<div id="pf85" class="pf w4 h1f" data-page-no="85"><div class="pc pc85 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg85.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>4.5<span class="_ _18b"> </span>File <span class="_"> </span>Access <span class="_"> </span>Permissions<span class="_ _1b"> </span><span class="ff18">99</span></div><div class="t m0 x3f h2a y12f ff19 fsf fc0 sc0 ls0 ws0">When <span class="_ _3"></span>we <span class="_ _9"></span>execute <span class="_ _9"></span>a <span class="_ _9"></span>program <span class="_ _3"></span>ﬁle, <span class="_ _9"></span>the <span class="_ _3"></span>effective <span class="_ _9"></span>user <span class="_ _3"></span>ID <span class="_ _9"></span>of <span class="_ _9"></span>the <span class="_ _9"></span>process <span class="_ _3"></span>is <span class="_ _3"></span>usually <span class="_ _9"></span>the</div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">al <span class="_ _9"></span>user <span class="_ _3"></span>ID, <span class="_ _9"></span>and <span class="_ _3"></span>the <span class="_ _3"></span>effective <span class="_ _3"></span>group <span class="_ _3"></span>ID <span class="_ _3"></span>is <span class="_ _9"></span>usually <span class="_ _3"></span>the <span class="_ _9"></span>real <span class="_ _2"></span>group <span class="_ _3"></span>ID.<span class="_ _16"> </span>However<span class="_ _1"></span>,<span class="_ _45"> </span>we<span class="_ _47"> </span>can</span></div><div class="t m0 x32 h26 y131 ff19 fsf fc0 sc0 ls0 ws0">also <span class="_ _23"></span>set <span class="_ _23"></span>a <span class="_ _23"> </span>special <span class="_ _23"> </span>ﬂag <span class="_ _23"> </span>in <span class="_ _23"> </span>the <span class="_ _23"> </span>ﬁle’s <span class="_ _42"> </span>mode <span class="_ _23"></span>wor<span class="_ _0"></span><span class="ls49d">d(<span class="_ _43"></span><span class="ff1a ls0">st_mode<span class="ff19 ls49d">)t<span class="_ _b"></span><span class="ls0">hat <span class="_ _23"></span>says, <span class="_ _23"></span>‘<span class="_ _1"></span>‘When <span class="_ _23"> </span>this <span class="_ _42"> </span>ﬁle <span class="_ _23"></span>is</span></span></span></span></div><div class="t m0 x32 h26 y132 ff19 fsf fc0 sc0 ls0 ws0">executed, <span class="_ _3"></span>set <span class="_ _9"></span>the <span class="_ _3"></span>effective <span class="_ _3"></span>user <span class="_ _9"></span>ID <span class="_ _3"></span>of <span class="_ _9"></span>the <span class="_ _3"></span>process <span class="_ _3"></span>to <span class="_ _9"></span>be <span class="_ _3"></span>the <span class="_ _9"></span>owner <span class="_ _3"></span>of <span class="_ _9"></span>the <span class="_ _3"></span>ﬁle <span class="_ _9"></span>(<span class="ff1a">st_uid</span>).’’</div><div class="t m0 x32 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">Similarly<span class="_ _4"></span>,<span class="_ _47"> </span>we<span class="_ _45"> </span>can <span class="_ _2"></span>set <span class="_ _3"></span>another <span class="_ _3"></span>bit <span class="_ _3"></span>in <span class="_ _3"></span>the <span class="_ _9"></span>ﬁle’s <span class="_ _2"></span>mode <span class="_ _9"></span>wor<span class="ls49e">dt<span class="_ _b"></span><span class="ls0">hat <span class="_ _3"></span>causes <span class="_ _3"></span>the <span class="_ _3"></span>effective <span class="_ _3"></span>group</span></span></div><div class="t m0 x32 h26 y134 ff19 fsf fc0 sc0 ls0 ws0">ID <span class="_ _9"></span>to <span class="_ _3"></span>be <span class="_ _9"></span>the <span class="_ _9"></span>group <span class="_ _3"></span>owner <span class="_ _9"></span>of <span class="_ _9"></span>the <span class="_ _9"></span>ﬁle <span class="_ _3"></span>(<span class="ff1a">st_gid</span>). <span class="_ _45"> </span>These<span class="_ _45"> </span>two <span class="_ _3"></span>bits <span class="_ _9"></span>in <span class="_ _9"></span>the <span class="_ _9"></span>ﬁle’s <span class="_ _9"></span>mode <span class="_ _3"></span>word</div><div class="t m0 x32 h2b y135 ff19 fsf fc0 sc0 ls0 ws0">ar<span class="ls44">ec<span class="_ _4f"></span><span class="ls0">alled the<span class="_"> </span><span class="ff1b">set-user-ID<span class="_"> </span></span>bit and the<span class="_"> </span><span class="ff1b">set-group-ID<span class="_"> </span></span>bit.</span></span></div><div class="t m0 x3f h2a y136 ff19 fsf fc0 sc0 ls0 ws0">For <span class="_ _3"></span>example, <span class="_ _3"></span>if <span class="_ _3"></span>the <span class="_ _3"></span>owner <span class="_ _3"></span>of <span class="_ _3"></span>the <span class="_ _3"></span>ﬁle <span class="_ _3"></span>is <span class="_ _3"></span>the <span class="_ _3"></span>superuser <span class="_ _3"></span>and <span class="_ _3"></span>if <span class="_ _3"></span>the <span class="_ _3"></span>ﬁle’s <span class="_ _3"></span>set-user-ID <span class="_ _3"></span>bit</div><div class="t m0 x32 h2a y137 ff19 fsf fc0 sc0 ls0 ws0">is <span class="_ _9"></span>set, <span class="_ _9"></span>then <span class="_ _9"></span>while <span class="_ _3"></span>that <span class="_ _9"></span>program <span class="_ _9"></span>ﬁle <span class="_ _9"></span>is <span class="_ _9"></span>running <span class="_ _3"></span>as <span class="_ _9"></span>a <span class="_ _9"></span>process, <span class="_ _9"></span>it <span class="_ _9"></span>has <span class="_ _9"></span>superuser <span class="_ _3"></span>privileges.</div><div class="t m0 x32 h2a y138 ff19 fsf fc0 sc0 ls0 ws0">This <span class="_ _9"></span>happens <span class="_ _3"></span>regardless <span class="_ _3"></span>of <span class="_ _9"></span>the <span class="_ _9"></span>real <span class="_ _3"></span>user <span class="_ _9"></span>ID <span class="_ _9"></span>of <span class="_ _9"></span>the <span class="_ _9"></span>process <span class="_ _3"></span>that <span class="_ _9"></span>executes <span class="_ _9"></span>the <span class="_ _9"></span>ﬁle.<span class="_ _5a"> </span>As <span class="_ _3"></span>an</div><div class="t m0 x32 h2a y139 ff19 fsf fc0 sc0 ls0 ws0">example, <span class="_ _2"></span>the <span class="_ _3"></span>UNIX <span class="_ _2"></span>System <span class="_ _3"></span>program <span class="_ _2"></span>that <span class="_ _3"></span>allows <span class="_ _2"></span>anyone <span class="_ _3"></span>to <span class="_ _3"></span>change <span class="_ _2"></span>his <span class="_ _3"></span>or <span class="_ _2"></span>her <span class="_ _3"></span>password,</div><div class="t m0 x32 h26 y13a ff1a fsf fc0 sc0 ls0 ws0">passwd</div><div class="t m0 x52 h2a ye85 ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 xc2 h2a y13a ff19 fsf fc0 sc0 ls0 ws0">1</div><div class="t m0 xc3 h2a ye85 ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 xc4 h2a y13a ff19 fsf fc0 sc0 ls0 ws0">,<span class="_ _66"> </span>is<span class="_ _47"> </span>a<span class="_ _66"> </span>set-user-ID <span class="_ _2"></span>program. <span class="_"> </span>This<span class="_ _47"> </span>is <span class="_ _2"></span>requir<span class="_ _0"></span>ed so <span class="_ _3"></span>that <span class="_ _2"></span>the <span class="_ _2"></span>program can <span class="_ _3"></span>write <span class="_ _2"></span>the</div><div class="t m0 x32 h26 y254 ff19 fsf fc0 sc0 ls0 ws0">new <span class="_ _23"> </span>password<span class="_ _35"> </span>to<span class="_ _35"> </span>the <span class="_ _23"></span>passwor<span class="ls49f">dﬁ<span class="_ _43"></span><span class="ls0">le, <span class="_ _23"></span>typically <span class="_ _23"> </span>either<span class="_ _35"> </span><span class="ff1a">/etc/passwd<span class="_ _35"> </span></span>or<span class="_ _35"> </span><span class="ff1a">/etc/shadow</span>,</span></span></div><div class="t m0 x32 h2a y255 ff19 fsf fc0 sc0 ls0 ws0">ﬁles <span class="_ _23"></span>that <span class="_ _9"></span>should <span class="_ _23"> </span>be <span class="_ _23"></span>writable <span class="_ _23"></span>only <span class="_ _9"></span>by <span class="_ _23"> </span>the <span class="_ _23"></span>superuser<span class="_ _6"></span><span class="ls4a0">.B<span class="_ _26"></span><span class="ls0">ecause <span class="_ _23"></span>a <span class="_ _23"></span>pr<span class="_ _0"></span>ocess <span class="_ _23"></span>that <span class="_ _9"></span>is <span class="_ _23"> </span>running</span></span></div><div class="t m0 x32 h2a y13b ff19 fsf fc0 sc0 ls0 ws0">set-user-ID <span class="_ _23"> </span>to <span class="_ _42"> </span>some <span class="_ _42"> </span>other <span class="_ _23"> </span>user <span class="_ _42"> </span>usually <span class="_ _42"> </span>assumes <span class="_ _42"> </span>extra <span class="_ _23"> </span>permissions, <span class="_ _42"> </span>it <span class="_ _42"> </span>must <span class="_ _42"> </span>be <span class="_ _23"> </span>written</div><div class="t m0 x32 h2a y13c ff19 fsf fc0 sc0 ls0 ws0">carefully<span class="_ _4"></span><span class="ls86">.W<span class="_ _26"></span><span class="ls0">e’ll discuss these types of programs in mor<span class="ls44">ed<span class="_ _4f"></span><span class="ls0">etail in Chapter 8.</span></span></span></span></div><div class="t m0 x3f h26 y256 ff19 fsf fc0 sc0 ls0 ws0">Returning <span class="_ _53"> </span>to <span class="_ _e"> </span>the<span class="_ _4b"> </span><span class="ff1a">stat<span class="_ _4b"> </span></span>function, <span class="_ _53"> </span>the <span class="_ _e"> </span>set-user-ID <span class="_ _53"> </span>bit <span class="_ _e"> </span>and <span class="_ _53"> </span>the <span class="_ _e"> </span>set-group-ID <span class="_ _53"> </span>bit <span class="_ _e"> </span>are</div><div class="t m0 x32 h26 y257 ff19 fsf fc0 sc0 ls0 ws0">contained <span class="_ _45"> </span>in <span class="_ _47"> </span>the <span class="_ _45"> </span>ﬁle’s<span class="_ _5a"> </span><span class="ff1a">st_mode<span class="_ _16"> </span></span>value. <span class="_ _5a"> </span>These<span class="_ _5a"> </span>two <span class="_ _45"> </span>bits <span class="_ _47"> </span>can <span class="_ _45"> </span>be <span class="_ _45"> </span>tested <span class="_ _47"> </span>against <span class="_ _45"> </span>the</div><div class="t m0 x32 h26 y258 ff19 fsf fc0 sc0 ls0 ws0">constants<span class="_"> </span><span class="ff1a">S_ISUID<span class="_ _80"> </span></span>and<span class="_"> </span><span class="ff1a">S_ISGID</span><span class="ls44">,r<span class="_ _d"></span><span class="ls0">espectively<span class="_ _4"></span>.</span></span></div><div class="t m0 x35 h53 ye86 ff16 fs2b fc0 sc0 ls0 ws0">4.5 <span class="_ _68"> </span>File<span class="_ _54"> </span>Access <span class="_"> </span>P<span class="_ _0"></span>ermissions</div><div class="t m0 x32 h26 ye87 ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _45"> </span><span class="ff1a">st_mode<span class="_ _45"> </span></span>value <span class="_ _9"></span>also <span class="_ _9"></span>encodes <span class="_ _9"></span>the <span class="_ _23"></span>access <span class="_ _9"></span>permission <span class="_ _9"></span>bits <span class="_ _9"></span>for <span class="_ _9"></span>the <span class="_ _23"></span>ﬁle.<span class="_ _5a"> </span>When <span class="_ _9"></span>we <span class="_ _9"></span>say</div><div class="t m0 x32 h2b ye88 ff1b fsf fc0 sc0 ls0 ws0">ﬁle<span class="ff19">,<span class="_ _5f"> </span>we<span class="_ _5f"> </span>mean <span class="_ _16"> </span>any <span class="_ _5a"> </span>of <span class="_ _16"> </span>the <span class="_ _16"> </span>ﬁle <span class="_ _5a"> </span>types <span class="_ _16"> </span>that <span class="_ _16"> </span>we <span class="_ _5a"> </span>described <span class="_ _16"> </span>earlier<span class="_ _6"></span><span class="ls4a1">.A<span class="_ _18c"></span><span class="ls0">ll <span class="_ _16"> </span>the <span class="_ _16"> </span>ﬁle</span></span></span></div><div class="t m0 x32 h2a ye89 ff19 fsf fc0 sc0 ls0 ws0">types <span class="_ _a"></span>— <span class="_ _a"></span>directories, <span class="_ _3"></span>character <span class="_ _9"></span>special <span class="_ _9"></span>ﬁles, <span class="_ _3"></span>and <span class="_ _9"></span>so <span class="_ _3"></span>on<span class="_ _9"></span><span class="ls9d">—h<span class="_ _6"></span><span class="ls0">ave <span class="_ _9"></span>permissions.<span class="_ _5a"> </span>Many <span class="_ _3"></span>people</span></span></div><div class="t m0 x32 h2a ye8a ff19 fsf fc0 sc0 ls0 ws0">think of only regular ﬁles as having access permissions.</div><div class="t m0 x3f h2a ye8b ff19 fsf fc0 sc0 ls0 ws0">Ther<span class="ls4a2">ea<span class="_ _b"></span><span class="ls45">re <span class="_ _9"></span>n<span class="_ _2"></span><span class="ls0">ine <span class="_ _3"></span>permission <span class="_ _3"></span>bits <span class="_ _9"></span>for <span class="_ _3"></span>each <span class="_ _3"></span>ﬁle, <span class="_ _3"></span>divided <span class="_ _3"></span>into <span class="_ _3"></span>three <span class="_ _3"></span>categories.<span class="_ _16"> </span>They <span class="_ _3"></span>are</span></span></span></div><div class="t m0 x32 h2a ye8c ff19 fsf fc0 sc0 ls0 ws0">shown in Figur<span class="ls44">e4<span class="_ _4f"></span><span class="ls0">.6.</span></span></div><div class="t m0 x146 h5e ye8d ff1a fs10 fc0 sc0 ls0 ws0">st_mode<span class="_ _53"> </span><span class="ff19">mask <span class="_ _170"> </span>Meaning</span></div><div class="t m0 x13 h4f ye8e ff1a fs11 fc0 sc0 ls0 ws0">S_IRUSR<span class="_ _129"> </span><span class="ff19">user-r<span class="_ _0"></span>ead</span></div><div class="t m0 x13 h4f ye8f ff1a fs11 fc0 sc0 ls0 ws0">S_IWUSR<span class="_ _129"> </span><span class="ff19">user-write</span></div><div class="t m0 x13 h4f ye90 ff1a fs11 fc0 sc0 ls0 ws0">S_IXUSR<span class="_ _129"> </span><span class="ff19">user-execute</span></div><div class="t m0 x13 h6d ye91 ff1a fs12 fc0 sc0 ls0 ws0">S_IRGRP<span class="_ _129"> </span><span class="ff19">group-r<span class="_ _0"></span>ead</span></div><div class="t m0 x13 h6d ye92 ff1a fs12 fc0 sc0 ls0 ws0">S_IWGRP<span class="_ _129"> </span><span class="ff19">group-write</span></div><div class="t m0 x13 h6d ye93 ff1a fs12 fc0 sc0 ls0 ws0">S_IXGRP<span class="_ _129"> </span><span class="ff19">group-execute</span></div><div class="t m0 x13 h63 ye94 ff1a fs13 fc0 sc0 ls0 ws0">S_IROTH<span class="_ _129"> </span><span class="ff19">other-r<span class="_ _0"></span>ead</span></div><div class="t m0 x13 h63 ye95 ff1a fs13 fc0 sc0 ls0 ws0">S_IWOTH<span class="_ _129"> </span><span class="ff19">other-write</span></div><div class="t m0 x13 h63 ye96 ff1a fs13 fc0 sc0 ls0 ws0">S_IXOTH<span class="_ _129"> </span><span class="ff19">other-execute</span></div><div class="t m0 xf6 h6f ye97 ff18 fs14 fc0 sc0 ls0 ws0">Figure 4.6<span class="_ _5a"> </span><span class="ff19">The nine ﬁle access permission bits, from<span class="_"> </span><span class="ff1a">&lt;sys/stat.h&gt;</span></span></div><div class="t m0 x32 h9a ye98 ff19 fs49 fc0 sc0 ls0 ws0">The <span class="_ _23"></span>term<span class="_ _35"> </span><span class="ff1b">user<span class="_ _35"> </span></span>in <span class="_ _23"></span>the <span class="_ _23"></span>ﬁrst <span class="_ _23"></span>three <span class="_ _9"></span>rows <span class="_ _23"></span>in <span class="_ _23"></span>Figur<span class="ls4a3">e4<span class="_ _43"></span><span class="ls0">.6 <span class="_ _23"></span>refers <span class="_ _9"></span>to <span class="_ _42"> </span>the <span class="_ _23"></span>owner <span class="_ _23"></span>of <span class="_ _23"></span>the <span class="_ _23"></span>ﬁle.<span class="_ _51"> </span>The</span></span></div><div class="t m0 x32 h9b ye99 ff1a fs49 fc0 sc0 ls0 ws0">chmod</div><div class="t m0 x182 h96 ye9a ff19 fs49 fc0 sc0 ls0 ws0">(</div><div class="t m0 x183 h96 ye99 ff19 fs49 fc0 sc0 ls0 ws0">1</div><div class="t m0 x14 h96 ye9a ff19 fs49 fc0 sc0 ls0 ws0">)</div><div class="t m0 x7c h96 ye99 ff19 fs49 fc0 sc0 ls0 ws0">command, <span class="_"> </span>which <span class="_"> </span>is <span class="_ _66"> </span>typically <span class="_ _66"> </span>used <span class="_ _66"> </span>to <span class="_ _66"> </span>modify <span class="_"> </span>these <span class="_ _66"> </span>nine <span class="_ _66"> </span>permission <span class="_ _66"> </span>bits,</div><div class="t m0 x32 h9b ye9b ff19 fs49 fc0 sc0 ls0 ws0">allows <span class="_ _3"></span>us <span class="_ _3"></span>to <span class="_ _9"></span>specify<span class="_ _47"> </span><span class="ff1a">u<span class="_ _47"> </span></span>for <span class="_ _9"></span>user <span class="_ _3"></span>(owner),<span class="_ _45"> </span><span class="ff1a">g<span class="_ _47"> </span></span>for <span class="_ _3"></span>group, <span class="_ _2"></span>and<span class="_ _45"> </span><span class="ff1a">o<span class="_ _47"> </span></span>for <span class="_ _3"></span>other<span class="_ _1"></span><span class="ls4a4">.S<span class="_ _1d"></span><span class="ls0">ome <span class="_ _3"></span>books <span class="_ _3"></span>refer</span></span></div><div class="t m0 x32 h9b ye9c ff19 fs49 fc0 sc0 ls0 ws0">to <span class="_ _23"> </span>these <span class="_ _42"> </span>three <span class="_ _23"></span>as <span class="_ _23"> </span>owner<span class="_ _1"></span><span class="ls4a5">,g<span class="_ _43"></span><span class="ls4a6">ro<span class="ls0">up, <span class="_ _42"> </span>and <span class="_ _23"> </span>world; <span class="_ _42"> </span>this <span class="_ _23"> </span>is <span class="_ _42"> </span>confusing, <span class="_ _23"> </span>as <span class="_ _42"> </span>the<span class="_ _35"> </span><span class="ff1a">chmod<span class="_ _35"> </span></span>command</span></span></span></div><a class="l" href="#pfd" data-dest-detail='[13,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892201px;bottom:717.168890px;width:183.047912px;height:19.680023px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
