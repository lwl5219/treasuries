<div id="pf99" class="pf w4 h1f" data-page-no="99"><div class="pc pc99 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg99.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h7a ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>4.16<span class="_ _149"> </span><span class="ff1a">rename<span class="_ _4b"> </span></span>and<span class="_ _4b"> </span><span class="ff1a">renameat<span class="_ _4b"> </span></span>Functions<span class="_ _1b"> </span><span class="ff18 ls153">11<span class="_ _2"></span><span class="ls0">9</span></span></div><div class="t m0 x3f h26 y12f ff19 fsf fc0 sc0 ls0 ws0">The <span class="_"> </span>superuser <span class="_"> </span>can <span class="_"> </span>call<span class="_ _59"> </span><span class="ff1a">unlink<span class="_ _46"> </span></span>with<span class="_ _46"> </span><span class="ff1b">pathname<span class="_ _46"> </span></span>specifying <span class="_"> </span>a <span class="_"> </span>directory <span class="_"> </span>if <span class="_"> </span>the <span class="_"> </span>ﬁle</div><div class="t m0 x32 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">system supports <span class="_ _2"></span>it, but <span class="_ _2"></span>the function<span class="_ _66"> </span><span class="ff1a">rmdir<span class="_ _66"> </span></span>should be <span class="_ _2"></span>used instead <span class="_ _2"></span>to unlink <span class="_ _2"></span>a directory<span class="_ _4"></span>.</div><div class="t m0 x32 h26 y131 ff19 fsf fc0 sc0 ls5f ws0">We <span class="_ _53"> </span>d<span class="_ _9"></span><span class="ls0">escribe the<span class="_"> </span><span class="ff1a">rmdir<span class="_ _66"> </span></span>function in Section 4.21.</span></div><div class="t m0 x3f h26 y132 ff19 fsf fc0 sc0 ls5f ws0">We <span class="_ _44"> </span>c<span class="_ _9"></span><span class="ls0">an <span class="_"> </span>also <span class="_"> </span>unlink <span class="_"> </span>a <span class="_"> </span>ﬁle <span class="_"> </span>or <span class="_"> </span>a <span class="_"> </span>dir<span class="_ _0"></span>ectory <span class="_"> </span>with <span class="_"> </span>the<span class="_ _59"> </span><span class="ff1a">remove<span class="_ _46"> </span></span>function. <span class="_ _59"> </span>For<span class="_ _46"> </span><span class="ls45d">aﬁ<span class="_ _4a"></span><span class="ls0">le,</span></span></span></div><div class="t m0 x32 h26 y133 ff1a fsf fc0 sc0 ls0 ws0">remove<span class="_ _80"> </span><span class="ff19">is identical to<span class="_"> </span></span>unlink<span class="ff19 ls86">.F<span class="_ _4a"></span><span class="ls0">or a directory<span class="_ _4"></span>,<span class="_"> </span><span class="ff1a">remove<span class="_ _80"> </span></span>is identical to<span class="_"> </span><span class="ff1a">rmdir</span>.</span></span></div><div class="t m0 x3f h57 y1130 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;stdio.h&gt;</div><div class="t m0 x3f h57 y1131 ff1a fs2d fc0 sc0 ls0 ws0">int remove(const char *<span class="ff1b">pathname</span>);</div><div class="t m0 x153 h5f y1132 ff19 fs2d fc0 sc0 ls0 ws0">Returns: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x76 h5e yd5f ff19 fs10 fc0 sc0 ls0 ws0">ISO C speciﬁes the<span class="_"> </span><span class="ff1a">remove<span class="_ _e"> </span></span>function to delete a ﬁle.<span class="_ _44"> </span>The name was changed from the historical</div><div class="t m0 x76 h5e yd60 ff19 fs10 fc0 sc0 ls0 ws0">UNIX name of<span class="_"> </span><span class="ff1a">unlink<span class="_ _e"> </span></span>because <span class="_ _2"></span>most non-UNIX systems that <span class="_ _2"></span>implement the C standar<span class="ls542">dd<span class="_ _84"></span><span class="ls0">idn’t</span></span></div><div class="t m0 x76 h2d y1133 ff19 fs10 fc0 sc0 ls0 ws0">support the concept of links to a ﬁle at the time.</div><div class="t m0 x35 h7b y1134 ff16 fs27 fc0 sc0 ls0 ws0">4.16<span class="_ _6d"> </span><span class="ff1f">rename<span class="_ _54"> </span></span>and<span class="_ _54"> </span><span class="ff1f">renameat<span class="_ _54"> </span></span>Functions</div><div class="t m0 x32 h4d y1135 ff19 fs26 fc0 sc0 lsd3 ws0">Aﬁ<span class="_ _d"></span><span class="ls0">le or a directory is renamed with either the<span class="_"> </span><span class="ff1a">rename<span class="_ _e"> </span></span>or<span class="_"> </span><span class="ff1a">renameat<span class="_ _66"> </span></span>function.</span></div><div class="t m0 x3f h4e y1136 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;stdio.h&gt;</div><div class="t m0 x3f h4e y1137 ff1a fs28 fc0 sc0 ls0 ws0">int rename(const char *<span class="ff1b">oldname</span><span class="ls1b6">,c<span class="_ _1d"></span><span class="ls0">onst char *<span class="ff1b">newname</span>);</span></span></div><div class="t m0 x3f h4e y1138 ff1a fs28 fc0 sc0 ls0 ws0">int renameat(int<span class="_"> </span><span class="ff1b">oldfd</span><span class="ls1b6">,c<span class="_ _1d"></span><span class="ls0">onst char *<span class="ff1b">oldname</span><span class="ls1b6">,i<span class="_ _5b"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">newfd</span>,</span></span></span></span></div><div class="t m0 xf0 h4e y1139 ff1a fs28 fc0 sc0 ls0 ws0">const char *<span class="ff1b">newname</span>);</div><div class="t m0 x103 h7c y113a ff19 fs28 fc0 sc0 ls0 ws0">Both return: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>err<span class="_ _0"></span>or</div><div class="t m0 x76 h4f y113b ff19 fs11 fc0 sc0 ls0 ws0">The<span class="_ _44"> </span><span class="ff1a">rename<span class="_ _4b"> </span></span>function <span class="_ _80"> </span>is <span class="_ _e"> </span>deﬁned <span class="_ _80"> </span>by <span class="_ _80"> </span>ISO <span class="_ _80"> </span>C <span class="_ _80"> </span>for <span class="_ _80"> </span>ﬁles.<span class="_ _51"> </span>(The <span class="_ _80"> </span>C <span class="_ _80"> </span>standar<span class="ls543">dd<span class="_ _55"></span><span class="ls0">oesn’t <span class="_ _80"> </span>deal <span class="_ _80"> </span>with</span></span></div><div class="t m0 x76 h2e y113c ff19 fs11 fc0 sc0 ls0 ws0">directories.) <span class="_"> </span>POSIX.1<span class="_"> </span>expanded the deﬁnition to include dir<span class="_ _0"></span>ectories and symbolic links.</div><div class="t m0 x3f h55 y113d ff19 fs2c fc0 sc0 ls0 ws0">Ther<span class="ls544">ea<span class="_ _b"></span><span class="ls150">re <span class="_ _9"></span>s<span class="_ _2"></span><span class="ls0">everal <span class="_ _9"></span>conditions <span class="_ _3"></span>to <span class="_ _3"></span>describe <span class="_ _9"></span>for <span class="_ _3"></span>these <span class="_ _3"></span>functions, <span class="_ _3"></span>depending <span class="_ _9"></span>on <span class="_ _3"></span>whether</span></span></span></div><div class="t m0 x32 h60 y113e ff1b fs2c fc0 sc0 ls0 ws0">oldname<span class="_ _44"> </span><span class="ff19 ls150">re<span class="_ _2"></span><span class="ls0">fers <span class="_ _53"> </span>to <span class="_ _53"> </span>a <span class="_ _53"> </span>ﬁle, <span class="_ _53"> </span>a <span class="_ _e"> </span>directory<span class="_ _4"></span>,<span class="_ _44"> </span>or<span class="_ _4b"> </span>a<span class="_ _44"> </span>symbolic <span class="_ _e"> </span>link.<span class="_ _65"> </span><span class="ls155">We <span class="_ _35"> </span>m<span class="_ _9"></span></span>ust <span class="_ _53"> </span>also <span class="_ _53"> </span>describe <span class="_ _53"> </span>what</span></span></div><div class="t m0 x32 h60 y113f ff19 fs2c fc0 sc0 ls0 ws0">happens if<span class="_"> </span><span class="ff1b">newname<span class="_"> </span></span>already exists.</div><div class="t m0 x3f h60 y1140 ff19 fs2c fc0 sc0 ls0 ws0">1. <span class="_ _51"> </span>If<span class="_ _47"> </span><span class="ff1b">oldname<span class="_ _47"> </span></span>speciﬁes <span class="_ _3"></span>a <span class="_ _3"></span>ﬁle <span class="_ _3"></span>that <span class="_ _3"></span>is <span class="_ _3"></span>not <span class="_ _3"></span>a <span class="_ _2"></span>directory<span class="_ _4"></span><span class="ls545">,t<span class="_ _4f"></span><span class="ls0">hen <span class="_ _3"></span>we <span class="_ _3"></span>ar<span class="ls545">er<span class="_ _b"></span><span class="ls0">enaming <span class="_ _3"></span>a <span class="_ _3"></span>ﬁle <span class="_ _3"></span>or <span class="_ _3"></span>a</span></span></span></span></div><div class="t m0 x41 h60 y1141 ff19 fs2c fc0 sc0 ls0 ws0">symbolic <span class="_ _23"> </span>link.<span class="_ _54"> </span>In <span class="_ _23"> </span>this <span class="_ _42"> </span>case, <span class="_ _23"> </span>if<span class="_ _44"> </span><span class="ff1b">newname<span class="_ _35"> </span></span>exists, <span class="_ _23"> </span>it <span class="_ _42"> </span>cannot <span class="_ _23"> </span>refer <span class="_ _23"> </span>to <span class="_ _42"> </span>a <span class="_ _23"> </span>directory<span class="_ _4"></span><span class="ls546">.I<span class="_ _7"></span><span class="ls0">f</span></span></div><div class="t m0 x41 h60 y1142 ff1b fs2c fc0 sc0 ls0 ws0">newname<span class="_ _45"> </span><span class="ff19">exists <span class="_ _3"></span>and <span class="_ _9"></span>is <span class="_ _9"></span>not <span class="_ _9"></span>a <span class="_ _9"></span>directory<span class="_ _4"></span>,<span class="_ _45"> </span>it<span class="_ _45"> </span>is<span class="_ _45"> </span>r<span class="_ _0"></span>emoved, <span class="_ _9"></span>and<span class="_ _45"> </span><span class="ff1b">oldname<span class="_ _47"> </span></span>is <span class="_ _9"></span>renamed <span class="_ _9"></span>to</span></div><div class="t m0 x41 h60 y1143 ff1b fs2c fc0 sc0 ls0 ws0">newname<span class="ff19 ls547">.W<span class="_ _64"></span><span class="ls548">em<span class="_ _b"></span><span class="ls0">ust <span class="_ _23"></span>have <span class="_ _9"></span>write <span class="_ _9"></span>permission <span class="_ _23"></span>for <span class="_ _9"></span>the <span class="_ _9"></span>directory <span class="_ _9"></span>containing<span class="_ _45"> </span><span class="ff1b">oldname</span></span></span></span></div><div class="t m0 x41 h60 y1144 ff19 fs2c fc0 sc0 ls0 ws0">and the directory containing<span class="_"> </span><span class="ff1b">newname</span><span class="ls142">,s<span class="_ _4f"></span><span class="ls0">ince we ar<span class="ls142">ec<span class="_ _d"></span><span class="ls0">hanging both directories.</span></span></span></span></div><div class="t m0 x3f h60 y1145 ff19 fs2c fc0 sc0 ls0 ws0">2. <span class="_ _51"> </span>If<span class="_ _44"> </span><span class="ff1b">oldname<span class="_ _35"> </span></span>speciﬁes <span class="_ _42"> </span>a <span class="_ _42"> </span>directory<span class="_ _4"></span><span class="ls549">,t<span class="_ _43"></span><span class="ls0">hen <span class="_ _23"> </span>we <span class="_ _42"> </span>ar<span class="ls54a">er<span class="_ _c"></span><span class="ls0">enaming <span class="_ _42"> </span>a <span class="_ _42"> </span>directory<span class="_ _4"></span><span class="ls54b">.I<span class="_ _52"></span><span class="ls0">f<span class="_ _44"> </span><span class="ff1b">newname</span></span></span></span></span></span></span></div><div class="t m0 x41 h55 y1146 ff19 fs2c fc0 sc0 ls0 ws0">exists, <span class="_ _2"></span>it <span class="_ _3"></span>must <span class="_ _3"></span>refer <span class="_ _2"></span>to <span class="_ _3"></span>a <span class="_ _3"></span>directory<span class="_ _4"></span><span class="ls54c">,a<span class="_ _8"></span><span class="ls0">nd <span class="_ _3"></span>that <span class="_ _3"></span>directory <span class="_ _2"></span>must <span class="_ _3"></span>be <span class="_ _2"></span>empty<span class="_ _6"></span><span class="ls54d">.(<span class="_ _1d"></span><span class="ls0">When <span class="_ _3"></span>we</span></span></span></span></div><div class="t m0 x41 h55 y1147 ff19 fs2c fc0 sc0 ls0 ws0">say <span class="_ _3"></span>that <span class="_ _3"></span>a <span class="_ _3"></span>directory <span class="_ _3"></span>is <span class="_ _3"></span>empty<span class="_ _6"></span>,<span class="_ _47"> </span>we<span class="_ _45"> </span>mean <span class="_ _2"></span>that <span class="_ _9"></span>the <span class="_ _3"></span>only <span class="_ _3"></span>entries <span class="_ _3"></span>in <span class="_ _9"></span>the <span class="_ _3"></span>directory <span class="_ _2"></span>are</div><div class="t m0 x41 h60 y1148 ff19 fs2c fc0 sc0 ls0 ws0">dot and dot-dot.)<span class="_ _46"> </span>If<span class="_"> </span><span class="ff1b">newname<span class="_"> </span></span>exists <span class="_ _2"></span>and is an empty <span class="_ _2"></span>directory<span class="_ _4"></span>,<span class="_"> </span>it<span class="_"> </span>i<span class="ls187">sr<span class="_ _4f"></span><span class="ls0">emoved, <span class="_ _2"></span>and</span></span></div><div class="t m0 x41 h60 y1149 ff1b fs2c fc0 sc0 ls0 ws0">oldname<span class="_"> </span><span class="ff19">is <span class="_ _2"></span>renamed to<span class="_ _66"> </span></span>newname<span class="ff19 ls54e">.A<span class="_ _4a"></span><span class="ls0">dditionally<span class="_ _4"></span><span class="ls54f">,w<span class="_ _d"></span><span class="ls0">hen we’r<span class="ls54f">er<span class="_ _4f"></span><span class="ls0">enaming a <span class="_ _2"></span>directory<span class="_ _4"></span>,</span></span></span></span></span></span></div><div class="t m0 x41 h60 y114a ff1b fs2c fc0 sc0 ls0 ws0">newname<span class="_ _4b"> </span><span class="ff19">cannot <span class="_"> </span>contain <span class="_ _53"> </span>a <span class="_"> </span>path <span class="_ _53"> </span>preﬁx <span class="_ _53"> </span>that <span class="_"> </span>names<span class="_ _4b"> </span></span>oldname<span class="ff19 ls550">.F<span class="_ _64"></span><span class="ls0">or <span class="_ _e"> </span>example, <span class="_ _e"> </span>we</span></span></div><div class="t m0 x41 h54 y114b ff19 fs2c fc0 sc0 ls0 ws0">can’t <span class="_ _59"> </span>rename<span class="_ _48"> </span><span class="ff1a">/usr/foo<span class="_ _48"> </span></span>to<span class="_ _60"> </span><span class="ff1a">/usr/foo/testdir</span><span class="ls551">,b<span class="_ _5d"></span><span class="ls0">ecause <span class="_ _59"> </span>the <span class="_ _46"> </span>old <span class="_ _59"> </span>name</span></span></div><div class="t m0 x41 h54 y114c ff19 fs2c fc0 sc0 ls0 ws0">(<span class="ff1a">/usr/foo</span>)<span class="_"> </span>is<span class="_"> </span>a<span class="_"> </span>path preﬁx of the new name and cannot be r<span class="_ _0"></span>emoved.</div><a class="l" href="#pfd" data-dest-detail='[13,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892201px;bottom:858.291030px;width:235.487915px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
