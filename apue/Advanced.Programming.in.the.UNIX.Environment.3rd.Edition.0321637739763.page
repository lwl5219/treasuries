<div id="pf2fb" class="pf w4 h1f" data-page-no="2fb"><div class="pc pc2fb w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg2fb.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h7a ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>19.5<span class="_ _30d"> </span><span class="ff1a">pty<span class="_ _4b"> </span></span>Program<span class="_ _1fb"> </span><span class="ff18">729</span></div><div class="t m0 x9d h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">if (dup2(fds, STDOUT_FILENO) != STDOUT_FILENO)</div><div class="t m0 x1f h57 y426 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;dup2 error to stdout&quot;);</div><div class="t m0 x9d h57 y800 ff1a fs2d fc0 sc0 ls0 ws0">if (dup2(fds, STDERR_FILENO) != STDERR_FILENO)</div><div class="t m0 x1f h57 y801 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;dup2 error to stderr&quot;);</div><div class="t m0 x9d h57 y802 ff1a fs2d fc0 sc0 ls0 ws0">if (fds != STDIN_FILENO &amp;&amp; fds != STDOUT_FILENO &amp;&amp;</div><div class="t m0 x76 h57 y803 ff1a fs2d fc0 sc0 ls0 ws0">fds != STDERR_FILENO)</div><div class="t m0 x1f h57 y804 ff1a fs2d fc0 sc0 ls0 ws0">close(fds);</div><div class="t m0 x9d h57 y805 ff1a fs2d fc0 sc0 ls0 ws0">return(0); <span class="_ _8a"> </span>/*<span class="_"> </span>child returns 0 just like fork() */</div><div class="t m0 x8a h57 y806 ff1a fs2d fc0 sc0 ls15c ws0">}e<span class="_ _1d"></span><span class="ls0">lse {<span class="_ _296"> </span>/* parent */</span></div><div class="t m0 x9d h57 y807 ff1a fs2d fc0 sc0 ls0 ws0">*ptrfdm = fdm;<span class="_ _d9"> </span>/* return fd of master */</div><div class="t m0 x9d h57 y808 ff1a fs2d fc0 sc0 ls0 ws0">return(pid); <span class="_ _68"> </span>/*<span class="_"> </span>parent returns pid of child */</div><div class="t m0 x8a h57 y809 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h57 y80a ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x145 h5e y53fd ff18 fs10 fc0 sc0 ls0 ws0">Figure 19.10<span class="_ _5a"> </span><span class="ff19">The<span class="_"> </span><span class="ff1a">pty_fork<span class="_ _e"> </span></span>function</span></div><div class="t m0 x35 h7b y53fe ff16 fs27 fc0 sc0 ls0 ws0">19.5<span class="_ _6d"> </span><span class="ff1f">pty<span class="_ _54"> </span></span>Program</div><div class="t m0 x32 h4d y53ff ff19 fs26 fc0 sc0 ls0 ws0">The goal in writing the<span class="_"> </span><span class="ff1a">pty<span class="_ _80"> </span></span>program is to be able to type</div><div class="t m0 x3f h4e y5400 ff1a fs28 fc0 sc0 ls0 ws0">pty prog arg1 arg2</div><div class="t m0 x32 h49 y5401 ff19 fs26 fc0 sc0 ls0 ws0">instead of</div><div class="t m0 x3f h4e y5402 ff1a fs28 fc0 sc0 ls0 ws0">prog arg1 arg2</div><div class="t m0 x32 h4d y5403 ff19 fs26 fc0 sc0 ls0 ws0">When <span class="_ _2"></span>we <span class="_ _3"></span>use<span class="_ _47"> </span><span class="ff1a">pty<span class="_ _66"> </span></span>to <span class="_ _3"></span>execute <span class="_ _2"></span>another <span class="_ _3"></span>program, <span class="_ _2"></span>that <span class="_ _2"></span>program <span class="_ _2"></span>is <span class="_ _2"></span>executed <span class="_ _3"></span>in <span class="_ _2"></span>a <span class="_ _3"></span>session <span class="_ _3"></span>of</div><div class="t m0 x32 h49 y5404 ff19 fs26 fc0 sc0 ls0 ws0">its own, connected to a pseudo terminal.</div><div class="t m0 x3f h4d y5405 ff19 fs26 fc0 sc0 ls0 ws0">Let’s <span class="_ _e"> </span>look <span class="_"> </span>at <span class="_ _e"> </span>the <span class="_"> </span>sour<span class="_ _0"></span>ce <span class="_ _e"> </span>code <span class="_"> </span>for <span class="_ _e"> </span>the<span class="_ _59"> </span><span class="ff1a">pty<span class="_ _59"> </span></span>program. <span class="_ _4b"> </span>The<span class="_ _59"> </span>ﬁrst <span class="_"> </span>ﬁle <span class="_ _53"> </span>(Figur<span class="ls15b6">e1<span class="_ _4a"></span><span class="ls0">9.1<span class="_ _0"></span>1)</span></span></div><div class="t m0 x32 h4d y5406 ff19 fs26 fc0 sc0 ls0 ws0">contains the<span class="_"> </span><span class="ff1a">main<span class="_ _80"> </span></span>function. <span class="_"> </span>It<span class="_"> </span>calls the<span class="_"> </span><span class="ff1a">pty_fork<span class="_ _66"> </span></span>function from the pr<span class="_ _0"></span>evious section.</div><div class="t m0 x32 h5d y5407 ff1a fs2f fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h5d y5408 ff1a fs2f fc0 sc0 ls0 ws0">#include &lt;termios.h&gt;</div><div class="t m0 x32 h5d y5409 ff1a fs2f fc0 sc0 ls0 ws0">#ifdef LINUX</div><div class="t m0 x32 h5d y540a ff1a fs2f fc0 sc0 ls0 ws0">#define OPTSTR &quot;+d:einv&quot;</div><div class="t m0 x32 h5d y540b ff1a fs2f fc0 sc0 ls0 ws0">#else</div><div class="t m0 x32 h5d y540c ff1a fs2f fc0 sc0 ls0 ws0">#define OPTSTR &quot;d:einv&quot;</div><div class="t m0 x32 h5d y540d ff1a fs2f fc0 sc0 ls0 ws0">#endif</div><div class="t m0 x32 h5d y540e ff1a fs2f fc0 sc0 ls0 ws0">static void set_noecho(int);<span class="_ _15"> </span>/* at the end of this file */</div><div class="t m0 x32 h5d y540f ff1a fs2f fc0 sc0 ls0 ws0">void <span class="_ _b7"> </span>do_driver(char<span class="_"> </span>*); <span class="_"> </span>/*<span class="_"> </span>in the file driver.c */</div><div class="t m0 x32 h5d y5410 ff1a fs2f fc0 sc0 ls0 ws0">void <span class="_ _b7"> </span>loop(int,<span class="_"> </span>int); <span class="_ _15"> </span>/*<span class="_"> </span>in the file loop.c */</div><div class="t m0 x32 h5d y5411 ff1a fs2f fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h5d y5412 ff1a fs2f fc0 sc0 ls0 ws0">main(int argc, char *argv[])</div><div class="t m0 x32 h5d y5413 ff1a fs2f fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h5d y5414 ff1a fs2f fc0 sc0 ls0 ws0">int <span class="_ _82"> </span>fdm,<span class="_"> </span>c, ignoreeof, interactive, noecho, verbose;</div><div class="t m0 x8a h5d y5415 ff1a fs2f fc0 sc0 ls0 ws0">pid_t <span class="_ _74"> </span>pid;</div><div class="t m0 x8a h5d y5416 ff1a fs2f fc0 sc0 ls0 ws0">char <span class="_ _bd"> </span>*driver;</div><div class="t m0 x8a h5d y5417 ff1a fs2f fc0 sc0 ls0 ws0">char <span class="_ _bd"> </span>slave_name[20];</div><a class="l" href="#pf13" data-dest-detail='[19,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.893467px;bottom:824.898928px;width:113.375298px;height:19.678986px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
