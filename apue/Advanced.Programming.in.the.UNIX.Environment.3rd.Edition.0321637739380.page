<div id="pf17c" class="pf w4 h1f" data-page-no="17c"><div class="pc pc17c w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg17c.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">346<span class="_ _1b"> </span><span class="ff19">Signals <span class="_ _24b"> </span>Chapter<span class="_ _21"> </span>10</span></div><div class="t m0 x35 h75 y12f ff16 fs2b fc0 sc0 ls0 ws0">10.12<span class="_ _5a"> </span><span class="ff1f">sigprocmask<span class="_ _54"> </span></span>Function</div><div class="t m0 x32 h2a y4de ff19 fsf fc0 sc0 ls0 ws0">Recall <span class="_ _3"></span>from <span class="_ _3"></span>Section <span class="_ _9"></span>10.8 <span class="_ _3"></span>that <span class="_ _9"></span>the <span class="_ _3"></span>signal <span class="_ _9"></span>mask <span class="_ _3"></span>of <span class="_ _9"></span>a <span class="_ _3"></span>process <span class="_ _3"></span>is <span class="_ _9"></span>the <span class="_ _3"></span>set <span class="_ _9"></span>of <span class="_ _3"></span>signals <span class="_ _9"></span>currently</div><div class="t m0 x32 h2a y6d0 ff19 fsf fc0 sc0 ls0 ws0">blocked from delivery to that pr<span class="_ _0"></span>ocess. <span class="_"> </span>A<span class="_"> </span>process can examine its signal mask, change its</div><div class="t m0 x32 h2a y6d1 ff19 fsf fc0 sc0 ls0 ws0">signal mask, or perform both operations in one step by calling the following function.</div><div class="t m0 x3f h57 y1130 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;signal.h&gt;</div><div class="t m0 x3f h57 y2c3d ff1a fs2d fc0 sc0 ls0 ws0">int sigprocmask(int<span class="_"> </span><span class="ff1b">how</span><span class="ls15c">,c<span class="_ _1d"></span><span class="ls0">onst sigset_t *restrict<span class="_"> </span><span class="ff1b">set</span>,</span></span></div><div class="t m0 x1dd h57 y2c3e ff1a fs2d fc0 sc0 ls0 ws0">sigset_t *restrict<span class="_"> </span><span class="ff1b">oset</span>);</div><div class="t m0 x153 h5f y2c3f ff19 fs2d fc0 sc0 ls0 ws0">Returns: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h4a y2c40 ff19 fs26 fc0 sc0 ls0 ws0">First, <span class="_ _42"> </span>if<span class="_ _35"> </span><span class="ff1b">oset<span class="_ _44"> </span></span>is <span class="_ _42"> </span>a <span class="_ _42"> </span>non-null <span class="_ _42"> </span>pointer<span class="_ _6"></span><span class="lsc9c">,t<span class="_ _43"></span><span class="ls0">he <span class="_ _42"> </span>current <span class="_ _23"> </span>signal <span class="_ _42"> </span>mask <span class="_ _42"> </span>for <span class="_ _42"> </span>the <span class="_ _42"> </span>process <span class="_ _42"> </span>is <span class="_ _42"> </span>returned</span></span></div><div class="t m0 x32 h4a y2c41 ff19 fs26 fc0 sc0 ls0 ws0">through<span class="_"> </span><span class="ff1b">oset</span>.</div><div class="t m0 x3f h4a y2c42 ff19 fs26 fc0 sc0 ls0 ws0">Second, <span class="_ _53"> </span>if<span class="_ _4b"> </span><span class="ff1b">set<span class="_ _4b"> </span></span>is <span class="_ _53"> </span>a <span class="_ _e"> </span>non-null <span class="_ _53"> </span>pointer<span class="_ _1"></span><span class="lsc9d">,t<span class="_ _55"></span><span class="ls0">he<span class="_ _4b"> </span><span class="ff1b">how<span class="_ _4b"> </span></span>argument <span class="_ _53"> </span>indicates <span class="_ _53"> </span>how <span class="_ _e"> </span>the <span class="_ _53"> </span>current</span></span></div><div class="t m0 x32 h4a y2c43 ff19 fs26 fc0 sc0 ls0 ws0">signal <span class="_ _46"> </span>mask <span class="_ _61"> </span>is <span class="_ _46"> </span>modiﬁed.<span class="_ _d9"> </span>Figur<span class="_ _0"></span><span class="lsc9e">e1<span class="_ _49"></span><span class="ls0">0.13 <span class="_ _46"> </span>describes <span class="_ _61"> </span>the <span class="_ _61"> </span>possible <span class="_ _46"> </span>values <span class="_ _61"> </span>for<span class="_ _50"> </span><span class="ff1b">how</span>.</span></span></div><div class="t m0 x32 h4d y2c44 ff1a fs26 fc0 sc0 ls0 ws0">SIG_BLOCK<span class="_ _4b"> </span><span class="ff19">is <span class="_"> </span>an <span class="_ _53"> </span>inclusive-OR <span class="_ _e"> </span>operation, <span class="_"> </span>wher<span class="_ _1"></span>eas<span class="_ _59"> </span><span class="ff1a">SIG_SETMASK<span class="_ _4b"> </span></span>is <span class="_"> </span>an <span class="_ _53"> </span>assignment.</span></div><div class="t m0 x32 h4d y2c45 ff19 fs26 fc0 sc0 ls0 ws0">Note that<span class="_"> </span><span class="ff1a">SIGKILL<span class="_ _80"> </span></span>and<span class="_"> </span><span class="ff1a">SIGSTOP<span class="_ _66"> </span></span>can’t be blocked.</div><div class="t m0 xd8 h56 y2c46 ff1b fs11 fc0 sc0 ls0 ws0">how<span class="_ _1bf"> </span><span class="ff19">Description</span></div><div class="t m0 x14b h6d y2c47 ff1a fs12 fc0 sc0 ls0 ws0">SIG_BLOCK<span class="_ _15"> </span><span class="ff19">The new signal mask for the process is the union of its curr<span class="_ _0"></span>ent signal mask</span></div><div class="t m0 xea hd1 y2c48 ff19 fs12 fc0 sc0 ls0 ws0">and the signal set pointed to by<span class="_"> </span><span class="ff1b">set</span><span class="lsc9f">.T<span class="_ _43"></span><span class="ls0">hat is,<span class="_"> </span><span class="ff1b">set<span class="_"> </span></span>contains the additional</span></span></div><div class="t m0 xea h2f y2c49 ff19 fs12 fc0 sc0 ls0 ws0">signals that we want to block.</div><div class="t m0 x14b h6d y2c4a ff1a fs12 fc0 sc0 ls0 ws0">SIG_UNBLOCK<span class="_ _6e"> </span><span class="ff19">The new signal mask for the process is the intersection of its curr<span class="_ _0"></span>ent signal</span></div><div class="t m0 xea hd1 y2c4b ff19 fs12 fc0 sc0 ls0 ws0">mask and the complement of the signal set pointed to by<span class="_"> </span><span class="ff1b">set</span><span class="lsc9f">.T<span class="_ _43"></span><span class="ls0">hat is,<span class="_"> </span><span class="ff1b">set</span></span></span></div><div class="t m0 xea h2f y2c4c ff19 fs12 fc0 sc0 ls0 ws0">contains the signals that we want to unblock.</div><div class="t m0 x14b h6d y2c4d ff1a fs12 fc0 sc0 ls0 ws0">SIG_SETMASK<span class="_ _6e"> </span><span class="ff19">The new signal mask for the process is r<span class="_ _0"></span>eplaced by the value of the signal</span></div><div class="t m0 xea hd1 y2c4e ff19 fs12 fc0 sc0 ls0 ws0">set pointed to by<span class="_"> </span><span class="ff1b">set</span>.</div><div class="t m0 x159 h63 y2c4f ff18 fs13 fc0 sc0 ls0 ws0">Figure 10.13<span class="_ _5a"> </span><span class="ff19 ls9b5">Wa<span class="_ _9"></span><span class="ls0">ys to change the current signal mask using<span class="_"> </span><span class="ff1a">sigprocmask</span></span></span></div><div class="t m0 x3f h79 y2c50 ff19 fs31 fc0 sc0 ls0 ws0">If<span class="_ _35"> </span><span class="ff1b">set<span class="_ _44"> </span></span>is <span class="_ _42"> </span>a <span class="_ _42"> </span>null <span class="_ _42"> </span>pointer<span class="_ _6"></span><span class="lsca0">,t<span class="_ _43"></span><span class="ls0">he <span class="_ _42"> </span>signal <span class="_ _42"> </span>mask <span class="_ _42"> </span>of <span class="_ _42"> </span>the <span class="_ _42"> </span>process <span class="_ _23"> </span>is <span class="_ _42"> </span>not <span class="_ _42"> </span>changed, <span class="_ _42"> </span>and<span class="_ _44"> </span><span class="ff1b">how<span class="_ _35"> </span></span>is</span></span></div><div class="t m0 x32 h6e y2c51 ff19 fs31 fc0 sc0 ls0 ws0">ignored.</div><div class="t m0 x3f h64 y2c52 ff19 fs31 fc0 sc0 ls0 ws0">After <span class="_ _23"></span>calling<span class="_ _35"> </span><span class="ff1a">sigprocmask</span>,<span class="_ _45"> </span>if<span class="_ _35"> </span>any <span class="_ _23"> </span>unblocked <span class="_ _23"> </span>signals <span class="_ _23"> </span>ar<span class="lsca1">ep<span class="_ _43"></span><span class="ls0">ending, <span class="_ _23"> </span>at <span class="_ _23"> </span>least <span class="_ _23"> </span>one <span class="_ _23"> </span>of</span></span></div><div class="t m0 x32 h64 y2c53 ff19 fs31 fc0 sc0 ls0 ws0">these signals is delivered to the pr<span class="_ _0"></span>ocess befor<span class="_ _0"></span>e<span class="_"> </span><span class="ff1a">sigprocmask<span class="_ _80"> </span></span><span class="ls225">re<span class="_ _2"></span></span>turns.</div><div class="t m0 x76 h63 y2c54 ff19 fs13 fc0 sc0 ls0 ws0">The<span class="_"> </span><span class="ff1a">sigprocmask<span class="_ _e"> </span></span>function is <span class="_ _2"></span>deﬁned only <span class="_ _2"></span>for single-threaded processes. <span class="_"> </span>A<span class="_"> </span>separate function</div><div class="t m0 x76 h30 y2c55 ff19 fs13 fc0 sc0 ls0 ws0">is provided to manipulate a thread’s signal mask in a multithreaded process. <span class="_"> </span>W<span class="_ _6"></span>e’ll discuss this</div><div class="t m0 x76 h30 y2c56 ff19 fs13 fc0 sc0 ls0 ws0">in Section 12.8.</div><div class="t m0 x35 h136 y2c57 ff16 fs31 fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h6e y2c58 ff19 fs31 fc0 sc0 ls0 ws0">Figur<span class="lsca2">e1<span class="_ _b"></span><span class="ls0">0.14 <span class="_ _3"></span>shows <span class="_ _3"></span>a <span class="_ _3"></span>function <span class="_ _3"></span>that <span class="_ _3"></span>prints <span class="_ _3"></span>the <span class="_ _2"></span>names <span class="_ _3"></span>of <span class="_ _3"></span>the <span class="_ _3"></span>signals <span class="_ _3"></span>in <span class="_ _3"></span>the <span class="_ _3"></span>signal <span class="_ _2"></span>mask <span class="_ _3"></span>of</span></span></div><div class="t m0 x32 h6e y2c59 ff19 fs31 fc0 sc0 ls0 ws0">the <span class="_ _2"></span>calling <span class="_ _3"></span>process. <span class="_ _47"> </span>W<span class="_ _6"></span><span class="lsca3">ec<span class="_ _8"></span><span class="ls0">all <span class="_ _3"></span>this <span class="_ _3"></span>function <span class="_ _2"></span>from <span class="_ _3"></span>the <span class="_ _2"></span>programs <span class="_ _3"></span>shown <span class="_ _2"></span>in <span class="_ _3"></span>Figur<span class="lsca4">e1<span class="_ _8"></span><span class="ls0">0.20 <span class="_ _3"></span>and</span></span></span></span></div><div class="t m0 x32 h6e y2c5a ff19 fs31 fc0 sc0 ls0 ws0">Figur<span class="ls229">e1<span class="_ _4f"></span><span class="ls0">0.22.</span></span></div><a class="l" href="#pf10" data-dest-detail='[16,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892409px;bottom:1236.288916px;width:172.535789px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
