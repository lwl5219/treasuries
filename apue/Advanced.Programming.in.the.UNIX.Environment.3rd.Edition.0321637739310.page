<div id="pf136" class="pf w4 h1f" data-page-no="136"><div class="pc pc136 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg136.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">276<span class="_ _1b"> </span><span class="ff19">Process <span class="_"> </span>Contr<span class="_ _0"></span>ol <span class="_ _222"> </span>Chapter<span class="_ _4b"> </span>8</span></div><div class="t m0 x3f h2a y12f ff19 fsf fc0 sc0 ls0 ws0">Given <span class="_ _e"> </span>the <span class="_ _e"> </span>login <span class="_ _e"> </span>name, <span class="_ _e"> </span>we <span class="_"> </span>can <span class="_ _53"> </span>then <span class="_ _e"> </span>use <span class="_ _e"> </span>it <span class="_"> </span>to <span class="_ _53"> </span>look <span class="_ _e"> </span>up <span class="_ _e"> </span>the <span class="_ _e"> </span>user <span class="_"> </span>in <span class="_ _53"> </span>the <span class="_ _e"> </span>password</div><div class="t m0 x32 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">ﬁle <span class="_ _a"></span>— <span class="_ _a"></span>to<span class="_"> </span>determine the login shell, for example<span class="_ _9"></span><span class="ls9d">—u<span class="_ _1"></span><span class="ls0">sing<span class="_"> </span><span class="ff1a">getpwnam</span>.</span></span></div><div class="t m0 x76 h52 y2355 ff19 fs2a fc0 sc0 lsed ws0">To <span class="_ _4b"> </span>ﬁ<span class="_ _9"></span><span class="ls0">nd <span class="_ _47"> </span>the <span class="_ _45"> </span>login <span class="_ _47"> </span>name, <span class="_ _47"> </span>UNIX <span class="_ _45"> </span>systems <span class="_ _47"> </span>have <span class="_ _47"> </span>historically <span class="_ _45"> </span>called <span class="_ _47"> </span>the<span class="_ _46"> </span><span class="ff1a">ttyname<span class="_ _46"> </span></span>function</span></div><div class="t m0 x76 h52 y2356 ff19 fs2a fc0 sc0 ls0 ws0">(Section <span class="_ _3"></span>18.9) <span class="_ _9"></span>and <span class="_ _9"></span>then <span class="_ _9"></span>tried <span class="_ _3"></span>to <span class="_ _9"></span>ﬁnd <span class="_ _9"></span>a <span class="_ _3"></span>matching <span class="_ _9"></span>entry <span class="_ _9"></span>in <span class="_ _9"></span>the<span class="_ _66"> </span><span class="ff1a">utmp<span class="_ _66"> </span></span>ﬁle <span class="_ _9"></span>(Section <span class="_ _9"></span>6.8).<span class="_ _59"> </span>FreeBSD</div><div class="t m0 x76 h51 y2357 ff19 fs2a fc0 sc0 ls0 ws0">and <span class="_ _3"></span>Mac <span class="_ _9"></span>OS <span class="_ _3"></span>X <span class="_ _9"></span>stor<span class="lsa86">et<span class="_ _4f"></span><span class="ls0">he <span class="_ _3"></span>login <span class="_ _9"></span>name <span class="_ _3"></span>in <span class="_ _9"></span>the <span class="_ _3"></span>session <span class="_ _9"></span>structur<span class="lsa86">ea<span class="_ _4f"></span><span class="ls0">ssociated <span class="_ _3"></span>with <span class="_ _9"></span>the <span class="_ _3"></span>process <span class="_ _3"></span>table</span></span></span></span></div><div class="t m0 x76 h51 y2358 ff19 fs2a fc0 sc0 ls0 ws0">entry and provide system calls to fetch and stor<span class="_ _0"></span><span class="lse9">et<span class="_ _84"></span><span class="ls0">his name.</span></span></div><div class="t m0 x76 h52 y2427 ff19 fs2a fc0 sc0 ls0 ws0">System <span class="_"> </span>V <span class="_ _42"> </span>provided <span class="_"> </span>the<span class="_ _35"> </span><span class="ff1a">cuserid<span class="_ _35"> </span></span>function <span class="_"> </span>to <span class="_ _42"> </span>return <span class="_"> </span>the <span class="_ _42"> </span>login <span class="_"> </span>name.<span class="_ _16"> </span>This <span class="_"> </span>function <span class="_"> </span>called</div><div class="t m0 x76 h52 y2428 ff1a fs2a fc0 sc0 ls0 ws0">getlogin<span class="_ _66"> </span><span class="ff19">and, <span class="_ _9"></span>if <span class="_ _9"></span>that <span class="_ _9"></span>failed, <span class="_ _9"></span>did <span class="_ _9"></span>a<span class="_ _66"> </span></span>getpwuid(getuid())<span class="ff19 lsa87">.T<span class="_ _55"></span><span class="ls0">he <span class="_ _9"></span>IEEE <span class="_ _9"></span>Standar<span class="lsa88">d1<span class="_ _8"></span><span class="ls0">003.1</span></span></span></span></div><div class="t m0 x162 h51 y2429 ff19 fs2a fc0 sc0 ls0 ws0">-</div><div class="t m0 x61 h51 y2428 ff19 fs2a fc0 sc0 ls0 ws0">1988</div><div class="t m0 x76 h52 y242a ff19 fs2a fc0 sc0 ls0 ws0">speciﬁed<span class="_"> </span><span class="ff1a">cuserid</span><span class="lsa89">,b<span class="_ _84"></span><span class="ls0">ut it <span class="_ _2"></span>called for <span class="_ _2"></span>the <span class="_ _2"></span>effective user ID <span class="_ _2"></span>to <span class="_ _2"></span>be used, <span class="_ _2"></span>instead of <span class="_ _2"></span>the <span class="_ _2"></span>real user ID.</span></span></div><div class="t m0 x76 h52 y242b ff19 fs2a fc0 sc0 ls0 ws0">The 1990 version of POSIX.1 dropped the<span class="_"> </span><span class="ff1a">cuserid<span class="_ _53"> </span></span>function.</div><div class="t m0 x76 h52 y242c ff19 fs2a fc0 sc0 ls0 ws0">The <span class="_ _80"> </span>environment <span class="_"> </span>variable<span class="_ _4b"> </span><span class="ff1a">LOGNAME<span class="_ _44"> </span></span>is <span class="_ _80"> </span>usually <span class="_ _80"> </span>initialized <span class="_ _80"> </span>with <span class="_ _80"> </span>the <span class="_ _80"> </span>user<span class="_ _3"></span>’s <span class="_ _80"> </span>login <span class="_ _80"> </span>name <span class="_ _80"> </span>by</div><div class="t m0 x76 h52 y242d ff1a fs2a fc0 sc0 ls0 ws0">login</div><div class="t m0 x1e5 h51 y242e ff19 fs2a fc0 sc0 ls0 ws0">(</div><div class="t m0 x184 h51 y242d ff19 fs2a fc0 sc0 ls0 ws0">1</div><div class="t m0 x1b h51 y242e ff19 fs2a fc0 sc0 ls0 ws0">)</div><div class="t m0 x4 h51 y242d ff19 fs2a fc0 sc0 ls0 ws0">and <span class="_"> </span>inherited <span class="_ _80"> </span>by <span class="_"> </span>the <span class="_ _80"> </span>login <span class="_"> </span>shell.<span class="_ _51"> </span>Realize, <span class="_"> </span>however<span class="_ _0"></span><span class="lsa8a">,t<span class="_ _c"></span><span class="ls0">hat <span class="_ _e"> </span>a <span class="_ _80"> </span>user <span class="_"> </span>can <span class="_ _80"> </span>modify <span class="_"> </span>an</span></span></div><div class="t m0 x76 h52 y242f ff19 fs2a fc0 sc0 ls0 ws0">environment <span class="_ _2"></span>variable, <span class="_ _2"></span>so <span class="_ _3"></span>we <span class="_ _2"></span>shouldn’t <span class="_ _3"></span>use<span class="_ _80"> </span><span class="ff1a">LOGNAME<span class="_ _80"> </span></span>to <span class="_ _3"></span>validate <span class="_ _3"></span>the <span class="_ _2"></span>user <span class="_ _3"></span>in <span class="_ _2"></span>any <span class="_ _3"></span>way<span class="_ _6"></span><span class="lsa8b">.I<span class="_ _c"></span><span class="ls0">nstead,</span></span></div><div class="t m0 x76 h52 y2430 ff19 fs2a fc0 sc0 ls0 ws0">we should use<span class="_"> </span><span class="ff1a">getlogin</span>.</div><div class="t m0 x35 h53 y2431 ff16 fs2b fc0 sc0 ls0 ws0">8.16 <span class="_ _93"> </span>Process <span class="_"> </span>Sc<span class="_ _0"></span>heduling</div><div class="t m0 x32 h2a ya0a ff19 fsf fc0 sc0 ls0 ws0">Historically<span class="_ _4"></span><span class="lsa8c">,t<span class="_ _43"></span><span class="ls0">he <span class="_ _42"> </span>UNIX <span class="_ _23"> </span>System <span class="_ _42"> </span>provided <span class="_ _23"></span>processes <span class="_ _23"></span>with <span class="_ _23"> </span>only <span class="_ _23"> </span>coarse <span class="_ _42"> </span>control <span class="_ _23"></span>over <span class="_ _23"> </span>their</span></span></div><div class="t m0 x32 h2a y2432 ff19 fsf fc0 sc0 ls0 ws0">scheduling <span class="_ _2"></span>priority<span class="_ _6"></span><span class="lsa8d">.T<span class="_ _1d"></span><span class="ls0">he <span class="_ _2"></span>scheduling <span class="_ _3"></span>policy <span class="_ _2"></span>and <span class="_ _3"></span>priority <span class="_ _2"></span>wer<span class="ls210">ed<span class="_ _8"></span><span class="ls0">etermined <span class="_ _3"></span>by <span class="_ _2"></span>the <span class="_ _2"></span>kernel.</span></span></span></span></div><div class="t m0 x32 h2b y2433 ff19 fsf fc0 sc0 lsa8e ws0">Ap<span class="_ _43"></span><span class="ls45">ro<span class="ls0">cess <span class="_ _42"> </span>could <span class="_ _42"> </span>choose <span class="_ _42"> </span>to <span class="_ _42"> </span>run <span class="_ _42"> </span>with <span class="_ _53"> </span>lower <span class="_ _42"> </span>priority <span class="_ _42"> </span>by <span class="_ _42"> </span>adjusting <span class="_ _42"> </span>its<span class="_ _44"> </span><span class="ff1b">nice <span class="_ _42"> </span>value<span class="_ _44"> </span></span>(thus <span class="_ _42"> </span>a</span></span></div><div class="t m0 x32 h2a y2434 ff19 fsf fc0 sc0 ls0 ws0">process <span class="_ _23"></span>could <span class="_ _23"> </span>be <span class="_ _42"> </span>‘<span class="_ _1"></span>‘nice’<span class="lsa8f">’a<span class="_ _43"></span><span class="ls0">nd <span class="_ _23"> </span>reduce <span class="_ _23"> </span>its <span class="_ _23"> </span>share<span class="_ _35"> </span>of<span class="_ _35"> </span>the <span class="_ _42"> </span>CPU <span class="_ _23"> </span>by <span class="_ _42"> </span>adjusting <span class="_ _23"> </span>its <span class="_ _42"> </span>nice <span class="_ _23"> </span>value).</span></span></div><div class="t m0 x32 h2a y2435 ff19 fsf fc0 sc0 ls0 ws0">Only a privileged process was allowed to incr<span class="_ _0"></span>ease its scheduling priority<span class="_ _4"></span>.</div><div class="t m0 x3f h2a yfec ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _45"> </span>real-time <span class="_ _47"> </span>extensions <span class="_ _35"> </span>in <span class="_ _45"> </span>POSIX <span class="_ _45"> </span>added <span class="_ _45"> </span>interfaces <span class="_ _45"> </span>to <span class="_ _45"> </span>select <span class="_ _45"> </span>among <span class="_ _45"> </span>multiple</div><div class="t m0 x32 h2a yfed ff19 fsf fc0 sc0 ls0 ws0">scheduling <span class="_ _3"></span>classes <span class="_ _9"></span>and <span class="_ _3"></span>ﬁne-tune <span class="_ _9"></span>their <span class="_ _9"></span>behavior<span class="_ _6"></span><span class="lsa90">.W<span class="_ _52"></span><span class="ls2dc">ed<span class="_ _8"></span><span class="ls0">iscuss <span class="_ _9"></span>only <span class="_ _3"></span>the <span class="_ _9"></span>interfaces <span class="_ _9"></span>used <span class="_ _3"></span>to</span></span></span></div><div class="t m0 x32 h2a yfee ff19 fsf fc0 sc0 ls0 ws0">adjust <span class="_ _47"> </span>the <span class="_ _45"> </span>nice <span class="_ _47"> </span>value <span class="_ _47"> </span>here; <span class="_ _47"> </span>they <span class="_ _47"> </span>ar<span class="lsa91">ep<span class="_ _62"></span><span class="ls0">art <span class="_ _45"> </span>of <span class="_ _47"> </span>the <span class="_ _47"> </span>XSI <span class="_ _45"> </span>option <span class="_ _47"> </span>in <span class="_ _47"> </span>POSIX.1.<span class="_ _5f"> </span>Refer <span class="_ _45"> </span>to</span></span></div><div class="t m0 x32 h2a yfef ff19 fsf fc0 sc0 ls0 ws0">Gallmeister</div><div class="t m0 x76 h2a y2436 ff19 fsf fc0 sc0 ls0 ws0">[</div><div class="t m0 x198 h2a yfef ff19 fsf fc0 sc0 ls0 ws0">1995</div><div class="t m0 x10c h2a y2436 ff19 fsf fc0 sc0 ls0 ws0">]</div><div class="t m0 xda h2a yfef ff19 fsf fc0 sc0 ls0 ws0">for mor<span class="ls44">ei<span class="_ _4f"></span><span class="ls0">nformation on the real-time scheduling extensions.</span></span></div><div class="t m0 x3f h26 yff0 ff19 fsf fc0 sc0 ls0 ws0">In <span class="_ _47"> </span>the <span class="_ _47"> </span>Single <span class="_ _47"> </span>UNIX <span class="_ _47"> </span>Speciﬁcation, <span class="_ _47"> </span>nice <span class="_ _45"> </span>values <span class="_ _47"> </span>range <span class="_ _47"> </span>from<span class="_ _61"> </span><span class="ff1a">0<span class="_ _16"> </span></span>to<span class="_ _61"> </span><span class="ff1a">(2*NZERO)<span class="ff20">−</span>1</span>,</div><div class="t m0 x32 h26 yff1 ff19 fsf fc0 sc0 ls0 ws0">although <span class="_"> </span>some <span class="_ _66"> </span>implementations <span class="_ _47"> </span>support <span class="_"> </span>a <span class="_ _66"> </span>range <span class="_ _47"> </span>fr<span class="_ _0"></span>om<span class="_ _46"> </span><span class="ff1a">0<span class="_ _61"> </span></span>to<span class="_ _46"> </span><span class="ff1a">2*NZERO</span><span class="lsa92">.L<span class="_ _49"></span><span class="ls0">ower <span class="_ _47"> </span>nice</span></span></div><div class="t m0 x32 h2a yff2 ff19 fsf fc0 sc0 ls0 ws0">values have <span class="_ _2"></span>higher scheduling <span class="_ _2"></span>priority<span class="_ _6"></span><span class="lsa93">.A<span class="_ _5b"></span><span class="ls0">lthough this <span class="_ _2"></span>might <span class="_ _2"></span>seem backward, it <span class="_ _2"></span>actually</span></span></div><div class="t m0 x32 h26 yff3 ff19 fsf fc0 sc0 ls0 ws0">makes sense: <span class="_ _2"></span>the <span class="_ _2"></span>mor<span class="ls81d">en<span class="_ _4f"></span><span class="ls0">ice <span class="_ _2"></span>you <span class="_ _2"></span>are, the <span class="_ _2"></span>lower <span class="_ _2"></span>your <span class="_ _2"></span>scheduling <span class="_ _2"></span>priority <span class="_ _2"></span>is.<span class="_ _61"> </span><span class="ff1a">NZERO<span class="_ _66"> </span></span>is <span class="_ _2"></span>the</span></span></div><div class="t m0 x32 h2a y2437 ff19 fsf fc0 sc0 ls0 ws0">default nice value of the system.</div><div class="t m0 x76 h52 y2438 ff19 fs2a fc0 sc0 ls0 ws0">Be awar<span class="lsa94">et<span class="_ _5"></span><span class="ls0">hat <span class="_ _2"></span>the header <span class="_ _2"></span>ﬁle <span class="_ _2"></span>deﬁning<span class="_"> </span><span class="ff1a">NZERO<span class="_ _80"> </span></span>differs among systems.<span class="_ _44"> </span>In <span class="_ _2"></span>addition to <span class="_ _2"></span>the <span class="_ _2"></span>header</span></span></div><div class="t m0 x76 h52 y2439 ff19 fs2a fc0 sc0 ls0 ws0">ﬁle, <span class="_ _66"> </span>Linux <span class="_ _66"> </span>3.2.0 <span class="_ _66"> </span>makes <span class="_ _66"> </span>the <span class="_ _66"> </span>value <span class="_ _66"> </span>of<span class="_ _4b"> </span><span class="ff1a">NZERO<span class="_"> </span></span>accessible <span class="_ _66"> </span>through <span class="_ _66"> </span>a <span class="_ _66"> </span>nonstandard<span class="_ _4b"> </span><span class="ff1a">sysconf</span></div><div class="t m0 x76 h52 y243a ff19 fs2a fc0 sc0 ls0 ws0">argument (<span class="ff1a">_SC_NZERO</span>).</div><div class="t m0 x3f h26 y243b ff19 fsf fc0 sc0 lsa95 ws0">Ap<span class="_ _8"></span><span class="ls45">ro<span class="ls0">cess <span class="_ _9"></span>can <span class="_ _3"></span>retrieve <span class="_ _2"></span>and <span class="_ _3"></span>change <span class="_ _3"></span>its <span class="_ _9"></span>nice <span class="_ _3"></span>value <span class="_ _3"></span>with <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">nice<span class="_ _45"> </span></span>function. <span class="_ _47"> </span>W<span class="_ _1"></span>ith <span class="_ _3"></span>this</span></span></div><div class="t m0 x32 h2a y243c ff19 fsf fc0 sc0 ls0 ws0">function, a <span class="_ _2"></span>process can <span class="_ _2"></span>affect only <span class="_ _2"></span>its own <span class="_ _2"></span>nice <span class="_ _2"></span>value; it <span class="_ _2"></span>can’t <span class="_ _2"></span>affect the <span class="_ _2"></span>nice <span class="_ _2"></span>value of <span class="_ _2"></span>any</div><div class="t m0 x32 h2a y243d ff19 fsf fc0 sc0 ls0 ws0">other process.</div><div class="t m0 x3f h57 y243e ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;unistd.h&gt;</div><div class="t m0 x3f h57 y243f ff1a fs2d fc0 sc0 ls0 ws0">int nice(int<span class="_"> </span><span class="ff1b">incr</span>);</div><div class="t m0 x17 h57 y2440 ff19 fs2d fc0 sc0 ls0 ws0">Returns: new nice value<span class="_"> </span><span class="ff20">−<span class="_ _e"> </span><span class="ff1a">NZERO<span class="_ _80"> </span></span></span>if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><a class="l" href="#pff" data-dest-detail='[15,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.890519px;bottom:828.888916px;width:153.683708px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
