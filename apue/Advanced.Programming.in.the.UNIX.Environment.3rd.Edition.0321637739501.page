<div id="pf1f5" class="pf w4 h1f" data-page-no="1f5"><div class="pc pc1f5 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg1f5.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>13.3<span class="_ _29a"> </span>Coding <span class="_"> </span>Rules<span class="_ _1b"> </span><span class="ff18">467</span></div><div class="t m0 x41 h2a y12f ff19 fsf fc0 sc0 ls0 ws0">terminal <span class="_ _47"> </span>device, <span class="_ _47"> </span>there<span class="_ _61"> </span>is<span class="_ _61"> </span>nowher<span class="lsf73">ef<span class="_ _1d"></span><span class="ls0">or <span class="_ _47"> </span>output <span class="_ _47"> </span>to <span class="_ _47"> </span>be <span class="_ _47"> </span>displayed, <span class="_ _47"> </span>nor <span class="_ _47"> </span>is <span class="_ _47"> </span>there</span></span></div><div class="t m0 x41 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">anywhere<span class="_ _35"> </span>to<span class="_ _44"> </span>receive <span class="_ _42"> </span>input <span class="_ _42"> </span>from <span class="_ _42"> </span>an <span class="_ _42"> </span>interactive <span class="_ _42"> </span>user<span class="_ _1"></span><span class="lsf74">.E<span class="_ _52"></span><span class="ls0">ven <span class="_ _53"> </span>if <span class="_ _42"> </span>the <span class="_ _42"> </span>daemon <span class="_ _53"> </span>was</span></span></div><div class="t m0 x41 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">started from <span class="_ _2"></span>an <span class="_ _2"></span>interactive <span class="_ _2"></span>session, the <span class="_ _2"></span>daemon <span class="_ _2"></span>runs <span class="_ _2"></span>in <span class="_ _2"></span>the <span class="_ _2"></span>background, and <span class="_ _2"></span>the</div><div class="t m0 x41 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">login <span class="_ _9"></span>session <span class="_ _3"></span>can <span class="_ _9"></span>terminate <span class="_ _9"></span>without <span class="_ _9"></span>affecting <span class="_ _3"></span>the <span class="_ _9"></span>daemon.<span class="_ _16"> </span>If <span class="_ _9"></span>other <span class="_ _9"></span>users <span class="_ _9"></span>log <span class="_ _9"></span>in</div><div class="t m0 x41 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">on <span class="_ _47"> </span>the <span class="_ _47"> </span>same <span class="_ _45"> </span>terminal <span class="_ _47"> </span>device, <span class="_ _47"> </span>we <span class="_ _47"> </span>wouldn’t <span class="_ _47"> </span>want <span class="_ _45"> </span>output <span class="_ _47"> </span>from <span class="_ _66"> </span>the <span class="_ _45"> </span>daemon</div><div class="t m0 x41 h2a y134 ff19 fsf fc0 sc0 ls0 ws0">showing <span class="_ _42"> </span>up <span class="_ _42"> </span>on <span class="_ _42"> </span>the <span class="_ _42"> </span>terminal, <span class="_ _53"> </span>and <span class="_ _42"> </span>the <span class="_ _42"> </span>users <span class="_ _42"> </span>wouldn’t <span class="_ _53"> </span>expect <span class="_ _42"> </span>their <span class="_ _42"> </span>input <span class="_ _42"> </span>to <span class="_ _53"> </span>be</div><div class="t m0 x41 h2a y135 ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">ad by the daemon.</span></div><div class="t m0 x35 h27 yc39 ff16 fsf fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h2a y39d7 ff19 fsf fc0 sc0 ls0 ws0">Figur<span class="ls2f8">e1<span class="_ _b"></span><span class="ls0">3.1 <span class="_ _3"></span>shows <span class="_ _9"></span>a <span class="_ _9"></span>function <span class="_ _3"></span>that <span class="_ _9"></span>can <span class="_ _9"></span>be <span class="_ _3"></span>called <span class="_ _9"></span>from <span class="_ _3"></span>a <span class="_ _9"></span>program <span class="_ _3"></span>that <span class="_ _3"></span>wants <span class="_ _9"></span>to <span class="_ _9"></span>initialize</span></span></div><div class="t m0 x32 h2a y39d8 ff19 fsf fc0 sc0 ls0 ws0">itself as a daemon.</div><div class="t m0 x32 h4e y39d9 ff1a fs28 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h4e y39da ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;syslog.h&gt;</div><div class="t m0 x32 h4e y39db ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;fcntl.h&gt;</div><div class="t m0 x32 h4e y39dc ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;sys/resource.h&gt;</div><div class="t m0 x32 h4e y39dd ff1a fs28 fc0 sc0 ls0 ws0">void</div><div class="t m0 x32 h4e y39de ff1a fs28 fc0 sc0 ls0 ws0">daemonize(const char *cmd)</div><div class="t m0 x32 h4e y39df ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y39e0 ff1a fs28 fc0 sc0 ls0 ws0">int <span class="_ _1e7"> </span>i,<span class="_"> </span>fd0, fd1, fd2;</div><div class="t m0 x8a h4e y39e1 ff1a fs28 fc0 sc0 ls0 ws0">pid_t <span class="_ _12d"> </span>pid;</div><div class="t m0 x8a h4e y39e2 ff1a fs28 fc0 sc0 ls0 ws0">struct rlimit<span class="_ _b7"> </span>rl;</div><div class="t m0 x8a h4e y39e3 ff1a fs28 fc0 sc0 ls0 ws0">struct sigaction<span class="_ _15"> </span>sa;</div><div class="t m0 x8a h4e y39e4 ff1a fs28 fc0 sc0 ls0 ws0">/*</div><div class="t m0 x214 h4e y39e5 ff1a fs28 fc0 sc0 ls1b6 ws0">*C<span class="_ _1d"></span><span class="ls0">lear file creation mask.</span></div><div class="t m0 x214 h4e y39e6 ff1a fs28 fc0 sc0 ls0 ws0">*/</div><div class="t m0 x8a h4e y39e7 ff1a fs28 fc0 sc0 ls0 ws0">umask(0);</div><div class="t m0 x8a h4e y39e8 ff1a fs28 fc0 sc0 ls0 ws0">/*</div><div class="t m0 x214 h4e y39e9 ff1a fs28 fc0 sc0 ls1b6 ws0">*G<span class="_ _1d"></span><span class="ls0">et maximum number of file descriptors.</span></div><div class="t m0 x214 h4e y39ea ff1a fs28 fc0 sc0 ls0 ws0">*/</div><div class="t m0 x8a h4e y39eb ff1a fs28 fc0 sc0 ls0 ws0">if (getrlimit(RLIMIT_NOFILE, &amp;rl) &lt; 0)</div><div class="t m0 x9d h4e y39ec ff1a fs28 fc0 sc0 ls0 ws0">err_quit(&quot;%s: can’t get file limit&quot;, cmd);</div><div class="t m0 x8a h4e y39ed ff1a fs28 fc0 sc0 ls0 ws0">/*</div><div class="t m0 x214 h4e y39ee ff1a fs28 fc0 sc0 ls1b6 ws0">*B<span class="_ _1d"></span><span class="ls0">ecome a session leader to lose controlling TTY.</span></div><div class="t m0 x214 h4e y39ef ff1a fs28 fc0 sc0 ls0 ws0">*/</div><div class="t m0 x8a h4e y39f0 ff1a fs28 fc0 sc0 ls0 ws0">if ((pid = fork()) &lt; 0)</div><div class="t m0 x9d h4e y39f1 ff1a fs28 fc0 sc0 ls0 ws0">err_quit(&quot;%s: can’t fork&quot;, cmd);</div><div class="t m0 x8a h4e y39f2 ff1a fs28 fc0 sc0 ls0 ws0">else if (pid != 0) /* parent */</div><div class="t m0 x9d h4e y39f3 ff1a fs28 fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x8a h4e y39f4 ff1a fs28 fc0 sc0 ls0 ws0">setsid();</div><div class="t m0 x8a h4e y39f5 ff1a fs28 fc0 sc0 ls0 ws0">/*</div><div class="t m0 x214 h4e y39f6 ff1a fs28 fc0 sc0 ls1b6 ws0">*E<span class="_ _1d"></span><span class="ls0">nsure future opens won’t allocate controlling TTYs.</span></div><div class="t m0 x214 h4e y39f7 ff1a fs28 fc0 sc0 ls0 ws0">*/</div><div class="t m0 x8a h4e y39f8 ff1a fs28 fc0 sc0 ls0 ws0">sa.sa_handler = SIG_IGN;</div><div class="t m0 x8a h4e y39f9 ff1a fs28 fc0 sc0 ls0 ws0">sigemptyset(&amp;sa.sa_mask);</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
