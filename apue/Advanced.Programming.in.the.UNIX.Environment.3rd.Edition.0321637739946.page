<div id="pf3b2" class="pf w4 h1f" data-page-no="3b2"><div class="pc pc3b2 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg3b2.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">912<span class="_ _1b"> </span><span class="ff19">Solutions <span class="_"> </span>to <span class="_"> </span>Selected <span class="_"> </span>Exercises <span class="_ _2eb"> </span>Appendix<span class="_ _4b"> </span>C</span></div><div class="t m0 x215 h57 y362 ff1a fs2d fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x215 h57 y3c0 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;fcntl.h&gt;</div><div class="t m0 x215 h57 y1d78 ff1a fs2d fc0 sc0 ls0 ws0">#define DEPTH<span class="_ _15"> </span>1000 <span class="_ _74"> </span>/*<span class="_"> </span>directory depth */</div><div class="t m0 x215 h57 y1d79 ff1a fs2d fc0 sc0 ls0 ws0">#define STARTDIR &quot;/tmp&quot;</div><div class="t m0 x215 h57 y1d7a ff1a fs2d fc0 sc0 ls0 ws0">#define NAME<span class="_ _8a"> </span>&quot;alonglonglonglonglonglonglonglonglonglongname&quot;</div><div class="t m0 x215 h57 y1d7b ff1a fs2d fc0 sc0 ls0 ws0">#define MAXSZ<span class="_ _15"> </span>(10*8192)</div><div class="t m0 x215 h57 y3c6 ff1a fs2d fc0 sc0 ls0 ws0">int</div><div class="t m0 x215 h57 y1d7c ff1a fs2d fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 x215 h57 y1d7d ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 xc4 h57 y1d7e ff1a fs2d fc0 sc0 ls0 ws0">int <span class="_ _15"> </span>i;</div><div class="t m0 xc4 h57 y1d7f ff1a fs2d fc0 sc0 ls0 ws0">size_t <span class="_"> </span>size;</div><div class="t m0 xc4 h57 y1d80 ff1a fs2d fc0 sc0 ls0 ws0">char <span class="_ _68"> </span>*path;</div><div class="t m0 xc4 h57 y2ad4 ff1a fs2d fc0 sc0 ls0 ws0">if (chdir(STARTDIR) &lt; 0)</div><div class="t m0 x206 h57 y2ad5 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;chdir error&quot;);</div><div class="t m0 xc4 h57 y4589 ff1a fs2d fc0 sc0 ls0 ws0">for (i = 0; i &lt; DEPTH; i++) {</div><div class="t m0 x206 h57 y2ad7 ff1a fs2d fc0 sc0 ls0 ws0">if (mkdir(NAME, DIR_MODE) &lt; 0)</div><div class="t m0 xe9 h57 y2ad8 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;mkdir failed, i = %d&quot;, i);</div><div class="t m0 x206 h57 y2ad9 ff1a fs2d fc0 sc0 ls0 ws0">if (chdir(NAME) &lt; 0)</div><div class="t m0 xe9 h57 y4d71 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;chdir failed, i = %d&quot;, i);</div><div class="t m0 xc4 h57 y4d72 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 xc4 h57 y2adc ff1a fs2d fc0 sc0 ls0 ws0">if (creat(&quot;afile&quot;, FILE_MODE) &lt; 0)</div><div class="t m0 x206 h57 y2add ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;creat error&quot;);</div><div class="t m0 xc4 h57 y2024 ff1a fs2d fc0 sc0 ls0 ws0">/*</div><div class="t m0 x7d h57 y2adf ff1a fs2d fc0 sc0 ls15c ws0">*T<span class="_ _1d"></span><span class="ls0">he deep directory is created, with a file at the leaf.</span></div><div class="t m0 x7d h57 y458e ff1a fs2d fc0 sc0 ls15c ws0">*N<span class="_ _1d"></span><span class="ls0">ow letâ€™s try to obtain its pathname.</span></div><div class="t m0 x7d h57 y57d0 ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 xc4 h57 y57d1 ff1a fs2d fc0 sc0 ls0 ws0">path = path_alloc(&amp;size);</div><div class="t m0 xc4 h57 y57d2 ff1a fs2d fc0 sc0 ls0 ws0">for ( ; ; ) {</div><div class="t m0 x206 h57 y581e ff1a fs2d fc0 sc0 ls0 ws0">if (getcwd(path, size) != NULL) {</div><div class="t m0 xe9 h57 y581f ff1a fs2d fc0 sc0 ls0 ws0">break;</div><div class="t m0 x206 h57 y5c1f ff1a fs2d fc0 sc0 ls15c ws0">}e<span class="_ _1d"></span><span class="ls0">lse {</span></div><div class="t m0 xe9 h57 y5c20 ff1a fs2d fc0 sc0 ls0 ws0">err_ret(&quot;getcwd failed, size = %ld&quot;, (long)size);</div><div class="t m0 xe9 h57 y5c21 ff1a fs2d fc0 sc0 ls0 ws0">size += 100;</div><div class="t m0 xe9 h57 y5c22 ff1a fs2d fc0 sc0 ls0 ws0">if (size &gt; MAXSZ)</div><div class="t m0 xa6 h57 y5c23 ff1a fs2d fc0 sc0 ls0 ws0">err_quit(&quot;giving up&quot;);</div><div class="t m0 xe9 h57 y6079 ff1a fs2d fc0 sc0 ls0 ws0">if ((path = realloc(path, size)) == NULL)</div><div class="t m0 xa6 h57 y607a ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;realloc error&quot;);</div><div class="t m0 x206 h57 y607b ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 xc4 h57 y607c ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 xc4 h57 y607d ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;length = %ld\n%s\n&quot;, (long)strlen(path), path);</div><div class="t m0 xc4 h57 y607e ff1a fs2d fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x215 h57 y607f ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x131 h2d y6080 ff18 fs10 fc0 sc0 ls0 ws0">Figure C.3<span class="_ _5a"> </span><span class="ff19">Create a deep directory tr<span class="_ _0"></span>ee</span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
