<div id="pf12e" class="pf w4 h1f" data-page-no="12e"><div class="pc pc12e w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg12e.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">268<span class="_ _1b"> </span><span class="ff19">Process <span class="_"> </span>Contr<span class="_ _0"></span>ol <span class="_ _222"> </span>Chapter<span class="_ _4b"> </span>8</span></div><div class="t m0 x32 h57 y362 ff1a fs2d fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h57 y1cc1 ff1a fs2d fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h57 y1d78 ff1a fs2d fc0 sc0 ls0 ws0">main(int argc, char *argv[])</div><div class="t m0 x32 h57 y1d79 ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y1d7a ff1a fs2d fc0 sc0 ls0 ws0">int <span class="_ _15"> </span>status;</div><div class="t m0 x8a h57 y3c5 ff1a fs2d fc0 sc0 ls0 ws0">if (argc &lt; 2)</div><div class="t m0 x9d h57 y3c6 ff1a fs2d fc0 sc0 ls0 ws0">err_quit(&quot;command-line argument required&quot;);</div><div class="t m0 x8a h57 y1cc4 ff1a fs2d fc0 sc0 ls0 ws0">if ((status = system(argv[1])) &lt; 0)</div><div class="t m0 x9d h57 y1cc5 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;system() error&quot;);</div><div class="t m0 x8a h57 y3ca ff1a fs2d fc0 sc0 ls0 ws0">pr_exit(status);</div><div class="t m0 x8a h57 y233c ff1a fs2d fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h57 y2329 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x184 h2d y13a4 ff18 fs10 fc0 sc0 ls0 ws0">Figure 8.24<span class="_ _5a"> </span><span class="ff19">Execute the command</span></div><div class="t m0 x8d h2d y233d ff19 fs10 fc0 sc0 ls0 ws0">-</div><div class="t m0 xaf h5e y13a4 ff19 fs10 fc0 sc0 ls0 ws0">line argument using<span class="_"> </span><span class="ff1a">system</span></div><div class="t m0 x32 h4d y13a5 ff19 fs26 fc0 sc0 ls164 ws0">We<span class="_ _9"></span><span class="ls0">’ll compile this program into the executable ﬁle<span class="_"> </span><span class="ff1a">tsys</span>.</span></div><div class="t m0 x3f h49 y13a6 ff19 fs26 fc0 sc0 ls0 ws0">Figur<span class="lsa59">e8<span class="_ _4f"></span><span class="ls0">.25 shows <span class="_ _2"></span>another simple <span class="_ _2"></span>program that prints its <span class="_ _2"></span>real and effective user IDs.</span></span></div><div class="t m0 x32 h5d y233e ff1a fs2f fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h5d y233f ff1a fs2f fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h5d y2340 ff1a fs2f fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 x32 h5d y2341 ff1a fs2f fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h5d y2342 ff1a fs2f fc0 sc0 ls0 ws0">printf(&quot;real uid = %d, effective uid = %d\n&quot;, getuid(), geteuid());</div><div class="t m0 x8a h5d y2343 ff1a fs2f fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h5d y2344 ff1a fs2f fc0 sc0 ls0 ws0">}</div><div class="t m0 x6b h2f y2345 ff18 fs12 fc0 sc0 ls0 ws0">Figure 8.25<span class="_ _5a"> </span><span class="ff19">Print real and effective user IDs</span></div><div class="t m0 x32 h5c y2346 ff19 fs29 fc0 sc0 lse2 ws0">We<span class="_ _9"></span><span class="ls0">’ll <span class="_ _44"> </span>compile <span class="_ _4b"> </span>this <span class="_ _44"> </span>program <span class="_ _44"> </span>into <span class="_ _44"> </span>the <span class="_ _4b"> </span>executable <span class="_ _44"> </span>ﬁle<span class="_ _65"> </span><span class="ff1a">printuids</span><span class="lsa5a">.R<span class="_ _184"></span><span class="ls0">unning <span class="_ _4b"> </span>both</span></span></span></div><div class="t m0 x32 h50 y2347 ff19 fs29 fc0 sc0 ls0 ws0">programs gives us the following:</div><div class="t m0 x3f h62 y2348 ff1a fs30 fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">tsys printuids<span class="_ _1a2"> </span><span class="ff1b">normal execution, no special privileges</span></span></div><div class="t m0 x3f h62 y2349 ff1a fs30 fc0 sc0 ls0 ws0">real uid = 205, effective uid = 205</div><div class="t m0 x3f h62 y234a ff1a fs30 fc0 sc0 ls0 ws0">normal termination, exit status = 0</div><div class="t m0 x3f h62 y234b ff1a fs30 fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">su<span class="_ _23b"> </span><span class="ff1b">become superuser</span></span></div><div class="t m0 x3f h62 y234c ff1a fs30 fc0 sc0 ls0 ws0">Password:<span class="_ _23c"> </span><span class="ff1b">enter superuser password</span></div><div class="t m0 x3f h62 y234d ff1a fs30 fc0 sc0 ls0 ws0">#<span class="_"> </span><span class="ff1f">chown root tsys<span class="_ _af"> </span><span class="ff1b">change owner</span></span></div><div class="t m0 x3f h62 y234e ff1a fs30 fc0 sc0 ls0 ws0">#<span class="_"> </span><span class="ff1f">chmod u+s tsys<span class="_ _1a2"> </span><span class="ff1b">make set-user-ID</span></span></div><div class="t m0 x3f h62 y234f ff1a fs30 fc0 sc0 ls0 ws0">#<span class="_"> </span><span class="ff1f">ls -l tsys<span class="_ _19e"> </span><span class="ff1b">verify ﬁle’<span class="_ _1"></span><span class="lsa5b">sp<span class="_ _5"></span><span class="ls0">ermissions and owner</span></span></span></span></div><div class="t m0 x3f h62 y2350 ff1a fs30 fc0 sc0 ls0 ws0">-rwsrwxr-x <span class="_"> </span>1<span class="_"> </span>root <span class="_ _68"> </span>7888<span class="_"> </span>Feb 25 22:13 tsys</div><div class="t m0 x3f h62 y2351 ff1a fs30 fc0 sc0 ls0 ws0">#<span class="_"> </span><span class="ff1f">exit<span class="_ _23d"> </span><span class="ff1b">leave superuser shell</span></span></div><div class="t m0 x3f h62 y2352 ff1a fs30 fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">tsys printuids</span></div><div class="t m0 x3f h62 y2353 ff1a fs30 fc0 sc0 ls0 ws0">real uid = 205, effective uid = 0<span class="_ _1c4"> </span><span class="ff1b">oops, this is a security hole</span></div><div class="t m0 x3f h62 y2354 ff1a fs30 fc0 sc0 ls0 ws0">normal termination, exit status = 0</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
