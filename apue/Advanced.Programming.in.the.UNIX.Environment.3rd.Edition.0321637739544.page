<div id="pf220" class="pf w4 h1f" data-page-no="220"><div class="pc pc220 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg220.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">510<span class="_ _1b"> </span><span class="ff19">Advanced <span class="_"> </span>I/O<span class="_ _16b"> </span>Chapter <span class="_"> </span>14</span></div><div class="t m0 x32 h53 y12f ff16 fs2b fc0 sc0 ls0 ws0">14.5.1 <span class="_ _54"> </span>System<span class="_ _54"> </span><span class="ls1c3">VA<span class="_ _52"></span><span class="ls0">synchronous <span class="_"> </span>I/O</span></span></div><div class="t m0 x32 h2a y4de ff19 fsf fc0 sc0 ls0 ws0">System V <span class="_ _2"></span>provides a limited form <span class="_ _2"></span>of asynchronous I/O <span class="_ _2"></span>that works <span class="_ _2"></span>only with <span class="_ _2"></span>STREAMS</div><div class="t m0 x32 h26 y6d0 ff19 fsf fc0 sc0 ls0 ws0">devices and STREAMS pipes.<span class="_ _59"> </span>The System V asynchronous I/O signal is<span class="_"> </span><span class="ff1a">SIGPOLL</span>.</div><div class="t m0 x3f h26 y6d1 ff19 fsf fc0 sc0 ls5f ws0">To <span class="_ _80"> </span>e<span class="_ _9"></span><span class="ls0">nable <span class="_ _9"></span>asynchronous <span class="_ _3"></span>I/O <span class="_ _3"></span>for <span class="_ _9"></span>a <span class="_ _3"></span>STREAMS <span class="_ _3"></span>device, <span class="_ _9"></span>we <span class="_ _3"></span>have <span class="_ _9"></span>to <span class="_ _3"></span>call<span class="_ _45"> </span><span class="ff1a">ioctl<span class="_ _47"> </span></span>with <span class="_ _3"></span>a</span></div><div class="t m0 x32 h26 y6d2 ff19 fsf fc0 sc0 ls0 ws0">second argument (<span class="ff1b ls45">re<span class="ls0">quest</span></span><span class="ls9d9">)o<span class="_ _d"></span><span class="ls0">f<span class="_ _66"> </span><span class="ff1a">I_SETSIG</span><span class="ls109b">.T<span class="_ _4a"></span><span class="ls0">he thir<span class="ls23f">da<span class="_ _4f"></span><span class="ls45">rg<span class="_ _2"></span><span class="ls0">ument is <span class="_ _2"></span>an integer <span class="_ _2"></span>value formed</span></span></span></span></span></span></span></div><div class="t m0 x32 h2a y6d3 ff19 fsf fc0 sc0 ls0 ws0">from <span class="_ _e"> </span>one <span class="_"> </span>or <span class="_"> </span>mor<span class="_ _0"></span><span class="ls109c">eo<span class="_ _4a"></span><span class="ls1cc">ft<span class="_ _4a"></span><span class="ls0">he <span class="_"> </span>constants <span class="_"> </span>in <span class="_ _e"> </span>Figur<span class="ls1cc">e1<span class="_ _4a"></span><span class="ls0">4.18. <span class="_ _59"> </span>These<span class="_ _59"> </span>constants <span class="_"> </span>ar<span class="ls1cc">ed<span class="_ _4a"></span><span class="ls0">eﬁned <span class="_"> </span>in</span></span></span></span></span></span></span></div><div class="t m0 x32 h26 y6d4 ff1a fsf fc0 sc0 ls0 ws0">&lt;stropts.h&gt;<span class="ff19">.</span></div><div class="t m0 x76 h51 y1ab2 ff19 fs2a fc0 sc0 ls0 ws0">Interfaces related to the STREAMS mechanism wer<span class="ls109d">em<span class="_ _5"></span><span class="ls0">arked obsolescent <span class="_ _2"></span>in SUSv4, so we don’t</span></span></div><div class="t m0 x76 h51 y3e80 ff19 fs2a fc0 sc0 ls0 ws0">cover them in any detail.<span class="_ _35"> </span>See Rago</div><div class="t m0 x18c h51 y3e81 ff19 fs2a fc0 sc0 ls0 ws0">[</div><div class="t m0 x222 h51 y3e80 ff19 fs2a fc0 sc0 ls0 ws0">1993</div><div class="t m0 x7e h51 y3e81 ff19 fs2a fc0 sc0 ls0 ws0">]</div><div class="t m0 xec h51 y3e80 ff19 fs2a fc0 sc0 ls0 ws0">for mor<span class="lse9">ei<span class="_ _5"></span><span class="ls0">nformation about STREAMS.</span></span></div><div class="t m0 x52 h2d y3e82 ff19 fs10 fc0 sc0 ls0 ws0">Constant <span class="_ _279"> </span>Description</div><div class="t m0 xe2 h4f y3e83 ff1a fs11 fc0 sc0 ls0 ws0">S_INPUT<span class="_ _15"> </span><span class="ff19 ls39f">We <span class="_"> </span>c<span class="_ _9"></span><span class="ls0">an read data (other than high-priority data) without blocking.</span></span></div><div class="t m0 xe2 h4f y3e84 ff1a fs11 fc0 sc0 ls0 ws0">S_RDNORM<span class="_ _75"> </span><span class="ff19 ls39f">We <span class="_"> </span>c<span class="_ _9"></span><span class="ls0">an read normal data without blocking.</span></span></div><div class="t m0 xe2 h4f y3e85 ff1a fs11 fc0 sc0 ls0 ws0">S_RDBAND<span class="_ _75"> </span><span class="ff19 ls39f">We <span class="_"> </span>c<span class="_ _9"></span><span class="ls0">an read priority data without blocking.</span></span></div><div class="t m0 xe2 h4f y3e86 ff1a fs11 fc0 sc0 ls0 ws0">S_BANDURG<span class="_ _6e"> </span><span class="ff19">If this constant is speciﬁed with<span class="_"> </span></span>S_RDBAND<span class="ff19 lsdb">,t<span class="_ _84"></span><span class="ls0">he<span class="_"> </span><span class="ff1a">SIGURG<span class="_ _53"> </span></span>signal is generated</span></span></div><div class="t m0 x30 h4f y3e87 ff19 fs11 fc0 sc0 ls0 ws0">instead of<span class="_"> </span><span class="ff1a">SIGPOLL<span class="_ _53"> </span></span>when we can read priority data without blocking.</div><div class="t m0 xe2 h4f y3e88 ff1a fs11 fc0 sc0 ls0 ws0">S_HIPRI<span class="_ _15"> </span><span class="ff19 ls39f">We <span class="_"> </span>c<span class="_ _9"></span><span class="ls0">an read high-priority data without blocking.</span></span></div><div class="t m0 xe2 h6d y3e89 ff1a fs12 fc0 sc0 ls0 ws0">S_OUTPUT<span class="_ _75"> </span><span class="ff19 ls389">We <span class="_"> </span>c<span class="_ _9"></span><span class="ls0">an write normal data without blocking.</span></span></div><div class="t m0 xe2 h6d y3e8a ff1a fs12 fc0 sc0 ls0 ws0">S_WRNORM<span class="_ _75"> </span><span class="ff19">Same as<span class="_"> </span></span>S_OUTPUT<span class="ff19">.</span></div><div class="t m0 xe2 h6d y3e8b ff1a fs12 fc0 sc0 ls0 ws0">S_WRBAND<span class="_ _75"> </span><span class="ff19 ls389">We <span class="_"> </span>c<span class="_ _9"></span><span class="ls0">an write priority data without blocking.</span></span></div><div class="t m0 xe2 h63 y3e8c ff1a fs13 fc0 sc0 ls0 ws0">S_MSG<span class="_ _10b"> </span><span class="ff19">The<span class="_"> </span></span>SIGPOLL<span class="_ _e"> </span><span class="ff19">signal message has reached the stream head.</span></div><div class="t m0 xe2 h63 y3e8d ff1a fs13 fc0 sc0 ls0 ws0">S_ERROR<span class="_ _15"> </span><span class="ff19">The stream has an err<span class="_ _0"></span>or<span class="_ _1"></span>.</span></div><div class="t m0 xe2 h63 y3e8e ff1a fs13 fc0 sc0 ls0 ws0">S_HANGUP<span class="_ _75"> </span><span class="ff19">The stream has hung up.</span></div><div class="t m0 x9f h6f y3e8f ff18 fs14 fc0 sc0 ls0 ws0">Figure 14.18<span class="_ _5a"> </span><span class="ff19">Conditions for generating<span class="_"> </span><span class="ff1a">SIGPOLL<span class="_ _e"> </span></span>signal</span></div><div class="t m0 x3f h9b y3e90 ff19 fs49 fc0 sc0 ls0 ws0">In <span class="_ _e"> </span>addition <span class="_"> </span>to <span class="_ _e"> </span>calling<span class="_ _59"> </span><span class="ff1a">ioctl<span class="_ _59"> </span></span>to <span class="_"> </span>specify <span class="_ _53"> </span>the <span class="_"> </span>conditions <span class="_ _e"> </span>that <span class="_"> </span>should <span class="_ _e"> </span>generate <span class="_"> </span>the</div><div class="t m0 x32 h9b y3e91 ff1a fs49 fc0 sc0 ls0 ws0">SIGPOLL<span class="_ _59"> </span><span class="ff19">signal, <span class="_"> </span>we <span class="_ _e"> </span>have <span class="_"> </span>to <span class="_"> </span>establish <span class="_ _e"> </span>a <span class="_"> </span>signal <span class="_"> </span>handler <span class="_ _e"> </span>for <span class="_"> </span>this <span class="_"> </span>signal.<span class="_ _65"> </span>Recall <span class="_"> </span>from</span></div><div class="t m0 x32 h9b y3e92 ff19 fs49 fc0 sc0 ls0 ws0">Figur<span class="ls109e">e1<span class="_ _4f"></span><span class="ls0">0.1 that the <span class="_ _2"></span>default action for<span class="_"> </span><span class="ff1a">SIGPOLL<span class="_ _66"> </span></span>is to terminate <span class="_ _2"></span>the process, so we should</span></span></div><div class="t m0 x32 h9b y3e93 ff19 fs49 fc0 sc0 ls0 ws0">establish the signal handler befor<span class="ls48d">ec<span class="_ _4f"></span><span class="ls0">alling<span class="_"> </span><span class="ff1a">ioctl</span>.</span></span></div><div class="t m0 x32 hfb y3e94 ff16 fs89 fc0 sc0 ls0 ws0">14.5.2 <span class="_ _54"> </span>BSD<span class="_ _54"> </span>Asynchr<span class="_ _0"></span>onous <span class="_"> </span>I/O</div><div class="t m0 x32 h9b y3e95 ff19 fs49 fc0 sc0 ls0 ws0">Asynchronous I/O <span class="_ _2"></span>in <span class="_ _3"></span>BSD-derived <span class="_ _2"></span>systems <span class="_ _2"></span>is <span class="_ _3"></span>a <span class="_ _2"></span>combination <span class="_ _2"></span>of <span class="_ _2"></span>two <span class="_ _3"></span>signals:<span class="_ _66"> </span><span class="ff1a">SIGIO<span class="_ _47"> </span></span>and</div><div class="t m0 x32 h9b y3e96 ff1a fs49 fc0 sc0 ls0 ws0">SIGURG<span class="ff19 ls109f">.T<span class="_ _5b"></span><span class="ls0">he <span class="_ _2"></span>former <span class="_ _2"></span>is the <span class="_ _2"></span>general <span class="_ _2"></span>asynchronous I/O <span class="_ _2"></span>signal, <span class="_ _2"></span>and <span class="_ _2"></span>the <span class="_ _2"></span>latter <span class="_ _2"></span>is <span class="_ _2"></span>used only</span></span></div><div class="t m0 x32 h96 y3e97 ff19 fs49 fc0 sc0 ls0 ws0">to notify the process that out-of-band data has arrived on a network connection.</div><div class="t m0 x3f h9b y3e98 ff19 fs49 fc0 sc0 ls9ae ws0">To <span class="_ _53"> </span>r<span class="_ _3"></span><span class="ls0">eceive the<span class="_"> </span><span class="ff1a">SIGIO<span class="_ _66"> </span></span>signal, we need to perform three steps.</span></div><div class="t m0 x3f h9b y3e99 ff19 fs49 fc0 sc0 ls0 ws0">1. <span class="_ _51"> </span>Establish<span class="_"> </span><span class="ls48d">as<span class="_ _d"></span><span class="ls0">ignal handler for<span class="_"> </span><span class="ff1a">SIGIO</span>,<span class="_"> </span>by<span class="_"> </span>calling either<span class="_"> </span><span class="ff1a">signal<span class="_ _66"> </span></span>or<span class="_"> </span><span class="ff1a">sigaction</span>.</span></span></div><div class="t m0 x3f h96 y3e9a ff19 fs49 fc0 sc0 ls0 ws0">2. <span class="_ _51"> </span>Set<span class="_"> </span>the <span class="_ _2"></span>process ID or <span class="_ _2"></span>process group ID to receive the signal <span class="_ _2"></span>for the <span class="_ _2"></span>descriptor<span class="_ _6"></span><span class="ls10a0">,b<span class="_ _d"></span><span class="ls0">y</span></span></div><div class="t m0 x41 h9b y3e9b ff19 fs49 fc0 sc0 ls0 ws0">calling<span class="_"> </span><span class="ff1a">fcntl<span class="_ _80"> </span></span>with a command of<span class="_"> </span><span class="ff1a">F_SETOWN<span class="_ _66"> </span></span>(Section 3.14).</div><a class="l" href="#pf11" data-dest-detail='[17,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:156.492009px;bottom:1236.288916px;width:213.731995px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pf11" data-dest-detail='[17,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:156.496207px;bottom:350.090999px;width:181.705002px;height:19.680008px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
