<div id="pfbf" class="pf w4 h1f" data-page-no="bf"><div class="pc pcbf w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bgbf.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>5.10<span class="_ _1dc"> </span>Positioning <span class="_"> </span>a <span class="_"> </span>Stream<span class="_ _1b"> </span><span class="ff18">157</span></div><div class="t m0 x32 h2a y12f ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _3"></span>obvious <span class="_ _3"></span>generalization <span class="_ _3"></span>of <span class="_ _3"></span>these <span class="_ _3"></span>two <span class="_ _3"></span>cases <span class="_ _3"></span>is <span class="_ _3"></span>to <span class="_ _3"></span>read <span class="_ _2"></span>or <span class="_ _3"></span>write <span class="_ _3"></span>an <span class="_ _9"></span>array <span class="_ _2"></span>of <span class="_ _3"></span>structures.</div><div class="t m0 x32 h26 y130 ff19 fsf fc0 sc0 ls5f ws0">To <span class="_ _47"> </span>d<span class="_ _9"></span><span class="ls6d6">ot<span class="_ _b"></span><span class="ls0">his,<span class="_ _45"> </span><span class="ff1b">size<span class="_ _45"> </span></span>would <span class="_ _23"> </span>be <span class="_ _23"> </span>the<span class="_ _35"> </span><span class="ff1a">sizeof<span class="_ _45"> </span></span>the <span class="_ _23"></span>structure, <span class="_ _9"></span>and<span class="_ _45"> </span><span class="ff1b">nobj<span class="_ _35"> </span></span>would <span class="_ _23"></span>be <span class="_ _9"></span>the <span class="_ _23"> </span>number <span class="_ _23"></span>of</span></span></div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">elements in the array<span class="_ _4"></span>.</div><div class="t m0 x3f h26 y132 ff19 fsf fc0 sc0 ls0 ws0">Both<span class="_"> </span><span class="ff1a">fread<span class="_ _47"> </span></span>and<span class="_"> </span><span class="ff1a">fwrite<span class="_ _47"> </span></span><span class="ls45">re</span>turn <span class="_ _2"></span>the <span class="_ _2"></span>number <span class="_ _2"></span>of objects <span class="_ _2"></span>read <span class="_ _2"></span>or written.<span class="_ _61"> </span>For <span class="_ _2"></span>the <span class="_ _2"></span>read</div><div class="t m0 x32 h2b y133 ff19 fsf fc0 sc0 ls0 ws0">case, <span class="_ _66"> </span>this <span class="_ _47"> </span>number <span class="_"> </span>can <span class="_ _47"> </span>be <span class="_ _66"> </span>less <span class="_ _47"> </span>than<span class="_ _46"> </span><span class="ff1b">nobj<span class="_ _61"> </span></span>if <span class="_ _47"> </span>an <span class="_ _66"> </span>error <span class="_ _66"> </span>occurs <span class="_ _47"> </span>or <span class="_"> </span>if <span class="_ _47"> </span>the <span class="_ _66"> </span>end <span class="_ _47"> </span>of <span class="_"> </span>ﬁle <span class="_ _47"> </span>is</div><div class="t m0 x32 h26 y134 ff19 fsf fc0 sc0 ls0 ws0">encountered. <span class="_ _45"> </span>In<span class="_ _45"> </span>this <span class="_ _23"> </span>situation,<span class="_ _35"> </span><span class="ff1a">ferror<span class="_ _45"> </span></span>or<span class="_ _35"> </span><span class="ff1a">feof<span class="_ _45"> </span></span>must <span class="_ _23"> </span>be <span class="_ _23"></span>called.<span class="_ _5a"> </span>For <span class="_ _23"> </span>the <span class="_ _23"> </span>write <span class="_ _23"></span>case, <span class="_ _23"></span>if</div><div class="t m0 x32 h2b y135 ff19 fsf fc0 sc0 ls0 ws0">the return value is less than the r<span class="_ _0"></span>equested<span class="_"> </span><span class="ff1b">nobj</span>,<span class="_"> </span>an<span class="_"> </span>err<span class="_ _0"></span>or has occurred.</div><div class="t m0 x3f h2a y136 ff19 fsf fc0 sc0 ls6d7 ws0">Af<span class="_ _d"></span><span class="ls0">undamental problem with binary I/O <span class="_ _2"></span>is that it <span class="_ _2"></span>can be used <span class="_ _2"></span>to read only data that</span></div><div class="t m0 x32 h2a y137 ff19 fsf fc0 sc0 ls0 ws0">has been <span class="_ _2"></span>written <span class="_ _2"></span>on the <span class="_ _2"></span>same <span class="_ _2"></span>system.<span class="_ _46"> </span>This <span class="_ _2"></span>was <span class="_ _2"></span>OK <span class="_ _2"></span>many years <span class="_ _2"></span>ago, <span class="_ _2"></span>when all <span class="_ _2"></span>the <span class="_ _2"></span>UNIX</div><div class="t m0 x32 h2a y138 ff19 fsf fc0 sc0 ls0 ws0">systems <span class="_ _2"></span>wer<span class="ls59c">eP<span class="_ _8"></span><span class="ls0">DP</span></span></div><div class="t m0 xd0 h2a y724 ff19 fsf fc0 sc0 ls0 ws0">-</div><div class="t m0 x180 h2a y138 ff19 fsf fc0 sc0 ls65 ws0">11<span class="_ _3"></span><span class="ls0">s, <span class="_ _2"></span>but <span class="_ _2"></span>the <span class="_ _2"></span>norm <span class="_ _2"></span>today <span class="_ _3"></span>is <span class="_ _2"></span>to <span class="_ _2"></span>have <span class="_ _2"></span>heterogeneous <span class="_ _2"></span>systems <span class="_ _2"></span>connected</span></div><div class="t m0 x32 h2a y139 ff19 fsf fc0 sc0 ls0 ws0">together <span class="_ _2"></span>with <span class="_ _2"></span>networks.<span class="_ _16"> </span>It <span class="_ _2"></span>is <span class="_ _2"></span>common <span class="_ _3"></span>to <span class="_ _2"></span>want <span class="_ _3"></span>to <span class="_ _2"></span>write <span class="_ _2"></span>data <span class="_ _3"></span>on <span class="_ _2"></span>one <span class="_ _3"></span>system <span class="_ _2"></span>and <span class="_ _2"></span>process</div><div class="t m0 x32 h2a y13a ff19 fsf fc0 sc0 ls0 ws0">it on another<span class="_ _6"></span><span class="ls86">.T<span class="_ _4a"></span><span class="ls0">hese two functions won’t work, for two reasons.</span></span></div><div class="t m0 x3f h2a y40c ff19 fsf fc0 sc0 ls0 ws0">1. <span class="_ _51"> </span>The<span class="_ _4b"> </span>offset <span class="_ _42"> </span>of <span class="_ _e"> </span>a <span class="_ _53"> </span>member <span class="_ _e"> </span>within <span class="_ _53"> </span>a <span class="_ _e"> </span>structur<span class="ls6d8">ec<span class="_ _55"></span><span class="ls0">an <span class="_ _53"> </span>differ <span class="_ _53"> </span>between <span class="_ _e"> </span>compilers <span class="_ _53"> </span>and</span></span></div><div class="t m0 x41 h2a y204 ff19 fsf fc0 sc0 ls0 ws0">systems <span class="_ _23"></span>because <span class="_ _23"> </span>of <span class="_ _23"> </span>different <span class="_ _23"></span>alignment <span class="_ _23"></span>requir<span class="_ _1"></span>ements. <span class="_ _35"> </span>Indeed,<span class="_ _35"> </span>some <span class="_ _23"> </span>compilers</div><div class="t m0 x41 h2a y205 ff19 fsf fc0 sc0 ls0 ws0">have <span class="_ _42"> </span>an <span class="_ _42"> </span>option <span class="_ _23"> </span>allowing <span class="_ _42"> </span>structures <span class="_ _23"> </span>to <span class="_ _42"> </span>be <span class="_ _42"> </span>packed <span class="_ _42"> </span>tightly<span class="_ _6"></span>,<span class="_ _35"> </span>to<span class="_ _44"> </span>save <span class="_ _42"> </span>space <span class="_ _23"> </span>with <span class="_ _42"> </span>a</div><div class="t m0 x41 h2a y40d ff19 fsf fc0 sc0 ls0 ws0">possible <span class="_ _4b"> </span>runtime <span class="_ _44"> </span>performance <span class="_ _4b"> </span>penalty<span class="_ _6"></span>,<span class="_ _65"> </span>or<span class="_ _48"> </span>aligned <span class="_ _4b"> </span>accurately<span class="_ _4"></span>,<span class="_ _48"> </span>to<span class="_ _65"> </span>optimize</div><div class="t m0 x41 h2a y40e ff19 fsf fc0 sc0 ls4e ws0">ru<span class="ls0">ntime <span class="_ _23"></span>access <span class="_ _23"></span>of <span class="_ _9"></span>each <span class="_ _23"> </span>member<span class="_ _1"></span><span class="ls6d9">.T<span class="_ _26"></span><span class="ls0">his <span class="_ _23"></span>means <span class="_ _23"></span>that <span class="_ _9"></span>even <span class="_ _23"> </span>on <span class="_ _23"></span>a <span class="_ _23"></span>single <span class="_ _23"></span>system, <span class="_ _9"></span>the</span></span></span></div><div class="t m0 x41 h2a y15ec ff19 fsf fc0 sc0 ls0 ws0">binary layout of a structur<span class="_ _0"></span><span class="ls44">ec<span class="_ _d"></span><span class="ls0">an differ<span class="_ _6"></span><span class="ls44">,d<span class="_ _d"></span><span class="ls0">epending on compiler options.</span></span></span></span></div><div class="t m0 x3f h2a y15ed ff19 fsf fc0 sc0 ls0 ws0">2. <span class="_ _51"> </span>The<span class="_ _35"> </span>binary <span class="_ _42"> </span>formats <span class="_ _42"> </span>used <span class="_ _42"> </span>to <span class="_ _42"> </span>stor<span class="ls6da">em<span class="_ _c"></span><span class="ls0">ultibyte <span class="_ _42"> </span>integers <span class="_ _42"> </span>and <span class="_ _42"> </span>ﬂoating-point <span class="_ _42"> </span>values</span></span></div><div class="t m0 x41 h2a y15ee ff19 fsf fc0 sc0 ls0 ws0">differ among machine ar<span class="_ _0"></span>chitectur<span class="_ _0"></span>es.</div><div class="t m0 x32 h2a y15ef ff19 fsf fc0 sc0 ls5f ws0">We<span class="_ _9"></span><span class="ls0">’ll <span class="_ _23"></span>touch <span class="_ _23"></span>on <span class="_ _23"></span>some <span class="_ _23"></span>of <span class="_ _9"></span>these <span class="_ _23"> </span>issues <span class="_ _23"> </span>when <span class="_ _23"></span>we <span class="_ _23"></span>discuss <span class="_ _23"></span>sockets <span class="_ _23"></span>in <span class="_ _9"></span>Chapter <span class="_ _23"> </span>16.<span class="_ _51"> </span>The <span class="_ _23"> </span>real</span></div><div class="t m0 x32 h2a y15f0 ff19 fsf fc0 sc0 ls0 ws0">solution <span class="_ _9"></span>for <span class="_ _9"></span>exchanging <span class="_ _9"></span>binary <span class="_ _9"></span>data <span class="_ _9"></span>among <span class="_ _9"></span>differ<span class="_ _1"></span>ent <span class="_ _9"></span>systems <span class="_ _9"></span>is <span class="_ _9"></span>to <span class="_ _9"></span>use <span class="_ _9"></span>an <span class="_ _9"></span>agreed-upon</div><div class="t m0 x32 h2a y15f1 ff19 fsf fc0 sc0 ls0 ws0">canonical <span class="_ _2"></span>format.<span class="_ _16"> </span>Refer <span class="_ _3"></span>to <span class="_ _3"></span>Section <span class="_ _3"></span>8.2 <span class="_ _3"></span>of <span class="_ _3"></span>Rago</div><div class="t m0 x179 h2a y25b ff19 fsf fc0 sc0 ls0 ws0">[</div><div class="t m0 x17a h2a y15f1 ff19 fsf fc0 sc0 ls0 ws0">1993</div><div class="t m0 x1c6 h2a y25b ff19 fsf fc0 sc0 ls0 ws0">]</div><div class="t m0 x73 h2a y15f1 ff19 fsf fc0 sc0 ls0 ws0">or <span class="_ _2"></span>Section <span class="_ _3"></span>5.18 <span class="_ _3"></span>of <span class="_ _3"></span>Stevens, <span class="_ _3"></span>Fenner<span class="_ _1"></span>,</div><div class="t m0 x32 h2a y15f2 ff19 fsf fc0 sc0 ls128 ws0">&amp;R<span class="_ _b"></span><span class="ls0">udoff</span></div><div class="t m0 x1c h2a y165 ff19 fsf fc0 sc0 ls0 ws0">[</div><div class="t m0 x175 h2a y15f2 ff19 fsf fc0 sc0 ls0 ws0">2004</div><div class="t m0 x137 h2a y165 ff19 fsf fc0 sc0 ls0 ws0">]</div><div class="t m0 xdf h2a y15f2 ff19 fsf fc0 sc0 ls0 ws0">for <span class="_ _3"></span>a <span class="_ _9"></span>description <span class="_ _9"></span>of <span class="_ _3"></span>some <span class="_ _9"></span>techniques <span class="_ _9"></span>various <span class="_ _3"></span>network <span class="_ _9"></span>protocols <span class="_ _3"></span>use <span class="_ _9"></span>to</div><div class="t m0 x32 h2a y15f3 ff19 fsf fc0 sc0 ls0 ws0">exchange binary data.</div><div class="t m0 x3f h26 y15f4 ff19 fsf fc0 sc0 ls5f ws0">We<span class="_ _9"></span><span class="ls0">’ll <span class="_ _9"></span>return <span class="_ _3"></span>to <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">fread<span class="_ _45"> </span></span>function <span class="_ _3"></span>in <span class="_ _9"></span>Section <span class="_ _9"></span>8.14 <span class="_ _9"></span>when <span class="_ _9"></span>we <span class="_ _9"></span>use <span class="_ _9"></span>it <span class="_ _3"></span>to <span class="_ _9"></span>read <span class="_ _9"></span>a <span class="_ _3"></span>binary</span></div><div class="t m0 x32 h2a y15f5 ff19 fsf fc0 sc0 ls0 ws0">structur<span class="_ _0"></span>e, the UNIX process accounting r<span class="_ _0"></span>ecords.</div><div class="t m0 x35 h53 y15f6 ff16 fs2b fc0 sc0 ls0 ws0">5.10 <span class="_ _93"> </span>P<span class="_ _1"></span>ositioning <span class="_"> </span>a <span class="_"> </span>Stream</div><div class="t m0 x32 h2a y15f7 ff19 fsf fc0 sc0 ls0 ws0">Ther<span class="ls44">ea<span class="_ _4f"></span><span class="ls45">re <span class="_ _3"></span>t<span class="ls0">hree ways to position a standar<span class="ls44">dI<span class="_ _4f"></span><span class="ls0">/O stream:</span></span></span></span></span></div><div class="t m0 x3f h26 y15f8 ff19 fsf fc0 sc0 ls0 ws0">1. <span class="_ _51"> </span>The<span class="_ _45"> </span>two <span class="_ _3"></span>functions<span class="_ _45"> </span><span class="ff1a">ftell<span class="_ _47"> </span></span>and<span class="_ _45"> </span><span class="ff1a">fseek</span><span class="ls6db">.T<span class="_ _62"></span><span class="ls0">hey <span class="_ _9"></span>have <span class="_ _9"></span>been <span class="_ _3"></span>around <span class="_ _9"></span>since <span class="_ _3"></span>V<span class="_ _6"></span>ersion <span class="_ _3"></span>7,</span></span></div><div class="t m0 x41 h2a y15f9 ff19 fsf fc0 sc0 ls0 ws0">but they assume that a ﬁle’s position can be stored in a long integer<span class="_ _6"></span>.</div><div class="t m0 x3f h26 y15fa ff19 fsf fc0 sc0 ls0 ws0">2. <span class="_ _51"> </span>The<span class="_ _44"> </span>two <span class="_ _23"> </span>functions<span class="_ _44"> </span><span class="ff1a">ftello<span class="_ _44"> </span></span>and<span class="_ _35"> </span><span class="ff1a">fseeko</span><span class="ls6dc">.T<span class="_ _7"></span><span class="ls0">hey <span class="_ _42"> </span>wer<span class="ls6dd">ei<span class="_ _c"></span><span class="ls0">ntroduced <span class="_ _42"> </span>in <span class="_ _42"> </span>the <span class="_ _23"> </span>Single</span></span></span></span></div><div class="t m0 x41 h2a y15fb ff19 fsf fc0 sc0 ls0 ws0">UNIX <span class="_ _23"></span>Speciﬁcation <span class="_ _9"></span>to <span class="_ _23"> </span>allow <span class="_ _23"> </span>for <span class="_ _23"> </span>ﬁle <span class="_ _23"></span>offsets <span class="_ _9"></span>that <span class="_ _23"> </span>might <span class="_ _23"></span>not <span class="_ _23"></span>ﬁt <span class="_ _23"></span>in <span class="_ _9"></span>a <span class="_ _23"> </span>long <span class="_ _23"> </span>integer<span class="_ _1"></span>.</div><div class="t m0 x41 h26 y15fc ff19 fsf fc0 sc0 ls0 ws0">They replace the long integer with the<span class="_"> </span><span class="ff1a">off_t<span class="_ _80"> </span></span>data type.</div><div class="t m0 x3f h26 y15fd ff19 fsf fc0 sc0 ls0 ws0">3. <span class="_ _51"> </span>The<span class="_ _44"> </span>two <span class="_ _42"> </span>functions<span class="_ _44"> </span><span class="ff1a">fgetpos<span class="_ _35"> </span></span>and<span class="_ _44"> </span><span class="ff1a">fsetpos</span><span class="ls6de">.T<span class="_ _52"></span><span class="ls0">hey <span class="_ _42"> </span>wer<span class="ls6df">ei<span class="_ _43"></span><span class="ls0">ntr<span class="_ _0"></span>oduced <span class="_ _42"> </span>by <span class="_ _42"> </span>ISO <span class="_ _42"> </span>C.</span></span></span></span></div><div class="t m0 x41 h26 y15fe ff19 fsf fc0 sc0 ls0 ws0">They <span class="_ _2"></span>use <span class="_ _3"></span>an <span class="_ _2"></span>abstract <span class="_ _2"></span>data <span class="_ _3"></span>type,<span class="_ _47"> </span><span class="ff1a">fpos_t</span><span class="ls6e0">,t<span class="_ _8"></span><span class="ls0">hat <span class="_ _3"></span>recor<span class="_ _0"></span>ds <span class="_ _2"></span>a <span class="_ _3"></span>ﬁle’s <span class="_ _2"></span>position.<span class="_ _61"> </span>This <span class="_ _3"></span>data</span></span></div><div class="t m0 x41 h2a y15ff ff19 fsf fc0 sc0 ls0 ws0">type can be made as big as necessary to recor<span class="_ _0"></span><span class="ls44">daﬁ<span class="_ _d"></span><span class="ls0">le’s position.</span></span></div><div class="t m0 x32 h26 y1600 ff19 fsf fc0 sc0 ls0 ws0">When porting applications to non-UNIX systems, use<span class="_"> </span><span class="ff1a">fgetpos<span class="_ _80"> </span></span>and<span class="_"> </span><span class="ff1a">fsetpos</span>.</div><a class="l" href="#pfe" data-dest-detail='[14,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.893883px;bottom:461.808878px;width:161.555107px;height:19.679016px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
