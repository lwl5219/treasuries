<div id="pf89" class="pf w4 h1f" data-page-no="89"><div class="pc pc89 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg89.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h7a ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>4.7<span class="_ _18f"> </span><span class="ff1a">access<span class="_ _4b"> </span></span>and<span class="_ _4b"> </span><span class="ff1a">faccessat<span class="_ _4b"> </span></span>Functions<span class="_ _1b"> </span><span class="ff18">103</span></div><div class="t m0 x3f h26 y12f ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _61"> </span><span class="ff1b">ﬂag<span class="_ _61"> </span></span>argument <span class="_"> </span>can <span class="_ _47"> </span>be <span class="_ _66"> </span>used <span class="_ _47"> </span>to <span class="_"> </span>change <span class="_ _47"> </span>the <span class="_ _66"> </span>behavior <span class="_ _47"> </span>of<span class="_ _61"> </span><span class="ff1a">faccessat</span><span class="ls4c0">.I<span class="_ _49"></span><span class="ls4c1">ft<span class="_ _1d"></span><span class="ls0">he</span></span></span></div><div class="t m0 x32 h26 y130 ff1a fsf fc0 sc0 ls0 ws0">AT_EACCESS<span class="_ _47"> </span><span class="ff19">ﬂag <span class="_ _9"></span>is <span class="_ _3"></span>set, <span class="_ _9"></span>the <span class="_ _3"></span>access <span class="_ _9"></span>checks <span class="_ _3"></span>ar<span class="ls4c2">em<span class="_ _b"></span><span class="ls0">ade <span class="_ _9"></span>using <span class="_ _3"></span>the <span class="_ _9"></span>effective <span class="_ _3"></span>user <span class="_ _3"></span>and <span class="_ _9"></span>group</span></span></span></div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">IDs of the calling process instead of the r<span class="_ _0"></span>eal user and gr<span class="_ _0"></span>oup IDs.</div><div class="t m0 x35 h27 y133 ff16 fsf fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h26 y135 ff19 fsf fc0 sc0 ls0 ws0">Figur<span class="ls44">e4<span class="_ _4f"></span><span class="ls0">.8 shows the use of the<span class="_"> </span><span class="ff1a">access<span class="_ _66"> </span></span>function.</span></span></div><div class="t m0 x32 h4e yee9 ff1a fs28 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h4e yeea ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;fcntl.h&gt;</div><div class="t m0 x32 h4e yeeb ff1a fs28 fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h4e yeec ff1a fs28 fc0 sc0 ls0 ws0">main(int argc, char *argv[])</div><div class="t m0 x32 h4e yeed ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e yeee ff1a fs28 fc0 sc0 ls0 ws0">if (argc != 2)</div><div class="t m0 x9d h4e yeef ff1a fs28 fc0 sc0 ls0 ws0">err_quit(&quot;usage: a.out &lt;pathname&gt;&quot;);</div><div class="t m0 x8a h4e yef0 ff1a fs28 fc0 sc0 ls0 ws0">if (access(argv[1], R_OK) &lt; 0)</div><div class="t m0 x9d h4e yef1 ff1a fs28 fc0 sc0 ls0 ws0">err_ret(&quot;access error for %s&quot;, argv[1]);</div><div class="t m0 x8a h4e yef2 ff1a fs28 fc0 sc0 ls0 ws0">else</div><div class="t m0 x9d h4e yef3 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;read access OK\n&quot;);</div><div class="t m0 x8a h4e yef4 ff1a fs28 fc0 sc0 ls0 ws0">if (open(argv[1], O_RDONLY) &lt; 0)</div><div class="t m0 x9d h4e yef5 ff1a fs28 fc0 sc0 ls0 ws0">err_ret(&quot;open error for %s&quot;, argv[1]);</div><div class="t m0 x8a h4e yef6 ff1a fs28 fc0 sc0 ls0 ws0">else</div><div class="t m0 x9d h4e yef7 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;open for reading OK\n&quot;);</div><div class="t m0 x8a h4e yef8 ff1a fs28 fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h4e yef9 ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x9e h4f yefa ff18 fs11 fc0 sc0 ls0 ws0">Figure 4.8<span class="_ _5a"> </span><span class="ff19">Example of<span class="_"> </span><span class="ff1a">access<span class="_ _e"> </span></span>function</span></div><div class="t m0 x32 h55 yefb ff19 fs2c fc0 sc0 ls0 ws0">Here<span class="_"> </span>is<span class="_"> </span>a<span class="_"> </span>sample session with this pr<span class="_ _0"></span>ogram:</div><div class="t m0 x52 h5d yefc ff1a fs2f fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">ls -l a.out</span></div><div class="t m0 x52 h5d yefd ff1a fs2f fc0 sc0 ls0 ws0">-rwxrwxr-x <span class="_"> </span>1<span class="_"> </span>sar <span class="_ _186"> </span>15945<span class="_"> </span>Nov 30 12:10 a.out</div><div class="t m0 x52 h5d yefe ff1a fs2f fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">./a.out a.out</span></div><div class="t m0 x52 h5d yeff ff1a fs2f fc0 sc0 ls0 ws0">read access OK</div><div class="t m0 x52 h5d yf00 ff1a fs2f fc0 sc0 ls0 ws0">open for reading OK</div><div class="t m0 x52 h5d yf01 ff1a fs2f fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">ls -l /etc/shadow</span></div><div class="t m0 x52 h5d yf02 ff1a fs2f fc0 sc0 ls0 ws0">-r-------- <span class="_"> </span>1<span class="_"> </span>root <span class="_ _186"> </span>1315<span class="_"> </span>Jul 17<span class="_ _d9"> </span>2002 /etc/shadow</div><div class="t m0 x52 h5d yf03 ff1a fs2f fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">./a.out /etc/shadow</span></div><div class="t m0 x52 h5d yf04 ff1a fs2f fc0 sc0 ls0 ws0">access error for /etc/shadow: Permission denied</div><div class="t m0 x52 h5d yf05 ff1a fs2f fc0 sc0 ls0 ws0">open error for /etc/shadow: Permission denied</div><div class="t m0 x52 h5d yf06 ff1a fs2f fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">su<span class="_ _190"> </span><span class="ff1b">become superuser</span></span></div><div class="t m0 x52 h5d yf07 ff1a fs2f fc0 sc0 ls0 ws0">Password:<span class="_ _168"> </span><span class="ff1b">enter superuser password</span></div><div class="t m0 x52 h5d yf08 ff1a fs2f fc0 sc0 ls0 ws0">#<span class="_"> </span><span class="ff1f">chown root a.out<span class="_ _191"> </span><span class="ff1b">change ﬁle’<span class="_ _1"></span><span class="ls4c3">su<span class="_ _5"></span><span class="ls0">ser ID to root</span></span></span></span></div><div class="t m0 x52 h5d yf09 ff1a fs2f fc0 sc0 ls0 ws0">#<span class="_"> </span><span class="ff1f">chmod u+s a.out<span class="_ _b0"> </span><span class="ff1b">and turn on set-user-ID bit</span></span></div><div class="t m0 x52 h5d yf0a ff1a fs2f fc0 sc0 ls0 ws0">#<span class="_"> </span><span class="ff1f">ls -l a.out<span class="_ _192"> </span><span class="ff1b">check owner and SUID bit</span></span></div><div class="t m0 x52 h5d yf0b ff1a fs2f fc0 sc0 ls0 ws0">-rwsrwxr-x <span class="_"> </span>1<span class="_"> </span>root <span class="_ _b7"> </span>15945<span class="_"> </span>Nov 30 12:10 a.out</div><div class="t m0 x52 h5d yf0c ff1a fs2f fc0 sc0 ls0 ws0">#<span class="_"> </span><span class="ff1f">exit<span class="_ _193"> </span><span class="ff1b">go back to normal user</span></span></div><div class="t m0 x52 h5d yf0d ff1a fs2f fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">./a.out /etc/shadow</span></div><div class="t m0 x52 h5d yf0e ff1a fs2f fc0 sc0 ls0 ws0">access error for /etc/shadow: Permission denied</div><div class="t m0 x52 h5d yf0f ff1a fs2f fc0 sc0 ls0 ws0">open for reading OK</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
