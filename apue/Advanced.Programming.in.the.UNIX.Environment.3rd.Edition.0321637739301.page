<div id="pf12d" class="pf w4 h1f" data-page-no="12d"><div class="pc pc12d w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg12d.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h7a ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>8.13<span class="_ _23a"> </span><span class="ff1a">system<span class="_ _4b"> </span></span>Function<span class="_ _1b"> </span><span class="ff18">267</span></div><div class="t m0 x32 h57 y362 ff1a fs2d fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h57 y3c0 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;sys/wait.h&gt;</div><div class="t m0 x32 h57 y1d78 ff1a fs2d fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h57 y1d79 ff1a fs2d fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 x32 h57 y1d7a ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y1d7b ff1a fs2d fc0 sc0 ls0 ws0">int <span class="_ _15"> </span>status;</div><div class="t m0 x8a h57 y3c6 ff1a fs2d fc0 sc0 ls0 ws0">if ((status = system(&quot;date&quot;)) &lt; 0)</div><div class="t m0 x9d h57 y1d7c ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;system() error&quot;);</div><div class="t m0 x8a h57 y1cc5 ff1a fs2d fc0 sc0 ls0 ws0">pr_exit(status);</div><div class="t m0 x8a h57 y3ca ff1a fs2d fc0 sc0 ls0 ws0">if ((status = system(&quot;nosuchcommand&quot;)) &lt; 0)</div><div class="t m0 x9d h57 y1cc6 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;system() error&quot;);</div><div class="t m0 x8a h57 y2329 ff1a fs2d fc0 sc0 ls0 ws0">pr_exit(status);</div><div class="t m0 x8a h57 y3ce ff1a fs2d fc0 sc0 ls0 ws0">if ((status = system(&quot;who; exit 44&quot;)) &lt; 0)</div><div class="t m0 x9d h57 y3cf ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;system() error&quot;);</div><div class="t m0 x8a h57 y232a ff1a fs2d fc0 sc0 ls0 ws0">pr_exit(status);</div><div class="t m0 x8a h57 y3d2 ff1a fs2d fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h57 y3d3 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x39 h5e y1f3f ff18 fs10 fc0 sc0 ls0 ws0">Figure 8.23<span class="_ _5a"> </span><span class="ff19">Calling the<span class="_"> </span><span class="ff1a">system<span class="_ _e"> </span></span>function</span></div><div class="t m0 x3f h4d y232b ff19 fs26 fc0 sc0 ls0 ws0">Earlier <span class="_ _23"> </span>systems, <span class="_ _42"> </span>including <span class="_ _23"></span>SVR3.2 <span class="_ _23"> </span>and <span class="_ _42"> </span>4.3BSD, <span class="_ _23"> </span>didn’t <span class="_ _23"> </span>have <span class="_ _42"> </span>the<span class="_ _35"> </span><span class="ff1a">waitpid<span class="_ _35"> </span></span>function</div><div class="t m0 x32 h49 y232c ff19 fs26 fc0 sc0 ls0 ws0">available. <span class="_"> </span>Instead,<span class="_"> </span>the parent waited for the child, using a statement such as</div><div class="t m0 xc2 h4e y232d ff1a fs28 fc0 sc0 ls0 ws0">while ((lastpid = wait(&amp;status)) != pid &amp;&amp; lastpid != -1)</div><div class="t m0 x16e h4e y232e ff1a fs28 fc0 sc0 ls0 ws0">;</div><div class="t m0 x32 h4d y232f ff19 fs26 fc0 sc0 lsa55 ws0">Ap<span class="_ _8"></span><span class="lscc">ro<span class="_ _2"></span><span class="ls0">blem <span class="_ _3"></span>occurs <span class="_ _2"></span>if <span class="_ _3"></span>the <span class="_ _2"></span>process <span class="_ _2"></span>that <span class="_ _3"></span>calls<span class="_ _47"> </span><span class="ff1a">system<span class="_ _47"> </span></span>has <span class="_ _2"></span>spawned <span class="_ _2"></span>its <span class="_ _3"></span>own <span class="_ _2"></span>children <span class="_ _2"></span>before</span></span></div><div class="t m0 x32 h4d y2330 ff19 fs26 fc0 sc0 ls0 ws0">calling<span class="_ _47"> </span><span class="ff1a">system</span><span class="ls166">.B<span class="_ _1d"></span><span class="ls0">ecause <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">while<span class="_ _47"> </span></span>statement <span class="_ _3"></span>above <span class="_ _9"></span>keeps <span class="_ _2"></span>looping <span class="_ _9"></span>until <span class="_ _2"></span>the <span class="_ _9"></span>child <span class="_ _2"></span>that</span></span></div><div class="t m0 x32 h4d y2331 ff19 fs26 fc0 sc0 ls0 ws0">was generated by<span class="_"> </span><span class="ff1a">system<span class="_ _66"> </span></span>terminates, if any children of the process terminate befor<span class="_ _0"></span><span class="lsa56">et<span class="_ _d"></span><span class="ls0">he</span></span></div><div class="t m0 x32 h4d y2332 ff19 fs26 fc0 sc0 ls0 ws0">process <span class="_ _42"> </span>identiﬁed <span class="_ _42"> </span>by<span class="_ _4b"> </span><span class="ff1a">pid</span><span class="lsa57">,t<span class="_ _c"></span><span class="ls0">hen <span class="_ _53"> </span>the <span class="_ _53"> </span>process <span class="_ _42"> </span>ID <span class="_ _42"> </span>and <span class="_ _53"> </span>termination <span class="_ _53"> </span>status <span class="_ _53"> </span>of <span class="_ _42"> </span>these <span class="_ _53"> </span>other</span></span></div><div class="t m0 x32 h4d y2333 ff19 fs26 fc0 sc0 ls0 ws0">children <span class="_ _42"> </span>ar<span class="ls6ae">ed<span class="_ _55"></span><span class="ls0">iscarded <span class="_ _53"> </span>by <span class="_ _53"> </span>the<span class="_ _4b"> </span><span class="ff1a">while<span class="_ _44"> </span></span>statement. <span class="_ _4b"> </span>Indeed,<span class="_ _44"> </span>this <span class="_ _53"> </span>inability <span class="_ _53"> </span>to<span class="_ _4b"> </span><span class="ff1a">wait<span class="_ _44"> </span></span>for <span class="_ _53"> </span>a</span></span></div><div class="t m0 x32 h49 y2334 ff19 fs26 fc0 sc0 ls0 ws0">speciﬁc <span class="_ _53"> </span>child <span class="_ _53"> </span>is <span class="_ _53"> </span>one <span class="_ _53"> </span>of <span class="_ _53"> </span>the <span class="_ _53"> </span>reasons <span class="_ _53"> </span>given <span class="_ _53"> </span>in <span class="_ _53"> </span>the <span class="_ _53"> </span>POSIX.1 <span class="_ _53"> </span>Rationale <span class="_ _53"> </span>for <span class="_ _e"> </span>including <span class="_ _53"> </span>the</div><div class="t m0 x32 h4d y2335 ff1a fs26 fc0 sc0 ls0 ws0">waitpid<span class="_ _44"> </span><span class="ff19">function. <span class="_ _4b"> </span>W<span class="_ _6"></span>e’ll <span class="_ _e"> </span>see <span class="_ _53"> </span>in <span class="_ _e"> </span>Section <span class="_ _53"> </span>15.3 <span class="_ _53"> </span>that <span class="_ _e"> </span>the <span class="_ _53"> </span>same <span class="_ _e"> </span>problem <span class="_ _42"> </span>occurs <span class="_ _e"> </span>with <span class="_ _53"> </span>the</span></div><div class="t m0 x32 h4d y2336 ff1a fs26 fc0 sc0 ls0 ws0">popen<span class="_ _80"> </span><span class="ff19">and<span class="_"> </span></span>pclose<span class="_ _66"> </span><span class="ff19">functions if the system doesn’t provide a<span class="_"> </span></span>waitpid<span class="_ _80"> </span><span class="ff19">function.</span></div><div class="t m0 x35 h4c y2337 ff16 fs26 fc0 sc0 ls0 ws0">Set-User-ID Pr<span class="_ _1"></span>ograms</div><div class="t m0 x32 h4d y2338 ff19 fs26 fc0 sc0 ls0 ws0">What <span class="_"> </span>happens <span class="_"> </span>if <span class="_"> </span>we <span class="_"> </span>call<span class="_ _59"> </span><span class="ff1a">system<span class="_ _59"> </span></span>from <span class="_"> </span>a <span class="_"> </span>set-user<span class="_ _0"></span>-ID <span class="_"> </span>pr<span class="_ _0"></span>ogram? <span class="_ _59"> </span>Doing<span class="_ _46"> </span>so <span class="_"> </span>creates <span class="_"> </span>a</div><div class="t m0 x32 h49 y2339 ff19 fs26 fc0 sc0 ls0 ws0">security <span class="_ _2"></span>hole <span class="_ _3"></span>and <span class="_ _2"></span>should <span class="_ _3"></span>never <span class="_ _2"></span>be <span class="_ _3"></span>attempted.<span class="_ _61"> </span>Figur<span class="lsa58">e8<span class="_ _8"></span><span class="ls0">.24 <span class="_ _3"></span>shows <span class="_ _3"></span>a <span class="_ _2"></span>simple <span class="_ _3"></span>program <span class="_ _2"></span>that</span></span></div><div class="t m0 x32 h4d y233a ff19 fs26 fc0 sc0 ls0 ws0">just calls<span class="_"> </span><span class="ff1a">system<span class="_ _80"> </span></span>for its command</div><div class="t m0 x5b h49 y233b ff19 fs26 fc0 sc0 ls0 ws0">-</div><div class="t m0 x5c h49 y233a ff19 fs26 fc0 sc0 ls0 ws0">line argument.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
