<div id="pf132" class="pf w4 h1f" data-page-no="132"><div class="pc pc132 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg132.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">272<span class="_ _1b"> </span><span class="ff19">Process <span class="_"> </span>Contr<span class="_ _0"></span>ol <span class="_ _222"> </span>Chapter<span class="_ _4b"> </span>8</span></div><div class="t m0 x8a h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">else if (pid != 0) {<span class="_ _186"> </span>/* parent */</div><div class="t m0 x9d h57 y426 ff1a fs2d fc0 sc0 ls0 ws0">sleep(2);</div><div class="t m0 x9d h57 y800 ff1a fs2d fc0 sc0 ls0 ws0">exit(2); <span class="_ _227"> </span>/*<span class="_"> </span>terminate with exit status 2 */</div><div class="t m0 x8a h57 y801 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y23c8 ff1a fs2d fc0 sc0 ls0 ws0">if ((pid = fork()) &lt; 0)</div><div class="t m0 x9d h57 y23c9 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;fork error&quot;);</div><div class="t m0 x8a h57 y23ca ff1a fs2d fc0 sc0 ls0 ws0">else if (pid != 0) {<span class="_ _186"> </span>/* first child */</div><div class="t m0 x9d h57 y23cb ff1a fs2d fc0 sc0 ls0 ws0">sleep(4);</div><div class="t m0 x9d h57 y86e ff1a fs2d fc0 sc0 ls0 ws0">abort(); <span class="_ _227"> </span>/*<span class="_"> </span>terminate with core dump */</div><div class="t m0 x8a h57 y86f ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y23cc ff1a fs2d fc0 sc0 ls0 ws0">if ((pid = fork()) &lt; 0)</div><div class="t m0 x9d h57 y23cd ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;fork error&quot;);</div><div class="t m0 x8a h57 y872 ff1a fs2d fc0 sc0 ls0 ws0">else if (pid != 0) {<span class="_ _186"> </span>/* second child */</div><div class="t m0 x9d h57 y873 ff1a fs2d fc0 sc0 ls0 ws0">execl(&quot;/bin/dd&quot;, &quot;dd&quot;, &quot;if=/etc/passwd&quot;, &quot;of=/dev/null&quot;, NULL);</div><div class="t m0 x9d h57 y874 ff1a fs2d fc0 sc0 ls0 ws0">exit(7); <span class="_ _227"> </span>/*<span class="_"> </span>shouldn’t get here */</div><div class="t m0 x8a h57 y875 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y23ce ff1a fs2d fc0 sc0 ls0 ws0">if ((pid = fork()) &lt; 0)</div><div class="t m0 x9d h57 y23cf ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;fork error&quot;);</div><div class="t m0 x8a h57 y23d0 ff1a fs2d fc0 sc0 ls0 ws0">else if (pid != 0) {<span class="_ _186"> </span>/* third child */</div><div class="t m0 x9d h57 y23d1 ff1a fs2d fc0 sc0 ls0 ws0">sleep(8);</div><div class="t m0 x9d h57 y23d2 ff1a fs2d fc0 sc0 ls0 ws0">exit(0); <span class="_ _227"> </span>/*<span class="_"> </span>normal exit */</div><div class="t m0 x8a h57 y23d3 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y23d4 ff1a fs2d fc0 sc0 ls0 ws0">sleep(6); <span class="_ _cb"> </span>/*<span class="_"> </span>fourth child */</div><div class="t m0 x8a h57 y23d5 ff1a fs2d fc0 sc0 ls0 ws0">kill(getpid(), SIGKILL);<span class="_ _15"> </span>/* terminate w/signal, no core dump */</div><div class="t m0 x8a h57 y23d6 ff1a fs2d fc0 sc0 ls0 ws0">exit(6); <span class="_ _1e9"> </span>/*<span class="_"> </span>shouldn’t get here */</div><div class="t m0 x32 h57 y23d7 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x3d h2d y881 ff18 fs10 fc0 sc0 ls0 ws0">Figure 8.28<span class="_ _5a"> </span><span class="ff19">Program to generate accounting data</span></div><div class="t m0 x3f h49 y23d8 ff19 fs26 fc0 sc0 ls164 ws0">We<span class="_ _9"></span><span class="ls0">’ll <span class="_ _23"> </span>run <span class="_ _23"> </span>the <span class="_ _42"> </span>test <span class="_ _23"> </span>program <span class="_ _23"></span>on <span class="_ _23"> </span>Solaris <span class="_ _42"> </span>and <span class="_ _23"></span>then <span class="_ _23"> </span>use <span class="_ _42"> </span>the <span class="_ _23"></span>program <span class="_ _23"></span>in <span class="_ _23"></span>Figur<span class="lsa6d">e8<span class="_ _43"></span><span class="ls0">.29 <span class="_ _23"></span>to</span></span></span></div><div class="t m0 x32 h49 y23d9 ff19 fs26 fc0 sc0 ls0 ws0">print out selected ﬁelds from the accounting r<span class="_ _0"></span>ecor<span class="_ _0"></span>ds.</div><div class="t m0 x32 h5d y23da ff1a fs2f fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h5d y23db ff1a fs2f fc0 sc0 ls0 ws0">#include &lt;sys/acct.h&gt;</div><div class="t m0 x32 h5d y23dc ff1a fs2f fc0 sc0 ls0 ws0">#if defined(BSD)<span class="_ _15"> </span>/* different structure in FreeBSD */</div><div class="t m0 x32 h5d y23dd ff1a fs2f fc0 sc0 ls0 ws0">#define acct acctv2</div><div class="t m0 x32 h5d y23de ff1a fs2f fc0 sc0 ls0 ws0">#define ac_flag ac_trailer.ac_flag</div><div class="t m0 x32 h5d y23df ff1a fs2f fc0 sc0 ls0 ws0">#define FMT &quot;%-*.*s<span class="_ _d9"> </span><span class="ls395">e=%<span class="_ _5b"></span><span class="ls0">.0f, chars = %.0f, %c %c %c %c\n&quot;</span></span></div><div class="t m0 x32 h5d y23e0 ff1a fs2f fc0 sc0 ls0 ws0">#elif defined(HAS_AC_STAT)</div><div class="t m0 x32 h5d y23e1 ff1a fs2f fc0 sc0 ls0 ws0">#define FMT &quot;%-*.*s<span class="_ _d9"> </span><span class="ls395">e=%<span class="_ _5b"></span><span class="ls0">6ld, chars = %7ld, stat = %3u: %c %c %c %c\n&quot;</span></span></div><div class="t m0 x32 h5d y23e2 ff1a fs2f fc0 sc0 ls0 ws0">#else</div><div class="t m0 x32 h5d y23e3 ff1a fs2f fc0 sc0 ls0 ws0">#define FMT &quot;%-*.*s<span class="_ _d9"> </span><span class="ls395">e=%<span class="_ _5b"></span><span class="ls0">6ld, chars = %7ld, %c %c %c %c\n&quot;</span></span></div><div class="t m0 x32 h5d y23e4 ff1a fs2f fc0 sc0 ls0 ws0">#endif</div><div class="t m0 x32 h5d y23e5 ff1a fs2f fc0 sc0 ls0 ws0">#if defined(LINUX)</div><div class="t m0 x32 h5d y23e6 ff1a fs2f fc0 sc0 ls0 ws0">#define acct acct_v3<span class="_ _15"> </span>/* different structure in Linux */</div><div class="t m0 x32 h5d y23e7 ff1a fs2f fc0 sc0 ls0 ws0">#endif</div><div class="t m0 x32 h5d y23e8 ff1a fs2f fc0 sc0 ls0 ws0">#if !defined(HAS_ACORE)</div><div class="t m0 x32 h5d y23e9 ff1a fs2f fc0 sc0 ls0 ws0">#define ACORE 0</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
