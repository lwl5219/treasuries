<div id="pf2dd" class="pf w4 h1f" data-page-no="2dd"><div class="pc pc2dd w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg2dd.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>18.9<span class="_ _30a"> </span><span class="ls719">Te<span class="_ _9"></span></span>rminal <span class="_"> </span>Identiﬁcation<span class="_ _1b"> </span><span class="ff18">699</span></div><div class="t m0 x32 h2a y12f ff19 fsf fc0 sc0 ls0 ws0">number <span class="_ _42"> </span>and <span class="_ _42"> </span>matching <span class="_ _42"> </span>i-node <span class="_ _42"> </span>number<span class="_ _1"></span><span class="ls14f3">,w<span class="_ _43"></span><span class="ls0">e’ve <span class="_ _42"> </span>located <span class="_ _42"> </span>the <span class="_ _42"> </span>desired <span class="_ _42"> </span>directory <span class="_ _23"> </span>entry<span class="_ _6"></span><span class="ls14f4">.W<span class="_ _49"></span><span class="ls0">e</span></span></span></span></div><div class="t m0 x32 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">could <span class="_ _42"> </span>also <span class="_ _53"> </span>verify <span class="_ _42"> </span>that <span class="_ _53"> </span>the <span class="_ _42"> </span>two <span class="_ _53"> </span>entries <span class="_ _53"> </span>have <span class="_ _42"> </span>matching<span class="_ _44"> </span><span class="ff1a">st_rdev<span class="_ _44"> </span></span>ﬁelds <span class="_ _53"> </span>(the <span class="_ _53"> </span>major <span class="_ _42"> </span>and</div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">minor <span class="_ _45"> </span>device <span class="_ _47"> </span>numbers <span class="_ _45"> </span>for <span class="_ _45"> </span>the <span class="_ _47"> </span>terminal <span class="_ _45"> </span>device) <span class="_ _45"> </span>and <span class="_ _45"> </span>that <span class="_ _47"> </span>the <span class="_ _45"> </span>directory <span class="_ _47"> </span>entry <span class="_ _45"> </span>is <span class="_ _45"> </span>a</div><div class="t m0 x32 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">character <span class="_ _e"> </span>special <span class="_"> </span>ﬁle.<span class="_ _65"> </span>However<span class="_ _6"></span><span class="ls14f5">,s<span class="_ _55"></span><span class="ls0">ince <span class="_"> </span>we’ve <span class="_ _53"> </span>already <span class="_ _e"> </span>veriﬁed <span class="_"> </span>that <span class="_ _53"> </span>the <span class="_"> </span>ﬁle <span class="_ _53"> </span>descriptor</span></span></div><div class="t m0 x32 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">argument <span class="_ _23"></span>is <span class="_ _23"> </span>both <span class="_ _23"> </span>a <span class="_ _42"> </span>terminal <span class="_ _23"> </span>device <span class="_ _42"> </span>and <span class="_ _23"></span>a <span class="_ _23"> </span>character <span class="_ _42"> </span>special <span class="_ _23"> </span>ﬁle, <span class="_ _42"> </span>and <span class="_ _23"></span>since <span class="_ _23"> </span>a <span class="_ _42"> </span>matching</div><div class="t m0 x32 h2a y134 ff19 fsf fc0 sc0 ls0 ws0">device <span class="_ _9"></span>number <span class="_ _9"></span>and <span class="_ _23"></span>i-node <span class="_ _9"></span>number <span class="_ _9"></span>pair <span class="_ _23"></span>is <span class="_ _9"></span>unique <span class="_ _9"></span>on <span class="_ _9"></span>a <span class="_ _23"></span>UNIX <span class="_ _9"></span>system, <span class="_ _9"></span>there<span class="_ _45"> </span>is<span class="_ _45"> </span>no<span class="_ _45"> </span>need</div><div class="t m0 x32 h2a y135 ff19 fsf fc0 sc0 ls0 ws0">for the additional comparisons.</div><div class="t m0 x3f h26 y136 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _3"></span>name <span class="_ _9"></span>of <span class="_ _3"></span>our <span class="_ _9"></span>terminal <span class="_ _3"></span>might <span class="_ _3"></span>reside <span class="_ _3"></span>in <span class="_ _9"></span>a <span class="_ _3"></span>subdirectory <span class="_ _3"></span>in<span class="_ _45"> </span><span class="ff1a">/dev</span><span class="ls14f6">.T<span class="_ _62"></span><span class="ls0">hus, <span class="_ _3"></span>we <span class="_ _9"></span>might</span></span></div><div class="t m0 x32 h26 y137 ff19 fsf fc0 sc0 ls0 ws0">need <span class="_ _9"></span>to <span class="_ _9"></span>search <span class="_ _9"></span>the <span class="_ _9"></span>entir<span class="ls127">eﬁ<span class="_ _b"></span><span class="ls0">le <span class="_ _9"></span>system <span class="_ _9"></span>tree <span class="_ _3"></span>under<span class="_ _45"> </span><span class="ff1a">/dev</span><span class="ls14f7">.W<span class="_ _52"></span><span class="ls127">es<span class="_ _b"></span><span class="ls0">kip <span class="_ _9"></span>several <span class="_ _9"></span>directories <span class="_ _9"></span>that</span></span></span></span></span></div><div class="t m0 x32 h2a y138 ff19 fsf fc0 sc0 ls0 ws0">might <span class="_ _3"></span>produce <span class="_ _3"></span>incorrect <span class="_ _3"></span>or <span class="_ _3"></span>odd</div><div class="t m0 x4a h2a y724 ff19 fsf fc0 sc0 ls0 ws0">-</div><div class="t m0 x4b h26 y138 ff19 fsf fc0 sc0 ls0 ws0">looking <span class="_ _3"></span>results:<span class="_ _47"> </span><span class="ff1a">/dev/.</span>,<span class="_ _45"> </span><span class="ff1a">/dev/..</span><span class="ls1b3">,a<span class="_ _b"></span><span class="ls0">nd<span class="_ _45"> </span><span class="ff1a">/dev/fd</span><span class="ls654">.W<span class="_ _52"></span><span class="ls0">e</span></span></span></span></div><div class="t m0 x32 h26 y139 ff19 fsf fc0 sc0 ls0 ws0">also <span class="_ _23"> </span>skip <span class="_ _42"> </span>the <span class="_ _42"> </span>aliases<span class="_ _35"> </span><span class="ff1a">/dev/stdin</span>,<span class="_ _35"> </span><span class="ff1a">/dev/stdout</span><span class="ls14c4">,a<span class="_ _43"></span><span class="ls0">nd<span class="_ _44"> </span><span class="ff1a">/dev/stderr</span><span class="ls14c4">,s<span class="_ _43"></span><span class="ls0">ince <span class="_ _23"> </span>they <span class="_ _42"> </span>are</span></span></span></span></div><div class="t m0 x32 h26 y13a ff19 fsf fc0 sc0 ls0 ws0">symbolic links to ﬁles in<span class="_"> </span><span class="ff1a">/dev/fd</span>.</div><div class="t m0 x3f h2a y254 ff19 fsf fc0 sc0 ls5f ws0">We <span class="_ _53"> </span>c<span class="_ _9"></span><span class="ls0">an test this implementation with the program shown in Figur<span class="ls44">e1<span class="_ _4f"></span><span class="ls0">8.16.</span></span></span></div><div class="t m0 x32 h4e y4b15 ff1a fs28 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h4e y513e ff1a fs28 fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h4e y513f ff1a fs28 fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 x32 h4e y5140 ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y5141 ff1a fs28 fc0 sc0 ls0 ws0">char *name;</div><div class="t m0 x8a h4e y5142 ff1a fs28 fc0 sc0 ls0 ws0">if (isatty(0)) {</div><div class="t m0 x9d h4e y5143 ff1a fs28 fc0 sc0 ls0 ws0">name = ttyname(0);</div><div class="t m0 x9d h4e y5144 ff1a fs28 fc0 sc0 ls0 ws0">if (name == NULL)</div><div class="t m0 x1f h4e y4b1d ff1a fs28 fc0 sc0 ls0 ws0">name = &quot;undefined&quot;;</div><div class="t m0 x8a h4e y4b1e ff1a fs28 fc0 sc0 ls1b6 ws0">}e<span class="_ _1d"></span><span class="ls0">lse {</span></div><div class="t m0 x9d h4e y4b1f ff1a fs28 fc0 sc0 ls0 ws0">name = &quot;not a tty&quot;;</div><div class="t m0 x8a h4e y4b20 ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h4e y5145 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;fd 0: %s\n&quot;, name);</div><div class="t m0 x8a h4e y4b22 ff1a fs28 fc0 sc0 ls0 ws0">if (isatty(1)) {</div><div class="t m0 x9d h4e y4b23 ff1a fs28 fc0 sc0 ls0 ws0">name = ttyname(1);</div><div class="t m0 x9d h4e y4b24 ff1a fs28 fc0 sc0 ls0 ws0">if (name == NULL)</div><div class="t m0 x1f h4e y5146 ff1a fs28 fc0 sc0 ls0 ws0">name = &quot;undefined&quot;;</div><div class="t m0 x8a h4e y5147 ff1a fs28 fc0 sc0 ls1b6 ws0">}e<span class="_ _1d"></span><span class="ls0">lse {</span></div><div class="t m0 x9d h4e y5148 ff1a fs28 fc0 sc0 ls0 ws0">name = &quot;not a tty&quot;;</div><div class="t m0 x8a h4e y5149 ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h4e y514a ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;fd 1: %s\n&quot;, name);</div><div class="t m0 x8a h4e y4b2a ff1a fs28 fc0 sc0 ls0 ws0">if (isatty(2)) {</div><div class="t m0 x9d h4e y514b ff1a fs28 fc0 sc0 ls0 ws0">name = ttyname(2);</div><div class="t m0 x9d h4e y514c ff1a fs28 fc0 sc0 ls0 ws0">if (name == NULL)</div><div class="t m0 x1f h4e y514d ff1a fs28 fc0 sc0 ls0 ws0">name = &quot;undefined&quot;;</div><div class="t m0 x8a h4e y514e ff1a fs28 fc0 sc0 ls1b6 ws0">}e<span class="_ _1d"></span><span class="ls0">lse {</span></div><div class="t m0 x9d h4e y514f ff1a fs28 fc0 sc0 ls0 ws0">name = &quot;not a tty&quot;;</div><div class="t m0 x8a h4e y5150 ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h4e y5151 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;fd 2: %s\n&quot;, name);</div><div class="t m0 x8a h4e y4b32 ff1a fs28 fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h4e y5152 ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x9e h4f y5153 ff18 fs11 fc0 sc0 ls0 ws0">Figure 18.16<span class="_ _5a"> </span><span class="ff19 ls39f">Te<span class="_ _9"></span><span class="ls0">st the<span class="_"> </span><span class="ff1a">ttyname<span class="_ _53"> </span></span>function</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
