<div id="pf226" class="pf w4 h1f" data-page-no="226"><div class="pc pc226 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg226.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">516<span class="_ _1b"> </span><span class="ff19">Advanced <span class="_"> </span>I/O<span class="_ _16b"> </span>Chapter <span class="_"> </span>14</span></div><div class="t m0 x3f h26 y12f ff19 fsf fc0 sc0 ls5f ws0">We <span class="_ _80"> </span>c<span class="_ _9"></span><span class="ls0">an <span class="_ _3"></span>determine <span class="_ _3"></span>the <span class="_ _3"></span>value <span class="_ _2"></span>of<span class="_ _47"> </span><span class="ff1a">AIO_LISTIO_MAX<span class="_ _47"> </span></span>by <span class="_ _3"></span>calling <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">sysconf<span class="_ _47"> </span></span>function</span></div><div class="t m0 x32 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">with <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1b">name<span class="_ _47"> </span></span>argument <span class="_ _3"></span>set <span class="_ _3"></span>to<span class="_ _45"> </span><span class="ff1a">_SC_IO_LISTIO_MAX</span><span class="ls10c1">.S<span class="_ _62"></span><span class="ls0">imilarly<span class="_ _6"></span>,<span class="_ _47"> </span>we<span class="_ _47"> </span>can <span class="_ _3"></span>determine <span class="_ _3"></span>the</span></span></div><div class="t m0 x32 h26 y131 ff19 fsf fc0 sc0 ls0 ws0">value <span class="_ _23"></span>of<span class="_ _45"> </span><span class="ff1a">AIO_MAX<span class="_ _35"> </span></span>by <span class="_ _23"></span>calling<span class="_ _45"> </span><span class="ff1a">sysconf<span class="_ _35"> </span></span>with <span class="_ _23"></span>the<span class="_ _35"> </span><span class="ff1b">name<span class="_ _45"> </span></span>argument <span class="_ _23"></span>set <span class="_ _9"></span>to<span class="_ _35"> </span><span class="ff1a">_SC_AIO_MAX</span>,</div><div class="t m0 x32 h26 y132 ff19 fsf fc0 sc0 ls0 ws0">and <span class="_"> </span>we <span class="_ _47"> </span>can <span class="_"> </span>get <span class="_ _66"> </span>the <span class="_ _47"> </span>value <span class="_"> </span>of<span class="_ _61"> </span><span class="ff1a">AIO_PRIO_DELTA_MAX<span class="_ _61"> </span></span>by <span class="_"> </span>calling<span class="_ _61"> </span><span class="ff1a">sysconf<span class="_ _61"> </span></span>with <span class="_ _66"> </span>its</div><div class="t m0 x32 h26 y133 ff19 fsf fc0 sc0 ls0 ws0">argument set to<span class="_"> </span><span class="ff1a">_SC_AIO_PRIO_DELTA_MAX</span>.</div><div class="t m0 x3f h2a y134 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _2"></span>POSIX <span class="_ _2"></span>asynchronous I/O <span class="_ _2"></span>interfaces <span class="_ _3"></span>wer<span class="ls79">eo<span class="_ _8"></span><span class="ls0">riginally <span class="_ _2"></span>introduced <span class="_ _2"></span>to <span class="_ _2"></span>provide real-</span></span></div><div class="t m0 x32 h2a y135 ff19 fsf fc0 sc0 ls0 ws0">time <span class="_ _3"></span>applications <span class="_ _3"></span>with <span class="_ _3"></span>a <span class="_ _3"></span>way <span class="_ _3"></span>to <span class="_ _3"></span>avoid <span class="_ _3"></span>being <span class="_ _9"></span>blocked <span class="_ _2"></span>while <span class="_ _9"></span>performing <span class="_ _3"></span>I/O <span class="_ _3"></span>operations.</div><div class="t m0 x32 h2a y136 ff19 fsf fc0 sc0 ls0 ws0">Now we’ll look at an example of how to use the interfaces.</div><div class="t m0 x35 h27 yc3a ff16 fsf fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h2a y39d8 ff19 fsf fc0 sc0 ls5f ws0">We <span class="_ _54"> </span>d<span class="_ _23"></span><span class="ls0">on’t <span class="_ _59"> </span>discuss <span class="_ _46"> </span>real-time <span class="_ _59"> </span>programming <span class="_ _59"> </span>in <span class="_ _46"> </span>this <span class="_ _46"> </span>text, <span class="_ _46"> </span>but <span class="_ _46"> </span>because <span class="_ _46"> </span>the <span class="_ _46"> </span>POSIX</span></div><div class="t m0 x32 h2a y3f48 ff19 fsf fc0 sc0 ls0 ws0">asynchronous <span class="_ _3"></span>I/O <span class="_ _9"></span>interfaces <span class="_ _9"></span>ar<span class="ls97e">en<span class="_ _b"></span><span class="ls0">ow <span class="_ _9"></span>part <span class="_ _9"></span>of <span class="_ _9"></span>the <span class="_ _9"></span>base <span class="_ _9"></span>speciﬁcation <span class="_ _9"></span>in <span class="_ _9"></span>the <span class="_ _9"></span>Single <span class="_ _9"></span>UNIX</span></span></div><div class="t m0 x32 h2a y3f49 ff19 fsf fc0 sc0 ls0 ws0">Speciﬁcation, <span class="_ _47"> </span>we’ll <span class="_ _45"> </span>look <span class="_ _45"> </span>at <span class="_ _47"> </span>how <span class="_ _45"> </span>to <span class="_ _45"> </span>use <span class="_ _47"> </span>them.<span class="_ _1a3"> </span><span class="ls5f">To <span class="_ _46"> </span>c<span class="_ _9"></span></span>ompar<span class="ls10c2">et<span class="_ _62"></span><span class="ls0">he <span class="_ _45"> </span>asynchr<span class="_ _0"></span>onous <span class="_ _47"> </span>I/O</span></span></div><div class="t m0 x32 h2a y3f4a ff19 fsf fc0 sc0 ls0 ws0">interfaces with their <span class="_ _2"></span>conventional counterparts, we’ll <span class="_ _2"></span>look at <span class="_ _2"></span>the task of <span class="_ _2"></span>translating a ﬁle</div><div class="t m0 x32 h2a y3f4b ff19 fsf fc0 sc0 ls0 ws0">from one format to another<span class="_ _6"></span>.</div><div class="t m0 x3f h2a yfd0 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _42"> </span>program <span class="_ _42"> </span>shown <span class="_ _42"> </span>in <span class="_ _53"> </span>Figur<span class="ls10c3">e1<span class="_ _c"></span><span class="ls0">4.20 <span class="_ _42"> </span>translates <span class="_ _42"> </span>a <span class="_ _53"> </span>ﬁle <span class="_ _42"> </span>using <span class="_ _53"> </span>the <span class="_ _42"> </span>ROT</span></span></div><div class="t m0 x37 h2a y3f4c ff19 fsf fc0 sc0 ls0 ws0">-</div><div class="t m0 x19e h2a yfd0 ff19 fsf fc0 sc0 ls0 ws0">13 <span class="_ _42"> </span>algorithm</div><div class="t m0 x32 h2a y965 ff19 fsf fc0 sc0 ls0 ws0">that <span class="_ _2"></span>the <span class="_ _2"></span>USENET <span class="_ _3"></span>news <span class="_ _2"></span>system, <span class="_ _3"></span>popular <span class="_ _2"></span>in <span class="_ _2"></span>the <span class="_ _3"></span>1980s, <span class="_ _2"></span>used <span class="_ _3"></span>to <span class="_ _2"></span>obscur<span class="ls7a">et<span class="_ _8"></span><span class="ls0">ext <span class="_ _3"></span>that <span class="_ _2"></span>might <span class="_ _3"></span>be</span></span></div><div class="t m0 x32 h2a y966 ff19 fsf fc0 sc0 ls0 ws0">offensive or contain <span class="_ _2"></span>spoilers <span class="_ _2"></span>or joke <span class="_ _2"></span>punchlines.<span class="_ _61"> </span>The algorithm <span class="_ _2"></span>rotates the <span class="_ _2"></span>characters <span class="_ _2"></span>’a’</div><div class="t m0 x32 h2a y967 ff19 fsf fc0 sc0 ls0 ws0">to ’z’ and ’A<span class="_ _6"></span>’<span class="_"> </span>to<span class="_"> </span>’Z’ by 13 positions, but leaves all other characters unchanged.</div><div class="t m0 x32 h4e y3f4d ff1a fs28 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h4e y3f4e ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;ctype.h&gt;</div><div class="t m0 x32 h4e y3f4f ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;fcntl.h&gt;</div><div class="t m0 x32 h4e y3f50 ff1a fs28 fc0 sc0 ls0 ws0">#define BSZ 4096</div><div class="t m0 x32 h4e y3f51 ff1a fs28 fc0 sc0 ls0 ws0">unsigned char buf[BSZ];</div><div class="t m0 x32 h4e y3f52 ff1a fs28 fc0 sc0 ls0 ws0">unsigned char</div><div class="t m0 x32 h4e y3f53 ff1a fs28 fc0 sc0 ls0 ws0">translate(unsigned char c)</div><div class="t m0 x32 h4e y3f54 ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y3f55 ff1a fs28 fc0 sc0 ls0 ws0">if (isalpha(c)) {</div><div class="t m0 x9d h4e y3f56 ff1a fs28 fc0 sc0 ls0 ws0">if (c &gt;= ’n’)</div><div class="t m0 x1f h4e y3f57 ff1a fs28 fc0 sc0 ls0 ws0">c<span class="_"> </span>-=<span class="_"> </span>13;</div><div class="t m0 x9d h4e y3f58 ff1a fs28 fc0 sc0 ls0 ws0">else if (c &gt;= ’a’)</div><div class="t m0 x1f h4e y3f59 ff1a fs28 fc0 sc0 ls0 ws0">c<span class="_"> </span>+=<span class="_"> </span>13;</div><div class="t m0 x9d h4e y3f5a ff1a fs28 fc0 sc0 ls0 ws0">else if (c &gt;= ’N’)</div><div class="t m0 x1f h4e y3f5b ff1a fs28 fc0 sc0 ls0 ws0">c<span class="_"> </span>-=<span class="_"> </span>13;</div><div class="t m0 x9d h4e y3f5c ff1a fs28 fc0 sc0 ls0 ws0">else</div><div class="t m0 x1f h4e y3f5d ff1a fs28 fc0 sc0 ls0 ws0">c<span class="_"> </span>+=<span class="_"> </span>13;</div><div class="t m0 x8a h4e y3f5e ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h4e y3f5f ff1a fs28 fc0 sc0 ls0 ws0">return(c);</div><div class="t m0 x32 h4e y3f60 ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h4e y3f61 ff1a fs28 fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h4e y3f62 ff1a fs28 fc0 sc0 ls0 ws0">main(int argc, char* argv[])</div><div class="t m0 x32 h4e y3f63 ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y3f64 ff1a fs28 fc0 sc0 ls0 ws0">int ifd, ofd, i, n, nw;</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
