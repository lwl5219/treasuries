<div id="pf9c" class="pf w4 h1f" data-page-no="9c"><div class="pc pc9c w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg9c.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">122<span class="_ _1b"> </span><span class="ff19">Files <span class="_"> </span>and <span class="_"> </span>Directories <span class="_ _18d"> </span>Chapter<span class="_ _4b"> </span>4</span></div><div class="t m0 x32 h26 y12f ff19 fsf fc0 sc0 ls0 ws0">This <span class="_ _9"></span>creates <span class="_ _9"></span>a <span class="_ _23"> </span>directory<span class="_ _45"> </span><span class="ff1a">foo<span class="_ _45"> </span></span>that <span class="_ _23"></span>contains <span class="_ _9"></span>the <span class="_ _23"> </span>ﬁle<span class="_ _45"> </span><span class="ff1a">a<span class="_ _35"> </span></span>and <span class="_ _9"></span>a <span class="_ _23"></span>symbolic <span class="_ _9"></span>link <span class="_ _23"></span>that <span class="_ _23"></span>points <span class="_ _9"></span>to</div><div class="t m0 x32 h26 y130 ff1a fsf fc0 sc0 ls0 ws0">foo<span class="ff19 ls566">.W<span class="_ _26"></span><span class="ls401">es<span class="_ _4f"></span><span class="ls0">how <span class="_ _2"></span>this <span class="_ _2"></span>arrangement in <span class="_ _2"></span>Figur<span class="ls401">e4<span class="_ _4f"></span><span class="ls0">.18, <span class="_ _2"></span>drawing a <span class="_ _2"></span>directory as <span class="_ _2"></span>a circle and <span class="_ _2"></span>a ﬁle</span></span></span></span></span></div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">as a square.</div><div class="t m0 x1ac h5e y1191 ff1a fs10 fc0 sc0 ls0 ws0">foo</div><div class="t m0 x17f h4f y1192 ff1a fs11 fc0 sc0 ls0 ws0">a</div><div class="t m0 x17b h6d y1193 ff1a fs12 fc0 sc0 ls0 ws0">testdir</div><div class="t m0 x10d h6f y1194 ff18 fs14 fc0 sc0 ls0 ws0">Figure 4.18<span class="_ _5a"> </span><span class="ff19">Symbolic link<span class="_"> </span><span class="ff1a">testdir<span class="_ _e"> </span></span>that creates a loop</span></div><div class="t m0 x32 h9b y1195 ff19 fs49 fc0 sc0 ls0 ws0">If <span class="_"> </span>we <span class="_ _e"> </span>write <span class="_"> </span>a <span class="_ _e"> </span>simple <span class="_"> </span>program <span class="_ _e"> </span>that <span class="_"> </span>uses <span class="_ _e"> </span>the <span class="_"> </span>standar<span class="_ _0"></span><span class="ls567">df<span class="_ _4a"></span><span class="ls0">unction<span class="_ _59"> </span><span class="ff1a">ftw</span></span></span></div><div class="t m0 x169 h96 y1196 ff19 fs49 fc0 sc0 ls0 ws0">(</div><div class="t m0 x11e h96 y1195 ff19 fs49 fc0 sc0 ls0 ws0">3</div><div class="t m0 x3a h96 y1196 ff19 fs49 fc0 sc0 ls0 ws0">)</div><div class="t m0 xb3 h96 y1195 ff19 fs49 fc0 sc0 ls0 ws0">on <span class="_"> </span>Solaris <span class="_ _e"> </span>to</div><div class="t m0 x32 h96 y1197 ff19 fs49 fc0 sc0 ls0 ws0">descend through a ﬁle hierar<span class="_ _0"></span>chy<span class="_ _4"></span><span class="ls48d">,p<span class="_ _d"></span><span class="ls0">rinting each pathname encountered, the output is</span></span></div><div class="t m0 x3f hc1 y1198 ff1a fs69 fc0 sc0 ls0 ws0">foo</div><div class="t m0 x3f hc1 y1199 ff1a fs69 fc0 sc0 ls0 ws0">foo/a</div><div class="t m0 x3f hc1 y119a ff1a fs69 fc0 sc0 ls0 ws0">foo/testdir</div><div class="t m0 x3f hc1 y119b ff1a fs69 fc0 sc0 ls0 ws0">foo/testdir/a</div><div class="t m0 x3f hc1 y119c ff1a fs69 fc0 sc0 ls0 ws0">foo/testdir/testdir</div><div class="t m0 x3f hc1 y119d ff1a fs69 fc0 sc0 ls0 ws0">foo/testdir/testdir/a</div><div class="t m0 x3f hc1 y119e ff1a fs69 fc0 sc0 ls0 ws0">foo/testdir/testdir/testdir</div><div class="t m0 x3f hc1 y119f ff1a fs69 fc0 sc0 ls0 ws0">foo/testdir/testdir/testdir/a</div><div class="t m0 x41 hc1 y11a0 ff19 fs69 fc0 sc0 ls0 ws0">(many mor<span class="ls568">el<span class="_ _d"></span><span class="ls0">ines until we encounter an<span class="_"> </span><span class="ff1a">ELOOP<span class="_ _80"> </span></span>error)</span></span></div><div class="t m0 x32 h9b y11a1 ff19 fs49 fc0 sc0 ls0 ws0">In <span class="_"> </span>Section <span class="_"> </span>4.22, <span class="_ _e"> </span>we <span class="_"> </span>provide <span class="_"> </span>our <span class="_ _e"> </span>own <span class="_"> </span>version <span class="_"> </span>of <span class="_"> </span>the<span class="_ _59"> </span><span class="ff1a">ftw<span class="_ _59"> </span></span>function <span class="_"> </span>that <span class="_"> </span>uses<span class="_ _59"> </span><span class="ff1a">lstat</span></div><div class="t m0 x32 h9b y11a2 ff19 fs49 fc0 sc0 ls0 ws0">instead of<span class="_"> </span><span class="ff1a">stat</span>,<span class="_"> </span>to<span class="_"> </span>p<span class="ls4a6">re</span>vent it from following symbolic links.</div><div class="t m0 x76 h6f y11a3 ff19 fs14 fc0 sc0 ls0 ws0">Note <span class="_ _80"> </span>that <span class="_ _66"> </span>on <span class="_ _66"> </span>Linux, <span class="_ _80"> </span>the<span class="_ _4b"> </span><span class="ff1a">ftw<span class="_"> </span></span>and<span class="_ _4b"> </span><span class="ff1a">nftw<span class="_"> </span></span>functions <span class="_ _e"> </span>recor<span class="ls569">da<span class="_ _55"></span><span class="ls0">ll <span class="_ _80"> </span>directories <span class="_ _66"> </span>seen <span class="_ _80"> </span>and <span class="_ _66"> </span>avoid</span></span></div><div class="t m0 x76 h31 y11a4 ff19 fs14 fc0 sc0 ls0 ws0">processing a dir<span class="_ _0"></span>ectory mor<span class="ls56a">et<span class="_ _5"></span><span class="ls0">han once, so they don’t display this behavior<span class="_ _1"></span>.</span></span></div><div class="t m0 x3f h9b y11a5 ff19 fs49 fc0 sc0 ls56b ws0">Al<span class="_ _b"></span><span class="ls0">oop <span class="_ _9"></span>of <span class="_ _23"></span>this <span class="_ _9"></span>form <span class="_ _23"></span>is <span class="_ _23"></span>easy <span class="_ _9"></span>to <span class="_ _23"></span>remove. <span class="_ _45"> </span>W<span class="_ _6"></span><span class="ls56b">ec<span class="_ _b"></span><span class="ls0">an<span class="_ _45"> </span><span class="ff1a">unlink<span class="_ _45"> </span></span>the <span class="_ _23"></span>ﬁle<span class="_ _45"> </span><span class="ff1a">foo/testdir</span><span class="ls56b">,a<span class="_ _b"></span><span class="ls0">s</span></span></span></span></span></div><div class="t m0 x32 h9b y11a6 ff1a fs49 fc0 sc0 ls0 ws0">unlink<span class="_ _47"> </span><span class="ff19">does <span class="_ _3"></span>not <span class="_ _3"></span>follow <span class="_ _3"></span>a <span class="_ _3"></span>symbolic <span class="_ _3"></span>link.<span class="_ _16"> </span>But <span class="_ _3"></span>if <span class="_ _3"></span>we <span class="_ _3"></span>create <span class="_ _2"></span>a <span class="_ _3"></span>har<span class="ls56c">dl<span class="_ _8"></span><span class="ls0">ink <span class="_ _3"></span>that <span class="_ _3"></span>forms <span class="_ _3"></span>a <span class="_ _3"></span>loop</span></span></span></div><div class="t m0 x32 h9b y11a7 ff19 fs49 fc0 sc0 ls0 ws0">of <span class="_ _3"></span>this <span class="_ _3"></span>type, <span class="_ _3"></span>its <span class="_ _3"></span>removal <span class="_ _2"></span>is <span class="_ _3"></span>much <span class="_ _3"></span>mor<span class="ls56d">ed<span class="_ _8"></span><span class="ls0">ifﬁcult. <span class="_ _66"> </span>This<span class="_ _45"> </span>is <span class="_ _2"></span>why <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">link<span class="_ _47"> </span></span>function <span class="_ _3"></span>will <span class="_ _3"></span>not</span></span></div><div class="t m0 x32 h96 y11a8 ff19 fs49 fc0 sc0 ls0 ws0">form a har<span class="ls48d">dl<span class="_ _4f"></span><span class="ls0">ink to a directory unless the process has super<span class="_ _0"></span>user privileges.</span></span></div><div class="t m0 x76 h31 y11a9 ff19 fs14 fc0 sc0 ls0 ws0">Indeed, <span class="_ _3"></span>Rich <span class="_ _9"></span>Stevens <span class="_ _3"></span>did <span class="_ _9"></span>this <span class="_ _3"></span>on <span class="_ _9"></span>his <span class="_ _3"></span>own <span class="_ _9"></span>system <span class="_ _3"></span>as <span class="_ _9"></span>an <span class="_ _3"></span>experiment <span class="_ _9"></span>while <span class="_ _3"></span>writing <span class="_ _9"></span>the <span class="_ _3"></span>original</div><div class="t m0 x76 h6f y11aa ff19 fs14 fc0 sc0 ls0 ws0">version <span class="_ _3"></span>of <span class="_ _3"></span>this <span class="_ _3"></span>section.<span class="_ _4b"> </span>The <span class="_ _3"></span>ﬁle <span class="_ _3"></span>system <span class="_ _3"></span>got <span class="_ _3"></span>corrupted <span class="_ _3"></span>and <span class="_ _3"></span>the <span class="_ _3"></span>normal<span class="_ _66"> </span><span class="ff1a">fsck</span></div><div class="t m0 x1ad h31 y11ab ff19 fs14 fc0 sc0 ls0 ws0">(</div><div class="t m0 x3b h31 y11aa ff19 fs14 fc0 sc0 ls0 ws0">1</div><div class="t m0 x1ae h31 y11ab ff19 fs14 fc0 sc0 ls0 ws0">)</div><div class="t m0 x82 h31 y11aa ff19 fs14 fc0 sc0 ls0 ws0">utility <span class="_ _3"></span>couldn’t</div><div class="t m0 x76 h6f y11ac ff19 fs14 fc0 sc0 ls0 ws0">ﬁx things.<span class="_ _44"> </span>The <span class="_ _2"></span>deprecated tools<span class="_ _80"> </span><span class="ff1a">clri</span></div><div class="t m0 x46 h31 y11ad ff19 fs14 fc0 sc0 ls0 ws0">(</div><div class="t m0 x92 h31 y11ac ff19 fs14 fc0 sc0 ls0 ws0">8</div><div class="t m0 xca h31 y11ad ff19 fs14 fc0 sc0 ls0 ws0">)</div><div class="t m0 x96 h6f y11ac ff19 fs14 fc0 sc0 ls0 ws0">and<span class="_"> </span><span class="ff1a">dcheck</span></div><div class="t m0 x1af h31 y11ad ff19 fs14 fc0 sc0 ls0 ws0">(</div><div class="t m0 x1a3 h31 y11ac ff19 fs14 fc0 sc0 ls0 ws0">8</div><div class="t m0 x47 h31 y11ad ff19 fs14 fc0 sc0 ls0 ws0">)</div><div class="t m0 x75 h31 y11ac ff19 fs14 fc0 sc0 ls0 ws0">wer<span class="ls56e">en<span class="_ _5"></span><span class="ls0">eeded to <span class="_ _2"></span>repair the <span class="_ _2"></span>ﬁle <span class="_ _2"></span>system.</span></span></div><div class="t m0 x76 h31 y11ae ff19 fs14 fc0 sc0 ls0 ws0">The <span class="_ _42"> </span>need <span class="_ _42"> </span>for <span class="_ _23"> </span>har<span class="ls56f">dl<span class="_ _b"></span><span class="ls0">inks <span class="_ _42"> </span>to <span class="_ _23"> </span>directories <span class="_ _42"> </span>has <span class="_ _42"> </span>long <span class="_ _42"> </span>since <span class="_ _42"> </span>passed.<span class="_ _61"> </span><span class="ls570">Wi<span class="_ _3"></span></span>th <span class="_ _42"> </span>symbolic <span class="_ _42"> </span>links <span class="_ _23"> </span>and <span class="_ _42"> </span>the</span></span></div><div class="t m0 x76 h6f y11af ff1a fs14 fc0 sc0 ls0 ws0">mkdir<span class="_ _53"> </span><span class="ff19">function, there<span class="_"> </span>is<span class="_"> </span>no<span class="_"> </span>longer any need for users to create har<span class="ls56a">dl<span class="_ _5"></span><span class="ls0">inks to directories.</span></span></span></div><div class="t m0 x3f h9b y11b0 ff19 fs49 fc0 sc0 ls0 ws0">When <span class="_ _42"> </span>we <span class="_ _53"> </span>open <span class="_ _53"> </span>a <span class="_ _53"> </span>ﬁle, <span class="_ _42"> </span>if <span class="_ _53"> </span>the <span class="_ _53"> </span>pathname <span class="_ _53"> </span>passed <span class="_ _42"> </span>to<span class="_ _4b"> </span><span class="ff1a">open<span class="_ _44"> </span></span>speciﬁes <span class="_ _42"> </span>a <span class="_ _53"> </span>symbolic <span class="_ _53"> </span>link,</div><div class="t m0 x32 h9b y11b1 ff1a fs49 fc0 sc0 ls0 ws0">open<span class="_ _35"> </span><span class="ff19">follows <span class="_ _42"> </span>the <span class="_ _23"> </span>link <span class="_ _42"> </span>to <span class="_ _23"> </span>the <span class="_ _42"> </span>speciﬁed <span class="_ _23"> </span>ﬁle.<span class="_ _54"> </span>If <span class="_ _23"> </span>the <span class="_ _42"> </span>ﬁle <span class="_ _23"> </span>pointed <span class="_ _42"> </span>to <span class="_ _23"> </span>by <span class="_ _42"> </span>the <span class="_ _23"> </span>symbolic <span class="_ _42"> </span>link</span></div><div class="t m0 x32 h9b y11b2 ff19 fs49 fc0 sc0 ls0 ws0">doesn’t <span class="_ _2"></span>exist,<span class="_ _47"> </span><span class="ff1a">open<span class="_ _47"> </span></span><span class="ls4a6">re</span>turns <span class="_ _3"></span>an <span class="_ _3"></span>error <span class="_ _2"></span>saying <span class="_ _2"></span>that <span class="_ _3"></span>it <span class="_ _3"></span>can’t <span class="_ _2"></span>open <span class="_ _3"></span>the <span class="_ _2"></span>ﬁle.<span class="_ _16"> </span>This <span class="_ _3"></span>response <span class="_ _2"></span>can</div><div class="t m0 x32 h96 y11b3 ff19 fs49 fc0 sc0 ls0 ws0">confuse users who aren’t familiar with symbolic links.<span class="_ _59"> </span>For example,</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
