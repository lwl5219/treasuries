<div id="pf13d" class="pf w4 h1f" data-page-no="13d"><div class="pc pc13d w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg13d.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Chapter <span class="_"> </span>8<span class="_ _1c8"> </span>Exercises<span class="_ _1fb"> </span><span class="ff18">283</span></div><div class="t m0 x32 h26 y12f ff1a fsf fc0 sc0 ls0 ws0">exec<span class="_ _61"> </span><span class="ff19">functions: <span class="_ _45"> </span>interpr<span class="_ _0"></span>eter <span class="_ _47"> </span>ﬁles <span class="_ _47"> </span>and <span class="_ _47"> </span>how <span class="_ _47"> </span>they <span class="_ _47"> </span>operate.<span class="_ _5f"> </span>An <span class="_ _45"> </span>understanding <span class="_ _66"> </span>of <span class="_ _45"> </span>the</span></div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">various <span class="_ _47"> </span>user <span class="_ _66"> </span>IDs <span class="_ _47"> </span>and <span class="_ _47"> </span>group <span class="_ _66"> </span>IDs <span class="_ _47"> </span>that <span class="_ _47"> </span>ar<span class="lsaaf">ep<span class="_ _1d"></span><span class="ls45">ro<span class="ls0">vided <span class="_ _4"></span>— <span class="_ _84"></span>real, <span class="_ _47"> </span>effective, <span class="_"> </span>and <span class="_ _47"> </span>saved<span class="_ _9"></span><span class="ls9d">—i<span class="_ _1"></span><span class="ls0">s</span></span></span></span></span></div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">critical to writing safe set-user-ID pr<span class="_ _0"></span>ograms.</div><div class="t m0 x3f h2a y132 ff19 fsf fc0 sc0 ls0 ws0">Given <span class="_ _2"></span>an <span class="_ _3"></span>understanding <span class="_ _3"></span>of <span class="_ _3"></span>a <span class="_ _2"></span>single <span class="_ _3"></span>process <span class="_ _2"></span>and <span class="_ _3"></span>its <span class="_ _3"></span>children, <span class="_ _2"></span>in <span class="_ _3"></span>the <span class="_ _3"></span>next <span class="_ _2"></span>chapter <span class="_ _3"></span>we</div><div class="t m0 x32 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">examine <span class="_ _3"></span>the <span class="_ _3"></span>relationship <span class="_ _3"></span>of <span class="_ _3"></span>a <span class="_ _3"></span>process <span class="_ _3"></span>to <span class="_ _3"></span>other <span class="_ _9"></span>processes <span class="_ _84"></span>— <span class="_ _4"></span>sessions<span class="_ _47"> </span>and <span class="_ _3"></span>job <span class="_ _3"></span>control. <span class="_ _47"> </span>W<span class="_ _6"></span>e</div><div class="t m0 x32 h2a y134 ff19 fsf fc0 sc0 ls0 ws0">then complete our discussion of processes in Chapter 10 when we describe signals.</div><div class="t m0 x32 h53 y2501 ff16 fs2b fc0 sc0 ls0 ws0">Exer<span class="_ _0"></span>cises</div><div class="t m0 x32 h57 y2502 ff18 fs2d fc0 sc0 ls0 ws0">8.1<span class="_ _6e"> </span><span class="ff19">In <span class="_ _9"></span>Figur<span class="lsab0">e8<span class="_ _8"></span><span class="ls0">.3, <span class="_ _3"></span>we <span class="_ _9"></span>said <span class="_ _3"></span>that <span class="_ _9"></span>replacing <span class="_ _3"></span>the <span class="_ _3"></span>call <span class="_ _9"></span>to<span class="_ _47"> </span><span class="ff1a">_exit<span class="_ _47"> </span></span>with <span class="_ _3"></span>a <span class="_ _3"></span>call <span class="_ _9"></span>to<span class="_ _47"> </span><span class="ff1a">exit<span class="_ _47"> </span></span>might <span class="_ _3"></span>cause <span class="_ _9"></span>the</span></span></span></div><div class="t m0 x90 h57 y2503 ff19 fs2d fc0 sc0 ls0 ws0">standar<span class="lsab1">do<span class="_ _55"></span><span class="ls0">utput <span class="_"> </span>to <span class="_"> </span>be <span class="_ _53"> </span>closed <span class="_"> </span>and<span class="_ _44"> </span><span class="ff1a">printf<span class="_ _44"> </span></span>to <span class="_"> </span>return<span class="_ _44"> </span><span class="ff20">−</span>1. <span class="_ _44"> </span>Modify<span class="_ _4b"> </span>the <span class="_"> </span>pr<span class="_ _0"></span>ogram <span class="_"> </span>to <span class="_ _53"> </span>check</span></span></div><div class="t m0 x90 h5f y2504 ff19 fs2d fc0 sc0 ls0 ws0">whether <span class="_ _9"></span>your <span class="_ _3"></span>implementation <span class="_ _9"></span>behaves <span class="_ _9"></span>this <span class="_ _9"></span>way<span class="_ _6"></span><span class="lsab2">.I<span class="_ _5b"></span><span class="ls0">f<span class="_ _47"> </span>it<span class="_ _47"> </span>does <span class="_ _9"></span>not, <span class="_ _9"></span>how <span class="_ _9"></span>can <span class="_ _9"></span>you <span class="_ _9"></span>simulate <span class="_ _9"></span>this</span></span></div><div class="t m0 x90 h5f y2505 ff19 fs2d fc0 sc0 ls0 ws0">behavior?</div><div class="t m0 x32 h5f y2506 ff18 fs2d fc0 sc0 ls0 ws0">8.2<span class="_ _6e"> </span><span class="ff19">Recall <span class="_ _35"> </span>the <span class="_ _45"> </span>typical <span class="_ _45"> </span>arrangement <span class="_ _45"> </span>of <span class="_ _35"> </span>memory <span class="_ _45"> </span>in <span class="_ _45"> </span>Figur<span class="lsab3">e7<span class="_ _62"></span><span class="ls0">.6. <span class="_ _5a"> </span>Because<span class="_ _16"> </span>the <span class="_ _35"> </span>stack <span class="_ _45"> </span>frames</span></span></span></div><div class="t m0 x90 h5f y2507 ff19 fs2d fc0 sc0 ls0 ws0">corresponding <span class="_ _42"> </span>to <span class="_ _53"> </span>each <span class="_ _53"> </span>function <span class="_ _53"> </span>call <span class="_ _53"> </span>ar<span class="lsab4">eu<span class="_ _43"></span><span class="ls0">sually <span class="_ _42"> </span>stored <span class="_ _53"> </span>in <span class="_ _53"> </span>the <span class="_ _53"> </span>stack, <span class="_ _53"> </span>and <span class="_ _53"> </span>because <span class="_ _53"> </span>after <span class="_ _53"> </span>a</span></span></div><div class="t m0 x90 h57 y2508 ff1a fs2d fc0 sc0 ls0 ws0">vfork<span class="_ _66"> </span><span class="ff19">the <span class="_ _3"></span>child <span class="_ _3"></span>runs <span class="_ _2"></span>in <span class="_ _3"></span>the <span class="_ _3"></span>address <span class="_ _2"></span>space <span class="_ _3"></span>of <span class="_ _3"></span>the <span class="_ _3"></span>parent, <span class="_ _3"></span>what <span class="_ _2"></span>happens <span class="_ _3"></span>if <span class="_ _3"></span>the <span class="_ _3"></span>call <span class="_ _3"></span>to<span class="_ _66"> </span></span>vfork</div><div class="t m0 x90 h57 y2509 ff19 fs2d fc0 sc0 ls0 ws0">is <span class="_ _3"></span>from <span class="_ _3"></span>a <span class="_ _3"></span>function <span class="_ _3"></span>other <span class="_ _9"></span>than<span class="_ _47"> </span><span class="ff1a">main<span class="_ _66"> </span></span>and <span class="_ _9"></span>the <span class="_ _3"></span>child <span class="_ _3"></span>does <span class="_ _9"></span>a <span class="_ _3"></span>return <span class="_ _3"></span>from <span class="_ _2"></span>this <span class="_ _9"></span>function <span class="_ _3"></span>after <span class="_ _3"></span>the</div><div class="t m0 x90 h57 y250a ff1a fs2d fc0 sc0 ls0 ws0">vfork<span class="ff19 ls614">?W<span class="_ _5b"></span><span class="ls0">rite a test program to verify this, and draw a picture<span class="_"> </span>of<span class="_"> </span>what’s happening.</span></span></div><div class="t m0 x32 h57 y250b ff18 fs2d fc0 sc0 ls0 ws0">8.3<span class="_ _6e"> </span><span class="ff19">Rewrite <span class="_"> </span>the <span class="_"> </span>program <span class="_"> </span>in <span class="_"> </span>Figur<span class="lsab5">e8<span class="_ _4a"></span><span class="ls0">.6 <span class="_"> </span>to <span class="_"> </span>use<span class="_ _4b"> </span><span class="ff1a">waitid<span class="_ _4b"> </span></span>instead <span class="_"> </span>of<span class="_ _4b"> </span><span class="ff1a">wait</span><span class="lsab6">.I<span class="_ _52"></span><span class="ls0">nstead <span class="_"> </span>of <span class="_"> </span>calling</span></span></span></span></span></div><div class="t m0 x90 h57 y250c ff1a fs2d fc0 sc0 ls0 ws0">pr_exit<span class="ff19 ls110">,d<span class="_ _5"></span><span class="ls0">etermine the equivalent information from the<span class="_"> </span><span class="ff1a">siginfo<span class="_ _e"> </span></span>structure.</span></span></div><div class="t m0 x32 h5f y250d ff18 fs2d fc0 sc0 ls0 ws0">8.4<span class="_ _6e"> </span><span class="ff19">When we execute the program in Figur<span class="ls110">e8<span class="_ _d"></span><span class="ls0">.13 one time, as in</span></span></span></div><div class="t m0 x138 h57 y250e ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">./a.out</span></div><div class="t m0 x90 h5f y250f ff19 fs2d fc0 sc0 ls0 ws0">the <span class="_ _42"> </span>output <span class="_ _42"> </span>is <span class="_ _53"> </span>correct. <span class="_ _35"> </span>But<span class="_ _35"> </span>if <span class="_ _42"> </span>we <span class="_ _42"> </span>execute <span class="_ _53"> </span>the <span class="_ _42"> </span>program <span class="_ _42"> </span>multiple <span class="_ _42"> </span>times, <span class="_ _42"> </span>one <span class="_ _53"> </span>right <span class="_ _42"> </span>after <span class="_ _42"> </span>the</div><div class="t m0 x90 h5f y2510 ff19 fs2d fc0 sc0 ls0 ws0">other<span class="_ _1"></span>,<span class="_"> </span>as<span class="_"> </span>in</div><div class="t m0 x138 h57 y2511 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">./a.out ; ./a.out ; ./a.out</span></div><div class="t m0 x138 h57 y2512 ff1a fs2d fc0 sc0 ls0 ws0">output from parent</div><div class="t m0 x138 h57 y2513 ff1a fs2d fc0 sc0 ls0 ws0">ooutput from parent</div><div class="t m0 x138 h57 y2514 ff1a fs2d fc0 sc0 ls0 ws0">ouotuptut from child</div><div class="t m0 x138 h57 y2515 ff1a fs2d fc0 sc0 ls0 ws0">put from parent</div><div class="t m0 x138 h57 y2516 ff1a fs2d fc0 sc0 ls0 ws0">output from child</div><div class="t m0 x138 h57 y2517 ff1a fs2d fc0 sc0 ls0 ws0">utput from child</div><div class="t m0 x90 h5f y2518 ff19 fs2d fc0 sc0 ls0 ws0">the <span class="_ _3"></span>output <span class="_ _9"></span>is <span class="_ _3"></span>not <span class="_ _9"></span>correct. <span class="_ _66"> </span>What’s<span class="_ _47"> </span>happening? <span class="_ _47"> </span>How<span class="_ _47"> </span>can <span class="_ _3"></span>we <span class="_ _3"></span>correct <span class="_ _3"></span>this?<span class="_ _61"> </span>Can <span class="_ _9"></span>this <span class="_ _3"></span>problem</div><div class="t m0 x90 h5f y2519 ff19 fs2d fc0 sc0 ls0 ws0">happen if we let the child write its output ﬁrst?</div><div class="t m0 x32 h57 y251a ff18 fs2d fc0 sc0 ls0 ws0">8.5<span class="_ _6e"> </span><span class="ff19">In <span class="_ _66"> </span>the <span class="_ _66"> </span>program <span class="_ _66"> </span>shown <span class="_ _66"> </span>in <span class="_ _66"> </span>Figur<span class="lsab7">e8<span class="_ _5b"></span><span class="ls0">.20, <span class="_ _66"> </span>we <span class="_ _66"> </span>call<span class="_ _46"> </span><span class="ff1a">execl</span><span class="lsab8">,s<span class="_ _4a"></span><span class="ls0">pecifying <span class="_ _66"> </span>the<span class="_ _46"> </span><span class="ff1b">pathname<span class="_ _59"> </span></span>of <span class="_ _66"> </span>the</span></span></span></span></span></div><div class="t m0 x90 h57 y251b ff19 fs2d fc0 sc0 ls0 ws0">interpreter <span class="_ _3"></span>ﬁle.<span class="_ _16"> </span>If <span class="_ _9"></span>we <span class="_ _23"> </span>called<span class="_ _47"> </span><span class="ff1a">execlp<span class="_ _45"> </span></span>instead, <span class="_ _9"></span>specifying <span class="_ _9"></span>a<span class="_ _45"> </span><span class="ff1b">ﬁlename<span class="_ _47"> </span></span>of<span class="_ _45"> </span><span class="ff1a">testinterp</span><span class="lsab9">,a<span class="_ _b"></span><span class="ls0">nd <span class="_ _9"></span>if</span></span></div><div class="t m0 x90 h57 y251c ff19 fs2d fc0 sc0 ls0 ws0">the directory<span class="_"> </span><span class="ff1a">/home/sar/bin<span class="_ _80"> </span></span>was a path <span class="_ _2"></span>preﬁx, what would be printed <span class="_ _2"></span>as<span class="_"> </span><span class="ff1a">argv[2]<span class="_ _80"> </span></span>when</div><div class="t m0 x90 h5f y251d ff19 fs2d fc0 sc0 ls0 ws0">the program is run?</div><div class="t m0 x32 h57 y251e ff18 fs2d fc0 sc0 ls0 ws0">8.6<span class="_ _6e"> </span><span class="ff19 ls467">Wr<span class="_ _9"></span><span class="ls0">ite a <span class="_ _2"></span>program that creates a <span class="_ _2"></span>zombie, and <span class="_ _2"></span>then <span class="_ _2"></span>call<span class="_"> </span><span class="ff1a">system<span class="_ _80"> </span></span>to <span class="_ _2"></span>execute the<span class="_ _66"> </span><span class="ff1a">ps</span></span></span></div><div class="t m0 x204 h5f y251f ff19 fs2d fc0 sc0 ls0 ws0">(</div><div class="t m0 x4d h5f y251e ff19 fs2d fc0 sc0 ls0 ws0">1</div><div class="t m0 xd5 h5f y251f ff19 fs2d fc0 sc0 ls0 ws0">)</div><div class="t m0 x6f h5f y251e ff19 fs2d fc0 sc0 ls0 ws0">command</div><div class="t m0 x90 h5f y2520 ff19 fs2d fc0 sc0 ls0 ws0">to verify that the process is a zombie.</div><div class="t m0 x32 h5f y2521 ff18 fs2d fc0 sc0 ls0 ws0">8.7<span class="_ _6e"> </span><span class="ff19 ls32e">We <span class="_ _45"> </span>m<span class="_ _3"></span><span class="ls0">entioned <span class="_ _42"> </span>in <span class="_ _42"> </span>Section <span class="_ _42"> </span>8.10 <span class="_ _42"> </span>that <span class="_ _42"> </span>POSIX.1 <span class="_ _42"> </span>requir<span class="_ _0"></span>es <span class="_ _23"> </span>open <span class="_ _42"> </span>directory <span class="_ _42"> </span>streams <span class="_ _23"> </span>to <span class="_ _42"> </span>be <span class="_ _42"> </span>closed</span></span></div><div class="t m0 x90 h57 y2522 ff19 fs2d fc0 sc0 ls0 ws0">across <span class="_ _23"> </span>an<span class="_ _45"> </span><span class="ff1a">exec</span><span class="lsaba">.V<span class="_ _52"></span><span class="ls0">erify <span class="_ _23"> </span>this <span class="_ _23"> </span>as <span class="_ _42"> </span>follows: <span class="_ _23"> </span>call<span class="_ _45"> </span><span class="ff1a">opendir<span class="_ _35"> </span></span>for <span class="_ _23"> </span>the <span class="_ _23"> </span>root <span class="_ _23"> </span>directory<span class="_ _4"></span><span class="lsabb">,p<span class="_ _b"></span><span class="ls0">eek <span class="_ _23"> </span>at <span class="_ _42"> </span>your</span></span></span></span></div><div class="t m0 x90 h57 y2523 ff19 fs2d fc0 sc0 ls0 ws0">system’s <span class="_ _2"></span>implementation <span class="_ _3"></span>of <span class="_ _3"></span>the<span class="_ _66"> </span><span class="ff1a">DIR<span class="_ _66"> </span></span>structure, <span class="_ _2"></span>and <span class="_ _3"></span>print <span class="_ _2"></span>the <span class="_ _3"></span>close-on-exec <span class="_ _3"></span>ﬂag.<span class="_ _59"> </span>Then<span class="_ _47"> </span><span class="ff1a">open</span></div><div class="t m0 x90 h5f y2524 ff19 fs2d fc0 sc0 ls0 ws0">the same directory for r<span class="_ _0"></span>eading, and print the close-on-exec ﬂag.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
