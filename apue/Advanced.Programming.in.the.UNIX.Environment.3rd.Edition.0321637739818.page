<div id="pf332" class="pf w4 h1f" data-page-no="332"><div class="pc pc332 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg332.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">784<span class="_ _1b"> </span><span class="ff19 ls30a">AD<span class="_ _55"></span><span class="ls0">atabase <span class="_"> </span>Library<span class="_ _245"> </span>Chapter <span class="_"> </span>20</span></span></div><div class="t m0 x3f h2a y12f ff19 fsf fc0 sc0 ls0 ws0">The next test <span class="_ _2"></span>was to try <span class="_ _2"></span>the no-locking <span class="_ _2"></span>program with multiple children. <span class="_"> </span>The<span class="_"> </span><span class="ls45">re<span class="_ _2"></span></span>sults,</div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">as <span class="_ _23"> </span>expected, <span class="_ _23"> </span>wer<span class="ls86a">er<span class="_ _43"></span><span class="ls0">andom <span class="_ _23"> </span>errors. <span class="_ _35"> </span>Normally<span class="_ _4"></span><span class="ls71b">,r<span class="_ _43"></span><span class="ls0">ecords <span class="_ _23"></span>that <span class="_ _23"> </span>wer<span class="ls71b">ea<span class="_ _43"></span><span class="ls0">dded <span class="_ _23"> </span>to <span class="_ _23"> </span>the <span class="_ _23"> </span>database</span></span></span></span></span></span></div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">couldn’t <span class="_ _9"></span>be <span class="_ _9"></span>found, <span class="_ _9"></span>and <span class="_ _9"></span>the <span class="_ _9"></span>test <span class="_ _9"></span>program <span class="_ _9"></span>aborted.<span class="_ _5a"> </span>Differ<span class="_ _0"></span>ent <span class="_ _3"></span>errors <span class="_ _9"></span>occurred <span class="_ _3"></span>every <span class="_ _23"></span>time</div><div class="t m0 x32 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _23"> </span>test <span class="_ _23"> </span>program <span class="_ _23"> </span>was <span class="_ _23"> </span>run. <span class="_ _35"> </span>This<span class="_ _35"> </span>illustrates <span class="_ _23"> </span>a <span class="_ _23"> </span>classic <span class="_ _42"> </span>race <span class="_ _23"></span>condition: <span class="_ _23"> </span>multiple <span class="_ _23"> </span>processes</div><div class="t m0 x32 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">updating the same ﬁle without using any form of locking.</div><div class="t m0 x35 h27 y498 ff16 fsf fc0 sc0 ls0 ws0">Multiple-Process Results</div><div class="t m0 x32 h2a y5896 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _23"></span>ﬁnal <span class="_ _23"></span>set <span class="_ _23"></span>of <span class="_ _9"></span>measurements <span class="_ _23"></span>looks <span class="_ _23"></span>mainly <span class="_ _23"></span>at <span class="_ _23"></span>the <span class="_ _23"></span>differ<span class="_ _1"></span>ences <span class="_ _23"> </span>between <span class="_ _23"> </span>coarse-grained</div><div class="t m0 x32 h2a y5897 ff19 fsf fc0 sc0 ls0 ws0">locking <span class="_ _2"></span>and <span class="_ _3"></span>ﬁne-grained <span class="_ _2"></span>locking.<span class="_ _16"> </span>As <span class="_ _2"></span>we <span class="_ _3"></span>said <span class="_ _2"></span>earlier<span class="_ _1"></span><span class="ls1c8">,i<span class="_ _4f"></span><span class="ls0">ntuitively<span class="_ _4"></span>,<span class="_ _47"> </span>we<span class="_ _47"> </span>expect <span class="_ _2"></span>ﬁne-grained</span></span></div><div class="t m0 x32 h2a ye9d ff19 fsf fc0 sc0 ls0 ws0">locking <span class="_ _23"></span>to <span class="_ _23"></span>provide <span class="_ _9"></span>additional <span class="_ _23"></span>concurrency<span class="_ _4"></span><span class="ls16e1">,s<span class="_ _b"></span><span class="ls0">ince <span class="_ _9"></span>there<span class="_ _45"> </span>is<span class="_ _35"> </span>less <span class="_ _23"></span>time <span class="_ _23"></span>that <span class="_ _23"></span>portions <span class="_ _23"></span>of <span class="_ _23"></span>the</span></span></div><div class="t m0 x32 h2b ye9e ff19 fsf fc0 sc0 ls0 ws0">database <span class="_ _9"></span>ar<span class="ls16e2">el<span class="_ _b"></span><span class="ls0">ocked <span class="_ _9"></span>from <span class="_ _9"></span>other <span class="_ _23"></span>processes. <span class="_ _45"> </span>Figur<span class="lsb7d">e2<span class="_ _43"></span><span class="ls0">0.8 <span class="_ _23"></span>shows <span class="_ _9"></span>the <span class="_ _23"></span>results <span class="_ _9"></span>for <span class="_ _23"></span>an<span class="_ _45"> </span><span class="ff1b">nrec<span class="_ _45"> </span></span>of</span></span></span></span></div><div class="t m0 x32 h2a ye9f ff19 fsf fc0 sc0 ls0 ws0">2,000, varying the number of children fr<span class="_ _0"></span>om 1 to 16.</div><div class="t m0 x6b h2d y4465 ff19 fs10 fc0 sc0 ls0 ws0">Advisory locking<span class="_ _3e"> </span>Mandatory locking</div><div class="t m0 x9d h2e y5898 ff19 fs11 fc0 sc0 ls0 ws0">Coarse-grained locking<span class="_ _68"> </span>Fine-grained locking<span class="_ _6e"> </span><span class="ff20">Δ<span class="_ _e"> </span></span>Clock <span class="_ _5e"> </span>Fine-grained<span class="_"> </span>locking<span class="_ _87"> </span><span class="ff20">Δ<span class="_ _e"> </span></span>Sys</div><div class="t m0 x1c h2f y706 ff19 fs12 fc0 sc0 ls0 ws0">User <span class="_ _2b"> </span>Sys<span class="_ _179"> </span>Clock <span class="_ _3a"> </span>User<span class="_ _75"> </span>Sys <span class="_ _41"> </span>Clock<span class="_ _50"> </span>Percent <span class="_ _50"> </span>User<span class="_ _75"> </span>Sys <span class="_ _41"> </span>Clock<span class="_ _50"> </span>Percent</div><div class="t m0 x1f0 h2f y5899 ff19 fs12 fc0 sc0 ls38a ws0">#P<span class="_ _84"></span><span class="ls222">ro<span class="ls0">c</span></span></div><div class="t m0 x219 h30 y589a ff19 fs13 fc0 sc0 ls16e3 ws0">10<span class="_ _19"></span><span class="ls0">.14 <span class="_ _1c5"> </span>0.35<span class="_ _1c3"> </span>0.50 <span class="_ _179"> </span>0.14<span class="_ _72"> </span>0.35 <span class="_ _41"> </span>0.50<span class="_ _129"> </span><span class="ls16e4">00<span class="_ _1ba"></span><span class="ls0">.15 <span class="_ _9c"> </span>0.42<span class="_ _179"> </span>0.58 <span class="_ _87"> </span>20</span></span></span></div><div class="t m0 x219 h30 y589b ff19 fs13 fc0 sc0 ls16e3 ws0">20<span class="_ _19"></span><span class="ls0">.60 <span class="_ _1c5"> </span>1.43<span class="_ _1c3"> </span>1.88 <span class="_ _179"> </span>0.54<span class="_ _72"> </span>1.36 <span class="_ _41"> </span>1.10<span class="_ _2b9"> </span>71 <span class="_ _13"> </span>0.65<span class="_ _72"> </span>2.01 <span class="_ _41"> </span>1.59<span class="_ _2b9"> </span>48</span></div><div class="t m0 x219 h30 y589c ff19 fs13 fc0 sc0 ls16e3 ws0">30<span class="_ _19"></span><span class="ls0">.97 <span class="_ _1c5"> </span>2.67<span class="_ _1c3"> </span>3.18 <span class="_ _179"> </span>1.37<span class="_ _72"> </span>3.73 <span class="_ _41"> </span>2.20<span class="_ _2b9"> </span>45 <span class="_ _13"> </span>1.62<span class="_ _72"> </span>5.67 <span class="_ _41"> </span>3.28<span class="_ _2b9"> </span>52</span></div><div class="t m0 x219 h30 y589d ff19 fs13 fc0 sc0 ls16e3 ws0">42<span class="_ _19"></span><span class="ls0">.38 <span class="_ _1c5"> </span>6.17<span class="_ _1c3"> </span>5.59 <span class="_ _179"> </span>2.83<span class="_ _72"> </span>8.15 <span class="_ _41"> </span>4.07<span class="_ _2b9"> </span>37 <span class="_ _13"> </span>3.29<span class="_ _1c3"> </span>12.35 <span class="_ _210"> </span>6.31<span class="_ _2b9"> </span>52</span></div><div class="t m0 x219 h30 y589e ff19 fs13 fc0 sc0 ls16e3 ws0">53<span class="_ _19"></span><span class="ls0">.72 <span class="_ _41"> </span>10.17 <span class="_ _41"> </span>8.37<span class="_ _9c"> </span>4.28 <span class="_ _9b"> </span>1<span class="_ _1"></span>1.86 <span class="_ _41"> </span>6.09<span class="_ _2b9"> </span>37 <span class="_ _13"> </span>4.96<span class="_ _1c3"> </span>18.47 <span class="_ _210"> </span>9.49<span class="_ _2b9"> </span>56</span></div><div class="t m0 x219 h30 y589f ff19 fs13 fc0 sc0 ls16e3 ws0">65<span class="_ _19"></span><span class="ls0">.02 <span class="_ _41"> </span>14.52<span class="_ _288"> </span><span class="ls10d4">11<span class="_ _3"></span></span>.52 <span class="_ _179"> </span>6.04<span class="_ _1c3"> </span>17.46 <span class="_ _41"> </span>8.89<span class="_ _1b"> </span>30 <span class="_ _13"> </span>6.66<span class="_ _1c3"> </span>26.38 <span class="_ _98"> </span>13.22<span class="_ _2b9"> </span>51</span></div><div class="t m0 x219 h30 y58a0 ff19 fs13 fc0 sc0 ls16e3 ws0">77<span class="_ _19"></span><span class="ls0">.00 <span class="_ _41"> </span>20.16<span class="_ _141"> </span>15.84 <span class="_ _179"> </span>8.06<span class="_ _1c3"> </span>23.23 <span class="_ _7f"> </span>1<span class="_ _1"></span>1.88 <span class="_ _87"> </span>33<span class="_ _129"> </span>9.12 <span class="_ _210"> </span>36.13<span class="_ _141"> </span>18.09 <span class="_ _87"> </span>56</span></div><div class="t m0 x219 h30 y14d3 ff19 fs13 fc0 sc0 ls16e3 ws0">89<span class="_ _19"></span><span class="ls0">.12 <span class="_ _41"> </span>26.20<span class="_ _141"> </span>20.31 <span class="_ _141"> </span>10.50<span class="_ _179"> </span>30.50 <span class="_ _93"> </span>15.48<span class="_ _2b9"> </span>31 <span class="_ _75"> </span>1<span class="_ _1"></span>1.81 <span class="_ _41"> </span>47.20<span class="_ _141"> </span>23.49 <span class="_ _87"> </span>55</span></div><div class="t m0 x219 h30 y58a1 ff19 fs13 fc0 sc0 ls16e5 ws0">91<span class="_ _318"></span><span class="ls0">1.60 <span class="_ _41"> </span>33.91<span class="_ _141"> </span>25.64 <span class="_ _141"> </span>13.40<span class="_ _179"> </span>37.80 <span class="_ _93"> </span>19.29<span class="_ _2b9"> </span>33 <span class="_ _87"> </span>14.54<span class="_ _179"> </span>60.23 <span class="_ _93"> </span>29.66<span class="_ _2b9"> </span>59</span></div><div class="t m0 xf7 h30 y46d1 ff19 fs13 fc0 sc0 ls0 ws0">10 <span class="_ _1c3"> </span>14.28<span class="_ _179"> </span>42.24 <span class="_ _93"> </span>31.35<span class="_ _41"> </span>16.39 <span class="_ _41"> </span>47.01<span class="_ _141"> </span>23.74 <span class="_ _87"> </span>32 <span class="_ _68"> </span>17.84<span class="_ _1c3"> </span>74.05 <span class="_ _98"> </span>36.27<span class="_ _2b9"> </span>58</div><div class="t m0 xf7 h30 y58a2 ff19 fs13 fc0 sc0 ls10d4 ws0">11 <span class="_ _87"> </span>1<span class="_ _2"></span><span class="ls0">7.37 <span class="_ _41"> </span>51.12<span class="_ _141"> </span>37.50 <span class="_ _141"> </span>19.71<span class="_ _179"> </span>56.59 <span class="_ _93"> </span>28.57<span class="_ _2b9"> </span>31 <span class="_ _87"> </span>21.57<span class="_ _179"> </span>90.14 <span class="_ _93"> </span>44.10<span class="_ _2b9"> </span>59</span></div><div class="t m0 xf7 h30 y58a3 ff19 fs13 fc0 sc0 ls0 ws0">12 <span class="_ _1c3"> </span>20.70<span class="_ _179"> </span>60.48 <span class="_ _93"> </span>44.24<span class="_ _41"> </span>23.47 <span class="_ _41"> </span>66.10<span class="_ _141"> </span>33.34 <span class="_ _87"> </span>33 <span class="_ _68"> </span>25.57<span class="_ _141"> </span>108.94 <span class="_ _93"> </span>53.1<span class="_ _1"></span><span class="ls16e6">16<span class="_ _318"></span><span class="ls0">5</span></span></div><div class="t m0 xf7 h30 y58a4 ff19 fs13 fc0 sc0 ls0 ws0">13 <span class="_ _1c3"> </span>25.13<span class="_ _179"> </span>70.67 <span class="_ _93"> </span>51.96<span class="_ _41"> </span>27.70 <span class="_ _41"> </span>77.76<span class="_ _141"> </span>39.21 <span class="_ _87"> </span>33 <span class="_ _68"> </span>29.71<span class="_ _141"> </span>133.31 <span class="_ _93"> </span>63.07<span class="_ _2b9"> </span>71</div><div class="t m0 xf7 h30 y58a5 ff19 fs13 fc0 sc0 ls0 ws0">14 <span class="_ _1c3"> </span>28.40<span class="_ _179"> </span>82.23 <span class="_ _93"> </span>59.88<span class="_ _41"> </span>32.34 <span class="_ _41"> </span>91.45<span class="_ _141"> </span>46.22 <span class="_ _87"> </span>30 <span class="_ _68"> </span>34.22<span class="_ _141"> </span>155.80 <span class="_ _93"> </span>73.86<span class="_ _2b9"> </span>70</div><div class="t m0 xf7 h30 y58a6 ff19 fs13 fc0 sc0 ls0 ws0">15 <span class="_ _1c3"> </span>32.23<span class="_ _179"> </span>94.26 <span class="_ _93"> </span>68.30<span class="_ _41"> </span>36.32 <span class="_ _93"> </span>102.97 <span class="_ _93"> </span>51.82<span class="_ _1b"> </span>32 <span class="_ _87"> </span>39.05<span class="_ _141"> </span>180.66 <span class="_ _93"> </span>84.14<span class="_ _1b"> </span>75</div><div class="t m0 xf7 h30 y9bc ff19 fs13 fc0 sc0 ls0 ws0">16 <span class="_ _1c3"> </span>37.24<span class="_ _141"> </span>107.87 <span class="_ _98"> </span>78.67<span class="_ _41"> </span>42.17 <span class="_ _7f"> </span>118.20 <span class="_ _98"> </span>59.72<span class="_ _2b9"> </span>32 <span class="_ _87"> </span>44.1<span class="_ _1"></span><span class="ls16e7">12<span class="_ _319"></span><span class="ls0">08.28 <span class="_ _93"> </span>96.82<span class="_ _1b"> </span>76</span></span></div><div class="t m0 xdf hd2 y58a7 ff18 fs14 fc0 sc0 ls0 ws0">Figure 20.8<span class="_ _5a"> </span><span class="ff19">Comparison of various locking techniques,<span class="_"> </span><span class="ff1b">nrec<span class="_"> </span></span><span class="ls56a">=2<span class="_ _84"></span><span class="ls0">,000</span></span></span></div><div class="t m0 x32 h96 y58a8 ff19 fs49 fc0 sc0 ls0 ws0">All <span class="_ _9"></span>times <span class="_ _9"></span>are<span class="_ _47"> </span>in<span class="_ _45"> </span>seconds <span class="_ _9"></span>and <span class="_ _9"></span>ar<span class="ls16e8">et<span class="_ _b"></span><span class="ls0">he <span class="_ _9"></span>total <span class="_ _9"></span>for <span class="_ _9"></span>the <span class="_ _9"></span>parent <span class="_ _3"></span>and <span class="_ _9"></span>all <span class="_ _23"></span>its <span class="_ _3"></span>children. <span class="_ _45"> </span>Ther<span class="ls16e9">ea<span class="_ _b"></span><span class="ls4a6">re</span></span></span></span></div><div class="t m0 x32 h96 y58a9 ff19 fs49 fc0 sc0 ls0 ws0">many items to consider from this data.</div><div class="t m0 x3f h96 y58aa ff19 fs49 fc0 sc0 ls0 ws0">The <span class="_ _23"></span>ﬁrst <span class="_ _23"> </span>thing <span class="_ _23"> </span>to <span class="_ _23"> </span>notice <span class="_ _23"> </span>is <span class="_ _42"> </span>that <span class="_ _23"></span>the <span class="_ _23"></span>sum <span class="_ _23"></span>of <span class="_ _23"> </span>the <span class="_ _23"> </span>user <span class="_ _23"> </span>and <span class="_ _23"> </span>system <span class="_ _23"> </span>times <span class="_ _42"> </span>exceeds <span class="_ _23"></span>the</div><div class="t m0 x32 h96 y58ab ff19 fs49 fc0 sc0 ls0 ws0">clock <span class="_ _42"> </span>time <span class="_ _42"> </span>when <span class="_ _42"> </span>multiple <span class="_ _42"> </span>processes <span class="_ _42"> </span>ar<span class="ls16ea">eu<span class="_ _c"></span><span class="ls0">sed. <span class="_ _44"> </span>This<span class="_ _44"> </span>seems <span class="_ _42"> </span>odd <span class="_ _42"> </span>at <span class="_ _53"> </span>ﬁrst, <span class="_ _42"> </span>but <span class="_ _42"> </span>is <span class="_ _42"> </span>normal</span></span></div><div class="t m0 x32 h96 y58ac ff19 fs49 fc0 sc0 ls0 ws0">when <span class="_"> </span>multiple <span class="_ _47"> </span>cores <span class="_"> </span>ar<span class="ls16eb">ep<span class="_ _1d"></span><span class="ls4a6">re<span class="_ _2"></span><span class="ls0">sent. <span class="_ _61"> </span>What<span class="_ _46"> </span>happens <span class="_ _47"> </span>is <span class="_"> </span>that <span class="_ _66"> </span>all <span class="_ _47"> </span>concurrently <span class="_"> </span>executing</span></span></span></div><div class="t m0 x32 h96 y58ad ff19 fs49 fc0 sc0 ls0 ws0">processes <span class="_ _42"> </span>accumulate <span class="_ _42"> </span>time <span class="_ _42"> </span>as <span class="_ _53"> </span>they <span class="_ _42"> </span>execute; <span class="_ _53"> </span>the <span class="_ _42"> </span>CPU <span class="_ _53"> </span>processing <span class="_ _42"> </span>times <span class="_ _42"> </span>shown <span class="_ _42"> </span>ar<span class="ls16ec">et<span class="_ _c"></span><span class="ls0">he</span></span></div><div class="t m0 x32 h96 y58ae ff19 fs49 fc0 sc0 ls0 ws0">sum <span class="_ _23"> </span>of <span class="_ _23"> </span>the <span class="_ _42"> </span>times <span class="_ _23"> </span>of <span class="_ _42"> </span>all <span class="_ _23"></span>the <span class="_ _23"> </span>cores <span class="_ _23"> </span>used <span class="_ _23"> </span>by <span class="_ _42"> </span>the <span class="_ _23"> </span>program. <span class="_ _35"> </span>Because<span class="_ _35"> </span>we <span class="_ _23"> </span>can <span class="_ _42"> </span>run <span class="_ _23"></span>multiple</div><div class="t m0 x32 h96 y58af ff19 fs49 fc0 sc0 ls0 ws0">processes <span class="_ _42"> </span>at <span class="_ _42"> </span>the <span class="_ _53"> </span>same <span class="_ _53"> </span>time <span class="_ _53"> </span>(one <span class="_ _53"> </span>per <span class="_ _42"> </span>core), <span class="_ _53"> </span>the <span class="_ _42"> </span>CPU <span class="_ _53"> </span>processing <span class="_ _42"> </span>times <span class="_ _53"> </span>can <span class="_ _53"> </span>exceed <span class="_ _53"> </span>the</div><div class="t m0 x32 h96 y58b0 ff19 fs49 fc0 sc0 ls0 ws0">clock time.</div><div class="t m0 x3f h96 y58b1 ff19 fs49 fc0 sc0 ls0 ws0">The <span class="_ _e"> </span>eighth <span class="_ _e"> </span>column, <span class="_ _e"> </span>labeled <span class="_ _e"> </span>‘<span class="_ _0"></span>‘<span class="ff20">Δ<span class="_ _4b"> </span></span>Clock,’<span class="_ _0"></span>’<span class="_ _4b"> </span>is<span class="_ _4b"> </span>the <span class="_"> </span>per<span class="_ _1"></span>centage <span class="_"> </span>dif<span class="_ _1"></span>ference <span class="_ _e"> </span>between <span class="_ _e"> </span>the</div><div class="t m0 x32 h96 y58b2 ff19 fs49 fc0 sc0 ls0 ws0">clock <span class="_ _53"> </span>times <span class="_ _53"> </span>from <span class="_ _53"> </span>advisory <span class="_ _e"> </span>coarse-grained <span class="_ _53"> </span>locking <span class="_ _e"> </span>and <span class="_ _53"> </span>advisory <span class="_ _53"> </span>ﬁne-grained <span class="_ _e"> </span>locking.</div><div class="t m0 x32 h96 y58b3 ff19 fs49 fc0 sc0 ls0 ws0">This <span class="_ _e"> </span>is <span class="_ _e"> </span>a <span class="_"> </span>measur<span class="_ _0"></span>ement <span class="_ _e"> </span>of <span class="_ _e"> </span>how <span class="_"> </span>much <span class="_ _53"> </span>concurrency <span class="_ _e"> </span>we <span class="_ _e"> </span>obtain <span class="_"> </span>by <span class="_ _53"> </span>going <span class="_"> </span>fr<span class="_ _1"></span>om <span class="_"> </span>coarse-</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
