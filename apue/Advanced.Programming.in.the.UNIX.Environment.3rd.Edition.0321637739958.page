<div id="pf3be" class="pf w4 h1f" data-page-no="3be"><div class="pc pc3be w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg3be.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">924<span class="_ _1b"> </span><span class="ff19">Solutions <span class="_"> </span>to <span class="_"> </span>Selected <span class="_"> </span>Exercises <span class="_ _2eb"> </span>Appendix<span class="_ _4b"> </span>C</span></div><div class="t m0 x35 h27 y12f ff16 fsf fc0 sc0 ls0 ws0">Chapter <span class="_"> </span>10</div><div class="t m0 x32 h2a y3eb ff18 fsf fc0 sc0 ls0 ws0">10.1<span class="_ _210"> </span><span class="ff19">The <span class="_ _3"></span>program <span class="_ _3"></span>terminates <span class="_ _3"></span>the <span class="_ _2"></span>ﬁrst <span class="_ _3"></span>time <span class="_ _3"></span>we <span class="_ _3"></span>send <span class="_ _3"></span>it <span class="_ _3"></span>a <span class="_ _3"></span>signal.<span class="_ _16"> </span>The <span class="_ _3"></span>reason <span class="_ _2"></span>is <span class="_ _3"></span>that <span class="_ _3"></span>the</span></div><div class="t m0 xe2 h26 y3ec ff1a fsf fc0 sc0 ls0 ws0">pause<span class="_ _80"> </span><span class="ff19">function returns whenever a signal is caught.</span></div><div class="t m0 x32 h2a y5070 ff18 fsf fc0 sc0 ls0 ws0">10.3<span class="_ _210"> </span><span class="ff19">Figur<span class="ls44">eC<span class="_ _d"></span><span class="ls0">.1<span class="_ _1"></span><span class="ls44">1s<span class="_ _5"></span><span class="ls0">hows the stack frames.</span></span></span></span></span></div><div class="t m0 xb0 h2d y616e ff19 fs10 fc0 sc0 ls0 ws0">stack frame</div><div class="t m0 x6 h5e y616f ff19 fs10 fc0 sc0 ls0 ws0">for<span class="_"> </span><span class="ff1a">main</span></div><div class="t m0 x17f h2e y6170 ff19 fs11 fc0 sc0 ls0 ws0">stack frame</div><div class="t m0 x110 h4f y6171 ff19 fs11 fc0 sc0 ls0 ws0">for<span class="_"> </span><span class="ff1a">main</span></div><div class="t m0 x17f h2f y6172 ff19 fs12 fc0 sc0 ls0 ws0">stack frame</div><div class="t m0 x17f h6d y6173 ff19 fs12 fc0 sc0 ls0 ws0">for<span class="_"> </span><span class="ff1a">sleep2</span></div><div class="t m0 x17f h30 y6174 ff19 fs13 fc0 sc0 ls0 ws0">stack frame</div><div class="t m0 x11b h63 y6175 ff19 fs13 fc0 sc0 ls0 ws0">for<span class="_"> </span><span class="ff1a">sig_int</span></div><div class="t m0 x15c h31 y6176 ff19 fs14 fc0 sc0 ls0 ws0">stack frame</div><div class="t m0 x1fe h6f y6177 ff19 fs14 fc0 sc0 ls0 ws0">for<span class="_"> </span><span class="ff1a">main</span></div><div class="t m0 x15c h32 y6178 ff19 fs15 fc0 sc0 ls0 ws0">stack frame</div><div class="t m0 x78 h66 y6179 ff19 fs15 fc0 sc0 ls0 ws0">for<span class="_"> </span><span class="ff1a">sleep2</span></div><div class="t m0 x15c h33 y617a ff19 fs16 fc0 sc0 ls0 ws0">stack frame</div><div class="t m0 x1de h70 y617b ff19 fs16 fc0 sc0 ls0 ws0">for<span class="_"> </span><span class="ff1a">sig_int</span></div><div class="t m0 x15c h83 y617c ff19 fs36 fc0 sc0 ls0 ws0">stack frame</div><div class="t m0 x107 h71 y617d ff19 fs36 fc0 sc0 ls0 ws0">for<span class="_"> </span><span class="ff1a">sig_alrm</span></div><div class="t m0 x196 hd4 y617e ff1a fs18 fc0 sc0 ls0 ws0">longjmp</div><div class="t m0 x49 h36 y617f ff19 fs19 fc0 sc0 ls0 ws0">stack frame</div><div class="t m0 x168 hd5 y6180 ff19 fs19 fc0 sc0 ls0 ws0">for<span class="_"> </span><span class="ff1a">main</span></div><div class="t m0 x49 h37 y6181 ff19 fs1a fc0 sc0 ls0 ws0">stack frame</div><div class="t m0 x23f h8d y6182 ff19 fs1a fc0 sc0 ls0 ws0">for<span class="_"> </span><span class="ff1a">sleep2</span></div><div class="t m0 x105 h39 y6183 ff19 fs1c fc0 sc0 ls183c ws0">re<span class="ls0">turn to</span></div><div class="t m0 x190 hd7 y6184 ff1a fs1c fc0 sc0 ls0 ws0">main</div><div class="t m0 x90 h39 y6185 ff19 fs1c fc0 sc0 ls0 ws0">bottom</div><div class="t m0 x156 h39 y6186 ff19 fs1c fc0 sc0 ls0 ws0">of stack</div><div class="t m0 x136 h88 y6187 ff19 fs43 fc0 sc0 ls0 ws0">processing</div><div class="t m0 x4b h128 y6188 ff1a fs43 fc0 sc0 ls0 ws0">SIGINT</div><div class="t m0 x17a h88 y6187 ff19 fs43 fc0 sc0 ls0 ws0">processing</div><div class="t m0 xcd h128 y6188 ff1a fs43 fc0 sc0 ls0 ws0">SIGALRM</div><div class="t m0 x1b1 h88 y6187 ff19 fs43 fc0 sc0 ls0 ws0">after</div><div class="t m0 x11 h128 y6188 ff1a fs43 fc0 sc0 ls0 ws0">longjmp</div><div class="t m0 x224 h128 y6189 ff18 fs43 fc0 sc0 ls0 ws0">Figure C.1<span class="_ _0"></span>1<span class="_ _5a"> </span><span class="ff19">Stack frames befor<span class="ls183d">ea<span class="_ _5"></span><span class="ls0">nd after<span class="_"> </span><span class="ff1a">longjmp</span></span></span></span></div><div class="t m0 xe2 h14f y618a ff19 fsb5 fc0 sc0 ls0 ws0">The<span class="_ _59"> </span><span class="ff1a">longjmp<span class="_ _46"> </span></span>from<span class="_ _59"> </span><span class="ff1a">sig_alrm<span class="_ _46"> </span></span>back <span class="_"> </span>to<span class="_ _46"> </span><span class="ff1a">sleep2<span class="_ _46"> </span></span>effectively <span class="_"> </span>aborts <span class="_"> </span>the <span class="_"> </span>call <span class="_"> </span>to</div><div class="t m0 xe2 h14f y618b ff1a fsb5 fc0 sc0 ls0 ws0">sig_int<span class="ff19 ls183e">.F<span class="_ _4a"></span><span class="ls127f">ro<span class="ls1282">mt<span class="_ _d"></span><span class="ls0">his point,<span class="_"> </span><span class="ff1a">sleep2<span class="_ _66"> </span></span><span class="ls127f">re<span class="_ _2"></span></span>turns to main (recall Figur<span class="_ _0"></span><span class="ls1282">e1<span class="_ _d"></span><span class="ls0">0.8).</span></span></span></span></span></span></div><div class="t m0 x32 h14f y618c ff18 fsb5 fc0 sc0 ls0 ws0">10.4<span class="_ _210"> </span><span class="ff19 ls183f">We <span class="_ _80"> </span>a<span class="_ _9"></span><span class="ls0">gain <span class="_ _2"></span>have <span class="_ _3"></span>a <span class="_ _2"></span>race <span class="_ _2"></span>condition, <span class="_ _2"></span>this <span class="_ _3"></span>time <span class="_ _2"></span>between <span class="_ _2"></span>the <span class="_ _3"></span>ﬁrst <span class="_ _2"></span>call <span class="_ _2"></span>to<span class="_ _47"> </span><span class="ff1a">alarm<span class="_ _66"> </span></span>and <span class="_ _3"></span>the</span></span></div><div class="t m0 xe2 h14f y618d ff19 fsb5 fc0 sc0 ls0 ws0">call <span class="_ _66"> </span>to<span class="_ _61"> </span><span class="ff1a">setjmp</span><span class="ls1840">.I<span class="_ _49"></span><span class="ls1841">ft<span class="_ _5b"></span><span class="ls0">he <span class="_ _66"> </span>process <span class="_ _66"> </span>is <span class="_ _47"> </span>blocked <span class="_ _66"> </span>by <span class="_ _47"> </span>the <span class="_"> </span>kernel <span class="_ _47"> </span>between <span class="_ _66"> </span>these <span class="_ _47"> </span>two</span></span></span></div><div class="t m0 xe2 h14f y618e ff19 fsb5 fc0 sc0 ls0 ws0">function <span class="_ _23"> </span>calls, <span class="_ _23"> </span>the <span class="_ _42"> </span>alarm <span class="_ _23"> </span>goes <span class="_ _42"> </span>of<span class="_ _0"></span>f, <span class="_ _23"> </span>the <span class="_ _42"> </span>signal <span class="_ _23"></span>handler <span class="_ _23"> </span>is <span class="_ _42"> </span>called, <span class="_ _23"> </span>and<span class="_ _35"> </span><span class="ff1a">longjmp<span class="_ _35"> </span></span>is</div><div class="t m0 xe2 h14f y618f ff19 fsb5 fc0 sc0 ls0 ws0">called. <span class="_ _47"> </span>But<span class="_ _47"> </span>since<span class="_ _47"> </span><span class="ff1a">setjmp<span class="_ _47"> </span></span>was <span class="_ _3"></span>never <span class="_ _2"></span>called, <span class="_ _3"></span>the <span class="_ _3"></span>buffer<span class="_ _47"> </span><span class="ff1a">env_alrm<span class="_ _47"> </span></span>is <span class="_ _2"></span>not <span class="_ _3"></span>set.<span class="_ _16"> </span>The</div><div class="t m0 xe2 h14f y6190 ff19 fsb5 fc0 sc0 ls0 ws0">operation <span class="_ _3"></span>of<span class="_ _47"> </span><span class="ff1a">longjmp<span class="_ _45"> </span></span>is <span class="_ _3"></span>undeﬁned <span class="_ _3"></span>if <span class="_ _3"></span>its <span class="_ _3"></span>jump <span class="_ _9"></span>buffer <span class="_ _2"></span>has <span class="_ _9"></span>not <span class="_ _3"></span>been <span class="_ _3"></span>initialized <span class="_ _3"></span>by</div><div class="t m0 xe2 h14f y6191 ff1a fsb5 fc0 sc0 ls0 ws0">setjmp<span class="ff19">.</span></div><div class="t m0 x32 h15c y6192 ff18 fsb5 fc0 sc0 ls0 ws0">10.5<span class="_ _210"> </span><span class="ff19">See <span class="_ _23"> </span>‘‘Implementing <span class="_ _9"></span>Softwar<span class="ls1842">eT<span class="_ _c"></span><span class="ls0">imers’’<span class="_ _45"> </span>by<span class="_ _35"> </span>Don <span class="_ _23"></span>Libes <span class="_ _23"></span>(<span class="ff1b ls1842">CU<span class="_ _43"></span><span class="ls0">sers <span class="_ _23"> </span>Journal<span class="ff19 ls1842">,v<span class="_ _b"></span><span class="ls0">ol. <span class="_ _9"></span>8, <span class="_ _23"> </span>no.</span></span></span></span></span></span></span></div><div class="t m0 xe2 h150 y6193 ff19 fsb5 fc0 sc0 ls1843 ws0">11<span class="_ _3"></span><span class="ls1844">,N<span class="_ _5b"></span><span class="ls0">ov<span class="_ _4"></span><span class="ls1844">.1<span class="_ _5b"></span><span class="ls0">990) <span class="_ _47"> </span>for <span class="_ _66"> </span>an <span class="_ _47"> </span>example.<span class="_ _50"> </span><span class="ls1845">Ac<span class="_ _1d"></span><span class="ls0">opy <span class="_ _47"> </span>of <span class="_ _66"> </span>this <span class="_ _47"> </span>paper <span class="_ _66"> </span>is <span class="_ _47"> </span>available <span class="_ _66"> </span>online <span class="_ _47"> </span>at</span></span></span></span></span></span></div><div class="t m0 xe2 h14f y6194 ff1a fsb5 fc0 sc0 ls0 ws0">http://www.kohala.com/start/libes.timers.txt<span class="ff19">.</span></div><div class="t m0 x32 h14f y6195 ff18 fsb5 fc0 sc0 ls0 ws0">10.7<span class="_ _210"> </span><span class="ff19">If <span class="_ _2"></span>we <span class="_ _2"></span>simply <span class="_ _2"></span>called<span class="_ _66"> </span><span class="ff1a">_exit</span><span class="ls1846">,t<span class="_ _d"></span><span class="ls0">he <span class="_ _2"></span>termination <span class="_ _2"></span>status <span class="_ _2"></span>of <span class="_ _2"></span>the process <span class="_ _2"></span>would <span class="_ _2"></span>not <span class="_ _2"></span>show</span></span></span></div><div class="t m0 xe2 h14f y6196 ff19 fsb5 fc0 sc0 ls0 ws0">that it was terminated by the<span class="_"> </span><span class="ff1a">SIGABRT<span class="_ _80"> </span></span>signal.</div><div class="t m0 x32 h150 y6197 ff18 fsb5 fc0 sc0 ls0 ws0">10.8<span class="_ _210"> </span><span class="ff19">If <span class="_ _3"></span>the <span class="_ _3"></span>signal <span class="_ _3"></span>was <span class="_ _3"></span>sent <span class="_ _3"></span>by <span class="_ _3"></span>a <span class="_ _3"></span>process <span class="_ _2"></span>owned <span class="_ _3"></span>by <span class="_ _3"></span>some <span class="_ _2"></span>other <span class="_ _3"></span>user<span class="_ _1"></span><span class="ls1847">,t<span class="_ _4f"></span><span class="ls0">he <span class="_ _2"></span>process <span class="_ _3"></span>has <span class="_ _2"></span>to</span></span></span></div><div class="t m0 xe2 h14f y6198 ff19 fsb5 fc0 sc0 ls0 ws0">be <span class="_ _2"></span>set-user-ID to <span class="_ _2"></span>either <span class="_ _2"></span>root or <span class="_ _2"></span>to <span class="_ _2"></span>the <span class="_ _2"></span>owner <span class="_ _2"></span>of <span class="_ _2"></span>the <span class="_ _2"></span>receiving <span class="_ _2"></span>process, or <span class="_ _2"></span>the<span class="_ _47"> </span><span class="ff1a">kill</span></div><div class="t m0 xe2 h150 y6199 ff19 fsb5 fc0 sc0 ls0 ws0">attempt <span class="_ _23"> </span>won’t <span class="_ _42"> </span>work.<span class="_ _51"> </span>Therefor<span class="_ _1"></span>e, <span class="_ _42"> </span>the <span class="_ _23"> </span>real <span class="_ _23"> </span>user <span class="_ _23"> </span>ID <span class="_ _42"> </span>provides <span class="_ _23"></span>mor<span class="ls1848">ei<span class="_ _43"></span><span class="ls0">nformation <span class="_ _23"></span>to</span></span></div><div class="t m0 xe2 h150 y619a ff19 fsb5 fc0 sc0 ls0 ws0">the receiver of the signal.</div><a class="l" href="http://www.kohala.com/start/libes.timers.txt"><div class="d m1" style="border-style:none;position:absolute;left:215.676307px;bottom:297.590999px;width:266.891006px;height:11.486999px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
