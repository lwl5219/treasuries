<div id="pf30a" class="pf w4 h1f" data-page-no="30a"><div class="pc pc30a w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg30a.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">744<span class="_ _1b"> </span><span class="ff19 ls30a">AD<span class="_ _55"></span><span class="ls0">atabase <span class="_"> </span>Library<span class="_ _245"> </span>Chapter <span class="_"> </span>20</span></span></div><div class="t m0 x32 h2a y12f ff19 fsf fc0 sc0 ls0 ws0">provided <span class="_ _47"> </span>in <span class="_ _47"> </span>SVR4’s <span class="_ _47"> </span>BSD-compatibility <span class="_ _47"> </span>library <span class="_ _45"> </span>[A<span class="_ _6"></span>T&amp;T <span class="_ _47"> </span>1990c].<span class="_ _5f"> </span>The <span class="_ _45"> </span>BSD <span class="_ _47"> </span>developers</div><div class="t m0 x32 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">extended <span class="_ _2"></span>the<span class="_ _47"> </span><span class="ff1a">dbm<span class="_ _47"> </span></span>library <span class="_ _3"></span>and <span class="_ _3"></span>called <span class="_ _3"></span>it<span class="_ _47"> </span><span class="ff1a">ndbm</span><span class="ls915">.T<span class="_ _1d"></span><span class="ls0">he<span class="_ _47"> </span><span class="ff1a">ndbm<span class="_ _47"> </span></span>library <span class="_ _3"></span>was <span class="_ _3"></span>included <span class="_ _3"></span>in <span class="_ _3"></span>BSD <span class="_ _3"></span>as</span></span></div><div class="t m0 x32 h26 y131 ff19 fsf fc0 sc0 ls0 ws0">well <span class="_ _9"></span>as <span class="_ _23"> </span>in <span class="_ _23"></span>SVR4.<span class="_ _5a"> </span>The<span class="_ _35"> </span><span class="ff1a">ndbm<span class="_ _45"> </span></span>functions <span class="_ _23"></span>ar<span class="ls15f6">es<span class="_ _43"></span><span class="ls0">tandardized <span class="_ _9"></span>in <span class="_ _23"></span>the <span class="_ _23"></span>XSI <span class="_ _9"></span>option <span class="_ _23"></span>of <span class="_ _23"></span>the <span class="_ _9"></span>Single</span></span></div><div class="t m0 x32 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">UNIX Speciﬁcation.</div><div class="t m0 x3f h2a y133 ff19 fsf fc0 sc0 ls0 ws0">Seltzer and Y<span class="_ _1"></span>igit</div><div class="t m0 x161 h2a y18af ff19 fsf fc0 sc0 ls0 ws0">[</div><div class="t m0 x30 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">1991</div><div class="t m0 x6b h2a y18af ff19 fsf fc0 sc0 ls0 ws0">]</div><div class="t m0 x7 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">provide a detailed history of the dynamic hashing <span class="_ _2"></span>algorithm</div><div class="t m0 x32 h26 y134 ff19 fsf fc0 sc0 ls0 ws0">used <span class="_ _3"></span>by <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">dbm<span class="_ _47"> </span></span>library <span class="_ _9"></span>and <span class="_ _3"></span>other <span class="_ _9"></span>implementations <span class="_ _9"></span>of <span class="_ _3"></span>this <span class="_ _9"></span>library<span class="_ _4"></span><span class="ls15f7">,i<span class="_ _8"></span><span class="ls0">ncluding<span class="_ _45"> </span><span class="ff1a">gdbm</span><span class="ls1cb">,t<span class="_ _b"></span><span class="ls0">he</span></span></span></span></div><div class="t m0 x32 h26 y135 ff19 fsf fc0 sc0 ls0 ws0">GNU <span class="_ _44"> </span>version <span class="_ _4b"> </span>of <span class="_ _44"> </span>the<span class="_ _65"> </span><span class="ff1a">dbm<span class="_ _65"> </span></span>library<span class="_ _4"></span><span class="ls15f8">.U<span class="_ _30f"></span><span class="ls0">nfortunately<span class="_ _4"></span><span class="ls15f9">,ab<span class="_ _52"></span><span class="ls0">asic <span class="_ _44"> </span>limitation <span class="_ _4b"> </span>of <span class="_ _44"> </span>all <span class="_ _4b"> </span>these</span></span></span></span></div><div class="t m0 x32 h2a y136 ff19 fsf fc0 sc0 ls0 ws0">implementations <span class="_ _23"></span>is <span class="_ _23"> </span>that <span class="_ _23"> </span>none <span class="_ _23"> </span>allows <span class="_ _23"> </span>concurrent <span class="_ _23"></span>updating <span class="_ _23"> </span>of <span class="_ _23"> </span>the <span class="_ _23"> </span>database <span class="_ _23"> </span>by <span class="_ _42"> </span>multiple</div><div class="t m0 x32 h2a y137 ff19 fsf fc0 sc0 ls0 ws0">processes. <span class="_ _44"> </span>These<span class="_ _4b"> </span>implementations <span class="_ _e"> </span>provide <span class="_ _53"> </span>no <span class="_ _e"> </span>type <span class="_ _e"> </span>of <span class="_ _e"> </span>concurrency <span class="_ _53"> </span>controls <span class="_ _53"> </span>(such <span class="_ _53"> </span>as</div><div class="t m0 x32 h2a y138 ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">cor<span class="ls44">dl<span class="_ _d"></span><span class="ls0">ocking).</span></span></span></div><div class="t m0 x3f h26 y139 ff19 fsf fc0 sc0 ls0 ws0">4.4BSD <span class="_ _2"></span>provided <span class="_ _3"></span>a <span class="_ _3"></span>new<span class="_ _47"> </span><span class="ff1a">db</span>(3) <span class="_ _2"></span>library <span class="_ _3"></span>that <span class="_ _3"></span>supports <span class="_ _3"></span>three <span class="_ _2"></span>forms <span class="_ _3"></span>of <span class="_ _3"></span>access: <span class="_ _3"></span>(a) <span class="_ _3"></span>recor<span class="_ _0"></span>d</div><div class="t m0 x32 h2a y13a ff19 fsf fc0 sc0 ls0 ws0">oriented, <span class="_ _2"></span>(b) <span class="_ _2"></span>hashing, <span class="_ _2"></span>and <span class="_ _3"></span>(c) <span class="_ _2"></span>a <span class="_ _2"></span>B-tree. <span class="_ _66"> </span>Again,<span class="_ _47"> </span>no <span class="_ _2"></span>form <span class="_ _2"></span>of <span class="_ _3"></span>concurrency was <span class="_ _3"></span>provided (as</div><div class="t m0 x32 h26 y254 ff19 fsf fc0 sc0 ls0 ws0">was plainly stated in the BUGS section of the<span class="_"> </span><span class="ff1a">db</span>(3) manual page).</div><div class="t m0 x76 h52 ya07 ff19 fs2a fc0 sc0 ls0 ws0">Oracle <span class="_ _80"> </span>(<span class="ff1a">http://www.oracle.com</span><span class="ls15fa">)p<span class="_ _c"></span><span class="ls34e">ro<span class="ls0">vides <span class="_ _80"> </span>versions <span class="_ _80"> </span>of <span class="_ _80"> </span>the<span class="_ _44"> </span><span class="ff1a">db<span class="_ _4b"> </span></span>library <span class="_ _80"> </span>that <span class="_ _80"> </span>do <span class="_ _80"> </span>support</span></span></span></div><div class="t m0 x76 h51 ya08 ff19 fs2a fc0 sc0 ls0 ws0">concurrent access, locking, and transactions.</div><div class="t m0 x3f h2a ybac ff19 fsf fc0 sc0 ls0 ws0">Most <span class="_ _23"> </span>commercial <span class="_ _42"> </span>database <span class="_ _23"> </span>libraries <span class="_ _42"> </span>do <span class="_ _23"> </span>provide <span class="_ _42"> </span>the <span class="_ _23"> </span>concurrency <span class="_ _23"> </span>controls <span class="_ _42"> </span>r<span class="_ _0"></span>equired</div><div class="t m0 x32 h2a y5552 ff19 fsf fc0 sc0 ls0 ws0">for <span class="_ _42"> </span>multiple <span class="_ _53"> </span>processes <span class="_ _42"> </span>to <span class="_ _53"> </span>update <span class="_ _53"> </span>a <span class="_ _42"> </span>database <span class="_ _53"> </span>simultaneously<span class="_ _6"></span><span class="ls15fb">.T<span class="_ _52"></span><span class="ls0">hese <span class="_ _42"> </span>systems <span class="_ _53"> </span>typically</span></span></div><div class="t m0 x32 h2a y5553 ff19 fsf fc0 sc0 ls0 ws0">use <span class="_ _23"> </span>advisory <span class="_ _23"> </span>locking, <span class="_ _23"> </span>as <span class="_ _42"> </span>we <span class="_ _23"> </span>described <span class="_ _23"> </span>in <span class="_ _23"> </span>Section <span class="_ _42"> </span>14.3, <span class="_ _23"></span>but <span class="_ _23"> </span>they <span class="_ _23"> </span>often <span class="_ _42"> </span>implement <span class="_ _23"></span>their</div><div class="t m0 x32 h2a y5554 ff19 fsf fc0 sc0 ls0 ws0">own locking <span class="_ _2"></span>primitives to <span class="_ _2"></span>avoid the <span class="_ _2"></span>overhead of a <span class="_ _2"></span>system <span class="_ _2"></span>call to <span class="_ _2"></span>acquire<span class="_"> </span>an<span class="_"> </span>uncontested</div><div class="t m0 x32 h2a y5555 ff19 fsf fc0 sc0 ls0 ws0">lock. <span class="_ _16"> </span>These<span class="_ _16"> </span>commercial <span class="_ _47"> </span>systems <span class="_ _47"> </span>usually <span class="_ _45"> </span>implement <span class="_ _47"> </span>their <span class="_ _47"> </span>database <span class="_ _45"> </span>using <span class="_ _47"> </span>B+ <span class="_ _47"> </span>trees</div><div class="t m0 x32 h2a y5556 ff19 fsf fc0 sc0 ls0 ws0">[</div><div class="t m0 x62 h2a y5557 ff19 fsf fc0 sc0 ls0 ws0">Comer <span class="_ _2"></span>1979</div><div class="t m0 x198 h2a y5556 ff19 fsf fc0 sc0 ls0 ws0">]</div><div class="t m0 x1d h2a y5557 ff19 fsf fc0 sc0 ls0 ws0">or <span class="_ _2"></span>some <span class="_ _2"></span>dynamic <span class="_ _3"></span>hashing <span class="_ _2"></span>technique, <span class="_ _2"></span>such <span class="_ _3"></span>as <span class="_ _2"></span>linear <span class="_ _2"></span>hashing</div><div class="t m0 x1ae h2a y5556 ff19 fsf fc0 sc0 ls0 ws0">[</div><div class="t m0 x1fb h2a y5557 ff19 fsf fc0 sc0 ls0 ws0">Litwin <span class="_ _2"></span>1980</div><div class="t m0 x17e h2a y5556 ff19 fsf fc0 sc0 ls0 ws0">]</div><div class="t m0 x32 h2a y5558 ff19 fsf fc0 sc0 ls0 ws0">or extendible hashing [Fagin et al. 1979].</div><div class="t m0 x3f h2a y5559 ff19 fsf fc0 sc0 ls0 ws0">Figur<span class="ls15fc">e2<span class="_ _64"></span><span class="ls0">0.1 <span class="_ _4b"> </span>summarizes <span class="_ _44"> </span>the <span class="_ _44"> </span>database <span class="_ _4b"> </span>libraries <span class="_ _44"> </span>commonly <span class="_ _44"> </span>found <span class="_ _4b"> </span>in <span class="_ _44"> </span>the <span class="_ _44"> </span>four</span></span></div><div class="t m0 x32 h26 y555a ff19 fsf fc0 sc0 ls0 ws0">operating <span class="_ _45"> </span>systems <span class="_ _45"> </span>described <span class="_ _45"> </span>in <span class="_ _45"> </span>this <span class="_ _45"> </span>book.<span class="_ _5f"> </span>Note <span class="_ _45"> </span>that <span class="_ _45"> </span>on <span class="_ _45"> </span>Linux, <span class="_ _45"> </span>the<span class="_ _5a"> </span><span class="ff1a">gdbm<span class="_"> </span></span>library</div><div class="t m0 x32 h26 y555b ff19 fsf fc0 sc0 ls0 ws0">provides support for both<span class="_"> </span><span class="ff1a">dbm<span class="_ _80"> </span></span>and<span class="_"> </span><span class="ff1a">ndbm<span class="_ _80"> </span></span>functions.</div><div class="t m0 x157 h2d y555c ff19 fs10 fc0 sc0 ls0 ws0">FreeBSD <span class="_ _72"> </span>Linux<span class="_ _17"> </span>Mac OS X<span class="_ _1fb"> </span>Solaris</div><div class="t m0 x1ab h2d y555d ff19 fs10 fc0 sc0 ls0 ws0">8.0 <span class="_ _12c"> </span>3.2.0<span class="_ _db"> </span>10.6.8 <span class="_ _10b"> </span>10</div><div class="t m0 x1f h2d y555e ff19 fs10 fc0 sc0 ls0 ws0">Library<span class="_ _2b"> </span>POSIX.1</div><div class="t m0 x1f h4f y555f ff1a fs11 fc0 sc0 ls0 ws0">dbm <span class="_ _1b4"> </span>gdbm<span class="_ _23e"> </span><span class="ff19">•</span></div><div class="t m0 x1f h4f y5560 ff1a fs11 fc0 sc0 ls0 ws0">ndbm<span class="_ _136"> </span><span class="ff19">XSI <span class="_ _130"> </span>•<span class="_ _16d"> </span></span>gdbm<span class="_ _1c7"> </span><span class="ff19 ls8fc">••</span></div><div class="t m0 x1f h4f y5561 ff1a fs11 fc0 sc0 ls0 ws0">db<span class="_ _10c"> </span><span class="ff19 ls8fc">•••</span></div><div class="t m0 x144 h2f y5562 ff18 fs12 fc0 sc0 ls0 ws0">Figure 20.1<span class="_ _5a"> </span><span class="ff19">Support for database libraries on various platforms</span></div><div class="t m0 x35 h59 y5563 ff16 fs2e fc0 sc0 ls0 ws0">20.3 <span class="_ _93"> </span>The<span class="_ _54"> </span>Librar <span class="_ _b"></span>y</div><div class="t m0 x32 h5c y5564 ff19 fs29 fc0 sc0 ls0 ws0">The <span class="_ _2"></span>library <span class="_ _3"></span>we <span class="_ _2"></span>develop <span class="_ _3"></span>in <span class="_ _3"></span>this <span class="_ _2"></span>chapter <span class="_ _3"></span>will <span class="_ _2"></span>be <span class="_ _3"></span>similar <span class="_ _2"></span>to <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">ndbm<span class="_ _47"> </span></span>library<span class="_ _4"></span><span class="ls15fd">,b<span class="_ _4f"></span><span class="ls0">ut <span class="_ _2"></span>we’ll <span class="_ _3"></span>add</span></span></div><div class="t m0 x32 h50 y5565 ff19 fs29 fc0 sc0 ls0 ws0">the <span class="_ _42"> </span>concurrency <span class="_ _42"> </span>control <span class="_ _42"> </span>mechanisms <span class="_ _42"> </span>to <span class="_ _53"> </span>allow <span class="_ _42"> </span>multiple <span class="_ _53"> </span>processes <span class="_ _42"> </span>to <span class="_ _42"> </span>update <span class="_ _53"> </span>the <span class="_ _42"> </span>same</div><div class="t m0 x32 h50 y5566 ff19 fs29 fc0 sc0 ls0 ws0">database <span class="_ _2"></span>at <span class="_ _2"></span>the <span class="_ _2"></span>same <span class="_ _2"></span>time.<span class="_ _46"> </span><span class="lse2">We <span class="_ _80"> </span>ﬁ<span class="_ _9"></span></span>rst <span class="_ _2"></span>describe <span class="_ _2"></span>the <span class="_ _2"></span>C <span class="_ _2"></span>interface <span class="_ _2"></span>to <span class="_ _2"></span>the <span class="_ _2"></span>database <span class="_ _2"></span>library<span class="_ _6"></span><span class="ls15fe">,t<span class="_ _4f"></span><span class="ls0">hen</span></span></div><div class="t m0 x32 h50 y5567 ff19 fs29 fc0 sc0 ls0 ws0">in the next section describe the actual implementation.</div><div class="t m0 x3f h50 y5568 ff19 fs29 fc0 sc0 ls0 ws0">When <span class="_ _44"> </span>we <span class="_ _44"> </span>open <span class="_ _44"> </span>a <span class="_ _44"> </span>database, <span class="_ _4b"> </span>we <span class="_ _44"> </span>ar<span class="ls15ff">er<span class="_ _64"></span><span class="ls0">eturned <span class="_ _44"> </span>a <span class="_ _44"> </span>handle <span class="_ _4b"> </span>(an <span class="_ _44"> </span>opaque <span class="_ _44"> </span>pointer)</span></span></div><div class="t m0 x32 h50 y5569 ff19 fs29 fc0 sc0 lsdf ws0">re<span class="ls0">presenting the database.<span class="_ _59"> </span><span class="lse2">We<span class="_ _23"></span></span>’ll pass this handle to the remaining database functions.</span></div><a class="l" href="#pf13" data-dest-detail='[19,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.893675px;bottom:304.308909px;width:104.808197px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="http://www.oracle.com"><div class="d m1" style="border-style:none;position:absolute;left:333.204882px;bottom:897.138916px;width:103.464020px;height:11.984009px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
