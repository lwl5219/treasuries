<div id="pf19a" class="pf w4 h1f" data-page-no="19a"><div class="pc pc19a w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg19a.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">376<span class="_ _1b"> </span><span class="ff19">Signals <span class="_ _24b"> </span>Chapter<span class="_ _21"> </span>10</span></div><div class="t m0 x35 h75 y12f ff16 fs2b fc0 sc0 ls0 ws0">10.20<span class="_ _5a"> </span><span class="ff1f">sigqueue<span class="_ _54"> </span></span>Function</div><div class="t m0 x32 h2a y681 ff19 fsf fc0 sc0 ls0 ws0">In Section <span class="_ _2"></span>10.8 <span class="_ _2"></span>we <span class="_ _2"></span>said <span class="_ _2"></span>that <span class="_ _2"></span>most <span class="_ _2"></span>UNIX <span class="_ _2"></span>systems <span class="_ _2"></span>don’t <span class="_ _2"></span>queue <span class="_ _2"></span>signals.<span class="_ _46"> </span><span class="ls65">Wi<span class="_ _3"></span></span>th <span class="_ _2"></span>the <span class="_ _2"></span>real-time</div><div class="t m0 x32 h2a y683 ff19 fsf fc0 sc0 ls0 ws0">extensions <span class="_ _2"></span>to <span class="_ _3"></span>POSIX.1, <span class="_ _3"></span>some <span class="_ _3"></span>systems <span class="_ _2"></span>began <span class="_ _3"></span>adding <span class="_ _3"></span>support <span class="_ _2"></span>for <span class="_ _3"></span>queueing <span class="_ _3"></span>signals.<span class="_ _16"> </span><span class="ls65">Wi<span class="_ _3"></span></span>th</div><div class="t m0 x32 h2a y685 ff19 fsf fc0 sc0 ls0 ws0">SUSv4, <span class="_ _3"></span>the <span class="_ _9"></span>queued <span class="_ _3"></span>signal <span class="_ _9"></span>functionality <span class="_ _3"></span>has <span class="_ _9"></span>moved <span class="_ _9"></span>from <span class="_ _2"></span>the <span class="_ _9"></span>real-time <span class="_ _3"></span>extensions <span class="_ _3"></span>to <span class="_ _9"></span>the</div><div class="t m0 x32 h2a y686 ff19 fsf fc0 sc0 ls0 ws0">base speciﬁcation.</div><div class="t m0 x3f h2a y687 ff19 fsf fc0 sc0 ls0 ws0">Generally <span class="_ _42"> </span>a <span class="_ _42"> </span>signal <span class="_ _53"> </span>carries <span class="_ _42"> </span>one <span class="_ _42"> </span>bit <span class="_ _53"> </span>of <span class="_ _42"> </span>information: <span class="_ _53"> </span>the <span class="_ _42"> </span>signal <span class="_ _42"> </span>itself.<span class="_ _65"> </span>In <span class="_ _42"> </span>addition <span class="_ _42"> </span>to</div><div class="t m0 x32 h2a y689 ff19 fsf fc0 sc0 ls0 ws0">queueing <span class="_ _23"> </span>signals, <span class="_ _42"> </span>these <span class="_ _23"> </span>extensions <span class="_ _42"> </span>allow <span class="_ _23"> </span>applications <span class="_ _42"> </span>to <span class="_ _23"> </span>pass <span class="_ _42"> </span>mor<span class="lsbe">ei<span class="_ _43"></span><span class="ls0">nformation <span class="_ _23"> </span>along</span></span></div><div class="t m0 x32 h26 y68a ff19 fsf fc0 sc0 ls0 ws0">with <span class="_ _42"> </span>the <span class="_ _23"> </span>delivery <span class="_ _42"> </span>(recall <span class="_ _23"> </span>Section <span class="_ _42"> </span>10.14).<span class="_ _54"> </span>This <span class="_ _23"> </span>information <span class="_ _42"> </span>is <span class="_ _42"> </span>embedded <span class="_ _23"> </span>in <span class="_ _42"> </span>a<span class="_ _44"> </span><span class="ff1a">siginfo</span></div><div class="t m0 x32 h2a y68b ff19 fsf fc0 sc0 ls0 ws0">structur<span class="_ _0"></span>e. <span class="_"> </span>Along<span class="_ _47"> </span>with system-provided information, <span class="_ _2"></span>applications <span class="_ _2"></span>can <span class="_ _2"></span>pass an <span class="_ _2"></span>integer <span class="_ _2"></span>or</div><div class="t m0 x32 h2a y68c ff19 fsf fc0 sc0 ls44 ws0">ap<span class="_ _d"></span><span class="ls0">ointer to a buffer containing mor<span class="ls44">ei<span class="_ _4f"></span><span class="ls0">nformation to the signal handler<span class="_ _1"></span>.</span></span></span></div><div class="t m0 x3f h2a y68d ff19 fsf fc0 sc0 ls5f ws0">To <span class="_ _53"> </span>u<span class="_ _9"></span><span class="ls0">se queued signals we have to do the following:</span></div><div class="t m0 x3f h26 y3021 ff19 fsf fc0 sc0 ls0 ws0">1. <span class="_ _51"> </span>Specify<span class="_ _5a"> </span>the<span class="_ _16"> </span><span class="ff1a">SA_SIGINFO<span class="_"> </span></span>ﬂag <span class="_ _45"> </span>when <span class="_ _47"> </span>we <span class="_ _45"> </span>install <span class="_ _45"> </span>a <span class="_ _45"> </span>signal <span class="_ _47"> </span>handler <span class="_ _45"> </span>using <span class="_ _45"> </span>the</div><div class="t m0 x41 h26 y3022 ff1a fsf fc0 sc0 ls0 ws0">sigaction<span class="_ _66"> </span><span class="ff19">function. <span class="_"> </span>If<span class="_ _66"> </span>we <span class="_ _2"></span>don’t <span class="_ _2"></span>specify this <span class="_ _2"></span>ﬂag, <span class="_ _2"></span>the <span class="_ _2"></span>signal will <span class="_ _2"></span>be <span class="_ _2"></span>posted, but</span></div><div class="t m0 x41 h2a y3023 ff19 fsf fc0 sc0 ls0 ws0">it is left up to the implementation whether the signal is queued.</div><div class="t m0 x3f h26 y3024 ff19 fsf fc0 sc0 ls0 ws0">2. <span class="_ _51"> </span>Provide <span class="_ _e"> </span>a <span class="_"> </span>signal <span class="_ _53"> </span>handler <span class="_"> </span>in <span class="_ _e"> </span>the<span class="_ _59"> </span><span class="ff1a">sa_sigaction<span class="_ _4b"> </span></span>member <span class="_"> </span>of <span class="_ _e"> </span>the<span class="_ _59"> </span><span class="ff1a">sigaction</span></div><div class="t m0 x41 h26 y3025 ff19 fsf fc0 sc0 ls0 ws0">structur<span class="_ _0"></span><span class="ls7a">ei<span class="_ _4f"></span><span class="ls0">nstead <span class="_ _2"></span>of <span class="_ _2"></span>using <span class="_ _3"></span>the <span class="_ _2"></span>usual<span class="_ _47"> </span><span class="ff1a">sa_handler<span class="_ _47"> </span></span>ﬁeld. <span class="_ _66"> </span>Implementations<span class="_ _47"> </span>might</span></span></div><div class="t m0 x41 h26 y3026 ff19 fsf fc0 sc0 ls0 ws0">allow <span class="_ _3"></span>us <span class="_ _3"></span>to <span class="_ _3"></span>use <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">sa_handler<span class="_ _45"> </span></span>ﬁeld, <span class="_ _2"></span>but <span class="_ _3"></span>we <span class="_ _3"></span>won’t <span class="_ _3"></span>be <span class="_ _9"></span>able <span class="_ _3"></span>to <span class="_ _3"></span>obtain <span class="_ _3"></span>the <span class="_ _3"></span>extra</div><div class="t m0 x41 h26 y3027 ff19 fsf fc0 sc0 ls0 ws0">information sent with the<span class="_"> </span><span class="ff1a">sigqueue<span class="_ _80"> </span></span>function.</div><div class="t m0 x3f h26 y3028 ff19 fsf fc0 sc0 ls0 ws0">3. <span class="_ _51"> </span>Use<span class="_"> </span>the<span class="_"> </span><span class="ff1a">sigqueue<span class="_ _80"> </span></span>function to send signals.</div><div class="t m0 x3f h57 y3029 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;signal.h&gt;</div><div class="t m0 x3f h57 y302a ff1a fs2d fc0 sc0 ls0 ws0">int sigqueue(pid_t<span class="_"> </span><span class="ff1b">pid</span><span class="ls15c">,i<span class="_ _1d"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">signo</span><span class="ls15c">,c<span class="_ _5b"></span><span class="ls0">onst union sigval<span class="_"> </span><span class="ff1b">value</span>)</span></span></span></span></div><div class="t m0 x153 h5f y302b ff19 fs2d fc0 sc0 ls0 ws0">Returns: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x3f h4d y302c ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _35"> </span><span class="ff1a">sigqueue<span class="_ _44"> </span></span>function <span class="_ _42"> </span>is <span class="_ _42"> </span>similar <span class="_ _42"> </span>to <span class="_ _42"> </span>the<span class="_ _35"> </span><span class="ff1a">kill<span class="_ _44"> </span></span>function, <span class="_ _42"> </span>except <span class="_ _42"> </span>that <span class="_ _42"> </span>we <span class="_ _42"> </span>can <span class="_ _42"> </span>only</div><div class="t m0 x32 h4d y302d ff19 fs26 fc0 sc0 ls0 ws0">direct signals <span class="_ _2"></span>to <span class="_ _3"></span>a <span class="_ _2"></span>single <span class="_ _2"></span>process <span class="_ _2"></span>with<span class="_ _47"> </span><span class="ff1a">sigqueue</span><span class="lsd3c">,a<span class="_ _8"></span><span class="ls0">nd <span class="_ _3"></span>we <span class="_ _2"></span>can <span class="_ _2"></span>use <span class="_ _3"></span>the<span class="_ _66"> </span><span class="ff1b">value<span class="_ _47"> </span></span>argument to</span></span></div><div class="t m0 x32 h49 y302e ff19 fs26 fc0 sc0 ls0 ws0">transmit either an integer or a pointer value to the signal handler<span class="_ _6"></span>.</div><div class="t m0 x3f h4d y302f ff19 fs26 fc0 sc0 ls0 ws0">Signals <span class="_ _3"></span>can’t <span class="_ _9"></span>be <span class="_ _9"></span>queued <span class="_ _3"></span>inﬁnitely<span class="_ _6"></span><span class="lsd3d">.R<span class="_ _62"></span><span class="ls0">ecall <span class="_ _9"></span>the<span class="_ _47"> </span><span class="ff1a">SIGQUEUE_MAX<span class="_ _45"> </span></span>limit <span class="_ _3"></span>from <span class="_ _9"></span>Figur<span class="lsd3e">e2<span class="_ _b"></span><span class="ls0">.9</span></span></span></span></div><div class="t m0 x32 h4d y3030 ff19 fs26 fc0 sc0 ls0 ws0">and <span class="_ _e"> </span>Figur<span class="ls5a4">e2<span class="_ _4a"></span><span class="ls0">.1<span class="_ _0"></span>1. <span class="_ _4b"> </span>When<span class="_ _59"> </span>this <span class="_"> </span>limit <span class="_ _53"> </span>is <span class="_"> </span>reached,<span class="_ _4b"> </span><span class="ff1a">sigqueue<span class="_ _4b"> </span></span>can <span class="_"> </span>fail <span class="_ _e"> </span>with<span class="_ _59"> </span><span class="ff1a">errno<span class="_ _59"> </span></span>set <span class="_ _e"> </span>to</span></span></div><div class="t m0 x32 h4d y3031 ff1a fs26 fc0 sc0 ls0 ws0">EAGAIN<span class="ff19">.</span></div><div class="t m0 x3f h49 y3032 ff19 fs26 fc0 sc0 ls3aa ws0">Wi<span class="_ _3"></span><span class="ls0">th the <span class="_ _2"></span>real-time signal enhancements, <span class="_ _2"></span>a <span class="_ _2"></span>separate set <span class="_ _2"></span>of signals <span class="_ _2"></span>was <span class="_ _2"></span>introduced for</span></div><div class="t m0 x32 h4d y3033 ff19 fs26 fc0 sc0 ls0 ws0">application <span class="_"> </span>use.<span class="_ _48"> </span>These <span class="_"> </span>ar<span class="lsd3f">et<span class="_ _5b"></span><span class="ls0">he <span class="_"> </span>signal <span class="_"> </span>numbers <span class="_"> </span>between<span class="_ _4b"> </span><span class="ff1a">SIGRTMIN<span class="_ _46"> </span></span>and<span class="_ _59"> </span><span class="ff1a">SIGRTMAX</span>,</span></span></div><div class="t m0 x32 h49 y3034 ff19 fs26 fc0 sc0 ls0 ws0">inclusive. <span class="_"> </span>Be<span class="_"> </span>awar<span class="lsd3">et<span class="_ _4f"></span><span class="ls0">hat the default action for these signals is to terminate the process.</span></span></div><div class="t m0 x3f h49 y3035 ff19 fs26 fc0 sc0 ls0 ws0">Figur<span class="lsd40">e1<span class="_ _5b"></span><span class="ls0">0.30 <span class="_"> </span>summarizes <span class="_"> </span>the <span class="_"> </span>way <span class="_"> </span>queued <span class="_ _e"> </span>signals <span class="_"> </span>differ <span class="_ _e"> </span>in <span class="_"> </span>behavior <span class="_"> </span>among <span class="_ _e"> </span>the</span></span></div><div class="t m0 x32 h49 y3036 ff19 fs26 fc0 sc0 ls0 ws0">implementations covered in this text.</div><div class="t m0 x170 h2e y3037 ff19 fs11 fc0 sc0 ls0 ws0">FreeBSD <span class="_"> </span>Linux <span class="_"> </span>Mac<span class="_"> </span>OS X<span class="_ _35"> </span>Solaris</div><div class="t m0 x14c h2e y3038 ff19 fs11 fc0 sc0 ls0 ws0">8.0 <span class="_ _d8"> </span>3.2.0<span class="_ _1bb"> </span>10.6.8 <span class="_ _9c"> </span>10</div><div class="t m0 xa0 h2e y3039 ff19 fs11 fc0 sc0 ls0 ws0">Behavior<span class="_ _3e"> </span>SUS</div><div class="t m0 x178 h6d y303a ff19 fs12 fc0 sc0 lsd41 ws0">••<span class="_ _c"></span><span class="lsd42">••<span class="_ _27f"></span><span class="ls0">supports<span class="_"> </span><span class="ff1a">sigqueue</span></span></span></div><div class="t m0 x117 h6d y303b ff19 fs12 fc0 sc0 ls0 ws0">optional <span class="_ _2b"> </span>•<span class="_ _191"> </span>•<span class="_ _280"></span>queues other signals besides<span class="_"> </span><span class="ff1a">SIGRTMIN<span class="_ _53"> </span></span>to<span class="_"> </span><span class="ff1a">SIGRTMAX</span></div><div class="t m0 x117 h6d y303c ff19 fs12 fc0 sc0 ls0 ws0">optional <span class="_ _2b"> </span>•<span class="_ _18"> </span>•<span class="_ _281"></span>queues signals even if the caller doesn’t use the<span class="_"> </span><span class="ff1a">SA_SIGINFO</span></div><div class="t m0 x8a h2f y303d ff19 fs12 fc0 sc0 ls0 ws0">ﬂag</div><div class="t m0 xe7 h30 y303e ff18 fs13 fc0 sc0 ls0 ws0">Figure 10.30<span class="_ _5a"> </span><span class="ff19">Behavior of queued signals on various platforms</span></div><a class="l" href="#pf10" data-dest-detail='[16,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892409px;bottom:1236.288916px;width:150.935798px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
