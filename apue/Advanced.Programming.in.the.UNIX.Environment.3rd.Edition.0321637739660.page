<div id="pf294" class="pf w4 h1f" data-page-no="294"><div class="pc pc294 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg294.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">626<span class="_ _1b"> </span><span class="ff19">Network <span class="_"> </span>IPC: <span class="_"> </span>Sockets<span class="_ _2c6"> </span>Chapter <span class="_"> </span>16</span></div><div class="t m0 x35 h53 y12f ff16 fs2b fc0 sc0 ls0 ws0">16.7 <span class="_ _93"> </span>Out-of-Band<span class="_ _54"> </span>Data</div><div class="t m0 x32 h2a y681 ff19 fsf fc0 sc0 ls0 ws0">Out-of-band <span class="_ _23"></span>data <span class="_ _23"></span>is <span class="_ _23"></span>an <span class="_ _23"></span>optional <span class="_ _23"></span>featur<span class="_ _0"></span><span class="ls881">es<span class="_ _43"></span><span class="ls0">upported <span class="_ _23"> </span>by <span class="_ _23"> </span>some <span class="_ _23"> </span>communication <span class="_ _23"> </span>protocols,</span></span></div><div class="t m0 x32 h2a y683 ff19 fsf fc0 sc0 ls0 ws0">allowing <span class="_ _9"></span>higher-priority <span class="_ _3"></span>delivery <span class="_ _9"></span>of <span class="_ _9"></span>data <span class="_ _9"></span>than <span class="_ _23"></span>normal.<span class="_ _16"> </span>Out-of-band <span class="_ _9"></span>data <span class="_ _23"></span>is <span class="_ _3"></span>sent <span class="_ _9"></span>ahead</div><div class="t m0 x32 h2a y685 ff19 fsf fc0 sc0 ls0 ws0">of <span class="_ _23"> </span>any <span class="_ _42"> </span>data <span class="_ _42"> </span>that <span class="_ _23"> </span>is <span class="_ _42"> </span>already <span class="_ _23"> </span>queued <span class="_ _42"> </span>for <span class="_ _23"> </span>transmission.<span class="_ _54"> </span>TCP <span class="_ _42"> </span>supports <span class="_ _23"> </span>out-of-band <span class="_ _42"> </span>data,</div><div class="t m0 x32 h2a y686 ff19 fsf fc0 sc0 ls0 ws0">but <span class="_ _e"> </span>UDP <span class="_ _e"> </span>doesn’t.<span class="_ _48"> </span>The <span class="_ _e"> </span>socket <span class="_ _e"> </span>interface <span class="_ _e"> </span>to <span class="_ _e"> </span>out-of-band <span class="_ _e"> </span>data <span class="_ _e"> </span>is <span class="_ _e"> </span>heavily <span class="_"> </span>inﬂuenced <span class="_ _53"> </span>by</div><div class="t m0 x32 h2a y687 ff19 fsf fc0 sc0 ls0 ws0">TCP’s implementation of out-of-band data.</div><div class="t m0 x3f h2a y689 ff19 fsf fc0 sc0 ls0 ws0">TCP refers to out-of-band <span class="_ _2"></span>data as ‘‘ur<span class="_ _0"></span>gent’<span class="_ _1"></span><span class="ls12d">’d<span class="_ _d"></span><span class="ls0">ata. <span class="_ _66"> </span>TCP<span class="_ _66"> </span>supports only <span class="_ _2"></span>a single <span class="_ _2"></span>byte of</span></span></div><div class="t m0 x32 h2a y68a ff19 fsf fc0 sc0 ls0 ws0">urgent <span class="_ _9"></span>data, <span class="_ _9"></span>but <span class="_ _23"> </span>allows <span class="_ _23"></span>urgent <span class="_ _9"></span>data <span class="_ _9"></span>to <span class="_ _23"></span>be <span class="_ _9"></span>delivered <span class="_ _9"></span>out <span class="_ _23"> </span>of <span class="_ _23"></span>band <span class="_ _9"></span>from <span class="_ _9"></span>the <span class="_ _23"></span>normal <span class="_ _9"></span>data</div><div class="t m0 x32 h26 y68b ff19 fsf fc0 sc0 ls0 ws0">delivery <span class="_ _9"></span>mechanisms.<span class="_ _16"> </span><span class="ls5f">To <span class="_ _66"> </span>g<span class="_ _23"></span></span>enerate <span class="_ _3"></span>urgent <span class="_ _9"></span>data, <span class="_ _3"></span>we <span class="_ _9"></span>specify <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">MSG_OOB<span class="_ _45"> </span></span>ﬂag <span class="_ _3"></span>to <span class="_ _9"></span>any <span class="_ _9"></span>of</div><div class="t m0 x32 h26 y68c ff19 fsf fc0 sc0 ls0 ws0">the three<span class="_"> </span><span class="ff1a">send<span class="_ _80"> </span></span>functions. <span class="_"> </span>If<span class="_"> </span>we send mor<span class="ls1388">et<span class="_ _4f"></span><span class="ls0">han one byte with the<span class="_"> </span><span class="ff1a">MSG_OOB<span class="_ _66"> </span></span>ﬂag, the last</span></span></div><div class="t m0 x32 h2a y68d ff19 fsf fc0 sc0 ls0 ws0">byte will be treated as the ur<span class="_ _0"></span>gent-data byte.</div><div class="t m0 x3f h26 y68e ff19 fsf fc0 sc0 ls0 ws0">When <span class="_ _9"></span>urgent <span class="_ _9"></span>data <span class="_ _9"></span>is <span class="_ _9"></span>received, <span class="_ _9"></span>we <span class="_ _23"></span>ar<span class="_ _0"></span><span class="lsae0">es<span class="_ _b"></span><span class="ls0">ent <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">SIGURG<span class="_ _45"> </span></span>signal <span class="_ _9"></span>if <span class="_ _23"></span>we <span class="_ _9"></span>have <span class="_ _9"></span>arranged</span></span></div><div class="t m0 x32 h2a y68f ff19 fsf fc0 sc0 ls0 ws0">for <span class="_ _9"></span>signal <span class="_ _23"></span>generation <span class="_ _9"></span>by <span class="_ _23"></span>the <span class="_ _9"></span>socket.<span class="_ _5a"> </span>In <span class="_ _23"></span>Sections <span class="_ _9"></span>3.14 <span class="_ _9"></span>and <span class="_ _23"></span>14.5.2, <span class="_ _9"></span>we <span class="_ _23"></span>saw <span class="_ _9"></span>that <span class="_ _23"></span>we <span class="_ _9"></span>could</div><div class="t m0 x32 h26 y690 ff19 fsf fc0 sc0 ls0 ws0">use <span class="_ _23"> </span>the<span class="_ _44"> </span><span class="ff1a">F_SETOWN<span class="_ _35"> </span></span>command <span class="_ _42"> </span>to<span class="_ _35"> </span><span class="ff1a">fcntl<span class="_ _35"> </span></span>to <span class="_ _42"> </span>set <span class="_ _23"> </span>the <span class="_ _42"> </span>ownership <span class="_ _42"> </span>of <span class="_ _23"> </span>a <span class="_ _42"> </span>socket.<span class="_ _51"> </span>If <span class="_ _42"> </span>the <span class="_ _42"> </span>third</div><div class="t m0 x32 h26 y691 ff19 fsf fc0 sc0 ls0 ws0">argument <span class="_ _3"></span>to<span class="_ _35"> </span><span class="ff1a">fcntl<span class="_ _45"> </span></span>is <span class="_ _9"></span>positive, <span class="_ _9"></span>it <span class="_ _23"></span>speciﬁes <span class="_ _9"></span>a <span class="_ _9"></span>process <span class="_ _9"></span>ID.<span class="_ _5a"> </span>If <span class="_ _23"></span>it <span class="_ _9"></span>is <span class="_ _9"></span>a <span class="_ _9"></span>negative <span class="_ _23"></span>value <span class="_ _9"></span>other</div><div class="t m0 x32 h2a y692 ff19 fsf fc0 sc0 ls0 ws0">than<span class="_ _4b"> </span><span class="ff20">−</span>1, <span class="_ _53"> </span>it <span class="_ _e"> </span>represents <span class="_ _42"> </span>the <span class="_ _e"> </span>process <span class="_ _53"> </span>group <span class="_ _53"> </span>ID.<span class="_ _65"> </span>Thus, <span class="_ _e"> </span>we <span class="_ _e"> </span>can <span class="_ _e"> </span>arrange <span class="_ _53"> </span>that <span class="_ _e"> </span>our <span class="_ _e"> </span>process</div><div class="t m0 x32 h2a y693 ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">ceive signals from a socket by calling</span></div><div class="t m0 x3f h57 y4ac3 ff1a fs2d fc0 sc0 ls0 ws0">fcntl(sockfd, F_SETOWN, pid);</div><div class="t m0 x3f h26 y4ac4 ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _47"> </span><span class="ff1a">F_GETOWN<span class="_ _47"> </span></span>command <span class="_ _2"></span>can <span class="_ _3"></span>be <span class="_ _2"></span>used <span class="_ _3"></span>to <span class="_ _3"></span>retrieve <span class="_ _2"></span>the <span class="_ _2"></span>current <span class="_ _3"></span>socket <span class="_ _2"></span>ownership.<span class="_ _16"> </span>As</div><div class="t m0 x32 h26 y4ac5 ff19 fsf fc0 sc0 ls0 ws0">with <span class="_ _23"> </span>the<span class="_ _44"> </span><span class="ff1a">F_SETOWN<span class="_ _35"> </span></span>command, <span class="_ _23"> </span>a <span class="_ _42"> </span>negative <span class="_ _23"> </span>value <span class="_ _42"> </span>repr<span class="_ _1"></span>esents <span class="_ _42"> </span>a <span class="_ _23"> </span>process <span class="_ _23"> </span>group <span class="_ _23"> </span>ID <span class="_ _42"> </span>and <span class="_ _23"> </span>a</div><div class="t m0 x32 h2a y4ac6 ff19 fsf fc0 sc0 ls0 ws0">positive value repr<span class="_ _0"></span>esents a pr<span class="_ _0"></span>ocess ID.<span class="_ _46"> </span>Thus, the call</div><div class="t m0 x3f h57 y4ac7 ff1a fs2d fc0 sc0 ls0 ws0">owner = fcntl(sockfd, F_GETOWN, 0);</div><div class="t m0 x32 h26 y4ac8 ff19 fsf fc0 sc0 ls0 ws0">will <span class="_ _2"></span>return with<span class="_ _66"> </span><span class="ff1a">owner<span class="_ _47"> </span></span>equal to <span class="_ _2"></span>the <span class="_ _2"></span>ID <span class="_ _2"></span>of <span class="_ _2"></span>the <span class="_ _2"></span>process <span class="_ _2"></span>conﬁgured to <span class="_ _2"></span>receive signals <span class="_ _2"></span>from</div><div class="t m0 x32 h26 y4ac9 ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _3"></span>socket <span class="_ _2"></span>if<span class="_ _45"> </span><span class="ff1a">owner<span class="_ _66"> </span></span>is <span class="_ _3"></span>positive <span class="_ _3"></span>and <span class="_ _3"></span>with <span class="_ _3"></span>the <span class="_ _3"></span>absolute <span class="_ _3"></span>value <span class="_ _3"></span>of<span class="_ _45"> </span><span class="ff1a">owner<span class="_ _66"> </span></span>equal <span class="_ _3"></span>to <span class="_ _3"></span>the <span class="_ _3"></span>ID <span class="_ _3"></span>of</div><div class="t m0 x32 h26 y4aca ff19 fsf fc0 sc0 ls0 ws0">the process gr<span class="_ _0"></span>oup conﬁgur<span class="_ _0"></span>ed to receive signals fr<span class="_ _0"></span>om the socket if<span class="_"> </span><span class="ff1a">owner<span class="_ _80"> </span></span>is negative.</div><div class="t m0 x3f h2b y4acb ff19 fsf fc0 sc0 ls0 ws0">TCP <span class="_ _42"> </span>supports <span class="_ _53"> </span>the <span class="_ _42"> </span>notion <span class="_ _53"> </span>of <span class="_ _42"> </span>an<span class="_ _44"> </span><span class="ff1b">urgent <span class="_ _42"> </span>mark<span class="_ _42"> </span></span><span class="ls1389">:t<span class="_ _43"></span><span class="ls0">he <span class="_ _42"> </span>point <span class="_ _42"> </span>in <span class="_ _53"> </span>the <span class="_ _42"> </span>normal <span class="_ _53"> </span>data <span class="_ _42"> </span>stream</span></span></div><div class="t m0 x32 h2a y4acc ff19 fsf fc0 sc0 ls0 ws0">wher<span class="lsd95">et<span class="_ _b"></span><span class="ls0">he <span class="_ _3"></span>urgent <span class="_ _3"></span>data <span class="_ _9"></span>would <span class="_ _3"></span>go.<span class="_ _5a"> </span><span class="ls5f">We <span class="_ _80"> </span>c<span class="_ _23"></span></span>an <span class="_ _3"></span>choose <span class="_ _9"></span>to <span class="_ _3"></span>receive <span class="_ _3"></span>the <span class="_ _9"></span>urgent <span class="_ _3"></span>data <span class="_ _3"></span>inline <span class="_ _9"></span>with</span></span></div><div class="t m0 x32 h26 y4acd ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _3"></span>normal <span class="_ _3"></span>data <span class="_ _3"></span>if <span class="_ _3"></span>we <span class="_ _3"></span>use <span class="_ _3"></span>the<span class="_ _45"> </span><span class="ff1a">SO_OOBINLINE<span class="_ _47"> </span></span>socket <span class="_ _2"></span>option.<span class="_ _5a"> </span><span class="ls5f">To <span class="_ _80"> </span>h<span class="_ _9"></span></span>elp <span class="_ _3"></span>us <span class="_ _3"></span>identify <span class="_ _3"></span>when</div><div class="t m0 x32 h26 y4ace ff19 fsf fc0 sc0 ls0 ws0">we have reached the ur<span class="_ _0"></span>gent mark, we can use the<span class="_"> </span><span class="ff1a">sockatmark<span class="_ _80"> </span></span>function.</div><div class="t m0 x3f h57 y4acf ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;sys/socket.h&gt;</div><div class="t m0 x3f h57 y4ad0 ff1a fs2d fc0 sc0 ls0 ws0">int sockatmark(int<span class="_"> </span><span class="ff1b">sockfd</span>);</div><div class="t m0 x221 h5f y4ad1 ff19 fs2d fc0 sc0 ls0 ws0">Returns: 1 if at mark, 0 if not at mark,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h4d y4ad2 ff19 fs26 fc0 sc0 ls0 ws0">When the next byte to be read is at the ur<span class="_ _0"></span>gent mark,<span class="_"> </span><span class="ff1a">sockatmark<span class="_ _80"> </span></span>will return 1.</div><div class="t m0 x3f h4d y4ad3 ff19 fs26 fc0 sc0 ls0 ws0">When <span class="_ _42"> </span>out-of-band <span class="_ _42"> </span>data <span class="_ _42"> </span>is <span class="_ _42"> </span>present <span class="_ _42"> </span>in <span class="_ _42"> </span>a <span class="_ _42"> </span>socket’s <span class="_ _42"> </span>read <span class="_ _42"> </span>queue, <span class="_ _42"> </span>the<span class="_ _35"> </span><span class="ff1a">select<span class="_ _44"> </span></span>function</div><div class="t m0 x32 h49 y4ad4 ff19 fs26 fc0 sc0 ls0 ws0">(Section <span class="_ _2"></span>14.4.1) <span class="_ _2"></span>will <span class="_ _2"></span>return <span class="_ _2"></span>the <span class="_ _2"></span>ﬁle <span class="_ _2"></span>descriptor <span class="_ _2"></span>as <span class="_ _3"></span>having <span class="_ _2"></span>an <span class="_ _2"></span>exception <span class="_ _2"></span>condition <span class="_ _2"></span>pending.</div><div class="t m0 x32 h49 y4ad5 ff19 fs26 fc0 sc0 ls164 ws0">We <span class="_ _e"> </span>c<span class="_ _9"></span><span class="ls0">an <span class="_ _3"></span>choose <span class="_ _2"></span>to <span class="_ _2"></span>receive <span class="_ _2"></span>the <span class="_ _2"></span>urgent <span class="_ _2"></span>data <span class="_ _2"></span>inline <span class="_ _3"></span>with <span class="_ _2"></span>the <span class="_ _2"></span>normal <span class="_ _3"></span>data, <span class="_ _2"></span>or <span class="_ _2"></span>we <span class="_ _3"></span>can <span class="_ _2"></span>use <span class="_ _2"></span>the</span></div><div class="t m0 x32 h4d y4ad6 ff1a fs26 fc0 sc0 ls0 ws0">MSG_OOB<span class="_ _45"> </span><span class="ff19">ﬂag <span class="_ _23"></span>with <span class="_ _9"></span>one <span class="_ _23"></span>of <span class="_ _9"></span>the<span class="_ _45"> </span></span>recv<span class="_ _35"> </span><span class="ff19">functions <span class="_ _9"></span>to <span class="_ _23"></span>receive <span class="_ _9"></span>the <span class="_ _9"></span>urgent <span class="_ _9"></span>data <span class="_ _23"></span>ahead <span class="_ _9"></span>of <span class="_ _23"></span>any</span></div><div class="t m0 x32 h49 y4ad7 ff19 fs26 fc0 sc0 ls0 ws0">other <span class="_ _42"> </span>queue <span class="_ _42"> </span>data.<span class="_ _54"> </span>TCP <span class="_ _53"> </span>queues <span class="_ _42"> </span>only <span class="_ _42"> </span>one <span class="_ _53"> </span>byte <span class="_ _42"> </span>of <span class="_ _42"> </span>urgent <span class="_ _42"> </span>data.<span class="_ _54"> </span>If <span class="_ _42"> </span>another <span class="_ _53"> </span>urgent <span class="_ _42"> </span>byte</div><div class="t m0 x32 h49 y4ad8 ff19 fs26 fc0 sc0 ls0 ws0">arrives before<span class="_"> </span>we<span class="_"> </span>r<span class="_ _0"></span>eceive the curr<span class="_ _0"></span>ent one, the existing one is discarded.</div><a class="l" href="#pf12" data-dest-detail='[18,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892409px;bottom:1236.288916px;width:138.659798px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
