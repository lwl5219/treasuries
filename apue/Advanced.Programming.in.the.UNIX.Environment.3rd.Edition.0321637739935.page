<div id="pf3a7" class="pf w4 h1f" data-page-no="3a7"><div class="pc pc3a7 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg3a7.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>B.2<span class="_ _321"> </span>Standar<span class="ls30a">dE<span class="_ _55"></span><span class="ls0">rror <span class="_"> </span>Routines<span class="_ _1fb"> </span><span class="ff18">901</span></span></span></div><div class="t m0 x140 h57 y425 ff1a fs2d fc0 sc0 ls15c ws0">*P<span class="_ _1d"></span><span class="ls0">rint a message and return.</span></div><div class="t m0 x140 h57 y426 ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 x32 h57 y800 ff1a fs2d fc0 sc0 ls0 ws0">void</div><div class="t m0 x32 h57 y801 ff1a fs2d fc0 sc0 ls0 ws0">err_msg(const char *fmt, ...)</div><div class="t m0 x32 h57 y802 ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y803 ff1a fs2d fc0 sc0 ls0 ws0">va_list <span class="_ _15"> </span>ap;</div><div class="t m0 x8a h57 y16f9 ff1a fs2d fc0 sc0 ls0 ws0">va_start(ap, fmt);</div><div class="t m0 x8a h57 y16df ff1a fs2d fc0 sc0 ls0 ws0">err_doit(0, 0, fmt, ap);</div><div class="t m0 x8a h57 y16e0 ff1a fs2d fc0 sc0 ls0 ws0">va_end(ap);</div><div class="t m0 x32 h57 y16e1 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h57 y16fa ff1a fs2d fc0 sc0 ls0 ws0">/*</div><div class="t m0 x140 h57 y340f ff1a fs2d fc0 sc0 ls15c ws0">*F<span class="_ _1d"></span><span class="ls0">atal error unrelated to a system call.</span></div><div class="t m0 x140 h57 y3410 ff1a fs2d fc0 sc0 ls15c ws0">*P<span class="_ _1d"></span><span class="ls0">rint a message and terminate.</span></div><div class="t m0 x140 h57 y3411 ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 x32 h57 y3412 ff1a fs2d fc0 sc0 ls0 ws0">void</div><div class="t m0 x32 h57 y3811 ff1a fs2d fc0 sc0 ls0 ws0">err_quit(const char *fmt, ...)</div><div class="t m0 x32 h57 y3812 ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y3813 ff1a fs2d fc0 sc0 ls0 ws0">va_list <span class="_ _15"> </span>ap;</div><div class="t m0 x8a h57 y3415 ff1a fs2d fc0 sc0 ls0 ws0">va_start(ap, fmt);</div><div class="t m0 x8a h57 y3416 ff1a fs2d fc0 sc0 ls0 ws0">err_doit(0, 0, fmt, ap);</div><div class="t m0 x8a h57 y3417 ff1a fs2d fc0 sc0 ls0 ws0">va_end(ap);</div><div class="t m0 x8a h57 y3418 ff1a fs2d fc0 sc0 ls0 ws0">exit(1);</div><div class="t m0 x32 h57 y16ed ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h57 y131d ff1a fs2d fc0 sc0 ls0 ws0">/*</div><div class="t m0 x140 h57 y131e ff1a fs2d fc0 sc0 ls15c ws0">*P<span class="_ _1d"></span><span class="ls0">rint a message and return to caller.</span></div><div class="t m0 x140 h57 y131f ff1a fs2d fc0 sc0 ls15c ws0">*C<span class="_ _1d"></span><span class="ls0">aller specifies &quot;errnoflag&quot;.</span></div><div class="t m0 x140 h57 y1320 ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 x32 h57 y1321 ff1a fs2d fc0 sc0 ls0 ws0">static void</div><div class="t m0 x32 h57 y1322 ff1a fs2d fc0 sc0 ls0 ws0">err_doit(int errnoflag, int error, const char *fmt, va_list ap)</div><div class="t m0 x32 h57 y3419 ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y341a ff1a fs2d fc0 sc0 ls0 ws0">char <span class="_ _68"> </span>buf[MAXLINE];</div><div class="t m0 x8a h57 y16f1 ff1a fs2d fc0 sc0 ls0 ws0">vsnprintf(buf, MAXLINE-1, fmt, ap);</div><div class="t m0 x8a h57 y16f2 ff1a fs2d fc0 sc0 ls0 ws0">if (errnoflag)</div><div class="t m0 x9d h57 y335b ff1a fs2d fc0 sc0 ls0 ws0">snprintf(buf+strlen(buf), MAXLINE-strlen(buf)-1, &quot;: %s&quot;,</div><div class="t m0 x76 h57 y335c ff1a fs2d fc0 sc0 ls0 ws0">strerror(error));</div><div class="t m0 x8a h57 y335d ff1a fs2d fc0 sc0 ls0 ws0">strcat(buf, &quot;\n&quot;);</div><div class="t m0 x8a h57 y335e ff1a fs2d fc0 sc0 ls0 ws0">fflush(stdout); <span class="_ _15"> </span>/*<span class="_"> </span>in case stdout and stderr are the same */</div><div class="t m0 x8a h57 y335f ff1a fs2d fc0 sc0 ls0 ws0">fputs(buf, stderr);</div><div class="t m0 x8a h57 y3360 ff1a fs2d fc0 sc0 ls0 ws0">fflush(NULL); <span class="_ _189"> </span>/*<span class="_"> </span>flushes all stdio output streams */</div><div class="t m0 x32 h57 y3361 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x9f h2d y5fbd ff18 fs10 fc0 sc0 ls0 ws0">Figure B.3<span class="_ _5a"> </span><span class="ff19">Error functions that output to standar<span class="ls136">de<span class="_ _5"></span><span class="ls0">rror</span></span></span></div><div class="t m0 x3f h4d y5fbe ff19 fs26 fc0 sc0 ls0 ws0">Figur<span class="ls17f1">eB<span class="_ _43"></span><span class="ls0">.4 <span class="_ _23"></span>shows <span class="_ _23"> </span>the<span class="_ _35"> </span><span class="ff1a">log_XXX<span class="_ _35"> </span></span>error <span class="_ _23"> </span>functions.<span class="_ _51"> </span>These <span class="_ _42"> </span>requir<span class="_ _0"></span><span class="ls17f2">et<span class="_ _43"></span><span class="ls0">he <span class="_ _23"> </span>caller <span class="_ _42"> </span>to <span class="_ _23"> </span>deﬁne</span></span></span></span></div><div class="t m0 x32 h4d y5fbf ff19 fs26 fc0 sc0 ls0 ws0">the <span class="_ _e"> </span>variable<span class="_ _59"> </span><span class="ff1a">log_to_stderr<span class="_ _59"> </span></span>and <span class="_"> </span>set <span class="_ _53"> </span>it <span class="_"> </span>nonzer<span class="_ _0"></span>o<span class="_ _59"> </span>if<span class="_ _4b"> </span>the <span class="_"> </span>pr<span class="_ _0"></span>ocess <span class="_ _e"> </span>is <span class="_"> </span>not <span class="_ _e"> </span>running <span class="_ _e"> </span>as <span class="_"> </span>a</div><div class="t m0 x32 h49 y5fc0 ff19 fs26 fc0 sc0 ls0 ws0">daemon. <span class="_ _60"> </span>In<span class="_ _60"> </span>this <span class="_ _46"> </span>case, <span class="_ _61"> </span>the <span class="_ _46"> </span>error <span class="_ _59"> </span>messages <span class="_ _46"> </span>ar<span class="ls17f3">es<span class="_ _49"></span><span class="ls0">ent <span class="_ _46"> </span>to <span class="_ _61"> </span>standar<span class="ls17f3">de<span class="_ _49"></span><span class="ls0">rror<span class="_ _6"></span><span class="ls17f4">.I<span class="_ _4e"></span><span class="ls17f3">ft<span class="_ _49"></span><span class="ls0">he</span></span></span></span></span></span></span></div><div class="t m0 x32 h4d y5fc1 ff1a fs26 fc0 sc0 ls0 ws0">log_to_stderr<span class="_ _80"> </span><span class="ff19">ﬂag is 0, the<span class="_"> </span></span>syslog<span class="_ _66"> </span><span class="ff19">facility (Section 13.4) is used.</span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
