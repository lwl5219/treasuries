<div id="pf199" class="pf w4 h1f" data-page-no="199"><div class="pc pc199 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg199.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h7a ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>10.19<span class="_ _21f"> </span><span class="ff1a">sleep</span>,<span class="_ _4b"> </span><span class="ff1a">nanosleep</span><span class="ls30a">,a<span class="_ _55"></span><span class="ls0">nd<span class="_ _4b"> </span><span class="ff1a">clock_nanosleep<span class="_ _4b"> </span></span>Functions<span class="_ _1b"> </span><span class="ff18">375</span></span></span></div><div class="t m0 x32 h2a y12f ff19 fsf fc0 sc0 ls0 ws0">to sleep <span class="_ _2"></span>in <span class="_ _2"></span>seconds <span class="_ _2"></span>and nanoseconds.<span class="_ _61"> </span>If <span class="_ _2"></span>the <span class="_ _2"></span>sleep interval <span class="_ _2"></span>is <span class="_ _2"></span>interrupted by <span class="_ _2"></span>a <span class="_ _2"></span>signal <span class="_ _2"></span>and</div><div class="t m0 x32 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _44"> </span>pr<span class="_ _0"></span>ocess <span class="_ _44"> </span>doesn’t <span class="_ _35"> </span>terminate, <span class="_ _44"> </span>the<span class="_ _54"> </span><span class="ff1a">timespec<span class="_ _54"> </span></span>structur<span class="lsd34">ep<span class="_ _52"></span><span class="ls0">ointed <span class="_ _35"> </span>to <span class="_ _44"> </span>by <span class="_ _44"> </span>the<span class="_ _54"> </span><span class="ff1b ls45">re<span class="ls0">mtp</span></span></span></span></div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">parameter <span class="_ _23"></span>will <span class="_ _23"></span>be <span class="_ _23"></span>set <span class="_ _23"></span>to <span class="_ _23"></span>the <span class="_ _23"></span>amount <span class="_ _9"></span>of <span class="_ _23"> </span>time <span class="_ _23"> </span>left <span class="_ _23"> </span>in <span class="_ _23"> </span>the <span class="_ _23"> </span>sleep <span class="_ _23"> </span>interval.<span class="_ _51"> </span><span class="ls5f">We <span class="_ _47"> </span>c<span class="_ _9"></span></span>an <span class="_ _23"> </span>set <span class="_ _23"> </span>this</div><div class="t m0 x32 h26 y132 ff19 fsf fc0 sc0 ls0 ws0">parameter to<span class="_"> </span><span class="ff1a">NULL<span class="_ _80"> </span></span>if we ar<span class="ls44">eu<span class="_ _d"></span><span class="ls0">ninterested in the time unslept.</span></span></div><div class="t m0 x3f h2a y133 ff19 fsf fc0 sc0 ls0 ws0">If <span class="_ _35"> </span>the <span class="_ _44"> </span>system <span class="_ _35"> </span>doesn’t <span class="_ _44"> </span>support <span class="_ _35"> </span>nanosecond <span class="_ _35"> </span>granularity<span class="_ _6"></span><span class="lsd35">,t<span class="_ _7"></span><span class="ls0">he <span class="_ _35"> </span>requested <span class="_ _35"> </span>time <span class="_ _44"> </span>is</span></span></div><div class="t m0 x32 h26 y134 ff19 fsf fc0 sc0 ls45 ws0">ro<span class="ls0">unded <span class="_ _42"> </span>up.<span class="_ _51"> </span>Because <span class="_ _42"> </span>the<span class="_ _35"> </span><span class="ff1a">nanosleep<span class="_ _35"> </span></span>function <span class="_ _23"> </span>doesn’t <span class="_ _42"> </span>involve <span class="_ _23"> </span>the <span class="_ _42"> </span>generation <span class="_ _23"> </span>of <span class="_ _42"> </span>any</span></div><div class="t m0 x32 h2a y135 ff19 fsf fc0 sc0 ls0 ws0">signals, we can use it without worrying about interactions with other functions.</div><div class="t m0 x76 h52 y3000 ff19 fs2a fc0 sc0 ls0 ws0">The<span class="_"> </span><span class="ff1a">nanosleep<span class="_ _e"> </span></span>function used to belong to the Timers option in the Single UNIX Speciﬁcation,</div><div class="t m0 x76 h51 y3001 ff19 fs2a fc0 sc0 ls0 ws0">but was moved to the base in SUSv4.</div><div class="t m0 x3f h2a y3002 ff19 fsf fc0 sc0 ls65 ws0">Wi<span class="_ _3"></span><span class="ls0">th <span class="_ _2"></span>the <span class="_ _2"></span>introduction of <span class="_ _2"></span>multiple <span class="_ _2"></span>system <span class="_ _2"></span>clocks <span class="_ _2"></span>(recall <span class="_ _2"></span>Section <span class="_ _2"></span>6.10), <span class="_ _2"></span>we <span class="_ _2"></span>need <span class="_ _2"></span>a <span class="_ _2"></span>way</span></div><div class="t m0 x32 h2a y3003 ff19 fsf fc0 sc0 ls0 ws0">to <span class="_ _53"> </span>suspend <span class="_ _e"> </span>the <span class="_ _e"> </span>calling <span class="_ _e"> </span>thread <span class="_ _53"> </span>using <span class="_ _e"> </span>a <span class="_ _e"> </span>delay <span class="_ _e"> </span>time <span class="_ _e"> </span>relative <span class="_ _53"> </span>to <span class="_ _e"> </span>a <span class="_ _53"> </span>particular <span class="_"> </span>clock.<span class="_ _54"> </span>The</div><div class="t m0 x32 h26 y3004 ff1a fsf fc0 sc0 ls0 ws0">clock_nanosleep<span class="_ _80"> </span><span class="ff19">function provides us with this capability<span class="_ _4"></span>.</span></div><div class="t m0 x21 h57 y3005 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;time.h&gt;</div><div class="t m0 x21 h57 y3006 ff1a fs2d fc0 sc0 ls0 ws0">int clock_nanosleep(clockid_t<span class="_"> </span><span class="ff1b">clock_id</span><span class="ls15c">,i<span class="_ _1d"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">ﬂags</span>,</span></span></div><div class="t m0 xa6 h57 y3007 ff1a fs2d fc0 sc0 ls0 ws0">const struct timespec *<span class="ff1b ls1e7">re<span class="ls0">qtp</span></span><span class="ls15c">,s<span class="_ _5b"></span><span class="ls0">truct timespec *<span class="ff1b ls1e7">re<span class="ls0">mtp</span></span>);</span></span></div><div class="t m0 x128 h5f y3008 ff19 fs2d fc0 sc0 ls0 ws0">Returns: 0 if slept for requested time or err<span class="_ _0"></span>or number on failure</div><div class="t m0 x32 h4a y3009 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _4b"> </span><span class="ff1b">clock_id<span class="_ _44"> </span></span>argument <span class="_ _53"> </span>speciﬁes <span class="_ _e"> </span>the <span class="_ _53"> </span>clock <span class="_ _e"> </span>against <span class="_ _53"> </span>which <span class="_ _e"> </span>the <span class="_ _53"> </span>time <span class="_ _e"> </span>delay <span class="_ _53"> </span>is <span class="_ _e"> </span>evaluated.</div><div class="t m0 x32 h4a y300a ff19 fs26 fc0 sc0 ls0 ws0">Identiﬁers <span class="_ _e"> </span>for <span class="_"> </span>clocks <span class="_ _53"> </span>ar<span class="lsd36">el<span class="_ _55"></span><span class="ls0">isted <span class="_ _e"> </span>in <span class="_"> </span>Figur<span class="_ _1"></span><span class="lsd36">e6<span class="_ _55"></span><span class="ls0">.8. <span class="_ _59"> </span>The<span class="_ _59"> </span><span class="ff1b">ﬂags<span class="_ _4b"> </span></span>argument <span class="_ _e"> </span>is <span class="_"> </span>used <span class="_ _53"> </span>to <span class="_"> </span>contr<span class="_ _0"></span>ol</span></span></span></span></div><div class="t m0 x32 h4a y300b ff19 fs26 fc0 sc0 ls0 ws0">whether the <span class="_ _2"></span>delay <span class="_ _2"></span>is absolute <span class="_ _2"></span>or <span class="_ _2"></span>relative. <span class="_"> </span>When<span class="_"> </span><span class="ff1b">ﬂags<span class="_ _47"> </span></span>is set <span class="_ _2"></span>to 0, <span class="_ _2"></span>the <span class="_ _2"></span>sleep time <span class="_ _2"></span>is <span class="_ _2"></span>relative</div><div class="t m0 x32 h4d y300c ff19 fs26 fc0 sc0 ls0 ws0">(i.e., <span class="_ _3"></span>how <span class="_ _9"></span>long <span class="_ _9"></span>we <span class="_ _9"></span>want <span class="_ _3"></span>to <span class="_ _9"></span>sleep).<span class="_ _5a"> </span>When <span class="_ _3"></span>it <span class="_ _9"></span>is <span class="_ _9"></span>set <span class="_ _3"></span>to<span class="_ _45"> </span><span class="ff1a">TIMER_ABSTIME</span><span class="lsd37">,t<span class="_ _b"></span><span class="ls0">he <span class="_ _9"></span>sleep <span class="_ _9"></span>time <span class="_ _9"></span>is</span></span></div><div class="t m0 x32 h49 y300d ff19 fs26 fc0 sc0 ls0 ws0">absolute (i.e., we want to sleep until the clock reaches the speciﬁed time).</div><div class="t m0 x3f h4d y300e ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _9"></span>other <span class="_ _3"></span>arguments,<span class="_ _45"> </span><span class="ff1b lscc">re<span class="ls0">qtp<span class="_ _45"> </span></span></span>and<span class="_ _45"> </span><span class="ff1b lscc">re<span class="ls0">mtp</span></span><span class="lsd38">,a<span class="_ _b"></span><span class="lscc">re <span class="_ _23"> </span>t<span class="_ _2"></span><span class="ls0">he <span class="_ _9"></span>same <span class="_ _9"></span>as <span class="_ _3"></span>in <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">nanosleep<span class="_ _45"> </span></span>function.</span></span></span></div><div class="t m0 x32 h4a y300f ff19 fs26 fc0 sc0 ls0 ws0">However<span class="_ _6"></span><span class="lsd39">,w<span class="_ _4f"></span><span class="ls0">hen <span class="_ _3"></span>we <span class="_ _2"></span>use <span class="_ _2"></span>an <span class="_ _3"></span>absolute <span class="_ _2"></span>time, <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1b lscc">re<span class="ls0">mtp<span class="_ _47"> </span></span></span>argument is <span class="_ _3"></span>unused, <span class="_ _2"></span>because <span class="_ _3"></span>it <span class="_ _2"></span>isn’t</span></span></div><div class="t m0 x32 h4a y3010 ff19 fs26 fc0 sc0 ls0 ws0">needed; <span class="_ _e"> </span>we <span class="_"> </span>can <span class="_ _53"> </span>reuse <span class="_ _e"> </span>the <span class="_ _e"> </span>same <span class="_"> </span>value <span class="_ _53"> </span>for <span class="_"> </span>the<span class="_ _4b"> </span><span class="ff1b lscc">re<span class="ls0">qtp<span class="_ _59"> </span></span></span>argument <span class="_ _e"> </span>for <span class="_ _e"> </span>additional <span class="_"> </span>calls <span class="_ _53"> </span>to</div><div class="t m0 x32 h4d y3011 ff1a fs26 fc0 sc0 ls0 ws0">clock_nanosleep<span class="_ _80"> </span><span class="ff19">until the clock reaches the speciﬁed absolute time value.</span></div><div class="t m0 x3f h49 y3012 ff19 fs26 fc0 sc0 ls0 ws0">Note that except for error r<span class="_ _0"></span>eturns, the call</div><div class="t m0 x3f h4e y3013 ff1a fs28 fc0 sc0 ls0 ws0">clock_nanosleep(CLOCK_REALTIME, 0, reqtp, remtp);</div><div class="t m0 x32 h49 y3014 ff19 fs26 fc0 sc0 ls0 ws0">has the same effect as the call</div><div class="t m0 x3f h4e y3015 ff1a fs28 fc0 sc0 ls0 ws0">nanosleep(reqtp, remtp);</div><div class="t m0 x32 h49 y3016 ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _2"></span>problem with <span class="_ _2"></span>using <span class="_ _2"></span>a <span class="_ _2"></span>relative <span class="_ _2"></span>sleep <span class="_ _2"></span>is <span class="_ _2"></span>that <span class="_ _2"></span>some <span class="_ _2"></span>applications <span class="_ _2"></span>requir<span class="_ _0"></span><span class="lsd3a">ep<span class="_ _4f"></span><span class="lscc">re<span class="_ _2"></span><span class="ls0">cision <span class="_ _2"></span>with</span></span></span></div><div class="t m0 x32 h49 y3017 ff19 fs26 fc0 sc0 ls0 ws0">how <span class="_ _2"></span>long <span class="_ _3"></span>they <span class="_ _3"></span>sleep, <span class="_ _3"></span>and <span class="_ _3"></span>a <span class="_ _3"></span>relative <span class="_ _2"></span>sleep <span class="_ _3"></span>time <span class="_ _3"></span>can <span class="_ _3"></span>lead <span class="_ _3"></span>to <span class="_ _3"></span>sleeping <span class="_ _2"></span>longer <span class="_ _3"></span>than <span class="_ _3"></span>desired.</div><div class="t m0 x32 h49 y3018 ff19 fs26 fc0 sc0 ls0 ws0">For <span class="_ _42"> </span>example, <span class="_ _42"> </span>if <span class="_ _42"> </span>an <span class="_ _42"> </span>application <span class="_ _42"> </span>wants <span class="_ _42"> </span>to <span class="_ _53"> </span>perform <span class="_ _42"> </span>a <span class="_ _42"> </span>task <span class="_ _42"> </span>at <span class="_ _42"> </span>regular <span class="_ _42"> </span>intervals, <span class="_ _42"> </span>it <span class="_ _42"> </span>would</div><div class="t m0 x32 h49 y3019 ff19 fs26 fc0 sc0 ls0 ws0">have <span class="_ _2"></span>to <span class="_ _3"></span>get <span class="_ _2"></span>the <span class="_ _3"></span>current <span class="_ _2"></span>time, <span class="_ _3"></span>calculate <span class="_ _2"></span>the <span class="_ _3"></span>amount <span class="_ _3"></span>of <span class="_ _2"></span>time <span class="_ _3"></span>until <span class="_ _2"></span>the <span class="_ _3"></span>next <span class="_ _3"></span>time <span class="_ _2"></span>to <span class="_ _3"></span>execute</div><div class="t m0 x32 h4d y301a ff19 fs26 fc0 sc0 ls0 ws0">the <span class="_ _3"></span>task, <span class="_ _3"></span>and <span class="_ _9"></span>then <span class="_ _3"></span>call<span class="_ _45"> </span><span class="ff1a">nanosleep</span><span class="lsd3b">.B<span class="_ _62"></span><span class="ls0">etween <span class="_ _3"></span>the <span class="_ _9"></span>time <span class="_ _3"></span>that <span class="_ _9"></span>the <span class="_ _3"></span>current <span class="_ _3"></span>time <span class="_ _3"></span>is <span class="_ _3"></span>obtained</span></span></div><div class="t m0 x32 h4d y301b ff19 fs26 fc0 sc0 ls0 ws0">and <span class="_ _2"></span>the <span class="_ _3"></span>call <span class="_ _3"></span>to<span class="_ _47"> </span><span class="ff1a">nanosleep<span class="_ _47"> </span></span>is <span class="_ _2"></span>made, <span class="_ _3"></span>processor <span class="_ _2"></span>scheduling <span class="_ _2"></span>and <span class="_ _3"></span>preemption <span class="_ _2"></span>can <span class="_ _3"></span>result <span class="_ _2"></span>in</div><div class="t m0 x32 h49 y301c ff19 fs26 fc0 sc0 ls0 ws0">the <span class="_"> </span>r<span class="_ _0"></span>elative <span class="_ _e"> </span>sleep <span class="_"> </span>time <span class="_"> </span>extending <span class="_ _e"> </span>past <span class="_"> </span>the <span class="_ _e"> </span>desired <span class="_ _e"> </span>interval.<span class="_ _60"> </span>Using <span class="_"> </span>an <span class="_ _e"> </span>absolute <span class="_"> </span>time</div><div class="t m0 x32 h49 y301d ff19 fs26 fc0 sc0 ls0 ws0">improves <span class="_ _45"> </span>the <span class="_ _35"> </span>pr<span class="_ _0"></span>ecision, <span class="_ _35"> </span>even <span class="_ _45"> </span>though <span class="_ _35"> </span>a <span class="_ _45"> </span>time-sharing <span class="_ _35"> </span>process <span class="_ _45"> </span>scheduler <span class="_ _35"> </span>makes <span class="_ _45"> </span>no</div><div class="t m0 x32 h49 y301e ff19 fs26 fc0 sc0 ls0 ws0">guarantee that our task will execute immediately after our sleep time has ended.</div><div class="t m0 x76 h5e y301f ff19 fs10 fc0 sc0 ls0 ws0">In <span class="_ _2"></span>older <span class="_ _3"></span>versions <span class="_ _3"></span>of <span class="_ _2"></span>the <span class="_ _3"></span>Single <span class="_ _3"></span>UNIX <span class="_ _3"></span>Speciﬁcation, <span class="_ _2"></span>the<span class="_ _66"> </span><span class="ff1a">clock_nanosleep<span class="_ _80"> </span></span>function <span class="_ _3"></span>belonged</div><div class="t m0 x76 h2d y3020 ff19 fs10 fc0 sc0 ls0 ws0">to the Clock Selection option.<span class="_ _35"> </span>In SUSv4, it was moved to the base.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
