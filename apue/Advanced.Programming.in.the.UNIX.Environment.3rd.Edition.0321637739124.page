<div id="pf7c" class="pf w4 h1f" data-page-no="7c"><div class="pc pc7c w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg7c.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">90<span class="_ _1b"> </span><span class="ff19">File <span class="_"> </span>I/O<span class="_ _169"> </span>Chapter <span class="_"> </span>3</span></div><div class="t m0 x35 h53 y12f ff16 fs2b fc0 sc0 ls0 ws0">3.17 <span class="_ _93"> </span>Summary</div><div class="t m0 x32 h2a y681 ff19 fsf fc0 sc0 ls0 ws0">This <span class="_"> </span>chapter <span class="_"> </span>has <span class="_ _e"> </span>described <span class="_"> </span>the <span class="_"> </span>basic <span class="_"> </span>I/O <span class="_ _e"> </span>functions <span class="_"> </span>provided <span class="_"> </span>by <span class="_ _e"> </span>the <span class="_"> </span>UNIX <span class="_"> </span>System.</div><div class="t m0 x32 h26 y683 ff19 fsf fc0 sc0 ls0 ws0">These <span class="_"> </span>ar<span class="ls461">eo<span class="_ _5b"></span><span class="ls0">ften <span class="_ _66"> </span>called <span class="_ _66"> </span>the <span class="_ _66"> </span>unbuffer<span class="_ _0"></span>ed <span class="_"> </span>I/O <span class="_ _66"> </span>functions <span class="_ _66"> </span>because <span class="_ _66"> </span>each<span class="_ _61"> </span><span class="ff1a">read<span class="_ _46"> </span></span>or<span class="_ _46"> </span><span class="ff1a">write</span></span></span></div><div class="t m0 x32 h26 y685 ff19 fsf fc0 sc0 ls0 ws0">invokes <span class="_ _23"></span>a <span class="_ _23"></span>system <span class="_ _23"></span>call <span class="_ _23"></span>into <span class="_ _23"></span>the <span class="_ _23"></span>kernel.<span class="_ _5a"> </span>Using <span class="_ _23"> </span>only<span class="_ _35"> </span><span class="ff1a">read<span class="_ _35"> </span></span>and<span class="_ _45"> </span><span class="ff1a">write</span>,<span class="_ _35"> </span>we<span class="_ _35"> </span>looked <span class="_ _23"></span>at <span class="_ _23"></span>the</div><div class="t m0 x32 h2a y686 ff19 fsf fc0 sc0 ls0 ws0">effect of various <span class="_ _2"></span>I/O <span class="_ _2"></span>sizes <span class="_ _2"></span>on the <span class="_ _2"></span>amount <span class="_ _2"></span>of <span class="_ _2"></span>time required to <span class="_ _2"></span>read a <span class="_ _2"></span>ﬁle.<span class="_ _46"> </span><span class="ls5f">We <span class="_ _e"> </span>a<span class="_ _9"></span></span>lso <span class="_ _2"></span>looked</div><div class="t m0 x32 h2a y687 ff19 fsf fc0 sc0 ls0 ws0">at several ways to ﬂush <span class="_ _2"></span>written data to disk <span class="_ _2"></span>and their effect on application performance.</div><div class="t m0 x3f h2a y689 ff19 fsf fc0 sc0 ls0 ws0">Atomic <span class="_ _23"> </span>operations <span class="_ _42"> </span>wer<span class="ls462">ei<span class="_ _43"></span><span class="ls0">ntr<span class="_ _0"></span>oduced <span class="_ _23"> </span>when <span class="_ _23"> </span>multiple <span class="_ _42"> </span>processes <span class="_ _23"></span>append <span class="_ _23"> </span>to <span class="_ _42"> </span>the <span class="_ _23"> </span>same</span></span></div><div class="t m0 x32 h2a y68a ff19 fsf fc0 sc0 ls0 ws0">ﬁle <span class="_"> </span>and <span class="_"> </span>when <span class="_"> </span>multiple <span class="_"> </span>processes <span class="_"> </span>cr<span class="_ _0"></span>eate <span class="_"> </span>the <span class="_"> </span>same <span class="_"> </span>ﬁle.<span class="_ _60"> </span><span class="ls5f">We <span class="_ _44"> </span>a<span class="_ _23"></span></span>lso <span class="_"> </span>looked <span class="_"> </span>at <span class="_"> </span>the <span class="_"> </span>data</div><div class="t m0 x32 h2a y68b ff19 fsf fc0 sc0 ls0 ws0">structur<span class="_ _0"></span>es <span class="_ _53"> </span>used <span class="_ _e"> </span>by <span class="_ _53"> </span>the <span class="_ _e"> </span>kernel <span class="_ _e"> </span>to <span class="_ _53"> </span>shar<span class="ls463">ei<span class="_ _55"></span><span class="ls0">nformation <span class="_ _e"> </span>about <span class="_ _53"> </span>open <span class="_ _e"> </span>ﬁles.<span class="_ _65"> </span><span class="ls5f">We<span class="_ _23"></span></span>’ll <span class="_ _53"> </span>return <span class="_ _53"> </span>to</span></span></div><div class="t m0 x32 h2a y68c ff19 fsf fc0 sc0 ls0 ws0">these data structur<span class="_ _0"></span>es later in the text.</div><div class="t m0 x3f h26 y68d ff19 fsf fc0 sc0 ls5f ws0">We <span class="_ _35"> </span>a<span class="_ _9"></span><span class="ls0">lso <span class="_ _e"> </span>described <span class="_ _e"> </span>the<span class="_ _4b"> </span><span class="ff1a">ioctl<span class="_ _4b"> </span></span>and<span class="_ _4b"> </span><span class="ff1a">fcntl<span class="_ _4b"> </span></span>functions. <span class="_ _59"> </span>W<span class="_ _6"></span><span class="ls464">er<span class="_ _4a"></span><span class="ls0">eturn <span class="_ _e"> </span>to <span class="_ _e"> </span>both <span class="_ _e"> </span>of <span class="_ _53"> </span>these</span></span></span></div><div class="t m0 x32 h26 y68e ff19 fsf fc0 sc0 ls0 ws0">functions <span class="_"> </span>later <span class="_ _53"> </span>in <span class="_"> </span>the <span class="_"> </span>book.<span class="_ _65"> </span>In <span class="_"> </span>Chapter <span class="_ _e"> </span>14, <span class="_"> </span>we’ll <span class="_ _e"> </span>use<span class="_ _59"> </span><span class="ff1a">fcntl<span class="_ _59"> </span></span>for <span class="_"> </span>recor<span class="_ _1"></span><span class="ls465">dl<span class="_ _55"></span><span class="ls0">ocking. <span class="_ _59"> </span>In</span></span></div><div class="t m0 x32 h26 y68f ff19 fsf fc0 sc0 ls0 ws0">Chapter 18 and Chapter 19, we’ll use<span class="_"> </span><span class="ff1a">ioctl<span class="_ _80"> </span></span>when we deal with terminal devices.</div><div class="t m0 x32 h53 ydc0 ff16 fs2b fc0 sc0 ls0 ws0">Exer<span class="_ _0"></span>cises</div><div class="t m0 x32 h5f ydc1 ff18 fs2d fc0 sc0 ls0 ws0">3.1<span class="_ _6e"> </span><span class="ff19">When <span class="_"> </span>reading <span class="_"> </span>or <span class="_"> </span>writing <span class="_"> </span>a <span class="_"> </span>disk <span class="_"> </span>ﬁle, <span class="_"> </span>ar<span class="ls466">et<span class="_ _55"></span><span class="ls0">he <span class="_"> </span>functions <span class="_"> </span>described <span class="_"> </span>in <span class="_"> </span>this <span class="_"> </span>chapter <span class="_"> </span>really</span></span></span></div><div class="t m0 x90 h5f ydc2 ff19 fs2d fc0 sc0 ls0 ws0">unbuffer<span class="_ _0"></span>ed? <span class="_"> </span>Explain.</div><div class="t m0 x32 h57 ydc3 ff18 fs2d fc0 sc0 ls0 ws0">3.2<span class="_ _6e"> </span><span class="ff19 ls467">Wr<span class="_ _9"></span><span class="ls0">ite <span class="_ _3"></span>your <span class="_ _9"></span>own<span class="_ _47"> </span><span class="ff1a">dup2<span class="_ _66"> </span></span>function <span class="_ _9"></span>that <span class="_ _3"></span>behaves <span class="_ _9"></span>the <span class="_ _3"></span>same <span class="_ _9"></span>way <span class="_ _3"></span>as <span class="_ _9"></span>the<span class="_ _47"> </span><span class="ff1a">dup2<span class="_ _47"> </span></span>function <span class="_ _3"></span>described</span></span></div><div class="t m0 x90 h57 ydc4 ff19 fs2d fc0 sc0 ls0 ws0">in Section 3.12, without calling the<span class="_"> </span><span class="ff1a">fcntl<span class="_ _e"> </span></span>function. <span class="_"> </span>Be<span class="_"> </span>sure<span class="_"> </span>to<span class="_"> </span>handle errors corr<span class="_ _0"></span>ectly<span class="_ _6"></span>.</div><div class="t m0 x32 h5f ydc5 ff18 fs2d fc0 sc0 ls0 ws0">3.3<span class="_ _6e"> </span><span class="ff19">Assume that a process executes the following three function calls:</span></div><div class="t m0 x138 h57 ydc6 ff1a fs2d fc0 sc0 ls0 ws0">fd1 = open(path, oflags);</div><div class="t m0 x138 h57 ydc7 ff1a fs2d fc0 sc0 ls0 ws0">fd2 = dup(fd1);</div><div class="t m0 x138 h57 ydc8 ff1a fs2d fc0 sc0 ls0 ws0">fd3 = open(path, oflags);</div><div class="t m0 x90 h5f ydc9 ff19 fs2d fc0 sc0 ls0 ws0">Draw <span class="_ _53"> </span>the <span class="_"> </span>r<span class="_ _0"></span>esulting <span class="_"> </span>pictur<span class="_ _1"></span>e, <span class="_"> </span>similar <span class="_ _53"> </span>to <span class="_"> </span>Figur<span class="_ _0"></span><span class="ls468">e3<span class="_ _c"></span><span class="ls0">.9. <span class="_ _44"> </span>Which<span class="_ _4b"> </span>descriptors <span class="_ _53"> </span>ar<span class="ls468">ea<span class="_ _c"></span><span class="ls1e7">ff<span class="_ _2"></span><span class="ls0">ected <span class="_ _53"> </span>by <span class="_"> </span>an</span></span></span></span></span></div><div class="t m0 x90 h57 ydca ff1a fs2d fc0 sc0 ls0 ws0">fcntl<span class="_ _66"> </span><span class="ff19">on<span class="_ _66"> </span></span>fd1<span class="_ _66"> </span><span class="ff19">with <span class="_ _3"></span>a <span class="_ _2"></span>command <span class="_ _3"></span>of<span class="_ _66"> </span></span>F_SETFD<span class="ff19 ls469">?W<span class="_ _4a"></span><span class="ls0">hich <span class="_ _3"></span>descriptors <span class="_ _2"></span>ar<span class="ls46a">ea<span class="_ _4f"></span><span class="ls1e7">ff<span class="_ _2"></span><span class="ls0">ected <span class="_ _3"></span>by <span class="_ _2"></span>an<span class="_ _47"> </span><span class="ff1a">fcntl</span></span></span></span></span></span></div><div class="t m0 x90 h57 ydcb ff19 fs2d fc0 sc0 ls0 ws0">on<span class="_"> </span><span class="ff1a">fd1<span class="_ _e"> </span></span>with a command of<span class="_"> </span><span class="ff1a">F_SETFL</span>?</div><div class="t m0 x32 h5f ydcc ff18 fs2d fc0 sc0 ls0 ws0">3.4<span class="_ _6e"> </span><span class="ff19">The following sequence of code has been observed in various programs:</span></div><div class="t m0 x138 h57 ydcd ff1a fs2d fc0 sc0 ls0 ws0">dup2(fd, 0);</div><div class="t m0 x138 h57 ydce ff1a fs2d fc0 sc0 ls0 ws0">dup2(fd, 1);</div><div class="t m0 x138 h57 ydcf ff1a fs2d fc0 sc0 ls0 ws0">dup2(fd, 2);</div><div class="t m0 x138 h57 ydd0 ff1a fs2d fc0 sc0 ls0 ws0">if (fd &gt; 2)</div><div class="t m0 x1d h57 ydd1 ff1a fs2d fc0 sc0 ls0 ws0">close(fd);</div><div class="t m0 x90 h57 ydd2 ff19 fs2d fc0 sc0 ls32e ws0">To <span class="_ _42"> </span>s<span class="_ _9"></span><span class="ls0">ee why the<span class="_ _80"> </span><span class="ff1a">if<span class="_ _80"> </span></span>test is needed, assume that<span class="_ _80"> </span><span class="ff1a">fd<span class="_ _80"> </span></span>is 1 and draw <span class="_ _2"></span>a picture<span class="_"> </span>of<span class="_"> </span>what happens to</span></div><div class="t m0 x90 h57 ydd3 ff19 fs2d fc0 sc0 ls0 ws0">the <span class="_ _9"></span>three <span class="_ _23"></span>descriptor <span class="_ _9"></span>entries <span class="_ _23"> </span>and <span class="_ _9"></span>the <span class="_ _23"> </span>corresponding <span class="_ _9"></span>ﬁle <span class="_ _23"> </span>table <span class="_ _23"></span>entry <span class="_ _9"></span>with <span class="_ _23"> </span>each <span class="_ _9"></span>call <span class="_ _23"> </span>to<span class="_ _45"> </span><span class="ff1a">dup2</span>.</div><div class="t m0 x90 h57 ydd4 ff19 fs2d fc0 sc0 ls0 ws0">Then assume that<span class="_"> </span><span class="ff1a">fd<span class="_ _e"> </span></span>is 3 and draw the same picture.</div><div class="t m0 x32 h5f ydd5 ff18 fs2d fc0 sc0 ls0 ws0">3.5<span class="_ _6e"> </span><span class="ff19">The Bourne shell, Bourne-again shell, and Korn shell notation</span></div><div class="t m0 x138 h57 ydd6 ff1b fs2d fc0 sc0 ls0 ws0">digit1<span class="_ _3"></span><span class="ff1a">&gt;&amp;<span class="_ _9"></span></span>digit2</div><div class="t m0 x90 h58 ydd7 ff19 fs2d fc0 sc0 ls0 ws0">says <span class="_ _2"></span>to <span class="_ _3"></span>redirect <span class="_ _2"></span>descriptor<span class="_ _66"> </span><span class="ff1b">digit1<span class="_ _66"> </span></span>to <span class="_ _3"></span>the <span class="_ _3"></span>same <span class="_ _2"></span>ﬁle <span class="_ _3"></span>as <span class="_ _3"></span>descriptor<span class="_ _66"> </span><span class="ff1b">digit2</span><span class="ls46b">.W<span class="_ _4a"></span><span class="ls0">hat <span class="_ _3"></span>is <span class="_ _3"></span>the <span class="_ _2"></span>difference</span></span></div><div class="t m0 x90 h5f ydd8 ff19 fs2d fc0 sc0 ls0 ws0">between <span class="_ _3"></span>the <span class="_ _9"></span>two <span class="_ _9"></span>commands <span class="_ _9"></span>shown <span class="_ _3"></span>below?<span class="_ _61"> </span>(Hint: <span class="_ _9"></span>The <span class="_ _9"></span>shells <span class="_ _3"></span>process <span class="_ _9"></span>their <span class="_ _3"></span>command <span class="_ _9"></span>lines</div><div class="t m0 x90 h5f ydd9 ff19 fs2d fc0 sc0 ls0 ws0">from left to right.)</div><div class="t m0 x138 h57 ydda ff1a fs2d fc0 sc0 ls0 ws0">./a.out &gt; outfile 2&gt;&amp;1</div><div class="t m0 x138 h57 yddb ff1a fs2d fc0 sc0 ls0 ws0">./a.out 2&gt;&amp;1 &gt; outfile</div><a class="l" href="#pfd" data-dest-detail='[13,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892409px;bottom:1236.288916px;width:90.803810px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
