<div id="pf1f8" class="pf w4 h1f" data-page-no="1f8"><div class="pc pc1f8 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg1f8.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">470<span class="_ _1b"> </span><span class="ff19">Daemon <span class="_"> </span>Processes <span class="_ _20f"> </span>Chapter<span class="_ _4b"> </span>13</span></div><div class="t m0 x32 h2a y12f ff19 fsf fc0 sc0 ls0 ws0">Ther<span class="ls44">ea<span class="_ _4f"></span><span class="ls45">re <span class="_ _3"></span>t<span class="ls0">hree ways to generate log messages:</span></span></span></div><div class="t m0 x3f h26 y3a24 ff19 fsf fc0 sc0 ls0 ws0">1. <span class="_ _51"> </span>Kernel<span class="_ _45"> </span><span class="ls45">ro<span class="_ _2"></span></span>utines <span class="_ _9"></span>can <span class="_ _23"></span>call <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">log<span class="_ _35"> </span></span>function. <span class="_ _45"> </span>These<span class="_ _45"> </span>messages <span class="_ _9"></span>can <span class="_ _23"></span>be <span class="_ _9"></span>read <span class="_ _9"></span>by <span class="_ _9"></span>any</div><div class="t m0 x41 h26 y2241 ff19 fsf fc0 sc0 ls0 ws0">user <span class="_ _3"></span>process <span class="_ _3"></span>that<span class="_ _45"> </span><span class="ff1a">open</span><span class="lsf78">sa<span class="_ _b"></span><span class="ls0">nd<span class="_ _45"> </span><span class="ff1a">read</span><span class="lsf78">st<span class="_ _b"></span><span class="ls0">he<span class="_ _45"> </span><span class="ff1a">/dev/klog<span class="_ _47"> </span></span>device. <span class="_ _45"> </span>W<span class="_ _6"></span><span class="lsc1d">ew<span class="_ _b"></span><span class="ls0">on’t <span class="_ _9"></span>describe</span></span></span></span></span></span></div><div class="t m0 x41 h2a yc35 ff19 fsf fc0 sc0 ls0 ws0">this function any further<span class="_ _6"></span><span class="ls44">,s<span class="_ _5"></span><span class="ls0">ince we’r<span class="ls44">en<span class="_ _4f"></span><span class="ls0">ot interested in writing kernel routines.</span></span></span></span></div><div class="t m0 x3f h26 y6fa ff19 fsf fc0 sc0 ls0 ws0">2. <span class="_ _51"> </span>Most<span class="_ _46"> </span>user <span class="_"> </span>processes <span class="_"> </span>(daemons) <span class="_"> </span>call <span class="_ _66"> </span>the<span class="_ _46"> </span><span class="ff1a">syslog</span></div><div class="t m0 x1d1 h2a y345 ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 x1c7 h2a y6fa ff19 fsf fc0 sc0 ls0 ws0">3</div><div class="t m0 x20b h2a y345 ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 x195 h2a y6fa ff19 fsf fc0 sc0 ls0 ws0">function <span class="_"> </span>to <span class="_"> </span>generate <span class="_ _66"> </span>log</div><div class="t m0 x41 h2a y6fb ff19 fsf fc0 sc0 ls0 ws0">messages. <span class="_ _47"> </span>W<span class="_ _6"></span><span class="ls52b">ed<span class="_ _8"></span><span class="ls0">escribe <span class="_ _3"></span>its <span class="_ _3"></span>calling <span class="_ _2"></span>sequence <span class="_ _3"></span>later<span class="_ _1"></span><span class="ls3e3">.T<span class="_ _1d"></span><span class="ls0">his <span class="_ _3"></span>causes <span class="_ _2"></span>the <span class="_ _3"></span>message <span class="_ _3"></span>to <span class="_ _3"></span>be</span></span></span></span></div><div class="t m0 x41 h26 y6fc ff19 fsf fc0 sc0 ls0 ws0">sent to the UNIX domain datagram socket<span class="_"> </span><span class="ff1a">/dev/log</span>.</div><div class="t m0 x3f h2a y3a25 ff19 fsf fc0 sc0 ls0 ws0">3. <span class="_ _51"> </span>A<span class="_ _47"> </span>user <span class="_ _3"></span>process <span class="_ _2"></span>on <span class="_ _3"></span>this <span class="_ _3"></span>host, <span class="_ _2"></span>or <span class="_ _3"></span>on <span class="_ _3"></span>some <span class="_ _3"></span>other <span class="_ _3"></span>host <span class="_ _3"></span>that <span class="_ _3"></span>is <span class="_ _2"></span>connected <span class="_ _3"></span>to <span class="_ _3"></span>this <span class="_ _3"></span>host</div><div class="t m0 x41 h2a y3a26 ff19 fsf fc0 sc0 ls0 ws0">by <span class="_ _23"></span>a <span class="_ _23"></span>TCP/IP <span class="_ _23"></span>network, <span class="_ _9"></span>can <span class="_ _23"> </span>send <span class="_ _23"> </span>log <span class="_ _23"> </span>messages <span class="_ _23"> </span>to <span class="_ _23"> </span>UDP <span class="_ _23"> </span>port <span class="_ _23"></span>514.<span class="_ _51"> </span>Note <span class="_ _23"></span>that <span class="_ _23"></span>the</div><div class="t m0 x41 h26 y3a27 ff1a fsf fc0 sc0 ls0 ws0">syslog<span class="_ _44"> </span><span class="ff19">function <span class="_ _42"> </span>never <span class="_ _53"> </span>generates <span class="_ _53"> </span>these <span class="_ _53"> </span>UDP <span class="_ _42"> </span>datagrams: <span class="_ _53"> </span>they <span class="_ _53"> </span>requir<span class="_ _0"></span><span class="lsf79">ee<span class="_ _c"></span><span class="ls0">xplicit</span></span></span></div><div class="t m0 x41 h2a y3a28 ff19 fsf fc0 sc0 ls0 ws0">network programming by the pr<span class="_ _0"></span>ocess generating the log message.</div><div class="t m0 x32 h2a y1b2 ff19 fsf fc0 sc0 ls0 ws0">Refer <span class="_ _42"> </span>to <span class="_ _42"> </span>Stevens, <span class="_ _42"> </span>Fenner<span class="_ _6"></span><span class="lsf7a">,a<span class="_ _43"></span><span class="ls0">nd <span class="_ _42"> </span>Rudoff</span></span></div><div class="t m0 x87 h2a y14b1 ff19 fsf fc0 sc0 ls0 ws0">[</div><div class="t m0 x6c h2a y1b2 ff19 fsf fc0 sc0 ls0 ws0">2004</div><div class="t m0 x129 h2a y14b1 ff19 fsf fc0 sc0 ls0 ws0">]</div><div class="t m0 x74 h2a y1b2 ff19 fsf fc0 sc0 ls0 ws0">for <span class="_ _42"> </span>details <span class="_ _42"> </span>on <span class="_ _42"> </span>UNIX <span class="_ _23"> </span>domain <span class="_ _42"> </span>sockets <span class="_ _42"> </span>and</div><div class="t m0 x32 h2a y1b3 ff19 fsf fc0 sc0 ls0 ws0">UDP sockets.</div><div class="t m0 x3f h26 y1b4 ff19 fsf fc0 sc0 ls0 ws0">Normally<span class="_ _4"></span><span class="lsf7b">,t<span class="_ _d"></span><span class="ls0">he<span class="_ _66"> </span><span class="ff1a">syslogd<span class="_ _66"> </span></span>daemon <span class="_ _2"></span>reads all three forms <span class="_ _2"></span>of <span class="_ _2"></span>log <span class="_ _2"></span>messages.<span class="_ _46"> </span>On <span class="_ _2"></span>start-up,</span></span></div><div class="t m0 x32 h26 y1b5 ff19 fsf fc0 sc0 ls0 ws0">this <span class="_ _2"></span>daemon <span class="_ _2"></span>reads a <span class="_ _2"></span>conﬁguration <span class="_ _2"></span>ﬁle, <span class="_ _2"></span>usually<span class="_ _66"> </span><span class="ff1a">/etc/syslog.conf</span><span class="ls8be">,w<span class="_ _d"></span><span class="ls0">hich <span class="_ _2"></span>determines</span></span></div><div class="t m0 x32 h2a y1b6 ff19 fsf fc0 sc0 ls0 ws0">wher<span class="ls271">ed<span class="_ _4f"></span><span class="ls0">iffer<span class="_ _0"></span>ent classes <span class="_ _2"></span>of messages <span class="_ _2"></span>are<span class="_"> </span>to<span class="_"> </span>be<span class="_ _66"> </span>sent. <span class="_ _66"> </span>For<span class="_ _66"> </span>example, <span class="_ _2"></span>urgent messages can <span class="_ _2"></span>be</span></span></div><div class="t m0 x32 h2a y1b7 ff19 fsf fc0 sc0 ls0 ws0">sent <span class="_ _53"> </span>to <span class="_ _e"> </span>the <span class="_ _e"> </span>system <span class="_ _53"> </span>administrator <span class="_ _e"> </span>(if <span class="_ _e"> </span>logged <span class="_ _e"> </span>in) <span class="_ _53"> </span>and <span class="_ _e"> </span>printed <span class="_ _e"> </span>on <span class="_ _e"> </span>the <span class="_ _53"> </span>console, <span class="_ _e"> </span>whereas</div><div class="t m0 x32 h2a y3a29 ff19 fsf fc0 sc0 ls0 ws0">warnings may be logged to a ﬁle.</div><div class="t m0 x3f h26 y3a2a ff19 fsf fc0 sc0 ls0 ws0">Our interface to this facility is through the<span class="_"> </span><span class="ff1a">syslog<span class="_ _80"> </span></span>function.</div><div class="t m0 x3f h57 y3a2b ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;syslog.h&gt;</div><div class="t m0 x3f h57 y3a2c ff1a fs2d fc0 sc0 ls0 ws0">void openlog(const char *<span class="ff1b">ident</span><span class="ls15c">,i<span class="_ _1d"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">option</span><span class="ls15c">,i<span class="_ _5b"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">facility</span>);</span></span></span></span></div><div class="t m0 x3f h57 y3a2d ff1a fs2d fc0 sc0 ls0 ws0">void syslog(int<span class="_"> </span><span class="ff1b">priority</span><span class="ls15c">,c<span class="_ _1d"></span><span class="ls0">onst char *<span class="ff1b">format</span><span class="ls15c">,.<span class="_ _5b"></span><span class="ls0">..);</span></span></span></span></div><div class="t m0 x3f h57 y3a2e ff1a fs2d fc0 sc0 ls0 ws0">void closelog(void);</div><div class="t m0 x3f h57 y3a2f ff1a fs2d fc0 sc0 ls0 ws0">int setlogmask(int<span class="_"> </span><span class="ff1b">maskpri</span>);</div><div class="t m0 x107 h5f y3a30 ff19 fs2d fc0 sc0 ls0 ws0">Returns: previous log priority mask value</div><div class="t m0 x32 h4d y3a31 ff19 fs26 fc0 sc0 ls0 ws0">Calling<span class="_ _66"> </span><span class="ff1a">openlog<span class="_ _66"> </span></span>is <span class="_ _2"></span>optional.<span class="_ _61"> </span>If <span class="_ _2"></span>it’s <span class="_ _2"></span>not <span class="_ _2"></span>called, <span class="_ _2"></span>the <span class="_ _2"></span>ﬁrst <span class="_ _2"></span>time<span class="_ _47"> </span><span class="ff1a">syslog<span class="_ _66"> </span></span>is <span class="_ _2"></span>called,<span class="_ _47"> </span><span class="ff1a">openlog</span></div><div class="t m0 x32 h4d y3a32 ff19 fs26 fc0 sc0 ls0 ws0">is <span class="_ _2"></span>called <span class="_ _2"></span>automatically<span class="_ _6"></span><span class="lsf7c">.C<span class="_ _1d"></span><span class="ls0">alling<span class="_ _47"> </span><span class="ff1a">closelog<span class="_ _47"> </span></span>is <span class="_ _2"></span>also <span class="_ _2"></span>optional<span class="_ _9"></span><span class="ls161">—i<span class="_ _1"></span><span class="lsf7d">tj<span class="_ _4f"></span><span class="ls0">ust <span class="_ _2"></span>closes <span class="_ _2"></span>the <span class="_ _3"></span>descriptor</span></span></span></span></span></div><div class="t m0 x32 h4d y3a33 ff19 fs26 fc0 sc0 ls0 ws0">that was being used to communicate with the<span class="_"> </span><span class="ff1a">syslogd<span class="_ _80"> </span></span>daemon.</div><div class="t m0 x3f h4d y3a34 ff19 fs26 fc0 sc0 ls0 ws0">Calling<span class="_ _47"> </span><span class="ff1a">openlog<span class="_ _47"> </span></span>lets <span class="_ _3"></span>us <span class="_ _3"></span>specify <span class="_ _3"></span>an<span class="_ _47"> </span><span class="ff1b">ident<span class="_ _45"> </span></span>that <span class="_ _2"></span>is <span class="_ _3"></span>added <span class="_ _3"></span>to <span class="_ _3"></span>each <span class="_ _3"></span>log <span class="_ _3"></span>message.<span class="_ _16"> </span>This <span class="_ _3"></span>is</div><div class="t m0 x32 h4d y3a35 ff19 fs26 fc0 sc0 ls0 ws0">normally <span class="_"> </span>the <span class="_"> </span>name <span class="_ _66"> </span>of <span class="_ _66"> </span>the <span class="_ _66"> </span>program <span class="_"> </span>(e.g.<span class="_ _60"> </span><span class="ff1a">cron</span>,<span class="_ _46"> </span><span class="ff1a">inetd</span>). <span class="_ _61"> </span>The<span class="_ _46"> </span><span class="ff1b">option<span class="_ _46"> </span></span>argument <span class="_"> </span>is <span class="_"> </span>a</div><div class="t m0 x32 h49 y3a36 ff19 fs26 fc0 sc0 ls0 ws0">bitmask <span class="_ _44"> </span>specifying <span class="_ _4b"> </span>various <span class="_ _44"> </span>options.<span class="_ _93"> </span>Figur<span class="lsf7e">e1<span class="_ _52"></span><span class="ls0">3.3 <span class="_ _44"> </span>describes <span class="_ _44"> </span>the <span class="_ _4b"> </span>available <span class="_ _44"> </span>options,</span></span></div><div class="t m0 x32 h4d y3a37 ff19 fs26 fc0 sc0 ls0 ws0">including <span class="_ _2"></span>a <span class="_ _2"></span>bullet <span class="_ _2"></span>in <span class="_ _3"></span>the <span class="_ _2"></span>XSI <span class="_ _2"></span>column <span class="_ _3"></span>if <span class="_ _2"></span>the <span class="_ _2"></span>option <span class="_ _2"></span>is <span class="_ _3"></span>included <span class="_ _2"></span>in <span class="_ _2"></span>the<span class="_ _47"> </span><span class="ff1a">openlog<span class="_ _47"> </span></span>deﬁnition</div><div class="t m0 x32 h49 y3a38 ff19 fs26 fc0 sc0 ls0 ws0">in the Single UNIX Speciﬁcation.</div><div class="t m0 x3f h4d y3a39 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _45"> </span><span class="ff1b">facility<span class="_ _45"> </span></span>argument <span class="_ _9"></span>for<span class="_ _45"> </span><span class="ff1a">openlog<span class="_ _45"> </span></span>is <span class="_ _23"></span>taken <span class="_ _9"></span>from <span class="_ _9"></span>Figur<span class="lsf7f">e1<span class="_ _b"></span><span class="ls0">3.4. <span class="_ _45"> </span>Note<span class="_ _45"> </span>that <span class="_ _9"></span>the <span class="_ _23"></span>Single</span></span></div><div class="t m0 x32 h49 y3a3a ff19 fs26 fc0 sc0 ls0 ws0">UNIX <span class="_ _23"> </span>Speciﬁcation <span class="_ _42"> </span>deﬁnes <span class="_ _23"> </span>only <span class="_ _42"> </span>a <span class="_ _23"> </span>subset <span class="_ _42"> </span>of <span class="_ _23"> </span>the <span class="_ _42"> </span>facility <span class="_ _23"> </span>codes <span class="_ _42"> </span>typically <span class="_ _23"> </span>available <span class="_ _42"> </span>on <span class="_ _23"> </span>a</div><div class="t m0 x32 h4a y3a3b ff19 fs26 fc0 sc0 ls0 ws0">given <span class="_"> </span>platform.<span class="_ _48"> </span>The <span class="_"> </span>reason <span class="_"> </span>for <span class="_ _e"> </span>the<span class="_ _46"> </span><span class="ff1b">facility<span class="_ _59"> </span></span>argument <span class="_"> </span>is <span class="_"> </span>to <span class="_ _e"> </span>let <span class="_"> </span>the <span class="_"> </span>conﬁguration <span class="_"> </span>ﬁle</div><div class="t m0 x32 h49 y3a3c ff19 fs26 fc0 sc0 ls0 ws0">specify <span class="_ _3"></span>that <span class="_ _3"></span>messages <span class="_ _9"></span>from <span class="_ _3"></span>differ<span class="_ _0"></span>ent <span class="_ _3"></span>facilities <span class="_ _3"></span>are<span class="_ _47"> </span>to<span class="_ _45"> </span>be<span class="_ _47"> </span>handled <span class="_ _3"></span>differently<span class="_ _4"></span><span class="lse96">.I<span class="_ _62"></span><span class="ls0">f<span class="_ _45"> </span>we<span class="_ _47"> </span>don’t</span></span></div><div class="t m0 x32 h4d y3a3d ff19 fs26 fc0 sc0 ls0 ws0">call<span class="_"> </span><span class="ff1a">openlog</span>,<span class="_ _66"> </span>or<span class="_ _47"> </span>if<span class="_"> </span>we<span class="_ _66"> </span>call <span class="_ _2"></span>it <span class="_ _2"></span>with <span class="_ _2"></span>a<span class="_ _66"> </span><span class="ff1b">facility<span class="_ _66"> </span></span>of <span class="_ _2"></span>0, <span class="_ _2"></span>we <span class="_ _2"></span>can still <span class="_ _2"></span>specify <span class="_ _2"></span>the <span class="_ _2"></span>facility <span class="_ _2"></span>as part <span class="_ _2"></span>of</div><div class="t m0 x32 h4d y3a3e ff19 fs26 fc0 sc0 ls0 ws0">the<span class="_"> </span><span class="ff1b">priority<span class="_"> </span></span>argument to<span class="_"> </span><span class="ff1a">syslog</span>.</div><div class="t m0 x3f h4d y3a3f ff19 fs26 fc0 sc0 ls164 ws0">We <span class="_ _80"> </span>c<span class="_ _9"></span><span class="ls0">all<span class="_ _45"> </span><span class="ff1a">syslog<span class="_ _47"> </span></span>to <span class="_ _3"></span>generate <span class="_ _3"></span>a <span class="_ _3"></span>log <span class="_ _9"></span>message.<span class="_ _16"> </span>The<span class="_ _47"> </span><span class="ff1b">priority<span class="_ _47"> </span></span>argument <span class="_ _3"></span>is <span class="_ _3"></span>a <span class="_ _9"></span>combination</span></div><div class="t m0 x32 h4a y3a40 ff19 fs26 fc0 sc0 ls0 ws0">of <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1b">facility</span><span class="lsf80">,s<span class="_ _b"></span><span class="ls0">hown <span class="_ _23"></span>in <span class="_ _9"></span>Figur<span class="lsf80">e1<span class="_ _b"></span><span class="ls0">3.4, <span class="_ _9"></span>and <span class="_ _9"></span>a<span class="_ _45"> </span><span class="ff1b">level</span><span class="ls93d">,s<span class="_ _b"></span><span class="ls0">hown <span class="_ _9"></span>in <span class="_ _23"></span>Figur<span class="ls93d">e1<span class="_ _b"></span><span class="ls0">3.5. <span class="_ _47"> </span>These<span class="_ _35"> </span><span class="ff1b">level</span><span class="ls93d">sa<span class="_ _b"></span><span class="lscc">re</span></span></span></span></span></span></span></span></span></span></div><div class="t m0 x32 h49 y3a41 ff19 fs26 fc0 sc0 ls0 ws0">order<span class="_ _0"></span>ed by priority<span class="_ _4"></span><span class="lsd3">,f<span class="_ _d"></span><span class="lscc">ro<span class="_ _2"></span><span class="lsd3">mh<span class="_ _d"></span><span class="ls0">ighest to lowest.</span></span></span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
