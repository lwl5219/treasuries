<div id="pf25a" class="pf w4 h1f" data-page-no="25a"><div class="pc pc25a w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg25a.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">568<span class="_ _1b"> </span><span class="ff19">Interprocess <span class="_"> </span>Communication<span class="_ _2c"> </span>Chapter <span class="_"> </span>15</span></div><div class="t m0 x32 h2a y12f ff19 fsf fc0 sc0 ls0 ws0">Note that the optional argument is the actual union, not a pointer to the union.</div><div class="t m0 x76 h52 y28eb ff19 fs2a fc0 sc0 ls0 ws0">Usually <span class="_"> </span>our <span class="_"> </span>application <span class="_"> </span>must <span class="_"> </span>deﬁne <span class="_"> </span>the<span class="_ _35"> </span><span class="ff1a">semun<span class="_ _44"> </span></span>union. <span class="_ _35"> </span>However<span class="_ _1"></span>,<span class="_ _44"> </span>on<span class="_ _35"> </span>F<span class="ls34e">re<span class="_ _2"></span></span>eBSD <span class="_"> </span>8.0, <span class="_"> </span>this <span class="_"> </span>is</div><div class="t m0 x76 h52 y28ed ff19 fs2a fc0 sc0 ls0 ws0">deﬁned for us in<span class="_"> </span><span class="ff1a">&lt;sys/sem.h&gt;</span>.</div><div class="t m0 x3f h2b y44b8 ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _66"> </span><span class="ff1b">cmd<span class="_ _47"> </span></span>argument speciﬁes <span class="_ _2"></span>one <span class="_ _2"></span>of <span class="_ _2"></span>the <span class="_ _2"></span>following <span class="_ _2"></span>ten <span class="_ _2"></span>commands <span class="_ _2"></span>to <span class="_ _3"></span>be <span class="_ _2"></span>performed <span class="_ _2"></span>on</div><div class="t m0 x32 h2b y44b9 ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _23"></span>set <span class="_ _23"></span>speciﬁed <span class="_ _23"></span>by<span class="_ _35"> </span><span class="ff1b">semid</span><span class="ls1247">.T<span class="_ _7"></span><span class="ls0">he <span class="_ _23"> </span>ﬁve <span class="_ _23"> </span>commands <span class="_ _23"> </span>that <span class="_ _23"> </span>refer <span class="_ _23"></span>to <span class="_ _23"></span>one <span class="_ _23"></span>particular <span class="_ _23"></span>semaphore</span></span></div><div class="t m0 x32 h2b y44ba ff19 fsf fc0 sc0 ls0 ws0">value <span class="_ _3"></span>use<span class="_ _47"> </span><span class="ff1b">semnum<span class="_ _45"> </span></span>to <span class="_ _2"></span>specify <span class="_ _9"></span>one <span class="_ _3"></span>member <span class="_ _3"></span>of <span class="_ _3"></span>the <span class="_ _3"></span>set.<span class="_ _16"> </span>The <span class="_ _9"></span>value <span class="_ _3"></span>of<span class="_ _47"> </span><span class="ff1b">semnum<span class="_ _45"> </span></span>is <span class="_ _2"></span>between <span class="_ _9"></span>0</div><div class="t m0 x32 h2b y44bb ff19 fsf fc0 sc0 ls0 ws0">and<span class="_"> </span><span class="ff1b">nsems<span class="_ _42"> </span><span class="ff20">−<span class="_ _53"> </span></span>1</span><span class="ls44">,i<span class="_ _d"></span><span class="ls0">nclusive.</span></span></div><div class="t m0 x3f h26 yad ff1a fsf fc0 sc0 ls0 ws0">IPC_STAT<span class="_ _6e"> </span><span class="ff19">Fetch <span class="_ _23"> </span>the<span class="_ _44"> </span></span>semid_ds<span class="_ _35"> </span><span class="ff19">structur<span class="ls363">ef<span class="_ _43"></span><span class="ls0">or <span class="_ _23"></span>this <span class="_ _42"> </span>set, <span class="_ _23"> </span>storing <span class="_ _42"> </span>it <span class="_ _42"> </span>in <span class="_ _23"> </span>the <span class="_ _42"> </span>structure</span></span></span></div><div class="t m0 x1e5 h2b y44bc ff19 fsf fc0 sc0 ls0 ws0">pointed to by<span class="_"> </span><span class="ff1b">arg.buf</span>.</div><div class="t m0 x3f h26 y44bd ff1a fsf fc0 sc0 ls0 ws0">IPC_SET<span class="_ _1b"> </span><span class="ff19">Set <span class="_ _2"></span>the<span class="_ _66"> </span></span>sem_perm.uid<span class="ff19">,<span class="_ _47"> </span></span>sem_perm.gid<span class="ff19 ls1248">,a<span class="_ _4f"></span><span class="ls0">nd<span class="_ _66"> </span><span class="ff1a">sem_perm.mode<span class="_ _47"> </span></span>ﬁelds</span></span></div><div class="t m0 x1e5 h26 y44be ff19 fsf fc0 sc0 ls0 ws0">from <span class="_ _42"> </span>the <span class="_ _e"> </span>structur<span class="ls71f">ep<span class="_ _55"></span><span class="ls0">ointed <span class="_ _53"> </span>to <span class="_ _53"> </span>by<span class="_ _4b"> </span><span class="ff1b">arg.buf<span class="_ _44"> </span></span>in <span class="_ _e"> </span>the<span class="_ _44"> </span><span class="ff1a">semid_ds<span class="_ _4b"> </span></span>structure</span></span></div><div class="t m0 x1e5 h2a yb1 ff19 fsf fc0 sc0 ls0 ws0">associated <span class="_ _53"> </span>with <span class="_ _53"> </span>this <span class="_ _e"> </span>set.<span class="_ _65"> </span>This <span class="_ _53"> </span>command <span class="_ _53"> </span>can <span class="_ _e"> </span>be <span class="_ _53"> </span>executed <span class="_ _53"> </span>only <span class="_ _e"> </span>by <span class="_ _53"> </span>a</div><div class="t m0 x1e5 h26 y44bf ff19 fsf fc0 sc0 ls0 ws0">process <span class="_ _65"> </span>whose <span class="_ _48"> </span>effective <span class="_ _65"> </span>user <span class="_ _48"> </span>ID <span class="_ _48"> </span>equals<span class="_ _7f"> </span><span class="ff1a">sem_perm.cuid<span class="_ _93"> </span></span>or</div><div class="t m0 x1e5 h26 y44c0 ff1a fsf fc0 sc0 ls0 ws0">sem_perm.uid<span class="_ _80"> </span><span class="ff19">or by a process with superuser privileges.</span></div><div class="t m0 x3f h26 y44c1 ff1a fsf fc0 sc0 ls0 ws0">IPC_RMID<span class="_ _6e"> </span><span class="ff19">Remove <span class="_ _59"> </span>the <span class="_ _46"> </span>semaphor<span class="ls1249">es<span class="_ _49"></span><span class="ls0">et <span class="_ _46"> </span>from <span class="_ _59"> </span>the <span class="_ _59"> </span>system.<span class="_ _5e"> </span>This <span class="_ _46"> </span>removal <span class="_ _59"> </span>is</span></span></span></div><div class="t m0 x1e5 h2a yb5 ff19 fsf fc0 sc0 ls0 ws0">immediate. <span class="_ _35"> </span>Any<span class="_ _44"> </span>other <span class="_ _23"> </span>process <span class="_ _23"> </span>still <span class="_ _42"> </span>using <span class="_ _42"> </span>the <span class="_ _23"> </span>semaphor<span class="ls124a">ew<span class="_ _43"></span><span class="ls0">ill <span class="_ _23"> </span>get <span class="_ _42"> </span>an</span></span></div><div class="t m0 x1e5 h26 y44c2 ff19 fsf fc0 sc0 ls0 ws0">error <span class="_ _53"> </span>of<span class="_ _59"> </span><span class="ff1a">EIDRM<span class="_ _4b"> </span></span>on <span class="_"> </span>its <span class="_ _53"> </span>next <span class="_ _e"> </span>attempted <span class="_"> </span>operation <span class="_ _53"> </span>on <span class="_ _e"> </span>the <span class="_"> </span>semaphor<span class="_ _1"></span>e.</div><div class="t m0 x1e5 h2a y44c3 ff19 fsf fc0 sc0 ls0 ws0">This command <span class="_ _2"></span>can <span class="_ _2"></span>be <span class="_ _2"></span>executed <span class="_ _2"></span>only <span class="_ _2"></span>by a <span class="_ _2"></span>process whose <span class="_ _2"></span>effective user</div><div class="t m0 x1e5 h26 y44c4 ff19 fsf fc0 sc0 ls0 ws0">ID <span class="_ _23"> </span>equals<span class="_ _35"> </span><span class="ff1a">sem_perm.cuid<span class="_ _35"> </span></span>or<span class="_ _35"> </span><span class="ff1a">sem_perm.uid<span class="_ _35"> </span></span>or <span class="_ _23"> </span>by <span class="_ _23"> </span>a <span class="_ _42"> </span>process <span class="_ _23"></span>with</div><div class="t m0 x1e5 h2a y44c5 ff19 fsf fc0 sc0 ls0 ws0">superuser privileges.</div><div class="t m0 x3f h26 y44c6 ff1a fsf fc0 sc0 ls0 ws0">GETVAL<span class="_ _78"> </span><span class="ff19">Return the value of<span class="_"> </span></span>semval<span class="_ _80"> </span><span class="ff19">for the member<span class="_"> </span><span class="ff1b">semnum</span>.</span></div><div class="t m0 x3f h26 y44c7 ff1a fsf fc0 sc0 ls0 ws0">SETVAL<span class="_ _78"> </span><span class="ff19">Set <span class="_ _45"> </span>the <span class="_ _45"> </span>value <span class="_ _45"> </span>of<span class="_ _16"> </span></span>semval<span class="_"> </span><span class="ff19">for <span class="_ _45"> </span>the <span class="_ _45"> </span>member<span class="_ _5a"> </span><span class="ff1b">semnum</span><span class="ls124b">.T<span class="_ _95"></span><span class="ls0">he <span class="_ _45"> </span>value <span class="_ _45"> </span>is</span></span></span></div><div class="t m0 x1e5 h2b y44c8 ff19 fsf fc0 sc0 ls0 ws0">speciﬁed by<span class="_"> </span><span class="ff1b">arg.val</span>.</div><div class="t m0 x3f h26 y44c9 ff1a fsf fc0 sc0 ls0 ws0">GETPID<span class="_ _78"> </span><span class="ff19">Return the value of<span class="_"> </span></span>sempid<span class="_ _80"> </span><span class="ff19">for the member<span class="_"> </span><span class="ff1b">semnum</span>.</span></div><div class="t m0 x3f h26 y44ca ff1a fsf fc0 sc0 ls0 ws0">GETNCNT<span class="_ _1b"> </span><span class="ff19">Return the value of<span class="_"> </span></span>semncnt<span class="_ _80"> </span><span class="ff19">for the member<span class="_"> </span><span class="ff1b">semnum</span>.</span></div><div class="t m0 x3f h26 y44cb ff1a fsf fc0 sc0 ls0 ws0">GETZCNT<span class="_ _1b"> </span><span class="ff19">Return the value of<span class="_"> </span></span>semzcnt<span class="_ _80"> </span><span class="ff19">for the member<span class="_"> </span><span class="ff1b">semnum</span>.</span></div><div class="t m0 x3f h26 y44cc ff1a fsf fc0 sc0 ls0 ws0">GETALL<span class="_ _78"> </span><span class="ff19">Fetch <span class="_ _9"></span>all <span class="_ _23"></span>the <span class="_ _9"></span>semaphor<span class="ls124c">ev<span class="_ _b"></span><span class="ls0">alues <span class="_ _9"></span>in <span class="_ _9"></span>the <span class="_ _23"></span>set.<span class="_ _5a"> </span>These <span class="_ _9"></span>values <span class="_ _23"></span>ar<span class="ls124d">es<span class="_ _43"></span><span class="ls0">tored <span class="_ _9"></span>in</span></span></span></span></span></div><div class="t m0 x1e5 h2b y44cd ff19 fsf fc0 sc0 ls0 ws0">the array pointed to by<span class="_"> </span><span class="ff1b">arg.array</span>.</div><div class="t m0 x3f h26 y44ce ff1a fsf fc0 sc0 ls0 ws0">SETALL<span class="_ _78"> </span><span class="ff19">Set <span class="_ _53"> </span>all <span class="_ _53"> </span>the <span class="_ _53"> </span>semaphor<span class="ls124e">ev<span class="_ _55"></span><span class="ls0">alues <span class="_ _53"> </span>in <span class="_ _e"> </span>the <span class="_ _53"> </span>set <span class="_ _53"> </span>to <span class="_ _53"> </span>the <span class="_ _53"> </span>values <span class="_ _53"> </span>pointed <span class="_ _53"> </span>to <span class="_ _e"> </span>by</span></span></span></div><div class="t m0 x1e5 h2b y44cf ff1b fsf fc0 sc0 ls0 ws0">arg.array<span class="ff19">.</span></div><div class="t m0 x32 h26 y44d0 ff19 fsf fc0 sc0 ls0 ws0">For <span class="_ _9"></span>all <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">GET<span class="_ _45"> </span></span>commands <span class="_ _9"></span>other <span class="_ _23"></span>than<span class="_ _45"> </span><span class="ff1a">GETALL</span><span class="ls124f">,t<span class="_ _b"></span><span class="ls0">he <span class="_ _9"></span>function <span class="_ _9"></span>returns <span class="_ _9"></span>the <span class="_ _9"></span>corresponding</span></span></div><div class="t m0 x32 h2a y44d1 ff19 fsf fc0 sc0 ls0 ws0">value. <span class="_"> </span>For<span class="_ _66"> </span>the <span class="_ _2"></span>remaining commands, <span class="_ _2"></span>the <span class="_ _2"></span>return value is <span class="_ _2"></span>0 <span class="_ _2"></span>if the <span class="_ _2"></span>call <span class="_ _2"></span>succeeds.<span class="_ _46"> </span>On <span class="_ _2"></span>error<span class="_ _6"></span>,</div><div class="t m0 x32 h26 y44d2 ff19 fsf fc0 sc0 ls0 ws0">the<span class="_"> </span><span class="ff1a">semctl<span class="_ _80"> </span></span>function sets<span class="_"> </span><span class="ff1a">errno<span class="_ _66"> </span></span>and returns<span class="_"> </span><span class="ff20">−</span>1.</div><div class="t m0 x3f h26 y44d3 ff19 fsf fc0 sc0 ls0 ws0">The function<span class="_ _66"> </span><span class="ff1a">semop<span class="_ _66"> </span></span>atomically performs <span class="_ _2"></span>an array <span class="_ _2"></span>of operations <span class="_ _2"></span>on a <span class="_ _2"></span>semaphor<span class="ls1be">es<span class="_ _4f"></span><span class="ls0">et.</span></span></div><div class="t m0 x3f h57 y44d4 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;sys/sem.h&gt;</div><div class="t m0 x3f h57 y44d5 ff1a fs2d fc0 sc0 ls0 ws0">int semop(int<span class="_"> </span><span class="ff1b">semid</span><span class="ls15c">,s<span class="_ _1d"></span><span class="ls0">truct sembuf<span class="_"> </span><span class="ff1b">semoparray</span>[], size_t<span class="_"> </span><span class="ff1b">nops</span>);</span></span></div><div class="t m0 x153 h5f y44d6 ff19 fs2d fc0 sc0 ls0 ws0">Returns: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h4a y44d7 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _47"> </span><span class="ff1b">semoparray<span class="_ _47"> </span></span>argument <span class="_ _3"></span>is <span class="_ _3"></span>a <span class="_ _9"></span>pointer <span class="_ _3"></span>to <span class="_ _3"></span>an <span class="_ _3"></span>array <span class="_ _3"></span>of <span class="_ _9"></span>semaphor<span class="lsa85">eo<span class="_ _b"></span><span class="ls0">perations, <span class="_ _3"></span>represented</span></span></div><div class="t m0 x32 h4d y44d8 ff19 fs26 fc0 sc0 ls0 ws0">by<span class="_"> </span><span class="ff1a">sembuf<span class="_ _80"> </span></span>structures:</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
