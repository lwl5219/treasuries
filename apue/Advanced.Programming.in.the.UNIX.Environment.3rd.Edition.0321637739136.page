<div id="pf88" class="pf w4 h1f" data-page-no="88"><div class="pc pc88 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg88.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">102<span class="_ _1b"> </span><span class="ff19">Files <span class="_"> </span>and <span class="_"> </span>Directories <span class="_ _18d"> </span>Chapter<span class="_ _4b"> </span>4</span></div><div class="t m0 x76 h51 y2a3 ff19 fs2a fc0 sc0 ls0 ws0">FreeBSD <span class="_ _23"> </span>8.0 <span class="_ _23"> </span>and <span class="_ _42"> </span>Mac <span class="_ _42"> </span>OS <span class="_ _23"> </span>X <span class="_ _42"> </span>10.6.8 <span class="_ _23"> </span>always <span class="_ _42"> </span>copy <span class="_ _23"> </span>the <span class="_ _42"> </span>new <span class="_ _42"> </span>ﬁle’s <span class="_ _23"> </span>group <span class="_ _23"> </span>ID <span class="_ _42"> </span>from <span class="_ _23"> </span>the <span class="_ _42"> </span>directory<span class="_ _6"></span>.</div><div class="t m0 x76 h51 y2a4 ff19 fs2a fc0 sc0 ls0 ws0">Several <span class="_ _23"> </span>Linux <span class="_ _23"> </span>ﬁle <span class="_ _23"> </span>systems <span class="_ _23"> </span>allow <span class="_ _42"> </span>the <span class="_ _23"> </span>choice <span class="_ _23"> </span>between <span class="_ _23"> </span>the <span class="_ _23"> </span>two <span class="_ _23"> </span>options <span class="_ _42"> </span>to <span class="_ _23"> </span>be <span class="_ _23"> </span>selected <span class="_ _23"> </span>using <span class="_ _23"> </span>a</div><div class="t m0 x76 h52 y2a5 ff1a fs2a fc0 sc0 ls0 ws0">mount</div><div class="t m0 x12f h51 y2f2 ff19 fs2a fc0 sc0 ls0 ws0">(</div><div class="t m0 x184 h51 y2a5 ff19 fs2a fc0 sc0 ls0 ws0">1</div><div class="t m0 x1b h51 y2f2 ff19 fs2a fc0 sc0 ls0 ws0">)</div><div class="t m0 x185 h51 y2a5 ff19 fs2a fc0 sc0 ls0 ws0">command option.<span class="_ _44"> </span>The default behavior for Linux <span class="_ _2"></span>3.2.0 and Solaris 10 <span class="_ _2"></span>is to determine</div><div class="t m0 x76 h51 y2a6 ff19 fs2a fc0 sc0 ls0 ws0">the group ID <span class="_ _2"></span>of a <span class="_ _2"></span>new ﬁle <span class="_ _2"></span>depending on <span class="_ _2"></span>whether the <span class="_ _2"></span>set-group-ID bit <span class="_ _2"></span>is set <span class="_ _2"></span>for the <span class="_ _2"></span>directory in</div><div class="t m0 x76 h51 y2a7 ff19 fs2a fc0 sc0 ls0 ws0">which <span class="_ _2"></span>the <span class="_ _3"></span>ﬁle <span class="_ _2"></span>is <span class="_ _3"></span>created. <span class="_ _80"> </span>If<span class="_ _80"> </span>this <span class="_ _3"></span>bit <span class="_ _2"></span>is <span class="_ _3"></span>set, <span class="_ _3"></span>the <span class="_ _2"></span>new <span class="_ _3"></span>ﬁle’s <span class="_ _3"></span>group <span class="_ _2"></span>ID <span class="_ _2"></span>is <span class="_ _3"></span>copied <span class="_ _3"></span>from <span class="_ _2"></span>the <span class="_ _2"></span>directory;</div><div class="t m0 x76 h51 y2a8 ff19 fs2a fc0 sc0 ls0 ws0">otherwise, the new ﬁle’s group ID is set to the ef<span class="_ _0"></span>fective group ID of the pr<span class="_ _0"></span>ocess.</div><div class="t m0 x3f h2a yaa ff19 fsf fc0 sc0 ls0 ws0">Using <span class="_ _9"></span>the <span class="_ _23"></span>second <span class="_ _9"></span>option<span class="_ _9"></span><span class="ls9d">—i<span class="_ _1"></span><span class="ls0">nheriting <span class="_ _9"></span>the <span class="_ _23"></span>directory’s <span class="_ _3"></span>group <span class="_ _9"></span>ID<span class="_ _23"></span><span class="ls9d">—a<span class="_ _6"></span><span class="ls0">ssures <span class="_ _9"></span>us <span class="_ _9"></span>that <span class="_ _23"></span>all</span></span></span></span></div><div class="t m0 x32 h2a yeca ff19 fsf fc0 sc0 ls0 ws0">ﬁles <span class="_ _66"> </span>and <span class="_ _66"> </span>directories <span class="_ _66"> </span>created <span class="_ _66"> </span>in <span class="_ _47"> </span>that <span class="_"> </span>directory <span class="_ _66"> </span>will <span class="_ _47"> </span>have <span class="_"> </span>the <span class="_ _47"> </span>same <span class="_ _66"> </span>group <span class="_"> </span>ID <span class="_ _47"> </span>as <span class="_ _66"> </span>the</div><div class="t m0 x32 h2a yecb ff19 fsf fc0 sc0 ls0 ws0">directory<span class="_ _4"></span><span class="ls4bc">.T<span class="_ _26"></span><span class="ls0">his <span class="_ _23"></span>gr<span class="_ _0"></span>oup <span class="_ _9"></span>ownership <span class="_ _9"></span>of <span class="_ _23"></span>ﬁles <span class="_ _9"></span>and <span class="_ _9"></span>directories <span class="_ _9"></span>will <span class="_ _9"></span>then <span class="_ _9"></span>propagate <span class="_ _9"></span>down <span class="_ _9"></span>the</span></span></div><div class="t m0 x32 h26 yecc ff19 fsf fc0 sc0 ls0 ws0">hierarchy from that <span class="_ _2"></span>point.<span class="_ _46"> </span>This <span class="_ _2"></span>is <span class="_ _2"></span>used <span class="_ _2"></span>in the <span class="_ _2"></span>Linux <span class="_ _2"></span>directory<span class="_"> </span><span class="ff1a">/var/mail</span><span class="ls4bd">,f<span class="_ _d"></span><span class="ls0">or example.</span></span></div><div class="t m0 x76 h51 yecd ff19 fs2a fc0 sc0 ls0 ws0">As <span class="_ _9"></span>we <span class="_ _3"></span>mentioned <span class="_ _9"> </span>earlier<span class="_ _1"></span><span class="ls4be">,t<span class="_ _d"></span><span class="ls0">his <span class="_ _9"></span>option <span class="_ _3"></span>for <span class="_ _9"> </span>group <span class="_ _9"></span>ownership <span class="_ _9"></span>is <span class="_ _3"></span>the <span class="_ _9"> </span>default <span class="_ _9"></span>for <span class="_ _9"></span>FreeBSD <span class="_ _3"></span>8.0 <span class="_ _9"></span>and</span></span></div><div class="t m0 x76 h51 yece ff19 fs2a fc0 sc0 ls0 ws0">Mac OS X<span class="_ _80"> </span>10.6.8, <span class="_ _3"></span>but <span class="_ _3"></span>an <span class="_ _3"></span>option <span class="_ _3"></span>for <span class="_ _3"></span>Linux <span class="_ _3"></span>and <span class="_ _2"></span>Solaris.<span class="_ _59"> </span>Under <span class="_ _2"></span>Solaris <span class="_ _3"></span>10, <span class="_ _3"></span>and <span class="_ _3"></span>by <span class="_ _3"></span>default <span class="_ _3"></span>under</div><div class="t m0 x76 h52 yecf ff19 fs2a fc0 sc0 ls0 ws0">Linux 3.2.0, <span class="_ _2"></span>we have <span class="_ _2"></span>to enable <span class="_ _2"></span>the <span class="_ _2"></span>set-group-ID bit, and <span class="_ _2"></span>the<span class="_"> </span><span class="ff1a">mkdir<span class="_ _80"> </span></span>function has <span class="_ _2"></span>to propagate a</div><div class="t m0 x76 h51 yed0 ff19 fs2a fc0 sc0 ls0 ws0">directory’s set-gr<span class="_ _0"></span>oup-ID bit automatically for this to work.<span class="_ _35"> </span>(This is described in Section 4.21.)</div><div class="t m0 x35 h75 yed1 ff16 fs2b fc0 sc0 ls0 ws0">4.7<span class="_ _72"> </span><span class="ff1f">access<span class="_ _54"> </span></span>and<span class="_ _54"> </span><span class="ff1f">faccessat<span class="_ _65"> </span></span>Functions</div><div class="t m0 x32 h2a yed2 ff19 fsf fc0 sc0 ls0 ws0">As <span class="_ _3"></span>we <span class="_ _3"></span>described <span class="_ _3"></span>earlier<span class="_ _6"></span><span class="ls1d2">,w<span class="_ _4f"></span><span class="ls0">hen <span class="_ _3"></span>we <span class="_ _3"></span>open <span class="_ _3"></span>a <span class="_ _3"></span>ﬁle, <span class="_ _3"></span>the <span class="_ _3"></span>kernel <span class="_ _3"></span>performs <span class="_ _3"></span>its <span class="_ _3"></span>access <span class="_ _3"></span>tests <span class="_ _3"></span>based</span></span></div><div class="t m0 x32 h2a yed3 ff19 fsf fc0 sc0 ls0 ws0">on <span class="_"> </span>the <span class="_"> </span>ef<span class="_ _0"></span>fective <span class="_"> </span>user <span class="_"> </span>and <span class="_"> </span>gr<span class="_ _0"></span>oup <span class="_"> </span>IDs.<span class="_ _48"> </span>Sometimes, <span class="_"> </span>however<span class="_ _1"></span><span class="ls4bf">,a<span class="ls0">process <span class="_"> </span>wants <span class="_"> </span>to <span class="_ _e"> </span>test</span></span></div><div class="t m0 x32 h2a yed4 ff19 fsf fc0 sc0 ls0 ws0">accessibility <span class="_ _42"> </span>based <span class="_ _53"> </span>on <span class="_ _42"> </span>the <span class="_ _53"> </span>real <span class="_ _42"> </span>user <span class="_ _53"> </span>and <span class="_ _42"> </span>group <span class="_ _42"> </span>IDs.<span class="_ _54"> </span>This <span class="_ _53"> </span>is <span class="_ _53"> </span>useful <span class="_ _42"> </span>when <span class="_ _53"> </span>a <span class="_ _42"> </span>process <span class="_ _42"> </span>is</div><div class="t m0 x32 h2a yed5 ff19 fsf fc0 sc0 ls4e ws0">ru<span class="ls0">nning <span class="_ _2"></span>as <span class="_ _3"></span>someone <span class="_ _3"></span>else, <span class="_ _2"></span>using <span class="_ _3"></span>either <span class="_ _2"></span>the <span class="_ _3"></span>set-user-ID <span class="_ _2"></span>or <span class="_ _2"></span>the <span class="_ _3"></span>set-group-ID <span class="_ _2"></span>feature. <span class="_ _66"> </span>Even</span></div><div class="t m0 x32 h2a yed6 ff19 fsf fc0 sc0 ls0 ws0">though <span class="_ _3"></span>a <span class="_ _9"></span>process <span class="_ _3"></span>might <span class="_ _9"></span>be <span class="_ _3"></span>set-user-ID <span class="_ _3"></span>to <span class="_ _9"></span>root, <span class="_ _3"></span>it <span class="_ _9"></span>might <span class="_ _3"></span>still <span class="_ _9"></span>want <span class="_ _3"></span>to <span class="_ _9"></span>verify <span class="_ _9"></span>that <span class="_ _3"></span>the <span class="_ _9"></span>real</div><div class="t m0 x32 h26 yed7 ff19 fsf fc0 sc0 ls0 ws0">user <span class="_ _3"></span>can <span class="_ _3"></span>access <span class="_ _9"></span>a <span class="_ _3"></span>given <span class="_ _3"></span>ﬁle.<span class="_ _5a"> </span>The<span class="_ _47"> </span><span class="ff1a">access<span class="_ _47"> </span></span>and<span class="_ _45"> </span><span class="ff1a">faccessat<span class="_ _47"> </span></span>functions <span class="_ _3"></span>base <span class="_ _9"></span>their <span class="_ _3"></span>tests <span class="_ _3"></span>on</div><div class="t m0 x32 h2b yed8 ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _9"></span>real <span class="_ _9"></span>user <span class="_ _23"></span>and <span class="_ _9"></span>group <span class="_ _9"></span>IDs.<span class="_ _5a"> </span>(Replace<span class="_ _35"> </span><span class="ff1b">effective<span class="_ _45"> </span></span>with<span class="_ _45"> </span><span class="ff1b ls45">re<span class="_ _2"></span><span class="ls0">al<span class="_ _45"> </span></span></span>in <span class="_ _23"></span>the <span class="_ _9"></span>four <span class="_ _23"></span>steps <span class="_ _9"></span>at <span class="_ _9"></span>the <span class="_ _23"></span>end <span class="_ _9"></span>of</div><div class="t m0 x32 h2a yed9 ff19 fsf fc0 sc0 ls0 ws0">Section 4.5.)</div><div class="t m0 x3f h57 yeda ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;unistd.h&gt;</div><div class="t m0 x3f h57 yedb ff1a fs2d fc0 sc0 ls0 ws0">int access(const char *<span class="ff1b">pathname</span><span class="ls15c">,i<span class="_ _1d"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">mode</span>);</span></span></div><div class="t m0 x3f h57 yedc ff1a fs2d fc0 sc0 ls0 ws0">int faccessat(int<span class="_"> </span><span class="ff1b">fd</span><span class="ls15c">,c<span class="_ _1d"></span><span class="ls0">onst char *<span class="ff1b">pathname</span><span class="ls15c">,i<span class="_ _5b"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">mode</span><span class="ls15c">,i<span class="_ _1d"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">ﬂag</span>);</span></span></span></span></span></span></div><div class="t m0 x103 h5f yedd ff19 fs2d fc0 sc0 ls0 ws0">Both return: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>err<span class="_ _0"></span>or</div><div class="t m0 x32 h4d yede ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _47"> </span><span class="ff1b">mode<span class="_ _45"> </span></span>is <span class="_ _3"></span>either <span class="_ _3"></span>the <span class="_ _9"></span>value<span class="_ _47"> </span><span class="ff1a">F_OK<span class="_ _45"> </span></span>to <span class="_ _3"></span>test <span class="_ _3"></span>if <span class="_ _9"></span>a <span class="_ _3"></span>ﬁle <span class="_ _9"></span>exists, <span class="_ _3"></span>or <span class="_ _9"></span>the <span class="_ _3"></span>bitwise <span class="_ _3"></span>OR <span class="_ _9"></span>of <span class="_ _3"></span>any <span class="_ _9"></span>of <span class="_ _3"></span>the</div><div class="t m0 x32 h49 yedf ff19 fs26 fc0 sc0 ls0 ws0">ﬂags shown in Figur<span class="lsd3">e4<span class="_ _4f"></span><span class="ls0">.7.</span></span></div><div class="t m0 x66 h56 yee0 ff1b fs11 fc0 sc0 ls0 ws0">mode<span class="_ _1c"> </span><span class="ff19">Description</span></div><div class="t m0 x186 h6d yee1 ff1a fs12 fc0 sc0 ls0 ws0">R_OK<span class="_ _6e"> </span><span class="ff19">test for read permission</span></div><div class="t m0 x186 h6d yee2 ff1a fs12 fc0 sc0 ls0 ws0">W_OK<span class="_ _6e"> </span><span class="ff19">test for write permission</span></div><div class="t m0 x186 h6d yee3 ff1a fs12 fc0 sc0 ls0 ws0">X_OK<span class="_ _6e"> </span><span class="ff19">test for execute permission</span></div><div class="t m0 xae h63 yee4 ff18 fs13 fc0 sc0 ls0 ws0">Figure 4.7<span class="_ _5a"> </span><span class="ff19">The<span class="_"> </span><span class="ff1b">mode<span class="_"> </span></span>ﬂags for<span class="_"> </span><span class="ff1a">access<span class="_ _e"> </span></span>function, from<span class="_"> </span><span class="ff1a">&lt;unistd.h&gt;</span></span></div><div class="t m0 x3f h64 yee5 ff19 fs31 fc0 sc0 ls0 ws0">The<span class="_ _59"> </span><span class="ff1a">faccessat<span class="_ _59"> </span></span>function <span class="_"> </span>behaves <span class="_ _e"> </span>like<span class="_ _59"> </span><span class="ff1a">access<span class="_ _59"> </span></span>when <span class="_"> </span>the<span class="_ _4b"> </span><span class="ff1b">pathname<span class="_ _59"> </span></span>argument <span class="_"> </span>is</div><div class="t m0 x32 h64 yee6 ff19 fs31 fc0 sc0 ls0 ws0">absolute <span class="_ _3"></span>or <span class="_ _2"></span>when <span class="_ _3"></span>the<span class="_ _45"> </span><span class="ff1b">fd<span class="_ _66"> </span></span>argument <span class="_ _3"></span>has <span class="_ _3"></span>the <span class="_ _3"></span>value<span class="_ _47"> </span><span class="ff1a">AT_FDCWD<span class="_ _47"> </span></span>and <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1b">pathname<span class="_ _47"> </span></span>argument</div><div class="t m0 x32 h64 yee7 ff19 fs31 fc0 sc0 ls0 ws0">is relative. <span class="_"> </span>Otherwise,<span class="_ _66"> </span><span class="ff1a">faccessat<span class="_ _66"> </span></span>evaluates <span class="_ _2"></span>the<span class="_ _66"> </span><span class="ff1b">pathname<span class="_ _66"> </span></span><span class="ls225">re<span class="_ _2"></span></span>lative to <span class="_ _2"></span>the <span class="_ _2"></span>open directory</div><div class="t m0 x32 h79 yee8 ff19 fs31 fc0 sc0 ls225 ws0">re<span class="ls0">ferenced by the<span class="_"> </span><span class="ff1b">fd<span class="_"> </span></span>argument.</span></div><a class="l" href="#pfd" data-dest-detail='[13,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.891785px;bottom:854.928903px;width:242.687088px;height:19.679992px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
