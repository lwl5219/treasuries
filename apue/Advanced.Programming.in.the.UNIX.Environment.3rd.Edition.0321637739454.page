<div id="pf1c6" class="pf w4 h1f" data-page-no="1c6"><div class="pc pc1c6 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg1c6.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">420<span class="_ _1b"> </span><span class="ff19">Threads <span class="_ _24b"> </span>Chapter<span class="_ _78"> </span><span class="ls7ed">11</span></span></div><div class="t m0 x36 h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">int (*)(const void *, const void *));</div><div class="t m0 x32 h57 y426 ff1a fs2d fc0 sc0 ls0 ws0">#endif</div><div class="t m0 x32 h57 y1307 ff1a fs2d fc0 sc0 ls0 ws0">/*</div><div class="t m0 x140 h57 y1308 ff1a fs2d fc0 sc0 ls15c ws0">*C<span class="_ _1d"></span><span class="ls0">ompare two long integers (helper function for heapsort)</span></div><div class="t m0 x140 h57 y3508 ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 x32 h57 y3509 ff1a fs2d fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h57 y350a ff1a fs2d fc0 sc0 ls0 ws0">complong(const void *arg1, const void *arg2)</div><div class="t m0 x32 h57 y350b ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y350c ff1a fs2d fc0 sc0 ls0 ws0">long l1 = *(long *)arg1;</div><div class="t m0 x8a h57 y350d ff1a fs2d fc0 sc0 ls0 ws0">long l2 = *(long *)arg2;</div><div class="t m0 x8a h57 y130f ff1a fs2d fc0 sc0 ls0 ws0">if (l1 == l2)</div><div class="t m0 x9d h57 y1310 ff1a fs2d fc0 sc0 ls0 ws0">return 0;</div><div class="t m0 x8a h57 y1311 ff1a fs2d fc0 sc0 ls0 ws0">else if (l1 &lt; l2)</div><div class="t m0 x9d h57 y1312 ff1a fs2d fc0 sc0 ls0 ws0">return -1;</div><div class="t m0 x8a h57 y1313 ff1a fs2d fc0 sc0 ls0 ws0">else</div><div class="t m0 x9d h57 y1314 ff1a fs2d fc0 sc0 ls0 ws0">return 1;</div><div class="t m0 x32 h57 y1315 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h57 y1316 ff1a fs2d fc0 sc0 ls0 ws0">/*</div><div class="t m0 x140 h57 y1317 ff1a fs2d fc0 sc0 ls15c ws0">*W<span class="_ _1d"></span><span class="ls0">orker thread to sort a portion of the set of numbers.</span></div><div class="t m0 x140 h57 y1318 ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 x32 h57 y1319 ff1a fs2d fc0 sc0 ls0 ws0">void *</div><div class="t m0 x32 h57 y131a ff1a fs2d fc0 sc0 ls0 ws0">thr_fn(void *arg)</div><div class="t m0 x32 h57 y131b ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y131c ff1a fs2d fc0 sc0 ls0 ws0">long <span class="_ _68"> </span>idx<span class="_"> </span><span class="ls15c">=(<span class="_ _5b"></span><span class="ls0">long)arg;</span></span></div><div class="t m0 x8a h57 y1342 ff1a fs2d fc0 sc0 ls0 ws0">heapsort(&amp;nums[idx], TNUM, sizeof(long), complong);</div><div class="t m0 x8a h57 y1343 ff1a fs2d fc0 sc0 ls0 ws0">pthread_barrier_wait(&amp;b);</div><div class="t m0 x8a h57 y23eb ff1a fs2d fc0 sc0 ls0 ws0">/*</div><div class="t m0 x214 h57 y23ec ff1a fs2d fc0 sc0 ls0 ws0">*<span class="_"> </span>Go<span class="_"> </span>off and perform more work ...</div><div class="t m0 x214 h57 y23ed ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 x8a h57 y23ee ff1a fs2d fc0 sc0 ls0 ws0">return((void *)0);</div><div class="t m0 x32 h57 y23ef ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h57 y350e ff1a fs2d fc0 sc0 ls0 ws0">/*</div><div class="t m0 x140 h57 y350f ff1a fs2d fc0 sc0 ls15c ws0">*M<span class="_ _1d"></span><span class="ls0">erge the results of the individual sorted ranges.</span></div><div class="t m0 x140 h57 y3510 ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 x32 h57 y3511 ff1a fs2d fc0 sc0 ls0 ws0">void</div><div class="t m0 x32 h57 y3512 ff1a fs2d fc0 sc0 ls0 ws0">merge()</div><div class="t m0 x32 h57 y3513 ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y3514 ff1a fs2d fc0 sc0 ls0 ws0">long <span class="_ _68"> </span>idx[NTHR];</div><div class="t m0 x8a h57 y170d ff1a fs2d fc0 sc0 ls0 ws0">long <span class="_ _68"> </span>i,<span class="_"> </span>minidx, sidx, num;</div><div class="t m0 x8a h57 y3515 ff1a fs2d fc0 sc0 ls0 ws0">for (i = 0; i &lt; NTHR; i++)</div><div class="t m0 x9d h57 y3516 ff1a fs2d fc0 sc0 ls0 ws0">idx[i] = i * TNUM;</div><div class="t m0 x8a h57 y3517 ff1a fs2d fc0 sc0 ls0 ws0">for (sidx = 0; sidx &lt; NUMNUM; sidx++) {</div><div class="t m0 x9d h57 y3518 ff1a fs2d fc0 sc0 ls0 ws0">num = LONG_MAX;</div><div class="t m0 x9d h57 y3519 ff1a fs2d fc0 sc0 ls0 ws0">for (i = 0; i &lt; NTHR; i++) {</div><div class="t m0 x1f h57 y351a ff1a fs2d fc0 sc0 ls0 ws0">if ((idx[i] &lt; (i+1)*TNUM) &amp;&amp; (nums[idx[i]] &lt; num)) {</div><div class="t m0 x1ca h57 y351b ff1a fs2d fc0 sc0 ls0 ws0">num = nums[idx[i]];</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
