<div id="pf13a" class="pf w4 h1f" data-page-no="13a"><div class="pc pc13a w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg13a.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">280<span class="_ _1b"> </span><span class="ff19">Process <span class="_"> </span>Contr<span class="_ _0"></span>ol <span class="_ _222"> </span>Chapter<span class="_ _4b"> </span>8</span></div><div class="t m0 x3f h2a y12f ff19 fsf fc0 sc0 ls0 ws0">In <span class="_ _2"></span>contrast, <span class="_ _3"></span>when <span class="_ _3"></span>the <span class="_ _2"></span>child <span class="_ _3"></span>has <span class="_ _3"></span>the <span class="_ _2"></span>highest <span class="_ _3"></span>possible <span class="_ _3"></span>nice <span class="_ _2"></span>value <span class="_ _3"></span>(the <span class="_ _3"></span>lowest <span class="_ _2"></span>priority),</div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">we see <span class="_ _2"></span>that the <span class="_ _2"></span>parent gets <span class="_ _2"></span>98.5% of <span class="_ _2"></span>the CPU, <span class="_ _2"></span>while <span class="_ _2"></span>the child <span class="_ _2"></span>gets only <span class="_ _2"></span>1.5% <span class="_ _2"></span>of the <span class="_ _2"></span>CPU.</div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">These <span class="_ _42"> </span>values <span class="_ _23"> </span>will <span class="_ _42"> </span>vary <span class="_ _42"> </span>based <span class="_ _23"> </span>on <span class="_ _42"> </span>how <span class="_ _42"> </span>the <span class="_ _42"> </span>process <span class="_ _23"></span>scheduler <span class="_ _42"> </span>uses <span class="_ _23"> </span>the <span class="_ _42"> </span>nice <span class="_ _42"> </span>value, <span class="_ _42"> </span>so <span class="_ _23"> </span>a</div><div class="t m0 x32 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">differ<span class="_ _0"></span>ent UNIX system will pr<span class="_ _0"></span>oduce differ<span class="_ _0"></span>ent ratios.</div><div class="t m0 x35 h4b y24a4 ff16 fs27 fc0 sc0 ls0 ws0">8.17 <span class="_ _93"> </span>Process <span class="_"> </span>Times</div><div class="t m0 x32 h49 yfaf ff19 fs26 fc0 sc0 ls0 ws0">In <span class="_ _42"> </span>Section <span class="_ _42"> </span>1.10, <span class="_ _42"> </span>we <span class="_ _42"> </span>described <span class="_ _53"> </span>three <span class="_ _42"> </span>times <span class="_ _42"> </span>that <span class="_ _42"> </span>we <span class="_ _42"> </span>can <span class="_ _42"> </span>measure: <span class="_ _42"> </span>wall <span class="_ _42"> </span>clock <span class="_ _42"> </span>time, <span class="_ _42"> </span>user</div><div class="t m0 x32 h4d yfb0 ff19 fs26 fc0 sc0 ls0 ws0">CPU <span class="_ _23"> </span>time, <span class="_ _23"> </span>and <span class="_ _23"> </span>system <span class="_ _42"> </span>CPU <span class="_ _23"> </span>time.<span class="_ _51"> </span>Any <span class="_ _23"> </span>process <span class="_ _23"> </span>can <span class="_ _23"> </span>call <span class="_ _42"> </span>the<span class="_ _35"> </span><span class="ff1a">times<span class="_ _35"> </span></span>function <span class="_ _23"></span>to <span class="_ _23"> </span>obtain</div><div class="t m0 x32 h49 y24a5 ff19 fs26 fc0 sc0 ls0 ws0">these values for itself and any terminated children.</div><div class="t m0 x3f h4e y24a6 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;sys/times.h&gt;</div><div class="t m0 x3f h4e y24a7 ff1a fs28 fc0 sc0 ls0 ws0">clock_t times(struct tms *<span class="ff1b">buf<span class="_ _42"> </span></span>);</div><div class="t m0 x1e h7c y24a8 ff19 fs28 fc0 sc0 ls0 ws0">Returns: elapsed wall clock time in clock ticks if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h54 y24a9 ff19 fs2c fc0 sc0 ls0 ws0">This function ﬁlls in the<span class="_"> </span><span class="ff1a">tms<span class="_ _80"> </span></span>structur<span class="ls142">ep<span class="_ _4f"></span><span class="ls0">ointed to by<span class="_"> </span><span class="ff1b">buf<span class="_ _53"> </span></span>:</span></span></div><div class="t m0 x3f h5d y24aa ff1a fs2f fc0 sc0 ls0 ws0">struct tms {</div><div class="t m0 xf4 h5d y24ab ff1a fs2f fc0 sc0 ls0 ws0">clock_t <span class="_"> </span>tms_utime; <span class="_"> </span>/*<span class="_"> </span>user CPU time */</div><div class="t m0 xf4 h5d y24ac ff1a fs2f fc0 sc0 ls0 ws0">clock_t <span class="_"> </span>tms_stime; <span class="_"> </span>/*<span class="_"> </span>system CPU time */</div><div class="t m0 xf4 h5d y24ad ff1a fs2f fc0 sc0 ls0 ws0">clock_t <span class="_"> </span>tms_cutime;<span class="_"> </span>/* user CPU time, terminated children */</div><div class="t m0 xf4 h5d y24ae ff1a fs2f fc0 sc0 ls0 ws0">clock_t <span class="_"> </span>tms_cstime;<span class="_"> </span>/* system CPU time, terminated children */</div><div class="t m0 x3f h5d y24af ff1a fs2f fc0 sc0 ls0 ws0">};</div><div class="t m0 x32 h55 y24b0 ff19 fs2c fc0 sc0 ls0 ws0">Note <span class="_"> </span>that <span class="_ _53"> </span>the <span class="_"> </span>structur<span class="_ _0"></span><span class="lsaa2">ed<span class="_ _4a"></span><span class="ls0">oes <span class="_"> </span>not <span class="_"> </span>contain <span class="_ _53"> </span>any <span class="_"> </span>measurement <span class="_ _e"> </span>for <span class="_"> </span>the <span class="_ _e"> </span>wall <span class="_"> </span>clock <span class="_ _53"> </span>time.</span></span></div><div class="t m0 x32 h55 y24b1 ff19 fs2c fc0 sc0 ls0 ws0">Instead, <span class="_ _3"></span>the <span class="_ _3"></span>function <span class="_ _9"></span>returns <span class="_ _2"></span>the <span class="_ _9"></span>wall <span class="_ _3"></span>clock <span class="_ _3"></span>time <span class="_ _9"></span>as <span class="_ _3"></span>the <span class="_ _3"></span>value <span class="_ _9"></span>of <span class="_ _3"></span>the <span class="_ _3"></span>function, <span class="_ _9"></span>each <span class="_ _3"></span>time</div><div class="t m0 x32 h55 y24b2 ff19 fs2c fc0 sc0 ls0 ws0">it’s called.<span class="_ _46"> </span>This value <span class="_ _2"></span>is measured from some arbitrary point in <span class="_ _2"></span>the past, so <span class="_ _2"></span>we can’t use</div><div class="t m0 x32 h54 y24b3 ff19 fs2c fc0 sc0 ls0 ws0">its <span class="_ _9"></span>absolute <span class="_ _23"></span>value; <span class="_ _9"></span>instead, <span class="_ _23"> </span>we <span class="_ _23"></span>use <span class="_ _9"></span>its <span class="_ _23"></span>relative <span class="_ _9"></span>value.<span class="_ _5a"> </span>For <span class="_ _23"></span>example, <span class="_ _9"></span>we <span class="_ _23"></span>call<span class="_ _45"> </span><span class="ff1a">times<span class="_ _35"> </span></span>and</div><div class="t m0 x32 h54 y24b4 ff19 fs2c fc0 sc0 ls0 ws0">save <span class="_ _3"></span>the <span class="_ _3"></span>return <span class="_ _2"></span>value.<span class="_ _16"> </span>At <span class="_ _3"></span>some <span class="_ _3"></span>later <span class="_ _3"></span>time, <span class="_ _3"></span>we <span class="_ _3"></span>call<span class="_ _47"> </span><span class="ff1a">times<span class="_ _47"> </span></span>again <span class="_ _3"></span>and <span class="_ _3"></span>subtract <span class="_ _3"></span>the <span class="_ _3"></span>earlier</div><div class="t m0 x32 h55 y24b5 ff19 fs2c fc0 sc0 ls150 ws0">re<span class="ls0">turn <span class="_ _42"> </span>value <span class="_ _53"> </span>from <span class="_ _23"> </span>the <span class="_ _42"> </span>new <span class="_ _53"> </span>return <span class="_ _23"> </span>value.<span class="_ _54"> </span>The <span class="_ _42"> </span>difference <span class="_ _42"> </span>is <span class="_ _42"> </span>the <span class="_ _42"> </span>wall <span class="_ _42"> </span>clock <span class="_ _42"> </span>time.<span class="_ _54"> </span>(It <span class="_ _42"> </span>is</span></div><div class="t m0 x32 h55 y24b6 ff19 fs2c fc0 sc0 ls0 ws0">possible, <span class="_ _23"> </span>though <span class="_ _23"> </span>unlikely<span class="_ _6"></span><span class="lsaa3">,f<span class="_ _43"></span><span class="ls0">or <span class="_ _23"> </span>a <span class="_ _42"> </span>long-running <span class="_ _23"></span>process <span class="_ _9"></span>to <span class="_ _42"> </span>overﬂow <span class="_ _23"></span>the <span class="_ _23"> </span>wall <span class="_ _23"> </span>clock <span class="_ _42"> </span>time;</span></span></div><div class="t m0 x32 h55 y24b7 ff19 fs2c fc0 sc0 ls0 ws0">see Exercise 1.5.)</div><div class="t m0 x3f h55 y24b8 ff19 fs2c fc0 sc0 ls0 ws0">The <span class="_ _2"></span>two <span class="_ _2"></span>structur<span class="lsaa4">eﬁ<span class="_ _8"></span><span class="ls0">elds <span class="_ _2"></span>for <span class="_ _3"></span>child <span class="_ _2"></span>processes contain <span class="_ _3"></span>values <span class="_ _2"></span>only <span class="_ _2"></span>for <span class="_ _2"></span>children <span class="_ _2"></span>that <span class="_ _2"></span>we</span></span></div><div class="t m0 x32 h54 y24b9 ff19 fs2c fc0 sc0 ls0 ws0">have waited for with one of the<span class="_"> </span><span class="ff1a">wait<span class="_ _80"> </span></span>functions discussed earlier in this chapter<span class="_ _1"></span>.</div><div class="t m0 x3f h54 y24ba ff19 fs2c fc0 sc0 ls0 ws0">All <span class="_ _23"></span>the<span class="_ _35"> </span><span class="ff1a">clock_t<span class="_ _35"> </span></span>values <span class="_ _23"></span>r<span class="_ _0"></span>eturned <span class="_ _23"></span>by <span class="_ _23"> </span>this <span class="_ _23"> </span>function <span class="_ _23"> </span>ar<span class="lsaa5">ec<span class="_ _43"></span><span class="ls0">onverted <span class="_ _23"> </span>to <span class="_ _23"> </span>seconds <span class="_ _23"> </span>using</span></span></div><div class="t m0 x32 h54 y24bb ff19 fs2c fc0 sc0 ls0 ws0">the <span class="_ _9"></span>number <span class="_ _3"></span>of <span class="_ _9"></span>clock <span class="_ _9"></span>ticks <span class="_ _9"></span>per <span class="_ _9"></span>second<span class="_ _9"></span><span class="ls6bf">—t<span class="_ _6"></span><span class="ls0">he<span class="_ _45"> </span><span class="ff1a">_SC_CLK_TCK<span class="_ _47"> </span></span>value <span class="_ _9"></span>returned <span class="_ _3"></span>by<span class="_ _45"> </span><span class="ff1a">sysconf</span></span></span></div><div class="t m0 x32 h55 y24bc ff19 fs2c fc0 sc0 ls0 ws0">(Section 2.5.4).</div><div class="t m0 x76 h4f y24bd ff19 fs11 fc0 sc0 ls0 ws0">Most <span class="_ _42"> </span>implementations <span class="_ _23"> </span>provide <span class="_ _42"> </span>the<span class="_ _45"> </span><span class="ff1a">getrusage</span></div><div class="t m0 x201 h2e y24be ff19 fs11 fc0 sc0 ls0 ws0">(</div><div class="t m0 x202 h2e y24bd ff19 fs11 fc0 sc0 ls0 ws0">2</div><div class="t m0 x1d9 h2e y24be ff19 fs11 fc0 sc0 ls0 ws0">)</div><div class="t m0 x1ba h2e y24bd ff19 fs11 fc0 sc0 ls0 ws0">function. <span class="_ _45"> </span>This<span class="_ _45"> </span>function <span class="_ _42"> </span>returns <span class="_ _42"> </span>the <span class="_ _23"> </span>CPU</div><div class="t m0 x76 h2e y24bf ff19 fs11 fc0 sc0 ls0 ws0">times and 14 <span class="_ _2"></span>other values <span class="_ _2"></span>indicating resource usage.<span class="_ _44"> </span>Historically<span class="_ _6"></span><span class="lsaa6">,t<span class="_ _5"></span><span class="ls0">his <span class="_ _2"></span>function originated <span class="_ _2"></span>with</span></span></div><div class="t m0 x76 h2e y24c0 ff19 fs11 fc0 sc0 ls0 ws0">the <span class="_ _42"> </span>BSD <span class="_ _23"> </span>operating <span class="_ _42"> </span>system, <span class="_ _42"> </span>so <span class="_ _42"> </span>BSD-derived <span class="_ _42"> </span>implementations <span class="_ _42"> </span>generally <span class="_ _23"> </span>support <span class="_ _42"> </span>mor<span class="lsaa7">eo<span class="_ _b"></span><span class="lsaa8">ft<span class="_ _b"></span><span class="ls0">he</span></span></span></div><div class="t m0 x76 h2e y24c1 ff19 fs11 fc0 sc0 ls0 ws0">ﬁelds than do other implementations.</div><div class="t m0 x35 h61 y24c2 ff16 fs2c fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h55 y24c3 ff19 fs2c fc0 sc0 ls0 ws0">The <span class="_ _2"></span>program <span class="_ _2"></span>in <span class="_ _3"></span>Figur<span class="ls6f7">e8<span class="_ _8"></span><span class="ls0">.31 <span class="_ _3"></span>executes <span class="_ _3"></span>each <span class="_ _2"></span>command</span></span></div><div class="t m0 x17b h55 y24c4 ff19 fs2c fc0 sc0 ls0 ws0">-</div><div class="t m0 x203 h55 y24c3 ff19 fs2c fc0 sc0 ls0 ws0">line <span class="_ _2"></span>argument <span class="_ _2"></span>as <span class="_ _3"></span>a <span class="_ _3"></span>shell <span class="_ _3"></span>command</div><div class="t m0 x32 h54 y24c5 ff19 fs2c fc0 sc0 ls0 ws0">string, timing the command and printing the values from the<span class="_"> </span><span class="ff1a">tms<span class="_ _80"> </span></span>structur<span class="_ _0"></span>e.</div><a class="l" href="#pff" data-dest-detail='[15,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892634px;bottom:1085.090965px;width:123.803703px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
