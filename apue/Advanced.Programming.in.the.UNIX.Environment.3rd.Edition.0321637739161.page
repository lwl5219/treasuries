<div id="pfa1" class="pf w4 h1f" data-page-no="a1"><div class="pc pca1 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bga1.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h7a ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>4.20<span class="_ _1bf"> </span><span class="ff1a">futimens</span>,<span class="_ _4b"> </span><span class="ff1a">utimensat</span><span class="ls30a">,a<span class="_ _55"></span><span class="ls0">nd<span class="_ _4b"> </span><span class="ff1a">utimes<span class="_ _4b"> </span></span>Functions<span class="_ _1b"> </span><span class="ff18">127</span></span></span></div><div class="t m0 x3f h26 y12f ff19 fsf fc0 sc0 ls49 ws0">•I<span class="_ _4d"></span><span class="ls0">f<span class="_ _45"> </span><span class="ff1b">times<span class="_ _35"> </span></span>is <span class="_ _9"></span>a <span class="_ _23"></span>non-null <span class="_ _9"></span>pointer <span class="_ _23"></span>and <span class="_ _9"></span>both<span class="_ _35"> </span><span class="ff1a">tv_nsec<span class="_ _45"> </span></span>ﬁelds <span class="_ _23"></span>ar<span class="ls599">es<span class="_ _43"></span><span class="ls0">et <span class="_ _23"></span>to<span class="_ _45"> </span><span class="ff1a">UTIME_OMIT</span>,</span></span></span></div><div class="t m0 x15 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">no permissions checks ar<span class="ls44">ep<span class="_ _4f"></span><span class="ls0">erformed.</span></span></div><div class="t m0 x3f h26 y405 ff19 fsf fc0 sc0 ls65 ws0">Wi<span class="_ _3"></span><span class="ls0">th<span class="_ _44"> </span><span class="ff1a">futimens</span><span class="ls59a">,y<span class="_ _c"></span><span class="ls0">ou <span class="_ _42"> </span>need <span class="_ _53"> </span>to <span class="_ _42"> </span>open <span class="_ _42"> </span>the <span class="_ _42"> </span>ﬁle <span class="_ _42"> </span>to <span class="_ _42"> </span>change <span class="_ _42"> </span>its <span class="_ _42"> </span>times.<span class="_ _54"> </span>The<span class="_ _44"> </span><span class="ff1a">utimensat</span></span></span></span></div><div class="t m0 x32 h2b y1fb ff19 fsf fc0 sc0 ls0 ws0">function <span class="_ _42"> </span>pr<span class="_ _0"></span>ovides <span class="_ _42"> </span>a <span class="_ _23"> </span>way <span class="_ _42"> </span>to <span class="_ _42"> </span>change <span class="_ _42"> </span>a <span class="_ _23"> </span>ﬁle’s <span class="_ _42"> </span>times <span class="_ _42"> </span>using <span class="_ _23"> </span>the <span class="_ _42"> </span>ﬁle’s <span class="_ _42"> </span>name.<span class="_ _54"> </span>The<span class="_ _35"> </span><span class="ff1b">pathname</span></div><div class="t m0 x32 h2b y1fc ff19 fsf fc0 sc0 ls0 ws0">argument is <span class="_ _3"></span>evaluated <span class="_ _3"></span>relative <span class="_ _2"></span>to <span class="_ _2"></span>the<span class="_ _47"> </span><span class="ff1b">fd<span class="_ _47"> </span></span>argument, which <span class="_ _3"></span>is <span class="_ _3"></span>either <span class="_ _2"></span>a <span class="_ _3"></span>ﬁle <span class="_ _2"></span>descriptor <span class="_ _3"></span>of <span class="_ _3"></span>an</div><div class="t m0 x32 h26 y1fd ff19 fsf fc0 sc0 ls0 ws0">open <span class="_ _2"></span>directory or <span class="_ _3"></span>the <span class="_ _2"></span>special <span class="_ _2"></span>value<span class="_ _47"> </span><span class="ff1a">AT_FDCWD<span class="_ _66"> </span></span>to <span class="_ _2"></span>force <span class="_ _2"></span>evaluation <span class="_ _2"></span>relative to <span class="_ _3"></span>the <span class="_ _2"></span>current</div><div class="t m0 x32 h2b y406 ff19 fsf fc0 sc0 ls0 ws0">directory <span class="_ _2"></span>of <span class="_ _3"></span>the <span class="_ _3"></span>calling <span class="_ _3"></span>process. <span class="_ _47"> </span>If<span class="_ _47"> </span><span class="ff1b">pathname<span class="_ _47"> </span></span>speciﬁes <span class="_ _3"></span>an <span class="_ _3"></span>absolute <span class="_ _3"></span>pathname, <span class="_ _3"></span>then <span class="_ _3"></span>the<span class="_ _45"> </span><span class="ff1b">fd</span></div><div class="t m0 x32 h2a y407 ff19 fsf fc0 sc0 ls0 ws0">argument is ignor<span class="_ _0"></span>ed.</div><div class="t m0 x3f h26 y408 ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _5a"> </span><span class="ff1b">ﬂag<span class="_ _5a"> </span></span>argument <span class="_ _47"> </span>to<span class="_ _5a"> </span><span class="ff1a">utimensat<span class="_"> </span></span>can <span class="_ _45"> </span>be <span class="_ _45"> </span>used <span class="_ _45"> </span>to <span class="_ _45"> </span>further <span class="_ _45"> </span>modify <span class="_ _45"> </span>the <span class="_ _45"> </span>default</div><div class="t m0 x32 h26 y409 ff19 fsf fc0 sc0 ls0 ws0">behavior<span class="_ _6"></span><span class="ls59b">.I<span class="_ _5b"></span><span class="ls12e">ft<span class="_ _d"></span><span class="ls0">he<span class="_ _66"> </span><span class="ff1a">AT_SYMLINK_NOFOLLOW<span class="_ _47"> </span></span>ﬂag is <span class="_ _2"></span>set, <span class="_ _3"></span>then <span class="_ _2"></span>the <span class="_ _2"></span>times <span class="_ _2"></span>of <span class="_ _2"></span>the <span class="_ _2"></span>symbolic <span class="_ _2"></span>link</span></span></span></div><div class="t m0 x32 h2a y40a ff19 fsf fc0 sc0 ls0 ws0">itself <span class="_ _2"></span>ar<span class="ls59c">ec<span class="_ _8"></span><span class="ls0">hanged <span class="_ _2"></span>(if <span class="_ _3"></span>the <span class="_ _2"></span>pathname <span class="_ _2"></span>refers <span class="_ _2"></span>to <span class="_ _2"></span>a <span class="_ _2"></span>symbolic <span class="_ _2"></span>link).<span class="_ _61"> </span>The <span class="_ _3"></span>default <span class="_ _2"></span>behavior <span class="_ _2"></span>is <span class="_ _2"></span>to</span></span></div><div class="t m0 x32 h2a y40b ff19 fsf fc0 sc0 ls0 ws0">follow a symbolic link and modify the times of the ﬁle to which the link refers.</div><div class="t m0 x3f h26 y40c ff19 fsf fc0 sc0 ls0 ws0">Both<span class="_ _5a"> </span><span class="ff1a">futimens<span class="_"> </span></span>and<span class="_ _51"> </span><span class="ff1a">utimensat<span class="_"> </span></span>ar<span class="_ _0"></span><span class="ls59d">ei<span class="_ _26"></span><span class="ls0">ncluded <span class="_ _45"> </span>in <span class="_ _35"> </span>POSIX.1.<span class="_ _1a3"> </span><span class="ls59d">At<span class="_ _26"></span><span class="ls0">hir<span class="ls59d">df<span class="_ _26"></span><span class="ls0">unction,</span></span></span></span></span></span></div><div class="t m0 x32 h26 y204 ff1a fsf fc0 sc0 ls0 ws0">utimes<span class="ff19">,<span class="_"> </span>is<span class="_"> </span>included in the Single UNIX Speciﬁcation as part of the XSI option.</span></div><div class="t m0 x3f h57 y1230 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;sys/time.h&gt;</div><div class="t m0 x3f h57 y1231 ff1a fs2d fc0 sc0 ls0 ws0">int utimes(const char *<span class="ff1b">pathname</span><span class="ls15c">,c<span class="_ _1d"></span><span class="ls0">onst struct timeval<span class="_"> </span><span class="ff1b">times[2]</span>);</span></span></div><div class="t m0 x153 h5f y1232 ff19 fs2d fc0 sc0 ls0 ws0">Returns: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x3f h4d y1233 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _45"> </span><span class="ff1a">utimes<span class="_ _45"> </span></span>function <span class="_ _9"></span>operates <span class="_ _9"></span>on <span class="_ _9"></span>a <span class="_ _23"></span>pathname.<span class="_ _5a"> </span>The<span class="_ _45"> </span><span class="ff1b">times<span class="_ _45"> </span></span>argument <span class="_ _3"></span>is <span class="_ _23"></span>a <span class="_ _9"></span>pointer <span class="_ _9"></span>to</div><div class="t m0 x32 h49 y1234 ff19 fs26 fc0 sc0 ls0 ws0">an <span class="_ _44"> </span>array <span class="_ _44"> </span>of <span class="_ _44"> </span>two <span class="_ _4b"> </span>timestamps<span class="_ _9"></span><span class="ls161">—a<span class="_ _6"></span><span class="ls0">ccess <span class="_ _44"> </span>time <span class="_ _4b"> </span>and <span class="_ _44"> </span>modiﬁcation <span class="_ _44"> </span>time<span class="_ _9"></span><span class="ls161">—b<span class="_ _6"></span><span class="ls0">ut <span class="_ _4b"> </span>they <span class="_ _44"> </span>are</span></span></span></span></div><div class="t m0 x32 h49 y1235 ff19 fs26 fc0 sc0 ls0 ws0">expressed in seconds and micr<span class="_ _0"></span>oseconds:</div><div class="t m0 x3f h4e y1236 ff1a fs28 fc0 sc0 ls0 ws0">struct timeval {</div><div class="t m0 x16e h4e y1237 ff1a fs28 fc0 sc0 ls0 ws0">time_t tv_sec;<span class="_ _15"> </span>/* seconds */</div><div class="t m0 x16e h4e y1238 ff1a fs28 fc0 sc0 ls0 ws0">long <span class="_ _d9"> </span>tv_usec; <span class="_ _3a"> </span>/*<span class="_"> </span>microseconds */</div><div class="t m0 x3f h4e y1239 ff1a fs28 fc0 sc0 ls0 ws0">};</div><div class="t m0 x3f h49 y123a ff19 fs26 fc0 sc0 ls0 ws0">Note <span class="_ _46"> </span>that <span class="_ _46"> </span>we <span class="_ _46"> </span>ar<span class="ls59e">eu<span class="_ _49"></span><span class="ls0">nable <span class="_ _46"> </span>to <span class="_ _46"> </span>specify <span class="_ _46"> </span>a <span class="_ _46"> </span>value <span class="_ _46"> </span>for <span class="_ _46"> </span>the <span class="_ _46"> </span>changed-status <span class="_ _46"> </span>time,</span></span></div><div class="t m0 x32 h4d y123b ff1a fs26 fc0 sc0 ls0 ws0">st_ctim<span class="ff19">—the time <span class="_ _2"></span>the <span class="_ _2"></span>i-node was <span class="_ _2"></span>last <span class="_ _2"></span>changed<span class="_ _9"></span><span class="ls161">—a<span class="_ _6"></span><span class="ls409">st<span class="_ _d"></span><span class="ls0">his ﬁeld <span class="_ _2"></span>is <span class="_ _2"></span>automatically updated</span></span></span></span></div><div class="t m0 x32 h4d y123c ff19 fs26 fc0 sc0 ls0 ws0">when the<span class="_"> </span><span class="ff1a">utime<span class="_ _80"> </span></span>function is called.</div><div class="t m0 x3f h4d y123d ff19 fs26 fc0 sc0 ls0 ws0">On <span class="_ _23"></span>some <span class="_ _23"></span>versions <span class="_ _9"></span>of <span class="_ _23"> </span>the <span class="_ _23"> </span>UNIX <span class="_ _23"> </span>System, <span class="_ _23"> </span>the<span class="_ _35"> </span><span class="ff1a">touch</span></div><div class="t m0 x104 h49 y123e ff19 fs26 fc0 sc0 ls0 ws0">(</div><div class="t m0 x47 h49 y123d ff19 fs26 fc0 sc0 ls0 ws0">1</div><div class="t m0 x75 h49 y123e ff19 fs26 fc0 sc0 ls0 ws0">)</div><div class="t m0 xc8 h49 y123d ff19 fs26 fc0 sc0 ls0 ws0">command <span class="_ _23"></span>uses <span class="_ _23"></span>one <span class="_ _9"></span>of <span class="_ _23"> </span>these</div><div class="t m0 x32 h4d y123f ff19 fs26 fc0 sc0 ls0 ws0">functions. <span class="_ _4b"> </span>Also,<span class="_ _4b"> </span>the <span class="_ _53"> </span>standar<span class="ls59f">da<span class="_ _55"></span><span class="lscc">rc<span class="_ _2"></span><span class="ls0">hive <span class="_ _53"> </span>programs,<span class="_ _4b"> </span><span class="ff1a">tar</span></span></span></span></div><div class="t m0 x1af h49 y1240 ff19 fs26 fc0 sc0 ls0 ws0">(</div><div class="t m0 x1a3 h49 y123f ff19 fs26 fc0 sc0 ls0 ws0">1</div><div class="t m0 x1b4 h49 y1240 ff19 fs26 fc0 sc0 ls0 ws0">)</div><div class="t m0 x15b h4d y123f ff19 fs26 fc0 sc0 ls0 ws0">and<span class="_ _4b"> </span><span class="ff1a">cpio</span></div><div class="t m0 x16f h49 y1240 ff19 fs26 fc0 sc0 ls0 ws0">(</div><div class="t m0 x1b5 h49 y123f ff19 fs26 fc0 sc0 ls0 ws0">1</div><div class="t m0 x11d h49 y1240 ff19 fs26 fc0 sc0 ls0 ws0">)</div><div class="t m0 x11e h49 y123f ff19 fs26 fc0 sc0 ls59f ws0">,o<span class="_ _55"></span><span class="ls0">ptionally <span class="_ _e"> </span>call</span></div><div class="t m0 x32 h49 y1241 ff19 fs26 fc0 sc0 ls0 ws0">these functions to set a ﬁle’s times to the time values saved when the ﬁle was archived.</div><div class="t m0 x35 h4c y1242 ff16 fs26 fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h4d y1243 ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _42"> </span>program <span class="_ _42"> </span>shown <span class="_ _53"> </span>in <span class="_ _53"> </span>Figur<span class="ls5a0">e4<span class="_ _c"></span><span class="ls0">.21 <span class="_ _42"> </span>truncates <span class="_ _53"> </span>ﬁles <span class="_ _53"> </span>to <span class="_ _42"> </span>zer<span class="ls5a0">ol<span class="_ _c"></span><span class="ls0">ength <span class="_ _53"> </span>using <span class="_ _53"> </span>the<span class="_ _44"> </span><span class="ff1a">O_TRUNC</span></span></span></span></span></div><div class="t m0 x32 h4d y1244 ff19 fs26 fc0 sc0 ls0 ws0">option of <span class="_ _2"></span>the<span class="_ _66"> </span><span class="ff1a">open<span class="_ _66"> </span></span>function, <span class="_ _2"></span>but <span class="_ _2"></span>does <span class="_ _2"></span>not <span class="_ _2"></span>change their <span class="_ _2"></span>access <span class="_ _2"></span>time <span class="_ _2"></span>or modiﬁcation <span class="_ _2"></span>time.</div><div class="t m0 x32 h4d y1245 ff19 fs26 fc0 sc0 ls164 ws0">To <span class="_ _53"> </span>d<span class="_ _23"></span><span class="ls5a1">ot<span class="_ _4f"></span><span class="ls0">his, <span class="_ _2"></span>the program ﬁrst <span class="_ _2"></span>obtains <span class="_ _2"></span>the <span class="_ _2"></span>times with <span class="_ _2"></span>the<span class="_ _66"> </span><span class="ff1a">stat<span class="_ _66"> </span></span>function, <span class="_ _2"></span>truncates <span class="_ _2"></span>the ﬁle,</span></span></div><div class="t m0 x32 h4d y1246 ff19 fs26 fc0 sc0 ls0 ws0">and then resets the times with the<span class="_"> </span><span class="ff1a">futimens<span class="_ _80"> </span></span>function.</div><div class="t m0 x32 h5d y1247 ff1a fs2f fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h5d y1248 ff1a fs2f fc0 sc0 ls0 ws0">#include &lt;fcntl.h&gt;</div><div class="t m0 x32 h5d y1249 ff1a fs2f fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h5d y124a ff1a fs2f fc0 sc0 ls0 ws0">main(int argc, char *argv[])</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
