<div id="pfec" class="pf w4 h1f" data-page-no="ec"><div class="pc pcec w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bgec.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">202<span class="_ _1b"> </span><span class="ff19">Process <span class="_"> </span>Envir<span class="_ _0"></span>onment <span class="_ _1c1"> </span>Chapter<span class="_ _44"> </span>7</span></div><div class="t m0 x35 h27 y12f ff16 fsf fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h26 y131 ff19 fsf fc0 sc0 ls0 ws0">The program in Figur<span class="_ _0"></span><span class="ls44">e7<span class="_ _d"></span><span class="ls0">.3 demonstrates the use of the<span class="_"> </span><span class="ff1a">atexit<span class="_ _80"> </span></span>function.</span></span></div><div class="t m0 x32 h4e y1b56 ff1a fs28 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h4e y1b57 ff1a fs28 fc0 sc0 ls0 ws0">static void my_exit1(void);</div><div class="t m0 x32 h4e y1b58 ff1a fs28 fc0 sc0 ls0 ws0">static void my_exit2(void);</div><div class="t m0 x32 h4e y1b59 ff1a fs28 fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h4e y1b5a ff1a fs28 fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 x32 h4e y1b5b ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y1b5c ff1a fs28 fc0 sc0 ls0 ws0">if (atexit(my_exit2) != 0)</div><div class="t m0 x9d h4e y1b5d ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;can’t register my_exit2&quot;);</div><div class="t m0 x8a h4e y1b5e ff1a fs28 fc0 sc0 ls0 ws0">if (atexit(my_exit1) != 0)</div><div class="t m0 x9d h4e y1b5f ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;can’t register my_exit1&quot;);</div><div class="t m0 x8a h4e y1b60 ff1a fs28 fc0 sc0 ls0 ws0">if (atexit(my_exit1) != 0)</div><div class="t m0 x9d h4e y1b61 ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;can’t register my_exit1&quot;);</div><div class="t m0 x8a h4e y1b62 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;main is done\n&quot;);</div><div class="t m0 x8a h4e y1b63 ff1a fs28 fc0 sc0 ls0 ws0">return(0);</div><div class="t m0 x32 h4e y1b64 ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h4e y1b65 ff1a fs28 fc0 sc0 ls0 ws0">static void</div><div class="t m0 x32 h4e y1b66 ff1a fs28 fc0 sc0 ls0 ws0">my_exit1(void)</div><div class="t m0 x32 h4e y1b67 ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y1b68 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;first exit handler\n&quot;);</div><div class="t m0 x32 h4e y1b69 ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h4e y1b6a ff1a fs28 fc0 sc0 ls0 ws0">static void</div><div class="t m0 x32 h4e y1b6b ff1a fs28 fc0 sc0 ls0 ws0">my_exit2(void)</div><div class="t m0 x32 h4e y1b6c ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y1b6d ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;second exit handler\n&quot;);</div><div class="t m0 x32 h4e y1b6e ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x63 h2e y1b6f ff18 fs11 fc0 sc0 ls0 ws0">Figure 7.3<span class="_ _5a"> </span><span class="ff19">Example of exit handlers</span></div><div class="t m0 x32 h55 y1b70 ff19 fs2c fc0 sc0 ls0 ws0">Executing the program in Figur<span class="_ _0"></span><span class="ls142">e7<span class="_ _d"></span><span class="ls0">.3 yields</span></span></div><div class="t m0 x3f h5d y1b71 ff1a fs2f fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">./a.out</span></div><div class="t m0 x3f h5d y1b72 ff1a fs2f fc0 sc0 ls0 ws0">main is done</div><div class="t m0 x3f h5d y1b73 ff1a fs2f fc0 sc0 ls0 ws0">first exit handler</div><div class="t m0 x3f h5d y1b74 ff1a fs2f fc0 sc0 ls0 ws0">first exit handler</div><div class="t m0 x3f h5d y1b75 ff1a fs2f fc0 sc0 ls0 ws0">second exit handler</div><div class="t m0 x32 h55 y1b76 ff19 fs2c fc0 sc0 ls0 ws0">An <span class="_ _9"></span>exit <span class="_ _9"></span>handler <span class="_ _9"></span>is <span class="_ _9"></span>called <span class="_ _9"></span>once <span class="_ _9"></span>for <span class="_ _9"></span>each <span class="_ _9"></span>time <span class="_ _9"></span>it <span class="_ _9"></span>is <span class="_ _9"></span>register<span class="_ _0"></span>ed. <span class="_ _45"> </span>In<span class="_ _45"> </span>Figur<span class="_ _0"></span><span class="ls851">e7<span class="_ _b"></span><span class="ls0">.3, <span class="_ _9"></span>the <span class="_ _9"></span>ﬁrst <span class="_ _9"></span>exit</span></span></div><div class="t m0 x32 h54 y1b77 ff19 fs2c fc0 sc0 ls0 ws0">handler <span class="_ _53"> </span>is <span class="_ _53"> </span>registered <span class="_ _42"> </span>twice, <span class="_ _53"> </span>so <span class="_ _53"> </span>it <span class="_ _53"> </span>is <span class="_ _e"> </span>called <span class="_ _53"> </span>two <span class="_ _53"> </span>times.<span class="_ _65"> </span>Note <span class="_ _53"> </span>that <span class="_ _e"> </span>we <span class="_ _53"> </span>don’t <span class="_ _53"> </span>call<span class="_ _4b"> </span><span class="ff1a">exit</span>;</div><div class="t m0 x32 h54 y1b78 ff19 fs2c fc0 sc0 ls0 ws0">instead, we return fr<span class="_ _0"></span>om<span class="_"> </span><span class="ff1a">main</span>.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
