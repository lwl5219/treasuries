<div id="pf97" class="pf w4 h1f" data-page-no="97"><div class="pc pc97 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg97.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h7a ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>4.15<span class="_ _181"> </span><span class="ff1a">link</span>,<span class="_ _4b"> </span><span class="ff1a">linkat</span>,<span class="_ _59"> </span><span class="ff1a">unlink</span>,<span class="_ _4b"> </span><span class="ff1a">unlinkat</span><span class="ls30a">,a<span class="_ _55"></span><span class="ls0">nd<span class="_ _4b"> </span><span class="ff1a">remove<span class="_ _4b"> </span></span>Functions<span class="_ _1b"> </span><span class="ff18 ls153">11<span class="_ _3"></span><span class="ls0">7</span></span></span></span></div><div class="t m0 x3f h2a y12f ff19 fsf fc0 sc0 ls0 ws0">Most <span class="_ _e"> </span>implementations <span class="_"> </span>r<span class="_ _1"></span>equir<span class="ls24f">et<span class="_ _55"></span><span class="ls0">hat <span class="_ _e"> </span>both <span class="_"> </span>pathnames <span class="_ _53"> </span>be <span class="_"> </span>on <span class="_ _53"> </span>the <span class="_"> </span>same <span class="_ _53"> </span>ﬁle <span class="_"> </span>system,</span></span></div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">although <span class="_ _23"></span>POSIX.1 <span class="_ _23"></span>allows <span class="_ _9"></span>an <span class="_ _23"> </span>implementation <span class="_ _23"> </span>to <span class="_ _23"> </span>support <span class="_ _23"> </span>linking <span class="_ _23"></span>across <span class="_ _9"></span>ﬁle <span class="_ _23"> </span>systems.<span class="_ _51"> </span>If</div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">an <span class="_ _23"></span>implementation <span class="_ _23"></span>supports <span class="_ _23"></span>the <span class="_ _9"></span>creation <span class="_ _23"></span>of <span class="_ _23"></span>har<span class="ls535">dl<span class="_ _43"></span><span class="ls0">inks <span class="_ _23"></span>to <span class="_ _23"></span>directories, <span class="_ _9"></span>it <span class="_ _23"> </span>is <span class="_ _23"> </span>restricted <span class="_ _23"></span>to</span></span></div><div class="t m0 x32 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">only the superuser<span class="_ _1"></span><span class="ls536">.T<span class="_ _5b"></span><span class="ls0">his <span class="_ _2"></span>constraint exists because <span class="_ _2"></span>such har<span class="lsf5">dl<span class="_ _4f"></span><span class="ls0">inks <span class="_ _2"></span>can cause <span class="_ _2"></span>loops in the</span></span></span></span></div><div class="t m0 x32 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">ﬁle <span class="_ _3"></span>system, <span class="_ _9"></span>which <span class="_ _3"></span>most <span class="_ _9"></span>utilities <span class="_ _3"></span>that <span class="_ _9"></span>process <span class="_ _2"></span>the <span class="_ _9"></span>ﬁle <span class="_ _3"></span>system <span class="_ _9"></span>aren’t <span class="_ _3"></span>capable <span class="_ _3"></span>of <span class="_ _9"></span>handling.</div><div class="t m0 x32 h2a y134 ff19 fsf fc0 sc0 ls0 ws0">(W<span class="_ _6"></span><span class="ls537">es<span class="_ _b"></span><span class="ls0">how <span class="_ _9"></span>an <span class="_ _9"></span>example <span class="_ _23"> </span>of <span class="_ _23"></span>a <span class="_ _9"></span>loop <span class="_ _23"></span>intr<span class="_ _0"></span>oduced <span class="_ _9"></span>by <span class="_ _23"></span>a <span class="_ _9"></span>symbolic <span class="_ _23"></span>link <span class="_ _9"></span>in <span class="_ _23"></span>Section <span class="_ _9"></span>4.17.)<span class="_ _51"> </span>Many</span></span></div><div class="t m0 x32 h2a y135 ff19 fsf fc0 sc0 ls0 ws0">ﬁle system implementations disallow har<span class="ls44">dl<span class="_ _4f"></span><span class="ls0">inks to directories for this reason.</span></span></div><div class="t m0 x3f h26 y136 ff19 fsf fc0 sc0 ls5f ws0">To <span class="_ _53"> </span>r<span class="_ _3"></span><span class="ls0">emove an existing directory entry<span class="_ _4"></span>,<span class="_"> </span>we<span class="_"> </span>call the<span class="_"> </span><span class="ff1a">unlink<span class="_ _66"> </span></span>function.</span></div><div class="t m0 x3f h57 y10e7 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;unistd.h&gt;</div><div class="t m0 x3f h57 y10e8 ff1a fs2d fc0 sc0 ls0 ws0">int unlink(const char *<span class="ff1b">pathname</span>);</div><div class="t m0 x3f h57 y10e9 ff1a fs2d fc0 sc0 ls0 ws0">int unlinkat(int<span class="_"> </span><span class="ff1b">fd</span><span class="ls15c">,c<span class="_ _1d"></span><span class="ls0">onst char *<span class="ff1b">pathname</span><span class="ls15c">,i<span class="_ _5b"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">ﬂag</span>);</span></span></span></span></div><div class="t m0 x103 h5f y10ea ff19 fs2d fc0 sc0 ls0 ws0">Both return: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>err<span class="_ _0"></span>or</div><div class="t m0 x32 h49 y10eb ff19 fs26 fc0 sc0 ls0 ws0">These <span class="_ _53"> </span>functions <span class="_ _53"> </span>remove <span class="_ _42"> </span>the <span class="_ _53"> </span>directory <span class="_ _42"> </span>entry <span class="_ _e"> </span>and <span class="_ _53"> </span>decrement <span class="_ _42"> </span>the <span class="_ _53"> </span>link <span class="_ _53"> </span>count <span class="_ _53"> </span>of <span class="_ _53"> </span>the <span class="_ _53"> </span>ﬁle</div><div class="t m0 x32 h4a y10ec ff19 fs26 fc0 sc0 lscc ws0">re<span class="ls0">ferenced <span class="_ _42"> </span>by<span class="_ _44"> </span><span class="ff1b">pathname</span><span class="ls538">.I<span class="_ _52"></span><span class="ls539">ft<span class="_ _43"></span><span class="ls0">her<span class="_ _0"></span><span class="ls539">ea<span class="_ _43"></span><span class="lscc">re <span class="_ _42"> </span>o<span class="_ _2"></span><span class="ls0">ther <span class="_ _42"> </span>links <span class="_ _42"> </span>to <span class="_ _42"> </span>the <span class="_ _42"> </span>ﬁle, <span class="_ _42"> </span>the <span class="_ _42"> </span>data <span class="_ _42"> </span>in <span class="_ _42"> </span>the <span class="_ _42"> </span>ﬁle <span class="_ _53"> </span>is <span class="_ _42"> </span>still</span></span></span></span></span></span></span></div><div class="t m0 x32 h49 y10ed ff19 fs26 fc0 sc0 ls0 ws0">accessible through the other links.<span class="_ _59"> </span>The ﬁle is not changed if an error occurs.</div><div class="t m0 x3f h49 y10ee ff19 fs26 fc0 sc0 ls0 ws0">As <span class="_ _9"></span>mentioned <span class="_ _9"></span>earlier<span class="_ _6"></span>,<span class="_ _45"> </span>to<span class="_ _45"> </span>unlink <span class="_ _9"></span>a <span class="_ _9"></span>ﬁle, <span class="_ _23"></span>we <span class="_ _3"></span>must <span class="_ _23"></span>have <span class="_ _9"></span>write <span class="_ _9"></span>permission <span class="_ _9"></span>and <span class="_ _9"></span>execute</div><div class="t m0 x32 h49 y10ef ff19 fs26 fc0 sc0 ls0 ws0">permission <span class="_ _42"> </span>in <span class="_ _42"> </span>the <span class="_ _23"> </span>directory <span class="_ _42"> </span>containing <span class="_ _42"> </span>the <span class="_ _42"> </span>directory <span class="_ _23"></span>entry<span class="_ _4"></span>,<span class="_ _44"> </span>as<span class="_ _44"> </span>it<span class="_ _35"> </span>is<span class="_ _44"> </span>the <span class="_ _42"> </span>dir<span class="_ _0"></span>ectory <span class="_ _42"> </span>entry</div><div class="t m0 x32 h49 y10f0 ff19 fs26 fc0 sc0 ls0 ws0">that <span class="_ _9"></span>we <span class="_ _9"></span>will <span class="_ _9"></span>be <span class="_ _23"></span>r<span class="_ _0"></span>emoving. <span class="_ _45"> </span>Also,<span class="_ _45"> </span>as <span class="_ _9"></span>mentioned <span class="_ _9"></span>in <span class="_ _9"></span>Section <span class="_ _23"></span>4.10, <span class="_ _9"></span>if <span class="_ _9"></span>the <span class="_ _9"></span>sticky <span class="_ _9"></span>bit <span class="_ _9"></span>is <span class="_ _23"></span>set <span class="_ _9"></span>in</div><div class="t m0 x32 h49 y10f1 ff19 fs26 fc0 sc0 ls0 ws0">this <span class="_ _53"> </span>directory <span class="_ _42"> </span>we <span class="_ _53"> </span>must <span class="_ _53"> </span>have <span class="_ _53"> </span>write <span class="_ _53"> </span>permission <span class="_ _53"> </span>for <span class="_ _53"> </span>the <span class="_ _53"> </span>directory <span class="_ _42"> </span>and <span class="_ _53"> </span>meet <span class="_ _53"> </span>one <span class="_ _53"> </span>of <span class="_ _53"> </span>the</div><div class="t m0 x32 h49 y10f2 ff19 fs26 fc0 sc0 ls0 ws0">following criteria:</div><div class="t m0 x3f h49 y10f3 ff19 fs26 fc0 sc0 ls15d ws0">•O<span class="_ _4d"></span><span class="ls0">wn the ﬁle</span></div><div class="t m0 x3f h49 y10f4 ff19 fs26 fc0 sc0 ls15d ws0">•O<span class="_ _4d"></span><span class="ls0">wn the directory</span></div><div class="t m0 x3f h49 y10f5 ff19 fs26 fc0 sc0 ls15d ws0">•H<span class="_ _4d"></span><span class="ls0">ave superuser privileges</span></div><div class="t m0 x3f h49 y10f6 ff19 fs26 fc0 sc0 ls0 ws0">Only <span class="_ _42"> </span>when <span class="_ _42"> </span>the <span class="_ _53"> </span>link <span class="_ _42"> </span>count <span class="_ _42"> </span>reaches <span class="_ _42"> </span>0 <span class="_ _42"> </span>can <span class="_ _53"> </span>the <span class="_ _42"> </span>contents <span class="_ _42"> </span>of <span class="_ _53"> </span>the <span class="_ _42"> </span>ﬁle <span class="_ _42"> </span>be <span class="_ _53"> </span>deleted.<span class="_ _54"> </span>One</div><div class="t m0 x32 h49 y10f7 ff19 fs26 fc0 sc0 ls0 ws0">other <span class="_ _e"> </span>condition <span class="_ _e"> </span>prevents <span class="_ _e"> </span>the <span class="_ _e"> </span>contents <span class="_ _e"> </span>of <span class="_"> </span>a <span class="_ _53"> </span>ﬁle <span class="_"> </span>fr<span class="_ _1"></span>om <span class="_"> </span>being <span class="_ _53"> </span>deleted: <span class="_"> </span>as <span class="_ _53"> </span>long <span class="_"> </span>as <span class="_ _53"> </span>some</div><div class="t m0 x32 h49 y10f8 ff19 fs26 fc0 sc0 ls0 ws0">process <span class="_ _23"> </span>has <span class="_ _53"> </span>the <span class="_ _42"> </span>ﬁle <span class="_ _42"> </span>open, <span class="_ _53"> </span>its <span class="_ _42"> </span>contents <span class="_ _42"> </span>will <span class="_ _53"> </span>not <span class="_ _42"> </span>be <span class="_ _42"> </span>deleted.<span class="_ _54"> </span>When <span class="_ _53"> </span>a <span class="_ _42"> </span>ﬁle <span class="_ _42"> </span>is <span class="_ _42"> </span>closed, <span class="_ _53"> </span>the</div><div class="t m0 x32 h49 y10f9 ff19 fs26 fc0 sc0 ls0 ws0">kernel <span class="_ _3"></span>ﬁrst <span class="_ _9"></span>checks <span class="_ _9"></span>the <span class="_ _3"></span>count <span class="_ _9"></span>of <span class="_ _9"></span>the <span class="_ _3"></span>number <span class="_ _9"></span>of <span class="_ _9"></span>processes <span class="_ _3"></span>that <span class="_ _9"></span>have <span class="_ _3"></span>the <span class="_ _9"></span>ﬁle <span class="_ _9"></span>open.<span class="_ _16"> </span>If <span class="_ _9"></span>this</div><div class="t m0 x32 h49 y10fa ff19 fs26 fc0 sc0 ls0 ws0">count has reached 0, the kernel then checks <span class="_ _2"></span>the link count; if <span class="_ _2"></span>it is 0, the <span class="_ _2"></span>ﬁle’s contents are</div><div class="t m0 x32 h49 y10fb ff19 fs26 fc0 sc0 ls0 ws0">deleted.</div><div class="t m0 x3f h4d y10fc ff19 fs26 fc0 sc0 ls0 ws0">If <span class="_ _66"> </span>the<span class="_ _61"> </span><span class="ff1b">pathname<span class="_ _61"> </span></span>argument <span class="_"> </span>is <span class="_ _47"> </span>a <span class="_"> </span>relative <span class="_ _66"> </span>pathname, <span class="_ _47"> </span>then <span class="_"> </span>the<span class="_ _61"> </span><span class="ff1a">unlinkat<span class="_ _61"> </span></span>function</div><div class="t m0 x32 h4a y10fd ff19 fs26 fc0 sc0 ls0 ws0">evaluates <span class="_ _42"> </span>the <span class="_ _53"> </span>pathname <span class="_ _42"> </span>relative <span class="_ _42"> </span>to <span class="_ _53"> </span>the <span class="_ _42"> </span>directory <span class="_ _42"> </span>represented <span class="_ _42"> </span>by <span class="_ _42"> </span>the<span class="_ _44"> </span><span class="ff1b">fd<span class="_ _44"> </span></span>ﬁle <span class="_ _53"> </span>descriptor</div><div class="t m0 x32 h4d y10fe ff19 fs26 fc0 sc0 ls0 ws0">argument. <span class="_ _4b"> </span>If<span class="_ _46"> </span>the<span class="_ _59"> </span><span class="ff1b">fd<span class="_ _46"> </span></span>argument <span class="_ _e"> </span>is <span class="_"> </span>set <span class="_"> </span>to <span class="_"> </span>the <span class="_ _e"> </span>value<span class="_ _59"> </span><span class="ff1a">AT_FDCWD</span><span class="ls53a">,t<span class="_ _55"></span><span class="ls0">hen <span class="_"> </span>the <span class="_ _e"> </span>pathname <span class="_"> </span>is</span></span></div><div class="t m0 x32 h49 y10ff ff19 fs26 fc0 sc0 ls0 ws0">evaluated <span class="_ _45"> </span>relative <span class="_ _47"> </span>to <span class="_ _45"> </span>the <span class="_ _45"> </span>current <span class="_ _47"> </span>working <span class="_ _45"> </span>directory <span class="_ _45"> </span>of <span class="_ _45"> </span>the <span class="_ _47"> </span>calling <span class="_ _45"> </span>process. <span class="_ _16"> </span>If<span class="_ _5a"> </span>the</div><div class="t m0 x32 h4a y1100 ff1b fs26 fc0 sc0 ls0 ws0">pathname<span class="_"> </span><span class="ff19">argument is an absolute pathname, then the<span class="_"> </span></span>fd<span class="_"> </span><span class="ff19">ar<span class="_ _0"></span>gument is ignor<span class="_ _0"></span>ed.</span></div><div class="t m0 x3f h4a y1101 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _16"> </span><span class="ff1b">ﬂag<span class="_ _5a"> </span></span>argument <span class="_ _47"> </span>gives <span class="_ _45"> </span>callers <span class="_ _45"> </span>a <span class="_ _47"> </span>way <span class="_ _45"> </span>to <span class="_ _47"> </span>change <span class="_ _45"> </span>the <span class="_ _45"> </span>default <span class="_ _47"> </span>behavior <span class="_ _45"> </span>of <span class="_ _45"> </span>the</div><div class="t m0 x32 h4d y1102 ff1a fs26 fc0 sc0 ls0 ws0">unlinkat<span class="_ _66"> </span><span class="ff19">function. <span class="_ _66"> </span>When<span class="_ _47"> </span>the<span class="_ _66"> </span></span>AT_REMOVEDIR<span class="_ _66"> </span><span class="ff19">ﬂag <span class="_ _2"></span>is <span class="_ _2"></span>set, <span class="_ _2"></span>then <span class="_ _2"></span>the<span class="_ _47"> </span></span>unlinkat<span class="_ _66"> </span><span class="ff19">function</span></div><div class="t m0 x32 h4d y1103 ff19 fs26 fc0 sc0 ls0 ws0">can <span class="_ _42"> </span>be <span class="_ _42"> </span>used <span class="_ _53"> </span>to <span class="_ _42"> </span>remove <span class="_ _42"> </span>a <span class="_ _42"> </span>directory<span class="_ _4"></span><span class="ls53b">,s<span class="_ _43"></span><span class="ls0">imilar <span class="_ _42"> </span>to <span class="_ _42"> </span>using<span class="_ _44"> </span><span class="ff1a">rmdir</span><span class="ls53c">.I<span class="_ _52"></span><span class="ls53d">ft<span class="_ _43"></span><span class="ls0">his <span class="_ _42"> </span>ﬂag <span class="_ _42"> </span>is <span class="_ _42"> </span>clear<span class="_ _1"></span><span class="ls53d">,t<span class="_ _43"></span><span class="ls0">hen</span></span></span></span></span></span></span></div><div class="t m0 x32 h4d y1104 ff1a fs26 fc0 sc0 ls0 ws0">unlinkat<span class="_ _80"> </span><span class="ff19">operates like<span class="_"> </span></span>unlink<span class="ff19">.</span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
