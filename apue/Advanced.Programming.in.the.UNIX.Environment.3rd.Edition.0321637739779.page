<div id="pf30b" class="pf w4 h1f" data-page-no="30b"><div class="pc pc30b w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg30b.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>20.3<span class="_ _ec"> </span>The <span class="_"> </span>Library<span class="_ _1fb"> </span><span class="ff18">745</span></div><div class="t m0 x3f h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">#include &quot;apue_db.h&quot;</div><div class="t m0 x3f h57 y8f6 ff1a fs2d fc0 sc0 ls0 ws0">DBHANDLE db_open(const char *<span class="ff1b">pathname</span><span class="ls15c">,i<span class="_ _1d"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">oﬂag</span><span class="ls15c">,.<span class="_ _5b"></span><span class="ls0">.. /* int<span class="_"> </span><span class="ff1b">mode<span class="_ _61"> </span></span>*/);</span></span></span></span></div><div class="t m0 x67 h57 y556a ff19 fs2d fc0 sc0 ls0 ws0">Returns: database handle if OK,<span class="_"> </span><span class="ff1a">NULL<span class="_ _e"> </span></span>on error</div><div class="t m0 x3f h57 y556b ff1a fs2d fc0 sc0 ls0 ws0">void db_close(DBHANDLE<span class="_"> </span><span class="ff1b">db</span>);</div><div class="t m0 x32 h4d y556c ff19 fs26 fc0 sc0 ls0 ws0">If<span class="_ _61"> </span><span class="ff1a">db_open<span class="_ _61"> </span></span>is <span class="_ _47"> </span>successful, <span class="_ _47"> </span>two <span class="_ _66"> </span>ﬁles <span class="_ _47"> </span>ar<span class="ls1600">ec<span class="_ _1d"></span><span class="lscc">re<span class="ls0">ated:<span class="_ _16"> </span><span class="ff1b">pathname.idx<span class="_ _61"> </span></span>is <span class="_ _47"> </span>the <span class="_ _66"> </span>index <span class="_ _47"> </span>ﬁle, <span class="_ _47"> </span>and</span></span></span></div><div class="t m0 x32 h4d y556d ff1b fs26 fc0 sc0 ls0 ws0">pathname.dat<span class="_"> </span><span class="ff19">is the <span class="_ _2"></span>data ﬁle.<span class="_ _46"> </span>The<span class="_ _66"> </span></span>oﬂag<span class="_"> </span><span class="ff19">argument is used <span class="_ _2"></span>as the <span class="_ _2"></span>second argument to<span class="_"> </span><span class="ff1a">open</span></span></div><div class="t m0 x32 h49 y556e ff19 fs26 fc0 sc0 ls0 ws0">(Section <span class="_ _2"></span>3.3) <span class="_ _2"></span>to <span class="_ _3"></span>specify <span class="_ _2"></span>how <span class="_ _2"></span>the <span class="_ _3"></span>ﬁles <span class="_ _2"></span>are<span class="_ _66"> </span>to<span class="_ _47"> </span>be<span class="_ _47"> </span>opened <span class="_ _2"></span>(e.g., <span class="_ _2"></span>read-only<span class="_ _4"></span><span class="ls7f2">,r<span class="_ _8"></span><span class="ls0">ead–write, <span class="_ _3"></span>create</span></span></div><div class="t m0 x32 h4d y556f ff19 fs26 fc0 sc0 ls0 ws0">ﬁle <span class="_ _9"></span>if <span class="_ _23"></span>it <span class="_ _9"></span>doesn’t <span class="_ _9"></span>exist).<span class="_ _51"> </span>The<span class="_ _45"> </span><span class="ff1b">mode<span class="_ _45"> </span></span>argument <span class="_ _9"></span>is <span class="_ _9"></span>used <span class="_ _9"></span>as <span class="_ _23"></span>the <span class="_ _9"></span>thir<span class="ls10e5">da<span class="_ _b"></span><span class="lscc">rg<span class="ls0">ument <span class="_ _9"></span>to<span class="_ _35"> </span><span class="ff1a">open<span class="_ _45"> </span></span>(the</span></span></span></div><div class="t m0 x32 h49 y5570 ff19 fs26 fc0 sc0 ls0 ws0">ﬁle access permissions) if the database ﬁles ar<span class="lsd3">ec<span class="_ _4f"></span><span class="lscc">re<span class="_ _2"></span><span class="ls0">ated.</span></span></span></div><div class="t m0 x3f h4d y5571 ff19 fs26 fc0 sc0 ls0 ws0">When <span class="_ _9"></span>we’r<span class="lsdc4">ed<span class="_ _b"></span><span class="ls0">one <span class="_ _9"></span>with <span class="_ _9"></span>a <span class="_ _23"></span>database, <span class="_ _9"></span>we <span class="_ _9"></span>call<span class="_ _35"> </span><span class="ff1a">db_close</span><span class="ls1601">.I<span class="_ _26"></span><span class="lsdc4">tc<span class="_ _b"></span><span class="ls0">loses <span class="_ _9"></span>the <span class="_ _23"></span>index <span class="_ _9"></span>ﬁle <span class="_ _9"></span>and</span></span></span></span></span></div><div class="t m0 x32 h49 y5572 ff19 fs26 fc0 sc0 ls0 ws0">the data ﬁle and releases any memory that it allocated for internal buf<span class="_ _0"></span>fers.</div><div class="t m0 x3f h49 y5573 ff19 fs26 fc0 sc0 ls0 ws0">When <span class="_ _42"> </span>we <span class="_ _23"> </span>stor<span class="lse80">ean<span class="_ _43"></span><span class="ls0">ew <span class="_ _42"> </span>recor<span class="_ _1"></span>d<span class="_ _44"> </span>in<span class="_ _35"> </span>the <span class="_ _42"> </span>database, <span class="_ _42"> </span>we <span class="_ _42"> </span>have <span class="_ _42"> </span>to <span class="_ _42"> </span>specify <span class="_ _42"> </span>the <span class="_ _23"> </span>key <span class="_ _42"> </span>for <span class="_ _42"> </span>the</span></span></div><div class="t m0 x32 h49 y5574 ff19 fs26 fc0 sc0 lscc ws0">re<span class="ls0">cor<span class="ls1602">da<span class="_ _1d"></span><span class="ls0">nd <span class="_ _47"> </span>the <span class="_ _47"> </span>data <span class="_ _47"> </span>associated <span class="_ _66"> </span>with <span class="_ _47"> </span>the <span class="_ _47"> </span>key<span class="_ _6"></span><span class="ls1603">.I<span class="_ _56"></span><span class="lseee">ft<span class="_ _5b"></span><span class="ls0">he <span class="_ _47"> </span>database <span class="_ _47"> </span>contained <span class="_ _66"> </span>personnel</span></span></span></span></span></span></div><div class="t m0 x32 h49 y5575 ff19 fs26 fc0 sc0 lscc ws0">re<span class="ls0">cords, <span class="_ _2"></span>the <span class="_ _2"></span>key <span class="_ _3"></span>could <span class="_ _2"></span>be <span class="_ _2"></span>the <span class="_ _3"></span>employee <span class="_ _2"></span>ID, <span class="_ _2"></span>and <span class="_ _3"></span>the <span class="_ _2"></span>data <span class="_ _3"></span>could <span class="_ _2"></span>be <span class="_ _2"></span>the <span class="_ _3"></span>employee’s <span class="_ _2"></span>name,</span></div><div class="t m0 x32 h49 y5576 ff19 fs26 fc0 sc0 ls0 ws0">address, telephone number<span class="_ _1"></span><span class="ls1604">,d<span class="_ _4f"></span><span class="ls0">ate <span class="_ _2"></span>of hire, and the <span class="_ _2"></span>like.<span class="_ _46"> </span>Our <span class="_ _2"></span>implementation requires that</span></span></div><div class="t m0 x32 h49 y5577 ff19 fs26 fc0 sc0 ls0 ws0">the <span class="_ _2"></span>key <span class="_ _2"></span>for <span class="_ _3"></span>each <span class="_ _2"></span>record<span class="_"> </span>be<span class="_ _47"> </span>unique. <span class="_ _66"> </span>(W<span class="_ _6"></span><span class="ls718">ec<span class="_ _4f"></span><span class="ls0">an’t <span class="_ _3"></span>have <span class="_ _2"></span>two <span class="_ _3"></span>employee <span class="_ _2"></span>records with <span class="_ _2"></span>the <span class="_ _3"></span>same</span></span></div><div class="t m0 x32 h49 y5578 ff19 fs26 fc0 sc0 ls0 ws0">employee ID, for example.)</div><div class="t m0 x3f h4e y5579 ff1a fs28 fc0 sc0 ls0 ws0">#include &quot;apue_db.h&quot;</div><div class="t m0 x3f h4e y557a ff1a fs28 fc0 sc0 ls0 ws0">int db_store(DBHANDLE<span class="_"> </span><span class="ff1b">db</span><span class="ls1b6">,c<span class="_ _1d"></span><span class="ls0">onst char *<span class="ff1b">key</span><span class="ls1b6">,c<span class="_ _5b"></span><span class="ls0">onst char *<span class="ff1b">data</span>,</span></span></span></span></div><div class="t m0 x234 h4e y557b ff1a fs28 fc0 sc0 ls0 ws0">int<span class="_"> </span><span class="ff1b">ﬂag</span>);</div><div class="t m0 xc5 h7c y557c ff19 fs28 fc0 sc0 ls0 ws0">Returns: 0 if OK, nonzero<span class="_"> </span>on<span class="_"> </span>err<span class="_ _0"></span>or (see following)</div><div class="t m0 x32 h60 y557d ff19 fs2c fc0 sc0 ls0 ws0">The<span class="_ _45"> </span><span class="ff1b">key<span class="_ _45"> </span></span>and<span class="_ _45"> </span><span class="ff1b">data<span class="_ _35"> </span></span>ar<span class="_ _0"></span>guments <span class="_ _9"></span>ar<span class="ls329">en<span class="_ _b"></span><span class="ls0">ull-terminated <span class="_ _9"></span>character <span class="_ _9"></span>strings.<span class="_ _51"> </span>The <span class="_ _9"></span>only <span class="_ _9"></span>restriction</span></span></div><div class="t m0 x32 h55 y557e ff19 fs2c fc0 sc0 ls0 ws0">on <span class="_ _53"> </span>these <span class="_ _e"> </span>two <span class="_ _e"> </span>strings <span class="_ _e"> </span>is <span class="_ _e"> </span>that <span class="_ _53"> </span>neither <span class="_ _e"> </span>can <span class="_ _e"> </span>contain <span class="_ _e"> </span>null <span class="_ _e"> </span>bytes.<span class="_ _65"> </span>They <span class="_ _e"> </span>may<span class="_ _6"></span><span class="ls1605">,f<span class="_ _55"></span><span class="ls0">or <span class="_ _e"> </span>example,</span></span></div><div class="t m0 x32 h55 y557f ff19 fs2c fc0 sc0 ls0 ws0">contain newlines.</div><div class="t m0 x3f h54 y5580 ff19 fs2c fc0 sc0 ls0 ws0">The<span class="_ _44"> </span><span class="ff1b">ﬂag<span class="_ _44"> </span></span>argument <span class="_ _42"> </span>can <span class="_ _53"> </span>be<span class="_ _44"> </span><span class="ff1a">DB_INSERT<span class="_ _44"> </span></span>(to <span class="_ _53"> </span>insert <span class="_ _42"> </span>a <span class="_ _53"> </span>new <span class="_ _53"> </span>recor<span class="_ _0"></span>d),<span class="_ _44"> </span><span class="ff1a">DB_REPLACE<span class="_ _44"> </span></span>(to</div><div class="t m0 x32 h54 y5581 ff19 fs2c fc0 sc0 ls150 ws0">re<span class="ls0">place <span class="_ _2"></span>an <span class="_ _2"></span>existing <span class="_ _2"></span>recor<span class="_ _0"></span>d), or<span class="_ _66"> </span><span class="ff1a">DB_STORE<span class="_ _47"> </span></span>(to either <span class="_ _2"></span>insert <span class="_ _2"></span>or replace <span class="_ _2"></span>a record, whichever</span></div><div class="t m0 x32 h54 y5582 ff19 fs2c fc0 sc0 ls0 ws0">is <span class="_ _53"> </span>appropriate). <span class="_ _4b"> </span>These<span class="_ _4b"> </span>three <span class="_ _53"> </span>constants <span class="_ _e"> </span>ar<span class="ls1606">ed<span class="_ _55"></span><span class="ls0">eﬁned <span class="_ _e"> </span>in <span class="_ _e"> </span>the<span class="_ _4b"> </span><span class="ff1a">apue_db.h<span class="_ _4b"> </span></span>header<span class="_ _1"></span><span class="ls1607">.I<span class="_ _64"></span><span class="ls1606">fw<span class="_ _55"></span><span class="ls0">e</span></span></span></span></span></div><div class="t m0 x32 h54 y5583 ff19 fs2c fc0 sc0 ls0 ws0">specify <span class="_ _3"></span>either<span class="_ _45"> </span><span class="ff1a">DB_INSERT<span class="_ _45"> </span></span>or<span class="_ _47"> </span><span class="ff1a">DB_STORE<span class="_ _45"> </span></span>and <span class="_ _3"></span>the <span class="_ _9"></span>recor<span class="_ _0"></span><span class="ls1608">dd<span class="_ _b"></span><span class="ls0">oes <span class="_ _9"></span>not <span class="_ _3"></span>exist, <span class="_ _9"></span>a <span class="_ _9"></span>new <span class="_ _3"></span>recor<span class="ls1609">di<span class="_ _b"></span><span class="ls0">s</span></span></span></span></div><div class="t m0 x32 h54 y5584 ff19 fs2c fc0 sc0 ls0 ws0">inserted. <span class="_ _47"> </span>If<span class="_ _47"> </span>we <span class="_ _2"></span>specify <span class="_ _3"></span>either<span class="_ _47"> </span><span class="ff1a">DB_REPLACE<span class="_ _47"> </span></span>or<span class="_ _47"> </span><span class="ff1a">DB_STORE<span class="_ _47"> </span></span>and <span class="_ _3"></span>the <span class="_ _3"></span>recor<span class="_ _1"></span><span class="ls160a">da<span class="_ _4f"></span><span class="ls0">lready <span class="_ _2"></span>exists,</span></span></div><div class="t m0 x32 h54 y5585 ff19 fs2c fc0 sc0 ls0 ws0">the <span class="_ _2"></span>existing <span class="_ _2"></span>record<span class="_"> </span>is<span class="_ _47"> </span>replaced with <span class="_ _2"></span>the <span class="_ _3"></span>new <span class="_ _2"></span>recor<span class="_ _0"></span>d. <span class="_ _66"> </span>If<span class="_ _47"> </span>we <span class="_ _2"></span>specify<span class="_ _47"> </span><span class="ff1a">DB_REPLACE<span class="_ _66"> </span></span>and <span class="_ _3"></span>the</div><div class="t m0 x32 h54 y5586 ff19 fs2c fc0 sc0 ls150 ws0">re<span class="ls0">cor<span class="ls160b">dd<span class="_ _43"></span><span class="ls0">oesn’t <span class="_ _23"> </span>exist, <span class="_ _23"> </span>we <span class="_ _23"> </span>set<span class="_ _35"> </span><span class="ff1a">errno<span class="_ _35"> </span></span>to<span class="_ _35"> </span><span class="ff1a">ENOENT<span class="_ _45"> </span></span>and <span class="_ _23"> </span>return<span class="_ _35"> </span><span class="ff20">−</span><span class="ls160c">1w<span class="_ _43"></span><span class="ls0">ithout <span class="_ _23"> </span>adding <span class="_ _23"> </span>the <span class="_ _23"> </span>new</span></span></span></span></span></div><div class="t m0 x32 h54 y5587 ff19 fs2c fc0 sc0 ls150 ws0">re<span class="ls0">cord. <span class="_"> </span>If<span class="_"> </span>we specify<span class="_"> </span><span class="ff1a">DB_INSERT<span class="_ _66"> </span></span>and the recor<span class="_ _0"></span><span class="ls4d7">da<span class="_ _d"></span><span class="ls0">lready exists, no r<span class="_ _0"></span>ecord<span class="_"> </span>is<span class="_"> </span>inserted. <span class="_"> </span>In</span></span></span></div><div class="t m0 x32 h55 y5588 ff19 fs2c fc0 sc0 ls0 ws0">this case, the return value is 1 to distinguish it fr<span class="_ _0"></span>om a normal err<span class="_ _0"></span>or return</div><div class="t m0 x51 h55 y5589 ff19 fs2c fc0 sc0 ls0 ws0">(</div><div class="t m0 x37 h55 y5588 ff20 fs2c fc0 sc0 ls0 ws0">−<span class="ff19">1</span></div><div class="t m0 xf9 h55 y5589 ff19 fs2c fc0 sc0 ls0 ws0">)</div><div class="t m0 xfa h55 y5588 ff19 fs2c fc0 sc0 ls0 ws0">.</div><div class="t m0 x3f h60 y558a ff19 fs2c fc0 sc0 ls155 ws0">We <span class="_ _53"> </span>c<span class="_ _9"></span><span class="ls0">an fetch any recor<span class="ls142">df<span class="_ _4f"></span><span class="ls150">ro<span class="_ _2"></span><span class="ls142">mt<span class="_ _d"></span><span class="ls0">he database by specifying its<span class="_"> </span><span class="ff1b">key</span>.</span></span></span></span></span></div><div class="t m0 x3f h5d y558b ff1a fs2f fc0 sc0 ls0 ws0">#include &quot;apue_db.h&quot;</div><div class="t m0 x3f h5d y558c ff1a fs2f fc0 sc0 ls0 ws0">char *db_fetch(DBHANDLE<span class="_"> </span><span class="ff1b">db</span><span class="ls395">,c<span class="_ _1d"></span><span class="ls0">onst char *<span class="ff1b">key</span>);</span></span></div><div class="t m0 xf h5d y558d ff19 fs2f fc0 sc0 ls0 ws0">Returns: pointer to data if OK,<span class="_"> </span><span class="ff1a">NULL<span class="_ _e"> </span></span>if recor<span class="ls4c3">dn<span class="_ _d"></span><span class="ls0">ot found</span></span></div><div class="t m0 x32 h5b y558e ff19 fs29 fc0 sc0 ls0 ws0">The <span class="_ _23"></span>return <span class="_ _9"></span>value <span class="_ _23"> </span>is <span class="_ _23"> </span>a <span class="_ _23"> </span>pointer <span class="_ _42"> </span>to <span class="_ _23"></span>the <span class="_ _23"></span>data <span class="_ _23"></span>that <span class="_ _23"></span>was <span class="_ _23"></span>stored <span class="_ _9"></span>with <span class="_ _23"> </span>the<span class="_ _35"> </span><span class="ff1b">key</span>,<span class="_ _35"> </span>if<span class="_ _35"> </span>the <span class="_ _23"></span>r<span class="_ _0"></span>ecor<span class="ls160d">di<span class="_ _43"></span><span class="ls0">s</span></span></div><div class="t m0 x32 h5b y558f ff19 fs29 fc0 sc0 ls0 ws0">found. <span class="_"> </span>W<span class="_ _6"></span><span class="lsdd">ec<span class="_ _d"></span><span class="ls0">an also delete a recor<span class="lsdd">df<span class="_ _4f"></span><span class="lsdf">ro<span class="_ _2"></span><span class="lsdd">mt<span class="_ _d"></span><span class="ls0">he database by specifying its<span class="_"> </span><span class="ff1b">key</span>.</span></span></span></span></span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
