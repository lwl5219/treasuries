<div id="pf120" class="pf w4 h1f" data-page-no="120"><div class="pc pc120 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg120.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">254<span class="_ _1b"> </span><span class="ff19">Process <span class="_"> </span>Contr<span class="_ _0"></span>ol <span class="_ _222"> </span>Chapter<span class="_ _4b"> </span>8</span></div><div class="t m0 x35 h27 y12f ff16 fsf fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h26 y131 ff19 fsf fc0 sc0 ls0 ws0">The program in Figur<span class="_ _0"></span><span class="ls44">e8<span class="_ _d"></span><span class="ls0">.16 demonstrates the<span class="_"> </span><span class="ff1a">exec<span class="_ _80"> </span></span>functions.</span></span></div><div class="t m0 x32 h4e y2170 ff1a fs28 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h4e y2171 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;sys/wait.h&gt;</div><div class="t m0 x32 h4e y2172 ff1a fs28 fc0 sc0 ls0 ws0">char <span class="_ _68"> </span>*env_init[]<span class="_"> </span><span class="ls1b6">={&quot;<span class="_ _5b"></span><span class="ls0">USER=unknown&quot;, &quot;PATH=/tmp&quot;, NULL };</span></span></div><div class="t m0 x32 h4e y2173 ff1a fs28 fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h4e y2174 ff1a fs28 fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 x32 h4e y2175 ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y2176 ff1a fs28 fc0 sc0 ls0 ws0">pid_t <span class="_ _d9"> </span>pid;</div><div class="t m0 x8a h4e y2177 ff1a fs28 fc0 sc0 ls0 ws0">if ((pid = fork()) &lt; 0) {</div><div class="t m0 x9d h4e y2178 ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;fork error&quot;);</div><div class="t m0 x8a h4e y2179 ff1a fs28 fc0 sc0 ls1b6 ws0">}e<span class="_ _1d"></span><span class="ls0">lse if (pid == 0) {<span class="_ _3a"> </span>/* specify pathname, specify environment */</span></div><div class="t m0 x9d h4e y217a ff1a fs28 fc0 sc0 ls0 ws0">if (execle(&quot;/home/sar/bin/echoall&quot;, &quot;echoall&quot;, &quot;myarg1&quot;,</div><div class="t m0 x1ca h4e y217b ff1a fs28 fc0 sc0 ls0 ws0">&quot;MY ARG2&quot;, (char *)0, env_init) &lt; 0)</div><div class="t m0 x1f h4e y217c ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;execle error&quot;);</div><div class="t m0 x8a h4e y217d ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h4e y217e ff1a fs28 fc0 sc0 ls0 ws0">if (waitpid(pid, NULL, 0) &lt; 0)</div><div class="t m0 x9d h4e y217f ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;wait error&quot;);</div><div class="t m0 x8a h4e y2180 ff1a fs28 fc0 sc0 ls0 ws0">if ((pid = fork()) &lt; 0) {</div><div class="t m0 x9d h4e y2181 ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;fork error&quot;);</div><div class="t m0 x8a h4e y2182 ff1a fs28 fc0 sc0 ls1b6 ws0">}e<span class="_ _1d"></span><span class="ls0">lse if (pid == 0) {<span class="_ _3a"> </span>/* specify filename, inherit environment */</span></div><div class="t m0 x9d h4e y2183 ff1a fs28 fc0 sc0 ls0 ws0">if (execlp(&quot;echoall&quot;, &quot;echoall&quot;, &quot;only 1 arg&quot;, (char *)0) &lt; 0)</div><div class="t m0 x1f h4e y2184 ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;execlp error&quot;);</div><div class="t m0 x8a h4e y2185 ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h4e y2186 ff1a fs28 fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h4e y2187 ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x123 h4f y2188 ff18 fs11 fc0 sc0 ls0 ws0">Figure 8.16<span class="_ _5a"> </span><span class="ff19">Example of<span class="_"> </span><span class="ff1a">exec<span class="_ _e"> </span></span>functions</span></div><div class="t m0 x3f h54 y2189 ff19 fs2c fc0 sc0 ls155 ws0">We <span class="_ _66"> </span>ﬁ<span class="_ _9"></span><span class="ls0">rst <span class="_ _9"></span>call<span class="_ _45"> </span><span class="ff1a">execle</span><span class="lsa01">,w<span class="_ _b"></span><span class="ls0">hich <span class="_ _23"></span>r<span class="_ _0"></span>equires <span class="_ _3"></span>a <span class="_ _9"></span>pathname <span class="_ _23"></span>and <span class="_ _9"></span>a <span class="_ _9"></span>speciﬁc <span class="_ _9"></span>environment. <span class="_ _45"> </span>The</span></span></span></div><div class="t m0 x32 h54 y218a ff19 fs2c fc0 sc0 ls0 ws0">next call <span class="_ _2"></span>is <span class="_ _2"></span>to<span class="_ _66"> </span><span class="ff1a">execlp</span><span class="lsa02">,w<span class="_ _d"></span><span class="ls0">hich <span class="_ _2"></span>uses <span class="_ _2"></span>a <span class="_ _2"></span>ﬁlename and <span class="_ _2"></span>passes <span class="_ _2"></span>the <span class="_ _2"></span>caller<span class="_ _9"></span>’s <span class="_ _2"></span>environment to <span class="_ _2"></span>the</span></span></div><div class="t m0 x32 h54 y218b ff19 fs2c fc0 sc0 ls0 ws0">new <span class="_ _35"> </span>program. <span class="_ _5a"> </span>The<span class="_ _54"> </span>only <span class="_ _35"> </span>r<span class="_ _0"></span>eason <span class="_ _35"> </span>the <span class="_ _35"> </span>call <span class="_ _35"> </span>to<span class="_ _51"> </span><span class="ff1a">execlp<span class="_ _51"> </span></span>works <span class="_ _35"> </span>is <span class="_ _35"> </span>that <span class="_ _35"> </span>the <span class="_ _35"> </span>directory</div><div class="t m0 x32 h54 y218c ff1a fs2c fc0 sc0 ls0 ws0">/home/sar/bin<span class="_ _44"> </span><span class="ff19">is <span class="_ _53"> </span>one <span class="_ _53"> </span>of <span class="_ _53"> </span>the <span class="_ _e"> </span>current <span class="_ _42"> </span>path <span class="_ _53"> </span>preﬁxes. <span class="_ _44"> </span>Note<span class="_ _4b"> </span>also <span class="_ _53"> </span>that <span class="_ _53"> </span>we <span class="_ _53"> </span>set <span class="_ _53"> </span>the <span class="_ _53"> </span>ﬁrst</span></div><div class="t m0 x32 h54 y218d ff19 fs2c fc0 sc0 ls0 ws0">argument,<span class="_ _51"> </span><span class="ff1a">argv[0]<span class="_ _51"> </span></span>in <span class="_ _35"> </span>the <span class="_ _35"> </span>new <span class="_ _35"> </span>program, <span class="_ _35"> </span>to <span class="_ _35"> </span>be <span class="_ _35"> </span>the <span class="_ _35"> </span>ﬁlename <span class="_ _35"> </span>component <span class="_ _44"> </span>of <span class="_ _35"> </span>the</div><div class="t m0 x32 h55 y218e ff19 fs2c fc0 sc0 ls0 ws0">pathname. <span class="_ _46"> </span>Some<span class="_ _59"> </span>shells <span class="_ _66"> </span>set <span class="_"> </span>this <span class="_"> </span>argument <span class="_"> </span>to <span class="_"> </span>be <span class="_"> </span>the <span class="_"> </span>complete <span class="_"> </span>pathname.<span class="_ _60"> </span>This <span class="_ _66"> </span>is <span class="_"> </span>a</div><div class="t m0 x32 h54 y218f ff19 fs2c fc0 sc0 ls0 ws0">convention <span class="_ _2"></span>only; <span class="_ _2"></span>we <span class="_ _2"></span>can set<span class="_ _47"> </span><span class="ff1a">argv[0]<span class="_ _66"> </span></span>to <span class="_ _2"></span>any <span class="_ _2"></span>string <span class="_ _2"></span>we <span class="_ _2"></span>like.<span class="_ _61"> </span>The<span class="_ _66"> </span><span class="ff1a">login<span class="_ _47"> </span></span>command does</div><div class="t m0 x32 h54 y2190 ff19 fs2c fc0 sc0 ls0 ws0">this when it executes the shell.<span class="_ _59"> </span>Befor<span class="lsa03">ee<span class="_ _d"></span><span class="ls0">xecuting the shell,<span class="_"> </span><span class="ff1a">login<span class="_ _66"> </span></span>adds a dash as a preﬁx</span></span></div><div class="t m0 x32 h54 y2191 ff19 fs2c fc0 sc0 ls0 ws0">to<span class="_"> </span><span class="ff1a">argv[0]<span class="_ _66"> </span></span>to indicate to <span class="_ _2"></span>the shell <span class="_ _2"></span>that it is <span class="_ _2"></span>being invoked <span class="_ _2"></span>as a login <span class="_ _2"></span>shell.<span class="_ _46"> </span><span class="lsa04">Al<span class="_ _d"></span><span class="ls0">ogin shell</span></span></div><div class="t m0 x32 h55 y2192 ff19 fs2c fc0 sc0 ls0 ws0">will execute the start-up proﬁle commands, wher<span class="_ _0"></span>eas a nonlogin shell will not.</div><div class="t m0 x3f h54 y2193 ff19 fs2c fc0 sc0 ls0 ws0">The <span class="_"> </span>pr<span class="_ _0"></span>ogram<span class="_ _59"> </span><span class="ff1a">echoall<span class="_ _46"> </span></span>that <span class="_"> </span>is <span class="_"> </span>executed <span class="_ _e"> </span>twice <span class="_"> </span>in <span class="_"> </span>the <span class="_"> </span>program <span class="_ _e"> </span>in <span class="_"> </span>Figur<span class="lsa05">e8<span class="_ _4a"></span><span class="ls0">.16 <span class="_"> </span>is</span></span></div><div class="t m0 x32 h55 y2194 ff19 fs2c fc0 sc0 ls0 ws0">shown in <span class="_ _2"></span>Figur<span class="lsa06">e8<span class="_ _4f"></span><span class="ls0">.17. <span class="_"> </span>It<span class="_ _66"> </span>is <span class="_ _2"></span>a trivial <span class="_ _2"></span>program that echoes all <span class="_ _2"></span>its command</span></span></div><div class="t m0 x1d7 h55 y2195 ff19 fs2c fc0 sc0 ls0 ws0">-</div><div class="t m0 x1c3 h55 y2194 ff19 fs2c fc0 sc0 ls0 ws0">line arguments</div><div class="t m0 x32 h55 y2196 ff19 fs2c fc0 sc0 ls0 ws0">and its entir<span class="ls142">ee<span class="_ _4f"></span><span class="ls0">nvironment list.</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
