<div id="pf24d" class="pf w4 h1f" data-page-no="24d"><div class="pc pc24d w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg24d.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>15.5<span class="_ _2b8"> </span>FIFOs<span class="_ _1b"> </span><span class="ff18">555</span></div><div class="t m0 x8a h51 y551 ff19 fs2a fc0 sc0 ls0 ws0">input</div><div class="t m0 x215 h51 y552 ff19 fs2a fc0 sc0 ls0 ws0">ﬁle</div><div class="t m0 x4 h5e y4335 ff1a fs10 fc0 sc0 ls0 ws0">prog1</div><div class="t m0 xc5 h4f y4336 ff1a fs11 fc0 sc0 ls0 ws0">tee</div><div class="t m0 x1dc h2f y4337 ff19 fs12 fc0 sc0 ls0 ws0">FIFO</div><div class="t m0 x4d h63 y4338 ff1a fs13 fc0 sc0 ls0 ws0">prog3</div><div class="t m0 xc8 h6f y4339 ff1a fs14 fc0 sc0 ls0 ws0">prog2</div><div class="t m0 x20c h70 y433a ff18 fs16 fc0 sc0 ls0 ws0">Figure 15.21<span class="_ _5a"> </span><span class="ff19">Using a FIFO and<span class="_"> </span><span class="ff1a">tee<span class="_ _e"> </span></span>to send a stream to two differ<span class="_ _0"></span>ent processes</span></div><div class="t m0 x32 hc5 y433b ff19 fs6a fc0 sc0 ls0 ws0">FIFO <span class="_ _53"> </span>that <span class="_ _53"> </span>the <span class="_ _53"> </span>server <span class="_ _53"> </span>creates. <span class="_ _44"> </span>(By<span class="_ _4b"> </span><span class="ls11c9">‘‘<span class="_ _2"></span></span>well-known,’’<span class="_ _44"> </span>we<span class="_ _4b"> </span>mean <span class="_ _53"> </span>that <span class="_ _53"> </span>the <span class="_ _53"> </span>pathname <span class="_ _53"> </span>of <span class="_ _53"> </span>the</div><div class="t m0 x32 hc5 y433c ff19 fs6a fc0 sc0 ls0 ws0">FIFO <span class="_ _2"></span>is <span class="_ _2"></span>known <span class="_ _2"></span>to all <span class="_ _2"></span>the <span class="_ _2"></span>clients <span class="_ _2"></span>that <span class="_ _2"></span>need <span class="_ _2"></span>to <span class="_ _2"></span>contact <span class="_ _2"></span>the <span class="_ _2"></span>server<span class="_ _1"></span>.) <span class="_ _66"> </span>Figur<span class="ls11ca">e1<span class="_ _4f"></span><span class="ls0">5.22 <span class="_ _2"></span>shows <span class="_ _2"></span>this</span></span></div><div class="t m0 x32 hc5 y433d ff19 fs6a fc0 sc0 ls0 ws0">arrangement.</div><div class="t m0 x8c h160 y433e ff19 fs36 fc0 sc0 ls0 ws0">client<span class="_ _ae"> </span><span class="ff18 fs38 lsdcb">...</span></div><div class="t m0 x1ef h34 y433f ff19 fs17 fc0 sc0 ls0 ws0">client</div><div class="t m0 x86 h35 y4340 ff19 fs18 fc0 sc0 ls0 ws0">well-known</div><div class="t m0 x1a4 h35 y4341 ff19 fs18 fc0 sc0 ls0 ws0">FIFO</div><div class="t m0 x207 h36 y4342 ff19 fs19 fc0 sc0 ls0 ws0">server</div><div class="t m0 x86 hd5 y4343 ff1a fs19 fc0 sc0 ls0 ws0">read<span class="_ _35"> </span><span class="ff19 ls11cb">re<span class="_ _2"></span><span class="ls0">quests</span></span></div><div class="t m2d x127 h161 y4344 ff1a fsb9 fc0 sc0 ls0 ws0">write<span class="_ _53"> </span><span class="ff19 ls11cc">re<span class="_ _2"></span><span class="ls0">quests</span></span></div><div class="t m2e x1fe h162 y4345 ff1a fsba fc0 sc0 ls0 ws0">write<span class="_ _53"> </span><span class="ff19 lsb28">re<span class="_ _2"></span><span class="ls0">quests</span></span></div><div class="t m0 xe7 h38 y4346 ff18 fs1b fc0 sc0 ls0 ws0">Figure 15.22<span class="_ _5a"> </span><span class="ff19">Clients sending requests to a server using a FIFO</span></div><div class="t m0 x32 hfa y4347 ff19 fs88 fc0 sc0 ls0 ws0">Since <span class="_ _53"> </span>ther<span class="ls11cd">ea<span class="_ _55"></span><span class="ls1067">re <span class="_"> </span>m<span class="_ _2"></span><span class="ls0">ultiple <span class="_ _53"> </span>writers <span class="_ _53"> </span>for <span class="_ _53"> </span>the <span class="_ _e"> </span>FIFO, <span class="_ _53"> </span>the <span class="_ _53"> </span>requests <span class="_ _53"> </span>sent <span class="_ _53"> </span>by <span class="_ _53"> </span>the <span class="_ _53"> </span>clients <span class="_ _e"> </span>to <span class="_ _53"> </span>the</span></span></span></div><div class="t m0 x32 hf9 y4348 ff19 fs88 fc0 sc0 ls0 ws0">server <span class="_ _9"></span>need <span class="_ _9"></span>to <span class="_ _23"></span>be <span class="_ _9"></span>less <span class="_ _9"></span>than<span class="_ _45"> </span><span class="ff1a">PIPE_BUF<span class="_ _45"> </span></span>bytes <span class="_ _9"></span>in <span class="_ _23"></span>size.<span class="_ _5a"> </span>This <span class="_ _9"></span>prevents <span class="_ _9"></span>any <span class="_ _9"></span>interleaving <span class="_ _9"></span>of</div><div class="t m0 x32 hf9 y4349 ff19 fs88 fc0 sc0 ls0 ws0">the client<span class="_"> </span><span class="ff1a">write</span>s.</div><div class="t m0 x3f hfa y434a ff19 fs88 fc0 sc0 ls0 ws0">The <span class="_ _3"></span>problem <span class="_ _2"></span>in <span class="_ _3"></span>using <span class="_ _3"></span>FIFOs <span class="_ _3"></span>for <span class="_ _3"></span>this <span class="_ _3"></span>type <span class="_ _3"></span>of <span class="_ _3"></span>client–server <span class="_ _3"></span>communication <span class="_ _3"></span>is <span class="_ _3"></span>how <span class="_ _3"></span>to</div><div class="t m0 x32 hfa y434b ff19 fs88 fc0 sc0 ls0 ws0">send <span class="_ _42"> </span>replies <span class="_ _23"></span>back <span class="_ _42"> </span>from <span class="_ _23"> </span>the <span class="_ _42"> </span>server <span class="_ _42"> </span>to <span class="_ _42"> </span>each <span class="_ _42"> </span>client.<span class="_ _51"> </span><span class="ls11ce">As<span class="_ _43"></span><span class="ls0">ingle <span class="_ _42"> </span>FIFO <span class="_ _42"> </span>can’t <span class="_ _23"> </span>be <span class="_ _42"> </span>used, <span class="_ _42"> </span>as <span class="_ _42"> </span>the</span></span></div><div class="t m0 x32 hfa y434c ff19 fs88 fc0 sc0 ls0 ws0">clients <span class="_"> </span>would <span class="_"> </span>never <span class="_ _66"> </span>know <span class="_ _66"> </span>when <span class="_"> </span>to <span class="_ _66"> </span>read <span class="_"> </span>their <span class="_"> </span>response <span class="_"> </span>versus <span class="_ _66"> </span>responses <span class="_"> </span>for <span class="_"> </span>other</div><div class="t m0 x32 hfa y434d ff19 fs88 fc0 sc0 ls0 ws0">clients. <span class="_ _44"> </span>One<span class="_ _4b"> </span>solution <span class="_ _53"> </span>is <span class="_ _53"> </span>for <span class="_ _53"> </span>each <span class="_ _e"> </span>client <span class="_ _53"> </span>to <span class="_ _53"> </span>send <span class="_ _53"> </span>its <span class="_ _e"> </span>process <span class="_ _42"> </span>ID <span class="_ _53"> </span>with <span class="_ _e"> </span>the <span class="_ _53"> </span>request. <span class="_ _44"> </span>The</div><div class="t m0 x32 hfa y434e ff19 fs88 fc0 sc0 ls0 ws0">server then creates a unique FIFO <span class="_ _2"></span>for each client, <span class="_ _2"></span>using a pathname <span class="_ _2"></span>based on the client’s</div><div class="t m0 x32 hfa y434f ff19 fs88 fc0 sc0 ls0 ws0">process <span class="_ _65"> </span>ID.<span class="_ _df"> </span>For <span class="_ _60"> </span>example, <span class="_ _48"> </span>the <span class="_ _48"> </span>server <span class="_ _60"> </span>can <span class="_ _48"> </span>create <span class="_ _48"> </span>a <span class="_ _60"> </span>FIFO <span class="_ _48"> </span>with <span class="_ _48"> </span>the <span class="_ _60"> </span>name</div><div class="t m0 x32 hf9 y4350 ff1a fs88 fc0 sc0 ls0 ws0">/tmp/serv1.XXXXX<span class="ff19 ls11cf">,w<span class="_ _1d"></span><span class="ls0">here<span class="_ _61"> </span><span class="ff1a">XXXXX<span class="_ _16"> </span></span>is <span class="_ _47"> </span>replaced <span class="_ _47"> </span>with <span class="_ _47"> </span>the <span class="_ _47"> </span>client’s <span class="_ _47"> </span>process <span class="_ _47"> </span>ID.<span class="_ _5f"> </span>This</span></span></div><div class="t m0 x32 hfa y4351 ff19 fs88 fc0 sc0 ls0 ws0">arrangement is shown in Figur<span class="lsb06">e1<span class="_ _4f"></span><span class="ls0">5.23.</span></span></div><div class="t m0 x3f hfa y4352 ff19 fs88 fc0 sc0 ls0 ws0">This <span class="_ _23"></span>arrangement <span class="_ _9"></span>works, <span class="_ _23"></span>although <span class="_ _23"></span>it <span class="_ _9"></span>is <span class="_ _23"> </span>impossible <span class="_ _23"></span>for <span class="_ _9"></span>the <span class="_ _23"> </span>server <span class="_ _23"></span>to <span class="_ _9"></span>tell <span class="_ _23"> </span>whether <span class="_ _23"></span>a</div><div class="t m0 x32 hfa y4353 ff19 fs88 fc0 sc0 ls0 ws0">client <span class="_ _e"> </span>crashes.<span class="_ _48"> </span><span class="ls11d0">Ac<span class="_ _55"></span><span class="ls0">lient <span class="_ _e"> </span>crash <span class="_ _e"> </span>leaves <span class="_"> </span>the <span class="_ _53"> </span>client-speciﬁc <span class="_ _e"> </span>FIFO <span class="_"> </span>in <span class="_ _53"> </span>the <span class="_ _e"> </span>ﬁle <span class="_"> </span>system.<span class="_ _65"> </span>The</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
