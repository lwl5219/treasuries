<div id="pf330" class="pf w4 h1f" data-page-no="330"><div class="pc pc330 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg330.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">782<span class="_ _1b"> </span><span class="ff19 ls30a">AD<span class="_ _55"></span><span class="ls0">atabase <span class="_"> </span>Library<span class="_ _245"> </span>Chapter <span class="_"> </span>20</span></span></div><div class="t m0 x3f h2b y12f ff19 fsf fc0 sc0 ls0 ws0">1. <span class="_ _51"> </span>W<span class="_ _6"></span>rite<span class="_"> </span><span class="ff1b">nrec<span class="_"> </span></span><span class="ls45">re</span>cords to the database.</div><div class="t m0 x3f h2b y6f7 ff19 fsf fc0 sc0 ls0 ws0">2. <span class="_ _51"> </span>Read<span class="_"> </span>the<span class="_"> </span><span class="ff1b">nrec<span class="_"> </span></span><span class="ls45">re</span>cords back by key value.</div><div class="t m0 x3f h2b y5862 ff19 fsf fc0 sc0 ls0 ws0">3. <span class="_ _51"> </span>Perform<span class="_"> </span>the following loop<span class="_"> </span><span class="ff1b">nrec<span class="_"> </span><span class="ff20">×<span class="_ _80"> </span></span>5<span class="_"> </span></span>times.</div><div class="t m0 x41 h2a y1fb ff19 fsf fc0 sc0 ls0 ws0">a. <span class="_ _51"> </span>Read<span class="_"> </span><span class="ls44">ar<span class="_ _d"></span><span class="ls0">andom record.</span></span></div><div class="t m0 x41 h2a y263c ff19 fsf fc0 sc0 ls0 ws0">b. <span class="_ _16"> </span>Every<span class="_"> </span>37 times through the loop, delete a random recor<span class="_ _0"></span>d.</div><div class="t m0 x41 h2a yd7d ff19 fsf fc0 sc0 ls0 ws0">c. <span class="_ _65"> </span>Every<span class="_ _35"> </span><span class="ls65">11 <span class="_ _66"> </span>t<span class="_ _3"></span></span>imes <span class="_ _42"> </span>through <span class="_ _23"> </span>the <span class="_ _42"> </span>loop, <span class="_ _42"> </span>insert <span class="_ _42"> </span>a <span class="_ _42"> </span>new <span class="_ _23"> </span>recor<span class="ls16cd">da<span class="_ _43"></span><span class="ls0">nd <span class="_ _23"> </span>read <span class="_ _23"> </span>the <span class="_ _42"> </span>record</span></span></div><div class="t m0 x122 h2a ya21 ff19 fsf fc0 sc0 ls0 ws0">back.</div><div class="t m0 x41 h2a yc39 ff19 fsf fc0 sc0 ls0 ws0">d. <span class="_ _46"> </span>Every<span class="_ _61"> </span>17 <span class="_ _66"> </span>times <span class="_ _47"> </span>thr<span class="_ _0"></span>ough <span class="_"> </span>the <span class="_ _47"> </span>loop, <span class="_"> </span>replace <span class="_ _66"> </span>a <span class="_ _66"> </span>random <span class="_ _47"> </span>recor<span class="_ _0"></span><span class="ls259">dw<span class="_ _1d"></span><span class="ls0">ith <span class="_ _47"> </span>a <span class="_"> </span>new</span></span></div><div class="t m0 x122 h2a yc3a ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">cord. <span class="_"> </span>Every<span class="_ _47"> </span>other <span class="_ _2"></span>one of <span class="_ _2"></span>these <span class="_ _2"></span>replacements <span class="_ _2"></span>is <span class="_ _2"></span>a <span class="_ _2"></span>recor<span class="_ _0"></span><span class="ls1104">dw<span class="_ _4f"></span><span class="ls0">ith <span class="_ _2"></span>the <span class="_ _2"></span>same <span class="_ _2"></span>size</span></span></span></div><div class="t m0 x122 h2a y39d7 ff19 fsf fc0 sc0 ls0 ws0">data; the alternate is a recor<span class="_ _0"></span><span class="ls44">dw<span class="_ _d"></span><span class="ls0">ith a longer data portion.</span></span></div><div class="t m0 x3f h2a y39a8 ff19 fsf fc0 sc0 ls0 ws0">4. <span class="_ _51"> </span>Delete<span class="_ _45"> </span>all <span class="_ _9"></span>the <span class="_ _23"></span>recor<span class="_ _1"></span>ds <span class="_ _23"></span>that <span class="_ _9"></span>this <span class="_ _9"></span>child <span class="_ _23"></span>wrote. <span class="_ _47"> </span>Every<span class="_ _35"> </span>time <span class="_ _9"></span>a <span class="_ _9"></span>record<span class="_ _47"> </span>is<span class="_ _35"> </span>deleted, <span class="_ _9"></span>ten</div><div class="t m0 x41 h2a y1847 ff19 fsf fc0 sc0 ls0 ws0">random recor<span class="_ _0"></span>ds ar<span class="_ _0"></span><span class="ls44">el<span class="_ _d"></span><span class="ls0">ooked up.</span></span></div><div class="t m0 x3f h26 y517c ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _23"></span>number <span class="_ _9"></span>of <span class="_ _23"> </span>operations <span class="_ _23"></span>performed <span class="_ _23"></span>on <span class="_ _9"></span>the <span class="_ _23"> </span>database <span class="_ _23"></span>is <span class="_ _23"></span>counted <span class="_ _9"></span>by <span class="_ _23"> </span>the<span class="_ _35"> </span><span class="ff1a">cnt_xxx</span></div><div class="t m0 x32 h26 y517d ff19 fsf fc0 sc0 ls0 ws0">variables <span class="_ _3"></span>in <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">DB<span class="_ _47"> </span></span>structure, <span class="_ _2"></span>which <span class="_ _3"></span>wer<span class="ls24d">ei<span class="_ _8"></span><span class="ls0">ncremented <span class="_ _2"></span>in <span class="_ _3"></span>the <span class="_ _3"></span>functions.<span class="_ _16"> </span>The <span class="_ _3"></span>number <span class="_ _3"></span>of</span></span></div><div class="t m0 x32 h2a y5863 ff19 fsf fc0 sc0 ls0 ws0">operations <span class="_ _3"></span>differs <span class="_ _3"></span>from <span class="_ _2"></span>one <span class="_ _9"></span>child <span class="_ _3"></span>to <span class="_ _3"></span>the <span class="_ _9"></span>next, <span class="_ _3"></span>since <span class="_ _3"></span>the <span class="_ _9"></span>random-number <span class="_ _3"></span>generator <span class="_ _3"></span>used</div><div class="t m0 x32 h2a y2244 ff19 fsf fc0 sc0 ls0 ws0">to <span class="_ _3"></span>select <span class="_ _3"></span>recor<span class="_ _0"></span>ds <span class="_ _3"></span>is <span class="_ _3"></span>initialized <span class="_ _3"></span>in <span class="_ _3"></span>each <span class="_ _3"></span>child <span class="_ _9"></span>to <span class="_ _3"></span>the <span class="_ _3"></span>child’s <span class="_ _3"></span>process <span class="_ _2"></span>ID.<span class="_ _16"> </span><span class="lsa7e">At<span class="_ _4f"></span><span class="ls0">ypical <span class="_ _3"></span>count <span class="_ _3"></span>of</span></span></div><div class="t m0 x32 h2a y1d97 ff19 fsf fc0 sc0 ls0 ws0">the operations performed in each child is shown in Figur<span class="ls44">e2<span class="_ _4f"></span><span class="ls0">0.6.</span></span></div><div class="t m0 x104 h5e y5864 ff19 fs10 fc0 sc0 ls0 ws0">Calls to<span class="_"> </span><span class="ff1a">fcntl</span></div><div class="t m0 x1a3 h2d y5865 ff19 fs10 fc0 sc0 ls0 ws0">(per operation)</div><div class="t m0 x1d3 h2e y5866 ff19 fs11 fc0 sc0 ls0 ws0">Coarse-grained <span class="_"> </span>Fine-grained</div><div class="t m0 x81 h2e y5867 ff19 fs11 fc0 sc0 ls0 ws0">locking <span class="_ _7a"> </span>locking</div><div class="t m0 x188 h2e y5868 ff19 fs11 fc0 sc0 ls0 ws0">Operation</div><div class="t m0 x237 h2e y5869 ff19 fs11 fc0 sc0 ls0 ws0">Operation</div><div class="t m0 x70 h2e y5868 ff19 fs11 fc0 sc0 ls0 ws0">count</div><div class="t m0 x56 h56 y586a ff19 fs11 fc0 sc0 ls0 ws0">(<span class="ff1b">nrec<span class="_ _23"> </span></span><span class="ls16ce">=2<span class="_ _4"></span><span class="ls0">,000)</span></span></div><div class="t m0 xf2 h6d y586b ff1a fs12 fc0 sc0 ls0 ws0">db_store<span class="ff19">,<span class="_"> </span></span>DB_INSERT<span class="ff19">,<span class="_"> </span>no<span class="_"> </span>empty recor<span class="_ _0"></span>d, appended<span class="_ _173"> </span><span class="ls16cf">28<span class="_ _30f"></span><span class="ls0">2,920</span></span></span></div><div class="t m0 xf2 h6d y586c ff1a fs12 fc0 sc0 ls0 ws0">db_store<span class="ff19">,<span class="_"> </span></span>DB_INSERT<span class="ff19 ls38a">,e<span class="_ _84"></span><span class="ls0">mpty recor<span class="_ _0"></span><span class="ls38a">dr<span class="_ _5"></span><span class="ls0">eused <span class="_ _134"> </span>2<span class="_ _b1"> </span><span class="ls16d0">44<span class="_ _258"></span><span class="ls0">68</span></span></span></span></span></span></div><div class="t m0 xf2 h6d y586d ff1a fs12 fc0 sc0 ls0 ws0">db_store<span class="ff19">,<span class="_"> </span></span>DB_REPLACE<span class="ff19 ls38a">,d<span class="_ _84"></span><span class="ls0">iffer<span class="_ _0"></span>ent data length, appended<span class="_ _db"> </span><span class="ls16cf">28<span class="_ _4f"></span><span class="ls0">405</span></span></span></span></div><div class="t m0 xf2 h6d y586e ff1a fs12 fc0 sc0 ls0 ws0">db_store<span class="ff19">,<span class="_"> </span></span>DB_REPLACE<span class="ff19 ls38a">,e<span class="_ _84"></span><span class="ls0">qual data length<span class="_ _a6"> </span><span class="ls16cf">22<span class="_ _8"></span><span class="ls0">416</span></span></span></span></div><div class="t m0 xf2 h6d y586f ff1a fs12 fc0 sc0 ls0 ws0">db_store<span class="ff19 ls38a">,r<span class="_ _5"></span><span class="ls0">ecor<span class="ls38a">dn<span class="_ _84"></span><span class="ls0">ot found<span class="_ _22c"> </span><span class="ls16cf">22 <span class="_ _312"></span>7<span class="_ _313"></span><span class="ls0">1</span></span></span></span></span></span></div><div class="t m0 xf2 h63 y5870 ff1a fs13 fc0 sc0 ls0 ws0">db_fetch<span class="ff19 ls673">,r<span class="_ _5"></span><span class="ls0">ecor<span class="ls673">df<span class="_ _84"></span><span class="ls0">ound <span class="_ _314"> </span>2<span class="_ _b1"> </span><span class="ls16d1">23<span class="_ _315"></span><span class="ls0">2,873</span></span></span></span></span></span></div><div class="t m0 xf2 h63 y3fe3 ff1a fs13 fc0 sc0 ls0 ws0">db_fetch<span class="ff19 ls673">,r<span class="_ _5"></span><span class="ls0">ecor<span class="ls673">dn<span class="_ _84"></span><span class="ls0">ot found<span class="_ _22c"> </span><span class="ls16d2">22<span class="_ _4d"></span><span class="ls0">2,966</span></span></span></span></span></span></div><div class="t m0 xf2 h6f y5871 ff1a fs14 fc0 sc0 ls0 ws0">db_delete<span class="ff19 ls56a">,r<span class="_ _5"></span><span class="ls0">ecor<span class="ls56a">df<span class="_ _84"></span><span class="ls0">ound <span class="_ _1ab"> </span>2<span class="_ _b1"> </span><span class="ls16d3">43<span class="_ _316"></span><span class="ls0">,388</span></span></span></span></span></span></div><div class="t m0 xf2 h6f y5872 ff1a fs14 fc0 sc0 ls0 ws0">db_delete<span class="ff19 ls56a">,r<span class="_ _5"></span><span class="ls0">ecor<span class="ls56a">dn<span class="_ _84"></span><span class="ls0">ot found<span class="_ _317"> </span><span class="ls16d4">22<span class="_ _8"></span><span class="ls0">422</span></span></span></span></span></span></div><div class="t m0 x132 h32 y5873 ff18 fs15 fc0 sc0 ls0 ws0">Figure 20.6<span class="_ _5a"> </span><span class="ff19 ls16d5">Ty<span class="_ _9"></span><span class="ls0">pical count of operations performed by each child</span></span></div><div class="t m0 x32 h67 y5874 ff19 fs33 fc0 sc0 ls1d9 ws0">We <span class="_ _80"> </span>p<span class="_ _9"></span><span class="ls0">erformed <span class="_ _3"></span>about <span class="_ _9"></span>ten <span class="_ _3"></span>times <span class="_ _3"></span>mor<span class="ls16d6">ef<span class="_ _b"></span><span class="ls0">etches <span class="_ _9"></span>than <span class="_ _3"></span>stores <span class="_ _2"></span>or <span class="_ _3"></span>deletions, <span class="_ _9"></span>which <span class="_ _3"></span>is <span class="_ _3"></span>probably</span></span></span></div><div class="t m0 x32 h67 y5875 ff19 fs33 fc0 sc0 ls0 ws0">typical of many database applications.</div><div class="t m0 x3f h67 y5876 ff19 fs33 fc0 sc0 ls0 ws0">Each child <span class="_ _2"></span>is performing <span class="_ _2"></span>these operations <span class="_ _2"></span>(fetching, storing, and <span class="_ _2"></span>deleting) only <span class="_ _2"></span>with</div><div class="t m0 x32 h67 y5877 ff19 fs33 fc0 sc0 ls0 ws0">the <span class="_ _3"></span>records <span class="_ _3"></span>that <span class="_ _9"></span>the <span class="_ _3"></span>child <span class="_ _9"></span>wrote. <span class="_ _47"> </span>The<span class="_ _45"> </span>concurrency <span class="_ _3"></span>controls <span class="_ _3"></span>ar<span class="ls16d7">eb<span class="_ _b"></span><span class="ls0">eing <span class="_ _9"></span>exercised <span class="_ _3"></span>because</span></span></div><div class="t m0 x32 h67 y5878 ff19 fs33 fc0 sc0 ls0 ws0">all <span class="_ _2"></span>the <span class="_ _3"></span>children <span class="_ _2"></span>ar<span class="ls16d8">eo<span class="_ _8"></span><span class="ls0">perating <span class="_ _3"></span>on <span class="_ _3"></span>the <span class="_ _3"></span>same <span class="_ _2"></span>database <span class="_ _3"></span>(albeit <span class="_ _3"></span>different <span class="_ _2"></span>recor<span class="_ _0"></span>ds <span class="_ _2"></span>in <span class="_ _3"></span>the <span class="_ _3"></span>same</span></span></div><div class="t m0 x32 h67 y5879 ff19 fs33 fc0 sc0 ls0 ws0">database). <span class="_ _35"> </span>The<span class="_ _35"> </span>total <span class="_ _23"></span>number <span class="_ _23"></span>of <span class="_ _23"> </span>recor<span class="_ _0"></span>ds <span class="_ _23"> </span>in <span class="_ _23"> </span>the <span class="_ _23"> </span>database <span class="_ _42"> </span>incr<span class="_ _0"></span>eases <span class="_ _23"> </span>in <span class="_ _23"> </span>proportion <span class="_ _23"></span>to <span class="_ _23"> </span>the</div><div class="t m0 x32 hd0 y587a ff19 fs33 fc0 sc0 ls0 ws0">number <span class="_ _2"></span>of <span class="_ _2"></span>children. <span class="_"> </span>(W<span class="_ _0"></span>ith one <span class="_ _3"></span>child,<span class="_ _66"> </span><span class="ff1b">nrec<span class="_ _66"> </span></span><span class="ls1d5">re<span class="_ _2"></span></span>cords ar<span class="ls16d9">eo<span class="_ _4f"></span><span class="ls0">riginally <span class="_ _2"></span>written <span class="_ _2"></span>to <span class="_ _2"></span>the <span class="_ _2"></span>database.</span></span></div><div class="t m0 x32 hd0 y587b ff19 fs33 fc0 sc0 ls6f5 ws0">Wi<span class="_ _3"></span><span class="ls0">th two children,<span class="_"> </span><span class="ff1b">nr<span class="_ _0"></span>ec<span class="_"> </span><span class="ff20">×<span class="_ _80"> </span></span>2<span class="_"> </span><span class="ff19 ls1d5">re<span class="_ _2"></span><span class="ls0">cords ar<span class="_ _0"></span><span class="ls1d7">eo<span class="_ _d"></span><span class="ls0">riginally written, and so on.)</span></span></span></span></span></span></div><div class="t m0 x3f h67 y587c ff19 fs33 fc0 sc0 ls1d9 ws0">To <span class="_ _44"> </span>t<span class="_ _9"></span><span class="ls0">est <span class="_"> </span>the <span class="_"> </span>concurrency <span class="_"> </span>pr<span class="_ _0"></span>ovided <span class="_"> </span>by <span class="_"> </span>coarse-grained <span class="_"> </span>locking <span class="_ _e"> </span>versus <span class="_"> </span>ﬁne-grained</span></div><div class="t m0 x32 h67 y587d ff19 fs33 fc0 sc0 ls0 ws0">locking <span class="_ _23"> </span>and <span class="_ _42"> </span>to <span class="_ _42"> </span>compar<span class="ls16da">et<span class="_ _43"></span><span class="ls0">he <span class="_ _23"></span>three <span class="_ _23"> </span>types <span class="_ _42"> </span>of <span class="_ _23"> </span>locking <span class="_ _42"> </span>(no <span class="_ _42"> </span>locking, <span class="_ _23"> </span>advisory <span class="_ _42"> </span>locking, <span class="_ _42"> </span>and</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
