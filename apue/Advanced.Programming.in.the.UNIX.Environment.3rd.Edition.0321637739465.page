<div id="pf1d1" class="pf w4 h1f" data-page-no="1d1"><div class="pc pc1d1 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg1d1.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>12.4<span class="_ _57"> </span>Synchronization <span class="_"> </span>Attributes<span class="_ _1b"> </span><span class="ff18">431</span></div><div class="t m0 x32 h26 y12f ff1a fsf fc0 sc0 ls0 ws0">PTHREAD_MUTEX_INITIALIZER<span class="_ _46"> </span><span class="ff19">constant <span class="_"> </span>or <span class="_ _66"> </span>by <span class="_ _66"> </span>calling <span class="_ _66"> </span>the<span class="_ _46"> </span></span>pthread_mutex_init</div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">function <span class="_ _47"> </span>with <span class="_ _45"> </span>a <span class="_ _45"> </span>null <span class="_ _47"> </span>pointer <span class="_ _45"> </span>for <span class="_ _47"> </span>the <span class="_ _45"> </span>argument <span class="_ _47"> </span>that <span class="_ _47"> </span>points <span class="_ _45"> </span>to <span class="_ _45"> </span>the <span class="_ _47"> </span>mutex <span class="_ _45"> </span>attribute</div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">structur<span class="_ _0"></span>e.</div><div class="t m0 x3f h26 y132 ff19 fsf fc0 sc0 ls0 ws0">When <span class="_ _23"></span>dealing <span class="_ _23"> </span>with <span class="_ _23"> </span>nondefault <span class="_ _23"> </span>attributes, <span class="_ _42"> </span>we <span class="_ _23"></span>use<span class="_ _35"> </span><span class="ff1a">pthread_mutexattr_init<span class="_ _45"> </span></span>to</div><div class="t m0 x32 h26 y133 ff19 fsf fc0 sc0 ls0 ws0">initialize <span class="_ _2"></span>a<span class="_ _47"> </span><span class="ff1a">pthread_mutexattr_t<span class="_ _66"> </span></span>structur<span class="ls3ed">ea<span class="_ _8"></span><span class="ls0">nd<span class="_ _47"> </span><span class="ff1a">pthread_mutexattr_destroy<span class="_ _47"> </span></span>to</span></span></div><div class="t m0 x32 h2a y134 ff19 fsf fc0 sc0 ls0 ws0">deinitialize one.</div><div class="t m0 x3f h57 y33ed ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;pthread.h&gt;</div><div class="t m0 x3f h57 y35cf ff1a fs2d fc0 sc0 ls0 ws0">int pthread_mutexattr_init(pthread_mutexattr_t *<span class="ff1b">attr</span>);</div><div class="t m0 x3f h57 y35d0 ff1a fs2d fc0 sc0 ls0 ws0">int pthread_mutexattr_destroy(pthread_mutexattr_t *<span class="ff1b">attr</span>);</div><div class="t m0 xca h5f y35d1 ff19 fs2d fc0 sc0 ls0 ws0">Both return: 0 if OK, err<span class="_ _0"></span>or number on failure</div><div class="t m0 x32 h4d y35d2 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _45"> </span><span class="ff1a">pthread_mutexattr_init<span class="_ _45"> </span></span>function <span class="_ _23"></span>will <span class="_ _9"></span>initialize <span class="_ _9"></span>the<span class="_ _35"> </span><span class="ff1a">pthread_mutexattr_t</span></div><div class="t m0 x32 h49 y35d3 ff19 fs26 fc0 sc0 ls0 ws0">structur<span class="_ _0"></span><span class="lse7f">ew<span class="_ _43"></span><span class="ls0">ith <span class="_ _23"> </span>the <span class="_ _42"> </span>default <span class="_ _42"> </span>mutex <span class="_ _42"> </span>attributes.<span class="_ _54"> </span>Ther<span class="lse80">ea<span class="_ _c"></span><span class="lscc">re <span class="_ _53"> </span>t<span class="_ _2"></span><span class="ls0">hree <span class="_ _23"> </span>attributes <span class="_ _42"> </span>of <span class="_ _42"> </span>interest: <span class="_ _23"> </span>the</span></span></span></span></span></div><div class="t m0 x32 h4a y35d4 ff1b fs26 fc0 sc0 ls0 ws0">process-shar<span class="_ _0"></span>ed<span class="_ _45"> </span><span class="ff19">attribute, <span class="_ _9"></span>the<span class="_ _45"> </span></span><span class="lscc">ro</span>bust<span class="_ _45"> </span><span class="ff19">attribute, <span class="_ _9"></span>and <span class="_ _9"></span>the<span class="_ _45"> </span></span>type<span class="_ _45"> </span><span class="ff19">attribute. <span class="_ _45"> </span>W<span class="_ _1"></span>ithin <span class="_ _9"></span>POSIX.1, <span class="_ _23"></span>the</span></div><div class="t m0 x32 h4a y35d5 ff1b fs26 fc0 sc0 ls0 ws0">process-shar<span class="_ _0"></span>ed<span class="_ _46"> </span><span class="ff19">attribute <span class="_ _66"> </span>is <span class="_ _66"> </span>optional; <span class="_ _47"> </span>you <span class="_"> </span>can <span class="_ _66"> </span>test <span class="_ _47"> </span>whether <span class="_"> </span>a <span class="_ _66"> </span>platform <span class="_ _66"> </span>supports <span class="_ _47"> </span>it <span class="_"> </span>by</span></div><div class="t m0 x32 h4d y35d6 ff19 fs26 fc0 sc0 ls0 ws0">checking whether <span class="_ _2"></span>the<span class="_"> </span><span class="ff1a">_POSIX_THREAD_PROCESS_SHARED<span class="_ _66"> </span></span>symbol <span class="_ _2"></span>is deﬁned.<span class="_ _61"> </span><span class="ls164">Yo<span class="_ _9"></span><span class="lse81">uc<span class="_ _d"></span><span class="ls0">an</span></span></span></div><div class="t m0 x32 h4d y35d7 ff19 fs26 fc0 sc0 ls0 ws0">also check <span class="_ _2"></span>at runtime <span class="_ _2"></span>by passing <span class="_ _2"></span>the<span class="_ _66"> </span><span class="ff1a">_SC_THREAD_PROCESS_SHARED<span class="_ _66"> </span></span>parameter <span class="_ _2"></span>to the</div><div class="t m0 x32 h4d y35d8 ff1a fs26 fc0 sc0 ls0 ws0">sysconf<span class="_ _4b"> </span><span class="ff19">function. <span class="_ _59"> </span>Although<span class="_ _4b"> </span>this <span class="_ _e"> </span>option <span class="_ _e"> </span>is <span class="_"> </span>not <span class="_ _53"> </span>requir<span class="_ _0"></span>ed <span class="_ _e"> </span>to <span class="_ _e"> </span>be <span class="_ _e"> </span>provided <span class="_ _e"> </span>by <span class="_ _e"> </span>POSIX-</span></div><div class="t m0 x32 h49 y35d9 ff19 fs26 fc0 sc0 ls0 ws0">conforming <span class="_ _4b"> </span>operating <span class="_ _4b"> </span>systems, <span class="_ _4b"> </span>the <span class="_ _44"> </span>Single <span class="_ _4b"> </span>UNIX <span class="_ _4b"> </span>Speciﬁcation <span class="_ _4b"> </span>requires <span class="_ _44"> </span>that <span class="_ _4b"> </span>XSI-</div><div class="t m0 x32 h49 y35da ff19 fs26 fc0 sc0 ls0 ws0">conforming operating systems do support it.</div><div class="t m0 x3f h49 y35db ff19 fs26 fc0 sc0 ls3aa ws0">Wi<span class="_ _3"></span><span class="ls0">thin <span class="_ _2"></span>a <span class="_ _2"></span>process, multiple <span class="_ _2"></span>threads can <span class="_ _2"></span>access <span class="_ _2"></span>the <span class="_ _2"></span>same <span class="_ _2"></span>synchronization object.<span class="_ _61"> </span>This</span></div><div class="t m0 x32 h4a y35dc ff19 fs26 fc0 sc0 ls0 ws0">is <span class="_ _9"></span>the <span class="_ _9"></span>default <span class="_ _9"></span>behavior<span class="_ _1"></span>,<span class="_ _45"> </span>as<span class="_ _45"> </span>we<span class="_ _45"> </span>saw <span class="_ _9"></span>in <span class="_ _23"></span>Chapter <span class="_ _9"></span>1<span class="_ _1"></span>1. <span class="_ _45"> </span>In<span class="_ _45"> </span>this <span class="_ _9"></span>case, <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1b">process-shared<span class="_ _45"> </span></span>mutex</div><div class="t m0 x32 h4d y35dd ff19 fs26 fc0 sc0 ls0 ws0">attribute is set to<span class="_"> </span><span class="ff1a">PTHREAD_PROCESS_PRIVATE</span>.</div><div class="t m0 x3f h49 y35de ff19 fs26 fc0 sc0 ls0 ws0">As <span class="_ _23"> </span>we <span class="_ _42"> </span>shall <span class="_ _23"> </span>see <span class="_ _42"> </span>in <span class="_ _23"> </span>Chapters <span class="_ _42"> </span>14 <span class="_ _23"> </span>and <span class="_ _42"> </span>15, <span class="_ _23"> </span>mechanisms <span class="_ _42"> </span>exist <span class="_ _23"> </span>that <span class="_ _42"> </span>allow <span class="_ _23"> </span>independent</div><div class="t m0 x32 h49 y35df ff19 fs26 fc0 sc0 ls0 ws0">processes <span class="_ _42"> </span>to <span class="_ _42"> </span>map <span class="_ _42"> </span>the <span class="_ _42"> </span>same <span class="_ _53"> </span>extent <span class="_ _42"> </span>of <span class="_ _42"> </span>memory <span class="_ _53"> </span>into <span class="_ _42"> </span>their <span class="_ _42"> </span>independent <span class="_ _53"> </span>address <span class="_ _42"> </span>spaces.</div><div class="t m0 x32 h49 y35e0 ff19 fs26 fc0 sc0 ls0 ws0">Access <span class="_ _42"> </span>to <span class="_ _42"> </span>shar<span class="_ _0"></span>ed <span class="_ _42"> </span>data <span class="_ _42"> </span>by <span class="_ _42"> </span>multiple <span class="_ _23"> </span>processes <span class="_ _42"> </span>usually <span class="_ _42"> </span>requir<span class="_ _0"></span>es <span class="_ _23"> </span>synchronization, <span class="_ _42"> </span>just <span class="_ _42"> </span>as</div><div class="t m0 x32 h4a y35e1 ff19 fs26 fc0 sc0 ls0 ws0">does <span class="_ _9"></span>access <span class="_ _23"></span>to <span class="_ _9"></span>shared <span class="_ _9"></span>data <span class="_ _23"></span>by <span class="_ _9"></span>multiple <span class="_ _23"></span>threads. <span class="_ _45"> </span>If<span class="_ _45"> </span>the<span class="_ _45"> </span><span class="ff1b">process-shared<span class="_ _45"> </span></span>mutex <span class="_ _9"></span>attribute <span class="_ _23"></span>is</div><div class="t m0 x32 h4d y35e2 ff19 fs26 fc0 sc0 ls0 ws0">set <span class="_ _42"> </span>to<span class="_ _44"> </span><span class="ff1a">PTHREAD_PROCESS_SHARED</span><span class="lse82">,am<span class="_ _c"></span><span class="ls0">utex <span class="_ _53"> </span>allocated <span class="_ _42"> </span>from <span class="_ _42"> </span>a <span class="_ _42"> </span>memory <span class="_ _42"> </span>extent <span class="_ _42"> </span>shared</span></span></div><div class="t m0 x32 h49 y35e3 ff19 fs26 fc0 sc0 ls0 ws0">between multiple processes may be used for synchr<span class="_ _0"></span>onization by those pr<span class="_ _0"></span>ocesses.</div><div class="t m0 x3f h4d y35e4 ff19 fs26 fc0 sc0 ls164 ws0">We <span class="_ _50"> </span>c<span class="_ _23"></span><span class="ls0">an <span class="_ _5a"> </span>use <span class="_ _51"> </span>the<span class="_ _5c"> </span><span class="ff1a">pthread_mutexattr_getpshared<span class="_ _5c"> </span></span>function <span class="_ _51"> </span>to <span class="_ _51"> </span>query <span class="_ _5a"> </span>a</span></div><div class="t m0 x32 h4d y35e5 ff1a fs26 fc0 sc0 ls0 ws0">pthread_mutexattr_t<span class="_ _44"> </span><span class="ff19">structur<span class="lse83">ef<span class="_ _55"></span><span class="ls0">or <span class="_ _53"> </span>its<span class="_ _44"> </span><span class="ff1b">process-shar<span class="_ _0"></span>ed<span class="_ _44"> </span><span class="ff19">attribute. <span class="_ _44"> </span>W<span class="_ _6"></span><span class="lse84">ec<span class="_ _43"></span><span class="ls0">an <span class="_ _42"> </span>change <span class="_ _42"> </span>the</span></span></span></span></span></span></span></div><div class="t m0 x32 h4d y35e6 ff1b fs26 fc0 sc0 ls0 ws0">process-shar<span class="_ _0"></span>ed<span class="_"> </span><span class="ff19">attribute with the<span class="_"> </span><span class="ff1a">pthread_mutexattr_setpshared<span class="_ _80"> </span></span>function.</span></div><div class="t m0 x3f h4e y35e7 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;pthread.h&gt;</div><div class="t m0 x3f h4e y35e8 ff1a fs28 fc0 sc0 ls0 ws0">int pthread_mutexattr_getpshared(const pthread_mutexattr_t *</div><div class="t m0 x129 h4e y35e9 ff1a fs28 fc0 sc0 ls0 ws0">restrict<span class="_"> </span><span class="ff1b">attr</span>,</div><div class="t m0 x129 h4e y35ea ff1a fs28 fc0 sc0 ls0 ws0">int *restrict<span class="_"> </span><span class="ff1b">pshared</span>);</div><div class="t m0 x3f h4e y35eb ff1a fs28 fc0 sc0 ls0 ws0">int pthread_mutexattr_setpshared(pthread_mutexattr_t *<span class="ff1b">attr</span>,</div><div class="t m0 x129 h4e y35ec ff1a fs28 fc0 sc0 ls0 ws0">int<span class="_"> </span><span class="ff1b">pshared</span>);</div><div class="t m0 xca h7c y35ed ff19 fs28 fc0 sc0 ls0 ws0">Both return: 0 if OK, err<span class="_ _0"></span>or number on failure</div><div class="t m0 x32 h60 y35ee ff19 fs2c fc0 sc0 ls0 ws0">The<span class="_ _35"> </span><span class="ff1b">pr<span class="_ _0"></span>ocess-shared<span class="_ _45"> </span><span class="ff19">mutex <span class="_ _23"></span>attribute <span class="_ _23"></span>allows <span class="_ _23"></span>the <span class="_ _23"></span>pthr<span class="_ _0"></span>ead <span class="_ _23"></span>library <span class="_ _23"></span>to <span class="_ _23"></span>pr<span class="_ _0"></span>ovide <span class="_ _23"></span>mor<span class="ls9d8">ee<span class="_ _43"></span><span class="ls150">fﬁ<span class="ls0">cient</span></span></span></span></span></div><div class="t m0 x32 h54 y35ef ff19 fs2c fc0 sc0 ls0 ws0">mutex <span class="_"> </span>implementations <span class="_ _47"> </span>when <span class="_"> </span>the <span class="_ _66"> </span>attribute <span class="_ _47"> </span>is <span class="_"> </span>set <span class="_ _47"> </span>to<span class="_ _46"> </span><span class="ff1a">PTHREAD_PROCESS_PRIVATE</span>,</div><div class="t m0 x32 h55 y35f0 ff19 fs2c fc0 sc0 ls0 ws0">which is <span class="_ _2"></span>the <span class="_ _2"></span>default <span class="_ _2"></span>case <span class="_ _2"></span>with <span class="_ _2"></span>multithreaded applications.<span class="_ _46"> </span>The <span class="_ _2"></span>pthread library <span class="_ _2"></span>can <span class="_ _2"></span>then</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
