<div id="pf24f" class="pf w4 h1f" data-page-no="24f"><div class="pc pc24f w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg24f.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>15.6<span class="_ _183"> </span>XSI <span class="_"> </span>IPC<span class="_ _1b"> </span><span class="ff18">557</span></div><div class="t m0 x32 h2a y12f ff19 fsf fc0 sc0 ls0 ws0">given <span class="_ _53"> </span>IPC <span class="_ _e"> </span>structure<span class="_ _44"> </span>is<span class="_ _4b"> </span>c<span class="ls45">re<span class="_ _2"></span></span>ated <span class="_ _53"> </span>and <span class="_ _e"> </span>then <span class="_ _e"> </span>removed, <span class="_ _53"> </span>the <span class="_ _53"> </span>identiﬁer <span class="_ _e"> </span>associated <span class="_ _e"> </span>with <span class="_ _53"> </span>that</div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">structur<span class="_ _0"></span><span class="ls11e1">ec<span class="_ _5b"></span><span class="ls0">ontinually <span class="_ _66"> </span>increases <span class="_"> </span>until <span class="_ _47"> </span>it <span class="_"> </span>reaches <span class="_ _66"> </span>the <span class="_ _66"> </span>maximum <span class="_ _47"> </span>positive <span class="_"> </span>value <span class="_ _47"> </span>for <span class="_"> </span>an</span></span></div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">integer<span class="_ _6"></span><span class="ls44">,a<span class="_ _5"></span><span class="ls0">nd then wraps around to 0.</span></span></div><div class="t m0 x3f h2a y132 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _2"></span>identiﬁer <span class="_ _2"></span>is <span class="_ _3"></span>an <span class="_ _2"></span>internal <span class="_ _3"></span>name <span class="_ _2"></span>for <span class="_ _2"></span>an <span class="_ _3"></span>IPC <span class="_ _2"></span>object.<span class="_ _61"> </span>Cooperating <span class="_ _3"></span>processes <span class="_ _2"></span>need <span class="_ _2"></span>an</div><div class="t m0 x32 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">external <span class="_ _9"></span>naming <span class="_ _23"> </span>scheme <span class="_ _23"></span>to <span class="_ _9"></span>be <span class="_ _23"> </span>able <span class="_ _23"></span>to <span class="_ _9"></span>rendezvous <span class="_ _9"></span>using <span class="_ _23"> </span>the <span class="_ _23"></span>same <span class="_ _9"></span>IPC <span class="_ _23"> </span>object.<span class="_ _51"> </span>For <span class="_ _9"></span>this</div><div class="t m0 x32 h2b y134 ff19 fsf fc0 sc0 ls0 ws0">purpose, an IPC object is associated with a<span class="_"> </span><span class="ff1b">key<span class="_"> </span></span>that acts as an external name.</div><div class="t m0 x3f h26 y135 ff19 fsf fc0 sc0 ls0 ws0">Whenever <span class="_ _45"> </span>an <span class="_ _45"> </span>IPC <span class="_ _45"> </span>structur<span class="ls11e2">ei<span class="_ _26"></span><span class="ls69a">sb<span class="_ _26"></span><span class="ls0">eing <span class="_ _45"> </span>created <span class="_ _45"> </span>(by <span class="_ _45"> </span>calling<span class="_ _5a"> </span><span class="ff1a">msgget</span>,<span class="_ _5a"> </span><span class="ff1a">semget</span><span class="ls69a">,o<span class="_ _62"></span><span class="ls0">r</span></span></span></span></span></div><div class="t m0 x32 h26 y136 ff1a fsf fc0 sc0 ls0 ws0">shmget<span class="ff19">), a key must be <span class="_ _2"></span>speciﬁed.<span class="_ _46"> </span>The data type <span class="_ _2"></span>of this key is <span class="_ _2"></span>the primitive system data</span></div><div class="t m0 x32 h26 y137 ff19 fsf fc0 sc0 ls0 ws0">type<span class="_ _35"> </span><span class="ff1a">key_t</span><span class="ls49d">,w<span class="_ _43"></span><span class="ls0">hich <span class="_ _23"> </span>is <span class="_ _23"> </span>often <span class="_ _23"> </span>deﬁned <span class="_ _23"> </span>as <span class="_ _42"> </span>a <span class="_ _23"></span>long <span class="_ _23"></span>integer <span class="_ _23"></span>in <span class="_ _23"></span>the <span class="_ _23"> </span>header<span class="_ _35"> </span><span class="ff1a">&lt;sys/types.h&gt;</span>.</span></span></div><div class="t m0 x32 h2a y138 ff19 fsf fc0 sc0 ls0 ws0">This key is converted into an identiﬁer by the kernel.</div><div class="t m0 x3f h2a y139 ff19 fsf fc0 sc0 ls0 ws0">Ther<span class="ls11e3">ea<span class="_ _55"></span><span class="ls45">re <span class="_"> </span>v<span class="ls0">arious <span class="_ _53"> </span>ways <span class="_ _53"> </span>for <span class="_ _53"> </span>a <span class="_ _42"> </span>client <span class="_ _53"> </span>and <span class="_ _53"> </span>a <span class="_ _53"> </span>server <span class="_ _53"> </span>to <span class="_ _42"> </span>rendezvous <span class="_ _53"> </span>at <span class="_ _42"> </span>the <span class="_ _53"> </span>same <span class="_ _53"> </span>IPC</span></span></span></div><div class="t m0 x32 h2a y13a ff19 fsf fc0 sc0 ls0 ws0">structur<span class="_ _0"></span>e.</div><div class="t m0 x3f h26 y255 ff19 fsf fc0 sc0 ls0 ws0">1. <span class="_ _51"> </span>The<span class="_ _47"> </span>server <span class="_ _2"></span>can <span class="_ _3"></span>create a <span class="_ _3"></span>new <span class="_ _2"></span>IPC <span class="_ _3"></span>structure<span class="_"> </span>by<span class="_ _47"> </span>specifying <span class="_ _3"></span>a <span class="_ _2"></span>key <span class="_ _3"></span>of<span class="_ _47"> </span><span class="ff1a">IPC_PRIVATE</span></div><div class="t m0 x41 h2a y13b ff19 fsf fc0 sc0 ls0 ws0">and <span class="_ _53"> </span>stor<span class="ls4ee">et<span class="_ _55"></span><span class="ls0">he <span class="_ _e"> </span>returned <span class="_ _53"> </span>identiﬁer <span class="_ _e"> </span>somewher<span class="ls11e4">e(<span class="_ _55"></span><span class="ls0">such <span class="_ _e"> </span>as <span class="_ _53"> </span>a <span class="_ _e"> </span>ﬁle) <span class="_ _e"> </span>for <span class="_ _e"> </span>the <span class="_ _e"> </span>client <span class="_ _e"> </span>to</span></span></span></span></div><div class="t m0 x41 h26 y13c ff19 fsf fc0 sc0 ls0 ws0">obtain. <span class="_ _44"> </span>The<span class="_ _44"> </span>key<span class="_ _44"> </span><span class="ff1a">IPC_PRIVATE<span class="_ _44"> </span></span>guarantees <span class="_ _53"> </span>that <span class="_ _53"> </span>the <span class="_ _42"> </span>server <span class="_ _53"> </span>creates <span class="_ _42"> </span>a <span class="_ _42"> </span>new <span class="_ _53"> </span>IPC</div><div class="t m0 x41 h2a y256 ff19 fsf fc0 sc0 ls0 ws0">structur<span class="_ _0"></span>e. <span class="_ _45"> </span>The<span class="_ _45"> </span>disadvantage <span class="_ _3"></span>of <span class="_ _9"></span>this <span class="_ _9"></span>technique <span class="_ _9"></span>is <span class="_ _9"></span>that <span class="_ _9"></span>ﬁle <span class="_ _9"></span>system <span class="_ _9"></span>operations <span class="_ _9"></span>are</div><div class="t m0 x41 h2a y257 ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">quired <span class="_ _9"></span>for <span class="_ _23"></span>the <span class="_ _23"></span>server <span class="_ _9"></span>to <span class="_ _23"></span>write <span class="_ _9"></span>the <span class="_ _23"></span>integer <span class="_ _23"></span>identiﬁer <span class="_ _9"></span>to <span class="_ _23"></span>a <span class="_ _9"></span>ﬁle, <span class="_ _23"></span>and <span class="_ _9"></span>then <span class="_ _23"> </span>for <span class="_ _23"></span>the</span></div><div class="t m0 x41 h2a y258 ff19 fsf fc0 sc0 ls0 ws0">clients to retrieve this identiﬁer later<span class="_ _6"></span>.</div><div class="t m0 x41 h26 ya2c ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _45"> </span><span class="ff1a">IPC_PRIVATE<span class="_ _45"> </span></span>key <span class="_ _23"></span>is <span class="_ _9"></span>also <span class="_ _9"></span>used <span class="_ _23"></span>in <span class="_ _9"></span>a <span class="_ _9"></span>parent–child <span class="_ _9"></span>relationship. <span class="_ _45"> </span>The<span class="_ _45"> </span>parent</div><div class="t m0 x41 h26 ya2d ff19 fsf fc0 sc0 ls0 ws0">creates <span class="_ _44"> </span>a <span class="_ _44"> </span>new <span class="_ _44"> </span>IPC <span class="_ _4b"> </span>structur<span class="ls11e5">es<span class="_ _64"></span><span class="ls0">pecifying<span class="_ _65"> </span><span class="ff1a">IPC_PRIVATE</span><span class="ls11e6">,a<span class="_ _52"></span><span class="ls0">nd <span class="_ _44"> </span>the <span class="_ _44"> </span>resulting</span></span></span></span></div><div class="t m0 x41 h26 ya2e ff19 fsf fc0 sc0 ls0 ws0">identiﬁer <span class="_ _23"> </span>is <span class="_ _23"> </span>then <span class="_ _42"> </span>available <span class="_ _23"></span>to <span class="_ _23"> </span>the <span class="_ _23"> </span>child <span class="_ _42"> </span>after <span class="_ _23"></span>the<span class="_ _35"> </span><span class="ff1a">fork</span><span class="ls2fb">.T<span class="_ _7"></span><span class="ls0">he <span class="_ _23"> </span>child <span class="_ _42"> </span>can <span class="_ _23"></span>pass <span class="_ _23"> </span>the</span></span></div><div class="t m0 x41 h26 ya2f ff19 fsf fc0 sc0 ls0 ws0">identiﬁer to a new program as an ar<span class="_ _0"></span>gument to one of the<span class="_"> </span><span class="ff1a">exec<span class="_ _80"> </span></span>functions.</div><div class="t m0 x3f h2a ya30 ff19 fsf fc0 sc0 ls0 ws0">2. <span class="_ _51"> </span>The<span class="_ _45"> </span>client <span class="_ _9"></span>and <span class="_ _23"></span>the <span class="_ _9"></span>server <span class="_ _9"></span>can <span class="_ _9"></span>agree <span class="_ _9"></span>on <span class="_ _9"></span>a <span class="_ _9"></span>key <span class="_ _23"></span>by <span class="_ _9"></span>deﬁning <span class="_ _9"></span>the <span class="_ _9"></span>key <span class="_ _23"></span>in <span class="_ _9"></span>a <span class="_ _9"></span>common</div><div class="t m0 x41 h2a ya31 ff19 fsf fc0 sc0 ls0 ws0">header<span class="_ _6"></span><span class="ls80a">,f<span class="_ _d"></span><span class="ls0">or <span class="_ _2"></span>example.<span class="_ _46"> </span>The <span class="_ _2"></span>server then <span class="_ _2"></span>creates a <span class="_ _2"></span>new <span class="_ _2"></span>IPC structur<span class="ls11e7">es<span class="_ _4f"></span><span class="ls0">pecifying <span class="_ _2"></span>this</span></span></span></span></div><div class="t m0 x41 h2a ya32 ff19 fsf fc0 sc0 ls0 ws0">key<span class="_ _4"></span><span class="ls11e8">.T<span class="_ _62"></span><span class="ls0">he <span class="_ _9"></span>problem <span class="_ _3"></span>with <span class="_ _9"></span>this <span class="_ _9"></span>approach <span class="_ _3"></span>is <span class="_ _9"></span>that <span class="_ _9"></span>it’s <span class="_ _3"></span>possible <span class="_ _9"></span>for <span class="_ _9"></span>the <span class="_ _9"></span>key <span class="_ _3"></span>to <span class="_ _9"></span>already</span></span></div><div class="t m0 x41 h26 y4379 ff19 fsf fc0 sc0 ls0 ws0">be <span class="_ _23"></span>associated <span class="_ _23"></span>with <span class="_ _23"> </span>an <span class="_ _23"> </span>IPC <span class="_ _23"> </span>structure, <span class="_ _23"></span>in <span class="_ _23"></span>which <span class="_ _23"></span>case <span class="_ _23"></span>the<span class="_ _35"> </span><span class="ff1a">get<span class="_ _35"> </span></span>function <span class="_ _23"></span>(<span class="ff1a">msgget</span>,</div><div class="t m0 x41 h26 y437a ff1a fsf fc0 sc0 ls0 ws0">semget<span class="ff19 ls89d">,o<span class="_ _62"></span><span class="ls0">r<span class="_ _5a"> </span><span class="ff1a">shmget</span><span class="ls89d">)r<span class="_ _26"></span><span class="ls0">eturns <span class="_ _45"> </span>an <span class="_ _47"> </span>error<span class="_ _6"></span><span class="ls89c">.T<span class="_ _56"></span><span class="ls0">he <span class="_ _45"> </span>server <span class="_ _47"> </span>must <span class="_ _45"> </span>handle <span class="_ _47"> </span>this <span class="_ _45"> </span>error<span class="_ _6"></span>,</span></span></span></span></span></span></div><div class="t m0 x41 h2a y437b ff19 fsf fc0 sc0 ls0 ws0">deleting the existing IPC structur<span class="_ _0"></span>e, and try to create it again.</div><div class="t m0 x3f h2a y335 ff19 fsf fc0 sc0 ls0 ws0">3. <span class="_ _51"> </span>The<span class="_"> </span>client <span class="_ _2"></span>and <span class="_ _2"></span>the <span class="_ _2"></span>server can <span class="_ _2"></span>agree on <span class="_ _2"></span>a pathname <span class="_ _2"></span>and <span class="_ _2"></span>project ID (the <span class="_ _2"></span>project ID</div><div class="t m0 x41 h26 y336 ff19 fsf fc0 sc0 ls0 ws0">is <span class="_ _23"></span>a <span class="_ _23"></span>character <span class="_ _23"></span>value <span class="_ _23"></span>between <span class="_ _23"></span>0 <span class="_ _23"></span>and <span class="_ _23"></span>255) <span class="_ _23"></span>and <span class="_ _23"></span>call <span class="_ _23"></span>the <span class="_ _23"></span>function<span class="_ _45"> </span><span class="ff1a">ftok<span class="_ _35"> </span></span>to <span class="_ _23"> </span>convert</div><div class="t m0 x41 h2a y337 ff19 fsf fc0 sc0 ls0 ws0">these <span class="_ _23"></span>two <span class="_ _9"></span>values <span class="_ _23"></span>into <span class="_ _23"></span>a <span class="_ _9"></span>key<span class="_ _6"></span><span class="ls11e9">.T<span class="_ _26"></span><span class="ls0">his <span class="_ _23"></span>key <span class="_ _9"></span>is <span class="_ _23"> </span>then <span class="_ _23"></span>used <span class="_ _23"></span>in <span class="_ _9"></span>step <span class="_ _23"> </span>2.<span class="_ _51"> </span>The <span class="_ _9"></span>only <span class="_ _23"> </span>service</span></span></div><div class="t m0 x41 h26 y28e3 ff19 fsf fc0 sc0 ls0 ws0">provided by<span class="_"> </span><span class="ff1a">ftok<span class="_ _66"> </span></span>is <span class="_ _2"></span>a <span class="_ _2"></span>way of <span class="_ _2"></span>generating a <span class="_ _2"></span>key <span class="_ _2"></span>from a pathname <span class="_ _2"></span>and <span class="_ _2"></span>project ID.</div><div class="t m0 x3f h57 y437c ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;sys/ipc.h&gt;</div><div class="t m0 x3f h57 y437d ff1a fs2d fc0 sc0 ls0 ws0">key_t ftok(const char *<span class="ff1b">path</span><span class="ls15c">,i<span class="_ _1d"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">id</span>);</span></span></div><div class="t m0 x17a h57 y437e ff19 fs2d fc0 sc0 ls0 ws0">Returns: key if OK,<span class="_"> </span><span class="ff1a">(key_t)<span class="ff20">−</span></span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x3f h4a y437f ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_"> </span><span class="ff1b">path<span class="_ _66"> </span></span>argument must refer to <span class="_ _2"></span>an existing <span class="_ _2"></span>ﬁle.<span class="_ _46"> </span>Only the <span class="_ _2"></span>lower 8 <span class="_ _2"></span>bits of<span class="_ _66"> </span><span class="ff1b">id<span class="_ _66"> </span></span>ar<span class="ls2bc">eu<span class="_ _d"></span><span class="ls0">sed</span></span></div><div class="t m0 x32 h49 y4380 ff19 fs26 fc0 sc0 ls0 ws0">when generating the key<span class="_ _4"></span>.</div><div class="t m0 x3f h4d y4381 ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _53"> </span>key <span class="_ _e"> </span>created <span class="_ _53"> </span>by<span class="_ _4b"> </span><span class="ff1a">ftok<span class="_ _4b"> </span></span>is <span class="_ _53"> </span>usually <span class="_ _e"> </span>formed <span class="_ _e"> </span>by <span class="_ _53"> </span>taking <span class="_ _e"> </span>parts <span class="_ _e"> </span>of <span class="_ _53"> </span>the<span class="_ _4b"> </span><span class="ff1a">st_dev<span class="_ _4b"> </span></span>and</div><div class="t m0 x32 h4d y4382 ff1a fs26 fc0 sc0 ls0 ws0">st_ino<span class="_ _47"> </span><span class="ff19">ﬁelds <span class="_ _3"></span>in <span class="_ _3"></span>the<span class="_ _47"> </span></span>stat<span class="_ _47"> </span><span class="ff19">structur<span class="ls11ea">e(<span class="_ _b"></span><span class="ls0">Section <span class="_ _3"></span>4.2) <span class="_ _3"></span>corresponding <span class="_ _3"></span>to <span class="_ _3"></span>the <span class="_ _3"></span>given <span class="_ _3"></span>pathname</span></span></span></div><div class="t m0 x32 h49 y4383 ff19 fs26 fc0 sc0 ls0 ws0">and <span class="_ _3"></span>combining <span class="_ _9"></span>them <span class="_ _9"></span>with <span class="_ _3"></span>the <span class="_ _9"></span>project <span class="_ _3"></span>ID.<span class="_ _5a"> </span>If <span class="_ _3"></span>two <span class="_ _9"></span>pathnames <span class="_ _9"></span>refer <span class="_ _3"></span>to <span class="_ _9"></span>two <span class="_ _3"></span>different <span class="_ _3"></span>ﬁles,</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
