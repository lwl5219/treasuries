<div id="pf179" class="pf w4 h1f" data-page-no="179"><div class="pc pc179 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg179.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h7a ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>10.10<span class="_ _110"> </span><span class="ff1a">alarm<span class="_ _4b"> </span></span>and<span class="_ _4b"> </span><span class="ff1a">pause<span class="_ _4b"> </span></span>Functions<span class="_ _1b"> </span><span class="ff18">343</span></div><div class="t m0 x32 h2a y12f ff19 fsf fc0 sc0 ls0 ws0">Here, <span class="_ _23"> </span>we <span class="_ _42"> </span>speciﬁcally <span class="_ _42"> </span>want <span class="_ _42"> </span>a <span class="_ _42"> </span>slow <span class="_ _23"> </span>system <span class="_ _42"> </span>call <span class="_ _42"> </span>to <span class="_ _42"> </span>be <span class="_ _42"> </span>interrupted. <span class="_ _35"> </span>W<span class="_ _6"></span>e’ll <span class="_ _42"> </span>see <span class="_ _42"> </span>a <span class="_ _42"> </span>portable</div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">way to do this in Section 10.14.</div><div class="t m0 x35 h4c y2bd8 ff16 fs26 fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h4d y2bd9 ff19 fs26 fc0 sc0 ls0 ws0">Let’s <span class="_ _23"></span>redo <span class="_ _9"></span>the <span class="_ _23"> </span>preceding <span class="_ _23"></span>example <span class="_ _23"></span>using<span class="_ _35"> </span><span class="ff1a">longjmp</span><span class="lsc8c">.T<span class="_ _7"></span><span class="ls0">his <span class="_ _23"> </span>way<span class="_ _6"></span>,<span class="_ _45"> </span>we<span class="_ _35"> </span>don’t <span class="_ _23"> </span>need <span class="_ _23"> </span>to <span class="_ _23"> </span>worry</span></span></div><div class="t m0 x32 h49 y2bda ff19 fs26 fc0 sc0 ls0 ws0">about whether a slow system call is interrupted.</div><div class="t m0 x32 h5d y2bdb ff1a fs2f fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h5d y2bdc ff1a fs2f fc0 sc0 ls0 ws0">#include &lt;setjmp.h&gt;</div><div class="t m0 x32 h5d y2bdd ff1a fs2f fc0 sc0 ls0 ws0">static void<span class="_ _8a"> </span>sig_alrm(int);</div><div class="t m0 x32 h5d y2bde ff1a fs2f fc0 sc0 ls0 ws0">static jmp_buf<span class="_ _d9"> </span>env_alrm;</div><div class="t m0 x32 h5d y2bdf ff1a fs2f fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h5d y2be0 ff1a fs2f fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 x32 h5d y2be1 ff1a fs2f fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h5d y2be2 ff1a fs2f fc0 sc0 ls0 ws0">int <span class="_ _15"> </span>n;</div><div class="t m0 x8a h5d y2be3 ff1a fs2f fc0 sc0 ls0 ws0">char <span class="_ _68"> </span>line[MAXLINE];</div><div class="t m0 x8a h5d y2be4 ff1a fs2f fc0 sc0 ls0 ws0">if (signal(SIGALRM, sig_alrm) == SIG_ERR)</div><div class="t m0 x9d h5d y2be5 ff1a fs2f fc0 sc0 ls0 ws0">err_sys(&quot;signal(SIGALRM) error&quot;);</div><div class="t m0 x8a h5d y2be6 ff1a fs2f fc0 sc0 ls0 ws0">if (setjmp(env_alrm) != 0)</div><div class="t m0 x9d h5d y2be7 ff1a fs2f fc0 sc0 ls0 ws0">err_quit(&quot;read timeout&quot;);</div><div class="t m0 x8a h5d y2be8 ff1a fs2f fc0 sc0 ls0 ws0">alarm(10);</div><div class="t m0 x8a h5d y2be9 ff1a fs2f fc0 sc0 ls0 ws0">if ((n = read(STDIN_FILENO, line, MAXLINE)) &lt; 0)</div><div class="t m0 x9d h5d y2bea ff1a fs2f fc0 sc0 ls0 ws0">err_sys(&quot;read error&quot;);</div><div class="t m0 x8a h5d y2beb ff1a fs2f fc0 sc0 ls0 ws0">alarm(0);</div><div class="t m0 x8a h5d y2bec ff1a fs2f fc0 sc0 ls0 ws0">write(STDOUT_FILENO, line, n);</div><div class="t m0 x8a h5d y2bed ff1a fs2f fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h5d y2bee ff1a fs2f fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h5d y2bef ff1a fs2f fc0 sc0 ls0 ws0">static void</div><div class="t m0 x32 h5d y2bf0 ff1a fs2f fc0 sc0 ls0 ws0">sig_alrm(int signo)</div><div class="t m0 x32 h5d y2bf1 ff1a fs2f fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h5d y2bf2 ff1a fs2f fc0 sc0 ls0 ws0">longjmp(env_alrm, 1);</div><div class="t m0 x32 h5d y2bf3 ff1a fs2f fc0 sc0 ls0 ws0">}</div><div class="t m0 x38 h6d y2bf4 ff18 fs12 fc0 sc0 ls0 ws0">Figure 10.1<span class="_ _0"></span>1<span class="_ _5a"> </span><span class="ff19">Calling<span class="_"> </span><span class="ff1a">read<span class="_ _e"> </span></span>with a timeout, using<span class="_"> </span><span class="ff1a">longjmp</span></span></div><div class="t m0 x32 h50 y2bf5 ff19 fs29 fc0 sc0 ls0 ws0">This <span class="_ _23"></span>version <span class="_ _23"></span>works <span class="_ _23"></span>as <span class="_ _23"></span>expected, <span class="_ _23"></span>regar<span class="_ _1"></span>dless <span class="_ _23"> </span>of <span class="_ _23"> </span>whether <span class="_ _23"> </span>the <span class="_ _23"> </span>system <span class="_ _23"> </span>restarts <span class="_ _23"></span>interrupted</div><div class="t m0 x32 h50 y2bf6 ff19 fs29 fc0 sc0 ls0 ws0">system <span class="_ _2"></span>calls.<span class="_ _46"> </span>Realize, <span class="_ _2"></span>however<span class="_ _1"></span><span class="lsc8d">,t<span class="_ _4f"></span><span class="ls0">hat <span class="_ _2"></span>we <span class="_ _2"></span>still <span class="_ _2"></span>have <span class="_ _2"></span>the <span class="_ _2"></span>problem <span class="_ _2"></span>of <span class="_ _2"></span>interactions <span class="_ _2"></span>with <span class="_ _2"></span>other</span></span></div><div class="t m0 x32 h50 y2bf7 ff19 fs29 fc0 sc0 ls0 ws0">signal handlers, as in Figur<span class="lsdd">e1<span class="_ _4f"></span><span class="ls0">0.8.</span></span></div><div class="t m0 x3f h64 y2bf8 ff19 fs31 fc0 sc0 ls0 ws0">If <span class="_ _23"> </span>we <span class="_ _42"> </span>want <span class="_ _42"> </span>to <span class="_ _23"> </span>set <span class="_ _42"> </span>a <span class="_ _23"> </span>time <span class="_ _42"> </span>limit <span class="_ _42"> </span>on <span class="_ _23"> </span>an <span class="_ _42"> </span>I/O <span class="_ _42"> </span>operation, <span class="_ _23"> </span>we <span class="_ _42"> </span>need <span class="_ _23"> </span>to <span class="_ _42"> </span>use<span class="_ _35"> </span><span class="ff1a">longjmp</span><span class="lsc8e">,a<span class="_ _43"></span><span class="ls0">s</span></span></div><div class="t m0 x32 h6e y2bf9 ff19 fs31 fc0 sc0 ls0 ws0">shown <span class="_ _2"></span>previously<span class="_ _4"></span><span class="lsc8f">,w<span class="_ _4f"></span><span class="ls0">hile <span class="_ _3"></span>recognizing <span class="_ _2"></span>its <span class="_ _2"></span>possible <span class="_ _3"></span>interaction <span class="_ _3"></span>with <span class="_ _2"></span>other <span class="_ _3"></span>signal <span class="_ _3"></span>handlers.</span></span></div><div class="t m0 x32 h64 y2bfa ff19 fs31 fc0 sc0 ls0 ws0">Another option is <span class="_ _2"></span>to use <span class="_ _2"></span>the<span class="_"> </span><span class="ff1a">select<span class="_ _66"> </span></span>or<span class="_"> </span><span class="ff1a">poll<span class="_ _66"> </span></span>functions, described <span class="_ _2"></span>in Sections <span class="_ _2"></span>14.4.1 and</div><div class="t m0 x32 h6e y2bfb ff19 fs31 fc0 sc0 ls0 ws0">14.4.2.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
