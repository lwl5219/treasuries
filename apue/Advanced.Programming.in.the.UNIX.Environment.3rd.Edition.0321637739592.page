<div id="pf250" class="pf w4 h1f" data-page-no="250"><div class="pc pc250 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg250.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">558<span class="_ _1b"> </span><span class="ff19">Interprocess <span class="_"> </span>Communication<span class="_ _2c"> </span>Chapter <span class="_"> </span>15</span></div><div class="t m0 x32 h26 y12f ff19 fsf fc0 sc0 ls0 ws0">then<span class="_"> </span><span class="ff1a">ftok<span class="_ _66"> </span></span>usually returns two different keys for the <span class="_ _2"></span>two pathnames.<span class="_ _46"> </span>However<span class="_ _1"></span><span class="lsbd">,b<span class="_ _d"></span><span class="ls0">ecause</span></span></div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">both <span class="_ _23"> </span>i-node <span class="_ _42"> </span>numbers <span class="_ _23"> </span>and <span class="_ _42"> </span>keys <span class="_ _23"> </span>ar<span class="ls11eb">eo<span class="_ _43"></span><span class="ls0">ften <span class="_ _23"> </span>stored <span class="_ _23"> </span>in <span class="_ _42"> </span>long <span class="_ _23"> </span>integers, <span class="_ _42"> </span>information <span class="_ _23"> </span>loss <span class="_ _42"> </span>can</span></span></div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">occur <span class="_ _23"></span>when <span class="_ _9"></span>creating <span class="_ _23"></span>a <span class="_ _9"></span>key<span class="_ _6"></span><span class="ls11ec">.T<span class="_ _26"></span><span class="ls0">his <span class="_ _23"></span>means <span class="_ _9"></span>that <span class="_ _23"> </span>two <span class="_ _23"> </span>differ<span class="_ _0"></span>ent <span class="_ _23"></span>pathnames <span class="_ _9"></span>to <span class="_ _23"> </span>different <span class="_ _9"></span>ﬁles</span></span></div><div class="t m0 x32 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">can generate the same key if the same project ID is used.</div><div class="t m0 x3f h26 y133 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_"> </span>three<span class="_ _46"> </span><span class="ff1a">get<span class="_ _61"> </span></span>functions <span class="_"> </span>(<span class="ff1a">msgget</span>,<span class="_ _61"> </span><span class="ff1a">semget</span><span class="ls11ed">,a<span class="_ _5b"></span><span class="ls0">nd<span class="_ _61"> </span><span class="ff1a">shmget</span><span class="ls11ed">)a<span class="_ _5b"></span><span class="ls0">ll <span class="_ _66"> </span>have <span class="_ _66"> </span>two <span class="_ _47"> </span>similar</span></span></span></span></div><div class="t m0 x32 h2b y134 ff19 fsf fc0 sc0 ls0 ws0">arguments: <span class="_ _23"> </span>a<span class="_ _44"> </span><span class="ff1b">key<span class="_ _44"> </span></span>and <span class="_ _42"> </span>an <span class="_ _42"> </span>integer<span class="_ _44"> </span><span class="ff1b">ﬂag</span><span class="ls6de">.A<span class="_ _d"></span><span class="ls0">new <span class="_ _42"> </span>IPC <span class="_ _42"> </span>structure<span class="_ _35"> </span>is<span class="_ _44"> </span>c<span class="ls45">re<span class="_ _2"></span></span>ated <span class="_ _42"> </span>(normally <span class="_ _42"> </span>by <span class="_ _42"> </span>a</span></span></div><div class="t m0 x32 h26 y135 ff19 fsf fc0 sc0 ls0 ws0">server) <span class="_ _53"> </span>if <span class="_ _e"> </span>either<span class="_ _4b"> </span><span class="ff1b">key<span class="_ _4b"> </span></span>is<span class="_ _4b"> </span><span class="ff1a">IPC_PRIVATE<span class="_ _59"> </span></span>or<span class="_ _4b"> </span><span class="ff1b">key<span class="_ _4b"> </span></span>is <span class="_ _53"> </span>not <span class="_ _e"> </span>currently <span class="_ _53"> </span>associated <span class="_ _e"> </span>with <span class="_ _e"> </span>an <span class="_ _e"> </span>IPC</div><div class="t m0 x32 h26 y136 ff19 fsf fc0 sc0 ls0 ws0">structur<span class="_ _0"></span>e<span class="_ _47"> </span>of<span class="_ _47"> </span>the <span class="_ _3"></span>particular <span class="_ _2"></span>type <span class="_ _3"></span>and <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">IPC_CREAT<span class="_ _47"> </span></span>bit <span class="_ _3"></span>of<span class="_ _47"> </span><span class="ff1b">ﬂag<span class="_ _47"> </span></span>is <span class="_ _3"></span>speciﬁed.<span class="_ _16"> </span><span class="ls5f">To <span class="_ _80"> </span>r<span class="_ _9"></span></span>eference</div><div class="t m0 x32 h2b y137 ff19 fsf fc0 sc0 ls0 ws0">an existing <span class="_ _2"></span>queue <span class="_ _2"></span>(normally <span class="_ _2"></span>done <span class="_ _2"></span>by <span class="_ _2"></span>a <span class="_ _2"></span>client),<span class="_ _47"> </span><span class="ff1b">key<span class="_"> </span></span>must <span class="_ _2"></span>equal <span class="_ _2"></span>the <span class="_ _2"></span>key <span class="_ _2"></span>that <span class="_ _2"></span>was <span class="_ _2"></span>speciﬁed</div><div class="t m0 x32 h26 y138 ff19 fsf fc0 sc0 ls0 ws0">when the queue was created, and<span class="_"> </span><span class="ff1a">IPC_CREAT<span class="_ _80"> </span></span>must not be speciﬁed.</div><div class="t m0 x3f h26 y139 ff19 fsf fc0 sc0 ls0 ws0">Note <span class="_ _66"> </span>that <span class="_ _47"> </span>it’s <span class="_"> </span>never <span class="_ _47"> </span>possible <span class="_ _66"> </span>to <span class="_ _66"> </span>specify<span class="_ _61"> </span><span class="ff1a">IPC_PRIVATE<span class="_ _61"> </span></span>to <span class="_ _47"> </span>refer<span class="_ _1"></span>ence <span class="_ _47"> </span>an <span class="_ _66"> </span>existing</div><div class="t m0 x32 h2b y13a ff19 fsf fc0 sc0 ls0 ws0">queue, <span class="_ _2"></span>since <span class="_ _2"></span>this <span class="_ _3"></span>special<span class="_ _66"> </span><span class="ff1b">key<span class="_ _47"> </span></span>value <span class="_ _2"></span>always <span class="_ _2"></span>creates <span class="_ _2"></span>a <span class="_ _2"></span>new <span class="_ _3"></span>queue.<span class="_ _61"> </span><span class="ls5f">To <span class="_ _e"> </span>r<span class="_ _9"></span></span>eference <span class="_ _2"></span>an <span class="_ _2"></span>existing</div><div class="t m0 x32 h26 y254 ff19 fsf fc0 sc0 ls0 ws0">queue <span class="_ _e"> </span>that <span class="_ _e"> </span>was <span class="_ _e"> </span>created <span class="_ _53"> </span>with <span class="_"> </span>a<span class="_ _4b"> </span><span class="ff1b">key<span class="_ _4b"> </span></span>of<span class="_ _4b"> </span><span class="ff1a">IPC_PRIVATE</span>,<span class="_ _59"> </span>we<span class="_ _4b"> </span>must <span class="_"> </span>know <span class="_ _53"> </span>the <span class="_ _e"> </span>associated</div><div class="t m0 x32 h26 y255 ff19 fsf fc0 sc0 ls0 ws0">identiﬁer <span class="_"> </span>and <span class="_ _66"> </span>then <span class="_"> </span>use <span class="_ _66"> </span>that <span class="_ _66"> </span>identiﬁer <span class="_ _66"> </span>in <span class="_ _66"> </span>the <span class="_ _66"> </span>other <span class="_ _66"> </span>IPC <span class="_"> </span>calls <span class="_ _66"> </span>(such <span class="_ _66"> </span>as<span class="_ _61"> </span><span class="ff1a">msgsnd<span class="_ _46"> </span></span>and</div><div class="t m0 x32 h26 y13b ff1a fsf fc0 sc0 ls0 ws0">msgrcv<span class="ff19">), bypassing the<span class="_"> </span></span>get<span class="_ _80"> </span><span class="ff19">function.</span></div><div class="t m0 x3f h2a y13c ff19 fsf fc0 sc0 ls0 ws0">If <span class="_ _23"></span>we <span class="_ _23"></span>want <span class="_ _9"></span>to <span class="_ _23"> </span>create <span class="_ _23"></span>a <span class="_ _23"></span>new <span class="_ _9"></span>IPC <span class="_ _23"> </span>structure, <span class="_ _23"></span>making <span class="_ _9"></span>sur<span class="lsdba">et<span class="_ _b"></span><span class="ls0">hat <span class="_ _9"></span>we <span class="_ _23"></span>don’t <span class="_ _23"></span>refer<span class="_ _0"></span>ence <span class="_ _23"></span>an</span></span></div><div class="t m0 x32 h26 y256 ff19 fsf fc0 sc0 ls0 ws0">existing <span class="_ _3"></span>one <span class="_ _9"></span>with <span class="_ _3"></span>the <span class="_ _9"></span>same <span class="_ _9"></span>identiﬁer<span class="_ _6"></span>,<span class="_ _45"> </span>we<span class="_ _47"> </span>must <span class="_ _9"></span>specify <span class="_ _3"></span>a<span class="_ _45"> </span><span class="ff1b">ﬂag<span class="_ _45"> </span></span>with <span class="_ _3"></span>both <span class="_ _3"></span>the<span class="_ _45"> </span><span class="ff1a">IPC_CREAT</span></div><div class="t m0 x32 h26 y257 ff19 fsf fc0 sc0 ls0 ws0">and<span class="_"> </span><span class="ff1a">IPC_EXCL<span class="_ _80"> </span></span>bits set.<span class="_ _46"> </span>Doing this <span class="_ _2"></span>causes an error r<span class="_ _0"></span>eturn of<span class="_"> </span><span class="ff1a">EEXIST<span class="_ _66"> </span></span>if the IPC structure</div><div class="t m0 x32 h26 y258 ff19 fsf fc0 sc0 ls0 ws0">already <span class="_ _53"> </span>exists.<span class="_ _48"> </span>(This <span class="_ _e"> </span>is <span class="_ _e"> </span>similar <span class="_"> </span>to <span class="_ _53"> </span>an<span class="_ _4b"> </span><span class="ff1a">open<span class="_ _59"> </span></span>that <span class="_ _e"> </span>speciﬁes <span class="_ _e"> </span>the<span class="_ _4b"> </span><span class="ff1a">O_CREAT<span class="_ _59"> </span></span>and<span class="_ _4b"> </span><span class="ff1a">O_EXCL</span></div><div class="t m0 x32 h2a y161 ff19 fsf fc0 sc0 ls0 ws0">ﬂags.)</div><div class="t m0 x32 h53 y4384 ff16 fs2b fc0 sc0 ls0 ws0">15.6.2 <span class="_ _54"> </span>P<span class="_ _0"></span>ermission <span class="_"> </span>Structure</div><div class="t m0 x32 h26 y4385 ff19 fsf fc0 sc0 ls0 ws0">XSI <span class="_"> </span>IPC <span class="_"> </span>associates <span class="_"> </span>an<span class="_ _46"> </span><span class="ff1a">ipc_perm<span class="_ _46"> </span></span>structur<span class="ls11ee">ew<span class="_ _5b"></span><span class="ls0">ith <span class="_ _66"> </span>each <span class="_"> </span>IPC <span class="_ _66"> </span>structure. <span class="_ _59"> </span>This<span class="_ _46"> </span>structure</span></span></div><div class="t m0 x32 h2a y4386 ff19 fsf fc0 sc0 ls0 ws0">deﬁnes the permissions and owner and includes at least the following members:</div><div class="t m0 x3f h57 y4387 ff1a fs2d fc0 sc0 ls0 ws0">struct ipc_perm {</div><div class="t m0 xf4 h57 y4388 ff1a fs2d fc0 sc0 ls0 ws0">uid_t <span class="_"> </span>uid; <span class="_"> </span>/*<span class="_"> </span>owner’s effective user ID */</div><div class="t m0 xf4 h57 y4389 ff1a fs2d fc0 sc0 ls0 ws0">gid_t <span class="_"> </span>gid; <span class="_"> </span>/*<span class="_"> </span>owner’s effective group ID */</div><div class="t m0 xf4 h57 y438a ff1a fs2d fc0 sc0 ls0 ws0">uid_t <span class="_"> </span>cuid;<span class="_"> </span>/* creator’s effective user ID */</div><div class="t m0 xf4 h57 y438b ff1a fs2d fc0 sc0 ls0 ws0">gid_t <span class="_"> </span>cgid;<span class="_"> </span>/* creator’s effective group ID */</div><div class="t m0 xf4 h57 y438c ff1a fs2d fc0 sc0 ls0 ws0">mode_t mode; /* access modes */</div><div class="t m0 xf4 h57 y438d ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 xf4 h57 y438e ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 xf4 h57 y438f ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 x3f h57 y4390 ff1a fs2d fc0 sc0 ls0 ws0">};</div><div class="t m0 x32 h26 y4391 ff19 fsf fc0 sc0 ls0 ws0">Each <span class="_ _2"></span>implementation <span class="_ _2"></span>includes <span class="_ _2"></span>additional <span class="_ _2"></span>members.<span class="_ _61"> </span>See<span class="_ _47"> </span><span class="ff1a">&lt;sys/ipc.h&gt;<span class="_ _66"> </span></span>on <span class="_ _2"></span>your <span class="_ _3"></span>system</div><div class="t m0 x32 h2a y4392 ff19 fsf fc0 sc0 ls0 ws0">for the complete deﬁnition.</div><div class="t m0 x3f h2a y4393 ff19 fsf fc0 sc0 ls0 ws0">All <span class="_ _9"></span>the <span class="_ _9"></span>ﬁelds <span class="_ _23"></span>ar<span class="lsa1d">ei<span class="_ _b"></span><span class="ls0">nitialized <span class="_ _3"></span>when <span class="_ _23"></span>the <span class="_ _9"></span>IPC <span class="_ _9"></span>structure<span class="_ _45"> </span>is<span class="_ _45"> </span>c<span class="ls45">re</span>ated. <span class="_ _35"> </span>At<span class="_ _45"> </span><span class="ls11ef">al<span class="_ _b"></span><span class="ls0">ater <span class="_ _9"></span>time, <span class="_ _9"></span>we</span></span></span></span></div><div class="t m0 x32 h26 y4394 ff19 fsf fc0 sc0 ls0 ws0">can <span class="_ _3"></span>modify <span class="_ _3"></span>the<span class="_ _45"> </span><span class="ff1a">uid</span>,<span class="_ _47"> </span><span class="ff1a">gid</span><span class="ls11f0">,a<span class="_ _8"></span><span class="ls0">nd<span class="_ _47"> </span><span class="ff1a">mode<span class="_ _45"> </span></span>ﬁelds <span class="_ _3"></span>by <span class="_ _3"></span>calling<span class="_ _45"> </span><span class="ff1a">msgctl</span>,<span class="_ _47"> </span><span class="ff1a">semctl</span><span class="ls11f0">,o<span class="_ _8"></span><span class="ls0">r<span class="_ _47"> </span><span class="ff1a">shmctl</span><span class="ls11f1">.T<span class="_ _7"></span><span class="ls0">o</span></span></span></span></span></span></div><div class="t m0 x32 h2a y4395 ff19 fsf fc0 sc0 ls0 ws0">change <span class="_ _9"></span>these <span class="_ _9"></span>values, <span class="_ _9"></span>the <span class="_ _9"></span>calling <span class="_ _9"></span>process <span class="_ _3"></span>must <span class="_ _9"></span>be <span class="_ _9"></span>either <span class="_ _9"></span>the <span class="_ _9"></span>creator <span class="_ _3"></span>of <span class="_ _9"></span>the <span class="_ _9"></span>IPC <span class="_ _9"></span>structure</div><div class="t m0 x32 h26 y4396 ff19 fsf fc0 sc0 ls0 ws0">or the superuser<span class="_ _6"></span><span class="ls86">.C<span class="_ _4a"></span><span class="ls0">hanging these ﬁelds is similar to calling<span class="_"> </span><span class="ff1a">chown<span class="_ _80"> </span></span>or<span class="_"> </span><span class="ff1a">chmod<span class="_ _66"> </span></span>for a ﬁle.</span></span></div><div class="t m0 x3f h26 y4397 ff19 fsf fc0 sc0 ls0 ws0">The values in <span class="_ _2"></span>the<span class="_"> </span><span class="ff1a">mode<span class="_ _66"> </span></span>ﬁeld ar<span class="ls12d">es<span class="_ _d"></span><span class="ls0">imilar to <span class="_ _2"></span>the values we <span class="_ _2"></span>saw in <span class="_ _2"></span>Figur<span class="ls11f2">e4<span class="_ _4f"></span><span class="ls0">.6, but <span class="_ _2"></span>there</span></span></span></span></div><div class="t m0 x32 h2a y4398 ff19 fsf fc0 sc0 ls0 ws0">is <span class="_ _53"> </span>nothing <span class="_ _53"> </span>corresponding <span class="_ _53"> </span>to <span class="_ _53"> </span>execute <span class="_ _53"> </span>permission <span class="_ _e"> </span>for <span class="_ _53"> </span>any <span class="_ _53"> </span>of <span class="_ _53"> </span>the <span class="_ _e"> </span>IPC <span class="_ _53"> </span>structures. <span class="_ _44"> </span>Also,</div><div class="t m0 x32 h2b y4399 ff19 fsf fc0 sc0 ls0 ws0">message <span class="_ _9"></span>queues <span class="_ _3"></span>and <span class="_ _9"></span>shared <span class="_ _3"></span>memory <span class="_ _9"></span>use <span class="_ _9"></span>the <span class="_ _9"></span>terms<span class="_ _45"> </span><span class="ff1b ls45">re<span class="ls0">ad<span class="_ _45"> </span></span></span>and<span class="_ _47"> </span><span class="ff1b">write</span><span class="ls88">,b<span class="_ _8"></span><span class="ls0">ut <span class="_ _9"></span>semaphores <span class="_ _3"></span>use</span></span></div><div class="t m0 x32 h2b y439a ff19 fsf fc0 sc0 ls0 ws0">the terms<span class="_"> </span><span class="ff1b ls45">re<span class="ls0">ad<span class="_"> </span></span></span>and<span class="_"> </span><span class="ff1b">alter</span><span class="ls86">.F<span class="_ _4a"></span><span class="ls0">igur<span class="ls44">e1<span class="_ _d"></span><span class="ls0">5.24 shows the six permissions for each form of IPC.</span></span></span></span></div><a class="l" href="#pf12" data-dest-detail='[18,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:156.496207px;bottom:694.488916px;width:167.710983px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
