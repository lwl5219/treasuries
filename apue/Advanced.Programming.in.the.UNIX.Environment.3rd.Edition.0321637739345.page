<div id="pf159" class="pf w4 h1f" data-page-no="159"><div class="pc pc159 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg159.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>9.1<span class="_ _1"></span><span class="lsb5f">1F<span class="_ _24a"></span><span class="lse">re<span class="ls0">eBSD <span class="_"> </span>Implementation<span class="_ _1b"> </span><span class="ff18">311</span></span></span></span></div><div class="t m0 x3f h26 y12f ff19 fsf fc0 sc0 ls0 ws0">•<span class="_ _5c"> </span><span class="ff1a">s_leader<span class="_ _66"> </span></span>is a pointer to the<span class="_"> </span><span class="ff1a">proc<span class="_ _80"> </span></span>structure<span class="_"> </span>of<span class="_"> </span>the session leader<span class="_ _6"></span>.</div><div class="t m0 x3f h26 y2849 ff19 fsf fc0 sc0 ls0 ws0">•<span class="_ _5c"> </span><span class="ff1a">s_ttyvp<span class="_ _66"> </span></span>is a pointer to the<span class="_"> </span><span class="ff1a">vnode<span class="_ _80"> </span></span>structure<span class="_"> </span>of<span class="_"> </span>the controlling terminal.</div><div class="t m0 x3f h26 y284a ff19 fsf fc0 sc0 ls0 ws0">•<span class="_ _5c"> </span><span class="ff1a">s_ttyp<span class="_ _66"> </span></span>is a pointer to the<span class="_"> </span><span class="ff1a">tty<span class="_ _80"> </span></span>structure<span class="_"> </span>of<span class="_"> </span>the controlling terminal.</div><div class="t m0 x3f h26 y284b ff19 fsf fc0 sc0 ls0 ws0">•<span class="_ _5c"> </span><span class="ff1a">s_sid<span class="_ _47"> </span></span>is the <span class="_ _2"></span>session <span class="_ _2"></span>ID.<span class="_ _61"> </span>Recall <span class="_ _2"></span>that <span class="_ _2"></span>the <span class="_ _2"></span>concept <span class="_ _2"></span>of <span class="_ _2"></span>a <span class="_ _2"></span>session <span class="_ _2"></span>ID <span class="_ _2"></span>is <span class="_ _2"></span>not <span class="_ _2"></span>part <span class="_ _2"></span>of <span class="_ _2"></span>the</div><div class="t m0 x15 h2a y284c ff19 fsf fc0 sc0 ls0 ws0">Single UNIX Speciﬁcation.</div><div class="t m0 x3f h26 y284d ff19 fsf fc0 sc0 ls0 ws0">When<span class="_ _35"> </span><span class="ff1a">setsid<span class="_ _44"> </span></span>is <span class="_ _42"> </span>called, <span class="_ _42"> </span>a <span class="_ _23"> </span>new<span class="_ _44"> </span><span class="ff1a">session<span class="_ _35"> </span></span>structur<span class="lsaf2">ei<span class="_ _43"></span><span class="lsb60">sa<span class="_ _43"></span><span class="ls0">llocated <span class="_ _23"> </span>within <span class="_ _42"> </span>the <span class="_ _42"> </span>kernel.</span></span></span></div><div class="t m0 x32 h26 y284e ff19 fsf fc0 sc0 ls0 ws0">Now<span class="_ _47"> </span><span class="ff1a">s_count<span class="_ _47"> </span></span>is <span class="_ _3"></span>set <span class="_ _3"></span>to <span class="_ _9"></span>1,<span class="_ _47"> </span><span class="ff1a">s_leader<span class="_ _47"> </span></span>is <span class="_ _3"></span>set <span class="_ _3"></span>to <span class="_ _3"></span>point <span class="_ _9"></span>to <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">proc<span class="_ _47"> </span></span>structure<span class="_ _47"> </span>of<span class="_ _47"> </span>the <span class="_ _3"></span>calling</div><div class="t m0 x32 h26 y1f0e ff19 fsf fc0 sc0 ls0 ws0">process,<span class="_ _4b"> </span><span class="ff1a">s_sid<span class="_ _59"> </span></span>is <span class="_"> </span>set <span class="_ _e"> </span>to <span class="_"> </span>the <span class="_"> </span>pr<span class="_ _1"></span>ocess <span class="_"> </span>ID, <span class="_"> </span>and<span class="_ _4b"> </span><span class="ff1a">s_ttyvp<span class="_ _59"> </span></span>and<span class="_ _59"> </span><span class="ff1a">s_ttyp<span class="_ _59"> </span></span>ar<span class="lsb61">es<span class="_ _4a"></span><span class="ls0">et <span class="_"> </span>to <span class="_ _e"> </span>null</span></span></div><div class="t m0 x32 h2a y284f ff19 fsf fc0 sc0 ls0 ws0">pointers, since the new session doesn’t have a controlling terminal.</div><div class="t m0 x3f h26 y2850 ff19 fsf fc0 sc0 ls0 ws0">Let’s <span class="_ _42"> </span>move <span class="_ _53"> </span>to <span class="_ _53"> </span>the<span class="_ _44"> </span><span class="ff1a">tty<span class="_ _44"> </span></span>structure. <span class="_ _44"> </span>The<span class="_ _44"> </span>kernel <span class="_ _42"> </span>contains <span class="_ _53"> </span>one <span class="_ _53"> </span>of <span class="_ _42"> </span>these <span class="_ _53"> </span>structures <span class="_ _42"> </span>for</div><div class="t m0 x32 h2a y2851 ff19 fsf fc0 sc0 ls0 ws0">each <span class="_ _42"> </span>terminal <span class="_ _42"> </span>device <span class="_ _42"> </span>and <span class="_ _42"> </span>each <span class="_ _42"> </span>pseudo <span class="_ _42"> </span>terminal <span class="_ _42"> </span>device.<span class="_ _51"> </span>(W<span class="_ _6"></span><span class="lsb62">et<span class="_ _43"></span><span class="ls0">alk <span class="_ _42"> </span>mor<span class="lsb63">ea<span class="_ _c"></span><span class="ls0">bout <span class="_ _42"> </span>pseudo</span></span></span></span></div><div class="t m0 x32 h2a y34b ff19 fsf fc0 sc0 ls0 ws0">terminals in Chapter 19.)</div><div class="t m0 x3f h26 y2852 ff19 fsf fc0 sc0 ls0 ws0">•<span class="_ _5c"> </span><span class="ff1a">t_session<span class="_"> </span></span>points <span class="_ _45"> </span>to <span class="_ _45"> </span>the<span class="_ _51"> </span><span class="ff1a">session<span class="_"> </span></span>structur<span class="_ _1"></span><span class="lsb64">et<span class="_ _62"></span><span class="ls0">hat <span class="_ _45"> </span>has <span class="_ _45"> </span>this <span class="_ _45"> </span>terminal <span class="_ _35"> </span>as <span class="_ _45"> </span>its</span></span></div><div class="t m0 x15 h26 y1f11 ff19 fsf fc0 sc0 ls0 ws0">controlling <span class="_ _45"> </span>terminal.<span class="_ _1a3"> </span>(Note <span class="_ _45"> </span>that <span class="_ _35"> </span>the<span class="_ _5a"> </span><span class="ff1a">tty<span class="_"> </span></span>structur<span class="_ _0"></span><span class="lsb65">ep<span class="_ _26"></span><span class="ls0">oints <span class="_ _45"> </span>to <span class="_ _35"> </span>the<span class="_ _5a"> </span><span class="ff1a">session</span></span></span></div><div class="t m0 x15 h2a y2853 ff19 fsf fc0 sc0 ls0 ws0">structur<span class="_ _0"></span>e, <span class="_ _9"></span>and <span class="_ _3"></span>vice <span class="_ _9"></span>versa.)<span class="_ _5a"> </span>This <span class="_ _9"></span>pointer <span class="_ _9"></span>is <span class="_ _3"></span>used <span class="_ _9"></span>by <span class="_ _9"></span>the <span class="_ _9"></span>terminal <span class="_ _9"></span>to <span class="_ _3"></span>send <span class="_ _9"></span>a <span class="_ _9"></span>hang-</div><div class="t m0 x15 h2a y2854 ff19 fsf fc0 sc0 ls0 ws0">up signal to the session leader if the terminal loses carrier (Figur<span class="ls44">e9<span class="_ _4f"></span><span class="ls0">.7).</span></span></div><div class="t m0 x3f h26 y15ed ff19 fsf fc0 sc0 ls0 ws0">•<span class="_ _5c"> </span><span class="ff1a">t_pgrp<span class="_ _66"> </span></span>points to the<span class="_ _66"> </span><span class="ff1a">pgrp<span class="_ _66"> </span></span>structur<span class="lsb66">eo<span class="_ _4f"></span><span class="lsae7">ft<span class="_ _d"></span><span class="ls0">he foreground pr<span class="_ _0"></span>ocess group. <span class="_"> </span>This<span class="_"> </span>ﬁeld</span></span></span></div><div class="t m0 x15 h2a y15ee ff19 fsf fc0 sc0 ls0 ws0">is <span class="_ _9"></span>used <span class="_ _9"></span>by <span class="_ _9"></span>the <span class="_ _9"></span>terminal <span class="_ _9"></span>driver <span class="_ _9"></span>to <span class="_ _9"></span>send <span class="_ _9"></span>signals <span class="_ _9"></span>to <span class="_ _9"></span>the <span class="_ _23"></span>for<span class="_ _0"></span>eground <span class="_ _3"></span>process <span class="_ _9"></span>group.</div><div class="t m0 x15 h2a y2245 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _23"></span>three <span class="_ _9"></span>signals <span class="_ _23"> </span>generated <span class="_ _23"> </span>by <span class="_ _23"> </span>entering <span class="_ _23"> </span>special <span class="_ _23"> </span>characters <span class="_ _23"> </span>(interrupt, <span class="_ _23"> </span>quit, <span class="_ _23"> </span>and</div><div class="t m0 x15 h2a y2855 ff19 fsf fc0 sc0 ls0 ws0">suspend) ar<span class="ls44">es<span class="_ _4f"></span><span class="ls0">ent to the foreground pr<span class="_ _0"></span>ocess gr<span class="_ _0"></span>oup.</span></span></div><div class="t m0 x3f h26 y2856 ff19 fsf fc0 sc0 ls0 ws0">•<span class="_ _5c"> </span><span class="ff1a">t_termios<span class="_"> </span></span>is <span class="_ _47"> </span>a <span class="_ _45"> </span>structur<span class="_ _1"></span><span class="lsb67">ec<span class="_ _1d"></span><span class="ls0">ontaining <span class="_ _45"> </span>all <span class="_ _47"> </span>the <span class="_ _45"> </span>special <span class="_ _47"> </span>characters <span class="_ _47"> </span>and <span class="_ _45"> </span>related</span></span></div><div class="t m0 x15 h2a y14b5 ff19 fsf fc0 sc0 ls0 ws0">information for <span class="_ _2"></span>this <span class="_ _2"></span>terminal, such <span class="_ _2"></span>as <span class="_ _2"></span>baud <span class="_ _2"></span>rate, whether <span class="_ _2"></span>echo <span class="_ _2"></span>is enabled, <span class="_ _2"></span>and <span class="_ _2"></span>so</div><div class="t m0 x15 h2a y2857 ff19 fsf fc0 sc0 ls0 ws0">on. <span class="_"> </span>W<span class="_ _6"></span>e’ll return to this str<span class="_ _0"></span>ucture<span class="_"> </span>in<span class="_"> </span>Chapter 18.</div><div class="t m0 x3f h26 y2858 ff19 fsf fc0 sc0 ls0 ws0">•<span class="_ _5c"> </span><span class="ff1a">t_winsize<span class="_ _66"> </span></span>is <span class="_ _2"></span>a<span class="_ _66"> </span><span class="ff1a">winsize<span class="_ _66"> </span></span>structur<span class="lsb68">et<span class="_ _4f"></span><span class="ls0">hat contains <span class="_ _2"></span>the <span class="_ _2"></span>current size of <span class="_ _2"></span>the terminal</span></span></div><div class="t m0 x15 h26 y2859 ff19 fsf fc0 sc0 ls0 ws0">window<span class="_ _6"></span><span class="lsb69">.W<span class="_ _62"></span><span class="ls0">hen <span class="_ _9"></span>the <span class="_ _3"></span>size <span class="_ _9"></span>of <span class="_ _3"></span>the <span class="_ _9"></span>terminal <span class="_ _3"></span>window <span class="_ _9"></span>changes, <span class="_ _9"></span>the<span class="_ _47"> </span><span class="ff1a">SIGWINCH<span class="_ _45"> </span></span>signal</span></span></div><div class="t m0 x15 h2a y285a ff19 fsf fc0 sc0 ls0 ws0">is <span class="_ _53"> </span>sent <span class="_"> </span>to <span class="_ _53"> </span>the <span class="_ _53"> </span>foreground <span class="_ _53"> </span>process <span class="_ _53"> </span>group. <span class="_ _4b"> </span>W<span class="_ _6"></span><span class="lsb6a">es<span class="_ _55"></span><span class="ls0">how <span class="_ _e"> </span>how <span class="_ _e"> </span>to <span class="_ _e"> </span>set <span class="_ _e"> </span>and <span class="_ _e"> </span>fetch <span class="_ _e"> </span>the</span></span></div><div class="t m0 x15 h2a y285b ff19 fsf fc0 sc0 ls0 ws0">terminal’s current window size in Section 18.12.</div><div class="t m0 x32 h2a y16d ff19 fsf fc0 sc0 ls5f ws0">To <span class="_ _53"> </span>ﬁ<span class="_ _23"></span><span class="ls0">nd the <span class="_ _2"></span>foreground process group of a <span class="_ _2"></span>particular <span class="_ _2"></span>session, <span class="_ _2"></span>the <span class="_ _2"></span>kernel has <span class="_ _2"></span>to <span class="_ _2"></span>start <span class="_ _2"></span>with</span></div><div class="t m0 x32 h26 y25c ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _9"></span>session <span class="_ _9"></span>structur<span class="_ _0"></span>e, <span class="_ _9"></span>follow<span class="_ _45"> </span><span class="ff1a">s_ttyp<span class="_ _45"> </span></span>to <span class="_ _3"></span>get <span class="_ _9"></span>to <span class="_ _9"></span>the <span class="_ _9"></span>controlling <span class="_ _9"></span>terminal’s<span class="_ _45"> </span><span class="ff1a">tty<span class="_ _47"> </span></span>structure,</div><div class="t m0 x32 h26 y25d ff19 fsf fc0 sc0 ls0 ws0">and <span class="_ _3"></span>then <span class="_ _9"></span>follow<span class="_ _45"> </span><span class="ff1a">t_pgrp<span class="_ _47"> </span></span>to <span class="_ _9"></span>get <span class="_ _3"></span>to <span class="_ _9"></span>the <span class="_ _3"></span>foreground <span class="_ _3"></span>process <span class="_ _3"></span>group’s<span class="_ _47"> </span><span class="ff1a">pgrp<span class="_ _45"> </span></span>structur<span class="_ _1"></span>e. <span class="_ _45"> </span>The</div><div class="t m0 x32 h26 y1805 ff1a fsf fc0 sc0 ls0 ws0">pgrp<span class="_ _80"> </span><span class="ff19">structur<span class="ls44">ec<span class="_ _4f"></span><span class="ls0">ontains the information for a particular process group.</span></span></span></div><div class="t m0 x3f h26 y1de ff19 fsf fc0 sc0 ls0 ws0">•<span class="_ _5c"> </span><span class="ff1a">pg_id<span class="_ _66"> </span></span>is the process gr<span class="_ _0"></span>oup ID.</div><div class="t m0 x3f h26 y285c ff19 fsf fc0 sc0 ls0 ws0">•<span class="_ _5c"> </span><span class="ff1a">pg_session<span class="_ _46"> </span></span>points <span class="_"> </span>to <span class="_"> </span>the<span class="_ _59"> </span><span class="ff1a">session<span class="_ _46"> </span></span>structur<span class="lsb6b">ef<span class="_ _5b"></span><span class="ls0">or <span class="_"> </span>the <span class="_"> </span>session <span class="_"> </span>to <span class="_"> </span>which <span class="_"> </span>this</span></span></div><div class="t m0 x15 h2a y33d ff19 fsf fc0 sc0 ls0 ws0">process gr<span class="_ _0"></span>oup belongs.</div><div class="t m0 x3f h26 y1da4 ff19 fsf fc0 sc0 ls0 ws0">•<span class="_ _5c"> </span><span class="ff1a">pg_members<span class="_ _45"> </span></span>is <span class="_ _2"></span>a <span class="_ _9"></span>pointer <span class="_ _3"></span>to <span class="_ _3"></span>the <span class="_ _3"></span>list <span class="_ _3"></span>of<span class="_ _45"> </span><span class="ff1a">proc<span class="_ _47"> </span></span>structur<span class="_ _0"></span>es <span class="_ _3"></span>that <span class="_ _3"></span>ar<span class="lsb6c">em<span class="_ _8"></span><span class="ls0">embers <span class="_ _3"></span>of <span class="_ _3"></span>this</span></span></div><div class="t m0 x15 h26 y1da5 ff19 fsf fc0 sc0 ls0 ws0">process <span class="_"> </span>gr<span class="_ _1"></span>oup. <span class="_ _46"> </span>The<span class="_ _46"> </span><span class="ff1a">p_pglist<span class="_ _59"> </span></span>structur<span class="ls891">ei<span class="_ _5b"></span><span class="lsb6d">nt<span class="_ _55"></span><span class="ls0">hat<span class="_ _59"> </span><span class="ff1a">proc<span class="_ _46"> </span></span>structur<span class="_ _0"></span>e<span class="_ _59"> </span>is<span class="_ _46"> </span>a<span class="_ _59"> </span>doubly</span></span></span></div><div class="t m0 x15 h2a y285d ff19 fsf fc0 sc0 ls0 ws0">linked <span class="_ _2"></span>list <span class="_ _3"></span>entry <span class="_ _3"></span>that <span class="_ _2"></span>points <span class="_ _3"></span>to <span class="_ _3"></span>both <span class="_ _2"></span>the <span class="_ _3"></span>next <span class="_ _3"></span>process <span class="_ _2"></span>and <span class="_ _3"></span>the <span class="_ _2"></span>previous <span class="_ _2"></span>process <span class="_ _2"></span>in</div><div class="t m0 x15 h26 y285e ff19 fsf fc0 sc0 ls0 ws0">the group, and <span class="_ _2"></span>so <span class="_ _2"></span>on, until <span class="_ _2"></span>a <span class="_ _2"></span>null <span class="_ _2"></span>pointer is <span class="_ _2"></span>encountered in <span class="_ _2"></span>the<span class="_ _66"> </span><span class="ff1a">proc<span class="_ _66"> </span></span>structur<span class="lsb6e">eo<span class="_ _4f"></span><span class="ls0">f</span></span></div><div class="t m0 x15 h2a y285f ff19 fsf fc0 sc0 ls0 ws0">the last process in the gr<span class="_ _0"></span>oup.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
