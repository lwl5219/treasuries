<div id="pf3b8" class="pf w4 h1f" data-page-no="3b8"><div class="pc pc3b8 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg3b8.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">918<span class="_ _1b"> </span><span class="ff19">Solutions <span class="_"> </span>to <span class="_"> </span>Selected <span class="_"> </span>Exercises <span class="_ _2eb"> </span>Appendix<span class="_ _4b"> </span>C</span></div><div class="t m0 x35 h27 y12f ff16 fsf fc0 sc0 ls0 ws0">Chapter <span class="_"> </span>6</div><div class="t m0 x32 h2a y60b0 ff18 fsf fc0 sc0 ls0 ws0">6.1<span class="_ _9b"> </span><span class="ff19">The <span class="_ _66"> </span>functions <span class="_ _45"> </span>to <span class="_ _47"> </span>access <span class="_ _47"> </span>the <span class="_ _47"> </span>shadow <span class="_ _47"> </span>passwor<span class="ls1820">dﬁ<span class="_ _62"></span><span class="ls0">le <span class="_ _45"> </span>on <span class="_ _47"> </span>Linux <span class="_ _47"> </span>and <span class="_ _47"> </span>Solaris <span class="_ _47"> </span>are</span></span></span></div><div class="t m0 x215 h26 y60b1 ff19 fsf fc0 sc0 ls0 ws0">discussed <span class="_ _3"></span>in <span class="_ _2"></span>Section <span class="_ _3"></span>6.3.<span class="_ _16"> </span><span class="ls5f">We <span class="_ _80"> </span>c<span class="_ _23"></span></span>an’t <span class="_ _2"></span>use <span class="_ _3"></span>the <span class="_ _3"></span>value <span class="_ _3"></span>returned <span class="_ _2"></span>in <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">pw_passwd<span class="_ _45"> </span></span>ﬁeld</div><div class="t m0 x215 h2a y60b2 ff19 fsf fc0 sc0 ls0 ws0">by the functions <span class="_ _2"></span>described in Section <span class="_ _2"></span>6.2 to <span class="_ _2"></span>compare<span class="_"> </span>an<span class="_"> </span>encrypted password, since</div><div class="t m0 x215 h2a y20eb ff19 fsf fc0 sc0 ls0 ws0">that ﬁeld <span class="_ _2"></span>is <span class="_ _2"></span>not <span class="_ _2"></span>the encrypted <span class="_ _2"></span>password. <span class="_"> </span>Instead,<span class="_ _47"> </span>we need <span class="_ _2"></span>to ﬁnd <span class="_ _2"></span>the <span class="_ _2"></span>user<span class="_ _9"></span>’s entry</div><div class="t m0 x215 h2a y20ec ff19 fsf fc0 sc0 ls0 ws0">in the shadow ﬁle and use its encrypted passwor<span class="ls44">dﬁ<span class="_ _4f"></span><span class="ls0">eld.</span></span></div><div class="t m0 x215 h2a y3fcf ff19 fsf fc0 sc0 ls0 ws0">On <span class="_ _9"></span>FreeBSD <span class="_ _3"></span>and <span class="_ _9"></span>Mac <span class="_ _9"></span>OS <span class="_ _9"></span>X, <span class="_ _3"></span>the <span class="_ _9"></span>passwor<span class="ls4f9">dﬁ<span class="_ _b"></span><span class="ls0">le <span class="_ _9"></span>is <span class="_ _9"></span>shadowed <span class="_ _9"></span>automatically<span class="_ _4"></span><span class="ls1821">.I<span class="_ _62"></span><span class="ls4f9">nt<span class="_ _8"></span><span class="ls0">he</span></span></span></span></span></div><div class="t m0 x215 h26 y3fd0 ff1a fsf fc0 sc0 ls0 ws0">passwd<span class="_ _59"> </span><span class="ff19">structur<span class="_ _0"></span><span class="ls1822">er<span class="_ _4a"></span><span class="ls0">eturned <span class="_"> </span>by<span class="_ _4b"> </span><span class="ff1a">getpwnam<span class="_ _59"> </span></span>and<span class="_ _59"> </span><span class="ff1a">getpwuid<span class="_ _59"> </span></span>on <span class="_"> </span>Fr<span class="_ _1"></span>eeBSD <span class="_"> </span>8.0, <span class="_ _e"> </span>the</span></span></span></div><div class="t m0 x215 h26 y39a7 ff1a fsf fc0 sc0 ls0 ws0">pw_passwd<span class="_"> </span><span class="ff19">ﬁeld <span class="_ _35"> </span>contains <span class="_ _35"> </span>the <span class="_ _35"> </span>encrypted <span class="_ _35"> </span>password, <span class="_ _45"> </span>but <span class="_ _35"> </span>only <span class="_ _35"> </span>if <span class="_ _35"> </span>the <span class="_ _35"> </span>caller<span class="_ _3"></span>’s</span></div><div class="t m0 x215 h2a y158 ff19 fsf fc0 sc0 ls0 ws0">effective <span class="_ _66"> </span>user <span class="_ _47"> </span>ID <span class="_ _47"> </span>is <span class="_ _47"> </span>0.<span class="_ _50"> </span>On <span class="_ _47"> </span>Mac <span class="_ _47"> </span>OS <span class="_ _47"> </span>X <span class="_ _47"> </span>10.6.8, <span class="_ _47"> </span>the <span class="_ _47"> </span>encrypted <span class="_ _66"> </span>password<span class="_ _61"> </span>is<span class="_ _16"> </span>not</div><div class="t m0 x215 h2a y39a8 ff19 fsf fc0 sc0 ls0 ws0">accessible using these interfaces.</div><div class="t m0 x32 h2a yd82 ff18 fsf fc0 sc0 ls0 ws0">6.2<span class="_ _9b"> </span><span class="ff19">The <span class="_ _53"> </span>program <span class="_ _53"> </span>in <span class="_ _e"> </span>Figur<span class="ls98b">eC<span class="_ _55"></span><span class="ls0">.5 <span class="_ _53"> </span>prints <span class="_"> </span>the <span class="_ _53"> </span>encrypted <span class="_ _53"> </span>password<span class="_ _4b"> </span>on<span class="_ _4b"> </span>Linux <span class="_"> </span>3.2.0 <span class="_ _53"> </span>and</span></span></span></div><div class="t m0 x215 h2a yd83 ff19 fsf fc0 sc0 ls0 ws0">Solaris <span class="_ _53"> </span>10.<span class="_ _48"> </span>Unless <span class="_ _53"> </span>this <span class="_ _e"> </span>program <span class="_ _53"> </span>is <span class="_ _e"> </span>run <span class="_ _53"> </span>with <span class="_ _e"> </span>superuser <span class="_ _53"> </span>permissions, <span class="_ _e"> </span>the <span class="_ _e"> </span>call <span class="_ _53"> </span>to</div><div class="t m0 x215 h26 yd84 ff1a fsf fc0 sc0 ls0 ws0">getspnam<span class="_ _80"> </span><span class="ff19">fails with an error of<span class="_"> </span></span>EACCES<span class="ff19">.</span></div><div class="t m0 x215 h4e y60b3 ff1a fs28 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x215 h4e y60b4 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;shadow.h&gt;</div><div class="t m0 x215 h4e y60b5 ff1a fs28 fc0 sc0 ls0 ws0">int</div><div class="t m0 x215 h4e y60b6 ff1a fs28 fc0 sc0 ls0 ws0">main(void) <span class="_ _8a"> </span>/*<span class="_"> </span>Linux/Solaris version */</div><div class="t m0 x215 h4e y60b7 ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 xc4 h4e y60b8 ff1a fs28 fc0 sc0 ls0 ws0">struct spwd *ptr;</div><div class="t m0 xc4 h4e y60b9 ff1a fs28 fc0 sc0 ls0 ws0">if ((ptr = getspnam(&quot;sar&quot;)) == NULL)</div><div class="t m0 x206 h4e y60ba ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;getspnam error&quot;);</div><div class="t m0 xc4 h4e y60bb ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;sp_pwdp = %s\n&quot;, ptr-&gt;sp_pwdp == NULL ||</div><div class="t m0 x1b0 h4e y60bc ff1a fs28 fc0 sc0 ls0 ws0">ptr-&gt;sp_pwdp[0] == 0 ?<span class="_ _d9"> </span>&quot;(null)&quot; : ptr-&gt;sp_pwdp);</div><div class="t m0 xc4 h4e y60bd ff1a fs28 fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x215 h4e y60be ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x30 h2e y60bf ff18 fs11 fc0 sc0 ls0 ws0">Figure C.5<span class="_ _5a"> </span><span class="ff19">Print encrypted passwor<span class="lsdb">du<span class="_ _84"></span><span class="ls0">nder Linux and Solaris</span></span></span></div><div class="t m0 x215 h55 y60c0 ff19 fs2c fc0 sc0 ls0 ws0">Under <span class="_ _23"></span>FreeBSD <span class="_ _9"></span>8.0, <span class="_ _23"> </span>the <span class="_ _23"></span>program <span class="_ _9"></span>in <span class="_ _23"> </span>Figur<span class="ls1823">eC<span class="_ _43"></span><span class="ls0">.6 <span class="_ _23"> </span>prints <span class="_ _23"> </span>the <span class="_ _23"> </span>encrypted <span class="_ _23"></span>passwor<span class="ls9d8">di<span class="_ _43"></span><span class="ls0">f</span></span></span></span></div><div class="t m0 x215 h55 y60c1 ff19 fs2c fc0 sc0 ls0 ws0">the <span class="_ _2"></span>program <span class="_ _2"></span>is <span class="_ _3"></span>run <span class="_ _2"></span>with <span class="_ _2"></span>superuser <span class="_ _3"></span>permissions.<span class="_ _61"> </span>Otherwise, <span class="_ _3"></span>the <span class="_ _2"></span>value <span class="_ _3"></span>returned in</div><div class="t m0 x215 h54 y60c2 ff1a fs2c fc0 sc0 ls0 ws0">pw_passwd<span class="_ _66"> </span><span class="ff19">is an <span class="_ _2"></span>asterisk.<span class="_ _46"> </span>On <span class="_ _2"></span>Mac OS <span class="_ _2"></span>X <span class="_ _2"></span>10.6.8, asterisks <span class="_ _2"></span>ar<span class="ls1824">ep<span class="_ _4f"></span><span class="ls0">rinted <span class="_ _2"></span>regar<span class="_ _0"></span>dless of</span></span></span></div><div class="t m0 x215 h55 y60c3 ff19 fs2c fc0 sc0 ls0 ws0">the permissions with which it is run.</div><div class="t m0 x215 h62 y60c4 ff1a fs30 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x215 h62 y60c5 ff1a fs30 fc0 sc0 ls0 ws0">#include &lt;pwd.h&gt;</div><div class="t m0 x215 h62 y60c6 ff1a fs30 fc0 sc0 ls0 ws0">int</div><div class="t m0 x215 h62 y60c7 ff1a fs30 fc0 sc0 ls0 ws0">main(void) <span class="_ _8a"> </span>/*<span class="_"> </span>FreeBSD/Mac OS X version */</div><div class="t m0 x215 h62 y60c8 ff1a fs30 fc0 sc0 ls0 ws0">{</div><div class="t m0 xc4 h62 y60c9 ff1a fs30 fc0 sc0 ls0 ws0">struct passwd<span class="_ _68"> </span>*ptr;</div><div class="t m0 xc4 h62 y60ca ff1a fs30 fc0 sc0 ls0 ws0">if ((ptr = getpwnam(&quot;sar&quot;)) == NULL)</div><div class="t m0 x206 h62 y60cb ff1a fs30 fc0 sc0 ls0 ws0">err_sys(&quot;getpwnam error&quot;);</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
