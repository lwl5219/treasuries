<div id="pf3ba" class="pf w4 h1f" data-page-no="3ba"><div class="pc pc3ba w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg3ba.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">920<span class="_ _1b"> </span><span class="ff19">Solutions <span class="_"> </span>to <span class="_"> </span>Selected <span class="_"> </span>Exercises <span class="_ _2eb"> </span>Appendix<span class="_ _4b"> </span>C</span></div><div class="t m0 x32 h2a y12f ff18 fsf fc0 sc0 ls0 ws0">7.2<span class="_ _9b"> </span><span class="ff19">When the pr<span class="_ _0"></span>ogram is run interactively<span class="_ _4"></span><span class="ls1829">,s<span class="_ _d"></span><span class="ls0">tandar<span class="ls182a">do<span class="_ _d"></span><span class="ls0">utput is usually line buffered, so</span></span></span></span></span></div><div class="t m0 x215 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _23"></span>actual <span class="_ _23"></span>output <span class="_ _23"> </span>occurs <span class="_ _23"> </span>when <span class="_ _23"> </span>each <span class="_ _23"> </span>newline <span class="_ _23"> </span>is <span class="_ _42"> </span>output.<span class="_ _51"> </span>If <span class="_ _23"></span>standar<span class="_ _0"></span><span class="ls130">do<span class="_ _43"></span><span class="ls0">utput <span class="_ _23"> </span>were</span></span></div><div class="t m0 x215 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">directed <span class="_ _42"> </span>to <span class="_ _42"> </span>a <span class="_ _42"> </span>ﬁle, <span class="_ _53"> </span>however<span class="_ _6"></span>,<span class="_ _44"> </span>it<span class="_ _44"> </span>would <span class="_ _53"> </span>probably <span class="_ _42"> </span>be <span class="_ _42"> </span>fully <span class="_ _42"> </span>buffered, <span class="_ _42"> </span>and <span class="_ _42"> </span>the <span class="_ _42"> </span>actual</div><div class="t m0 x215 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">output wouldn’t occur until the standar<span class="ls44">dI<span class="_ _4f"></span><span class="ls0">/O cleanup is performed.</span></span></div><div class="t m0 x32 h26 y2936 ff18 fsf fc0 sc0 ls0 ws0">7.3<span class="_ _9b"> </span><span class="ff19">On most <span class="_ _2"></span>UNIX <span class="_ _3"></span>systems, <span class="_ _2"></span>there<span class="_ _66"> </span>is<span class="_ _47"> </span>no<span class="_ _66"> </span>way <span class="_ _3"></span>to <span class="_ _2"></span>do <span class="_ _2"></span>this.<span class="_ _16"> </span>Copies <span class="_ _2"></span>of<span class="_ _47"> </span><span class="ff1a">argc<span class="_ _66"> </span></span>and<span class="_ _47"> </span><span class="ff1a">argv<span class="_ _66"> </span></span>are</span></div><div class="t m0 x215 h26 y2914 ff19 fsf fc0 sc0 ls0 ws0">not kept in global variables like<span class="_"> </span><span class="ff1a">environ<span class="_ _80"> </span></span>is.</div><div class="t m0 x32 h2a y296d ff18 fsf fc0 sc0 ls0 ws0">7.4<span class="_ _9b"> </span><span class="ff19">This <span class="_ _9"></span>provides <span class="_ _23"></span>a <span class="_ _9"></span>way <span class="_ _23"> </span>to <span class="_ _23"> </span>terminate <span class="_ _23"> </span>the <span class="_ _23"></span>process <span class="_ _9"></span>when <span class="_ _23"> </span>it <span class="_ _23"> </span>tries <span class="_ _23"> </span>to <span class="_ _23"></span>derefer<span class="_ _0"></span>ence <span class="_ _23"></span>a <span class="_ _9"></span>null</span></div><div class="t m0 x215 h2a y1151 ff19 fsf fc0 sc0 ls0 ws0">pointer<span class="_ _6"></span><span class="ls44">,ac<span class="_ _5"></span><span class="ls0">ommon C programming err<span class="_ _1"></span>or<span class="_ _1"></span>.</span></span></div><div class="t m0 x32 h2a y1d2 ff18 fsf fc0 sc0 ls0 ws0">7.5<span class="_ _9b"> </span><span class="ff19">The deﬁnitions ar<span class="_ _1"></span>e</span></div><div class="t m0 x1a7 h57 y60ee ff1a fs2d fc0 sc0 ls0 ws0">typedef void<span class="_ _15"> </span>Exitfunc(void);</div><div class="t m0 x1a7 h57 y60ef ff1a fs2d fc0 sc0 ls0 ws0">int atexit(Exitfunc *<span class="ff1b">func</span>);</div><div class="t m0 x32 h26 y60f0 ff18 fsf fc0 sc0 ls0 ws0">7.6<span class="_ _9b"> </span><span class="ff1a">calloc<span class="_ _35"> </span><span class="ff19">initializes <span class="_ _23"></span>the <span class="_ _23"> </span>memory <span class="_ _42"> </span>that <span class="_ _42"> </span>it <span class="_ _23"> </span>allocates <span class="_ _42"> </span>to <span class="_ _23"> </span>all <span class="_ _42"> </span>zer<span class="ls5c9">ob<span class="_ _c"></span><span class="ls0">its. <span class="_ _44"> </span>ISO<span class="_ _35"> </span><span class="ls5c9">Cd<span class="_ _43"></span><span class="ls0">oes <span class="_ _42"> </span>not</span></span></span></span></span></span></div><div class="t m0 x215 h2a y60f1 ff19 fsf fc0 sc0 ls0 ws0">guarantee that this is the same as either a ﬂoating-point 0 or a null pointer<span class="_ _6"></span>.</div><div class="t m0 x32 h2a y60f2 ff18 fsf fc0 sc0 ls0 ws0">7.7<span class="_ _9b"> </span><span class="ff19">The <span class="_ _2"></span>heap <span class="_ _3"></span>and <span class="_ _3"></span>the <span class="_ _9"></span>stack <span class="_ _3"></span>aren’t <span class="_ _2"></span>allocated <span class="_ _3"></span>until <span class="_ _3"></span>a <span class="_ _9"></span>program <span class="_ _2"></span>is <span class="_ _3"></span>executed <span class="_ _3"></span>by <span class="_ _9"></span>one <span class="_ _3"></span>of <span class="_ _3"></span>the</span></div><div class="t m0 x215 h26 y60f3 ff1a fsf fc0 sc0 ls0 ws0">exec<span class="_ _80"> </span><span class="ff19">functions (described in Section 8.10).</span></div><div class="t m0 x32 h26 y60f4 ff18 fsf fc0 sc0 ls0 ws0">7.8<span class="_ _9b"> </span><span class="ff19">The executable <span class="_ _3"></span>ﬁle <span class="_ _2"></span>(<span class="ff1a">a.out</span><span class="lsaf6">)c<span class="_ _4f"></span><span class="ls0">ontains <span class="_ _2"></span>symbol <span class="_ _3"></span>table <span class="_ _2"></span>information <span class="_ _3"></span>that <span class="_ _2"></span>can <span class="_ _3"></span>be <span class="_ _2"></span>helpful</span></span></span></div><div class="t m0 x215 h26 y60f5 ff19 fsf fc0 sc0 ls0 ws0">in <span class="_ _44"> </span>debugging <span class="_ _44"> </span>a<span class="_ _54"> </span><span class="ff1a">core<span class="_ _54"> </span></span>ﬁle. <span class="_ _65"> </span>T<span class="_ _6"></span><span class="lsafe">or<span class="_ _52"></span><span class="ls0">emove <span class="_ _35"> </span>this <span class="_ _4b"> </span>information, <span class="_ _44"> </span>use <span class="_ _44"> </span>the<span class="_ _54"> </span><span class="ff1a">strip</span></span></span></div><div class="t m0 x40 h2a y60f6 ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 x1b2 h2a y60f5 ff19 fsf fc0 sc0 ls0 ws0">1</div><div class="t m0 x17e h2a y60f6 ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 x215 h26 y60f7 ff19 fsf fc0 sc0 ls0 ws0">command. <span class="_ _45"> </span>Stripping<span class="_ _45"> </span>the <span class="_ _9"></span>two<span class="_ _35"> </span><span class="ff1a">a.out<span class="_ _45"> </span></span>ﬁles <span class="_ _9"></span>reduces <span class="_ _9"></span>their <span class="_ _9"></span>size <span class="_ _9"></span>to <span class="_ _23"></span>798,760 <span class="_ _9"></span>and <span class="_ _9"></span>6,200</div><div class="t m0 x215 h2a y60f8 ff19 fsf fc0 sc0 ls0 ws0">bytes.</div><div class="t m0 x32 h2a y60f9 ff18 fsf fc0 sc0 ls0 ws0">7.9<span class="_ _9b"> </span><span class="ff19">When <span class="_"> </span>shared <span class="_ _66"> </span>libraries <span class="_ _47"> </span>ar<span class="ls79e">en<span class="_ _1d"></span><span class="ls0">ot <span class="_ _47"> </span>used, <span class="_ _66"> </span>a <span class="_ _47"> </span>large <span class="_"> </span>portion <span class="_ _47"> </span>of <span class="_ _47"> </span>the <span class="_ _66"> </span>executable <span class="_ _47"> </span>ﬁle <span class="_ _66"> </span>is</span></span></span></div><div class="t m0 x215 h2a y60fa ff19 fsf fc0 sc0 ls0 ws0">occupied by the standar<span class="ls44">dI<span class="_ _4f"></span><span class="ls0">/O library<span class="_ _6"></span>.</span></span></div><div class="t m0 x32 h26 y60fb ff18 fsf fc0 sc0 ls0 ws0">7.10<span class="_ _1a3"> </span><span class="ff19">The <span class="_"> </span>code <span class="_ _e"> </span>is <span class="_"> </span>incorr<span class="_ _0"></span>ect, <span class="_"> </span>since <span class="_ _e"> </span>it <span class="_"> </span>r<span class="_ _1"></span>eferences <span class="_"> </span>the <span class="_ _e"> </span>automatic <span class="_"> </span>integer<span class="_ _4b"> </span><span class="ff1a">val<span class="_ _59"> </span></span>through <span class="_ _e"> </span>a</span></div><div class="t m0 x215 h2a y60fc ff19 fsf fc0 sc0 ls0 ws0">pointer after <span class="_ _2"></span>the <span class="_ _2"></span>automatic <span class="_ _2"></span>variable <span class="_ _2"></span>is no <span class="_ _2"></span>longer <span class="_ _2"></span>in <span class="_ _2"></span>existence.<span class="_ _46"> </span>Automatic <span class="_ _2"></span>variables</div><div class="t m0 x215 h2a y60fd ff19 fsf fc0 sc0 ls0 ws0">declared <span class="_ _2"></span>after <span class="_ _9"></span>the <span class="_ _3"></span>left <span class="_ _9"></span>brace <span class="_ _3"></span>that <span class="_ _9"></span>starts <span class="_ _3"></span>a <span class="_ _3"></span>compound <span class="_ _9"></span>statement <span class="_ _3"></span>disappear <span class="_ _9"></span>after <span class="_ _3"></span>the</div><div class="t m0 x215 h2a y60fe ff19 fsf fc0 sc0 ls0 ws0">matching right brace.</div><div class="t m0 x35 h27 y60ff ff16 fsf fc0 sc0 ls0 ws0">Chapter <span class="_"> </span>8</div><div class="t m0 x32 h2a y6100 ff18 fsf fc0 sc0 ls0 ws0">8.1<span class="_ _9b"> </span><span class="ff19 ls5f">To <span class="_ _47"> </span>s<span class="_ _9"></span><span class="ls0">imulate <span class="_ _23"> </span>the <span class="_ _23"> </span>behavior <span class="_ _23"> </span>of <span class="_ _42"> </span>the <span class="_ _23"> </span>child <span class="_ _23"> </span>closing <span class="_ _23"> </span>the <span class="_ _42"> </span>standar<span class="ls400">do<span class="_ _43"></span><span class="ls0">utput <span class="_ _23"></span>when <span class="_ _23"> </span>it <span class="_ _23"> </span>exits,</span></span></span></span></div><div class="t m0 x215 h26 y6101 ff19 fsf fc0 sc0 ls0 ws0">add the following line befor<span class="ls44">ec<span class="_ _4f"></span><span class="ls0">alling<span class="_"> </span><span class="ff1a">exit<span class="_ _66"> </span></span>in the child:</span></span></div><div class="t m0 x1a7 h57 y6102 ff1a fs2d fc0 sc0 ls0 ws0">fclose(stdout);</div><div class="t m0 x215 h26 y6103 ff19 fsf fc0 sc0 ls5f ws0">To <span class="_ _53"> </span>s<span class="_ _9"></span><span class="ls0">ee the effects of doing this, replace the call to<span class="_"> </span><span class="ff1a">printf<span class="_ _e"> </span></span>with the lines</span></div><div class="t m0 x1a7 h57 y6104 ff1a fs2d fc0 sc0 ls15c ws0">i=p<span class="_ _1d"></span><span class="ls0">rintf(&quot;pid = %ld, glob = %d, var = %d\n&quot;,</span></div><div class="t m0 x148 h57 y6105 ff1a fs2d fc0 sc0 ls0 ws0">(long)getpid(), glob, var);</div><div class="t m0 x1a7 h57 y6106 ff1a fs2d fc0 sc0 ls0 ws0">sprintf(buf, &quot;%d\n&quot;, i);</div><div class="t m0 x1a7 h57 y6107 ff1a fs2d fc0 sc0 ls0 ws0">write(STDOUT_FILENO, buf, strlen(buf));</div><div class="t m0 x215 h26 y6108 ff19 fsf fc0 sc0 ls5f ws0">Yo<span class="_ _9"></span><span class="ls44">un<span class="_ _d"></span><span class="ls0">eed to deﬁne the variables<span class="_"> </span><span class="ff1a">i<span class="_ _66"> </span></span>and<span class="_"> </span><span class="ff1a">buf<span class="_ _80"> </span></span>also.</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
