<div id="pf3c5" class="pf w4 h1f" data-page-no="3c5"><div class="pc pc3c5 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg3c5.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Appendix <span class="_"> </span>C<span class="_ _89"> </span>Chapter <span class="_"> </span>14<span class="_ _54"> </span>Solutions<span class="_ _1b"> </span><span class="ff18">931</span></div><div class="t m0 xb9 h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x60 h57 y426 ff1a fs2d fc0 sc0 ls15c ws0">}e<span class="_ _1d"></span><span class="ls0">lse {<span class="_ _186"> </span>/* parent */</span></div><div class="t m0 xb9 h57 y800 ff1a fs2d fc0 sc0 ls0 ws0">sleep(2);</div><div class="t m0 x60 h57 y801 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x60 h57 y124b ff1a fs2d fc0 sc0 ls0 ws0">/*</div><div class="t m0 x211 h57 y124c ff1a fs2d fc0 sc0 ls15c ws0">*P<span class="_ _1d"></span><span class="ls0">arent continues ... read-lock the file again.</span></div><div class="t m0 x211 h57 y124d ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 x60 h57 y124e ff1a fs2d fc0 sc0 ls0 ws0">if ((pid2 = fork()) &lt; 0) {</div><div class="t m0 xb9 h57 y124f ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;fork failed&quot;);</div><div class="t m0 x60 h57 y1250 ff1a fs2d fc0 sc0 ls15c ws0">}e<span class="_ _1d"></span><span class="ls0">lse if (pid2 == 0) { /* child */</span></div><div class="t m0 xb9 h57 y8d8 ff1a fs2d fc0 sc0 ls0 ws0">if (lock_reg(fd, F_SETLK, F_RDLCK, 0, SEEK_SET, 0) &lt; 0)</div><div class="t m0 x1ce h57 y8d9 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;child 2: can’t read-lock file&quot;);</div><div class="t m0 xb9 h57 y8da ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;child 2: obtained read lock on file\n&quot;);</div><div class="t m0 xb9 h57 y8db ff1a fs2d fc0 sc0 ls0 ws0">pause();</div><div class="t m0 xb9 h57 y8dc ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;child 2: exit after pause\n&quot;);</div><div class="t m0 xb9 h57 y8dd ff1a fs2d fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x60 h57 y8de ff1a fs2d fc0 sc0 ls15c ws0">}e<span class="_ _1d"></span><span class="ls0">lse {<span class="_ _186"> </span>/* parent */</span></div><div class="t m0 xb9 h57 y8df ff1a fs2d fc0 sc0 ls0 ws0">sleep(2);</div><div class="t m0 x60 h57 y1251 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x60 h57 y8e1 ff1a fs2d fc0 sc0 ls0 ws0">/*</div><div class="t m0 x211 h57 y2f74 ff1a fs2d fc0 sc0 ls15c ws0">*P<span class="_ _1d"></span><span class="ls0">arent continues ... block while trying to write-lock</span></div><div class="t m0 x211 h57 y2f75 ff1a fs2d fc0 sc0 ls15c ws0">*t<span class="_ _1d"></span><span class="ls0">he file.</span></div><div class="t m0 x211 h57 y2f76 ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 x60 h57 y2f77 ff1a fs2d fc0 sc0 ls0 ws0">if ((pid3 = fork()) &lt; 0) {</div><div class="t m0 xb9 h57 y31bc ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;fork failed&quot;);</div><div class="t m0 x60 h57 y3264 ff1a fs2d fc0 sc0 ls15c ws0">}e<span class="_ _1d"></span><span class="ls0">lse if (pid3 == 0) { /* child */</span></div><div class="t m0 xb9 h57 y3265 ff1a fs2d fc0 sc0 ls0 ws0">if (lock_reg(fd, F_SETLK, F_WRLCK, 0, SEEK_SET, 0) &lt; 0)</div><div class="t m0 x1ce h57 y3266 ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;child 3: can’t set write lock: %s\n&quot;,</div><div class="t m0 x26 h57 y3267 ff1a fs2d fc0 sc0 ls0 ws0">strerror(errno));</div><div class="t m0 xb9 h57 y3268 ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;child 3 about to block in write-lock...\n&quot;);</div><div class="t m0 xb9 h57 y4853 ff1a fs2d fc0 sc0 ls0 ws0">if (lock_reg(fd, F_SETLKW, F_WRLCK, 0, SEEK_SET, 0) &lt; 0)</div><div class="t m0 x1ce h57 y4854 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;child 3: can’t write-lock file&quot;);</div><div class="t m0 xb9 h57 y4855 ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;child 3 returned and got write lock????\n&quot;);</div><div class="t m0 xb9 h57 y4856 ff1a fs2d fc0 sc0 ls0 ws0">pause();</div><div class="t m0 xb9 h57 y4857 ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;child 3: exit after pause\n&quot;);</div><div class="t m0 xb9 h57 y4858 ff1a fs2d fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x60 h57 y4218 ff1a fs2d fc0 sc0 ls15c ws0">}e<span class="_ _1d"></span><span class="ls0">lse {<span class="_ _186"> </span>/* parent */</span></div><div class="t m0 xb9 h57 y4219 ff1a fs2d fc0 sc0 ls0 ws0">sleep(2);</div><div class="t m0 x60 h57 y421a ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x60 h57 y3271 ff1a fs2d fc0 sc0 ls0 ws0">/*</div><div class="t m0 x211 h57 y3272 ff1a fs2d fc0 sc0 ls15c ws0">*S<span class="_ _1d"></span><span class="ls0">ee if a pending write lock will block the next</span></div><div class="t m0 x211 h57 y3273 ff1a fs2d fc0 sc0 ls15c ws0">*r<span class="_ _1d"></span><span class="ls0">ead-lock attempt.</span></div><div class="t m0 x211 h57 y3274 ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 x60 h57 y3275 ff1a fs2d fc0 sc0 ls0 ws0">if (lock_reg(fd, F_SETLK, F_RDLCK, 0, SEEK_SET, 0) &lt; 0)</div><div class="t m0 xb9 h57 y3276 ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;parent: can’t set read lock: %s\n&quot;,</div><div class="t m0 x1b h57 y3277 ff1a fs2d fc0 sc0 ls0 ws0">strerror(errno));</div><div class="t m0 x60 h57 y4a08 ff1a fs2d fc0 sc0 ls0 ws0">else</div><div class="t m0 xb9 h57 y4a09 ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;parent: obtained additional read lock while&quot;</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
