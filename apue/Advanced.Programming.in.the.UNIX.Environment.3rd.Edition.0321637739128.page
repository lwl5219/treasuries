<div id="pf80" class="pf w4 h1f" data-page-no="80"><div class="pc pc80 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg80.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">94<span class="_ _1b"> </span><span class="ff19">Files <span class="_"> </span>and <span class="_"> </span>Directories <span class="_ _e5"> </span>Chapter<span class="_ _4b"> </span>4</span></div><div class="t m0 x3f h26 y12f ff19 fsf fc0 sc0 ls0 ws0">Given <span class="_ _23"> </span>a<span class="_ _35"> </span><span class="ff1b">pathname</span><span class="ls26b">,t<span class="_ _43"></span><span class="ls0">he<span class="_ _44"> </span><span class="ff1a">stat<span class="_ _35"> </span></span>function <span class="_ _23"> </span>returns <span class="_ _23"></span>a <span class="_ _23"> </span>structure<span class="_ _35"> </span>of<span class="_ _35"> </span>information <span class="_ _23"> </span>about <span class="_ _42"> </span>the</span></span></div><div class="t m0 x32 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">named <span class="_ _3"></span>ﬁle.<span class="_ _61"> </span>The<span class="_ _47"> </span><span class="ff1a">fstat<span class="_ _45"> </span></span>function <span class="_ _2"></span>obtains <span class="_ _3"></span>information <span class="_ _3"></span>about <span class="_ _3"></span>the <span class="_ _3"></span>ﬁle <span class="_ _3"></span>that <span class="_ _3"></span>is <span class="_ _3"></span>already <span class="_ _2"></span>open</div><div class="t m0 x32 h26 y131 ff19 fsf fc0 sc0 ls0 ws0">on <span class="_ _2"></span>the <span class="_ _2"></span>descriptor<span class="_ _47"> </span><span class="ff1b">fd</span><span class="ls473">.T<span class="_ _1d"></span><span class="ls0">he<span class="_ _47"> </span><span class="ff1a">lstat<span class="_ _66"> </span></span>function <span class="_ _2"></span>is <span class="_ _3"></span>similar <span class="_ _2"></span>to<span class="_ _47"> </span><span class="ff1a">stat</span><span class="ls474">,b<span class="_ _8"></span><span class="ls0">ut <span class="_ _3"></span>when <span class="_ _2"></span>the <span class="_ _2"></span>named <span class="_ _2"></span>ﬁle <span class="_ _2"></span>is</span></span></span></span></div><div class="t m0 x32 h26 y132 ff19 fsf fc0 sc0 ls475 ws0">as<span class="_ _62"></span><span class="ls0">ymbolic <span class="_ _45"> </span>link,<span class="_ _16"> </span><span class="ff1a">lstat<span class="_"> </span></span><span class="ls45">re</span>turns <span class="_ _45"> </span>information <span class="_ _45"> </span>about <span class="_ _45"> </span>the <span class="_ _45"> </span>symbolic <span class="_ _45"> </span>link, <span class="_ _47"> </span>not <span class="_ _45"> </span>the <span class="_ _45"> </span>ﬁle</span></div><div class="t m0 x32 h26 y133 ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">ferenced by the symbolic link.<span class="_ _46"> </span>(W<span class="_ _6"></span>e’ll need<span class="_ _66"> </span><span class="ff1a">lstat<span class="_ _66"> </span></span>in Section 4.22 when we <span class="_ _2"></span>walk down</span></div><div class="t m0 x32 h2a y134 ff19 fsf fc0 sc0 ls44 ws0">ad<span class="_ _d"></span><span class="ls0">irectory hierarchy<span class="_ _4"></span><span class="ls86">.W<span class="_ _26"></span><span class="ls44">ed<span class="_ _d"></span><span class="ls0">escribe symbolic links in mor<span class="ls44">ed<span class="_ _d"></span><span class="ls0">etail in Section 4.17.)</span></span></span></span></span></span></div><div class="t m0 x3f h26 y135 ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _35"> </span><span class="ff1a">fstatat<span class="_ _35"> </span></span>function <span class="_ _23"> </span>provides <span class="_ _23"></span>a <span class="_ _23"> </span>way <span class="_ _23"> </span>to <span class="_ _42"> </span>return <span class="_ _23"></span>the <span class="_ _23"></span>ﬁle <span class="_ _23"> </span>statistics <span class="_ _23"> </span>for <span class="_ _42"> </span>a <span class="_ _23"> </span>pathname</div><div class="t m0 x32 h2b y136 ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">lative <span class="_ _45"> </span>to <span class="_ _47"> </span>an <span class="_ _47"> </span>open <span class="_ _45"> </span>dir<span class="_ _0"></span>ectory <span class="_ _47"> </span>represented <span class="_ _66"> </span>by <span class="_ _45"> </span>the<span class="_ _61"> </span><span class="ff1b">fd<span class="_ _5a"> </span></span>argument. <span class="_ _61"> </span>The<span class="_ _16"> </span><span class="ff1b">ﬂag<span class="_ _16"> </span></span>argument</span></div><div class="t m0 x32 h26 y137 ff19 fsf fc0 sc0 ls0 ws0">controls <span class="_ _9"></span>whether <span class="_ _9"></span>symbolic <span class="_ _23"> </span>links <span class="_ _23"></span>ar<span class="ls476">ef<span class="_ _43"></span><span class="ls0">ollowed; <span class="_ _23"></span>when <span class="_ _9"></span>the<span class="_ _35"> </span><span class="ff1a">AT_SYMLINK_NOFOLLOW<span class="_ _45"> </span></span>ﬂag</span></span></div><div class="t m0 x32 h26 y138 ff19 fsf fc0 sc0 ls0 ws0">is <span class="_ _2"></span>set,<span class="_ _47"> </span><span class="ff1a">fstatat<span class="_ _66"> </span></span>will <span class="_ _2"></span>not <span class="_ _3"></span>follow <span class="_ _2"></span>symbolic <span class="_ _2"></span>links, <span class="_ _2"></span>but <span class="_ _3"></span>rather <span class="_ _2"></span>returns <span class="_ _2"></span>information <span class="_ _2"></span>about <span class="_ _2"></span>the</div><div class="t m0 x32 h2a y139 ff19 fsf fc0 sc0 ls0 ws0">link <span class="_ _53"> </span>itself.<span class="_ _48"> </span>Otherwise, <span class="_ _e"> </span>the <span class="_ _e"> </span>default <span class="_ _e"> </span>is <span class="_ _e"> </span>to <span class="_ _53"> </span>follow <span class="_"> </span>symbolic <span class="_ _53"> </span>links, <span class="_ _53"> </span>returning <span class="_ _e"> </span>information</div><div class="t m0 x32 h2b y13a ff19 fsf fc0 sc0 ls0 ws0">about <span class="_"> </span>the <span class="_ _e"> </span>ﬁle <span class="_"> </span>to <span class="_"> </span>which <span class="_ _e"> </span>the <span class="_"> </span>symbolic <span class="_"> </span>link <span class="_ _e"> </span>points.<span class="_ _60"> </span>If <span class="_"> </span>the<span class="_ _4b"> </span><span class="ff1b">fd<span class="_ _59"> </span></span>argument <span class="_"> </span>has <span class="_ _e"> </span>the <span class="_"> </span>value</div><div class="t m0 x32 h26 y254 ff1a fsf fc0 sc0 ls0 ws0">AT_FDCWD<span class="_ _47"> </span><span class="ff19">and <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1b">pathname<span class="_ _47"> </span></span>argument <span class="_ _2"></span>is <span class="_ _3"></span>a <span class="_ _3"></span>relative <span class="_ _2"></span>pathname, <span class="_ _3"></span>then<span class="_ _47"> </span></span>fstatat<span class="_ _47"> </span><span class="ff19">evaluates</span></div><div class="t m0 x32 h2b y255 ff19 fsf fc0 sc0 ls0 ws0">the<span class="_ _47"> </span><span class="ff1b">pathname<span class="_ _45"> </span></span>ar<span class="_ _0"></span>gument <span class="_ _3"></span>relative <span class="_ _3"></span>to <span class="_ _3"></span>the <span class="_ _3"></span>current <span class="_ _3"></span>directory<span class="_ _4"></span><span class="ls477">.I<span class="_ _1d"></span><span class="ls478">ft<span class="_ _8"></span><span class="ls0">he<span class="_ _47"> </span><span class="ff1b">pathname<span class="_ _45"> </span></span>ar<span class="_ _0"></span>gument <span class="_ _3"></span>is <span class="_ _3"></span>an</span></span></span></div><div class="t m0 x32 h26 y13b ff19 fsf fc0 sc0 ls0 ws0">absolute <span class="_"> </span>pathname, <span class="_ _e"> </span>then <span class="_"> </span>the<span class="_ _59"> </span><span class="ff1b">fd<span class="_ _59"> </span></span>argument <span class="_"> </span>is <span class="_"> </span>ignor<span class="_ _1"></span>ed. <span class="_ _46"> </span>In<span class="_ _59"> </span>these <span class="_"> </span>two <span class="_"> </span>cases,<span class="_ _59"> </span><span class="ff1a">fstatat</span></div><div class="t m0 x32 h26 y13c ff19 fsf fc0 sc0 ls0 ws0">behaves like either<span class="_"> </span><span class="ff1a">stat<span class="_ _80"> </span></span>or<span class="_"> </span><span class="ff1a">lstat</span><span class="ls44">,d<span class="_ _5"></span><span class="ls0">epending on the value of<span class="_"> </span><span class="ff1b">ﬂag</span>.</span></span></div><div class="t m0 x3f h2b y256 ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _47"> </span><span class="ff1b">buf<span class="_ _66"> </span></span>argument <span class="_ _2"></span>is <span class="_ _3"></span>a <span class="_ _3"></span>pointer <span class="_ _2"></span>to <span class="_ _3"></span>a <span class="_ _3"></span>structur<span class="ls479">et<span class="_ _8"></span><span class="ls0">hat <span class="_ _2"></span>we <span class="_ _3"></span>must <span class="_ _2"></span>supply<span class="_ _6"></span><span class="ls47a">.T<span class="_ _1d"></span><span class="ls0">he <span class="_ _3"></span>functions <span class="_ _3"></span>ﬁll</span></span></span></span></div><div class="t m0 x32 h2a y257 ff19 fsf fc0 sc0 ls0 ws0">in <span class="_ _3"></span>the <span class="_ _9"></span>structur<span class="_ _0"></span>e. <span class="_ _47"> </span>The<span class="_ _45"> </span>deﬁnition <span class="_ _3"></span>of <span class="_ _9"></span>the <span class="_ _3"></span>structur<span class="ls47b">ec<span class="_ _b"></span><span class="ls0">an <span class="_ _9"></span>differ <span class="_ _2"></span>among <span class="_ _9"></span>implementations, <span class="_ _3"></span>but</span></span></div><div class="t m0 x32 h2a y258 ff19 fsf fc0 sc0 ls0 ws0">it could look like</div><div class="t m0 x3f h57 ydf3 ff1a fs2d fc0 sc0 ls0 ws0">struct stat {</div><div class="t m0 xf4 h57 ydf4 ff1a fs2d fc0 sc0 ls0 ws0">mode_t <span class="_ _176"> </span>st_mode;<span class="_ _15"> </span>/* file type &amp; mode (permissions) */</div><div class="t m0 xf4 h57 ydf5 ff1a fs2d fc0 sc0 ls0 ws0">ino_t <span class="_ _74"> </span>st_ino;<span class="_ _8a"> </span>/* i-node number (serial number) */</div><div class="t m0 xf4 h57 ydf6 ff1a fs2d fc0 sc0 ls0 ws0">dev_t <span class="_ _74"> </span>st_dev;<span class="_ _8a"> </span>/* device number (file system) */</div><div class="t m0 xf4 h57 ydf7 ff1a fs2d fc0 sc0 ls0 ws0">dev_t <span class="_ _74"> </span>st_rdev;<span class="_ _15"> </span>/* device number for special files */</div><div class="t m0 xf4 h57 ydf8 ff1a fs2d fc0 sc0 ls0 ws0">nlink_t <span class="_ _186"> </span>st_nlink;<span class="_ _68"> </span>/* number of links */</div><div class="t m0 xf4 h57 ydf9 ff1a fs2d fc0 sc0 ls0 ws0">uid_t <span class="_ _74"> </span>st_uid;<span class="_ _8a"> </span>/* user ID of owner */</div><div class="t m0 xf4 h57 ydfa ff1a fs2d fc0 sc0 ls0 ws0">gid_t <span class="_ _74"> </span>st_gid;<span class="_ _8a"> </span>/* group ID of owner */</div><div class="t m0 xf4 h57 ydfb ff1a fs2d fc0 sc0 ls0 ws0">off_t <span class="_ _74"> </span>st_size;<span class="_ _15"> </span>/* size in bytes, for regular files */</div><div class="t m0 xf4 h57 ydfc ff1a fs2d fc0 sc0 ls0 ws0">struct timespec st_atim;<span class="_ _15"> </span>/* time of last access */</div><div class="t m0 xf4 h57 ydfd ff1a fs2d fc0 sc0 ls0 ws0">struct timespec st_mtim;<span class="_ _15"> </span>/* time of last modification */</div><div class="t m0 xf4 h57 ydfe ff1a fs2d fc0 sc0 ls0 ws0">struct timespec st_ctim;<span class="_ _15"> </span>/* time of last file status change */</div><div class="t m0 xf4 h57 ydff ff1a fs2d fc0 sc0 ls0 ws0">blksize_t <span class="_ _88"> </span>st_blksize;<span class="_"> </span>/* best I/O block size */</div><div class="t m0 xf4 h57 ye00 ff1a fs2d fc0 sc0 ls0 ws0">blkcnt_t <span class="_ _b7"> </span>st_blocks;<span class="_ _3a"> </span>/* number of disk blocks allocated */</div><div class="t m0 x3f h57 ye01 ff1a fs2d fc0 sc0 ls0 ws0">};</div><div class="t m0 x76 h52 ye02 ff19 fs2a fc0 sc0 ls0 ws0">The<span class="_ _47"> </span><span class="ff1a">st_rdev</span>,<span class="_ _47"> </span><span class="ff1a">st_blksize</span><span class="ls47c">,a<span class="_ _4f"></span><span class="ls0">nd<span class="_ _47"> </span><span class="ff1a">st_blocks<span class="_ _47"> </span></span>ﬁelds <span class="_ _23"> </span>ar<span class="ls47c">en<span class="_ _8"></span><span class="ls0">ot <span class="_ _23"> </span>requir<span class="_ _0"></span>ed <span class="_ _9"> </span>by <span class="_ _23"> </span>POSIX.1.<span class="_ _46"> </span>They <span class="_ _23"> </span>are</span></span></span></span></div><div class="t m0 x76 h51 ye03 ff19 fs2a fc0 sc0 ls0 ws0">deﬁned as part of the XSI option in the Single UNIX Speciﬁcation.</div><div class="t m0 x3f h26 ye04 ff19 fsf fc0 sc0 ls0 ws0">The<span class="_"> </span><span class="ff1a">timespec<span class="_ _47"> </span></span>structur<span class="_ _0"></span><span class="ls47d">et<span class="_ _4f"></span><span class="ls0">ype <span class="_ _2"></span>deﬁnes <span class="_ _2"></span>time <span class="_ _2"></span>in <span class="_ _2"></span>terms <span class="_ _2"></span>of <span class="_ _2"></span>seconds and <span class="_ _2"></span>nanoseconds.<span class="_ _61"> </span>It</span></span></div><div class="t m0 x32 h2a ye05 ff19 fsf fc0 sc0 ls0 ws0">includes at least the following ﬁelds:</div><div class="t m0 x3f h57 ye06 ff1a fs2d fc0 sc0 ls0 ws0">time_t tv_sec;</div><div class="t m0 x3f h57 ye07 ff1a fs2d fc0 sc0 ls0 ws0">long <span class="_ _d9"> </span>tv_nsec;</div><div class="t m0 x76 h52 ye08 ff19 fs2a fc0 sc0 ls0 ws0">Prior <span class="_ _3"></span>to <span class="_ _9"></span>the <span class="_ _3"></span>2008 <span class="_ _9"></span>version <span class="_ _3"></span>of <span class="_ _3"></span>the <span class="_ _9"></span>standard, <span class="_ _3"></span>the <span class="_ _3"></span>time <span class="_ _9"></span>ﬁelds <span class="_ _3"></span>wer<span class="ls47e">en<span class="_ _d"></span><span class="ls0">amed<span class="_ _66"> </span><span class="ff1a">st_atime</span>,<span class="_ _66"> </span><span class="ff1a">st_mtime</span>,</span></span></div><div class="t m0 x76 h52 ye09 ff19 fs2a fc0 sc0 ls0 ws0">and<span class="_ _47"> </span><span class="ff1a">st_ctime</span><span class="ls47f">,a<span class="_ _8"></span><span class="ls0">nd <span class="_ _23"> </span>were<span class="_ _66"> </span>of<span class="_ _45"> </span>type<span class="_ _47"> </span><span class="ff1a">time_t<span class="_ _47"> </span></span>(expressed <span class="_ _9"></span>in <span class="_ _23"> </span>seconds).<span class="_ _59"> </span>The<span class="_ _45"> </span><span class="ff1a">timespec<span class="_ _66"> </span></span>structure</span></span></div><div class="t m0 x76 h52 ye0a ff19 fs2a fc0 sc0 ls0 ws0">enables <span class="_ _3"></span>higher-resolution <span class="_ _2"></span>timestamps.<span class="_ _59"> </span>The <span class="_ _3"></span>old <span class="_ _3"></span>names <span class="_ _3"></span>can <span class="_ _3"></span>be <span class="_ _9"></span>deﬁned <span class="_ _3"></span>in <span class="_ _3"></span>terms <span class="_ _3"></span>of <span class="_ _9"></span>the<span class="_ _66"> </span><span class="ff1a">tv_sec</span></div><div class="t m0 x76 h52 ye0b ff19 fs2a fc0 sc0 ls0 ws0">members for compatibility<span class="_ _6"></span><span class="ls10f">.F<span class="_ _43"></span><span class="ls0">or example,<span class="_"> </span><span class="ff1a">st_atime<span class="_ _53"> </span></span>can be deﬁned as<span class="_"> </span><span class="ff1a">st_atim.tv_sec</span>.</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
