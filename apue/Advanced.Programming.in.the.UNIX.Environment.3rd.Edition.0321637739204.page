<div id="pfcc" class="pf w4 h1f" data-page-no="cc"><div class="pc pccc w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bgcc.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">170<span class="_ _1b"> </span><span class="ff19">Standar<span class="ls30a">dI<span class="_ _55"></span><span class="ls0">/O <span class="_"> </span>Library<span class="_ _1c9"> </span>Chapter <span class="_"> </span>5</span></span></span></div><div class="t m0 x35 h27 y12f ff16 fsf fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h26 y131 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _e"> </span>program <span class="_ _e"> </span>in <span class="_"> </span>Figur<span class="_ _0"></span><span class="ls730">e5<span class="_ _4a"></span><span class="ls0">.13 <span class="_"> </span>shows <span class="_ _e"> </span>how <span class="_"> </span>to <span class="_ _e"> </span>use <span class="_"> </span>(and <span class="_ _53"> </span>how <span class="_"> </span>not <span class="_ _e"> </span>to <span class="_"> </span>use) <span class="_ _53"> </span>the<span class="_ _59"> </span><span class="ff1a">mkstemp</span></span></span></div><div class="t m0 x32 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">function.</div><div class="t m0 x32 h4e y177c ff1a fs28 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h4e y177d ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;errno.h&gt;</div><div class="t m0 x32 h4e y177e ff1a fs28 fc0 sc0 ls0 ws0">void make_temp(char *template);</div><div class="t m0 x32 h4e y177f ff1a fs28 fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h4e y1780 ff1a fs28 fc0 sc0 ls0 ws0">main()</div><div class="t m0 x32 h4e y1781 ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y1782 ff1a fs28 fc0 sc0 ls0 ws0">char <span class="_ _68"> </span>good_template[]<span class="_"> </span><span class="ls1b6">=&quot;<span class="_ _5b"></span><span class="ls0">/tmp/dirXXXXXX&quot;; /* right way */</span></span></div><div class="t m0 x8a h4e y1783 ff1a fs28 fc0 sc0 ls0 ws0">char <span class="_ _68"> </span>*bad_template<span class="_"> </span><span class="ls1b6">=&quot;<span class="_ _5b"></span><span class="ls0">/tmp/dirXXXXXX&quot;; <span class="_ _3a"> </span>/*<span class="_"> </span>wrong way*/</span></span></div><div class="t m0 x8a h4e y1784 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;trying to create first temp file...\n&quot;);</div><div class="t m0 x8a h4e y1785 ff1a fs28 fc0 sc0 ls0 ws0">make_temp(good_template);</div><div class="t m0 x8a h4e y1786 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;trying to create second temp file...\n&quot;);</div><div class="t m0 x8a h4e y1787 ff1a fs28 fc0 sc0 ls0 ws0">make_temp(bad_template);</div><div class="t m0 x8a h4e y1788 ff1a fs28 fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h4e y1789 ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h4e y178a ff1a fs28 fc0 sc0 ls0 ws0">void</div><div class="t m0 x32 h4e y178b ff1a fs28 fc0 sc0 ls0 ws0">make_temp(char *template)</div><div class="t m0 x32 h4e y178c ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y178d ff1a fs28 fc0 sc0 ls0 ws0">int <span class="_ _186"> </span>fd;</div><div class="t m0 x8a h4e y178e ff1a fs28 fc0 sc0 ls0 ws0">struct stat sbuf;</div><div class="t m0 x8a h4e y178f ff1a fs28 fc0 sc0 ls0 ws0">if ((fd = mkstemp(template)) &lt; 0)</div><div class="t m0 x9d h4e y1790 ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;can’t create temp file&quot;);</div><div class="t m0 x8a h4e y1791 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;temp name = %s\n&quot;, template);</div><div class="t m0 x8a h4e y1792 ff1a fs28 fc0 sc0 ls0 ws0">close(fd);</div><div class="t m0 x8a h4e y1793 ff1a fs28 fc0 sc0 ls0 ws0">if (stat(template, &amp;sbuf) &lt; 0) {</div><div class="t m0 x9d h4e y1794 ff1a fs28 fc0 sc0 ls0 ws0">if (errno == ENOENT)</div><div class="t m0 x1f h4e y1795 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;file doesn’t exist\n&quot;);</div><div class="t m0 x9d h4e y1796 ff1a fs28 fc0 sc0 ls0 ws0">else</div><div class="t m0 x1f h4e y1797 ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;stat failed&quot;);</div><div class="t m0 x8a h4e y1798 ff1a fs28 fc0 sc0 ls1b6 ws0">}e<span class="_ _1d"></span><span class="ls0">lse {</span></div><div class="t m0 x9d h4e y1799 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;file exists\n&quot;);</div><div class="t m0 x9d h4e y179a ff1a fs28 fc0 sc0 ls0 ws0">unlink(template);</div><div class="t m0 x8a h4e y179b ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h4e y179c ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x27 h4f y179d ff18 fs11 fc0 sc0 ls0 ws0">Figure 5.13<span class="_ _5a"> </span><span class="ff19">Demonstrate<span class="_"> </span><span class="ff1a">mkstemp<span class="_ _e"> </span></span>function</span></div><div class="t m0 x32 h55 y179e ff19 fs2c fc0 sc0 ls0 ws0">If we execute the program in Figur<span class="_ _0"></span><span class="ls142">e5<span class="_ _d"></span><span class="ls0">.13, we get</span></span></div><div class="t m0 x3f h5d y179f ff1a fs2f fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">./a.out</span></div><div class="t m0 x3f h5d y17a0 ff1a fs2f fc0 sc0 ls0 ws0">trying to create first temp file...</div><div class="t m0 x3f h5d y17a1 ff1a fs2f fc0 sc0 ls0 ws0">temp name = /tmp/dirUmBT7h</div><div class="t m0 x3f h5d y17a2 ff1a fs2f fc0 sc0 ls0 ws0">file exists</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
