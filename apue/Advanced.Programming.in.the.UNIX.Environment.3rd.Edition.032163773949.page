<div id="pf31" class="pf w4 h1f" data-page-no="31"><div class="pc pc31 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg31.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>1.7<span class="_ _8d"> </span>Error <span class="_"> </span>Handling<span class="_ _1b"> </span><span class="ff18">15</span></div><div class="t m0 x3f h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">extern int *_<span class="_ _42"> </span>_errno_location(void);</div><div class="t m0 x3f h57 y426 ff1a fs2d fc0 sc0 ls0 ws0">#define errno (*_<span class="_ _42"> </span>_errno_location())</div><div class="t m0 x3f h26 y427 ff19 fsf fc0 sc0 ls0 ws0">Ther<span class="ls183">ea<span class="_ _b"></span><span class="ls45">re <span class="_ _9"></span>t<span class="_ _2"></span><span class="ls0">wo <span class="_ _9"></span>rules <span class="_ _9"></span>to <span class="_ _23"></span>be <span class="_ _9"></span>aware<span class="_ _45"> </span>of<span class="_ _45"> </span>with <span class="_ _9"></span>respect <span class="_ _3"></span>to<span class="_ _35"> </span><span class="ff1a">errno</span><span class="ls184">.F<span class="_ _26"></span><span class="ls0">irst, <span class="_ _9"></span>its <span class="_ _9"></span>value <span class="_ _23"></span>is <span class="_ _9"></span>never</span></span></span></span></span></div><div class="t m0 x32 h2a y428 ff19 fsf fc0 sc0 ls0 ws0">cleared <span class="_ _2"></span>by <span class="_ _3"></span>a <span class="_ _9"></span>routine <span class="_ _2"></span>if <span class="_ _3"></span>an <span class="_ _3"></span>error <span class="_ _3"></span>does <span class="_ _3"></span>not <span class="_ _9"></span>occur<span class="_ _6"></span><span class="ls181">.T<span class="_ _1d"></span><span class="ls0">herefore, <span class="_ _2"></span>we <span class="_ _3"></span>should <span class="_ _3"></span>examine <span class="_ _9"></span>its <span class="_ _3"></span>value</span></span></div><div class="t m0 x32 h2a y429 ff19 fsf fc0 sc0 ls0 ws0">only <span class="_ _23"></span>when <span class="_ _23"></span>the <span class="_ _23"></span>return <span class="_ _9"></span>value <span class="_ _23"> </span>from <span class="_ _23"> </span>a <span class="_ _23"> </span>function <span class="_ _23"> </span>indicates <span class="_ _23"> </span>that <span class="_ _23"> </span>an <span class="_ _23"> </span>error <span class="_ _23"></span>occurred. <span class="_ _45"> </span>Second,</div><div class="t m0 x32 h26 y42a ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _3"></span>value <span class="_ _9"></span>of<span class="_ _45"> </span><span class="ff1a">errno<span class="_ _47"> </span></span>is <span class="_ _9"></span>never <span class="_ _3"></span>set <span class="_ _9"></span>to <span class="_ _3"></span>0 <span class="_ _9"></span>by <span class="_ _9"></span>any <span class="_ _3"></span>of <span class="_ _9"></span>the <span class="_ _3"></span>functions, <span class="_ _9"></span>and <span class="_ _3"></span>none <span class="_ _9"></span>of <span class="_ _9"></span>the <span class="_ _3"></span>constants</div><div class="t m0 x32 h26 y42b ff19 fsf fc0 sc0 ls0 ws0">deﬁned in<span class="_"> </span><span class="ff1a">&lt;errno.h&gt;<span class="_ _80"> </span></span>has a value of 0.</div><div class="t m0 x3f h2a y42c ff19 fsf fc0 sc0 lsbc ws0">Tw<span class="_ _9"></span><span class="ls44">of<span class="_ _d"></span><span class="ls0">unctions ar<span class="ls44">ed<span class="_ _d"></span><span class="ls0">eﬁned by the C standard<span class="_"> </span>to<span class="_"> </span>help with printing err<span class="_ _0"></span>or messages.</span></span></span></span></div><div class="t m0 x3f h57 y42d ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;string.h&gt;</div><div class="t m0 x3f h57 y42e ff1a fs2d fc0 sc0 ls0 ws0">char *strerror(int<span class="_"> </span><span class="ff1b">errnum</span>);</div><div class="t m0 xb4 h5f y42f ff19 fs2d fc0 sc0 ls0 ws0">Returns: pointer to message string</div><div class="t m0 x32 h4d y430 ff19 fs26 fc0 sc0 ls0 ws0">This <span class="_ _9"></span>function <span class="_ _23"></span>maps<span class="_ _45"> </span><span class="ff1b">errnum</span><span class="ls185">,w<span class="_ _b"></span><span class="ls0">hich <span class="_ _9"></span>is <span class="_ _9"></span>typically <span class="_ _23"></span>the<span class="_ _45"> </span><span class="ff1a">errno<span class="_ _45"> </span></span>value, <span class="_ _23"></span>into <span class="_ _9"></span>an <span class="_ _9"></span>error <span class="_ _9"></span>message</span></span></div><div class="t m0 x32 h49 y431 ff19 fs26 fc0 sc0 ls0 ws0">string and returns a pointer to the string.</div><div class="t m0 x3f h4d y432 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _35"> </span><span class="ff1a">perror<span class="_ _35"> </span></span>function <span class="_ _23"> </span>produces <span class="_ _23"> </span>an <span class="_ _42"> </span>error <span class="_ _23"></span>message <span class="_ _23"> </span>on <span class="_ _23"> </span>the <span class="_ _42"> </span>standar<span class="ls186">de<span class="_ _43"></span><span class="ls0">rr<span class="_ _0"></span>or<span class="_ _6"></span><span class="ls186">,b<span class="_ _b"></span><span class="ls0">ased <span class="_ _23"></span>on</span></span></span></span></div><div class="t m0 x32 h4d y433 ff19 fs26 fc0 sc0 ls0 ws0">the current value of<span class="_"> </span><span class="ff1a">errno</span><span class="lsd3">,a<span class="_ _4f"></span><span class="ls0">nd returns.</span></span></div><div class="t m0 x3f h4e y434 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;stdio.h&gt;</div><div class="t m0 x3f h4e y435 ff1a fs28 fc0 sc0 ls0 ws0">void perror(const char *<span class="ff1b">msg</span>);</div><div class="t m0 x32 h60 y436 ff19 fs2c fc0 sc0 ls0 ws0">It outputs the string pointed <span class="_ _2"></span>to by<span class="_"> </span><span class="ff1b">msg</span><span class="ls187">,f<span class="_ _d"></span><span class="ls0">ollowed <span class="_ _2"></span>by a colon and a <span class="_ _2"></span>space, followed by the</span></span></div><div class="t m0 x32 h54 y437 ff19 fs2c fc0 sc0 ls0 ws0">error message corr<span class="_ _0"></span>esponding to the value of<span class="_"> </span><span class="ff1a">errno</span><span class="ls142">,f<span class="_ _d"></span><span class="ls0">ollowed by a newline.</span></span></div><div class="t m0 x35 h61 y438 ff16 fs2c fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h55 y439 ff19 fs2c fc0 sc0 ls0 ws0">Figur<span class="ls142">e1<span class="_ _4f"></span><span class="ls0">.8 shows the use of these two error functions.</span></span></div><div class="t m0 x32 h62 y43a ff1a fs30 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h62 y43b ff1a fs30 fc0 sc0 ls0 ws0">#include &lt;errno.h&gt;</div><div class="t m0 x32 h62 y43c ff1a fs30 fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h62 y43d ff1a fs30 fc0 sc0 ls0 ws0">main(int argc, char *argv[])</div><div class="t m0 x32 h62 y43e ff1a fs30 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h62 y43f ff1a fs30 fc0 sc0 ls0 ws0">fprintf(stderr, &quot;EACCES: %s\n&quot;, strerror(EACCES));</div><div class="t m0 x8a h62 y440 ff1a fs30 fc0 sc0 ls0 ws0">errno = ENOENT;</div><div class="t m0 x8a h62 y441 ff1a fs30 fc0 sc0 ls0 ws0">perror(argv[0]);</div><div class="t m0 x8a h62 y442 ff1a fs30 fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h62 y443 ff1a fs30 fc0 sc0 ls0 ws0">}</div><div class="t m0 x36 h63 y444 ff18 fs13 fc0 sc0 ls0 ws0">Figure 1.8<span class="_ _5a"> </span><span class="ff19">Demonstrate<span class="_"> </span><span class="ff1a">strerror<span class="_ _e"> </span></span>and<span class="_"> </span><span class="ff1a">perror</span></span></div><div class="t m0 x32 h64 y445 ff19 fs31 fc0 sc0 ls0 ws0">If this program is compiled into the ﬁle<span class="_"> </span><span class="ff1a">a.out</span>,<span class="_"> </span>we<span class="_"> </span>have</div><div class="t m0 x3f h65 y446 ff1a fs32 fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">./a.out</span></div><div class="t m0 x3f h65 y447 ff1a fs32 fc0 sc0 ls0 ws0">EACCES: Permission denied</div><div class="t m0 x3f h65 y448 ff1a fs32 fc0 sc0 ls0 ws0">./a.out: No such file or directory</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
