<div id="pf3c7" class="pf w4 h1f" data-page-no="3c7"><div class="pc pc3c7 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg3c7.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Appendix <span class="_"> </span>C<span class="_ _89"> </span>Chapter <span class="_"> </span>14<span class="_ _54"> </span>Solutions<span class="_ _1b"> </span><span class="ff18">933</span></div><div class="t m0 x7c h26 y12f ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _2"></span>deﬁnition <span class="_ _2"></span>of <span class="_ _2"></span>the<span class="_ _66"> </span><span class="ff1a">fd_set<span class="_ _47"> </span></span>type <span class="_ _2"></span>with <span class="_ _2"></span>a <span class="_ _2"></span>separate <span class="_ _2"></span>symbol.<span class="_ _61"> </span><span class="ls5f">We <span class="_ _e"> </span>n<span class="_ _9"></span></span>eed <span class="_ _2"></span>to <span class="_ _2"></span>deﬁne</div><div class="t m0 x7c h2a y130 ff19 fsf fc0 sc0 ls0 ws0">this, too.</div><div class="t m0 x7c h26 y2241 ff19 fsf fc0 sc0 ls0 ws0">For <span class="_ _45"> </span>example, <span class="_ _45"> </span>on <span class="_ _35"> </span>Fr<span class="_ _0"></span>eeBSD <span class="_ _45"> </span>8.0, <span class="_ _35"> </span>we <span class="_ _45"> </span>need <span class="_ _45"> </span>to <span class="_ _45"> </span>deﬁne<span class="_ _51"> </span><span class="ff1a">_SYS_SELECT_H_<span class="_"> </span></span>to</div><div class="t m0 x7c h26 yc35 ff19 fsf fc0 sc0 ls0 ws0">prevent <span class="_ _2"></span>the <span class="_ _9"></span>inclusion <span class="_ _9"></span>of<span class="_ _47"> </span><span class="ff1a">&lt;sys/select.h&gt;<span class="_ _45"> </span></span>and <span class="_ _3"></span>we <span class="_ _9"></span>need <span class="_ _3"></span>to <span class="_ _9"></span>deﬁne<span class="_ _47"> </span><span class="ff1a">_FD_SET</span></div><div class="t m0 x7c h26 y2242 ff19 fsf fc0 sc0 ls0 ws0">to prevent the inclusion of the deﬁnition for the<span class="_"> </span><span class="ff1a">fd_set<span class="_ _80"> </span></span>data type.</div><div class="t m0 xe2 h26 yc80 ff19 fsf fc0 sc0 ls0 ws0">2. <span class="_ _51"> </span>Sometimes,<span class="_ _48"> </span>for <span class="_ _4b"> </span>compatibility <span class="_ _4b"> </span>with <span class="_ _59"> </span>older <span class="_ _4b"> </span>applications,<span class="_ _48"> </span><span class="ff1a">&lt;sys/types.h&gt;</span></div><div class="t m0 x7c h26 y14ac ff19 fsf fc0 sc0 ls0 ws0">deﬁnes <span class="_ _9"></span>the <span class="_ _9"></span>size <span class="_ _23"></span>of <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">fd_set</span>,<span class="_ _45"> </span>so<span class="_ _45"> </span>we<span class="_ _45"> </span>need <span class="_ _9"></span>to <span class="_ _9"></span>include <span class="_ _23"></span>it <span class="_ _9"></span>ﬁrst, <span class="_ _9"></span>then <span class="_ _9"></span>undeﬁne</div><div class="t m0 x7c h26 y14ad ff1a fsf fc0 sc0 ls0 ws0">FD_SETSIZE<span class="ff19 ls86">.N<span class="_ _4a"></span><span class="ls0">ote that some systems use<span class="_"> </span><span class="ff1a ls1863">__<span class="_ _a"></span><span class="ls0">FD_SETSIZE<span class="_ _80"> </span><span class="ff19">instead.</span></span></span></span></span></div><div class="t m0 xe2 h26 y1152 ff19 fsf fc0 sc0 ls0 ws0">3. <span class="_ _51"> </span>W<span class="_ _6"></span><span class="ls1864">en<span class="_ _b"></span><span class="ls0">eed <span class="_ _9"></span>to <span class="_ _23"></span>r<span class="_ _0"></span>edeﬁne<span class="_ _45"> </span><span class="ff1a">FD_SETSIZE<span class="_ _45"> </span></span>(or<span class="ff1a ls1863">__<span class="_ _a"></span><span class="ls0">FD_SETSIZE<span class="ff19 ls1864">)t<span class="_ _b"></span><span class="ls1865">ot<span class="_ _b"></span><span class="ls0">he <span class="_ _9"></span>maximum <span class="_ _23"></span>ﬁle</span></span></span></span></span></span></span></div><div class="t m0 x7c h26 y1153 ff19 fsf fc0 sc0 ls0 ws0">descriptor number we want to be able to use with<span class="_"> </span><span class="ff1a">select</span>.</div><div class="t m0 xe2 h2a y39d8 ff19 fsf fc0 sc0 ls0 ws0">4. <span class="_ _51"> </span>W<span class="_ _6"></span><span class="ls44">en<span class="_ _d"></span><span class="ls0">eed to undeﬁne the symbols we deﬁned in step 1.</span></span></div><div class="t m0 xe2 h26 y10ab ff19 fsf fc0 sc0 ls0 ws0">5. <span class="_ _51"> </span>Finally<span class="_ _4"></span>,<span class="_"> </span>we<span class="_"> </span>can include<span class="_"> </span><span class="ff1a">&lt;sys/select.h&gt;</span>.</div><div class="t m0 xe2 h2a y517c ff19 fsf fc0 sc0 ls0 ws0">Before<span class="_"> </span>we<span class="_ _47"> </span>run <span class="_ _2"></span>the <span class="_ _2"></span>program, <span class="_ _2"></span>we <span class="_ _2"></span>need <span class="_ _2"></span>to <span class="_ _3"></span>conﬁgur<span class="ls1852">et<span class="_ _8"></span><span class="ls0">he <span class="_ _2"></span>system <span class="_ _3"></span>to <span class="_ _2"></span>allow <span class="_ _2"></span>us <span class="_ _3"></span>to <span class="_ _2"></span>open</span></span></div><div class="t m0 xe2 h2a y517d ff19 fsf fc0 sc0 ls0 ws0">as <span class="_ _9"></span>many <span class="_ _23"></span>ﬁle <span class="_ _9"></span>descriptors <span class="_ _23"></span>as <span class="_ _9"></span>we <span class="_ _23"> </span>might <span class="_ _23"></span>need <span class="_ _9"></span>so <span class="_ _23"></span>that <span class="_ _9"></span>we <span class="_ _23"></span>can <span class="_ _9"></span>actually <span class="_ _23"></span>make <span class="_ _9"></span>use <span class="_ _23"></span>of</div><div class="t m0 xe2 h26 y5863 ff1a fsf fc0 sc0 ls0 ws0">FD_SETSIZE<span class="_ _80"> </span><span class="ff19">ﬁle descriptors.</span></div><div class="t m0 x32 h2a y94a ff18 fsf fc0 sc0 ls0 ws0">14.4<span class="_ _210"> </span><span class="ff19">The following table lists the functions that do similar things.</span></div><div class="t m0 x121 h5e y6207 ff1a fs10 fc0 sc0 ls0 ws0">FD_ZERO <span class="_ _6e"> </span>sigemptyset</div><div class="t m0 x121 h5e y6208 ff1a fs10 fc0 sc0 ls0 ws0">FD_SET <span class="_ _75"> </span>sigaddset</div><div class="t m0 x121 h5e y6209 ff1a fs10 fc0 sc0 ls0 ws0">FD_CLR <span class="_ _75"> </span>sigdelset</div><div class="t m0 x121 h5e y620a ff1a fs10 fc0 sc0 ls0 ws0">FD_ISSET <span class="_ _48"> </span>sigismember</div><div class="t m0 xe2 h54 y620b ff19 fs2c fc0 sc0 ls0 ws0">There<span class="_ _47"> </span>is<span class="_ _47"> </span>not <span class="_ _9"></span>an<span class="_ _45"> </span><span class="ff1a">FD_xxx<span class="_ _47"> </span></span>function <span class="_ _9"></span>that <span class="_ _3"></span>corresponds <span class="_ _3"></span>to<span class="_ _45"> </span><span class="ff1a">sigfillset</span><span class="ls1866">.W<span class="_ _7"></span><span class="ls0">ith <span class="_ _9"></span>signal</span></span></div><div class="t m0 xe2 h55 y620c ff19 fs2c fc0 sc0 ls0 ws0">sets, <span class="_ _2"></span>the <span class="_ _3"></span>pointer <span class="_ _3"></span>to <span class="_ _3"></span>the <span class="_ _3"></span>set <span class="_ _3"></span>is <span class="_ _3"></span>always <span class="_ _2"></span>the <span class="_ _3"></span>ﬁrst <span class="_ _3"></span>argument, <span class="_ _2"></span>and <span class="_ _3"></span>the <span class="_ _3"></span>signal <span class="_ _3"></span>number <span class="_ _3"></span>is</div><div class="t m0 xe2 h55 y620d ff19 fs2c fc0 sc0 ls0 ws0">the <span class="_ _53"> </span>second <span class="_ _53"> </span>argument. <span class="_ _4b"> </span>W<span class="_ _1"></span>ith <span class="_ _53"> </span>descriptor <span class="_ _e"> </span>sets, <span class="_ _53"> </span>the <span class="_ _53"> </span>descriptor <span class="_ _e"> </span>number <span class="_ _53"> </span>is <span class="_ _e"> </span>the <span class="_ _53"> </span>ﬁrst</div><div class="t m0 xe2 h55 y620e ff19 fs2c fc0 sc0 ls0 ws0">argument, and the pointer to the set is the next ar<span class="_ _0"></span>gument.</div><div class="t m0 x32 h54 y620f ff18 fs2c fc0 sc0 ls0 ws0">14.5<span class="_ _210"> </span><span class="ff19">Figur<span class="ls142">eC<span class="_ _d"></span><span class="ls0">.16 shows an implementation using<span class="_"> </span><span class="ff1a">select</span>.</span></span></span></div><div class="t m0 xe2 h62 y6210 ff1a fs30 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 xe2 h62 y6211 ff1a fs30 fc0 sc0 ls0 ws0">#include &lt;sys/select.h&gt;</div><div class="t m0 xe2 h62 y6212 ff1a fs30 fc0 sc0 ls0 ws0">void</div><div class="t m0 xe2 h62 y6213 ff1a fs30 fc0 sc0 ls0 ws0">sleep_us(unsigned int nusecs)</div><div class="t m0 xe2 h62 y6214 ff1a fs30 fc0 sc0 ls0 ws0">{</div><div class="t m0 x60 h62 y6215 ff1a fs30 fc0 sc0 ls0 ws0">struct timeval<span class="_ _d9"> </span>tval;</div><div class="t m0 x60 h62 y6216 ff1a fs30 fc0 sc0 ls0 ws0">tval.tv_sec = nusecs / 1000000;</div><div class="t m0 x60 h62 y6217 ff1a fs30 fc0 sc0 ls0 ws0">tval.tv_usec = nusecs % 1000000;</div><div class="t m0 x60 h62 y6218 ff1a fs30 fc0 sc0 ls0 ws0">select(0, NULL, NULL, NULL, &amp;tval);</div><div class="t m0 xe2 h62 y6219 ff1a fs30 fc0 sc0 ls0 ws0">}</div><div class="t m0 x3d h63 y621a ff18 fs13 fc0 sc0 ls0 ws0">Figure C.16<span class="_ _5a"> </span><span class="ff19">Implementation of<span class="_"> </span><span class="ff1a">sleep_us<span class="_ _e"> </span></span>using<span class="_"> </span><span class="ff1a">select</span></span></div><div class="t m0 xe2 h64 y621b ff19 fs31 fc0 sc0 ls0 ws0">Figur<span class="ls229">eC<span class="_ _4f"></span><span class="ls0">.17 shows an implementation using<span class="_"> </span><span class="ff1a">poll</span>.</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
