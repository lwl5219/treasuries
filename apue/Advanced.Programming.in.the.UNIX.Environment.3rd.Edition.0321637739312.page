<div id="pf138" class="pf w4 h1f" data-page-no="138"><div class="pc pc138 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg138.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">278<span class="_ _1b"> </span><span class="ff19">Process <span class="_"> </span>Contr<span class="_ _0"></span>ol <span class="_ _222"> </span>Chapter<span class="_ _4b"> </span>8</span></div><div class="t m0 x32 h2a y12f ff19 fsf fc0 sc0 ls0 ws0">optional <span class="_ _42"> </span>command <span class="_ _23"> </span>argument. <span class="_ _35"> </span>After<span class="_ _44"> </span><span class="ls4e">ru</span>nning <span class="_ _42"> </span>for <span class="_ _23"> </span>10 <span class="_ _42"> </span>seconds, <span class="_ _42"> </span>both <span class="_ _42"> </span>pr<span class="_ _0"></span>ocesses <span class="_ _42"> </span>print <span class="_ _23"> </span>the</div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">value <span class="_ _e"> </span>of <span class="_ _e"> </span>their <span class="_ _e"> </span>counter <span class="_ _e"> </span>and <span class="_"> </span>exit.<span class="_ _65"> </span>By <span class="_ _e"> </span>comparing <span class="_ _e"> </span>the <span class="_ _e"> </span>counter <span class="_ _e"> </span>values <span class="_"> </span>for <span class="_ _53"> </span>differ<span class="_ _0"></span>ent <span class="_ _e"> </span>nice</div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">values, we can get an idea how the nice value affects pr<span class="_ _0"></span>ocess scheduling.</div><div class="t m0 x32 h4e y245e ff1a fs28 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h4e y245f ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;errno.h&gt;</div><div class="t m0 x32 h4e y2460 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;sys/time.h&gt;</div><div class="t m0 x32 h4e y2461 ff1a fs28 fc0 sc0 ls0 ws0">#if defined(MACOS)</div><div class="t m0 x32 h4e y2462 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;sys/syslimits.h&gt;</div><div class="t m0 x32 h4e y2463 ff1a fs28 fc0 sc0 ls0 ws0">#elif defined(SOLARIS)</div><div class="t m0 x32 h4e y2464 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;limits.h&gt;</div><div class="t m0 x32 h4e y2465 ff1a fs28 fc0 sc0 ls0 ws0">#elif defined(BSD)</div><div class="t m0 x32 h4e y2466 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;sys/param.h&gt;</div><div class="t m0 x32 h4e y2467 ff1a fs28 fc0 sc0 ls0 ws0">#endif</div><div class="t m0 x32 h4e y2468 ff1a fs28 fc0 sc0 ls0 ws0">unsigned long long count;</div><div class="t m0 x32 h4e y2469 ff1a fs28 fc0 sc0 ls0 ws0">struct timeval end;</div><div class="t m0 x32 h4e y246a ff1a fs28 fc0 sc0 ls0 ws0">void</div><div class="t m0 x32 h4e y246b ff1a fs28 fc0 sc0 ls0 ws0">checktime(char *str)</div><div class="t m0 x32 h4e y246c ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y246d ff1a fs28 fc0 sc0 ls0 ws0">struct timeval<span class="_ _d9"> </span>tv;</div><div class="t m0 x8a h4e y246e ff1a fs28 fc0 sc0 ls0 ws0">gettimeofday(&amp;tv, NULL);</div><div class="t m0 x8a h4e y246f ff1a fs28 fc0 sc0 ls0 ws0">if (tv.tv_sec &gt;= end.tv_sec &amp;&amp; tv.tv_usec &gt;= end.tv_usec) {</div><div class="t m0 x9d h4e y2470 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;%s count = %lld\n&quot;, str, count);</div><div class="t m0 x9d h4e y2471 ff1a fs28 fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x8a h4e y2472 ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h4e y2473 ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h4e y2474 ff1a fs28 fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h4e y2475 ff1a fs28 fc0 sc0 ls0 ws0">main(int argc, char *argv[])</div><div class="t m0 x32 h4e y2476 ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y2477 ff1a fs28 fc0 sc0 ls0 ws0">pid_t <span class="_ _d9"> </span>pid;</div><div class="t m0 x8a h4e y2478 ff1a fs28 fc0 sc0 ls0 ws0">char <span class="_ _68"> </span>*s;</div><div class="t m0 x8a h4e y2479 ff1a fs28 fc0 sc0 ls0 ws0">int <span class="_ _15"> </span>nzero,<span class="_"> </span>ret;</div><div class="t m0 x8a h4e y247a ff1a fs28 fc0 sc0 ls0 ws0">int <span class="_ _15"> </span>adj<span class="_"> </span><span class="ls1b6">=0<span class="_ _1d"></span><span class="ls0">;</span></span></div><div class="t m0 x8a h4e y247b ff1a fs28 fc0 sc0 ls0 ws0">setbuf(stdout, NULL);</div><div class="t m0 x32 h4e y247c ff1a fs28 fc0 sc0 ls0 ws0">#if defined(NZERO)</div><div class="t m0 x8a h4e y247d ff1a fs28 fc0 sc0 ls0 ws0">nzero = NZERO;</div><div class="t m0 x32 h4e y247e ff1a fs28 fc0 sc0 ls0 ws0">#elif defined(_SC_NZERO)</div><div class="t m0 x8a h4e y247f ff1a fs28 fc0 sc0 ls0 ws0">nzero = sysconf(_SC_NZERO);</div><div class="t m0 x32 h4e y2480 ff1a fs28 fc0 sc0 ls0 ws0">#else</div><div class="t m0 x32 h4e y2481 ff1a fs28 fc0 sc0 ls0 ws0">#error NZERO undefined</div><div class="t m0 x32 h4e y2482 ff1a fs28 fc0 sc0 ls0 ws0">#endif</div><div class="t m0 x8a h4e y2483 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;NZERO = %d\n&quot;, nzero);</div><div class="t m0 x8a h4e y2484 ff1a fs28 fc0 sc0 ls0 ws0">if (argc == 2)</div><div class="t m0 x9d h4e y2485 ff1a fs28 fc0 sc0 ls0 ws0">adj = strtol(argv[1], NULL, 10);</div><div class="t m0 x8a h4e y2486 ff1a fs28 fc0 sc0 ls0 ws0">gettimeofday(&amp;end, NULL);</div><div class="t m0 x8a h4e y2487 ff1a fs28 fc0 sc0 ls0 ws0">end.tv_sec += 10;<span class="_ _68"> </span>/* run for 10 seconds */</div><div class="t m0 x8a h4e y2488 ff1a fs28 fc0 sc0 ls0 ws0">if ((pid = fork()) &lt; 0) {</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
