<div id="pf2e8" class="pf w4 h1f" data-page-no="2e8"><div class="pc pc2e8 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg2e8.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">710<span class="_ _1b"> </span><span class="ff19 ls719">Te<span class="_ _9"></span><span class="ls0">rminal <span class="_"> </span>I/O<span class="_ _eb"> </span>Chapter <span class="_"> </span>18</span></span></div><div class="t m0 x3f h2a y12f ff19 fsf fc0 sc0 ls0 ws0">Running <span class="_ _53"> </span>the <span class="_ _53"> </span>program <span class="_ _42"> </span>in <span class="_ _53"> </span>Figur<span class="ls14a6">e1<span class="_ _55"></span><span class="ls0">8.21, <span class="_ _53"> </span>we <span class="_ _53"> </span>can <span class="_ _53"> </span>see <span class="_ _53"> </span>what <span class="_ _53"> </span>happens <span class="_ _53"> </span>with <span class="_ _53"> </span>these <span class="_ _53"> </span>two</span></span></div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">terminal modes:</div><div class="t m0 x3f h57 y1c09 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">./a.out</span></div><div class="t m0 x3f h57 y1c0a ff1a fs2d fc0 sc0 ls0 ws0">Enter raw mode characters, terminate with DELETE</div><div class="t m0 x1 h57 y1c0b ff1a fs2d fc0 sc0 ls0 ws0">4</div><div class="t m0 xba h57 y1c0c ff1a fs2d fc0 sc0 ls0 ws0">33</div><div class="t m0 x49 h57 y1c0d ff1a fs2d fc0 sc0 ls0 ws0">133</div><div class="t m0 x1b5 h57 y1c0e ff1a fs2d fc0 sc0 ls0 ws0">61</div><div class="t m0 x1d7 h57 y1d56 ff1a fs2d fc0 sc0 ls0 ws0">70</div><div class="t m0 x1ae h57 y1d57 ff1a fs2d fc0 sc0 ls0 ws0">176</div><div class="t m0 xb5 h58 y1d58 ff1b fs2d fc0 sc0 ls0 ws0">type DELETE</div><div class="t m0 x3f h57 y1d59 ff1a fs2d fc0 sc0 ls0 ws0">Enter cbreak mode characters, terminate with SIGINT</div><div class="t m0 x3f h57 y1d5a ff1a fs2d fc0 sc0 ls0 ws0">1<span class="_ _168"> </span><span class="ff1b">type Control-A</span></div><div class="t m0 x3f h57 y1d5b ff1a fs2d fc0 sc0 ls0 ws0">10<span class="_ _22c"> </span><span class="ff1b">type backspace</span></div><div class="t m0 x3f h57 y521a ff1a fs2d fc0 sc0 ls0 ws0">signal caught<span class="_ _30c"> </span><span class="ff1b">type interrupt key</span></div><div class="t m0 x32 h2a y521b ff19 fsf fc0 sc0 ls0 ws0">In <span class="_ _9"></span>raw <span class="_ _23"> </span>mode, <span class="_ _23"></span>the <span class="_ _9"></span>characters <span class="_ _23"> </span>entered <span class="_ _9"></span>wer<span class="lseb">eC<span class="_ _b"></span><span class="ls0">ontr<span class="_ _0"></span>ol</span></span></div><div class="t m0 x5d h2a y521c ff19 fsf fc0 sc0 ls0 ws0">-</div><div class="t m0 x19d h2a y521b ff19 fsf fc0 sc0 ls0 ws0">D</div><div class="t m0 x65 h2a y521d ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 xa1 h2a y521b ff19 fsf fc0 sc0 ls0 ws0">04</div><div class="t m0 x1bf h2a y521d ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 xad h2a y521b ff19 fsf fc0 sc0 ls0 ws0">and <span class="_ _9"></span>the <span class="_ _23"> </span>special <span class="_ _23"></span>function <span class="_ _9"></span>key</div><div class="t m0 x32 h2b y521e ff19 fsf fc0 sc0 ls0 ws0">F7. <span class="_"> </span>On<span class="_ _47"> </span>the terminal <span class="_ _2"></span>being <span class="_ _2"></span>used, <span class="_ _2"></span>this <span class="_ _2"></span>function key <span class="_ _2"></span>generated <span class="_ _2"></span>ﬁve <span class="_ _2"></span>characters:<span class="_ _66"> </span><span class="ff1b">ESC</span></div><div class="t m0 x21e h2a y521f ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 x57 h2a y521e ff19 fsf fc0 sc0 ls0 ws0">033</div><div class="t m0 x40 h2a y521f ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 xcf h2b y521e ff19 fsf fc0 sc0 ls0 ws0">,<span class="_"> </span><span class="ff1b">[</span></div><div class="t m0 x32 h2a y5220 ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 x62 h2a y5221 ff19 fsf fc0 sc0 ls0 ws0">0133</div><div class="t m0 x90 h2a y5220 ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 x9 h2b y5221 ff19 fsf fc0 sc0 ls0 ws0">,<span class="_ _47"> </span><span class="ff1b">1</span></div><div class="t m0 x2d h2a y5220 ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 x9d h2a y5221 ff19 fsf fc0 sc0 ls0 ws0">061</div><div class="t m0 x1b0 h2a y5220 ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 x159 h2b y5221 ff19 fsf fc0 sc0 ls0 ws0">,<span class="_ _47"> </span><span class="ff1b">8</span></div><div class="t m0 xae h2a y5220 ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 x50 h2a y5221 ff19 fsf fc0 sc0 ls0 ws0">070</div><div class="t m0 xea h2a y5220 ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 x10d h2b y5221 ff19 fsf fc0 sc0 ls274 ws0">,a<span class="_ _8"></span><span class="ls0">nd<span class="_ _47"> </span><span class="ff1b">˜</span></span></div><div class="t m0 xb7 h2a y5220 ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 x66 h2a y5221 ff19 fsf fc0 sc0 ls0 ws0">0176</div><div class="t m0 x1e3 h2a y5220 ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 xc1 h2a y5221 ff19 fsf fc0 sc0 ls1090 ws0">.N<span class="_ _62"></span><span class="ls0">ote <span class="_ _9"></span>that <span class="_ _3"></span>with <span class="_ _3"></span>the <span class="_ _3"></span>output <span class="_ _3"></span>processing <span class="_ _3"></span>turned <span class="_ _3"></span>of<span class="ls4f5">fi<span class="_ _8"></span><span class="ls0">n</span></span></span></div><div class="t m0 x32 h26 y5222 ff19 fsf fc0 sc0 ls0 ws0">raw <span class="_ _3"></span>mode <span class="_ _9"></span>(<span class="ff1a">˜OPOST</span>), <span class="_ _9"></span>we <span class="_ _9"></span>do <span class="_ _3"></span>not <span class="_ _9"></span>get <span class="_ _9"></span>a <span class="_ _3"></span>carriage <span class="_ _9"></span>return <span class="_ _3"></span>output <span class="_ _9"></span>after <span class="_ _9"></span>each <span class="_ _3"></span>character<span class="_ _1"></span><span class="ls152b">.A<span class="_ _62"></span><span class="ls0">lso</span></span></div><div class="t m0 x32 h2a y5223 ff19 fsf fc0 sc0 ls0 ws0">note <span class="_"> </span>that <span class="_"> </span>special-character <span class="_"> </span>processing <span class="_"> </span>is <span class="_"> </span>disabled <span class="_"> </span>in <span class="_ _66"> </span>cbreak <span class="_"> </span>mode <span class="_"> </span>(so, <span class="_"> </span>for <span class="_ _66"> </span>example,</div><div class="t m0 x32 h2a y5224 ff19 fsf fc0 sc0 ls0 ws0">Control</div><div class="t m0 x183 h2a y5225 ff19 fsf fc0 sc0 ls0 ws0">-</div><div class="t m0 x135 h2a y5224 ff19 fsf fc0 sc0 ls0 ws0">D, <span class="_ _23"> </span>the <span class="_ _42"> </span>end-of-ﬁle <span class="_ _42"> </span>character<span class="_ _6"></span><span class="ls9ed">,a<span class="_ _43"></span><span class="ls0">nd <span class="_ _42"> </span>backspace <span class="_ _23"> </span>aren’t <span class="_ _23"> </span>handled <span class="_ _42"> </span>specially), <span class="_ _42"> </span>whereas</span></span></div><div class="t m0 x32 h2a y5226 ff19 fsf fc0 sc0 ls0 ws0">the terminal-generated signals ar<span class="ls44">es<span class="_ _4f"></span><span class="ls0">till processed.</span></span></div><div class="t m0 x35 h4b y5227 ff16 fs27 fc0 sc0 ls0 ws0">18.12 <span class="_ _66"> </span>T<span class="_ _6"></span>erminal <span class="_"> </span>Windo<span class="ls5d5">wS<span class="_ _52"></span><span class="ls0">iz <span class="_ _b"></span>e</span></span></div><div class="t m0 x32 h49 y5228 ff19 fs26 fc0 sc0 ls0 ws0">Most <span class="_ _9"></span>UNIX <span class="_ _23"></span>systems <span class="_ _9"></span>provide <span class="_ _23"></span>a <span class="_ _9"></span>way <span class="_ _23"></span>to <span class="_ _9"></span>keep <span class="_ _23"></span>track <span class="_ _9"></span>of <span class="_ _23"></span>the <span class="_ _23"></span>curr<span class="_ _0"></span>ent <span class="_ _9"></span>terminal <span class="_ _23"></span>window <span class="_ _9"></span>size</div><div class="t m0 x32 h49 y5229 ff19 fs26 fc0 sc0 ls0 ws0">and to <span class="_ _2"></span>have <span class="_ _2"></span>the <span class="_ _2"></span>kernel <span class="_ _2"></span>notify <span class="_ _2"></span>the <span class="_ _2"></span>foregr<span class="_ _0"></span>ound process <span class="_ _2"></span>group when <span class="_ _2"></span>the <span class="_ _2"></span>size <span class="_ _2"></span>changes.<span class="_ _46"> </span>The</div><div class="t m0 x32 h4d y522a ff19 fs26 fc0 sc0 ls0 ws0">kernel maintains a<span class="_"> </span><span class="ff1a">winsize<span class="_ _80"> </span></span>structur<span class="lsd3">ef<span class="_ _4f"></span><span class="ls0">or every terminal and pseudo terminal:</span></span></div><div class="t m0 x3f h4e y522b ff1a fs28 fc0 sc0 ls0 ws0">struct winsize {</div><div class="t m0 xf4 h4e y522c ff1a fs28 fc0 sc0 ls0 ws0">unsigned short<span class="_ _d9"> </span>ws_row; <span class="_ _15"> </span>/*<span class="_"> </span>rows, in characters */</div><div class="t m0 xf4 h4e y522d ff1a fs28 fc0 sc0 ls0 ws0">unsigned short<span class="_ _d9"> </span>ws_col; <span class="_ _15"> </span>/*<span class="_"> </span>columns, in characters */</div><div class="t m0 xf4 h4e y522e ff1a fs28 fc0 sc0 ls0 ws0">unsigned short<span class="_ _d9"> </span>ws_xpixel; <span class="_"> </span>/*<span class="_"> </span>horizontal size, pixels (unused) */</div><div class="t m0 xf4 h4e y522f ff1a fs28 fc0 sc0 ls0 ws0">unsigned short<span class="_ _d9"> </span>ws_ypixel; <span class="_"> </span>/*<span class="_"> </span>vertical size, pixels (unused) */</div><div class="t m0 x3f h4e y5230 ff1a fs28 fc0 sc0 ls0 ws0">};</div><div class="t m0 x32 h49 y5231 ff19 fs26 fc0 sc0 ls0 ws0">The rules for this structur<span class="_ _0"></span><span class="lsd3">ea<span class="_ _d"></span><span class="lscc">re <span class="_ _2"></span>a<span class="_ _2"></span><span class="lsd3">sf<span class="_ _d"></span><span class="ls0">ollows:</span></span></span></span></div><div class="t m0 x3f h4d y5232 ff19 fs26 fc0 sc0 ls15d ws0">•W<span class="_ _4e"></span><span class="ls152c">ec<span class="_ _4f"></span><span class="ls0">an <span class="_ _3"></span>fetch <span class="_ _2"></span>the <span class="_ _3"></span>current <span class="_ _2"></span>value <span class="_ _2"></span>of <span class="_ _3"></span>this <span class="_ _3"></span>structur<span class="ls152c">eu<span class="_ _8"></span><span class="ls0">sing <span class="_ _2"></span>an<span class="_ _47"> </span><span class="ff1a">ioctl<span class="_ _47"> </span></span>(Section <span class="_ _2"></span>3.15) <span class="_ _3"></span>of</span></span></span></span></div><div class="t m0 x15 h4d y5233 ff1a fs26 fc0 sc0 ls0 ws0">TIOCGWINSZ<span class="ff19">.</span></div><div class="t m0 x3f h4d y5234 ff19 fs26 fc0 sc0 ls15d ws0">•W<span class="_ _4e"></span><span class="ls152d">ec<span class="_ _55"></span><span class="ls0">an <span class="_"> </span>stor<span class="_ _0"></span><span class="ls152d">ean<span class="_ _55"></span><span class="ls0">ew <span class="_ _e"> </span>value <span class="_ _e"> </span>of <span class="_ _e"> </span>this <span class="_ _e"> </span>structure<span class="_ _4b"> </span>in<span class="_ _4b"> </span>the <span class="_ _e"> </span>kernel <span class="_ _e"> </span>using <span class="_"> </span>an<span class="_ _44"> </span><span class="ff1a">ioctl<span class="_ _59"> </span></span>of</span></span></span></span></div><div class="t m0 x15 h4d y5235 ff1a fs26 fc0 sc0 ls0 ws0">TIOCSWINSZ<span class="ff19 ls152e">.I<span class="_ _64"></span><span class="ls152f">ft<span class="_ _55"></span><span class="ls0">his <span class="_ _e"> </span>new <span class="_ _e"> </span>value <span class="_"> </span>dif<span class="_ _1"></span>fers <span class="_"> </span>fr<span class="_ _0"></span>om <span class="_ _53"> </span>the <span class="_"> </span>curr<span class="_ _0"></span>ent <span class="_ _e"> </span>value <span class="_ _e"> </span>stored <span class="_ _53"> </span>in <span class="_"> </span>the</span></span></span></div><div class="t m0 x15 h4d y5236 ff19 fs26 fc0 sc0 ls0 ws0">kernel, <span class="_ _3"></span>a<span class="_ _45"> </span><span class="ff1a">SIGWINCH<span class="_ _47"> </span></span>signal <span class="_ _3"></span>is <span class="_ _9"></span>sent <span class="_ _3"></span>to <span class="_ _9"></span>the <span class="_ _3"></span>foreground <span class="_ _2"></span>process <span class="_ _3"></span>group. <span class="_ _47"> </span>(Note<span class="_ _45"> </span>from</div><div class="t m0 x15 h49 y5237 ff19 fs26 fc0 sc0 ls0 ws0">Figur<span class="lsd3">e1<span class="_ _4f"></span><span class="ls0">0.1 that the default action for this signal is to be ignored.)</span></span></div><a class="l" href="#pf13" data-dest-detail='[19,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892634px;bottom:617.943890px;width:168.588691px;height:19.680023px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
