<div id="pf3b0" class="pf w4 h1f" data-page-no="3b0"><div class="pc pc3b0 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg3b0.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">910<span class="_ _1b"> </span><span class="ff19">Solutions <span class="_"> </span>to <span class="_"> </span>Selected <span class="_"> </span>Exercises <span class="_ _2eb"> </span>Appendix<span class="_ _4b"> </span>C</span></div><div class="t m0 x215 h26 y12f ff1a fsf fc0 sc0 ls0 ws0">tempfile<span class="ff19 ls14ae">.W<span class="_ _5d"></span><span class="ls1298">eh<span class="_ _43"></span><span class="ls0">ave <span class="_ _23"> </span>to <span class="_ _42"> </span>use <span class="_ _42"> </span>the<span class="_ _44"> </span><span class="ff1a">df<span class="_ _35"> </span></span>command <span class="_ _42"> </span>in <span class="_ _42"> </span>this <span class="_ _42"> </span>example <span class="_ _42"> </span>to <span class="_ _42"> </span>see <span class="_ _42"> </span>the <span class="_ _42"> </span>actual</span></span></span></div><div class="t m0 x215 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">amount of free space on the ﬁle system.</div><div class="t m0 x32 h2a y114d ff18 fsf fc0 sc0 ls0 ws0">4.9<span class="_ _9b"> </span><span class="ff19">If the <span class="_ _3"></span>link <span class="_ _2"></span>being <span class="_ _3"></span>removed <span class="_ _2"></span>is <span class="_ _2"></span>not <span class="_ _3"></span>the <span class="_ _2"></span>last <span class="_ _3"></span>link <span class="_ _2"></span>to <span class="_ _3"></span>the <span class="_ _2"></span>ﬁle, <span class="_ _3"></span>the <span class="_ _2"></span>ﬁle <span class="_ _3"></span>is <span class="_ _2"></span>not <span class="_ _3"></span>removed. <span class="_ _66"> </span>In</span></div><div class="t m0 x215 h2a y114e ff19 fsf fc0 sc0 ls0 ws0">this <span class="_ _53"> </span>case, <span class="_ _e"> </span>the <span class="_ _e"> </span>changed-status <span class="_ _e"> </span>time <span class="_ _53"> </span>of <span class="_ _e"> </span>the <span class="_ _e"> </span>ﬁle <span class="_ _e"> </span>is <span class="_ _e"> </span>updated.<span class="_ _65"> </span>But <span class="_ _e"> </span>if <span class="_ _e"> </span>the <span class="_ _53"> </span>link <span class="_ _e"> </span>being</div><div class="t m0 x215 h2a y2936 ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">moved <span class="_ _3"></span>is <span class="_ _9"></span>the <span class="_ _3"></span>last <span class="_ _3"></span>link <span class="_ _3"></span>to <span class="_ _3"></span>the <span class="_ _3"></span>ﬁle, <span class="_ _3"></span>it <span class="_ _3"></span>makes <span class="_ _9"></span>no <span class="_ _3"></span>sense <span class="_ _3"></span>to <span class="_ _3"></span>update <span class="_ _3"></span>this <span class="_ _3"></span>time, <span class="_ _3"></span>because</span></div><div class="t m0 x215 h2a y2914 ff19 fsf fc0 sc0 ls0 ws0">all the information about the ﬁle (the i-node) is removed with the ﬁle.</div><div class="t m0 x32 h26 y296d ff18 fsf fc0 sc0 ls0 ws0">4.10<span class="_ _1a3"> </span><span class="ff19 ls5f">We <span class="_ _e"> </span>r<span class="_ _9"></span><span class="ls0">ecursively <span class="_ _2"></span>call <span class="_ _2"></span>our <span class="_ _2"></span>function<span class="_ _47"> </span><span class="ff1a">dopath<span class="_ _66"> </span></span>after <span class="_ _2"></span>opening <span class="_ _2"></span>a <span class="_ _2"></span>directory with<span class="_ _47"> </span><span class="ff1a">opendir</span>.</span></span></div><div class="t m0 x215 h26 y1151 ff19 fsf fc0 sc0 ls0 ws0">Assuming that<span class="_"> </span><span class="ff1a">opendir<span class="_ _80"> </span></span>uses <span class="_ _2"></span>a single ﬁle descriptor<span class="_ _1"></span><span class="ls647">,t<span class="_ _d"></span><span class="ls0">his means that each time we</span></span></div><div class="t m0 x215 h2a y1152 ff19 fsf fc0 sc0 ls0 ws0">descend one level, we use <span class="_ _2"></span>another descriptor<span class="_ _1"></span><span class="ls1813">.(<span class="_ _5b"></span><span class="ls5f">We <span class="_ _e"> </span>a<span class="_ _9"></span><span class="ls0">ssume that <span class="_ _2"></span>the descriptor isn’t</span></span></span></div><div class="t m0 x215 h26 y1153 ff19 fsf fc0 sc0 ls0 ws0">closed <span class="_ _9"></span>until <span class="_ _23"> </span>we’r<span class="ls60">eﬁ<span class="_ _43"></span><span class="ls0">nished <span class="_ _23"> </span>with <span class="_ _23"></span>a <span class="_ _9"></span>directory <span class="_ _9"></span>and <span class="_ _23"> </span>call<span class="_ _35"> </span><span class="ff1a">closedir</span>.) <span class="_ _45"> </span>This<span class="_ _45"> </span>limits <span class="_ _23"> </span>the</span></span></div><div class="t m0 x215 h2a y1154 ff19 fsf fc0 sc0 ls0 ws0">depth of the ﬁle <span class="_ _2"></span>system tree that we can <span class="_ _2"></span>traverse to the <span class="_ _2"></span>maximum number of open</div><div class="t m0 x215 h26 y1155 ff19 fsf fc0 sc0 ls0 ws0">descriptors <span class="_ _23"> </span>for <span class="_ _23"> </span>the <span class="_ _42"> </span>process. <span class="_ _45"> </span>Note<span class="_ _35"> </span>that <span class="_ _42"> </span>the<span class="_ _35"> </span><span class="ff1a">nftw<span class="_ _35"> </span></span>function <span class="_ _23"> </span>as <span class="_ _23"> </span>speciﬁed <span class="_ _42"> </span>in <span class="_ _23"> </span>the <span class="_ _23"> </span>XSI</div><div class="t m0 x215 h2a y961 ff19 fsf fc0 sc0 ls0 ws0">option <span class="_ _2"></span>of <span class="_ _3"></span>the <span class="_ _3"></span>Single <span class="_ _2"></span>UNIX <span class="_ _3"></span>Speciﬁcation <span class="_ _3"></span>allows <span class="_ _2"></span>the <span class="_ _3"></span>caller <span class="_ _3"></span>to <span class="_ _3"></span>specify <span class="_ _2"></span>the <span class="_ _3"></span>number <span class="_ _3"></span>of</div><div class="t m0 x215 h2a y962 ff19 fsf fc0 sc0 ls0 ws0">descriptors to use, implying that it can close and reuse descriptors.</div><div class="t m0 x32 h26 y3552 ff18 fsf fc0 sc0 ls0 ws0">4.12<span class="_ _1a3"> </span><span class="ff19">The<span class="_ _47"> </span><span class="ff1a">chroot<span class="_ _66"> </span></span>function <span class="_ _2"></span>is <span class="_ _2"></span>used <span class="_ _2"></span>by <span class="_ _3"></span>the <span class="_ _2"></span>Internet <span class="_ _2"></span>File <span class="_ _2"></span>T<span class="_ _6"></span>ransfer <span class="_ _2"></span>Protocol</span></div><div class="t m0 x1c3 h2a y605d ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 x1cc h2a y3552 ff19 fsf fc0 sc0 ls0 ws0">FTP</div><div class="t m0 xd5 h2a y605d ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 xd6 h2a y3552 ff19 fsf fc0 sc0 ls0 ws0">program</div><div class="t m0 x215 h2b y3553 ff19 fsf fc0 sc0 ls0 ws0">to <span class="_ _23"></span>aid <span class="_ _23"></span>in <span class="_ _23"> </span>security<span class="_ _4"></span><span class="ls1814">.U<span class="_ _26"></span><span class="ls0">sers <span class="_ _23"> </span>without <span class="_ _23"> </span>accounts <span class="_ _23"> </span>on <span class="_ _23"> </span>a <span class="_ _23"> </span>system <span class="_ _42"> </span>(termed<span class="_ _45"> </span><span class="ff1b">anonymous <span class="_ _23"> </span>FTP</span>)</span></span></div><div class="t m0 x215 h26 y1d9 ff19 fsf fc0 sc0 ls0 ws0">ar<span class="ls49d">ep<span class="_ _43"></span><span class="ls0">laced <span class="_ _23"></span>in <span class="_ _23"></span>a <span class="_ _23"> </span>separate <span class="_ _23"> </span>directory<span class="_ _4"></span><span class="ls1815">,a<span class="_ _b"></span><span class="ls0">nd <span class="_ _9"></span>a<span class="_ _35"> </span><span class="ff1a">chroot<span class="_ _35"> </span></span>is <span class="_ _23"></span>done <span class="_ _23"> </span>to <span class="_ _23"> </span>that <span class="_ _23"> </span>directory<span class="_ _4"></span><span class="ls1816">.T<span class="_ _26"></span><span class="ls0">his</span></span></span></span></span></span></div><div class="t m0 x215 h2a y1da ff19 fsf fc0 sc0 ls0 ws0">prevents the user fr<span class="_ _0"></span>om accessing any ﬁle outside this new r<span class="_ _0"></span>oot directory<span class="_ _4"></span>.</div><div class="t m0 x215 h26 y32b ff19 fsf fc0 sc0 ls0 ws0">In <span class="_ _23"></span>addition,<span class="_ _35"> </span><span class="ff1a">chroot<span class="_ _35"> </span></span>can <span class="_ _9"></span>be <span class="_ _42"> </span>used <span class="_ _23"></span>to <span class="_ _23"></span>build <span class="_ _23"></span>a <span class="_ _23"></span>copy <span class="_ _23"></span>of <span class="_ _23"></span>a <span class="_ _23"> </span>ﬁle <span class="_ _23"> </span>system <span class="_ _23"> </span>hierarchy <span class="_ _23"></span>at <span class="_ _23"></span>a</div><div class="t m0 x215 h2a y32c ff19 fsf fc0 sc0 ls0 ws0">new <span class="_ _23"> </span>location <span class="_ _42"> </span>and <span class="_ _23"> </span>then <span class="_ _42"> </span>modify <span class="_ _23"> </span>this <span class="_ _23"> </span>new <span class="_ _42"> </span>copy <span class="_ _23"> </span>without <span class="_ _42"> </span>changing <span class="_ _23"> </span>the <span class="_ _42"> </span>original <span class="_ _23"> </span>ﬁle</div><div class="t m0 x215 h2a y4faf ff19 fsf fc0 sc0 ls0 ws0">system. <span class="_ _45"> </span>This<span class="_ _45"> </span>could <span class="_ _9"></span>be <span class="_ _9"></span>used, <span class="_ _9"></span>for <span class="_ _9"></span>example, <span class="_ _9"></span>to <span class="_ _9"></span>test <span class="_ _9"></span>the <span class="_ _9"></span>installation <span class="_ _9"></span>of <span class="_ _9"></span>new <span class="_ _9"></span>software</div><div class="t m0 x215 h2a y4fb0 ff19 fsf fc0 sc0 ls0 ws0">packages.</div><div class="t m0 x215 h26 yec3 ff19 fsf fc0 sc0 ls0 ws0">Only <span class="_"> </span>the <span class="_"> </span>superuser <span class="_"> </span>can <span class="_"> </span>execute<span class="_ _46"> </span><span class="ff1a">chroot</span><span class="ls1817">,a<span class="_ _4a"></span><span class="ls0">nd <span class="_"> </span>once <span class="_"> </span>you <span class="_"> </span>change <span class="_"> </span>the <span class="_"> </span>root <span class="_"> </span>of <span class="_"> </span>a</span></span></div><div class="t m0 x215 h2a yec4 ff19 fsf fc0 sc0 ls0 ws0">process, it (and all its descendants) can never get back to the original r<span class="_ _0"></span>oot.</div><div class="t m0 x32 h26 y605e ff18 fsf fc0 sc0 ls0 ws0">4.13<span class="_ _1a3"> </span><span class="ff19">First, <span class="_ _53"> </span>call<span class="_ _4b"> </span><span class="ff1a">stat<span class="_ _44"> </span></span>to <span class="_ _53"> </span>fetch <span class="_ _53"> </span>the <span class="_ _53"> </span>three <span class="_ _53"> </span>times <span class="_ _53"> </span>for <span class="_ _53"> </span>the <span class="_ _53"> </span>ﬁle; <span class="_ _53"> </span>then <span class="_ _53"> </span>call<span class="_ _44"> </span><span class="ff1a">utime<span class="_ _4b"> </span></span>to <span class="_ _53"> </span>set <span class="_ _53"> </span>the</span></div><div class="t m0 x215 h26 y605f ff19 fsf fc0 sc0 ls0 ws0">desired <span class="_ _e"> </span>value.<span class="_ _60"> </span>The <span class="_"> </span>value <span class="_ _e"> </span>that <span class="_"> </span>we <span class="_"> </span>don’t <span class="_ _e"> </span>want <span class="_"> </span>to <span class="_ _e"> </span>change <span class="_"> </span>in <span class="_"> </span>the <span class="_ _e"> </span>call <span class="_"> </span>to<span class="_ _59"> </span><span class="ff1a">utime</span></div><div class="t m0 x215 h26 y6060 ff19 fsf fc0 sc0 ls0 ws0">should be the corresponding value fr<span class="_ _0"></span>om<span class="_"> </span><span class="ff1a">stat</span>.</div><div class="t m0 x32 h26 y1d9e ff18 fsf fc0 sc0 ls0 ws0">4.14<span class="_ _1a3"> </span><span class="ff19">The<span class="_ _45"> </span><span class="ff1a">finger</span></span></div><div class="t m0 xd0 h2a y5075 ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 x180 h2a y1d9e ff19 fsf fc0 sc0 ls0 ws0">1</div><div class="t m0 xe9 h2a y5075 ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 x10d h26 y1d9e ff19 fsf fc0 sc0 ls0 ws0">command <span class="_ _9"></span>calls<span class="_ _45"> </span><span class="ff1a">stat<span class="_ _45"> </span></span>on <span class="_ _9"></span>the <span class="_ _9"></span>mailbox.<span class="_ _51"> </span>The <span class="_ _9"></span>last-modiﬁcation <span class="_ _9"></span>time</div><div class="t m0 x215 h2a y1d9f ff19 fsf fc0 sc0 ls0 ws0">is <span class="_ _9"></span>the <span class="_ _9"></span>time <span class="_ _23"></span>that <span class="_ _9"></span>mail <span class="_ _9"></span>was <span class="_ _9"></span>last <span class="_ _23"></span>received, <span class="_ _3"></span>and <span class="_ _23"></span>the <span class="_ _9"></span>last-access <span class="_ _9"></span>time <span class="_ _9"></span>is <span class="_ _23"></span>when <span class="_ _9"></span>the <span class="_ _9"></span>mail</div><div class="t m0 x215 h2a y6061 ff19 fsf fc0 sc0 ls0 ws0">was last read.</div><div class="t m0 x32 h26 y6062 ff18 fsf fc0 sc0 ls0 ws0">4.15<span class="_ _1a3"> </span><span class="ff19">Both<span class="_ _45"> </span><span class="ff1a">cpio<span class="_ _45"> </span></span>and<span class="_ _45"> </span><span class="ff1a">tar<span class="_ _45"> </span></span>stor<span class="ls1818">eo<span class="_ _b"></span><span class="ls0">nly <span class="_ _9"></span>the <span class="_ _9"></span>modiﬁcation <span class="_ _23"></span>time <span class="_ _9"></span>(<span class="ff1a">st_mtime</span>)<span class="_ _45"> </span>in<span class="_ _45"> </span>the <span class="_ _9"></span>archive.</span></span></span></div><div class="t m0 x215 h2a y6063 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _2"></span>access <span class="_ _3"></span>time <span class="_ _3"></span>isn’t <span class="_ _3"></span>stored, <span class="_ _2"></span>because <span class="_ _3"></span>its <span class="_ _2"></span>value <span class="_ _3"></span>corresponds <span class="_ _2"></span>to <span class="_ _3"></span>the <span class="_ _3"></span>time <span class="_ _3"></span>the <span class="_ _2"></span>archive</div><div class="t m0 x215 h26 y5ed ff19 fsf fc0 sc0 ls0 ws0">was <span class="_ _9"></span>created, <span class="_ _9"></span>since <span class="_ _9"></span>the <span class="_ _23"></span>ﬁle <span class="_ _9"></span>has <span class="_ _9"></span>to <span class="_ _23"></span>be <span class="_ _9"></span>read <span class="_ _9"></span>to <span class="_ _9"></span>be <span class="_ _9"></span>archived. <span class="_ _45"> </span>The<span class="_ _45"> </span><span class="ff1a">-a<span class="_ _45"> </span></span>option <span class="_ _23"></span>to<span class="_ _45"> </span><span class="ff1a">cpio</span></div><div class="t m0 x215 h2a y5ee ff19 fsf fc0 sc0 ls0 ws0">has it <span class="_ _2"></span>reset <span class="_ _2"></span>the access <span class="_ _2"></span>time <span class="_ _2"></span>of <span class="_ _2"></span>each <span class="_ _2"></span>input <span class="_ _2"></span>ﬁle <span class="_ _2"></span>after the <span class="_ _2"></span>ﬁle <span class="_ _2"></span>has <span class="_ _2"></span>been <span class="_ _2"></span>read. <span class="_"> </span>This<span class="_ _47"> </span>way<span class="_ _4"></span>,</div><div class="t m0 x215 h2a y5ef ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _23"></span>creation <span class="_ _9"></span>of <span class="_ _23"> </span>the <span class="_ _23"> </span>archive <span class="_ _23"></span>doesn’t <span class="_ _23"></span>change <span class="_ _23"></span>the <span class="_ _23"></span>access <span class="_ _23"></span>time.<span class="_ _5a"> </span>(Resetting <span class="_ _23"> </span>the <span class="_ _23"> </span>access</div><div class="t m0 x215 h2a y5f0 ff19 fsf fc0 sc0 ls0 ws0">time, <span class="_ _42"> </span>however<span class="_ _6"></span><span class="ls8f8">,d<span class="_ _43"></span><span class="ls0">oes <span class="_ _42"> </span>modify <span class="_ _42"> </span>the <span class="_ _42"> </span>changed-status <span class="_ _23"> </span>time.)<span class="_ _54"> </span>The <span class="_ _42"> </span>changed-status <span class="_ _42"> </span>time</span></span></div><div class="t m0 x215 h2a y5f1 ff19 fsf fc0 sc0 ls0 ws0">isn’t <span class="_ _3"></span>stored <span class="_ _9"></span>in <span class="_ _3"></span>the <span class="_ _9"></span>archive, <span class="_ _3"></span>because <span class="_ _9"></span>we <span class="_ _9"></span>can’t <span class="_ _9"></span>set <span class="_ _3"></span>this <span class="_ _9"></span>value <span class="_ _9"></span>on <span class="_ _9"></span>extraction <span class="_ _3"></span>even <span class="_ _9"></span>if <span class="_ _9"></span>it</div><div class="t m0 x215 h26 y5f2 ff19 fsf fc0 sc0 ls0 ws0">was <span class="_ _53"> </span>archived. <span class="_ _44"> </span>(The<span class="_ _44"> </span><span class="ff1a">utimes<span class="_ _4b"> </span></span>function <span class="_ _42"> </span>and <span class="_ _53"> </span>its <span class="_ _53"> </span>related <span class="_ _53"> </span>functions,<span class="_ _44"> </span><span class="ff1a">futimens<span class="_ _4b"> </span></span>and</div><div class="t m0 x215 h26 y5f3 ff1a fsf fc0 sc0 ls0 ws0">utimensat<span class="ff19 ls44">,c<span class="_ _d"></span><span class="ls0">an change only the access time and the modiﬁcation time.)</span></span></div><div class="t m0 x215 h26 y1f1a ff19 fsf fc0 sc0 ls0 ws0">When <span class="_ _59"> </span>the <span class="_ _59"> </span>archive <span class="_ _4b"> </span>is <span class="_ _59"> </span>read <span class="_ _59"> </span>back <span class="_ _59"> </span>(extracted),<span class="_ _60"> </span><span class="ff1a">tar</span>,<span class="_ _48"> </span>by<span class="_ _48"> </span>default, <span class="_ _59"> </span>restores <span class="_ _4b"> </span>the</div><div class="t m0 x215 h26 y1f1b ff19 fsf fc0 sc0 ls0 ws0">modiﬁcation <span class="_ _9"></span>time <span class="_ _9"></span>to <span class="_ _23"></span>the <span class="_ _9"></span>value <span class="_ _9"></span>in <span class="_ _23"></span>the <span class="_ _9"></span>archive. <span class="_ _45"> </span>The<span class="_ _45"> </span><span class="ff1a">m<span class="_ _45"> </span></span>option <span class="_ _9"></span>to<span class="_ _45"> </span><span class="ff1a">tar<span class="_ _45"> </span></span>tells <span class="_ _9"></span>it <span class="_ _23"></span>to <span class="_ _9"></span>not</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
