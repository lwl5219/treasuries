<div id="pf11f" class="pf w4 h1f" data-page-no="11f"><div class="pc pc11f w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg11f.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h7a ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>8.10<span class="_ _22f"> </span><span class="ff1a">exec<span class="_ _4b"> </span></span>Functions<span class="_ _1b"> </span><span class="ff18">253</span></div><div class="t m0 x32 h26 y12f ff19 fsf fc0 sc0 ls0 ws0">function <span class="_ _42"> </span>from <span class="_ _53"> </span>Section <span class="_ _42"> </span>4.22) <span class="_ _53"> </span>be <span class="_ _53"> </span>closed <span class="_ _53"> </span>across <span class="_ _42"> </span>an<span class="_ _4b"> </span><span class="ff1a">exec</span><span class="ls9fd">.T<span class="_ _52"></span><span class="ls0">his <span class="_ _42"> </span>is <span class="_ _53"> </span>normally <span class="_ _53"> </span>done <span class="_ _42"> </span>by <span class="_ _53"> </span>the</span></span></div><div class="t m0 x32 h26 y130 ff1a fsf fc0 sc0 ls0 ws0">opendir<span class="_ _51"> </span><span class="ff19">function <span class="_ _35"> </span>calling<span class="_ _51"> </span></span>fcntl<span class="_ _51"> </span><span class="ff19">to <span class="_ _35"> </span>set <span class="_ _35"> </span>the <span class="_ _35"> </span>close-on-exec <span class="_ _35"> </span>ﬂag <span class="_ _35"> </span>for <span class="_ _35"> </span>the <span class="_ _35"> </span>descriptor</span></div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">corresponding to the open dir<span class="_ _0"></span>ectory str<span class="_ _0"></span>eam.</div><div class="t m0 x3f h26 y132 ff19 fsf fc0 sc0 ls0 ws0">Note <span class="_ _3"></span>that <span class="_ _9"></span>the <span class="_ _9"></span>real <span class="_ _3"></span>user <span class="_ _9"></span>ID <span class="_ _3"></span>and <span class="_ _9"></span>the <span class="_ _9"></span>real <span class="_ _2"></span>group <span class="_ _9"></span>ID <span class="_ _3"></span>remain <span class="_ _3"></span>the <span class="_ _9"></span>same <span class="_ _9"></span>across <span class="_ _3"></span>the<span class="_ _45"> </span><span class="ff1a">exec</span>,</div><div class="t m0 x32 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">but <span class="_ _2"></span>the <span class="_ _2"></span>effective <span class="_ _2"></span>IDs <span class="_ _2"></span>can <span class="_ _2"></span>change, <span class="_ _3"></span>depending <span class="_ _2"></span>on <span class="_ _2"></span>the <span class="_ _2"></span>status <span class="_ _3"></span>of <span class="_ _2"></span>the <span class="_ _2"></span>set-user-ID <span class="_ _2"></span>and <span class="_ _2"></span>the <span class="_ _3"></span>set-</div><div class="t m0 x32 h2a y134 ff19 fsf fc0 sc0 ls0 ws0">group-ID <span class="_ _9"></span>bits <span class="_ _23"></span>for <span class="_ _23"></span>the <span class="_ _9"></span>program <span class="_ _23"></span>ﬁle <span class="_ _9"></span>that <span class="_ _23"> </span>is <span class="_ _23"></span>executed.<span class="_ _51"> </span>If <span class="_ _9"></span>the <span class="_ _23"></span>set-user-ID <span class="_ _9"></span>bit <span class="_ _23"> </span>is <span class="_ _23"></span>set <span class="_ _23"></span>for <span class="_ _9"></span>the</div><div class="t m0 x32 h2a y135 ff19 fsf fc0 sc0 ls0 ws0">new <span class="_ _45"> </span>program, <span class="_ _35"> </span>the <span class="_ _45"> </span>effective <span class="_ _45"> </span>user <span class="_ _35"> </span>ID <span class="_ _35"> </span>becomes <span class="_ _45"> </span>the <span class="_ _35"> </span>owner <span class="_ _35"> </span>ID <span class="_ _45"> </span>of <span class="_ _35"> </span>the <span class="_ _45"> </span>program <span class="_ _35"> </span>ﬁle.</div><div class="t m0 x32 h2a y136 ff19 fsf fc0 sc0 ls0 ws0">Otherwise, <span class="_ _42"> </span>the <span class="_ _23"> </span>effective <span class="_ _42"> </span>user <span class="_ _42"> </span>ID <span class="_ _23"> </span>is <span class="_ _42"> </span>not <span class="_ _42"> </span>changed <span class="_ _42"> </span>(it’s <span class="_ _42"> </span>not <span class="_ _23"> </span>set <span class="_ _42"> </span>to <span class="_ _42"> </span>the <span class="_ _42"> </span>real <span class="_ _23"> </span>user <span class="_ _42"> </span>ID).<span class="_ _54"> </span>The</div><div class="t m0 x32 h2a y137 ff19 fsf fc0 sc0 ls0 ws0">group ID is handled in the same way<span class="_ _4"></span>.</div><div class="t m0 x3f h26 y138 ff19 fsf fc0 sc0 ls0 ws0">In many UNIX system implementations, only <span class="_ _2"></span>one of these seven functions,<span class="_ _66"> </span><span class="ff1a">execve</span>,</div><div class="t m0 x32 h2a y139 ff19 fsf fc0 sc0 ls0 ws0">is a system <span class="_ _2"></span>call within the <span class="_ _2"></span>kernel.<span class="_ _46"> </span>The other <span class="_ _2"></span>six ar<span class="lsf5">ej<span class="_ _4f"></span><span class="ls0">ust <span class="_ _2"></span>library functions <span class="_ _2"></span>that eventually</span></span></div><div class="t m0 x32 h2a y13a ff19 fsf fc0 sc0 ls0 ws0">invoke <span class="_ _3"></span>this <span class="_ _3"></span>system <span class="_ _3"></span>call.<span class="_ _16"> </span><span class="ls5f">We <span class="_ _66"> </span>c<span class="_ _9"></span></span>an <span class="_ _3"></span>illustrate <span class="_ _3"></span>the <span class="_ _9"></span>relationship <span class="_ _2"></span>among <span class="_ _3"></span>these <span class="_ _3"></span>seven <span class="_ _9"></span>functions</div><div class="t m0 x32 h2a y254 ff19 fsf fc0 sc0 ls0 ws0">as shown in Figur<span class="ls44">e8<span class="_ _4f"></span><span class="ls0">.15.</span></span></div><div class="t m0 x9d h5e y2152 ff1a fs10 fc0 sc0 ls0 ws0">execlp</div><div class="t m0 xe0 h4f y2153 ff1a fs11 fc0 sc0 ls0 ws0">execl</div><div class="t m0 x12d h6d y2154 ff1a fs12 fc0 sc0 ls0 ws0">execle</div><div class="t m0 x9d h63 y2155 ff1a fs13 fc0 sc0 ls0 ws0">execvp</div><div class="t m0 xe0 h6f y2156 ff1a fs14 fc0 sc0 ls0 ws0">execv</div><div class="t m0 x12d h66 y2157 ff1a fs15 fc0 sc0 ls0 ws0">execve</div><div class="t m0 x1a9 h32 y2158 ff19 fs15 fc0 sc0 ls0 ws0">(system call)</div><div class="t m0 x97 h70 y2159 ff1a fs16 fc0 sc0 ls0 ws0">fexecve</div><div class="t m0 xaa hfc y215a ff19 fs36 fc0 sc0 ls0 ws0">build<span class="_"> </span><span class="ff1b">argv</span></div><div class="t m0 xcc hfd y215b ff19 fs17 fc0 sc0 ls0 ws0">build<span class="_"> </span><span class="ff1b">argv</span></div><div class="t m0 x102 hfe y215c ff19 fs18 fc0 sc0 ls0 ws0">build<span class="_"> </span><span class="ff1b">argv</span></div><div class="t m0 x108 h36 y215d ff19 fs19 fc0 sc0 ls0 ws0">try each</div><div class="t m0 xea hd5 y215e ff1a fs19 fc0 sc0 ls0 ws0">PATH<span class="_ _53"> </span><span class="ff19">preﬁx</span></div><div class="t m0 x19c h37 y215f ff19 fs1a fc0 sc0 ls0 ws0">use</div><div class="t m0 xa9 h8d y2160 ff1a fs1a fc0 sc0 ls0 ws0">environ</div><div class="t m0 x102 h38 y2161 ff19 fs1b fc0 sc0 ls0 ws0">build path from</div><div class="t m0 x102 hd6 y2162 ff1a fs1b fc0 sc0 ls0 ws0">/proc/self/fd</div><div class="t m0 x102 h38 y2163 ff19 fs1b fc0 sc0 ls0 ws0">alias</div><div class="t m0 x12b hd6 y2164 ff18 fs1b fc0 sc0 ls0 ws0">Figure 8.15<span class="_ _5a"> </span><span class="ff19">Relationship of the seven<span class="_"> </span><span class="ff1a">exec<span class="_ _e"> </span></span>functions</span></div><div class="t m0 x32 hf9 y2165 ff19 fs88 fc0 sc0 ls0 ws0">In <span class="_ _47"> </span>this <span class="_ _47"> </span>arrangement, <span class="_ _47"> </span>the <span class="_ _47"> </span>library <span class="_ _47"> </span>functions<span class="_ _16"> </span><span class="ff1a">execlp<span class="_ _61"> </span></span>and<span class="_ _16"> </span><span class="ff1a">execvp<span class="_ _16"> </span></span>process <span class="_ _47"> </span>the<span class="_ _61"> </span><span class="ff1a">PATH</span></div><div class="t m0 x32 hfa y2166 ff19 fs88 fc0 sc0 ls0 ws0">environment <span class="_ _23"></span>variable, <span class="_ _23"></span>looking <span class="_ _23"> </span>for <span class="_ _23"> </span>the <span class="_ _42"> </span>ﬁrst <span class="_ _23"> </span>path <span class="_ _23"> </span>preﬁx <span class="_ _23"> </span>that <span class="_ _23"> </span>contains <span class="_ _42"> </span>an <span class="_ _23"> </span>executable <span class="_ _23"> </span>ﬁle</div><div class="t m0 x32 hf9 y2167 ff19 fs88 fc0 sc0 ls0 ws0">named<span class="_"> </span><span class="ff1b">ﬁlename</span><span class="ls9fe">.T<span class="_ _4a"></span><span class="ls0">he<span class="_"> </span><span class="ff1a">fexecve<span class="_ _66"> </span></span>library function uses<span class="_ _66"> </span><span class="ff1a">/proc<span class="_ _66"> </span></span>to convert the <span class="_ _2"></span>ﬁle descriptor</span></span></div><div class="t m0 x32 hf9 y2168 ff19 fs88 fc0 sc0 ls0 ws0">argument into a pathname that can be used by<span class="_"> </span><span class="ff1a">execve<span class="_ _80"> </span></span>to execute the program.</div><div class="t m0 x76 hd6 y2169 ff19 fs1b fc0 sc0 ls0 ws0">This <span class="_ _3"></span>describes <span class="_ _9"></span>how<span class="_ _66"> </span><span class="ff1a">fexecve<span class="_ _66"> </span></span>is <span class="_ _9"></span>implemented <span class="_ _3"></span>in <span class="_ _9"></span>FreeBSD <span class="_ _3"></span>8.0 <span class="_ _9"></span>and <span class="_ _3"></span>Linux <span class="_ _9"></span>3.2.0.<span class="_ _59"> </span>Other <span class="_ _3"></span>systems</div><div class="t m0 x76 hd6 y216a ff19 fs1b fc0 sc0 ls0 ws0">might <span class="_ _23"> </span>take <span class="_ _23"> </span>a <span class="_ _23"> </span>different <span class="_ _23"> </span>approach. <span class="_ _47"> </span>For<span class="_ _45"> </span>example, <span class="_ _23"> </span>a <span class="_ _23"> </span>system <span class="_ _42"> </span>without<span class="_ _47"> </span><span class="ff1a">/proc<span class="_ _45"> </span></span>or<span class="_ _45"> </span><span class="ff1a">/dev/fd<span class="_ _45"> </span></span>could</div><div class="t m0 x76 hd6 y216b ff19 fs1b fc0 sc0 ls0 ws0">implement<span class="_"> </span><span class="ff1a">fexecve<span class="_ _e"> </span></span>as a system call veneer that <span class="_ _2"></span>translates the ﬁle descriptor argument into an</div><div class="t m0 x76 hd6 y216c ff19 fs1b fc0 sc0 ls0 ws0">i-node <span class="_ _80"> </span>pointer<span class="_ _1"></span><span class="ls9ff">,i<span class="_ _c"></span><span class="ls0">mplement<span class="_ _44"> </span><span class="ff1a">execve<span class="_ _4b"> </span></span>as <span class="_ _80"> </span>a <span class="_ _80"> </span>system <span class="_ _80"> </span>call <span class="_ _80"> </span>veneer <span class="_ _80"> </span>that <span class="_ _80"> </span>translates <span class="_ _80"> </span>the <span class="_ _e"> </span>pathname</span></span></div><div class="t m0 x76 hd6 y216d ff19 fs1b fc0 sc0 ls0 ws0">argument <span class="_ _23"> </span>into <span class="_ _42"> </span>an <span class="_ _42"> </span>i-node <span class="_ _42"> </span>pointer<span class="_ _1"></span><span class="lsa00">,a<span class="_ _b"></span><span class="ls0">nd <span class="_ _42"> </span>place <span class="_ _42"> </span>all <span class="_ _42"> </span>the <span class="_ _42"> </span>rest <span class="_ _23"> </span>of <span class="_ _42"> </span>the<span class="_ _45"> </span><span class="ff1a">exec<span class="_ _35"> </span></span>code <span class="_ _42"> </span>common <span class="_ _23"> </span>to <span class="_"> </span>both</span></span></div><div class="t m0 x76 hd6 y216e ff1a fs1b fc0 sc0 ls0 ws0">execve<span class="_ _80"> </span><span class="ff19">and<span class="_ _80"> </span></span>fexecve<span class="_ _80"> </span><span class="ff19">in <span class="_ _3"></span>a <span class="_ _2"></span>separate <span class="_ _3"></span>function <span class="_ _2"></span>to <span class="_ _3"></span>be <span class="_ _2"></span>called <span class="_ _3"></span>with <span class="_ _3"></span>an <span class="_ _2"></span>i-node <span class="_ _3"></span>pointer <span class="_ _2"></span>for <span class="_ _3"></span>the <span class="_ _2"></span>ﬁle <span class="_ _3"></span>to</span></div><div class="t m0 x76 h38 y216f ff19 fs1b fc0 sc0 ls0 ws0">be executed.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
