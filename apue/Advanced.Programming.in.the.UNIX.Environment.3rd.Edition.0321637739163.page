<div id="pfa3" class="pf w4 h1f" data-page-no="a3"><div class="pc pca3 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bga3.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h7a ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>4.21<span class="_ _1c0"> </span><span class="ff1a">mkdir</span>,<span class="_ _4b"> </span><span class="ff1a">mkdirat</span><span class="ls30a">,a<span class="_ _55"></span><span class="ls0">nd<span class="_ _4b"> </span><span class="ff1a">rmdir<span class="_ _4b"> </span></span>Functions<span class="_ _1b"> </span><span class="ff18">129</span></span></span></div><div class="t m0 x35 h75 y12f ff16 fs2b fc0 sc0 ls0 ws0">4.21<span class="_ _6d"> </span><span class="ff1f">mkdir</span>,<span class="_ _54"> </span><span class="ff1f">mkdirat</span><span class="ls1c3">,a<span class="_ _52"></span><span class="ls0">nd<span class="_ _54"> </span><span class="ff1f">rmdir<span class="_ _54"> </span></span>Functions</span></span></div><div class="t m0 x32 h26 y4de ff19 fsf fc0 sc0 ls0 ws0">Directories <span class="_ _23"></span>ar<span class="_ _0"></span><span class="ls59">ec<span class="_ _43"></span><span class="ls45">re<span class="_ _2"></span><span class="ls0">ated <span class="_ _23"> </span>with <span class="_ _23"> </span>the<span class="_ _35"> </span><span class="ff1a">mkdir<span class="_ _35"> </span></span>and<span class="_ _35"> </span><span class="ff1a">mkdirat<span class="_ _35"> </span></span>functions, <span class="_ _23"> </span>and <span class="_ _23"> </span>deleted <span class="_ _42"> </span>with <span class="_ _23"></span>the</span></span></span></div><div class="t m0 x32 h26 y6d0 ff1a fsf fc0 sc0 ls0 ws0">rmdir<span class="_ _80"> </span><span class="ff19">function.</span></div><div class="t m0 x3f h57 y126b ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;sys/stat.h&gt;</div><div class="t m0 x3f h57 y126c ff1a fs2d fc0 sc0 ls0 ws0">int mkdir(const char *<span class="ff1b">pathname</span><span class="ls15c">,m<span class="_ _1d"></span><span class="ls0">ode_t<span class="_"> </span><span class="ff1b">mode</span>);</span></span></div><div class="t m0 x3f h57 y126d ff1a fs2d fc0 sc0 ls0 ws0">int mkdirat(int<span class="_"> </span><span class="ff1b">fd</span><span class="ls15c">,c<span class="_ _1d"></span><span class="ls0">onst char *<span class="ff1b">pathname</span><span class="ls15c">,m<span class="_ _5b"></span><span class="ls0">ode_t<span class="_"> </span><span class="ff1b">mode</span>);</span></span></span></span></div><div class="t m0 x1af h5f y126e ff19 fs2d fc0 sc0 ls0 ws0">Both return: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>err<span class="_ _0"></span>or</div><div class="t m0 x32 h49 y126f ff19 fs26 fc0 sc0 ls0 ws0">These <span class="_ _e"> </span>functions <span class="_"> </span>cr<span class="_ _0"></span>eate <span class="_ _e"> </span>a <span class="_"> </span>new<span class="_ _4"></span><span class="ls5a4">,e<span class="_ _55"></span><span class="ls0">mpty <span class="_"> </span>dir<span class="_ _0"></span>ectory<span class="_ _4"></span><span class="ls5a5">.T<span class="_ _64"></span><span class="ls0">he <span class="_ _e"> </span>entries <span class="_"> </span>for <span class="_ _e"> </span>dot <span class="_ _e"> </span>and <span class="_"> </span>dot-dot <span class="_ _e"> </span>are</span></span></span></span></div><div class="t m0 x32 h4a y1270 ff19 fs26 fc0 sc0 ls0 ws0">created <span class="_ _9"></span>automatically<span class="_ _4"></span><span class="ls5a6">.T<span class="_ _62"></span><span class="ls0">he <span class="_ _9"></span>speciﬁed <span class="_ _9"></span>ﬁle <span class="_ _23"></span>access <span class="_ _9"></span>permissions,<span class="_ _45"> </span><span class="ff1b">mode</span><span class="ls5a7">,a<span class="_ _b"></span><span class="lscc">re <span class="_ _23"> </span>m<span class="_ _2"></span><span class="ls0">odiﬁed <span class="_ _23"></span>by <span class="_ _9"></span>the</span></span></span></span></span></div><div class="t m0 x32 h49 y1271 ff19 fs26 fc0 sc0 ls0 ws0">ﬁle mode creation mask of the pr<span class="_ _0"></span>ocess.</div><div class="t m0 x3f h4a y1272 ff19 fs26 fc0 sc0 ls5a8 ws0">Ac<span class="_ _1d"></span><span class="ls0">ommon <span class="_ _47"> </span>mistake <span class="_ _47"> </span>is <span class="_ _47"> </span>to <span class="_ _47"> </span>specify <span class="_ _47"> </span>the <span class="_ _47"> </span>same<span class="_ _16"> </span><span class="ff1b">mode<span class="_ _16"> </span></span>as <span class="_ _47"> </span>for <span class="_ _47"> </span>a <span class="_ _47"> </span>ﬁle: <span class="_ _47"> </span>read <span class="_ _47"> </span>and <span class="_ _47"> </span>write</span></div><div class="t m0 x32 h49 y1273 ff19 fs26 fc0 sc0 ls0 ws0">permissions <span class="_ _3"></span>only<span class="_ _4"></span><span class="ls166">.B<span class="_ _1d"></span><span class="ls0">ut <span class="_ _3"></span>for <span class="_ _3"></span>a <span class="_ _9"></span>directory<span class="_ _4"></span>,<span class="_ _47"> </span>we<span class="_ _47"> </span>normally <span class="_ _3"></span>want <span class="_ _3"></span>at <span class="_ _3"></span>least <span class="_ _3"></span>one <span class="_ _3"></span>of <span class="_ _3"></span>the <span class="_ _3"></span>execute <span class="_ _3"></span>bits</span></span></div><div class="t m0 x32 h49 y1274 ff19 fs26 fc0 sc0 ls0 ws0">enabled, to allow access to ﬁlenames within the directory<span class="_ _4"></span><span class="ls199">.(<span class="_ _4a"></span><span class="ls0">See Exercise 4.16.)</span></span></div><div class="t m0 x3f h49 y1275 ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _42"> </span>user <span class="_ _53"> </span>ID <span class="_ _53"> </span>and <span class="_ _42"> </span>group <span class="_ _42"> </span>ID <span class="_ _53"> </span>of <span class="_ _53"> </span>the <span class="_ _42"> </span>new <span class="_ _53"> </span>directory <span class="_ _42"> </span>ar<span class="ls5a9">ee<span class="_ _c"></span><span class="ls0">stablished <span class="_ _53"> </span>according <span class="_ _42"> </span>to <span class="_ _42"> </span>the</span></span></div><div class="t m0 x32 h49 y1276 ff19 fs26 fc0 sc0 ls2b1 ws0">ru<span class="ls0">les we described in Section 4.6.</span></div><div class="t m0 x76 h2d y1277 ff19 fs10 fc0 sc0 ls0 ws0">Solaris <span class="_ _23"> </span>10 <span class="_ _9"></span>and <span class="_ _23"> </span>Linux <span class="_ _23"> </span>3.2.0 <span class="_ _23"> </span>also <span class="_ _9"></span>have <span class="_ _23"> </span>the <span class="_ _23"> </span>new <span class="_ _9"> </span>directory <span class="_ _23"> </span>inherit <span class="_ _23"> </span>the <span class="_ _9"></span>set-group-ID <span class="_ _23"> </span>bit <span class="_ _9"> </span>from <span class="_ _23"> </span>the</div><div class="t m0 x76 h2d y1278 ff19 fs10 fc0 sc0 ls0 ws0">parent <span class="_ _42"> </span>directory<span class="_ _4"></span><span class="ls5aa">.F<span class="_ _1d"></span><span class="ls0">iles <span class="_"> </span>cr<span class="_ _0"></span>eated <span class="_ _42"> </span>in <span class="_ _42"> </span>the <span class="_"> </span>new <span class="_ _42"> </span>directory <span class="_ _42"> </span>will <span class="_ _42"> </span>then <span class="_ _42"> </span>inherit <span class="_"> </span>the <span class="_ _42"> </span>group <span class="_ _42"> </span>ID <span class="_ _42"> </span>of <span class="_"> </span>that</span></span></div><div class="t m0 x76 h2d y1279 ff19 fs10 fc0 sc0 ls0 ws0">directory<span class="_ _4"></span><span class="ls5ab">.W<span class="_ _62"></span><span class="ls0">ith <span class="_ _42"> </span>Linux, <span class="_ _42"> </span>the <span class="_ _42"> </span>ﬁle <span class="_ _42"> </span>system <span class="_ _23"> </span>implementation <span class="_ _42"> </span>determines <span class="_ _42"> </span>whether <span class="_ _42"> </span>this <span class="_ _42"> </span>behavior <span class="_ _42"> </span>is</span></span></div><div class="t m0 x76 h5e y127a ff19 fs10 fc0 sc0 ls0 ws0">supported. <span class="_ _45"> </span>For<span class="_ _45"> </span>example, <span class="_ _23"> </span>the<span class="_ _45"> </span><span class="ff1a">ext2</span>,<span class="_ _45"> </span><span class="ff1a">ext3</span><span class="ls5ac">,a<span class="_ _b"></span><span class="ls0">nd<span class="_ _45"> </span><span class="ff1a">ext4<span class="_ _45"> </span></span>ﬁle <span class="_ _23"> </span>systems <span class="_ _23"> </span>allow <span class="_ _42"> </span>this <span class="_ _23"> </span>behavior <span class="_ _42"> </span>to <span class="_ _23"> </span>be</span></span></div><div class="t m0 x76 h5e y127b ff19 fs10 fc0 sc0 ls0 ws0">controlled by an <span class="_ _2"></span>option <span class="_ _2"></span>to the<span class="_ _80"> </span><span class="ff1a">mount</span></div><div class="t m0 x45 h2d y127c ff19 fs10 fc0 sc0 ls0 ws0">(</div><div class="t m0 x46 h2d y127b ff19 fs10 fc0 sc0 ls0 ws0">1</div><div class="t m0 x114 h2d y127c ff19 fs10 fc0 sc0 ls0 ws0">)</div><div class="t m0 x95 h5e y127b ff19 fs10 fc0 sc0 ls0 ws0">command. <span class="_"> </span>W<span class="_ _0"></span>ith the <span class="_ _2"></span>Linux <span class="_ _2"></span>implementation of <span class="_ _2"></span>the<span class="_"> </span><span class="ff1a">UFS</span></div><div class="t m0 x76 h2d y127d ff19 fs10 fc0 sc0 ls0 ws0">ﬁle system, however<span class="_ _0"></span><span class="ls5ad">,t<span class="_ _5"></span><span class="ls0">he behavior <span class="_ _2"></span>is not <span class="_ _2"></span>selectable; it inherits <span class="_ _2"></span>the set-group-ID bit <span class="_ _2"></span>to mimic the</span></span></div><div class="t m0 x76 h2d y127e ff19 fs10 fc0 sc0 ls0 ws0">historical <span class="_ _2"></span>BSD <span class="_ _3"></span>implementation, <span class="_ _2"></span>wher<span class="ls5ae">et<span class="_ _d"></span><span class="ls0">he <span class="_ _3"></span>group <span class="_ _2"></span>ID <span class="_ _3"></span>of <span class="_ _2"></span>a <span class="_ _3"></span>directory <span class="_ _2"></span>is <span class="_ _2"></span>inherited <span class="_ _3"></span>from <span class="_ _2"></span>the <span class="_ _2"></span>parent</span></span></div><div class="t m0 x76 h2d y127f ff19 fs10 fc0 sc0 ls0 ws0">directory<span class="_ _4"></span>.</div><div class="t m0 x76 h2d y1280 ff19 fs10 fc0 sc0 ls0 ws0">BSD</div><div class="t m0 x54 h2d y1281 ff19 fs10 fc0 sc0 ls0 ws0">-</div><div class="t m0 xf6 h2d y1280 ff19 fs10 fc0 sc0 ls0 ws0">based <span class="_"> </span>implementations <span class="_"> </span>don’t <span class="_"> </span>propagate <span class="_"> </span>the <span class="_"> </span>set-group-ID <span class="_"> </span>bit; <span class="_"> </span>they <span class="_"> </span>simply <span class="_"> </span>inherit <span class="_"> </span>the</div><div class="t m0 x76 h2d y1282 ff19 fs10 fc0 sc0 ls0 ws0">group ID as a <span class="_ _2"></span>matter of <span class="_ _2"></span>policy<span class="_ _6"></span><span class="ls5af">.B<span class="_ _43"></span><span class="ls0">ecause FreeBSD 8.0 and Mac <span class="_ _2"></span>OS X <span class="_ _2"></span>10.6.8 ar<span class="ls5b0">eb<span class="_ _5"></span><span class="ls0">ased on <span class="_ _2"></span>4.4BSD,</span></span></span></span></div><div class="t m0 x76 h2d y1283 ff19 fs10 fc0 sc0 ls0 ws0">they do not requir<span class="_ _0"></span><span class="ls5b1">ei<span class="_ _84"></span><span class="ls0">nheriting the set-group-ID bit.<span class="_ _35"> </span>On these platforms, newly created ﬁles and</span></span></div><div class="t m0 x76 h2d y1284 ff19 fs10 fc0 sc0 ls0 ws0">directories <span class="_"> </span>always <span class="_ _42"> </span>inherit <span class="_"> </span>the <span class="_"> </span>group <span class="_ _42"> </span>ID <span class="_"> </span>of <span class="_"> </span>the <span class="_"> </span>par<span class="_ _0"></span>ent <span class="_"> </span>directory<span class="_ _4"></span><span class="ls5b2">,r<span class="_ _43"></span><span class="ls0">egardless <span class="_"> </span>of <span class="_ _42"> </span>whether <span class="_"> </span>the</span></span></div><div class="t m0 x76 h2d y1285 ff19 fs10 fc0 sc0 ls0 ws0">set-group-ID bit is set.</div><div class="t m0 x76 h5e y1286 ff19 fs10 fc0 sc0 ls0 ws0">Earlier <span class="_ _2"></span>versions <span class="_ _3"></span>of <span class="_ _2"></span>the <span class="_ _3"></span>UNIX <span class="_ _3"></span>System <span class="_ _2"></span>did <span class="_ _3"></span>not <span class="_ _2"></span>have <span class="_ _3"></span>the<span class="_ _80"> </span><span class="ff1a">mkdir<span class="_ _66"> </span></span>function; <span class="_ _2"></span>it <span class="_ _3"></span>was <span class="_ _2"></span>introduced <span class="_ _2"></span>with</div><div class="t m0 x76 h5e y1287 ff19 fs10 fc0 sc0 ls0 ws0">4.2BSD <span class="_ _2"></span>and <span class="_ _3"></span>SVR3.<span class="_ _4b"> </span>In <span class="_ _2"></span>the <span class="_ _3"></span>earlier <span class="_ _3"></span>versions, <span class="_ _2"></span>a <span class="_ _3"></span>process <span class="_ _2"></span>had <span class="_ _3"></span>to <span class="_ _3"></span>call <span class="_ _2"></span>the<span class="_ _66"> </span><span class="ff1a">mknod<span class="_ _80"> </span></span>function <span class="_ _2"></span>to <span class="_ _3"></span>create <span class="_ _2"></span>a</div><div class="t m0 x76 h5e y1288 ff19 fs10 fc0 sc0 ls0 ws0">new <span class="_"> </span>directory <span class="_ _4"></span>— <span class="_ _a"></span>but<span class="_ _44"> </span>use <span class="_"> </span>of <span class="_"> </span>the<span class="_ _44"> </span><span class="ff1a">mknod<span class="_ _35"> </span></span>function <span class="_"> </span>was <span class="_"> </span>restricted <span class="_"> </span>to <span class="_"> </span>superuser <span class="_"> </span>processes. <span class="_ _35"> </span>T<span class="_ _6"></span>o</div><div class="t m0 x76 h5e y1289 ff19 fs10 fc0 sc0 ls0 ws0">circumvent <span class="_ _2"></span>this <span class="_ _3"></span>constraint, <span class="_ _3"></span>the <span class="_ _3"></span>normal <span class="_ _2"></span>command <span class="_ _3"></span>that <span class="_ _3"></span>created <span class="_ _2"></span>a <span class="_ _3"></span>directory<span class="_ _6"></span>,<span class="_ _66"> </span><span class="ff1a">mkdir</span></div><div class="t m0 xfa h2d y128a ff19 fs10 fc0 sc0 ls0 ws0">(</div><div class="t m0 xd5 h2d y1289 ff19 fs10 fc0 sc0 ls0 ws0">1</div><div class="t m0 x69 h2d y128a ff19 fs10 fc0 sc0 ls0 ws0">)</div><div class="t m0 xd6 h2d y1289 ff19 fs10 fc0 sc0 ls5b3 ws0">,h<span class="_ _d"></span><span class="ls0">ad <span class="_ _3"></span>to <span class="_ _3"></span>be</span></div><div class="t m0 x76 h5e y128b ff19 fs10 fc0 sc0 ls0 ws0">owned <span class="_ _2"></span>by <span class="_ _3"></span>root <span class="_ _3"></span>with <span class="_ _3"></span>the <span class="_ _3"></span>set-user-ID <span class="_ _2"></span>bit <span class="_ _3"></span>on.<span class="_ _4b"> </span><span class="ls292">To <span class="_ _e"> </span>c<span class="_ _3"></span><span class="ls21d">re<span class="_ _2"></span></span></span>ate <span class="_ _3"></span>a <span class="_ _3"></span>directory <span class="_ _2"></span>from <span class="_ _2"></span>a <span class="_ _3"></span>process, <span class="_ _3"></span>the<span class="_ _80"> </span><span class="ff1a">mkdir</span></div><div class="t m0 xcf h2d y128c ff19 fs10 fc0 sc0 ls0 ws0">(</div><div class="t m0 x1b6 h2d y128b ff19 fs10 fc0 sc0 ls0 ws0">1</div><div class="t m0 x163 h2d y128c ff19 fs10 fc0 sc0 ls0 ws0">)</div><div class="t m0 x76 h5e y128d ff19 fs10 fc0 sc0 ls0 ws0">command had to be invoked with the<span class="_"> </span><span class="ff1a">system</span></div><div class="t m0 xce h2d y128e ff19 fs10 fc0 sc0 ls0 ws0">(</div><div class="t m0 xdc h2d y128d ff19 fs10 fc0 sc0 ls0 ws0">3</div><div class="t m0 x19c h2d y128e ff19 fs10 fc0 sc0 ls0 ws0">)</div><div class="t m0 x187 h2d y128d ff19 fs10 fc0 sc0 ls0 ws0">function.</div><div class="t m0 x3f h4d y128f ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _66"> </span><span class="ff1a">mkdirat<span class="_ _47"> </span></span>function <span class="_ _2"></span>is <span class="_ _3"></span>similar <span class="_ _2"></span>to <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">mkdir<span class="_ _66"> </span></span>function. <span class="_ _47"> </span>When<span class="_ _47"> </span>the<span class="_ _66"> </span><span class="ff1b">fd<span class="_ _47"> </span></span>argument <span class="_ _2"></span>has</div><div class="t m0 x32 h4d y1290 ff19 fs26 fc0 sc0 ls0 ws0">the <span class="_"> </span>special <span class="_"> </span>value<span class="_ _59"> </span><span class="ff1a">AT_FDCWD</span>,<span class="_ _46"> </span>or<span class="_ _46"> </span>when <span class="_"> </span>the<span class="_ _46"> </span><span class="ff1b">pathname<span class="_ _59"> </span></span>argument <span class="_"> </span>speciﬁes <span class="_"> </span>an <span class="_"> </span>absolute</div><div class="t m0 x32 h4d y1291 ff19 fs26 fc0 sc0 ls0 ws0">pathname,<span class="_ _4b"> </span><span class="ff1a">mkdirat<span class="_ _59"> </span></span>behaves <span class="_"> </span>exactly <span class="_ _53"> </span>like<span class="_ _59"> </span><span class="ff1a">mkdir</span><span class="ls5b4">.O<span class="_ _64"></span><span class="ls0">therwise, <span class="_"> </span>the<span class="_ _4b"> </span><span class="ff1b">fd<span class="_ _59"> </span></span>argument <span class="_ _53"> </span>is <span class="_"> </span>an</span></span></div><div class="t m0 x32 h49 y1292 ff19 fs26 fc0 sc0 ls0 ws0">open directory fr<span class="_ _0"></span>om which r<span class="_ _0"></span>elative pathnames will be evaluated.</div><div class="t m0 x3f h4d y1293 ff19 fs26 fc0 sc0 ls0 ws0">An <span class="_"> </span>empty <span class="_"> </span>directory <span class="_"> </span>is <span class="_"> </span>deleted <span class="_"> </span>with <span class="_"> </span>the<span class="_ _59"> </span><span class="ff1a">rmdir<span class="_ _46"> </span></span>function. <span class="_ _46"> </span>Recall<span class="_ _46"> </span>that <span class="_"> </span>an <span class="_"> </span>empty</div><div class="t m0 x32 h49 y1294 ff19 fs26 fc0 sc0 ls0 ws0">directory is one that contains entries only for dot and dot-dot.</div><a class="l" href="#pfd" data-dest-detail='[13,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892409px;bottom:1236.288916px;width:270.431816px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
