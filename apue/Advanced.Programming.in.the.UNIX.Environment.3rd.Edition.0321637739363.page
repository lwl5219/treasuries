<div id="pf16b" class="pf w4 h1f" data-page-no="16b"><div class="pc pc16b w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg16b.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>10.5<span class="_ _26c"> </span>Interrupted <span class="_"> </span>System <span class="_"> </span>Calls<span class="_ _1b"> </span><span class="ff18">329</span></div><div class="t m0 x3f h2a y12f ff19 fsf fc0 sc0 ls5f ws0">To <span class="_ _35"> </span>p<span class="_ _23"></span><span class="ls45">re<span class="ls0">vent <span class="_"> </span>applications <span class="_ _53"> </span>from <span class="_ _e"> </span>having <span class="_ _e"> </span>to <span class="_"> </span>handle <span class="_ _53"> </span>interrupted <span class="_ _e"> </span>system <span class="_"> </span>calls, <span class="_ _53"> </span>4.2BSD</span></span></div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">introduced the automatic restarting of certain interrupted system calls.<span class="_ _46"> </span>The <span class="_ _2"></span>system calls</div><div class="t m0 x32 h26 y131 ff19 fsf fc0 sc0 ls0 ws0">that <span class="_ _2"></span>wer<span class="ls74d">ea<span class="_ _8"></span><span class="ls0">utomatically <span class="_ _3"></span>restarted <span class="_ _2"></span>are<span class="_"> </span><span class="ff1a">ioctl</span>,<span class="_ _47"> </span><span class="ff1a">read</span>,<span class="_ _47"> </span><span class="ff1a">readv</span>,<span class="_ _66"> </span><span class="ff1a">write</span>,<span class="_ _47"> </span><span class="ff1a">writev</span>,<span class="_ _47"> </span><span class="ff1a">wait</span><span class="lsc01">,a<span class="_ _4f"></span><span class="ls0">nd</span></span></span></span></div><div class="t m0 x32 h26 y132 ff1a fsf fc0 sc0 ls0 ws0">waitpid<span class="ff19 lsc02">.A<span class="_ _52"></span><span class="ls260">sw<span class="_ _43"></span><span class="ls0">e’ve <span class="_ _42"> </span>mentioned, <span class="_ _42"> </span>the <span class="_ _42"> </span>ﬁrst <span class="_ _42"> </span>ﬁve <span class="_ _42"> </span>of <span class="_ _42"> </span>these <span class="_ _42"> </span>functions <span class="_ _53"> </span>ar<span class="lsc03">ei<span class="_ _c"></span><span class="ls0">nterrupted <span class="_ _42"> </span>by <span class="_ _42"> </span>a</span></span></span></span></span></div><div class="t m0 x32 h26 y133 ff19 fsf fc0 sc0 ls0 ws0">signal <span class="_ _e"> </span>only <span class="_"> </span>if <span class="_ _53"> </span>they <span class="_"> </span>ar<span class="lsc04">eo<span class="_ _4a"></span><span class="ls0">perating <span class="_ _e"> </span>on <span class="_"> </span>a <span class="_ _e"> </span>slow <span class="_ _e"> </span>device;<span class="_ _59"> </span><span class="ff1a">wait<span class="_ _59"> </span></span>and<span class="_ _59"> </span><span class="ff1a">waitpid<span class="_ _4b"> </span></span>ar<span class="lsc04">ea<span class="_ _4a"></span><span class="ls0">lways</span></span></span></span></div><div class="t m0 x32 h2a y134 ff19 fsf fc0 sc0 ls0 ws0">interrupted <span class="_ _2"></span>when <span class="_ _3"></span>a <span class="_ _2"></span>signal <span class="_ _3"></span>is <span class="_ _3"></span>caught.<span class="_ _61"> </span>Since <span class="_ _3"></span>this <span class="_ _3"></span>caused <span class="_ _2"></span>a <span class="_ _3"></span>problem <span class="_ _2"></span>for <span class="_ _3"></span>some <span class="_ _3"></span>applications</div><div class="t m0 x32 h2a y135 ff19 fsf fc0 sc0 ls0 ws0">that <span class="_ _66"> </span>didn’t <span class="_ _66"> </span>want <span class="_ _47"> </span>the <span class="_ _66"> </span>operation <span class="_ _47"> </span>r<span class="_ _0"></span>estarted <span class="_ _66"> </span>if <span class="_ _47"> </span>it <span class="_"> </span>was <span class="_ _47"> </span>interrupted, <span class="_"> </span>4.3BSD <span class="_ _47"> </span>allowed <span class="_"> </span>the</div><div class="t m0 x32 h2a y136 ff19 fsf fc0 sc0 ls0 ws0">process to disable this featur<span class="_ _0"></span>e<span class="_"> </span>on<span class="_"> </span>a<span class="_"> </span>per<span class="_ _0"></span>-signal basis.</div><div class="t m0 x76 h52 y2a45 ff19 fs2a fc0 sc0 ls0 ws0">POSIX.1 requires an <span class="_ _2"></span>implementation <span class="_ _2"></span>to <span class="_ _2"></span>restart system <span class="_ _2"></span>calls <span class="_ _2"></span>only <span class="_ _2"></span>when <span class="_ _2"></span>the<span class="_ _80"> </span><span class="ff1a">SA_RESTART<span class="_ _e"> </span></span>ﬂag <span class="_ _2"></span>is</div><div class="t m0 x76 h51 y2a46 ff19 fs2a fc0 sc0 ls0 ws0">in <span class="_ _3"></span>effect <span class="_ _2"></span>for <span class="_ _9"></span>the <span class="_ _3"></span>interrupting <span class="_ _3"></span>signal.<span class="_ _4b"> </span>As <span class="_ _3"></span>we <span class="_ _9"></span>will <span class="_ _3"></span>see <span class="_ _3"></span>in <span class="_ _3"></span>Section <span class="_ _3"></span>10.14, <span class="_ _3"></span>this <span class="_ _9"></span>ﬂag <span class="_ _3"></span>is <span class="_ _3"></span>used <span class="_ _3"></span>with <span class="_ _3"></span>the</div><div class="t m0 x76 h52 y2a47 ff1a fs2a fc0 sc0 ls0 ws0">sigaction<span class="_ _46"> </span><span class="ff19">function <span class="_ _45"> </span>to <span class="_ _47"> </span>allow <span class="_ _45"> </span>applications <span class="_ _47"> </span>to <span class="_ _45"> </span>request <span class="_ _47"> </span>that <span class="_ _47"> </span>interrupted <span class="_ _45"> </span>system <span class="_ _47"> </span>calls <span class="_ _45"> </span>be</span></div><div class="t m0 x76 h51 y2a48 ff19 fs2a fc0 sc0 ls34e ws0">re<span class="ls0">started.</span></div><div class="t m0 x76 h52 y2a49 ff19 fs2a fc0 sc0 ls0 ws0">Historically<span class="_ _6"></span><span class="lsc05">,w<span class="_ _8"></span><span class="ls0">hen <span class="_ _23"> </span>using <span class="_ _9"></span>the<span class="_ _47"> </span><span class="ff1a">signal<span class="_ _47"> </span></span>function <span class="_ _9"></span>to <span class="_ _9"> </span>establish <span class="_ _23"> </span>a <span class="_ _9"></span>signal <span class="_ _9"> </span>handler<span class="_ _0"></span><span class="lsc06">,i<span class="_ _8"></span><span class="ls0">mplementations</span></span></span></span></div><div class="t m0 x76 h51 y2a4a ff19 fs2a fc0 sc0 ls0 ws0">varied <span class="_ _3"></span>with <span class="_ _9"></span>respect <span class="_ _3"></span>to <span class="_ _3"></span>how <span class="_ _9"></span>interrupted <span class="_ _3"></span>system <span class="_ _9"></span>calls <span class="_ _3"></span>wer<span class="lsc07">eh<span class="_ _4f"></span><span class="ls0">andled. <span class="_ _47"> </span>System<span class="_ _66"> </span><span class="lsc08">Vn<span class="_ _4f"></span><span class="ls0">ever <span class="_ _9"></span>restarted</span></span></span></span></div><div class="t m0 x76 h51 y2a4b ff19 fs2a fc0 sc0 ls0 ws0">system <span class="_"> </span>calls <span class="_"> </span>by <span class="_"> </span>default.<span class="_ _16"> </span>BSD, <span class="_"> </span>in <span class="_"> </span>contrast, <span class="_"> </span>restarted <span class="_ _42"> </span>them <span class="_"> </span>if <span class="_"> </span>the <span class="_"> </span>calls <span class="_"> </span>wer<span class="_ _0"></span><span class="lsc09">ei<span class="_ _43"></span><span class="ls0">nterrupted <span class="_"> </span>by</span></span></div><div class="t m0 x76 h51 y2a4c ff19 fs2a fc0 sc0 ls0 ws0">signals. <span class="_ _80"> </span>On<span class="_ _80"> </span>FreeBSD <span class="_ _2"></span>8.0, <span class="_ _2"></span>Linux <span class="_ _2"></span>3.2.0, <span class="_ _3"></span>and <span class="_ _2"></span>Mac <span class="_ _3"></span>OS <span class="_ _2"></span>X <span class="_ _3"></span>10.6.8, <span class="_ _2"></span>when <span class="_ _2"></span>signal <span class="_ _3"></span>handlers <span class="_ _2"></span>ar<span class="ls350">ei<span class="_ _5"></span><span class="ls0">nstalled</span></span></div><div class="t m0 x76 h52 y2a4d ff19 fs2a fc0 sc0 ls0 ws0">with the<span class="_"> </span><span class="ff1a">signal<span class="_ _e"> </span></span>function, interrupted system calls will <span class="_ _2"></span>be restarted. <span class="_"> </span>The<span class="_"> </span>default on Solaris 10,</div><div class="t m0 x76 h52 y2a4e ff19 fs2a fc0 sc0 ls0 ws0">however<span class="_ _1"></span>,<span class="_ _45"> </span>is<span class="_ _47"> </span>to<span class="_ _45"> </span>return <span class="_ _23"> </span>an <span class="_ _23"> </span>error <span class="_ _23"> </span>(<span class="ff1a">EINTR</span><span class="lsc0a">)i<span class="_ _b"></span><span class="ls0">nstead <span class="_ _23"> </span>when <span class="_ _42"> </span>system <span class="_ _23"> </span>calls <span class="_ _23"> </span>ar<span class="lsc0a">ei<span class="_ _b"></span><span class="ls0">nterrupted <span class="_ _23"> </span>by <span class="_ _23"> </span>signal</span></span></span></span></div><div class="t m0 x76 h52 y2a4f ff19 fs2a fc0 sc0 ls0 ws0">handlers <span class="_ _80"> </span>installed <span class="_ _80"> </span>with <span class="_ _66"> </span>the<span class="_ _44"> </span><span class="ff1a">signal<span class="_"> </span></span>function. <span class="_ _44"> </span>By<span class="_ _4b"> </span>using <span class="_ _80"> </span>our <span class="_ _66"> </span>own <span class="_ _80"> </span>implementation <span class="_ _80"> </span>of <span class="_ _66"> </span>the</div><div class="t m0 x76 h52 y2a50 ff1a fs2a fc0 sc0 ls0 ws0">signal<span class="_ _53"> </span><span class="ff19">function (shown in Figur<span class="lse9">e1<span class="_ _84"></span><span class="ls0">0.18), we avoid having to deal with these differences.</span></span></span></div><div class="t m0 x3f h2a y57d ff19 fsf fc0 sc0 ls0 ws0">One <span class="_ _44"> </span>of <span class="_ _4b"> </span>the <span class="_ _4b"> </span>reasons <span class="_ _44"> </span>4.2BSD <span class="_ _44"> </span>introduced <span class="_ _44"> </span>the <span class="_ _4b"> </span>automatic <span class="_ _4b"> </span>restart <span class="_ _44"> </span>feature<span class="_ _54"> </span>is<span class="_ _65"> </span>that</div><div class="t m0 x32 h2a y2a51 ff19 fsf fc0 sc0 ls0 ws0">sometimes <span class="_ _e"> </span>we <span class="_"> </span>don’t <span class="_ _53"> </span>know <span class="_"> </span>that <span class="_ _53"> </span>the <span class="_"> </span>input <span class="_ _e"> </span>or <span class="_ _e"> </span>output <span class="_"> </span>device <span class="_ _53"> </span>is <span class="_"> </span>a <span class="_ _e"> </span>slow <span class="_ _e"> </span>device.<span class="_ _48"> </span>If <span class="_"> </span>the</div><div class="t m0 x32 h2a y2a52 ff19 fsf fc0 sc0 ls0 ws0">program <span class="_ _2"></span>we <span class="_ _9"></span>write <span class="_ _3"></span>can <span class="_ _3"></span>be <span class="_ _9"></span>used <span class="_ _3"></span>interactively<span class="_ _6"></span><span class="ls23c">,t<span class="_ _b"></span><span class="ls0">hen <span class="_ _9"></span>it <span class="_ _3"></span>might <span class="_ _3"></span>be <span class="_ _9"></span>reading <span class="_ _2"></span>or <span class="_ _3"></span>writing <span class="_ _9"></span>a <span class="_ _3"></span>slow</span></span></div><div class="t m0 x32 h2a y2a53 ff19 fsf fc0 sc0 ls0 ws0">device, <span class="_ _2"></span>since <span class="_ _2"></span>terminals <span class="_ _2"></span>fall <span class="_ _3"></span>into <span class="_ _2"></span>this <span class="_ _2"></span>category<span class="_ _6"></span><span class="lsc0b">.I<span class="_ _1d"></span><span class="ls0">f<span class="_ _47"> </span>we<span class="_ _66"> </span>catch <span class="_ _3"></span>signals <span class="_ _2"></span>in <span class="_ _2"></span>this <span class="_ _2"></span>program, <span class="_ _2"></span>and <span class="_ _2"></span>if</span></span></div><div class="t m0 x32 h2a y2a54 ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _42"> </span>system <span class="_ _53"> </span>doesn’t <span class="_ _42"> </span>provide <span class="_ _42"> </span>the <span class="_ _53"> </span>restart <span class="_ _42"> </span>capability<span class="_ _4"></span><span class="ls4fa">,t<span class="_ _43"></span><span class="ls0">hen <span class="_ _42"> </span>we <span class="_ _53"> </span>have <span class="_ _42"> </span>to <span class="_ _53"> </span>test <span class="_ _42"> </span>every <span class="_ _53"> </span>read <span class="_ _42"> </span>or</span></span></div><div class="t m0 x32 h2a y2a55 ff19 fsf fc0 sc0 ls0 ws0">write for the interrupted err<span class="_ _0"></span>or return and r<span class="_ _0"></span>eissue the read or write.</div><div class="t m0 x3f h2a y2a56 ff19 fsf fc0 sc0 ls0 ws0">Figur<span class="ls821">e1<span class="_ _c"></span><span class="ls0">0.3 <span class="_ _42"> </span>summarizes <span class="_ _42"> </span>the <span class="_ _42"> </span>signal <span class="_ _23"> </span>functions <span class="_ _42"> </span>and <span class="_ _42"> </span>their <span class="_ _42"> </span>semantics <span class="_ _23"> </span>provided <span class="_ _42"> </span>by <span class="_ _23"> </span>the</span></span></div><div class="t m0 x32 h2a y2a57 ff19 fsf fc0 sc0 ls0 ws0">various implementations.</div><div class="t m0 x16a h2d y2a58 ff19 fs10 fc0 sc0 ls0 ws0">Automatic restart</div><div class="t m0 xd3 h2d y2a59 ff19 fs10 fc0 sc0 ls0 ws0">of interrupted</div><div class="t m0 x1fd h2d y2a5a ff19 fs10 fc0 sc0 ls0 ws0">system calls?</div><div class="t m0 x52 h2d y2a59 ff19 fs10 fc0 sc0 ls0 ws0">Functions<span class="_ _2e"> </span>System</div><div class="t m0 x205 h2d y2a5b ff19 fs10 fc0 sc0 ls0 ws0">Signal handler</div><div class="t m0 xb5 h2d y2a5c ff19 fs10 fc0 sc0 ls21d ws0">re<span class="ls0">mains installed</span></div><div class="t m0 x212 h2d y2a5b ff19 fs10 fc0 sc0 ls0 ws0">Ability to</div><div class="t m0 xb4 h2d y2a5c ff19 fs10 fc0 sc0 ls0 ws0">block signals</div><div class="t m0 xe8 h2e y2a5d ff19 fs11 fc0 sc0 ls0 ws0">ISO C, POSIX.1<span class="_ _1ad"> </span>unspeciﬁed <span class="_ _18"> </span>unspeciﬁed<span class="_ _12e"> </span>unspeciﬁed</div><div class="t m0 xe8 h2f y2a5e ff19 fs12 fc0 sc0 ls0 ws0">V7, SVR2, SVR3<span class="_ _26e"> </span>never</div><div class="t m0 xe8 h30 y2a5f ff19 fs13 fc0 sc0 ls0 ws0">SVR4, Solaris<span class="_ _26f"> </span>never</div><div class="t m0 xe8 h31 y2a60 ff19 fs14 fc0 sc0 ls0 ws0">4.2BSD <span class="_ _1e2"> </span>•<span class="_ _270"> </span><span class="lsc0c">•a<span class="_ _271"></span><span class="ls0">lways</span></span></div><div class="t m0 xe8 h32 y2a61 ff19 fs15 fc0 sc0 ls0 ws0">4.3BSD, 4.4BSD,</div><div class="t m0 xe8 h32 y2a62 ff19 fs15 fc0 sc0 ls0 ws0">FreeBSD, Linux,</div><div class="t m0 x194 h66 y2a63 ff1a fs15 fc0 sc0 ls0 ws0">signal</div><div class="t m0 xe8 h32 y2a64 ff19 fs15 fc0 sc0 ls0 ws0">Mac OS X</div><div class="t m0 x1e7 h32 y2a62 ff19 fs15 fc0 sc0 ls0 ws0">•<span class="_ _270"> </span>•<span class="_ _be"> </span>default</div><div class="t m0 xe8 h33 y2a65 ff19 fs16 fc0 sc0 ls0 ws0">POSIX.1, 4.4BSD,</div><div class="t m0 xe8 h33 y2a66 ff19 fs16 fc0 sc0 ls0 ws0">SVR4, FreeBSD,</div><div class="t m0 xe8 h33 y2a67 ff19 fs16 fc0 sc0 ls0 ws0">Linux, Mac OS X,</div><div class="t m0 xe8 h33 y2a68 ff19 fs16 fc0 sc0 ls0 ws0">Solaris</div><div class="t m0 x194 h70 y2a69 ff1a fs16 fc0 sc0 ls0 ws0">sigaction<span class="_ _17b"> </span><span class="ff19">•<span class="_ _270"> </span>•<span class="_ _213"> </span>optional</span></div><div class="t m0 x10c h83 y2a6a ff18 fs36 fc0 sc0 ls0 ws0">Figure 10.3<span class="_ _5a"> </span><span class="ff19">Features provided by various signal implementations</span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
