<div id="pf30c" class="pf w4 h1f" data-page-no="30c"><div class="pc pc30c w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg30c.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">746<span class="_ _1b"> </span><span class="ff19 ls30a">AD<span class="_ _55"></span><span class="ls0">atabase <span class="_"> </span>Library<span class="_ _245"> </span>Chapter <span class="_"> </span>20</span></span></div><div class="t m0 x3f h57 y1295 ff1a fs2d fc0 sc0 ls0 ws0">#include &quot;apue_db.h&quot;</div><div class="t m0 x3f h57 y30ff ff1a fs2d fc0 sc0 ls0 ws0">int db_delete(DBHANDLE<span class="_"> </span><span class="ff1b">db</span><span class="ls15c">,c<span class="_ _1d"></span><span class="ls0">onst char *<span class="ff1b">key</span>);</span></span></div><div class="t m0 xdb h5f y3100 ff19 fs2d fc0 sc0 ls0 ws0">Returns: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>if<span class="_"> </span>recor<span class="_ _0"></span><span class="ls110">dn<span class="_ _5"></span><span class="ls0">ot found</span></span></div><div class="t m0 x3f h49 y5590 ff19 fs26 fc0 sc0 ls0 ws0">In <span class="_ _3"></span>addition <span class="_ _9"></span>to <span class="_ _9"></span>fetching <span class="_ _3"></span>a <span class="_ _9"></span>recor<span class="_ _0"></span>d<span class="_ _45"> </span>by<span class="_ _47"> </span>specifying <span class="_ _9"></span>its <span class="_ _3"></span>key<span class="_ _6"></span><span class="lsfda">,w<span class="_ _b"></span><span class="ls160e">ec<span class="_ _8"></span><span class="ls0">an <span class="_ _9"></span>go <span class="_ _3"></span>through <span class="_ _3"></span>the <span class="_ _9"></span>entire</span></span></span></div><div class="t m0 x32 h4d y5591 ff19 fs26 fc0 sc0 ls0 ws0">database, reading each recor<span class="_ _1"></span>d<span class="_ _66"> </span>in<span class="_"> </span>turn. <span class="_"> </span>T<span class="_ _6"></span>o<span class="_ _66"> </span>do<span class="_"> </span>this, we <span class="_ _2"></span>ﬁrst call<span class="_"> </span><span class="ff1a">db_rewind<span class="_ _66"> </span></span>to rewind the</div><div class="t m0 x32 h4d y5592 ff19 fs26 fc0 sc0 ls0 ws0">database <span class="_ _2"></span>to <span class="_ _3"></span>the <span class="_ _2"></span>ﬁrst <span class="_ _2"></span>recor<span class="ls6ff">da<span class="_ _8"></span><span class="ls0">nd <span class="_ _3"></span>then <span class="_ _2"></span>call<span class="_ _47"> </span><span class="ff1a">db_nextrec<span class="_ _47"> </span></span>in <span class="_ _2"></span>a <span class="_ _2"></span>loop <span class="_ _3"></span>to <span class="_ _2"></span>read <span class="_ _2"></span>each <span class="_ _2"></span>sequential</span></span></div><div class="t m0 x32 h49 y5593 ff19 fs26 fc0 sc0 lscc ws0">re<span class="ls0">cord.</span></div><div class="t m0 x3f h4e y5594 ff1a fs28 fc0 sc0 ls0 ws0">#include &quot;apue_db.h&quot;</div><div class="t m0 x3f h4e y5595 ff1a fs28 fc0 sc0 ls0 ws0">void db_rewind(DBHANDLE<span class="_"> </span><span class="ff1b">db</span>);</div><div class="t m0 x3f h4e y5596 ff1a fs28 fc0 sc0 ls0 ws0">char *db_nextrec(DBHANDLE<span class="_"> </span><span class="ff1b">db</span><span class="ls1b6">,c<span class="_ _1d"></span><span class="ls0">har *<span class="ff1b">key</span>);</span></span></div><div class="t m0 x87 h4e y5597 ff19 fs28 fc0 sc0 ls0 ws0">Returns: pointer to data if OK,<span class="_"> </span><span class="ff1a">NULL<span class="_ _e"> </span></span>on end of ﬁle</div><div class="t m0 x32 h54 y5598 ff19 fs2c fc0 sc0 ls0 ws0">If<span class="_ _45"> </span><span class="ff1b">key<span class="_ _45"> </span></span>is <span class="_ _9"></span>a <span class="_ _9"></span>non-null <span class="_ _9"></span>pointer<span class="_ _1"></span>,<span class="_ _45"> </span><span class="ff1a">db_nextrec<span class="_ _45"> </span></span><span class="ls150">re<span class="_ _2"></span></span>turns <span class="_ _9"></span>the <span class="_ _9"></span>key <span class="_ _23"></span>by <span class="_ _9"></span>copying <span class="_ _9"></span>it <span class="_ _9"></span>to <span class="_ _9"></span>the <span class="_ _23"></span>memory</div><div class="t m0 x32 h55 y5599 ff19 fs2c fc0 sc0 ls0 ws0">starting at that location.</div><div class="t m0 x3f h54 y559a ff19 fs2c fc0 sc0 ls0 ws0">There<span class="_ _66"> </span>is<span class="_ _47"> </span>no<span class="_ _47"> </span>o<span class="ls150">rd<span class="_ _2"></span></span>er <span class="_ _3"></span>to <span class="_ _3"></span>the <span class="_ _2"></span>records <span class="_ _2"></span>returned <span class="_ _2"></span>by<span class="_ _47"> </span><span class="ff1a">db_nextrec</span><span class="ls160f">.A<span class="_ _1d"></span><span class="ls0">ll <span class="_ _3"></span>we’r<span class="ls7ce">eg<span class="_ _8"></span><span class="ls0">uaranteed <span class="_ _3"></span>is</span></span></span></span></div><div class="t m0 x32 h55 y559b ff19 fs2c fc0 sc0 ls0 ws0">that <span class="_ _3"></span>we’ll <span class="_ _3"></span>read <span class="_ _3"></span>each <span class="_ _9"></span>recor<span class="_ _1"></span>d<span class="_ _45"> </span>in<span class="_ _47"> </span>the <span class="_ _3"></span>database <span class="_ _9"></span>once.<span class="_ _16"> </span>If <span class="_ _3"></span>we <span class="_ _9"></span>stor<span class="ls1610">et<span class="_ _b"></span><span class="ls0">hree <span class="_ _3"></span>recor<span class="_ _0"></span>ds <span class="_ _3"></span>with <span class="_ _3"></span>keys <span class="_ _9"></span>of</span></span></div><div class="t m0 x32 h54 y559c ff19 fs2c fc0 sc0 ls0 ws0">A, <span class="_ _2"></span>B, <span class="_ _3"></span>and <span class="_ _2"></span>C, <span class="_ _3"></span>in <span class="_ _2"></span>that <span class="_ _3"></span>order<span class="_ _6"></span>,<span class="_ _47"> </span>we<span class="_ _47"> </span>have <span class="_ _2"></span>no <span class="_ _2"></span>idea <span class="_ _3"></span>in <span class="_ _3"></span>which <span class="_ _2"></span>order<span class="_ _66"> </span><span class="ff1a">db_nextrec<span class="_ _47"> </span></span>will <span class="_ _3"></span>return <span class="_ _2"></span>the</div><div class="t m0 x32 h55 y559d ff19 fs2c fc0 sc0 ls0 ws0">three <span class="_ _23"> </span>recor<span class="_ _0"></span>ds. <span class="_ _35"> </span>It<span class="_ _44"> </span>might <span class="_ _42"> </span>r<span class="_ _0"></span>eturn <span class="_ _42"> </span>B, <span class="_ _23"> </span>then <span class="_ _42"> </span>A, <span class="_ _42"> </span>then <span class="_ _42"> </span>C, <span class="_ _42"> </span>or <span class="_ _23"> </span>some <span class="_ _42"> </span>other <span class="_ _42"> </span>(apparently <span class="_ _23"> </span>random)</div><div class="t m0 x32 h55 y559e ff19 fs2c fc0 sc0 ls0 ws0">order<span class="_ _6"></span><span class="ls5e9">.T<span class="_ _4a"></span><span class="ls0">he actual order depends on the implementation of the database.</span></span></div><div class="t m0 x3f h55 y559f ff19 fs2c fc0 sc0 ls0 ws0">These <span class="_ _45"> </span>seven <span class="_ _47"> </span>functions <span class="_ _45"> </span>provide <span class="_ _45"> </span>the <span class="_ _47"> </span>interface <span class="_ _45"> </span>to <span class="_ _45"> </span>the <span class="_ _45"> </span>database <span class="_ _45"> </span>library<span class="_ _4"></span><span class="ls1611">.W<span class="_ _184"></span><span class="ls1612">en<span class="_ _62"></span><span class="ls0">ow</span></span></span></div><div class="t m0 x32 h55 y55a0 ff19 fs2c fc0 sc0 ls0 ws0">describe the actual implementation that we have chosen.</div><div class="t m0 x35 h99 y55a1 ff16 fs3b fc0 sc0 ls0 ws0">20.4 <span class="_ _93"> </span>Implementation<span class="_ _54"> </span>Over <span class="_ _b"></span>view</div><div class="t m0 x32 h55 y55a2 ff19 fs2c fc0 sc0 ls0 ws0">Database <span class="_ _2"></span>access <span class="_ _2"></span>libraries <span class="_ _3"></span>often <span class="_ _2"></span>use <span class="_ _2"></span>two <span class="_ _3"></span>ﬁles <span class="_ _2"></span>to <span class="_ _2"></span>stor<span class="ls1613">et<span class="_ _8"></span><span class="ls0">he <span class="_ _3"></span>information: <span class="_ _2"></span>an <span class="_ _2"></span>index <span class="_ _3"></span>ﬁle <span class="_ _2"></span>and <span class="_ _2"></span>a</span></span></div><div class="t m0 x32 h55 y55a3 ff19 fs2c fc0 sc0 ls0 ws0">data <span class="_ _9"></span>ﬁle.<span class="_ _51"> </span>The <span class="_ _9"></span>index <span class="_ _23"> </span>ﬁle <span class="_ _23"></span>contains <span class="_ _9"></span>the <span class="_ _23"></span>actual <span class="_ _9"></span>index <span class="_ _23"></span>value <span class="_ _23"></span>(the <span class="_ _9"></span>key) <span class="_ _23"></span>and <span class="_ _9"></span>a <span class="_ _23"></span>pointer <span class="_ _9"></span>to <span class="_ _23"> </span>the</div><div class="t m0 x32 h55 y55a4 ff19 fs2c fc0 sc0 ls0 ws0">corresponding <span class="_ _66"> </span>data <span class="_ _45"> </span>r<span class="_ _0"></span>ecord<span class="_ _61"> </span>in<span class="_ _16"> </span>the <span class="_ _47"> </span>data <span class="_ _47"> </span>ﬁle.<span class="_ _5f"> </span>Numerous <span class="_ _47"> </span>techniques <span class="_ _47"> </span>can <span class="_ _47"> </span>be <span class="_ _47"> </span>used <span class="_ _47"> </span>to</div><div class="t m0 x32 h55 y55a5 ff19 fs2c fc0 sc0 ls0 ws0">organize <span class="_ _23"> </span>the <span class="_ _42"> </span>index <span class="_ _42"> </span>ﬁle <span class="_ _42"> </span>so <span class="_ _42"> </span>that <span class="_ _42"> </span>it <span class="_ _42"> </span>can <span class="_ _42"> </span>be <span class="_ _42"> </span>searched <span class="_ _23"> </span>quickly <span class="_ _42"> </span>and <span class="_ _42"> </span>efﬁciently <span class="_ _42"> </span>for <span class="_ _42"> </span>any <span class="_ _42"> </span>key:</div><div class="t m0 x32 h55 y55a6 ff19 fs2c fc0 sc0 ls0 ws0">hashing <span class="_ _9"></span>and <span class="_ _23"></span>B+ <span class="_ _9"></span>trees <span class="_ _9"></span>ar<span class="ls1614">ep<span class="_ _b"></span><span class="ls0">opular<span class="_ _6"></span><span class="ls1615">.W<span class="_ _64"></span><span class="ls1616">eh<span class="_ _b"></span><span class="ls0">ave <span class="_ _9"></span>chosen <span class="_ _23"></span>to <span class="_ _9"></span>use <span class="_ _23"></span>a <span class="_ _9"></span>ﬁxed-size <span class="_ _9"></span>hash <span class="_ _23"></span>table <span class="_ _9"></span>with</span></span></span></span></span></div><div class="t m0 x32 h54 y55a7 ff19 fs2c fc0 sc0 ls0 ws0">chaining <span class="_ _2"></span>for <span class="_ _2"></span>the <span class="_ _3"></span>index <span class="_ _2"></span>ﬁle.<span class="_ _61"> </span><span class="ls155">We <span class="_ _80"> </span>m<span class="_ _9"></span></span>entioned <span class="_ _2"></span>in <span class="_ _3"></span>the <span class="_ _2"></span>description <span class="_ _2"></span>of<span class="_ _47"> </span><span class="ff1a">db_open<span class="_ _47"> </span></span>that <span class="_ _2"></span>we <span class="_ _2"></span>create</div><div class="t m0 x32 h54 y55a8 ff19 fs2c fc0 sc0 ls0 ws0">two ﬁles: one with a sufﬁx of<span class="_"> </span><span class="ff1a">.idx<span class="_ _80"> </span></span>and one with a sufﬁx of<span class="_"> </span><span class="ff1a">.dat</span>.</div><div class="t m0 x3f h55 y55a9 ff19 fs2c fc0 sc0 ls155 ws0">We <span class="_ _45"> </span>s<span class="_ _9"></span><span class="ls0">tor<span class="ls1617">et<span class="_ _c"></span><span class="ls0">he <span class="_ _53"> </span>key <span class="_ _42"> </span>and <span class="_ _53"> </span>the <span class="_ _42"> </span>index <span class="_ _53"> </span>as <span class="_ _42"> </span>null-terminated <span class="_ _53"> </span>character <span class="_ _42"> </span>strings; <span class="_ _42"> </span>they <span class="_ _53"> </span>cannot</span></span></span></div><div class="t m0 x32 h55 y55aa ff19 fs2c fc0 sc0 ls0 ws0">contain <span class="_ _3"></span>arbitrary <span class="_ _9"></span>binary <span class="_ _3"></span>data.<span class="_ _5a"> </span>Some <span class="_ _9"></span>database <span class="_ _3"></span>systems <span class="_ _9"></span>stor<span class="ls1618">en<span class="_ _b"></span><span class="ls0">umerical <span class="_ _3"></span>data <span class="_ _9"></span>in <span class="_ _9"></span>a <span class="_ _3"></span>binary</span></span></div><div class="t m0 x32 h55 y55ab ff19 fs2c fc0 sc0 ls0 ws0">format <span class="_ _47"> </span>(1, <span class="_ _45"> </span>2, <span class="_ _47"> </span>or <span class="_ _45"> </span>4 <span class="_ _47"> </span>bytes <span class="_ _47"> </span>for <span class="_ _45"> </span>an <span class="_ _47"> </span>integer<span class="_ _1"></span><span class="ls1619">,f<span class="_ _62"></span><span class="ls0">or <span class="_ _45"> </span>example) <span class="_ _47"> </span>to <span class="_ _45"> </span>save <span class="_ _47"> </span>storage <span class="_ _47"> </span>space.<span class="_ _5f"> </span>This</span></span></div><div class="t m0 x32 h55 y55ac ff19 fs2c fc0 sc0 ls0 ws0">complicates <span class="_ _9"></span>the <span class="_ _23"> </span>functions <span class="_ _23"></span>and <span class="_ _23"></span>r<span class="_ _0"></span>equires <span class="_ _9"></span>mor<span class="ls161a">ew<span class="_ _43"></span><span class="ls0">ork <span class="_ _23"> </span>to <span class="_ _23"></span>make <span class="_ _9"></span>the <span class="_ _23"> </span>database <span class="_ _23"></span>ﬁles <span class="_ _9"></span>portable</span></span></div><div class="t m0 x32 h55 y55ad ff19 fs2c fc0 sc0 ls0 ws0">between <span class="_ _23"></span>differ<span class="_ _1"></span>ent <span class="_ _23"> </span>computer <span class="_ _23"> </span>systems.<span class="_ _51"> </span>For <span class="_ _23"></span>example, <span class="_ _23"></span>if <span class="_ _9"></span>a <span class="_ _23"> </span>network <span class="_ _23"> </span>has <span class="_ _23"> </span>two <span class="_ _23"></span>systems <span class="_ _23"></span>that</div><div class="t m0 x32 h55 y55ae ff19 fs2c fc0 sc0 ls0 ws0">use differ<span class="_ _0"></span>ent formats for storing binary integers, we need to account <span class="_ _2"></span>for this difference if</div><div class="t m0 x32 h55 y55af ff19 fs2c fc0 sc0 ls0 ws0">we <span class="_ _3"></span>want <span class="_ _3"></span>both <span class="_ _3"></span>systems <span class="_ _3"></span>to <span class="_ _3"></span>access <span class="_ _3"></span>the <span class="_ _3"></span>database.<span class="_ _16"> </span>(It <span class="_ _3"></span>is <span class="_ _3"></span>not <span class="_ _3"></span>at <span class="_ _3"></span>all <span class="_ _3"></span>uncommon <span class="_ _9"></span>today <span class="_ _2"></span>to <span class="_ _9"></span>have</div><div class="t m0 x32 h55 y55b0 ff19 fs2c fc0 sc0 ls0 ws0">systems <span class="_ _2"></span>with <span class="_ _3"></span>differ<span class="_ _0"></span>ent <span class="_ _2"></span>architectures sharing <span class="_ _3"></span>ﬁles <span class="_ _2"></span>on <span class="_ _3"></span>a <span class="_ _3"></span>network.)<span class="_ _61"> </span>Storing <span class="_ _3"></span>all <span class="_ _2"></span>the <span class="_ _3"></span>recor<span class="_ _0"></span>ds,</div><div class="t m0 x32 h55 y55b1 ff19 fs2c fc0 sc0 ls0 ws0">both keys and data, as <span class="_ _2"></span>character strings simpliﬁes everything.<span class="_ _46"> </span>It <span class="_ _2"></span>does requir<span class="_ _0"></span><span class="ls161b">ea<span class="_ _d"></span><span class="ls0">dditional</span></span></div><div class="t m0 x32 h55 y55b2 ff19 fs2c fc0 sc0 ls0 ws0">disk space, but that is a small cost for portability<span class="_ _4"></span>.</div><a class="l" href="#pf13" data-dest-detail='[19,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.893883px;bottom:559.356018px;width:184.657097px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
