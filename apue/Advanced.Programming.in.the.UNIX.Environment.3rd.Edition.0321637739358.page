<div id="pf166" class="pf w4 h1f" data-page-no="166"><div class="pc pc166 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg166.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">324<span class="_ _1b"> </span><span class="ff19">Signals <span class="_ _24b"> </span>Chapter<span class="_ _21"> </span>10</span></div><div class="t m0 x32 h2a y12f ff19 fsf fc0 sc0 ls0 ws0">Then the prototype becomes</div><div class="t m0 x3f h57 ya9b ff1a fs2d fc0 sc0 ls0 ws0">Sigfunc *signal(int, Sigfunc *);</div><div class="t m0 x32 h26 y22a6 ff19 fsf fc0 sc0 ls5f ws0">We<span class="_ _9"></span><span class="ls0">’ve <span class="_ _2"></span>included <span class="_ _3"></span>this<span class="_ _47"> </span><span class="ff1a">typedef<span class="_ _47"> </span></span>in<span class="_ _47"> </span><span class="ff1a">apue.h<span class="_ _47"> </span></span>(Appendix <span class="_ _2"></span>B) <span class="_ _3"></span>and <span class="_ _2"></span>use <span class="_ _3"></span>it <span class="_ _2"></span>with <span class="_ _3"></span>the <span class="_ _3"></span>functions <span class="_ _2"></span>in</span></div><div class="t m0 x32 h2a y22a7 ff19 fsf fc0 sc0 ls0 ws0">this chapter<span class="_ _6"></span>.</div><div class="t m0 x3f h26 y22a8 ff19 fsf fc0 sc0 ls0 ws0">If we examine the <span class="_ _2"></span>system’s header<span class="_"> </span><span class="ff1a">&lt;signal.h&gt;</span>,<span class="_"> </span>we<span class="_ _66"> </span>will probably ﬁnd declarations</div><div class="t m0 x32 h2a y22a9 ff19 fsf fc0 sc0 ls0 ws0">of the form</div><div class="t m0 x3f h57 y42c ff1a fs2d fc0 sc0 ls0 ws0">#define SIG_ERR<span class="_ _68"> </span>(void (*)())-1</div><div class="t m0 x3f h57 y29ad ff1a fs2d fc0 sc0 ls0 ws0">#define SIG_DFL<span class="_ _68"> </span>(void (*)())0</div><div class="t m0 x3f h57 y29ae ff1a fs2d fc0 sc0 ls0 ws0">#define SIG_IGN<span class="_ _68"> </span>(void (*)())1</div><div class="t m0 x32 h2a y29af ff19 fsf fc0 sc0 ls0 ws0">These <span class="_ _3"></span>constants <span class="_ _9"></span>can <span class="_ _3"></span>be <span class="_ _9"></span>used <span class="_ _3"></span>in <span class="_ _9"></span>place <span class="_ _9"></span>of <span class="_ _3"></span>the <span class="_ _9"></span>‘<span class="_ _1"></span>‘pointer <span class="_ _9"></span>to <span class="_ _3"></span>a <span class="_ _9"></span>function <span class="_ _3"></span>that <span class="_ _9"></span>takes <span class="_ _9"></span>an <span class="_ _3"></span>integer</div><div class="t m0 x32 h26 y29b0 ff19 fsf fc0 sc0 ls0 ws0">argument <span class="_ _2"></span>and <span class="_ _9"></span>returns <span class="_ _3"></span>nothing,’<span class="_ _0"></span><span class="ls268">’t<span class="_ _b"></span><span class="ls0">he <span class="_ _9"></span>second <span class="_ _3"></span>argument <span class="_ _3"></span>to<span class="_ _45"> </span><span class="ff1a">signal</span><span class="ls2f3">,a<span class="_ _b"></span><span class="ls0">nd <span class="_ _3"></span>the <span class="_ _9"></span>return <span class="_ _3"></span>value</span></span></span></span></div><div class="t m0 x32 h26 y29b1 ff19 fsf fc0 sc0 ls0 ws0">from<span class="_"> </span><span class="ff1a">signal</span><span class="lsbe0">.T<span class="_ _5b"></span><span class="ls0">he <span class="_ _2"></span>three <span class="_ _2"></span>values <span class="_ _2"></span>used <span class="_ _2"></span>for <span class="_ _3"></span>these <span class="_ _2"></span>constants <span class="_ _2"></span>need <span class="_ _3"></span>not <span class="_ _2"></span>be<span class="_ _66"> </span><span class="ff20">−</span>1, <span class="_ _3"></span>0, <span class="_ _2"></span>and <span class="_ _2"></span>1.<span class="_ _61"> </span>They</span></span></div><div class="t m0 x32 h2a y29b2 ff19 fsf fc0 sc0 ls0 ws0">must <span class="_ _23"> </span>be <span class="_ _42"> </span>three <span class="_ _23"> </span>values <span class="_ _42"> </span>that <span class="_ _42"> </span>can <span class="_ _23"> </span>never <span class="_ _42"> </span>be <span class="_ _42"> </span>the <span class="_ _42"> </span>address <span class="_ _23"></span>of <span class="_ _42"> </span>any <span class="_ _23"> </span>declarable <span class="_ _42"> </span>function.<span class="_ _51"> </span>Most</div><div class="t m0 x32 h2a y29b3 ff19 fsf fc0 sc0 ls0 ws0">UNIX systems use the values shown.</div><div class="t m0 x35 h27 y29b4 ff16 fsf fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h2a y29b5 ff19 fsf fc0 sc0 ls0 ws0">Figur<span class="ls820">e1<span class="_ _43"></span><span class="ls0">0.2 <span class="_ _23"></span>shows <span class="_ _23"> </span>a <span class="_ _42"> </span>simple <span class="_ _23"> </span>signal <span class="_ _23"> </span>handler <span class="_ _42"> </span>that <span class="_ _23"> </span>catches <span class="_ _42"> </span>either <span class="_ _23"></span>of <span class="_ _23"> </span>the <span class="_ _42"> </span>two <span class="_ _23"> </span>user-deﬁned</span></span></div><div class="t m0 x32 h26 y29b6 ff19 fsf fc0 sc0 ls0 ws0">signals <span class="_ _2"></span>and <span class="_ _2"></span>prints <span class="_ _3"></span>the <span class="_ _2"></span>signal <span class="_ _2"></span>number<span class="_ _1"></span><span class="lsbe1">.I<span class="_ _5b"></span><span class="lsbe2">nS<span class="_ _4f"></span><span class="ls0">ection <span class="_ _2"></span>10.10, <span class="_ _2"></span>we <span class="_ _3"></span>describe <span class="_ _2"></span>the<span class="_ _47"> </span><span class="ff1a">pause<span class="_ _47"> </span></span>function,</span></span></span></div><div class="t m0 x32 h2a y29b7 ff19 fsf fc0 sc0 ls0 ws0">which simply suspends the calling process until a signal is r<span class="_ _0"></span>eceived.</div><div class="t m0 x32 h4e y29b8 ff1a fs28 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h4e y29b9 ff1a fs28 fc0 sc0 ls0 ws0">static void sig_usr(int);<span class="_ _68"> </span>/* one handler for both signals */</div><div class="t m0 x32 h4e y29ba ff1a fs28 fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h4e y29bb ff1a fs28 fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 x32 h4e y29bc ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y29bd ff1a fs28 fc0 sc0 ls0 ws0">if (signal(SIGUSR1, sig_usr) == SIG_ERR)</div><div class="t m0 x9d h4e y29be ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;can’t catch SIGUSR1&quot;);</div><div class="t m0 x8a h4e y29bf ff1a fs28 fc0 sc0 ls0 ws0">if (signal(SIGUSR2, sig_usr) == SIG_ERR)</div><div class="t m0 x9d h4e y29c0 ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;can’t catch SIGUSR2&quot;);</div><div class="t m0 x8a h4e y29c1 ff1a fs28 fc0 sc0 ls0 ws0">for ( ; ; )</div><div class="t m0 x9d h4e y29c2 ff1a fs28 fc0 sc0 ls0 ws0">pause();</div><div class="t m0 x32 h4e y29c3 ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h4e y29c4 ff1a fs28 fc0 sc0 ls0 ws0">static void</div><div class="t m0 x32 h4e y29c5 ff1a fs28 fc0 sc0 ls0 ws0">sig_usr(int signo)<span class="_ _189"> </span>/* argument is signal number */</div><div class="t m0 x32 h4e y29c6 ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y29c7 ff1a fs28 fc0 sc0 ls0 ws0">if (signo == SIGUSR1)</div><div class="t m0 x9d h4e y29c8 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;received SIGUSR1\n&quot;);</div><div class="t m0 x8a h4e y29c9 ff1a fs28 fc0 sc0 ls0 ws0">else if (signo == SIGUSR2)</div><div class="t m0 x9d h4e y29ca ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;received SIGUSR2\n&quot;);</div><div class="t m0 x8a h4e y29cb ff1a fs28 fc0 sc0 ls0 ws0">else</div><div class="t m0 x9d h4e y29cc ff1a fs28 fc0 sc0 ls0 ws0">err_dump(&quot;received signal %d\n&quot;, signo);</div><div class="t m0 x32 h4e y29cd ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x180 h4f y29ce ff18 fs11 fc0 sc0 ls0 ws0">Figure 10.2<span class="_ _5a"> </span><span class="ff19">Simple program to catch<span class="_"> </span><span class="ff1a">SIGUSR1<span class="_ _53"> </span></span>and<span class="_"> </span><span class="ff1a">SIGUSR2</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
