<div id="pf65" class="pf w4 h1f" data-page-no="65"><div class="pc pc65 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg65.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h7a ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>3.6<span class="_ _16b"> </span><span class="ff1a">lseek<span class="_ _4b"> </span></span>Function<span class="_ _1b"> </span><span class="ff18">67</span></div><div class="t m0 x3f h26 y12f ff19 fsf fc0 sc0 ls0 ws0">An open ﬁle’s offset can be set explicitly by calling<span class="_"> </span><span class="ff1a">lseek</span>.</div><div class="t m0 x3f h57 ya9b ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;unistd.h&gt;</div><div class="t m0 x3f h57 ya9c ff1a fs2d fc0 sc0 ls0 ws0">off_t lseek(int<span class="_"> </span><span class="ff1b">fd</span><span class="ls15c">,o<span class="_ _1d"></span><span class="ls0">ff_t<span class="_"> </span><span class="ff1b">offset</span><span class="ls15c">,i<span class="_ _5b"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">whence</span>);</span></span></span></span></div><div class="t m0 x8e h5f ya9d ff19 fs2d fc0 sc0 ls0 ws0">Returns: new ﬁle offset if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>err<span class="_ _0"></span>or</div><div class="t m0 x32 h4a ya9e ff19 fs26 fc0 sc0 ls0 ws0">The interpretation of the<span class="_"> </span><span class="ff1b">offset<span class="_"> </span></span>depends on the value of the<span class="_"> </span><span class="ff1b">whence<span class="_"> </span></span>ar<span class="_ _0"></span>gument.</div><div class="t m0 x3f h4d ya9f ff19 fs26 fc0 sc0 ls15d ws0">•I<span class="_ _4d"></span><span class="ls0">f<span class="_ _66"> </span><span class="ff1b">whence<span class="_ _47"> </span></span>is<span class="_ _47"> </span><span class="ff1a">SEEK_SET</span><span class="ls37c">,t<span class="_ _8"></span><span class="ls0">he <span class="_ _3"></span>ﬁle’s <span class="_ _2"></span>offset <span class="_ _2"></span>is <span class="_ _2"></span>set <span class="_ _3"></span>to<span class="_ _66"> </span><span class="ff1b">offset<span class="_ _47"> </span></span>bytes <span class="_ _2"></span>from <span class="_ _2"></span>the <span class="_ _2"></span>beginning <span class="_ _3"></span>of</span></span></span></div><div class="t m0 x15 h49 yaa0 ff19 fs26 fc0 sc0 ls0 ws0">the ﬁle.</div><div class="t m0 x3f h4d yaa1 ff19 fs26 fc0 sc0 ls15d ws0">•I<span class="_ _4d"></span><span class="ls0">f<span class="_ _45"> </span><span class="ff1b">whence<span class="_ _45"> </span></span>is<span class="_ _35"> </span><span class="ff1a">SEEK_CUR</span><span class="ls37d">,t<span class="_ _b"></span><span class="ls0">he <span class="_ _9"></span>ﬁle’s <span class="_ _9"></span>offset <span class="_ _9"></span>is <span class="_ _23"></span>set <span class="_ _9"></span>to <span class="_ _23"></span>its <span class="_ _9"></span>current <span class="_ _9"></span>value <span class="_ _23"></span>plus <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1b">offset</span>.</span></span></span></div><div class="t m0 x15 h4a yaa2 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_"> </span><span class="ff1b">offset<span class="_"> </span></span>can be positive or negative.</div><div class="t m0 x3f h4d yaa3 ff19 fs26 fc0 sc0 ls15d ws0">•I<span class="_ _4d"></span><span class="ls0">f<span class="_ _47"> </span><span class="ff1b">whence<span class="_ _47"> </span></span>is<span class="_ _47"> </span><span class="ff1a">SEEK_END</span><span class="ls37e">,t<span class="_ _4f"></span><span class="ls0">he <span class="_ _3"></span>ﬁle’s <span class="_ _3"></span>offset <span class="_ _2"></span>is <span class="_ _9"></span>set <span class="_ _3"></span>to <span class="_ _3"></span>the <span class="_ _3"></span>size <span class="_ _3"></span>of <span class="_ _3"></span>the <span class="_ _3"></span>ﬁle <span class="_ _9"></span>plus <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1b">offset</span>.</span></span></span></div><div class="t m0 x15 h4a yaa4 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_"> </span><span class="ff1b">offset<span class="_"> </span></span>can be positive or negative.</div><div class="t m0 x32 h4d yaa5 ff19 fs26 fc0 sc0 ls0 ws0">Because <span class="_ _23"></span>a <span class="_ _23"></span>successful <span class="_ _23"></span>call <span class="_ _23"></span>to<span class="_ _35"> </span><span class="ff1a">lseek<span class="_ _45"> </span></span><span class="lscc">re<span class="_ _2"></span></span>turns <span class="_ _23"> </span>the <span class="_ _23"> </span>new <span class="_ _23"> </span>ﬁle <span class="_ _23"> </span>offset, <span class="_ _23"></span>we <span class="_ _23"></span>can <span class="_ _23"> </span>seek <span class="_ _23"> </span>zer<span class="ls37f">ob<span class="_ _43"></span><span class="ls0">ytes</span></span></div><div class="t m0 x32 h49 yaa6 ff19 fs26 fc0 sc0 ls0 ws0">from the curr<span class="_ _0"></span>ent position to determine the curr<span class="_ _0"></span>ent offset:</div><div class="t m0 x3f h4e yaa7 ff1a fs28 fc0 sc0 ls0 ws0">off_t <span class="_ _68"> </span>currpos;</div><div class="t m0 x3f h4e yaa8 ff1a fs28 fc0 sc0 ls0 ws0">currpos = lseek(fd, 0, SEEK_CUR);</div><div class="t m0 x32 h49 yaa9 ff19 fs26 fc0 sc0 ls0 ws0">This <span class="_ _23"></span>technique <span class="_ _9"></span>can <span class="_ _23"> </span>also <span class="_ _23"></span>be <span class="_ _23"></span>used <span class="_ _23"></span>to <span class="_ _9"></span>determine <span class="_ _23"> </span>if <span class="_ _23"></span>a <span class="_ _23"></span>ﬁle <span class="_ _9"></span>is <span class="_ _23"> </span>capable <span class="_ _23"> </span>of <span class="_ _23"></span>seeking.<span class="_ _5a"> </span>If <span class="_ _23"> </span>the <span class="_ _23"> </span>ﬁle</div><div class="t m0 x32 h49 yaaa ff19 fs26 fc0 sc0 ls0 ws0">descriptor refers to a pipe,</div><div class="t m0 xa7 h4d yaab ff19 fs28 fc0 sc0 ls0 ws0">FIFO<span class="fs26">,<span class="_"> </span>or<span class="_"> </span>socket,<span class="_"> </span><span class="ff1a">lseek<span class="_ _66"> </span></span>sets<span class="_ _66"> </span><span class="ff1a">errno<span class="_ _66"> </span></span>to<span class="_"> </span><span class="ff1a">ESPIPE<span class="_ _66"> </span></span>and returns<span class="_"> </span><span class="ff20">−</span>1.</span></div><div class="t m0 x76 h5e yaac ff19 fs10 fc0 sc0 ls0 ws0">The <span class="_ _80"> </span>three <span class="_ _80"> </span>symbolic <span class="_ _66"> </span>constants<span class="_ _9"></span>—<span class="_ _3"></span><span class="ff1a">SEEK_SET</span>,<span class="_ _4b"> </span><span class="ff1a">SEEK_CUR</span><span class="ls380">,a<span class="_ _c"></span><span class="ls0">nd<span class="_ _4b"> </span><span class="ff1a">SEEK_END<span class="_ _3"></span></span><span class="ls170">—w<span class="_ _1"></span><span class="ls0">er<span class="ls380">ei<span class="_ _55"></span><span class="ls0">ntroduced</span></span></span></span></span></span></div><div class="t m0 x76 h77 yaad ff19 fs10 fc0 sc0 ls0 ws0">with <span class="_ _23"> </span>System <span class="_ _23"> </span>V<span class="_ _4"></span><span class="ls381">.P<span class="_ _4a"></span><span class="ls0">rior <span class="_ _23"> </span>to <span class="_ _23"> </span>this,<span class="_ _47"> </span><span class="ff1b">whence<span class="_ _45"> </span></span>was <span class="_ _23"> </span>speciﬁed <span class="_ _23"> </span>as <span class="_ _23"> </span>0 <span class="_ _23"> </span>(absolute), <span class="_ _23"> </span>1 <span class="_ _23"> </span>(relative <span class="_ _9"></span>to <span class="_ _23"> </span>the <span class="_ _23"> </span>current</span></span></div><div class="t m0 x76 h2d yaae ff19 fs10 fc0 sc0 ls0 ws0">offset), <span class="_ _9"></span>or <span class="_ _23"> </span>2 <span class="_ _9"></span>(relative <span class="_ _9"> </span>to <span class="_ _23"> </span>the <span class="_ _23"> </span>end <span class="_ _9"></span>of <span class="_ _23"> </span>ﬁle).<span class="_ _46"> </span>Much <span class="_ _9"> </span>softwar<span class="ls382">es<span class="_ _8"></span><span class="ls0">till <span class="_ _23"> </span>exists <span class="_ _9"> </span>with <span class="_ _23"> </span>these <span class="_ _23"> </span>numbers <span class="_ _9"></span>hard</span></span></div><div class="t m0 x76 h2d yaaf ff19 fs10 fc0 sc0 ls0 ws0">coded.</div><div class="t m0 x76 h5e yab0 ff19 fs10 fc0 sc0 ls0 ws0">The <span class="_ _42"> </span>character<span class="_ _35"> </span><span class="ff1a">l<span class="_ _35"> </span></span>in <span class="_"> </span>the <span class="_ _42"> </span>name<span class="_ _35"> </span><span class="ff1a">lseek<span class="_ _35"> </span></span>means <span class="_ _42"> </span>‘‘long <span class="_ _42"> </span>integer<span class="_ _1"></span>.’<span class="_ _0"></span><span class="ls383">’B<span class="_ _62"></span><span class="ls0">efor<span class="ls384">et<span class="_ _43"></span><span class="ls0">he <span class="_"> </span>intr<span class="_ _0"></span>oduction <span class="_ _42"> </span>of <span class="_"> </span>the</span></span></span></span></div><div class="t m0 x76 h5e yab1 ff1a fs10 fc0 sc0 ls0 ws0">off_t<span class="_ _45"> </span><span class="ff19">data <span class="_ _23"> </span>type, <span class="_ _23"> </span>the<span class="_ _45"> </span><span class="ff1b">offset<span class="_ _45"> </span></span>argument <span class="_ _23"> </span>and <span class="_ _23"> </span>the <span class="_ _42"> </span>return <span class="_ _23"> </span>value <span class="_ _23"> </span>wer<span class="ls385">el<span class="_ _b"></span><span class="ls0">ong <span class="_ _23"> </span>integers.<span class="_ _61"> </span><span class="ff1a">lseek<span class="_ _45"> </span></span>was</span></span></span></div><div class="t m0 x76 h2d yab2 ff19 fs10 fc0 sc0 ls0 ws0">introduced <span class="_ _23"> </span>with <span class="_ _23"> </span>V<span class="_ _6"></span>ersion <span class="_ _23"> </span>7 <span class="_ _23"> </span>when <span class="_ _23"> </span>long <span class="_ _23"> </span>integers <span class="_ _23"> </span>wer<span class="ls386">ea<span class="_ _8"></span><span class="ls0">dded <span class="_ _23"> </span>to <span class="_ _23"> </span>C.<span class="_ _61"> </span>(Similar <span class="_ _23"> </span>functionality <span class="_ _23"> </span>was</span></span></div><div class="t m0 x76 h5e yab3 ff19 fs10 fc0 sc0 ls0 ws0">provided in V<span class="_ _4"></span>ersion 6 by the functions<span class="_"> </span><span class="ff1a">seek<span class="_ _e"> </span></span>and<span class="_"> </span><span class="ff1a">tell</span>.)</div><div class="t m0 x35 h4c yab4 ff16 fs26 fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h49 yab5 ff19 fs26 fc0 sc0 ls0 ws0">The program in Figur<span class="_ _0"></span><span class="ls387">e3<span class="_ _d"></span><span class="ls0">.1 tests its standar<span class="ls388">di<span class="_ _4f"></span><span class="ls0">nput to see whether it is capable of seeking.</span></span></span></span></div><div class="t m0 x32 h5d yab6 ff1a fs2f fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h5d yab7 ff1a fs2f fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h5d yab8 ff1a fs2f fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 x32 h5d yab9 ff1a fs2f fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h5d yaba ff1a fs2f fc0 sc0 ls0 ws0">if (lseek(STDIN_FILENO, 0, SEEK_CUR) == -1)</div><div class="t m0 x9d h5d yabb ff1a fs2f fc0 sc0 ls0 ws0">printf(&quot;cannot seek\n&quot;);</div><div class="t m0 x8a h5d yabc ff1a fs2f fc0 sc0 ls0 ws0">else</div><div class="t m0 x9d h5d yabd ff1a fs2f fc0 sc0 ls0 ws0">printf(&quot;seek OK\n&quot;);</div><div class="t m0 x8a h5d yabe ff1a fs2f fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h5d yabf ff1a fs2f fc0 sc0 ls0 ws0">}</div><div class="t m0 x126 h2f yac0 ff18 fs12 fc0 sc0 ls0 ws0">Figure 3.1<span class="_ _5a"> </span><span class="ff19 ls389">Te<span class="_ _9"></span><span class="ls0">st whether standar<span class="ls38a">di<span class="_ _5"></span><span class="ls0">nput is capable of seeking</span></span></span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
