<div id="pf10a" class="pf w4 h1f" data-page-no="10a"><div class="pc pc10a w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg10a.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">232<span class="_ _1b"> </span><span class="ff19">Process <span class="_"> </span>Contr<span class="_ _0"></span>ol <span class="_ _222"> </span>Chapter<span class="_ _4b"> </span>8</span></div><div class="t m0 x1c1 h51 y1ed4 ff19 fs2a fc0 sc0 ls0 ws0">parent pr<span class="_ _0"></span>ocess table entry</div><div class="t m0 x139 hee y1ed5 ff19 fs82 fc0 sc0 ls945 ws0">...</div><div class="t m0 x3f h9f y1ed6 ff19 fs39 fc0 sc0 ls0 ws0">fd 0:</div><div class="t m0 x3f h9f y1ed7 ff19 fs39 fc0 sc0 ls0 ws0">fd 1:</div><div class="t m0 x3f h9f y1ed8 ff19 fs39 fc0 sc0 ls0 ws0">fd 2:</div><div class="t m0 x167 h81 y1ed9 ff19 fs3f fc0 sc0 ls0 ws0">fd</div><div class="t m0 x135 h81 y1eda ff19 fs3f fc0 sc0 ls0 ws0">ﬂags</div><div class="t m0 x137 h81 y1ed9 ff19 fs3f fc0 sc0 ls0 ws0">ﬁle</div><div class="t m0 x16e h81 y1eda ff19 fs3f fc0 sc0 ls0 ws0">pointer</div><div class="t m0 x1f4 h2f y1edb ff19 fs12 fc0 sc0 ls0 ws0">child process table entry</div><div class="t m0 x139 hef y1edc ff19 fs83 fc0 sc0 ls946 ws0">...</div><div class="t m0 x3f ha0 y1edd ff19 fs4c fc0 sc0 ls0 ws0">fd 0:</div><div class="t m0 x3f ha0 y1ede ff19 fs4c fc0 sc0 ls0 ws0">fd 1:</div><div class="t m0 x3f ha0 y1edf ff19 fs4c fc0 sc0 ls0 ws0">fd 2:</div><div class="t m0 x167 h8b y1ee0 ff19 fs46 fc0 sc0 ls0 ws0">fd</div><div class="t m0 x135 h8b y1ee1 ff19 fs46 fc0 sc0 ls0 ws0">ﬂags</div><div class="t m0 x137 h8b y1ee0 ff19 fs46 fc0 sc0 ls0 ws0">ﬁle</div><div class="t m0 x16e h8b y1ee1 ff19 fs46 fc0 sc0 ls0 ws0">pointer</div><div class="t m0 x87 h32 y1ee2 ff19 fs15 fc0 sc0 ls0 ws0">ﬁle status ﬂags</div><div class="t m0 x10f h33 y1ee3 ff19 fs16 fc0 sc0 ls0 ws0">current ﬁle of<span class="_ _0"></span>fset</div><div class="t m0 x87 h83 y1ee4 ff19 fs36 fc0 sc0 ls0 ws0">v-node pointer</div><div class="t m0 x87 h34 y1ee5 ff19 fs17 fc0 sc0 ls0 ws0">ﬁle status ﬂags</div><div class="t m0 x17 h35 y1ee6 ff19 fs18 fc0 sc0 ls0 ws0">current ﬁle of<span class="_ _0"></span>fset</div><div class="t m0 x87 h36 y1ee7 ff19 fs19 fc0 sc0 ls0 ws0">v-node pointer</div><div class="t m0 x87 h37 y1ee8 ff19 fs1a fc0 sc0 ls0 ws0">ﬁle status ﬂags</div><div class="t m0 x17 h38 y1ee9 ff19 fs1b fc0 sc0 ls0 ws0">current ﬁle of<span class="_ _0"></span>fset</div><div class="t m0 x1f5 h39 y1eea ff19 fs1c fc0 sc0 ls0 ws0">v-node pointer</div><div class="t m0 x88 h39 y1eeb ff19 fs1c fc0 sc0 ls0 ws0">ﬁle table</div><div class="t m0 x168 hf0 y1eec ff19 fs84 fc0 sc0 ls0 ws0">v-node information</div><div class="t m0 x11f hf1 y1eed ff1a fs84 fc0 sc0 ls0 ws0">v_data</div><div class="t m0 x13b hf0 y1eee ff19 fs84 fc0 sc0 ls0 ws0">i-node information</div><div class="t m0 xd4 hf0 y1eef ff19 fs84 fc0 sc0 ls0 ws0">current ﬁle size</div><div class="t m0 x169 hf1 y1ef0 ff1a fs84 fc0 sc0 ls0 ws0">i_vnode</div><div class="t m0 x168 hb7 y1ef1 ff19 fs61 fc0 sc0 ls0 ws0">v-node information</div><div class="t m0 xef hf2 y1ef2 ff1a fs61 fc0 sc0 ls0 ws0">v_data</div><div class="t m0 x13b hb7 y1ef3 ff19 fs61 fc0 sc0 ls0 ws0">i-node information</div><div class="t m0 xd4 hb7 y1ef4 ff19 fs61 fc0 sc0 ls0 ws0">current ﬁle size</div><div class="t m0 x169 hf2 y1ef5 ff1a fs61 fc0 sc0 ls0 ws0">i_vnode</div><div class="t m0 x168 ha8 y1ef6 ff19 fs54 fc0 sc0 ls0 ws0">v-node information</div><div class="t m0 xef hf3 y1ef7 ff1a fs54 fc0 sc0 ls0 ws0">v_data</div><div class="t m0 x13b ha8 y1ef8 ff19 fs54 fc0 sc0 ls0 ws0">i-node information</div><div class="t m0 xd4 ha8 y1ef9 ff19 fs54 fc0 sc0 ls0 ws0">current ﬁle size</div><div class="t m0 x169 hf3 y1efa ff1a fs54 fc0 sc0 ls0 ws0">i_vnode</div><div class="t m0 xe3 hf4 y1efb ff19 fs85 fc0 sc0 ls0 ws0">v-node table</div><div class="t m0 xf6 hf5 y1efc ff18 fs86 fc0 sc0 ls0 ws0">Figure 8.2<span class="_ _5a"> </span><span class="ff19">Sharing of open ﬁles between parent and child after<span class="_"> </span><span class="ff1a">fork</span></span></div><div class="t m0 x3f hf6 y1efd ff19 fs87 fc0 sc0 ls0 ws0">If <span class="_ _35"> </span>both <span class="_ _45"> </span>parent <span class="_ _45"> </span>and <span class="_ _35"> </span>child <span class="_ _35"> </span>write <span class="_ _45"> </span>to <span class="_ _35"> </span>the <span class="_ _45"> </span>same <span class="_ _35"> </span>descriptor<span class="_ _1"></span><span class="ls947">,w<span class="_ _7"></span><span class="ls0">ithout <span class="_ _35"> </span>any <span class="_ _35"> </span>form <span class="_ _45"> </span>of</span></span></div><div class="t m0 x32 hf7 y1efe ff19 fs87 fc0 sc0 ls0 ws0">synchronization, <span class="_ _53"> </span>such <span class="_ _e"> </span>as <span class="_ _e"> </span>having <span class="_"> </span>the <span class="_ _53"> </span>parent<span class="_ _4b"> </span><span class="ff1a">wait<span class="_ _4b"> </span></span>for <span class="_ _e"> </span>the <span class="_ _e"> </span>child, <span class="_"> </span>their <span class="_ _53"> </span>output <span class="_ _e"> </span>will <span class="_ _e"> </span>be</div><div class="t m0 x32 hf7 y1eff ff19 fs87 fc0 sc0 ls0 ws0">intermixed (assuming <span class="_ _2"></span>it’s <span class="_ _2"></span>a <span class="_ _2"></span>descriptor <span class="_ _2"></span>that <span class="_ _2"></span>was open <span class="_ _2"></span>befor<span class="ls948">et<span class="_ _4f"></span><span class="ls0">he<span class="_ _66"> </span><span class="ff1a">fork</span>). <span class="_ _66"> </span>Although<span class="_ _47"> </span>this is</span></span></div><div class="t m0 x32 hf6 y1f00 ff19 fs87 fc0 sc0 ls0 ws0">possible <span class="_ _a"></span>— <span class="_ _a"></span>we<span class="_"> </span>saw it in Figur<span class="ls949">e8<span class="_ _d"></span><span class="ls0">.2 <span class="_ _a"></span>— <span class="_ _4"></span>it’s<span class="_"> </span>not the normal mode of operation.</span></span></div><div class="t m0 x3f hf7 y1f01 ff19 fs87 fc0 sc0 ls0 ws0">Ther<span class="ls949">ea<span class="_ _4f"></span><span class="ls94a">re <span class="_ _3"></span>t<span class="ls0">wo normal cases for handling the descriptors after a<span class="_"> </span><span class="ff1a">fork</span>.</span></span></span></div><div class="t m0 x3f hf6 y1f02 ff19 fs87 fc0 sc0 ls0 ws0">1. <span class="_ _51"> </span>The<span class="_"> </span>parent waits for the child to complete.<span class="_ _46"> </span>In this case, the parent does not need</div><div class="t m0 x41 hf6 y1f03 ff19 fs87 fc0 sc0 ls0 ws0">to <span class="_"> </span>do <span class="_"> </span>anything <span class="_"> </span>with <span class="_"> </span>its <span class="_"> </span>descriptors.<span class="_ _48"> </span>When <span class="_"> </span>the <span class="_"> </span>child <span class="_"> </span>terminates, <span class="_"> </span>any <span class="_"> </span>of <span class="_"> </span>the</div><div class="t m0 x41 hf6 y1f04 ff19 fs87 fc0 sc0 ls0 ws0">shared descriptors that <span class="_ _2"></span>the child <span class="_ _2"></span>read from or wrote to will <span class="_ _2"></span>have <span class="_ _2"></span>their ﬁle <span class="_ _2"></span>offsets</div><div class="t m0 x41 hf6 y1f05 ff19 fs87 fc0 sc0 ls0 ws0">updated accordingly<span class="_ _4"></span>.</div><div class="t m0 x3f hf7 y1f06 ff19 fs87 fc0 sc0 ls0 ws0">2. <span class="_ _51"> </span>Both<span class="_ _4b"> </span>the <span class="_ _53"> </span>parent <span class="_ _42"> </span>and <span class="_ _e"> </span>the <span class="_ _53"> </span>child <span class="_ _53"> </span>go <span class="_ _53"> </span>their <span class="_ _e"> </span>own <span class="_ _53"> </span>ways.<span class="_ _65"> </span>Here, <span class="_ _42"> </span>after <span class="_ _e"> </span>the<span class="_ _44"> </span><span class="ff1a">fork</span><span class="ls94b">,t<span class="_ _c"></span><span class="ls0">he</span></span></div><div class="t m0 x41 hf6 y1f07 ff19 fs87 fc0 sc0 ls0 ws0">parent <span class="_ _9"></span>closes <span class="_ _23"> </span>the <span class="_ _23"></span>descriptors <span class="_ _23"></span>that <span class="_ _23"></span>it <span class="_ _9"></span>doesn’t <span class="_ _23"> </span>need, <span class="_ _23"> </span>and <span class="_ _23"> </span>the <span class="_ _23"></span>child <span class="_ _23"></span>does <span class="_ _23"></span>the <span class="_ _23"></span>same</div><div class="t m0 x41 hf6 y1f08 ff19 fs87 fc0 sc0 ls0 ws0">thing. <span class="_ _61"> </span>This<span class="_ _61"> </span>way<span class="_ _6"></span><span class="ls94c">,n<span class="_ _1d"></span><span class="ls0">either <span class="_ _47"> </span>interferes <span class="_ _66"> </span>with <span class="_ _47"> </span>the <span class="_ _47"> </span>other<span class="_ _3"></span>’s <span class="_ _47"> </span>open <span class="_ _47"> </span>descriptors.<span class="_ _50"> </span>This</span></span></div><div class="t m0 x41 hf6 y1f09 ff19 fs87 fc0 sc0 ls0 ws0">scenario is often found with network servers.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
