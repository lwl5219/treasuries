<div id="pfb7" class="pf w4 h1f" data-page-no="b7"><div class="pc pcb7 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bgb7.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>5.5<span class="_ _1d5"> </span>Opening <span class="_"> </span>a <span class="_"> </span>Stream<span class="_ _1b"> </span><span class="ff18">149</span></div><div class="t m0 x32 h2a y12f ff19 fsf fc0 sc0 ls0 ws0">text <span class="_ _42"> </span>ﬁle <span class="_ _42"> </span>and <span class="_ _42"> </span>a <span class="_ _42"> </span>binary <span class="_ _42"> </span>ﬁle.<span class="_ _54"> </span>Since <span class="_ _42"> </span>the <span class="_ _42"> </span>UNIX <span class="_ _42"> </span>kernel <span class="_ _42"> </span>doesn’t <span class="_ _42"> </span>differentiate <span class="_ _23"> </span>between <span class="_ _42"> </span>these</div><div class="t m0 x32 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">types of ﬁles, specifying the character<span class="_"> </span><span class="ff1a">b<span class="_ _80"> </span></span>as part of the<span class="_"> </span><span class="ff1b">type<span class="_"> </span></span>has no effect.</div><div class="t m0 x3f h26 y131 ff19 fsf fc0 sc0 ls65 ws0">Wi<span class="_ _3"></span><span class="ls0">th<span class="_ _66"> </span><span class="ff1a">fdopen</span><span class="ls676">,t<span class="_ _4f"></span><span class="ls0">he <span class="_ _3"></span>meanings <span class="_ _2"></span>of <span class="_ _2"></span>the<span class="_ _47"> </span><span class="ff1b">type<span class="_ _66"> </span></span>argument <span class="_ _2"></span>differ <span class="_ _2"></span>slightly<span class="_ _4"></span><span class="ls677">.T<span class="_ _5b"></span><span class="ls0">he <span class="_ _2"></span>descriptor <span class="_ _3"></span>has</span></span></span></span></span></div><div class="t m0 x32 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">already been opened, so opening for writing does not <span class="_ _2"></span>truncate the ﬁle.<span class="_ _46"> </span>(If the descriptor</div><div class="t m0 x32 h26 y133 ff19 fsf fc0 sc0 ls0 ws0">was <span class="_ _47"> </span>created <span class="_ _47"> </span>by <span class="_ _45"> </span>the<span class="_ _16"> </span><span class="ff1a">open<span class="_ _16"> </span></span>function, <span class="_ _45"> </span>for <span class="_ _47"> </span>example, <span class="_ _45"> </span>and <span class="_ _47"> </span>the <span class="_ _47"> </span>ﬁle <span class="_ _45"> </span>already <span class="_ _47"> </span>existed, <span class="_ _47"> </span>the</div><div class="t m0 x32 h26 y134 ff1a fsf fc0 sc0 ls0 ws0">O_TRUNC<span class="_ _59"> </span><span class="ff19">ﬂag <span class="_ _e"> </span>would <span class="_"> </span>contr<span class="_ _0"></span>ol <span class="_ _e"> </span>whether <span class="_"> </span>the <span class="_ _e"> </span>ﬁle <span class="_"> </span>was <span class="_ _53"> </span>truncated. <span class="_ _59"> </span>The<span class="_ _59"> </span><span class="ff1a">fdopen<span class="_ _59"> </span></span>function</span></div><div class="t m0 x32 h2a y135 ff19 fsf fc0 sc0 ls0 ws0">cannot <span class="_ _23"> </span>simply <span class="_ _42"> </span>truncate <span class="_ _23"></span>any <span class="_ _23"> </span>ﬁle <span class="_ _23"> </span>it <span class="_ _42"> </span>opens <span class="_ _23"> </span>for <span class="_ _42"> </span>writing.)<span class="_ _51"> </span>Also, <span class="_ _23"> </span>the <span class="_ _23"> </span>standar<span class="ls678">dI<span class="_ _43"></span><span class="ls0">/O <span class="_ _42"> </span>append</span></span></div><div class="t m0 x32 h2a y136 ff19 fsf fc0 sc0 ls0 ws0">mode cannot create the ﬁle (since the ﬁle has to exist if a descriptor r<span class="_ _0"></span>efers to it).</div><div class="t m0 x3f h2a y137 ff19 fsf fc0 sc0 ls0 ws0">When <span class="_ _3"></span>a <span class="_ _3"></span>ﬁle <span class="_ _3"></span>is <span class="_ _9"></span>opened <span class="_ _3"></span>with <span class="_ _3"></span>a <span class="_ _3"></span>type <span class="_ _9"></span>of <span class="_ _3"></span>append, <span class="_ _3"></span>each <span class="_ _3"></span>write <span class="_ _3"></span>will <span class="_ _9"></span>take <span class="_ _3"></span>place <span class="_ _3"></span>at <span class="_ _3"></span>the <span class="_ _9"></span>then</div><div class="t m0 x32 h2a y138 ff19 fsf fc0 sc0 ls0 ws0">current <span class="_ _53"> </span>end <span class="_ _e"> </span>of <span class="_ _e"> </span>ﬁle.<span class="_ _48"> </span>If <span class="_ _e"> </span>multiple <span class="_ _e"> </span>processes <span class="_ _53"> </span>open <span class="_ _e"> </span>the <span class="_"> </span>same <span class="_ _53"> </span>ﬁle <span class="_ _e"> </span>with <span class="_ _e"> </span>the <span class="_ _e"> </span>standar<span class="ls679">dI<span class="_ _55"></span><span class="ls0">/O</span></span></div><div class="t m0 x32 h2a y139 ff19 fsf fc0 sc0 ls0 ws0">append mode, the data from each pr<span class="_ _0"></span>ocess will be corr<span class="_ _0"></span>ectly written to the ﬁle.</div><div class="t m0 x76 h52 y15a ff19 fs2a fc0 sc0 ls67a ws0">Ve<span class="_"> </span><span class="ls0">rsions of<span class="_ _80"> </span><span class="ff1a">fopen<span class="_ _66"> </span></span>from <span class="_ _2"></span>Berkeley <span class="_ _2"></span>befor<span class="ls67b">e4<span class="_ _d"></span><span class="ls0">.4BSD <span class="_ _3"></span>and <span class="_ _2"></span>the <span class="_ _3"></span>simple <span class="_ _2"></span>version <span class="_ _3"></span>shown <span class="_ _3"></span>on <span class="_ _2"></span>page <span class="_ _3"></span>177 <span class="_ _2"></span>of</span></span></span></div><div class="t m0 x76 h51 y1053 ff19 fs2a fc0 sc0 ls0 ws0">Kernighan <span class="_ _2"></span>and <span class="_ _2"></span>Ritchie</div><div class="t m0 x131 h51 y150c ff19 fs2a fc0 sc0 ls0 ws0">[</div><div class="t m0 xac h51 y1053 ff19 fs2a fc0 sc0 ls0 ws0">1988</div><div class="t m0 x85 h51 y150c ff19 fs2a fc0 sc0 ls0 ws0">]</div><div class="t m0 x16 h51 y1053 ff19 fs2a fc0 sc0 ls0 ws0">do <span class="_ _2"></span>not <span class="_ _2"></span>handle <span class="_ _3"></span>the <span class="_ _2"></span>append <span class="_ _3"></span>mode <span class="_ _2"></span>correctly<span class="_ _6"></span><span class="ls67c">.T<span class="_ _c"></span><span class="ls0">hese <span class="_ _2"></span>versions <span class="_ _2"></span>do <span class="_ _3"></span>an</span></span></div><div class="t m0 x76 h52 y1054 ff1a fs2a fc0 sc0 ls0 ws0">lseek<span class="_ _66"> </span><span class="ff19">to <span class="_ _23"> </span>the <span class="_ _3"></span>end <span class="_ _23"> </span>of <span class="_ _9"></span>ﬁle <span class="_ _9"></span>when <span class="_ _9"></span>the <span class="_ _9"></span>stream <span class="_ _9"></span>is <span class="_ _9"></span>opened.<span class="_ _59"> </span><span class="lsed">To <span class="_ _80"> </span>c<span class="_ _9"></span></span>orrectly <span class="_ _3"></span>support <span class="_ _9"> </span>the <span class="_ _23"> </span>append <span class="_ _3"></span>mode</span></div><div class="t m0 x76 h52 y1055 ff19 fs2a fc0 sc0 ls0 ws0">when multiple <span class="_ _2"></span>processes ar<span class="ls67d">ei<span class="_ _5"></span><span class="ls0">nvolved, <span class="_ _2"></span>the ﬁle <span class="_ _2"></span>must <span class="_ _2"></span>be opened <span class="_ _2"></span>with <span class="_ _2"></span>the<span class="_ _e"> </span><span class="ff1a">O_APPEND<span class="_ _80"> </span></span>ﬂag, <span class="_ _2"></span>which</span></span></div><div class="t m0 x76 h52 y1056 ff19 fs2a fc0 sc0 ls0 ws0">we <span class="_ _42"> </span>discussed <span class="_ _42"> </span>in <span class="_ _42"> </span>Section <span class="_"> </span>3.3.<span class="_ _61"> </span>Doing <span class="_ _42"> </span>an<span class="_ _35"> </span><span class="ff1a">lseek<span class="_ _45"> </span></span>befor<span class="ls67e">ee<span class="_ _b"></span><span class="ls0">ach <span class="_ _42"> </span>write <span class="_ _42"> </span>won’t <span class="_ _42"> </span>work <span class="_ _42"> </span>either<span class="_ _1"></span>,<span class="_ _35"> </span>as<span class="_ _45"> </span>we</span></span></div><div class="t m0 x76 h51 y1057 ff19 fs2a fc0 sc0 ls0 ws0">discussed in Section 3.1<span class="_ _1"></span>1.</div><div class="t m0 x3f h2b ya6b ff19 fsf fc0 sc0 ls0 ws0">When <span class="_"> </span>a <span class="_ _e"> </span>ﬁle <span class="_"> </span>is <span class="_"> </span>opened <span class="_ _e"> </span>for <span class="_"> </span>reading <span class="_ _e"> </span>and <span class="_"> </span>writing <span class="_"> </span>(the <span class="_ _e"> </span>plus <span class="_"> </span>sign <span class="_ _e"> </span>in <span class="_"> </span>the<span class="_ _59"> </span><span class="ff1b">type</span>), <span class="_"> </span>two</div><div class="t m0 x32 h2a y150d ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">strictions apply<span class="_ _6"></span>.</span></div><div class="t m0 x3f h26 y162 ff19 fsf fc0 sc0 ls49 ws0">•O<span class="_ _4d"></span><span class="ls0">utput <span class="_ _42"> </span>cannot <span class="_ _42"> </span>be <span class="_ _42"> </span>directly <span class="_ _42"> </span>followed <span class="_ _42"> </span>by <span class="_ _42"> </span>input <span class="_ _42"> </span>without <span class="_ _42"> </span>an <span class="_ _42"> </span>intervening<span class="_ _44"> </span><span class="ff1a">fflush</span>,</span></div><div class="t m0 x15 h26 y1db ff1a fsf fc0 sc0 ls0 ws0">fseek<span class="ff19">,<span class="_"> </span></span>fsetpos<span class="ff19 ls44">,o<span class="_ _d"></span><span class="ls0">r<span class="_"> </span><span class="ff1a">rewind</span>.</span></span></div><div class="t m0 x3f h26 y150e ff19 fsf fc0 sc0 ls49 ws0">•I<span class="_ _4d"></span><span class="ls0">nput <span class="_"> </span>cannot <span class="_ _e"> </span>be <span class="_"> </span>directly <span class="_ _e"> </span>followed <span class="_"> </span>by <span class="_"> </span>output <span class="_ _e"> </span>without <span class="_"> </span>an <span class="_"> </span>intervening<span class="_ _59"> </span><span class="ff1a">fseek</span>,</span></div><div class="t m0 x15 h26 y150f ff1a fsf fc0 sc0 ls0 ws0">fsetpos<span class="ff19 ls44">,o<span class="_ _d"></span><span class="ls0">r<span class="_"> </span><span class="ff1a">rewind</span>,<span class="_"> </span>or<span class="_"> </span>an<span class="_"> </span>input operation that encounters an end of ﬁle.</span></span></div><div class="t m0 x3f h2a y330 ff19 fsf fc0 sc0 ls5f ws0">We <span class="_ _53"> </span>c<span class="_ _9"></span><span class="ls0">an summarize the six ways to open a stream from Figur<span class="_ _1"></span><span class="ls44">e5<span class="_ _5"></span><span class="ls0">.2 in Figur<span class="ls44">e5<span class="_ _4f"></span><span class="ls0">.3.</span></span></span></span></span></div><div class="t m0 xbe h5e y1510 ff19 fs10 fc0 sc0 ls0 ws0">Restriction<span class="_ _ae"> </span><span class="ff1a ls67f">rwa<span class="_ _d"></span><span class="ls0">r+ <span class="_ _48"> </span>w+ <span class="_ _60"> </span>a+</span></span></div><div class="t m0 x54 h2e y1511 ff19 fs11 fc0 sc0 ls0 ws0">ﬁle must already exist<span class="_ _b8"> </span><span class="ls680">••</span></div><div class="t m0 x54 h2e y1512 ff19 fs11 fc0 sc0 ls0 ws0">previous contents of ﬁle discar<span class="_ _0"></span>ded <span class="_ _dd"> </span>•<span class="_ _a4"> </span>•</div><div class="t m0 x54 h2f y1513 ff19 fs12 fc0 sc0 ls0 ws0">stream can be r<span class="_ _0"></span>ead <span class="_ _1d6"> </span>•<span class="_ _a4"> </span><span class="ls681">•••</span></div><div class="t m0 x54 h2f y1514 ff19 fs12 fc0 sc0 ls0 ws0">stream can be written<span class="_ _138"> </span><span class="ls681">•••••</span></div><div class="t m0 x54 h2f y1515 ff19 fs12 fc0 sc0 ls0 ws0">stream can be written only at end<span class="_ _1d7"> </span><span class="ls682">••</span></div><div class="t m0 x3c h30 y1516 ff18 fs13 fc0 sc0 ls0 ws0">Figure 5.3<span class="_ _5a"> </span><span class="ff19">Six ways to open a standar<span class="ls673">dI<span class="_ _84"></span><span class="ls0">/O stream</span></span></span></div><div class="t m0 x32 h64 y1517 ff19 fs31 fc0 sc0 ls0 ws0">Note <span class="_ _2"></span>that <span class="_ _3"></span>if <span class="_ _3"></span>a <span class="_ _3"></span>new <span class="_ _2"></span>ﬁle <span class="_ _3"></span>is <span class="_ _3"></span>created <span class="_ _2"></span>by <span class="_ _3"></span>specifying <span class="_ _3"></span>a<span class="_ _47"> </span><span class="ff1b">type<span class="_ _47"> </span></span>of <span class="_ _2"></span>either<span class="_ _47"> </span><span class="ff1a">w<span class="_ _47"> </span></span>or<span class="_ _47"> </span><span class="ff1a">a</span>,<span class="_ _47"> </span>we<span class="_ _47"> </span>a<span class="ls225">re <span class="_ _9"></span>n</span>ot <span class="_ _3"></span>able <span class="_ _3"></span>to</div><div class="t m0 x32 h64 y1518 ff19 fs31 fc0 sc0 ls0 ws0">specify <span class="_ _9"></span>the <span class="_ _9"></span>ﬁle’s <span class="_ _23"></span>access <span class="_ _9"></span>permission <span class="_ _9"></span>bits, <span class="_ _9"></span>as <span class="_ _23"></span>we <span class="_ _9"></span>wer<span class="ls683">ea<span class="_ _b"></span><span class="ls0">ble <span class="_ _3"></span>to <span class="_ _23"></span>do <span class="_ _9"></span>with <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">open<span class="_ _45"> </span></span>function</span></span></div><div class="t m0 x32 h64 y1519 ff19 fs31 fc0 sc0 ls0 ws0">and <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">creat<span class="_ _45"> </span></span>function <span class="_ _23"></span>in <span class="_ _9"></span>Chapter <span class="_ _9"></span>3.<span class="_ _51"> </span>POSIX.1 <span class="_ _9"></span>requir<span class="_ _0"></span>es <span class="_ _9"></span>implementations <span class="_ _9"></span>to <span class="_ _23"></span>cr<span class="_ _0"></span>eate <span class="_ _9"></span>the</div><div class="t m0 x32 h6e y151a ff19 fs31 fc0 sc0 ls0 ws0">ﬁle with the following permissions bit set:</div><div class="t m0 x3f h65 y151b ff1a fs32 fc0 sc0 ls0 ws0">S_IRUSR | S_IWUSR | S_IRGRP | S_IWGRP | S_IROTH | S_IWOTH</div><div class="t m0 x32 h6e y151c ff19 fs31 fc0 sc0 ls0 ws0">Recall from Section 4.8, <span class="_ _2"></span>however<span class="_ _6"></span><span class="ls684">,t<span class="_ _d"></span><span class="ls0">hat <span class="_ _2"></span>we can restrict these <span class="_ _2"></span>permissions by adjusting <span class="_ _2"></span>our</span></span></div><div class="t m0 x32 h64 y151d ff1a fs31 fc0 sc0 ls0 ws0">umask<span class="_ _80"> </span><span class="ff19">value.</span></div><div class="t m0 x3f h6e y151e ff19 fs31 fc0 sc0 ls0 ws0">By <span class="_ _3"></span>default, <span class="_ _3"></span>the <span class="_ _9"></span>stream <span class="_ _2"></span>that <span class="_ _9"></span>is <span class="_ _3"></span>opened <span class="_ _3"></span>is <span class="_ _9"></span>fully <span class="_ _3"></span>buffered, <span class="_ _2"></span>unless <span class="_ _3"></span>it <span class="_ _9"></span>refers <span class="_ _2"></span>to <span class="_ _9"></span>a <span class="_ _3"></span>terminal</div><div class="t m0 x32 h6e y151f ff19 fs31 fc0 sc0 ls0 ws0">device, <span class="_ _9"></span>in <span class="_ _23"></span>which <span class="_ _9"></span>case <span class="_ _9"></span>it <span class="_ _23"></span>is <span class="_ _9"></span>line <span class="_ _9"></span>buffered. <span class="_ _45"> </span>Once<span class="_ _45"> </span>the <span class="_ _9"></span>stream <span class="_ _9"></span>is <span class="_ _9"></span>opened, <span class="_ _23"></span>but <span class="_ _9"></span>before<span class="_ _45"> </span>we<span class="_ _45"> </span>do</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
