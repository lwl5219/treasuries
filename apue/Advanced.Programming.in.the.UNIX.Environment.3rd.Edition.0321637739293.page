<div id="pf125" class="pf w4 h1f" data-page-no="125"><div class="pc pc125 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg125.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>8.1<span class="_ _1"></span><span class="lsa07">1C<span class="_ _234"></span><span class="ls0">hanging <span class="_"> </span>User <span class="_"> </span>IDs <span class="_"> </span>and <span class="_"> </span>Group <span class="_"> </span>IDs<span class="_ _1fb"> </span><span class="ff18">259</span></span></span></div><div class="t m0 x35 h27 y12f ff16 fsf fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls5f ws0">To <span class="_ _44"> </span>s<span class="_ _9"></span><span class="ls0">ee <span class="_"> </span>the <span class="_"> </span>utility <span class="_"> </span>of <span class="_ _e"> </span>the <span class="_"> </span>saved <span class="_"> </span>set-user<span class="_ _0"></span>-ID <span class="_"> </span>featur<span class="_ _0"></span>e, <span class="_"> </span>let’s <span class="_ _e"> </span>examine <span class="_"> </span>the <span class="_"> </span>operation <span class="_"> </span>of <span class="_ _e"> </span>a</span></div><div class="t m0 x32 h26 y132 ff19 fsf fc0 sc0 ls0 ws0">program <span class="_ _9"></span>that <span class="_ _42"> </span>uses <span class="_ _23"></span>it.<span class="_ _51"> </span><span class="ls5f">We<span class="_ _9"></span></span>’ll <span class="_ _23"> </span>look <span class="_ _23"> </span>at <span class="_ _23"> </span>the<span class="_ _35"> </span><span class="ff1a">at</span></div><div class="t m0 x114 h2a y1ab0 ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 x115 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">1</div><div class="t m0 x1ed h2a y1ab0 ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 x1de h2a y132 ff19 fsf fc0 sc0 ls0 ws0">program, <span class="_ _9"></span>which <span class="_ _42"> </span>we <span class="_ _23"></span>can <span class="_ _23"></span>use <span class="_ _23"> </span>to <span class="_ _23"> </span>schedule</div><div class="t m0 x32 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">commands to be run at some time in the futur<span class="_ _0"></span>e.</div><div class="t m0 x76 h52 y221d ff19 fs2a fc0 sc0 ls0 ws0">On <span class="_ _2"></span>Linux <span class="_ _3"></span>3.2.0, <span class="_ _2"></span>the<span class="_ _80"> </span><span class="ff1a">at<span class="_ _80"> </span></span>program <span class="_ _2"></span>is <span class="_ _3"></span>installed <span class="_ _2"></span>set-user-ID <span class="_ _2"></span>to <span class="_ _3"></span>user<span class="_ _80"> </span><span class="ff1a">daemon</span><span class="lsa23">.O<span class="_ _c"></span><span class="lsa24">nF<span class="_ _5"></span><span class="ls34e">re<span class="ls0">eBSD <span class="_ _3"></span>8.0, <span class="_ _2"></span>Mac</span></span></span></span></div><div class="t m0 x76 h52 y221e ff19 fs2a fc0 sc0 ls0 ws0">OS <span class="_ _3"></span>X <span class="_ _2"></span>10.6.8, <span class="_ _3"></span>and <span class="_ _3"></span>Solaris <span class="_ _3"></span>10, <span class="_ _3"></span>the<span class="_ _66"> </span><span class="ff1a">at<span class="_ _66"> </span></span>program <span class="_ _2"></span>is <span class="_ _3"></span>installed <span class="_ _3"></span>set-user-ID <span class="_ _2"></span>to <span class="_ _3"></span>user<span class="_ _66"> </span><span class="ff1a">root</span><span class="lsa25">.T<span class="_ _55"></span><span class="ls0">his <span class="_ _3"></span>allows</span></span></div><div class="t m0 x76 h52 y221f ff19 fs2a fc0 sc0 ls0 ws0">the<span class="_ _66"> </span><span class="ff1a">at<span class="_ _66"> </span></span>command <span class="_ _3"></span>to <span class="_ _9"></span>write <span class="_ _3"></span>privileged <span class="_ _3"></span>ﬁles <span class="_ _9"></span>owned <span class="_ _3"></span>by <span class="_ _9"></span>the <span class="_ _3"></span>daemon <span class="_ _3"></span>that <span class="_ _9"></span>will <span class="_ _3"></span>run <span class="_ _3"></span>the <span class="_ _9"></span>commands</div><div class="t m0 x76 h52 y2220 ff19 fs2a fc0 sc0 ls0 ws0">on <span class="_ _3"></span>behalf <span class="_ _3"></span>of <span class="_ _3"></span>the <span class="_ _9"></span>user <span class="_ _3"></span>running <span class="_ _3"></span>the<span class="_ _66"> </span><span class="ff1a">at<span class="_ _66"> </span></span>command. <span class="_ _80"> </span>On<span class="_ _66"> </span>Linux <span class="_ _9"></span>3.2.0, <span class="_ _3"></span>the <span class="_ _3"></span>programs <span class="_ _3"></span>ar<span class="ls370">er<span class="_ _4f"></span><span class="ls0">un <span class="_ _3"></span>by <span class="_ _3"></span>the</span></span></div><div class="t m0 x76 h52 y2221 ff1a fs2a fc0 sc0 ls0 ws0">atd</div><div class="t m0 x137 h51 y2222 ff19 fs2a fc0 sc0 ls0 ws0">(</div><div class="t m0 x6 h51 y2221 ff19 fs2a fc0 sc0 ls0 ws0">8</div><div class="t m0 xdf h51 y2222 ff19 fs2a fc0 sc0 ls0 ws0">)</div><div class="t m0 x144 h52 y2221 ff19 fs2a fc0 sc0 ls0 ws0">daemon. <span class="_ _35"> </span>On<span class="_ _44"> </span>FreeBSD <span class="_"> </span>8.0 <span class="_"> </span>and <span class="_"> </span>Solaris <span class="_"> </span>10, <span class="_"> </span>the <span class="_"> </span>pr<span class="_ _0"></span>ograms <span class="_"> </span>ar<span class="lsa26">er<span class="_ _c"></span><span class="ls0">un <span class="_"> </span>by <span class="_"> </span>the<span class="_ _44"> </span><span class="ff1a">cron</span></span></span></div><div class="t m0 x61 h51 y2222 ff19 fs2a fc0 sc0 ls0 ws0">(</div><div class="t m0 x55 h51 y2221 ff19 fs2a fc0 sc0 ls0 ws0">1M</div><div class="t m0 x163 h51 y2222 ff19 fs2a fc0 sc0 ls0 ws0">)</div><div class="t m0 x76 h52 y2223 ff19 fs2a fc0 sc0 ls0 ws0">daemon. <span class="_"> </span>On<span class="_"> </span>Mac OS X 10.6.8, the programs ar<span class="_ _0"></span><span class="lse9">er<span class="_ _5"></span><span class="ls0">un by the<span class="_"> </span><span class="ff1a">launchd</span></span></span></div><div class="t m0 x119 h51 y2224 ff19 fs2a fc0 sc0 ls0 ws0">(</div><div class="t m0 x1fc h51 y2223 ff19 fs2a fc0 sc0 ls0 ws0">8</div><div class="t m0 x1fd h51 y2224 ff19 fs2a fc0 sc0 ls0 ws0">)</div><div class="t m0 x151 h51 y2223 ff19 fs2a fc0 sc0 ls0 ws0">daemon.</div><div class="t m0 x3f h2a y2225 ff19 fsf fc0 sc0 ls5f ws0">To <span class="_ _80"> </span>p<span class="_ _23"></span><span class="ls45">re<span class="ls0">vent <span class="_ _9"></span>being <span class="_ _3"></span>tricked <span class="_ _9"></span>into <span class="_ _9"></span>running <span class="_ _3"></span>commands <span class="_ _9"></span>that <span class="_ _3"></span>we <span class="_ _9"></span>aren’t <span class="_ _3"></span>allowed <span class="_ _3"></span>to <span class="_ _9"></span>run, <span class="_ _3"></span>or</span></span></div><div class="t m0 x32 h26 y2226 ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">ading <span class="_"> </span>or <span class="_ _53"> </span>writing <span class="_"> </span>ﬁles <span class="_ _53"> </span>that <span class="_"> </span>we <span class="_ _53"> </span>aren’t <span class="_ _e"> </span>allowed <span class="_ _e"> </span>to <span class="_ _e"> </span>access, <span class="_"> </span>the<span class="_ _4b"> </span><span class="ff1a">at<span class="_ _4b"> </span></span>command <span class="_"> </span>and <span class="_ _53"> </span>the</span></div><div class="t m0 x32 h2a y2227 ff19 fsf fc0 sc0 ls0 ws0">daemon <span class="_ _3"></span>that <span class="_ _9"></span>ultimately <span class="_ _3"></span>runs <span class="_ _9"></span>the <span class="_ _3"></span>commands <span class="_ _9"></span>on <span class="_ _9"></span>our <span class="_ _3"></span>behalf <span class="_ _9"></span>have <span class="_ _3"></span>to <span class="_ _9"></span>switch <span class="_ _9"></span>between <span class="_ _3"></span>sets</div><div class="t m0 x32 h2a y2228 ff19 fsf fc0 sc0 ls0 ws0">of privileges: ours and those of the daemon.<span class="_ _59"> </span>The following steps take place.</div><div class="t m0 x3f h26 y2229 ff19 fsf fc0 sc0 ls0 ws0">1. <span class="_ _51"> </span>Assuming<span class="_ _66"> </span>that <span class="_ _2"></span>the<span class="_ _47"> </span><span class="ff1a">at<span class="_ _66"> </span></span>program ﬁle <span class="_ _3"></span>is <span class="_ _2"></span>owned <span class="_ _2"></span>by<span class="_ _66"> </span><span class="ff1a">root<span class="_ _47"> </span></span>and has <span class="_ _3"></span>its <span class="_ _2"></span>set-user-ID bit</div><div class="t m0 x41 h2a y222a ff19 fsf fc0 sc0 ls0 ws0">set, when we run it, we have</div><div class="t m0 x14e h2a y222b ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">al user ID =<span class="_ _46"> </span>our user ID (unchanged)</span></div><div class="t m0 xdf h26 y222c ff19 fsf fc0 sc0 ls0 ws0">effective user ID =<span class="_ _59"> </span><span class="ff1a">root</span></div><div class="t m0 xb1 h26 y222d ff19 fsf fc0 sc0 ls0 ws0">saved set-user-ID =<span class="_ _59"> </span><span class="ff1a">root</span></div><div class="t m0 x3f h26 y222e ff19 fsf fc0 sc0 ls0 ws0">2. <span class="_ _51"> </span>The<span class="_ _66"> </span>ﬁrst <span class="_ _3"></span>thing <span class="_ _2"></span>the<span class="_ _47"> </span><span class="ff1a">at<span class="_ _66"> </span></span>command <span class="_ _2"></span>does <span class="_ _2"></span>is <span class="_ _3"></span>reduce its <span class="_ _3"></span>privileges <span class="_ _2"></span>so <span class="_ _2"></span>that <span class="_ _2"></span>it <span class="_ _3"></span>runs <span class="_ _2"></span>with</div><div class="t m0 x41 h26 y222f ff19 fsf fc0 sc0 ls0 ws0">our <span class="_ _9"></span>privileges.<span class="_ _16"> </span>It <span class="_ _9"></span>calls <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">seteuid<span class="_ _45"> </span></span>function <span class="_ _3"></span>to <span class="_ _9"></span>set <span class="_ _9"></span>the <span class="_ _9"></span>effective <span class="_ _3"></span>user <span class="_ _9"></span>ID <span class="_ _9"></span>to <span class="_ _9"></span>our</div><div class="t m0 x41 h2a y2230 ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">al user ID.<span class="_ _46"> </span>After this, we have</span></div><div class="t m0 x14e h2a y2231 ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">al user ID =<span class="_ _46"> </span>our user ID (unchanged)</span></div><div class="t m0 xdf h2a y2232 ff19 fsf fc0 sc0 ls0 ws0">effective user ID =<span class="_ _59"> </span>our user ID</div><div class="t m0 xb1 h26 y2233 ff19 fsf fc0 sc0 ls0 ws0">saved set-user-ID =<span class="_ _59"> </span><span class="ff1a">root<span class="_ _80"> </span></span>(unchanged)</div><div class="t m0 x3f h26 y2234 ff19 fsf fc0 sc0 ls0 ws0">3. <span class="_ _51"> </span>The<span class="_ _48"> </span><span class="ff1a">at<span class="_ _48"> </span></span>program <span class="_ _4b"> </span>runs <span class="_ _59"> </span>with <span class="_ _59"> </span>our <span class="_ _4b"> </span>privileges <span class="_ _59"> </span>until <span class="_ _59"> </span>it <span class="_ _4b"> </span>needs <span class="_ _59"> </span>to <span class="_ _59"> </span>access <span class="_ _59"> </span>the</div><div class="t m0 x41 h2a y2235 ff19 fsf fc0 sc0 ls0 ws0">conﬁguration <span class="_ _9"></span>ﬁles <span class="_ _23"> </span>that <span class="_ _23"></span>control <span class="_ _9"></span>which <span class="_ _9"></span>commands <span class="_ _23"> </span>are<span class="_ _45"> </span>to<span class="_ _45"> </span>be<span class="_ _35"> </span>run <span class="_ _9"></span>and <span class="_ _23"></span>the <span class="_ _9"></span>time <span class="_ _23"></span>at</div><div class="t m0 x41 h2a y2236 ff19 fsf fc0 sc0 ls0 ws0">which <span class="_ _2"></span>they <span class="_ _3"></span>need <span class="_ _3"></span>to <span class="_ _3"></span>run. <span class="_ _47"> </span>These<span class="_ _47"> </span>ﬁles <span class="_ _3"></span>ar<span class="lsa27">eo<span class="_ _8"></span><span class="ls0">wned <span class="_ _3"></span>by <span class="_ _3"></span>the <span class="_ _3"></span>daemon <span class="_ _3"></span>that <span class="_ _2"></span>will <span class="_ _3"></span>run <span class="_ _3"></span>the</span></span></div><div class="t m0 x41 h26 y2237 ff19 fsf fc0 sc0 ls0 ws0">commands <span class="_ _3"></span>for <span class="_ _9"></span>us.<span class="_ _5a"> </span>The<span class="_ _47"> </span><span class="ff1a">at<span class="_ _45"> </span></span>command <span class="_ _9"></span>calls<span class="_ _47"> </span><span class="ff1a">seteuid<span class="_ _45"> </span></span>to <span class="_ _9"></span>set <span class="_ _3"></span>the <span class="_ _9"></span>effective <span class="_ _3"></span>user <span class="_ _9"></span>ID</div><div class="t m0 x41 h26 y2238 ff19 fsf fc0 sc0 ls0 ws0">to<span class="_ _4b"> </span><span class="ff1a">root</span><span class="lsa28">.T<span class="_ _64"></span><span class="ls0">his <span class="_"> </span>call <span class="_ _53"> </span>is <span class="_"> </span>allowed <span class="_ _53"> </span>because <span class="_"> </span>the <span class="_ _e"> </span>argument <span class="_ _53"> </span>to<span class="_ _59"> </span><span class="ff1a">seteuid<span class="_ _59"> </span></span>equals <span class="_ _e"> </span>the</span></span></div><div class="t m0 x41 h2a y2239 ff19 fsf fc0 sc0 ls0 ws0">saved <span class="_ _9"></span>set-user-ID. <span class="_ _47"> </span>(This<span class="_ _45"> </span>is <span class="_ _9"></span>why <span class="_ _9"></span>we <span class="_ _9"></span>need <span class="_ _9"></span>the <span class="_ _9"></span>saved <span class="_ _9"></span>set-user-ID.) <span class="_ _45"> </span>After<span class="_ _45"> </span>this, <span class="_ _9"></span>we</div><div class="t m0 x41 h2a y223a ff19 fsf fc0 sc0 ls0 ws0">have</div><div class="t m0 x14e h2a y223b ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">al user ID =<span class="_ _46"> </span>our user ID (unchanged)</span></div><div class="t m0 xdf h26 y223c ff19 fsf fc0 sc0 ls0 ws0">effective user ID =<span class="_ _59"> </span><span class="ff1a">root</span></div><div class="t m0 xb1 h26 y223d ff19 fsf fc0 sc0 ls0 ws0">saved set-user-ID =<span class="_ _59"> </span><span class="ff1a">root<span class="_ _80"> </span></span>(unchanged)</div><div class="t m0 x41 h26 y223e ff19 fsf fc0 sc0 ls0 ws0">Because the effective user ID is<span class="_"> </span><span class="ff1a">root</span><span class="ls44">,ﬁ<span class="_ _4f"></span><span class="ls0">le access is allowed.</span></span></div><div class="t m0 x3f h2a y223f ff19 fsf fc0 sc0 ls0 ws0">4. <span class="_ _51"> </span>After<span class="_ _45"> </span>the <span class="_ _23"> </span>ﬁles <span class="_ _23"></span>ar<span class="lsa29">em<span class="_ _43"></span><span class="ls0">odiﬁed <span class="_ _23"></span>to <span class="_ _9"></span>recor<span class="lsa29">dt<span class="_ _43"></span><span class="ls0">he <span class="_ _23"> </span>commands <span class="_ _23"></span>to <span class="_ _9"></span>be <span class="_ _23"></span>run <span class="_ _9"></span>and <span class="_ _23"> </span>the <span class="_ _23"></span>time <span class="_ _9"></span>at</span></span></span></span></div><div class="t m0 x41 h26 y2240 ff19 fsf fc0 sc0 ls0 ws0">which <span class="_"> </span>they <span class="_ _e"> </span>are<span class="_ _59"> </span>to<span class="_ _59"> </span>be<span class="_ _46"> </span>run, <span class="_"> </span>the<span class="_ _4b"> </span><span class="ff1a">at<span class="_ _46"> </span></span>command <span class="_"> </span>lowers <span class="_ _e"> </span>its <span class="_"> </span>privileges <span class="_"> </span>by <span class="_"> </span>calling</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
