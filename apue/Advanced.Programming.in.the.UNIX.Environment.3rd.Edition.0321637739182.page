<div id="pfb6" class="pf w4 h1f" data-page-no="b6"><div class="pc pcb6 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bgb6.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">148<span class="_ _1b"> </span><span class="ff19">Standar<span class="ls30a">dI<span class="_ _55"></span><span class="ls0">/O <span class="_"> </span>Library<span class="_ _1c9"> </span>Chapter <span class="_"> </span>5</span></span></span></div><div class="t m0 x35 h53 y12f ff16 fs2b fc0 sc0 ls0 ws0">5.5 <span class="_ _68"> </span>Opening<span class="_ _54"> </span><span class="ls1c3">aS<span class="_ _52"></span><span class="ls0">tream</span></span></div><div class="t m0 x32 h26 y4de ff19 fsf fc0 sc0 ls0 ws0">The<span class="_"> </span><span class="ff1a">fopen</span>,<span class="_"> </span><span class="ff1a">freopen</span><span class="ls44">,a<span class="_ _d"></span><span class="ls0">nd<span class="_"> </span><span class="ff1a">fdopen<span class="_ _66"> </span></span>functions open a standar<span class="ls44">dI<span class="_ _4f"></span><span class="ls0">/O stream.</span></span></span></span></div><div class="t m0 x3f h57 ya79 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;stdio.h&gt;</div><div class="t m0 x3f h57 y14e9 ff1a fs2d fc0 sc0 ls0 ws0">FILE *fopen(const char *restrict<span class="_"> </span><span class="ff1b">pathname</span><span class="ls15c">,c<span class="_ _1d"></span><span class="ls0">onst char *restrict<span class="_"> </span><span class="ff1b">type</span>);</span></span></div><div class="t m0 x3f h57 y14ea ff1a fs2d fc0 sc0 ls0 ws0">FILE *freopen(const char *restrict<span class="_"> </span><span class="ff1b">pathname</span><span class="ls15c">,c<span class="_ _1d"></span><span class="ls0">onst char *restrict<span class="_"> </span><span class="ff1b">type</span>,</span></span></div><div class="t m0 xea h57 y14eb ff1a fs2d fc0 sc0 ls0 ws0">FILE *restrict<span class="_"> </span><span class="ff1b">fp</span>);</div><div class="t m0 x3f h57 y14ec ff1a fs2d fc0 sc0 ls0 ws0">FILE *fdopen(int<span class="_"> </span><span class="ff1b">fd</span><span class="ls15c">,c<span class="_ _1d"></span><span class="ls0">onst char *<span class="ff1b">type</span>);</span></span></div><div class="t m0 x9c h57 y14ed ff19 fs2d fc0 sc0 ls0 ws0">All three r<span class="_ _0"></span>eturn: ﬁle pointer if OK,<span class="_"> </span><span class="ff1a">NULL<span class="_ _e"> </span></span>on error</div><div class="t m0 x32 h49 y14ee ff19 fs26 fc0 sc0 ls0 ws0">The differ<span class="_ _0"></span>ences in these thr<span class="_ _0"></span>ee functions are<span class="_"> </span>as<span class="_"> </span>follows:</div><div class="t m0 x3f h4d y14ef ff19 fs26 fc0 sc0 ls0 ws0">1. <span class="_ _51"> </span>The<span class="_"> </span><span class="ff1a">fopen<span class="_ _80"> </span></span>function opens a speciﬁed ﬁle.</div><div class="t m0 x3f h4d y14f0 ff19 fs26 fc0 sc0 ls66b ws0">2T<span class="_ _1cc"></span><span class="ls0">he<span class="_ _45"> </span><span class="ff1a">freopen<span class="_ _45"> </span></span>function <span class="_ _23"></span>opens <span class="_ _9"></span>a <span class="_ _23"> </span>speciﬁed <span class="_ _9"></span>ﬁle <span class="_ _23"> </span>on <span class="_ _23"></span>a <span class="_ _9"></span>speciﬁed <span class="_ _23"></span>str<span class="_ _0"></span>eam, <span class="_ _9"></span>closing <span class="_ _23"></span>the</span></div><div class="t m0 x41 h49 y14f1 ff19 fs26 fc0 sc0 ls0 ws0">stream <span class="_ _23"> </span>ﬁrst <span class="_ _42"> </span>if <span class="_ _42"> </span>it <span class="_ _42"> </span>is <span class="_ _42"> </span>alr<span class="_ _0"></span>eady <span class="_ _42"> </span>open.<span class="_ _51"> </span>If <span class="_ _42"> </span>the <span class="_ _42"> </span>stream <span class="_ _23"> </span>previously <span class="_ _42"> </span>had <span class="_ _23"> </span>an <span class="_ _42"> </span>orientation,</div><div class="t m0 x41 h4d y14f2 ff1a fs26 fc0 sc0 ls0 ws0">freopen<span class="_ _66"> </span><span class="ff19">clears <span class="_ _3"></span>it.<span class="_ _61"> </span>This <span class="_ _2"></span>function <span class="_ _2"></span>is <span class="_ _3"></span>typically <span class="_ _2"></span>used <span class="_ _2"></span>to <span class="_ _3"></span>open <span class="_ _2"></span>a <span class="_ _2"></span>speciﬁed <span class="_ _3"></span>ﬁle <span class="_ _2"></span>as <span class="_ _2"></span>one</span></div><div class="t m0 x41 h49 y14f3 ff19 fs26 fc0 sc0 ls0 ws0">of the predeﬁned str<span class="_ _0"></span>eams: standar<span class="_ _0"></span><span class="lsd3">di<span class="_ _d"></span><span class="ls0">nput, standar<span class="lsd3">do<span class="_ _d"></span><span class="ls0">utput, or standar<span class="lsd3">de<span class="_ _d"></span><span class="ls0">rror<span class="_ _6"></span>.</span></span></span></span></span></span></div><div class="t m0 x3f h4d y14f4 ff19 fs26 fc0 sc0 ls0 ws0">3. <span class="_ _51"> </span>The<span class="_ _35"> </span><span class="ff1a">fdopen<span class="_ _44"> </span></span>function <span class="_ _42"> </span>takes <span class="_ _23"> </span>an <span class="_ _42"> </span>existing <span class="_ _42"> </span>ﬁle <span class="_ _42"> </span>descriptor<span class="_ _6"></span><span class="ls66c">,w<span class="_ _43"></span><span class="ls0">hich <span class="_ _42"> </span>we <span class="_ _42"> </span>could <span class="_ _23"> </span>obtain</span></span></div><div class="t m0 x41 h4d y14f5 ff19 fs26 fc0 sc0 ls0 ws0">from <span class="_ _42"> </span>the<span class="_ _44"> </span><span class="ff1a">open</span>,<span class="_ _44"> </span><span class="ff1a">dup</span>,<span class="_ _44"> </span><span class="ff1a">dup2</span>,<span class="_ _35"> </span><span class="ff1a">fcntl</span>,<span class="_ _44"> </span><span class="ff1a">pipe</span>,<span class="_ _44"> </span><span class="ff1a">socket</span>,<span class="_ _44"> </span><span class="ff1a">socketpair</span><span class="ls66d">,o<span class="_ _43"></span><span class="ls0">r<span class="_ _44"> </span><span class="ff1a">accept</span></span></span></div><div class="t m0 x41 h49 y14f6 ff19 fs26 fc0 sc0 ls0 ws0">functions, <span class="_ _47"> </span>and <span class="_ _45"> </span>associates <span class="_ _45"> </span>a <span class="_ _47"> </span>standar<span class="ls66e">dI<span class="_ _62"></span><span class="ls0">/O <span class="_ _47"> </span>stream <span class="_ _45"> </span>with <span class="_ _47"> </span>the <span class="_ _45"> </span>descriptor<span class="_ _6"></span><span class="ls66f">.T<span class="_ _56"></span><span class="ls0">his</span></span></span></span></div><div class="t m0 x41 h49 y14f7 ff19 fs26 fc0 sc0 ls0 ws0">function <span class="_ _23"></span>is <span class="_ _23"> </span>often <span class="_ _23"> </span>used <span class="_ _23"> </span>with <span class="_ _23"> </span>descriptors <span class="_ _42"> </span>that <span class="_ _23"></span>ar<span class="ls63d">er<span class="_ _c"></span><span class="ls0">eturned <span class="_ _42"> </span>by <span class="_ _23"></span>the <span class="_ _23"></span>functions <span class="_ _23"></span>that</span></span></div><div class="t m0 x41 h49 y14f8 ff19 fs26 fc0 sc0 ls0 ws0">create pipes <span class="_ _3"></span>and <span class="_ _2"></span>network <span class="_ _3"></span>communication <span class="_ _2"></span>channels.<span class="_ _16"> </span>Because <span class="_ _2"></span>these <span class="_ _3"></span>special <span class="_ _2"></span>types</div><div class="t m0 x41 h4d y14f9 ff19 fs26 fc0 sc0 ls0 ws0">of ﬁles <span class="_ _2"></span>cannot be <span class="_ _2"></span>opened with <span class="_ _2"></span>the <span class="_ _2"></span>standar<span class="ls670">dI<span class="_ _4f"></span><span class="ls0">/O<span class="_"> </span><span class="ff1a">fopen<span class="_ _66"> </span></span>function, <span class="_ _2"></span>we have <span class="_ _2"></span>to call</span></span></div><div class="t m0 x41 h49 y14fa ff19 fs26 fc0 sc0 ls0 ws0">the <span class="_ _42"> </span>device-speciﬁc <span class="_ _42"> </span>function <span class="_ _42"> </span>to <span class="_ _53"> </span>obtain <span class="_ _42"> </span>a <span class="_ _42"> </span>ﬁle <span class="_ _53"> </span>descriptor<span class="_ _6"></span><span class="ls671">,a<span class="_ _43"></span><span class="ls0">nd <span class="_ _42"> </span>then <span class="_ _42"> </span>associate <span class="_ _42"> </span>this</span></span></div><div class="t m0 x41 h4d y14fb ff19 fs26 fc0 sc0 ls0 ws0">descriptor with a standar<span class="lsd3">dI<span class="_ _4f"></span><span class="ls0">/O stream using<span class="_"> </span><span class="ff1a">fdopen</span>.</span></span></div><div class="t m0 x76 h5e y14fc ff19 fs10 fc0 sc0 ls0 ws0">Both<span class="_ _66"> </span><span class="ff1a">fopen<span class="_ _66"> </span></span>and<span class="_ _66"> </span><span class="ff1a">freopen<span class="_ _66"> </span></span>ar<span class="ls672">ep<span class="_ _4f"></span><span class="ls0">art <span class="_ _3"></span>of <span class="_ _9"></span>ISO <span class="_ _3"></span>C;<span class="_ _66"> </span><span class="ff1a">fdopen<span class="_ _66"> </span></span>is <span class="_ _3"></span>part <span class="_ _9"></span>of <span class="_ _3"></span>POSIX.1, <span class="_ _3"></span>since <span class="_ _9"></span>ISO <span class="_ _3"></span>C <span class="_ _9"></span>doesn’t</span></span></div><div class="t m0 x76 h2d y14fd ff19 fs10 fc0 sc0 ls0 ws0">deal with ﬁle descriptors.</div><div class="t m0 x135 h4f y14fe ff1b fs11 fc0 sc0 ls0 ws0">type<span class="_ _1b3"> </span><span class="ff19">Description<span class="_ _1a7"> </span><span class="ff1a">open</span></span></div><div class="t m0 x16b h2e y14ff ff19 fs11 fc0 sc0 ls0 ws0">(</div><div class="t m0 x120 h2e y14fe ff19 fs11 fc0 sc0 ls0 ws0">2</div><div class="t m0 x1c3 h2e y14ff ff19 fs11 fc0 sc0 ls0 ws0">)</div><div class="t m0 xb2 h2e y14fe ff19 fs11 fc0 sc0 ls0 ws0">Flags</div><div class="t m0 x1c4 h6d y1500 ff1a fs12 fc0 sc0 ls0 ws0">r<span class="_"> </span><span class="ff19">or<span class="_ _59"> </span></span>rb <span class="_ _1cd"> </span>O_RDONLY<span class="_ _1ce"></span><span class="ff19">open for reading</span></div><div class="t m0 x1c4 h6d y1501 ff1a fs12 fc0 sc0 ls0 ws0">w<span class="_"> </span><span class="ff19">or<span class="_ _59"> </span></span>wb <span class="_ _1cd"> </span>O_WRONLY|O_CREAT|O_TRUNC<span class="_ _1cf"></span><span class="ff19">truncate to 0 length or create for writing</span></div><div class="t m0 x1c4 h6d y1502 ff1a fs12 fc0 sc0 ls0 ws0">a<span class="_"> </span><span class="ff19">or<span class="_ _59"> </span></span>ab <span class="_ _1cd"> </span>O_WRONLY|O_CREAT|O_APPEND<span class="_ _1d0"></span><span class="ff19">append; open for writing at end of ﬁle, or</span></div><div class="t m0 x25 h2f y1503 ff19 fs12 fc0 sc0 ls0 ws0">create for writing</div><div class="t m0 x1c4 h6d y1504 ff1a fs12 fc0 sc0 ls0 ws0">r+<span class="_"> </span><span class="ff19">or<span class="_ _59"> </span></span>r+b<span class="_"> </span><span class="ff19">or<span class="_ _59"> </span></span>rb+ <span class="_ _1d1"> </span>O_RDWR<span class="_ _1d2"></span><span class="ff19">open for reading and writing</span></div><div class="t m0 x1c4 h6d y1505 ff1a fs12 fc0 sc0 ls0 ws0">w+<span class="_"> </span><span class="ff19">or<span class="_ _59"> </span></span>w+b<span class="_"> </span><span class="ff19">or<span class="_ _59"> </span></span>wb+ <span class="_ _1d1"> </span>O_RDWR|O_CREAT|O_TRUNC<span class="_ _1d3"></span><span class="ff19">truncate to 0 length or create for r<span class="_ _0"></span>eading and</span></div><div class="t m0 x25 h2f y1506 ff19 fs12 fc0 sc0 ls0 ws0">writing</div><div class="t m0 x1c4 h6d y1507 ff1a fs12 fc0 sc0 ls0 ws0">a+<span class="_"> </span><span class="ff19">or<span class="_ _59"> </span></span>a+b<span class="_"> </span><span class="ff19">or<span class="_ _59"> </span></span>ab+ <span class="_ _1d1"> </span>O_RDWR|O_CREAT|O_APPEND<span class="_ _1d4"></span><span class="ff19">open or create for r<span class="_ _0"></span>eading and writing at</span></div><div class="t m0 x25 h2f y1508 ff19 fs12 fc0 sc0 ls0 ws0">end of ﬁle</div><div class="t m0 x50 hca y1509 ff18 fs13 fc0 sc0 ls0 ws0">Figure 5.2<span class="_ _5a"> </span><span class="ff19">The<span class="_"> </span><span class="ff1b">type<span class="_"> </span></span>argument for opening a standar<span class="ls673">dI<span class="_ _5"></span><span class="ls0">/O stream</span></span></span></div><div class="t m0 x3f h79 y150a ff19 fs31 fc0 sc0 ls0 ws0">ISO <span class="_ _42"> </span>C <span class="_ _42"> </span>speciﬁes <span class="_ _53"> </span>15 <span class="_ _42"> </span>values <span class="_ _53"> </span>for <span class="_ _42"> </span>the<span class="_ _44"> </span><span class="ff1b">type<span class="_ _44"> </span></span>argument, <span class="_ _42"> </span>shown <span class="_ _53"> </span>in <span class="_ _42"> </span>Figur<span class="ls674">e5<span class="_ _c"></span><span class="ls0">.3. <span class="_ _44"> </span>Using<span class="_ _44"> </span>the</span></span></div><div class="t m0 x32 h64 y150b ff19 fs31 fc0 sc0 ls0 ws0">character<span class="_"> </span><span class="ff1a">b<span class="_ _47"> </span></span>as part <span class="_ _2"></span>of <span class="_ _2"></span>the<span class="_ _66"> </span><span class="ff1b">type<span class="_ _66"> </span></span>allows <span class="_ _2"></span>the <span class="_ _2"></span>standar<span class="ls675">dI<span class="_ _4f"></span><span class="ls0">/O <span class="_ _2"></span>system <span class="_ _2"></span>to differentiate between <span class="_ _2"></span>a</span></span></div><a class="l" href="#pfd" data-dest-detail='[13,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892409px;bottom:1236.288916px;width:145.367805px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
