<div id="pfb5" class="pf w4 h1f" data-page-no="b5"><div class="pc pcb5 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bgb5.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>5.4<span class="_ _1ca"> </span>Buffering<span class="_ _1b"> </span><span class="ff18">147</span></div><div class="t m0 x3f h26 y12f ff19 fsf fc0 sc0 ls65 ws0">Wi<span class="_ _3"></span><span class="ls0">th<span class="_ _47"> </span><span class="ff1a">setbuf</span>,<span class="_ _45"> </span>we<span class="_ _47"> </span>can <span class="_ _3"></span>turn <span class="_ _9"></span>buffering <span class="_ _2"></span>on <span class="_ _9"></span>or <span class="_ _3"></span>off. <span class="_ _47"> </span>T<span class="_ _6"></span><span class="ls65d">oe<span class="_ _8"></span><span class="ls0">nable <span class="_ _3"></span>buffering,<span class="_ _47"> </span><span class="ff1b">buf<span class="_ _45"> </span></span>must <span class="_ _3"></span>point</span></span></span></div><div class="t m0 x32 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">to a buffer of length<span class="_"> </span><span class="ff1a">BUFSIZ</span><span class="ls65e">,ac<span class="_ _4f"></span><span class="ls0">onstant deﬁned in<span class="_"> </span><span class="ff1a">&lt;stdio.h&gt;</span><span class="ls65f">.N<span class="_ _4a"></span><span class="ls0">ormally<span class="_ _6"></span><span class="ls11c">,t<span class="_ _d"></span><span class="ls0">he stream is</span></span></span></span></span></span></div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">then <span class="_ _3"></span>fully <span class="_ _9"></span>buffer<span class="_ _1"></span>ed, <span class="_ _9"></span>but <span class="_ _3"></span>some <span class="_ _9"></span>systems <span class="_ _3"></span>may <span class="_ _9"></span>set <span class="_ _3"></span>line <span class="_ _9"></span>buffering <span class="_ _3"></span>if <span class="_ _3"></span>the <span class="_ _9"></span>stream <span class="_ _3"></span>is <span class="_ _3"></span>associated</div><div class="t m0 x32 h26 y132 ff19 fsf fc0 sc0 ls0 ws0">with a terminal device.<span class="_ _59"> </span><span class="ls5f">To <span class="_ _e"> </span>d<span class="_ _9"></span></span>isable buffering, we set<span class="_"> </span><span class="ff1b">buf<span class="_"> </span></span>to<span class="_"> </span><span class="ff1a">NULL</span>.</div><div class="t m0 x3f h26 y133 ff19 fsf fc0 sc0 ls65 ws0">Wi<span class="_ _3"></span><span class="ls0">th<span class="_ _45"> </span><span class="ff1a">setvbuf</span>,<span class="_ _45"> </span>we<span class="_ _45"> </span>specify <span class="_ _9"></span>exactly <span class="_ _23"></span>which <span class="_ _9"></span>type <span class="_ _9"></span>of <span class="_ _23"></span>buffering <span class="_ _3"></span>we <span class="_ _23"></span>want.<span class="_ _5a"> </span>This <span class="_ _9"></span>is <span class="_ _9"></span>done</span></div><div class="t m0 x32 h2b y134 ff19 fsf fc0 sc0 ls0 ws0">with the<span class="_"> </span><span class="ff1b">mode<span class="_"> </span></span>argument:</div><div class="t m0 xf h52 y14c4 ff1a fs2a fc0 sc0 ls0 ws0">_IOFBF<span class="_ _6e"> </span><span class="ff19">fully buffer<span class="_ _0"></span>ed</span></div><div class="t m0 xf h52 y14c5 ff1a fs2a fc0 sc0 ls0 ws0">_IOLBF<span class="_ _6e"> </span><span class="ff19">line buffer<span class="_ _0"></span>ed</span></div><div class="t m0 xf h52 y14c6 ff1a fs2a fc0 sc0 ls0 ws0">_IONBF<span class="_ _6e"> </span><span class="ff19">unbuffer<span class="_ _0"></span>ed</span></div><div class="t m0 x32 h2b y14c7 ff19 fsf fc0 sc0 ls0 ws0">If <span class="_"> </span>we <span class="_ _e"> </span>specify <span class="_"> </span>an <span class="_ _e"> </span>unbuffered <span class="_ _e"> </span>stream, <span class="_ _e"> </span>the<span class="_ _59"> </span><span class="ff1b">buf<span class="_ _59"> </span></span>and<span class="_ _46"> </span><span class="ff1b">size<span class="_ _59"> </span></span>arguments <span class="_ _e"> </span>ar<span class="ls660">ei<span class="_ _4a"></span><span class="ls0">gnored. <span class="_ _4b"> </span>If<span class="_ _46"> </span>we</span></span></div><div class="t m0 x32 h2b y14c8 ff19 fsf fc0 sc0 ls0 ws0">specify fully buffered or line buffer<span class="_ _0"></span>ed,<span class="_"> </span><span class="ff1b">buf<span class="_"> </span></span>and<span class="_"> </span><span class="ff1b">size<span class="_ _66"> </span></span>can <span class="_ _2"></span>optionally specify a buffer and its</div><div class="t m0 x32 h26 y14c9 ff19 fsf fc0 sc0 ls0 ws0">size. <span class="_ _54"> </span>If<span class="_ _54"> </span>the <span class="_ _35"> </span>stream <span class="_ _44"> </span>is <span class="_ _35"> </span>buffered <span class="_ _35"> </span>and<span class="_ _54"> </span><span class="ff1b">buf<span class="_ _54"> </span></span>is<span class="_ _54"> </span><span class="ff1a">NULL</span><span class="ls661">,t<span class="_ _52"></span><span class="ls0">he <span class="_ _44"> </span>standar<span class="ls661">dI<span class="_ _52"></span><span class="ls0">/O <span class="_ _35"> </span>library <span class="_ _44"> </span>will</span></span></span></span></div><div class="t m0 x32 h2a y14ca ff19 fsf fc0 sc0 ls0 ws0">automatically <span class="_ _35"> </span>allocate <span class="_ _45"> </span>its <span class="_ _35"> </span>own <span class="_ _45"> </span>buffer <span class="_ _35"> </span>of <span class="_ _45"> </span>the <span class="_ _35"> </span>appropriate <span class="_ _45"> </span>size <span class="_ _35"> </span>for <span class="_ _45"> </span>the <span class="_ _35"> </span>stream. <span class="_ _5a"> </span>By</div><div class="t m0 x32 h26 y14cb ff19 fsf fc0 sc0 ls0 ws0">appropriate size, we mean the value speciﬁed by the constant<span class="_"> </span><span class="ff1a">BUFSIZ</span>.</div><div class="t m0 x76 h52 y6b6 ff19 fs2a fc0 sc0 ls0 ws0">Some <span class="_ _23"> </span>C <span class="_ _23"> </span>library <span class="_ _23"> </span>implementations <span class="_ _23"> </span>use <span class="_ _23"> </span>the <span class="_ _23"> </span>value <span class="_ _23"> </span>from <span class="_ _9"> </span>the<span class="_ _45"> </span><span class="ff1a">st_blksize<span class="_ _47"> </span></span>member <span class="_ _23"> </span>of <span class="_ _23"> </span>the<span class="_ _45"> </span><span class="ff1a">stat</span></div><div class="t m0 x76 h51 y14cc ff19 fs2a fc0 sc0 ls0 ws0">structur<span class="ls662">e(<span class="_ _8"></span><span class="ls0">see <span class="_ _9"></span>Section <span class="_ _9"></span>4.2) <span class="_ _3"></span>to <span class="_ _9"></span>determine <span class="_ _9"></span>the <span class="_ _9"></span>optimal <span class="_ _3"></span>standar<span class="ls662">dI<span class="_ _4f"></span><span class="ls0">/O <span class="_ _9"></span>buffer <span class="_ _3"></span>size.<span class="_ _59"> </span>As <span class="_ _9"></span>we <span class="_ _9"></span>will <span class="_ _9"></span>see</span></span></span></span></div><div class="t m0 x76 h51 y14cd ff19 fs2a fc0 sc0 ls0 ws0">later in this chapter<span class="_ _1"></span><span class="lse9">,t<span class="_ _84"></span><span class="ls0">he GNU C library uses this method.</span></span></div><div class="t m0 x3f h2a y14ce ff19 fsf fc0 sc0 ls0 ws0">Figur<span class="ls44">e5<span class="_ _4f"></span><span class="ls0">.1 summarizes the actions of these two functions and their various options.</span></span></div><div class="t m0 x1c1 h77 y14cf ff19 fs10 fc0 sc0 ls0 ws0">Function<span class="_ _17"> </span><span class="ff1b">mode <span class="_ _21"> </span>buf<span class="_ _73"> </span></span>Buffer and length<span class="_ _139"> </span><span class="ls277">Ty<span class="_ _3"></span></span>pe of buffering</div><div class="t m0 xea h4f y14d0 ff19 fs11 fc0 sc0 ls0 ws0">non-null <span class="_ _df"> </span>user<span class="_"> </span><span class="ff1b">buf<span class="_"> </span></span>of length<span class="_"> </span><span class="ff1a">BUFSIZ<span class="_ _a1"> </span></span>fully buffer<span class="_ _0"></span>ed or line buffer<span class="_ _0"></span>ed</div><div class="t m0 xea h6d y14d1 ff1a fs12 fc0 sc0 ls0 ws0">NULL<span class="_ _7a"> </span><span class="ff19">(no buffer) <span class="_ _1cb"> </span>unbuffer<span class="_ _0"></span>ed</span></div><div class="t m0 x1c2 h6d y14d2 ff1a fs12 fc0 sc0 ls0 ws0">setbuf</div><div class="t m0 xea hca y14d3 ff19 fs13 fc0 sc0 ls0 ws0">non-null <span class="_ _df"> </span>user<span class="_"> </span><span class="ff1b">buf<span class="_"> </span></span>of length<span class="_"> </span><span class="ff1b">size</span></div><div class="t m0 xea h6f y14d4 ff1a fs14 fc0 sc0 ls0 ws0">NULL<span class="_ _7a"> </span><span class="ff19">system buffer of appropriate length</span></div><div class="t m0 x139 h6f y14d5 ff1a fs14 fc0 sc0 ls0 ws0">_IOFBF<span class="_ _8b"> </span><span class="ff19">fully buf<span class="_ _0"></span>fered</span></div><div class="t m0 xea hcb y14d6 ff19 fs15 fc0 sc0 ls0 ws0">non-null <span class="_ _df"> </span>user<span class="_"> </span><span class="ff1b">buf<span class="_"> </span></span>of length<span class="_"> </span><span class="ff1b">size</span></div><div class="t m0 xea h70 y14d7 ff1a fs16 fc0 sc0 ls0 ws0">NULL<span class="_ _7a"> </span><span class="ff19">system buffer of appropriate length</span></div><div class="t m0 x139 h70 y14d8 ff1a fs16 fc0 sc0 ls0 ws0">_IOLBF<span class="_ _8b"> </span><span class="ff19">line buf<span class="_ _0"></span>fered</span></div><div class="t m0 x139 h71 y14d9 ff1a fs36 fc0 sc0 ls0 ws0">_IONBF<span class="_ _6e"> </span><span class="ff19">(ignored) <span class="_ _7f"> </span>(no<span class="_"> </span>buffer) <span class="_ _1cb"> </span>unbuffer<span class="_ _0"></span>ed</span></div><div class="t m0 x1c2 h71 y14da ff1a fs36 fc0 sc0 ls0 ws0">setvbuf</div><div class="t m0 xe8 hcc y14db ff18 fs17 fc0 sc0 ls0 ws0">Figure 5.1<span class="_ _5a"> </span><span class="ff19">Summary of the<span class="_"> </span><span class="ff1a">setbuf<span class="_ _e"> </span></span>and<span class="_"> </span><span class="ff1a">setvbuf<span class="_ _e"> </span></span>functions</span></div><div class="t m0 x3f hcd y14dc ff19 fs6e fc0 sc0 ls0 ws0">Be awar<span class="ls663">et<span class="_ _4f"></span><span class="ls0">hat <span class="_ _2"></span>if <span class="_ _2"></span>we <span class="_ _2"></span>allocate <span class="_ _2"></span>a <span class="_ _2"></span>standar<span class="ls664">dI<span class="_ _4f"></span><span class="ls0">/O <span class="_ _2"></span>buffer as <span class="_ _2"></span>an <span class="_ _2"></span>automatic <span class="_ _2"></span>variable <span class="_ _2"></span>within <span class="_ _2"></span>a</span></span></span></span></div><div class="t m0 x32 hcd y14dd ff19 fs6e fc0 sc0 ls0 ws0">function, <span class="_ _2"></span>we <span class="_ _2"></span>have <span class="_ _2"></span>to <span class="_ _3"></span>close <span class="_ _2"></span>the <span class="_ _2"></span>stream <span class="_ _2"></span>befor<span class="ls665">er<span class="_ _b"></span><span class="ls0">eturning <span class="_ _3"></span>from the <span class="_ _3"></span>function.<span class="_ _61"> </span>(W<span class="_ _6"></span>e’ll <span class="_ _2"></span>discuss</span></span></div><div class="t m0 x32 hcd y14de ff19 fs6e fc0 sc0 ls0 ws0">this <span class="_ _2"></span>point <span class="_ _3"></span>further <span class="_ _3"></span>in <span class="_ _2"></span>Section <span class="_ _3"></span>7.8.)<span class="_ _61"> </span>Also, <span class="_ _3"></span>some <span class="_ _3"></span>implementations <span class="_ _2"></span>use <span class="_ _3"></span>part <span class="_ _3"></span>of <span class="_ _2"></span>the <span class="_ _3"></span>buffer <span class="_ _2"></span>for</div><div class="t m0 x32 hcd y14df ff19 fs6e fc0 sc0 ls0 ws0">internal <span class="_ _23"> </span>bookkeeping, <span class="_ _23"> </span>so <span class="_ _42"> </span>the <span class="_ _23"> </span>actual <span class="_ _23"> </span>number <span class="_ _42"> </span>of <span class="_ _23"></span>bytes <span class="_ _23"> </span>of <span class="_ _23"> </span>data <span class="_ _42"> </span>that <span class="_ _23"> </span>can <span class="_ _23"> </span>be <span class="_ _42"> </span>stor<span class="_ _0"></span>ed <span class="_ _23"> </span>in <span class="_ _23"> </span>the</div><div class="t m0 x32 hce y14e0 ff19 fs6e fc0 sc0 ls0 ws0">buffer <span class="_ _2"></span>can <span class="_ _3"></span>be <span class="_ _9"></span>less <span class="_ _3"></span>than<span class="_ _47"> </span><span class="ff1b">size</span><span class="ls666">.I<span class="_ _1d"></span><span class="ls667">ng<span class="_ _8"></span><span class="ls0">eneral, <span class="_ _9"></span>we <span class="_ _3"></span>should <span class="_ _3"></span>let <span class="_ _3"></span>the <span class="_ _9"></span>system <span class="_ _3"></span>choose <span class="_ _3"></span>the <span class="_ _3"></span>buffer <span class="_ _3"></span>size</span></span></span></div><div class="t m0 x32 hcd y14e1 ff19 fs6e fc0 sc0 ls0 ws0">and <span class="_ _66"> </span>automatically <span class="_ _47"> </span>allocate <span class="_ _66"> </span>the <span class="_ _47"> </span>buffer<span class="_ _6"></span><span class="ls668">.W<span class="_ _49"></span><span class="ls0">hen <span class="_"> </span>we <span class="_ _47"> </span>do <span class="_ _66"> </span>this, <span class="_ _47"> </span>the <span class="_ _66"> </span>standar<span class="ls669">dI<span class="_ _1d"></span><span class="ls0">/O <span class="_ _47"> </span>library</span></span></span></span></div><div class="t m0 x32 hcd y14e2 ff19 fs6e fc0 sc0 ls0 ws0">automatically releases the buf<span class="_ _0"></span>fer when we close the str<span class="_ _0"></span>eam.</div><div class="t m0 x3f hcd y14e3 ff19 fs6e fc0 sc0 ls0 ws0">At any time, we can force a str<span class="_ _0"></span>eam to be ﬂushed.</div><div class="t m0 x3f hcf y14e4 ff1a fs6f fc0 sc0 ls0 ws0">#include &lt;stdio.h&gt;</div><div class="t m0 x3f hcf y14e5 ff1a fs6f fc0 sc0 ls0 ws0">int fflush(FILE *<span class="ff1b">fp</span>);</div><div class="t m0 x1b4 hcf y14e6 ff19 fs6f fc0 sc0 ls0 ws0">Returns: 0 if OK,<span class="_"> </span><span class="ff1a">EOF<span class="_ _e"> </span></span>on error</div><div class="t m0 x32 h6a y14e7 ff19 fs34 fc0 sc0 ls0 ws0">The<span class="_ _4b"> </span><span class="ff1a">fflush<span class="_ _4b"> </span></span>function <span class="_ _e"> </span>causes <span class="_ _53"> </span>any <span class="_ _e"> </span>unwritten <span class="_ _e"> </span>data <span class="_ _e"> </span>for <span class="_ _53"> </span>the <span class="_ _e"> </span>stream <span class="_ _53"> </span>to <span class="_ _e"> </span>be <span class="_ _e"> </span>passed <span class="_ _e"> </span>to <span class="_ _53"> </span>the</div><div class="t m0 x32 h6a y14e8 ff19 fs34 fc0 sc0 ls0 ws0">kernel. <span class="_"> </span>As<span class="_"> </span><span class="ls66a">as<span class="_ _d"></span><span class="ls0">pecial case, if<span class="_"> </span><span class="ff1b">fp<span class="_"> </span></span>is<span class="_"> </span><span class="ff1a">NULL</span>,<span class="_"> </span><span class="ff1a">fflush<span class="_ _66"> </span></span>causes all output streams to be ﬂushed.</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
