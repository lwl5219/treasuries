<div id="pff4" class="pf w4 h1f" data-page-no="f4"><div class="pc pcf4 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bgf4.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">210<span class="_ _1b"> </span><span class="ff19">Process <span class="_"> </span>Envir<span class="_ _0"></span>onment <span class="_ _1c1"> </span>Chapter<span class="_ _44"> </span>7</span></div><div class="t m0 x35 h26 y12f ff1f fsf fc0 sc0 ls0 ws0">jemalloc</div><div class="t m0 x32 h26 y1105 ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _47"> </span><span class="ff1a">jemalloc<span class="_ _66"> </span></span>implementation <span class="_ _3"></span>of <span class="_ _2"></span>the<span class="_ _47"> </span><span class="ff1a">malloc<span class="_ _47"> </span></span>family <span class="_ _3"></span>of <span class="_ _2"></span>library <span class="_ _3"></span>functions <span class="_ _2"></span>is <span class="_ _3"></span>the <span class="_ _3"></span>default</div><div class="t m0 x32 h2a y150 ff19 fsf fc0 sc0 ls0 ws0">memory <span class="_ _66"> </span>allocator <span class="_ _47"> </span>in <span class="_ _47"> </span>FreeBSD <span class="_"> </span>8.0.<span class="_ _5f"> </span>It <span class="_ _47"> </span>was <span class="_ _66"> </span>designed <span class="_ _47"> </span>to <span class="_ _47"> </span>scale <span class="_ _66"> </span>well <span class="_ _47"> </span>when <span class="_ _47"> </span>used <span class="_ _47"> </span>with</div><div class="t m0 x32 h2a y151 ff19 fsf fc0 sc0 ls0 ws0">multithreaded <span class="_ _2"></span>applications <span class="_ _3"></span>running <span class="_ _3"></span>on <span class="_ _3"></span>multiprocessor <span class="_ _2"></span>systems.<span class="_ _16"> </span>Evans</div><div class="t m0 x120 h2a y1c60 ff19 fsf fc0 sc0 ls0 ws0">[</div><div class="t m0 x3a h2a y151 ff19 fsf fc0 sc0 ls0 ws0">2006</div><div class="t m0 xfa h2a y1c60 ff19 fsf fc0 sc0 ls0 ws0">]</div><div class="t m0 x69 h2a y151 ff19 fsf fc0 sc0 ls0 ws0">describes</div><div class="t m0 x32 h2a ya63 ff19 fsf fc0 sc0 ls0 ws0">the implementation and evaluates its performance.</div><div class="t m0 x35 h26 y31f ff1f fsf fc0 sc0 ls0 ws0">TCMalloc</div><div class="t m0 x32 h26 y137 ff1a fsf fc0 sc0 ls0 ws0">TCMalloc<span class="_ _61"> </span><span class="ff19">was <span class="_ _47"> </span>designed <span class="_ _47"> </span>as <span class="_ _47"> </span>a <span class="_ _47"> </span>replacement <span class="_ _66"> </span>for <span class="_ _47"> </span>the<span class="_ _16"> </span></span>malloc<span class="_ _61"> </span><span class="ff19">family <span class="_ _47"> </span>of <span class="_ _47"> </span>functions <span class="_ _47"> </span>to</span></div><div class="t m0 x32 h2a y138 ff19 fsf fc0 sc0 ls0 ws0">provide <span class="_ _47"> </span>high <span class="_ _47"> </span>performance, <span class="_ _45"> </span>scalability<span class="_ _4"></span><span class="ls89b">,a<span class="_ _1d"></span><span class="ls0">nd <span class="_ _45"> </span>memory <span class="_ _47"> </span>efﬁciency<span class="_ _4"></span><span class="ls89c">.I<span class="_ _56"></span><span class="ls89d">tu<span class="_ _62"></span><span class="ls0">ses <span class="_ _45"> </span>thread</span></span></span></span></span></div><div class="t m0 x1ec h2a y724 ff19 fsf fc0 sc0 ls0 ws0">-</div><div class="t m0 x14f h2a y138 ff19 fsf fc0 sc0 ls0 ws0">local</div><div class="t m0 x32 h2a y139 ff19 fsf fc0 sc0 ls0 ws0">caches <span class="_ _3"></span>to <span class="_ _3"></span>avoid <span class="_ _3"></span>locking <span class="_ _3"></span>overhead <span class="_ _2"></span>when <span class="_ _3"></span>allocating <span class="_ _3"></span>buffers <span class="_ _3"></span>from <span class="_ _2"></span>and <span class="_ _3"></span>releasing <span class="_ _2"></span>buffers <span class="_ _3"></span>to</div><div class="t m0 x32 h2a y13a ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _23"></span>cache.<span class="_ _5a"> </span>It <span class="_ _23"> </span>also <span class="_ _23"></span>has <span class="_ _23"></span>a <span class="_ _23"></span>heap <span class="_ _9"></span>checker <span class="_ _23"> </span>and <span class="_ _23"> </span>a <span class="_ _23"></span>heap <span class="_ _23"></span>proﬁler <span class="_ _9"></span>built <span class="_ _23"></span>in <span class="_ _23"></span>to <span class="_ _9"></span>aid <span class="_ _23"> </span>in <span class="_ _23"> </span>debugging</div><div class="t m0 x32 h26 y254 ff19 fsf fc0 sc0 ls0 ws0">and <span class="_ _53"> </span>analyzing <span class="_"> </span>dynamic <span class="_ _53"> </span>memory <span class="_ _e"> </span>usage.<span class="_ _65"> </span>The<span class="_ _59"> </span><span class="ff1a">TCMalloc<span class="_ _4b"> </span></span>library <span class="_ _e"> </span>is <span class="_ _e"> </span>available <span class="_ _e"> </span>as <span class="_ _e"> </span>open</div><div class="t m0 x32 h2a y255 ff19 fsf fc0 sc0 ls0 ws0">source fr<span class="_ _0"></span>om Google.<span class="_ _59"> </span>It is brieﬂy described by Ghemawat and Menage</div><div class="t m0 x1a5 h2a y1543 ff19 fsf fc0 sc0 ls0 ws0">[</div><div class="t m0 xef h2a y255 ff19 fsf fc0 sc0 ls0 ws0">2005</div><div class="t m0 x1d4 h2a y1543 ff19 fsf fc0 sc0 ls0 ws0">]</div><div class="t m0 xf9 h2a y255 ff19 fsf fc0 sc0 ls0 ws0">.</div><div class="t m0 x35 h26 y13c ff1f fsf fc0 sc0 ls0 ws0">alloca<span class="_ _66"> </span><span class="ff16">Function</span></div><div class="t m0 x32 h26 ya69 ff19 fsf fc0 sc0 ls0 ws0">One <span class="_ _9"></span>additional <span class="_ _3"></span>function <span class="_ _9"></span>is <span class="_ _9"></span>also <span class="_ _9"></span>worth <span class="_ _9"></span>mentioning.<span class="_ _5a"> </span>The <span class="_ _9"></span>function<span class="_ _45"> </span><span class="ff1a">alloca<span class="_ _47"> </span></span>has <span class="_ _9"></span>the <span class="_ _9"></span>same</div><div class="t m0 x32 h26 ya6b ff19 fsf fc0 sc0 ls0 ws0">calling <span class="_ _3"></span>sequence <span class="_ _3"></span>as<span class="_ _47"> </span><span class="ff1a">malloc</span><span class="ls89e">;h<span class="_ _8"></span><span class="ls0">owever<span class="_ _1"></span><span class="ls89e">,i<span class="_ _8"></span><span class="ls0">nstead <span class="_ _3"></span>of <span class="_ _9"></span>allocating <span class="_ _3"></span>memory <span class="_ _3"></span>from <span class="_ _2"></span>the <span class="_ _3"></span>heap, <span class="_ _3"></span>the</span></span></span></span></div><div class="t m0 x32 h2a y150d ff19 fsf fc0 sc0 ls0 ws0">memory is <span class="_ _2"></span>allocated <span class="_ _2"></span>from the stack <span class="_ _2"></span>frame <span class="_ _2"></span>of <span class="_ _2"></span>the current function.<span class="_ _61"> </span>The <span class="_ _2"></span>advantage is <span class="_ _2"></span>that</div><div class="t m0 x32 h2a ya2c ff19 fsf fc0 sc0 ls0 ws0">we <span class="_ _3"></span>don’t <span class="_ _9"></span>have <span class="_ _9"></span>to <span class="_ _3"></span>free <span class="_ _3"></span>the <span class="_ _9"></span>space; <span class="_ _9"></span>it <span class="_ _3"></span>goes <span class="_ _9"></span>away <span class="_ _9"></span>automatically <span class="_ _3"></span>when <span class="_ _9"></span>the <span class="_ _9"></span>function <span class="_ _3"></span>returns.</div><div class="t m0 x32 h26 ya2d ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _35"> </span><span class="ff1a">alloca<span class="_ _44"> </span></span>function <span class="_ _42"> </span>increases <span class="_ _42"> </span>the <span class="_ _42"> </span>size <span class="_ _42"> </span>of <span class="_ _42"> </span>the <span class="_ _42"> </span>stack <span class="_ _42"> </span>frame.<span class="_ _54"> </span>The <span class="_ _42"> </span>disadvantage <span class="_ _42"> </span>is <span class="_ _42"> </span>that</div><div class="t m0 x32 h26 ya2e ff19 fsf fc0 sc0 ls0 ws0">some <span class="_ _9"></span>systems <span class="_ _23"></span>can’t <span class="_ _9"></span>support<span class="_ _45"> </span><span class="ff1a">alloca</span>,<span class="_ _35"> </span>if<span class="_ _45"> </span>it’s <span class="_ _9"></span>impossible <span class="_ _23"></span>to <span class="_ _9"></span>increase <span class="_ _9"></span>the <span class="_ _23"></span>size <span class="_ _9"></span>of <span class="_ _23"></span>the <span class="_ _9"></span>stack</div><div class="t m0 x32 h2a ya2f ff19 fsf fc0 sc0 ls0 ws0">frame <span class="_ _3"></span>after <span class="_ _9"></span>the <span class="_ _3"></span>function <span class="_ _3"></span>has <span class="_ _9"></span>been <span class="_ _3"></span>called.<span class="_ _5a"> </span>Nevertheless, <span class="_ _3"></span>many <span class="_ _3"></span>softwar<span class="ls89f">ep<span class="_ _8"></span><span class="ls0">ackages <span class="_ _3"></span>use <span class="_ _9"></span>it,</span></span></div><div class="t m0 x32 h2a y1c61 ff19 fsf fc0 sc0 ls0 ws0">and implementations exist for a wide variety of systems.</div><div class="t m0 x76 h52 y4a6 ff19 fs2a fc0 sc0 ls0 ws0">All four platforms discussed in this text provide the<span class="_"> </span><span class="ff1a">alloca<span class="_ _53"> </span></span>function.</div><div class="t m0 x35 h53 y1c62 ff16 fs2b fc0 sc0 ls0 ws0">7.9 <span class="_ _68"> </span>En<span class="_ _1"></span>vironment <span class="_"> </span>V<span class="_ _6"></span>ariables</div><div class="t m0 x32 h2a y1c63 ff19 fsf fc0 sc0 ls0 ws0">As we mentioned earlier<span class="_ _6"></span><span class="ls44">,t<span class="_ _5"></span><span class="ls0">he environment strings ar<span class="_ _1"></span><span class="ls44">eu<span class="_ _5"></span><span class="ls0">sually of the form</span></span></span></span></div><div class="t m0 x3f h57 y1c64 ff1b fs2d fc0 sc0 ls0 ws0">name<span class="ff1a">=</span>value</div><div class="t m0 x32 h2a y1c65 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _23"></span>UNIX <span class="_ _9"></span>kernel <span class="_ _23"></span>never <span class="_ _23"></span>looks <span class="_ _9"></span>at <span class="_ _23"> </span>these <span class="_ _23"></span>strings; <span class="_ _9"></span>their <span class="_ _23"> </span>interpretation <span class="_ _9"></span>is <span class="_ _23"> </span>up <span class="_ _23"></span>to <span class="_ _9"></span>the <span class="_ _23"> </span>various</div><div class="t m0 x32 h2a y1c66 ff19 fsf fc0 sc0 ls0 ws0">applications. <span class="_ _46"> </span>The<span class="_ _46"> </span>shells, <span class="_"> </span>for <span class="_"> </span>example, <span class="_"> </span>use <span class="_"> </span>numerous <span class="_"> </span>environment <span class="_"> </span>variables.<span class="_ _60"> </span>Some,</div><div class="t m0 x32 h26 y1c67 ff19 fsf fc0 sc0 ls0 ws0">such <span class="_ _3"></span>as<span class="_ _45"> </span><span class="ff1a">HOME<span class="_ _47"> </span></span>and<span class="_ _45"> </span><span class="ff1a">USER</span><span class="ls8a0">,a<span class="_ _b"></span><span class="ls45">re <span class="_ _23"> </span>s<span class="_ _2"></span><span class="ls0">et <span class="_ _3"></span>automatically <span class="_ _9"></span>at <span class="_ _9"></span>login; <span class="_ _3"></span>others <span class="_ _9"></span>ar<span class="ls8a1">el<span class="_ _b"></span><span class="ls0">eft <span class="_ _9"></span>for <span class="_ _3"></span>us <span class="_ _9"></span>to <span class="_ _3"></span>set.<span class="_ _5a"> </span><span class="ls5f">We</span></span></span></span></span></span></div><div class="t m0 x32 h2a y1c68 ff19 fsf fc0 sc0 ls0 ws0">normally <span class="_ _3"></span>set <span class="_ _9"></span>environment <span class="_ _3"></span>variables <span class="_ _9"></span>in <span class="_ _9"></span>a <span class="_ _3"></span>shell <span class="_ _9"></span>start-up <span class="_ _9"></span>ﬁle <span class="_ _3"></span>to <span class="_ _9"></span>control <span class="_ _3"></span>the <span class="_ _9"></span>shell’s <span class="_ _3"></span>actions.</div><div class="t m0 x32 h26 y1c69 ff19 fsf fc0 sc0 ls0 ws0">If <span class="_ _42"> </span>we <span class="_ _53"> </span>set <span class="_ _42"> </span>the <span class="_ _53"> </span>environment <span class="_ _42"> </span>variable<span class="_ _44"> </span><span class="ff1a">MAILPATH</span><span class="ls8a2">,f<span class="_ _43"></span><span class="ls0">or <span class="_ _42"> </span>example, <span class="_ _42"> </span>it <span class="_ _53"> </span>tells <span class="_ _42"> </span>the <span class="_ _53"> </span>Bourne <span class="_ _53"> </span>shell,</span></span></div><div class="t m0 x32 h2a y1c6a ff19 fsf fc0 sc0 ls0 ws0">GNU Bourne-again shell, and Korn shell where<span class="_"> </span>to<span class="_"> </span>look for mail.</div><div class="t m0 x3f h2a y1c6b ff19 fsf fc0 sc0 ls0 ws0">ISO <span class="_ _3"></span>C <span class="_ _2"></span>deﬁnes <span class="_ _3"></span>a <span class="_ _3"></span>function <span class="_ _3"></span>that <span class="_ _3"></span>we <span class="_ _3"></span>can <span class="_ _3"></span>use <span class="_ _3"></span>to <span class="_ _3"></span>fetch <span class="_ _3"></span>values <span class="_ _3"></span>from <span class="_ _2"></span>the <span class="_ _3"></span>environment, <span class="_ _3"></span>but</div><div class="t m0 x32 h2a y1c6c ff19 fsf fc0 sc0 ls0 ws0">this standar<span class="ls44">ds<span class="_ _4f"></span><span class="ls0">ays that the contents of the environment ar<span class="ls44">ei<span class="_ _4f"></span><span class="ls0">mplementation deﬁned.</span></span></span></span></div><div class="t m0 x3f h57 y1c6d ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;stdlib.h&gt;</div><div class="t m0 x3f h57 y1c6e ff1a fs2d fc0 sc0 ls0 ws0">char *getenv(const char *<span class="ff1b">name</span>);</div><div class="t m0 xbf h57 y1c6f ff19 fs2d fc0 sc0 ls0 ws0">Returns: pointer to<span class="_"> </span><span class="ff1b">value<span class="_"> </span></span>associated with<span class="_"> </span><span class="ff1b">name</span>,<span class="_"> </span><span class="ff1a">NULL<span class="_ _e"> </span></span>if not found</div><a class="l" href="#pfe" data-dest-detail='[14,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892201px;bottom:531.528903px;width:167.819915px;height:19.679992px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
