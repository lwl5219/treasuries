<div id="pf240" class="pf w4 h1f" data-page-no="240"><div class="pc pc240 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg240.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">542<span class="_ _1b"> </span><span class="ff19">Interprocess <span class="_"> </span>Communication<span class="_ _2c"> </span>Chapter <span class="_"> </span>15</span></div><div class="t m0 x199 h76 y1ed4 ff19 fs2a fc0 sc0 ls0 ws0">parent<span class="_ _1bc"> </span><span class="ff1b">cmdstring<span class="_"> </span></span>(child)</div><div class="t m0 x19b h52 y41c8 ff1a fs2a fc0 sc0 ls0 ws0">fp<span class="_ _b4"> </span><span class="ff1b">stdin</span></div><div class="t m0 x14e h5e y41c9 ff18 fs10 fc0 sc0 ls0 ws0">Figure 15.10<span class="_ _5a"> </span><span class="ff19">Result of<span class="_"> </span><span class="ff1a">fp = popen(<span class="ff1b">cmdstring</span><span class="ls1180">,&quot;<span class="_ _55"></span><span class="ls0">w&quot;)</span></span></span></span></div><div class="t m0 x32 h4d y41ca ff19 fs26 fc0 sc0 ls0 ws0">One way <span class="_ _2"></span>to remember the <span class="_ _2"></span>ﬁnal argument to<span class="_ _66"> </span><span class="ff1a">popen<span class="_ _66"> </span></span>is <span class="_ _2"></span>to remember that, like<span class="_ _66"> </span><span class="ff1a">fopen</span><span class="ls1181">,t<span class="_ _d"></span><span class="ls0">he</span></span></div><div class="t m0 x32 h4d y41cb ff19 fs26 fc0 sc0 lscc ws0">re<span class="ls0">turned ﬁle pointer is readable if<span class="_"> </span><span class="ff1b">type<span class="_"> </span></span>is<span class="_"> </span><span class="ff1a">&quot;r&quot;<span class="_ _80"> </span></span>or writable if<span class="_"> </span><span class="ff1b">type<span class="_"> </span></span>is<span class="_"> </span><span class="ff1a">&quot;w&quot;</span>.</span></div><div class="t m0 x3f h4d y41cc ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _44"> </span><span class="ff1a">pclose<span class="_ _44"> </span></span>function <span class="_ _42"> </span>closes <span class="_ _42"> </span>the <span class="_ _53"> </span>standar<span class="ls1182">dI<span class="_ _c"></span><span class="ls0">/O <span class="_ _42"> </span>stream, <span class="_ _42"> </span>waits <span class="_ _42"> </span>for <span class="_ _53"> </span>the <span class="_ _42"> </span>command <span class="_ _42"> </span>to</span></span></div><div class="t m0 x32 h49 y41cd ff19 fs26 fc0 sc0 ls0 ws0">terminate, <span class="_ _59"> </span>and <span class="_ _46"> </span>returns <span class="_ _59"> </span>the <span class="_ _59"> </span>termination <span class="_ _46"> </span>status <span class="_ _46"> </span>of <span class="_ _59"> </span>the <span class="_ _46"> </span>shell.<span class="_ _5e"> </span>(W<span class="_ _6"></span><span class="ls1183">ed<span class="_ _49"></span><span class="ls0">escribed <span class="_ _46"> </span>the</span></span></div><div class="t m0 x32 h4d y41ce ff19 fs26 fc0 sc0 ls0 ws0">termination <span class="_ _9"></span>status <span class="_ _9"></span>in <span class="_ _9"></span>Section <span class="_ _9"></span>8.6.<span class="_ _5a"> </span>The<span class="_ _45"> </span><span class="ff1a">system<span class="_ _45"> </span></span>function, <span class="_ _9"></span>described <span class="_ _9"></span>in <span class="_ _9"></span>Section <span class="_ _9"></span>8.13, <span class="_ _9"></span>also</div><div class="t m0 x32 h49 y41cf ff19 fs26 fc0 sc0 lscc ws0">re<span class="ls0">turns <span class="_ _23"></span>the <span class="_ _23"></span>termination <span class="_ _9"></span>status.)<span class="_ _51"> </span>If <span class="_ _9"></span>the <span class="_ _23"></span>shell <span class="_ _23"></span>cannot <span class="_ _9"></span>be <span class="_ _23"></span>executed, <span class="_ _9"></span>the <span class="_ _23"></span>termination <span class="_ _23"></span>status</span></div><div class="t m0 x32 h4d y41d0 ff19 fs26 fc0 sc0 lscc ws0">re<span class="ls0">turned by<span class="_"> </span><span class="ff1a">pclose<span class="_ _66"> </span></span>is as if the shell had executed<span class="_"> </span><span class="ff1a">exit(127)</span>.</span></div><div class="t m0 x3f h4a y41d1 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_"> </span><span class="ff1b">cmdstring<span class="_"> </span></span>is executed by the Bourne shell, as in</div><div class="t m0 x3f h4e y41d2 ff1a fs28 fc0 sc0 ls0 ws0">sh -c<span class="_"> </span><span class="ff1b">cmdstring</span></div><div class="t m0 x32 h4a y41d3 ff19 fs26 fc0 sc0 ls0 ws0">This <span class="_ _2"></span>means <span class="_ _2"></span>that <span class="_ _2"></span>the <span class="_ _2"></span>shell <span class="_ _3"></span>expands <span class="_ _2"></span>any <span class="_ _2"></span>of <span class="_ _2"></span>its <span class="_ _2"></span>special <span class="_ _3"></span>characters <span class="_ _2"></span>in<span class="_ _66"> </span><span class="ff1b">cmdstring</span><span class="ls1184">.T<span class="_ _5b"></span><span class="ls0">his <span class="_ _3"></span>allows</span></span></div><div class="t m0 x32 h49 y41d4 ff19 fs26 fc0 sc0 ls0 ws0">us to say<span class="_ _4"></span><span class="lsd3">,f<span class="_ _5"></span><span class="ls0">or example,</span></span></div><div class="t m0 x3f h4e y41d5 ff1a fs28 fc0 sc0 ls0 ws0">fp = popen(&quot;ls *.c&quot;, &quot;r&quot;);</div><div class="t m0 x32 h49 y41d6 ff19 fs26 fc0 sc0 ls0 ws0">or</div><div class="t m0 x3f h4e y41d7 ff1a fs28 fc0 sc0 ls0 ws0">fp = popen(&quot;cmd 2&gt;&amp;1&quot;, &quot;r&quot;);</div><div class="t m0 x35 h4c y41d8 ff16 fs26 fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h4d y41d9 ff19 fs26 fc0 sc0 ls0 ws0">Let’s redo the pr<span class="_ _0"></span>ogram fr<span class="_ _0"></span>om Figur<span class="lsd3">e1<span class="_ _4f"></span><span class="ls0">5.6, using<span class="_"> </span><span class="ff1a">popen</span><span class="ls199">.T<span class="_ _4a"></span><span class="ls0">his is shown in Figur<span class="lsd3">e1<span class="_ _d"></span><span class="ls0">5.1<span class="_ _1"></span>1.</span></span></span></span></span></span></div><div class="t m0 x32 h5d y41da ff1a fs2f fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h5d y41db ff1a fs2f fc0 sc0 ls0 ws0">#include &lt;sys/wait.h&gt;</div><div class="t m0 x32 h5d y41dc ff1a fs2f fc0 sc0 ls0 ws0">#define PAGER<span class="_ _68"> </span>&quot;${PAGER:-more}&quot; /* environment variable, or default */</div><div class="t m0 x32 h5d y41dd ff1a fs2f fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h5d y41de ff1a fs2f fc0 sc0 ls0 ws0">main(int argc, char *argv[])</div><div class="t m0 x32 h5d y41df ff1a fs2f fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h5d y41e0 ff1a fs2f fc0 sc0 ls0 ws0">char <span class="_ _68"> </span>line[MAXLINE];</div><div class="t m0 x8a h5d y41e1 ff1a fs2f fc0 sc0 ls0 ws0">FILE <span class="_ _68"> </span>*fpin,<span class="_"> </span>*fpout;</div><div class="t m0 x8a h5d y41e2 ff1a fs2f fc0 sc0 ls0 ws0">if (argc != 2)</div><div class="t m0 x9d h5d y41e3 ff1a fs2f fc0 sc0 ls0 ws0">err_quit(&quot;usage: a.out &lt;pathname&gt;&quot;);</div><div class="t m0 x8a h5d y41e4 ff1a fs2f fc0 sc0 ls0 ws0">if ((fpin = fopen(argv[1], &quot;r&quot;)) == NULL)</div><div class="t m0 x9d h5d y41e5 ff1a fs2f fc0 sc0 ls0 ws0">err_sys(&quot;can’t open %s&quot;, argv[1]);</div><div class="t m0 x8a h5d y41e6 ff1a fs2f fc0 sc0 ls0 ws0">if ((fpout = popen(PAGER, &quot;w&quot;)) == NULL)</div><div class="t m0 x9d h5d y41e7 ff1a fs2f fc0 sc0 ls0 ws0">err_sys(&quot;popen error&quot;);</div><div class="t m0 x8a h5d y41e8 ff1a fs2f fc0 sc0 ls0 ws0">/* copy argv[1] to pager */</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
