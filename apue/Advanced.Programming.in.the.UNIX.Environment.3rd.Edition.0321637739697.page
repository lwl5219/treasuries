<div id="pf2b9" class="pf w4 h1f" data-page-no="2b9"><div class="pc pc2b9 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg2b9.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>17.6<span class="_ _67"> </span>An <span class="_"> </span>Open <span class="_"> </span>Server<span class="_ _6"></span><span class="ls30a">,V<span class="_ _1d"></span><span class="ls0">ersion <span class="_"> </span>2<span class="_ _1b"> </span><span class="ff18">663</span></span></span></div><div class="t m0 x32 h26 y12f ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _4b"> </span><span class="ff1b">argc<span class="_ _44"> </span></span>and<span class="_ _4b"> </span><span class="ff1b">argv<span class="_ _44"> </span></span>arguments <span class="_ _53"> </span>ar<span class="ls135e">et<span class="_ _55"></span><span class="ls0">he <span class="_ _53"> </span>same <span class="_ _e"> </span>ones <span class="_ _53"> </span>passed <span class="_ _53"> </span>to <span class="_ _e"> </span>the<span class="_ _4b"> </span><span class="ff1a">main<span class="_ _4b"> </span></span>function <span class="_ _53"> </span>of <span class="_ _e"> </span>the</span></span></div><div class="t m0 x32 h2b y130 ff19 fsf fc0 sc0 ls0 ws0">program. <span class="_ _45"> </span>The<span class="_ _45"> </span><span class="ff1b">options<span class="_ _45"> </span></span>argument <span class="_ _9"></span>is <span class="_ _23"></span>a <span class="_ _9"></span>string <span class="_ _23"></span>containing <span class="_ _9"></span>the <span class="_ _23"></span>option <span class="_ _9"></span>characters <span class="_ _23"></span>supported</div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">by the <span class="_ _2"></span>command.<span class="_ _61"> </span>If an <span class="_ _2"></span>option <span class="_ _2"></span>character <span class="_ _2"></span>is followed <span class="_ _2"></span>by <span class="_ _2"></span>a <span class="_ _2"></span>colon, then <span class="_ _2"></span>the <span class="_ _2"></span>option <span class="_ _2"></span>takes <span class="_ _2"></span>an</div><div class="t m0 x32 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">argument. <span class="_ _45"> </span>Otherwise,<span class="_ _35"> </span>the <span class="_ _23"> </span>option <span class="_ _23"> </span>exists <span class="_ _23"> </span>by <span class="_ _23"> </span>itself.<span class="_ _51"> </span>For <span class="_ _23"> </span>example, <span class="_ _23"> </span>if <span class="_ _23"> </span>the <span class="_ _23"> </span>usage <span class="_ _23"> </span>statement</div><div class="t m0 x32 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">for a command was</div><div class="t m0 x3f h57 y4e07 ff1a fs2d fc0 sc0 ls0 ws0">command [-i] [-u username] [-z] filename</div><div class="t m0 x32 h26 y4e08 ff19 fsf fc0 sc0 ls0 ws0">we would pass<span class="_"> </span><span class="ff1a">&quot;iu:z&quot;<span class="_ _80"> </span></span>as the<span class="_"> </span><span class="ff1b">options<span class="_"> </span></span>string to<span class="_"> </span><span class="ff1a">getopt</span>.</div><div class="t m0 x3f h26 y4e09 ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _4b"> </span><span class="ff1a">getopt<span class="_ _4b"> </span></span>function <span class="_"> </span>is <span class="_ _53"> </span>normally <span class="_ _e"> </span>used <span class="_ _e"> </span>in <span class="_ _e"> </span>a <span class="_ _e"> </span>loop <span class="_ _e"> </span>that <span class="_ _e"> </span>terminates <span class="_ _e"> </span>when<span class="_ _59"> </span><span class="ff1a">getopt</span></div><div class="t m0 x32 h26 y4e0a ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">turns<span class="_ _46"> </span><span class="ff20">−</span>1. <span class="_ _46"> </span>During<span class="_ _46"> </span>each <span class="_ _66"> </span>iteration <span class="_"> </span>of <span class="_"> </span>the <span class="_ _66"> </span>loop,<span class="_ _46"> </span><span class="ff1a">getopt<span class="_ _46"> </span></span>will <span class="_"> </span>return <span class="_"> </span>the <span class="_"> </span>next <span class="_"> </span>option</span></div><div class="t m0 x32 h2a y4e0b ff19 fsf fc0 sc0 ls0 ws0">processed. <span class="_ _4b"> </span>It<span class="_ _46"> </span>is <span class="_"> </span>up <span class="_"> </span>to <span class="_ _e"> </span>the <span class="_"> </span>application <span class="_"> </span>to <span class="_ _e"> </span>sort <span class="_"> </span>out <span class="_"> </span>any <span class="_"> </span>conﬂict <span class="_ _e"> </span>in <span class="_"> </span>options, <span class="_"> </span>however;</div><div class="t m0 x32 h26 y4e0c ff1a fsf fc0 sc0 ls0 ws0">getopt<span class="_ _80"> </span><span class="ff19">simply parses the options and enforces a standar<span class="ls44">df<span class="_ _4f"></span><span class="ls0">ormat.</span></span></span></div><div class="t m0 x3f h26 y253b ff19 fsf fc0 sc0 ls0 ws0">When <span class="_ _9"></span>it <span class="_ _23"></span>encounters <span class="_ _9"></span>an <span class="_ _23"></span>invalid <span class="_ _9"></span>option,<span class="_ _45"> </span><span class="ff1a">getopt<span class="_ _35"> </span></span><span class="ls45">re</span>turns <span class="_ _9"></span>a <span class="_ _23"></span>question <span class="_ _9"></span>mark <span class="_ _23"></span>instead <span class="_ _9"></span>of</div><div class="t m0 x32 h26 y253c ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _23"> </span>character<span class="_ _1"></span><span class="ls140a">.I<span class="_ _7"></span><span class="ls0">f<span class="_ _35"> </span>an<span class="_ _35"> </span>option’s <span class="_ _23"> </span>argument <span class="_ _23"></span>is <span class="_ _23"> </span>missing,<span class="_ _35"> </span><span class="ff1a">getopt<span class="_ _35"> </span></span>will <span class="_ _23"> </span>also <span class="_ _23"> </span>return <span class="_ _23"> </span>a <span class="_ _23"> </span>question</span></span></div><div class="t m0 x32 h26 y253d ff19 fsf fc0 sc0 ls0 ws0">mark, <span class="_ _9"></span>but <span class="_ _9"></span>if <span class="_ _9"></span>the <span class="_ _9"></span>ﬁrst <span class="_ _9"></span>character <span class="_ _9"></span>in <span class="_ _9"></span>the <span class="_ _23"></span>options <span class="_ _3"></span>string <span class="_ _23"></span>is <span class="_ _9"></span>a <span class="_ _9"></span>colon,<span class="_ _45"> </span><span class="ff1a">getopt<span class="_ _45"> </span></span><span class="ls45">re</span>turns <span class="_ _9"></span>a <span class="_ _9"></span>colon</div><div class="t m0 x32 h26 y253e ff19 fsf fc0 sc0 ls0 ws0">instead. <span class="_ _59"> </span>The<span class="_ _46"> </span>special <span class="_"> </span>pattern<span class="_ _59"> </span><span class="ff1a">--<span class="_ _46"> </span></span>will <span class="_"> </span>cause<span class="_ _59"> </span><span class="ff1a">getopt<span class="_ _59"> </span></span>to <span class="_"> </span>stop <span class="_"> </span>processing <span class="_"> </span>options <span class="_"> </span>and</div><div class="t m0 x32 h2a y253f ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">turn<span class="_ _35"> </span><span class="ff20">−</span>1. <span class="_ _44"> </span>This<span class="_ _35"> </span>allows <span class="_ _23"> </span>users <span class="_ _42"> </span>to <span class="_ _23"> </span>provide <span class="_ _23"> </span>command <span class="_ _42"> </span>arguments <span class="_ _23"></span>that <span class="_ _23"> </span>start <span class="_ _42"> </span>with <span class="_ _23"> </span>a <span class="_ _42"> </span>minus</span></div><div class="t m0 x32 h26 y2540 ff19 fsf fc0 sc0 ls0 ws0">sign <span class="_ _3"></span>but <span class="_ _3"></span>aren’t <span class="_ _2"></span>options.<span class="_ _16"> </span>For <span class="_ _9"></span>example, <span class="_ _3"></span>if <span class="_ _3"></span>you <span class="_ _3"></span>have <span class="_ _3"></span>a <span class="_ _3"></span>ﬁle <span class="_ _3"></span>named<span class="_ _45"> </span><span class="ff1a">-bar</span><span class="lsa95">,y<span class="_ _8"></span><span class="ls0">ou <span class="_ _3"></span>can’t <span class="_ _3"></span>remove</span></span></div><div class="t m0 x32 h2a y2541 ff19 fsf fc0 sc0 ls0 ws0">it by typing</div><div class="t m0 x3f h57 y4e0d ff1a fs2d fc0 sc0 ls0 ws0">rm -bar</div><div class="t m0 x32 h26 y4e0e ff19 fsf fc0 sc0 ls0 ws0">because<span class="_"> </span><span class="ff1a">rm<span class="_ _80"> </span></span>will try to interpret<span class="_"> </span><span class="ff1a">-bar<span class="_ _80"> </span></span>as options.<span class="_ _46"> </span>The way to remove the ﬁle is to type</div><div class="t m0 x3f h57 y4e0f ff1a fs2d fc0 sc0 ls0 ws0">rm -- -bar</div><div class="t m0 x32 h26 y4e10 ff19 fsf fc0 sc0 ls0 ws0">The<span class="_"> </span><span class="ff1a">getopt<span class="_ _80"> </span></span>function supports four external variables.</div><div class="t m0 x3f h26 y4e11 ff1a fsf fc0 sc0 ls0 ws0">optarg<span class="_ _5c"> </span><span class="ff19">If <span class="_"> </span>an <span class="_"> </span>option <span class="_"> </span>takes <span class="_ _e"> </span>an <span class="_"> </span>ar<span class="_ _0"></span>gument,<span class="_ _59"> </span><span class="ff1a">getopt<span class="_ _59"> </span></span>sets<span class="_ _59"> </span><span class="ff1a">optarg<span class="_ _46"> </span></span>to <span class="_"> </span>point <span class="_ _e"> </span>to <span class="_"> </span>the</span></div><div class="t m0 x1d h2a y4e12 ff19 fsf fc0 sc0 ls0 ws0">option’s argument string when an option is pr<span class="_ _0"></span>ocessed.</div><div class="t m0 x3f h26 y4e13 ff1a fsf fc0 sc0 ls0 ws0">opterr<span class="_ _5c"> </span><span class="ff19">If <span class="_ _9"></span>an <span class="_ _3"></span>option <span class="_ _9"></span>error <span class="_ _2"></span>is <span class="_ _9"></span>encountered,<span class="_ _47"> </span></span>getopt<span class="_ _47"> </span><span class="ff19">will <span class="_ _3"></span>print <span class="_ _9"></span>an <span class="_ _3"></span>error <span class="_ _3"></span>message <span class="_ _3"></span>by</span></div><div class="t m0 x1d h26 y4e14 ff19 fsf fc0 sc0 ls0 ws0">default. <span class="_"> </span>T<span class="_ _6"></span><span class="ls44">od<span class="_ _d"></span><span class="ls0">isable this behavior<span class="_ _1"></span><span class="ls44">,a<span class="_ _d"></span><span class="ls0">pplications can set<span class="_"> </span><span class="ff1a">opterr<span class="_ _66"> </span></span>to 0.</span></span></span></span></div><div class="t m0 x3f h26 y4e15 ff1a fsf fc0 sc0 ls0 ws0">optind<span class="_ _5c"> </span><span class="ff19">The <span class="_ _2"></span>index <span class="_ _2"></span>in <span class="_ _2"></span>the<span class="_ _47"> </span></span>argv<span class="_ _66"> </span><span class="ff19">array <span class="_ _2"></span>of <span class="_ _2"></span>the <span class="_ _2"></span>next <span class="_ _2"></span>string <span class="_ _2"></span>to <span class="_ _2"></span>be <span class="_ _2"></span>processed. <span class="_"> </span>It<span class="_ _47"> </span>starts at</span></div><div class="t m0 x1d h26 y4e16 ff19 fsf fc0 sc0 ls44 ws0">1a<span class="_ _d"></span><span class="ls0">nd is incremented for each argument pr<span class="_ _1"></span>ocessed by<span class="_"> </span><span class="ff1a">getopt</span>.</span></div><div class="t m0 x3f h26 y4e17 ff1a fsf fc0 sc0 ls0 ws0">optopt<span class="_ _5c"> </span><span class="ff19">If <span class="_"> </span>an <span class="_ _e"> </span>error <span class="_ _53"> </span>is <span class="_"> </span>encounter<span class="_ _0"></span>ed <span class="_ _e"> </span>during <span class="_"> </span>options <span class="_ _53"> </span>processing,<span class="_ _59"> </span><span class="ff1a">getopt<span class="_ _4b"> </span></span>will <span class="_"> </span>set</span></div><div class="t m0 x1d h26 y4e18 ff1a fsf fc0 sc0 ls0 ws0">optopt<span class="_ _80"> </span><span class="ff19">to point to the option string that caused the error<span class="_ _6"></span>.</span></div><div class="t m0 x3f h26 y4e19 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _35"> </span>open <span class="_ _35"> </span>server<span class="_ _9"></span>’s<span class="_ _51"> </span><span class="ff1a">main<span class="_ _54"> </span></span>function <span class="_ _35"> </span>(Figur<span class="ls1380">e1<span class="_ _52"></span><span class="ls0">7.28) <span class="_ _35"> </span>deﬁnes <span class="_ _44"> </span>the <span class="_ _35"> </span>global <span class="_ _35"> </span>variables,</span></span></div><div class="t m0 x32 h2a y4e1a ff19 fsf fc0 sc0 ls0 ws0">processes <span class="_ _53"> </span>the <span class="_ _53"> </span>command</div><div class="t m0 x18 h2a y4e1b ff19 fsf fc0 sc0 ls0 ws0">-</div><div class="t m0 xa6 h26 y4e1a ff19 fsf fc0 sc0 ls0 ws0">line <span class="_ _53"> </span>options, <span class="_ _e"> </span>and <span class="_ _e"> </span>calls <span class="_ _e"> </span>the <span class="_ _53"> </span>function<span class="_ _59"> </span><span class="ff1a">loop</span><span class="ls140b">.I<span class="_ _64"></span><span class="ls0">f<span class="_ _4b"> </span>we<span class="_ _4b"> </span>invoke <span class="_ _e"> </span>the</span></span></div><div class="t m0 x32 h26 y4e1c ff19 fsf fc0 sc0 ls0 ws0">server <span class="_ _23"> </span>with <span class="_ _23"> </span>the<span class="_ _35"> </span><span class="ff1a">-d<span class="_ _35"> </span></span>option, <span class="_ _42"> </span>the <span class="_ _23"> </span>server <span class="_ _23"> </span>runs <span class="_ _42"> </span>interactively <span class="_ _23"></span>instead <span class="_ _23"> </span>of <span class="_ _23"> </span>as <span class="_ _42"> </span>a <span class="_ _23"> </span>daemon.<span class="_ _51"> </span>This</div><div class="t m0 x32 h2a y4e1d ff19 fsf fc0 sc0 ls0 ws0">option is used when testing the server<span class="_ _6"></span>.</div><div class="t m0 x32 h4e y4e1e ff1a fs28 fc0 sc0 ls0 ws0">#include <span class="_ _68"> </span>&quot;opend.h&quot;</div><div class="t m0 x32 h4e y4e1f ff1a fs28 fc0 sc0 ls0 ws0">#include <span class="_ _68"> </span>&lt;syslog.h&gt;</div><div class="t m0 x32 h4e y4e20 ff1a fs28 fc0 sc0 ls0 ws0">int <span class="_ _8a"> </span>debug,<span class="_"> </span>oflag, client_size, log_to_stderr;</div><div class="t m0 x32 h4e y4e21 ff1a fs28 fc0 sc0 ls0 ws0">char <span class="_ _15"> </span>errmsg[MAXLINE];</div><div class="t m0 x32 h4e y4e22 ff1a fs28 fc0 sc0 ls0 ws0">char <span class="_ _68"> </span>*pathname;</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
