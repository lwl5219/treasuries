<div id="pf34e" class="pf w4 h1f" data-page-no="34e"><div class="pc pc34e w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg34e.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">812<span class="_ _1b"> </span><span class="ff19">Communicating <span class="_"> </span>with <span class="_"> </span>a <span class="_"> </span>Network <span class="_"> </span>Printer<span class="_ _23b"> </span>Chapter <span class="_"> </span>21</span></div><div class="t m0 x140 h57 y362 ff1a fs2d fc0 sc0 lsa73 ws0">1/<span class="_ _244"></span><span class="ls0">*</span></div><div class="t m0 x140 h57 y3c0 ff1a fs2d fc0 sc0 lsa74 ws0">2*<span class="_ _244"></span><span class="ls0">Print server daemon.</span></div><div class="t m0 x140 h57 y845 ff1a fs2d fc0 sc0 lsa74 ws0">3*<span class="_ _19"></span><span class="ls0">/</span></div><div class="t m0 x140 h57 y56c4 ff1a fs2d fc0 sc0 lsa73 ws0">4#<span class="_ _244"></span><span class="ls0">include &quot;apue.h&quot;</span></div><div class="t m0 x140 h57 y56c5 ff1a fs2d fc0 sc0 lsa73 ws0">5#<span class="_ _244"></span><span class="ls0">include &lt;fcntl.h&gt;</span></div><div class="t m0 x140 h57 y56c6 ff1a fs2d fc0 sc0 lsa73 ws0">6#<span class="_ _244"></span><span class="ls0">include &lt;dirent.h&gt;</span></div><div class="t m0 x140 h57 y56c7 ff1a fs2d fc0 sc0 lsa73 ws0">7#<span class="_ _244"></span><span class="ls0">include &lt;ctype.h&gt;</span></div><div class="t m0 x140 h57 y56c8 ff1a fs2d fc0 sc0 lsa73 ws0">8#<span class="_ _244"></span><span class="ls0">include &lt;pwd.h&gt;</span></div><div class="t m0 x140 h57 y56c9 ff1a fs2d fc0 sc0 lsa73 ws0">9#<span class="_ _244"></span><span class="ls0">include &lt;pthread.h&gt;</span></div><div class="t m0 x32 h57 y56ca ff1a fs2d fc0 sc0 ls0 ws0">10 <span class="_ _d9"> </span>#include<span class="_"> </span>&lt;strings.h&gt;</div><div class="t m0 x32 h57 y56cb ff1a fs2d fc0 sc0 ls0 ws0">11 <span class="_ _d9"> </span>#include<span class="_"> </span>&lt;sys/select.h&gt;</div><div class="t m0 x32 h57 y56cc ff1a fs2d fc0 sc0 ls0 ws0">12 <span class="_ _d9"> </span>#include<span class="_"> </span>&lt;sys/uio.h&gt;</div><div class="t m0 x32 h57 y5712 ff1a fs2d fc0 sc0 ls0 ws0">13 <span class="_ _d9"> </span>#include<span class="_"> </span>&quot;print.h&quot;</div><div class="t m0 x32 h57 y5713 ff1a fs2d fc0 sc0 ls0 ws0">14 <span class="_ _d9"> </span>#include<span class="_"> </span>&quot;ipp.h&quot;</div><div class="t m0 x32 h57 y2c5d ff1a fs2d fc0 sc0 ls0 ws0">15 <span class="_ _d9"> </span>/*</div><div class="t m0 x32 h57 y2c5e ff1a fs2d fc0 sc0 ls0 ws0">16 <span class="_ _68"> </span>*<span class="_"> </span>These are for the HTTP response from the printer.</div><div class="t m0 x32 h57 y2c5f ff1a fs2d fc0 sc0 ls0 ws0">17 <span class="_ _68"> </span>*/</div><div class="t m0 x32 h57 y2c60 ff1a fs2d fc0 sc0 ls0 ws0">18 <span class="_ _d9"> </span>#define<span class="_"> </span>HTTP_INFO(x) <span class="_ _3a"> </span>((x)<span class="_"> </span>&gt;= 100 &amp;&amp; (x) &lt;= 199)</div><div class="t m0 x32 h57 y2c61 ff1a fs2d fc0 sc0 ls0 ws0">19 <span class="_ _d9"> </span>#define<span class="_"> </span>HTTP_SUCCESS(x) ((x) &gt;= 200 &amp;&amp; (x) &lt;= 299)</div><div class="t m0 x32 h57 y33b5 ff1a fs2d fc0 sc0 ls0 ws0">20 <span class="_ _d9"> </span>/*</div><div class="t m0 x32 h57 y2c63 ff1a fs2d fc0 sc0 ls0 ws0">21 <span class="_ _68"> </span>*<span class="_"> </span>Describes a print job.</div><div class="t m0 x32 h57 y33b6 ff1a fs2d fc0 sc0 ls0 ws0">22 <span class="_ _68"> </span>*/</div><div class="t m0 x32 h57 y33b7 ff1a fs2d fc0 sc0 ls0 ws0">23 <span class="_ _d9"> </span>struct<span class="_"> </span>job {</div><div class="t m0 x32 h57 y33b8 ff1a fs2d fc0 sc0 ls0 ws0">24 <span class="_ _8a"> </span>struct<span class="_"> </span>job <span class="_ _8a"> </span>*next; <span class="_ _8a"> </span>/*<span class="_"> </span>next in list */</div><div class="t m0 x32 h57 y33b9 ff1a fs2d fc0 sc0 ls0 ws0">25 <span class="_ _8a"> </span>struct<span class="_"> </span>job <span class="_ _8a"> </span>*prev; <span class="_ _8a"> </span>/*<span class="_"> </span>previous in list */</div><div class="t m0 x32 h57 y33ba ff1a fs2d fc0 sc0 ls0 ws0">26 <span class="_ _8a"> </span>int32_t<span class="_ _74"> </span>jobid; <span class="_ _15"> </span>/*<span class="_"> </span>job ID */</div><div class="t m0 x32 h57 y33bb ff1a fs2d fc0 sc0 ls0 ws0">27 <span class="_ _8a"> </span>struct<span class="_"> </span>printreq <span class="_"> </span>req;<span class="_ _b7"> </span>/* copy of print request */</div><div class="t m0 x32 h57 y33bc ff1a fs2d fc0 sc0 ls0 ws0">28 <span class="_ _d9"> </span>};</div><div class="t m0 x32 h57 y3b51 ff1a fs2d fc0 sc0 ls0 ws0">29 <span class="_ _d9"> </span>/*</div><div class="t m0 x32 h57 y5b61 ff1a fs2d fc0 sc0 ls0 ws0">30 <span class="_ _68"> </span>*<span class="_"> </span>Describes a thread processing a client request.</div><div class="t m0 x32 h57 y5b62 ff1a fs2d fc0 sc0 ls0 ws0">31 <span class="_ _68"> </span>*/</div><div class="t m0 x32 h57 y5b63 ff1a fs2d fc0 sc0 ls0 ws0">32 <span class="_ _d9"> </span>struct<span class="_"> </span>worker_thread {</div><div class="t m0 x32 h57 y5b64 ff1a fs2d fc0 sc0 ls0 ws0">33 <span class="_ _8a"> </span>struct<span class="_"> </span>worker_thread <span class="_"> </span>*next;<span class="_ _15"> </span>/* next in list */</div><div class="t m0 x32 h57 y41a3 ff1a fs2d fc0 sc0 ls0 ws0">34 <span class="_ _8a"> </span>struct<span class="_"> </span>worker_thread <span class="_"> </span>*prev;<span class="_ _15"> </span>/* previous in list */</div><div class="t m0 x32 h57 y41a4 ff1a fs2d fc0 sc0 ls0 ws0">35 <span class="_ _8a"> </span>pthread_t<span class="_ _12d"> </span>tid; <span class="_ _15"> </span>/*<span class="_"> </span>thread ID */</div><div class="t m0 x32 h57 y41a5 ff1a fs2d fc0 sc0 ls0 ws0">36 <span class="_ _8a"> </span>int<span class="_ _296"> </span>sockfd; <span class="_"> </span>/*<span class="_"> </span>socket */</div><div class="t m0 x32 h57 y41a6 ff1a fs2d fc0 sc0 ls0 ws0">37 <span class="_ _d9"> </span>};</div><div class="t m0 x32 h49 y5b65 ff19 fs26 fc0 sc0 ls0 ws0">[1 <span class="_ _a"></span>– <span class="_ _a"></span>19]<span class="_ _288"> </span>The <span class="_ _9"></span>printer <span class="_ _9"></span>spooling <span class="_ _9"></span>daemon <span class="_ _9"></span>includes <span class="_ _3"></span>the <span class="_ _9"></span>IPP <span class="_ _9"></span>header <span class="_ _9"></span>ﬁle <span class="_ _9"></span>that <span class="_ _3"></span>we <span class="_ _9"></span>saw <span class="_ _9"></span>earlier<span class="_ _1"></span>,</div><div class="t m0 x2d h49 y5b66 ff19 fs26 fc0 sc0 ls0 ws0">because <span class="_ _35"> </span>the <span class="_ _44"> </span>daemon <span class="_ _44"> </span>needs <span class="_ _35"> </span>to <span class="_ _44"> </span>communicate <span class="_ _44"> </span>with <span class="_ _35"> </span>the <span class="_ _44"> </span>printer <span class="_ _44"> </span>using <span class="_ _35"> </span>this</div><div class="t m0 x2d h4d y5b67 ff19 fs26 fc0 sc0 ls0 ws0">protocol. <span class="_"> </span>The<span class="_"> </span><span class="ff1a">HTTP_INFO<span class="_ _66"> </span></span>and<span class="_ _66"> </span><span class="ff1a">HTTP_SUCCESS<span class="_ _66"> </span></span>macros deﬁne <span class="_ _2"></span>the <span class="_ _2"></span>status of <span class="_ _2"></span>the</div><div class="t m0 x2d h49 y5b68 ff19 fs26 fc0 sc0 ls0 ws0">HTTP <span class="_ _2"></span>request <span class="_ _2"></span>(recall <span class="_ _2"></span>that <span class="_ _2"></span>IPP <span class="_ _3"></span>is <span class="_ _2"></span>built <span class="_ _3"></span>on <span class="_ _2"></span>top <span class="_ _3"></span>of <span class="_ _2"></span>HTTP).<span class="_ _61"> </span>Section <span class="_ _3"></span>10 <span class="_ _2"></span>in <span class="_ _3"></span>RFC <span class="_ _2"></span>2616</div><div class="t m0 x2d h49 y5b69 ff19 fs26 fc0 sc0 ls0 ws0">deﬁnes the HTTP status codes.</div><div class="t m0 x32 h4d y5b6a ff19 fs26 fc0 sc0 ls0 ws0">[20 <span class="_ _a"></span>– <span class="_ _a"></span>37]<span class="_ _65"> </span>The<span class="_ _47"> </span><span class="ff1a">job<span class="_ _47"> </span></span>and<span class="_ _47"> </span><span class="ff1a">worker_thread<span class="_ _45"> </span></span>structur<span class="_ _1"></span>es <span class="_ _3"></span>ar<span class="ls160">eu<span class="_ _8"></span><span class="ls0">sed <span class="_ _3"></span>by <span class="_ _3"></span>the <span class="_ _3"></span>spooling <span class="_ _9"></span>daemon <span class="_ _3"></span>to</span></span></div><div class="t m0 x2d h49 y5b6b ff19 fs26 fc0 sc0 ls0 ws0">keep track of print jobs and threads accepting print r<span class="_ _0"></span>equests, r<span class="_ _0"></span>espectively<span class="_ _4"></span>.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
