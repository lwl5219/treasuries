<div id="pf6e" class="pf w4 h1f" data-page-no="6e"><div class="pc pc6e w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg6e.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">76<span class="_ _1b"> </span><span class="ff19">File <span class="_"> </span>I/O<span class="_ _169"> </span>Chapter <span class="_"> </span>3</span></div><div class="t m0 x76 h51 y2a3 ff19 fs2a fc0 sc0 ls0 ws0">The <span class="_ _80"> </span>v-node <span class="_ _e"> </span>was <span class="_ _80"> </span>invented <span class="_ _80"> </span>to <span class="_ _80"> </span>provide <span class="_ _80"> </span>support <span class="_ _e"> </span>for <span class="_ _80"> </span>multiple <span class="_ _80"> </span>ﬁle <span class="_ _80"> </span>system <span class="_ _80"> </span>types <span class="_ _80"> </span>on <span class="_ _80"> </span>a <span class="_ _80"> </span>single</div><div class="t m0 x76 h51 y2a4 ff19 fs2a fc0 sc0 ls0 ws0">computer system.<span class="_ _4b"> </span>This work <span class="_ _2"></span>was <span class="_ _2"></span>done <span class="_ _2"></span>independently <span class="_ _2"></span>by Peter <span class="_ _2"></span>W<span class="_ _1"></span>einberger (Bell <span class="_ _2"></span>Laboratories)</div><div class="t m0 x76 h51 y2a5 ff19 fs2a fc0 sc0 ls0 ws0">and <span class="_ _23"> </span>Bill <span class="_ _23"> </span>Joy <span class="_ _23"> </span>(Sun <span class="_ _23"> </span>Microsystems). <span class="_ _45"> </span>Sun<span class="_ _47"> </span>called <span class="_ _42"> </span>this <span class="_ _23"> </span>the <span class="_ _23"> </span>V<span class="_ _1"></span>irtual <span class="_ _42"> </span>File <span class="_ _23"> </span>System <span class="_ _23"> </span>and <span class="_ _23"> </span>called <span class="_ _23"> </span>the <span class="_ _23"> </span>ﬁle</div><div class="t m0 x76 h51 y2a6 ff19 fs2a fc0 sc0 ls0 ws0">system–independent portion <span class="_ _2"></span>of <span class="_ _2"></span>the <span class="_ _2"></span>i-node <span class="_ _2"></span>the <span class="_ _2"></span>v-node</div><div class="t m0 xa2 h51 ybf2 ff19 fs2a fc0 sc0 ls0 ws0">[</div><div class="t m0 x104 h51 y2a6 ff19 fs2a fc0 sc0 ls0 ws0">Kleiman 1986</div><div class="t m0 x119 h51 ybf2 ff19 fs2a fc0 sc0 ls0 ws0">]</div><div class="t m0 x16c h51 y2a6 ff19 fs2a fc0 sc0 ls3d3 ws0">.T<span class="_ _c"></span><span class="ls0">he <span class="_ _2"></span>v-node <span class="_ _2"></span>propagated</span></div><div class="t m0 x76 h51 y2a7 ff19 fs2a fc0 sc0 ls0 ws0">through various vendor <span class="_ _2"></span>implementations as <span class="_ _2"></span>support for <span class="_ _2"></span>Sun’s <span class="_ _2"></span>Network File <span class="_ _2"></span>System</div><div class="t m0 x16d h51 ybf3 ff19 fs2a fc0 sc0 ls0 ws0">(</div><div class="t m0 x4f h51 y2a7 ff19 fs2a fc0 sc0 ls0 ws0">NFS</div><div class="t m0 x162 h51 ybf3 ff19 fs2a fc0 sc0 ls0 ws0">)</div><div class="t m0 x55 h51 y2a7 ff19 fs2a fc0 sc0 ls0 ws0">was</div><div class="t m0 x76 h51 y2a8 ff19 fs2a fc0 sc0 ls0 ws0">added. <span class="_ _e"> </span>The<span class="_ _80"> </span>ﬁrst <span class="_ _2"></span>release <span class="_ _2"></span>from <span class="_ _2"></span>Berkeley <span class="_ _2"></span>to <span class="_ _2"></span>provide <span class="_ _2"></span>v-nodes <span class="_ _2"></span>was <span class="_ _2"></span>the <span class="_ _2"></span>4.3BSD <span class="_ _2"></span>Reno <span class="_ _2"></span>release, <span class="_ _2"></span>when</div><div class="t m0 x76 h51 y2a9 ff19 fs2a fc0 sc0 ls0 ws0">NFS was added.</div><div class="t m0 x76 h51 ybf4 ff19 fs2a fc0 sc0 ls0 ws0">In <span class="_ _3"></span>SVR4, <span class="_ _9"></span>the <span class="_ _3"></span>v-node <span class="_ _9"></span>replaced <span class="_ _3"></span>the <span class="_ _9"></span>ﬁle <span class="_ _3"></span>system–independent <span class="_ _9"></span>i-node <span class="_ _3"></span>of <span class="_ _9"></span>SVR3.<span class="_ _59"> </span>Solaris <span class="_ _3"></span>is <span class="_ _9"></span>derived</div><div class="t m0 x76 h51 ybf5 ff19 fs2a fc0 sc0 ls0 ws0">from SVR4 and, ther<span class="_ _0"></span>efore, uses v-nodes.</div><div class="t m0 x76 h51 ybf6 ff19 fs2a fc0 sc0 ls0 ws0">Instead <span class="_ _66"> </span>of <span class="_ _66"> </span>splitting <span class="_ _66"> </span>the <span class="_ _66"> </span>data <span class="_ _47"> </span>structur<span class="_ _0"></span>es <span class="_ _66"> </span>into <span class="_ _66"> </span>a <span class="_ _66"> </span>v-node <span class="_ _66"> </span>and <span class="_ _47"> </span>an <span class="_ _66"> </span>i-node, <span class="_ _66"> </span>Linux <span class="_ _66"> </span>uses <span class="_ _66"> </span>a <span class="_ _66"> </span>ﬁle</div><div class="t m0 x76 h51 ybf7 ff19 fs2a fc0 sc0 ls0 ws0">system–independent i-node and a ﬁle system–dependent i-node.</div><div class="t m0 x3f h2a ybf8 ff19 fsf fc0 sc0 ls0 ws0">If <span class="_ _44"> </span>two <span class="_ _44"> </span>independent <span class="_ _44"> </span>processes <span class="_ _44"> </span>have <span class="_ _44"> </span>the <span class="_ _44"> </span>same <span class="_ _44"> </span>ﬁle <span class="_ _44"> </span>open, <span class="_ _4b"> </span>we <span class="_ _44"> </span>could <span class="_ _44"> </span>have <span class="_ _44"> </span>the</div><div class="t m0 x32 h2a ybf9 ff19 fsf fc0 sc0 ls0 ws0">arrangement shown in Figur<span class="ls44">e3<span class="_ _4f"></span><span class="ls0">.8.</span></span></div><div class="t m0 x8a h2d ybfa ff19 fs10 fc0 sc0 ls0 ws0">process table entry</div><div class="t m0 x139 h80 ybfb ff19 fs3e fc0 sc0 ls3cf ws0">...</div><div class="t m0 x3f h81 ybfc ff19 fs3f fc0 sc0 ls0 ws0">fd 0:</div><div class="t m0 x3f h81 ybfd ff19 fs3f fc0 sc0 ls0 ws0">fd 1:</div><div class="t m0 x3f h81 ybfe ff19 fs3f fc0 sc0 ls0 ws0">fd 2:</div><div class="t m0 x3f h81 ybff ff19 fs3f fc0 sc0 ls0 ws0">fd 3:</div><div class="t m0 x167 h82 yc00 ff19 fs40 fc0 sc0 ls0 ws0">fd</div><div class="t m0 x135 h82 yc01 ff19 fs40 fc0 sc0 ls0 ws0">ﬂags</div><div class="t m0 x137 h82 yc00 ff19 fs40 fc0 sc0 ls0 ws0">ﬁle</div><div class="t m0 x159 h82 yc01 ff19 fs40 fc0 sc0 ls0 ws0">pointer</div><div class="t m0 x8a h30 yc02 ff19 fs13 fc0 sc0 ls0 ws0">process table entry</div><div class="t m0 x139 h8a yc03 ff19 fs45 fc0 sc0 ls3d4 ws0">...</div><div class="t m0 x3f h8b yc04 ff19 fs46 fc0 sc0 ls0 ws0">fd 0:</div><div class="t m0 x3f h8b yc05 ff19 fs46 fc0 sc0 ls0 ws0">fd 1:</div><div class="t m0 x3f h8b yc06 ff19 fs46 fc0 sc0 ls0 ws0">fd 2:</div><div class="t m0 x3f h8b yc07 ff19 fs46 fc0 sc0 ls0 ws0">fd 3:</div><div class="t m0 x3f h8b yc08 ff19 fs46 fc0 sc0 ls0 ws0">fd 4:</div><div class="t m0 x167 h7f yc09 ff19 fs3d fc0 sc0 ls0 ws0">fd</div><div class="t m0 x135 h7f yc0a ff19 fs3d fc0 sc0 ls0 ws0">ﬂags</div><div class="t m0 x137 h7f yc09 ff19 fs3d fc0 sc0 ls0 ws0">ﬁle</div><div class="t m0 x159 h7f yc0a ff19 fs3d fc0 sc0 ls0 ws0">pointer</div><div class="t m0 x87 h33 yc0b ff19 fs16 fc0 sc0 ls0 ws0">ﬁle status ﬂags</div><div class="t m0 x17 h83 yc0c ff19 fs36 fc0 sc0 ls0 ws0">current ﬁle of<span class="_ _0"></span>fset</div><div class="t m0 x87 h34 yc0d ff19 fs17 fc0 sc0 ls0 ws0">v-node pointer</div><div class="t m0 x87 h35 yc0e ff19 fs18 fc0 sc0 ls0 ws0">ﬁle status ﬂags</div><div class="t m0 x17 h36 yc0f ff19 fs19 fc0 sc0 ls0 ws0">current ﬁle of<span class="_ _0"></span>fset</div><div class="t m0 x87 h37 yc10 ff19 fs1a fc0 sc0 ls0 ws0">v-node pointer</div><div class="t m0 x87 h37 yc11 ff19 fs1a fc0 sc0 ls0 ws0">ﬁle table entry</div><div class="t m0 x87 h37 yc12 ff19 fs1a fc0 sc0 ls0 ws0">ﬁle table entry</div><div class="t m0 x168 h86 yc13 ff19 fs42 fc0 sc0 ls0 ws0">v-node information</div><div class="t m0 x11f h87 yc14 ff1a fs42 fc0 sc0 ls0 ws0">v_data</div><div class="t m0 x13b h86 yc15 ff19 fs42 fc0 sc0 ls0 ws0">i-node information</div><div class="t m0 xd4 h86 yc16 ff19 fs42 fc0 sc0 ls0 ws0">current ﬁle size</div><div class="t m0 x169 h87 yc17 ff1a fs42 fc0 sc0 ls0 ws0">i_vnode</div><div class="t m0 x16a h88 yc18 ff19 fs43 fc0 sc0 ls0 ws0">v-node table entry</div><div class="t m0 x16b h88 yc19 ff19 fs43 fc0 sc0 ls0 ws0">i-node</div><div class="t m0 xda h3f yc1a ff18 fs21 fc0 sc0 ls0 ws0">Figure 3.8<span class="_ _5a"> </span><span class="ff19 ls3d5">Tw<span class="_ _9"></span><span class="ls3d6">oi<span class="_ _84"></span><span class="ls0">ndependent processes with the same ﬁle open</span></span></span></div><div class="t m0 x32 h89 yc1b ff19 fs44 fc0 sc0 ls3d7 ws0">We <span class="_ _45"> </span>a<span class="_ _23"></span><span class="ls0">ssume <span class="_ _42"> </span>her<span class="ls3d8">et<span class="_ _c"></span><span class="ls0">hat <span class="_ _42"> </span>the <span class="_ _53"> </span>ﬁrst <span class="_ _53"> </span>process <span class="_ _42"> </span>has <span class="_ _53"> </span>the <span class="_ _53"> </span>ﬁle <span class="_ _42"> </span>open <span class="_ _53"> </span>on <span class="_ _53"> </span>descriptor <span class="_ _53"> </span>3 <span class="_ _42"> </span>and <span class="_ _53"> </span>that <span class="_ _53"> </span>the</span></span></span></div><div class="t m0 x32 h89 yc1c ff19 fs44 fc0 sc0 ls0 ws0">second <span class="_ _2"></span>process <span class="_ _2"></span>has <span class="_ _2"></span>that <span class="_ _2"></span>same <span class="_ _3"></span>ﬁle <span class="_ _2"></span>open <span class="_ _3"></span>on <span class="_ _2"></span>descriptor <span class="_ _2"></span>4.<span class="_ _16"> </span>Each <span class="_ _2"></span>process <span class="_ _2"></span>that <span class="_ _2"></span>opens <span class="_ _3"></span>the <span class="_ _2"></span>ﬁle</div><div class="t m0 x32 h89 yc1d ff19 fs44 fc0 sc0 ls0 ws0">gets <span class="_ _3"></span>its <span class="_ _3"></span>own <span class="_ _3"></span>ﬁle <span class="_ _9"></span>table <span class="_ _3"></span>entry<span class="_ _6"></span><span class="ls3d9">,b<span class="_ _b"></span><span class="ls0">ut <span class="_ _9"></span>only <span class="_ _3"></span>a <span class="_ _3"></span>single <span class="_ _3"></span>v-node <span class="_ _9"></span>table <span class="_ _3"></span>entry <span class="_ _3"></span>is <span class="_ _3"></span>required <span class="_ _2"></span>for <span class="_ _9"></span>a <span class="_ _3"></span>given</span></span></div><div class="t m0 x32 h89 yc1e ff19 fs44 fc0 sc0 ls0 ws0">ﬁle. <span class="_ _47"> </span>One<span class="_ _47"> </span><span class="ls3da">re<span class="_ _2"></span></span>ason <span class="_ _3"></span>each <span class="_ _3"></span>process <span class="_ _2"></span>gets <span class="_ _3"></span>its <span class="_ _3"></span>own <span class="_ _3"></span>ﬁle <span class="_ _3"></span>table <span class="_ _3"></span>entry <span class="_ _3"></span>is <span class="_ _3"></span>so <span class="_ _3"></span>that <span class="_ _3"></span>each <span class="_ _3"></span>process <span class="_ _2"></span>has <span class="_ _3"></span>its</div><div class="t m0 x32 h89 yc1f ff19 fs44 fc0 sc0 ls0 ws0">own current of<span class="_ _0"></span>fset for the ﬁle.</div><div class="t m0 x3f h89 yc20 ff19 fs44 fc0 sc0 ls0 ws0">Given <span class="_ _3"></span>these <span class="_ _9"></span>data <span class="_ _9"></span>structur<span class="_ _0"></span>es, <span class="_ _3"></span>we <span class="_ _9"></span>now <span class="_ _9"></span>need <span class="_ _9"></span>to <span class="_ _3"></span>be <span class="_ _9"></span>mor<span class="ls3db">es<span class="_ _b"></span><span class="ls0">peciﬁc <span class="_ _3"></span>about <span class="_ _9"></span>what <span class="_ _9"></span>happens</span></span></div><div class="t m0 x32 h89 yc21 ff19 fs44 fc0 sc0 ls0 ws0">with certain operations that we’ve already described.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
