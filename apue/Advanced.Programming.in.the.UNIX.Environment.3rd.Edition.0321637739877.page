<div id="pf36d" class="pf w4 h1f" data-page-no="36d"><div class="pc pc36d w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg36d.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Chapter <span class="_"> </span>21<span class="_ _183"> </span>Exercises<span class="_ _1fb"> </span><span class="ff18">843</span></div><div class="t m0 x35 h53 y12f ff16 fs2b fc0 sc0 ls0 ws0">21.6 <span class="_ _93"> </span>Summary</div><div class="t m0 x32 h2a y4de ff19 fsf fc0 sc0 ls0 ws0">This <span class="_ _23"> </span>chapter <span class="_ _42"> </span>has <span class="_ _42"> </span>examined <span class="_ _23"> </span>in <span class="_ _42"> </span>detail <span class="_ _23"> </span>two <span class="_ _42"> </span>complete <span class="_ _42"> </span>pr<span class="_ _0"></span>ograms: <span class="_ _23"> </span>a <span class="_ _42"> </span>print <span class="_ _42"> </span>spooler <span class="_ _23"> </span>daemon</div><div class="t m0 x32 h2a y6d0 ff19 fsf fc0 sc0 ls0 ws0">that <span class="_ _2"></span>sends <span class="_ _2"></span>a <span class="_ _2"></span>print <span class="_ _2"></span>job <span class="_ _2"></span>to <span class="_ _3"></span>a <span class="_ _2"></span>network <span class="_ _2"></span>printer <span class="_ _2"></span>and <span class="_ _2"></span>a <span class="_ _2"></span>command <span class="_ _3"></span>that <span class="_ _2"></span>can <span class="_ _2"></span>be <span class="_ _2"></span>used <span class="_ _2"></span>to <span class="_ _3"></span>submit <span class="_ _2"></span>a</div><div class="t m0 x32 h2a y6d1 ff19 fsf fc0 sc0 ls0 ws0">job <span class="_ _53"> </span>to <span class="_ _53"> </span>be <span class="_ _e"> </span>printed <span class="_ _53"> </span>to <span class="_ _e"> </span>the <span class="_ _53"> </span>spooling <span class="_ _53"> </span>daemon.<span class="_ _48"> </span>This <span class="_ _53"> </span>has <span class="_ _53"> </span>given <span class="_ _e"> </span>us <span class="_ _53"> </span>a <span class="_ _e"> </span>chance <span class="_ _53"> </span>to <span class="_ _e"> </span>see <span class="_ _53"> </span>many</div><div class="t m0 x32 h2a y6d2 ff19 fsf fc0 sc0 ls0 ws0">features <span class="_"> </span>that <span class="_"> </span>we <span class="_ _47"> </span>described <span class="_"> </span>in <span class="_ _66"> </span>earlier <span class="_ _66"> </span>chapters <span class="_ _47"> </span>used <span class="_"> </span>in <span class="_ _66"> </span>real <span class="_"> </span>programs: <span class="_"> </span>threads, <span class="_"> </span>I/O</div><div class="t m0 x32 h2a y6d3 ff19 fsf fc0 sc0 ls0 ws0">multiplexing, ﬁle I/O, reading dir<span class="_ _0"></span>ectories, socket I/O, and signals.</div><div class="t m0 x32 h53 y5ce1 ff16 fs2b fc0 sc0 ls0 ws0">Exer<span class="_ _0"></span>cises</div><div class="t m0 x32 h57 y5ce2 ff18 fs2d fc0 sc0 ls0 ws0">21.1<span class="_ _288"> </span><span class="ff19 ls75c">Tr<span class="_ _9"></span><span class="ls0">anslate <span class="_ _3"></span>the <span class="_ _9"></span>IPP <span class="_ _3"></span>error <span class="_ _2"></span>code <span class="_ _9"></span>values <span class="_ _3"></span>listed <span class="_ _3"></span>in<span class="_ _47"> </span><span class="ff1a">ipp.h<span class="_ _66"> </span></span>into <span class="_ _3"></span>error <span class="_ _3"></span>messages.<span class="_ _46"> </span>Then <span class="_ _3"></span>modify <span class="_ _9"></span>the</span></span></div><div class="t m0 xe1 h57 y5ce3 ff19 fs2d fc0 sc0 ls0 ws0">print <span class="_ _2"></span>spooler <span class="_ _2"></span>daemon <span class="_ _2"></span>to <span class="_ _2"></span>log <span class="_ _2"></span>a <span class="_ _2"></span>message <span class="_ _2"></span>at <span class="_ _2"></span>the <span class="_ _2"></span>end <span class="_ _2"></span>of <span class="_ _3"></span>the<span class="_ _80"> </span><span class="ff1a">printer_status<span class="_ _66"> </span></span>function <span class="_ _2"></span>when</div><div class="t m0 xe1 h5f y5ce4 ff19 fs2d fc0 sc0 ls0 ws0">the IPP header indicates a printer error<span class="_ _6"></span>.</div><div class="t m0 x32 h57 y5ce5 ff18 fs2d fc0 sc0 ls0 ws0">21.2<span class="_ _288"> </span><span class="ff19">Add <span class="_ _23"> </span>support <span class="_ _9"></span>to <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">print<span class="_ _45"> </span></span>command <span class="_ _9"></span>and <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">printd<span class="_ _47"> </span></span>daemon <span class="_ _23"></span>to <span class="_ _9"></span>allow <span class="_ _9"></span>users <span class="_ _23"> </span>to <span class="_ _9"></span>request</span></div><div class="t m0 xe1 h5f y5ce6 ff19 fs2d fc0 sc0 ls0 ws0">double-sided printing.<span class="_ _4b"> </span>Do the same for landscape and portrait page orientation.</div><div class="t m0 x32 h5f y5ce7 ff18 fs2d fc0 sc0 ls0 ws0">21.3<span class="_ _288"> </span><span class="ff19">Modify <span class="_ _9"></span>the <span class="_ _9"></span>print <span class="_ _3"></span>spooler <span class="_ _9"></span>daemon <span class="_ _3"></span>so <span class="_ _9"></span>that <span class="_ _9"></span>when <span class="_ _3"></span>it <span class="_ _9"></span>starts, <span class="_ _3"></span>it <span class="_ _9"></span>contacts <span class="_ _3"></span>the <span class="_ _9"></span>printer <span class="_ _9"></span>to <span class="_ _3"></span>ﬁnd <span class="_ _9"></span>out</span></div><div class="t m0 xe1 h5f y5ce8 ff19 fs2d fc0 sc0 ls0 ws0">which <span class="_ _3"></span>features <span class="_ _2"></span>ar<span class="ls17e3">es<span class="_ _4f"></span><span class="ls0">upported <span class="_ _3"></span>by <span class="_ _3"></span>the <span class="_ _3"></span>printer <span class="_ _3"></span>so <span class="_ _3"></span>that <span class="_ _3"></span>the <span class="_ _3"></span>daemon <span class="_ _3"></span>doesn’t <span class="_ _3"></span>request <span class="_ _3"></span>an <span class="_ _3"></span>option</span></span></div><div class="t m0 xe1 h5f y5ce9 ff19 fs2d fc0 sc0 ls0 ws0">that isn’t supported.</div><div class="t m0 x32 h5f y5cea ff18 fs2d fc0 sc0 ls0 ws0">21.4<span class="_ _288"> </span><span class="ff19 ls467">Wr<span class="_ _9"></span><span class="ls0">ite a command to report on the status of pending print jobs.</span></span></div><div class="t m0 x32 h5f y5ceb ff18 fs2d fc0 sc0 ls0 ws0">21.5<span class="_ _288"> </span><span class="ff19 ls467">Wr<span class="_ _9"></span><span class="ls0">ite <span class="_ _23"> </span>a <span class="_ _23"> </span>command <span class="_ _42"> </span>to <span class="_ _23"> </span>cancel <span class="_ _23"> </span>a <span class="_ _23"> </span>pending <span class="_ _42"> </span>print <span class="_ _23"> </span>job.<span class="_ _5a"> </span>Use <span class="_ _23"> </span>the <span class="_ _23"> </span>job <span class="_ _23"> </span>ID <span class="_ _42"> </span>as <span class="_ _23"> </span>the <span class="_ _23"> </span>argument <span class="_ _23"> </span>to <span class="_ _23"> </span>the</span></span></div><div class="t m0 xe1 h5f y5cec ff19 fs2d fc0 sc0 ls0 ws0">command <span class="_ _9"></span>to <span class="_ _9"></span>specify <span class="_ _23"> </span>which <span class="_ _9"></span>job <span class="_ _9"></span>to <span class="_ _23"></span>cancel.<span class="_ _61"> </span>How <span class="_ _9"></span>can <span class="_ _23"></span>you <span class="_ _9"></span>prevent <span class="_ _9"></span>one <span class="_ _9"></span>user <span class="_ _9"></span>from <span class="_ _9"></span>canceling</div><div class="t m0 xe1 h5f y5ced ff19 fs2d fc0 sc0 ls0 ws0">another user<span class="_ _3"></span>’s print jobs?</div><div class="t m0 x32 h5f y5cee ff18 fs2d fc0 sc0 ls0 ws0">21.6<span class="_ _288"> </span><span class="ff19">Add <span class="_ _2"></span>support <span class="_ _2"></span>for <span class="_ _2"></span>multiple <span class="_ _2"></span>printers <span class="_ _2"></span>to <span class="_ _2"></span>the <span class="_ _2"></span>printer <span class="_ _2"></span>spooler<span class="_ _1"></span><span class="ls17e4">.I<span class="_ _55"></span><span class="ls0">nclude a <span class="_ _2"></span>way <span class="_ _2"></span>to <span class="_ _2"></span>move <span class="_ _2"></span>print <span class="_ _2"></span>jobs</span></span></span></div><div class="t m0 xe1 h5f y5cef ff19 fs2d fc0 sc0 ls0 ws0">from one printer to another<span class="_ _6"></span>.</div><div class="t m0 x32 h5f y5cf0 ff18 fs2d fc0 sc0 ls0 ws0">21.7<span class="_ _288"> </span><span class="ff19">In <span class="_ _23"> </span>the <span class="_ _42"> </span>printer <span class="_ _23"> </span>daemon, <span class="_ _23"> </span>explain <span class="_ _23"> </span>why <span class="_ _23"> </span>we <span class="_ _23"> </span>don’t <span class="_ _23"> </span>need <span class="_ _23"> </span>to <span class="_ _23"> </span>prod <span class="_ _23"> </span>the <span class="_ _23"> </span>printer <span class="_ _23"> </span>thread <span class="_ _23"> </span>when <span class="_ _23"> </span>the</span></div><div class="t m0 xe1 h57 y5cf1 ff19 fs2d fc0 sc0 ls0 ws0">signal handling thread catches<span class="_"> </span><span class="ff1a">SIGHUP<span class="_ _e"> </span></span>and sets<span class="_"> </span><span class="ff1a">reread<span class="_ _e"> </span></span>to 1.</div><div class="t m0 x32 h57 y5cf2 ff18 fs2d fc0 sc0 ls0 ws0">21.8<span class="_ _288"> </span><span class="ff19">In <span class="_ _2"></span>the<span class="_ _66"> </span><span class="ff1a">printer_status<span class="_ _66"> </span></span>function, <span class="_ _2"></span>we <span class="_ _2"></span>search <span class="_ _2"></span>for <span class="_ _2"></span>the <span class="_ _2"></span>length <span class="_ _2"></span>of <span class="_ _2"></span>the <span class="_ _2"></span>IPP <span class="_ _3"></span>message <span class="_ _2"></span>by <span class="_ _2"></span>looking</span></div><div class="t m0 xe1 h57 y5cf3 ff19 fs2d fc0 sc0 ls0 ws0">for <span class="_ _3"></span>the<span class="_ _66"> </span><span class="ff1a">Content-Length<span class="_ _47"> </span></span>HTTP <span class="_ _3"></span>attribute.<span class="_ _46"> </span>This <span class="_ _3"></span>technique <span class="_ _3"></span>won’t <span class="_ _3"></span>work <span class="_ _3"></span>with <span class="_ _9"></span>a <span class="_ _3"></span>printer <span class="_ _3"></span>that</div><div class="t m0 xe1 h5f y5cf4 ff19 fs2d fc0 sc0 ls1e7 ws0">re<span class="ls0">sponds <span class="_"> </span>using <span class="_ _53"> </span>a <span class="_"> </span>chunked <span class="_ _42"> </span>transfer <span class="_"> </span>encoding.<span class="_ _51"> </span>Check <span class="_"> </span>RFC <span class="_ _53"> </span>2616 <span class="_"> </span>to <span class="_ _53"> </span>see <span class="_ _53"> </span>how <span class="_"> </span>a <span class="_ _53"> </span>chunked</span></div><div class="t m0 xe1 h57 y5cf5 ff19 fs2d fc0 sc0 ls0 ws0">message is <span class="_ _2"></span>formatted and <span class="_ _2"></span>then modify<span class="_ _80"> </span><span class="ff1a">printer_status<span class="_ _66"> </span></span>to support this <span class="_ _2"></span>form <span class="_ _2"></span>of response</div><div class="t m0 xe1 h5f y5cf6 ff19 fs2d fc0 sc0 ls0 ws0">as well.</div><div class="t m0 x32 h57 y5cf7 ff18 fs2d fc0 sc0 ls0 ws0">21.9<span class="_ _288"> </span><span class="ff19">In <span class="_ _47"> </span>the<span class="_ _46"> </span><span class="ff1a">update_jobno<span class="_ _59"> </span></span>function, <span class="_ _47"> </span>when <span class="_ _66"> </span>the <span class="_ _47"> </span>next <span class="_ _66"> </span>job <span class="_ _66"> </span>number <span class="_ _47"> </span>wraps <span class="_ _66"> </span>around <span class="_ _66"> </span>from <span class="_ _66"> </span>the</span></div><div class="t m0 xe1 h57 y5cf8 ff19 fs2d fc0 sc0 ls0 ws0">maximum <span class="_ _23"> </span>positive <span class="_ _23"> </span>value <span class="_ _23"> </span>to <span class="_ _23"></span>1 <span class="_ _23"></span>(see<span class="_ _45"> </span><span class="ff1a">get_newjobno<span class="_ _45"> </span></span>to <span class="_ _23"></span>see <span class="_ _23"></span>how <span class="_ _9"></span>this <span class="_ _23"> </span>can <span class="_ _23"> </span>happen), <span class="_ _23"> </span>we <span class="_ _23"> </span>can</div><div class="t m0 xe1 h5f y5cf9 ff19 fs2d fc0 sc0 ls0 ws0">write <span class="_"> </span>a <span class="_ _53"> </span>smaller <span class="_"> </span>number <span class="_"> </span>over <span class="_ _53"> </span>a <span class="_"> </span>lar<span class="_ _0"></span>ger <span class="_"> </span>one.<span class="_ _51"> </span>This <span class="_"> </span>can <span class="_"> </span>r<span class="_ _0"></span>esult <span class="_"> </span>in <span class="_ _53"> </span>the <span class="_"> </span>daemon <span class="_ _53"> </span>reading <span class="_"> </span>an</div><div class="t m0 xe1 h5f y5cfa ff19 fs2d fc0 sc0 ls0 ws0">incorrect number when it r<span class="_ _0"></span>estarts. <span class="_"> </span>What<span class="_"> </span>is a simple solution to this problem?</div><a class="l" href="#pf14" data-dest-detail='[20,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892409px;bottom:1236.288916px;width:90.803810px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
