<div id="pf2dc" class="pf w4 h1f" data-page-no="2dc"><div class="pc pc2dc w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg2dc.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">698<span class="_ _1b"> </span><span class="ff19 ls719">Te<span class="_ _9"></span><span class="ls0">rminal <span class="_"> </span>I/O<span class="_ _eb"> </span>Chapter <span class="_"> </span>18</span></span></div><div class="t m0 x76 h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">strcmp(pathname, &quot;/dev/stdout&quot;) == 0 ||</div><div class="t m0 x76 h57 y426 ff1a fs2d fc0 sc0 ls0 ws0">strcmp(pathname, &quot;/dev/stderr&quot;) == 0)</div><div class="t m0 x1f h57 y800 ff1a fs2d fc0 sc0 ls0 ws0">continue;</div><div class="t m0 x9d h57 y801 ff1a fs2d fc0 sc0 ls0 ws0">if (stat(pathname, &amp;devstat) &lt; 0)</div><div class="t m0 x1f h57 y802 ff1a fs2d fc0 sc0 ls0 ws0">continue;</div><div class="t m0 x9d h57 y803 ff1a fs2d fc0 sc0 ls0 ws0">if (S_ISDIR(devstat.st_mode)) {</div><div class="t m0 x1f h57 y804 ff1a fs2d fc0 sc0 ls0 ws0">add(pathname);</div><div class="t m0 x1f h57 y805 ff1a fs2d fc0 sc0 ls0 ws0">continue;</div><div class="t m0 x9d h57 y806 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x9d h57 y807 ff1a fs2d fc0 sc0 ls0 ws0">if (devstat.st_ino == fdstatp-&gt;st_ino &amp;&amp;</div><div class="t m0 x76 h57 y808 ff1a fs2d fc0 sc0 ls0 ws0">devstat.st_dev == fdstatp-&gt;st_dev) {<span class="_ _d9"> </span>/* found a match */</div><div class="t m0 x1f h57 y809 ff1a fs2d fc0 sc0 ls0 ws0">closedir(dp);</div><div class="t m0 x1f h57 y80a ff1a fs2d fc0 sc0 ls0 ws0">return(pathname);</div><div class="t m0 x9d h57 y80b ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y80c ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y16e7 ff1a fs2d fc0 sc0 ls0 ws0">closedir(dp);</div><div class="t m0 x8a h57 y16e8 ff1a fs2d fc0 sc0 ls0 ws0">return(NULL);</div><div class="t m0 x32 h57 y16e9 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h57 y3814 ff1a fs2d fc0 sc0 ls0 ws0">char *</div><div class="t m0 x32 h57 y16eb ff1a fs2d fc0 sc0 ls0 ws0">ttyname(int fd)</div><div class="t m0 x32 h57 y16ec ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y8e2 ff1a fs2d fc0 sc0 ls0 ws0">struct stat<span class="_ _8a"> </span>fdstat;</div><div class="t m0 x8a h57 y8e3 ff1a fs2d fc0 sc0 ls0 ws0">struct devdir<span class="_ _68"> </span>*ddp;</div><div class="t m0 x8a h57 y8e4 ff1a fs2d fc0 sc0 ls0 ws0">char <span class="_ _bd"> </span>*rval;</div><div class="t m0 x8a h57 y3380 ff1a fs2d fc0 sc0 ls0 ws0">if (isatty(fd) == 0)</div><div class="t m0 x9d h57 y3381 ff1a fs2d fc0 sc0 ls0 ws0">return(NULL);</div><div class="t m0 x8a h57 y3382 ff1a fs2d fc0 sc0 ls0 ws0">if (fstat(fd, &amp;fdstat) &lt; 0)</div><div class="t m0 x9d h57 y3383 ff1a fs2d fc0 sc0 ls0 ws0">return(NULL);</div><div class="t m0 x8a h57 y3384 ff1a fs2d fc0 sc0 ls0 ws0">if (S_ISCHR(fdstat.st_mode) == 0)</div><div class="t m0 x9d h57 y3385 ff1a fs2d fc0 sc0 ls0 ws0">return(NULL);</div><div class="t m0 x8a h57 y341a ff1a fs2d fc0 sc0 ls0 ws0">rval = searchdir(&quot;/dev&quot;, &amp;fdstat);</div><div class="t m0 x8a h57 y341b ff1a fs2d fc0 sc0 ls0 ws0">if (rval == NULL) {</div><div class="t m0 x9d h57 y341c ff1a fs2d fc0 sc0 ls0 ws0">for (ddp = head; ddp != NULL; ddp = ddp-&gt;d_next)</div><div class="t m0 x1f h57 y341d ff1a fs2d fc0 sc0 ls0 ws0">if ((rval = searchdir(ddp-&gt;d_name, &amp;fdstat)) != NULL)</div><div class="t m0 x1ca h57 y338a ff1a fs2d fc0 sc0 ls0 ws0">break;</div><div class="t m0 x8a h57 y338b ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y335e ff1a fs2d fc0 sc0 ls0 ws0">cleanup();</div><div class="t m0 x8a h57 y335f ff1a fs2d fc0 sc0 ls0 ws0">return(rval);</div><div class="t m0 x32 h57 y3360 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x234 h5e y5138 ff18 fs10 fc0 sc0 ls0 ws0">Figure 18.15<span class="_ _5a"> </span><span class="ff19">Implementation of POSIX.1<span class="_"> </span><span class="ff1a">ttyname<span class="_ _e"> </span></span>function</span></div><div class="t m0 x3f h4d y5139 ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _42"> </span>technique <span class="_ _53"> </span>is <span class="_ _53"> </span>to <span class="_ _42"> </span>read <span class="_ _42"> </span>the<span class="_ _4b"> </span><span class="ff1a">/dev<span class="_ _44"> </span></span>directory<span class="_ _4"></span><span class="lsee1">,l<span class="_ _c"></span><span class="ls0">ooking <span class="_ _53"> </span>for <span class="_ _42"> </span>an <span class="_ _53"> </span>entry <span class="_ _53"> </span>with <span class="_ _42"> </span>the <span class="_ _53"> </span>same</span></span></div><div class="t m0 x32 h49 y513a ff19 fs26 fc0 sc0 ls0 ws0">device <span class="_ _2"></span>number <span class="_ _3"></span>and <span class="_ _3"></span>i-node <span class="_ _3"></span>number<span class="_ _1"></span><span class="ls14f2">.R<span class="_ _1d"></span><span class="ls0">ecall <span class="_ _3"></span>from <span class="_ _2"></span>Section <span class="_ _3"></span>4.24 <span class="_ _3"></span>that <span class="_ _3"></span>each <span class="_ _3"></span>ﬁle <span class="_ _3"></span>system <span class="_ _3"></span>has <span class="_ _3"></span>a</span></span></div><div class="t m0 x32 h4d y513b ff19 fs26 fc0 sc0 ls0 ws0">unique <span class="_ _9"></span>device <span class="_ _9"></span>number <span class="_ _23"></span>(the<span class="_ _45"> </span><span class="ff1a">st_dev<span class="_ _45"> </span></span>ﬁeld <span class="_ _9"></span>in <span class="_ _9"></span>the<span class="_ _35"> </span><span class="ff1a">stat<span class="_ _45"> </span></span>structur<span class="_ _0"></span>e, <span class="_ _9"></span>from <span class="_ _9"></span>Section <span class="_ _9"></span>4.2), <span class="_ _9"></span>and</div><div class="t m0 x32 h4d y513c ff19 fs26 fc0 sc0 ls0 ws0">each directory entry in <span class="_ _2"></span>that ﬁle system <span class="_ _2"></span>has a <span class="_ _2"></span>unique i-node number <span class="_ _2"></span>(the<span class="_"> </span><span class="ff1a">st_ino<span class="_ _66"> </span></span>ﬁeld <span class="_ _2"></span>in</div><div class="t m0 x32 h4d y513d ff19 fs26 fc0 sc0 ls0 ws0">the<span class="_ _35"> </span><span class="ff1a">stat<span class="_ _35"> </span></span>structur<span class="_ _0"></span>e). <span class="_ _35"> </span>W<span class="_ _4"></span><span class="lsea6">ea<span class="_ _b"></span><span class="ls0">ssume <span class="_ _23"></span>in <span class="_ _23"></span>this <span class="_ _23"></span>function <span class="_ _23"> </span>that <span class="_ _23"> </span>when <span class="_ _23"> </span>we <span class="_ _23"> </span>hit <span class="_ _42"> </span>a <span class="_ _23"></span>matching <span class="_ _23"></span>device</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
