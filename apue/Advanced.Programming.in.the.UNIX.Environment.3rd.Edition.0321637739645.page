<div id="pf285" class="pf w4 h1f" data-page-no="285"><div class="pc pc285 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg285.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>16.5<span class="_ _2cb"> </span>Data <span class="_"> </span>T<span class="_ _6"></span>ransfer<span class="_ _1b"> </span><span class="ff18">611</span></div><div class="t m0 x32 h26 y12f ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _2"></span>destination <span class="_ _3"></span>address <span class="_ _2"></span>is <span class="_ _3"></span>ﬁrst <span class="_ _3"></span>set <span class="_ _2"></span>by <span class="_ _3"></span>calling<span class="_ _47"> </span><span class="ff1a">connect</span><span class="ls135a">,s<span class="_ _4f"></span><span class="ls0">o<span class="_ _47"> </span><span class="ff1a">sendto<span class="_ _47"> </span></span>gives <span class="_ _2"></span>us <span class="_ _3"></span>an <span class="_ _3"></span>alternate</span></span></div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">way to send a message.</div><div class="t m0 x6d h2d y4920 ff19 fs10 fc0 sc0 ls0 ws0">FreeBSD <span class="_ _141"> </span>Linux<span class="_ _3a"> </span>Mac OS X<span class="_ _7f"> </span>Solaris</div><div class="t m0 x103 h2d y4921 ff19 fs10 fc0 sc0 ls0 ws0">8.0 <span class="_ _215"> </span>3.2.0<span class="_ _76"> </span>10.6.8 <span class="_ _bf"> </span>10</div><div class="t m0 x150 h2d y4922 ff19 fs10 fc0 sc0 ls0 ws0">Flag<span class="_ _b9"> </span>Description<span class="_ _2cc"> </span>POSIX.1</div><div class="t m0 x1bd h4f y4923 ff1a fs11 fc0 sc0 ls0 ws0">MSG_CONFIRM<span class="_ _25a"> </span><span class="ff19">•<span class="_ _2cd"></span>Provide feedback to the link layer</span></div><div class="t m0 x12f h2e y4924 ff19 fs11 fc0 sc0 ls0 ws0">to keep address mapping valid.</div><div class="t m0 x1bd h4f y4925 ff1a fs11 fc0 sc0 ls0 ws0">MSG_DONTROUTE<span class="_ _2ce"> </span><span class="ff19 ls135b">••••<span class="_ _2cf"></span><span class="ls0">Don’t route packet outside of local</span></span></div><div class="t m0 x12f h2e y4926 ff19 fs11 fc0 sc0 ls0 ws0">network.</div><div class="t m0 x1bd h4f y4927 ff1a fs11 fc0 sc0 ls0 ws0">MSG_DONTWAIT<span class="_ _2d0"> </span><span class="ff19 ls135b">••••<span class="_ _2cf"></span><span class="ls0">Enable nonblocking operation</span></span></div><div class="t m0 x12f h2e y4928 ff19 fs11 fc0 sc0 ls0 ws0">(equivalent to using</div><div class="t m0 x12f h4f y4929 ff1a fs11 fc0 sc0 ls0 ws0">O_NONBLOCK<span class="ff19">).</span></div><div class="t m0 x1bd h4f y492a ff1a fs11 fc0 sc0 ls0 ws0">MSG_EOF<span class="_ _1d8"> </span><span class="ff19 ls135c">••<span class="_ _2cf"></span><span class="ls0">Shut the sender side of the socket</span></span></div><div class="t m0 x12f h2e y492b ff19 fs11 fc0 sc0 ls0 ws0">down after sending data.</div><div class="t m0 x1bd h4f y492c ff1a fs11 fc0 sc0 ls0 ws0">MSG_EOR<span class="_ _26f"> </span><span class="ff19 ls135b">•••••<span class="_ _2cf"></span><span class="ls0">Mark the end of the recor<span class="lsdb">di<span class="_ _5"></span><span class="ls0">f</span></span></span></span></div><div class="t m0 x12f h2e y492d ff19 fs11 fc0 sc0 ls0 ws0">supported by protocol.</div><div class="t m0 x1bd h4f y492e ff1a fs11 fc0 sc0 ls0 ws0">MSG_MORE<span class="_ _2d1"> </span><span class="ff19">•<span class="_ _2cd"></span>Delay sending the packet to allow</span></div><div class="t m0 x12f h2e y492f ff19 fs11 fc0 sc0 ls0 ws0">mor<span class="lsdb">ed<span class="_ _5"></span><span class="ls0">ata to be written.</span></span></div><div class="t m0 x1bd h4f y4930 ff1a fs11 fc0 sc0 ls0 ws0">MSG_NOSIGNAL<span class="_ _33"> </span><span class="ff19 ls135b">•••<span class="_ _f8"></span><span class="ls0">Don’t generate<span class="_"> </span><span class="ff1a">SIGPIPE<span class="_ _53"> </span></span>when</span></span></div><div class="t m0 x12f h2e y4931 ff19 fs11 fc0 sc0 ls0 ws0">writing to an unconnected</div><div class="t m0 x12f h2e y4932 ff19 fs11 fc0 sc0 ls0 ws0">socket.</div><div class="t m0 x1bd h4f y4933 ff1a fs11 fc0 sc0 ls0 ws0">MSG_OOB<span class="_ _26f"> </span><span class="ff19 ls135b">•••••<span class="_ _2cf"></span><span class="ls0">Send out-of-band data if</span></span></div><div class="t m0 x12f h2e y4934 ff19 fs11 fc0 sc0 ls0 ws0">supported by protocol (see</div><div class="t m0 x12f h2e y4935 ff19 fs11 fc0 sc0 ls0 ws0">Section 16.7).</div><div class="t m0 xa0 h6d y4936 ff18 fs12 fc0 sc0 ls0 ws0">Figure 16.13<span class="_ _5a"> </span><span class="ff19">Flags used with<span class="_"> </span><span class="ff1a">send<span class="_ _e"> </span></span>socket calls</span></div><div class="t m0 x3f h50 y4937 ff19 fs29 fc0 sc0 lse2 ws0">We <span class="_ _4b"> </span>h<span class="_ _23"></span><span class="ls0">ave <span class="_"> </span>one <span class="_ _47"> </span>mor<span class="ls135d">ec<span class="_ _1d"></span><span class="ls0">hoice <span class="_ _47"> </span>when <span class="_ _66"> </span>transmitting <span class="_ _47"> </span>data <span class="_ _66"> </span>over <span class="_ _47"> </span>a <span class="_ _66"> </span>socket.<span class="_ _50"> </span><span class="lse2">We <span class="_ _59"> </span>c<span class="_ _9"></span></span>an <span class="_ _47"> </span>call</span></span></span></div><div class="t m0 x32 h5c y4938 ff1a fs29 fc0 sc0 ls0 ws0">sendmsg<span class="_ _45"> </span><span class="ff19">with <span class="_ _23"> </span>a<span class="_ _35"> </span></span>msghdr<span class="_ _45"> </span><span class="ff19">structure<span class="_ _45"> </span>to<span class="_ _35"> </span>specify <span class="_ _23"></span>multiple <span class="_ _23"></span>buf<span class="_ _0"></span>fers <span class="_ _23"></span>from <span class="_ _9"></span>which <span class="_ _23"></span>to <span class="_ _23"></span>transmit</span></div><div class="t m0 x32 h5c y4939 ff19 fs29 fc0 sc0 ls0 ws0">data, similar to the<span class="_"> </span><span class="ff1a">writev<span class="_ _80"> </span></span>function (Section 14.6).</div><div class="t m0 x3f h62 y493a ff1a fs30 fc0 sc0 ls0 ws0">#include &lt;sys/socket.h&gt;</div><div class="t m0 x3f h62 y493b ff1a fs30 fc0 sc0 ls0 ws0">ssize_t sendmsg(int<span class="_"> </span><span class="ff1b">sockfd</span><span class="ls1185">,c<span class="_ _1d"></span><span class="ls0">onst struct msghdr *<span class="ff1b">msg</span><span class="ls1185">,i<span class="_ _5b"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">ﬂags</span>);</span></span></span></span></div><div class="t m0 x1d8 hff y493c ff19 fs30 fc0 sc0 ls0 ws0">Returns: number of bytes sent if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x3f h64 y493d ff19 fs31 fc0 sc0 ls0 ws0">POSIX.1 deﬁnes the<span class="_"> </span><span class="ff1a">msghdr<span class="_ _80"> </span></span>structure<span class="_"> </span>to<span class="_"> </span>have at least the following members:</div><div class="t m0 x3f h65 y493e ff1a fs32 fc0 sc0 ls0 ws0">struct msghdr {</div><div class="t m0 xf4 h65 y493f ff1a fs32 fc0 sc0 ls0 ws0">void <span class="_ _176"> </span>*msg_name;<span class="_ _186"> </span>/* optional address */</div><div class="t m0 xf4 h65 y4940 ff1a fs32 fc0 sc0 ls0 ws0">socklen_t <span class="_ _8a"> </span>msg_namelen;<span class="_ _8a"> </span>/* address size in bytes */</div><div class="t m0 xf4 h65 y4941 ff1a fs32 fc0 sc0 ls0 ws0">struct iovec<span class="_ _d9"> </span>*msg_iov; <span class="_ _186"> </span>/*<span class="_"> </span>array of I/O buffers */</div><div class="t m0 xf4 h65 y4942 ff1a fs32 fc0 sc0 ls0 ws0">int <span class="_ _bd"> </span>msg_iovlen;<span class="_ _189"> </span>/* number of elements in array */</div><div class="t m0 xf4 h65 y4943 ff1a fs32 fc0 sc0 ls0 ws0">void <span class="_ _176"> </span>*msg_control;<span class="_ _8a"> </span>/* ancillary data */</div><div class="t m0 xf4 h65 y4944 ff1a fs32 fc0 sc0 ls0 ws0">socklen_t <span class="_ _8a"> </span>msg_controllen;<span class="_ _d9"> </span>/* number of ancillary bytes */</div><div class="t m0 xf4 h65 y4945 ff1a fs32 fc0 sc0 ls0 ws0">int <span class="_ _bd"> </span>msg_flags;<span class="_ _90"> </span>/* flags for received message */</div><div class="t m0 xf4 h65 y4946 ff1a fs32 fc0 sc0 ls0 ws0">.</div><div class="t m0 xf4 h65 y4947 ff1a fs32 fc0 sc0 ls0 ws0">.</div><div class="t m0 xf4 h65 y4948 ff1a fs32 fc0 sc0 ls0 ws0">.</div><div class="t m0 x3f h65 y4949 ff1a fs32 fc0 sc0 ls0 ws0">};</div><div class="t m0 x32 h64 y494a ff19 fs31 fc0 sc0 ls43f ws0">We <span class="_ _44"> </span>s<span class="_ _9"></span><span class="ls0">aw <span class="_"> </span>the<span class="_ _4b"> </span><span class="ff1a">iovec<span class="_ _59"> </span></span>structure<span class="_ _4b"> </span>in<span class="_ _59"> </span>Section <span class="_"> </span>14.6.<span class="_ _65"> </span></span>We<span class="_ _9"></span><span class="ls0">’ll <span class="_"> </span>see <span class="_ _e"> </span>the <span class="_"> </span>use <span class="_ _e"> </span>of <span class="_"> </span>ancillary <span class="_ _e"> </span>data <span class="_"> </span>in</span></div><div class="t m0 x32 h6e y494b ff19 fs31 fc0 sc0 ls0 ws0">Section 17.4.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
