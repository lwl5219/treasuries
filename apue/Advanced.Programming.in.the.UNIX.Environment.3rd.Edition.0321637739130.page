<div id="pf82" class="pf w4 h1f" data-page-no="82"><div class="pc pc82 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg82.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">96<span class="_ _1b"> </span><span class="ff19">Files <span class="_"> </span>and <span class="_"> </span>Directories <span class="_ _e5"> </span>Chapter<span class="_ _4b"> </span>4</span></div><div class="t m0 x17c h51 y597 ff19 fs2a fc0 sc0 ls0 ws0">Macr<span class="ls488">oT<span class="_ _187"></span><span class="ls0">ype of ﬁle</span></span></div><div class="t m0 xb7 h5e y7b6 ff1a fs10 fc0 sc0 ls0 ws0">S_ISREG()<span class="_ _75"> </span><span class="ff19 ls21d">re<span class="ls0">gular ﬁle</span></span></div><div class="t m0 xb7 h5e y7b7 ff1a fs10 fc0 sc0 ls0 ws0">S_ISDIR()<span class="_ _75"> </span><span class="ff19">directory ﬁle</span></div><div class="t m0 xb7 h5e y7b8 ff1a fs10 fc0 sc0 ls0 ws0">S_ISCHR()<span class="_ _75"> </span><span class="ff19">character special ﬁle</span></div><div class="t m0 xb7 h5e y7b9 ff1a fs10 fc0 sc0 ls0 ws0">S_ISBLK()<span class="_ _75"> </span><span class="ff19">block special ﬁle</span></div><div class="t m0 xb7 h5e y7ba ff1a fs10 fc0 sc0 ls0 ws0">S_ISFIFO()<span class="_ _6e"> </span><span class="ff19">pipe or FIFO</span></div><div class="t m0 xb7 h5e y7bb ff1a fs10 fc0 sc0 ls0 ws0">S_ISLNK()<span class="_ _75"> </span><span class="ff19">symbolic link</span></div><div class="t m0 xb7 h5e y7bc ff1a fs10 fc0 sc0 ls0 ws0">S_ISSOCK()<span class="_ _6e"> </span><span class="ff19">socket</span></div><div class="t m0 xbe h4f y60c ff18 fs11 fc0 sc0 ls0 ws0">Figure 4.1<span class="_ _5a"> </span><span class="ff19">File type macros in<span class="_"> </span><span class="ff1a">&lt;sys/stat.h&gt;</span></span></div><div class="t m0 x3f h55 ye2c ff19 fs2c fc0 sc0 ls0 ws0">POSIX.1 <span class="_"> </span>allows <span class="_"> </span>implementations <span class="_ _66"> </span>to <span class="_"> </span>represent <span class="_"> </span>interpr<span class="_ _0"></span>ocess <span class="_"> </span>communication</div><div class="t m0 x106 h55 ye2d ff19 fs2c fc0 sc0 ls0 ws0">(</div><div class="t m0 x17d h55 ye2c ff19 fs2c fc0 sc0 ls0 ws0">IPC</div><div class="t m0 x17e h55 ye2d ff19 fs2c fc0 sc0 ls0 ws0">)</div><div class="t m0 x32 h55 ye2e ff19 fs2c fc0 sc0 ls0 ws0">objects, <span class="_ _47"> </span>such <span class="_ _47"> </span>as <span class="_ _45"> </span>message <span class="_ _47"> </span>queues <span class="_ _47"> </span>and <span class="_ _47"> </span>semaphores, <span class="_ _47"> </span>as <span class="_ _45"> </span>ﬁles.<span class="_ _50"> </span>The <span class="_ _45"> </span>macr<span class="_ _0"></span>os <span class="_ _47"> </span>shown <span class="_ _45"> </span>in</div><div class="t m0 x32 h54 ye2f ff19 fs2c fc0 sc0 ls0 ws0">Figur<span class="ls489">e4<span class="_ _4f"></span><span class="ls0">.2 allow <span class="_ _2"></span>us to determine <span class="_ _2"></span>the type of <span class="_ _2"></span>IPC object from the<span class="_"> </span><span class="ff1a">stat<span class="_ _66"> </span></span>structure. <span class="_"> </span>Instead</span></span></div><div class="t m0 x32 h54 ye30 ff19 fs2c fc0 sc0 ls0 ws0">of <span class="_"> </span>taking <span class="_ _e"> </span>the<span class="_ _59"> </span><span class="ff1a">st_mode<span class="_ _59"> </span></span>member <span class="_"> </span>as <span class="_ _e"> </span>an <span class="_"> </span>ar<span class="_ _0"></span>gument, <span class="_"> </span>these <span class="_ _e"> </span>macros <span class="_ _e"> </span>differ <span class="_ _e"> </span>from <span class="_ _e"> </span>those <span class="_"> </span>in</div><div class="t m0 x32 h54 ye31 ff19 fs2c fc0 sc0 ls0 ws0">Figur<span class="ls142">e4<span class="_ _4f"></span><span class="ls0">.1 in that their argument is a pointer to the<span class="_"> </span><span class="ff1a">stat<span class="_ _80"> </span></span>structure.</span></span></div><div class="t m0 x17f h2f ye32 ff19 fs12 fc0 sc0 ls0 ws0">Macr<span class="ls48a">oT<span class="_ _188"></span><span class="ls0">ype of object</span></span></div><div class="t m0 xa7 h63 ye33 ff1a fs13 fc0 sc0 ls0 ws0">S_TYPEISMQ()<span class="_ _75"> </span><span class="ff19">message queue</span></div><div class="t m0 xa7 h63 ye34 ff1a fs13 fc0 sc0 ls0 ws0">S_TYPEISSEM()<span class="_ _6e"> </span><span class="ff19">semaphore</span></div><div class="t m0 xa7 h63 ye35 ff1a fs13 fc0 sc0 ls0 ws0">S_TYPEISSHM()<span class="_ _6e"> </span><span class="ff19">shared memory object</span></div><div class="t m0 xbe h6f ye36 ff18 fs14 fc0 sc0 ls0 ws0">Figure 4.2<span class="_ _5a"> </span><span class="ff19">IPC type macros in<span class="_"> </span><span class="ff1a">&lt;sys/stat.h&gt;</span></span></div><div class="t m0 x32 h96 ye37 ff19 fs49 fc0 sc0 ls0 ws0">Message <span class="_ _3"></span>queues, <span class="_ _3"></span>semaphores, <span class="_ _3"></span>and <span class="_ _9"></span>shared <span class="_ _2"></span>memory <span class="_ _9"></span>objects <span class="_ _3"></span>ar<span class="ls48b">ed<span class="_ _b"></span><span class="ls0">iscussed <span class="_ _9"></span>in <span class="_ _3"></span>Chapter <span class="_ _3"></span>15.</span></span></div><div class="t m0 x32 h96 ye38 ff19 fs49 fc0 sc0 ls0 ws0">However<span class="_ _6"></span><span class="ls48c">,n<span class="_ _b"></span><span class="ls0">one <span class="_ _9"></span>of <span class="_ _42"> </span>the <span class="_ _23"> </span>various <span class="_ _23"> </span>implementations <span class="_ _42"> </span>of <span class="_ _23"></span>the <span class="_ _23"> </span>UNIX <span class="_ _23"> </span>System <span class="_ _42"> </span>discussed <span class="_ _23"></span>in <span class="_ _23"> </span>this</span></span></div><div class="t m0 x32 h96 ye39 ff19 fs49 fc0 sc0 ls0 ws0">book repr<span class="_ _0"></span>esent these objects as ﬁles.</div><div class="t m0 x35 h97 ye3a ff16 fs49 fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h96 ye3b ff19 fs49 fc0 sc0 ls0 ws0">The program in Figur<span class="_ _0"></span><span class="ls48d">e4<span class="_ _d"></span><span class="ls0">.3 prints the type of ﬁle for each command</span></span></div><div class="t m0 xfc h96 ye3c ff19 fs49 fc0 sc0 ls0 ws0">-</div><div class="t m0 x168 h96 ye3b ff19 fs49 fc0 sc0 ls0 ws0">line argument.</div><div class="t m0 x32 h98 ye3d ff1a fs4a fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h98 ye3e ff1a fs4a fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h98 ye3f ff1a fs4a fc0 sc0 ls0 ws0">main(int argc, char *argv[])</div><div class="t m0 x32 h98 ye40 ff1a fs4a fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h98 ye41 ff1a fs4a fc0 sc0 ls0 ws0">int <span class="_ _186"> </span>i;</div><div class="t m0 x8a h98 ye42 ff1a fs4a fc0 sc0 ls0 ws0">struct stat buf;</div><div class="t m0 x8a h98 ye43 ff1a fs4a fc0 sc0 ls0 ws0">char <span class="_ _b7"> </span>*ptr;</div><div class="t m0 x8a h98 ye44 ff1a fs4a fc0 sc0 ls0 ws0">for (i = 1; i &lt; argc; i++) {</div><div class="t m0 x9d h98 ye45 ff1a fs4a fc0 sc0 ls0 ws0">printf(&quot;%s: &quot;, argv[i]);</div><div class="t m0 x9d h98 ye46 ff1a fs4a fc0 sc0 ls0 ws0">if (lstat(argv[i], &amp;buf) &lt; 0) {</div><div class="t m0 x1f h98 ye47 ff1a fs4a fc0 sc0 ls0 ws0">err_ret(&quot;lstat error&quot;);</div><div class="t m0 x1f h98 ye48 ff1a fs4a fc0 sc0 ls0 ws0">continue;</div><div class="t m0 x9d h98 ye49 ff1a fs4a fc0 sc0 ls0 ws0">}</div><div class="t m0 x9d h98 ye4a ff1a fs4a fc0 sc0 ls0 ws0">if (S_ISREG(buf.st_mode))</div><div class="t m0 x1f h98 ye4b ff1a fs4a fc0 sc0 ls0 ws0">ptr = &quot;regular&quot;;</div><div class="t m0 x9d h98 ye4c ff1a fs4a fc0 sc0 ls0 ws0">else if (S_ISDIR(buf.st_mode))</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
