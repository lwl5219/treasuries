<div id="pf8d" class="pf w4 h1f" data-page-no="8d"><div class="pc pc8d w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg8d.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h7a ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>4.9<span class="_ _197"> </span><span class="ff1a">chmod</span>,<span class="_ _4b"> </span><span class="ff1a">fchmod</span><span class="ls30a">,a<span class="_ _55"></span><span class="ls0">nd<span class="_ _4b"> </span><span class="ff1a">fchmodat<span class="_ _4b"> </span></span>Functions<span class="_ _1b"> </span><span class="ff18">107</span></span></span></div><div class="t m0 x32 h2a y12f ff19 fsf fc0 sc0 ls0 ws0">Note <span class="_ _3"></span>that <span class="_ _9"></span>nine <span class="_ _3"></span>of <span class="_ _3"></span>the <span class="_ _9"></span>entries <span class="_ _3"></span>in <span class="_ _9"></span>Figur<span class="ls4d3">e4<span class="_ _b"></span><span class="ls0">.1<span class="_ _1"></span><span class="ls4d3">1a<span class="_ _8"></span><span class="ls45">re <span class="_ _23"></span>t<span class="ls0">he <span class="_ _9"></span>nine <span class="_ _3"></span>ﬁle <span class="_ _3"></span>access <span class="_ _9"></span>permission <span class="_ _3"></span>bits <span class="_ _9"></span>from</span></span></span></span></span></div><div class="t m0 x32 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">Figur<span class="ls4d4">e4<span class="_ _26"></span><span class="ls0">.6. <span class="_ _5a"> </span>W<span class="_ _6"></span>e’ve <span class="_ _45"> </span>added <span class="_ _45"> </span>the <span class="_ _45"> </span>two <span class="_ _45"> </span>set-ID <span class="_ _35"> </span>constants <span class="_ _45"> </span>(<span class="ff1a">S_ISUID<span class="_"> </span></span>and<span class="_ _5a"> </span><span class="ff1a">S_ISGID</span>), <span class="_ _45"> </span>the</span></span></div><div class="t m0 x32 h26 y131 ff19 fsf fc0 sc0 ls0 ws0">saved-text <span class="_ _2"></span>constant <span class="_ _2"></span>(<span class="ff1a">S_ISVTX</span>), <span class="_ _2"></span>and <span class="_ _2"></span>the <span class="_ _2"></span>three combined <span class="_ _2"></span>constants <span class="_ _2"></span>(<span class="ff1a">S_IRWXU</span>,<span class="_ _47"> </span><span class="ff1a">S_IRWXG</span>,</div><div class="t m0 x32 h26 y132 ff19 fsf fc0 sc0 ls0 ws0">and<span class="_"> </span><span class="ff1a">S_IRWXO</span>).</div><div class="t m0 x76 h52 yf89 ff19 fs2a fc0 sc0 ls0 ws0">The <span class="_ _23"> </span>saved-text <span class="_ _23"> </span>bit <span class="_ _42"> </span>(<span class="ff1a">S_ISVTX</span>)<span class="_ _45"> </span>is<span class="_ _47"> </span>not <span class="_ _42"> </span>part <span class="_ _23"> </span>of <span class="_ _23"> </span>POSIX.1.<span class="_ _61"> </span>It <span class="_ _23"> </span>is <span class="_ _42"> </span>deﬁned <span class="_ _23"> </span>in <span class="_ _23"> </span>the <span class="_ _23"> </span>XSI <span class="_ _42"> </span>option <span class="_ _23"> </span>in <span class="_ _23"> </span>the</div><div class="t m0 x76 h51 yf8a ff19 fs2a fc0 sc0 ls0 ws0">Single UNIX Speciﬁcation.<span class="_ _35"> </span><span class="lsed">We <span class="_ _42"> </span>d<span class="_ _9"></span></span>escribe its purpose in the next section.</div><div class="t m0 x35 h27 y75a ff16 fsf fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h26 yf8b ff19 fsf fc0 sc0 ls0 ws0">Recall <span class="_ _2"></span>the <span class="_ _2"></span>ﬁnal <span class="_ _3"></span>state <span class="_ _2"></span>of <span class="_ _3"></span>the <span class="_ _2"></span>ﬁles<span class="_ _47"> </span><span class="ff1a">foo<span class="_ _47"> </span></span>and<span class="_ _66"> </span><span class="ff1a">bar<span class="_ _47"> </span></span>when <span class="_ _2"></span>we <span class="_ _3"></span>ran <span class="_ _2"></span>the <span class="_ _3"></span>program in <span class="_ _3"></span>Figur<span class="ls4d5">e4<span class="_ _8"></span><span class="ls0">.9 <span class="_ _2"></span>to</span></span></div><div class="t m0 x32 h26 yf8c ff19 fsf fc0 sc0 ls0 ws0">demonstrate the<span class="_"> </span><span class="ff1a">umask<span class="_ _80"> </span></span>function:</div><div class="t m0 x3f h57 yf8d ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">ls -l foo bar</span></div><div class="t m0 x3f h57 yf8e ff1a fs2d fc0 sc0 ls0 ws0">-rw------- <span class="_"> </span>1<span class="_"> </span>sar <span class="_ _82"> </span>0<span class="_"> </span>Dec <span class="_"> </span>7<span class="_"> </span>21:20 bar</div><div class="t m0 x3f h57 yf8f ff1a fs2d fc0 sc0 ls0 ws0">-rw-rw-rw- <span class="_"> </span>1<span class="_"> </span>sar <span class="_ _82"> </span>0<span class="_"> </span>Dec <span class="_"> </span>7<span class="_"> </span>21:20 foo</div><div class="t m0 x32 h2a y555 ff19 fsf fc0 sc0 ls0 ws0">The program shown in Figur<span class="_ _0"></span><span class="ls44">e4<span class="_ _d"></span><span class="ls0">.12 modiﬁes the mode of these two ﬁles.</span></span></div><div class="t m0 x32 h4e yf90 ff1a fs28 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h4e yf91 ff1a fs28 fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h4e yf92 ff1a fs28 fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 x32 h4e yf93 ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e yf94 ff1a fs28 fc0 sc0 ls0 ws0">struct stat<span class="_ _8a"> </span>statbuf;</div><div class="t m0 x8a h4e yf95 ff1a fs28 fc0 sc0 ls0 ws0">/* turn on set-group-ID and turn off group-execute */</div><div class="t m0 x8a h4e yf96 ff1a fs28 fc0 sc0 ls0 ws0">if (stat(&quot;foo&quot;, &amp;statbuf) &lt; 0)</div><div class="t m0 x9d h4e yf97 ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;stat error for foo&quot;);</div><div class="t m0 x8a h4e yf98 ff1a fs28 fc0 sc0 ls0 ws0">if (chmod(&quot;foo&quot;, (statbuf.st_mode &amp; ˜S_IXGRP) | S_ISGID) &lt; 0)</div><div class="t m0 x9d h4e yf99 ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;chmod error for foo&quot;);</div><div class="t m0 x8a h4e yf9a ff1a fs28 fc0 sc0 ls0 ws0">/* set absolute mode to &quot;rw-r--r--&quot; */</div><div class="t m0 x8a h4e yf9b ff1a fs28 fc0 sc0 ls0 ws0">if (chmod(&quot;bar&quot;, S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH) &lt; 0)</div><div class="t m0 x9d h4e yf9c ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;chmod error for bar&quot;);</div><div class="t m0 x8a h4e yf9d ff1a fs28 fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h4e yf9e ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x9e h4f yf9f ff18 fs11 fc0 sc0 ls0 ws0">Figure 4.12<span class="_ _5a"> </span><span class="ff19">Example of<span class="_"> </span><span class="ff1a">chmod<span class="_ _e"> </span></span>function</span></div><div class="t m0 x32 h55 yfa0 ff19 fs2c fc0 sc0 ls0 ws0">After running the pr<span class="_ _0"></span>ogram in Figur<span class="ls142">e4<span class="_ _4f"></span><span class="ls0">.12, we see that the ﬁnal state of the two ﬁles is</span></span></div><div class="t m0 x3f h5d yfa1 ff1a fs2f fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">ls -l foo bar</span></div><div class="t m0 x3f h5d yfa2 ff1a fs2f fc0 sc0 ls0 ws0">-rw-r--r-- <span class="_"> </span>1<span class="_"> </span>sar <span class="_ _82"> </span>0<span class="_"> </span>Dec <span class="_"> </span>7<span class="_"> </span>21:20 bar</div><div class="t m0 x3f h5d yfa3 ff1a fs2f fc0 sc0 ls0 ws0">-rw-rwSrw- <span class="_"> </span>1<span class="_"> </span>sar <span class="_ _82"> </span>0<span class="_"> </span>Dec <span class="_"> </span>7<span class="_"> </span>21:20 foo</div><div class="t m0 x32 h54 yfa4 ff19 fs2c fc0 sc0 ls0 ws0">In <span class="_"> </span>this <span class="_ _e"> </span>example, <span class="_"> </span>we <span class="_"> </span>have <span class="_ _e"> </span>set <span class="_"> </span>the <span class="_"> </span>permissions <span class="_ _e"> </span>of <span class="_"> </span>the <span class="_ _e"> </span>ﬁle<span class="_ _59"> </span><span class="ff1a">bar<span class="_ _46"> </span></span>to <span class="_"> </span>an <span class="_ _e"> </span>absolute <span class="_"> </span>value,</div><div class="t m0 x32 h54 yfa5 ff19 fs2c fc0 sc0 ls150 ws0">re<span class="ls0">gardless <span class="_"> </span>of <span class="_"> </span>the <span class="_"> </span>curr<span class="_ _0"></span>ent <span class="_"> </span>permission <span class="_"> </span>bits.<span class="_ _48"> </span>For <span class="_"> </span>the <span class="_"> </span>ﬁle<span class="_ _59"> </span><span class="ff1a">foo</span>,<span class="_ _46"> </span>we<span class="_ _59"> </span>set <span class="_"> </span>the <span class="_"> </span>permissions</span></div><div class="t m0 x32 h54 yfa6 ff19 fs2c fc0 sc0 ls150 ws0">re<span class="ls0">lative <span class="_ _66"> </span>to <span class="_"> </span>their <span class="_ _66"> </span>current <span class="_"> </span>state.<span class="_ _60"> </span><span class="ls155">To <span class="_ _4b"> </span>d<span class="_ _9"></span><span class="ls4d6">ot<span class="_ _4a"></span><span class="ls0">his, <span class="_"> </span>we <span class="_"> </span>ﬁrst <span class="_ _66"> </span>call<span class="_ _46"> </span><span class="ff1a">stat<span class="_ _61"> </span></span>to <span class="_"> </span>obtain <span class="_"> </span>the <span class="_ _66"> </span>current</span></span></span></span></div><div class="t m0 x32 h55 yfa7 ff19 fs2c fc0 sc0 ls0 ws0">permissions <span class="_ _9"></span>and <span class="_ _9"></span>then <span class="_ _9"></span>modify <span class="_ _9"></span>them.<span class="_ _5a"> </span><span class="ls155">We <span class="_ _66"> </span>h<span class="_ _9"></span></span>ave <span class="_ _23"></span>explicitly <span class="_ _9"></span>turned <span class="_ _9"></span>on <span class="_ _9"></span>the <span class="_ _9"></span>set-group-ID <span class="_ _3"></span>bit</div><div class="t m0 x32 h54 yfa8 ff19 fs2c fc0 sc0 ls0 ws0">and turned of<span class="ls4d7">ft<span class="_ _4f"></span><span class="ls0">he group-execute bit.<span class="_ _46"> </span>Note that the<span class="_"> </span><span class="ff1a">ls<span class="_ _66"> </span></span>command lists the group-execute</span></span></div><div class="t m0 x32 h54 yfa9 ff19 fs2c fc0 sc0 ls0 ws0">permission <span class="_ _3"></span>as<span class="_ _47"> </span><span class="ff1a">S<span class="_ _45"> </span></span>to <span class="_ _2"></span>signify <span class="_ _3"></span>that <span class="_ _9"></span>the <span class="_ _3"></span>set-group-ID <span class="_ _2"></span>bit <span class="_ _9"></span>is <span class="_ _3"></span>set <span class="_ _3"></span>without <span class="_ _3"></span>the <span class="_ _3"></span>group-execute <span class="_ _3"></span>bit</div><div class="t m0 x32 h55 yfaa ff19 fs2c fc0 sc0 ls0 ws0">being set.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
