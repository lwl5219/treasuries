<div id="pf284" class="pf w4 h1f" data-page-no="284"><div class="pc pc284 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg284.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">610<span class="_ _1b"> </span><span class="ff19">Network <span class="_"> </span>IPC: <span class="_"> </span>Sockets<span class="_ _2c6"> </span>Chapter <span class="_"> </span>16</span></div><div class="t m0 x35 h53 y12f ff16 fs2b fc0 sc0 ls0 ws0">16.5 <span class="_ _93"> </span>Data<span class="_ _54"> </span><span class="ls4fe">Tr<span class="_ _9"></span></span>ansfer</div><div class="t m0 x32 h26 y4de ff19 fsf fc0 sc0 ls0 ws0">Since <span class="_ _3"></span>a <span class="_ _2"></span>socket <span class="_ _3"></span>endpoint <span class="_ _3"></span>is <span class="_ _3"></span>represented <span class="_ _2"></span>as <span class="_ _3"></span>a <span class="_ _3"></span>ﬁle <span class="_ _3"></span>descriptor<span class="_ _1"></span><span class="lsf90">,w<span class="_ _8"></span><span class="ls8c2">ec<span class="_ _8"></span><span class="ls0">an <span class="_ _3"></span>use<span class="_ _47"> </span><span class="ff1a">read<span class="_ _45"> </span></span>and<span class="_ _66"> </span><span class="ff1a">write</span></span></span></span></div><div class="t m0 x32 h2a y6d0 ff19 fsf fc0 sc0 ls0 ws0">to <span class="_ _2"></span>communicate <span class="_ _3"></span>with <span class="_ _3"></span>a <span class="_ _3"></span>socket, <span class="_ _3"></span>as <span class="_ _3"></span>long <span class="_ _3"></span>as <span class="_ _2"></span>it <span class="_ _3"></span>is <span class="_ _3"></span>connected.<span class="_ _16"> </span>Recall <span class="_ _3"></span>that <span class="_ _3"></span>a <span class="_ _2"></span>datagram <span class="_ _3"></span>socket</div><div class="t m0 x32 h26 y6d1 ff19 fsf fc0 sc0 ls0 ws0">can <span class="_ _53"> </span>be <span class="_ _e"> </span>‘‘connected’<span class="_ _1"></span>’<span class="_ _4b"> </span>if<span class="_ _4b"> </span>we<span class="_ _4b"> </span>set <span class="_ _e"> </span>the <span class="_ _53"> </span>default <span class="_ _e"> </span>peer <span class="_ _e"> </span>address <span class="_ _53"> </span>using <span class="_ _53"> </span>the<span class="_ _59"> </span><span class="ff1a">connect<span class="_ _4b"> </span></span>function.</div><div class="t m0 x32 h26 y6d2 ff19 fsf fc0 sc0 ls0 ws0">Using<span class="_ _47"> </span><span class="ff1a">read<span class="_ _47"> </span></span>and<span class="_ _47"> </span><span class="ff1a">write<span class="_ _47"> </span></span>with <span class="_ _3"></span>socket <span class="_ _3"></span>descriptors <span class="_ _3"></span>is <span class="_ _3"></span>signiﬁcant, <span class="_ _9"></span>because <span class="_ _2"></span>it <span class="_ _3"></span>means <span class="_ _9"></span>that <span class="_ _2"></span>we</div><div class="t m0 x32 h2a y6d3 ff19 fsf fc0 sc0 ls0 ws0">can pass socket descriptors to functions that wer<span class="ls1354">eo<span class="_ _d"></span><span class="ls0">riginally designed to work with local</span></span></div><div class="t m0 x32 h2a y6d4 ff19 fsf fc0 sc0 ls0 ws0">ﬁles. <span class="_ _47"> </span>W<span class="_ _6"></span><span class="ls288">ec<span class="_ _8"></span><span class="ls0">an <span class="_ _3"></span>also <span class="_ _9"></span>arrange <span class="_ _3"></span>to <span class="_ _3"></span>pass <span class="_ _3"></span>the <span class="_ _9"></span>socket <span class="_ _3"></span>descriptors <span class="_ _3"></span>to <span class="_ _9"></span>child <span class="_ _3"></span>processes <span class="_ _2"></span>that <span class="_ _9"></span>execute</span></span></div><div class="t m0 x32 h2a y6d5 ff19 fsf fc0 sc0 ls0 ws0">programs that know nothing about sockets.</div><div class="t m0 x3f h26 y6d6 ff19 fsf fc0 sc0 ls0 ws0">Although <span class="_ _2"></span>we <span class="_ _2"></span>can <span class="_ _2"></span>exchange <span class="_ _2"></span>data <span class="_ _2"></span>using<span class="_ _66"> </span><span class="ff1a">read<span class="_ _47"> </span></span>and<span class="_ _66"> </span><span class="ff1a">write</span><span class="ls5c">,t<span class="_ _4f"></span><span class="ls0">hat <span class="_ _2"></span>is <span class="_ _2"></span>about <span class="_ _2"></span>all <span class="_ _3"></span>we <span class="_ _2"></span>can <span class="_ _2"></span>do</span></span></div><div class="t m0 x32 h2a y6d7 ff19 fsf fc0 sc0 ls0 ws0">with <span class="_ _3"></span>these <span class="_ _9"></span>two <span class="_ _9"></span>functions.<span class="_ _16"> </span>If <span class="_ _9"></span>we <span class="_ _9"></span>want <span class="_ _3"></span>to <span class="_ _9"></span>specify <span class="_ _3"></span>options, <span class="_ _9"></span>receive <span class="_ _3"></span>packets <span class="_ _9"></span>from <span class="_ _3"></span>multiple</div><div class="t m0 x32 h2a y6d8 ff19 fsf fc0 sc0 ls0 ws0">clients, <span class="_ _47"> </span>or <span class="_ _66"> </span>send <span class="_ _47"> </span>out-of-band <span class="_ _47"> </span>data, <span class="_ _47"> </span>we <span class="_ _66"> </span>need <span class="_ _47"> </span>to <span class="_ _47"> </span>use <span class="_ _47"> </span>one <span class="_ _66"> </span>of <span class="_ _47"> </span>the <span class="_ _47"> </span>six <span class="_ _47"> </span>socket <span class="_ _66"> </span>functions</div><div class="t m0 x32 h2a y6d9 ff19 fsf fc0 sc0 ls0 ws0">designed for data transfer<span class="_ _6"></span>.</div><div class="t m0 x3f h2a y6da ff19 fsf fc0 sc0 ls0 ws0">Three <span class="_ _2"></span>functions <span class="_ _3"></span>ar<span class="ls929">ea<span class="_ _8"></span><span class="ls0">vailable <span class="_ _3"></span>for <span class="_ _3"></span>sending <span class="_ _2"></span>data, <span class="_ _3"></span>and <span class="_ _3"></span>three <span class="_ _3"></span>ar<span class="ls8c2">ea<span class="_ _8"></span><span class="ls0">vailable <span class="_ _2"></span>for <span class="_ _3"></span>receiving</span></span></span></span></div><div class="t m0 x32 h2a y6db ff19 fsf fc0 sc0 ls0 ws0">data. <span class="_"> </span>First,<span class="_"> </span>we’ll look at the ones used to send data.</div><div class="t m0 x3f h26 y6dc ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _9"></span>simplest <span class="_ _23"></span>one <span class="_ _9"></span>is<span class="_ _35"> </span><span class="ff1a">send</span><span class="ls1355">.I<span class="_ _26"></span><span class="ls0">t<span class="_ _45"> </span>is<span class="_ _35"> </span>similar <span class="_ _9"></span>to<span class="_ _45"> </span><span class="ff1a">write</span><span class="lse13">,b<span class="_ _b"></span><span class="ls0">ut <span class="_ _23"></span>allows <span class="_ _9"></span>us <span class="_ _23"></span>to <span class="_ _9"></span>specify <span class="_ _23"></span>ﬂags <span class="_ _9"></span>to</span></span></span></span></div><div class="t m0 x32 h2a y6dd ff19 fsf fc0 sc0 ls0 ws0">change how the data we want to transmit is treated.</div><div class="t m0 x3f h57 y4909 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;sys/socket.h&gt;</div><div class="t m0 x3f h57 y490a ff1a fs2d fc0 sc0 ls0 ws0">ssize_t send(int<span class="_"> </span><span class="ff1b">sockfd</span><span class="ls15c">,c<span class="_ _1d"></span><span class="ls0">onst void *<span class="ff1b">buf</span><span class="ls15c">,s<span class="_ _5b"></span><span class="ls0">ize_t<span class="_"> </span><span class="ff1b">nbytes</span><span class="ls15c">,i<span class="_ _1d"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">ﬂags</span>);</span></span></span></span></span></span></div><div class="t m0 x1d8 h5f y490b ff19 fs2d fc0 sc0 ls0 ws0">Returns: number of bytes sent if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h4d y490c ff19 fs26 fc0 sc0 ls0 ws0">Like<span class="_ _47"> </span><span class="ff1a">write</span><span class="ls1356">,t<span class="_ _8"></span><span class="ls0">he <span class="_ _3"></span>socket <span class="_ _3"></span>has <span class="_ _2"></span>to <span class="_ _3"></span>be <span class="_ _3"></span>connected <span class="_ _3"></span>to <span class="_ _2"></span>use<span class="_ _47"> </span><span class="ff1a">send</span><span class="ls1357">.T<span class="_ _5b"></span><span class="ls0">he<span class="_ _47"> </span><span class="ff1b">buf<span class="_ _47"> </span></span>and<span class="_ _47"> </span><span class="ff1b">nbytes<span class="_ _66"> </span></span>arguments</span></span></span></span></div><div class="t m0 x32 h4d y490d ff19 fs26 fc0 sc0 ls0 ws0">have the same meaning as they do with<span class="_"> </span><span class="ff1a">write</span>.</div><div class="t m0 x3f h4d y490e ff19 fs26 fc0 sc0 ls0 ws0">Unlike<span class="_ _44"> </span><span class="ff1a">write</span><span class="ls1358">,h<span class="_ _c"></span><span class="ls0">owever<span class="_ _1"></span>,<span class="_ _44"> </span><span class="ff1a">send<span class="_ _44"> </span></span>supports <span class="_ _53"> </span>a <span class="_ _53"> </span>fourth<span class="_ _44"> </span><span class="ff1b">ﬂags<span class="_ _44"> </span></span>argument. <span class="_ _44"> </span>Three <span class="_ _42"> </span>ﬂags <span class="_ _53"> </span>are</span></span></div><div class="t m0 x32 h49 y490f ff19 fs26 fc0 sc0 ls0 ws0">deﬁned <span class="_ _e"> </span>by <span class="_"> </span>the <span class="_ _53"> </span>Single <span class="_"> </span>UNIX <span class="_ _53"> </span>Speciﬁcation, <span class="_"> </span>but <span class="_ _53"> </span>it <span class="_"> </span>is <span class="_ _53"> </span>common <span class="_"> </span>for <span class="_ _53"> </span>implementations <span class="_"> </span>to</div><div class="t m0 x32 h49 y4910 ff19 fs26 fc0 sc0 ls0 ws0">support additional ones.<span class="_ _59"> </span>They ar<span class="lsd3">es<span class="_ _d"></span><span class="ls0">ummarized in Figur<span class="lsd3">e1<span class="_ _d"></span><span class="ls0">6.13.</span></span></span></span></div><div class="t m0 x3f h4d y4911 ff19 fs26 fc0 sc0 ls0 ws0">If<span class="_"> </span><span class="ff1a">send<span class="_ _66"> </span></span><span class="lscc">re</span>turns <span class="_ _2"></span>success, it <span class="_ _2"></span>doesn’t necessarily <span class="_ _2"></span>mean that the <span class="_ _2"></span>process at the other <span class="_ _2"></span>end</div><div class="t m0 x32 h4d y4912 ff19 fs26 fc0 sc0 ls0 ws0">of <span class="_ _2"></span>the <span class="_ _2"></span>connection <span class="_ _3"></span>receives the <span class="_ _3"></span>data.<span class="_ _61"> </span>All <span class="_ _2"></span>we <span class="_ _3"></span>ar<span class="ls7f2">eg<span class="_ _8"></span><span class="ls0">uaranteed <span class="_ _2"></span>is <span class="_ _3"></span>that <span class="_ _2"></span>when<span class="_ _47"> </span><span class="ff1a">send<span class="_ _66"> </span></span>succeeds,</span></span></div><div class="t m0 x32 h49 y4913 ff19 fs26 fc0 sc0 ls0 ws0">the data has been delivered to the network drivers without err<span class="_ _0"></span>or<span class="_ _6"></span>.</div><div class="t m0 x3f h49 y4914 ff19 fs26 fc0 sc0 ls3aa ws0">Wi<span class="_ _3"></span><span class="ls0">th <span class="_ _66"> </span>a <span class="_ _47"> </span>protocol <span class="_"> </span>that <span class="_ _47"> </span>supports <span class="_ _47"> </span>message <span class="_ _66"> </span>boundaries, <span class="_ _47"> </span>if <span class="_ _66"> </span>we <span class="_ _47"> </span>try <span class="_ _66"> </span>to <span class="_ _47"> </span>send <span class="_ _66"> </span>a <span class="_ _47"> </span>single</span></div><div class="t m0 x32 h4d y4915 ff19 fs26 fc0 sc0 ls0 ws0">message <span class="_"> </span>larger <span class="_"> </span>than <span class="_"> </span>the <span class="_ _66"> </span>maximum <span class="_ _66"> </span>supported <span class="_ _66"> </span>by <span class="_ _66"> </span>the <span class="_ _66"> </span>protocol,<span class="_ _46"> </span><span class="ff1a">send<span class="_ _46"> </span></span>will <span class="_"> </span>fail <span class="_ _66"> </span>with</div><div class="t m0 x32 h4d y4916 ff1a fs26 fc0 sc0 ls0 ws0">errno<span class="_ _45"> </span><span class="ff19">set <span class="_ _3"></span>to<span class="_ _45"> </span></span>EMSGSIZE<span class="ff19 ls1359">.W<span class="_ _7"></span><span class="ls0">ith <span class="_ _9"></span>a <span class="_ _9"></span>byte-stream <span class="_ _3"></span>protocol,<span class="_ _47"> </span><span class="ff1a">send<span class="_ _45"> </span></span>will <span class="_ _9"></span>block <span class="_ _9"></span>until <span class="_ _9"></span>the <span class="_ _3"></span>entire</span></span></div><div class="t m0 x32 h49 y4917 ff19 fs26 fc0 sc0 ls0 ws0">amount of data has been transmitted.</div><div class="t m0 x3f h4d y4918 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_"> </span><span class="ff1a">sendto<span class="_ _66"> </span></span>function <span class="_ _2"></span>is <span class="_ _2"></span>similar to<span class="_ _47"> </span><span class="ff1a">send</span><span class="lsccf">.T<span class="_ _5b"></span><span class="ls0">he difference is that<span class="_ _47"> </span><span class="ff1a">sendto<span class="_ _66"> </span></span>allows us <span class="_ _2"></span>to</span></span></div><div class="t m0 x32 h49 y4919 ff19 fs26 fc0 sc0 ls0 ws0">specify a destination address to be used with connectionless sockets.</div><div class="t m0 x3f h4e y491a ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;sys/socket.h&gt;</div><div class="t m0 x3f h4e y491b ff1a fs28 fc0 sc0 ls0 ws0">ssize_t sendto(int<span class="_"> </span><span class="ff1b">sockfd</span><span class="ls1b6">,c<span class="_ _1d"></span><span class="ls0">onst void *<span class="ff1b">buf</span><span class="ls1b6">,s<span class="_ _5b"></span><span class="ls0">ize_t<span class="_"> </span><span class="ff1b">nbytes</span><span class="ls1b6">,i<span class="_ _1d"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">ﬂags</span>,</span></span></span></span></span></span></div><div class="t m0 x12b h4e y491c ff1a fs28 fc0 sc0 ls0 ws0">const struct sockaddr *<span class="ff1b">destaddr</span><span class="ls1b6">,s<span class="_ _1d"></span><span class="ls0">ocklen_t<span class="_"> </span><span class="ff1b">destlen</span>);</span></span></div><div class="t m0 x1d8 h7c y491d ff19 fs28 fc0 sc0 ls0 ws0">Returns: number of bytes sent if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h55 y491e ff19 fs2c fc0 sc0 ls6a4 ws0">Wi<span class="_ _3"></span><span class="ls0">th <span class="_ _2"></span>a connection-oriented <span class="_ _2"></span>socket, <span class="_ _2"></span>the <span class="_ _2"></span>destination <span class="_ _2"></span>address is <span class="_ _2"></span>ignored, <span class="_ _2"></span>as <span class="_ _2"></span>the <span class="_ _2"></span>destination</span></div><div class="t m0 x32 h54 y491f ff19 fs2c fc0 sc0 ls0 ws0">is <span class="_ _23"></span>implied <span class="_ _23"></span>by <span class="_ _9"></span>the <span class="_ _23"> </span>connection.<span class="_ _51"> </span><span class="ls6a4">Wi<span class="_ _3"></span></span>th <span class="_ _23"> </span>a <span class="_ _23"></span>connectionless <span class="_ _23"></span>socket, <span class="_ _23"></span>we <span class="_ _23"></span>can’t <span class="_ _23"></span>use<span class="_ _45"> </span><span class="ff1a">send<span class="_ _35"> </span></span>unless</div><a class="l" href="#pf12" data-dest-detail='[18,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892409px;bottom:1236.288916px;width:115.607796px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
