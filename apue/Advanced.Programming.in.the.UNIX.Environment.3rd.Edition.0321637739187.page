<div id="pfbb" class="pf w4 h1f" data-page-no="bb"><div class="pc pcbb w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bgbb.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>5.8<span class="_ _1d9"> </span>Standar<span class="ls30a">dI<span class="_ _55"></span><span class="ls0">/O <span class="_"> </span>Efﬁciency<span class="_ _1b"> </span><span class="ff18">153</span></span></span></div><div class="t m0 x32 h2a y12f ff19 fsf fc0 sc0 ls0 ws0">buffer<span class="_ _6"></span><span class="ls6a7">.T<span class="_ _62"></span><span class="ls0">he <span class="_ _9"></span>buffer <span class="_ _2"></span>is <span class="_ _9"></span>terminated <span class="_ _3"></span>with <span class="_ _9"></span>a <span class="_ _3"></span>null <span class="_ _9"></span>byte.<span class="_ _16"> </span>If <span class="_ _9"></span>the <span class="_ _3"></span>line, <span class="_ _3"></span>including <span class="_ _9"></span>the <span class="_ _3"></span>terminating</span></span></div><div class="t m0 x32 h2b y130 ff19 fsf fc0 sc0 ls0 ws0">newline, <span class="_ _2"></span>is <span class="_ _2"></span>longer <span class="_ _2"></span>than<span class="_ _47"> </span><span class="ff1b">n<span class="_ _42"> </span><span class="ff20">−<span class="_ _42"> </span></span>1</span><span class="ls6a8">,o<span class="_ _d"></span><span class="ls0">nly <span class="_ _2"></span>a <span class="_ _2"></span>partial <span class="_ _2"></span>line <span class="_ _2"></span>is <span class="_ _3"></span>returned, but <span class="_ _2"></span>the <span class="_ _2"></span>buffer <span class="_ _2"></span>is <span class="_ _2"></span>always <span class="_ _2"></span>null</span></span></div><div class="t m0 x32 h26 y131 ff19 fsf fc0 sc0 ls0 ws0">terminated. <span class="_"> </span>Another<span class="_"> </span>call to<span class="_"> </span><span class="ff1a">fgets<span class="_ _80"> </span></span>will read what follows on the line.</div><div class="t m0 x3f h26 y132 ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _45"> </span><span class="ff1a">gets<span class="_ _47"> </span></span>function <span class="_ _9"></span>should <span class="_ _9"></span>never <span class="_ _9"></span>be <span class="_ _9"></span>used.<span class="_ _5a"> </span>The <span class="_ _9"></span>problem <span class="_ _3"></span>is <span class="_ _9"></span>that <span class="_ _9"></span>it <span class="_ _9"></span>doesn’t <span class="_ _9"></span>allow <span class="_ _9"></span>the</div><div class="t m0 x32 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">caller <span class="_ _9"></span>to <span class="_ _9"></span>specify <span class="_ _9"></span>the <span class="_ _9"></span>buffer <span class="_ _9"></span>size.<span class="_ _5a"> </span>This <span class="_ _9"></span>allows <span class="_ _9"></span>the <span class="_ _9"></span>buffer <span class="_ _9"></span>to <span class="_ _9"></span>overﬂow <span class="_ _9"></span>if <span class="_ _23"></span>the <span class="_ _9"></span>line <span class="_ _9"></span>is <span class="_ _9"></span>longer</div><div class="t m0 x32 h2a y134 ff19 fsf fc0 sc0 ls0 ws0">than <span class="_ _9"></span>the <span class="_ _9"></span>buffer<span class="_ _6"></span><span class="ls6a9">,w<span class="_ _b"></span><span class="ls0">riting <span class="_ _23"></span>over <span class="_ _9"></span>whatever <span class="_ _9"></span>happens <span class="_ _9"></span>to <span class="_ _23"></span>follow <span class="_ _9"></span>the <span class="_ _9"></span>buffer <span class="_ _9"></span>in <span class="_ _9"></span>memory<span class="_ _4"></span><span class="ls6aa">.F<span class="_ _62"></span><span class="ls0">or <span class="_ _9"></span>a</span></span></span></span></div><div class="t m0 x32 h2a y135 ff19 fsf fc0 sc0 ls0 ws0">description of <span class="_ _2"></span>how <span class="_ _2"></span>this <span class="_ _2"></span>ﬂaw <span class="_ _2"></span>was <span class="_ _2"></span>used <span class="_ _2"></span>as <span class="_ _2"></span>part <span class="_ _2"></span>of <span class="_ _2"></span>the <span class="_ _2"></span>Internet worm <span class="_ _2"></span>of <span class="_ _2"></span>1988, <span class="_ _2"></span>see <span class="_ _2"></span>the <span class="_ _2"></span>June</div><div class="t m0 x32 h2b y136 ff19 fsf fc0 sc0 ls0 ws0">1989 <span class="_ _3"></span>issue <span class="_ _9"></span>(vol. <span class="_ _3"></span>32, <span class="_ _9"></span>no. <span class="_ _3"></span>6) <span class="_ _3"></span>of<span class="_ _45"> </span><span class="ff1b">Communications <span class="_ _3"></span>of <span class="_ _9"></span>the <span class="_ _3"></span>ACM</span><span class="ls6ab">.A<span class="_ _1d"></span><span class="ls3ea">na<span class="_ _b"></span><span class="ls0">dditional <span class="_ _9"></span>differ<span class="_ _0"></span>ence <span class="_ _3"></span>with</span></span></span></div><div class="t m0 x32 h26 y137 ff1a fsf fc0 sc0 ls0 ws0">gets<span class="_ _80"> </span><span class="ff19">is that it doesn’t stor<span class="ls44">et<span class="_ _d"></span><span class="ls0">he newline in the buffer<span class="_ _6"></span><span class="ls44">,a<span class="_ _d"></span><span class="ls0">s<span class="_"> </span><span class="ff1a">fgets<span class="_ _66"> </span></span>does.</span></span></span></span></span></div><div class="t m0 x76 h51 y1571 ff19 fs2a fc0 sc0 ls0 ws0">This difference in <span class="_ _2"></span>newline <span class="_ _2"></span>handling <span class="_ _2"></span>between <span class="_ _2"></span>the <span class="_ _2"></span>two functions <span class="_ _2"></span>goes <span class="_ _2"></span>way <span class="_ _2"></span>back <span class="_ _2"></span>in <span class="_ _2"></span>the <span class="_ _2"></span>evolution</div><div class="t m0 x76 h51 y1572 ff19 fs2a fc0 sc0 ls0 ws0">of the <span class="_ _2"></span>UNIX <span class="_ _2"></span>System.<span class="_ _44"> </span>Even <span class="_ _2"></span>the <span class="_ _2"></span>V<span class="_ _6"></span>ersion <span class="_ _2"></span>7 <span class="_ _2"></span>manual</div><div class="t m0 x187 h51 y1573 ff19 fs2a fc0 sc0 ls0 ws0">(</div><div class="t m0 x1c6 h51 y1572 ff19 fs2a fc0 sc0 ls0 ws0">1979</div><div class="t m0 x1a3 h51 y1573 ff19 fs2a fc0 sc0 ls0 ws0">)</div><div class="t m0 x181 h52 y1572 ff19 fs2a fc0 sc0 ls0 ws0">states ‘‘<span class="ff1a">gets<span class="_ _e"> </span></span>deletes <span class="_ _2"></span>a <span class="_ _2"></span>newline,<span class="_ _e"> </span><span class="ff1a">fgets</span></div><div class="t m0 x76 h51 y1574 ff19 fs2a fc0 sc0 ls0 ws0">keeps it, all in the name of backwar<span class="lse9">dc<span class="_ _5"></span><span class="ls0">ompatibility<span class="_ _6"></span>.’’</span></span></div><div class="t m0 x32 h26 y1575 ff19 fsf fc0 sc0 ls0 ws0">Even <span class="_"> </span>though <span class="_ _66"> </span>ISO <span class="_ _66"> </span>C <span class="_ _47"> </span>requir<span class="_ _1"></span>es <span class="_ _66"> </span>an <span class="_ _47"> </span>implementation <span class="_"> </span>to <span class="_ _66"> </span>provide<span class="_ _46"> </span><span class="ff1a">gets</span><span class="ls6ac">,y<span class="_ _5b"></span><span class="ls0">ou <span class="_ _66"> </span>should <span class="_ _47"> </span>use</span></span></div><div class="t m0 x32 h26 y1576 ff1a fsf fc0 sc0 ls0 ws0">fgets<span class="_ _45"> </span><span class="ff19">instead. <span class="_ _35"> </span>In<span class="_ _35"> </span>fact,<span class="_ _45"> </span></span>gets<span class="_ _35"> </span><span class="ff19">is <span class="_ _9"></span>marked <span class="_ _23"> </span>as <span class="_ _23"> </span>an <span class="_ _23"></span>obsolescent <span class="_ _23"></span>interface <span class="_ _23"></span>in <span class="_ _9"></span>SUSv4 <span class="_ _23"> </span>and <span class="_ _23"></span>has</span></div><div class="t m0 x32 h2a y1577 ff19 fsf fc0 sc0 ls0 ws0">been omitted from the latest version of the ISO C standar<span class="_ _0"></span><span class="ls44">d(<span class="_ _d"></span><span class="ls0">ISO/IEC 9899:201<span class="_ _1"></span>1).</span></span></div><div class="t m0 x3f h26 y1578 ff19 fsf fc0 sc0 ls0 ws0">Line-at-a-time output is provided by<span class="_"> </span><span class="ff1a">fputs<span class="_ _80"> </span></span>and<span class="_"> </span><span class="ff1a">puts</span>.</div><div class="t m0 x3f h57 y1579 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;stdio.h&gt;</div><div class="t m0 x3f h57 y157a ff1a fs2d fc0 sc0 ls0 ws0">int fputs(const char *restrict<span class="_"> </span><span class="ff1b">str</span><span class="ls15c">,F<span class="_ _1d"></span><span class="ls0">ILE *restrict<span class="_"> </span><span class="ff1b">fp</span>);</span></span></div><div class="t m0 x3f h57 y157b ff1a fs2d fc0 sc0 ls0 ws0">int puts(const char *<span class="ff1b">str</span>);</div><div class="t m0 x24 h57 y157c ff19 fs2d fc0 sc0 ls0 ws0">Both return: non-negative value if OK,<span class="_"> </span><span class="ff1a">EOF<span class="_ _e"> </span></span>on error</div><div class="t m0 x32 h4d y157d ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _3"></span>function<span class="_ _45"> </span><span class="ff1a">fputs<span class="_ _47"> </span></span>writes <span class="_ _9"></span>the <span class="_ _3"></span>null-terminated <span class="_ _9"></span>string <span class="_ _3"></span>to <span class="_ _9"></span>the <span class="_ _3"></span>speciﬁed <span class="_ _9"></span>stream. <span class="_ _47"> </span>The<span class="_ _47"> </span>null</div><div class="t m0 x32 h49 y157e ff19 fs26 fc0 sc0 ls0 ws0">byte at <span class="_ _2"></span>the <span class="_ _2"></span>end <span class="_ _2"></span>is not <span class="_ _2"></span>written.<span class="_ _61"> </span>Note that <span class="_ _2"></span>this <span class="_ _2"></span>need <span class="_ _2"></span>not be <span class="_ _2"></span>line-at-a-time <span class="_ _2"></span>output, <span class="_ _2"></span>since the</div><div class="t m0 x32 h49 y157f ff19 fs26 fc0 sc0 ls0 ws0">string <span class="_ _53"> </span>need <span class="_ _53"> </span>not <span class="_ _53"> </span>contain <span class="_ _53"> </span>a <span class="_ _53"> </span>newline <span class="_ _53"> </span>as <span class="_ _53"> </span>the <span class="_ _53"> </span>last <span class="_ _53"> </span>non-null <span class="_ _53"> </span>character<span class="_ _1"></span><span class="ls6ad">.U<span class="_ _52"></span><span class="ls0">sually<span class="_ _4"></span><span class="ls6ae">,t<span class="_ _c"></span><span class="ls0">his <span class="_ _53"> </span>is <span class="_ _53"> </span>the</span></span></span></span></div><div class="t m0 x32 h49 y1580 ff19 fs26 fc0 sc0 ls0 ws0">case <span class="_ _a"></span>— <span class="_ _a"></span>the<span class="_"> </span>last non-null character is a newline<span class="_ _9"></span><span class="ls161">—b<span class="_ _1"></span><span class="ls0">ut it’s not requir<span class="_ _1"></span>ed.</span></span></div><div class="t m0 x3f h4d y1581 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_"> </span><span class="ff1a">puts<span class="_ _80"> </span></span>function writes <span class="_ _2"></span>the null-terminated string to the standar<span class="ls6af">do<span class="_ _d"></span><span class="ls0">utput, without</span></span></div><div class="t m0 x32 h4d y1582 ff19 fs26 fc0 sc0 ls0 ws0">writing <span class="_ _2"></span>the <span class="_ _2"></span>null <span class="_ _2"></span>byte.<span class="_ _61"> </span>But<span class="_ _47"> </span><span class="ff1a">puts<span class="_ _66"> </span></span>then <span class="_ _2"></span>writes <span class="_ _3"></span>a <span class="_ _2"></span>newline <span class="_ _2"></span>character <span class="_ _2"></span>to <span class="_ _3"></span>the <span class="_ _2"></span>standar<span class="ls6b0">do<span class="_ _8"></span><span class="ls0">utput.</span></span></div><div class="t m0 x3f h4d y1583 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _4b"> </span><span class="ff1a">puts<span class="_ _59"> </span></span>function <span class="_"> </span>is <span class="_ _53"> </span>not <span class="_"> </span>unsafe, <span class="_ _53"> </span>like <span class="_"> </span>its <span class="_ _e"> </span>counterpart<span class="_ _4b"> </span><span class="ff1a">gets</span><span class="ls6b1">.N<span class="_ _64"></span><span class="ls0">evertheless, <span class="_"> </span>we’ll</span></span></div><div class="t m0 x32 h49 y1584 ff19 fs26 fc0 sc0 ls0 ws0">avoid <span class="_ _42"> </span>using <span class="_ _42"> </span>it, <span class="_ _53"> </span>to <span class="_ _42"> </span>prevent <span class="_ _42"> </span>having <span class="_ _42"> </span>to <span class="_ _53"> </span>remember <span class="_ _42"> </span>whether <span class="_ _42"> </span>it <span class="_ _42"> </span>appends <span class="_ _42"> </span>a <span class="_ _53"> </span>newline.<span class="_ _54"> </span>If <span class="_ _42"> </span>we</div><div class="t m0 x32 h4d y1585 ff19 fs26 fc0 sc0 ls0 ws0">always <span class="_ _3"></span>use<span class="_ _47"> </span><span class="ff1a">fgets<span class="_ _47"> </span></span>and<span class="_ _45"> </span><span class="ff1a">fputs</span>,<span class="_ _47"> </span>we<span class="_ _47"> </span>know <span class="_ _3"></span>that <span class="_ _3"></span>we <span class="_ _9"></span>always <span class="_ _3"></span>have <span class="_ _3"></span>to <span class="_ _3"></span>deal <span class="_ _3"></span>with <span class="_ _3"></span>the <span class="_ _9"></span>newline</div><div class="t m0 x32 h49 y1586 ff19 fs26 fc0 sc0 ls0 ws0">character at the end of each line.</div><div class="t m0 x35 h4b y1587 ff16 fs27 fc0 sc0 ls0 ws0">5.8 <span class="_ _68"> </span>Standar<span class="ls5d5">dI<span class="_ _64"></span><span class="ls0">/O <span class="_"> </span>Efﬁciency</span></span></div><div class="t m0 x32 h49 y1588 ff19 fs26 fc0 sc0 ls0 ws0">Using the <span class="_ _2"></span>functions from the previous section, <span class="_ _2"></span>we can <span class="_ _2"></span>get an <span class="_ _2"></span>idea of <span class="_ _2"></span>the efﬁciency of the</div><div class="t m0 x32 h49 y1589 ff19 fs26 fc0 sc0 ls0 ws0">standar<span class="ls343">dI<span class="_ _b"></span><span class="ls0">/O <span class="_ _3"></span>system.<span class="_ _5a"> </span>The <span class="_ _3"></span>program <span class="_ _2"></span>in <span class="_ _9"></span>Figur<span class="ls6b2">e5<span class="_ _b"></span><span class="ls0">.4 <span class="_ _3"></span>is <span class="_ _9"></span>like <span class="_ _3"></span>the <span class="_ _3"></span>one <span class="_ _9"></span>in <span class="_ _3"></span>Figur<span class="ls6b2">e3<span class="_ _b"></span><span class="ls0">.5: <span class="_ _9"></span>it <span class="_ _3"></span>simply</span></span></span></span></span></span></div><div class="t m0 x32 h4d y158a ff19 fs26 fc0 sc0 ls0 ws0">copies <span class="_ _23"></span>standar<span class="ls6b3">di<span class="_ _43"></span><span class="ls0">nput <span class="_ _23"></span>to <span class="_ _23"> </span>standar<span class="ls6b3">do<span class="_ _43"></span><span class="ls0">utput, <span class="_ _23"> </span>using<span class="_ _35"> </span><span class="ff1a">getc<span class="_ _35"> </span></span>and<span class="_ _35"> </span><span class="ff1a">putc</span><span class="ls6b4">.T<span class="_ _7"></span><span class="ls0">hese <span class="_ _23"></span>two <span class="_ _23"> </span>routines</span></span></span></span></span></span></div><div class="t m0 x32 h49 y158b ff19 fs26 fc0 sc0 ls0 ws0">can be implemented as macros.</div><a class="l" href="#pfe" data-dest-detail='[14,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.891576px;bottom:318.861895px;width:173.688194px;height:19.680007px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
