<div id="pf64" class="pf w4 h1f" data-page-no="64"><div class="pc pc64 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg64.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">66<span class="_ _1b"> </span><span class="ff19">File <span class="_"> </span>I/O<span class="_ _169"> </span>Chapter <span class="_"> </span>3</span></div><div class="t m0 x35 h75 y12f ff16 fs2b fc0 sc0 ls0 ws0">3.4<span class="_ _72"> </span><span class="ff1f">creat<span class="_ _54"> </span></span>Function</div><div class="t m0 x32 h26 y681 ff19 fsf fc0 sc0 ls44 ws0">An<span class="_ _d"></span><span class="ls0">ew ﬁle can also be created by calling the<span class="_"> </span><span class="ff1a">creat<span class="_ _80"> </span></span>function.</span></div><div class="t m0 x3f h57 ya79 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;fcntl.h&gt;</div><div class="t m0 x3f h57 ya7a ff1a fs2d fc0 sc0 ls0 ws0">int creat(const char *<span class="ff1b">path</span><span class="ls15c">,m<span class="_ _1d"></span><span class="ls0">ode_t<span class="_"> </span><span class="ff1b">mode</span>);</span></span></div><div class="t m0 xa7 h5f ya7b ff19 fs2d fc0 sc0 ls0 ws0">Returns: ﬁle descriptor opened for write-only if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h49 ya7c ff19 fs26 fc0 sc0 ls0 ws0">Note that this function is equivalent to</div><div class="t m0 x3f h4e ya7d ff1a fs28 fc0 sc0 ls0 ws0">open(<span class="ff1b">path</span><span class="ls1b6">,O<span class="_ _1d"></span><span class="ls0">_WRONLY | O_CREAT | O_TRUNC,<span class="_"> </span><span class="ff1b">mode</span>);</span></span></div><div class="t m0 x76 h5e ya7e ff19 fs10 fc0 sc0 ls0 ws0">Historically<span class="_ _6"></span>,<span class="_"> </span>in<span class="_ _e"> </span>early <span class="_ _2"></span>versions of <span class="_ _2"></span>the <span class="_ _2"></span>UNIX System, <span class="_ _2"></span>the second <span class="_ _2"></span>argument to<span class="_"> </span><span class="ff1a">open<span class="_ _e"> </span></span>could <span class="_ _2"></span>be only</div><div class="t m0 x76 h5e ya7f ff19 fs10 fc0 sc0 ls0 ws0">0, <span class="_ _23"> </span>1, <span class="_ _23"> </span>or <span class="_ _9"> </span>2.<span class="_ _61"> </span>Ther<span class="ls371">ew<span class="_ _b"></span><span class="ls0">as <span class="_ _23"> </span>no <span class="_ _23"> </span>way <span class="_ _23"> </span>to<span class="_ _47"> </span><span class="ff1a">open<span class="_ _45"> </span></span><span class="ls371">aﬁ<span class="_ _b"></span><span class="ls0">le <span class="_ _23"> </span>that <span class="_ _23"> </span>didn’t <span class="_ _23"> </span>already <span class="_ _23"> </span>exist.<span class="_ _46"> </span>Therefore, <span class="_ _9"></span>a <span class="_ _23"> </span>separate</span></span></span></span></div><div class="t m0 x76 h5e ya80 ff19 fs10 fc0 sc0 ls0 ws0">system <span class="_ _2"></span>call,<span class="_ _66"> </span><span class="ff1a">creat</span><span class="ls372">,w<span class="_ _d"></span><span class="ls0">as <span class="_ _3"></span>needed <span class="_ _2"></span>to <span class="_ _3"></span>create <span class="_ _2"></span>new <span class="_ _3"></span>ﬁles.<span class="_ _4b"> </span><span class="ls373">Wi<span class="_ _2"></span></span>th <span class="_ _3"></span>the<span class="_ _80"> </span><span class="ff1a">O_CREAT<span class="_ _66"> </span></span>and<span class="_ _80"> </span><span class="ff1a">O_TRUNC<span class="_ _80"> </span></span>options</span></span></div><div class="t m0 x76 h5e ya81 ff19 fs10 fc0 sc0 ls0 ws0">now provided by<span class="_"> </span><span class="ff1a">open</span><span class="ls136">,as<span class="_ _5"></span><span class="ls0">eparate<span class="_"> </span><span class="ff1a">creat<span class="_ _e"> </span></span>function is no longer needed.</span></span></div><div class="t m0 x32 h4a ya82 ff19 fs26 fc0 sc0 ls164 ws0">We<span class="_ _9"></span><span class="ls0">’ll <span class="_ _45"> </span>show <span class="_ _45"> </span>how <span class="_ _45"> </span>to <span class="_ _45"> </span>specify<span class="_ _5a"> </span><span class="ff1b">mode<span class="_ _5a"> </span></span>in <span class="_ _45"> </span>Section <span class="_ _45"> </span>4.5 <span class="_ _45"> </span>when <span class="_ _47"> </span>we <span class="_ _45"> </span>describe <span class="_ _45"> </span>a <span class="_ _45"> </span>ﬁle’s <span class="_ _45"> </span>access</span></div><div class="t m0 x32 h49 ya83 ff19 fs26 fc0 sc0 ls0 ws0">permissions in detail.</div><div class="t m0 x3f h4d ya84 ff19 fs26 fc0 sc0 ls0 ws0">One <span class="_ _23"> </span>deﬁciency <span class="_ _42"> </span>with<span class="_ _35"> </span><span class="ff1a">creat<span class="_ _35"> </span></span>is <span class="_ _23"> </span>that <span class="_ _42"> </span>the <span class="_ _23"></span>ﬁle <span class="_ _23"> </span>is <span class="_ _42"> </span>opened <span class="_ _23"> </span>only <span class="_ _23"> </span>for <span class="_ _42"> </span>writing.<span class="_ _51"> </span>Befor<span class="ls374">et<span class="_ _43"></span><span class="ls0">he</span></span></div><div class="t m0 x32 h4d ya85 ff19 fs26 fc0 sc0 ls0 ws0">new version of<span class="_"> </span><span class="ff1a">open<span class="_ _66"> </span></span>was provided, if we wer<span class="ls375">ec<span class="_ _d"></span><span class="lscc">re<span class="_ _2"></span><span class="ls0">ating a temporary ﬁle <span class="_ _2"></span>that we wanted</span></span></span></div><div class="t m0 x32 h4d ya86 ff19 fs26 fc0 sc0 ls0 ws0">to <span class="_ _23"> </span>write <span class="_ _23"> </span>and <span class="_ _42"> </span>then <span class="_ _23"></span>read <span class="_ _23"></span>back, <span class="_ _23"></span>we <span class="_ _23"> </span>had <span class="_ _23"> </span>to <span class="_ _42"> </span>call<span class="_ _35"> </span><span class="ff1a">creat</span>,<span class="_ _35"> </span><span class="ff1a">close</span><span class="ls376">,a<span class="_ _43"></span><span class="ls0">nd <span class="_ _23"> </span>then<span class="_ _35"> </span><span class="ff1a">open</span><span class="ls377">.A<span class="_ _5"></span><span class="ls0">better</span></span></span></span></div><div class="t m0 x32 h4d ya87 ff19 fs26 fc0 sc0 ls0 ws0">way is to use the<span class="_"> </span><span class="ff1a">open<span class="_ _80"> </span></span>function, as in</div><div class="t m0 x3f h4e ya88 ff1a fs28 fc0 sc0 ls0 ws0">open(<span class="ff1b">path</span><span class="ls1b6">,O<span class="_ _1d"></span><span class="ls0">_RDWR | O_CREAT | O_TRUNC,<span class="_"> </span><span class="ff1b">mode</span>);</span></span></div><div class="t m0 x35 h7b ya89 ff16 fs27 fc0 sc0 ls0 ws0">3.5<span class="_ _72"> </span><span class="ff1f">close<span class="_ _54"> </span></span>Function</div><div class="t m0 x32 h4d ya8a ff19 fs26 fc0 sc0 ls0 ws0">An open ﬁle is closed by calling the<span class="_"> </span><span class="ff1a">close<span class="_ _80"> </span></span>function.</div><div class="t m0 x3f h4e ya8b ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;unistd.h&gt;</div><div class="t m0 x3f h4e ya8c ff1a fs28 fc0 sc0 ls0 ws0">int close(int<span class="_"> </span><span class="ff1b">fd</span>);</div><div class="t m0 x153 h7c ya8d ff19 fs28 fc0 sc0 ls0 ws0">Returns: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h55 ya8e ff19 fs2c fc0 sc0 ls0 ws0">Closing <span class="_ _2"></span>a <span class="_ _3"></span>ﬁle <span class="_ _2"></span>also <span class="_ _3"></span>releases <span class="_ _2"></span>any <span class="_ _2"></span>recor<span class="ls378">dl<span class="_ _8"></span><span class="ls0">ocks <span class="_ _2"></span>that <span class="_ _3"></span>the <span class="_ _2"></span>process <span class="_ _2"></span>may <span class="_ _3"></span>have <span class="_ _2"></span>on <span class="_ _3"></span>the <span class="_ _2"></span>ﬁle.<span class="_ _16"> </span><span class="ls155">We<span class="_ _9"></span></span>’ll</span></span></div><div class="t m0 x32 h55 ya8f ff19 fs2c fc0 sc0 ls0 ws0">discuss this point further in Section 14.3.</div><div class="t m0 x3f h55 ya90 ff19 fs2c fc0 sc0 ls0 ws0">When <span class="_ _e"> </span>a <span class="_"> </span>pr<span class="_ _0"></span>ocess <span class="_ _e"> </span>terminates, <span class="_"> </span>all <span class="_ _53"> </span>of <span class="_"> </span>its <span class="_ _e"> </span>open <span class="_ _e"> </span>ﬁles <span class="_"> </span>ar<span class="_ _0"></span><span class="ls379">ec<span class="_ _55"></span><span class="ls0">losed <span class="_ _e"> </span>automatically <span class="_"> </span>by <span class="_ _53"> </span>the</span></span></div><div class="t m0 x32 h55 ya91 ff19 fs2c fc0 sc0 ls0 ws0">kernel. <span class="_ _66"> </span>Many<span class="_ _47"> </span>programs take <span class="_ _3"></span>advantage <span class="_ _2"></span>of <span class="_ _2"></span>this <span class="_ _3"></span>fact <span class="_ _2"></span>and <span class="_ _2"></span>don’t <span class="_ _3"></span>explicitly <span class="_ _2"></span>close <span class="_ _2"></span>open <span class="_ _3"></span>ﬁles.</div><div class="t m0 x32 h55 ya92 ff19 fs2c fc0 sc0 ls0 ws0">See the program in Figur<span class="_ _0"></span><span class="ls142">e1<span class="_ _d"></span><span class="ls0">.4, for example.</span></span></div><div class="t m0 x35 h7d ya93 ff16 fs3b fc0 sc0 ls0 ws0">3.6<span class="_ _72"> </span><span class="ff1f">lseek<span class="_ _54"> </span></span>Function</div><div class="t m0 x32 h55 ya94 ff19 fs2c fc0 sc0 ls0 ws0">Every <span class="_ _3"></span>open <span class="_ _9"></span>ﬁle <span class="_ _9"></span>has <span class="_ _9"></span>an <span class="_ _3"></span>associated <span class="_ _9"></span>‘‘curr<span class="_ _1"></span>ent <span class="_ _9"></span>ﬁle <span class="_ _9"></span>offset,’<span class="_ _1"></span><span class="ls37a">’n<span class="_ _8"></span><span class="ls0">ormally <span class="_ _9"></span>a <span class="_ _3"></span>non-negative <span class="_ _9"></span>integer</span></span></div><div class="t m0 x32 h55 ya95 ff19 fs2c fc0 sc0 ls0 ws0">that <span class="_ _23"></span>measures <span class="_ _9"></span>the <span class="_ _23"> </span>number <span class="_ _23"></span>of <span class="_ _23"></span>bytes <span class="_ _23"></span>from <span class="_ _9"></span>the <span class="_ _23"></span>beginning <span class="_ _23"></span>of <span class="_ _23"></span>the <span class="_ _23"></span>ﬁle.</div><div class="t m0 xe3 h55 ya96 ff19 fs2c fc0 sc0 ls0 ws0">(</div><div class="t m0 x151 h55 ya95 ff19 fs2c fc0 sc0 ls155 ws0">We <span class="_ _47"> </span>d<span class="_ _9"></span><span class="ls0">escribe <span class="_ _23"></span>some</span></div><div class="t m0 x32 h55 ya97 ff19 fs2c fc0 sc0 ls0 ws0">exceptions <span class="_ _35"> </span>to <span class="_ _45"> </span>the <span class="_ _35"> </span>‘<span class="_ _0"></span>‘non-negative’<span class="_ _1"></span><span class="ls37b">’q<span class="_ _26"></span><span class="ls0">ualiﬁer <span class="_ _35"> </span>later <span class="_ _45"> </span>in <span class="_ _35"> </span>this <span class="_ _35"> </span>section.)<span class="_ _5c"> </span>Read <span class="_ _45"> </span>and <span class="_ _35"> </span>write</span></span></div><div class="t m0 x32 h55 ya98 ff19 fs2c fc0 sc0 ls0 ws0">operations normally <span class="_ _2"></span>start at <span class="_ _2"></span>the current ﬁle offset and <span class="_ _2"></span>cause the <span class="_ _2"></span>offset to be <span class="_ _2"></span>incremented</div><div class="t m0 x32 h55 ya99 ff19 fs2c fc0 sc0 ls0 ws0">by <span class="_ _2"></span>the <span class="_ _3"></span>number <span class="_ _3"></span>of <span class="_ _3"></span>bytes <span class="_ _2"></span>read <span class="_ _2"></span>or <span class="_ _3"></span>written.<span class="_ _16"> </span>By <span class="_ _2"></span>default, <span class="_ _3"></span>this <span class="_ _3"></span>offset <span class="_ _2"></span>is <span class="_ _3"></span>initialized <span class="_ _2"></span>to <span class="_ _3"></span>0 <span class="_ _3"></span>when <span class="_ _3"></span>a</div><div class="t m0 x32 h54 ya9a ff19 fs2c fc0 sc0 ls0 ws0">ﬁle is opened, unless the<span class="_"> </span><span class="ff1a">O_APPEND<span class="_ _80"> </span></span>option is speciﬁed.</div><a class="l" href="#pfc" data-dest-detail='[12,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892409px;bottom:1236.288916px;width:129.335808px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfc" data-dest-detail='[12,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.893259px;bottom:633.588916px;width:129.335404px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfc" data-dest-detail='[12,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.893883px;bottom:281.628903px;width:129.336097px;height:19.680008px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
