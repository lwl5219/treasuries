<div id="pf35" class="pf w4 h1f" data-page-no="35"><div class="pc pc35 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg35.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>1.9<span class="_ _8f"> </span>Signals<span class="_ _1b"> </span><span class="ff18">19</span></div><div class="t m0 x32 h2a y12f ff19 fsf fc0 sc0 ls65 ws0">11 <span class="_"> </span>l<span class="_ _3"></span><span class="ls0">ines <span class="_ _23"> </span>to <span class="_ _23"></span>the <span class="_ _9"></span>program <span class="_ _9"></span>in <span class="_ _23"></span>Figur<span class="ls1b4">e1<span class="_ _43"></span><span class="ls0">.7 <span class="_ _23"> </span>gives <span class="_ _23"></span>us <span class="_ _9"></span>the <span class="_ _23"></span>version <span class="_ _9"></span>in <span class="_ _23"></span>Figur<span class="ls1b5">e1<span class="_ _43"></span><span class="ls0">.10. <span class="_ _35"> </span>(The<span class="_ _45"> </span><span class="ls65">11 <span class="_ _e"> </span>n<span class="_ _9"></span></span>ew</span></span></span></span></span></div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">lines ar<span class="ls44">ei<span class="_ _4f"></span><span class="ls0">ndicated with a plus sign at the beginning of the line.)</span></span></div><div class="t m0 xb8 h4e y4b6 ff1a fs28 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 xb8 h4e y4b7 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;sys/wait.h&gt;</div><div class="t m0 x32 h4e y4b8 ff1a fs28 fc0 sc0 ls1b6 ws0">+s<span class="_ _1d"></span><span class="ls0">tatic void sig_int(int);<span class="_ _90"> </span>/* our signal-catching function */</span></div><div class="t m0 x32 h4e y4b9 ff1a fs28 fc0 sc0 ls0 ws0">+</div><div class="t m0 xb8 h4e y4ba ff1a fs28 fc0 sc0 ls0 ws0">int</div><div class="t m0 xb8 h4e y4bb ff1a fs28 fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 xb8 h4e y4bc ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x15 h4e y4bd ff1a fs28 fc0 sc0 ls0 ws0">char <span class="_ _68"> </span>buf[MAXLINE];<span class="_ _87"> </span>/* from apue.h */</div><div class="t m0 x15 h4e y4be ff1a fs28 fc0 sc0 ls0 ws0">pid_t <span class="_ _3a"> </span>pid;</div><div class="t m0 x15 h4e y4bf ff1a fs28 fc0 sc0 ls0 ws0">int <span class="_ _15"> </span>status;</div><div class="t m0 x32 h4e y4c0 ff1a fs28 fc0 sc0 ls1b7 ws0">+i<span class="_ _91"></span><span class="ls1b6">f(<span class="_ _1d"></span><span class="ls0">signal(SIGINT, sig_int) == SIG_ERR)</span></span></div><div class="t m0 x32 h4e y4c1 ff1a fs28 fc0 sc0 ls1b8 ws0">+e<span class="_ _92"></span><span class="ls0">rr_sys(&quot;signal error&quot;);</span></div><div class="t m0 x32 h4e y4c2 ff1a fs28 fc0 sc0 ls0 ws0">+</div><div class="t m0 x15 h4e y4c3 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;%% &quot;);<span class="_ _3a"> </span>/* print prompt (printf requires %% to print %) */</div><div class="t m0 x15 h4e y4c4 ff1a fs28 fc0 sc0 ls0 ws0">while (fgets(buf, MAXLINE, stdin) != NULL) {</div><div class="t m0 x76 h4e y4c5 ff1a fs28 fc0 sc0 ls0 ws0">if (buf[strlen(buf) - 1] == ’\n’)</div><div class="t m0 xae h4e y4c6 ff1a fs28 fc0 sc0 ls0 ws0">buf[strlen(buf) - 1] = 0; /* replace newline with null */</div><div class="t m0 x76 h4e y4c7 ff1a fs28 fc0 sc0 ls0 ws0">if ((pid = fork()) &lt; 0) {</div><div class="t m0 xae h4e y4c8 ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;fork error&quot;);</div><div class="t m0 x76 h4e y4c9 ff1a fs28 fc0 sc0 ls1b6 ws0">}e<span class="_ _1d"></span><span class="ls0">lse if (pid == 0) {<span class="_ _88"> </span>/* child */</span></div><div class="t m0 xae h4e y4ca ff1a fs28 fc0 sc0 ls0 ws0">execlp(buf, buf, (char *)0);</div><div class="t m0 xae h4e y4cb ff1a fs28 fc0 sc0 ls0 ws0">err_ret(&quot;couldn’t execute: %s&quot;, buf);</div><div class="t m0 xae h4e y4cc ff1a fs28 fc0 sc0 ls0 ws0">exit(127);</div><div class="t m0 x76 h4e y4cd ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x76 h4e y4ce ff1a fs28 fc0 sc0 ls0 ws0">/* parent */</div><div class="t m0 x76 h4e y4cf ff1a fs28 fc0 sc0 ls0 ws0">if ((pid = waitpid(pid, &amp;status, 0)) &lt; 0)</div><div class="t m0 xae h4e y4d0 ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;waitpid error&quot;);</div><div class="t m0 x76 h4e y4d1 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;%% &quot;);</div><div class="t m0 x15 h4e y4d2 ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x15 h4e y4d3 ff1a fs28 fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 xb8 h4e y4d4 ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h4e y4d5 ff1a fs28 fc0 sc0 ls0 ws0">+</div><div class="t m0 x32 h4e y4d6 ff1a fs28 fc0 sc0 ls1b6 ws0">+v<span class="_ _1d"></span><span class="ls0">oid</span></div><div class="t m0 x32 h4e y4d7 ff1a fs28 fc0 sc0 ls1b6 ws0">+s<span class="_ _1d"></span><span class="ls0">ig_int(int signo)</span></div><div class="t m0 x32 h4e y4d8 ff1a fs28 fc0 sc0 ls1b6 ws0">+{</div><div class="t m0 x32 h4e y4d9 ff1a fs28 fc0 sc0 ls1b7 ws0">+p<span class="_ _91"></span><span class="ls0">rintf(&quot;interrupt\n%% &quot;);</span></div><div class="t m0 x32 h4e y4da ff1a fs28 fc0 sc0 ls1b6 ws0">+}</div><div class="t m0 xb9 h2e y4db ff18 fs11 fc0 sc0 ls0 ws0">Figure 1.10<span class="_ _5a"> </span><span class="ff19">Read commands from standar<span class="lsdb">di<span class="_ _5"></span><span class="ls0">nput and execute them</span></span></span></div><div class="t m0 x3f h55 y4dc ff19 fs2c fc0 sc0 ls0 ws0">In <span class="_ _2"></span>Chapter <span class="_ _3"></span>10, <span class="_ _2"></span>we’ll <span class="_ _3"></span>take <span class="_ _3"></span>a <span class="_ _2"></span>long <span class="_ _3"></span>look <span class="_ _3"></span>at <span class="_ _2"></span>signals, <span class="_ _3"></span>as <span class="_ _2"></span>most <span class="_ _3"></span>nontrivial <span class="_ _3"></span>applications <span class="_ _2"></span>deal</div><div class="t m0 x32 h55 y4dd ff19 fs2c fc0 sc0 ls0 ws0">with them.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
