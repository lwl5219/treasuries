<div id="pf298" class="pf w4 h1f" data-page-no="298"><div class="pc pc298 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg298.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">630<span class="_ _1b"> </span><span class="ff19">Advanced <span class="_"> </span>IPC<span class="_ _e8"> </span>Chapter <span class="_"> </span>17</span></div><div class="t m0 x3f h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;sys/socket.h&gt;</div><div class="t m0 x3f h57 y1334 ff1a fs2d fc0 sc0 ls0 ws0">int socketpair(int<span class="_"> </span><span class="ff1b">domain</span><span class="ls15c">,i<span class="_ _1d"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">type</span><span class="ls15c">,i<span class="_ _5b"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">protocol</span><span class="ls15c">,i<span class="_ _1d"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">sockfd</span>[2]);</span></span></span></span></span></span></div><div class="t m0 x153 h5f y4af7 ff19 fs2d fc0 sc0 ls0 ws0">Returns: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h4d y4af8 ff19 fs26 fc0 sc0 ls0 ws0">Although <span class="_ _53"> </span>the <span class="_ _53"> </span>interface <span class="_ _53"> </span>is <span class="_ _53"> </span>sufﬁciently <span class="_ _53"> </span>general <span class="_ _53"> </span>to <span class="_ _53"> </span>allow<span class="_ _4b"> </span><span class="ff1a">socketpair<span class="_ _44"> </span></span>to <span class="_ _53"> </span>be <span class="_ _e"> </span>used <span class="_ _53"> </span>with</div><div class="t m0 x32 h49 y4af9 ff19 fs26 fc0 sc0 ls0 ws0">other <span class="_ _2"></span>domains, <span class="_ _2"></span>operating <span class="_ _2"></span>systems <span class="_ _2"></span>typically <span class="_ _2"></span>provide support <span class="_ _2"></span>only <span class="_ _2"></span>for <span class="_ _2"></span>the <span class="_ _2"></span>UNIX <span class="_ _3"></span>domain.</div><div class="t m0 xb6 h2e y4afa ff19 fs11 fc0 sc0 ls0 ws0">socket</div><div class="t m0 x74 h2f y4afb ff19 fs12 fc0 sc0 ls0 ws0">socket</div><div class="t m0 x226 h70 y4afc ff1a fs16 fc0 sc0 ls0 ws0">fd[0]<span class="_ _1c3"> </span>fd[1]</div><div class="t m0 x87 h34 y4afd ff19 fs17 fc0 sc0 ls0 ws0">user process</div><div class="t m0 x15f h34 y4afe ff18 fs17 fc0 sc0 ls0 ws0">Figure 17.1<span class="_ _5a"> </span><span class="ff19 lsad3">As<span class="_ _84"></span><span class="ls0">ocket pair</span></span></div><div class="t m0 x3f hcd y4aff ff19 fs6e fc0 sc0 ls13a0 ws0">Ap<span class="_ _d"></span><span class="ls0">air of connected <span class="_ _2"></span>UNIX domain sockets acts <span class="_ _2"></span>like a full-duplex pipe: <span class="_ _2"></span>both ends are</span></div><div class="t m0 x32 hcd y4b00 ff19 fs6e fc0 sc0 ls0 ws0">open <span class="_ _53"> </span>for <span class="_ _53"> </span>reading <span class="_ _42"> </span>and <span class="_ _53"> </span>writing <span class="_ _53"> </span>(see <span class="_ _53"> </span>Figur<span class="ls13a1">e1<span class="_ _55"></span><span class="ls0">7.1). <span class="_ _4b"> </span>W<span class="_ _6"></span>e’ll <span class="_ _53"> </span>refer <span class="_ _42"> </span>to <span class="_ _53"> </span>these <span class="_ _53"> </span>as <span class="_ _53"> </span>‘<span class="_ _0"></span>‘fd-pipes’<span class="_ _1"></span><span class="ls13a1">’t<span class="_ _43"></span><span class="ls0">o</span></span></span></span></div><div class="t m0 x32 hcd y4b01 ff19 fs6e fc0 sc0 ls0 ws0">distinguish them from normal, half-duplex pipes.</div><div class="t m0 x35 h138 y4b02 ff16 fs6e fc0 sc0 ls0 ws0">Example <span class="_ _84"></span>—<span class="_ _9"></span><span class="ff1f">fd_pipe<span class="_ _66"> </span></span>Function</div><div class="t m0 x32 h138 y4b03 ff19 fs6e fc0 sc0 ls0 ws0">Figur<span class="ls13a2">e1<span class="_ _5b"></span><span class="ls0">7.2 <span class="_"> </span>shows <span class="_"> </span>the<span class="_ _59"> </span><span class="ff1a">fd_pipe<span class="_ _46"> </span></span>function, <span class="_"> </span>which <span class="_"> </span>uses <span class="_ _e"> </span>the<span class="_ _46"> </span><span class="ff1a">socketpair<span class="_ _59"> </span></span>function <span class="_"> </span>to</span></span></div><div class="t m0 x32 hcd y4b04 ff19 fs6e fc0 sc0 ls0 ws0">create a pair of connected UNIX domain str<span class="_ _0"></span>eam sockets.</div><div class="t m0 x32 h110 y4b05 ff1a fs92 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h110 y4b06 ff1a fs92 fc0 sc0 ls0 ws0">#include &lt;sys/socket.h&gt;</div><div class="t m0 x32 h110 y4b07 ff1a fs92 fc0 sc0 ls0 ws0">/*</div><div class="t m0 x140 h110 y4b08 ff1a fs92 fc0 sc0 ls13a3 ws0">*R<span class="_ _1d"></span><span class="ls0">eturns a full-duplex pipe (a UNIX domain socket) with</span></div><div class="t m0 x140 h110 y4b09 ff1a fs92 fc0 sc0 ls13a3 ws0">*t<span class="_ _1d"></span><span class="ls0">he two file descriptors returned in fd[0] and fd[1].</span></div><div class="t m0 x140 h110 y4b0a ff1a fs92 fc0 sc0 ls0 ws0">*/</div><div class="t m0 x32 h110 y4b0b ff1a fs92 fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h110 y4b0c ff1a fs92 fc0 sc0 ls0 ws0">fd_pipe(int fd[2])</div><div class="t m0 x32 h110 y4b0d ff1a fs92 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h110 y4b0e ff1a fs92 fc0 sc0 ls0 ws0">return(socketpair(AF_UNIX, SOCK_STREAM, 0, fd));</div><div class="t m0 x32 h110 y4b0f ff1a fs92 fc0 sc0 ls0 ws0">}</div><div class="t m0 x123 h36 y4b10 ff18 fs19 fc0 sc0 ls0 ws0">Figure 17.2<span class="_ _5a"> </span><span class="ff19">Creating a full-duplex pipe</span></div><div class="t m0 x76 h36 y4b11 ff19 fs19 fc0 sc0 ls0 ws0">Some <span class="_ _9"></span>BSD</div><div class="t m0 x4 h36 y4b12 ff19 fs19 fc0 sc0 ls0 ws0">-</div><div class="t m0 xea hd5 y4b11 ff19 fs19 fc0 sc0 ls0 ws0">based <span class="_ _9"></span>systems <span class="_ _9"> </span>use <span class="_ _23"> </span>UNIX <span class="_ _9"></span>domain <span class="_ _9"> </span>sockets <span class="_ _23"> </span>to <span class="_ _9"></span>implement <span class="_ _9"> </span>pipes.<span class="_ _46"> </span>But <span class="_ _9"> </span>when<span class="_ _47"> </span><span class="ff1a">pipe<span class="_ _47"> </span></span>is</div><div class="t m0 x76 h36 y4b13 ff19 fs19 fc0 sc0 ls0 ws0">called, <span class="_ _2"></span>the <span class="_ _3"></span>write <span class="_ _3"></span>end <span class="_ _3"></span>of <span class="_ _3"></span>the <span class="_ _2"></span>ﬁrst <span class="_ _3"></span>descriptor <span class="_ _3"></span>and <span class="_ _3"></span>the <span class="_ _3"></span>read <span class="_ _2"></span>end <span class="_ _3"></span>of <span class="_ _3"></span>the <span class="_ _2"></span>second <span class="_ _3"></span>descriptor <span class="_ _3"></span>ar<span class="ls13a4">eb<span class="_ _d"></span><span class="ls0">oth</span></span></div><div class="t m0 x76 hd5 y4b14 ff19 fs19 fc0 sc0 ls0 ws0">closed. <span class="_"> </span>T<span class="_ _6"></span><span class="ls9ba">og<span class="_ _84"></span><span class="ls0">et a full-duplex pipe, we must call<span class="_"> </span><span class="ff1a">socketpair<span class="_ _e"> </span></span>directly<span class="_ _6"></span>.</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
