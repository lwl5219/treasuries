<div id="pf191" class="pf w4 h1f" data-page-no="191"><div class="pc pc191 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg191.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h7a ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>10.18<span class="_ _27b"> </span><span class="ff1a">system<span class="_ _4b"> </span></span>Function<span class="_ _1b"> </span><span class="ff18">367</span></div><div class="t m0 x32 h2a y12f ff19 fsf fc0 sc0 ls5f ws0">We <span class="_ _66"> </span>ﬁ<span class="_ _23"></span><span class="ls0">rst <span class="_ _9"></span>see <span class="_ _23"></span>whether <span class="_ _23"></span>the <span class="_ _9"></span>default <span class="_ _23"></span>action <span class="_ _9"></span>will <span class="_ _23"> </span>occur; <span class="_ _23"></span>if <span class="_ _9"></span>so, <span class="_ _23"></span>we <span class="_ _23"></span>ﬂush <span class="_ _9"></span>all <span class="_ _23"></span>the <span class="_ _9"></span>standar<span class="lsd02">dI<span class="_ _b"></span><span class="ls0">/O</span></span></span></div><div class="t m0 x32 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">streams. <span class="_ _47"> </span>This<span class="_ _45"> </span>is <span class="_ _9"></span>not <span class="_ _3"></span>equivalent <span class="_ _9"></span>to <span class="_ _9"></span>calling<span class="_ _45"> </span><span class="ff1a">fclose<span class="_ _45"> </span></span>on <span class="_ _3"></span>all <span class="_ _9"></span>the <span class="_ _9"></span>open <span class="_ _9"></span>streams <span class="_ _3"></span>(since <span class="_ _9"></span>it <span class="_ _9"></span>just</div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">ﬂushes <span class="_ _e"> </span>them <span class="_ _e"> </span>and <span class="_"> </span>doesn’t <span class="_ _53"> </span>close <span class="_"> </span>them), <span class="_ _53"> </span>but <span class="_"> </span>when <span class="_ _53"> </span>the <span class="_"> </span>pr<span class="_ _0"></span>ocess <span class="_ _e"> </span>terminates, <span class="_ _e"> </span>the <span class="_"> </span>system</div><div class="t m0 x32 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">closes <span class="_ _e"> </span>all <span class="_"> </span>open <span class="_ _e"> </span>ﬁles.<span class="_ _48"> </span>If <span class="_"> </span>the <span class="_ _e"> </span>process <span class="_ _e"> </span>catches <span class="_"> </span>the <span class="_ _53"> </span>signal <span class="_"> </span>and <span class="_ _e"> </span>returns, <span class="_ _e"> </span>we <span class="_"> </span>ﬂush <span class="_ _e"> </span>all <span class="_"> </span>the</div><div class="t m0 x32 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">streams again, <span class="_ _2"></span>since <span class="_ _2"></span>the <span class="_ _2"></span>process could <span class="_ _2"></span>have <span class="_ _2"></span>generated <span class="_ _2"></span>mor<span class="lsd03">eo<span class="_ _4f"></span><span class="ls0">utput. <span class="_ _66"> </span>The<span class="_ _47"> </span>only <span class="_ _2"></span>condition</span></span></div><div class="t m0 x32 h26 y134 ff19 fsf fc0 sc0 ls0 ws0">we <span class="_ _42"> </span>don’t <span class="_ _42"> </span>handle <span class="_ _42"> </span>is <span class="_ _42"> </span>the <span class="_ _42"> </span>case <span class="_ _42"> </span>wher<span class="lsd04">et<span class="_ _43"></span><span class="ls0">he <span class="_ _23"> </span>process <span class="_ _42"> </span>catches <span class="_ _42"> </span>the <span class="_ _42"> </span>signal <span class="_ _42"> </span>and <span class="_ _42"> </span>calls<span class="_ _44"> </span><span class="ff1a">_exit<span class="_ _44"> </span></span>or</span></span></div><div class="t m0 x32 h26 y135 ff1a fsf fc0 sc0 ls0 ws0">_Exit<span class="ff19 lsd05">.I<span class="_ _1d"></span><span class="lsf8">nt<span class="_ _4f"></span><span class="ls0">his <span class="_ _2"></span>case, <span class="_ _3"></span>any <span class="_ _2"></span>unﬂushed <span class="_ _3"></span>standar<span class="lsf8">dI<span class="_ _8"></span><span class="ls0">/O <span class="_ _3"></span>buffers in <span class="_ _3"></span>memory <span class="_ _2"></span>ar<span class="lsbf9">ed<span class="_ _4f"></span><span class="ls0">iscarded. <span class="_"> </span>W<span class="_ _6"></span>e</span></span></span></span></span></span></span></div><div class="t m0 x32 h2a y136 ff19 fsf fc0 sc0 ls0 ws0">assume that a caller that does this doesn’t want the buffers ﬂushed.</div><div class="t m0 x3f h26 y137 ff19 fsf fc0 sc0 ls0 ws0">Recall from Section 10.9 that if calling<span class="_ _66"> </span><span class="ff1a">kill<span class="_ _66"> </span></span>causes the signal <span class="_ _2"></span>to be generated for <span class="_ _2"></span>the</div><div class="t m0 x32 h2a y138 ff19 fsf fc0 sc0 ls0 ws0">caller<span class="_ _6"></span><span class="lsd06">,a<span class="_ _b"></span><span class="ls0">nd <span class="_ _9"></span>if <span class="_ _42"> </span>the <span class="_ _23"> </span>signal <span class="_ _23"> </span>is <span class="_ _42"> </span>not <span class="_ _23"> </span>blocked <span class="_ _23"> </span>(which <span class="_ _42"> </span>we <span class="_ _23"></span>guarantee <span class="_ _23"> </span>in <span class="_ _23"> </span>Figur<span class="lsd07">e1<span class="_ _43"></span><span class="ls0">0.25), <span class="_ _42"> </span>then <span class="_ _23"></span>the</span></span></span></span></div><div class="t m0 x32 h26 y139 ff19 fsf fc0 sc0 ls0 ws0">signal <span class="_ _2"></span>(or <span class="_ _3"></span>some <span class="_ _2"></span>other <span class="_ _2"></span>pending, <span class="_ _3"></span>unlocked <span class="_ _2"></span>signal) <span class="_ _3"></span>is <span class="_ _2"></span>delivered <span class="_ _2"></span>to <span class="_ _3"></span>the <span class="_ _2"></span>process <span class="_ _2"></span>before<span class="_ _66"> </span><span class="ff1a">kill</span></div><div class="t m0 x32 h26 y13a ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">turns. <span class="_ _4b"> </span>W<span class="_ _6"></span><span class="lsd08">eb<span class="_ _c"></span><span class="ls0">lock <span class="_ _e"> </span>all <span class="_ _53"> </span>signals <span class="_ _e"> </span>except<span class="_ _4b"> </span><span class="ff1a">SIGABRT</span>,<span class="_ _4b"> </span>so<span class="_ _59"> </span>we<span class="_ _4b"> </span>know <span class="_ _53"> </span>that <span class="_ _e"> </span>if <span class="_ _e"> </span>the <span class="_ _e"> </span>call <span class="_ _53"> </span>to<span class="_ _4b"> </span><span class="ff1a">kill</span></span></span></span></div><div class="t m0 x32 h2a y254 ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">turns, the process caught the signal and the signal handler returned.</span></div><div class="t m0 x35 h7b y2f00 ff16 fs27 fc0 sc0 ls0 ws0">10.18<span class="_ _5a"> </span><span class="ff1f">system<span class="_ _54"> </span></span>Function</div><div class="t m0 x32 h4d y2f01 ff19 fs26 fc0 sc0 ls0 ws0">In <span class="_ _23"></span>Section <span class="_ _9"></span>8.13, <span class="_ _23"> </span>we <span class="_ _23"></span>showed <span class="_ _23"></span>an <span class="_ _9"></span>implementation <span class="_ _23"> </span>of <span class="_ _23"></span>the<span class="_ _45"> </span><span class="ff1a">system<span class="_ _35"> </span></span>function. <span class="_ _45"> </span>That<span class="_ _35"> </span>version,</div><div class="t m0 x32 h4d y2f02 ff19 fs26 fc0 sc0 ls0 ws0">however<span class="_ _6"></span><span class="lsd09">,d<span class="_ _5"></span><span class="ls0">id not do any signal handling.<span class="_ _46"> </span>POSIX.1 requir<span class="_ _0"></span>es that<span class="_"> </span><span class="ff1a">system<span class="_ _80"> </span></span>ignore<span class="_"> </span><span class="ff1a">SIGINT</span></span></span></div><div class="t m0 x32 h4d y2f03 ff19 fs26 fc0 sc0 ls0 ws0">and<span class="_ _66"> </span><span class="ff1a">SIGQUIT<span class="_ _47"> </span></span>and block<span class="_ _47"> </span><span class="ff1a">SIGCHLD</span><span class="lsd0a">.B<span class="_ _5b"></span><span class="ls0">efor<span class="lsd0b">es<span class="_ _8"></span><span class="ls0">howing <span class="_ _2"></span>a <span class="_ _2"></span>version <span class="_ _2"></span>that <span class="_ _2"></span>handles <span class="_ _3"></span>these <span class="_ _2"></span>signals</span></span></span></span></div><div class="t m0 x32 h49 y2f04 ff19 fs26 fc0 sc0 ls0 ws0">correctly<span class="_ _4"></span><span class="lsd3">,l<span class="_ _d"></span><span class="ls0">et’s see why we need to worry about signal handling.</span></span></div><div class="t m0 x35 h4c y2f05 ff16 fs26 fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h4d y2f06 ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _23"> </span>program <span class="_ _42"> </span>shown <span class="_ _23"> </span>in <span class="_ _42"> </span>Figur<span class="lsd0c">e1<span class="_ _43"></span><span class="ls0">0.26 <span class="_ _23"></span>uses <span class="_ _42"> </span>the <span class="_ _23"> </span>version <span class="_ _42"> </span>of<span class="_ _35"> </span><span class="ff1a">system<span class="_ _35"> </span></span>from <span class="_ _42"> </span>Section <span class="_ _23"> </span>8.13 <span class="_ _42"> </span>to</span></span></div><div class="t m0 x32 h4d y2f07 ff19 fs26 fc0 sc0 ls0 ws0">invoke the<span class="_ _66"> </span><span class="ff1a">ed</span></div><div class="t m0 x16e h49 y2f08 ff19 fs26 fc0 sc0 ls0 ws0">(</div><div class="t m0 x1f h49 y2f07 ff19 fs26 fc0 sc0 ls0 ws0">1</div><div class="t m0 x54 h49 y2f08 ff19 fs26 fc0 sc0 ls0 ws0">)</div><div class="t m0 xae h49 y2f07 ff19 fs26 fc0 sc0 ls0 ws0">editor<span class="_ _6"></span><span class="lsd0d">.(<span class="_ _4a"></span><span class="ls0">This editor <span class="_ _2"></span>has been <span class="_ _2"></span>part of <span class="_ _2"></span>UNIX systems <span class="_ _2"></span>for a <span class="_ _2"></span>long time.<span class="_ _61"> </span><span class="ls164">We</span></span></span></div><div class="t m0 x32 h49 y2f09 ff19 fs26 fc0 sc0 ls0 ws0">use <span class="_"> </span>it <span class="_ _e"> </span>her<span class="lsd0e">eb<span class="_ _4a"></span><span class="ls0">ecause <span class="_"> </span>it <span class="_ _e"> </span>is <span class="_"> </span>an <span class="_"> </span>interactive <span class="_ _e"> </span>program <span class="_ _e"> </span>that <span class="_"> </span>catches <span class="_ _e"> </span>the <span class="_"> </span>interrupt <span class="_ _e"> </span>and <span class="_"> </span>quit</span></span></div><div class="t m0 x32 h4d y2f0a ff19 fs26 fc0 sc0 ls0 ws0">signals. <span class="_ _35"> </span>If<span class="_ _44"> </span>we <span class="_ _42"> </span>invoke<span class="_ _44"> </span><span class="ff1a">ed<span class="_ _35"> </span></span>from <span class="_ _42"> </span>a <span class="_ _42"> </span>shell <span class="_ _42"> </span>and <span class="_ _42"> </span>type <span class="_ _42"> </span>the <span class="_ _42"> </span>interrupt <span class="_ _23"> </span>character<span class="_ _1"></span>,<span class="_ _44"> </span>it<span class="_ _35"> </span>catches <span class="_ _42"> </span>the</div><div class="t m0 x32 h4d y2f0b ff19 fs26 fc0 sc0 ls0 ws0">interrupt signal and prints a question mark.<span class="_ _46"> </span>The<span class="_"> </span><span class="ff1a">ed<span class="_ _66"> </span></span>program also sets the disposition of</div><div class="t m0 x32 h4d y2f0c ff19 fs26 fc0 sc0 ls0 ws0">the <span class="_ _3"></span>quit <span class="_ _3"></span>signal <span class="_ _3"></span>so <span class="_ _3"></span>that <span class="_ _3"></span>it <span class="_ _3"></span>is <span class="_ _3"></span>ignored.) <span class="_ _47"> </span>The<span class="_ _47"> </span>program <span class="_ _2"></span>in <span class="_ _3"></span>Figur<span class="lsd0f">e1<span class="_ _8"></span><span class="ls0">0.26 <span class="_ _3"></span>catches <span class="_ _3"></span>both<span class="_ _47"> </span><span class="ff1a">SIGINT</span></span></span></div><div class="t m0 x32 h4d y2f0d ff19 fs26 fc0 sc0 ls0 ws0">and<span class="_"> </span><span class="ff1a">SIGCHLD</span><span class="ls199">.I<span class="_ _4a"></span><span class="ls0">f<span class="_"> </span>we<span class="_"> </span>invoke the program, we get</span></span></div><div class="t m0 x3f h4e y2f0e ff1a fs28 fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">./a.out</span></div><div class="t m0 x3f h4e y2f0f ff1f fs28 fc0 sc0 ls0 ws0">a<span class="_ _168"> </span><span class="ff1b">append text to the editor<span class="_ _2"></span><span class="lsd10">’s <span class="_ _9"></span>b<span class="_ _3"></span></span>uffer</span></div><div class="t m0 x3f h4e y2f10 ff1f fs28 fc0 sc0 ls0 ws0">Here is one line of text</div><div class="t m0 x3f h4e y2f11 ff1f fs28 fc0 sc0 ls0 ws0">.<span class="_ _168"> </span><span class="ff1b">period on a line by itself stops append mode</span></div><div class="t m0 x3f h4e y2f12 ff1f fs28 fc0 sc0 ls0 ws0">1,$p<span class="_ _d1"> </span><span class="ff1b">print ﬁrst through last lines of buffer to see what’<span class="_ _1"></span><span class="ls396">st<span class="_ _5"></span><span class="ls0">here</span></span></span></div><div class="t m0 x3f h4e y2f13 ff1a fs28 fc0 sc0 ls0 ws0">Here is one line of text</div><div class="t m0 x3f h4e y2f14 ff1f fs28 fc0 sc0 ls1b6 ws0">wt<span class="_ _1d"></span><span class="ls0">emp.foo<span class="_ _191"> </span><span class="ff1b">write the buffer to a ﬁle</span></span></div><div class="t m0 x3f h4e y2f15 ff1a fs28 fc0 sc0 ls0 ws0">25<span class="_ _22c"> </span><span class="ff1b">editor says it wr<span class="_ _0"></span>ote 25 bytes</span></div><div class="t m0 x3f h4e y2f16 ff1f fs28 fc0 sc0 ls0 ws0">q<span class="_ _168"> </span><span class="ff1b">and leave the editor</span></div><div class="t m0 x3f h4e y2f17 ff1a fs28 fc0 sc0 ls0 ws0">caught SIGCHLD</div><div class="t m0 x32 h4d y2f18 ff19 fs26 fc0 sc0 ls0 ws0">When <span class="_ _42"> </span>the <span class="_ _42"> </span>editor <span class="_ _42"> </span>terminates, <span class="_ _42"> </span>the <span class="_ _53"> </span>system <span class="_ _42"> </span>sends <span class="_ _42"> </span>the<span class="_ _44"> </span><span class="ff1a">SIGCHLD<span class="_ _44"> </span></span>signal <span class="_ _42"> </span>to <span class="_ _42"> </span>the <span class="_ _42"> </span>parent <span class="_ _42"> </span>(the</div><div class="t m0 x32 h4d y2f19 ff1a fs26 fc0 sc0 ls0 ws0">a.out<span class="_ _66"> </span><span class="ff19">process). <span class="_ _66"> </span>W<span class="_ _6"></span><span class="ls63b">ec<span class="_ _4f"></span><span class="ls0">atch <span class="_ _2"></span>it <span class="_ _3"></span>and <span class="_ _2"></span>return from <span class="_ _2"></span>the <span class="_ _2"></span>signal <span class="_ _2"></span>handler<span class="_ _6"></span><span class="lsd11">.B<span class="_ _5b"></span><span class="ls0">ut <span class="_ _3"></span>if <span class="_ _2"></span>it <span class="_ _2"></span>is <span class="_ _2"></span>catching <span class="_ _2"></span>the</span></span></span></span></span></div><div class="t m0 x32 h4d y2f1a ff1a fs26 fc0 sc0 ls0 ws0">SIGCHLD<span class="_ _47"> </span><span class="ff19">signal, <span class="_ _3"></span>the <span class="_ _3"></span>parent <span class="_ _2"></span>should <span class="_ _9"></span>be <span class="_ _3"></span>doing <span class="_ _3"></span>so <span class="_ _3"></span>because <span class="_ _3"></span>it <span class="_ _3"></span>has <span class="_ _3"></span>created <span class="_ _3"></span>its <span class="_ _3"></span>own <span class="_ _3"></span>children,</span></div><div class="t m0 x32 h49 y2f1b ff19 fs26 fc0 sc0 ls0 ws0">so <span class="_ _9"></span>that <span class="_ _23"></span>it <span class="_ _9"></span>knows <span class="_ _23"> </span>when <span class="_ _23"></span>its <span class="_ _9"></span>children <span class="_ _9"></span>have <span class="_ _23"></span>terminated.<span class="_ _5a"> </span>The <span class="_ _23"></span>delivery <span class="_ _9"></span>of <span class="_ _23"> </span>this <span class="_ _23"></span>signal <span class="_ _9"></span>in <span class="_ _23"></span>the</div><a class="l" href="#pf10" data-dest-detail='[16,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892634px;bottom:850.731018px;width:136.535698px;height:19.678985px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
