<div id="pf16f" class="pf w4 h1f" data-page-no="16f"><div class="pc pc16f w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg16f.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h7a ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>10.7<span class="_ _e4"> </span><span class="ff1a">SIGCLD<span class="_ _4b"> </span></span>Semantics<span class="_ _1b"> </span><span class="ff18">333</span></div><div class="t m0 x3f h26 y12f ff19 fsf fc0 sc0 ls0 ws0">The semantics of the BSD<span class="_ _66"> </span><span class="ff1a">SIGCHLD<span class="_ _66"> </span></span>signal ar<span class="lsb66">en<span class="_ _4f"></span><span class="ls0">ormal, in <span class="_ _2"></span>the sense that its semantics</span></span></div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">ar<span class="ls5cd">es<span class="_ _8"></span><span class="ls0">imilar <span class="_ _2"></span>to <span class="_ _2"></span>those <span class="_ _2"></span>of <span class="_ _2"></span>all other <span class="_ _2"></span>signals.<span class="_ _61"> </span>When <span class="_ _2"></span>the signal <span class="_ _2"></span>occurs, <span class="_ _2"></span>the <span class="_ _2"></span>status <span class="_ _2"></span>of a <span class="_ _2"></span>child <span class="_ _2"></span>has</span></span></div><div class="t m0 x32 h26 y131 ff19 fsf fc0 sc0 ls0 ws0">changed, <span class="_ _47"> </span>and <span class="_ _45"> </span>we <span class="_ _47"> </span>need <span class="_ _47"> </span>to <span class="_ _45"> </span>call <span class="_ _47"> </span>one <span class="_ _47"> </span>of <span class="_ _45"> </span>the<span class="_ _16"> </span><span class="ff1a">wait<span class="_ _16"> </span></span>functions <span class="_ _47"> </span>to <span class="_ _45"> </span>determine <span class="_ _47"> </span>what <span class="_ _45"> </span>has</div><div class="t m0 x32 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">happened.</div><div class="t m0 x3f h26 y133 ff19 fsf fc0 sc0 ls0 ws0">System <span class="_ _42"> </span>V<span class="_ _4"></span><span class="lsc37">,h<span class="_ _43"></span><span class="ls0">owever<span class="_ _6"></span><span class="lsc37">,h<span class="_ _43"></span><span class="ls0">as <span class="_ _23"> </span>traditionally <span class="_ _42"> </span>handled <span class="_ _42"> </span>the<span class="_ _44"> </span><span class="ff1a">SIGCLD<span class="_ _44"> </span></span>signal <span class="_ _42"> </span>differ<span class="_ _1"></span>ently <span class="_ _42"> </span>from</span></span></span></span></div><div class="t m0 x32 h2a y134 ff19 fsf fc0 sc0 ls0 ws0">other <span class="_ _54"> </span>signals.<span class="_ _6e"> </span>SVR4</div><div class="t m0 x134 h2a y27e ff19 fsf fc0 sc0 ls0 ws0">-</div><div class="t m0 x91 h2a y134 ff19 fsf fc0 sc0 ls0 ws0">based <span class="_ _54"> </span>systems <span class="_ _65"> </span>continue <span class="_ _65"> </span>this <span class="_ _54"> </span>questionable <span class="_ _65"> </span>tradition <span class="_ _65"> </span>(i.e.,</div><div class="t m0 x32 h26 y135 ff19 fsf fc0 sc0 ls0 ws0">compatibility <span class="_ _23"></span>constraint) <span class="_ _9"></span>if <span class="_ _23"> </span>we <span class="_ _23"></span>set <span class="_ _23"></span>its <span class="_ _23"></span>disposition <span class="_ _9"></span>using <span class="_ _23"> </span>either<span class="_ _35"> </span><span class="ff1a">signal<span class="_ _45"> </span></span>or<span class="_ _35"> </span><span class="ff1a">sigset<span class="_ _45"> </span></span>(the</div><div class="t m0 x32 h2a y136 ff19 fsf fc0 sc0 ls0 ws0">older<span class="_ _6"></span><span class="ls2fc">,S<span class="_ _d"></span><span class="ls0">VR3-compatible <span class="_ _2"></span>functions to <span class="_ _2"></span>set <span class="_ _2"></span>the disposition <span class="_ _2"></span>of <span class="_ _2"></span>a signal).<span class="_ _61"> </span>This older <span class="_ _2"></span>handling</span></span></div><div class="t m0 x32 h26 y137 ff19 fsf fc0 sc0 ls0 ws0">of<span class="_"> </span><span class="ff1a">SIGCLD<span class="_ _80"> </span></span>consists of the following behavior:</div><div class="t m0 x3f h26 y2091 ff19 fsf fc0 sc0 ls0 ws0">1. <span class="_ _51"> </span>If<span class="_ _47"> </span>the <span class="_ _2"></span>process <span class="_ _2"></span>speciﬁcally <span class="_ _2"></span>sets <span class="_ _2"></span>its <span class="_ _3"></span>disposition <span class="_ _2"></span>to<span class="_ _47"> </span><span class="ff1a">SIG_IGN</span><span class="lsc01">,c<span class="_ _4f"></span><span class="ls0">hildren <span class="_ _2"></span>of <span class="_ _2"></span>the <span class="_ _3"></span>calling</span></span></div><div class="t m0 x41 h2a y17b ff19 fsf fc0 sc0 ls0 ws0">process <span class="_ _3"></span>will <span class="_ _23"></span>not <span class="_ _9"></span>generate <span class="_ _9"></span>zombie <span class="_ _23"></span>processes. <span class="_ _47"> </span>Note<span class="_ _35"> </span>that <span class="_ _9"></span>this <span class="_ _9"></span>is <span class="_ _9"></span>different <span class="_ _9"></span>from <span class="_ _3"></span>its</div><div class="t m0 x41 h26 y17c ff19 fsf fc0 sc0 ls0 ws0">default <span class="_ _9"></span>action <span class="_ _3"></span>(<span class="ff1a">SIG_DFL</span>), <span class="_ _9"></span>which <span class="_ _9"></span>from <span class="_ _3"></span>Figur<span class="lsc38">e1<span class="_ _b"></span><span class="ls0">0.1 <span class="_ _9"></span>is <span class="_ _9"></span>to <span class="_ _3"></span>be <span class="_ _9"></span>ignored. <span class="_ _45"> </span>Instead,<span class="_ _47"> </span>on</span></span></div><div class="t m0 x41 h2a y17d ff19 fsf fc0 sc0 ls0 ws0">termination, <span class="_ _9"></span>the <span class="_ _9"></span>status <span class="_ _23"></span>of <span class="_ _9"></span>these <span class="_ _23"></span>child <span class="_ _9"></span>processes <span class="_ _9"></span>is <span class="_ _9"></span>discarded. <span class="_ _45"> </span>If<span class="_ _45"> </span>it <span class="_ _9"></span>subsequently</div><div class="t m0 x41 h26 y17e ff19 fsf fc0 sc0 ls0 ws0">calls <span class="_ _66"> </span>one <span class="_ _47"> </span>of <span class="_ _47"> </span>the<span class="_ _61"> </span><span class="ff1a">wait<span class="_ _61"> </span></span>functions, <span class="_ _47"> </span>the <span class="_ _47"> </span>calling <span class="_ _47"> </span>process <span class="_"> </span>will <span class="_ _47"> </span>block <span class="_ _47"> </span>until <span class="_ _66"> </span>all <span class="_ _47"> </span>its</div><div class="t m0 x41 h26 y17f ff19 fsf fc0 sc0 ls0 ws0">children have <span class="_ _2"></span>terminated, <span class="_ _3"></span>and <span class="_ _2"></span>then<span class="_ _66"> </span><span class="ff1a">wait<span class="_ _47"> </span></span><span class="ls45">re</span>turns<span class="_ _47"> </span><span class="ff20">−</span><span class="lsc39">1w<span class="_ _4f"></span><span class="ls0">ith<span class="_ _47"> </span><span class="ff1a">errno<span class="_ _66"> </span></span>set <span class="_ _2"></span>to<span class="_ _47"> </span><span class="ff1a">ECHILD</span>.</span></span></div><div class="t m0 x41 h2a y180 ff19 fsf fc0 sc0 ls0 ws0">(The <span class="_ _9"></span>default <span class="_ _3"></span>disposition <span class="_ _9"></span>of <span class="_ _9"></span>this <span class="_ _9"></span>signal <span class="_ _9"></span>is <span class="_ _9"></span>to <span class="_ _9"></span>be <span class="_ _9"></span>ignored, <span class="_ _3"></span>but <span class="_ _9"></span>this <span class="_ _9"></span>default <span class="_ _9"></span>will <span class="_ _3"></span>not</div><div class="t m0 x41 h2a y181 ff19 fsf fc0 sc0 ls0 ws0">cause <span class="_ _9"></span>the <span class="_ _23"></span>preceding <span class="_ _9"></span>semantics <span class="_ _9"></span>to <span class="_ _23"></span>occur<span class="_ _6"></span><span class="lsc3a">.I<span class="_ _26"></span><span class="ls0">nstead, <span class="_ _23"></span>we <span class="_ _9"></span>speciﬁcally <span class="_ _23"></span>have <span class="_ _9"></span>to <span class="_ _23"></span>set <span class="_ _9"></span>its</span></span></div><div class="t m0 x41 h26 y182 ff19 fsf fc0 sc0 ls0 ws0">disposition to<span class="_"> </span><span class="ff1a">SIG_IGN</span>.)</div><div class="t m0 xf6 h52 y2ac1 ff19 fs2a fc0 sc0 ls0 ws0">POSIX.1 <span class="_ _23"> </span>does <span class="_ _23"> </span>not <span class="_ _9"> </span>specify <span class="_ _23"> </span>what <span class="_ _23"> </span>happens <span class="_ _23"> </span>when<span class="_ _45"> </span><span class="ff1a">SIGCHLD<span class="_ _47"> </span></span>is <span class="_ _23"> </span>ignored, <span class="_ _9"></span>so <span class="_ _23"> </span>this <span class="_ _23"> </span>behavior <span class="_ _23"> </span>is</div><div class="t m0 xf6 h52 y2ac2 ff19 fs2a fc0 sc0 ls0 ws0">allowed. <span class="_"> </span>The<span class="_"> </span>XSI option requir<span class="_ _0"></span>es this behavior to be supported for<span class="_"> </span><span class="ff1a">SIGCHLD</span>.</div><div class="t m0 xf6 h52 y2ac3 ff19 fs2a fc0 sc0 ls0 ws0">4.4BSD <span class="_ _9"></span>always <span class="_ _9"></span>generates <span class="_ _3"></span>zombies <span class="_ _9"> </span>if<span class="_ _47"> </span><span class="ff1a">SIGCHLD<span class="_ _66"> </span></span>is <span class="_ _9"> </span>ignored. <span class="_ _66"> </span>If<span class="_ _47"> </span>we <span class="_ _9"></span>want <span class="_ _9"></span>to <span class="_ _9"></span>avoid <span class="_ _3"></span>zombies,</div><div class="t m0 xf6 h52 y2ac4 ff19 fs2a fc0 sc0 ls0 ws0">we have to<span class="_ _80"> </span><span class="ff1a">wait<span class="_ _e"> </span></span>for our <span class="_ _2"></span>children. <span class="_"> </span>W<span class="_ _1"></span>ith <span class="_ _2"></span>SVR4, if <span class="_ _2"></span>either<span class="_"> </span><span class="ff1a">signal<span class="_ _e"> </span></span>or<span class="_ _80"> </span><span class="ff1a">sigset<span class="_ _e"> </span></span>is called <span class="_ _2"></span>to set</div><div class="t m0 xf6 h52 y2ac5 ff19 fs2a fc0 sc0 ls0 ws0">the <span class="_ _66"> </span>disposition <span class="_ _66"> </span>of<span class="_ _59"> </span><span class="ff1a">SIGCHLD<span class="_"> </span></span>to <span class="_ _66"> </span>be <span class="_ _66"> </span>ignored, <span class="_ _66"> </span>zombies <span class="_ _66"> </span>ar<span class="lsc3b">en<span class="_ _4a"></span><span class="ls0">ever <span class="_ _47"> </span>generated.<span class="_ _54"> </span>All <span class="_ _66"> </span>four</span></span></div><div class="t m0 xf6 h51 y2ac6 ff19 fs2a fc0 sc0 ls0 ws0">platforms described in this book follow SVR4 in this behavior<span class="_ _1"></span>.</div><div class="t m0 xf6 h52 y2ac7 ff19 fs2a fc0 sc0 ls341 ws0">Wi<span class="_ _2"></span><span class="ls0">th<span class="_ _47"> </span><span class="ff1a">sigaction</span>,<span class="_ _45"> </span>we<span class="_ _66"> </span>can <span class="_ _23"> </span>set <span class="_ _23"> </span>the<span class="_ _47"> </span><span class="ff1a">SA_NOCLDWAIT<span class="_ _47"> </span></span>ﬂag <span class="_ _9"> </span>(Figur<span class="lsc3c">e1<span class="_ _8"></span><span class="ls0">0.16) <span class="_ _23"> </span>to <span class="_ _9"></span>avoid <span class="_ _23"> </span>zombies.</span></span></span></div><div class="t m0 xf6 h51 y2ac8 ff19 fs2a fc0 sc0 ls0 ws0">This action is also supported on all four platforms.</div><div class="t m0 x3f h26 y2ac9 ff19 fsf fc0 sc0 ls0 ws0">2. <span class="_ _51"> </span>If<span class="_ _47"> </span>we <span class="_ _2"></span>set <span class="_ _2"></span>the <span class="_ _2"></span>disposition <span class="_ _3"></span>of<span class="_ _66"> </span><span class="ff1a">SIGCLD<span class="_ _47"> </span></span>to <span class="_ _2"></span>be <span class="_ _2"></span>caught, <span class="_ _3"></span>the <span class="_ _2"></span>kernel <span class="_ _2"></span>immediately <span class="_ _3"></span>checks</div><div class="t m0 x41 h26 y2aca ff19 fsf fc0 sc0 ls0 ws0">whether <span class="_ _53"> </span>any <span class="_ _53"> </span>child <span class="_ _e"> </span>processes <span class="_ _42"> </span>ar<span class="lsc3d">er<span class="_ _55"></span><span class="ls0">eady <span class="_ _53"> </span>to <span class="_ _e"> </span>be<span class="_ _4b"> </span><span class="ff1a">wait</span>ed <span class="_ _53"> </span>for <span class="_ _53"> </span>and, <span class="_ _e"> </span>if <span class="_ _53"> </span>so, <span class="_ _53"> </span>calls <span class="_ _e"> </span>the</span></span></div><div class="t m0 x41 h26 y2acb ff1a fsf fc0 sc0 ls0 ws0">SIGCLD<span class="_ _80"> </span><span class="ff19">handler<span class="_ _1"></span>.</span></div><div class="t m0 x32 h2a y2acc ff19 fsf fc0 sc0 ls0 ws0">Item 2 changes the way we have to write a signal handler for <span class="_ _2"></span>this signal, as illustrated in</div><div class="t m0 x32 h2a y2acd ff19 fsf fc0 sc0 ls0 ws0">the following example.</div><div class="t m0 x35 h27 y2ace ff16 fsf fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h2a y2acf ff19 fsf fc0 sc0 ls0 ws0">Recall <span class="_ _9"></span>from <span class="_ _3"></span>Section <span class="_ _9"></span>10.4 <span class="_ _9"></span>that <span class="_ _9"></span>the <span class="_ _9"></span>ﬁrst <span class="_ _9"></span>thing <span class="_ _9"></span>to <span class="_ _9"></span>do <span class="_ _9"></span>on <span class="_ _9"></span>entry <span class="_ _3"></span>to <span class="_ _9"></span>a <span class="_ _9"></span>signal <span class="_ _9"></span>handler <span class="_ _9"></span>is <span class="_ _9"></span>to <span class="_ _9"></span>call</div><div class="t m0 x32 h26 y2ad0 ff1a fsf fc0 sc0 ls0 ws0">signal<span class="_ _59"> </span><span class="ff19">again, <span class="_"> </span>to <span class="_ _e"> </span>reestablish <span class="_"> </span>the <span class="_ _e"> </span>handler<span class="_ _1"></span><span class="lsc3e">.(<span class="_ _5d"></span><span class="ls0">This <span class="_"> </span>action <span class="_"> </span>is <span class="_ _e"> </span>intended <span class="_"> </span>to <span class="_"> </span>minimize <span class="_ _e"> </span>the</span></span></span></div><div class="t m0 x32 h2a y2ad1 ff19 fsf fc0 sc0 ls0 ws0">window of time when the signal is reset back to its default and could get lost.)<span class="_ _46"> </span><span class="ls5f">We <span class="_ _53"> </span>s<span class="_ _9"></span></span>how</div><div class="t m0 x32 h2a y6b0 ff19 fsf fc0 sc0 ls0 ws0">this <span class="_ _2"></span>in <span class="_ _3"></span>Figur<span class="lsc3f">e1<span class="_ _8"></span><span class="ls0">0.6. <span class="_ _47"> </span>This<span class="_ _47"> </span>program <span class="_ _2"></span>doesn’t <span class="_ _3"></span>work <span class="_ _3"></span>on <span class="_ _3"></span>traditional <span class="_ _2"></span>System <span class="_ _3"></span>V <span class="_ _3"></span>platforms.<span class="_ _16"> </span>The</span></span></div><div class="t m0 x32 h26 y2ad2 ff19 fsf fc0 sc0 ls0 ws0">output <span class="_ _23"> </span>is <span class="_ _23"> </span>a <span class="_ _42"> </span>continual <span class="_ _23"> </span>string <span class="_ _23"> </span>of<span class="_ _35"> </span><span class="ff1a">SIGCLD <span class="_ _84"></span>received<span class="_ _35"> </span><span class="ff19">lines. <span class="_ _35"> </span>Eventually<span class="_ _6"></span><span class="lsc40">,t<span class="_ _43"></span><span class="ls0">he <span class="_ _23"> </span>process <span class="_ _23"></span>runs</span></span></span></span></div><div class="t m0 x32 h2a y2ad3 ff19 fsf fc0 sc0 ls0 ws0">out of stack space and terminates abnormally<span class="_ _4"></span>.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
