<div id="pff6" class="pf w4 h1f" data-page-no="f6"><div class="pc pcf6 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bgf6.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">212<span class="_ _1b"> </span><span class="ff19">Process <span class="_"> </span>Envir<span class="_ _0"></span>onment <span class="_ _1c1"> </span>Chapter<span class="_ _44"> </span>7</span></div><div class="t m0 x88 h51 y597 ff19 fs2a fc0 sc0 ls0 ws0">FreeBSD <span class="_ _7f"> </span>Linux <span class="_ _5e"> </span>Mac<span class="_"> </span>OS X<span class="_ _6e"> </span>Solaris</div><div class="t m0 x113 h51 y598 ff19 fs2a fc0 sc0 ls0 ws0">8.0 <span class="_ _129"> </span>3.2.0<span class="_ _79"> </span>10.6.8 <span class="_ _7a"> </span>10</div><div class="t m0 x125 h51 y599 ff19 fs2a fc0 sc0 ls0 ws0">Function<span class="_ _1c3"> </span>ISO C<span class="_ _6e"> </span>POSIX.1</div><div class="t m0 xaa h5e y59a ff1a fs10 fc0 sc0 ls0 ws0">getenv<span class="_ _171"> </span><span class="ff19 ls8af">•• <span class="_ _216"></span>•<span class="_ _2"></span><span class="ls8b0">•• <span class="_ _217"></span>•</span></span></div><div class="t m0 xaa h5e y59b ff1a fs10 fc0 sc0 ls0 ws0">putenv<span class="_ _1ec"> </span><span class="ff19">XSI <span class="_ _7b"> </span>•<span class="_ _88"> </span><span class="ls8b0">•• <span class="_ _217"></span>•</span></span></div><div class="t m0 xaa h5e y59c ff1a fs10 fc0 sc0 ls0 ws0">setenv<span class="_ _218"> </span><span class="ff19 ls8b1">••<span class="_ _c"></span><span class="ls8b0">••</span></span></div><div class="t m0 xaa h5e y59d ff1a fs10 fc0 sc0 ls0 ws0">unsetenv<span class="_ _219"> </span><span class="ff19 ls8b1">••<span class="_ _c"></span><span class="ls8b0">••</span></span></div><div class="t m0 xaa h5e y59e ff1a fs10 fc0 sc0 ls0 ws0">clearenv<span class="_ _19e"> </span><span class="ff19">•</span></div><div class="t m0 x4 h2e y15ae ff18 fs11 fc0 sc0 ls0 ws0">Figure 7.8<span class="_ _5a"> </span><span class="ff19">Support for various environment list functions</span></div><div class="t m0 x76 h4f y1c92 ff19 fs11 fc0 sc0 ls0 ws0">The<span class="_ _66"> </span><span class="ff1a">clearenv<span class="_ _66"> </span></span>function <span class="_ _3"></span>is <span class="_ _9"></span>not <span class="_ _3"></span>part <span class="_ _3"></span>of <span class="_ _9"></span>the <span class="_ _3"></span>Single <span class="_ _9"></span>UNIX <span class="_ _3"></span>Speciﬁcation.<span class="_ _59"> </span>It <span class="_ _3"></span>is <span class="_ _3"></span>used <span class="_ _9"></span>to <span class="_ _3"></span>remove <span class="_ _3"></span>all</div><div class="t m0 x76 h2e y1c93 ff19 fs11 fc0 sc0 ls0 ws0">entries from the envir<span class="_ _0"></span>onment list.</div><div class="t m0 x32 h55 y1c94 ff19 fs2c fc0 sc0 ls0 ws0">The prototypes for the middle thr<span class="_ _0"></span>ee functions listed in Figur<span class="_ _0"></span><span class="ls142">e7<span class="_ _d"></span><span class="ls0">.8 are</span></span></div><div class="t m0 x3f h5d y1c95 ff1a fs2f fc0 sc0 ls0 ws0">#include &lt;stdlib.h&gt;</div><div class="t m0 x3f h5d y1c96 ff1a fs2f fc0 sc0 ls0 ws0">int putenv(char *<span class="ff1b">str</span>);</div><div class="t m0 x81 hc2 y1c97 ff19 fs2f fc0 sc0 ls0 ws0">Returns: 0 if OK, nonzero<span class="_"> </span>on<span class="_"> </span>err<span class="_ _0"></span>or</div><div class="t m0 x3f h5d y1c98 ff1a fs2f fc0 sc0 ls0 ws0">int setenv(const char *<span class="ff1b">name</span><span class="ls395">,c<span class="_ _1d"></span><span class="ls0">onst char *<span class="ff1b">value</span><span class="ls395">,i<span class="_ _5b"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b ls8b2">re<span class="ls0">write</span></span>);</span></span></span></span></div><div class="t m0 x3f h5d y1c99 ff1a fs2f fc0 sc0 ls0 ws0">int unsetenv(const char *<span class="ff1b">name</span>);</div><div class="t m0 x1af hc2 y1c9a ff19 fs2f fc0 sc0 ls0 ws0">Both return: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>err<span class="_ _0"></span>or</div><div class="t m0 x32 h50 y1c9b ff19 fs29 fc0 sc0 ls0 ws0">The operation of these three functions is as follows:</div><div class="t m0 x3f h5c y1c9c ff19 fs29 fc0 sc0 ls3ac ws0">•T<span class="_ _4d"></span><span class="ls0">he<span class="_ _45"> </span><span class="ff1a">putenv<span class="_ _45"> </span></span>function <span class="_ _9"></span>takes <span class="_ _9"></span>a <span class="_ _9"></span>string <span class="_ _9"></span>of <span class="_ _9"></span>the <span class="_ _9"></span>form<span class="_ _45"> </span><span class="ff1b">name=value<span class="_ _45"> </span></span>and <span class="_ _9"></span>places <span class="_ _9"></span>it <span class="_ _9"></span>in <span class="_ _9"></span>the</span></div><div class="t m0 x15 h5b y1c9d ff19 fs29 fc0 sc0 ls0 ws0">environment list.<span class="_ _59"> </span>If<span class="_"> </span><span class="ff1b">name<span class="_"> </span></span>already exists, its old deﬁnition is ﬁrst r<span class="_ _0"></span>emoved.</div><div class="t m0 x3f h5c y1c9e ff19 fs29 fc0 sc0 ls3ac ws0">•T<span class="_ _4d"></span><span class="ls0">he<span class="_ _65"> </span><span class="ff1a">setenv<span class="_ _48"> </span></span>function <span class="_ _59"> </span>sets<span class="_ _65"> </span><span class="ff1b">name<span class="_ _48"> </span></span>to<span class="_ _48"> </span><span class="ff1b">value</span><span class="ls8b3">.I<span class="_ _da"></span><span class="ls0">f<span class="_ _48"> </span><span class="ff1b">name<span class="_ _48"> </span></span>already <span class="_ _44"> </span>exists <span class="_ _59"> </span>in <span class="_ _4b"> </span>the</span></span></span></div><div class="t m0 x15 h5b y1c9f ff19 fs29 fc0 sc0 ls0 ws0">environment, then (a) <span class="_ _2"></span>if<span class="_ _66"> </span><span class="ff1b lsdf">re<span class="_ _2"></span><span class="ls0">write<span class="_ _66"> </span></span></span>is <span class="_ _2"></span>nonzero, the existing <span class="_ _2"></span>deﬁnition <span class="_ _2"></span>for<span class="_"> </span><span class="ff1b">name<span class="_ _47"> </span></span>is ﬁrst</div><div class="t m0 x15 h5b y1ca0 ff19 fs29 fc0 sc0 lsdf ws0">re<span class="ls0">moved; <span class="_ _42"> </span>or <span class="_ _53"> </span>(b) <span class="_ _42"> </span>if<span class="_ _44"> </span></span><span class="ff1b">re<span class="ls0">write<span class="_ _44"> </span><span class="ff19">is <span class="_ _42"> </span>0, <span class="_ _53"> </span>an <span class="_ _42"> </span>existing <span class="_ _42"> </span>deﬁnition <span class="_ _42"> </span>for<span class="_ _44"> </span></span>name<span class="_ _44"> </span><span class="ff19">is <span class="_ _42"> </span>not <span class="_ _42"> </span>removed,</span></span></span></div><div class="t m0 x15 h5b y1ca1 ff1b fs29 fc0 sc0 ls0 ws0">name<span class="_"> </span><span class="ff19">is not set to the new<span class="_"> </span></span>value<span class="ff19 lsdd">,a<span class="_ _d"></span><span class="ls0">nd no error occurs.</span></span></div><div class="t m0 x3f h5c y1ca2 ff19 fs29 fc0 sc0 ls3ac ws0">•T<span class="_ _4d"></span><span class="ls0">he<span class="_ _44"> </span><span class="ff1a">unsetenv<span class="_ _44"> </span></span>function <span class="_ _53"> </span>removes <span class="_ _42"> </span>any <span class="_ _53"> </span>deﬁnition <span class="_ _53"> </span>of<span class="_ _4b"> </span><span class="ff1b">name</span><span class="ls8b4">.I<span class="_ _52"></span><span class="ls0">t<span class="_ _44"> </span>is<span class="_ _44"> </span>not <span class="_ _53"> </span>an <span class="_ _53"> </span>error <span class="_ _42"> </span>if</span></span></span></div><div class="t m0 x15 h50 y1ca3 ff19 fs29 fc0 sc0 ls0 ws0">such a deﬁnition does not exist.</div><div class="t m0 x76 h6d y1ca4 ff19 fs12 fc0 sc0 ls0 ws0">Note the <span class="_ _2"></span>difference between<span class="_"> </span><span class="ff1a">putenv<span class="_ _e"> </span></span>and<span class="_ _80"> </span><span class="ff1a">setenv</span><span class="ls8b5">.W<span class="_ _c"></span><span class="ls0">hereas<span class="_ _e"> </span><span class="ff1a">setenv<span class="_ _80"> </span></span>must allocate <span class="_ _2"></span>memory <span class="_ _2"></span>to</span></span></div><div class="t m0 x76 h6d y1ca5 ff19 fs12 fc0 sc0 ls0 ws0">create the<span class="_ _80"> </span><span class="ff1b">name=value<span class="_ _80"> </span></span>string <span class="_ _2"></span>from <span class="_ _2"></span>its <span class="_ _2"></span>arguments,<span class="_ _80"> </span><span class="ff1a">putenv<span class="_ _80"> </span></span>is <span class="_ _2"></span>free <span class="_ _2"></span>to <span class="_ _2"></span>place <span class="_ _2"></span>the <span class="_ _3"></span>string <span class="_ _2"></span>passed <span class="_ _2"></span>to <span class="_ _2"></span>it</div><div class="t m0 x76 h2f y1ca6 ff19 fs12 fc0 sc0 ls0 ws0">directly <span class="_ _2"></span>into <span class="_ _9"></span>the <span class="_ _3"></span>environment. <span class="_ _66"> </span>Indeed,<span class="_ _66"> </span>many <span class="_ _3"></span>implementations <span class="_ _9"></span>do <span class="_ _3"></span>exactly <span class="_ _3"></span>this, <span class="_ _9"></span>so <span class="_ _3"></span>it <span class="_ _3"></span>would <span class="_ _9"></span>be</div><div class="t m0 x76 h6d y1ca7 ff19 fs12 fc0 sc0 ls0 ws0">an <span class="_ _9"></span>error <span class="_ _9"></span>to <span class="_ _23"> </span>pass<span class="_ _47"> </span><span class="ff1a">putenv<span class="_ _47"> </span></span><span class="ls8b6">as<span class="_ _8"></span><span class="ls0">tring <span class="_ _23"> </span>allocated <span class="_ _9"></span>on <span class="_ _9"> </span>the <span class="_ _23"> </span>stack, <span class="_ _9"></span>since <span class="_ _23"> </span>the <span class="_ _9"></span>memory <span class="_ _23"> </span>would <span class="_ _9"></span>be <span class="_ _9"> </span>reused</span></span></div><div class="t m0 x76 h2f y1ca8 ff19 fs12 fc0 sc0 ls0 ws0">after we return fr<span class="_ _0"></span>om the current function.</div><div class="t m0 x3f h50 y1ca9 ff19 fs29 fc0 sc0 ls0 ws0">It <span class="_ _9"></span>is <span class="_ _9"></span>interesting <span class="_ _3"></span>to <span class="_ _23"></span>examine <span class="_ _3"></span>how <span class="_ _23"></span>these <span class="_ _9"></span>functions <span class="_ _9"></span>must <span class="_ _9"></span>operate <span class="_ _9"></span>when <span class="_ _9"></span>modifying <span class="_ _9"></span>the</div><div class="t m0 x32 h50 y1caa ff19 fs29 fc0 sc0 ls0 ws0">environment <span class="_ _9"></span>list.<span class="_ _51"> </span>Recall <span class="_ _9"></span>Figur<span class="ls8b7">e7<span class="_ _b"></span><span class="ls0">.6: <span class="_ _9"></span>the <span class="_ _23"></span>environment <span class="_ _9"></span>list<span class="_ _9"></span><span class="ls2d6">—t<span class="_ _1"></span><span class="ls0">he <span class="_ _9"></span>array <span class="_ _23"> </span>of <span class="_ _23"> </span>pointers <span class="_ _23"></span>to <span class="_ _23"></span>the</span></span></span></span></div><div class="t m0 x32 h5b y1cab ff19 fs29 fc0 sc0 ls0 ws0">actual<span class="_ _45"> </span><span class="ff1b">name=value<span class="_ _45"> </span></span>strings <span class="_ _a"></span>— <span class="_ _4"></span>and<span class="_ _45"> </span>the <span class="_ _9"></span>environment <span class="_ _3"></span>strings <span class="_ _23"></span>ar<span class="ls8b8">et<span class="_ _b"></span><span class="ls0">ypically <span class="_ _3"></span>stored <span class="_ _9"></span>at <span class="_ _9"></span>the <span class="_ _23"></span>top</span></span></div><div class="t m0 x32 h50 y1cac ff19 fs29 fc0 sc0 ls0 ws0">of <span class="_ _9"></span>a <span class="_ _3"></span>process’s <span class="_ _9"></span>memory <span class="_ _3"></span>space, <span class="_ _9"></span>above <span class="_ _9"></span>the <span class="_ _9"></span>stack.<span class="_ _5a"> </span>Deleting <span class="_ _3"></span>a <span class="_ _9"></span>string <span class="_ _9"></span>is <span class="_ _9"></span>simple; <span class="_ _9"></span>we <span class="_ _3"></span>just <span class="_ _9"></span>ﬁnd</div><div class="t m0 x32 h50 y1cad ff19 fs29 fc0 sc0 ls0 ws0">the <span class="_ _23"> </span>pointer <span class="_ _23"> </span>in <span class="_ _42"> </span>the <span class="_ _23"> </span>environment <span class="_ _23"> </span>list <span class="_ _23"> </span>and <span class="_ _42"> </span>move <span class="_ _23"> </span>all <span class="_ _23"> </span>subsequent <span class="_ _42"> </span>pointers <span class="_ _23"> </span>down <span class="_ _42"> </span>one.<span class="_ _51"> </span>But</div><div class="t m0 x32 h50 y1cae ff19 fs29 fc0 sc0 ls0 ws0">adding a <span class="_ _2"></span>string <span class="_ _2"></span>or <span class="_ _2"></span>modifying <span class="_ _2"></span>an <span class="_ _2"></span>existing <span class="_ _2"></span>string <span class="_ _2"></span>is <span class="_ _2"></span>mor<span class="ls8b9">ed<span class="_ _4f"></span><span class="ls0">ifﬁcult. <span class="_"> </span>The<span class="_ _66"> </span>space <span class="_ _2"></span>at <span class="_ _2"></span>the <span class="_ _2"></span>top <span class="_ _2"></span>of</span></span></div><div class="t m0 x32 h50 y1caf ff19 fs29 fc0 sc0 ls0 ws0">the <span class="_ _3"></span>stack <span class="_ _9"></span>cannot <span class="_ _9"></span>be <span class="_ _9"></span>expanded, <span class="_ _3"></span>because <span class="_ _9"></span>it <span class="_ _9"></span>is <span class="_ _9"></span>often <span class="_ _3"></span>at <span class="_ _9"></span>the <span class="_ _9"></span>top <span class="_ _9"></span>of <span class="_ _3"></span>the <span class="_ _9"></span>address <span class="_ _3"></span>space <span class="_ _9"></span>of <span class="_ _9"></span>the</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
