<div id="pf343" class="pf w4 h1f" data-page-no="343"><div class="pc pc343 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg343.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>21.5<span class="_ _eb"> </span>Source <span class="_"> </span>Code<span class="_ _1fb"> </span><span class="ff18">801</span></div><div class="t m0 x32 h57 y362 ff1a fs2d fc0 sc0 ls0 ws0">48 <span class="_ _d9"> </span>/*</div><div class="t m0 x32 h57 y3c0 ff1a fs2d fc0 sc0 ls0 ws0">49 <span class="_ _68"> </span>*<span class="_"> </span>Structure describing a print request.</div><div class="t m0 x32 h57 y845 ff1a fs2d fc0 sc0 ls0 ws0">50 <span class="_ _68"> </span>*/</div><div class="t m0 x32 h57 y56c4 ff1a fs2d fc0 sc0 ls0 ws0">51 <span class="_ _d9"> </span>struct<span class="_"> </span>printreq {</div><div class="t m0 x32 h57 y56c5 ff1a fs2d fc0 sc0 ls0 ws0">52 <span class="_ _8a"> </span>uint32_t<span class="_"> </span>size; <span class="_ _166"> </span>/*<span class="_"> </span>size in bytes */</div><div class="t m0 x32 h57 y56c6 ff1a fs2d fc0 sc0 ls0 ws0">53 <span class="_ _8a"> </span>uint32_t<span class="_"> </span>flags; <span class="_ _82"> </span>/*<span class="_"> </span>see below */</div><div class="t m0 x32 h57 y56c7 ff1a fs2d fc0 sc0 ls0 ws0">54 <span class="_ _8a"> </span>char<span class="_"> </span>usernm[USERNM_MAX]; <span class="_ _68"> </span>/*<span class="_"> </span>user’s name */</div><div class="t m0 x32 h57 y56c8 ff1a fs2d fc0 sc0 ls0 ws0">55 <span class="_ _8a"> </span>char<span class="_"> </span>jobnm[JOBNM_MAX]; <span class="_ _8a"> </span>/*<span class="_"> </span>job’s name */</div><div class="t m0 x32 h57 y56c9 ff1a fs2d fc0 sc0 ls0 ws0">56 <span class="_ _d9"> </span>};</div><div class="t m0 x32 h57 y33b0 ff1a fs2d fc0 sc0 ls0 ws0">57 <span class="_ _d9"> </span>/*</div><div class="t m0 x32 h57 y419a ff1a fs2d fc0 sc0 ls0 ws0">58 <span class="_ _68"> </span>*<span class="_"> </span>Request flags.</div><div class="t m0 x32 h57 y3b4c ff1a fs2d fc0 sc0 ls0 ws0">59 <span class="_ _68"> </span>*/</div><div class="t m0 x32 h57 y3b4d ff1a fs2d fc0 sc0 ls0 ws0">60 <span class="_ _d9"> </span>#define<span class="_"> </span>PR_TEXT <span class="_ _90"> </span>0x01<span class="_ _15"> </span>/* treat file as plain text */</div><div class="t m0 x32 h57 y2ad4 ff1a fs2d fc0 sc0 ls0 ws0">61 <span class="_ _d9"> </span>/*</div><div class="t m0 x32 h57 y2ad5 ff1a fs2d fc0 sc0 ls0 ws0">62 <span class="_ _68"> </span>*<span class="_"> </span>The response from the spooling daemon to the print command.</div><div class="t m0 x32 h57 y2ad6 ff1a fs2d fc0 sc0 ls0 ws0">63 <span class="_ _68"> </span>*/</div><div class="t m0 x32 h57 y33b1 ff1a fs2d fc0 sc0 ls0 ws0">64 <span class="_ _d9"> </span>struct<span class="_"> </span>printresp {</div><div class="t m0 x32 h57 y33b2 ff1a fs2d fc0 sc0 ls0 ws0">65 <span class="_ _8a"> </span>uint32_t<span class="_"> </span>retcode; <span class="_ _74"> </span>/*<span class="_"> </span>0=success, !0=error code */</div><div class="t m0 x32 h57 y33b3 ff1a fs2d fc0 sc0 ls0 ws0">66 <span class="_ _8a"> </span>uint32_t<span class="_"> </span>jobid; <span class="_ _82"> </span>/*<span class="_"> </span>job ID */</div><div class="t m0 x32 h57 y33b4 ff1a fs2d fc0 sc0 ls0 ws0">67 <span class="_ _8a"> </span>char<span class="_"> </span>msg[MSGLEN_MAX]; <span class="_ _189"> </span>/*<span class="_"> </span>error message */</div><div class="t m0 x32 h57 y33b5 ff1a fs2d fc0 sc0 ls0 ws0">68 <span class="_ _d9"> </span>};</div><div class="t m0 x32 h57 y2021 ff1a fs2d fc0 sc0 ls0 ws0">69 <span class="_ _d9"> </span>#endif<span class="_"> </span>/* _PRINT_H */</div><div class="t m0 x32 h4d y5a7b ff19 fs26 fc0 sc0 ls0 ws0">[48 <span class="_ _a"></span>– <span class="_ _a"></span>69]<span class="_ _65"> </span>The<span class="_ _4b"> </span><span class="ff1a">printreq<span class="_ _4b"> </span></span>and<span class="_ _59"> </span><span class="ff1a">printresp<span class="_ _4b"> </span></span>structures <span class="_ _53"> </span>deﬁne <span class="_ _e"> </span>the <span class="_ _e"> </span>protocol <span class="_ _53"> </span>between <span class="_ _e"> </span>the</div><div class="t m0 x2d h4d y5a7c ff19 fs26 fc0 sc0 ls0 ws0">print command <span class="_ _2"></span>and the <span class="_ _2"></span>printer spooling <span class="_ _2"></span>daemon.<span class="_ _46"> </span>The<span class="_"> </span><span class="ff1a">print<span class="_ _66"> </span></span>command <span class="_ _2"></span>sends</div><div class="t m0 x2d h4d y5a7d ff19 fs26 fc0 sc0 ls0 ws0">a<span class="_"> </span><span class="ff1a">printreq<span class="_ _66"> </span></span>structur<span class="ls15b8">es<span class="_ _4f"></span><span class="ls0">pecifying the <span class="_ _2"></span>size <span class="_ _2"></span>of the <span class="_ _2"></span>job in <span class="_ _2"></span>bytes, job <span class="_ _2"></span>characteristics,</span></span></div><div class="t m0 x2d h49 y5a7e ff19 fs26 fc0 sc0 ls0 ws0">the <span class="_ _2"></span>user <span class="_ _2"></span>name, <span class="_ _2"></span>and <span class="_ _2"></span>the <span class="_ _2"></span>job <span class="_ _2"></span>name <span class="_ _2"></span>to <span class="_ _2"></span>the <span class="_ _2"></span>printer <span class="_ _2"></span>spooling <span class="_ _2"></span>daemon.<span class="_ _61"> </span>The <span class="_ _2"></span>daemon</div><div class="t m0 x2d h4d y5a7f ff19 fs26 fc0 sc0 lscc ws0">re<span class="ls0">sponds <span class="_ _53"> </span>with <span class="_ _53"> </span>a<span class="_ _44"> </span><span class="ff1a">printresp<span class="_ _4b"> </span></span>structur<span class="_ _0"></span><span class="ls1747">ec<span class="_ _c"></span><span class="ls0">ontaining <span class="_ _53"> </span>a <span class="_ _53"> </span>return <span class="_ _42"> </span>code, <span class="_ _53"> </span>the <span class="_ _42"> </span>job <span class="_ _53"> </span>ID,</span></span></span></div><div class="t m0 x2d h49 y5a80 ff19 fs26 fc0 sc0 ls0 ws0">and an error message if the r<span class="_ _0"></span>equest failed.</div><div class="t m0 x2d h4d y5a81 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _45"> </span><span class="ff1a">PR_TEXT<span class="_ _45"> </span></span>job <span class="_ _3"></span>characteristic <span class="_ _9"></span>indicates <span class="_ _9"></span>that <span class="_ _9"></span>the <span class="_ _9"></span>ﬁle <span class="_ _9"></span>being <span class="_ _9"></span>printed <span class="_ _9"></span>should <span class="_ _9"></span>be</div><div class="t m0 x2d h49 y5a82 ff19 fs26 fc0 sc0 ls0 ws0">treated <span class="_ _47"> </span>as <span class="_ _47"> </span>plaintext <span class="_ _47"> </span>(instead <span class="_ _45"> </span>of <span class="_ _47"> </span>PostScript).<span class="_ _5f"> </span><span class="ls164">We <span class="_ _46"> </span>d<span class="_ _9"></span></span>eﬁne <span class="_ _47"> </span>a <span class="_ _45"> </span>bitmask <span class="_ _47"> </span>of <span class="_ _47"> </span>ﬂags</div><div class="t m0 x2d h49 y5a83 ff19 fs26 fc0 sc0 ls0 ws0">instead <span class="_ _2"></span>of <span class="_ _2"></span>deﬁning <span class="_ _2"></span>a <span class="_ _2"></span>separate <span class="_ _2"></span>ﬁeld <span class="_ _2"></span>for <span class="_ _2"></span>each <span class="_ _2"></span>ﬂag.<span class="_ _61"> </span>Although <span class="_ _2"></span>only <span class="_ _2"></span>one <span class="_ _2"></span>ﬂag <span class="_ _2"></span>value</div><div class="t m0 x2d h49 y5a84 ff19 fs26 fc0 sc0 ls0 ws0">is <span class="_ _23"></span>currently <span class="_ _23"></span>deﬁned, <span class="_ _23"></span>we <span class="_ _23"> </span>could <span class="_ _23"> </span>extend <span class="_ _23"> </span>the <span class="_ _42"> </span>pr<span class="_ _0"></span>otocol <span class="_ _23"> </span>in <span class="_ _23"> </span>the <span class="_ _23"> </span>future<span class="_ _35"> </span>to<span class="_ _35"> </span>add <span class="_ _23"></span>more</div><div class="t m0 x2d h49 y5a85 ff19 fs26 fc0 sc0 ls0 ws0">characteristics. <span class="_ _46"> </span>For<span class="_ _46"> </span>example, <span class="_"> </span>we <span class="_ _66"> </span>could <span class="_"> </span>add <span class="_ _66"> </span>a <span class="_"> </span>ﬂag <span class="_ _66"> </span>to <span class="_ _66"> </span>request <span class="_"> </span>double-sided</div><div class="t m0 x2d h49 y5a86 ff19 fs26 fc0 sc0 ls0 ws0">printing. <span class="_ _59"> </span>W<span class="_ _6"></span><span class="ls1748">eh<span class="_ _4a"></span><span class="ls0">ave <span class="_"> </span>room <span class="_"> </span>for <span class="_"> </span>31 <span class="_ _e"> </span>additional <span class="_"> </span>ﬂags <span class="_"> </span>without <span class="_"> </span>r<span class="_ _0"></span>equiring <span class="_"> </span>that <span class="_"> </span>we</span></span></div><div class="t m0 x2d h49 y5a87 ff19 fs26 fc0 sc0 ls0 ws0">change <span class="_ _2"></span>the <span class="_ _3"></span>size <span class="_ _2"></span>of <span class="_ _3"></span>the <span class="_ _2"></span>structure. <span class="_ _66"> </span>Changing<span class="_ _47"> </span>the <span class="_ _2"></span>size <span class="_ _3"></span>of <span class="_ _2"></span>the <span class="_ _3"></span>structur<span class="ls1749">em<span class="_ _8"></span><span class="ls0">eans <span class="_ _2"></span>that</span></span></div><div class="t m0 x2d h49 y5a88 ff19 fs26 fc0 sc0 ls0 ws0">we <span class="_ _2"></span>might <span class="_ _3"></span>introduce <span class="_ _3"></span>a <span class="_ _3"></span>compatibility <span class="_ _3"></span>problem <span class="_ _2"></span>between <span class="_ _3"></span>the <span class="_ _3"></span>client <span class="_ _3"></span>and <span class="_ _3"></span>the <span class="_ _2"></span>server</div><div class="t m0 x2d h49 y5a89 ff19 fs26 fc0 sc0 ls0 ws0">unless <span class="_ _2"></span>we <span class="_ _3"></span>upgrade <span class="_ _2"></span>both <span class="_ _3"></span>at <span class="_ _3"></span>the <span class="_ _2"></span>same <span class="_ _3"></span>time.<span class="_ _61"> </span>An <span class="_ _3"></span>alternative <span class="_ _3"></span>approach <span class="_ _2"></span>is <span class="_ _2"></span>to <span class="_ _3"></span>add <span class="_ _2"></span>a</div><div class="t m0 x2d h49 y5a8a ff19 fs26 fc0 sc0 ls0 ws0">version <span class="_ _23"> </span>number <span class="_ _42"> </span>to <span class="_ _23"> </span>the <span class="_ _42"> </span>messages <span class="_ _23"> </span>to <span class="_ _42"> </span>allow <span class="_ _23"> </span>the <span class="_ _42"> </span>structur<span class="_ _0"></span>es <span class="_ _23"> </span>to <span class="_ _42"> </span>change <span class="_ _23"> </span>with <span class="_ _23"> </span>each</div><div class="t m0 x2d h49 y5a8b ff19 fs26 fc0 sc0 ls0 ws0">version.</div><div class="t m0 x2d h49 y5a8c ff19 fs26 fc0 sc0 ls0 ws0">Note <span class="_ _2"></span>that <span class="_ _3"></span>we <span class="_ _2"></span>deﬁne <span class="_ _3"></span>all <span class="_ _2"></span>integers <span class="_ _3"></span>in <span class="_ _2"></span>the <span class="_ _3"></span>protocol <span class="_ _2"></span>structur<span class="_ _0"></span>es <span class="_ _2"></span>with <span class="_ _3"></span>an <span class="_ _2"></span>explicit <span class="_ _3"></span>size.</div><div class="t m0 x2d h49 y5a8d ff19 fs26 fc0 sc0 ls0 ws0">This <span class="_ _23"> </span>helps <span class="_ _23"> </span>avoid <span class="_ _42"> </span>misaligned <span class="_ _23"> </span>structur<span class="ls174a">ee<span class="_ _43"></span><span class="ls0">lements <span class="_ _23"></span>when <span class="_ _23"> </span>a <span class="_ _42"> </span>client <span class="_ _23"></span>has <span class="_ _23"> </span>a <span class="_ _42"> </span>dif<span class="_ _0"></span>ferent</span></span></div><div class="t m0 x2d h49 y5a8e ff19 fs26 fc0 sc0 ls0 ws0">long integer size than the server<span class="_ _6"></span>.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
