<div id="pf74" class="pf w4 h1f" data-page-no="74"><div class="pc pc74 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg74.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">82<span class="_ _1b"> </span><span class="ff19">File <span class="_"> </span>I/O<span class="_ _169"> </span>Chapter <span class="_"> </span>3</span></div><div class="t m0 x35 h75 y12f ff16 fs2b fc0 sc0 ls0 ws0">3.14<span class="_ _6d"> </span><span class="ff1f">fcntl<span class="_ _54"> </span></span>Function</div><div class="t m0 x32 h26 y4de ff19 fsf fc0 sc0 ls0 ws0">The<span class="_"> </span><span class="ff1a">fcntl<span class="_ _80"> </span></span>function can change the properties of a ﬁle that is already open.</div><div class="t m0 x3f h57 yca2 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;fcntl.h&gt;</div><div class="t m0 x3f h57 yca3 ff1a fs2d fc0 sc0 ls0 ws0">int fcntl(int<span class="_"> </span><span class="ff1b">fd</span><span class="ls15c">,i<span class="_ _1d"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">cmd</span><span class="ls15c">,.<span class="_ _5b"></span><span class="ls0">.. /* int<span class="_"> </span><span class="ff1b">arg<span class="_ _46"> </span></span>*/ );</span></span></span></span></div><div class="t m0 xac h58 yca4 ff19 fs2d fc0 sc0 ls0 ws0">Returns: depends on<span class="_"> </span><span class="ff1b">cmd<span class="_"> </span></span>if OK (see following),<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h49 yca5 ff19 fs26 fc0 sc0 ls0 ws0">In <span class="_ _3"></span>the <span class="_ _9"></span>examples <span class="_ _9"></span>in <span class="_ _3"></span>this <span class="_ _9"></span>section, <span class="_ _3"></span>the <span class="_ _9"></span>thir<span class="ls408">da<span class="_ _b"></span><span class="lscc">rg<span class="_ _2"></span><span class="ls0">ument <span class="_ _3"></span>is <span class="_ _9"></span>always <span class="_ _9"></span>an <span class="_ _3"></span>integer<span class="_ _1"></span><span class="ls408">,c<span class="_ _b"></span><span class="ls0">orresponding</span></span></span></span></span></div><div class="t m0 x32 h49 yca6 ff19 fs26 fc0 sc0 ls0 ws0">to the <span class="_ _2"></span>comment <span class="_ _2"></span>in the <span class="_ _2"></span>function <span class="_ _2"></span>prototype just shown.<span class="_ _61"> </span>When <span class="_ _2"></span>we describe <span class="_ _2"></span>recor<span class="_ _0"></span><span class="ls409">dl<span class="_ _4f"></span><span class="ls0">ocking</span></span></div><div class="t m0 x32 h49 yca7 ff19 fs26 fc0 sc0 ls0 ws0">in Section 14.3, however<span class="_ _6"></span><span class="lsd3">,t<span class="_ _5"></span><span class="ls0">he thir<span class="lsd3">da<span class="_ _4f"></span><span class="lscc">rg<span class="_ _2"></span><span class="ls0">ument becomes a pointer to a structure.</span></span></span></span></span></div><div class="t m0 x3f h4d yca8 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_"> </span><span class="ff1a">fcntl<span class="_ _80"> </span></span>function is used for ﬁve different purposes.</div><div class="t m0 x3f h4d yca9 ff19 fs26 fc0 sc0 ls0 ws0">1. <span class="_ _51"> </span>Duplicate<span class="_"> </span>an existing descriptor (<span class="ff1b">cmd<span class="_"> </span></span>=<span class="_"> </span><span class="ff1a">F_DUPFD<span class="_ _80"> </span></span>or<span class="_"> </span><span class="ff1a">F_DUPFD_CLOEXEC</span>)</div><div class="t m0 x3f h4d ycaa ff19 fs26 fc0 sc0 ls0 ws0">2. <span class="_ _51"> </span>Get/set<span class="_"> </span>ﬁle descriptor ﬂags (<span class="ff1b">cmd<span class="_"> </span></span>=<span class="_"> </span><span class="ff1a">F_GETFD<span class="_ _80"> </span></span>or<span class="_"> </span><span class="ff1a">F_SETFD</span>)</div><div class="t m0 x3f h4d ycab ff19 fs26 fc0 sc0 ls0 ws0">3. <span class="_ _51"> </span>Get/set<span class="_"> </span>ﬁle status ﬂags (<span class="ff1b">cmd<span class="_"> </span></span>=<span class="_"> </span><span class="ff1a">F_GETFL<span class="_ _80"> </span></span>or<span class="_"> </span><span class="ff1a">F_SETFL</span>)</div><div class="t m0 x3f h4d ycac ff19 fs26 fc0 sc0 ls0 ws0">4. <span class="_ _51"> </span>Get/set<span class="_"> </span>asynchronous I/O ownership (<span class="ff1b">cmd<span class="_"> </span></span>=<span class="_"> </span><span class="ff1a">F_GETOWN<span class="_ _80"> </span></span>or<span class="_"> </span><span class="ff1a">F_SETOWN</span>)</div><div class="t m0 x3f h4d ycad ff19 fs26 fc0 sc0 ls0 ws0">5. <span class="_ _51"> </span>Get/set<span class="_"> </span><span class="lscc">re</span>cor<span class="lsd3">dl<span class="_ _d"></span><span class="ls0">ocks (<span class="ff1b">cmd<span class="_"> </span></span>=<span class="_"> </span><span class="ff1a">F_GETLK</span>,<span class="_"> </span><span class="ff1a">F_SETLK</span><span class="lsd3">,o<span class="_ _5"></span><span class="ls0">r<span class="_"> </span><span class="ff1a">F_SETLKW</span>)</span></span></span></span></div><div class="t m0 x32 h4a ycae ff19 fs26 fc0 sc0 ls164 ws0">We<span class="_ _9"></span><span class="ls0">’ll <span class="_ _23"></span>now <span class="_ _23"></span>describe <span class="_ _23"></span>the <span class="_ _23"></span>ﬁrst <span class="_ _23"></span>8 <span class="_ _23"></span>of <span class="_ _9"></span>these <span class="_ _23"> </span>1<span class="_ _0"></span>1<span class="_ _35"> </span><span class="ff1b">cmd<span class="_ _45"> </span></span>values. <span class="_ _35"> </span>(W<span class="_ _6"></span>e’ll <span class="_ _23"></span>wait <span class="_ _23"></span>until <span class="_ _23"></span>Section <span class="_ _9"></span>14.3 <span class="_ _23"> </span>to</span></div><div class="t m0 x32 h49 ycaf ff19 fs26 fc0 sc0 ls0 ws0">describe <span class="_ _2"></span>the <span class="_ _2"></span>last <span class="_ _2"></span>3, <span class="_ _2"></span>which <span class="_ _2"></span>deal <span class="_ _2"></span>with <span class="_ _2"></span>recor<span class="_ _0"></span><span class="ls40a">dl<span class="_ _4f"></span><span class="ls0">ocking.) <span class="_ _66"> </span>Refer<span class="_ _47"> </span>to <span class="_ _2"></span>Figur<span class="ls40a">e3<span class="_ _8"></span><span class="ls0">.7, <span class="_ _2"></span>as <span class="_ _2"></span>we’ll <span class="_ _2"></span>discuss</span></span></span></span></div><div class="t m0 x32 h49 ycb0 ff19 fs26 fc0 sc0 ls0 ws0">both <span class="_ _42"> </span>the <span class="_ _53"> </span>ﬁle <span class="_ _42"> </span>descriptor <span class="_ _53"> </span>ﬂags <span class="_ _53"> </span>associated <span class="_ _42"> </span>with <span class="_ _53"> </span>each <span class="_ _42"> </span>ﬁle <span class="_ _53"> </span>descriptor <span class="_ _53"> </span>in <span class="_ _42"> </span>the <span class="_ _53"> </span>process <span class="_ _42"> </span>table</div><div class="t m0 x32 h49 ycb1 ff19 fs26 fc0 sc0 ls0 ws0">entry and the ﬁle status ﬂags associated with each ﬁle table entry<span class="_ _4"></span>.</div><div class="t m0 x32 h4d ycb2 ff1a fs26 fc0 sc0 ls0 ws0">F_DUPFD<span class="_ _a4"> </span><span class="ff19">Duplicate <span class="_ _35"> </span>the <span class="_ _35"> </span>ﬁle <span class="_ _44"> </span>descriptor<span class="_ _51"> </span><span class="ff1b">fd</span><span class="ls40b">.T<span class="_ _4d"></span><span class="ls0">he <span class="_ _35"> </span>new <span class="_ _44"> </span>ﬁle <span class="_ _35"> </span>descriptor <span class="_ _35"> </span>is</span></span></span></div><div class="t m0 x171 h49 ycb3 ff19 fs26 fc0 sc0 lscc ws0">re<span class="ls0">turned <span class="_ _9"></span>as <span class="_ _3"></span>the <span class="_ _9"></span>value <span class="_ _3"></span>of <span class="_ _3"></span>the <span class="_ _9"></span>function.<span class="_ _16"> </span>It <span class="_ _9"></span>is <span class="_ _3"></span>the <span class="_ _3"></span>lowest-numbered</span></div><div class="t m0 x171 h49 ycb4 ff19 fs26 fc0 sc0 ls0 ws0">descriptor <span class="_ _42"> </span>that <span class="_ _42"> </span>is <span class="_ _42"> </span>not <span class="_ _42"> </span>already <span class="_ _23"> </span>open, <span class="_ _42"> </span>and <span class="_ _42"> </span>that <span class="_ _42"> </span>is <span class="_ _42"> </span>greater <span class="_ _23"> </span>than <span class="_ _42"> </span>or</div><div class="t m0 x171 h49 ycb5 ff19 fs26 fc0 sc0 ls0 ws0">equal <span class="_ _66"> </span>to <span class="_ _47"> </span>the <span class="_ _66"> </span>thir<span class="ls40c">da<span class="_ _1d"></span><span class="lscc">rg<span class="_ _2"></span><span class="ls0">ument <span class="_ _47"> </span>(taken <span class="_ _66"> </span>as <span class="_ _47"> </span>an <span class="_ _66"> </span>integer).<span class="_ _50"> </span>The <span class="_ _47"> </span>new</span></span></span></div><div class="t m0 x171 h4a ycb6 ff19 fs26 fc0 sc0 ls0 ws0">descriptor <span class="_ _35"> </span>shar<span class="_ _0"></span>es <span class="_ _35"> </span>the <span class="_ _45"> </span>same <span class="_ _35"> </span>ﬁle <span class="_ _35"> </span>table <span class="_ _35"> </span>entry <span class="_ _35"> </span>as<span class="_ _5a"> </span><span class="ff1b">fd</span><span class="ls40d">.(<span class="_ _95"></span><span class="ls0">Refer <span class="_ _35"> </span>to</span></span></div><div class="t m0 x171 h49 ycb7 ff19 fs26 fc0 sc0 ls0 ws0">Figur<span class="ls40e">e3<span class="_ _26"></span><span class="ls0">.9.) <span class="_ _5a"> </span>But<span class="_ _5a"> </span>the <span class="_ _45"> </span>new <span class="_ _45"> </span>descriptor <span class="_ _45"> </span>has <span class="_ _35"> </span>its <span class="_ _45"> </span>own <span class="_ _45"> </span>set <span class="_ _45"> </span>of <span class="_ _45"> </span>ﬁle</span></span></div><div class="t m0 x171 h4d ycb8 ff19 fs26 fc0 sc0 ls0 ws0">descriptor <span class="_ _35"> </span>ﬂags, <span class="_ _45"> </span>and <span class="_ _35"> </span>its<span class="_ _51"> </span><span class="ff1a">FD_CLOEXEC<span class="_"> </span></span>ﬁle <span class="_ _35"> </span>descriptor <span class="_ _35"> </span>ﬂag <span class="_ _45"> </span>is</div><div class="t m0 x171 h49 ycb9 ff19 fs26 fc0 sc0 ls0 ws0">cleared. <span class="_ _35"> </span>(This<span class="_ _4b"> </span>means <span class="_ _42"> </span>that <span class="_ _53"> </span>the <span class="_ _53"> </span>descriptor <span class="_ _42"> </span>is <span class="_ _53"> </span>left <span class="_ _53"> </span>open <span class="_ _53"> </span>across <span class="_ _42"> </span>an</div><div class="t m0 x171 h4d ycba ff1a fs26 fc0 sc0 ls0 ws0">exec<span class="ff19 lsd3">,w<span class="_ _d"></span><span class="ls0">hich we discuss in Chapter 8.)</span></span></div><div class="t m0 x32 h4d ycbb ff1a fs26 fc0 sc0 ls0 ws0">F_DUPFD_CLOEXEC<span class="_ _6e"> </span><span class="ff19">Duplicate <span class="_ _4b"> </span>the <span class="_ _44"> </span>ﬁle <span class="_ _4b"> </span>descriptor <span class="_ _4b"> </span>and <span class="_ _4b"> </span>set <span class="_ _4b"> </span>the<span class="_ _65"> </span></span>FD_CLOEXEC<span class="_ _65"> </span><span class="ff19">ﬁle</span></div><div class="t m0 x171 h49 ycbc ff19 fs26 fc0 sc0 ls0 ws0">descriptor <span class="_ _23"></span>ﬂag <span class="_ _23"></span>associated <span class="_ _23"></span>with <span class="_ _23"></span>the <span class="_ _23"></span>new <span class="_ _23"></span>descriptor<span class="_ _6"></span><span class="ls40f">.R<span class="_ _26"></span><span class="ls0">eturns <span class="_ _23"> </span>the</span></span></div><div class="t m0 x171 h49 ycbd ff19 fs26 fc0 sc0 ls0 ws0">new ﬁle descriptor<span class="_ _6"></span>.</div><div class="t m0 x32 h4d ycbe ff1a fs26 fc0 sc0 ls0 ws0">F_GETFD<span class="_ _a4"> </span><span class="ff19">Return <span class="_ _2"></span>the <span class="_ _2"></span>ﬁle <span class="_ _2"></span>descriptor <span class="_ _2"></span>ﬂags <span class="_ _2"></span>for<span class="_ _47"> </span><span class="ff1b">fd<span class="_ _66"> </span></span>as <span class="_ _2"></span>the <span class="_ _2"></span>value <span class="_ _3"></span>of <span class="_ _2"></span>the <span class="_ _2"></span>function.</span></div><div class="t m0 x171 h49 ycbf ff19 fs26 fc0 sc0 ls0 ws0">Currently<span class="_ _4"></span><span class="ls410">,o<span class="_ _da"></span><span class="ls0">nly <span class="_ _65"> </span>one <span class="_ _65"> </span>ﬁle <span class="_ _65"> </span>descriptor <span class="_ _65"> </span>ﬂag <span class="_ _65"> </span>is <span class="_ _65"> </span>deﬁned: <span class="_ _65"> </span>the</span></span></div><div class="t m0 x171 h4d ycc0 ff1a fs26 fc0 sc0 ls0 ws0">FD_CLOEXEC<span class="_ _80"> </span><span class="ff19">ﬂag.</span></div><div class="t m0 x32 h4d ycc1 ff1a fs26 fc0 sc0 ls0 ws0">F_SETFD<span class="_ _a4"> </span><span class="ff19">Set <span class="_ _2"></span>the <span class="_ _3"></span>ﬁle <span class="_ _2"></span>descriptor <span class="_ _3"></span>ﬂags <span class="_ _3"></span>for<span class="_ _47"> </span><span class="ff1b">fd</span><span class="ls411">.T<span class="_ _1d"></span><span class="ls0">he <span class="_ _3"></span>new <span class="_ _2"></span>ﬂag <span class="_ _3"></span>value <span class="_ _2"></span>is <span class="_ _3"></span>set <span class="_ _2"></span>from</span></span></span></div><div class="t m0 x171 h49 ycc2 ff19 fs26 fc0 sc0 ls0 ws0">the thir<span class="lsd3">da<span class="_ _4f"></span><span class="lscc">rg<span class="_ _2"></span><span class="ls0">ument (taken as an integer).</span></span></span></div><a class="l" href="#pfc" data-dest-detail='[12,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892409px;bottom:1236.288916px;width:129.335808px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
