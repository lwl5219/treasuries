<div id="pf126" class="pf w4 h1f" data-page-no="126"><div class="pc pc126 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg126.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">260<span class="_ _1b"> </span><span class="ff19">Process <span class="_"> </span>Contr<span class="_ _0"></span>ol <span class="_ _222"> </span>Chapter<span class="_ _4b"> </span>8</span></div><div class="t m0 x41 h26 y12f ff1a fsf fc0 sc0 ls0 ws0">seteuid<span class="_ _66"> </span><span class="ff19">to set <span class="_ _2"></span>its effective user <span class="_ _2"></span>ID <span class="_ _2"></span>to our <span class="_ _2"></span>user ID.<span class="_ _61"> </span>This prevents any <span class="_ _2"></span>accidental</span></div><div class="t m0 x41 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">misuse of privilege.<span class="_ _59"> </span>At this point, we have</div><div class="t m0 x14e h2a y2241 ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">al user ID =<span class="_ _46"> </span>our user ID (unchanged)</span></div><div class="t m0 xdf h2a yc35 ff19 fsf fc0 sc0 ls0 ws0">effective user ID =<span class="_ _59"> </span>our user ID</div><div class="t m0 xb1 h26 y2242 ff19 fsf fc0 sc0 ls0 ws0">saved set-user-ID =<span class="_ _59"> </span><span class="ff1a">root<span class="_ _80"> </span></span>(unchanged)</div><div class="t m0 x3f h26 y1541 ff19 fsf fc0 sc0 ls0 ws0">5. <span class="_ _51"> </span>The<span class="_ _66"> </span>daemon <span class="_ _2"></span>starts <span class="_ _3"></span>out <span class="_ _2"></span>running with<span class="_ _47"> </span><span class="ff1a">root<span class="_ _66"> </span></span>privileges. <span class="_ _47"> </span>T<span class="_ _6"></span><span class="lsa2a">or<span class="_ _8"></span><span class="ls0">un <span class="_ _3"></span>commands <span class="_ _2"></span>on <span class="_ _2"></span>our</span></span></div><div class="t m0 x41 h26 y940 ff19 fsf fc0 sc0 ls0 ws0">behalf, <span class="_ _3"></span>the <span class="_ _3"></span>daemon <span class="_ _3"></span>calls<span class="_ _45"> </span><span class="ff1a">fork<span class="_ _47"> </span></span>and <span class="_ _3"></span>the <span class="_ _3"></span>child <span class="_ _3"></span>calls<span class="_ _45"> </span><span class="ff1a">setuid<span class="_ _47"> </span></span>to <span class="_ _3"></span>change <span class="_ _3"></span>its <span class="_ _3"></span>user <span class="_ _3"></span>ID</div><div class="t m0 x41 h26 y941 ff19 fsf fc0 sc0 ls0 ws0">to <span class="_ _3"></span>our <span class="_ _3"></span>user <span class="_ _3"></span>ID.<span class="_ _16"> </span>Because <span class="_ _3"></span>the <span class="_ _3"></span>child <span class="_ _3"></span>is <span class="_ _3"></span>running <span class="_ _2"></span>with<span class="_ _45"> </span><span class="ff1a">root<span class="_ _47"> </span></span>privileges, <span class="_ _2"></span>this <span class="_ _3"></span>changes</div><div class="t m0 x41 h2a y20ed ff19 fsf fc0 sc0 ls0 ws0">all of the IDs.<span class="_ _59"> </span><span class="ls5f">We <span class="_ _e"> </span>h<span class="_ _9"></span></span>ave</div><div class="t m0 x14e h2a y10aa ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">al user ID =<span class="_ _46"> </span>our user ID</span></div><div class="t m0 xdf h2a y1846 ff19 fsf fc0 sc0 ls0 ws0">effective user ID =<span class="_ _59"> </span>our user ID</div><div class="t m0 xb1 h2a y2243 ff19 fsf fc0 sc0 ls0 ws0">saved set-user-ID =<span class="_ _59"> </span>our user ID</div><div class="t m0 x41 h2a ya27 ff19 fsf fc0 sc0 ls0 ws0">Now <span class="_ _42"> </span>the <span class="_ _23"> </span>daemon <span class="_ _42"> </span>can <span class="_ _42"> </span>safely <span class="_ _42"> </span>execute <span class="_ _42"> </span>commands <span class="_ _42"> </span>on <span class="_ _23"> </span>our <span class="_ _42"> </span>behalf, <span class="_ _42"> </span>because <span class="_ _42"> </span>it <span class="_ _42"> </span>can</div><div class="t m0 x41 h2a ya28 ff19 fsf fc0 sc0 ls0 ws0">access <span class="_ _3"></span>only <span class="_ _9"></span>the <span class="_ _9"></span>ﬁles <span class="_ _3"></span>to <span class="_ _9"></span>which <span class="_ _9"></span>we <span class="_ _3"></span>normally <span class="_ _9"></span>have <span class="_ _9"></span>access.<span class="_ _16"> </span><span class="ls5f">We <span class="_ _66"> </span>h<span class="_ _9"></span></span>ave <span class="_ _9"></span>no <span class="_ _3"></span>additional</div><div class="t m0 x41 h2a ya29 ff19 fsf fc0 sc0 ls0 ws0">permissions.</div><div class="t m0 x32 h2a y2244 ff19 fsf fc0 sc0 ls0 ws0">By using the saved <span class="_ _2"></span>set-user-ID in this fashion, we <span class="_ _2"></span>can use the <span class="_ _2"></span>extra privileges granted to</div><div class="t m0 x32 h2a y1d97 ff19 fsf fc0 sc0 ls0 ws0">us <span class="_ _9"></span>by <span class="_ _9"></span>the <span class="_ _9"></span>set-user-ID <span class="_ _3"></span>of <span class="_ _9"></span>the <span class="_ _9"></span>program <span class="_ _3"></span>ﬁle <span class="_ _9"></span>only <span class="_ _9"></span>when <span class="_ _9"></span>we <span class="_ _9"></span>need <span class="_ _9"></span>elevated <span class="_ _9"></span>privileges.<span class="_ _5a"> </span>Any</div><div class="t m0 x32 h2a y15ed ff19 fsf fc0 sc0 ls0 ws0">other <span class="_ _3"></span>time, <span class="_ _3"></span>however<span class="_ _6"></span><span class="ls26e">,t<span class="_ _4f"></span><span class="ls0">he <span class="_ _3"></span>process <span class="_ _2"></span>runs <span class="_ _3"></span>with <span class="_ _3"></span>our <span class="_ _3"></span>normal <span class="_ _3"></span>permissions.<span class="_ _61"> </span>If <span class="_ _9"></span>we <span class="_ _2"></span>weren’t <span class="_ _3"></span>able</span></span></div><div class="t m0 x32 h2a y15ee ff19 fsf fc0 sc0 ls0 ws0">to <span class="_ _23"></span>switch <span class="_ _9"></span>back <span class="_ _23"> </span>to <span class="_ _23"> </span>the <span class="_ _23"></span>saved <span class="_ _23"></span>set-user-ID <span class="_ _9"></span>at <span class="_ _23"></span>the <span class="_ _23"></span>end, <span class="_ _9"></span>we <span class="_ _23"> </span>might <span class="_ _23"> </span>be <span class="_ _23"></span>tempted <span class="_ _23"></span>to <span class="_ _9"></span>retain <span class="_ _23"></span>the</div><div class="t m0 x32 h2a y2245 ff19 fsf fc0 sc0 ls0 ws0">extra permissions the whole time we wer<span class="ls44">er<span class="_ _4f"></span><span class="ls0">unning (which is asking for trouble).</span></span></div><div class="t m0 x35 h4b y2246 ff16 fs27 fc0 sc0 ls0 ws0">8.12 <span class="_ _93"> </span>Interpreter<span class="_ _54"> </span>Files</div><div class="t m0 x32 h49 y2247 ff19 fs26 fc0 sc0 ls0 ws0">All <span class="_ _3"></span>contemporary <span class="_ _9"></span>UNIX <span class="_ _3"></span>systems <span class="_ _9"></span>support <span class="_ _3"></span>interpreter <span class="_ _3"></span>ﬁles.<span class="_ _16"> </span>These <span class="_ _9"></span>ﬁles <span class="_ _3"></span>ar<span class="lsa2b">et<span class="_ _8"></span><span class="ls0">ext <span class="_ _3"></span>ﬁles <span class="_ _9"></span>that</span></span></div><div class="t m0 x32 h49 y2248 ff19 fs26 fc0 sc0 ls0 ws0">begin with a line of the form</div><div class="t m0 x3f h4e y2249 ff1a fs28 fc0 sc0 ls0 ws0">#!<span class="_"> </span><span class="ff1b">pathname <span class="_ _47"> </span>[<span class="_"> </span>optional-argument ]</span></div><div class="t m0 x32 h4a y224a ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_"> </span>space <span class="_ _47"> </span>between <span class="_"> </span>the <span class="_ _47"> </span>exclamation <span class="_"> </span>point <span class="_ _66"> </span>and <span class="_ _47"> </span>the<span class="_ _46"> </span><span class="ff1b">pathname<span class="_ _61"> </span></span>is <span class="_ _66"> </span>optional.<span class="_ _50"> </span>The <span class="_ _66"> </span>most</div><div class="t m0 x32 h49 y224b ff19 fs26 fc0 sc0 ls0 ws0">common of these interpreter ﬁles begin with the line</div><div class="t m0 x3f h4e y224c ff1a fs28 fc0 sc0 ls0 ws0">#!/bin/sh</div><div class="t m0 x32 h4a y224d ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _5a"> </span><span class="ff1b">pathname<span class="_ _51"> </span></span>is <span class="_ _45"> </span>normally <span class="_ _35"> </span>an <span class="_ _45"> </span>absolute <span class="_ _35"> </span>pathname, <span class="_ _45"> </span>since <span class="_ _35"> </span>no <span class="_ _45"> </span>special <span class="_ _35"> </span>operations <span class="_ _45"> </span>are</div><div class="t m0 x32 h4d y224e ff19 fs26 fc0 sc0 ls0 ws0">performed on <span class="_ _2"></span>it (i.e.,<span class="_ _47"> </span><span class="ff1a">PATH<span class="_ _80"> </span></span>is <span class="_ _2"></span>not <span class="_ _2"></span>used).<span class="_ _46"> </span>The <span class="_ _2"></span>recognition of these <span class="_ _2"></span>ﬁles <span class="_ _2"></span>is done <span class="_ _2"></span>within <span class="_ _2"></span>the</div><div class="t m0 x32 h4d y224f ff19 fs26 fc0 sc0 ls0 ws0">kernel <span class="_ _3"></span>as <span class="_ _3"></span>part <span class="_ _9"></span>of <span class="_ _3"></span>processing <span class="_ _2"></span>the<span class="_ _45"> </span><span class="ff1a">exec<span class="_ _47"> </span></span>system <span class="_ _3"></span>call.<span class="_ _5a"> </span>The <span class="_ _3"></span>actual <span class="_ _3"></span>ﬁle <span class="_ _3"></span>that <span class="_ _9"></span>gets <span class="_ _3"></span>executed <span class="_ _3"></span>by</div><div class="t m0 x32 h4a y2250 ff19 fs26 fc0 sc0 ls0 ws0">the <span class="_ _3"></span>kernel <span class="_ _9"></span>is <span class="_ _3"></span>not <span class="_ _9"></span>the <span class="_ _3"></span>interpreter <span class="_ _3"></span>ﬁle, <span class="_ _9"></span>but <span class="_ _3"></span>rather <span class="_ _9"></span>the <span class="_ _3"></span>ﬁle <span class="_ _9"></span>speciﬁed <span class="_ _3"></span>by <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1b">pathname<span class="_ _47"> </span></span>on <span class="_ _9"></span>the</div><div class="t m0 x32 h49 y2251 ff19 fs26 fc0 sc0 ls0 ws0">ﬁrst <span class="_ _9"></span>line <span class="_ _23"></span>of <span class="_ _23"></span>the <span class="_ _9"></span>interpreter <span class="_ _9"></span>ﬁle.<span class="_ _51"> </span>Be <span class="_ _9"></span>sure<span class="_ _45"> </span>to<span class="_ _35"> </span>dif<span class="_ _0"></span>ferentiate <span class="_ _9"></span>between <span class="_ _9"></span>the <span class="_ _23"></span>interpreter <span class="_ _9"></span>ﬁle<span class="_ _9"></span><span class="ls161">—a</span></div><div class="t m0 x32 h4d y2252 ff19 fs26 fc0 sc0 ls0 ws0">text <span class="_ _2"></span>ﬁle <span class="_ _3"></span>that <span class="_ _3"></span>begins <span class="_ _3"></span>with<span class="_ _47"> </span><span class="ff1a">#!</span>—and <span class="_ _3"></span>the <span class="_ _3"></span>interpreter<span class="_ _6"></span><span class="lsa2c">,w<span class="_ _8"></span><span class="ls0">hich <span class="_ _3"></span>is <span class="_ _3"></span>speciﬁed <span class="_ _3"></span>by <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1b">pathname<span class="_ _47"> </span></span>on</span></span></div><div class="t m0 x32 h49 y2253 ff19 fs26 fc0 sc0 ls0 ws0">the ﬁrst line of the interpreter ﬁle.</div><div class="t m0 x3f h49 y2254 ff19 fs26 fc0 sc0 ls0 ws0">Be <span class="_ _3"></span>awar<span class="lsa2d">et<span class="_ _b"></span><span class="ls0">hat <span class="_ _9"></span>systems <span class="_ _9"></span>place <span class="_ _9"></span>a <span class="_ _3"></span>size <span class="_ _9"></span>limit <span class="_ _9"></span>on <span class="_ _3"></span>the <span class="_ _9"></span>ﬁrst <span class="_ _9"></span>line <span class="_ _9"></span>of <span class="_ _3"></span>an <span class="_ _9"></span>interpreter <span class="_ _3"></span>ﬁle.<span class="_ _5a"> </span>This</span></span></div><div class="t m0 x32 h4d y2255 ff19 fs26 fc0 sc0 ls0 ws0">limit includes the<span class="_"> </span><span class="ff1a">#!</span><span class="lsa2e">,t<span class="_ _d"></span><span class="ls0">he<span class="_ _66"> </span><span class="ff1b">pathname</span><span class="lsa2f">,t<span class="_ _d"></span><span class="ls0">he <span class="_ _2"></span>optional argument, the terminating newline, and</span></span></span></span></div><div class="t m0 x32 h49 y2256 ff19 fs26 fc0 sc0 ls0 ws0">any spaces.</div><div class="t m0 x76 h2d y2257 ff19 fs10 fc0 sc0 ls0 ws0">On <span class="_ _23"> </span>FreeBSD <span class="_ _9"> </span>8.0, <span class="_ _23"> </span>this <span class="_ _42"> </span>limit <span class="_ _23"> </span>is <span class="_ _23"> </span>4,097 <span class="_ _23"> </span>bytes.<span class="_ _46"> </span>On <span class="_ _23"> </span>Linux <span class="_ _23"> </span>3.2.0, <span class="_ _23"> </span>the <span class="_ _23"> </span>limit <span class="_ _23"> </span>is <span class="_ _23"> </span>128 <span class="_ _23"> </span>bytes.<span class="_ _61"> </span>Mac <span class="_ _23"> </span>OS <span class="_ _23"> </span>X</div><div class="t m0 x76 h2d y2258 ff19 fs10 fc0 sc0 ls0 ws0">10.6.8 supports a limit of 513 bytes, whereas Solaris 10 places the limit at 1,024 bytes.</div><a class="l" href="#pff" data-dest-detail='[15,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892634px;bottom:620.568890px;width:130.032692px;height:19.680023px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
