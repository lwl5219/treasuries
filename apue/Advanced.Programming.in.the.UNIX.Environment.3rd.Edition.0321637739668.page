<div id="pf29c" class="pf w4 h1f" data-page-no="29c"><div class="pc pc29c w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg29c.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">634<span class="_ _1b"> </span><span class="ff19">Advanced <span class="_"> </span>IPC<span class="_ _e8"> </span>Chapter <span class="_"> </span>17</span></div><div class="t m0 x32 h53 y12f ff16 fs2b fc0 sc0 ls0 ws0">17.2.1 <span class="_ _54"> </span>Naming<span class="_ _54"> </span>UNIX <span class="_"> </span>Domain <span class="_"> </span>Sockets</div><div class="t m0 x32 h26 y4de ff19 fsf fc0 sc0 ls0 ws0">Although the<span class="_"> </span><span class="ff1a">socketpair<span class="_ _66"> </span></span>function creates sockets that ar<span class="lsb66">ec<span class="_ _4f"></span><span class="ls0">onnected to <span class="_ _2"></span>each other<span class="_ _6"></span><span class="lsb66">,t<span class="_ _5"></span><span class="ls0">he</span></span></span></span></div><div class="t m0 x32 h2a y6d0 ff19 fsf fc0 sc0 ls0 ws0">individual <span class="_"> </span>sockets <span class="_"> </span>don’t <span class="_"> </span>have <span class="_ _66"> </span>names.<span class="_ _60"> </span>This <span class="_ _66"> </span>means <span class="_"> </span>that <span class="_ _66"> </span>they <span class="_"> </span>can’t <span class="_ _66"> </span>be <span class="_"> </span>addressed <span class="_"> </span>by</div><div class="t m0 x32 h2a y6d1 ff19 fsf fc0 sc0 ls0 ws0">unrelated pr<span class="_ _0"></span>ocesses.</div><div class="t m0 x3f h2a y6d2 ff19 fsf fc0 sc0 ls0 ws0">In <span class="_ _3"></span>Section <span class="_ _3"></span>16.3.4, <span class="_ _9"></span>we <span class="_ _3"></span>learned <span class="_ _9"></span>how <span class="_ _3"></span>to <span class="_ _3"></span>bind <span class="_ _9"></span>an <span class="_ _3"></span>address <span class="_ _3"></span>to <span class="_ _3"></span>an <span class="_ _9"></span>Internet <span class="_ _3"></span>domain <span class="_ _9"></span>socket.</div><div class="t m0 x32 h2a y6d3 ff19 fsf fc0 sc0 ls0 ws0">Just <span class="_ _3"></span>as <span class="_ _9"></span>with <span class="_ _3"></span>Internet <span class="_ _9"></span>domain <span class="_ _3"></span>sockets, <span class="_ _9"></span>UNIX <span class="_ _3"></span>domain <span class="_ _9"></span>sockets <span class="_ _3"></span>can <span class="_ _9"></span>be <span class="_ _3"></span>named <span class="_ _9"></span>and <span class="_ _9"></span>used <span class="_ _3"></span>to</div><div class="t m0 x32 h2a y6d4 ff19 fsf fc0 sc0 ls0 ws0">advertise <span class="_ _42"> </span>services.<span class="_ _54"> </span>The <span class="_ _42"> </span>address <span class="_ _23"> </span>format <span class="_ _53"> </span>used <span class="_ _42"> </span>with <span class="_ _42"> </span>UNIX <span class="_ _42"> </span>domain <span class="_ _42"> </span>sockets <span class="_ _42"> </span>differs <span class="_ _42"> </span>from</div><div class="t m0 x32 h2a y6d5 ff19 fsf fc0 sc0 ls0 ws0">that used with Internet domain sockets, however<span class="_ _6"></span>.</div><div class="t m0 x3f h2a y6d6 ff19 fsf fc0 sc0 ls0 ws0">Recall from Section 16.3 <span class="_ _2"></span>that socket address formats <span class="_ _2"></span>differ from one implementation</div><div class="t m0 x32 h26 y6d7 ff19 fsf fc0 sc0 ls0 ws0">to <span class="_ _9"></span>the <span class="_ _9"></span>next.<span class="_ _51"> </span>An <span class="_ _9"></span>address <span class="_ _9"></span>for <span class="_ _9"></span>a <span class="_ _23"></span>UNIX <span class="_ _9"></span>domain <span class="_ _9"></span>socket <span class="_ _23"></span>is <span class="_ _9"></span>repr<span class="_ _0"></span>esented <span class="_ _9"></span>by <span class="_ _9"></span>a<span class="_ _45"> </span><span class="ff1a">sockaddr_un</span></div><div class="t m0 x32 h26 y6d8 ff19 fsf fc0 sc0 ls0 ws0">structur<span class="_ _0"></span>e. <span class="_ _45"> </span>On<span class="_ _45"> </span>Linux <span class="_ _3"></span>3.2.0 <span class="_ _9"></span>and <span class="_ _9"></span>Solaris <span class="_ _9"></span>10, <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">sockaddr_un<span class="_ _45"> </span></span>structure<span class="_ _47"> </span>is<span class="_ _45"> </span>deﬁned <span class="_ _9"></span>in <span class="_ _9"></span>the</div><div class="t m0 x32 h26 y6d9 ff19 fsf fc0 sc0 ls0 ws0">header<span class="_"> </span><span class="ff1a">&lt;sys/un.h&gt;<span class="_ _80"> </span></span>as</div><div class="t m0 x3f h57 y4b51 ff1a fs2d fc0 sc0 ls0 ws0">struct sockaddr_un {</div><div class="t m0 x21b h57 y4b52 ff1a fs2d fc0 sc0 ls0 ws0">sa_family_t <span class="_"> </span>sun_family;<span class="_ _8a"> </span>/* AF_UNIX */</div><div class="t m0 x21b h57 y4b53 ff1a fs2d fc0 sc0 ls0 ws0">char <span class="_ _186"> </span>sun_path[108];<span class="_ _d9"> </span>/* pathname */</div><div class="t m0 x3f h57 y4b54 ff1a fs2d fc0 sc0 ls0 ws0">};</div><div class="t m0 x32 h26 y4b55 ff19 fsf fc0 sc0 ls0 ws0">On <span class="_ _3"></span>FreeBSD <span class="_ _3"></span>8.0 <span class="_ _9"></span>and <span class="_ _3"></span>Mac <span class="_ _9"></span>OS <span class="_ _9"></span>X <span class="_ _3"></span>10.6.8, <span class="_ _9"></span>however<span class="_ _6"></span><span class="ls13a7">,t<span class="_ _8"></span><span class="ls0">he<span class="_ _45"> </span><span class="ff1a">sockaddr_un<span class="_ _47"> </span></span>structure<span class="_ _47"> </span>is<span class="_ _45"> </span>deﬁned</span></span></div><div class="t m0 x32 h2a y4b56 ff19 fsf fc0 sc0 ls0 ws0">as</div><div class="t m0 x3f h57 y42ed ff1a fs2d fc0 sc0 ls0 ws0">struct sockaddr_un {</div><div class="t m0 x21b h57 y42ee ff1a fs2d fc0 sc0 ls0 ws0">unsigned char<span class="_ _d9"> </span>sun_len; <span class="_ _90"> </span>/*<span class="_"> </span>sockaddr length */</div><div class="t m0 x21b h57 y4b57 ff1a fs2d fc0 sc0 ls0 ws0">sa_family_t <span class="_ _68"> </span>sun_family;<span class="_ _8a"> </span>/* AF_UNIX */</div><div class="t m0 x21b h57 y4b58 ff1a fs2d fc0 sc0 ls0 ws0">char <span class="_ _74"> </span>sun_path[104];<span class="_ _3a"> </span>/* pathname */</div><div class="t m0 x3f h57 y4b59 ff1a fs2d fc0 sc0 ls0 ws0">};</div><div class="t m0 x3f h26 y4b5a ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _5a"> </span><span class="ff1a">sun_path<span class="_"> </span></span>member <span class="_ _45"> </span>of <span class="_ _45"> </span>the<span class="_ _5a"> </span><span class="ff1a">sockaddr_un<span class="_"> </span></span>structur<span class="_ _0"></span><span class="ls445">ec<span class="_ _26"></span><span class="ls0">ontains <span class="_ _45"> </span>a <span class="_ _45"> </span>pathname.</span></span></div><div class="t m0 x32 h2a y4b5b ff19 fsf fc0 sc0 ls0 ws0">When <span class="_ _23"></span>we <span class="_ _23"></span>bind <span class="_ _9"></span>an <span class="_ _23"> </span>address <span class="_ _23"></span>to <span class="_ _23"></span>a <span class="_ _23"></span>UNIX <span class="_ _9"></span>domain <span class="_ _23"> </span>socket, <span class="_ _23"> </span>the <span class="_ _23"> </span>system <span class="_ _23"> </span>creates <span class="_ _9"></span>a <span class="_ _23"> </span>ﬁle <span class="_ _23"> </span>of <span class="_ _23"> </span>type</div><div class="t m0 x32 h26 y4b5c ff1a fsf fc0 sc0 ls0 ws0">S_IFSOCK<span class="_ _80"> </span><span class="ff19">with the same name.</span></div><div class="t m0 x3f h2a y4b5d ff19 fsf fc0 sc0 ls0 ws0">This <span class="_ _23"></span>ﬁle <span class="_ _9"></span>exists <span class="_ _23"> </span>only <span class="_ _23"></span>as <span class="_ _23"></span>a <span class="_ _23"></span>means <span class="_ _9"></span>of <span class="_ _23"> </span>advertising <span class="_ _23"></span>the <span class="_ _23"></span>socket <span class="_ _9"></span>name <span class="_ _23"> </span>to <span class="_ _23"> </span>clients.<span class="_ _51"> </span>The <span class="_ _9"></span>ﬁle</div><div class="t m0 x32 h2a y4b5e ff19 fsf fc0 sc0 ls0 ws0">can’t be opened or otherwise used for communication by applications.</div><div class="t m0 x3f h26 y4b5f ff19 fsf fc0 sc0 ls0 ws0">If <span class="_ _23"></span>the <span class="_ _23"> </span>ﬁle <span class="_ _23"> </span>already <span class="_ _23"> </span>exists <span class="_ _23"> </span>when <span class="_ _23"> </span>we <span class="_ _42"> </span>try <span class="_ _23"></span>to <span class="_ _23"></span>bind <span class="_ _23"> </span>the <span class="_ _23"> </span>same <span class="_ _23"> </span>address, <span class="_ _23"> </span>the<span class="_ _35"> </span><span class="ff1a">bind<span class="_ _35"> </span></span><span class="ls45">re</span>quest</div><div class="t m0 x32 h2a y4b60 ff19 fsf fc0 sc0 ls0 ws0">will fail.<span class="_ _46"> </span>When we close <span class="_ _2"></span>the socket, this ﬁle <span class="_ _2"></span>is not automatically <span class="_ _2"></span>removed, so we need to</div><div class="t m0 x32 h2a y4b61 ff19 fsf fc0 sc0 ls0 ws0">make sur<span class="ls44">et<span class="_ _4f"></span><span class="ls0">hat we unlink it befor<span class="ls44">eo<span class="_ _d"></span><span class="ls0">ur application exits.</span></span></span></span></div><div class="t m0 x35 h27 y4b62 ff16 fsf fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h2a y4b63 ff19 fsf fc0 sc0 ls0 ws0">The program <span class="_ _2"></span>in Figur<span class="ls28a">e1<span class="_ _4f"></span><span class="ls0">7.5 <span class="_ _2"></span>shows <span class="_ _2"></span>an <span class="_ _2"></span>example <span class="_ _2"></span>of <span class="_ _2"></span>binding <span class="_ _2"></span>an address to <span class="_ _2"></span>a <span class="_ _2"></span>UNIX <span class="_ _2"></span>domain</span></span></div><div class="t m0 x32 h2a y4b64 ff19 fsf fc0 sc0 ls0 ws0">socket.</div><div class="t m0 x32 h4e y4b65 ff1a fs28 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h4e y4b66 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;sys/socket.h&gt;</div><div class="t m0 x32 h4e y4b67 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;sys/un.h&gt;</div><div class="t m0 x32 h4e y4b68 ff1a fs28 fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h4e y4b69 ff1a fs28 fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 x32 h4e y4b6a ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y4b6b ff1a fs28 fc0 sc0 ls0 ws0">int fd, size;</div><a class="l" href="#pf12" data-dest-detail='[18,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:156.492009px;bottom:1236.288916px;width:225.841004px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
