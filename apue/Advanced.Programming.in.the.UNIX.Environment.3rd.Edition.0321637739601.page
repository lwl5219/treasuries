<div id="pf259" class="pf w4 h1f" data-page-no="259"><div class="pc pc259 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg259.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>15.8<span class="_ _e9"> </span>Semaphor<span class="_ _0"></span>es<span class="_ _1b"> </span><span class="ff18">567</span></div><div class="t m0 x98 h51 y597 ff19 fs2a fc0 sc0 ls324 ws0">Ty<span class="_ _3"></span><span class="ls0">pical values</span></div><div class="t m0 x19c h2d y21d3 ff19 fs10 fc0 sc0 ls0 ws0">FreeBSD <span class="_ _210"> </span>Linux <span class="_ _210"> </span>Mac<span class="_"> </span>OS X<span class="_ _7f"> </span>Solaris</div><div class="t m0 x80 h2d y4493 ff19 fs10 fc0 sc0 ls0 ws0">8.0 <span class="_ _7a"> </span>3.2.0<span class="_ _268"> </span>10.6.8 <span class="_ _1c4"> </span>10</div><div class="t m0 x30 h2d y4494 ff19 fs10 fc0 sc0 ls0 ws0">Description</div><div class="t m0 x201 h2e y439b ff19 fs11 fc0 sc0 ls0 ws0">32,767 <span class="_ _87"> </span>32,767<span class="_ _76"> </span>32,767 <span class="_ _179"> </span>65,535<span class="_ _2bf"></span>maximum value of any semaphore</div><div class="t m0 x201 h2e y439c ff19 fs11 fc0 sc0 ls0 ws0">16,384 <span class="_ _87"> </span>32,767<span class="_ _76"> </span>16,384 <span class="_ _179"> </span>32,767<span class="_ _2bf"></span>maximum value of any semaphore’s adjust-on-exit value</div><div class="t m0 x212 h2e y4495 ff19 fs11 fc0 sc0 ls0 ws0">10 <span class="_ _12e"> </span>128<span class="_ _76"> </span>87,381 <span class="_ _268"> </span>128<span class="_ _2bf"></span>maximum number of semaphor<span class="lsdb">es<span class="_ _5"></span><span class="ls0">ets, systemwide</span></span></div><div class="t m0 x212 h2e y4496 ff19 fs11 fc0 sc0 ls0 ws0">60 <span class="_ _87"> </span>32,000<span class="_ _76"> </span>87,381 <span class="_ _df"> </span>derived<span class="_ _2c0"></span>maximum number of semaphores, systemwide</div><div class="t m0 x212 h2e y4497 ff19 fs11 fc0 sc0 ls0 ws0">60 <span class="_ _12e"> </span>250<span class="_ _76"> </span>87,381 <span class="_ _268"> </span>512<span class="_ _2bf"></span>maximum number of semaphores per semaphor<span class="_ _0"></span><span class="lsdb">es<span class="_ _84"></span><span class="ls0">et</span></span></div><div class="t m0 x212 h2e y4498 ff19 fs11 fc0 sc0 ls0 ws0">30 <span class="_ _87"> </span>32,000<span class="_ _76"> </span>87,381 <span class="_ _df"> </span>derived<span class="_ _2c0"></span>maximum number of undo structures, systemwide</div><div class="t m0 x212 h2e y4499 ff19 fs11 fc0 sc0 ls0 ws0">10 <span class="_ _5e"> </span>unlimited<span class="_ _e0"> </span>10 <span class="_ _df"> </span>derived<span class="_ _2c0"></span>maximum number of undo entries per undo structur<span class="_ _0"></span>es</div><div class="t m0 x109 h4f y449a ff19 fs11 fc0 sc0 ls0 ws0">100 <span class="_ _136"> </span>32<span class="_ _17a"> </span><span class="ls1242">55<span class="_ _91"></span><span class="ls0">12<span class="_ _2c1"></span>maximum number of operations per<span class="_"> </span><span class="ff1a">semop<span class="_ _53"> </span></span>call</span></span></div><div class="t m0 x18f h2f y449b ff18 fs12 fc0 sc0 ls0 ws0">Figure 15.28<span class="_ _5a"> </span><span class="ff19">System limits that affect semaphores</span></div><div class="t m0 x3f h50 y449c ff19 fs29 fc0 sc0 ls0 ws0">When <span class="_ _9"></span>we <span class="_ _9"></span>want <span class="_ _9"></span>to <span class="_ _9"></span>use <span class="_ _9"></span>XSI <span class="_ _23"></span>semaphor<span class="_ _0"></span>es, <span class="_ _9"></span>we <span class="_ _9"></span>ﬁrst <span class="_ _9"></span>need <span class="_ _9"></span>to <span class="_ _9"></span>obtain <span class="_ _23"></span>a <span class="_ _9"></span>semaphore<span class="_ _47"> </span>ID<span class="_ _45"> </span>by</div><div class="t m0 x32 h5c y449d ff19 fs29 fc0 sc0 ls0 ws0">calling the<span class="_"> </span><span class="ff1a">semget<span class="_ _80"> </span></span>function.</div><div class="t m0 x3f h62 y449e ff1a fs30 fc0 sc0 ls0 ws0">#include &lt;sys/sem.h&gt;</div><div class="t m0 x3f h62 y449f ff1a fs30 fc0 sc0 ls0 ws0">int semget(key_t<span class="_"> </span><span class="ff1b">key</span><span class="ls1185">,i<span class="_ _1d"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">nsems</span><span class="ls1185">,i<span class="_ _5b"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">ﬂag</span>);</span></span></span></span></div><div class="t m0 x1de hff y44a0 ff19 fs30 fc0 sc0 ls0 ws0">Returns: semaphore<span class="_"> </span>ID<span class="_"> </span>if<span class="_"> </span>OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>err<span class="_ _0"></span>or</div><div class="t m0 x32 h79 y44a1 ff19 fs31 fc0 sc0 ls0 ws0">In <span class="_ _42"> </span>Section <span class="_ _42"> </span>15.6.1, <span class="_ _42"> </span>we <span class="_ _42"> </span>described <span class="_ _23"> </span>the <span class="_ _42"> </span>rules <span class="_ _42"> </span>for <span class="_ _42"> </span>converting <span class="_ _42"> </span>the<span class="_ _44"> </span><span class="ff1b">key<span class="_ _35"> </span></span>into <span class="_ _42"> </span>an <span class="_ _42"> </span>identiﬁer <span class="_ _42"> </span>and</div><div class="t m0 x32 h6e y44a2 ff19 fs31 fc0 sc0 ls0 ws0">discussed <span class="_ _2"></span>whether <span class="_ _3"></span>a <span class="_ _2"></span>new <span class="_ _2"></span>set <span class="_ _3"></span>is <span class="_ _2"></span>created <span class="_ _2"></span>or <span class="_ _3"></span>an <span class="_ _2"></span>existing <span class="_ _3"></span>set <span class="_ _2"></span>is <span class="_ _3"></span>refer<span class="_ _1"></span>enced. <span class="_ _47"> </span>When<span class="_ _47"> </span><span class="ls1243">an<span class="_ _4f"></span><span class="ls0">ew <span class="_ _2"></span>set</span></span></div><div class="t m0 x32 h64 y44a3 ff19 fs31 fc0 sc0 ls0 ws0">is created, the following members of the<span class="_"> </span><span class="ff1a">semid_ds<span class="_ _80"> </span></span>structur<span class="_ _0"></span><span class="ls229">ea<span class="_ _d"></span><span class="ls225">re <span class="_ _2"></span>i<span class="_ _2"></span><span class="ls0">nitialized.</span></span></span></div><div class="t m0 x3f h64 y44a4 ff19 fs31 fc0 sc0 ls101c ws0">•T<span class="_ _4d"></span><span class="ls0">he<span class="_ _45"> </span><span class="ff1a">ipc_perm<span class="_ _45"> </span></span>structure<span class="_ _47"> </span>is<span class="_ _45"> </span>initialized <span class="_ _23"></span>as <span class="_ _9"></span>described <span class="_ _9"></span>in <span class="_ _9"></span>Section <span class="_ _9"></span>15.6.2.<span class="_ _5a"> </span>The<span class="_ _45"> </span><span class="ff1a">mode</span></span></div><div class="t m0 x15 h79 y44a5 ff19 fs31 fc0 sc0 ls0 ws0">member <span class="_"> </span>of <span class="_ _e"> </span>this <span class="_"> </span>structur<span class="_ _0"></span>e<span class="_ _59"> </span>is<span class="_ _59"> </span>set <span class="_"> </span>to <span class="_"> </span>the <span class="_ _e"> </span>corresponding <span class="_ _e"> </span>permission <span class="_"> </span>bits <span class="_"> </span>of<span class="_ _4b"> </span><span class="ff1b">ﬂag</span>.</div><div class="t m0 x15 h6e y44a6 ff19 fs31 fc0 sc0 ls0 ws0">These permissions ar<span class="ls229">es<span class="_ _4f"></span><span class="ls0">peciﬁed with the values from Figur<span class="ls229">e1<span class="_ _4f"></span><span class="ls0">5.24.</span></span></span></span></div><div class="t m0 x3f h64 y44a7 ff19 fs31 fc0 sc0 ls0 ws0">•<span class="_ _5c"> </span><span class="ff1a">sem_otime<span class="_ _66"> </span></span>is set to 0.</div><div class="t m0 x3f h64 y44a8 ff19 fs31 fc0 sc0 ls0 ws0">•<span class="_ _5c"> </span><span class="ff1a">sem_ctime<span class="_ _66"> </span></span>is set to the current time.</div><div class="t m0 x3f h64 y44a9 ff19 fs31 fc0 sc0 ls0 ws0">•<span class="_ _5c"> </span><span class="ff1a">sem_nsems<span class="_ _66"> </span></span>is set to<span class="_"> </span><span class="ff1b">nsems</span>.</div><div class="t m0 x3f h79 y44aa ff19 fs31 fc0 sc0 ls0 ws0">The <span class="_ _66"> </span>number <span class="_ _47"> </span>of <span class="_ _66"> </span>semaphores <span class="_ _66"> </span>in <span class="_ _47"> </span>the <span class="_"> </span>set <span class="_ _47"> </span>is<span class="_ _61"> </span><span class="ff1b">nsems</span><span class="ls1244">.I<span class="_ _49"></span><span class="ls1245">fan<span class="_ _1d"></span><span class="ls0">ew <span class="_ _47"> </span>set <span class="_ _66"> </span>is <span class="_ _47"> </span>being <span class="_ _66"> </span>created</span></span></span></div><div class="t m0 x32 h79 y44ab ff19 fs31 fc0 sc0 ls0 ws0">(typically <span class="_ _2"></span>by <span class="_ _3"></span>the <span class="_ _2"></span>server), <span class="_ _3"></span>we <span class="_ _3"></span>must <span class="_ _2"></span>specify<span class="_ _47"> </span><span class="ff1b">nsems</span><span class="ls1246">.I<span class="_ _5b"></span><span class="ls0">f<span class="_ _47"> </span>we<span class="_ _66"> </span>a<span class="ls225">re <span class="_ _9"></span>re<span class="_ _2"></span></span>ferencing <span class="_ _2"></span>an <span class="_ _2"></span>existing <span class="_ _3"></span>set <span class="_ _3"></span>(a</span></span></div><div class="t m0 x32 h79 y44ac ff19 fs31 fc0 sc0 ls0 ws0">client), we can specify<span class="_"> </span><span class="ff1b">nsems<span class="_"> </span></span>as 0.</div><div class="t m0 x3f h64 y44ad ff19 fs31 fc0 sc0 ls0 ws0">The<span class="_"> </span><span class="ff1a">semctl<span class="_ _80"> </span></span>function is the catchall for various semaphor<span class="ls229">eo<span class="_ _d"></span><span class="ls0">perations.</span></span></div><div class="t m0 xb8 h65 y44ae ff1a fs32 fc0 sc0 ls0 ws0">#include &lt;sys/sem.h&gt;</div><div class="t m0 xb8 h65 y44af ff1a fs32 fc0 sc0 ls0 ws0">int semctl(int<span class="_"> </span><span class="ff1b">semid</span><span class="ls441">,i<span class="_ _1d"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">semnum</span><span class="ls441">,i<span class="_ _5b"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">cmd</span><span class="ls441">,.<span class="_ _1d"></span><span class="ls0">.. /* union semun<span class="_"> </span><span class="ff1b">arg<span class="_ _61"> </span></span>*/ );</span></span></span></span></span></span></div><div class="t m0 x164 h92 y44b0 ff19 fs32 fc0 sc0 ls0 ws0">Returns: (see following)</div><div class="t m0 x32 h96 y44b1 ff19 fs49 fc0 sc0 ls0 ws0">The <span class="_ _2"></span>fourth <span class="_ _2"></span>argument <span class="_ _2"></span>is <span class="_ _2"></span>optional, <span class="_ _2"></span>depending <span class="_ _3"></span>on <span class="_ _2"></span>the <span class="_ _2"></span>command <span class="_ _2"></span>requested, <span class="_ _2"></span>and <span class="_ _2"></span>if <span class="_ _3"></span>present,</div><div class="t m0 x32 h9b y44b2 ff19 fs49 fc0 sc0 ls0 ws0">is of type<span class="_"> </span><span class="ff1a">semun</span><span class="ls48d">,au<span class="_ _d"></span><span class="ls0">nion of various command-speciﬁc arguments:</span></span></div><div class="t m0 x3f hc1 y44b3 ff1a fs69 fc0 sc0 ls0 ws0">union semun {</div><div class="t m0 xf4 hc1 y44b4 ff1a fs69 fc0 sc0 ls0 ws0">int <span class="_ _12d"> </span>val;<span class="_ _87"> </span>/* for SETVAL */</div><div class="t m0 xf4 hc1 y44b5 ff1a fs69 fc0 sc0 ls0 ws0">struct semid_ds<span class="_ _d9"> </span>*buf; <span class="_ _3a"> </span>/*<span class="_"> </span>for IPC_STAT and IPC_SET */</div><div class="t m0 xf4 hc1 y44b6 ff1a fs69 fc0 sc0 ls0 ws0">unsigned short<span class="_ _68"> </span>*array; /* for GETALL and SETALL */</div><div class="t m0 x3f hc1 y44b7 ff1a fs69 fc0 sc0 ls0 ws0">};</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
