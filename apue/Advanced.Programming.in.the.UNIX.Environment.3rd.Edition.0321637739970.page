<div id="pf3ca" class="pf w4 h1f" data-page-no="3ca"><div class="pc pc3ca w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg3ca.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">936<span class="_ _1b"> </span><span class="ff19">Solutions <span class="_"> </span>to <span class="_"> </span>Selected <span class="_"> </span>Exercises <span class="_ _2eb"> </span>Appendix<span class="_ _4b"> </span>C</span></div><div class="t m0 xe2 h26 y12f ff19 fsf fc0 sc0 ls0 ws0">Then <span class="_ _9"></span>use<span class="_ _45"> </span><span class="ff1a">fdopen<span class="_ _45"> </span></span>to <span class="_ _9"></span>associate <span class="_ _9"></span>the <span class="_ _9"></span>pipe <span class="_ _9"></span>descriptors <span class="_ _9"></span>with <span class="_ _9"></span>a <span class="_ _9"></span>standar<span class="ls186f">dI<span class="_ _b"></span><span class="ls0">/O <span class="_ _9"></span>stream,</span></span></div><div class="t m0 xe2 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">and <span class="_ _2"></span>set <span class="_ _2"></span>the <span class="_ _2"></span>streams <span class="_ _2"></span>to <span class="_ _2"></span>be <span class="_ _2"></span>line <span class="_ _2"></span>buffered. <span class="_"> </span>Do<span class="_ _66"> </span>this <span class="_ _3"></span>befor<span class="ls1480">et<span class="_ _8"></span><span class="ls0">he<span class="_ _47"> </span><span class="ff1a">while<span class="_ _66"> </span></span>loop <span class="_ _2"></span>that <span class="_ _2"></span>reads</span></span></div><div class="t m0 xe2 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">from standar<span class="_ _0"></span><span class="ls44">di<span class="_ _d"></span><span class="ls0">nput:</span></span></div><div class="t m0 xd8 h57 y273f ff1a fs2d fc0 sc0 ls0 ws0">if ((fpin = fdopen(fd2[0], &quot;r&quot;)) == NULL)</div><div class="t m0 xb1 h57 y6261 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;fdopen error&quot;);</div><div class="t m0 xd8 h57 y6262 ff1a fs2d fc0 sc0 ls0 ws0">if ((fpout = fdopen(fd1[1], &quot;w&quot;)) == NULL)</div><div class="t m0 xb1 h57 y6263 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;fdopen error&quot;);</div><div class="t m0 xd8 h57 y6264 ff1a fs2d fc0 sc0 ls0 ws0">if (setvbuf(fpin, NULL, _IOLBF, 0) &lt; 0)</div><div class="t m0 xb1 h57 y6265 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;setvbuf error&quot;);</div><div class="t m0 xd8 h57 y6266 ff1a fs2d fc0 sc0 ls0 ws0">if (setvbuf(fpout, NULL, _IOLBF, 0) &lt; 0)</div><div class="t m0 xb1 h57 y6267 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;setvbuf error&quot;);</div><div class="t m0 xe2 h26 y6268 ff19 fsf fc0 sc0 ls0 ws0">The<span class="_"> </span><span class="ff1a">write<span class="_ _80"> </span></span>and<span class="_"> </span><span class="ff1a">read<span class="_ _66"> </span></span>in the<span class="_"> </span><span class="ff1a">while<span class="_ _80"> </span></span>loop ar<span class="ls44">er<span class="_ _4f"></span><span class="ls0">eplaced with</span></span></div><div class="t m0 xd8 h57 y6269 ff1a fs2d fc0 sc0 ls0 ws0">if (fputs(line, fpout) == EOF)</div><div class="t m0 xb1 h57 y626a ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;fputs error to pipe&quot;);</div><div class="t m0 xd8 h57 y626b ff1a fs2d fc0 sc0 ls0 ws0">if (fgets(line, MAXLINE, fpin) == NULL) {</div><div class="t m0 xb1 h57 y626c ff1a fs2d fc0 sc0 ls0 ws0">err_msg(&quot;child closed pipe&quot;);</div><div class="t m0 xb1 h57 y626d ff1a fs2d fc0 sc0 ls0 ws0">break;</div><div class="t m0 xd8 h57 y626e ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h26 y626f ff18 fsf fc0 sc0 ls0 ws0">15.6<span class="_ _210"> </span><span class="ff19">The<span class="_ _59"> </span><span class="ff1a">system<span class="_ _4b"> </span></span>function <span class="_ _53"> </span>calls<span class="_ _4b"> </span><span class="ff1a">wait</span><span class="ls1870">,a<span class="_ _c"></span><span class="ls0">nd <span class="_ _e"> </span>the <span class="_ _53"> </span>ﬁrst <span class="_ _e"> </span>child <span class="_ _e"> </span>to <span class="_ _e"> </span>terminate <span class="_ _53"> </span>is <span class="_ _e"> </span>the <span class="_ _e"> </span>child</span></span></span></div><div class="t m0 xe2 h26 y6270 ff19 fsf fc0 sc0 ls0 ws0">generated by<span class="_"> </span><span class="ff1a">popen</span><span class="ls16f0">.S<span class="_ _4a"></span><span class="ls0">ince that’s not the <span class="_ _2"></span>child that<span class="_"> </span><span class="ff1a">system<span class="_ _66"> </span></span>created, it calls<span class="_"> </span><span class="ff1a">wait</span></span></span></div><div class="t m0 xe2 h26 y6271 ff19 fsf fc0 sc0 ls0 ws0">again and <span class="_ _2"></span>blocks <span class="_ _2"></span>until <span class="_ _2"></span>the<span class="_ _47"> </span><span class="ff1a">sleep<span class="_ _66"> </span></span>is <span class="_ _2"></span>done.<span class="_ _61"> </span>Then<span class="_"> </span><span class="ff1a">system<span class="_ _47"> </span></span><span class="ls45">re</span>turns. <span class="_ _47"> </span>When<span class="_"> </span><span class="ff1a">pclose</span></div><div class="t m0 xe2 h26 y6272 ff19 fsf fc0 sc0 ls0 ws0">calls<span class="_ _35"> </span><span class="ff1a">wait</span>,<span class="_ _44"> </span>an<span class="_ _44"> </span>error <span class="_ _23"> </span>is <span class="_ _42"> </span>returned, <span class="_ _23"> </span>since <span class="_ _42"> </span>ther<span class="lsb82">ea<span class="_ _43"></span><span class="ls45">re <span class="_ _42"> </span>n<span class="_ _2"></span><span class="lsb82">om<span class="_ _43"></span><span class="ls0">or<span class="lsb82">ec<span class="_ _c"></span><span class="ls0">hildren <span class="_ _42"> </span>to<span class="_ _35"> </span><span class="ff1a">wait<span class="_ _44"> </span></span>for<span class="_ _6"></span>.</span></span></span></span></span></span></div><div class="t m0 xe2 h26 y6273 ff19 fsf fc0 sc0 ls0 ws0">Then<span class="_"> </span><span class="ff1a">pclose<span class="_ _80"> </span></span><span class="ls45">re<span class="_ _2"></span></span>turns an error<span class="_ _6"></span>.</div><div class="t m0 x32 h26 y6274 ff18 fsf fc0 sc0 ls0 ws0">15.7<span class="_ _210"> </span><span class="ff19">Although <span class="_ _23"> </span>the <span class="_ _23"></span>details <span class="_ _23"></span>vary <span class="_ _9"></span>by <span class="_ _23"> </span>platform <span class="_ _23"></span>(see <span class="_ _23"></span>Figur<span class="_ _0"></span><span class="ls7de">eC<span class="_ _b"></span><span class="ls0">.19),<span class="_ _45"> </span><span class="ff1a">select<span class="_ _45"> </span></span>indicates <span class="_ _23"> </span>that</span></span></span></div><div class="t m0 xe2 h26 y6275 ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _42"> </span>descriptor <span class="_ _23"> </span>is <span class="_ _42"> </span>readable. <span class="_ _35"> </span>After<span class="_ _35"> </span>all <span class="_ _42"> </span>the <span class="_ _42"> </span>data <span class="_ _42"> </span>has <span class="_ _42"> </span>been <span class="_ _23"> </span>read,<span class="_ _35"> </span><span class="ff1a">read<span class="_ _44"> </span></span><span class="ls45">re</span>turns <span class="_ _42"> </span>0 <span class="_ _42"> </span>to</div><div class="t m0 xe2 h26 y6276 ff19 fsf fc0 sc0 ls0 ws0">indicate <span class="_ _3"></span>the <span class="_ _2"></span>end <span class="_ _3"></span>of <span class="_ _3"></span>ﬁle.<span class="_ _16"> </span>But <span class="_ _3"></span>with<span class="_ _47"> </span><span class="ff1a">poll</span><span class="ls1812">,t<span class="_ _4f"></span><span class="ls0">he<span class="_ _47"> </span><span class="ff1a">POLLHUP<span class="_ _47"> </span></span>event <span class="_ _3"></span>is <span class="_ _3"></span>returned, <span class="_ _2"></span>and <span class="_ _3"></span>this</span></span></div><div class="t m0 xe2 h2a y6277 ff19 fsf fc0 sc0 ls0 ws0">can <span class="_ _9"></span>happen <span class="_ _9"></span>while <span class="_ _9"></span>there<span class="_ _47"> </span>is<span class="_ _45"> </span>still <span class="_ _9"></span>data <span class="_ _9"></span>to <span class="_ _9"></span>be <span class="_ _9"></span>read. <span class="_ _45"> </span>Once<span class="_ _47"> </span>we <span class="_ _9"></span>have <span class="_ _9"></span>read <span class="_ _9"></span>all <span class="_ _9"></span>the <span class="_ _9"></span>data,</div><div class="t m0 xe2 h26 y6278 ff19 fsf fc0 sc0 ls0 ws0">however<span class="_ _6"></span>,<span class="_ _35"> </span><span class="ff1a">read<span class="_ _45"> </span></span><span class="ls45">re</span>turns <span class="_ _23"></span>0 <span class="_ _9"></span>to <span class="_ _23"></span>indicate <span class="_ _9"></span>the <span class="_ _23"></span>end <span class="_ _9"></span>of <span class="_ _23"></span>ﬁle.<span class="_ _5a"> </span>After <span class="_ _23"></span>all <span class="_ _9"></span>the <span class="_ _9"></span>data <span class="_ _23"></span>has <span class="_ _9"></span>been</div><div class="t m0 xe2 h26 y6279 ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">ad, <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">POLLIN<span class="_ _47"> </span></span>event <span class="_ _2"></span>is <span class="_ _3"></span>not <span class="_ _2"></span>returned, <span class="_ _2"></span>even <span class="_ _3"></span>though <span class="_ _3"></span>we <span class="_ _2"></span>need <span class="_ _3"></span>to <span class="_ _2"></span>issue <span class="_ _3"></span>a<span class="_ _47"> </span><span class="ff1a">read<span class="_ _47"> </span></span>to</span></div><div class="t m0 xe2 h2a y627a ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">ceive the end-of-ﬁle notiﬁcation (the return value of 0).</span></div><div class="t m0 x19c h2d y627b ff19 fs10 fc0 sc0 ls0 ws0">FreeBSD <span class="_ _9b"> </span>Linux <span class="_ _9b"> </span>Mac<span class="_"> </span>OS X<span class="_ _1bb"> </span>Solaris</div><div class="t m0 x1d9 h2d y627c ff19 fs10 fc0 sc0 ls0 ws0">8.0 <span class="_ _6c"> </span>3.2.0<span class="_ _dc"> </span>10.6.8 <span class="_ _8a"> </span>10</div><div class="t m0 x108 h2d y627d ff19 fs10 fc0 sc0 ls0 ws0">Operation</div><div class="t m0 x1e1 h4f y627e ff19 fs11 fc0 sc0 ls0 ws0">R/W/E <span class="_ _12b"> </span>R<span class="_ _12c"> </span>R/W <span class="_ _2b9"> </span>R/W/E<span class="_ _324"></span><span class="ff1a">select<span class="_ _53"> </span><span class="ff19">on<span class="_"> </span></span>read<span class="_ _e"> </span><span class="ff19">end of pipe with<span class="_"> </span></span>write<span class="_ _e"> </span><span class="ff19">end closed</span></span></div><div class="t m0 x1e1 h4f y627f ff19 fs11 fc0 sc0 ls0 ws0">R/HUP <span class="_ _87"> </span>HUP<span class="_ _21"> </span>INV <span class="_ _1a8"> </span>HUP<span class="_ _2be"></span><span class="ff1a">poll<span class="_ _53"> </span><span class="ff19">on<span class="_"> </span></span>read<span class="_ _e"> </span><span class="ff19">end of pipe with<span class="_"> </span></span>write<span class="_ _e"> </span><span class="ff19">end closed</span></span></div><div class="t m0 x1e1 h4f y6280 ff19 fs11 fc0 sc0 ls0 ws0">R/W/E <span class="_ _87"> </span>R/W<span class="_ _1a8"> </span>R/W <span class="_ _1c4"> </span>R/W<span class="_ _2be"></span><span class="ff1a">select<span class="_ _53"> </span><span class="ff19">on<span class="_"> </span></span>write<span class="_ _e"> </span><span class="ff19">end of pipe with<span class="_"> </span></span>read<span class="_ _53"> </span><span class="ff19">end closed</span></span></div><div class="t m0 x1e1 h4f y6281 ff19 fs11 fc0 sc0 ls0 ws0">R/HUP <span class="_ _141"> </span>W/ERR<span class="_ _15"> </span>INV <span class="_ _1a8"> </span>HUP<span class="_ _2be"></span><span class="ff1a">poll<span class="_ _e"> </span><span class="ff19">on<span class="_"> </span></span>write<span class="_ _e"> </span><span class="ff19">end of pipe with<span class="_"> </span></span>read<span class="_ _53"> </span><span class="ff19">end closed</span></span></div><div class="t m0 x2f h6d y6282 ff18 fs12 fc0 sc0 ls0 ws0">Figure C.19<span class="_ _5a"> </span><span class="ff19">Pipe behavior with<span class="_"> </span><span class="ff1a">select<span class="_ _e"> </span></span>and<span class="_"> </span><span class="ff1a">poll</span></span></div><div class="t m0 xe2 h50 y6283 ff19 fs29 fc0 sc0 ls0 ws0">The <span class="_ _47"> </span>conditions <span class="_ _47"> </span>shown <span class="_ _47"> </span>in <span class="_ _47"> </span>Figur<span class="ls1871">eC<span class="_ _1d"></span><span class="ls0">.19 <span class="_ _47"> </span>include <span class="_ _47"> </span>R <span class="_ _47"> </span>(readable), <span class="_ _47"> </span>W <span class="_ _47"> </span>(writable), <span class="_ _47"> </span>E</span></span></div><div class="t m0 xe2 h50 y6284 ff19 fs29 fc0 sc0 ls0 ws0">(exception), <span class="_ _3"></span>HUP <span class="_ _9"></span>(hangup), <span class="_ _9"></span>ERR <span class="_ _3"></span>(error), <span class="_ _3"></span>and <span class="_ _9"></span>INV <span class="_ _9"></span>(invalid <span class="_ _3"></span>ﬁle <span class="_ _9"></span>descriptor).<span class="_ _5a"> </span><span class="ls12f8">Wi<span class="_ _3"></span></span>th</div><div class="t m0 xe2 h50 y6285 ff19 fs29 fc0 sc0 ls0 ws0">an <span class="_ _53"> </span>output <span class="_ _53"> </span>descriptor <span class="_ _53"> </span>that <span class="_ _e"> </span>refers <span class="_ _42"> </span>to <span class="_ _e"> </span>a <span class="_ _53"> </span>pipe <span class="_ _53"> </span>that <span class="_ _e"> </span>has <span class="_ _53"> </span>been <span class="_ _53"> </span>closed <span class="_ _53"> </span>by <span class="_ _e"> </span>the <span class="_ _53"> </span>reader<span class="_ _6"></span>,</div><div class="t m0 xe2 h5c y6286 ff1a fs29 fc0 sc0 ls0 ws0">select<span class="_ _45"> </span><span class="ff19">indicates <span class="_ _23"> </span>that <span class="_ _23"> </span>the <span class="_ _23"> </span>descriptor <span class="_ _23"></span>is <span class="_ _23"></span>writable.<span class="_ _51"> </span>But <span class="_ _9"></span>when <span class="_ _23"> </span>we <span class="_ _23"> </span>call<span class="_ _35"> </span></span>write<span class="ff19 ls1872">,t<span class="_ _43"></span><span class="ls0">he</span></span></div><div class="t m0 xe2 h5c y6287 ff1a fs29 fc0 sc0 ls0 ws0">SIGPIPE<span class="_ _35"> </span><span class="ff19">signal <span class="_ _23"> </span>is <span class="_ _23"> </span>generated.<span class="_ _54"> </span>If <span class="_ _23"></span>we <span class="_ _23"> </span>either <span class="_ _42"> </span>ignor<span class="_ _0"></span><span class="ls1873">et<span class="_ _43"></span><span class="ls0">his <span class="_ _23"> </span>signal <span class="_ _42"> </span>or <span class="_ _23"> </span>return <span class="_ _23"></span>from <span class="_ _23"></span>its</span></span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
