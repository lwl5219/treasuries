<div id="pf3b3" class="pf w4 h1f" data-page-no="3b3"><div class="pc pc3b3 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg3b3.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Appendix <span class="_"> </span>C<span class="_ _322"> </span>Chapter <span class="_"> </span>5<span class="_ _54"> </span>Solutions<span class="_ _1b"> </span><span class="ff18">913</span></div><div class="t m0 x32 h2a y12f ff18 fsf fc0 sc0 ls0 ws0">5.3<span class="_ _9b"> </span><span class="ff19">The function call</span></div><div class="t m0 x1a7 h57 y6081 ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;&quot;);</div><div class="t m0 x215 h2a y6082 ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">turns 0, since no characters ar<span class="ls44">eo<span class="_ _d"></span><span class="ls0">utput.</span></span></span></div><div class="t m0 x32 h26 y6083 ff18 fsf fc0 sc0 ls0 ws0">5.4<span class="_ _9b"> </span><span class="ff19">This is <span class="_ _2"></span>a <span class="_ _2"></span>common <span class="_ _2"></span>error<span class="_ _6"></span><span class="lsee5">.T<span class="_ _5b"></span><span class="ls0">he <span class="_ _2"></span>return value <span class="_ _2"></span>from<span class="_ _66"> </span><span class="ff1a">getc<span class="_ _47"> </span></span>and<span class="_"> </span><span class="ff1a">getchar<span class="_ _47"> </span></span>is <span class="_ _2"></span>an<span class="_ _66"> </span><span class="ff1a">int</span><span class="ls181e">,n<span class="_ _d"></span><span class="ls0">ot</span></span></span></span></span></div><div class="t m0 x215 h26 y6084 ff19 fsf fc0 sc0 ls0 ws0">a<span class="_ _66"> </span><span class="ff1a">char</span>.<span class="_ _16"> </span><span class="ff1a">EOF<span class="_ _66"> </span></span>is <span class="_ _3"></span>often <span class="_ _2"></span>deﬁned <span class="_ _2"></span>to <span class="_ _3"></span>be<span class="_ _47"> </span><span class="ff20">−</span>1, <span class="_ _2"></span>so <span class="_ _2"></span>if <span class="_ _2"></span>the <span class="_ _3"></span>system <span class="_ _2"></span>uses <span class="_ _3"></span>signed <span class="_ _2"></span>characters, <span class="_ _2"></span>the</div><div class="t m0 x215 h26 y6085 ff19 fsf fc0 sc0 ls0 ws0">code <span class="_ _23"></span>normally <span class="_ _9"></span>works.<span class="_ _51"> </span>But <span class="_ _23"></span>if <span class="_ _23"></span>the <span class="_ _23"></span>system <span class="_ _9"></span>uses <span class="_ _23"> </span>unsigned <span class="_ _23"></span>characters, <span class="_ _23"></span>after <span class="_ _23"></span>the<span class="_ _45"> </span><span class="ff1a">EOF</span></div><div class="t m0 x215 h26 y6086 ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">turned <span class="_ _3"></span>by<span class="_ _47"> </span><span class="ff1a">getchar<span class="_ _47"> </span></span>is <span class="_ _3"></span>stored <span class="_ _2"></span>as <span class="_ _3"></span>an <span class="_ _3"></span>unsigned <span class="_ _3"></span>character<span class="_ _6"></span><span class="lsb59">,t<span class="_ _4f"></span><span class="ls0">he <span class="_ _3"></span>character<span class="_ _9"></span>’s <span class="_ _2"></span>value <span class="_ _3"></span>no</span></span></span></div><div class="t m0 x215 h2a y6087 ff19 fsf fc0 sc0 ls0 ws0">longer <span class="_ _23"></span>equals<span class="_ _45"> </span><span class="ff20">−</span>1, <span class="_ _23"> </span>so <span class="_ _23"></span>the <span class="_ _23"></span>loop <span class="_ _23"></span>never <span class="_ _9"></span>terminates.<span class="_ _51"> </span>The <span class="_ _23"></span>four <span class="_ _23"></span>platforms <span class="_ _9"></span>described <span class="_ _23"> </span>in</div><div class="t m0 x215 h2a y6088 ff19 fsf fc0 sc0 ls0 ws0">this book all <span class="_ _2"></span>use signed <span class="_ _2"></span>characters, so the <span class="_ _2"></span>example code <span class="_ _2"></span>works on <span class="_ _2"></span>these platforms.</div><div class="t m0 x32 h26 y6089 ff18 fsf fc0 sc0 ls0 ws0">5.5<span class="_ _9b"> </span><span class="ff19">Call<span class="_ _45"> </span><span class="ff1a">fsync<span class="_ _45"> </span></span>after <span class="_ _9"></span>each <span class="_ _23"></span>call <span class="_ _9"></span>to<span class="_ _35"> </span><span class="ff1a">fflush</span><span class="ls181f">.T<span class="_ _26"></span><span class="ls0">he <span class="_ _9"></span>argument <span class="_ _23"></span>to<span class="_ _45"> </span><span class="ff1a">fsync<span class="_ _45"> </span></span>is <span class="_ _23"></span>obtained <span class="_ _9"></span>with</span></span></span></div><div class="t m0 x215 h26 y608a ff19 fsf fc0 sc0 ls0 ws0">the<span class="_ _66"> </span><span class="ff1a">fileno<span class="_ _66"> </span></span>function. <span class="_ _47"> </span>Calling<span class="_"> </span><span class="ff1a">fsync<span class="_ _47"> </span></span>without <span class="_ _2"></span>calling<span class="_ _66"> </span><span class="ff1a">fflush<span class="_ _66"> </span></span>might <span class="_ _2"></span>do <span class="_ _2"></span>nothing <span class="_ _2"></span>if</div><div class="t m0 x215 h2a y608b ff19 fsf fc0 sc0 ls0 ws0">all the data wer<span class="ls44">es<span class="_ _4f"></span><span class="ls0">till in memory buffers.</span></span></div><div class="t m0 x32 h2a y608c ff18 fsf fc0 sc0 ls0 ws0">5.6<span class="_ _9b"> </span><span class="ff19">Standar<span class="_ _1"></span><span class="ls64f">di<span class="_ _d"></span><span class="ls0">nput <span class="_ _2"></span>and standar<span class="ls64f">do<span class="_ _d"></span><span class="ls0">utput ar<span class="ls64f">eb<span class="_ _4f"></span><span class="ls0">oth <span class="_ _2"></span>line <span class="_ _2"></span>buffer<span class="_ _0"></span>ed when a <span class="_ _2"></span>program is <span class="_ _2"></span>run</span></span></span></span></span></span></span></div><div class="t m0 x215 h26 y608d ff19 fsf fc0 sc0 ls0 ws0">interactively<span class="_ _4"></span><span class="ls86">.W<span class="_ _4a"></span><span class="ls0">hen<span class="_"> </span><span class="ff1a">fgets<span class="_ _66"> </span></span>is called, standar<span class="ls44">do<span class="_ _4f"></span><span class="ls0">utput is ﬂushed automatically<span class="_ _6"></span>.</span></span></span></span></div><div class="t m0 x32 h26 y608e ff18 fsf fc0 sc0 ls0 ws0">5.7<span class="_ _9b"> </span><span class="ff19">An implementation of<span class="_"> </span><span class="ff1a">fmemopen<span class="_ _e"> </span></span>for BSD</span></div><div class="t m0 x176 h2a y608f ff19 fsf fc0 sc0 ls0 ws0">-</div><div class="t m0 x1fe h2a y608e ff19 fsf fc0 sc0 ls0 ws0">based systems is shown in Figur<span class="ls44">eC<span class="_ _4f"></span><span class="ls0">.4.</span></span></div><div class="t m0 x215 h4e y6090 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;stdio.h&gt;</div><div class="t m0 x215 h4e y6091 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;stdlib.h&gt;</div><div class="t m0 x215 h4e y6092 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;string.h&gt;</div><div class="t m0 x215 h4e y6093 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;errno.h&gt;</div><div class="t m0 x215 h4e y6094 ff1a fs28 fc0 sc0 ls0 ws0">/*</div><div class="t m0 x14d h4e y6095 ff1a fs28 fc0 sc0 ls1b6 ws0">*O<span class="_ _1d"></span><span class="ls0">ur internal structure tracking a memory stream</span></div><div class="t m0 x14d h4e y6096 ff1a fs28 fc0 sc0 ls0 ws0">*/</div><div class="t m0 x215 h4e y6097 ff1a fs28 fc0 sc0 ls0 ws0">struct memstream</div><div class="t m0 x215 h4e y6098 ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 xc4 h4e y6099 ff1a fs28 fc0 sc0 ls0 ws0">char <span class="_ _68"> </span>*buf;<span class="_ _87"> </span>/* in-memory buffer */</div><div class="t m0 xc4 h4e y609a ff1a fs28 fc0 sc0 ls0 ws0">size_t <span class="_"> </span>rsize; <span class="_"> </span>/*<span class="_"> </span>real size of buffer */</div><div class="t m0 xc4 h4e y609b ff1a fs28 fc0 sc0 ls0 ws0">size_t <span class="_"> </span>vsize; <span class="_"> </span>/*<span class="_"> </span>virtual size of buffer */</div><div class="t m0 xc4 h4e y609c ff1a fs28 fc0 sc0 ls0 ws0">size_t <span class="_"> </span>curpos;<span class="_"> </span>/* current position in buffer */</div><div class="t m0 xc4 h4e y609d ff1a fs28 fc0 sc0 ls0 ws0">int <span class="_ _15"> </span>flags;<span class="_ _d9"> </span>/* see below */</div><div class="t m0 x215 h4e y609e ff1a fs28 fc0 sc0 ls0 ws0">};</div><div class="t m0 x215 h4e y609f ff1a fs28 fc0 sc0 ls0 ws0">/* flags */</div><div class="t m0 x215 h4e y60a0 ff1a fs28 fc0 sc0 ls0 ws0">#define MS_READ<span class="_ _8a"> </span>0x01 <span class="_ _68"> </span>/*<span class="_"> </span>open for reading */</div><div class="t m0 x215 h4e y60a1 ff1a fs28 fc0 sc0 ls0 ws0">#define MS_WRITE<span class="_ _15"> </span>0x02 <span class="_ _68"> </span>/*<span class="_"> </span>open for writing */</div><div class="t m0 x215 h4e y60a2 ff1a fs28 fc0 sc0 ls0 ws0">#define MS_APPEND<span class="_ _68"> </span>0x04 <span class="_ _87"> </span>/*<span class="_"> </span>append to stream */</div><div class="t m0 x215 h4e y60a3 ff1a fs28 fc0 sc0 ls0 ws0">#define MS_TRUNCATE 0x08<span class="_ _15"> </span>/* truncate the stream on open */</div><div class="t m0 x215 h4e y60a4 ff1a fs28 fc0 sc0 ls0 ws0">#define MS_MYBUF<span class="_ _15"> </span>0x10 <span class="_ _68"> </span>/*<span class="_"> </span>free buffer on close */</div><div class="t m0 x215 h4e y60a5 ff1a fs28 fc0 sc0 ls0 ws0">#ifndef MIN</div><div class="t m0 x215 h4e y60a6 ff1a fs28 fc0 sc0 ls0 ws0">#define MIN(a, b) ((a) &lt; (b) ? (a) : (b))</div><div class="t m0 x215 h4e y60a7 ff1a fs28 fc0 sc0 ls0 ws0">#endif</div><div class="t m0 x215 h4e y60a8 ff1a fs28 fc0 sc0 ls0 ws0">static int mstream_read(void *, char *, int);</div><div class="t m0 x215 h4e y60a9 ff1a fs28 fc0 sc0 ls0 ws0">static int mstream_write(void *, const char *, int);</div><div class="t m0 x215 h4e y60aa ff1a fs28 fc0 sc0 ls0 ws0">static fpos_t mstream_seek(void *, fpos_t, int);</div><div class="t m0 x215 h4e y60ab ff1a fs28 fc0 sc0 ls0 ws0">static int mstream_close(void *);</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
