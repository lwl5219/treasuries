<div id="pf254" class="pf w4 h1f" data-page-no="254"><div class="pc pc254 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg254.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">562<span class="_ _1b"> </span><span class="ff19">Interprocess <span class="_"> </span>Communication<span class="_ _2c"> </span>Chapter <span class="_"> </span>15</span></div><div class="t m0 x3f h26 y12f ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _42"> </span>ﬁrst <span class="_ _42"> </span>function <span class="_ _42"> </span>normally <span class="_ _42"> </span>called <span class="_ _42"> </span>is<span class="_ _35"> </span><span class="ff1a">msgget<span class="_ _44"> </span></span>to <span class="_ _42"> </span>either <span class="_ _42"> </span>open <span class="_ _42"> </span>an <span class="_ _42"> </span>existing <span class="_ _42"> </span>queue <span class="_ _42"> </span>or</div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">create a new queue.</div><div class="t m0 x3f h57 y1c09 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;sys/msg.h&gt;</div><div class="t m0 x3f h57 y43f6 ff1a fs2d fc0 sc0 ls0 ws0">int msgget(key_t<span class="_"> </span><span class="ff1b">key</span><span class="ls15c">,i<span class="_ _1d"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">ﬂag</span>);</span></span></div><div class="t m0 x92 h5f y43f7 ff19 fs2d fc0 sc0 ls0 ws0">Returns: message queue ID if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h4a y43f8 ff19 fs26 fc0 sc0 ls0 ws0">In <span class="_ _42"> </span>Section <span class="_ _42"> </span>15.6.1, <span class="_ _42"> </span>we <span class="_ _42"> </span>described <span class="_ _23"> </span>the <span class="_ _42"> </span>rules <span class="_ _42"> </span>for <span class="_ _42"> </span>converting <span class="_ _42"> </span>the<span class="_ _44"> </span><span class="ff1b">key<span class="_ _35"> </span></span>into <span class="_ _42"> </span>an <span class="_ _42"> </span>identiﬁer <span class="_ _42"> </span>and</div><div class="t m0 x32 h49 y43f9 ff19 fs26 fc0 sc0 ls0 ws0">discussed <span class="_ _9"></span>whether <span class="_ _9"></span>a <span class="_ _9"></span>new <span class="_ _9"></span>queue <span class="_ _23"></span>is <span class="_ _9"></span>created <span class="_ _3"></span>or <span class="_ _9"></span>an <span class="_ _9"></span>existing <span class="_ _23"></span>queue <span class="_ _9"></span>is <span class="_ _9"></span>refer<span class="_ _0"></span>enced. <span class="_ _45"> </span>When<span class="_ _45"> </span>a</div><div class="t m0 x32 h4d y43fa ff19 fs26 fc0 sc0 ls0 ws0">new <span class="_ _2"></span>queue <span class="_ _2"></span>is <span class="_ _2"></span>created, the <span class="_ _2"></span>following <span class="_ _2"></span>members <span class="_ _3"></span>of <span class="_ _2"></span>the<span class="_ _66"> </span><span class="ff1a">msqid_ds<span class="_ _47"> </span></span>structur<span class="_ _0"></span><span class="ls121e">ea<span class="_ _4f"></span><span class="lscc">re <span class="_ _3"></span>i<span class="_ _2"></span><span class="ls0">nitialized.</span></span></span></div><div class="t m0 x3f h4d y43fb ff19 fs26 fc0 sc0 ls15d ws0">•T<span class="_ _4d"></span><span class="ls0">he<span class="_ _45"> </span><span class="ff1a">ipc_perm<span class="_ _45"> </span></span>structure<span class="_ _47"> </span>is<span class="_ _45"> </span>initialized <span class="_ _23"></span>as <span class="_ _9"></span>described <span class="_ _9"></span>in <span class="_ _9"></span>Section <span class="_ _9"></span>15.6.2.<span class="_ _5a"> </span>The<span class="_ _45"> </span><span class="ff1a">mode</span></span></div><div class="t m0 x15 h4a y43fc ff19 fs26 fc0 sc0 ls0 ws0">member <span class="_"> </span>of <span class="_ _e"> </span>this <span class="_"> </span>structur<span class="_ _0"></span>e<span class="_ _59"> </span>is<span class="_ _59"> </span>set <span class="_"> </span>to <span class="_"> </span>the <span class="_ _e"> </span>corresponding <span class="_ _e"> </span>permission <span class="_"> </span>bits <span class="_"> </span>of<span class="_ _4b"> </span><span class="ff1b">ﬂag</span>.</div><div class="t m0 x15 h49 y43fd ff19 fs26 fc0 sc0 ls0 ws0">These permissions ar<span class="lsd3">es<span class="_ _4f"></span><span class="ls0">peciﬁed with the values from Figur<span class="lsd3">e1<span class="_ _4f"></span><span class="ls0">5.24.</span></span></span></span></div><div class="t m0 x3f h4d y43fe ff19 fs26 fc0 sc0 ls0 ws0">•<span class="_ _5c"> </span><span class="ff1a">msg_qnum</span>,<span class="_ _35"> </span><span class="ff1a">msg_lspid</span>,<span class="_ _35"> </span><span class="ff1a">msg_lrpid</span>,<span class="_ _35"> </span><span class="ff1a">msg_stime</span><span class="lsf38">,a<span class="_ _43"></span><span class="ls0">nd<span class="_ _35"> </span><span class="ff1a">msg_rtime<span class="_ _35"> </span></span>ar<span class="_ _0"></span><span class="lsf38">ea<span class="_ _43"></span><span class="ls0">ll <span class="_ _23"> </span>set</span></span></span></span></div><div class="t m0 x15 h49 y43ff ff19 fs26 fc0 sc0 ls0 ws0">to 0.</div><div class="t m0 x3f h4d y4400 ff19 fs26 fc0 sc0 ls0 ws0">•<span class="_ _5c"> </span><span class="ff1a">msg_ctime<span class="_ _66"> </span></span>is set to the current time.</div><div class="t m0 x3f h4d y4401 ff19 fs26 fc0 sc0 ls0 ws0">•<span class="_ _5c"> </span><span class="ff1a">msg_qbytes<span class="_ _66"> </span></span>is set to the system limit.</div><div class="t m0 x32 h4d y4402 ff19 fs26 fc0 sc0 ls0 ws0">On <span class="_ _9"></span>success,<span class="_ _35"> </span><span class="ff1a">msgget<span class="_ _45"> </span></span><span class="lscc">re<span class="_ _2"></span></span>turns <span class="_ _23"></span>the <span class="_ _9"></span>non-negative <span class="_ _23"></span>queue <span class="_ _9"></span>ID.<span class="_ _51"> </span>This <span class="_ _23"></span>value <span class="_ _9"></span>is <span class="_ _23"></span>then <span class="_ _9"></span>used <span class="_ _23"></span>with</div><div class="t m0 x32 h49 y4403 ff19 fs26 fc0 sc0 ls0 ws0">the other three message queue functions.</div><div class="t m0 x3f h4d y4404 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _45"> </span><span class="ff1a">msgctl<span class="_ _35"> </span></span>function <span class="_ _23"></span>performs <span class="_ _9"></span>various <span class="_ _23"> </span>operations <span class="_ _23"> </span>on <span class="_ _23"></span>a <span class="_ _23"></span>queue.<span class="_ _5a"> </span>This <span class="_ _23"> </span>function <span class="_ _23"></span>and</div><div class="t m0 x32 h4d y4405 ff19 fs26 fc0 sc0 ls0 ws0">the related functions for <span class="_ _2"></span>semaphores and shared memory (<span class="ff1a">semctl<span class="_ _66"> </span></span>and<span class="_"> </span><span class="ff1a">shmctl</span><span class="ls121f">)a<span class="_ _d"></span><span class="lscc">re <span class="_ _3"></span>t<span class="_ _2"></span><span class="ls0">he</span></span></span></div><div class="t m0 x32 h4d y4406 ff1a fs26 fc0 sc0 ls0 ws0">ioctl<span class="ff19">-like functions for XSI IPC (i.e., the garbage-can functions).</span></div><div class="t m0 x3f h4e y4407 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;sys/msg.h&gt;</div><div class="t m0 x3f h4e y4408 ff1a fs28 fc0 sc0 ls0 ws0">int msgctl(int<span class="_"> </span><span class="ff1b">msqid</span><span class="ls1b6">,i<span class="_ _1d"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">cmd</span><span class="ls1b6">,s<span class="_ _5b"></span><span class="ls0">truct msqid_ds *<span class="ff1b">buf<span class="_ _42"> </span></span>);</span></span></span></span></div><div class="t m0 x153 h7c y4409 ff19 fs28 fc0 sc0 ls0 ws0">Returns: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h60 y440a ff19 fs2c fc0 sc0 ls0 ws0">The<span class="_ _35"> </span><span class="ff1b">cmd<span class="_ _35"> </span></span>ar<span class="_ _0"></span>gument <span class="_ _23"></span>speciﬁes <span class="_ _23"></span>the <span class="_ _23"></span>command <span class="_ _23"> </span>to <span class="_ _23"> </span>be <span class="_ _23"> </span>performed <span class="_ _23"> </span>on <span class="_ _23"> </span>the <span class="_ _42"> </span>queue <span class="_ _23"></span>speciﬁed <span class="_ _23"></span>by</div><div class="t m0 x32 h60 y440b ff1b fs2c fc0 sc0 ls0 ws0">msqid<span class="ff19">.</span></div><div class="t m0 x3f h54 y440c ff1a fs2c fc0 sc0 ls0 ws0">IPC_STAT<span class="_"> </span><span class="ff19">Fetch <span class="_ _3"></span>the<span class="_ _47"> </span></span>msqid_ds<span class="_ _45"> </span><span class="ff19">structur<span class="_ _0"></span><span class="ls1220">ef<span class="_ _b"></span><span class="ls0">or <span class="_ _9"></span>this <span class="_ _3"></span>queue, <span class="_ _3"></span>storing <span class="_ _9"></span>it <span class="_ _3"></span>in <span class="_ _3"></span>the <span class="_ _3"></span>structure</span></span></span></div><div class="t m0 xf6 h60 y440d ff19 fs2c fc0 sc0 ls0 ws0">pointed to by<span class="_"> </span><span class="ff1b">buf</span>.</div><div class="t m0 x3f h54 y440e ff1a fs2c fc0 sc0 ls0 ws0">IPC_SET<span class="_ _6e"> </span><span class="ff19">Copy <span class="_ _42"> </span>the <span class="_ _42"> </span>following <span class="_ _42"> </span>ﬁelds <span class="_ _42"> </span>from <span class="_ _23"> </span>the <span class="_ _42"> </span>structur<span class="ls1221">ep<span class="_ _c"></span><span class="ls0">ointed <span class="_ _42"> </span>to <span class="_ _42"> </span>by<span class="_ _44"> </span><span class="ff1b">buf<span class="_ _44"> </span></span>to <span class="_ _42"> </span>the</span></span></span></div><div class="t m0 xf6 h54 y440f ff1a fs2c fc0 sc0 ls0 ws0">msqid_ds<span class="_ _48"> </span><span class="ff19">structur<span class="ls1222">ea<span class="_ _5d"></span><span class="ls0">ssociated <span class="_ _59"> </span>with <span class="_ _59"> </span>this <span class="_ _59"> </span>queue:<span class="_ _60"> </span><span class="ff1a">msg_perm.uid</span>,</span></span></span></div><div class="t m0 xf6 h54 y4410 ff1a fs2c fc0 sc0 ls0 ws0">msg_perm.gid<span class="ff19">,<span class="_ _45"> </span></span>msg_perm.mode<span class="ff19 ls1223">,a<span class="_ _b"></span><span class="ls0">nd<span class="_ _45"> </span><span class="ff1a">msg_qbytes</span><span class="ls1224">.T<span class="_ _26"></span><span class="ls0">his <span class="_ _23"></span>command</span></span></span></span></div><div class="t m0 xf6 h55 y4411 ff19 fs2c fc0 sc0 ls0 ws0">can <span class="_ _47"> </span>be <span class="_ _66"> </span>executed <span class="_ _47"> </span>only <span class="_ _47"> </span>by <span class="_ _47"> </span>a <span class="_ _47"> </span>process <span class="_ _66"> </span>whose <span class="_ _47"> </span>effective <span class="_ _66"> </span>user <span class="_ _47"> </span>ID <span class="_ _47"> </span>equals</div><div class="t m0 xf6 h54 y4412 ff1a fs2c fc0 sc0 ls0 ws0">msg_perm.cuid<span class="_ _4b"> </span><span class="ff19">or<span class="_ _4b"> </span></span>msg_perm.uid<span class="_ _4b"> </span><span class="ff19">or <span class="_ _53"> </span>by <span class="_ _e"> </span>a <span class="_ _e"> </span>process <span class="_ _53"> </span>with <span class="_ _53"> </span>superuser</span></div><div class="t m0 xf6 h54 y4413 ff19 fs2c fc0 sc0 ls0 ws0">privileges. <span class="_"> </span>Only<span class="_"> </span>the superuser can incr<span class="_ _0"></span>ease the value of<span class="_"> </span><span class="ff1a">msg_qbytes</span>.</div><div class="t m0 x3f h54 y4414 ff1a fs2c fc0 sc0 ls0 ws0">IPC_RMID<span class="_"> </span><span class="ff19">Remove <span class="_ _9"></span>the <span class="_ _23"> </span>message <span class="_ _23"></span>queue <span class="_ _23"></span>fr<span class="_ _0"></span>om <span class="_ _23"></span>the <span class="_ _9"></span>system <span class="_ _23"></span>and <span class="_ _23"></span>any <span class="_ _9"></span>data <span class="_ _23"></span>still <span class="_ _23"></span>on <span class="_ _9"></span>the</span></div><div class="t m0 xf6 h55 y4415 ff19 fs2c fc0 sc0 ls0 ws0">queue. <span class="_ _44"> </span>This<span class="_ _35"> </span><span class="ls150">re<span class="_ _2"></span></span>moval <span class="_ _42"> </span>is <span class="_ _42"> </span>immediate.<span class="_ _54"> </span>Any <span class="_ _42"> </span>other <span class="_ _42"> </span>process <span class="_ _42"> </span>still <span class="_ _42"> </span>using <span class="_ _42"> </span>the</div><div class="t m0 xf6 h54 y4416 ff19 fs2c fc0 sc0 ls0 ws0">message <span class="_ _45"> </span>queue <span class="_ _45"> </span>will <span class="_ _45"> </span>get <span class="_ _45"> </span>an <span class="_ _45"> </span>error <span class="_ _45"> </span>of<span class="_ _5a"> </span><span class="ff1a">EIDRM<span class="_"> </span></span>on <span class="_ _45"> </span>its <span class="_ _45"> </span>next <span class="_ _45"> </span>attempted</div><div class="t m0 xf6 h55 y4417 ff19 fs2c fc0 sc0 ls0 ws0">operation <span class="_"> </span>on <span class="_ _e"> </span>the <span class="_"> </span>queue.<span class="_ _60"> </span>This <span class="_"> </span>command <span class="_ _e"> </span>can <span class="_"> </span>be <span class="_"> </span>executed <span class="_ _e"> </span>only <span class="_"> </span>by <span class="_"> </span>a</div><div class="t m0 xf6 h54 y4418 ff19 fs2c fc0 sc0 ls0 ws0">process <span class="_ _50"> </span>whose <span class="_ _50"> </span>effective <span class="_ _50"> </span>user <span class="_ _5f"> </span>ID <span class="_ _50"> </span>equals<span class="_ _d9"> </span><span class="ff1a">msg_perm.cuid<span class="_ _d9"> </span></span>or</div><div class="t m0 xf6 h54 y4419 ff1a fs2c fc0 sc0 ls0 ws0">msg_perm.uid<span class="_ _80"> </span><span class="ff19">or by a process with superuser privileges.</span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
