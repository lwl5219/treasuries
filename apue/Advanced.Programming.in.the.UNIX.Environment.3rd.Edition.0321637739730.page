<div id="pf2da" class="pf w4 h1f" data-page-no="2da"><div class="pc pc2da w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg2da.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">696<span class="_ _1b"> </span><span class="ff19 ls719">Te<span class="_ _9"></span><span class="ls0">rminal <span class="_"> </span>I/O<span class="_ _eb"> </span>Chapter <span class="_"> </span>18</span></span></div><div class="t m0 x32 h2a y12f ff19 fsf fc0 sc0 ls0 ws0">When we run the pr<span class="_ _0"></span>ogram from Figur<span class="_ _0"></span><span class="ls44">e1<span class="_ _d"></span><span class="ls0">8.14, we get the following output:</span></span></div><div class="t m0 x3f h57 ya9b ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">./a.out</span></div><div class="t m0 x3f h57 yac1 ff1a fs2d fc0 sc0 ls0 ws0">fd 0: tty</div><div class="t m0 x3f h57 yac2 ff1a fs2d fc0 sc0 ls0 ws0">fd 1: tty</div><div class="t m0 x3f h57 yac3 ff1a fs2d fc0 sc0 ls0 ws0">fd 2: tty</div><div class="t m0 x3f h57 yac4 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">./a.out &lt;/etc/passwd 2&gt;/dev/null</span></div><div class="t m0 x3f h57 yac5 ff1a fs2d fc0 sc0 ls0 ws0">fd 0: not a tty</div><div class="t m0 x3f h57 y321e ff1a fs2d fc0 sc0 ls0 ws0">fd 1: tty</div><div class="t m0 x3f h57 y321f ff1a fs2d fc0 sc0 ls0 ws0">fd 2: not a tty</div><div class="t m0 x35 h4d y5113 ff16 fs26 fc0 sc0 ls0 ws0">Example <span class="_ _84"></span>—<span class="_ _9"></span><span class="ff1f">ttyname<span class="_ _66"> </span></span>Function</div><div class="t m0 x32 h4d y5114 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _4b"> </span><span class="ff1a">ttyname<span class="_ _59"> </span></span>function <span class="_ _e"> </span>(Figur<span class="ls14f0">e1<span class="_ _55"></span><span class="ls0">8.15) <span class="_ _e"> </span>is <span class="_ _e"> </span>longer<span class="_ _1"></span>,<span class="_ _59"> </span>as<span class="_ _4b"> </span>w<span class="ls14f1">eh<span class="_ _55"></span><span class="ls0">ave <span class="_"> </span>to <span class="_ _53"> </span>search <span class="_ _e"> </span>all <span class="_ _e"> </span>the <span class="_"> </span>device</span></span></span></span></div><div class="t m0 x32 h49 y5115 ff19 fs26 fc0 sc0 ls0 ws0">entries, looking for a match.</div><div class="t m0 x32 h5d y5116 ff1a fs2f fc0 sc0 ls0 ws0">#include <span class="_ _68"> </span>&lt;sys/stat.h&gt;</div><div class="t m0 x32 h5d y5117 ff1a fs2f fc0 sc0 ls0 ws0">#include <span class="_ _68"> </span>&lt;dirent.h&gt;</div><div class="t m0 x32 h5d y5118 ff1a fs2f fc0 sc0 ls0 ws0">#include <span class="_ _68"> </span>&lt;limits.h&gt;</div><div class="t m0 x32 h5d y5119 ff1a fs2f fc0 sc0 ls0 ws0">#include <span class="_ _68"> </span>&lt;string.h&gt;</div><div class="t m0 x32 h5d y511a ff1a fs2f fc0 sc0 ls0 ws0">#include <span class="_ _68"> </span>&lt;termios.h&gt;</div><div class="t m0 x32 h5d y511b ff1a fs2f fc0 sc0 ls0 ws0">#include <span class="_ _68"> </span>&lt;unistd.h&gt;</div><div class="t m0 x32 h5d y511c ff1a fs2f fc0 sc0 ls0 ws0">#include <span class="_ _68"> </span>&lt;stdlib.h&gt;</div><div class="t m0 x32 h5d y511d ff1a fs2f fc0 sc0 ls0 ws0">struct devdir {</div><div class="t m0 x8a h5d y511e ff1a fs2f fc0 sc0 ls0 ws0">struct devdir<span class="_ _68"> </span>*d_next;</div><div class="t m0 x8a h5d y511f ff1a fs2f fc0 sc0 ls0 ws0">char <span class="_ _bd"> </span>*d_name;</div><div class="t m0 x32 h5d y5120 ff1a fs2f fc0 sc0 ls0 ws0">};</div><div class="t m0 x32 h5d y5121 ff1a fs2f fc0 sc0 ls0 ws0">static struct devdir<span class="_ _15"> </span>*head;</div><div class="t m0 x32 h5d y5122 ff1a fs2f fc0 sc0 ls0 ws0">static struct devdir<span class="_ _15"> </span>*tail;</div><div class="t m0 x32 h5d y5123 ff1a fs2f fc0 sc0 ls0 ws0">static char<span class="_ _166"> </span>pathname[_POSIX_PATH_MAX + 1];</div><div class="t m0 x32 h5d y5124 ff1a fs2f fc0 sc0 ls0 ws0">static void</div><div class="t m0 x32 h5d y5125 ff1a fs2f fc0 sc0 ls0 ws0">add(char *dirname)</div><div class="t m0 x32 h5d y5126 ff1a fs2f fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h5d y5127 ff1a fs2f fc0 sc0 ls0 ws0">struct devdir<span class="_ _68"> </span>*ddp;</div><div class="t m0 x8a h5d y5128 ff1a fs2f fc0 sc0 ls0 ws0">int <span class="_ _82"> </span>len;</div><div class="t m0 x8a h5d y5129 ff1a fs2f fc0 sc0 ls0 ws0">len = strlen(dirname);</div><div class="t m0 x8a h5d y512a ff1a fs2f fc0 sc0 ls0 ws0">/*</div><div class="t m0 x214 h5d y512b ff1a fs2f fc0 sc0 ls395 ws0">*S<span class="_ _1d"></span><span class="ls0">kip ., .., and /dev/fd.</span></div><div class="t m0 x214 h5d y512c ff1a fs2f fc0 sc0 ls0 ws0">*/</div><div class="t m0 x8a h5d y512d ff1a fs2f fc0 sc0 ls0 ws0">if ((dirname[len-1] == ’.’) &amp;&amp; (dirname[len-2] == ’/’ ||</div><div class="t m0 x194 h5d y512e ff1a fs2f fc0 sc0 ls0 ws0">(dirname[len-2] == ’.’ &amp;&amp; dirname[len-3] == ’/’)))</div><div class="t m0 x9d h5d y512f ff1a fs2f fc0 sc0 ls0 ws0">return;</div><div class="t m0 x8a h5d y5130 ff1a fs2f fc0 sc0 ls0 ws0">if (strcmp(dirname, &quot;/dev/fd&quot;) == 0)</div><div class="t m0 x9d h5d y5131 ff1a fs2f fc0 sc0 ls0 ws0">return;</div><div class="t m0 x8a h5d y5132 ff1a fs2f fc0 sc0 ls0 ws0">if ((ddp = malloc(sizeof(struct devdir))) == NULL)</div><div class="t m0 x9d h5d y5133 ff1a fs2f fc0 sc0 ls0 ws0">return;</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
