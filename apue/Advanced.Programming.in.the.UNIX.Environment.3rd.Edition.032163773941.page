<div id="pf29" class="pf w4 h1f" data-page-no="29"><div class="pc pc29 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg29.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>1.4<span class="_ _81"> </span>Files <span class="_"> </span>and <span class="_"> </span>Directories<span class="_ _1b"> </span><span class="ff18">7</span></div><div class="t m0 x32 h2b y12f ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _23"></span>comments <span class="_ _23"> </span>in<span class="_ _35"> </span><span class="ff1b">italics</span><span class="ls114">.T<span class="_ _7"></span><span class="ls0">he <span class="_ _42"> </span>dollar <span class="_ _23"></span>sign <span class="_ _23"> </span>that <span class="_ _23"> </span>precedes <span class="_ _23"></span>our <span class="_ _23"> </span>input <span class="_ _23"> </span>is <span class="_ _23"> </span>the <span class="_ _42"> </span>prompt <span class="_ _9"></span>that <span class="_ _23"> </span>is</span></span></div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">printed by the shell.<span class="_ _59"> </span><span class="ls5f">We<span class="_ _23"></span></span>’ll always show the shell prompt as a dollar sign.</div><div class="t m0 x3f h26 y131 ff19 fsf fc0 sc0 ls0 ws0">Note <span class="_ _9"></span>that <span class="_ _9"></span>the <span class="_ _9"></span>directory <span class="_ _9"></span>listing <span class="_ _9"></span>is <span class="_ _23"></span>not <span class="_ _9"></span>in <span class="_ _9"></span>alphabetical <span class="_ _9"></span>order<span class="_ _6"></span><span class="ls115">.T<span class="_ _62"></span><span class="ls0">he<span class="_ _45"> </span><span class="ff1a">ls<span class="_ _45"> </span></span>command <span class="_ _9"></span>sorts</span></span></div><div class="t m0 x32 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">the names befor<span class="ls44">ep<span class="_ _4f"></span><span class="ls0">rinting them.</span></span></div><div class="t m0 x3f h2a y133 ff19 fsf fc0 sc0 ls0 ws0">Ther<span class="ls44">ea<span class="_ _4f"></span><span class="ls45">re <span class="_ _3"></span>m<span class="ls0">any details to consider in this 20</span></span></span></div><div class="t m0 xa9 h2a y31d ff19 fsf fc0 sc0 ls0 ws0">-</div><div class="t m0 x93 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">line program.</div><div class="t m0 x32 h26 y31e ff19 fsf fc0 sc0 ls49 ws0">•F<span class="_ _4d"></span><span class="ls0">irst, <span class="_ _23"></span>we <span class="_ _23"></span>include <span class="_ _23"></span>a <span class="_ _23"></span>header <span class="_ _23"></span>of <span class="_ _23"></span>our <span class="_ _23"></span>own:<span class="_ _35"> </span><span class="ff1a">apue.h</span><span class="ls116">.W<span class="_ _5d"></span><span class="ls117">ei<span class="_ _b"></span><span class="ls0">nclude <span class="_ _23"></span>this <span class="_ _23"></span>header <span class="_ _23"></span>in <span class="_ _23"></span>almost</span></span></span></span></div><div class="t m0 x20 h2a y31f ff19 fsf fc0 sc0 ls0 ws0">every <span class="_ _2"></span>program in <span class="_ _2"></span>this <span class="_ _2"></span>text.<span class="_ _61"> </span>This <span class="_ _2"></span>header <span class="_ _2"></span>includes <span class="_ _2"></span>some <span class="_ _2"></span>standar<span class="ls118">ds<span class="_ _4f"></span><span class="ls0">ystem <span class="_ _2"></span>headers <span class="_ _2"></span>and</span></span></div><div class="t m0 x20 h2a y320 ff19 fsf fc0 sc0 ls0 ws0">deﬁnes <span class="_ _53"> </span>numerous <span class="_ _53"> </span>constants <span class="_ _e"> </span>and <span class="_ _e"> </span>function <span class="_ _e"> </span>prototypes <span class="_ _53"> </span>that <span class="_ _e"> </span>we <span class="_ _e"> </span>use <span class="_ _53"> </span>throughout <span class="_ _e"> </span>the</div><div class="t m0 x20 h2a y321 ff19 fsf fc0 sc0 ls0 ws0">examples in the text.<span class="_ _59"> </span><span class="ls44">Al<span class="_ _5"></span><span class="ls0">isting of this header is in Appendix B.</span></span></div><div class="t m0 x32 h26 y322 ff19 fsf fc0 sc0 ls49 ws0">•N<span class="_ _4d"></span><span class="ls0">ext, we <span class="_ _2"></span>include <span class="_ _2"></span>a <span class="_ _2"></span>system header<span class="_ _1"></span>,<span class="_ _66"> </span><span class="ff1a">dirent.h</span>,<span class="_ _66"> </span>to<span class="_ _47"> </span>pick up <span class="_ _2"></span>the <span class="_ _2"></span>function prototypes for</span></div><div class="t m0 x20 h26 y323 ff1a fsf fc0 sc0 ls0 ws0">opendir<span class="_ _45"> </span><span class="ff19">and<span class="_ _35"> </span></span>readdir<span class="ff19">,<span class="_ _45"> </span>in<span class="_ _45"> </span>addition <span class="_ _23"></span>to <span class="_ _23"></span>the <span class="_ _9"></span>deﬁnition <span class="_ _23"></span>of <span class="_ _9"></span>the<span class="_ _35"> </span></span>dirent<span class="_ _45"> </span><span class="ff19">structure. <span class="_ _45"> </span>On</span></div><div class="t m0 x20 h2a y324 ff19 fsf fc0 sc0 ls0 ws0">some systems, the <span class="_ _2"></span>deﬁnitions ar<span class="ls119">es<span class="_ _4f"></span><span class="ls0">plit <span class="_ _2"></span>into multiple <span class="_ _2"></span>header ﬁles.<span class="_ _46"> </span>For <span class="_ _2"></span>example, in <span class="_ _2"></span>the</span></span></div><div class="t m0 x20 h26 y325 ff19 fsf fc0 sc0 ls0 ws0">Ubuntu <span class="_ _9"></span>12.04 <span class="_ _9"></span>Linux <span class="_ _23"></span>distribution,<span class="_ _45"> </span><span class="ff1a">/usr/include/dirent.h<span class="_ _45"> </span></span>declares <span class="_ _9"></span>the <span class="_ _9"></span>function</div><div class="t m0 x20 h26 y326 ff19 fsf fc0 sc0 ls0 ws0">prototypes and includes<span class="_"> </span><span class="ff1a">bits/dirent.h</span><span class="ls11a">,w<span class="_ _d"></span><span class="ls0">hich <span class="_ _2"></span>deﬁnes the<span class="_ _66"> </span><span class="ff1a">dirent<span class="_ _66"> </span></span>structur<span class="ls11b">e(<span class="_ _4f"></span><span class="ls0">and</span></span></span></span></div><div class="t m0 x20 h26 y327 ff19 fsf fc0 sc0 ls0 ws0">is actually stored in<span class="_"> </span><span class="ff1a">/usr/include/x86_64-linux-gnu/bits</span>).</div><div class="t m0 x32 h26 y328 ff19 fsf fc0 sc0 ls49 ws0">•T<span class="_ _4d"></span><span class="ls0">he <span class="_ _45"> </span>declaration <span class="_ _45"> </span>of <span class="_ _45"> </span>the<span class="_ _5a"> </span><span class="ff1a">main<span class="_"> </span></span>function <span class="_ _45"> </span>uses <span class="_ _45"> </span>the <span class="_ _45"> </span>style <span class="_ _45"> </span>supported <span class="_ _45"> </span>by <span class="_ _45"> </span>the <span class="_ _45"> </span>ISO <span class="_ _45"> </span>C</span></div><div class="t m0 x20 h2a y329 ff19 fsf fc0 sc0 ls0 ws0">standard. <span class="_"> </span>(W<span class="_ _4"></span>e’ll have more<span class="_"> </span>to<span class="_"> </span>say about the ISO C standard<span class="_"> </span>in<span class="_"> </span>the next chapter<span class="_ _6"></span>.)</div><div class="t m0 x32 h26 y32a ff19 fsf fc0 sc0 ls49 ws0">•W<span class="_ _4e"></span><span class="ls11c">et<span class="_ _5"></span><span class="ls0">ake an argument fr<span class="_ _0"></span>om the command line,<span class="_"> </span><span class="ff1a">argv[1]</span>,<span class="_"> </span>as<span class="_"> </span>the name of the directory</span></span></div><div class="t m0 x20 h26 y32b ff19 fsf fc0 sc0 ls0 ws0">to <span class="_ _42"> </span>list.<span class="_ _65"> </span>In <span class="_ _53"> </span>Chapter <span class="_ _42"> </span>7, <span class="_ _53"> </span>we’ll <span class="_ _53"> </span>look <span class="_ _53"> </span>at <span class="_ _42"> </span>how <span class="_ _53"> </span>the<span class="_ _44"> </span><span class="ff1a">main<span class="_ _4b"> </span></span>function <span class="_ _42"> </span>is <span class="_ _53"> </span>called <span class="_ _53"> </span>and <span class="_ _42"> </span>how <span class="_ _53"> </span>the</div><div class="t m0 x20 h2a y32c ff19 fsf fc0 sc0 ls0 ws0">command</div><div class="t m0 xaa h2a y32d ff19 fsf fc0 sc0 ls0 ws0">-</div><div class="t m0 x1d h2a y32c ff19 fsf fc0 sc0 ls0 ws0">line arguments and envir<span class="_ _0"></span>onment variables ar<span class="_ _0"></span><span class="ls44">ea<span class="_ _d"></span><span class="ls0">ccessible to the program.</span></span></div><div class="t m0 x32 h2a y32e ff19 fsf fc0 sc0 ls49 ws0">•B<span class="_ _4d"></span><span class="ls0">ecause <span class="_"> </span>the <span class="_"> </span>actual <span class="_"> </span>format <span class="_ _66"> </span>of <span class="_"> </span>directory <span class="_"> </span>entries <span class="_"> </span>varies <span class="_"> </span>from <span class="_"> </span>one <span class="_"> </span>UNIX <span class="_"> </span>system <span class="_ _66"> </span>to</span></div><div class="t m0 x20 h26 y32f ff19 fsf fc0 sc0 ls0 ws0">another<span class="_ _6"></span>,<span class="_ _66"> </span>we<span class="_ _66"> </span>use the <span class="_ _2"></span>functions<span class="_"> </span><span class="ff1a">opendir</span>,<span class="_ _66"> </span><span class="ff1a">readdir</span><span class="ls11d">,a<span class="_ _d"></span><span class="ls0">nd<span class="_ _66"> </span><span class="ff1a">closedir<span class="_ _66"> </span></span>to manipulate <span class="_ _2"></span>the</span></span></div><div class="t m0 x20 h2a y330 ff19 fsf fc0 sc0 ls0 ws0">directory<span class="_ _4"></span>.</div><div class="t m0 x32 h26 y331 ff19 fsf fc0 sc0 ls49 ws0">•T<span class="_ _4d"></span><span class="ls0">he<span class="_"> </span><span class="ff1a">opendir<span class="_ _47"> </span></span>function returns <span class="_ _2"></span>a <span class="_ _2"></span>pointer to <span class="_ _2"></span>a<span class="_ _47"> </span><span class="ff1a">DIR<span class="_ _66"> </span></span>structure, and <span class="_ _2"></span>we <span class="_ _2"></span>pass this <span class="_ _2"></span>pointer</span></div><div class="t m0 x20 h26 y332 ff19 fsf fc0 sc0 ls0 ws0">to <span class="_ _9"></span>the<span class="_ _35"> </span><span class="ff1a">readdir<span class="_ _45"> </span></span>function. <span class="_ _45"> </span>W<span class="_ _6"></span><span class="ls11e">ed<span class="_ _b"></span><span class="ls0">on’t <span class="_ _23"></span>car<span class="_ _0"></span><span class="ls11e">ew<span class="_ _b"></span><span class="ls0">hat’s <span class="_ _9"></span>in <span class="_ _23"></span>the<span class="_ _45"> </span><span class="ff1a">DIR<span class="_ _45"> </span></span>structure. <span class="_ _45"> </span>W<span class="_ _6"></span><span class="ls11e">et<span class="_ _b"></span><span class="ls0">hen <span class="_ _9"></span>call</span></span></span></span></span></span></div><div class="t m0 x20 h26 y333 ff1a fsf fc0 sc0 ls0 ws0">readdir<span class="_ _35"> </span><span class="ff19">in <span class="_ _23"></span>a <span class="_ _23"></span>loop, <span class="_ _23"></span>to <span class="_ _23"></span>read <span class="_ _9"></span>each <span class="_ _23"> </span>directory <span class="_ _23"> </span>entry<span class="_ _6"></span><span class="ls11f">.T<span class="_ _7"></span><span class="ls0">he<span class="_ _35"> </span><span class="ff1a">readdir<span class="_ _35"> </span></span>function <span class="_ _23"></span>returns <span class="_ _9"></span>a</span></span></span></div><div class="t m0 x20 h26 y334 ff19 fsf fc0 sc0 ls0 ws0">pointer to a<span class="_"> </span><span class="ff1a">dirent<span class="_ _66"> </span></span>structur<span class="ls120">eo<span class="_ _4f"></span><span class="lsb4">r, <span class="_"> </span>w<span class="_ _3"></span><span class="ls0">hen <span class="_ _2"></span>it’s ﬁnished with <span class="_ _2"></span>the directory<span class="_ _4"></span><span class="ls120">,an<span class="_ _d"></span><span class="ls0">ull pointer<span class="_ _1"></span>.</span></span></span></span></span></div><div class="t m0 x20 h26 y335 ff19 fsf fc0 sc0 ls0 ws0">All <span class="_ _45"> </span>we <span class="_ _47"> </span>examine <span class="_ _45"> </span>in <span class="_ _45"> </span>the<span class="_ _16"> </span><span class="ff1a">dirent<span class="_"> </span></span>str<span class="_ _0"></span>ucture<span class="_ _16"> </span>is<span class="_ _16"> </span>the <span class="_ _45"> </span>name <span class="_ _45"> </span>of <span class="_ _47"> </span>each <span class="_ _45"> </span>directory <span class="_ _47"> </span>entry</div><div class="t m0 x20 h26 y336 ff19 fsf fc0 sc0 ls0 ws0">(<span class="ff1a">d_name</span>). <span class="_ _35"> </span>Using<span class="_ _35"> </span>this <span class="_ _42"> </span>name, <span class="_ _23"> </span>we <span class="_ _42"> </span>could <span class="_ _23"> </span>then <span class="_ _23"> </span>call <span class="_ _42"> </span>the<span class="_ _35"> </span><span class="ff1a">stat<span class="_ _35"> </span></span>function <span class="_ _42"> </span>(Section <span class="_ _23"> </span>4.2) <span class="_ _42"> </span>to</div><div class="t m0 x20 h2a y337 ff19 fsf fc0 sc0 ls0 ws0">determine all the attributes of the ﬁle.</div><div class="t m0 x32 h26 y338 ff19 fsf fc0 sc0 ls49 ws0">•W<span class="_ _4e"></span><span class="ls121">ec<span class="_ _d"></span><span class="ls0">all <span class="_ _2"></span>two functions of <span class="_ _2"></span>our own to <span class="_ _2"></span>handle the errors:<span class="_"> </span><span class="ff1a">err_sys<span class="_ _66"> </span></span>and<span class="_"> </span><span class="ff1a">err_quit</span><span class="ls122">.W<span class="_ _62"></span><span class="ls0">e</span></span></span></span></div><div class="t m0 x20 h26 y339 ff19 fsf fc0 sc0 ls0 ws0">can <span class="_ _3"></span>see <span class="_ _3"></span>from <span class="_ _3"></span>the <span class="_ _3"></span>preceding <span class="_ _3"></span>output <span class="_ _3"></span>that <span class="_ _3"></span>the<span class="_ _45"> </span><span class="ff1a">err_sys<span class="_ _47"> </span></span>function <span class="_ _3"></span>prints <span class="_ _3"></span>an <span class="_ _9"></span>informative</div><div class="t m0 x20 h2a y33a ff19 fsf fc0 sc0 ls0 ws0">message <span class="_ _53"> </span>describing <span class="_ _53"> </span>what <span class="_ _53"> </span>type <span class="_ _53"> </span>of <span class="_ _53"> </span>error <span class="_ _42"> </span>was <span class="_ _53"> </span>encountered <span class="_ _42"> </span>(‘‘Permission <span class="_ _42"> </span>denied’<span class="ls123">’o<span class="_ _55"></span><span class="ls0">r</span></span></div><div class="t m0 x20 h2a y33b ff19 fsf fc0 sc0 ls124 ws0">‘‘<span class="_ _2"></span><span class="ls0">Not <span class="_ _4b"> </span>a <span class="_ _4b"> </span>directory’<span class="_ _1"></span>’). <span class="_ _65"> </span>These<span class="_ _65"> </span>two <span class="_ _4b"> </span>error <span class="_ _4b"> </span>functions <span class="_ _4b"> </span>ar<span class="ls125">es<span class="_ _64"></span><span class="ls0">hown <span class="_ _44"> </span>and <span class="_ _4b"> </span>described <span class="_ _4b"> </span>in</span></span></span></div><div class="t m0 x20 h2a y33c ff19 fsf fc0 sc0 ls0 ws0">Appendix B.<span class="_ _59"> </span><span class="ls5f">We <span class="_ _e"> </span>a<span class="_ _9"></span></span>lso talk mor<span class="ls44">ea<span class="_ _d"></span><span class="ls0">bout error handling in Section 1.7.</span></span></div><div class="t m0 x32 h26 y33d ff19 fsf fc0 sc0 ls49 ws0">•W<span class="_ _4d"></span><span class="ls0">hen <span class="_ _23"></span>the <span class="_ _9"></span>program <span class="_ _9"></span>is <span class="_ _23"> </span>done, <span class="_ _23"></span>it <span class="_ _23"></span>calls <span class="_ _9"></span>the <span class="_ _23"> </span>function<span class="_ _35"> </span><span class="ff1a">exit<span class="_ _45"> </span></span>with <span class="_ _23"></span>an <span class="_ _23"></span>argument <span class="_ _9"></span>of <span class="_ _23"></span>0.<span class="_ _5a"> </span>The</span></div><div class="t m0 x20 h26 y33e ff19 fsf fc0 sc0 ls0 ws0">function<span class="_ _45"> </span><span class="ff1a">exit<span class="_ _45"> </span></span>terminates <span class="_ _9"></span>a <span class="_ _9"></span>program. <span class="_ _45"> </span>By<span class="_ _45"> </span>convention, <span class="_ _9"></span>an <span class="_ _9"></span>argument <span class="_ _9"></span>of <span class="_ _9"></span>0 <span class="_ _23"></span>means <span class="_ _9"></span>OK,</div><div class="t m0 x20 h2a y33f ff19 fsf fc0 sc0 ls0 ws0">and an argument between 1 and 255 means that an error occurred. <span class="_"> </span>In<span class="_"> </span>Section 8.5, we</div><div class="t m0 x20 h2a y340 ff19 fsf fc0 sc0 ls0 ws0">show <span class="_ _3"></span>how <span class="_ _9"></span>any <span class="_ _9"></span>program, <span class="_ _3"></span>such <span class="_ _9"></span>as <span class="_ _9"></span>a <span class="_ _9"></span>shell <span class="_ _9"></span>or <span class="_ _3"></span>a <span class="_ _9"></span>program <span class="_ _3"></span>that <span class="_ _9"></span>we <span class="_ _9"></span>write, <span class="_ _9"></span>can <span class="_ _9"></span>obtain <span class="_ _9"></span>the</div><div class="t m0 x20 h26 y341 ff1a fsf fc0 sc0 ls0 ws0">exit<span class="_ _80"> </span><span class="ff19">status of a program that it executes.</span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
