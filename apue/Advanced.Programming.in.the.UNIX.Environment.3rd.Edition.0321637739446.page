<div id="pf1be" class="pf w4 h1f" data-page-no="1be"><div class="pc pc1be w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg1be.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">412<span class="_ _1b"> </span><span class="ff19">Threads <span class="_ _24b"> </span>Chapter<span class="_ _78"> </span><span class="ls7ed">11</span></span></div><div class="t m0 x8a h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">jp-&gt;j_prev = qp-&gt;q_tail;</div><div class="t m0 x8a h57 y426 ff1a fs2d fc0 sc0 ls0 ws0">if (qp-&gt;q_tail != NULL)</div><div class="t m0 x9d h57 y800 ff1a fs2d fc0 sc0 ls0 ws0">qp-&gt;q_tail-&gt;j_next = jp;</div><div class="t m0 x8a h57 y801 ff1a fs2d fc0 sc0 ls0 ws0">else</div><div class="t m0 x9d h57 y802 ff1a fs2d fc0 sc0 ls0 ws0">qp-&gt;q_head = jp;<span class="_ _15"> </span>/* list was empty */</div><div class="t m0 x8a h57 y803 ff1a fs2d fc0 sc0 ls0 ws0">qp-&gt;q_tail = jp;</div><div class="t m0 x8a h57 y804 ff1a fs2d fc0 sc0 ls0 ws0">pthread_rwlock_unlock(&amp;qp-&gt;q_lock);</div><div class="t m0 x32 h57 y805 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h57 y16e0 ff1a fs2d fc0 sc0 ls0 ws0">/*</div><div class="t m0 x140 h57 y16e1 ff1a fs2d fc0 sc0 ls15c ws0">*R<span class="_ _1d"></span><span class="ls0">emove the given job from a queue.</span></div><div class="t m0 x140 h57 y16e2 ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 x32 h57 y16e3 ff1a fs2d fc0 sc0 ls0 ws0">void</div><div class="t m0 x32 h57 y16e4 ff1a fs2d fc0 sc0 ls0 ws0">job_remove(struct queue *qp, struct job *jp)</div><div class="t m0 x32 h57 y16e5 ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y16e6 ff1a fs2d fc0 sc0 ls0 ws0">pthread_rwlock_wrlock(&amp;qp-&gt;q_lock);</div><div class="t m0 x8a h57 y16e7 ff1a fs2d fc0 sc0 ls0 ws0">if (jp == qp-&gt;q_head) {</div><div class="t m0 x9d h57 y16e8 ff1a fs2d fc0 sc0 ls0 ws0">qp-&gt;q_head = jp-&gt;j_next;</div><div class="t m0 x9d h57 y16e9 ff1a fs2d fc0 sc0 ls0 ws0">if (qp-&gt;q_tail == jp)</div><div class="t m0 x1f h57 y16ea ff1a fs2d fc0 sc0 ls0 ws0">qp-&gt;q_tail = NULL;</div><div class="t m0 x9d h57 y337f ff1a fs2d fc0 sc0 ls0 ws0">else</div><div class="t m0 x1f h57 y341e ff1a fs2d fc0 sc0 ls0 ws0">jp-&gt;j_next-&gt;j_prev = jp-&gt;j_prev;</div><div class="t m0 x8a h57 y341f ff1a fs2d fc0 sc0 ls15c ws0">}e<span class="_ _1d"></span><span class="ls0">lse if (jp == qp-&gt;q_tail) {</span></div><div class="t m0 x9d h57 y3420 ff1a fs2d fc0 sc0 ls0 ws0">qp-&gt;q_tail = jp-&gt;j_prev;</div><div class="t m0 x9d h57 y3421 ff1a fs2d fc0 sc0 ls0 ws0">jp-&gt;j_prev-&gt;j_next = jp-&gt;j_next;</div><div class="t m0 x8a h57 y3422 ff1a fs2d fc0 sc0 ls15c ws0">}e<span class="_ _1d"></span><span class="ls0">lse {</span></div><div class="t m0 x9d h57 y3423 ff1a fs2d fc0 sc0 ls0 ws0">jp-&gt;j_prev-&gt;j_next = jp-&gt;j_next;</div><div class="t m0 x9d h57 y3424 ff1a fs2d fc0 sc0 ls0 ws0">jp-&gt;j_next-&gt;j_prev = jp-&gt;j_prev;</div><div class="t m0 x8a h57 y3425 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y3426 ff1a fs2d fc0 sc0 ls0 ws0">pthread_rwlock_unlock(&amp;qp-&gt;q_lock);</div><div class="t m0 x32 h57 y3427 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h57 y2f7d ff1a fs2d fc0 sc0 ls0 ws0">/*</div><div class="t m0 x140 h57 y2f7e ff1a fs2d fc0 sc0 ls15c ws0">*F<span class="_ _1d"></span><span class="ls0">ind a job for the given thread ID.</span></div><div class="t m0 x140 h57 y3269 ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 x32 h57 y326a ff1a fs2d fc0 sc0 ls0 ws0">struct job *</div><div class="t m0 x32 h57 y326b ff1a fs2d fc0 sc0 ls0 ws0">job_find(struct queue *qp, pthread_t id)</div><div class="t m0 x32 h57 y326c ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y326d ff1a fs2d fc0 sc0 ls0 ws0">struct job *jp;</div><div class="t m0 x8a h57 y3428 ff1a fs2d fc0 sc0 ls0 ws0">if (pthread_rwlock_rdlock(&amp;qp-&gt;q_lock) != 0)</div><div class="t m0 x9d h57 y3429 ff1a fs2d fc0 sc0 ls0 ws0">return(NULL);</div><div class="t m0 x8a h57 y342a ff1a fs2d fc0 sc0 ls0 ws0">for (jp = qp-&gt;q_head; jp != NULL; jp = jp-&gt;j_next)</div><div class="t m0 x9d h57 y342b ff1a fs2d fc0 sc0 ls0 ws0">if (pthread_equal(jp-&gt;j_id, id))</div><div class="t m0 x1f h57 y342c ff1a fs2d fc0 sc0 ls0 ws0">break;</div><div class="t m0 x8a h57 y3364 ff1a fs2d fc0 sc0 ls0 ws0">pthread_rwlock_unlock(&amp;qp-&gt;q_lock);</div><div class="t m0 x8a h57 y3365 ff1a fs2d fc0 sc0 ls0 ws0">return(jp);</div><div class="t m0 x32 h57 y3366 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x123 h2d y3367 ff18 fs10 fc0 sc0 ls0 ws0">Figure 1<span class="_ _0"></span>1.14<span class="_ _54"> </span><span class="ff19">Using readerâ€“writer locks</span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
