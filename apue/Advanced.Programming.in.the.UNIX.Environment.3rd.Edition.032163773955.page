<div id="pf37" class="pf w4 h1f" data-page-no="37"><div class="pc pc37 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg37.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>1.1<span class="_ _1"></span><span class="ls1c2">1S<span class="_ _94"></span><span class="ls0">ystem <span class="_"> </span>Calls <span class="_"> </span>and <span class="_"> </span>Library <span class="_"> </span>Functions<span class="_ _1b"> </span><span class="ff18">21</span></span></span></div><div class="t m0 x35 h53 y12f ff16 fs2b fc0 sc0 ls0 ws0">1.11 <span class="_ _93"> </span>System<span class="_ _54"> </span>Calls <span class="_"> </span>and <span class="_"> </span>Librar<span class="ls1c3">yF<span class="_ _52"></span><span class="ls0">unctions</span></span></div><div class="t m0 x32 h2a y507 ff19 fsf fc0 sc0 ls0 ws0">All <span class="_ _3"></span>operating <span class="_ _9"></span>systems <span class="_ _3"></span>provide <span class="_ _3"></span>service <span class="_ _9"></span>points <span class="_ _3"></span>through <span class="_ _3"></span>which <span class="_ _9"></span>programs <span class="_ _3"></span>request <span class="_ _2"></span>services</div><div class="t m0 x32 h2a y508 ff19 fsf fc0 sc0 ls0 ws0">from <span class="_"> </span>the <span class="_ _e"> </span>kernel.<span class="_ _60"> </span>All <span class="_"> </span>implementations <span class="_"> </span>of <span class="_"> </span>the <span class="_"> </span>UNIX <span class="_"> </span>System <span class="_"> </span>pr<span class="_ _0"></span>ovide <span class="_"> </span>a <span class="_"> </span>well-deﬁned,</div><div class="t m0 x32 h2b y509 ff19 fsf fc0 sc0 ls0 ws0">limited <span class="_ _45"> </span>number <span class="_ _45"> </span>of <span class="_ _45"> </span>entry <span class="_ _45"> </span>points <span class="_ _35"> </span>dir<span class="_ _0"></span>ectly <span class="_ _45"> </span>into <span class="_ _45"> </span>the <span class="_ _45"> </span>kernel <span class="_ _45"> </span>called<span class="_ _51"> </span><span class="ff1b">system <span class="_ _45"> </span>calls<span class="_ _5a"> </span></span>(recall</div><div class="t m0 x32 h2a y50a ff19 fsf fc0 sc0 ls0 ws0">Figur<span class="ls1c4">e1<span class="_ _c"></span><span class="ls0">.1). <span class="_ _44"> </span>V<span class="_ _4"></span>ersion <span class="_ _42"> </span>7 <span class="_ _53"> </span>of <span class="_ _42"> </span>the <span class="_ _42"> </span>Research <span class="_ _42"> </span>UNIX <span class="_ _42"> </span>System <span class="_ _42"> </span>provided <span class="_ _23"> </span>about <span class="_ _53"> </span>50 <span class="_ _42"> </span>system <span class="_ _42"> </span>calls,</span></span></div><div class="t m0 x32 h2a y50b ff19 fsf fc0 sc0 ls0 ws0">4.4BSD <span class="_ _23"> </span>provided <span class="_ _42"> </span>about <span class="_ _23"> </span>1<span class="_ _1"></span>10, <span class="_ _42"> </span>and <span class="_ _42"> </span>SVR4 <span class="_ _42"> </span>had <span class="_ _23"> </span>around <span class="_ _23"> </span>120.<span class="_ _54"> </span>The <span class="_ _42"> </span>exact <span class="_ _23"> </span>number <span class="_ _42"> </span>of <span class="_ _42"> </span>system</div><div class="t m0 x32 h2a y50c ff19 fsf fc0 sc0 ls0 ws0">calls varies <span class="_ _2"></span>depending <span class="_ _2"></span>on <span class="_ _2"></span>the <span class="_ _2"></span>operating <span class="_ _2"></span>system <span class="_ _2"></span>version.<span class="_ _61"> </span>Mor<span class="ls1c5">er<span class="_ _8"></span><span class="ls0">ecent <span class="_ _2"></span>systems <span class="_ _2"></span>have <span class="_ _2"></span>seen</span></span></div><div class="t m0 x32 h2a y50d ff19 fsf fc0 sc0 ls0 ws0">incredible <span class="_ _2"></span>growth <span class="_ _2"></span>in <span class="_ _3"></span>the <span class="_ _3"></span>number <span class="_ _3"></span>of <span class="_ _3"></span>supported <span class="_ _3"></span>system <span class="_ _3"></span>calls.<span class="_ _61"> </span>Linux <span class="_ _3"></span>3.2.0 <span class="_ _3"></span>has <span class="_ _3"></span>380 <span class="_ _3"></span>system</div><div class="t m0 x32 h2a y50e ff19 fsf fc0 sc0 ls0 ws0">calls and FreeBSD 8.0 has over 450.</div><div class="t m0 x3f h2b y50f ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _42"> </span>system <span class="_ _42"> </span>call <span class="_ _53"> </span>interface <span class="_ _42"> </span>has <span class="_ _42"> </span>always <span class="_ _53"> </span>been <span class="_ _42"> </span>documented <span class="_ _42"> </span>in <span class="_ _53"> </span>Section <span class="_ _42"> </span>2 <span class="_ _42"> </span>of <span class="_ _53"> </span>the<span class="_ _44"> </span><span class="ff1b">UNIX</span></div><div class="t m0 x32 h2b y510 ff1b fsf fc0 sc0 ls0 ws0">Programmer <span class="_ _5"></span>’<span class="_ _1"></span><span class="ls1c6">sM<span class="_ _95"></span><span class="ls0">anual<span class="ff19 ls1c7">.I<span class="_ _96"></span><span class="ls0">ts <span class="_ _5a"> </span>deﬁnition <span class="_ _51"> </span>is <span class="_ _5a"> </span>in <span class="_ _5a"> </span>the <span class="_ _51"> </span>C <span class="_ _5a"> </span>language, <span class="_ _5a"> </span>no <span class="_ _51"> </span>matter <span class="_ _5a"> </span>which</span></span></span></span></div><div class="t m0 x32 h2a y511 ff19 fsf fc0 sc0 ls0 ws0">implementation <span class="_ _2"></span>technique <span class="_ _2"></span>is <span class="_ _2"></span>actually <span class="_ _2"></span>used <span class="_ _3"></span>on <span class="_ _2"></span>any <span class="_ _2"></span>given <span class="_ _2"></span>system <span class="_ _2"></span>to <span class="_ _3"></span>invoke <span class="_ _2"></span>a <span class="_ _2"></span>system <span class="_ _2"></span>call.</div><div class="t m0 x32 h2a y512 ff19 fsf fc0 sc0 ls0 ws0">This <span class="_ _3"></span>differs <span class="_ _3"></span>from <span class="_ _2"></span>many <span class="_ _9"></span>older <span class="_ _3"></span>operating <span class="_ _3"></span>systems, <span class="_ _9"></span>which <span class="_ _3"></span>traditionally <span class="_ _3"></span>deﬁned <span class="_ _9"></span>the <span class="_ _3"></span>kernel</div><div class="t m0 x32 h2a y513 ff19 fsf fc0 sc0 ls0 ws0">entry points in the assembly language of the machine.</div><div class="t m0 x3f h2a y514 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _9"></span>technique <span class="_ _9"></span>used <span class="_ _9"></span>on <span class="_ _23"></span>UNIX <span class="_ _9"></span>systems <span class="_ _9"></span>is <span class="_ _9"></span>for <span class="_ _9"></span>each <span class="_ _23"></span>system <span class="_ _9"></span>call <span class="_ _9"></span>to <span class="_ _9"></span>have <span class="_ _9"></span>a <span class="_ _23"></span>function <span class="_ _9"></span>of</div><div class="t m0 x32 h2a y515 ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _2"></span>same <span class="_ _3"></span>name <span class="_ _2"></span>in <span class="_ _3"></span>the <span class="_ _2"></span>standar<span class="ls1c8">dCl<span class="_ _4f"></span><span class="ls0">ibrary<span class="_ _4"></span><span class="ls1c9">.T<span class="_ _5b"></span><span class="ls0">he <span class="_ _2"></span>user <span class="_ _3"></span>process <span class="_ _2"></span>calls <span class="_ _2"></span>this <span class="_ _3"></span>function, <span class="_ _2"></span>using <span class="_ _3"></span>the</span></span></span></span></div><div class="t m0 x32 h2a y516 ff19 fsf fc0 sc0 ls0 ws0">standar<span class="ls1ca">dCc<span class="_ _8"></span><span class="ls0">alling <span class="_ _2"></span>sequence.<span class="_ _61"> </span>This <span class="_ _3"></span>function <span class="_ _2"></span>then <span class="_ _2"></span>invokes <span class="_ _2"></span>the <span class="_ _3"></span>appropriate kernel <span class="_ _2"></span>service,</span></span></div><div class="t m0 x32 h2a y517 ff19 fsf fc0 sc0 ls0 ws0">using whatever technique <span class="_ _2"></span>is required on the system.<span class="_ _46"> </span>For example, <span class="_ _2"></span>the function <span class="_ _2"></span>may put</div><div class="t m0 x32 h2a y518 ff19 fsf fc0 sc0 ls0 ws0">one <span class="_ _9"></span>or <span class="_ _3"></span>more<span class="_ _45"> </span>of<span class="_ _47"> </span>the <span class="_ _9"></span>C <span class="_ _9"></span>arguments <span class="_ _3"></span>into <span class="_ _9"></span>general <span class="_ _9"></span>registers <span class="_ _3"></span>and <span class="_ _9"></span>then <span class="_ _9"></span>execute <span class="_ _9"></span>some <span class="_ _9"></span>machine</div><div class="t m0 x32 h2a y519 ff19 fsf fc0 sc0 ls0 ws0">instruction <span class="_ _3"></span>that <span class="_ _9"></span>generates <span class="_ _3"></span>a <span class="_ _9"></span>softwar<span class="ls1cb">ei<span class="_ _b"></span><span class="ls0">nterrupt <span class="_ _3"></span>in <span class="_ _9"></span>the <span class="_ _9"></span>kernel.<span class="_ _16"> </span>For <span class="_ _9"></span>our <span class="_ _3"></span>purposes, <span class="_ _9"></span>we <span class="_ _9"></span>can</span></span></div><div class="t m0 x32 h2a y51a ff19 fsf fc0 sc0 ls0 ws0">consider the system calls to be C functions.</div><div class="t m0 x3f h2b y51b ff19 fsf fc0 sc0 ls0 ws0">Section <span class="_"> </span>3 <span class="_ _e"> </span>of <span class="_"> </span>the<span class="_ _59"> </span><span class="ff1b">UNIX <span class="_"> </span>Programmer <span class="_ _d"></span>’<span class="_ _0"></span><span class="ls1cc">sM<span class="_ _4a"></span><span class="ls0">anual<span class="_ _59"> </span><span class="ff19">deﬁnes <span class="_"> </span>the <span class="_"> </span>general-purpose <span class="_ _e"> </span>library</span></span></span></span></div><div class="t m0 x32 h2a y51c ff19 fsf fc0 sc0 ls0 ws0">functions available <span class="_ _2"></span>to <span class="_ _2"></span>programmers. <span class="_"> </span>These<span class="_ _66"> </span>functions <span class="_ _2"></span>aren’t entry <span class="_ _2"></span>points into <span class="_ _2"></span>the <span class="_ _2"></span>kernel,</div><div class="t m0 x32 h2a y51d ff19 fsf fc0 sc0 ls0 ws0">although <span class="_ _23"></span>they <span class="_ _23"></span>may <span class="_ _9"></span>invoke <span class="_ _23"> </span>one <span class="_ _23"> </span>or <span class="_ _23"> </span>more<span class="_ _45"> </span>of<span class="_ _35"> </span>the <span class="_ _23"></span>kernel’s <span class="_ _9"></span>system <span class="_ _23"> </span>calls.<span class="_ _51"> </span>For <span class="_ _23"></span>example, <span class="_ _23"></span>the</div><div class="t m0 x32 h26 y51e ff1a fsf fc0 sc0 ls0 ws0">printf<span class="_ _35"> </span><span class="ff19">function <span class="_ _42"> </span>may <span class="_ _42"> </span>use <span class="_ _42"> </span>the<span class="_ _35"> </span></span>write<span class="_ _44"> </span><span class="ff19">system <span class="_ _42"> </span>call <span class="_ _23"> </span>to <span class="_ _42"> </span>output <span class="_ _42"> </span>a <span class="_ _42"> </span>string, <span class="_ _42"> </span>but <span class="_ _42"> </span>the<span class="_ _35"> </span></span>strcpy</div><div class="t m0 x32 h26 y51f ff19 fsf fc0 sc0 ls0 ws0">(copy a string) and<span class="_"> </span><span class="ff1a">atoi<span class="_ _66"> </span></span>(convert ASCII to integer) functions <span class="_ _2"></span>don’t involve the kernel at</div><div class="t m0 x32 h2a y520 ff19 fsf fc0 sc0 ls0 ws0">all.</div><div class="t m0 x3f h2a y521 ff19 fsf fc0 sc0 ls0 ws0">From <span class="_ _9"></span>an <span class="_ _9"></span>implementor<span class="_ _9"></span>’s <span class="_ _9"></span>point <span class="_ _23"></span>of <span class="_ _9"></span>view<span class="_ _6"></span><span class="ls1cd">,t<span class="_ _b"></span><span class="ls0">he <span class="_ _9"></span>distinction <span class="_ _23"></span>between <span class="_ _9"></span>a <span class="_ _9"></span>system <span class="_ _23"></span>call <span class="_ _9"></span>and <span class="_ _23"></span>a</span></span></div><div class="t m0 x32 h2a y522 ff19 fsf fc0 sc0 ls0 ws0">library <span class="_ _23"></span>function <span class="_ _9"></span>is <span class="_ _23"> </span>fundamental.<span class="_ _51"> </span>From <span class="_ _9"></span>a <span class="_ _23"></span>user<span class="_ _3"></span>’s <span class="_ _23"> </span>perspective, <span class="_ _23"> </span>however<span class="_ _1"></span><span class="ls1ce">,t<span class="_ _b"></span><span class="ls0">he <span class="_ _9"></span>differ<span class="_ _0"></span>ence <span class="_ _23"></span>is</span></span></div><div class="t m0 x32 h2a y523 ff19 fsf fc0 sc0 ls0 ws0">not <span class="_ _2"></span>as <span class="_ _2"></span>critical.<span class="_ _61"> </span>From our <span class="_ _2"></span>perspective <span class="_ _2"></span>in <span class="_ _2"></span>this <span class="_ _2"></span>text, <span class="_ _3"></span>both <span class="_ _2"></span>system <span class="_ _2"></span>calls <span class="_ _2"></span>and <span class="_ _2"></span>library <span class="_ _2"></span>functions</div><div class="t m0 x32 h2a y524 ff19 fsf fc0 sc0 ls0 ws0">appear <span class="_ _3"></span>as <span class="_ _3"></span>normal <span class="_ _9"></span>C <span class="_ _3"></span>functions.<span class="_ _16"> </span>Both <span class="_ _3"></span>exist <span class="_ _9"></span>to <span class="_ _3"></span>provide <span class="_ _2"></span>services <span class="_ _9"></span>for <span class="_ _3"></span>application <span class="_ _3"></span>programs.</div><div class="t m0 x32 h2a y525 ff19 fsf fc0 sc0 ls5f ws0">We <span class="_ _59"> </span>s<span class="_ _9"></span><span class="ls0">hould <span class="_ _45"> </span>r<span class="_ _0"></span>ealize, <span class="_ _47"> </span>however<span class="_ _1"></span><span class="ls1cf">,t<span class="_ _62"></span><span class="ls0">hat <span class="_ _45"> </span>we <span class="_ _47"> </span>can <span class="_ _47"> </span>replace <span class="_ _47"> </span>the <span class="_ _47"> </span>library <span class="_ _47"> </span>functions, <span class="_ _45"> </span>if <span class="_ _47"> </span>desired,</span></span></span></div><div class="t m0 x32 h2a y526 ff19 fsf fc0 sc0 ls0 ws0">whereas the system calls usually cannot be r<span class="_ _0"></span>eplaced.</div><div class="t m0 x3f h26 y527 ff19 fsf fc0 sc0 ls0 ws0">Consider <span class="_ _9"></span>the <span class="_ _9"></span>memory <span class="_ _9"></span>allocation <span class="_ _23"></span>function<span class="_ _45"> </span><span class="ff1a">malloc<span class="_ _45"> </span></span>as <span class="_ _9"></span>an <span class="_ _9"></span>example.<span class="_ _5a"> </span>Ther<span class="ls1d0">ea<span class="_ _b"></span><span class="ls45">re <span class="_ _23"></span>m<span class="ls0">any</span></span></span></div><div class="t m0 x32 h2a y528 ff19 fsf fc0 sc0 ls0 ws0">ways to do <span class="_ _2"></span>memory allocation and <span class="_ _2"></span>its associated garbage <span class="_ _2"></span>collection (best ﬁt, <span class="_ _2"></span>ﬁrst ﬁt, and</div><div class="t m0 x32 h2a y529 ff19 fsf fc0 sc0 ls0 ws0">so <span class="_ _42"> </span>on).<span class="_ _54"> </span>No <span class="_ _42"> </span>single <span class="_ _53"> </span>technique <span class="_ _42"> </span>is <span class="_ _53"> </span>optimal <span class="_ _42"> </span>for <span class="_ _42"> </span>all <span class="_ _53"> </span>programs. <span class="_ _35"> </span>The<span class="_ _44"> </span>UNIX <span class="_ _53"> </span>system <span class="_ _42"> </span>call <span class="_ _42"> </span>that</div><div class="t m0 x32 h26 y52a ff19 fsf fc0 sc0 ls0 ws0">handles <span class="_"> </span>memory <span class="_ _53"> </span>allocation,<span class="_ _59"> </span><span class="ff1a">sbrk</span></div><div class="t m0 xc1 h2a y52b ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 xe h2a y52a ff19 fsf fc0 sc0 ls0 ws0">2</div><div class="t m0 xb6 h2a y52b ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 x84 h2a y52a ff19 fsf fc0 sc0 ls0 ws0">,<span class="_ _59"> </span>is<span class="_ _59"> </span>not <span class="_ _e"> </span>a <span class="_"> </span>general-purpose <span class="_ _e"> </span>memory <span class="_"> </span>manager<span class="_ _6"></span><span class="ls1d1">.I<span class="_ _5d"></span><span class="ls0">t</span></span></div><div class="t m0 x32 h2a y52c ff19 fsf fc0 sc0 ls0 ws0">increases <span class="_ _3"></span>or <span class="_ _3"></span>decreases <span class="_ _3"></span>the <span class="_ _9"></span>address <span class="_ _3"></span>space <span class="_ _9"></span>of <span class="_ _3"></span>the <span class="_ _9"></span>process <span class="_ _3"></span>by <span class="_ _9"></span>a <span class="_ _3"></span>speciﬁed <span class="_ _9"></span>number <span class="_ _3"></span>of <span class="_ _9"></span>bytes.</div><div class="t m0 x32 h2a y52d ff19 fsf fc0 sc0 ls0 ws0">How <span class="_ _e"> </span>that <span class="_"> </span>space <span class="_ _e"> </span>is <span class="_ _e"> </span>managed <span class="_"> </span>is <span class="_ _e"> </span>up <span class="_ _e"> </span>to <span class="_"> </span>the <span class="_ _e"> </span>process. <span class="_ _4b"> </span>The<span class="_ _59"> </span>memory <span class="_ _e"> </span>allocation <span class="_"> </span>function,</div><div class="t m0 x32 h26 y52e ff1a fsf fc0 sc0 ls0 ws0">malloc</div><div class="t m0 x52 h2a y52f ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 xc2 h2a y52e ff19 fsf fc0 sc0 ls0 ws0">3</div><div class="t m0 xc3 h2a y52f ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 xc4 h2a y52e ff19 fsf fc0 sc0 ls1d2 ws0">,i<span class="_ _8"></span><span class="ls0">mplements <span class="_ _3"></span>one <span class="_ _3"></span>particular <span class="_ _3"></span>type <span class="_ _3"></span>of <span class="_ _3"></span>allocation.<span class="_ _16"> </span>If <span class="_ _3"></span>we <span class="_ _3"></span>don’t <span class="_ _3"></span>like <span class="_ _3"></span>its <span class="_ _3"></span>operation,</span></div><div class="t m0 x32 h26 y530 ff19 fsf fc0 sc0 ls0 ws0">we can <span class="_ _2"></span>deﬁne <span class="_ _2"></span>our own<span class="_ _47"> </span><span class="ff1a">malloc<span class="_ _66"> </span></span>function, which <span class="_ _2"></span>will <span class="_ _2"></span>probably use the<span class="_ _66"> </span><span class="ff1a">sbrk<span class="_ _47"> </span></span>system call.</div><div class="t m0 x32 h2a y531 ff19 fsf fc0 sc0 ls0 ws0">In <span class="_ _46"> </span>fact, <span class="_ _61"> </span>numerous <span class="_ _46"> </span>softwar<span class="ls1d3">ep<span class="_ _49"></span><span class="ls0">ackages <span class="_ _46"> </span>implement <span class="_ _46"> </span>their <span class="_ _61"> </span>own <span class="_ _61"> </span>memory <span class="_ _46"> </span>allocation</span></span></div><div class="t m0 x32 h26 y532 ff19 fsf fc0 sc0 ls0 ws0">algorithms <span class="_ _9"></span>with <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">sbrk<span class="_ _45"> </span></span>system <span class="_ _23"></span>call.<span class="_ _5a"> </span>Figur<span class="ls1d4">e1<span class="_ _b"></span><span class="ls0">.1<span class="_ _6"></span><span class="ls1d4">1s<span class="_ _b"></span><span class="ls0">hows <span class="_ _9"></span>the <span class="_ _23"></span>r<span class="_ _0"></span>elationship <span class="_ _9"></span>between <span class="_ _9"></span>the</span></span></span></span></div><div class="t m0 x32 h26 y533 ff19 fsf fc0 sc0 ls0 ws0">application, the<span class="_"> </span><span class="ff1a">malloc<span class="_ _80"> </span></span>function, and the<span class="_"> </span><span class="ff1a">sbrk<span class="_ _66"> </span></span>system call.</div><a class="l" href="#pfb" data-dest-detail='[11,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892409px;bottom:1236.288916px;width:253.523796px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
