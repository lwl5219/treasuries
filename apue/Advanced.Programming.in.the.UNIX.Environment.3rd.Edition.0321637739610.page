<div id="pf262" class="pf w4 h1f" data-page-no="262"><div class="pc pc262 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg262.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">576<span class="_ _1b"> </span><span class="ff19">Interprocess <span class="_"> </span>Communication<span class="_ _2c"> </span>Chapter <span class="_"> </span>15</span></div><div class="t m0 x30 h51 y459b ff19 fs2a fc0 sc0 ls0 ws0">stack</div><div class="t m0 x10c h2d y459c ff19 fs10 fc0 sc0 ls0 ws0">shared memory</div><div class="t m0 x30 h2d y459d ff19 fs10 fc0 sc0 ls0 ws0">heap</div><div class="t m0 x71 h2e y459e ff19 fs11 fc0 sc0 ls0 ws0">uninitialized data</div><div class="t m0 x10d h2e y459f ff19 fs11 fc0 sc0 ls0 ws0">(bss)</div><div class="t m0 x50 h2f y45a0 ff19 fs12 fc0 sc0 ls0 ws0">initialized data</div><div class="t m0 x12b h30 y45a1 ff19 fs13 fc0 sc0 ls0 ws0">text</div><div class="t m0 xd h31 y45a2 ff19 fs14 fc0 sc0 ls0 ws0">command</div><div class="t m0 x114 h31 y45a3 ff19 fs14 fc0 sc0 ls0 ws0">-</div><div class="t m0 xca h31 y45a2 ff19 fs14 fc0 sc0 ls0 ws0">line arguments</div><div class="t m0 xd h31 y45a4 ff19 fs14 fc0 sc0 ls0 ws0">and environment variables</div><div class="t m0 x8a h31 y45a5 ff19 fs14 fc0 sc0 ls0 ws0">high address</div><div class="t m0 x156 h31 y45a6 ff19 fs14 fc0 sc0 ls0 ws0">low address</div><div class="t m0 xc6 h66 y45a7 ff1a fs15 fc0 sc0 ls0 ws0">0x7fff957b146c</div><div class="t m0 xc6 h70 y45a8 ff1a fs16 fc0 sc0 ls0 ws0">0x00000060bd00</div><div class="t m0 xc6 h71 y45a9 ff1a fs36 fc0 sc0 ls0 ws0">0x0000006020c0</div><div class="t m0 x178 hcc y45aa ff1a fs17 fc0 sc0 ls0 ws0">array[]<span class="_ _53"> </span><span class="ff19">of 40,000 bytes</span></div><div class="t m0 xc6 hd4 y45ab ff1a fs18 fc0 sc0 ls0 ws0">0x0000009fb6b0</div><div class="t m0 xc6 hd5 y45ac ff1a fs19 fc0 sc0 ls0 ws0">0x0000009e3010</div><div class="t m0 x178 h8d y45ad ff1a fs1a fc0 sc0 ls0 ws0">malloc<span class="_ _53"> </span><span class="ff19">of 100,000 bytes</span></div><div class="t m0 xc6 hd6 y45ae ff1a fs1b fc0 sc0 ls0 ws0">0x7fba578c36a0</div><div class="t m0 xc6 hd7 y45af ff1a fs1c fc0 sc0 ls0 ws0">0x7fba578ab000</div><div class="t m0 x178 h88 y45b0 ff19 fs43 fc0 sc0 ls0 ws0">shared memory of 100,000 bytes</div><div class="t m0 x1ca h88 y45b1 ff18 fs43 fc0 sc0 ls0 ws0">Figure 15.32<span class="_ _5a"> </span><span class="ff19">Memory layout on an Intel-based Linux system</span></div><div class="t m0 x3f h14f y45b2 ff19 fsb5 fc0 sc0 ls0 ws0">Recall <span class="_ _23"> </span>that <span class="_ _23"> </span>the<span class="_ _35"> </span><span class="ff1a">mmap<span class="_ _35"> </span></span>function <span class="_ _42"> </span>(Section <span class="_ _23"></span>14.8) <span class="_ _23"> </span>can <span class="_ _23"> </span>be <span class="_ _42"> </span>used <span class="_ _23"> </span>to <span class="_ _23"> </span>map <span class="_ _42"> </span>portions <span class="_ _23"> </span>of <span class="_ _23"> </span>a <span class="_ _42"> </span>ﬁle</div><div class="t m0 x32 h150 y45b3 ff19 fsb5 fc0 sc0 ls0 ws0">into <span class="_ _9"></span>the <span class="_ _23"> </span>address <span class="_ _9"></span>space <span class="_ _23"></span>of <span class="_ _23"></span>a <span class="_ _9"></span>process. <span class="_ _45"> </span>This<span class="_ _35"> </span>is <span class="_ _9"></span>conceptually <span class="_ _23"></span>similar <span class="_ _23"></span>to <span class="_ _9"></span>attaching <span class="_ _23"></span>a <span class="_ _9"></span>shared</div><div class="t m0 x32 h14f y45b4 ff19 fsb5 fc0 sc0 ls0 ws0">memory <span class="_ _42"> </span>segment <span class="_ _23"> </span>using <span class="_ _42"> </span>the<span class="_ _35"> </span><span class="ff1a">shmat<span class="_ _44"> </span></span>XSI <span class="_ _42"> </span>IPC <span class="_ _23"> </span>function.<span class="_ _54"> </span>The <span class="_ _42"> </span>main <span class="_ _23"> </span>difference <span class="_ _23"> </span>is <span class="_ _42"> </span>that <span class="_ _42"> </span>the</div><div class="t m0 x32 h14f y45b5 ff19 fsb5 fc0 sc0 ls0 ws0">memory <span class="_ _9"></span>segment <span class="_ _23"></span>mapped <span class="_ _9"></span>with<span class="_ _45"> </span><span class="ff1a">mmap<span class="_ _35"> </span></span>is <span class="_ _9"></span>backed <span class="_ _9"></span>by <span class="_ _23"></span>a <span class="_ _9"></span>ﬁle, <span class="_ _23"></span>whereas <span class="_ _3"></span>no <span class="_ _23"></span>ﬁle <span class="_ _9"></span>is <span class="_ _23"></span>associated</div><div class="t m0 x32 h150 y45b6 ff19 fsb5 fc0 sc0 ls0 ws0">with an XSI shared memory segment.</div><div class="t m0 x35 h14f y45b7 ff16 fsb5 fc0 sc0 ls0 ws0">Example <span class="_ _84"></span>— <span class="_ _84"></span>Memor<span class="_ _2"></span><span class="ls127e">yM<span class="_ _4f"></span><span class="ls0">apping of<span class="_"> </span><span class="ff1f">/dev/zero</span></span></span></div><div class="t m0 x32 h150 y45b8 ff19 fsb5 fc0 sc0 ls0 ws0">Shared <span class="_ _e"> </span>memory <span class="_"> </span>can <span class="_ _e"> </span>be <span class="_"> </span>used <span class="_ _53"> </span>between <span class="_"> </span>unrelated <span class="_ _e"> </span>processes. <span class="_ _4b"> </span>But<span class="_ _59"> </span>if <span class="_"> </span>the <span class="_ _e"> </span>processes <span class="_ _e"> </span>are</div><div class="t m0 x32 h150 y45b9 ff19 fsb5 fc0 sc0 ls127f ws0">re<span class="ls0">lated, some implementations provide a differ<span class="_ _0"></span>ent technique.</span></div><div class="t m0 x76 h88 y45ba ff19 fs43 fc0 sc0 ls0 ws0">The <span class="_ _3"></span>following <span class="_ _9"></span>technique <span class="_ _9"></span>works <span class="_ _3"></span>on <span class="_ _9"></span>FreeBSD <span class="_ _3"></span>8.0, <span class="_ _9"></span>Linux <span class="_ _9"></span>3.2.0, <span class="_ _3"></span>and <span class="_ _9"></span>Solaris <span class="_ _9"></span>10.<span class="_ _59"> </span>Mac <span class="_ _3"></span>OS <span class="_ _9"></span>X <span class="_ _9"></span>10.6.8</div><div class="t m0 x76 h88 y45bb ff19 fs43 fc0 sc0 ls0 ws0">currently doesn’t support the mapping <span class="_ _2"></span>of character devices into <span class="_ _2"></span>the address space of a <span class="_ _2"></span>process.</div><div class="t m0 x3f h14f y45bc ff19 fsb5 fc0 sc0 ls0 ws0">The <span class="_ _3"></span>device<span class="_ _47"> </span><span class="ff1a">/dev/zero<span class="_ _47"> </span></span>is <span class="_ _3"></span>an <span class="_ _3"></span>inﬁnite <span class="_ _3"></span>source <span class="_ _2"></span>of <span class="_ _3"></span>0 <span class="_ _3"></span>bytes <span class="_ _3"></span>when <span class="_ _3"></span>read. <span class="_ _47"> </span>This<span class="_ _47"> </span>device <span class="_ _2"></span>also</div><div class="t m0 x32 h150 y45bd ff19 fsb5 fc0 sc0 ls0 ws0">accepts <span class="_ _9"></span>any <span class="_ _9"></span>data <span class="_ _9"></span>that <span class="_ _23"></span>is <span class="_ _9"></span>written <span class="_ _9"></span>to <span class="_ _9"></span>it, <span class="_ _9"></span>ignoring <span class="_ _23"></span>the <span class="_ _9"></span>data.<span class="_ _5a"> </span>Our <span class="_ _9"></span>interest <span class="_ _9"></span>in <span class="_ _9"></span>this <span class="_ _9"></span>device <span class="_ _9"></span>for</div><div class="t m0 x32 h150 y45be ff19 fsb5 fc0 sc0 ls0 ws0">IPC arises from its special pr<span class="_ _0"></span>operties when it is memory mapped.</div><div class="t m0 x3f h150 y45bf ff19 fsb5 fc0 sc0 ls1280 ws0">•A<span class="_ _4d"></span><span class="ls1281">nu<span class="_ _43"></span><span class="ls0">nnamed <span class="_ _23"> </span>memory <span class="_ _42"> </span>region <span class="_ _23"> </span>is <span class="_ _42"> </span>created <span class="_ _23"></span>whose <span class="_ _23"> </span>size <span class="_ _42"> </span>is <span class="_ _23"> </span>the <span class="_ _42"> </span>second <span class="_ _42"> </span>argument <span class="_ _23"></span>to</span></span></div><div class="t m0 x15 h14f y45c0 ff1a fsb5 fc0 sc0 ls0 ws0">mmap<span class="ff19 ls1282">,r<span class="_ _4f"></span><span class="ls0">ounded up to the nearest page size on the system.</span></span></div><div class="t m0 x3f h150 y45c1 ff19 fsb5 fc0 sc0 ls1280 ws0">•T<span class="_ _4d"></span><span class="ls0">he memory region is initialized to 0.</span></div><div class="t m0 x3f h150 y45c2 ff19 fsb5 fc0 sc0 ls1280 ws0">•M<span class="_ _4d"></span><span class="ls0">ultiple <span class="_"> </span>processes <span class="_"> </span>can <span class="_"> </span>shar<span class="_ _0"></span><span class="ls1283">et<span class="_ _5b"></span><span class="ls0">his <span class="_"> </span>region <span class="_"> </span>if <span class="_"> </span>a <span class="_"> </span>common <span class="_"> </span>ancestor <span class="_"> </span>speciﬁes <span class="_"> </span>the</span></span></span></div><div class="t m0 x15 h14f y45c3 ff1a fsb5 fc0 sc0 ls0 ws0">MAP_SHARED<span class="_ _80"> </span><span class="ff19">ﬂag to<span class="_"> </span></span>mmap<span class="ff19">.</span></div><div class="t m0 x32 h150 y45c4 ff19 fsb5 fc0 sc0 ls0 ws0">The program in Figur<span class="_ _0"></span><span class="ls1282">e1<span class="_ _d"></span><span class="ls0">5.33 is an example that uses this special device.</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
