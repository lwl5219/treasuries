<div id="pf16a" class="pf w4 h1f" data-page-no="16a"><div class="pc pc16a w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg16a.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">328<span class="_ _1b"> </span><span class="ff19">Signals <span class="_ _24b"> </span>Chapter<span class="_ _21"> </span>10</span></div><div class="t m0 x3f h2a y12f ff19 fsf fc0 sc0 ls5f ws0">To <span class="_ _e"> </span>s<span class="_ _23"></span><span class="ls0">upport <span class="_ _2"></span>this <span class="_ _2"></span>feature, <span class="_ _2"></span>the <span class="_ _2"></span>system <span class="_ _3"></span>calls <span class="_ _2"></span>ar<span class="lsbf9">ed<span class="_ _4f"></span><span class="ls0">ivided <span class="_ _2"></span>into <span class="_ _3"></span>two <span class="_ _2"></span>categories: <span class="_ _3"></span>the <span class="_ _2"></span>‘‘slow’<span class="_ _1"></span>’</span></span></span></div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">system <span class="_ _9"></span>calls <span class="_ _9"></span>and <span class="_ _9"></span>all <span class="_ _9"></span>the <span class="_ _9"></span>others.<span class="_ _5a"> </span>The <span class="_ _9"></span>slow <span class="_ _9"></span>system <span class="_ _9"></span>calls <span class="_ _9"></span>ar<span class="lsbfa">et<span class="_ _b"></span><span class="ls0">hose <span class="_ _9"></span>that <span class="_ _9"></span>can <span class="_ _9"></span>block <span class="_ _9"></span>forever<span class="_ _6"></span>.</span></span></div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">Included in this category are</div><div class="t m0 x3f h2a y151 ff19 fsf fc0 sc0 ls49 ws0">•R<span class="_ _4d"></span><span class="ls0">eads <span class="_ _2"></span>that <span class="_ _2"></span>can <span class="_ _2"></span>block <span class="_ _2"></span>the <span class="_ _2"></span>caller <span class="_ _2"></span>forever if <span class="_ _2"></span>data <span class="_ _2"></span>isn’t <span class="_ _2"></span>present with <span class="_ _2"></span>certain <span class="_ _2"></span>ﬁle <span class="_ _2"></span>types</span></div><div class="t m0 x15 h2a ya63 ff19 fsf fc0 sc0 ls0 ws0">(pipes, terminal devices, and network devices)</div><div class="t m0 x3f h2a y2a2c ff19 fsf fc0 sc0 ls49 ws0">•W<span class="_ _da"></span><span class="ls0">rites <span class="_ _2"></span>that <span class="_ _2"></span>can <span class="_ _3"></span>block <span class="_ _2"></span>the <span class="_ _2"></span>caller <span class="_ _2"></span>forever <span class="_ _2"></span>if <span class="_ _2"></span>the <span class="_ _2"></span>data <span class="_ _3"></span>can’t <span class="_ _2"></span>be <span class="_ _2"></span>accepted <span class="_ _2"></span>immediately</span></div><div class="t m0 x15 h2a y1f0d ff19 fsf fc0 sc0 ls0 ws0">by these same ﬁle types</div><div class="t m0 x3f h2a ya22 ff19 fsf fc0 sc0 ls49 ws0">•O<span class="_ _4d"></span><span class="ls0">pens <span class="_ _e"> </span>on <span class="_ _e"> </span>certain <span class="_ _e"> </span>ﬁle <span class="_ _e"> </span>types <span class="_"> </span>that <span class="_ _53"> </span>block <span class="_ _e"> </span>the <span class="_ _e"> </span>caller <span class="_"> </span>until <span class="_ _53"> </span>some <span class="_ _e"> </span>condition <span class="_ _e"> </span>occurs</span></div><div class="t m0 x15 h2a yd7e ff19 fsf fc0 sc0 ls0 ws0">(such <span class="_ _23"></span>as <span class="_ _9"></span>a <span class="_ _23"> </span>terminal <span class="_ _23"></span>device <span class="_ _23"></span>open <span class="_ _9"></span>waiting <span class="_ _23"> </span>until <span class="_ _23"></span>an <span class="_ _23"></span>attached <span class="_ _9"></span>modem <span class="_ _23"> </span>answers <span class="_ _23"></span>the</div><div class="t m0 x15 h2a yd7f ff19 fsf fc0 sc0 ls0 ws0">phone)</div><div class="t m0 x3f h26 y34a ff19 fsf fc0 sc0 ls49 ws0">•T<span class="_ _4d"></span><span class="ls0">he<span class="_"> </span><span class="ff1a">pause<span class="_ _47"> </span></span>function (which <span class="_ _2"></span>by deﬁnition <span class="_ _2"></span>puts <span class="_ _2"></span>the <span class="_ _2"></span>calling <span class="_ _2"></span>process to sleep <span class="_ _2"></span>until <span class="_ _2"></span>a</span></div><div class="t m0 x15 h26 ya65 ff19 fsf fc0 sc0 ls0 ws0">signal is caught) and the<span class="_"> </span><span class="ff1a">wait<span class="_ _80"> </span></span>function</div><div class="t m0 x3f h26 ya27 ff19 fsf fc0 sc0 ls49 ws0">•C<span class="_ _4d"></span><span class="ls0">ertain<span class="_"> </span><span class="ff1a">ioctl<span class="_ _80"> </span></span>operations</span></div><div class="t m0 x3f h2a yd84 ff19 fsf fc0 sc0 ls49 ws0">•S<span class="_ _4d"></span><span class="ls0">ome of the interprocess communication functions (Chapter 15)</span></div><div class="t m0 x32 h2a y15f ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _66"> </span>notable <span class="_ _47"> </span>exception <span class="_ _47"> </span>to <span class="_ _66"> </span>these <span class="_ _47"> </span>slow <span class="_ _47"> </span>system <span class="_ _66"> </span>calls <span class="_ _47"> </span>is <span class="_ _47"> </span>anything <span class="_ _47"> </span>related <span class="_"> </span>to <span class="_ _47"> </span>disk <span class="_ _47"> </span>I/O.</div><div class="t m0 x32 h2a y160 ff19 fsf fc0 sc0 ls0 ws0">Although <span class="_ _2"></span>a <span class="_ _2"></span>read <span class="_ _2"></span>or <span class="_ _2"></span>a <span class="_ _2"></span>write <span class="_ _3"></span>of <span class="_ _2"></span>a <span class="_ _2"></span>disk <span class="_ _2"></span>ﬁle <span class="_ _3"></span>can <span class="_ _2"></span>block <span class="_ _2"></span>the <span class="_ _3"></span>caller <span class="_ _2"></span>temporarily <span class="_ _2"></span>(while <span class="_ _2"></span>the <span class="_ _3"></span>disk</div><div class="t m0 x32 h2a y2a2d ff19 fsf fc0 sc0 ls0 ws0">driver <span class="_ _42"> </span>queues <span class="_ _42"> </span>the <span class="_ _23"> </span>request <span class="_ _42"> </span>and <span class="_ _42"> </span>then <span class="_ _42"> </span>the <span class="_ _23"> </span>request <span class="_ _42"> </span>is <span class="_ _42"> </span>executed), <span class="_ _23"> </span>unless <span class="_ _42"> </span>a <span class="_ _42"> </span>hardwar<span class="lsbfb">ee<span class="_ _c"></span><span class="ls0">rror</span></span></div><div class="t m0 x32 h2a y2a2e ff19 fsf fc0 sc0 ls0 ws0">occurs, the I/O operation always returns and unblocks the caller quickly<span class="_ _4"></span>.</div><div class="t m0 x3f h2a y2a2f ff19 fsf fc0 sc0 ls0 ws0">One <span class="_ _9"></span>condition <span class="_ _23"></span>that <span class="_ _9"></span>is <span class="_ _23"></span>handled <span class="_ _9"></span>by <span class="_ _23"></span>interrupted <span class="_ _9"></span>system <span class="_ _23"></span>calls, <span class="_ _9"></span>for <span class="_ _23"></span>example, <span class="_ _9"></span>is <span class="_ _23"></span>when <span class="_ _9"></span>a</div><div class="t m0 x32 h2a y1d98 ff19 fsf fc0 sc0 ls0 ws0">process <span class="_ _2"></span>initiates <span class="_ _3"></span>a <span class="_ _3"></span>read <span class="_ _2"></span>from <span class="_ _2"></span>a <span class="_ _3"></span>terminal <span class="_ _3"></span>device <span class="_ _3"></span>and <span class="_ _3"></span>the <span class="_ _3"></span>user <span class="_ _3"></span>at <span class="_ _3"></span>the <span class="_ _3"></span>terminal <span class="_ _3"></span>walks <span class="_ _3"></span>away</div><div class="t m0 x32 h2a y1d99 ff19 fsf fc0 sc0 ls0 ws0">from the terminal for an <span class="_ _2"></span>extended period.<span class="_ _46"> </span>In <span class="_ _2"></span>this example, the <span class="_ _2"></span>process could be blocked</div><div class="t m0 x32 h2a y1d9a ff19 fsf fc0 sc0 ls0 ws0">for hours or days and would remain so unless the system was taken down.</div><div class="t m0 x76 h52 y2a30 ff19 fs2a fc0 sc0 ls0 ws0">POSIX.1 <span class="_ _9"> </span>semantics <span class="_ _23"> </span>for <span class="_ _23"> </span>interrupted<span class="_ _47"> </span><span class="ff1a">read</span><span class="lsbfc">sa<span class="_ _8"></span><span class="ls0">nd<span class="_ _47"> </span><span class="ff1a">write</span><span class="lsbfc">sc<span class="_ _8"></span><span class="ls0">hanged <span class="_ _23"> </span>with <span class="_ _9"> </span>the <span class="_ _23"> </span>2001 <span class="_ _23"> </span>version <span class="_ _9"></span>of <span class="_ _23"> </span>the</span></span></span></span></div><div class="t m0 x76 h52 y2a31 ff19 fs2a fc0 sc0 ls0 ws0">standard. <span class="_ _45"> </span>Earlier<span class="_ _35"> </span>versions <span class="_ _42"> </span>gave <span class="_ _42"> </span>implementations <span class="_ _42"> </span>a <span class="_"> </span>choice <span class="_ _23"> </span>of <span class="_"> </span>how <span class="_ _42"> </span>to <span class="_ _42"> </span>deal <span class="_ _42"> </span>with<span class="_ _35"> </span><span class="ff1a">read</span><span class="lsbfd">sa<span class="_ _43"></span><span class="ls0">nd</span></span></div><div class="t m0 x76 h52 y2a32 ff1a fs2a fc0 sc0 ls0 ws0">write<span class="ff19 lsbfe">st<span class="_ _b"></span><span class="ls0">hat <span class="_ _23"> </span>have <span class="_ _42"> </span>processed <span class="_ _23"> </span>partial <span class="_ _23"> </span>amounts <span class="_ _23"> </span>of <span class="_ _23"> </span>data.<span class="_ _61"> </span>If<span class="_ _45"> </span><span class="ff1a">read<span class="_ _45"> </span></span>has <span class="_ _23"> </span>received <span class="_ _23"> </span>and <span class="_ _23"> </span>transferred</span></span></div><div class="t m0 x76 h51 y2a33 ff19 fs2a fc0 sc0 ls0 ws0">data to an application’s <span class="_ _2"></span>buffer<span class="_ _6"></span><span class="lsbff">,b<span class="_ _84"></span><span class="ls0">ut has <span class="_ _2"></span>not yet received all that the application <span class="_ _2"></span>requested and is</span></span></div><div class="t m0 x76 h52 y2a34 ff19 fs2a fc0 sc0 ls0 ws0">then <span class="_ _42"> </span>interrupted, <span class="_ _23"> </span>the <span class="_ _42"> </span>operating <span class="_ _42"> </span>system <span class="_ _42"> </span>could <span class="_ _42"> </span>either <span class="_ _23"> </span>fail <span class="_ _42"> </span>the <span class="_ _42"> </span>system <span class="_ _42"> </span>call, <span class="_ _42"> </span>with<span class="_ _45"> </span><span class="ff1a">errno<span class="_ _45"> </span></span>set <span class="_ _42"> </span>to</div><div class="t m0 x76 h52 y2a35 ff1a fs2a fc0 sc0 ls0 ws0">EINTR<span class="ff19">,<span class="_ _45"> </span>or<span class="_ _45"> </span>allow <span class="_ _42"> </span>the <span class="_ _23"> </span>system <span class="_ _42"> </span>call <span class="_ _42"> </span>to <span class="_ _42"> </span>succeed, <span class="_ _23"> </span>returning <span class="_ _42"> </span>the <span class="_ _23"> </span>partial <span class="_ _42"> </span>amount <span class="_ _42"> </span>of <span class="_ _23"> </span>data <span class="_ _42"> </span>received.</span></div><div class="t m0 x76 h52 y2a36 ff19 fs2a fc0 sc0 ls0 ws0">Similarly<span class="_ _6"></span><span class="lsc00">,i<span class="_ _5"></span><span class="ls0">f<span class="_ _80"> </span><span class="ff1a">write<span class="_ _80"> </span></span>is <span class="_ _2"></span>interrupted <span class="_ _2"></span>after <span class="_ _2"></span>transferring <span class="_ _2"></span>some <span class="_ _3"></span>of <span class="_ _2"></span>the <span class="_ _2"></span>data <span class="_ _3"></span>in <span class="_ _2"></span>an <span class="_ _2"></span>application’s <span class="_ _3"></span>buffer<span class="_ _6"></span>,</span></span></div><div class="t m0 x76 h52 y2a37 ff19 fs2a fc0 sc0 ls0 ws0">the <span class="_ _3"></span>operation <span class="_ _9"></span>system <span class="_ _3"></span>could <span class="_ _9"></span>either <span class="_ _3"></span>fail <span class="_ _9"></span>the <span class="_ _3"></span>system <span class="_ _9"></span>call, <span class="_ _3"></span>with<span class="_ _66"> </span><span class="ff1a">errno<span class="_ _66"> </span></span>set <span class="_ _9"></span>to<span class="_ _66"> </span><span class="ff1a">EINTR</span>,<span class="_ _66"> </span>or<span class="_ _66"> </span>allow <span class="_ _9"></span>the</div><div class="t m0 x76 h51 y2a38 ff19 fs2a fc0 sc0 ls0 ws0">system <span class="_ _4b"> </span>call <span class="_ _4b"> </span>to <span class="_ _4b"> </span>succeed, <span class="_ _59"> </span>returning <span class="_ _44"> </span>the <span class="_ _4b"> </span>partial <span class="_ _59"> </span>amount <span class="_ _4b"> </span>of <span class="_ _4b"> </span>data <span class="_ _4b"> </span>written.<span class="_ _5c"> </span>Historically<span class="_ _6"></span>,</div><div class="t m0 x76 h51 y2a39 ff19 fs2a fc0 sc0 ls0 ws0">implementations <span class="_ _44"> </span>derived <span class="_ _4b"> </span>from <span class="_ _4b"> </span>System <span class="_ _44"> </span>V <span class="_ _4b"> </span>fail <span class="_ _4b"> </span>the <span class="_ _4b"> </span>system <span class="_ _4b"> </span>call, <span class="_ _4b"> </span>whereas <span class="_ _44"> </span>BSD-derived</div><div class="t m0 x76 h51 y2a3a ff19 fs2a fc0 sc0 ls0 ws0">implementations <span class="_ _23"> </span>return <span class="_ _9"> </span>partial <span class="_ _23"> </span>success.<span class="_ _61"> </span><span class="ls341">Wi<span class="_ _3"></span></span>th <span class="_ _23"> </span>the <span class="_ _23"> </span>2001 <span class="_ _23"> </span>version <span class="_ _23"> </span>of <span class="_ _23"> </span>the <span class="_ _23"> </span>POSIX.1 <span class="_ _23"> </span>standard, <span class="_ _9"> </span>the</div><div class="t m0 x76 h51 y2a3b ff19 fs2a fc0 sc0 ls0 ws0">BSD-style semantics ar<span class="lse9">er<span class="_ _5"></span><span class="ls0">equired.</span></span></div><div class="t m0 x3f h2a y2a3c ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _3"></span>problem <span class="_ _2"></span>with <span class="_ _3"></span>interrupted <span class="_ _3"></span>system <span class="_ _3"></span>calls <span class="_ _3"></span>is <span class="_ _9"></span>that <span class="_ _3"></span>we <span class="_ _3"></span>now <span class="_ _3"></span>have <span class="_ _3"></span>to <span class="_ _3"></span>handle <span class="_ _3"></span>the <span class="_ _9"></span>error</div><div class="t m0 x32 h2a y2a3d ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">turn <span class="_ _9"></span>explicitly<span class="_ _6"></span><span class="lsa80">.T<span class="_ _62"></span><span class="ls0">he <span class="_ _9"></span>typical <span class="_ _9"></span>code <span class="_ _9"></span>sequence <span class="_ _9"></span>(assuming <span class="_ _9"></span>a <span class="_ _3"></span>read <span class="_ _9"></span>operation <span class="_ _9"></span>and <span class="_ _9"></span>assuming</span></span></span></div><div class="t m0 x32 h2a y2a3e ff19 fsf fc0 sc0 ls0 ws0">that we want to restart the r<span class="_ _0"></span>ead even if it’s interrupted) would be</div><div class="t m0 x3f h57 y2a3f ff1a fs2d fc0 sc0 ls0 ws0">again:</div><div class="t m0 xc2 h57 y2a40 ff1a fs2d fc0 sc0 ls0 ws0">if ((n = read(fd, buf, BUFFSIZE)) &lt; 0) {</div><div class="t m0 x16e h57 y2a41 ff1a fs2d fc0 sc0 ls0 ws0">if (errno == EINTR)</div><div class="t m0 xda h57 y2a42 ff1a fs2d fc0 sc0 ls0 ws0">goto again;<span class="_ _8a"> </span>/* just an interrupted system call */</div><div class="t m0 x16e h57 y2a43 ff1a fs2d fc0 sc0 ls0 ws0">/* handle other errors */</div><div class="t m0 xc2 h57 y2a44 ff1a fs2d fc0 sc0 ls0 ws0">}</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
