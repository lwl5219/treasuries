<div id="pf133" class="pf w4 h1f" data-page-no="133"><div class="pc pc133 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg133.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>8.14<span class="_ _18d"> </span>Process <span class="_"> </span>Accounting<span class="_ _1b"> </span><span class="ff18">273</span></div><div class="t m0 x32 h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">#endif</div><div class="t m0 x32 h57 y426 ff1a fs2d fc0 sc0 ls0 ws0">#if !defined(HAS_AXSIG)</div><div class="t m0 x32 h57 y800 ff1a fs2d fc0 sc0 ls0 ws0">#define AXSIG 0</div><div class="t m0 x32 h57 y801 ff1a fs2d fc0 sc0 ls0 ws0">#endif</div><div class="t m0 x32 h57 y23c8 ff1a fs2d fc0 sc0 ls0 ws0">#if !defined(BSD)</div><div class="t m0 x32 h57 y23c9 ff1a fs2d fc0 sc0 ls0 ws0">static unsigned long</div><div class="t m0 x32 h57 y23ca ff1a fs2d fc0 sc0 ls0 ws0">compt2ulong(comp_t comptime)<span class="_ _15"> </span>/* convert comp_t to unsigned long */</div><div class="t m0 x32 h57 y23cb ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y86e ff1a fs2d fc0 sc0 ls0 ws0">unsigned long<span class="_ _68"> </span>val;</div><div class="t m0 x8a h57 y86f ff1a fs2d fc0 sc0 ls0 ws0">int <span class="_ _82"> </span>exp;</div><div class="t m0 x8a h57 y23cc ff1a fs2d fc0 sc0 ls0 ws0">val = comptime &amp; 0x1fff;<span class="_ _15"> </span>/* 13-bit fraction */</div><div class="t m0 x8a h57 y23cd ff1a fs2d fc0 sc0 ls0 ws0">exp = (comptime &gt;&gt; 13) &amp; 7; /* 3-bit exponent (0-7) */</div><div class="t m0 x8a h57 y872 ff1a fs2d fc0 sc0 ls0 ws0">while (exp-- &gt; 0)</div><div class="t m0 x9d h57 y873 ff1a fs2d fc0 sc0 ls0 ws0">val *= 8;</div><div class="t m0 x8a h57 y874 ff1a fs2d fc0 sc0 ls0 ws0">return(val);</div><div class="t m0 x32 h57 y875 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h57 y876 ff1a fs2d fc0 sc0 ls0 ws0">#endif</div><div class="t m0 x32 h57 y23cf ff1a fs2d fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h57 y23d0 ff1a fs2d fc0 sc0 ls0 ws0">main(int argc, char *argv[])</div><div class="t m0 x32 h57 y23d1 ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y23d2 ff1a fs2d fc0 sc0 ls0 ws0">struct acct<span class="_ _8a"> </span>acdata;</div><div class="t m0 x8a h57 y23d3 ff1a fs2d fc0 sc0 ls0 ws0">FILE <span class="_ _bd"> </span>*fp;</div><div class="t m0 x8a h57 y23d4 ff1a fs2d fc0 sc0 ls0 ws0">if (argc != 2)</div><div class="t m0 x9d h57 y23d5 ff1a fs2d fc0 sc0 ls0 ws0">err_quit(&quot;usage: pracct filename&quot;);</div><div class="t m0 x8a h57 y23d6 ff1a fs2d fc0 sc0 ls0 ws0">if ((fp = fopen(argv[1], &quot;r&quot;)) == NULL)</div><div class="t m0 x9d h57 y23d7 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;can’t open %s&quot;, argv[1]);</div><div class="t m0 x8a h57 y23ea ff1a fs2d fc0 sc0 ls0 ws0">while (fread(&amp;acdata, sizeof(acdata), 1, fp) == 1) {</div><div class="t m0 x9d h57 y23eb ff1a fs2d fc0 sc0 ls0 ws0">printf(FMT, (int)sizeof(acdata.ac_comm),</div><div class="t m0 x1f h57 y23ec ff1a fs2d fc0 sc0 ls0 ws0">(int)sizeof(acdata.ac_comm), acdata.ac_comm,</div><div class="t m0 x32 h57 y23ed ff1a fs2d fc0 sc0 ls0 ws0">#if defined(BSD)</div><div class="t m0 x1f h57 y23ee ff1a fs2d fc0 sc0 ls0 ws0">acdata.ac_etime, acdata.ac_io,</div><div class="t m0 x32 h57 y23ef ff1a fs2d fc0 sc0 ls0 ws0">#else</div><div class="t m0 x1f h57 y23f0 ff1a fs2d fc0 sc0 ls0 ws0">compt2ulong(acdata.ac_etime), compt2ulong(acdata.ac_io),</div><div class="t m0 x32 h57 y23f1 ff1a fs2d fc0 sc0 ls0 ws0">#endif</div><div class="t m0 x32 h57 y23f2 ff1a fs2d fc0 sc0 ls0 ws0">#if defined(HAS_AC_STAT)</div><div class="t m0 x1f h57 y1327 ff1a fs2d fc0 sc0 ls0 ws0">(unsigned char) acdata.ac_stat,</div><div class="t m0 x32 h57 y1328 ff1a fs2d fc0 sc0 ls0 ws0">#endif</div><div class="t m0 x1f h57 y1329 ff1a fs2d fc0 sc0 ls0 ws0">acdata.ac_flag &amp; ACORE ? ’D’ : ’ ’,</div><div class="t m0 x1f h57 y132a ff1a fs2d fc0 sc0 ls0 ws0">acdata.ac_flag &amp; AXSIG ? ’X’ : ’ ’,</div><div class="t m0 x1f h57 y132b ff1a fs2d fc0 sc0 ls0 ws0">acdata.ac_flag &amp; AFORK ? ’F’ : ’ ’,</div><div class="t m0 x1f h57 y132c ff1a fs2d fc0 sc0 ls0 ws0">acdata.ac_flag &amp; ASU<span class="_ _68"> </span><span class="ls15c">?’<span class="_ _5b"></span><span class="ls0">S’ : ’ ’);</span></span></div><div class="t m0 x8a h57 y23f3 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y23f4 ff1a fs2d fc0 sc0 ls0 ws0">if (ferror(fp))</div><div class="t m0 x9d h57 y23f5 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;read error&quot;);</div><div class="t m0 x8a h57 y23f6 ff1a fs2d fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h57 y23f7 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x1b h2d y23f8 ff18 fs10 fc0 sc0 ls0 ws0">Figure 8.29<span class="_ _5a"> </span><span class="ff19">Print selected ﬁelds from system’s accounting ﬁle</span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
