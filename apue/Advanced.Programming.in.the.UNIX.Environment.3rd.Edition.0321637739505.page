<div id="pf1f9" class="pf w4 h1f" data-page-no="1f9"><div class="pc pc1f9 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg1f9.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>13.4<span class="_ _ea"> </span>Error <span class="_"> </span>Logging<span class="_ _1fb"> </span><span class="ff18">471</span></div><div class="t m0 x182 h76 y3a42 ff1b fs2a fc0 sc0 ls0 ws0">option<span class="_ _dc"> </span><span class="ff19">XSI <span class="_ _32"> </span>Description</span></div><div class="t m0 x1a0 h5e y3a43 ff1a fs10 fc0 sc0 ls0 ws0">LOG_CONS<span class="_ _1a8"> </span><span class="ff19">•<span class="_ _1c3"> </span>If the log message can’t be sent to<span class="_"> </span></span>syslogd<span class="_ _e"> </span><span class="ff19">via the UNIX domain datagram,</span></div><div class="t m0 xbe h2d y3a44 ff19 fs10 fc0 sc0 ls0 ws0">the message is written to the console instead.</div><div class="t m0 x1a0 h5e y3a45 ff1a fs10 fc0 sc0 ls0 ws0">LOG_NDELAY<span class="_ _1c3"> </span><span class="ff19">•<span class="_ _1c3"> </span>Open the UNIX domain datagram socket to the<span class="_"> </span></span>syslogd<span class="_ _e"> </span><span class="ff19">daemon</span></div><div class="t m0 xbe h2d y3a46 ff19 fs10 fc0 sc0 ls0 ws0">immediately; don’t wait until the ﬁrst message is logged.<span class="_ _35"> </span>Normally<span class="_ _6"></span><span class="ls136">,t<span class="_ _a"></span><span class="ls0">he</span></span></div><div class="t m0 xbe h2d y3a47 ff19 fs10 fc0 sc0 ls0 ws0">socket is not opened until the ﬁrst message is logged.</div><div class="t m0 x1a0 h5e y3a48 ff1a fs10 fc0 sc0 ls0 ws0">LOG_NOWAIT<span class="_ _1c3"> </span><span class="ff19">•<span class="_ _1c3"> </span>Do not wait for child processes that might have been created in the process of</span></div><div class="t m0 xbe h2d y3a49 ff19 fs10 fc0 sc0 ls0 ws0">logging the message.<span class="_ _35"> </span>This prevents conﬂicts with applications that catch</div><div class="t m0 xbe h5e y3a4a ff1a fs10 fc0 sc0 ls0 ws0">SIGCHLD<span class="ff19 ls136">,s<span class="_ _84"></span><span class="ls0">ince the application might have retrieved the child’s status by</span></span></div><div class="t m0 xbe h5e y3a4b ff19 fs10 fc0 sc0 ls0 ws0">the time that<span class="_"> </span><span class="ff1a">syslog<span class="_ _53"> </span></span>calls<span class="_"> </span><span class="ff1a">wait</span>.</div><div class="t m0 x1a0 h5e y3a4c ff1a fs10 fc0 sc0 ls0 ws0">LOG_ODELAY<span class="_ _1c3"> </span><span class="ff19">•<span class="_ _1c3"> </span>Delay the opening of the connection to the<span class="_"> </span></span>syslogd<span class="_ _e"> </span><span class="ff19">daemon until the ﬁrst</span></div><div class="t m0 xbe h2d y3a4d ff19 fs10 fc0 sc0 ls0 ws0">message is logged.</div><div class="t m0 x1a0 h5e y3a4e ff1a fs10 fc0 sc0 ls0 ws0">LOG_PERROR<span class="_ _9f"> </span><span class="ff19 lsf81">Wr<span class="_ _9"></span><span class="ls0">ite the log message to standar<span class="ls136">de<span class="_ _5"></span><span class="ls0">rror in addition to sending it to<span class="_"> </span><span class="ff1a">syslogd</span>.</span></span></span></span></div><div class="t m0 xbe h2d y3a4f ff19 fs10 fc0 sc0 ls0 ws0">(Unavailable on Solaris.)</div><div class="t m0 x1a0 h5e y3a50 ff1a fs10 fc0 sc0 ls0 ws0">LOG_PID<span class="_ _14"> </span><span class="ff19">•<span class="_ _1c3"> </span>Log the process ID with each message.<span class="_ _35"> </span>This is intended for daemons that</span></div><div class="t m0 xbe h5e y3a51 ff1a fs10 fc0 sc0 ls0 ws0">fork<span class="_ _53"> </span><span class="ff19 ls136">ac<span class="_ _84"></span><span class="ls0">hild process to handle different r<span class="_ _0"></span>equests (as compared to</span></span></div><div class="t m0 xbe h5e y3a52 ff19 fs10 fc0 sc0 ls0 ws0">daemons, such as<span class="_"> </span><span class="ff1a">syslogd</span><span class="ls136">,t<span class="_ _84"></span><span class="ls0">hat never call<span class="_"> </span><span class="ff1a">fork</span>).</span></span></div><div class="t m0 xa6 h4f y3a53 ff18 fs11 fc0 sc0 ls0 ws0">Figure 13.3<span class="_ _5a"> </span><span class="ff19">The<span class="_"> </span><span class="ff1b">option<span class="_"> </span></span>argument for<span class="_"> </span><span class="ff1a">openlog</span></span></div><div class="t m0 x3f h54 y3a54 ff19 fs2c fc0 sc0 ls0 ws0">The<span class="_ _44"> </span><span class="ff1b">format<span class="_ _35"> </span></span>argument <span class="_ _42"> </span>and <span class="_ _42"> </span>any <span class="_ _42"> </span>remaining <span class="_ _42"> </span>arguments <span class="_ _42"> </span>ar<span class="_ _0"></span><span class="lsf82">ep<span class="_ _43"></span><span class="ls0">assed <span class="_ _23"> </span>to <span class="_ _53"> </span>the<span class="_ _44"> </span><span class="ff1a">vsprintf</span></span></span></div><div class="t m0 x32 h54 y3a55 ff19 fs2c fc0 sc0 ls0 ws0">function for formatting.<span class="_ _59"> </span>Any <span class="_ _2"></span>occurrences of the characters<span class="_"> </span><span class="ff1a">%m<span class="_ _80"> </span></span>in<span class="_"> </span><span class="ff1b">format<span class="_"> </span></span>ar<span class="lsf83">eﬁ<span class="_ _4f"></span><span class="ls0">rst replaced</span></span></div><div class="t m0 x32 h54 y3a56 ff19 fs2c fc0 sc0 ls0 ws0">with the error message string (<span class="ff1a">strerror</span><span class="ls142">)c<span class="_ _4f"></span><span class="ls0">orresponding to the value of<span class="_"> </span><span class="ff1a">errno</span>.</span></span></div><div class="t m0 x3f h54 y3a57 ff19 fs2c fc0 sc0 ls0 ws0">The<span class="_ _47"> </span><span class="ff1a">setlogmask<span class="_ _47"> </span></span>function <span class="_ _3"></span>can <span class="_ _3"></span>be <span class="_ _9"></span>used <span class="_ _3"></span>to <span class="_ _3"></span>set <span class="_ _3"></span>the <span class="_ _3"></span>log <span class="_ _3"></span>priority <span class="_ _3"></span>mask <span class="_ _9"></span>for <span class="_ _3"></span>the <span class="_ _3"></span>process.</div><div class="t m0 x32 h55 y3a58 ff19 fs2c fc0 sc0 ls0 ws0">This <span class="_ _9"></span>function <span class="_ _23"></span>r<span class="_ _0"></span>eturns <span class="_ _9"></span>the <span class="_ _23"></span>pr<span class="_ _0"></span>evious <span class="_ _9"></span>mask.<span class="_ _51"> </span>When <span class="_ _9"></span>the <span class="_ _9"></span>log <span class="_ _23"></span>priority <span class="_ _9"></span>mask <span class="_ _9"></span>is <span class="_ _23"></span>set, <span class="_ _9"></span>messages</div><div class="t m0 x32 h55 y3a59 ff19 fs2c fc0 sc0 ls0 ws0">ar<span class="lsf84">en<span class="_ _8"></span><span class="ls0">ot <span class="_ _2"></span>logged <span class="_ _2"></span>unless <span class="_ _2"></span>their <span class="_ _2"></span>priority <span class="_ _2"></span>is set <span class="_ _2"></span>in <span class="_ _2"></span>the <span class="_ _2"></span>log <span class="_ _2"></span>priority <span class="_ _2"></span>mask.<span class="_ _46"> </span>Note <span class="_ _2"></span>that <span class="_ _2"></span>attempts <span class="_ _2"></span>to</span></span></div><div class="t m0 x32 h55 y3a5a ff19 fs2c fc0 sc0 ls0 ws0">set the log priority mask to 0 will have no effect.</div><div class="t m0 x3f h54 y3a5b ff19 fs2c fc0 sc0 ls0 ws0">The<span class="_ _35"> </span><span class="ff1a">logger</span></div><div class="t m0 xdf h55 y3a5c ff19 fs2c fc0 sc0 ls0 ws0">(</div><div class="t m0 x1e5 h55 y3a5b ff19 fs2c fc0 sc0 ls0 ws0">1</div><div class="t m0 xda h55 y3a5c ff19 fs2c fc0 sc0 ls0 ws0">)</div><div class="t m0 x38 h55 y3a5b ff19 fs2c fc0 sc0 ls0 ws0">program <span class="_ _23"> </span>is <span class="_ _42"> </span>also <span class="_ _23"> </span>provided <span class="_ _42"> </span>by <span class="_ _23"> </span>many <span class="_ _42"> </span>systems <span class="_ _42"> </span>as <span class="_ _42"> </span>a <span class="_ _23"> </span>way <span class="_ _42"> </span>to <span class="_ _42"> </span>send <span class="_ _42"> </span>log</div><div class="t m0 x32 h54 y3a5d ff19 fs2c fc0 sc0 ls0 ws0">messages <span class="_ _23"> </span>to <span class="_ _42"> </span>the<span class="_ _35"> </span><span class="ff1a">syslog<span class="_ _35"> </span></span>facility<span class="_ _6"></span><span class="lsf85">.S<span class="_ _7"></span><span class="ls0">ome <span class="_ _23"> </span>implementations <span class="_ _42"> </span>allow <span class="_ _42"> </span>optional <span class="_ _23"> </span>arguments <span class="_ _23"> </span>to</span></span></div><div class="t m0 x32 h60 y3a5e ff19 fs2c fc0 sc0 ls0 ws0">this <span class="_ _44"> </span>program, <span class="_ _44"> </span>specifying <span class="_ _4b"> </span>the<span class="_ _54"> </span><span class="ff1b">facility</span>,<span class="_ _65"> </span><span class="ff1b">level</span><span class="lsf86">,a<span class="_ _52"></span><span class="ls0">nd<span class="_ _54"> </span><span class="ff1b">ident</span><span class="lsf86">,a<span class="_ _52"></span><span class="ls0">lthough <span class="_ _44"> </span>the <span class="_ _4b"> </span>Single <span class="_ _44"> </span>UNIX</span></span></span></span></div><div class="t m0 x32 h54 y3a5f ff19 fs2c fc0 sc0 ls0 ws0">Speciﬁcation <span class="_ _3"></span>doesn’t <span class="_ _3"></span>deﬁne <span class="_ _3"></span>any <span class="_ _3"></span>options.<span class="_ _16"> </span>The<span class="_ _47"> </span><span class="ff1a">logger<span class="_ _45"> </span></span>command <span class="_ _2"></span>is <span class="_ _3"></span>intended <span class="_ _3"></span>for <span class="_ _3"></span>a <span class="_ _9"></span>shell</div><div class="t m0 x32 h55 y3a60 ff19 fs2c fc0 sc0 ls0 ws0">script running noninteractively that needs to generate log messages.</div><div class="t m0 x35 h61 y3a61 ff16 fs2c fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h55 y3a62 ff19 fs2c fc0 sc0 ls0 ws0">In a (hypothetical) line printer spooler daemon, you might encounter the sequence</div><div class="t m0 x3f h5d y3a63 ff1a fs2f fc0 sc0 ls0 ws0">openlog(&quot;lpd&quot;, LOG_PID, LOG_LPR);</div><div class="t m0 x3f h5d y3a64 ff1a fs2f fc0 sc0 ls0 ws0">syslog(LOG_ERR, &quot;open error for %s: %m&quot;, filename);</div><div class="t m0 x32 h60 y3a65 ff19 fs2c fc0 sc0 ls0 ws0">The <span class="_ _42"> </span>ﬁrst <span class="_ _53"> </span>call <span class="_ _42"> </span>sets <span class="_ _53"> </span>the<span class="_ _44"> </span><span class="ff1b">ident<span class="_ _44"> </span></span>string <span class="_ _53"> </span>to <span class="_ _42"> </span>the <span class="_ _53"> </span>program <span class="_ _42"> </span>name, <span class="_ _53"> </span>speciﬁes <span class="_ _42"> </span>that <span class="_ _53"> </span>the <span class="_ _42"> </span>process <span class="_ _42"> </span>ID</div><div class="t m0 x32 h60 y3a66 ff19 fs2c fc0 sc0 ls0 ws0">should always be printed, and <span class="_ _2"></span>sets the default<span class="_"> </span><span class="ff1b">facility<span class="_ _66"> </span></span>to the line <span class="_ _2"></span>printer system.<span class="_ _46"> </span>The call</div><div class="t m0 x32 h54 y3a67 ff19 fs2c fc0 sc0 ls0 ws0">to<span class="_ _4b"> </span><span class="ff1a">syslog<span class="_ _59"> </span></span>speciﬁes <span class="_ _e"> </span>an <span class="_"> </span>err<span class="_ _0"></span>or <span class="_ _e"> </span>condition <span class="_ _e"> </span>and <span class="_"> </span>a <span class="_ _53"> </span>message <span class="_"> </span>string.<span class="_ _65"> </span>If <span class="_"> </span>we <span class="_ _53"> </span>had <span class="_"> </span>not <span class="_ _53"> </span>called</div><div class="t m0 x32 h54 y3a68 ff1a fs2c fc0 sc0 ls0 ws0">openlog<span class="ff19 ls142">,t<span class="_ _d"></span><span class="ls0">he second call could have been</span></span></div><div class="t m0 x3f h5d y3a69 ff1a fs2f fc0 sc0 ls0 ws0">syslog(LOG_ERR | LOG_LPR, &quot;open error for %s: %m&quot;, filename);</div><div class="t m0 x32 h60 y3a6a ff19 fs2c fc0 sc0 ls0 ws0">Here, we specify the<span class="_"> </span><span class="ff1b">priority<span class="_"> </span></span>ar<span class="_ _0"></span>gument as a combination of a<span class="_"> </span><span class="ff1b">level<span class="_"> </span></span>and a<span class="_"> </span><span class="ff1b">facility</span>.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
