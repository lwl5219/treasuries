<div id="pf5f" class="pf w4 h1f" data-page-no="5f"><div class="pc pc5f w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg5f.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x32 h47 y25f ff1e fsb fc0 sc0 ls0 ws0">3</div><div class="t m0 x32 h20 y8f ff15 fs2 fc0 sc0 ls0 ws0">File <span class="_"> </span>I/O</div><div class="t m0 x35 h48 y114 ff16 fs1 fc0 sc0 ls0 ws0">3.1 <span class="_ _68"> </span>Introduction</div><div class="t m0 x32 h28 y116 ff19 fs5 fc0 sc0 ls72 ws0">We<span class="_ _9"></span><span class="ls0">’ll <span class="_ _3"></span>start <span class="_ _3"></span>our <span class="_ _9"></span>discussion <span class="_ _3"></span>of <span class="_ _3"></span>the <span class="_ _3"></span>UNIX <span class="_ _9"></span>System <span class="_ _3"></span>by <span class="_ _3"></span>describing <span class="_ _3"></span>the <span class="_ _9"></span>functions <span class="_ _3"></span>available <span class="_ _3"></span>for</span></div><div class="t m0 x32 h28 y117 ff19 fs5 fc0 sc0 ls0 ws0">ﬁle I/O<span class="_ _9"></span><span class="ls37">—o<span class="_ _6"></span><span class="ls0">pen a <span class="_ _2"></span>ﬁle, read a ﬁle, write a <span class="_ _2"></span>ﬁle, and so on.<span class="_ _46"> </span>Most <span class="_ _2"></span>ﬁle I/O on <span class="_ _2"></span>a UNIX system</span></span></div><div class="t m0 x32 h2c y118 ff19 fs5 fc0 sc0 ls0 ws0">can <span class="_ _23"></span>be <span class="_ _23"> </span>performed <span class="_ _23"> </span>using <span class="_ _23"> </span>only <span class="_ _42"> </span>ﬁve <span class="_ _23"></span>functions:<span class="_ _35"> </span><span class="ff1a">open</span>,<span class="_ _35"> </span><span class="ff1a">read</span>,<span class="_ _35"> </span><span class="ff1a">write</span>,<span class="_ _35"> </span><span class="ff1a">lseek</span><span class="ls333">,a<span class="_ _43"></span><span class="ls0">nd<span class="_ _35"> </span><span class="ff1a">close</span>.</span></span></div><div class="t m0 x32 h2c y119 ff19 fs5 fc0 sc0 ls72 ws0">We <span class="_ _53"> </span>t<span class="_ _9"></span><span class="ls0">hen examine the effect of various buffer sizes on the<span class="_"> </span><span class="ff1a">read<span class="_ _e"> </span></span>and<span class="_"> </span><span class="ff1a">write<span class="_ _66"> </span></span>functions.</span></div><div class="t m0 x3f h29 y11a ff19 fs5 fc0 sc0 ls0 ws0">The <span class="_ _42"> </span>functions <span class="_ _53"> </span>described <span class="_ _42"> </span>in <span class="_ _53"> </span>this <span class="_ _53"> </span>chapter <span class="_ _42"> </span>ar<span class="ls334">eo<span class="_ _c"></span><span class="ls0">ften <span class="_ _53"> </span>referr<span class="_ _0"></span>ed <span class="_ _42"> </span>to <span class="_ _53"> </span>as<span class="_ _44"> </span><span class="ff1b">unbuffered <span class="_ _42"> </span>I/O</span><span class="ls334">,i<span class="_ _43"></span><span class="ls0">n</span></span></span></span></div><div class="t m0 x32 h28 y11b ff19 fs5 fc0 sc0 ls0 ws0">contrast <span class="_"> </span>to <span class="_ _66"> </span>the <span class="_ _66"> </span>standar<span class="ls335">dI<span class="_ _5b"></span><span class="ls0">/O <span class="_ _66"> </span>routines, <span class="_"> </span>which <span class="_ _66"> </span>we <span class="_ _66"> </span>describe <span class="_ _66"> </span>in <span class="_ _66"> </span>Chapter <span class="_ _47"> </span>5.<span class="_ _60"> </span>The <span class="_"> </span>term</span></span></div><div class="t m0 x32 h2c y11c ff1b fs5 fc0 sc0 ls0 ws0">unbuffered<span class="_ _45"> </span><span class="ff19">means <span class="_ _23"></span>that <span class="_ _9"></span>each<span class="_ _35"> </span><span class="ff1a">read<span class="_ _45"> </span></span>or<span class="_ _35"> </span><span class="ff1a">write<span class="_ _45"> </span></span>invokes <span class="_ _23"> </span>a <span class="_ _23"></span>system <span class="_ _9"></span>call <span class="_ _23"> </span>in <span class="_ _23"></span>the <span class="_ _23"></span>kernel.<span class="_ _5a"> </span>These</span></div><div class="t m0 x32 h28 y11d ff19 fs5 fc0 sc0 ls0 ws0">unbuffer<span class="_ _0"></span>ed <span class="_ _3"></span>I/O <span class="_ _3"></span>functions <span class="_ _9"></span>ar<span class="ls336">en<span class="_ _b"></span><span class="ls0">ot <span class="_ _3"></span>part <span class="_ _9"></span>of <span class="_ _3"></span>ISO <span class="_ _9"></span>C, <span class="_ _3"></span>but <span class="_ _9"></span>ar<span class="ls336">ep<span class="_ _b"></span><span class="ls0">art <span class="_ _3"></span>of <span class="_ _9"></span>POSIX.1 <span class="_ _3"></span>and <span class="_ _9"></span>the <span class="_ _3"></span>Single</span></span></span></span></div><div class="t m0 x32 h28 y11e ff19 fs5 fc0 sc0 ls0 ws0">UNIX Speciﬁcation.</div><div class="t m0 x3f h28 y11f ff19 fs5 fc0 sc0 ls0 ws0">Whenever <span class="_"> </span>we <span class="_ _47"> </span>describe <span class="_"> </span>the <span class="_ _47"> </span>sharing <span class="_"> </span>of <span class="_ _47"> </span>resour<span class="_ _1"></span>ces <span class="_ _47"> </span>among <span class="_"> </span>multiple <span class="_ _66"> </span>processes, <span class="_ _66"> </span>the</div><div class="t m0 x32 h28 y120 ff19 fs5 fc0 sc0 ls0 ws0">concept <span class="_"> </span>of <span class="_"> </span>an <span class="_"> </span>atomic <span class="_ _e"> </span>operation <span class="_"> </span>becomes <span class="_"> </span>important.<span class="_ _48"> </span><span class="ls72">We <span class="_ _4b"> </span>e<span class="_ _9"></span></span>xamine <span class="_"> </span>this <span class="_"> </span>concept <span class="_"> </span>with</div><div class="t m0 x32 h2c y121 ff19 fs5 fc0 sc0 ls16 ws0">re<span class="ls0">gard<span class="_"> </span>to<span class="_ _47"> </span>ﬁle I/O <span class="_ _2"></span>and <span class="_ _2"></span>the <span class="_ _2"></span>arguments to the<span class="_ _47"> </span><span class="ff1a">open<span class="_ _66"> </span></span>function. <span class="_"> </span>This<span class="_ _47"> </span>leads to <span class="_ _2"></span>a <span class="_ _2"></span>discussion <span class="_ _2"></span>of</span></div><div class="t m0 x32 h28 y122 ff19 fs5 fc0 sc0 ls0 ws0">how <span class="_ _42"> </span>ﬁles <span class="_ _42"> </span>ar<span class="ls337">es<span class="_ _43"></span><span class="ls0">har<span class="_ _1"></span>ed <span class="_ _53"> </span>among <span class="_ _42"> </span>multiple <span class="_ _53"> </span>processes <span class="_ _42"> </span>and <span class="_ _42"> </span>which <span class="_ _42"> </span>kernel <span class="_ _53"> </span>data <span class="_ _42"> </span>structures <span class="_ _42"> </span>are</span></span></div><div class="t m0 x32 h2c y123 ff19 fs5 fc0 sc0 ls0 ws0">involved. <span class="_ _45"> </span>After<span class="_ _35"> </span>describing <span class="_ _23"></span>these <span class="_ _23"></span>features, <span class="_ _9"></span>we <span class="_ _23"></span>describe <span class="_ _23"></span>the<span class="_ _45"> </span><span class="ff1a">dup</span>,<span class="_ _35"> </span><span class="ff1a">fcntl</span>,<span class="_ _45"> </span><span class="ff1a">sync</span>,<span class="_ _35"> </span><span class="ff1a">fsync</span>,</div><div class="t m0 x32 h2c y124 ff19 fs5 fc0 sc0 ls0 ws0">and<span class="_"> </span><span class="ff1a">ioctl<span class="_ _80"> </span></span>functions.</div><div class="t m0 x35 h48 y127 ff16 fs1 fc0 sc0 ls0 ws0">3.2 <span class="_ _68"> </span>File<span class="_ _54"> </span>Descriptors</div><div class="t m0 x32 h28 y129 ff19 fs5 fc0 sc0 ls72 ws0">To <span class="_ _45"> </span>t<span class="_ _23"></span><span class="ls0">he <span class="_ _42"> </span>kernel, <span class="_ _53"> </span>all <span class="_ _53"> </span>open <span class="_ _53"> </span>ﬁles <span class="_ _53"> </span>ar<span class="ls338">er<span class="_ _55"></span><span class="ls0">eferred <span class="_ _42"> </span>to <span class="_ _53"> </span>by <span class="_ _53"> </span>ﬁle <span class="_ _53"> </span>descriptors.<span class="_ _65"> </span><span class="ls338">Aﬁ<span class="_ _c"></span><span class="ls0">le <span class="_ _53"> </span>descriptor <span class="_ _53"> </span>is <span class="_ _53"> </span>a</span></span></span></span></span></div><div class="t m0 x32 h28 y12a ff19 fs5 fc0 sc0 ls0 ws0">non-negative <span class="_ _42"> </span>integer<span class="_ _1"></span><span class="ls339">.W<span class="_ _52"></span><span class="ls0">hen <span class="_ _42"> </span>we <span class="_ _53"> </span>open <span class="_ _42"> </span>an <span class="_ _53"> </span>existing <span class="_ _42"> </span>ﬁle <span class="_ _42"> </span>or <span class="_ _53"> </span>create <span class="_ _42"> </span>a <span class="_ _42"> </span>new <span class="_ _53"> </span>ﬁle, <span class="_ _42"> </span>the <span class="_ _53"> </span>kernel</span></span></div><div class="t m0 x32 h28 y12b ff19 fs5 fc0 sc0 ls16 ws0">re<span class="ls0">turns <span class="_"> </span>a <span class="_ _e"> </span>ﬁle <span class="_"> </span>descriptor <span class="_ _e"> </span>to <span class="_"> </span>the <span class="_ _e"> </span>process. <span class="_ _59"> </span>When<span class="_ _59"> </span>we <span class="_ _e"> </span>want <span class="_"> </span>to <span class="_ _e"> </span>read <span class="_ _e"> </span>or <span class="_"> </span>write <span class="_ _e"> </span>a <span class="_"> </span>ﬁle, <span class="_ _e"> </span>we</span></div><div class="t m0 x32 h2c y12c ff19 fs5 fc0 sc0 ls0 ws0">identify <span class="_ _53"> </span>the <span class="_ _e"> </span>ﬁle <span class="_ _53"> </span>with <span class="_ _e"> </span>the <span class="_ _53"> </span>ﬁle <span class="_ _e"> </span>descriptor <span class="_ _53"> </span>that <span class="_ _e"> </span>was <span class="_ _53"> </span>returned <span class="_ _53"> </span>by<span class="_ _4b"> </span><span class="ff1a">open<span class="_ _4b"> </span></span>or<span class="_ _4b"> </span><span class="ff1a">creat<span class="_ _4b"> </span></span>as <span class="_ _53"> </span>an</div><div class="t m0 x32 h2c y12d ff19 fs5 fc0 sc0 ls0 ws0">argument to either<span class="_"> </span><span class="ff1a">read<span class="_ _80"> </span></span>or<span class="_"> </span><span class="ff1a">write</span>.</div><div class="t m0 xcf h23 y12e ff18 fs0 fc0 sc0 ls0 ws0">61</div><a class="l" href="#pfc" data-dest-detail='[12,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:157.497886px;bottom:975.452099px;width:91.145004px;height:134.895020px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfc" data-dest-detail='[12,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.891993px;bottom:743.626788px;width:105.756005px;height:19.680023px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfc" data-dest-detail='[12,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.893883px;bottom:264.826820px;width:129.851097px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
