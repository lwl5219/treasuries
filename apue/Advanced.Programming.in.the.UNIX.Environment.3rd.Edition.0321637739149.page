<div id="pf95" class="pf w4 h1f" data-page-no="95"><div class="pc pc95 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg95.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>4.14<span class="_ _19a"> </span>File <span class="_"> </span>Systems<span class="_ _1b"> </span><span class="ff18 ls153">11<span class="_ _2"></span><span class="ls0">5</span></span></div><div class="t m0 x32 h2a y12f ff19 fsf fc0 sc0 ls49 ws0">•B<span class="_ _4d"></span><span class="ls0">ecause <span class="_ _2"></span>the <span class="_ _2"></span>i-node <span class="_ _2"></span>number in <span class="_ _2"></span>the <span class="_ _2"></span>directory <span class="_ _2"></span>entry <span class="_ _2"></span>points <span class="_ _2"></span>to <span class="_ _2"></span>an <span class="_ _2"></span>i-node <span class="_ _2"></span>in <span class="_ _2"></span>the <span class="_ _2"></span>same <span class="_ _2"></span>ﬁle</span></div><div class="t m0 x20 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">system, <span class="_ _23"></span>a <span class="_ _23"></span>directory <span class="_ _9"></span>entry <span class="_ _23"> </span>can’t <span class="_ _23"> </span>refer <span class="_ _23"> </span>to <span class="_ _23"> </span>an <span class="_ _23"> </span>i-node <span class="_ _23"> </span>in <span class="_ _23"> </span>a <span class="_ _23"> </span>differ<span class="_ _0"></span>ent <span class="_ _23"></span>ﬁle <span class="_ _23"></span>system.<span class="_ _51"> </span>This <span class="_ _23"></span>is</div><div class="t m0 x20 h26 y131 ff19 fsf fc0 sc0 ls0 ws0">why <span class="_ _2"></span>the<span class="_ _47"> </span><span class="ff1a">ln</span></div><div class="t m0 x53 h2a y17a ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 x54 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">1</div><div class="t m0 xdf h2a y17a ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 x184 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">command <span class="_ _2"></span>(make <span class="_ _3"></span>a <span class="_ _3"></span>new <span class="_ _3"></span>directory <span class="_ _2"></span>entry <span class="_ _3"></span>that <span class="_ _3"></span>points <span class="_ _3"></span>to <span class="_ _3"></span>an <span class="_ _3"></span>existing <span class="_ _3"></span>ﬁle)</div><div class="t m0 x20 h26 y132 ff19 fsf fc0 sc0 ls0 ws0">can’t cross ﬁle systems.<span class="_ _59"> </span><span class="ls5f">We <span class="_ _53"> </span>d<span class="_ _9"></span></span>escribe the<span class="_"> </span><span class="ff1a">link<span class="_ _66"> </span></span>function in the next section.</div><div class="t m0 x32 h2a y1ad ff19 fsf fc0 sc0 ls49 ws0">•W<span class="_ _4d"></span><span class="ls0">hen <span class="_ _9"></span>renaming <span class="_ _9"></span>a <span class="_ _23"> </span>ﬁle <span class="_ _23"></span>without <span class="_ _9"></span>changing <span class="_ _23"></span>ﬁle <span class="_ _9"></span>systems, <span class="_ _23"></span>the <span class="_ _9"></span>actual <span class="_ _23"></span>contents <span class="_ _23"></span>of <span class="_ _9"></span>the <span class="_ _23"></span>ﬁle</span></div><div class="t m0 x20 h2a y1ae ff19 fsf fc0 sc0 ls0 ws0">need <span class="_ _9"></span>not <span class="_ _9"></span>be <span class="_ _9"></span>moved<span class="_ _9"></span><span class="ls9d">—a<span class="_ _6"></span><span class="ls0">ll <span class="_ _9"></span>that <span class="_ _9"></span>needs <span class="_ _9"></span>to <span class="_ _9"></span>be <span class="_ _9"></span>done <span class="_ _3"></span>is <span class="_ _9"></span>to <span class="_ _9"></span>add <span class="_ _9"></span>a <span class="_ _9"></span>new <span class="_ _9"></span>directory <span class="_ _3"></span>entry <span class="_ _9"></span>that</span></span></div><div class="t m0 x20 h2a y1af ff19 fsf fc0 sc0 ls0 ws0">points <span class="_ _2"></span>to <span class="_ _3"></span>the <span class="_ _3"></span>existing <span class="_ _2"></span>i-node <span class="_ _3"></span>and <span class="_ _3"></span>then <span class="_ _2"></span>unlink <span class="_ _3"></span>the <span class="_ _3"></span>old <span class="_ _3"></span>directory <span class="_ _2"></span>entry<span class="_ _4"></span><span class="ls524">.T<span class="_ _5b"></span><span class="ls0">he <span class="_ _2"></span>link <span class="_ _3"></span>count</span></span></div><div class="t m0 x20 h26 y1b0 ff19 fsf fc0 sc0 ls0 ws0">will <span class="_ _59"> </span>remain <span class="_ _4b"> </span>the <span class="_ _59"> </span>same.<span class="_ _5e"> </span>For <span class="_ _4b"> </span>example, <span class="_ _59"> </span>to <span class="_ _59"> </span>rename <span class="_ _59"> </span>the <span class="_ _59"> </span>ﬁle<span class="_ _48"> </span><span class="ff1a">/usr/lib/foo<span class="_ _60"> </span></span>to</div><div class="t m0 x20 h26 y153 ff1a fsf fc0 sc0 ls0 ws0">/usr/foo<span class="ff19 ls525">,t<span class="_ _62"></span><span class="ls0">he <span class="_ _45"> </span>contents <span class="_ _47"> </span>of <span class="_ _45"> </span>the <span class="_ _45"> </span>ﬁle<span class="_ _16"> </span><span class="ff1a">foo<span class="_"> </span></span>need <span class="_ _45"> </span>not <span class="_ _47"> </span>be <span class="_ _45"> </span>moved <span class="_ _45"> </span>if <span class="_ _45"> </span>the <span class="_ _47"> </span>directories</span></span></div><div class="t m0 x20 h26 y155 ff1a fsf fc0 sc0 ls0 ws0">/usr/lib<span class="_ _45"> </span><span class="ff19">and<span class="_ _45"> </span></span>/usr<span class="_ _45"> </span><span class="ff19">ar<span class="_ _0"></span><span class="ls2a1">eo<span class="_ _b"></span><span class="ls240">nt<span class="_ _b"></span><span class="ls0">he <span class="_ _9"></span>same <span class="_ _9"></span>ﬁle <span class="_ _9"></span>system.<span class="_ _5a"> </span>This <span class="_ _9"></span>is <span class="_ _9"></span>how <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">mv</span></span></span></span></span></div><div class="t m0 xb3 h2a y5d0 ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 x189 h2a y155 ff19 fsf fc0 sc0 ls0 ws0">1</div><div class="t m0 xf9 h2a y5d0 ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 x1a2 h2a y155 ff19 fsf fc0 sc0 ls0 ws0">command</div><div class="t m0 x20 h2a y10aa ff19 fsf fc0 sc0 ls0 ws0">usually operates.</div><div class="t m0 x3f h2a y960 ff19 fsf fc0 sc0 ls5f ws0">We<span class="_ _9"></span><span class="ls0">’ve <span class="_ _2"></span>talked <span class="_ _2"></span>about <span class="_ _3"></span>the <span class="_ _2"></span>concept <span class="_ _2"></span>of <span class="_ _3"></span>a <span class="_ _2"></span>link <span class="_ _2"></span>count <span class="_ _2"></span>for <span class="_ _3"></span>a <span class="_ _2"></span>regular <span class="_ _2"></span>ﬁle, <span class="_ _2"></span>but <span class="_ _2"></span>what <span class="_ _3"></span>about <span class="_ _2"></span>the</span></div><div class="t m0 x32 h2a y10ab ff19 fsf fc0 sc0 ls0 ws0">link <span class="_ _3"></span>count <span class="_ _9"></span>ﬁeld <span class="_ _3"></span>for <span class="_ _9"></span>a <span class="_ _3"></span>directory? <span class="_ _45"> </span>Assume<span class="_ _47"> </span>that <span class="_ _9"></span>we <span class="_ _3"></span>make <span class="_ _9"></span>a <span class="_ _3"></span>new <span class="_ _9"></span>directory <span class="_ _3"></span>in <span class="_ _3"></span>the <span class="_ _9"></span>working</div><div class="t m0 x32 h2a y10ac ff19 fsf fc0 sc0 ls0 ws0">directory<span class="_ _4"></span>,<span class="_"> </span>as<span class="_"> </span>in</div><div class="t m0 x3f h57 y10ad ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">mkdir testdir</span></div><div class="t m0 x32 h2a y10ae ff19 fsf fc0 sc0 ls0 ws0">Figur<span class="ls526">e4<span class="_ _b"></span><span class="ls0">.15 <span class="_ _3"></span>shows <span class="_ _3"></span>the <span class="_ _3"></span>result. <span class="_ _47"> </span>Note<span class="_ _47"> </span>that <span class="_ _2"></span>in <span class="_ _3"></span>this <span class="_ _3"></span>ﬁgure, <span class="_ _2"></span>we <span class="_ _3"></span>explicitly <span class="_ _3"></span>show <span class="_ _3"></span>the <span class="_ _3"></span>entries <span class="_ _2"></span>for</span></span></div><div class="t m0 x32 h2a y10af ff19 fsf fc0 sc0 ls0 ws0">dot and dot-dot.</div><div class="t m0 x139 h9f y10b0 ff19 fs39 fc0 sc0 ls0 ws0">i-node array</div><div class="t m0 x77 h81 y10b1 ff19 fs3f fc0 sc0 ls0 ws0">directory</div><div class="t m0 x78 h81 y10b2 ff19 fs3f fc0 sc0 ls0 ws0">block</div><div class="t m0 x151 h82 y10b3 ff19 fs40 fc0 sc0 ls0 ws0">directory</div><div class="t m0 x11d h82 y10b4 ff19 fs40 fc0 sc0 ls0 ws0">block</div><div class="t m0 x92 h7f y10b5 ff19 fs3d fc0 sc0 ls0 ws0">directory blocks and data blocks</div><div class="t m0 x1a0 hb0 y10b6 ff19 fs5a fc0 sc0 ls0 ws0">i-node</div><div class="t m0 x156 hb0 y10b7 ff19 fs5a fc0 sc0 ls0 ws0">0</div><div class="t m0 x53 hb1 y10b8 ff19 fs5b fc0 sc0 ls0 ws0">i-node</div><div class="t m0 x54 hb1 y10b9 ff19 fs5b fc0 sc0 ls0 ws0">1267</div><div class="t m0 x6b h84 y10ba ff19 fs41 fc0 sc0 ls0 ws0">i-node</div><div class="t m0 xf3 h84 y10bb ff19 fs41 fc0 sc0 ls0 ws0">2549</div><div class="t m5 x1a3 hb2 y10bc ff19 fs5c fc0 sc0 ls0 ws0">data block</div><div class="t m6 x16 hb3 y10bd ff19 fs5d fc0 sc0 ls0 ws0">data block</div><div class="t m0 x1a4 ha3 y10be ff19 fs4f fc0 sc0 ls0 ws0">2549</div><div class="t m0 x179 hb4 y10bf ff1a fs5e fc0 sc0 ls0 ws0">.</div><div class="t m0 x1a4 hb5 y10c0 ff19 fs5f fc0 sc0 ls0 ws0">1267</div><div class="t m0 x179 hb6 y10c1 ff1a fs60 fc0 sc0 ls0 ws0">..</div><div class="t m0 x1a1 hb7 y10c2 ff19 fs61 fc0 sc0 ls0 ws0">1267</div><div class="t m0 x169 hb8 y10c3 ff1a fs62 fc0 sc0 ls0 ws0">.</div><div class="t m0 x5e hb9 y10c4 ff19 fs63 fc0 sc0 ls0 ws0">i-node</div><div class="t m0 x165 hb9 y10c5 ff19 fs63 fc0 sc0 ls0 ws0">number</div><div class="t m0 x169 hba y10c6 ff1a fs64 fc0 sc0 ls0 ws0">..</div><div class="t m0 x1a1 hbb y10c7 ff19 fs65 fc0 sc0 ls0 ws0">2549</div><div class="t m0 x1a5 hbc y10c8 ff1a fs66 fc0 sc0 ls0 ws0">testdir</div><div class="t m0 x148 hbd y10c9 ff18 fs67 fc0 sc0 ls0 ws0">Figure 4.15<span class="_ _5a"> </span><span class="ff19">Sample cylinder group after creating the dir<span class="_ _0"></span>ectory<span class="_"> </span><span class="ff1a">testdir</span></span></div><div class="t m0 x32 hbe y10ca ff19 fs68 fc0 sc0 ls0 ws0">The <span class="_ _2"></span>i-node <span class="_ _3"></span>whose <span class="_ _2"></span>number <span class="_ _3"></span>is <span class="_ _2"></span>2549 <span class="_ _3"></span>has <span class="_ _3"></span>a <span class="_ _2"></span>type <span class="_ _3"></span>ﬁeld <span class="_ _2"></span>of <span class="_ _3"></span>‘<span class="_ _0"></span>‘directory’<span class="_ _1"></span><span class="ls527">’a<span class="_ _4f"></span><span class="ls0">nd <span class="_ _2"></span>a <span class="_ _3"></span>link <span class="_ _2"></span>count <span class="_ _3"></span>equal</span></span></div><div class="t m0 x32 hbe y10cb ff19 fs68 fc0 sc0 ls0 ws0">to <span class="_ _2"></span>2.<span class="_ _16"> </span>Any <span class="_ _3"></span>leaf <span class="_ _2"></span>directory <span class="_ _2"></span>(a <span class="_ _3"></span>directory <span class="_ _2"></span>that <span class="_ _3"></span>does <span class="_ _3"></span>not <span class="_ _2"></span>contain <span class="_ _3"></span>any <span class="_ _3"></span>other <span class="_ _3"></span>directories) <span class="_ _2"></span>always</div><div class="t m0 x32 hbe y10cc ff19 fs68 fc0 sc0 ls0 ws0">has <span class="_ _42"> </span>a <span class="_ _23"> </span>link <span class="_ _42"> </span>count <span class="_ _42"> </span>of <span class="_ _42"> </span>2.<span class="_ _51"> </span>The <span class="_ _42"> </span>value <span class="_ _42"> </span>of <span class="_ _42"> </span>2 <span class="_ _23"> </span>comes <span class="_ _42"> </span>from <span class="_ _42"> </span>the <span class="_ _23"> </span>directory <span class="_ _42"> </span>entry <span class="_ _23"> </span>that <span class="_ _42"> </span>names <span class="_ _42"> </span>the</div><div class="t m0 x32 hbf y10cd ff19 fs68 fc0 sc0 ls0 ws0">directory <span class="_ _42"> </span>(<span class="ff1a">testdir</span><span class="ls528">)a<span class="_ _c"></span><span class="ls0">nd <span class="_ _53"> </span>from <span class="_ _42"> </span>the <span class="_ _42"> </span>entry <span class="_ _42"> </span>for <span class="_ _42"> </span>dot <span class="_ _53"> </span>in <span class="_ _42"> </span>that <span class="_ _53"> </span>directory<span class="_ _4"></span><span class="ls529">.T<span class="_ _52"></span><span class="ls0">he <span class="_ _42"> </span>i-node <span class="_ _53"> </span>whose</span></span></span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
