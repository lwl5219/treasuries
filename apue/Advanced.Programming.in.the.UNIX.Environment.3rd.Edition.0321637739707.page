<div id="pf2c3" class="pf w4 h1f" data-page-no="2c3"><div class="pc pc2c3 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg2c3.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>18.2<span class="_ _2e2"> </span>Overview<span class="_ _1b"> </span><span class="ff18">673</span></div><div class="t m0 x3f h26 y12f ff19 fsf fc0 sc0 ls49 ws0">•T<span class="_ _4d"></span><span class="ls0">here<span class="_"> </span>is<span class="_ _47"> </span>another <span class="_ _3"></span>input <span class="_ _2"></span>limit,<span class="_ _47"> </span><span class="ff1a">MAX_CANON</span><span class="ls133a">,t<span class="_ _4f"></span><span class="ls0">hat <span class="_ _2"></span>we <span class="_ _3"></span>don’t <span class="_ _2"></span>show <span class="_ _3"></span>here. <span class="_ _66"> </span>This<span class="_ _47"> </span>limit <span class="_ _2"></span>is</span></span></span></div><div class="t m0 x15 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">the maximum number of bytes in a canonical input line.</div><div class="t m0 x3f h2a y3eb ff19 fsf fc0 sc0 ls49 ws0">•A<span class="_ _4d"></span><span class="ls0">lthough <span class="_ _23"></span>the <span class="_ _9"></span>size <span class="_ _23"> </span>of <span class="_ _23"></span>the <span class="_ _23"></span>output <span class="_ _23"></span>queue <span class="_ _9"></span>is <span class="_ _23"> </span>ﬁnite, <span class="_ _23"></span>no <span class="_ _23"></span>constants <span class="_ _9"></span>deﬁning <span class="_ _23"> </span>that <span class="_ _23"> </span>size</span></div><div class="t m0 x15 h2a y3ec ff19 fsf fc0 sc0 ls0 ws0">ar<span class="lsf3">ea<span class="_ _43"></span><span class="ls0">ccessible <span class="_ _23"></span>to <span class="_ _23"></span>the <span class="_ _9"></span>program, <span class="_ _23"></span>because <span class="_ _9"></span>when <span class="_ _23"> </span>the <span class="_ _23"></span>output <span class="_ _9"></span>queue <span class="_ _23"> </span>starts <span class="_ _23"></span>to <span class="_ _23"></span>ﬁll <span class="_ _9"></span>up,</span></span></div><div class="t m0 x15 h2a y1ad ff19 fsf fc0 sc0 ls0 ws0">the kernel simply puts the writing process to sleep until r<span class="_ _0"></span>oom is available.</div><div class="t m0 x3f h26 y735 ff19 fsf fc0 sc0 ls49 ws0">•W<span class="_ _4e"></span><span class="ls0">e’ll <span class="_ _42"> </span>see <span class="_ _42"> </span>how <span class="_ _42"> </span>the<span class="_ _44"> </span><span class="ff1a">tcflush<span class="_ _44"> </span></span>ﬂush <span class="_ _42"> </span>function <span class="_ _42"> </span>allows <span class="_ _42"> </span>us <span class="_ _42"> </span>to <span class="_ _42"> </span>ﬂush <span class="_ _42"> </span>either <span class="_ _42"> </span>the <span class="_ _42"> </span>input</span></div><div class="t m0 x15 h26 y736 ff19 fsf fc0 sc0 ls0 ws0">queue <span class="_ _45"> </span>or <span class="_ _45"> </span>the <span class="_ _35"> </span>output <span class="_ _45"> </span>queue.<span class="_ _1a3"> </span>Similarly<span class="_ _6"></span><span class="ls1432">,w<span class="_ _26"></span><span class="ls0">hen <span class="_ _45"> </span>we <span class="_ _35"> </span>describe <span class="_ _45"> </span>the<span class="_ _5a"> </span><span class="ff1a">tcsetattr</span></span></span></div><div class="t m0 x15 h2a y3ed ff19 fsf fc0 sc0 ls0 ws0">function, <span class="_ _e"> </span>we’ll <span class="_"> </span>see <span class="_ _53"> </span>how <span class="_"> </span>we <span class="_ _53"> </span>can <span class="_"> </span>tell <span class="_ _53"> </span>the <span class="_"> </span>system <span class="_ _53"> </span>to <span class="_"> </span>change <span class="_ _53"> </span>the <span class="_"> </span>attributes <span class="_ _53"> </span>of <span class="_"> </span>a</div><div class="t m0 x15 h2a y3ee ff19 fsf fc0 sc0 ls0 ws0">terminal <span class="_ _9"></span>device <span class="_ _23"></span>only <span class="_ _9"></span>after <span class="_ _23"></span>the <span class="_ _9"></span>output <span class="_ _9"></span>queue <span class="_ _23"></span>is <span class="_ _9"></span>empty<span class="_ _6"></span><span class="ls1433">.(<span class="_ _26"></span><span class="ls5f">We <span class="_ _66"> </span>w<span class="_ _23"></span><span class="ls0">ant <span class="_ _9"></span>to <span class="_ _23"></span>do <span class="_ _9"></span>this, <span class="_ _9"></span>for</span></span></span></div><div class="t m0 x15 h2a y1b1 ff19 fsf fc0 sc0 ls0 ws0">example, <span class="_ _2"></span>if <span class="_ _2"></span>we’r<span class="ls1203">ec<span class="_ _4f"></span><span class="ls0">hanging <span class="_ _2"></span>the <span class="_ _2"></span>output <span class="_ _2"></span>attributes.)<span class="_ _61"> </span><span class="ls5f">We <span class="_ _80"> </span>c<span class="_ _9"></span></span>an <span class="_ _2"></span>also <span class="_ _3"></span>tell <span class="_ _2"></span>the <span class="_ _2"></span>system <span class="_ _3"></span>to</span></span></div><div class="t m0 x15 h2a y157 ff19 fsf fc0 sc0 ls0 ws0">discar<span class="ls1434">de<span class="_ _c"></span><span class="ls0">verything <span class="_ _42"> </span>in <span class="_ _42"> </span>the <span class="_ _42"> </span>input <span class="_ _53"> </span>queue <span class="_ _42"> </span>when <span class="_ _42"> </span>changing <span class="_ _42"> </span>the <span class="_ _42"> </span>terminal <span class="_ _42"> </span>attributes.</span></span></div><div class="t m0 x15 h2a y15a ff19 fsf fc0 sc0 ls0 ws0">(W<span class="_ _6"></span><span class="ls1435">ew<span class="_ _b"></span><span class="ls0">ant <span class="_ _9"></span>to <span class="_ _3"></span>do <span class="_ _9"></span>this <span class="_ _3"></span>if <span class="_ _9"></span>we’r<span class="ls1435">ec<span class="_ _b"></span><span class="ls0">hanging <span class="_ _9"></span>the <span class="_ _3"></span>input <span class="_ _9"></span>attributes <span class="_ _3"></span>or <span class="_ _9"></span>changing <span class="_ _3"></span>between</span></span></span></span></div><div class="t m0 x15 h2a y15b ff19 fsf fc0 sc0 ls0 ws0">canonical <span class="_ _9"></span>and <span class="_ _3"></span>noncanonical <span class="_ _9"></span>modes, <span class="_ _9"></span>so <span class="_ _9"></span>that <span class="_ _9"></span>previously <span class="_ _3"></span>entered <span class="_ _3"></span>characters <span class="_ _9"></span>aren’t</div><div class="t m0 x15 h2a y15c ff19 fsf fc0 sc0 ls0 ws0">interpreted in the wr<span class="_ _0"></span>ong mode.)</div><div class="t m0 x3f h2a y4ebd ff19 fsf fc0 sc0 ls0 ws0">Most <span class="_ _3"></span>UNIX <span class="_ _9"></span>systems <span class="_ _3"></span>implement <span class="_ _9"></span>all <span class="_ _9"></span>the <span class="_ _3"></span>canonical <span class="_ _9"></span>processing <span class="_ _3"></span>in <span class="_ _3"></span>a <span class="_ _9"></span>module <span class="_ _9"></span>called <span class="_ _3"></span>the</div><div class="t m0 x32 h2b y4ebe ff1b fsf fc0 sc0 ls0 ws0">terminal <span class="_"> </span>line <span class="_ _e"> </span>discipline<span class="ff19 ls1436">.W<span class="_ _56"></span><span class="ls1437">ec<span class="_ _4a"></span><span class="ls0">an <span class="_"> </span>think <span class="_"> </span>of <span class="_ _e"> </span>this <span class="_"> </span>module <span class="_ _e"> </span>as <span class="_"> </span>a <span class="_ _e"> </span>box <span class="_"> </span>that <span class="_ _e"> </span>sits <span class="_"> </span>between <span class="_ _e"> </span>the</span></span></span></div><div class="t m0 x32 h2a y207 ff19 fsf fc0 sc0 ls0 ws0">kernel’s generic read and write functions and the actual device driver (see Figur<span class="_ _0"></span><span class="ls44">e1<span class="_ _d"></span><span class="ls0">8.2).</span></span></div><div class="t m0 x10f h2d y4ebf ff19 fs10 fc0 sc0 ls21d ws0">re<span class="ls0">ad and write</span></div><div class="t m0 x1df h2d y4ec0 ff19 fs10 fc0 sc0 ls0 ws0">functions</div><div class="t m0 x18c h2e y4ec1 ff19 fs11 fc0 sc0 ls0 ws0">terminal</div><div class="t m0 x1bb h2e y4ec2 ff19 fs11 fc0 sc0 ls0 ws0">line discipline</div><div class="t m0 x18c h2f y4ec3 ff19 fs12 fc0 sc0 ls0 ws0">terminal</div><div class="t m0 x1f2 h2f y4ec4 ff19 fs12 fc0 sc0 ls0 ws0">device driver</div><div class="t m0 x87 h34 y4ec5 ff19 fs17 fc0 sc0 ls0 ws0">user process</div><div class="t m0 x1f2 h36 y4ec6 ff19 fs19 fc0 sc0 ls0 ws0">actual device</div><div class="t m0 x100 h37 y4ec7 ff19 fs1a fc0 sc0 ls0 ws0">kernel</div><div class="t m0 x63 h37 y4ec8 ff18 fs1a fc0 sc0 ls0 ws0">Figure 18.2<span class="_ _5a"> </span><span class="ff19 ls9bb">Te<span class="_ _9"></span><span class="ls0">rminal line discipline</span></span></div><div class="t m0 x32 h8e y4ec9 ff19 fs47 fc0 sc0 ls0 ws0">By <span class="_ _e"> </span>isolating <span class="_ _e"> </span>the <span class="_ _e"> </span>canonical <span class="_ _e"> </span>processing <span class="_ _53"> </span>in <span class="_ _e"> </span>a <span class="_ _e"> </span>separate <span class="_ _e"> </span>module, <span class="_ _e"> </span>all <span class="_ _e"> </span>terminal <span class="_"> </span>drivers <span class="_ _53"> </span>can</div><div class="t m0 x32 h8e y4eca ff19 fs47 fc0 sc0 ls0 ws0">support <span class="_ _2"></span>canonical <span class="_ _3"></span>processing <span class="_ _3"></span>consistently<span class="_ _4"></span><span class="ls1438">.W<span class="_ _7"></span><span class="ls0">e’ll <span class="_ _3"></span>return <span class="_ _2"></span>to <span class="_ _3"></span>this <span class="_ _3"></span>pictur<span class="ls1439">ew<span class="_ _8"></span><span class="ls0">hen <span class="_ _3"></span>we <span class="_ _3"></span>discuss</span></span></span></span></div><div class="t m0 x32 h8e y4ecb ff19 fs47 fc0 sc0 ls0 ws0">pseudo terminals in Chapter 19.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
