<div id="pf300" class="pf w4 h1f" data-page-no="300"><div class="pc pc300 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg300.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">734<span class="_ _1b"> </span><span class="ff19">Pseudo <span class="_"> </span>T<span class="_ _6"></span>erminals <span class="_ _23a"> </span>Chapter<span class="_ _4b"> </span>19</span></div><div class="t m0 x3f h57 y5454 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">who</span></div><div class="t m0 x3f h57 y5455 ff1a fs2d fc0 sc0 ls0 ws0">sar <span class="_"> </span>console <span class="_"> </span>May<span class="_"> </span>19 16:47</div><div class="t m0 x3f h57 y5456 ff1a fs2d fc0 sc0 ls0 ws0">sar <span class="_"> </span>ttys000 <span class="_"> </span>May<span class="_"> </span>19 16:47</div><div class="t m0 x3f h57 y5457 ff1a fs2d fc0 sc0 ls0 ws0">sar <span class="_"> </span>ttys001 <span class="_"> </span>May<span class="_"> </span>19 16:48</div><div class="t m0 x3f h57 y5458 ff1a fs2d fc0 sc0 ls0 ws0">sar <span class="_"> </span>ttys002 <span class="_"> </span>May<span class="_"> </span>19 16:48</div><div class="t m0 x3f h57 y5459 ff1a fs2d fc0 sc0 ls0 ws0">sar <span class="_"> </span>ttys003 <span class="_"> </span>May<span class="_"> </span>19 16:49</div><div class="t m0 x3f h57 y545a ff1a fs2d fc0 sc0 ls0 ws0">sar <span class="_"> </span>ttys004 <span class="_"> </span>May<span class="_"> </span>19 16:49<span class="_ _16e"> </span><span class="ff1b">ttys004 is the highest PTY currently in use</span></div><div class="t m0 x3f h57 y545b ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">pty ttyname<span class="_ _af"> </span><span class="ff1b">run program in Figur<span class="ls110">e1<span class="_ _d"></span><span class="ls0">8.16 from PTY</span></span></span></span></div><div class="t m0 x3f h57 y545c ff1a fs2d fc0 sc0 ls0 ws0">fd 0: /dev/ttys005<span class="_ _1a0"> </span><span class="ff1b">ttys005 is the next available PTY</span></div><div class="t m0 x3f h57 y545d ff1a fs2d fc0 sc0 ls0 ws0">fd 1: /dev/ttys005</div><div class="t m0 x3f h57 y545e ff1a fs2d fc0 sc0 ls0 ws0">fd 2: /dev/ttys005</div><div class="t m0 x35 h26 y545f ff1f fsf fc0 sc0 ls0 ws0">utmp<span class="_ _66"> </span><span class="ff16">File</span></div><div class="t m0 x32 h26 y5460 ff19 fsf fc0 sc0 ls0 ws0">In <span class="_ _3"></span>Section <span class="_ _3"></span>6.8, <span class="_ _3"></span>we <span class="_ _3"></span>described <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">utmp<span class="_ _45"> </span></span>ﬁle <span class="_ _2"></span>that <span class="_ _3"></span>records <span class="_ _2"></span>all <span class="_ _3"></span>users <span class="_ _3"></span>currently <span class="_ _3"></span>logged <span class="_ _3"></span>in <span class="_ _3"></span>to <span class="_ _3"></span>a</div><div class="t m0 x32 h2a y5461 ff19 fsf fc0 sc0 ls0 ws0">UNIX <span class="_ _2"></span>system.<span class="_ _61"> </span>The <span class="_ _2"></span>question <span class="_ _2"></span>is <span class="_ _2"></span>whether <span class="_ _2"></span>a <span class="_ _3"></span>user <span class="_ _2"></span>running <span class="_ _2"></span>a <span class="_ _2"></span>program on <span class="_ _2"></span>a <span class="_ _3"></span>pseudo <span class="_ _2"></span>terminal</div><div class="t m0 x32 h26 y5462 ff19 fsf fc0 sc0 ls0 ws0">is <span class="_ _53"> </span>considered <span class="_ _42"> </span>logged <span class="_ _53"> </span>in.<span class="_ _65"> </span>In <span class="_ _53"> </span>the <span class="_ _53"> </span>case <span class="_ _42"> </span>of <span class="_ _53"> </span>remote <span class="_ _53"> </span>logins, <span class="_ _53"> </span>with<span class="_ _44"> </span><span class="ff1a">telnetd<span class="_ _4b"> </span></span>and<span class="_ _44"> </span><span class="ff1a">rlogind</span>,</div><div class="t m0 x32 h26 y5463 ff19 fsf fc0 sc0 ls0 ws0">obviously an entry should be <span class="_ _2"></span>made in the<span class="_"> </span><span class="ff1a">utmp<span class="_ _66"> </span></span>ﬁle for <span class="_ _2"></span>the user logged in on <span class="_ _2"></span>the pseudo</div><div class="t m0 x32 h2a y5464 ff19 fsf fc0 sc0 ls0 ws0">terminal. <span class="_"> </span>There<span class="_"> </span>is<span class="_ _66"> </span>little <span class="_ _2"></span>agreement, however<span class="_ _1"></span><span class="ls6d1">,w<span class="_ _4f"></span><span class="ls0">hether <span class="_ _2"></span>users <span class="_ _2"></span>running a <span class="_ _2"></span>shell <span class="_ _2"></span>on a <span class="_ _2"></span>pseudo</span></span></div><div class="t m0 x32 h26 y5465 ff19 fsf fc0 sc0 ls0 ws0">terminal <span class="_ _e"> </span>from <span class="_ _e"> </span>a <span class="_"> </span>window <span class="_ _53"> </span>system <span class="_"> </span>or <span class="_ _e"> </span>from <span class="_ _e"> </span>a <span class="_"> </span>pr<span class="_ _1"></span>ogram, <span class="_"> </span>such <span class="_ _e"> </span>as<span class="_ _59"> </span><span class="ff1a">script</span><span class="lsfe">,s<span class="_ _55"></span><span class="ls0">hould <span class="_ _e"> </span>have</span></span></div><div class="t m0 x32 h26 y5466 ff19 fsf fc0 sc0 ls0 ws0">entries <span class="_ _42"> </span>made <span class="_ _53"> </span>in <span class="_ _42"> </span>the<span class="_ _44"> </span><span class="ff1a">utmp<span class="_ _44"> </span></span>ﬁle. <span class="_ _44"> </span>Some<span class="_ _44"> </span>systems <span class="_ _53"> </span>recor<span class="_ _0"></span><span class="ls219">dt<span class="_ _c"></span><span class="ls0">hese; <span class="_ _53"> </span>others <span class="_ _42"> </span>don’t.<span class="_ _54"> </span>If <span class="_ _53"> </span>a <span class="_ _42"> </span>system</span></span></div><div class="t m0 x32 h26 y5467 ff19 fsf fc0 sc0 ls0 ws0">doesn’t <span class="_ _3"></span>recor<span class="ls15be">dt<span class="_ _b"></span><span class="ls0">hese <span class="_ _3"></span>entries <span class="_ _9"></span>in <span class="_ _3"></span>the<span class="_ _45"> </span><span class="ff1a">utmp<span class="_ _47"> </span></span>ﬁle, <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">who</span></span></span></div><div class="t m0 x81 h2a y5468 ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 x1ba h2a y5467 ff19 fsf fc0 sc0 ls0 ws0">1</div><div class="t m0 x1af h2a y5468 ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 x181 h2a y5467 ff19 fsf fc0 sc0 ls0 ws0">program <span class="_ _3"></span>normally <span class="_ _3"></span>won’t <span class="_ _9"></span>show</div><div class="t m0 x32 h2a y5469 ff19 fsf fc0 sc0 ls0 ws0">the corresponding pseudo terminals as being used.</div><div class="t m0 x3f h26 y546a ff19 fsf fc0 sc0 ls0 ws0">Unless <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">utmp<span class="_ _47"> </span></span>ﬁle <span class="_ _3"></span>has <span class="_ _3"></span>other-write <span class="_ _2"></span>permission <span class="_ _3"></span>enabled <span class="_ _9"></span>(which <span class="_ _2"></span>is <span class="_ _3"></span>considered <span class="_ _3"></span>to <span class="_ _3"></span>be</div><div class="t m0 x32 h2a y546b ff19 fsf fc0 sc0 ls87 ws0">as<span class="_ _b"></span><span class="ls0">ecurity <span class="_ _9"></span>hole), <span class="_ _9"></span>random <span class="_ _3"></span>programs <span class="_ _3"></span>that <span class="_ _9"></span>use <span class="_ _9"></span>pseudo <span class="_ _3"></span>terminals <span class="_ _9"></span>won’t <span class="_ _9"></span>be <span class="_ _3"></span>able <span class="_ _9"></span>to <span class="_ _9"></span>write <span class="_ _9"></span>to</span></div><div class="t m0 x32 h2a y546c ff19 fsf fc0 sc0 ls0 ws0">this ﬁle.</div><div class="t m0 x35 h27 y546d ff16 fsf fc0 sc0 ls0 ws0">Job Control Interaction</div><div class="t m0 x32 h26 y546e ff19 fsf fc0 sc0 ls0 ws0">If we run a job-contr<span class="_ _0"></span>ol shell under<span class="_"> </span><span class="ff1a">pty</span>,<span class="_"> </span>it<span class="_"> </span>works normally<span class="_ _4"></span><span class="ls86">.F<span class="_ _4a"></span><span class="ls0">or example,</span></span></div><div class="t m0 x3f h57 y546f ff1a fs2d fc0 sc0 ls0 ws0">pty ksh</div><div class="t m0 x32 h26 y5470 ff19 fsf fc0 sc0 ls4e ws0">ru<span class="ls0">ns <span class="_ _3"></span>the <span class="_ _3"></span>Korn <span class="_ _2"></span>shell <span class="_ _3"></span>under<span class="_ _47"> </span><span class="ff1a">pty</span><span class="ls1123">.W<span class="_ _7"></span><span class="ls1124">ec<span class="_ _4f"></span><span class="ls0">an <span class="_ _3"></span>run <span class="_ _2"></span>programs <span class="_ _2"></span>under <span class="_ _3"></span>this <span class="_ _3"></span>new <span class="_ _3"></span>shell <span class="_ _3"></span>and <span class="_ _2"></span>use <span class="_ _3"></span>job</span></span></span></span></div><div class="t m0 x32 h2a y5471 ff19 fsf fc0 sc0 ls0 ws0">control <span class="_ _3"></span>just <span class="_ _23"></span>as <span class="_ _9"></span>we <span class="_ _9"></span>do <span class="_ _23"></span>with <span class="_ _9"></span>our <span class="_ _9"></span>login <span class="_ _9"></span>shell.<span class="_ _51"> </span>But <span class="_ _9"></span>if <span class="_ _9"></span>we <span class="_ _9"></span>run <span class="_ _9"></span>an <span class="_ _23"></span>interactive <span class="_ _9"></span>program <span class="_ _9"></span>other</div><div class="t m0 x32 h26 y5472 ff19 fsf fc0 sc0 ls0 ws0">than a job-control shell under<span class="_"> </span><span class="ff1a">pty</span>,<span class="_"> </span>as<span class="_"> </span>in</div><div class="t m0 x3f h57 y5473 ff1a fs2d fc0 sc0 ls0 ws0">pty cat</div><div class="t m0 x32 h2a y5474 ff19 fsf fc0 sc0 ls0 ws0">everything <span class="_ _42"> </span>is <span class="_ _42"> </span>ﬁne <span class="_ _42"> </span>until <span class="_ _42"> </span>we <span class="_ _42"> </span>type <span class="_ _42"> </span>the <span class="_ _42"> </span>job-control <span class="_ _23"> </span>suspend <span class="_ _42"> </span>character<span class="_ _1"></span><span class="ls15bf">.A<span class="_ _52"></span><span class="lsc37">tt<span class="_ _43"></span><span class="ls0">hat <span class="_ _42"> </span>point, <span class="_ _42"> </span>the</span></span></span></div><div class="t m0 x32 h26 y5475 ff19 fsf fc0 sc0 ls0 ws0">job-control <span class="_ _2"></span>character <span class="_ _3"></span>is <span class="_ _2"></span>echoed <span class="_ _3"></span>as<span class="_ _47"> </span><span class="ff1a">ˆZ<span class="_ _47"> </span></span>and <span class="_ _3"></span>is <span class="_ _3"></span>ignored. <span class="_ _66"> </span>Under<span class="_ _47"> </span>earlier <span class="_ _3"></span>BSD</div><div class="t m0 x1d7 h2a y5476 ff19 fsf fc0 sc0 ls0 ws0">-</div><div class="t m0 x1c3 h2a y5475 ff19 fsf fc0 sc0 ls0 ws0">based <span class="_ _2"></span>systems,</div><div class="t m0 x32 h26 y5477 ff19 fsf fc0 sc0 ls0 ws0">the<span class="_ _47"> </span><span class="ff1a">cat<span class="_ _45"> </span></span>pr<span class="_ _0"></span>ocess <span class="_ _3"></span>terminates, <span class="_ _9"></span>the<span class="_ _47"> </span><span class="ff1a">pty<span class="_ _45"> </span></span>pr<span class="_ _0"></span>ocess <span class="_ _3"></span>terminates, <span class="_ _9"></span>and <span class="_ _3"></span>we’r<span class="ls299">eb<span class="_ _b"></span><span class="ls0">ack <span class="_ _9"></span>to <span class="_ _3"></span>our <span class="_ _9"></span>original</span></span></div><div class="t m0 x32 h2a y5478 ff19 fsf fc0 sc0 ls0 ws0">shell. <span class="_ _46"> </span>T<span class="_ _6"></span><span class="ls8c">ou<span class="_ _5b"></span><span class="ls0">nderstand <span class="_ _47"> </span>what’s <span class="_"> </span>going <span class="_ _66"> </span>on <span class="_ _66"> </span>here, <span class="_"> </span>we <span class="_ _47"> </span>need <span class="_"> </span>to <span class="_ _66"> </span>examine <span class="_ _66"> </span>all <span class="_ _66"> </span>the <span class="_ _47"> </span>processes</span></span></div><div class="t m0 x32 h2a y5479 ff19 fsf fc0 sc0 ls0 ws0">involved, their process groups, and sessions.<span class="_ _46"> </span>Figur<span class="ls6d7">e1<span class="_ _4f"></span><span class="ls0">9.13 <span class="_ _2"></span>shows the arrangement <span class="_ _2"></span>when</span></span></div><div class="t m0 x32 h26 y547a ff1a fsf fc0 sc0 ls0 ws0">pty <span class="_ _4f"></span>cat<span class="_ _66"> </span><span class="ff19">is running.</span></div><div class="t m0 x3f h2a y547b ff19 fsf fc0 sc0 ls0 ws0">When <span class="_ _66"> </span>we <span class="_ _47"> </span>type <span class="_ _47"> </span>the <span class="_ _47"> </span>suspend <span class="_ _66"> </span>character <span class="_ _47"> </span>(Control</div><div class="t m0 x109 h2a y547c ff19 fsf fc0 sc0 ls0 ws0">-</div><div class="t m0 x212 h2a y547b ff19 fsf fc0 sc0 ls0 ws0">Z), <span class="_ _66"> </span>it <span class="_ _47"> </span>is <span class="_ _47"> </span>recognized <span class="_ _66"> </span>by <span class="_ _47"> </span>the <span class="_ _47"> </span>line</div><div class="t m0 x32 h26 y547d ff19 fsf fc0 sc0 ls0 ws0">discipline <span class="_ _23"> </span>module <span class="_ _42"> </span>beneath <span class="_ _42"> </span>the<span class="_ _35"> </span><span class="ff1a">cat<span class="_ _44"> </span></span>process, <span class="_ _23"></span>since<span class="_ _35"> </span><span class="ff1a">pty<span class="_ _44"> </span></span>puts <span class="_ _23"> </span>the <span class="_ _42"> </span>terminal <span class="_ _42"> </span>(beneath <span class="_ _23"> </span>the</div><div class="t m0 x32 h26 y547e ff1a fsf fc0 sc0 ls0 ws0">pty<span class="_ _4b"> </span><span class="ff19">parent) <span class="_ _e"> </span>into <span class="_"> </span>raw <span class="_ _53"> </span>mode.<span class="_ _48"> </span>But <span class="_"> </span>the <span class="_ _53"> </span>kernel <span class="_"> </span>won’t <span class="_ _53"> </span>stop <span class="_"> </span>the<span class="_ _44"> </span></span>cat<span class="_ _59"> </span><span class="ff19">process, <span class="_ _e"> </span>because <span class="_ _e"> </span>it</span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
