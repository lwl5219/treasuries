<div id="pf175" class="pf w4 h1f" data-page-no="175"><div class="pc pc175 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg175.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h7a ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>10.10<span class="_ _110"> </span><span class="ff1a">alarm<span class="_ _4b"> </span></span>and<span class="_ _4b"> </span><span class="ff1a">pause<span class="_ _4b"> </span></span>Functions<span class="_ _1b"> </span><span class="ff18">339</span></div><div class="t m0 x32 h26 y12f ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _2"></span>only <span class="_ _2"></span>time<span class="_ _47"> </span><span class="ff1a">pause<span class="_ _47"> </span></span><span class="ls45">re</span>turns <span class="_ _3"></span>is <span class="_ _2"></span>if <span class="_ _2"></span>a <span class="_ _3"></span>signal <span class="_ _2"></span>handler <span class="_ _3"></span>is <span class="_ _2"></span>executed <span class="_ _2"></span>and <span class="_ _3"></span>that <span class="_ _2"></span>handler <span class="_ _3"></span>returns.</div><div class="t m0 x32 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">In that case,<span class="_"> </span><span class="ff1a">pause<span class="_ _80"> </span></span><span class="ls45">re<span class="_ _2"></span></span>turns<span class="_"> </span><span class="ff20">−</span><span class="ls44">1w<span class="_ _d"></span><span class="ls0">ith<span class="_"> </span><span class="ff1a">errno<span class="_ _66"> </span></span>set to<span class="_"> </span><span class="ff1a">EINTR</span>.</span></span></div><div class="t m0 x35 h27 y132 ff16 fsf fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h26 y1fc ff19 fsf fc0 sc0 ls0 ws0">Using<span class="_ _47"> </span><span class="ff1a">alarm<span class="_ _47"> </span></span>and<span class="_ _47"> </span><span class="ff1a">pause</span>,<span class="_ _47"> </span>we<span class="_ _47"> </span>can <span class="_ _9"></span>put <span class="_ _2"></span>a <span class="_ _3"></span>process <span class="_ _3"></span>to <span class="_ _3"></span>sleep <span class="_ _3"></span>for <span class="_ _3"></span>a <span class="_ _3"></span>speciﬁed <span class="_ _3"></span>amount <span class="_ _3"></span>of <span class="_ _3"></span>time.</div><div class="t m0 x32 h26 y1fd ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _47"> </span><span class="ff1a">sleep1<span class="_ _47"> </span></span>function <span class="_ _2"></span>in <span class="_ _3"></span>Figur<span class="lsc6f">e1<span class="_ _8"></span><span class="ls0">0.7 <span class="_ _2"></span>appears <span class="_ _3"></span>to <span class="_ _3"></span>do <span class="_ _2"></span>this <span class="_ _3"></span>(but <span class="_ _3"></span>it <span class="_ _3"></span>has <span class="_ _2"></span>problems, <span class="_ _2"></span>as <span class="_ _3"></span>we <span class="_ _3"></span>shall</span></span></div><div class="t m0 x32 h2a y406 ff19 fsf fc0 sc0 ls0 ws0">see shortly).</div><div class="t m0 x32 h4e y2b63 ff1a fs28 fc0 sc0 ls0 ws0">#include <span class="_ _68"> </span>&lt;signal.h&gt;</div><div class="t m0 x32 h4e y2b64 ff1a fs28 fc0 sc0 ls0 ws0">#include <span class="_ _68"> </span>&lt;unistd.h&gt;</div><div class="t m0 x32 h4e y2b65 ff1a fs28 fc0 sc0 ls0 ws0">static void</div><div class="t m0 x32 h4e y2b66 ff1a fs28 fc0 sc0 ls0 ws0">sig_alrm(int signo)</div><div class="t m0 x32 h4e y2b67 ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y2b68 ff1a fs28 fc0 sc0 ls0 ws0">/* nothing to do, just return to wake up the pause */</div><div class="t m0 x32 h4e y2b69 ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h4e y2b6a ff1a fs28 fc0 sc0 ls0 ws0">unsigned int</div><div class="t m0 x32 h4e y2b6b ff1a fs28 fc0 sc0 ls0 ws0">sleep1(unsigned int seconds)</div><div class="t m0 x32 h4e y2b6c ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y2b6d ff1a fs28 fc0 sc0 ls0 ws0">if (signal(SIGALRM, sig_alrm) == SIG_ERR)</div><div class="t m0 x9d h4e y2b6e ff1a fs28 fc0 sc0 ls0 ws0">return(seconds);</div><div class="t m0 x8a h4e y2b6f ff1a fs28 fc0 sc0 ls0 ws0">alarm(seconds); <span class="_ _15"> </span>/*<span class="_"> </span>start the timer */</div><div class="t m0 x8a h4e y2b70 ff1a fs28 fc0 sc0 ls0 ws0">pause(); <span class="_ _bd"> </span>/*<span class="_"> </span>next caught signal wakes us up */</div><div class="t m0 x8a h4e y2b71 ff1a fs28 fc0 sc0 ls0 ws0">return(alarm(0)); <span class="_ _d9"> </span>/*<span class="_"> </span>turn off timer, return unslept time */</div><div class="t m0 x32 h4e y2b72 ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x4 h4f y2b73 ff18 fs11 fc0 sc0 ls0 ws0">Figure 10.7<span class="_ _5a"> </span><span class="ff19">Simple, incomplete implementation of<span class="_"> </span><span class="ff1a">sleep</span></span></div><div class="t m0 x32 h54 y2b74 ff19 fs2c fc0 sc0 ls0 ws0">This function looks <span class="_ _2"></span>like the<span class="_ _66"> </span><span class="ff1a">sleep<span class="_ _66"> </span></span>function, <span class="_ _2"></span>which we <span class="_ _2"></span>describe in Section <span class="_ _2"></span>10.19, but <span class="_ _2"></span>this</div><div class="t m0 x32 h55 y2b75 ff19 fs2c fc0 sc0 ls0 ws0">simple implementation has three pr<span class="_ _0"></span>oblems.</div><div class="t m0 x3f h55 y2b76 ff19 fs2c fc0 sc0 ls0 ws0">1. <span class="_ _51"> </span>If<span class="_ _44"> </span>the <span class="_ _42"> </span>caller <span class="_ _42"> </span>already <span class="_ _42"> </span>has <span class="_ _42"> </span>an <span class="_ _53"> </span>alarm <span class="_ _42"> </span>set, <span class="_ _42"> </span>that <span class="_ _53"> </span>alarm <span class="_ _42"> </span>is <span class="_ _42"> </span>erased <span class="_ _53"> </span>by <span class="_ _42"> </span>the <span class="_ _42"> </span>ﬁrst <span class="_ _53"> </span>call <span class="_ _42"> </span>to</div><div class="t m0 x41 h54 y2b77 ff1a fs2c fc0 sc0 ls0 ws0">alarm<span class="ff19 lsc70">.W<span class="_ _52"></span><span class="lsc71">ec<span class="_ _b"></span><span class="ls0">an <span class="_ _9"></span>correct <span class="_ _3"></span>this <span class="_ _9"></span>by <span class="_ _9"></span>looking <span class="_ _9"></span>at<span class="_ _47"> </span><span class="ff1a">alarm</span>’s <span class="_ _9"></span>return <span class="_ _9"></span>value.<span class="_ _16"> </span>If <span class="_ _9"></span>the <span class="_ _9"></span>number</span></span></span></div><div class="t m0 x41 h55 y2b78 ff19 fs2c fc0 sc0 ls0 ws0">of <span class="_ _23"></span>seconds <span class="_ _9"></span>until <span class="_ _23"></span>some <span class="_ _23"></span>pr<span class="_ _0"></span>eviously <span class="_ _23"></span>set <span class="_ _9"></span>alarm <span class="_ _23"> </span>is <span class="_ _23"></span>less <span class="_ _9"></span>than <span class="_ _23"> </span>the <span class="_ _23"></span>argument, <span class="_ _9"></span>then <span class="_ _23"></span>we</div><div class="t m0 x41 h55 y2b79 ff19 fs2c fc0 sc0 ls0 ws0">should <span class="_ _42"> </span>wait <span class="_ _42"> </span>only <span class="_ _42"> </span>until <span class="_ _23"> </span>the <span class="_ _42"> </span>existing <span class="_ _42"> </span>alarm <span class="_ _42"> </span>expires. <span class="_ _35"> </span>If<span class="_ _44"> </span>the <span class="_ _42"> </span>previously <span class="_ _23"> </span>set <span class="_ _42"> </span>alarm</div><div class="t m0 x41 h55 y2b7a ff19 fs2c fc0 sc0 ls0 ws0">will <span class="_ _3"></span>go <span class="_ _9"></span>of<span class="lsc72">fa<span class="_ _b"></span><span class="ls0">fter <span class="_ _3"></span>ours, <span class="_ _9"></span>then <span class="_ _3"></span>befor<span class="lsc72">er<span class="_ _b"></span><span class="ls0">eturning <span class="_ _3"></span>we <span class="_ _9"></span>should <span class="_ _3"></span>reset <span class="_ _3"></span>this <span class="_ _3"></span>alarm <span class="_ _9"></span>to <span class="_ _3"></span>occur</span></span></span></span></div><div class="t m0 x41 h55 y2b7b ff19 fs2c fc0 sc0 ls0 ws0">at its designated time in the future.</div><div class="t m0 x3f h54 y2b7c ff19 fs2c fc0 sc0 ls0 ws0">2. <span class="_ _51"> </span>W<span class="_ _6"></span><span class="lsc73">eh<span class="_ _8"></span><span class="ls0">ave <span class="_ _3"></span>modiﬁed <span class="_ _9"></span>the <span class="_ _9"></span>disposition <span class="_ _3"></span>for<span class="_ _45"> </span><span class="ff1a">SIGALRM</span><span class="lsc74">.I<span class="_ _62"></span><span class="lsc75">fw<span class="_ _b"></span><span class="ls0">e’r<span class="lsc75">ew<span class="_ _8"></span><span class="ls0">riting <span class="_ _3"></span>a <span class="_ _9"></span>function <span class="_ _3"></span>for</span></span></span></span></span></span></span></div><div class="t m0 x41 h55 y2b7d ff19 fs2c fc0 sc0 ls0 ws0">others <span class="_ _23"></span>to <span class="_ _23"></span>call, <span class="_ _9"></span>we <span class="_ _23"> </span>should <span class="_ _23"> </span>save <span class="_ _23"> </span>the <span class="_ _23"> </span>disposition <span class="_ _23"></span>when <span class="_ _23"></span>our <span class="_ _23"></span>function <span class="_ _23"></span>is <span class="_ _23"></span>called <span class="_ _9"></span>and</div><div class="t m0 x41 h55 y2b7e ff19 fs2c fc0 sc0 ls150 ws0">re<span class="ls0">store<span class="_ _66"> </span>it<span class="_ _47"> </span>when <span class="_ _2"></span>we’r<span class="lsc76">ed<span class="_ _4f"></span><span class="ls0">one. <span class="_ _66"> </span>W<span class="_ _6"></span><span class="lsc76">ec<span class="_ _4f"></span><span class="ls0">an <span class="_ _3"></span>correct this <span class="_ _3"></span>by <span class="_ _2"></span>saving <span class="_ _2"></span>the <span class="_ _3"></span>return <span class="_ _2"></span>value <span class="_ _2"></span>from</span></span></span></span></span></div><div class="t m0 x41 h54 y2b7f ff1a fs2c fc0 sc0 ls0 ws0">signal<span class="_ _80"> </span><span class="ff19">and resetting the disposition befor<span class="ls142">eo<span class="_ _4f"></span><span class="ls0">ur function returns.</span></span></span></div><div class="t m0 x3f h54 y2b80 ff19 fs2c fc0 sc0 ls0 ws0">3. <span class="_ _51"> </span>There<span class="_ _47"> </span>is<span class="_ _45"> </span>a<span class="_ _47"> </span>race <span class="_ _3"></span>condition <span class="_ _9"></span>between <span class="_ _9"></span>the <span class="_ _3"></span>ﬁrst <span class="_ _9"></span>call <span class="_ _3"></span>to<span class="_ _45"> </span><span class="ff1a">alarm<span class="_ _47"> </span></span>and <span class="_ _9"></span>the <span class="_ _3"></span>call <span class="_ _9"></span>to<span class="_ _47"> </span><span class="ff1a">pause</span>.</div><div class="t m0 x41 h55 y2b81 ff19 fs2c fc0 sc0 ls0 ws0">On <span class="_ _3"></span>a <span class="_ _3"></span>busy <span class="_ _3"></span>system, <span class="_ _3"></span>it’s <span class="_ _3"></span>possible <span class="_ _3"></span>for <span class="_ _3"></span>the <span class="_ _3"></span>alarm <span class="_ _3"></span>to <span class="_ _3"></span>go <span class="_ _3"></span>of<span class="lsc77">fa<span class="_ _8"></span><span class="ls0">nd <span class="_ _3"></span>the <span class="_ _3"></span>signal <span class="_ _3"></span>handler <span class="_ _3"></span>to</span></span></div><div class="t m0 x41 h54 y2b82 ff19 fs2c fc0 sc0 ls0 ws0">be <span class="_ _2"></span>called <span class="_ _3"></span>before<span class="_ _47"> </span>we<span class="_ _47"> </span>call<span class="_ _47"> </span><span class="ff1a">pause</span><span class="lsc78">.I<span class="_ _1d"></span><span class="lsa9c">ft<span class="_ _8"></span><span class="ls0">hat <span class="_ _3"></span>happens, <span class="_ _3"></span>the <span class="_ _3"></span>caller <span class="_ _3"></span>is <span class="_ _3"></span>suspended <span class="_ _3"></span>forever</span></span></span></div><div class="t m0 x41 h54 y2b83 ff19 fs2c fc0 sc0 ls0 ws0">in the call to<span class="_"> </span><span class="ff1a">pause<span class="_ _80"> </span></span>(assuming that some other signal isn’t caught).</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
