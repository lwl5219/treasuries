<div id="pfb3" class="pf w4 h1f" data-page-no="b3"><div class="pc pcb3 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bgb3.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>5.4<span class="_ _1ca"> </span>Buffering<span class="_ _1b"> </span><span class="ff18">145</span></div><div class="t m0 x35 h53 y12f ff16 fs2b fc0 sc0 ls0 ws0">5.3 <span class="_ _68"> </span>Standar<span class="ls1c3">dI<span class="_ _64"></span><span class="ls0">nput, <span class="_"> </span>Standar<span class="ls1c3">dO<span class="_ _52"></span><span class="ls0">utput, <span class="_"> </span>and <span class="_"> </span>Standar<span class="_ _0"></span><span class="ls1c3">dE<span class="_ _52"></span><span class="ls0">rror</span></span></span></span></span></span></div><div class="t m0 x32 h2a y4de ff19 fsf fc0 sc0 ls0 ws0">Three <span class="_ _3"></span>streams <span class="_ _3"></span>ar<span class="ls63e">ep<span class="_ _b"></span><span class="ls45">re<span class="_ _2"></span><span class="ls0">deﬁned <span class="_ _9"></span>and <span class="_ _9"></span>automatically <span class="_ _9"></span>available <span class="_ _9"></span>to <span class="_ _9"></span>a <span class="_ _9"></span>process: <span class="_ _3"></span>standar<span class="ls63f">di<span class="_ _b"></span><span class="ls0">nput,</span></span></span></span></span></div><div class="t m0 x32 h2a y6d0 ff19 fsf fc0 sc0 ls0 ws0">standar<span class="ls1f6">do<span class="_ _43"></span><span class="ls0">utput, <span class="_ _23"></span>and <span class="_ _23"> </span>standar<span class="ls1f6">de<span class="_ _43"></span><span class="ls0">rror<span class="_ _6"></span><span class="ls143">.T<span class="_ _7"></span><span class="ls0">hese <span class="_ _23"> </span>streams <span class="_ _42"> </span>refer <span class="_ _23"></span>to <span class="_ _23"> </span>the <span class="_ _42"> </span>same <span class="_ _42"> </span>ﬁles <span class="_ _23"> </span>as <span class="_ _42"> </span>the <span class="_ _42"> </span>ﬁle</span></span></span></span></span></span></div><div class="t m0 x32 h26 y6d1 ff19 fsf fc0 sc0 ls0 ws0">descriptors<span class="_ _54"> </span><span class="ff1a">STDIN_FILENO</span>,<span class="_ _54"> </span><span class="ff1a">STDOUT_FILENO</span><span class="ls640">,a<span class="_ _52"></span><span class="ls0">nd<span class="_ _65"> </span><span class="ff1a">STDERR_FILENO</span><span class="ls640">,r<span class="_ _52"></span><span class="ls0">espectively<span class="_ _4"></span>,</span></span></span></span></div><div class="t m0 x32 h2a y6d2 ff19 fsf fc0 sc0 ls0 ws0">which we mentioned in Section 3.2.</div><div class="t m0 x3f h2a y6d3 ff19 fsf fc0 sc0 ls0 ws0">These <span class="_ _45"> </span>three <span class="_ _35"> </span>standar<span class="_ _0"></span><span class="ls641">dI<span class="_ _26"></span><span class="ls0">/O <span class="_ _45"> </span>streams <span class="_ _35"> </span>ar<span class="_ _0"></span><span class="ls641">er<span class="_ _7"></span><span class="ls0">eferenced <span class="_ _45"> </span>through <span class="_ _45"> </span>the <span class="_ _35"> </span>predeﬁned <span class="_ _45"> </span>ﬁle</span></span></span></span></div><div class="t m0 x32 h26 y6d4 ff19 fsf fc0 sc0 ls0 ws0">pointers<span class="_ _66"> </span><span class="ff1a">stdin</span>,<span class="_ _47"> </span><span class="ff1a">stdout</span><span class="ls59c">,a<span class="_ _4f"></span><span class="ls0">nd<span class="_ _66"> </span><span class="ff1a">stderr</span><span class="ls642">.T<span class="_ _5b"></span><span class="ls0">he <span class="_ _2"></span>ﬁle <span class="_ _3"></span>pointers <span class="_ _2"></span>ar<span class="ls643">ed<span class="_ _8"></span><span class="ls0">eﬁned <span class="_ _3"></span>in <span class="_ _2"></span>the<span class="_ _66"> </span><span class="ff1a">&lt;stdio.h&gt;</span></span></span></span></span></span></span></div><div class="t m0 x32 h2a y6d5 ff19 fsf fc0 sc0 ls0 ws0">header<span class="_ _6"></span>.</div><div class="t m0 x35 h53 y49b ff16 fs2b fc0 sc0 ls0 ws0">5.4 <span class="_ _68"> </span>Buffering</div><div class="t m0 x32 h2a y148f ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _9"></span>goal <span class="_ _3"></span>of <span class="_ _9"></span>the <span class="_ _9"></span>buffering <span class="_ _9"></span>provided <span class="_ _3"></span>by <span class="_ _9"></span>the <span class="_ _9"></span>standar<span class="ls243">dI<span class="_ _b"></span><span class="ls0">/O <span class="_ _3"></span>library <span class="_ _9"></span>is <span class="_ _9"></span>to <span class="_ _9"></span>use <span class="_ _9"></span>the <span class="_ _9"></span>minimum</span></span></div><div class="t m0 x32 h26 y1490 ff19 fsf fc0 sc0 ls0 ws0">number of<span class="_ _66"> </span><span class="ff1a">read<span class="_ _66"> </span></span>and<span class="_ _66"> </span><span class="ff1a">write<span class="_ _66"> </span></span>calls. <span class="_ _66"> </span>(Recall<span class="_ _66"> </span>Figur<span class="ls24c">e3<span class="_ _4f"></span><span class="ls0">.6, <span class="_ _2"></span>which showed <span class="_ _2"></span>the <span class="_ _2"></span>amount of <span class="_ _2"></span>CPU</span></span></div><div class="t m0 x32 h2a y1491 ff19 fsf fc0 sc0 ls0 ws0">time <span class="_ _9"></span>requir<span class="_ _0"></span>ed <span class="_ _9"></span>to <span class="_ _9"></span>perform <span class="_ _9"></span>I/O <span class="_ _9"></span>using <span class="_ _23"></span>various <span class="_ _9"></span>buffer <span class="_ _3"></span>sizes.)<span class="_ _5a"> </span>Also, <span class="_ _23"></span>this <span class="_ _9"></span>library <span class="_ _9"></span>tries <span class="_ _9"></span>to <span class="_ _9"></span>do</div><div class="t m0 x32 h2a y1492 ff19 fsf fc0 sc0 ls0 ws0">its buffering automatically for each I/O stream, obviating the need for the application to</div><div class="t m0 x32 h2a y1493 ff19 fsf fc0 sc0 ls0 ws0">worry <span class="_ _47"> </span>about <span class="_ _45"> </span>it.<span class="_ _50"> </span>Unfortunately<span class="_ _6"></span><span class="ls644">,t<span class="_ _62"></span><span class="ls0">he <span class="_ _45"> </span>single <span class="_ _47"> </span>aspect <span class="_ _45"> </span>of <span class="_ _47"> </span>the <span class="_ _47"> </span>standar<span class="ls644">dI<span class="_ _62"></span><span class="ls0">/O <span class="_ _45"> </span>library <span class="_ _47"> </span>that</span></span></span></span></div><div class="t m0 x32 h2a y1494 ff19 fsf fc0 sc0 ls0 ws0">generates the most confusion is its buffering.</div><div class="t m0 x3f h2a y1495 ff19 fsf fc0 sc0 ls0 ws0">Three types of buf<span class="_ _0"></span>fering ar<span class="_ _0"></span><span class="ls44">ep<span class="_ _d"></span><span class="ls45">ro<span class="_ _2"></span><span class="ls0">vided:</span></span></span></div><div class="t m0 x3f h2a y1496 ff19 fsf fc0 sc0 ls0 ws0">1. <span class="_ _51"> </span>Fully<span class="_ _59"> </span>buffered. <span class="_ _4b"> </span>In<span class="_ _46"> </span>this <span class="_"> </span>case, <span class="_"> </span>actual <span class="_ _e"> </span>I/O <span class="_"> </span>takes <span class="_"> </span>place <span class="_"> </span>when <span class="_ _e"> </span>the <span class="_"> </span>standar<span class="ls645">dI<span class="_ _4a"></span><span class="ls0">/O</span></span></div><div class="t m0 x41 h2a y1497 ff19 fsf fc0 sc0 ls0 ws0">buffer <span class="_ _47"> </span>is <span class="_ _45"> </span>ﬁlled.<span class="_ _1a3"> </span>Files <span class="_ _45"> </span>residing <span class="_ _47"> </span>on <span class="_ _45"> </span>disk <span class="_ _45"> </span>ar<span class="ls646">en<span class="_ _26"></span><span class="ls0">ormally <span class="_ _45"> </span>fully <span class="_ _45"> </span>buffer<span class="_ _0"></span>ed <span class="_ _45"> </span>by <span class="_ _45"> </span>the</span></span></div><div class="t m0 x41 h2a y1498 ff19 fsf fc0 sc0 ls0 ws0">standar<span class="ls647">dI<span class="_ _4f"></span><span class="ls0">/O library<span class="_ _6"></span><span class="ls648">.T<span class="_ _4a"></span><span class="ls0">he buffer used is usually obtained by one of the standard</span></span></span></span></div><div class="t m0 x41 h26 y1499 ff19 fsf fc0 sc0 ls0 ws0">I/O <span class="_ _3"></span>functions <span class="_ _9"></span>calling<span class="_ _47"> </span><span class="ff1a">malloc<span class="_ _45"> </span></span>(Section <span class="_ _3"></span>7.8) <span class="_ _9"></span>the <span class="_ _3"></span>ﬁrst <span class="_ _9"></span>time <span class="_ _3"></span>I/O <span class="_ _9"></span>is <span class="_ _3"></span>performed <span class="_ _9"></span>on <span class="_ _3"></span>a</div><div class="t m0 x41 h2a y149a ff19 fsf fc0 sc0 ls0 ws0">stream.</div><div class="t m0 x41 h2b y149b ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _9"></span>term<span class="_ _35"> </span><span class="ff1b">ﬂush<span class="_ _45"> </span></span>describes <span class="_ _9"></span>the <span class="_ _23"></span>writing <span class="_ _9"></span>of <span class="_ _23"></span>a <span class="_ _9"></span>standar<span class="ls266">dI<span class="_ _b"></span><span class="ls0">/O <span class="_ _3"></span>buffer<span class="_ _6"></span><span class="ls649">.A<span class="_ _5"></span><span class="ls0">buffer <span class="_ _9"></span>can <span class="_ _9"></span>be</span></span></span></span></div><div class="t m0 x41 h2a y149c ff19 fsf fc0 sc0 ls0 ws0">ﬂushed <span class="_ _3"></span>automatically <span class="_ _3"></span>by <span class="_ _3"></span>the <span class="_ _3"></span>standar<span class="ls64a">dI<span class="_ _8"></span><span class="ls0">/O <span class="_ _3"></span>routines, <span class="_ _2"></span>such <span class="_ _3"></span>as <span class="_ _3"></span>when <span class="_ _9"></span>a <span class="_ _3"></span>buffer <span class="_ _2"></span>ﬁlls,</span></span></div><div class="t m0 x41 h26 y149d ff19 fsf fc0 sc0 ls0 ws0">or <span class="_ _53"> </span>we <span class="_ _e"> </span>can <span class="_ _53"> </span>call <span class="_ _e"> </span>the <span class="_ _e"> </span>function<span class="_ _4b"> </span><span class="ff1a">fflush<span class="_ _4b"> </span></span>to <span class="_ _53"> </span>ﬂush <span class="_ _e"> </span>a <span class="_ _53"> </span>stream. <span class="_ _4b"> </span>Unfortunately<span class="_ _4"></span>,<span class="_ _4b"> </span>in<span class="_ _4b"> </span>the</div><div class="t m0 x41 h2b y149e ff19 fsf fc0 sc0 ls0 ws0">UNIX <span class="_ _9"></span>environment,<span class="_ _45"> </span><span class="ff1b">ﬂush<span class="_ _45"> </span></span>means <span class="_ _9"></span>two <span class="_ _9"></span>different <span class="_ _3"></span>things.<span class="_ _51"> </span>In <span class="_ _9"></span>terms <span class="_ _9"></span>of <span class="_ _9"></span>the <span class="_ _9"></span>standard</div><div class="t m0 x41 h2a y149f ff19 fsf fc0 sc0 ls0 ws0">I/O library<span class="_ _6"></span><span class="ls64b">,i<span class="_ _4f"></span><span class="ls64c">tm<span class="_ _d"></span><span class="ls0">eans <span class="_ _2"></span>writing out <span class="_ _2"></span>the contents <span class="_ _2"></span>of a <span class="_ _2"></span>buffer<span class="_ _6"></span><span class="ls64c">,w<span class="_ _d"></span><span class="ls0">hich may <span class="_ _2"></span>be partially</span></span></span></span></span></div><div class="t m0 x41 h26 y14a0 ff19 fsf fc0 sc0 ls0 ws0">ﬁlled. <span class="_ _5a"> </span>In<span class="_ _51"> </span>terms <span class="_ _45"> </span>of <span class="_ _35"> </span>the <span class="_ _45"> </span>terminal <span class="_ _35"> </span>driver<span class="_ _6"></span><span class="ls64d">,s<span class="_ _26"></span><span class="ls0">uch <span class="_ _35"> </span>as <span class="_ _45"> </span>the<span class="_ _51"> </span><span class="ff1a">tcflush<span class="_"> </span></span>function <span class="_ _45"> </span>in</span></span></div><div class="t m0 x41 h2a y14a1 ff19 fsf fc0 sc0 ls0 ws0">Chapter 18, it means to discar<span class="ls44">dt<span class="_ _4f"></span><span class="ls0">he data that’s already stored in a buf<span class="_ _0"></span>fer<span class="_ _6"></span>.</span></span></div><div class="t m0 x3f h2a y14a2 ff19 fsf fc0 sc0 ls0 ws0">2. <span class="_ _51"> </span>Line<span class="_ _59"> </span>buffered. <span class="_ _59"> </span>In<span class="_ _59"> </span>this <span class="_"> </span>case, <span class="_"> </span>the <span class="_"> </span>standar<span class="ls64e">dI<span class="_ _5b"></span><span class="ls0">/O <span class="_"> </span>library <span class="_"> </span>performs <span class="_"> </span>I/O <span class="_"> </span>when <span class="_"> </span>a</span></span></div><div class="t m0 x41 h2a y14a3 ff19 fsf fc0 sc0 ls0 ws0">newline character <span class="_ _2"></span>is <span class="_ _2"></span>encountered <span class="_ _2"></span>on input <span class="_ _2"></span>or <span class="_ _2"></span>output.<span class="_ _61"> </span>This <span class="_ _2"></span>allows <span class="_ _2"></span>us <span class="_ _2"></span>to <span class="_ _2"></span>output <span class="_ _2"></span>a</div><div class="t m0 x41 h26 y14a4 ff19 fsf fc0 sc0 ls0 ws0">single character <span class="_ _2"></span>at a <span class="_ _2"></span>time <span class="_ _2"></span>(with the <span class="_ _2"></span>standar<span class="ls64f">dI<span class="_ _4f"></span><span class="ls0">/O<span class="_"> </span><span class="ff1a">fputc<span class="_ _66"> </span></span>function), <span class="_ _2"></span>knowing <span class="_ _2"></span>that</span></span></div><div class="t m0 x41 h2a y14a5 ff19 fsf fc0 sc0 ls0 ws0">actual I/O <span class="_ _2"></span>will <span class="_ _2"></span>take <span class="_ _2"></span>place <span class="_ _2"></span>only <span class="_ _2"></span>when <span class="_ _2"></span>we <span class="_ _2"></span>ﬁnish writing <span class="_ _2"></span>each <span class="_ _2"></span>line.<span class="_ _61"> </span>Line <span class="_ _2"></span>buffering</div><div class="t m0 x41 h2a y14a6 ff19 fsf fc0 sc0 ls0 ws0">is <span class="_ _9"></span>typically <span class="_ _9"></span>used <span class="_ _9"></span>on <span class="_ _9"></span>a <span class="_ _9"></span>stream <span class="_ _9"></span>when <span class="_ _9"></span>it <span class="_ _9"></span>refers <span class="_ _3"></span>to <span class="_ _9"></span>a <span class="_ _9"></span>terminal<span class="_ _9"></span><span class="ls9d">—s<span class="_ _1"></span><span class="ls0">tandar<span class="ls2a1">di<span class="_ _b"></span><span class="ls0">nput <span class="_ _3"></span>and</span></span></span></span></div><div class="t m0 x41 h2a y14a7 ff19 fsf fc0 sc0 ls0 ws0">standar<span class="ls44">do<span class="_ _4f"></span><span class="ls0">utput, for example.</span></span></div><div class="t m0 x41 h2a y14a8 ff19 fsf fc0 sc0 ls0 ws0">Line <span class="_ _53"> </span>buffering <span class="_ _53"> </span>comes <span class="_ _e"> </span>with <span class="_ _e"> </span>two <span class="_ _e"> </span>caveats.<span class="_ _65"> </span>First, <span class="_ _e"> </span>the <span class="_ _e"> </span>size <span class="_ _e"> </span>of <span class="_ _53"> </span>the <span class="_ _e"> </span>buffer <span class="_ _53"> </span>that <span class="_ _e"> </span>the</div><div class="t m0 x41 h2a y14a9 ff19 fsf fc0 sc0 ls0 ws0">standar<span class="lsf8">dI<span class="_ _8"></span><span class="ls0">/O <span class="_ _2"></span>library <span class="_ _3"></span>uses <span class="_ _2"></span>to <span class="_ _3"></span>collect <span class="_ _2"></span>each <span class="_ _3"></span>line <span class="_ _2"></span>is <span class="_ _3"></span>ﬁxed, <span class="_ _2"></span>so <span class="_ _3"></span>I/O <span class="_ _2"></span>might <span class="_ _2"></span>take <span class="_ _3"></span>place <span class="_ _2"></span>if</span></span></div><div class="t m0 x41 h2a y14aa ff19 fsf fc0 sc0 ls0 ws0">we <span class="_ _44"> </span>ﬁll <span class="_ _35"> </span>this <span class="_ _44"> </span>buffer <span class="_ _35"> </span>befor<span class="ls650">ew<span class="_ _52"></span><span class="ls0">riting <span class="_ _44"> </span>a <span class="_ _44"> </span>newline.<span class="_ _98"> </span>Second, <span class="_ _44"> </span>whenever <span class="_ _44"> </span>input <span class="_ _35"> </span>is</span></span></div><div class="t m0 x41 h2a y14ab ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">quested through the standar<span class="ls482">dI<span class="_ _4f"></span><span class="ls0">/O library from either (a) an unbuffered str<span class="_ _1"></span>eam</span></span></span></div><a class="l" href="#pfd" data-dest-detail='[13,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892409px;bottom:1236.288916px;width:357.094810px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfd" data-dest-detail='[13,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892634px;bottom:949.008941px;width:89.207695px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
