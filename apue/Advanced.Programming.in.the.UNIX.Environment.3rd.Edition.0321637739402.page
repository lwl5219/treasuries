<div id="pf192" class="pf w4 h1f" data-page-no="192"><div class="pc pc192 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg192.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">368<span class="_ _1b"> </span><span class="ff19">Signals <span class="_ _24b"> </span>Chapter<span class="_ _21"> </span>10</span></div><div class="t m0 x32 h57 y362 ff1a fs2d fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h57 y2f1c ff1a fs2d fc0 sc0 ls0 ws0">static void</div><div class="t m0 x32 h57 y2f1d ff1a fs2d fc0 sc0 ls0 ws0">sig_int(int signo)</div><div class="t m0 x32 h57 y2f1e ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y2f1f ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;caught SIGINT\n&quot;);</div><div class="t m0 x32 h57 y2f20 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h57 y2f21 ff1a fs2d fc0 sc0 ls0 ws0">static void</div><div class="t m0 x32 h57 y2f22 ff1a fs2d fc0 sc0 ls0 ws0">sig_chld(int signo)</div><div class="t m0 x32 h57 y2f23 ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y2f24 ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;caught SIGCHLD\n&quot;);</div><div class="t m0 x32 h57 y2f25 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h57 y2f26 ff1a fs2d fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h57 y2f27 ff1a fs2d fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 x32 h57 y2f28 ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y2f29 ff1a fs2d fc0 sc0 ls0 ws0">if (signal(SIGINT, sig_int) == SIG_ERR)</div><div class="t m0 x9d h57 y2f2a ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;signal(SIGINT) error&quot;);</div><div class="t m0 x8a h57 y2f2b ff1a fs2d fc0 sc0 ls0 ws0">if (signal(SIGCHLD, sig_chld) == SIG_ERR)</div><div class="t m0 x9d h57 y2f2c ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;signal(SIGCHLD) error&quot;);</div><div class="t m0 x8a h57 y2f2d ff1a fs2d fc0 sc0 ls0 ws0">if (system(&quot;/bin/ed&quot;) &lt; 0)</div><div class="t m0 x9d h57 y2f2e ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;system() error&quot;);</div><div class="t m0 x8a h57 y2f2f ff1a fs2d fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h57 y2f30 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 xab h5e y2f31 ff18 fs10 fc0 sc0 ls0 ws0">Figure 10.26<span class="_ _5a"> </span><span class="ff19">Using<span class="_"> </span><span class="ff1a">system<span class="_ _e"> </span></span>to invoke the<span class="_"> </span><span class="ff1a">ed<span class="_ _e"> </span></span>editor</span></div><div class="t m0 x32 h4d y2f32 ff19 fs26 fc0 sc0 ls0 ws0">parent <span class="_ _2"></span>should <span class="_ _3"></span>be <span class="_ _3"></span>blocked <span class="_ _3"></span>while <span class="_ _3"></span>the<span class="_ _45"> </span><span class="ff1a">system<span class="_ _47"> </span></span>function <span class="_ _2"></span>is <span class="_ _9"></span>executing.<span class="_ _61"> </span>Indeed, <span class="_ _9"></span>this <span class="_ _2"></span>is <span class="_ _9"></span>what</div><div class="t m0 x32 h4d y2f33 ff19 fs26 fc0 sc0 ls0 ws0">POSIX.1 <span class="_ _9"></span>speciﬁes.<span class="_ _5a"> </span>Otherwise, <span class="_ _23"></span>when <span class="_ _9"></span>the <span class="_ _9"></span>child <span class="_ _23"></span>cr<span class="_ _0"></span>eated <span class="_ _9"></span>by<span class="_ _45"> </span><span class="ff1a">system<span class="_ _45"> </span></span>terminates, <span class="_ _23"></span>it <span class="_ _9"></span>would</div><div class="t m0 x32 h4d y2f34 ff19 fs26 fc0 sc0 ls0 ws0">fool <span class="_ _42"> </span>the <span class="_ _23"> </span>caller <span class="_ _42"> </span>of<span class="_ _44"> </span><span class="ff1a">system<span class="_ _35"> </span></span>into <span class="_ _42"> </span>thinking <span class="_ _42"> </span>that <span class="_ _42"> </span>one <span class="_ _42"> </span>of <span class="_ _42"> </span>its <span class="_ _23"> </span>own <span class="_ _42"> </span>children <span class="_ _42"> </span>terminated.<span class="_ _51"> </span>The</div><div class="t m0 x32 h4d y2f35 ff19 fs26 fc0 sc0 ls0 ws0">caller <span class="_ _42"> </span>would <span class="_ _42"> </span>then <span class="_ _42"> </span>use <span class="_ _42"> </span>one <span class="_ _53"> </span>of <span class="_ _42"> </span>the<span class="_ _44"> </span><span class="ff1a">wait<span class="_ _44"> </span></span>functions <span class="_ _42"> </span>to <span class="_ _42"> </span>get <span class="_ _42"> </span>the <span class="_ _42"> </span>termination <span class="_ _53"> </span>status <span class="_ _42"> </span>of <span class="_ _42"> </span>the</div><div class="t m0 x32 h4d y2f36 ff19 fs26 fc0 sc0 ls0 ws0">child, <span class="_ _53"> </span>thereby <span class="_ _42"> </span>preventing <span class="_ _53"> </span>the<span class="_ _4b"> </span><span class="ff1a">system<span class="_ _44"> </span></span>function <span class="_ _e"> </span>from <span class="_ _42"> </span>being <span class="_ _53"> </span>able <span class="_ _e"> </span>to <span class="_ _53"> </span>obtain <span class="_ _53"> </span>the <span class="_ _e"> </span>child’s</div><div class="t m0 x32 h49 y2f37 ff19 fs26 fc0 sc0 ls0 ws0">termination status for its return value.</div><div class="t m0 x3f h49 y2f38 ff19 fs26 fc0 sc0 ls0 ws0">If we run the <span class="_ _2"></span>program again, this time <span class="_ _2"></span>sending the <span class="_ _2"></span>editor an <span class="_ _2"></span>interrupt signal, we <span class="_ _2"></span>get</div><div class="t m0 x3f h4e y2f39 ff1a fs28 fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">./a.out</span></div><div class="t m0 x3f h4e y2f3a ff1f fs28 fc0 sc0 ls0 ws0">a<span class="_ _1e9"> </span><span class="ff1b">append text to the editor<span class="_ _2"></span><span class="lsd10">’s <span class="_ _9"></span>b<span class="_ _3"></span></span>uffer</span></div><div class="t m0 x3f h4e y2f3b ff1f fs28 fc0 sc0 ls0 ws0">hello, world</div><div class="t m0 x3f h4e y2f3c ff1f fs28 fc0 sc0 ls0 ws0">.<span class="_ _1e9"> </span><span class="ff1b">period on a line by itself stops append mode</span></div><div class="t m0 x3f h4e y2f3d ff1f fs28 fc0 sc0 ls0 ws0">1,$p<span class="_ _1e7"> </span><span class="ff1b">print ﬁrst through last lines to see what’<span class="_ _1"></span><span class="ls396">st<span class="_ _5"></span><span class="ls0">here</span></span></span></div><div class="t m0 x3f h4e y2f3e ff1a fs28 fc0 sc0 ls0 ws0">hello, world</div><div class="t m0 x3f h4e y2f3f ff1f fs28 fc0 sc0 ls1b6 ws0">wt<span class="_ _1d"></span><span class="ls0">emp.foo<span class="_ _74"> </span><span class="ff1b">write the buffer to a ﬁle</span></span></div><div class="t m0 x3f h4e y2f40 ff1a fs28 fc0 sc0 ls0 ws0">13<span class="_ _cb"> </span><span class="ff1b">editor says it wrote 13 bytes</span></div><div class="t m0 x3f h4e y2f41 ff1f fs28 fc0 sc0 ls0 ws0">ˆC<span class="_ _cb"> </span><span class="ff1b">type the interrupt character</span></div><div class="t m0 x3f h4e y2f42 ff1a fs28 fc0 sc0 ls0 ws0">?<span class="_ _1e9"> </span><span class="ff1b">editor catches signal, prints question mark</span></div><div class="t m0 x3f h4e y2f43 ff1a fs28 fc0 sc0 ls0 ws0">caught SIGINT<span class="_ _b7"> </span><span class="ff1b">and so does the parent process</span></div><div class="t m0 x3f h4e y2f44 ff1f fs28 fc0 sc0 ls0 ws0">q<span class="_ _1e9"> </span><span class="ff1b">leave editor</span></div><div class="t m0 x3f h4e y2f45 ff1a fs28 fc0 sc0 ls0 ws0">caught SIGCHLD</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
