<div id="pf21d" class="pf w4 h1f" data-page-no="21d"><div class="pc pc21d w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg21d.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>14.4<span class="_ _2a5"> </span>I/O <span class="_"> </span>Multiplexing<span class="_ _1b"> </span><span class="ff18">507</span></div><div class="t m0 x32 h26 y12f ff19 fsf fc0 sc0 ls65 ws0">Wi<span class="_ _3"></span><span class="ls0">th<span class="_ _46"> </span><span class="ff1a">poll</span><span class="ls296">,i<span class="_ _4a"></span><span class="ls0">nstead <span class="_"> </span>of <span class="_"> </span>building <span class="_"> </span>a <span class="_"> </span>set <span class="_"> </span>of <span class="_"> </span>descriptors <span class="_"> </span>for <span class="_"> </span>each <span class="_ _66"> </span>condition <span class="_"> </span>(readability<span class="_ _4"></span>,</span></span></span></div><div class="t m0 x32 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">writability<span class="_ _4"></span><span class="ls107c">,a<span class="_ _55"></span><span class="ls0">nd <span class="_"> </span>exception <span class="_ _53"> </span>condition) <span class="_"> </span>as <span class="_ _e"> </span>we <span class="_ _e"> </span>did <span class="_"> </span>with<span class="_ _4b"> </span><span class="ff1a">select</span>,<span class="_ _59"> </span>we<span class="_ _4b"> </span>build <span class="_"> </span>an <span class="_ _e"> </span>array <span class="_ _e"> </span>of</span></span></div><div class="t m0 x32 h26 y131 ff1a fsf fc0 sc0 ls0 ws0">pollfd<span class="_ _44"> </span><span class="ff19">structures, <span class="_ _42"> </span>with <span class="_ _53"> </span>each <span class="_ _53"> </span>array <span class="_ _53"> </span>element <span class="_ _53"> </span>specifying <span class="_ _42"> </span>a <span class="_ _53"> </span>descriptor <span class="_ _53"> </span>number <span class="_ _53"> </span>and <span class="_ _53"> </span>the</span></div><div class="t m0 x32 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">conditions that we’r<span class="ls44">ei<span class="_ _4f"></span><span class="ls0">nterested in for that descriptor:</span></span></div><div class="t m0 x3f h57 y3e1e ff1a fs2d fc0 sc0 ls0 ws0">struct pollfd {</div><div class="t m0 xf4 h57 y3e1f ff1a fs2d fc0 sc0 ls0 ws0">int <span class="_ _68"> </span>fd;<span class="_ _90"> </span>/* file descriptor to check, or &lt;0 to ignore */</div><div class="t m0 xf4 h57 y3e20 ff1a fs2d fc0 sc0 ls0 ws0">short <span class="_"> </span>events;<span class="_ _68"> </span>/* events of interest on fd */</div><div class="t m0 xf4 h57 y3e21 ff1a fs2d fc0 sc0 ls0 ws0">short <span class="_"> </span>revents; <span class="_"> </span>/*<span class="_"> </span>events that occurred on fd */</div><div class="t m0 x3f h57 y3e22 ff1a fs2d fc0 sc0 ls0 ws0">};</div><div class="t m0 x32 h2b y3e23 ff19 fsf fc0 sc0 ls0 ws0">The number of elements in the<span class="_"> </span><span class="ff1b">fdarray<span class="_"> </span></span>array is speciﬁed by<span class="_"> </span><span class="ff1b">nfds</span>.</div><div class="t m0 x76 h76 y3e24 ff19 fs2a fc0 sc0 ls0 ws0">Historically<span class="_ _6"></span><span class="ls107d">,t<span class="_ _c"></span><span class="ls0">her<span class="ls107d">eh<span class="_ _c"></span><span class="ls0">ave <span class="_ _80"> </span>been <span class="_ _e"> </span>differences <span class="_"> </span>in <span class="_ _80"> </span>how <span class="_ _80"> </span>the<span class="_ _44"> </span><span class="ff1b">nfds<span class="_ _4b"> </span></span>parameter <span class="_ _e"> </span>was <span class="_ _80"> </span>declared. <span class="_ _44"> </span>SVR3</span></span></span></span></div><div class="t m0 x76 h52 y3e25 ff19 fs2a fc0 sc0 ls0 ws0">speciﬁed <span class="_ _3"></span>the <span class="_ _3"></span>number <span class="_ _3"></span>of <span class="_ _3"></span>elements <span class="_ _9"></span>in <span class="_ _3"></span>the <span class="_ _3"></span>array <span class="_ _3"></span>as <span class="_ _3"></span>an<span class="_ _66"> </span><span class="ff1a">unsigned <span class="_ _5"></span>long<span class="ff19 ls107e">,w<span class="_ _5"></span><span class="ls0">hich <span class="_ _2"></span>seems <span class="_ _9"></span>excessive.</span></span></span></div><div class="t m0 x76 h52 y3e26 ff19 fs2a fc0 sc0 ls0 ws0">In the SVR4 manual <span class="_ _2"></span>[A<span class="_ _1"></span>T&amp;T 1990d], the <span class="_ _2"></span>prototype for<span class="_"> </span><span class="ff1a">poll<span class="_ _e"> </span></span>showed the data <span class="_ _2"></span>type of the second</div><div class="t m0 x76 h52 y3e27 ff19 fs2a fc0 sc0 ls0 ws0">argument as<span class="_"> </span><span class="ff1a">size_t</span><span class="ls107f">.(<span class="_ _43"></span><span class="ls0">Recall the primitive system data types from Figur<span class="lsa3a">e2<span class="_ _5"></span><span class="ls0">.21.) <span class="_"> </span>But<span class="_"> </span>the actual</span></span></span></span></div><div class="t m0 x76 h52 y3e28 ff19 fs2a fc0 sc0 ls0 ws0">prototype <span class="_ _2"></span>in <span class="_ _3"></span>the<span class="_ _66"> </span><span class="ff1a">&lt;poll.h&gt;<span class="_ _66"> </span></span>header <span class="_ _3"></span>still <span class="_ _3"></span>showed <span class="_ _9"></span>the <span class="_ _3"></span>second <span class="_ _3"></span>argument <span class="_ _3"></span>as <span class="_ _3"></span>an<span class="_ _66"> </span><span class="ff1a">unsigned <span class="_ _5"></span>long<span class="ff19">.</span></span></div><div class="t m0 x76 h52 y3e29 ff19 fs2a fc0 sc0 ls0 ws0">The <span class="_ _9"></span>Single <span class="_ _9"></span>UNIX <span class="_ _9"></span>Speciﬁcation <span class="_ _9"></span>deﬁnes <span class="_ _9"> </span>the <span class="_ _23"> </span>new <span class="_ _9"></span>type<span class="_ _66"> </span><span class="ff1a">nfds_t<span class="_ _47"> </span></span>to <span class="_ _9"></span>allow <span class="_ _9"></span>the <span class="_ _9"> </span>implementation <span class="_ _9"> </span>to</div><div class="t m0 x76 h51 y3e2a ff19 fs2a fc0 sc0 ls0 ws0">select the appropriate type and hide the details from applications.<span class="_ _44"> </span>Note that this type has to be</div><div class="t m0 x76 h51 y3e2b ff19 fs2a fc0 sc0 ls0 ws0">large <span class="_ _2"></span>enough <span class="_ _2"></span>to <span class="_ _3"></span>hold <span class="_ _2"></span>an <span class="_ _3"></span>integer<span class="_ _1"></span><span class="ls1080">,s<span class="_ _5"></span><span class="ls0">ince <span class="_ _2"></span>the <span class="_ _3"></span>return <span class="_ _2"></span>value <span class="_ _2"></span>represents <span class="_ _2"></span>the <span class="_ _2"></span>number <span class="_ _3"></span>of <span class="_ _2"></span>entries <span class="_ _3"></span>in <span class="_ _3"></span>the</span></span></div><div class="t m0 x76 h51 y3e2c ff19 fs2a fc0 sc0 ls0 ws0">array with satisﬁed events.</div><div class="t m0 x76 h52 y3e2d ff19 fs2a fc0 sc0 ls0 ws0">The <span class="_ _2"></span>SVID <span class="_ _2"></span>corresponding <span class="_ _2"></span>to <span class="_ _3"></span>SVR4 <span class="_ _2"></span>[A<span class="_ _1"></span>T&amp;T <span class="_ _3"></span>1989] <span class="_ _2"></span>showed <span class="_ _3"></span>the <span class="_ _2"></span>ﬁrst <span class="_ _2"></span>argument <span class="_ _2"></span>to<span class="_ _80"> </span><span class="ff1a">poll<span class="_ _80"> </span></span>as<span class="_ _66"> </span><span class="ff1a">struct</span></div><div class="t m0 x76 h52 y3e2e ff1a fs2a fc0 sc0 ls0 ws0">pollfd<span class="_ _16"> </span><span class="ff1b">fdarray</span>[]<span class="ff19 ls1081">,w<span class="_ _4f"></span><span class="ls0">hereas <span class="_ _9"></span>the <span class="_ _9"></span>SVR4 <span class="_ _9"> </span>manual <span class="_ _23"> </span>page <span class="_ _9"></span>[A<span class="_ _1"></span>T&amp;T <span class="_ _9"></span>1990d] <span class="_ _9"></span>showed <span class="_ _9"> </span>this <span class="_ _23"> </span>argument <span class="_ _3"></span>as</span></span></div><div class="t m0 x76 h52 y3e2f ff1a fs2a fc0 sc0 ls0 ws0">struct <span class="_ _3"></span>pollfd <span class="_ _9"> </span>*<span class="ff1b">fdarray<span class="ff19 ls1082">.I<span class="_ _55"></span><span class="ls1083">nt<span class="_ _4f"></span><span class="ls0">he <span class="_ _9"></span>C <span class="_ _9"></span>language, <span class="_ _9"></span>both <span class="_ _3"></span>declarations <span class="_ _9"></span>ar<span class="ls1083">ee<span class="_ _4f"></span><span class="ls0">quivalent. <span class="_ _66"> </span>W<span class="_ _1"></span><span class="ls1083">eu<span class="_ _4f"></span><span class="ls0">se <span class="_ _9"></span>the</span></span></span></span></span></span></span></span></div><div class="t m0 x76 h52 y3e30 ff19 fs2a fc0 sc0 ls0 ws0">ﬁrst <span class="_ _2"></span>declaration <span class="_ _2"></span>to <span class="_ _3"></span>reiterate <span class="_ _2"></span>that<span class="_ _80"> </span><span class="ff1a">fdarray<span class="_ _80"> </span></span>points <span class="_ _2"></span>to <span class="_ _3"></span>an <span class="_ _2"></span>array <span class="_ _3"></span>of <span class="_ _2"></span>structures <span class="_ _2"></span>and <span class="_ _2"></span>not <span class="_ _2"></span>a <span class="_ _3"></span>pointer <span class="_ _2"></span>to</div><div class="t m0 x76 h51 y3e31 ff19 fs2a fc0 sc0 lse9 ws0">as<span class="_ _84"></span><span class="ls0">ingle structure.</span></div><div class="t m0 x3f h2a y3e32 ff19 fsf fc0 sc0 ls5f ws0">To <span class="_ _53"> </span>t<span class="_ _9"></span><span class="ls0">ell the kernel which <span class="_ _2"></span>events we’r<span class="ls653">ei<span class="_ _4f"></span><span class="ls0">nterested in for each descriptor<span class="_ _1"></span>,<span class="_"> </span>we<span class="_"> </span>have to set</span></span></span></div><div class="t m0 x32 h26 y3e33 ff19 fsf fc0 sc0 ls0 ws0">the<span class="_ _66"> </span><span class="ff1a">events<span class="_ _47"> </span></span>member <span class="_ _2"></span>of <span class="_ _2"></span>each <span class="_ _2"></span>array <span class="_ _3"></span>element <span class="_ _2"></span>to <span class="_ _2"></span>one <span class="_ _2"></span>or <span class="_ _3"></span>more<span class="_"> </span>of<span class="_ _47"> </span>the <span class="_ _2"></span>values <span class="_ _2"></span>in <span class="_ _2"></span>Figur<span class="ls52c">e1<span class="_ _4f"></span><span class="ls0">4.17.</span></span></div><div class="t m0 x32 h26 y3e34 ff19 fsf fc0 sc0 ls0 ws0">On <span class="_ _9"></span>return, <span class="_ _3"></span>the<span class="_ _45"> </span><span class="ff1a">revents<span class="_ _45"> </span></span>member <span class="_ _9"></span>is <span class="_ _23"></span>set <span class="_ _9"></span>by <span class="_ _9"></span>the <span class="_ _9"></span>kernel, <span class="_ _9"></span>thereby <span class="_ _3"></span>specifying <span class="_ _23"></span>which <span class="_ _9"></span>events</div><div class="t m0 x32 h26 y3e35 ff19 fsf fc0 sc0 ls0 ws0">have <span class="_ _45"> </span>occurred <span class="_ _35"> </span>for <span class="_ _45"> </span>each <span class="_ _35"> </span>descriptor<span class="_ _6"></span><span class="ls1084">.(<span class="_ _95"></span><span class="ls0">Note <span class="_ _45"> </span>that<span class="_ _51"> </span><span class="ff1a">poll<span class="_"> </span></span>doesn’t <span class="_ _35"> </span>change <span class="_ _45"> </span>the<span class="_ _51"> </span><span class="ff1a">events</span></span></span></div><div class="t m0 x32 h26 y3e36 ff19 fsf fc0 sc0 ls0 ws0">member<span class="_ _6"></span><span class="ls1085">.T<span class="_ _26"></span><span class="ls0">his <span class="_ _23"> </span>behavior <span class="_ _23"> </span>differs <span class="_ _9"></span>from <span class="_ _23"></span>that <span class="_ _23"></span>of<span class="_ _35"> </span><span class="ff1a">select</span><span class="ls1086">,w<span class="_ _43"></span><span class="ls0">hich <span class="_ _23"> </span>modiﬁes <span class="_ _23"> </span>its <span class="_ _23"> </span>arguments <span class="_ _9"></span>to</span></span></span></span></div><div class="t m0 x32 h2a y3e37 ff19 fsf fc0 sc0 ls0 ws0">indicate what is ready<span class="_ _4"></span>.)</div><div class="t m0 x1d h2d y3e38 ff19 fs10 fc0 sc0 ls0 ws0">Input to<span class="_ _7f"> </span>Result from</div><div class="t m0 x16e h5e y3e39 ff1a fs10 fc0 sc0 ls0 ws0">events<span class="ff19">?<span class="_ _5e"> </span></span>revents<span class="ff19">?</span></div><div class="t m0 x3f h2d y3e3a ff19 fs10 fc0 sc0 ls0 ws0">Name<span class="_ _15b"> </span>Description</div><div class="t m0 x2c h4f y3e3b ff1a fs11 fc0 sc0 ls0 ws0">POLLIN<span class="_ _7d"> </span><span class="ff19 ls1087">••<span class="_ _9e"></span><span class="ls0">Data other than high priority data can be read without blocking</span></span></div><div class="t m0 xb5 h4f y3e3c ff19 fs11 fc0 sc0 ls0 ws0">(equivalent to<span class="_"> </span><span class="ff1a">POLLRDNORM|POLLRDBAND</span>).</div><div class="t m0 x2c h4f y3e3d ff1a fs11 fc0 sc0 ls0 ws0">POLLRDNORM<span class="_ _15"> </span><span class="ff19 ls1087">••<span class="_ _9e"></span><span class="ls0">Normal data can be read without blocking.</span></span></div><div class="t m0 x2c h4f y3e3e ff1a fs11 fc0 sc0 ls0 ws0">POLLRDBAND<span class="_ _15"> </span><span class="ff19 ls1087">••<span class="_ _9e"></span><span class="ls0">Priority data can be read without blocking.</span></span></div><div class="t m0 x2c h4f y3e3f ff1a fs11 fc0 sc0 ls0 ws0">POLLPRI<span class="_ _9f"> </span><span class="ff19 ls1087">••<span class="_ _9e"></span><span class="ls0">High-priority data can be read without blocking.</span></span></div><div class="t m0 x2c h6d y3e40 ff1a fs12 fc0 sc0 ls0 ws0">POLLOUT<span class="_ _9f"> </span><span class="ff19 ls1088">••<span class="_ _9e"></span><span class="ls0">Normal data can be written without blocking.</span></span></div><div class="t m0 x2c h6d y3e41 ff1a fs12 fc0 sc0 ls0 ws0">POLLWRNORM<span class="_ _15"> </span><span class="ff19 ls1088">••<span class="_ _9e"></span><span class="ls0">Same as<span class="_"> </span><span class="ff1a">POLLOUT</span>.</span></span></div><div class="t m0 x2c h6d y3e42 ff1a fs12 fc0 sc0 ls0 ws0">POLLWRBAND<span class="_ _15"> </span><span class="ff19 ls1088">••<span class="_ _9e"></span><span class="ls0">Priority data can be written without blocking.</span></span></div><div class="t m0 x2c h63 y3e43 ff1a fs13 fc0 sc0 ls0 ws0">POLLERR<span class="_ _227"> </span><span class="ff19">•<span class="_ _6c"> </span>An error has occurr<span class="_ _0"></span>ed.</span></div><div class="t m0 x2c h63 y3e44 ff1a fs13 fc0 sc0 ls0 ws0">POLLHUP<span class="_ _227"> </span><span class="ff19">•<span class="_ _6c"> </span><span class="ls673">Ah<span class="_ _84"></span><span class="ls0">angup has occurred.</span></span></span></div><div class="t m0 x2c h63 y3e45 ff1a fs13 fc0 sc0 ls0 ws0">POLLNVAL<span class="_ _b9"> </span><span class="ff19">•<span class="_ _6c"> </span>The descriptor does not reference an open ﬁle.</span></div><div class="t m0 x30 h6f y3e46 ff18 fs14 fc0 sc0 ls0 ws0">Figure 14.17<span class="_ _5a"> </span><span class="ff19">The<span class="_"> </span><span class="ff1a">events<span class="_ _e"> </span></span>and<span class="_"> </span><span class="ff1a">revents<span class="_ _e"> </span></span>ﬂags for<span class="_"> </span><span class="ff1a">poll</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
