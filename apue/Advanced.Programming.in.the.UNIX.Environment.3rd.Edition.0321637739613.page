<div id="pf265" class="pf w4 h1f" data-page-no="265"><div class="pc pc265 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg265.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>15.10<span class="_ _282"> </span>POSIX <span class="_"> </span>Semaphores<span class="_ _1fb"> </span><span class="ff18">579</span></div><div class="t m0 x35 h53 y12f ff16 fs2b fc0 sc0 ls0 ws0">15.10 <span class="_ _66"> </span>POSIX<span class="_ _54"> </span>Semaphores</div><div class="t m0 x32 h2a y4de ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _2"></span>POSIX <span class="_ _3"></span>semaphor<span class="lscdd">em<span class="_ _8"></span><span class="ls0">echanism <span class="_ _3"></span>is <span class="_ _2"></span>one <span class="_ _3"></span>of <span class="_ _3"></span>three <span class="_ _2"></span>IPC <span class="_ _2"></span>mechanisms <span class="_ _3"></span>that <span class="_ _3"></span>originated <span class="_ _3"></span>with</span></span></div><div class="t m0 x32 h2a y6d0 ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _53"> </span>real-time <span class="_ _42"> </span>extensions <span class="_ _53"> </span>to <span class="_ _53"> </span>POSIX.1.<span class="_ _65"> </span>The <span class="_ _53"> </span>Single <span class="_ _53"> </span>UNIX <span class="_ _53"> </span>Speciﬁcation <span class="_ _53"> </span>placed <span class="_ _e"> </span>the <span class="_ _53"> </span>three</div><div class="t m0 x32 h2a y6d1 ff19 fsf fc0 sc0 ls0 ws0">mechanisms <span class="_ _66"> </span>(message <span class="_ _66"> </span>queues, <span class="_ _47"> </span>semaphores, <span class="_"> </span>and <span class="_ _66"> </span>shared <span class="_ _66"> </span>memory) <span class="_ _47"> </span>in <span class="_"> </span>option <span class="_ _47"> </span>classes.</div><div class="t m0 x32 h2a y6d2 ff19 fsf fc0 sc0 ls0 ws0">Prior <span class="_"> </span>to <span class="_ _66"> </span>SUSv4, <span class="_ _66"> </span>the <span class="_ _66"> </span>POSIX <span class="_ _66"> </span>semaphor<span class="ls128f">ei<span class="_ _5b"></span><span class="ls0">nterfaces <span class="_ _66"> </span>wer<span class="ls128f">ei<span class="_ _5b"></span><span class="ls0">ncluded <span class="_ _66"> </span>in <span class="_ _66"> </span>the <span class="_ _66"> </span>semaphores</span></span></span></span></div><div class="t m0 x32 h2a y6d3 ff19 fsf fc0 sc0 ls0 ws0">option. <span class="_ _16"> </span>In<span class="_ _5a"> </span>SUSv4, <span class="_ _45"> </span>these <span class="_ _47"> </span>interfaces <span class="_ _45"> </span>wer<span class="ls1290">em<span class="_ _26"></span><span class="ls0">oved <span class="_ _45"> </span>to <span class="_ _47"> </span>the <span class="_ _45"> </span>base <span class="_ _45"> </span>speciﬁcation, <span class="_ _47"> </span>but <span class="_ _45"> </span>the</span></span></div><div class="t m0 x32 h2a y6d4 ff19 fsf fc0 sc0 ls0 ws0">message queue and shared memory interfaces r<span class="_ _0"></span>emained optional.</div><div class="t m0 x3f h2a y6d5 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _42"> </span>POSIX <span class="_ _23"> </span>semaphor<span class="ls8bd">ei<span class="_ _43"></span><span class="ls0">nterfaces <span class="_ _23"> </span>wer<span class="ls8bd">em<span class="_ _43"></span><span class="ls0">eant <span class="_ _23"> </span>to <span class="_ _42"> </span>address <span class="_ _23"> </span>several <span class="_ _42"> </span>deﬁciencies <span class="_ _42"> </span>with</span></span></span></span></div><div class="t m0 x32 h2a y6d6 ff19 fsf fc0 sc0 ls0 ws0">the XSI semaphor<span class="ls44">ei<span class="_ _4f"></span><span class="ls0">nterfaces:</span></span></div><div class="t m0 x3f h2a y45da ff19 fsf fc0 sc0 ls49 ws0">•T<span class="_ _4d"></span><span class="ls0">he <span class="_ _2"></span>POSIX <span class="_ _2"></span>semaphor<span class="ls1291">ei<span class="_ _8"></span><span class="ls0">nterfaces <span class="_ _2"></span>allow <span class="_ _2"></span>for <span class="_ _2"></span>higher-performance <span class="_ _2"></span>implementations</span></span></span></div><div class="t m0 x15 h2a y45db ff19 fsf fc0 sc0 ls0 ws0">compared to XSI semaphor<span class="_ _0"></span>es.</div><div class="t m0 x3f h2a y45dc ff19 fsf fc0 sc0 ls49 ws0">•T<span class="_ _4d"></span><span class="ls0">he POSIX semaphor<span class="ls1292">ei<span class="_ _d"></span><span class="ls0">nterfaces ar<span class="ls1292">es<span class="_ _4f"></span><span class="ls0">impler <span class="_ _2"></span>to use: <span class="_ _2"></span>ther<span class="ls1292">ea<span class="_ _4f"></span><span class="ls45">re <span class="_ _3"></span>n<span class="ls21c">os<span class="_ _d"></span><span class="ls0">emaphor<span class="ls21c">es<span class="_ _d"></span><span class="ls0">ets,</span></span></span></span></span></span></span></span></span></span></span></div><div class="t m0 x15 h2a y45dd ff19 fsf fc0 sc0 ls0 ws0">and <span class="_ _9"></span>several <span class="_ _9"></span>of <span class="_ _23"></span>the <span class="_ _9"></span>interfaces <span class="_ _9"></span>ar<span class="ls1bc">ep<span class="_ _b"></span><span class="ls0">atterned <span class="_ _9"></span>after <span class="_ _9"></span>familiar <span class="_ _23"></span>ﬁle <span class="_ _9"></span>system <span class="_ _9"></span>operations.</span></span></div><div class="t m0 x15 h2a y45de ff19 fsf fc0 sc0 ls0 ws0">Although <span class="_ _23"></span>ther<span class="_ _0"></span>e<span class="_ _45"> </span>is<span class="_ _35"> </span>no<span class="_ _45"> </span>requirement <span class="_ _9"></span>that <span class="_ _23"> </span>they <span class="_ _23"></span>be <span class="_ _23"></span>implemented <span class="_ _9"></span>in <span class="_ _23"> </span>the <span class="_ _23"></span>ﬁle <span class="_ _23"></span>system,</div><div class="t m0 x15 h2a y45df ff19 fsf fc0 sc0 ls0 ws0">some systems do take this approach.</div><div class="t m0 x3f h2a y33d4 ff19 fsf fc0 sc0 ls49 ws0">•T<span class="_ _4d"></span><span class="ls0">he <span class="_"> </span>POSIX <span class="_"> </span>semaphores <span class="_"> </span>behave <span class="_ _66"> </span>mor<span class="ls1293">eg<span class="_ _5b"></span><span class="ls0">racefully <span class="_ _66"> </span>when <span class="_"> </span>removed. <span class="_ _46"> </span>Recall<span class="_ _46"> </span>that</span></span></span></div><div class="t m0 x15 h2a y33d5 ff19 fsf fc0 sc0 ls0 ws0">when <span class="_"> </span>an <span class="_ _66"> </span>XSI <span class="_ _66"> </span>semaphore<span class="_ _46"> </span>is<span class="_ _46"> </span>removed, <span class="_"> </span>operations <span class="_ _66"> </span>using <span class="_ _66"> </span>the <span class="_ _66"> </span>same <span class="_ _66"> </span>semaphore</div><div class="t m0 x15 h26 y33d6 ff19 fsf fc0 sc0 ls0 ws0">identiﬁer <span class="_ _53"> </span>fail <span class="_ _53"> </span>with<span class="_ _44"> </span><span class="ff1a">errno<span class="_ _4b"> </span></span>set <span class="_ _53"> </span>to<span class="_ _44"> </span><span class="ff1a">EIDRM</span><span class="ls1294">.W<span class="_ _5d"></span><span class="ls0">ith <span class="_ _53"> </span>POSIX <span class="_ _53"> </span>semaphores, <span class="_ _53"> </span>operations</span></span></div><div class="t m0 x15 h2a y33d7 ff19 fsf fc0 sc0 ls0 ws0">continue to work normally until the last refer<span class="_ _0"></span>ence to the semaphor<span class="_ _0"></span>e<span class="_"> </span>is<span class="_"> </span>released.</div><div class="t m0 x3f h2a y45e0 ff19 fsf fc0 sc0 ls0 ws0">POSIX <span class="_ _9"></span>semaphores <span class="_ _3"></span>ar<span class="ls1295">ea<span class="_ _b"></span><span class="ls0">vailable <span class="_ _9"></span>in <span class="_ _9"></span>two <span class="_ _9"></span>ﬂavors: <span class="_ _3"></span>named <span class="_ _9"></span>and <span class="_ _9"></span>unnamed.<span class="_ _5a"> </span>They <span class="_ _9"></span>differ</span></span></div><div class="t m0 x32 h2a y45e1 ff19 fsf fc0 sc0 ls0 ws0">in <span class="_ _47"> </span>how <span class="_ _47"> </span>they <span class="_ _66"> </span>ar<span class="ls1296">ec<span class="_ _1d"></span><span class="ls45">re<span class="_ _2"></span><span class="ls0">ated <span class="_ _47"> </span>and <span class="_ _47"> </span>destroyed, <span class="_ _66"> </span>but <span class="_ _47"> </span>otherwise <span class="_ _47"> </span>work <span class="_ _47"> </span>the <span class="_ _47"> </span>same.<span class="_ _50"> </span>Unnamed</span></span></span></div><div class="t m0 x32 h2a y45e2 ff19 fsf fc0 sc0 ls0 ws0">semaphores exist in <span class="_ _2"></span>memory only <span class="_ _2"></span>and requir<span class="ls9da">et<span class="_ _4f"></span><span class="ls0">hat processes have <span class="_ _2"></span>access to <span class="_ _2"></span>the memory</span></span></div><div class="t m0 x32 h2a y45e3 ff19 fsf fc0 sc0 ls0 ws0">to <span class="_ _9"></span>be <span class="_ _23"></span>able <span class="_ _9"></span>to <span class="_ _9"></span>use <span class="_ _23"></span>the <span class="_ _9"></span>semaphores. <span class="_ _9"></span>This <span class="_ _23"></span>means <span class="_ _9"></span>they <span class="_ _9"></span>can <span class="_ _23"></span>be <span class="_ _9"></span>used <span class="_ _23"></span>only <span class="_ _9"></span>by <span class="_ _9"></span>threads <span class="_ _9"></span>in <span class="_ _23"></span>the</div><div class="t m0 x32 h2a y45e4 ff19 fsf fc0 sc0 ls0 ws0">same <span class="_ _53"> </span>process <span class="_ _53"> </span>or <span class="_ _e"> </span>threads <span class="_ _53"> </span>in <span class="_ _53"> </span>different <span class="_ _53"> </span>processes <span class="_ _53"> </span>that <span class="_ _53"> </span>have <span class="_ _e"> </span>mapped <span class="_ _e"> </span>the <span class="_ _53"> </span>same <span class="_ _e"> </span>memory</div><div class="t m0 x32 h2a y45e5 ff19 fsf fc0 sc0 ls0 ws0">extent <span class="_ _2"></span>into <span class="_ _2"></span>their <span class="_ _3"></span>address spaces.<span class="_ _16"> </span>Named <span class="_ _2"></span>semaphores, <span class="_ _2"></span>in <span class="_ _2"></span>contrast, <span class="_ _3"></span>ar<span class="ls3ed">ea<span class="_ _8"></span><span class="ls0">ccessed <span class="_ _2"></span>by <span class="_ _3"></span>name</span></span></div><div class="t m0 x32 h2a y45e6 ff19 fsf fc0 sc0 ls0 ws0">and can be used by threads in any pr<span class="_ _0"></span>ocesses that know their names.</div><div class="t m0 x3f h26 y45e7 ff19 fsf fc0 sc0 ls5f ws0">To <span class="_ _47"> </span>c<span class="_ _9"></span><span class="ls45">re<span class="_ _2"></span><span class="ls0">ate <span class="_ _42"> </span>a <span class="_ _23"></span>new <span class="_ _23"> </span>named <span class="_ _42"> </span>semaphor<span class="_ _0"></span>e<span class="_ _35"> </span>or<span class="_ _35"> </span>use <span class="_ _23"> </span>an <span class="_ _42"> </span>existing <span class="_ _23"></span>one, <span class="_ _23"> </span>we <span class="_ _42"> </span>call <span class="_ _23"></span>the<span class="_ _35"> </span><span class="ff1a">sem_open</span></span></span></div><div class="t m0 x32 h2a y45e8 ff19 fsf fc0 sc0 ls0 ws0">function.</div><div class="t m0 x3f h57 y45e9 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;semaphore.h&gt;</div><div class="t m0 x3f h57 y45ea ff1a fs2d fc0 sc0 ls0 ws0">sem_t *sem_open(const char *<span class="ff1b">name</span><span class="ls15c">,i<span class="_ _1d"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">oﬂag</span><span class="ls15c">,.<span class="_ _5b"></span><span class="ls0">.. /* mode_t<span class="_"> </span><span class="ff1b">mode</span>,</span></span></span></span></div><div class="t m0 x1dd h57 y45eb ff1a fs2d fc0 sc0 ls0 ws0">unsigned int<span class="_"> </span><span class="ff1b">value<span class="_ _61"> </span></span>*/ );</div><div class="t m0 x128 h57 y45ec ff19 fs2d fc0 sc0 ls0 ws0">Returns: Pointer to semaphore<span class="_"> </span>if<span class="_"> </span>OK,<span class="_"> </span><span class="ff1a">SEM_FAILED<span class="_ _e"> </span></span>on error</div><div class="t m0 x32 h49 y45ed ff19 fs26 fc0 sc0 ls0 ws0">When using an <span class="_ _2"></span>existing named semaphore, we specify <span class="_ _2"></span>only two arguments: the name <span class="_ _2"></span>of</div><div class="t m0 x32 h4a y45ee ff19 fs26 fc0 sc0 ls0 ws0">the <span class="_ _23"></span>semaphor<span class="_ _0"></span><span class="ls39a">ea<span class="_ _b"></span><span class="ls0">nd <span class="_ _9"></span>a <span class="_ _23"></span>zer<span class="ls39a">ov<span class="_ _43"></span><span class="ls0">alue <span class="_ _23"></span>for <span class="_ _23"></span>the<span class="_ _45"> </span><span class="ff1b">oﬂag<span class="_ _35"> </span></span>ar<span class="_ _0"></span>gument. <span class="_ _45"> </span>When<span class="_ _35"> </span>the<span class="_ _45"> </span><span class="ff1b">oﬂag<span class="_ _35"> </span></span>argument <span class="_ _9"></span>has</span></span></span></span></div><div class="t m0 x32 h4d y45ef ff19 fs26 fc0 sc0 ls0 ws0">the<span class="_ _45"> </span><span class="ff1a">O_CREAT<span class="_ _35"> </span></span>ﬂag <span class="_ _9"></span>set, <span class="_ _23"> </span>we <span class="_ _23"></span>create <span class="_ _9"></span>a <span class="_ _23"></span>new <span class="_ _9"></span>named <span class="_ _23"></span>semaphore<span class="_ _45"> </span>if<span class="_ _45"> </span>it<span class="_ _35"> </span>does <span class="_ _23"></span>not <span class="_ _9"></span>yet <span class="_ _23"></span>exist.<span class="_ _5a"> </span>If <span class="_ _23"> </span>it</div><div class="t m0 x32 h49 y45f0 ff19 fs26 fc0 sc0 ls0 ws0">already exists, it is opened for use, but no additional initialization takes place.</div><div class="t m0 x3f h4d y45f1 ff19 fs26 fc0 sc0 ls0 ws0">When <span class="_ _2"></span>we <span class="_ _3"></span>specify <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">O_CREAT<span class="_ _47"> </span></span>ﬂag, <span class="_ _3"></span>we <span class="_ _3"></span>need <span class="_ _2"></span>to <span class="_ _3"></span>provide <span class="_ _2"></span>two <span class="_ _3"></span>additional <span class="_ _3"></span>arguments.</div><div class="t m0 x32 h4a y45f2 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _35"> </span><span class="ff1b">mode<span class="_ _35"> </span></span>argument <span class="_ _23"></span>speciﬁes <span class="_ _23"> </span>who <span class="_ _23"> </span>can <span class="_ _42"> </span>access <span class="_ _23"> </span>the <span class="_ _42"> </span>semaphor<span class="_ _0"></span>e. <span class="_ _35"> </span>It<span class="_ _35"> </span>can <span class="_ _23"> </span>take <span class="_ _42"> </span>on <span class="_ _23"> </span>the <span class="_ _23"> </span>same</div><div class="t m0 x32 h49 y45f3 ff19 fs26 fc0 sc0 ls0 ws0">values <span class="_"> </span>as <span class="_ _e"> </span>the <span class="_"> </span>permission <span class="_ _e"> </span>bits <span class="_"> </span>for <span class="_ _e"> </span>opening <span class="_"> </span>a <span class="_ _e"> </span>ﬁle: <span class="_"> </span>user<span class="_ _0"></span>-read, <span class="_ _e"> </span>user-write, <span class="_ _e"> </span>user-execute,</div><div class="t m0 x32 h49 y45f4 ff19 fs26 fc0 sc0 ls0 ws0">group-r<span class="_ _0"></span>ead, <span class="_ _45"> </span>group-write, <span class="_ _45"> </span>gr<span class="_ _0"></span>oup-execute, <span class="_ _45"> </span>other-read, <span class="_ _45"> </span>other<span class="_ _0"></span>-write, <span class="_ _45"> </span>and <span class="_ _45"> </span>other-execute.</div><div class="t m0 x32 h49 y45f5 ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _23"> </span>resulting <span class="_ _23"> </span>permissions <span class="_ _42"> </span>assigned <span class="_ _23"> </span>to <span class="_ _42"> </span>the <span class="_ _23"> </span>semaphor<span class="ls1297">ea<span class="_ _43"></span><span class="lscc">re <span class="_ _42"> </span>m<span class="_ _2"></span><span class="ls0">odiﬁed <span class="_ _23"> </span>by <span class="_ _42"> </span>the <span class="_ _23"> </span>caller<span class="_ _9"></span>’s <span class="_ _42"> </span>ﬁle</span></span></span></div><a class="l" href="#pf12" data-dest-detail='[18,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892409px;bottom:1236.288916px;width:151.379799px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
