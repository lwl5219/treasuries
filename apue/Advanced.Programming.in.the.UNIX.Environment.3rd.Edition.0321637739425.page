<div id="pf1a9" class="pf w4 h1f" data-page-no="1a9"><div class="pc pc1a9 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg1a9.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>1<span class="_ _1"></span>1.5 <span class="_ _1c9"> </span>Thr<span class="_ _1"></span>ead <span class="_"> </span>T<span class="_ _1"></span>ermination<span class="_ _1b"> </span><span class="ff18">391</span></div><div class="t m0 x35 h27 y12f ff16 fsf fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _47"> </span>program <span class="_"> </span>in <span class="_ _47"> </span>Figur<span class="lsdad">e1<span class="_ _26"></span><span class="ls0">1.4 <span class="_ _47"> </span>shows <span class="_ _47"> </span>the <span class="_ _47"> </span>problem <span class="_ _66"> </span>with <span class="_ _47"> </span>using <span class="_ _47"> </span>an <span class="_ _47"> </span>automatic <span class="_ _47"> </span>variable</span></span></div><div class="t m0 x32 h26 y132 ff19 fsf fc0 sc0 ls0 ws0">(allocated on the stack) as the argument to<span class="_"> </span><span class="ff1a">pthread_exit</span>.</div><div class="t m0 x32 h4e y2d71 ff1a fs28 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h4e y31cf ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;pthread.h&gt;</div><div class="t m0 x32 h4e y31d0 ff1a fs28 fc0 sc0 ls0 ws0">struct foo {</div><div class="t m0 x8a h4e y31d1 ff1a fs28 fc0 sc0 ls0 ws0">int a, b, c, d;</div><div class="t m0 x32 h4e y31d2 ff1a fs28 fc0 sc0 ls0 ws0">};</div><div class="t m0 x32 h4e y31d3 ff1a fs28 fc0 sc0 ls0 ws0">void</div><div class="t m0 x32 h4e y31d4 ff1a fs28 fc0 sc0 ls0 ws0">printfoo(const char *s, const struct foo *fp)</div><div class="t m0 x32 h4e y31d5 ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y31d6 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;%s&quot;, s);</div><div class="t m0 x8a h4e y31d7 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot; <span class="_"> </span>structure<span class="_"> </span>at 0x%lx\n&quot;, (unsigned long)fp);</div><div class="t m0 x8a h4e y31d8 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot; <span class="_"> </span>foo.a<span class="_"> </span><span class="ls1b6">=%<span class="_ _1d"></span><span class="ls0">d\n&quot;, fp-&gt;a);</span></span></div><div class="t m0 x8a h4e y31d9 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot; <span class="_"> </span>foo.b<span class="_"> </span><span class="ls1b6">=%<span class="_ _1d"></span><span class="ls0">d\n&quot;, fp-&gt;b);</span></span></div><div class="t m0 x8a h4e y31da ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot; <span class="_"> </span>foo.c<span class="_"> </span><span class="ls1b6">=%<span class="_ _1d"></span><span class="ls0">d\n&quot;, fp-&gt;c);</span></span></div><div class="t m0 x8a h4e y31db ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot; <span class="_"> </span>foo.d<span class="_"> </span><span class="ls1b6">=%<span class="_ _1d"></span><span class="ls0">d\n&quot;, fp-&gt;d);</span></span></div><div class="t m0 x32 h4e y31dc ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h4e y31dd ff1a fs28 fc0 sc0 ls0 ws0">void *</div><div class="t m0 x32 h4e y31de ff1a fs28 fc0 sc0 ls0 ws0">thr_fn1(void *arg)</div><div class="t m0 x32 h4e y31df ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y31e0 ff1a fs28 fc0 sc0 ls0 ws0">struct foo<span class="_ _d9"> </span>foo = {1, 2, 3, 4};</div><div class="t m0 x8a h4e y31e1 ff1a fs28 fc0 sc0 ls0 ws0">printfoo(&quot;thread 1:\n&quot;, &amp;foo);</div><div class="t m0 x8a h4e y31e2 ff1a fs28 fc0 sc0 ls0 ws0">pthread_exit((void *)&amp;foo);</div><div class="t m0 x32 h4e y31e3 ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h4e y31e4 ff1a fs28 fc0 sc0 ls0 ws0">void *</div><div class="t m0 x32 h4e y31e5 ff1a fs28 fc0 sc0 ls0 ws0">thr_fn2(void *arg)</div><div class="t m0 x32 h4e y31e6 ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y31e7 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;thread 2: ID is %lu\n&quot;, (unsigned long)pthread_self());</div><div class="t m0 x8a h4e y31e8 ff1a fs28 fc0 sc0 ls0 ws0">pthread_exit((void *)0);</div><div class="t m0 x32 h4e y31e9 ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h4e y31ea ff1a fs28 fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h4e y31eb ff1a fs28 fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 x32 h4e y31ec ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y31ed ff1a fs28 fc0 sc0 ls0 ws0">int <span class="_ _186"> </span>err;</div><div class="t m0 x8a h4e y31ee ff1a fs28 fc0 sc0 ls0 ws0">pthread_t <span class="_ _d9"> </span>tid1,<span class="_"> </span>tid2;</div><div class="t m0 x8a h4e y31ef ff1a fs28 fc0 sc0 ls0 ws0">struct foo<span class="_ _d9"> </span>*fp;</div><div class="t m0 x8a h4e y31f0 ff1a fs28 fc0 sc0 ls0 ws0">err = pthread_create(&amp;tid1, NULL, thr_fn1, NULL);</div><div class="t m0 x8a h4e y31f1 ff1a fs28 fc0 sc0 ls0 ws0">if (err != 0)</div><div class="t m0 x9d h4e y31f2 ff1a fs28 fc0 sc0 ls0 ws0">err_exit(err, &quot;can’t create thread 1&quot;);</div><div class="t m0 x8a h4e y31f3 ff1a fs28 fc0 sc0 ls0 ws0">err = pthread_join(tid1, (void *)&amp;fp);</div><div class="t m0 x8a h4e y31f4 ff1a fs28 fc0 sc0 ls0 ws0">if (err != 0)</div><div class="t m0 x9d h4e y31f5 ff1a fs28 fc0 sc0 ls0 ws0">err_exit(err, &quot;can’t join with thread 1&quot;);</div><div class="t m0 x8a h4e y31f6 ff1a fs28 fc0 sc0 ls0 ws0">sleep(1);</div><div class="t m0 x8a h4e y31f7 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;parent starting second thread\n&quot;);</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
