<div id="pf27e" class="pf w4 h1f" data-page-no="27e"><div class="pc pc27e w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg27e.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">604<span class="_ _1b"> </span><span class="ff19">Network <span class="_"> </span>IPC: <span class="_"> </span>Sockets<span class="_ _2c6"> </span>Chapter <span class="_"> </span>16</span></div><div class="t m0 x1f h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">sinp = (struct sockaddr_in *)aip-&gt;ai_addr;</div><div class="t m0 x1f h57 y426 ff1a fs2d fc0 sc0 ls0 ws0">addr = inet_ntop(AF_INET, &amp;sinp-&gt;sin_addr, abuf,</div><div class="t m0 x1ca h57 y800 ff1a fs2d fc0 sc0 ls0 ws0">INET_ADDRSTRLEN);</div><div class="t m0 x1f h57 y801 ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot; address %s&quot;, addr?addr:&quot;unknown&quot;);</div><div class="t m0 x1f h57 y802 ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot; port %d&quot;, ntohs(sinp-&gt;sin_port));</div><div class="t m0 x9d h57 y803 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x9d h57 y804 ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;\n&quot;);</div><div class="t m0 x8a h57 y805 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y806 ff1a fs2d fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h57 y807 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x2f h2d y3391 ff18 fs10 fc0 sc0 ls0 ws0">Figure 16.9<span class="_ _5a"> </span><span class="ff19">Print host and service information</span></div><div class="t m0 x32 h4d y3392 ff19 fs26 fc0 sc0 ls0 ws0">This <span class="_ _42"> </span>program <span class="_ _23"></span>illustrates <span class="_ _42"> </span>the <span class="_ _42"> </span>use <span class="_ _23"> </span>of <span class="_ _42"> </span>the<span class="_ _44"> </span><span class="ff1a">getaddrinfo<span class="_ _35"> </span></span>function. <span class="_ _44"> </span>If<span class="_ _35"> </span>multiple <span class="_ _42"> </span>protocols</div><div class="t m0 x32 h49 y3393 ff19 fs26 fc0 sc0 ls0 ws0">provide the given service for the given host, the <span class="_ _2"></span>program will print mor<span class="ls133b">et<span class="_ _4f"></span><span class="ls0">han one entry<span class="_ _6"></span>.</span></span></div><div class="t m0 x32 h49 y3394 ff19 fs26 fc0 sc0 ls0 ws0">In <span class="_ _9"></span>this <span class="_ _3"></span>example, <span class="_ _9"></span>we <span class="_ _9"></span>print <span class="_ _9"></span>out <span class="_ _9"></span>the <span class="_ _3"></span>address <span class="_ _9"></span>information <span class="_ _3"></span>only <span class="_ _9"></span>for <span class="_ _9"></span>the <span class="_ _9"></span>protocols <span class="_ _3"></span>that <span class="_ _9"></span>work</div><div class="t m0 x32 h4d y3395 ff19 fs26 fc0 sc0 ls0 ws0">with <span class="_ _42"> </span>IPv4 <span class="_ _53"> </span>(<span class="ff1a">ai_family<span class="_ _44"> </span></span>equals<span class="_ _44"> </span><span class="ff1a">AF_INET</span>). <span class="_ _44"> </span>If<span class="_ _44"> </span>we <span class="_ _53"> </span>wanted <span class="_ _42"> </span>to <span class="_ _53"> </span>restrict <span class="_ _42"> </span>the <span class="_ _42"> </span>output <span class="_ _53"> </span>to <span class="_ _42"> </span>the</div><div class="t m0 x32 h4d y3396 ff1a fs26 fc0 sc0 ls0 ws0">AF_INET<span class="_ _80"> </span><span class="ff19">protocol family<span class="_ _4"></span>,<span class="_"> </span>we<span class="_"> </span>could set the<span class="_"> </span><span class="ff1a">ai_family<span class="_ _66"> </span></span>ﬁeld in the hint.</span></div><div class="t m0 x3f h49 y3397 ff19 fs26 fc0 sc0 ls0 ws0">When we run the pr<span class="_ _0"></span>ogram on one of the test systems, we get</div><div class="t m0 x3f h4e y4863 ff1a fs28 fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">./a.out harry nfs</span></div><div class="t m0 x3f h4e y4864 ff1a fs28 fc0 sc0 ls0 ws0">flags canon family inet type stream protocol TCP</div><div class="t m0 x21b h4e y4865 ff1a fs28 fc0 sc0 ls0 ws0">host harry address 192.168.1.99 port 2049</div><div class="t m0 x3f h4e y4866 ff1a fs28 fc0 sc0 ls0 ws0">flags canon family inet type datagram protocol UDP</div><div class="t m0 x21b h4e y4867 ff1a fs28 fc0 sc0 ls0 ws0">host harry address 192.168.1.99 port 2049</div><div class="t m0 x32 h99 y4868 ff16 fs3b fc0 sc0 ls0 ws0">16.3.4 <span class="_ _54"> </span>Associating<span class="_ _54"> </span>Addresses <span class="_"> </span>with <span class="_"> </span>Sockets</div><div class="t m0 x32 h55 y4869 ff19 fs2c fc0 sc0 ls0 ws0">The <span class="_ _53"> </span>address <span class="_ _53"> </span>associated <span class="_"> </span>with <span class="_ _53"> </span>a <span class="_ _53"> </span>client’s <span class="_ _e"> </span>socket <span class="_ _e"> </span>is <span class="_ _e"> </span>of <span class="_ _e"> </span>little <span class="_ _e"> </span>interest, <span class="_ _53"> </span>and <span class="_ _e"> </span>we <span class="_ _e"> </span>can <span class="_ _53"> </span>let <span class="_"> </span>the</div><div class="t m0 x32 h55 y486a ff19 fs2c fc0 sc0 ls0 ws0">system <span class="_ _9"></span>choose <span class="_ _23"></span>a <span class="_ _9"></span>default <span class="_ _23"></span>address <span class="_ _9"></span>for <span class="_ _9"></span>us.<span class="_ _51"> </span>For <span class="_ _9"></span>a <span class="_ _23"></span>server<span class="_ _6"></span><span class="ls133c">,h<span class="_ _b"></span><span class="ls0">owever<span class="_ _6"></span>,<span class="_ _35"> </span>we<span class="_ _45"> </span>need <span class="_ _9"></span>to <span class="_ _23"></span>associate <span class="_ _9"></span>a</span></span></div><div class="t m0 x32 h55 y486b ff19 fs2c fc0 sc0 ls0 ws0">well-known <span class="_ _47"> </span>address <span class="_"> </span>with <span class="_ _47"> </span>the <span class="_ _47"> </span>server<span class="_ _9"></span>’s <span class="_ _47"> </span>socket <span class="_ _47"> </span>on <span class="_ _47"> </span>which <span class="_ _47"> </span>client <span class="_ _47"> </span>requests <span class="_"> </span>will <span class="_ _47"> </span>arrive.</div><div class="t m0 x32 h55 y486c ff19 fs2c fc0 sc0 ls0 ws0">Clients <span class="_ _9"></span>need <span class="_ _3"></span>a <span class="_ _9"></span>way <span class="_ _9"></span>to <span class="_ _9"></span>discover <span class="_ _9"></span>the <span class="_ _9"></span>address <span class="_ _3"></span>to <span class="_ _9"></span>use <span class="_ _9"></span>to <span class="_ _9"></span>contact <span class="_ _9"></span>a <span class="_ _9"></span>server<span class="_ _6"></span><span class="ls133d">,a<span class="_ _8"></span><span class="ls0">nd <span class="_ _9"></span>the <span class="_ _9"></span>simplest</span></span></div><div class="t m0 x32 h54 y486d ff19 fs2c fc0 sc0 ls0 ws0">scheme is for a <span class="_ _2"></span>server to reserve an address and register it in<span class="_"> </span><span class="ff1a">/etc/services<span class="_ _66"> </span></span>or with <span class="_ _2"></span>a</div><div class="t m0 x32 h55 y486e ff19 fs2c fc0 sc0 ls0 ws0">name service.</div><div class="t m0 x3f h54 y486f ff19 fs2c fc0 sc0 ls155 ws0">We <span class="_ _53"> </span>u<span class="_ _9"></span><span class="ls0">se the<span class="_"> </span><span class="ff1a">bind<span class="_ _66"> </span></span>function to associate an address with a socket.</span></div><div class="t m0 x3f h5d y4870 ff1a fs2f fc0 sc0 ls0 ws0">#include &lt;sys/socket.h&gt;</div><div class="t m0 x3f h5d y4871 ff1a fs2f fc0 sc0 ls0 ws0">int bind(int<span class="_"> </span><span class="ff1b">sockfd</span><span class="ls395">,c<span class="_ _1d"></span><span class="ls0">onst struct sockaddr *<span class="ff1b">addr</span><span class="ls395">,s<span class="_ _5b"></span><span class="ls0">ocklen_t<span class="_"> </span><span class="ff1b">len</span>);</span></span></span></span></div><div class="t m0 x153 hc2 y4872 ff19 fs2f fc0 sc0 ls0 ws0">Returns: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h50 y4873 ff19 fs29 fc0 sc0 ls0 ws0">Ther<span class="lsdd">ea<span class="_ _4f"></span><span class="lsdf">re <span class="_ _3"></span>s<span class="ls0">everal restrictions on the address we can use:</span></span></span></div><div class="t m0 x3f h50 y4874 ff19 fs29 fc0 sc0 ls3ac ws0">•T<span class="_ _4d"></span><span class="ls0">he <span class="_ _9"></span>address <span class="_ _9"></span>we <span class="_ _23"> </span>specify <span class="_ _23"></span>must <span class="_ _9"></span>be <span class="_ _23"></span>valid <span class="_ _9"></span>for <span class="_ _23"> </span>the <span class="_ _23"></span>machine <span class="_ _9"></span>on <span class="_ _23"></span>which <span class="_ _9"></span>the <span class="_ _23"></span>process <span class="_ _9"></span>is</span></div><div class="t m0 x15 h50 y4875 ff19 fs29 fc0 sc0 ls133e ws0">ru<span class="ls0">nning; we can’t specify an address belonging to some other machine.</span></div><div class="t m0 x3f h50 y4876 ff19 fs29 fc0 sc0 ls3ac ws0">•T<span class="_ _4d"></span><span class="ls0">he <span class="_ _2"></span>address must <span class="_ _2"></span>match <span class="_ _2"></span>the <span class="_ _2"></span>format <span class="_ _2"></span>supported <span class="_ _2"></span>by <span class="_ _2"></span>the <span class="_ _2"></span>address family <span class="_ _2"></span>we <span class="_ _2"></span>used <span class="_ _2"></span>to</span></div><div class="t m0 x15 h50 y4877 ff19 fs29 fc0 sc0 ls0 ws0">create the socket.</div><a class="l" href="#pf12" data-dest-detail='[18,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:156.494092px;bottom:613.638916px;width:262.417007px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
