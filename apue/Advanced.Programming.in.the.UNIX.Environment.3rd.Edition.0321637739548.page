<div id="pf224" class="pf w4 h1f" data-page-no="224"><div class="pc pc224 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg224.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">514<span class="_ _1b"> </span><span class="ff19">Advanced <span class="_"> </span>I/O<span class="_ _16b"> </span>Chapter <span class="_"> </span>14</span></div><div class="t m0 x3f h2a y12f ff19 fsf fc0 sc0 ls5f ws0">We <span class="_ _e"> </span>u<span class="_ _9"></span><span class="ls0">se <span class="_ _2"></span>asynchronous I/O <span class="_ _2"></span>when <span class="_ _2"></span>we <span class="_ _2"></span>have other <span class="_ _2"></span>processing <span class="_ _2"></span>to do <span class="_ _2"></span>and <span class="_ _2"></span>we <span class="_ _2"></span>don’t <span class="_ _2"></span>want</span></div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">to <span class="_ _9"></span>block <span class="_ _9"></span>while <span class="_ _9"></span>performing <span class="_ _9"></span>the <span class="_ _9"></span>I/O <span class="_ _9"></span>operation.<span class="_ _5a"> </span>However<span class="_ _1"></span><span class="ls4ff">,w<span class="_ _b"></span><span class="ls0">hen <span class="_ _9"></span>we <span class="_ _9"></span>have <span class="_ _9"></span>completed <span class="_ _23"></span>the</span></span></div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">processing and ﬁnd that <span class="_ _2"></span>we <span class="_ _2"></span>still have <span class="_ _2"></span>asynchronous operations outstanding, <span class="_ _2"></span>we can <span class="_ _2"></span>call</div><div class="t m0 x32 h26 y132 ff19 fsf fc0 sc0 ls0 ws0">the<span class="_"> </span><span class="ff1a">aio_suspend<span class="_ _80"> </span></span>function to block until an operation completes.</div><div class="t m0 x3f h57 y126b ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;aio.h&gt;</div><div class="t m0 x3f h57 y126c ff1a fs2d fc0 sc0 ls0 ws0">int aio_suspend(const struct aiocb *const<span class="_"> </span><span class="ff1b">list</span>[], int<span class="_"> </span><span class="ff1b">nent</span>,</div><div class="t m0 x1dd h57 y3f04 ff1a fs2d fc0 sc0 ls0 ws0">const struct timespec *<span class="ff1b">timeout</span>);</div><div class="t m0 x153 h5f y3f05 ff19 fs2d fc0 sc0 ls0 ws0">Returns: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h4d y3f06 ff19 fs26 fc0 sc0 ls0 ws0">One <span class="_ _e"> </span>of <span class="_"> </span>thr<span class="_ _1"></span>ee <span class="_"> </span>things <span class="_ _53"> </span>can <span class="_"> </span>cause<span class="_ _4b"> </span><span class="ff1a">aio_suspend<span class="_ _59"> </span></span>to <span class="_ _e"> </span>return. <span class="_ _4b"> </span>If<span class="_ _59"> </span>we <span class="_ _e"> </span>ar<span class="ls10b1">ei<span class="_ _4a"></span><span class="ls0">nterrupted <span class="_"> </span>by <span class="_ _53"> </span>a</span></span></div><div class="t m0 x32 h4d y3f07 ff19 fs26 fc0 sc0 ls0 ws0">signal, it <span class="_ _2"></span>returns<span class="_ _66"> </span><span class="ff20">−</span><span class="ls10b2">1w<span class="_ _d"></span><span class="ls0">ith<span class="_"> </span><span class="ff1a">errno<span class="_ _47"> </span></span>set to<span class="_ _47"> </span><span class="ff1a">EINTR</span><span class="ls10b3">.I<span class="_ _5b"></span><span class="ls10b2">ft<span class="_ _4f"></span><span class="ls0">he <span class="_ _2"></span>time <span class="_ _2"></span>limit <span class="_ _2"></span>speciﬁed <span class="_ _2"></span>by <span class="_ _2"></span>the <span class="_ _2"></span>optional</span></span></span></span></span></div><div class="t m0 x32 h4a y3f08 ff1b fs26 fc0 sc0 ls0 ws0">timeout<span class="_ _48"> </span><span class="ff19">argument <span class="_ _59"> </span>expires <span class="_ _59"> </span>without <span class="_ _59"> </span>any <span class="_ _59"> </span>of <span class="_ _46"> </span>the <span class="_ _59"> </span>I/O <span class="_ _59"> </span>operations <span class="_ _46"> </span>completing, <span class="_ _59"> </span>then</span></div><div class="t m0 x32 h4d y3f09 ff1a fs26 fc0 sc0 ls0 ws0">aio_suspend<span class="_ _66"> </span><span class="ff19 lscc">re<span class="_ _2"></span><span class="ls0">turns<span class="_ _66"> </span><span class="ff20">−</span><span class="lsc2c">1w<span class="_ _d"></span><span class="ls0">ith<span class="_ _66"> </span><span class="ff1a">errno<span class="_ _47"> </span></span>set to<span class="_ _47"> </span><span class="ff1a">EAGAIN<span class="_ _66"> </span></span>(we <span class="_ _2"></span>can <span class="_ _2"></span>pass <span class="_ _2"></span>a <span class="_ _2"></span>null <span class="_ _2"></span>pointer <span class="_ _2"></span>for <span class="_ _2"></span>the</span></span></span></span></div><div class="t m0 x32 h4a y3f0a ff1b fs26 fc0 sc0 ls0 ws0">timeout<span class="_"> </span><span class="ff19">argument if <span class="_ _2"></span>we want <span class="_ _2"></span>to block <span class="_ _2"></span>without a <span class="_ _2"></span>time <span class="_ _2"></span>limit).<span class="_ _46"> </span>If <span class="_ _2"></span>any of <span class="_ _2"></span>the I/O <span class="_ _2"></span>operations</span></div><div class="t m0 x32 h4d y3f0b ff19 fs26 fc0 sc0 ls0 ws0">complete,<span class="_ _44"> </span><span class="ff1a">aio_suspend<span class="_ _44"> </span></span><span class="lscc">re</span>turns <span class="_ _53"> </span>0.<span class="_ _54"> </span>If <span class="_ _42"> </span>all <span class="_ _53"> </span>asynchronous <span class="_ _42"> </span>I/O <span class="_ _42"> </span>operations <span class="_ _53"> </span>ar<span class="ls10b4">ec<span class="_ _c"></span><span class="ls0">omplete</span></span></div><div class="t m0 x32 h4d y3f0c ff19 fs26 fc0 sc0 ls0 ws0">when we call<span class="_"> </span><span class="ff1a">aio_suspend</span><span class="lsd3">,t<span class="_ _d"></span><span class="ls0">hen<span class="_"> </span><span class="ff1a">aio_suspend<span class="_ _66"> </span></span>will return without blocking.</span></span></div><div class="t m0 x3f h4a y3f0d ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _46"> </span><span class="ff1b">list<span class="_ _46"> </span></span>argument <span class="_"> </span>is <span class="_"> </span>a <span class="_"> </span>pointer <span class="_"> </span>to <span class="_"> </span>an <span class="_"> </span>array <span class="_ _66"> </span>of <span class="_"> </span>AIO <span class="_"> </span>control <span class="_"> </span>blocks <span class="_"> </span>and <span class="_"> </span>the<span class="_ _46"> </span><span class="ff1b">nent</span></div><div class="t m0 x32 h49 y3f0e ff19 fs26 fc0 sc0 ls0 ws0">argument <span class="_ _23"></span>indicates <span class="_ _23"> </span>the <span class="_ _42"> </span>number <span class="_ _23"> </span>of <span class="_ _23"> </span>entries <span class="_ _42"> </span>in <span class="_ _23"> </span>the <span class="_ _42"> </span>array<span class="_ _4"></span><span class="ls10b5">.N<span class="_ _7"></span><span class="ls0">ull <span class="_ _42"> </span>pointers <span class="_ _23"> </span>in <span class="_ _42"> </span>the <span class="_ _23"> </span>array <span class="_ _42"> </span>are</span></span></div><div class="t m0 x32 h49 y3f0f ff19 fs26 fc0 sc0 ls0 ws0">skipped; <span class="_ _53"> </span>the <span class="_ _e"> </span>other <span class="_ _e"> </span>entries <span class="_ _53"> </span>must <span class="_ _e"> </span>point <span class="_ _e"> </span>to <span class="_ _53"> </span>AIO <span class="_ _e"> </span>control <span class="_ _53"> </span>blocks <span class="_ _e"> </span>that <span class="_ _53"> </span>have <span class="_ _e"> </span>been <span class="_ _e"> </span>used <span class="_ _e"> </span>to</div><div class="t m0 x32 h49 y3f10 ff19 fs26 fc0 sc0 ls0 ws0">initiate asynchronous I/O operations.</div><div class="t m0 x3f h49 y3f11 ff19 fs26 fc0 sc0 ls0 ws0">When <span class="_ _23"> </span>we <span class="_ _42"> </span>have <span class="_ _42"> </span>pending <span class="_ _23"> </span>asynchronous <span class="_ _23"> </span>I/O <span class="_ _42"> </span>operations <span class="_ _42"> </span>that <span class="_ _23"> </span>we <span class="_ _42"> </span>no <span class="_ _23"> </span>longer <span class="_ _42"> </span>want <span class="_ _42"> </span>to</div><div class="t m0 x32 h4d y3f12 ff19 fs26 fc0 sc0 ls0 ws0">complete, we can attempt to cancel them with the<span class="_"> </span><span class="ff1a">aio_cancel<span class="_ _80"> </span></span>function.</div><div class="t m0 x3f h4e y3f13 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;aio.h&gt;</div><div class="t m0 x3f h4e y3f14 ff1a fs28 fc0 sc0 ls0 ws0">int aio_cancel(int<span class="_"> </span><span class="ff1b">fd</span><span class="ls1b6">,s<span class="_ _1d"></span><span class="ls0">truct aiocb *<span class="ff1b">aiocb</span>);</span></span></div><div class="t m0 x195 h7c y3f15 ff19 fs28 fc0 sc0 ls0 ws0">Returns: (see following)</div><div class="t m0 x32 h60 y3f16 ff19 fs2c fc0 sc0 ls0 ws0">The<span class="_ _44"> </span><span class="ff1b">fd<span class="_ _44"> </span></span>argument <span class="_ _23"> </span>speciﬁes <span class="_ _53"> </span>the <span class="_ _42"> </span>ﬁle <span class="_ _53"> </span>descriptor <span class="_ _42"> </span>with <span class="_ _42"> </span>the <span class="_ _53"> </span>outstanding <span class="_ _42"> </span>asynchronous <span class="_ _42"> </span>I/O</div><div class="t m0 x32 h54 y3f17 ff19 fs2c fc0 sc0 ls0 ws0">operations. <span class="_ _61"> </span>If<span class="_ _61"> </span>the<span class="_ _16"> </span><span class="ff1b">aiocb<span class="_ _61"> </span></span>argument <span class="_ _47"> </span>is<span class="_ _61"> </span><span class="ff1a">NULL</span><span class="ls10b6">,t<span class="_ _1d"></span><span class="ls0">hen <span class="_ _47"> </span>the <span class="_ _47"> </span>system <span class="_ _47"> </span>attempts <span class="_ _66"> </span>to <span class="_ _47"> </span>cancel <span class="_ _47"> </span>all</span></span></div><div class="t m0 x32 h55 y3f18 ff19 fs2c fc0 sc0 ls0 ws0">outstanding <span class="_ _9"></span>asynchronous <span class="_ _9"></span>I/O <span class="_ _23"></span>operations <span class="_ _9"></span>on <span class="_ _9"></span>the <span class="_ _23"></span>ﬁle.<span class="_ _5a"> </span>Otherwise, <span class="_ _23"></span>the <span class="_ _9"></span>system <span class="_ _9"></span>attempts</div><div class="t m0 x32 h55 y3f19 ff19 fs2c fc0 sc0 ls0 ws0">to <span class="_ _42"> </span>cancel <span class="_ _23"> </span>the <span class="_ _42"> </span>single <span class="_ _42"> </span>asynchronous <span class="_ _23"> </span>I/O <span class="_ _42"> </span>operation <span class="_ _42"> </span>described <span class="_ _42"> </span>by <span class="_ _42"> </span>the <span class="_ _42"> </span>AIO <span class="_ _23"> </span>control <span class="_ _42"> </span>block.</div><div class="t m0 x32 h55 y3f1a ff19 fs2c fc0 sc0 ls155 ws0">We <span class="_ _46"> </span>s<span class="_ _9"></span><span class="ls0">ay <span class="_ _45"> </span>that <span class="_ _45"> </span>the <span class="_ _47"> </span>system <span class="_ _45"> </span>‘<span class="_ _0"></span>‘attempts’<span class="_ _1"></span>’<span class="_ _5a"> </span>to<span class="_ _5a"> </span>cancel <span class="_ _45"> </span>the <span class="_ _47"> </span>operations, <span class="_ _45"> </span>because <span class="_ _45"> </span>there<span class="_ _61"> </span>is<span class="_ _5a"> </span>no</span></div><div class="t m0 x32 h55 y3f1b ff19 fs2c fc0 sc0 ls0 ws0">guarantee that the system will be able to cancel any operations that are<span class="_"> </span>in<span class="_"> </span>p<span class="ls150">ro</span>gress.</div><div class="t m0 x3f h54 y3f1c ff19 fs2c fc0 sc0 ls0 ws0">The<span class="_"> </span><span class="ff1a">aio_cancel<span class="_ _80"> </span></span>function can return one of four values:</div><div class="t m0 x3f h54 y3f1d ff1a fs2c fc0 sc0 ls0 ws0">AIO_ALLDONE<span class="_ _20"> </span><span class="ff19">All <span class="_ _9"></span>of <span class="_ _9"></span>the <span class="_ _23"></span>operations <span class="_ _9"></span>completed <span class="_ _23"></span>befor<span class="ls10b7">et<span class="_ _43"></span><span class="ls0">he <span class="_ _23"></span>attempt <span class="_ _9"></span>to <span class="_ _9"></span>cancel</span></span></span></div><div class="t m0 x6b h55 y3f1e ff19 fs2c fc0 sc0 ls0 ws0">them.</div><div class="t m0 x3f h54 y3f1f ff1a fs2c fc0 sc0 ls0 ws0">AIO_CANCELED<span class="_ _12e"> </span><span class="ff19">All of the requested operations have been canceled.</span></div><div class="t m0 x3f h54 y3f20 ff1a fs2c fc0 sc0 ls0 ws0">AIO_NOTCANCELED<span class="_ _5c"> </span><span class="ff19">At <span class="_ _4b"> </span>least <span class="_ _59"> </span>one <span class="_ _4b"> </span>of <span class="_ _4b"> </span>the <span class="_ _4b"> </span>requested <span class="_ _4b"> </span>operations <span class="_ _4b"> </span>could <span class="_ _4b"> </span>not <span class="_ _4b"> </span>be</span></div><div class="t m0 x6b h55 y3f21 ff19 fs2c fc0 sc0 ls0 ws0">canceled.</div><div class="t m0 x3f h54 y3f22 ff20 fs2c fc0 sc0 ls0 ws0">−<span class="ff19 ls10b8">1T<span class="_ _2a9"></span><span class="ls0">he <span class="_ _2"></span>call <span class="_ _2"></span>to<span class="_ _66"> </span><span class="ff1a">aio_cancel<span class="_ _47"> </span></span>failed. <span class="_ _66"> </span>The<span class="_ _47"> </span>error code <span class="_ _2"></span>will <span class="_ _2"></span>be <span class="_ _2"></span>stored</span></span></div><div class="t m0 x6b h54 y3f23 ff19 fs2c fc0 sc0 ls0 ws0">in<span class="_"> </span><span class="ff1a">errno</span>.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
