<div id="pf2f7" class="pf w4 h1f" data-page-no="2f7"><div class="pc pc2f7 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg2f7.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>19.3<span class="_ _31"> </span>Opening <span class="_"> </span>Pseudo-T<span class="_ _4"></span>erminal <span class="_"> </span>Devices<span class="_ _1b"> </span><span class="ff18">725</span></div><div class="t m0 x32 h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h57 y426 ff1a fs2d fc0 sc0 ls0 ws0">ptym_open(char *pts_name, int pts_namesz)</div><div class="t m0 x32 h57 y800 ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y801 ff1a fs2d fc0 sc0 ls0 ws0">char <span class="_ _68"> </span>*ptr;</div><div class="t m0 x8a h57 y802 ff1a fs2d fc0 sc0 ls0 ws0">int <span class="_ _15"> </span>fdm,<span class="_"> </span>err;</div><div class="t m0 x8a h57 yaeb ff1a fs2d fc0 sc0 ls0 ws0">if ((fdm = posix_openpt(O_RDWR)) &lt; 0)</div><div class="t m0 x9d h57 y16f9 ff1a fs2d fc0 sc0 ls0 ws0">return(-1);</div><div class="t m0 x8a h57 y16df ff1a fs2d fc0 sc0 ls0 ws0">if (grantpt(fdm) &lt; 0)<span class="_ _b7"> </span>/* grant access to slave */</div><div class="t m0 x9d h57 y16e0 ff1a fs2d fc0 sc0 ls0 ws0">goto errout;</div><div class="t m0 x8a h57 y16e1 ff1a fs2d fc0 sc0 ls0 ws0">if (unlockpt(fdm) &lt; 0)<span class="_ _189"> </span>/* clear slave’s lock flag */</div><div class="t m0 x9d h57 y16e2 ff1a fs2d fc0 sc0 ls0 ws0">goto errout;</div><div class="t m0 x8a h57 y16e3 ff1a fs2d fc0 sc0 ls0 ws0">if ((ptr = ptsname(fdm)) == NULL)<span class="_ _68"> </span>/* get slave’s name */</div><div class="t m0 x9d h57 y16e4 ff1a fs2d fc0 sc0 ls0 ws0">goto errout;</div><div class="t m0 x8a h57 y3411 ff1a fs2d fc0 sc0 ls0 ws0">/*</div><div class="t m0 x214 h57 y3412 ff1a fs2d fc0 sc0 ls15c ws0">*R<span class="_ _1d"></span><span class="ls0">eturn name of slave.<span class="_ _3a"> </span>Null terminate to handle</span></div><div class="t m0 x214 h57 y3811 ff1a fs2d fc0 sc0 ls15c ws0">*c<span class="_ _1d"></span><span class="ls0">ase where strlen(ptr) &gt; pts_namesz.</span></div><div class="t m0 x214 h57 y3812 ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 x8a h57 y3813 ff1a fs2d fc0 sc0 ls0 ws0">strncpy(pts_name, ptr, pts_namesz);</div><div class="t m0 x8a h57 y3814 ff1a fs2d fc0 sc0 ls0 ws0">pts_name[pts_namesz - 1] = ’\0’;</div><div class="t m0 x8a h57 y16eb ff1a fs2d fc0 sc0 ls0 ws0">return(fdm); <span class="_ _bd"> </span>/*<span class="_"> </span>return fd of master */</div><div class="t m0 x32 h57 y16ec ff1a fs2d fc0 sc0 ls0 ws0">errout:</div><div class="t m0 x8a h57 y8e2 ff1a fs2d fc0 sc0 ls0 ws0">err = errno;</div><div class="t m0 x8a h57 y8e3 ff1a fs2d fc0 sc0 ls0 ws0">close(fdm);</div><div class="t m0 x8a h57 y8e4 ff1a fs2d fc0 sc0 ls0 ws0">errno = err;</div><div class="t m0 x8a h57 y8e5 ff1a fs2d fc0 sc0 ls0 ws0">return(-1);</div><div class="t m0 x32 h57 y2f78 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h57 y3382 ff1a fs2d fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h57 y3383 ff1a fs2d fc0 sc0 ls0 ws0">ptys_open(char *pts_name)</div><div class="t m0 x32 h57 y3384 ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y3385 ff1a fs2d fc0 sc0 ls0 ws0">int fds;</div><div class="t m0 x32 h57 y3386 ff1a fs2d fc0 sc0 ls0 ws0">#if defined(SOLARIS)</div><div class="t m0 x8a h57 y3387 ff1a fs2d fc0 sc0 ls0 ws0">int err, setup;</div><div class="t m0 x32 h57 y3388 ff1a fs2d fc0 sc0 ls0 ws0">#endif</div><div class="t m0 x8a h57 y341d ff1a fs2d fc0 sc0 ls0 ws0">if ((fds = open(pts_name, O_RDWR)) &lt; 0)</div><div class="t m0 x9d h57 y338a ff1a fs2d fc0 sc0 ls0 ws0">return(-1);</div><div class="t m0 x32 h57 y335d ff1a fs2d fc0 sc0 ls0 ws0">#if defined(SOLARIS)</div><div class="t m0 x8a h57 y335e ff1a fs2d fc0 sc0 ls0 ws0">/*</div><div class="t m0 x214 h57 y335f ff1a fs2d fc0 sc0 ls15c ws0">*C<span class="_ _1d"></span><span class="ls0">heck if stream is already set up by autopush facility.</span></div><div class="t m0 x214 h57 y3360 ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 x8a h57 y3361 ff1a fs2d fc0 sc0 ls0 ws0">if ((setup = ioctl(fds, I_FIND, &quot;ldterm&quot;)) &lt; 0)</div><div class="t m0 x9d h57 y3362 ff1a fs2d fc0 sc0 ls0 ws0">goto errout;</div><div class="t m0 x8a h57 y53b5 ff1a fs2d fc0 sc0 ls0 ws0">if (setup == 0) {</div><div class="t m0 x9d h57 y5134 ff1a fs2d fc0 sc0 ls0 ws0">if (ioctl(fds, I_PUSH, &quot;ptem&quot;) &lt; 0)</div><div class="t m0 x1f h57 y5135 ff1a fs2d fc0 sc0 ls0 ws0">goto errout;</div><div class="t m0 x9d h57 y5136 ff1a fs2d fc0 sc0 ls0 ws0">if (ioctl(fds, I_PUSH, &quot;ldterm&quot;) &lt; 0)</div><div class="t m0 x1f h57 y5137 ff1a fs2d fc0 sc0 ls0 ws0">goto errout;</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
