<div id="pf21c" class="pf w4 h1f" data-page-no="21c"><div class="pc pc21c w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg21c.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">506<span class="_ _1b"> </span><span class="ff19">Advanced <span class="_"> </span>I/O<span class="_ _16b"> </span>Chapter <span class="_"> </span>14</span></div><div class="t m0 x32 h2a y12f ff19 fsf fc0 sc0 ls0 ws0">It <span class="_ _e"> </span>is <span class="_ _e"> </span>important <span class="_ _e"> </span>to <span class="_ _e"> </span>realize <span class="_ _53"> </span>that <span class="_ _e"> </span>whether <span class="_ _e"> </span>a <span class="_ _e"> </span>descriptor <span class="_ _e"> </span>is <span class="_ _e"> </span>blocking <span class="_ _e"> </span>or <span class="_ _e"> </span>not <span class="_ _e"> </span>doesn’t <span class="_ _e"> </span>affect</div><div class="t m0 x32 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">whether<span class="_ _45"> </span><span class="ff1a">select<span class="_ _45"> </span></span>blocks. <span class="_ _47"> </span>That<span class="_ _45"> </span>is, <span class="_ _9"></span>if <span class="_ _9"></span>we <span class="_ _9"></span>have <span class="_ _9"></span>a <span class="_ _9"></span>nonblocking <span class="_ _9"></span>descriptor <span class="_ _9"></span>that <span class="_ _9"></span>we <span class="_ _9"></span>want <span class="_ _9"></span>to</div><div class="t m0 x32 h26 y131 ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">ad <span class="_ _2"></span>from and we <span class="_ _2"></span>call<span class="_"> </span><span class="ff1a">select<span class="_ _66"> </span></span>with <span class="_ _2"></span>a timeout <span class="_ _2"></span>value of <span class="_ _2"></span>5 seconds,<span class="_ _66"> </span><span class="ff1a">select<span class="_ _66"> </span></span>will <span class="_ _2"></span>block for</span></div><div class="t m0 x32 h26 y132 ff19 fsf fc0 sc0 ls0 ws0">up to <span class="_ _2"></span>5 <span class="_ _2"></span>seconds.<span class="_ _61"> </span>Similarly<span class="_ _4"></span>,<span class="_ _47"> </span>if<span class="_"> </span>we<span class="_ _66"> </span>s<span class="_ _2"></span>pecify an <span class="_ _2"></span>inﬁnite <span class="_ _2"></span>timeout,<span class="_ _66"> </span><span class="ff1a">select<span class="_ _47"> </span></span>blocks until <span class="_ _2"></span>data <span class="_ _2"></span>is</div><div class="t m0 x32 h2a y133 ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">ady for the descriptor or until a signal is caught.</span></div><div class="t m0 x3f h2a y134 ff19 fsf fc0 sc0 ls0 ws0">If we encounter the end of ﬁle <span class="_ _2"></span>on a descriptor<span class="_ _1"></span><span class="ls1074">,t<span class="_ _d"></span><span class="ls0">hat descriptor is considered readable</span></span></div><div class="t m0 x32 h26 y135 ff19 fsf fc0 sc0 ls0 ws0">by<span class="_"> </span><span class="ff1a">select</span><span class="ls461">.W<span class="_ _26"></span><span class="ls88e">et<span class="_ _d"></span><span class="ls0">hen <span class="_ _2"></span>call<span class="_"> </span><span class="ff1a">read<span class="_ _66"> </span></span>and <span class="_ _2"></span>it returns 0<span class="_ _9"></span><span class="ls9d">—t<span class="_ _6"></span><span class="ls0">he <span class="_ _2"></span>way <span class="_ _2"></span>to signify <span class="_ _2"></span>end of <span class="_ _2"></span>ﬁle on <span class="_ _2"></span>UNIX</span></span></span></span></span></div><div class="t m0 x32 h26 y136 ff19 fsf fc0 sc0 ls0 ws0">systems. <span class="_ _65"> </span>(Many<span class="_ _48"> </span>people <span class="_ _59"> </span>incorrectly <span class="_ _4b"> </span>assume <span class="_ _4b"> </span>that<span class="_ _48"> </span><span class="ff1a">select<span class="_ _48"> </span></span>indicates <span class="_ _59"> </span>an <span class="_ _4b"> </span>exception</div><div class="t m0 x32 h2a y137 ff19 fsf fc0 sc0 ls0 ws0">condition on a descriptor when the end of ﬁle is reached.)</div><div class="t m0 x3f h26 y138 ff19 fsf fc0 sc0 ls0 ws0">POSIX.1 also deﬁnes a variant of<span class="_"> </span><span class="ff1a">select<span class="_ _80"> </span></span>called<span class="_"> </span><span class="ff1a">pselect</span>.</div><div class="t m0 x3f h57 y35f1 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;sys/select.h&gt;</div><div class="t m0 x3f h57 y35f2 ff1a fs2d fc0 sc0 ls0 ws0">int pselect(int<span class="_"> </span><span class="ff1b">maxfdp1</span><span class="ls15c">,f<span class="_ _1d"></span><span class="ls0">d_set *restrict<span class="_"> </span><span class="ff1b ls1e7">re<span class="_ _2"></span><span class="ls0">adfds</span></span>,</span></span></div><div class="t m0 xda h57 y35f3 ff1a fs2d fc0 sc0 ls0 ws0">fd_set *restrict<span class="_"> </span><span class="ff1b">writefds</span><span class="ls15c">,f<span class="_ _1d"></span><span class="ls0">d_set *restrict<span class="_"> </span><span class="ff1b">exceptfds</span>,</span></span></div><div class="t m0 xda h57 y35f4 ff1a fs2d fc0 sc0 ls0 ws0">const struct timespec *restrict<span class="_"> </span><span class="ff1b">tsptr</span>,</div><div class="t m0 xda h57 y3e09 ff1a fs2d fc0 sc0 ls0 ws0">const sigset_t *restrict<span class="_"> </span><span class="ff1b">sigmask</span>);</div><div class="t m0 xb7 h5f y35f6 ff19 fs2d fc0 sc0 ls0 ws0">Returns: count of ready descriptors, 0 on timeout,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>err<span class="_ _0"></span>or</div><div class="t m0 x32 h4d y3e0a ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_"> </span><span class="ff1a">pselect<span class="_ _80"> </span></span>function is identical to<span class="_"> </span><span class="ff1a">select</span><span class="lsd3">,w<span class="_ _5"></span><span class="ls0">ith the following exceptions.</span></span></div><div class="t m0 x3f h4d y3e0b ff19 fs26 fc0 sc0 ls15d ws0">•T<span class="_ _4d"></span><span class="ls0">he <span class="_"> </span>timeout <span class="_ _e"> </span>value <span class="_"> </span>for<span class="_ _59"> </span><span class="ff1a">select<span class="_ _59"> </span></span>is <span class="_"> </span>speciﬁed <span class="_"> </span>by <span class="_"> </span>a<span class="_ _4b"> </span><span class="ff1a">timeval<span class="_ _46"> </span></span>structur<span class="_ _0"></span>e, <span class="_"> </span>but <span class="_"> </span>for</span></div><div class="t m0 x15 h4d y3e0c ff1a fs26 fc0 sc0 ls0 ws0">pselect<span class="ff19 ls1075">,a</span>timespec<span class="_ _66"> </span><span class="ff19">structur<span class="_ _0"></span>e<span class="_"> </span>is<span class="_ _66"> </span>used. <span class="_"> </span>(Recall<span class="_ _66"> </span>the <span class="_ _2"></span>deﬁnition of <span class="_ _2"></span>the<span class="_"> </span><span class="ff1a">timespec</span></span></div><div class="t m0 x15 h4d y3e0d ff19 fs26 fc0 sc0 ls0 ws0">structur<span class="_ _0"></span>e<span class="_ _35"> </span>in<span class="_ _35"> </span>Section <span class="_ _23"></span>4.2.)<span class="_ _51"> </span>Instead <span class="_ _23"> </span>of <span class="_ _23"> </span>seconds <span class="_ _23"> </span>and <span class="_ _42"> </span>micr<span class="_ _0"></span>oseconds, <span class="_ _23"> </span>the<span class="_ _35"> </span><span class="ff1a">timespec</span></div><div class="t m0 x15 h49 y3e0e ff19 fs26 fc0 sc0 ls0 ws0">structur<span class="_ _0"></span><span class="ls1076">er<span class="_ _52"></span><span class="ls0">epresents <span class="_ _35"> </span>the <span class="_ _35"> </span>timeout <span class="_ _35"> </span>value <span class="_ _35"> </span>in <span class="_ _35"> </span>seconds <span class="_ _35"> </span>and <span class="_ _44"> </span>nanoseconds.<span class="_ _5c"> </span>This</span></span></div><div class="t m0 x15 h49 y3e0f ff19 fs26 fc0 sc0 ls0 ws0">provides a <span class="_ _3"></span>higher-resolution timeout <span class="_ _3"></span>if <span class="_ _2"></span>the <span class="_ _3"></span>platform <span class="_ _3"></span>supports <span class="_ _2"></span>that <span class="_ _3"></span>ﬁne <span class="_ _2"></span>a <span class="_ _3"></span>level <span class="_ _3"></span>of</div><div class="t m0 x15 h49 y3e10 ff19 fs26 fc0 sc0 ls0 ws0">granularity<span class="_ _4"></span>.</div><div class="t m0 x3f h4d y3e11 ff19 fs26 fc0 sc0 ls15d ws0">•T<span class="_ _4d"></span><span class="ls0">he <span class="_ _3"></span>timeout <span class="_ _9"></span>value <span class="_ _3"></span>for<span class="_ _47"> </span><span class="ff1a">pselect<span class="_ _45"> </span></span>is <span class="_ _3"></span>declared<span class="_ _47"> </span><span class="ff1a">const</span><span class="ls1077">,a<span class="_ _8"></span><span class="ls0">nd <span class="_ _3"></span>we <span class="_ _9"></span>ar<span class="ls1078">eg<span class="_ _b"></span><span class="ls0">uaranteed <span class="_ _3"></span>that</span></span></span></span></span></div><div class="t m0 x15 h4d y3e12 ff19 fs26 fc0 sc0 ls0 ws0">its value will not change as a result of calling<span class="_"> </span><span class="ff1a">pselect</span>.</div><div class="t m0 x3f h4d y3e13 ff19 fs26 fc0 sc0 ls15d ws0">•A<span class="_ _4d"></span><span class="ls1079">no<span class="_ _4a"></span><span class="ls0">ptional <span class="_"> </span>signal <span class="_"> </span>mask <span class="_ _e"> </span>argument <span class="_ _e"> </span>is <span class="_"> </span>available <span class="_"> </span>with<span class="_ _59"> </span><span class="ff1a">pselect</span><span class="ls107a">.I<span class="_ _5d"></span><span class="ls0">f<span class="_ _59"> </span><span class="ff1b">sigmask<span class="_ _59"> </span></span>is</span></span></span></span></div><div class="t m0 x15 h4d y3e14 ff1a fs26 fc0 sc0 ls0 ws0">NULL<span class="ff19">,<span class="_ _44"> </span></span>pselect<span class="_ _44"> </span><span class="ff19">behaves <span class="_ _53"> </span>as<span class="_ _44"> </span></span>select<span class="_ _4b"> </span><span class="ff19">does <span class="_ _42"> </span>with <span class="_ _53"> </span>respect <span class="_ _42"> </span>to <span class="_ _53"> </span>signals.<span class="_ _54"> </span>Otherwise,</span></div><div class="t m0 x15 h4d y3e15 ff1b fs26 fc0 sc0 ls0 ws0">sigmask<span class="_ _44"> </span><span class="ff19">points <span class="_ _53"> </span>to <span class="_ _42"> </span>a <span class="_ _53"> </span>signal <span class="_ _53"> </span>mask <span class="_ _42"> </span>that <span class="_ _53"> </span>is <span class="_ _53"> </span>atomically <span class="_ _53"> </span>installed <span class="_ _42"> </span>when<span class="_ _4b"> </span><span class="ff1a">pselect<span class="_ _44"> </span></span>is</span></div><div class="t m0 x15 h49 y3e16 ff19 fs26 fc0 sc0 ls0 ws0">called. <span class="_"> </span>On<span class="_"> </span><span class="lscc">re</span>turn, the previous signal mask is restor<span class="_ _0"></span>ed.</div><div class="t m0 x32 h7b y3e17 ff16 fs27 fc0 sc0 ls0 ws0">14.4.2<span class="_ _5e"> </span><span class="ff1f">poll<span class="_ _54"> </span></span>Function</div><div class="t m0 x32 h4d y3e18 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_"> </span><span class="ff1a">poll<span class="_ _66"> </span></span>function <span class="_ _2"></span>is <span class="_ _2"></span>similar to<span class="_ _66"> </span><span class="ff1a">select</span><span class="ls107b">,b<span class="_ _d"></span><span class="ls0">ut <span class="_ _2"></span>the programmer interface <span class="_ _2"></span>is <span class="_ _2"></span>differ<span class="_ _0"></span>ent. <span class="_"> </span>This</span></span></div><div class="t m0 x32 h49 y3e19 ff19 fs26 fc0 sc0 ls0 ws0">function <span class="_ _23"> </span>was <span class="_ _42"> </span>originally <span class="_ _23"> </span>introduced <span class="_ _23"> </span>in <span class="_ _23"> </span>System <span class="_ _42"> </span>V <span class="_ _23"> </span>to <span class="_ _42"> </span>support <span class="_ _23"> </span>the <span class="_ _42"> </span>STREAMS <span class="_ _23"> </span>subsystem,</div><div class="t m0 x32 h49 y3e1a ff19 fs26 fc0 sc0 ls0 ws0">but we ar<span class="lsd3">ea<span class="_ _4f"></span><span class="ls0">ble to use it with any type of ﬁle descriptor<span class="_ _1"></span>.</span></span></div><div class="t m0 x3f h4e y3e1b ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;poll.h&gt;</div><div class="t m0 x3f h4e y3e1c ff1a fs28 fc0 sc0 ls0 ws0">int poll(struct pollfd<span class="_"> </span><span class="ff1b">fdarray</span>[], nfds_t<span class="_"> </span><span class="ff1b">nfds</span><span class="ls1b6">,i<span class="_ _1d"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">timeout</span>);</span></span></div><div class="t m0 xb7 h7c y3e1d ff19 fs28 fc0 sc0 ls0 ws0">Returns: count of ready descriptors, 0 on timeout,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>err<span class="_ _0"></span>or</div><a class="l" href="#pf11" data-dest-detail='[17,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:156.492009px;bottom:365.796907px;width:129.502991px;height:19.680008px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
