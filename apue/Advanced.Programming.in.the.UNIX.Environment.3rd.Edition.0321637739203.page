<div id="pfcb" class="pf w4 h1f" data-page-no="cb"><div class="pc pccb w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bgcb.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>5.13<span class="_ _f0"> </span><span class="ls719">Te<span class="_ _9"></span></span>mporary <span class="_"> </span>Files<span class="_ _1b"> </span><span class="ff18">169</span></div><div class="t m0 x32 h2a y12f ff19 fsf fc0 sc0 ls0 ws0">If we execute the program in Figur<span class="_ _0"></span><span class="ls44">e5<span class="_ _d"></span><span class="ls0">.12, we get</span></span></div><div class="t m0 x3f h57 ya9b ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">./a.out</span></div><div class="t m0 x3f h57 yac1 ff1a fs2d fc0 sc0 ls0 ws0">/tmp/fileT0Hsu6</div><div class="t m0 x3f h57 yac2 ff1a fs2d fc0 sc0 ls0 ws0">/tmp/filekmAsYQ</div><div class="t m0 x3f h57 yac3 ff1a fs2d fc0 sc0 ls0 ws0">one line of output</div><div class="t m0 x3f h4d y1759 ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _9"></span>standar<span class="ls727">dt<span class="_ _b"></span><span class="ls0">echnique <span class="_ _9"></span>often <span class="_ _23"></span>used <span class="_ _23"></span>by <span class="_ _9"></span>the<span class="_ _35"> </span><span class="ff1a">tmpfile<span class="_ _45"> </span></span>function <span class="_ _23"></span>is <span class="_ _9"></span>to <span class="_ _23"> </span>create <span class="_ _9"></span>a <span class="_ _23"></span>unique</span></span></div><div class="t m0 x32 h4d y175a ff19 fs26 fc0 sc0 ls0 ws0">pathname <span class="_ _23"></span>by <span class="_ _9"></span>calling<span class="_ _35"> </span><span class="ff1a">tmpnam</span><span class="ls728">,t<span class="_ _b"></span><span class="ls0">hen <span class="_ _9"></span>create <span class="_ _23"></span>the <span class="_ _9"></span>ﬁle, <span class="_ _23"> </span>and <span class="_ _23"> </span>immediately<span class="_ _35"> </span><span class="ff1a">unlink<span class="_ _45"> </span></span>it. <span class="_ _35"> </span>Recall</span></span></div><div class="t m0 x32 h49 y175b ff19 fs26 fc0 sc0 ls0 ws0">from Section <span class="_ _2"></span>4.15 <span class="_ _2"></span>that <span class="_ _2"></span>unlinking <span class="_ _2"></span>a <span class="_ _2"></span>ﬁle <span class="_ _2"></span>does <span class="_ _2"></span>not <span class="_ _2"></span>delete <span class="_ _2"></span>its <span class="_ _2"></span>contents <span class="_ _2"></span>until <span class="_ _2"></span>the <span class="_ _2"></span>ﬁle <span class="_ _2"></span>is <span class="_ _2"></span>closed.</div><div class="t m0 x32 h49 y175c ff19 fs26 fc0 sc0 ls0 ws0">This <span class="_"> </span>way<span class="_ _6"></span><span class="ls729">,w<span class="_ _5b"></span><span class="ls0">hen <span class="_"> </span>the <span class="_ _66"> </span>ﬁle <span class="_ _66"> </span>is <span class="_ _66"> </span>closed, <span class="_ _66"> </span>either <span class="_"> </span>explicitly <span class="_ _66"> </span>or <span class="_ _66"> </span>on <span class="_ _66"> </span>program <span class="_"> </span>termination, <span class="_"> </span>the</span></span></div><div class="t m0 x32 h49 y175d ff19 fs26 fc0 sc0 ls0 ws0">contents of the ﬁle ar<span class="lsd3">ed<span class="_ _4f"></span><span class="ls0">eleted.</span></span></div><div class="t m0 x3f h49 y175e ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _23"></span>Single <span class="_ _23"></span>UNIX <span class="_ _23"></span>Speciﬁcation <span class="_ _23"></span>deﬁnes <span class="_ _23"></span>two <span class="_ _23"> </span>additional <span class="_ _23"> </span>functions <span class="_ _23"> </span>as <span class="_ _23"> </span>part <span class="_ _23"> </span>of <span class="_ _23"> </span>the <span class="_ _23"> </span>XSI</div><div class="t m0 x32 h4d y175f ff19 fs26 fc0 sc0 ls0 ws0">option for dealing with temporary ﬁles:<span class="_"> </span><span class="ff1a">mkdtemp<span class="_ _80"> </span></span>and<span class="_"> </span><span class="ff1a">mkstemp</span>.</div><div class="t m0 x76 h5e y1760 ff19 fs10 fc0 sc0 ls0 ws0">Older <span class="_ _23"> </span>versions <span class="_ _23"> </span>of <span class="_ _23"> </span>the <span class="_ _23"> </span>Single <span class="_ _23"> </span>UNIX <span class="_ _23"> </span>Speciﬁcation <span class="_ _23"> </span>deﬁned <span class="_ _23"> </span>the<span class="_ _45"> </span><span class="ff1a">tempnam<span class="_ _45"> </span></span>function <span class="_ _23"> </span>as <span class="_ _23"> </span>a <span class="_ _23"> </span>way <span class="_ _23"> </span>to</div><div class="t m0 x76 h2d y1761 ff19 fs10 fc0 sc0 ls0 ws0">create a temporary ﬁle in a caller<span class="_ _0"></span>-speciﬁed location.<span class="_ _35"> </span>It is marked obsolescent in SUSv4.</div><div class="t m0 x3f h4e y1762 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;stdlib.h&gt;</div><div class="t m0 x3f h4e y1763 ff1a fs28 fc0 sc0 ls0 ws0">char *mkdtemp(char *<span class="ff1b">template</span>);</div><div class="t m0 xf h4e y1764 ff19 fs28 fc0 sc0 ls0 ws0">Returns: pointer to directory name if OK,<span class="_"> </span><span class="ff1a">NULL<span class="_ _e"> </span></span>on error</div><div class="t m0 x3f h4e y1765 ff1a fs28 fc0 sc0 ls0 ws0">int mkstemp(char *<span class="ff1b">template</span>);</div><div class="t m0 x179 h7c y1766 ff19 fs28 fc0 sc0 ls0 ws0">Returns: ﬁle descriptor if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h54 y1767 ff19 fs2c fc0 sc0 ls0 ws0">The<span class="_ _46"> </span><span class="ff1a">mkdtemp<span class="_ _61"> </span></span>function <span class="_"> </span>creates <span class="_ _66"> </span>a <span class="_ _66"> </span>directory <span class="_"> </span>with <span class="_ _66"> </span>a <span class="_ _47"> </span>unique <span class="_"> </span>name, <span class="_ _66"> </span>and <span class="_ _66"> </span>the<span class="_ _61"> </span><span class="ff1a">mkstemp</span></div><div class="t m0 x32 h55 y1768 ff19 fs2c fc0 sc0 ls0 ws0">function <span class="_ _e"> </span>creates <span class="_ _53"> </span>a <span class="_ _e"> </span>regular <span class="_ _53"> </span>ﬁle <span class="_ _e"> </span>with <span class="_ _e"> </span>a <span class="_ _e"> </span>unique <span class="_ _e"> </span>name.<span class="_ _48"> </span>The <span class="_ _e"> </span>name <span class="_ _e"> </span>is <span class="_ _e"> </span>selected <span class="_ _e"> </span>using <span class="_ _e"> </span>the</div><div class="t m0 x32 h54 y1769 ff1b fs2c fc0 sc0 ls0 ws0">template<span class="_ _45"> </span><span class="ff19">string. <span class="_ _45"> </span>This<span class="_ _35"> </span>string <span class="_ _9"></span>is <span class="_ _9"></span>a <span class="_ _23"></span>pathname <span class="_ _9"></span>whose <span class="_ _23"></span>last <span class="_ _9"></span>six <span class="_ _23"></span>characters <span class="_ _9"></span>ar<span class="ls72a">es<span class="_ _b"></span><span class="ls0">et <span class="_ _9"></span>to<span class="_ _45"> </span><span class="ff1a">XXXXXX</span>.</span></span></span></div><div class="t m0 x32 h55 y176a ff19 fs2c fc0 sc0 ls0 ws0">The <span class="_ _42"> </span>function <span class="_ _53"> </span>replaces <span class="_ _42"> </span>these <span class="_ _53"> </span>placeholders <span class="_ _53"> </span>with <span class="_ _53"> </span>differ<span class="_ _0"></span>ent <span class="_ _42"> </span>characters <span class="_ _53"> </span>to <span class="_ _53"> </span>create <span class="_ _42"> </span>a <span class="_ _53"> </span>unique</div><div class="t m0 x32 h60 y176b ff19 fs2c fc0 sc0 ls0 ws0">pathname. <span class="_"> </span>If<span class="_"> </span>successful, these functions modify <span class="_ _2"></span>the<span class="_"> </span><span class="ff1b">template<span class="_"> </span></span>string to reﬂect the name of</div><div class="t m0 x32 h55 y176c ff19 fs2c fc0 sc0 ls0 ws0">the temporary ﬁle.</div><div class="t m0 x3f h54 y176d ff19 fs2c fc0 sc0 ls0 ws0">The <span class="_ _9"></span>directory <span class="_ _3"></span>created <span class="_ _9"></span>by<span class="_ _45"> </span><span class="ff1a">mkdtemp<span class="_ _45"> </span></span>is <span class="_ _9"></span>created <span class="_ _9"></span>with <span class="_ _9"></span>the <span class="_ _9"></span>following <span class="_ _9"></span>access <span class="_ _9"></span>permission</div><div class="t m0 x32 h54 y176e ff19 fs2c fc0 sc0 ls0 ws0">bits <span class="_ _2"></span>set:<span class="_ _47"> </span><span class="ff1a">S_IRUSR <span class="_ _b"></span>| <span class="_ _b"></span>S_IWUSR <span class="_ _b"></span>| <span class="_ _b"></span>S_IXUSR<span class="ff19 ls72b">.N<span class="_ _62"></span><span class="ls0">ote <span class="_ _3"></span>that <span class="_ _3"></span>the <span class="_ _2"></span>ﬁle <span class="_ _3"></span>mode <span class="_ _3"></span>creation <span class="_ _2"></span>mask <span class="_ _3"></span>of <span class="_ _2"></span>the</span></span></span></div><div class="t m0 x32 h55 y176f ff19 fs2c fc0 sc0 ls0 ws0">calling <span class="_ _3"></span>process <span class="_ _2"></span>can <span class="_ _3"></span>restrict <span class="_ _2"></span>these <span class="_ _3"></span>permissions <span class="_ _3"></span>further<span class="_ _1"></span><span class="ls72c">.I<span class="_ _1d"></span><span class="ls72d">fd<span class="_ _8"></span><span class="ls0">irectory <span class="_ _2"></span>creation <span class="_ _3"></span>is <span class="_ _3"></span>successful,</span></span></span></div><div class="t m0 x32 h54 y1770 ff1a fs2c fc0 sc0 ls0 ws0">mkdtemp<span class="_ _80"> </span><span class="ff19 ls150">re<span class="_ _2"></span><span class="ls0">turns the name of the new directory<span class="_ _4"></span>.</span></span></div><div class="t m0 x3f h54 y1771 ff19 fs2c fc0 sc0 ls0 ws0">The<span class="_ _47"> </span><span class="ff1a">mkstemp<span class="_ _47"> </span></span>function <span class="_ _3"></span>creates <span class="_ _3"></span>a <span class="_ _3"></span>regular <span class="_ _2"></span>ﬁle <span class="_ _9"></span>with <span class="_ _3"></span>a <span class="_ _3"></span>unique <span class="_ _3"></span>name <span class="_ _3"></span>and <span class="_ _3"></span>opens <span class="_ _3"></span>it.<span class="_ _5a"> </span>The</div><div class="t m0 x32 h54 y1772 ff19 fs2c fc0 sc0 ls0 ws0">ﬁle descriptor returned by<span class="_"> </span><span class="ff1a">mkstemp<span class="_ _80"> </span></span>is open for reading and writing.<span class="_ _59"> </span>The ﬁle created by</div><div class="t m0 x32 h54 y1773 ff1a fs2c fc0 sc0 ls0 ws0">mkstemp<span class="_ _80"> </span><span class="ff19">is created with access permissions<span class="_"> </span></span>S_IRUSR <span class="_ _b"></span>| <span class="_ _b"></span>S_IWUSR<span class="ff19">.</span></div><div class="t m0 x3f h54 y1774 ff19 fs2c fc0 sc0 ls0 ws0">Unlike<span class="_ _60"> </span><span class="ff1a">tmpfile</span><span class="ls72e">,t<span class="_ _49"></span><span class="ls0">he <span class="_ _61"> </span>temporary <span class="_ _61"> </span>ﬁle <span class="_ _46"> </span>created <span class="_ _46"> </span>by<span class="_ _50"> </span><span class="ff1a">mkstemp<span class="_ _60"> </span></span>is <span class="_ _61"> </span>not <span class="_ _61"> </span>removed</span></span></div><div class="t m0 x32 h55 y1775 ff19 fs2c fc0 sc0 ls0 ws0">automatically <span class="_ _2"></span>for <span class="_ _3"></span>us.<span class="_ _16"> </span>If <span class="_ _3"></span>we <span class="_ _3"></span>want <span class="_ _3"></span>to <span class="_ _3"></span>remove <span class="_ _2"></span>it <span class="_ _3"></span>from <span class="_ _2"></span>the <span class="_ _3"></span>ﬁle <span class="_ _3"></span>system <span class="_ _3"></span>namespace, <span class="_ _3"></span>we <span class="_ _2"></span>need</div><div class="t m0 x32 h55 y1776 ff19 fs2c fc0 sc0 ls0 ws0">to unlink it ourselves.</div><div class="t m0 x3f h54 y1777 ff19 fs2c fc0 sc0 ls0 ws0">Use <span class="_ _42"> </span>of<span class="_ _35"> </span><span class="ff1a">tmpnam<span class="_ _44"> </span></span>and<span class="_ _35"> </span><span class="ff1a">tempnam<span class="_ _44"> </span></span>does <span class="_ _42"> </span>have <span class="_ _42"> </span>at <span class="_ _42"> </span>least <span class="_ _42"> </span>one <span class="_ _42"> </span>drawback: <span class="_ _23"> </span>a <span class="_ _42"> </span>window <span class="_ _42"> </span>exists</div><div class="t m0 x32 h55 y1778 ff19 fs2c fc0 sc0 ls0 ws0">between the <span class="_ _2"></span>time <span class="_ _2"></span>that <span class="_ _2"></span>the <span class="_ _2"></span>unique pathname <span class="_ _2"></span>is <span class="_ _2"></span>returned and <span class="_ _2"></span>the <span class="_ _2"></span>time that <span class="_ _2"></span>an <span class="_ _2"></span>application</div><div class="t m0 x32 h55 y1779 ff19 fs2c fc0 sc0 ls0 ws0">creates <span class="_ _2"></span>a <span class="_ _9"></span>ﬁle <span class="_ _3"></span>with <span class="_ _9"></span>that <span class="_ _3"></span>name.<span class="_ _5a"> </span>During <span class="_ _3"></span>this <span class="_ _9"></span>timing <span class="_ _3"></span>window<span class="_ _6"></span><span class="ls72f">,a<span class="_ _8"></span><span class="ls0">nother <span class="_ _3"></span>process <span class="_ _3"></span>can <span class="_ _9"></span>create <span class="_ _2"></span>a</span></span></div><div class="t m0 x32 h54 y177a ff19 fs2c fc0 sc0 ls0 ws0">ﬁle of the <span class="_ _2"></span>same name.<span class="_ _46"> </span>The<span class="_ _66"> </span><span class="ff1a">tmpfile<span class="_ _66"> </span></span>and<span class="_"> </span><span class="ff1a">mkstemp<span class="_ _66"> </span></span>functions should <span class="_ _2"></span>be used <span class="_ _2"></span>instead, as</div><div class="t m0 x32 h55 y177b ff19 fs2c fc0 sc0 ls0 ws0">they don’t suffer fr<span class="_ _0"></span>om this pr<span class="_ _0"></span>oblem.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
