<div id="pf12a" class="pf w4 h1f" data-page-no="12a"><div class="pc pc12a w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg12a.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">264<span class="_ _1b"> </span><span class="ff19">Process <span class="_"> </span>Contr<span class="_ _0"></span>ol <span class="_ _222"> </span>Chapter<span class="_ _4b"> </span>8</span></div><div class="t m0 x41 h26 y12f ff19 fsf fc0 sc0 ls0 ws0">instead <span class="_ _42"> </span>of <span class="_ _53"> </span>needing <span class="_ _53"> </span>to <span class="_ _42"> </span>know <span class="_ _53"> </span>that <span class="_ _53"> </span>the <span class="_ _42"> </span>program <span class="_ _42"> </span>is <span class="_ _53"> </span>really <span class="_ _42"> </span>an<span class="_ _44"> </span><span class="ff1a">awk<span class="_ _44"> </span></span>script <span class="_ _53"> </span>that <span class="_ _53"> </span>we</div><div class="t m0 x41 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">would otherwise have to execute as</div><div class="t m0 x7d h57 y1c09 ff1a fs2d fc0 sc0 ls0 ws0">awk -f awkexample<span class="_"> </span><span class="ff1b">optional-arguments</span></div><div class="t m0 x3f h2a y22cf ff19 fsf fc0 sc0 ls0 ws0">2. <span class="_ _51"> </span>Interpreter <span class="_ _42"> </span>scripts <span class="_ _42"> </span>provide <span class="_ _23"> </span>an <span class="_ _42"> </span>efﬁciency <span class="_ _42"> </span>gain.<span class="_ _54"> </span>Consider <span class="_ _42"> </span>the <span class="_ _42"> </span>previous <span class="_ _23"> </span>example</div><div class="t m0 x41 h26 y22d0 ff19 fsf fc0 sc0 ls0 ws0">again. <span class="_"> </span>W<span class="_ _1"></span><span class="ls74f">ec<span class="_ _4f"></span><span class="ls0">ould <span class="_ _2"></span>still <span class="_ _2"></span>hide <span class="_ _2"></span>that <span class="_ _2"></span>the <span class="_ _2"></span>program is <span class="_ _2"></span>an<span class="_ _66"> </span><span class="ff1a">awk<span class="_ _47"> </span></span>script, by <span class="_ _2"></span>wrapping <span class="_ _2"></span>it <span class="_ _2"></span>in <span class="_ _2"></span>a</span></span></div><div class="t m0 x41 h2a y22d1 ff19 fsf fc0 sc0 ls0 ws0">shell script:</div><div class="t m0 x7d h57 y22d2 ff1a fs2d fc0 sc0 ls0 ws0">awk ’BEGIN {</div><div class="t m0 xb9 h57 y22d3 ff1a fs2d fc0 sc0 ls0 ws0">for (i = 0; i &lt; ARGC; i++)</div><div class="t m0 x1ce h57 y22d4 ff1a fs2d fc0 sc0 ls0 ws0">printf &quot;ARGV[%d] = %s\n&quot;, i, ARGV[i]</div><div class="t m0 xb9 h57 y22d5 ff1a fs2d fc0 sc0 ls0 ws0">exit</div><div class="t m0 x7d h57 y22d6 ff1a fs2d fc0 sc0 ls0 ws0">}’ $*</div><div class="t m0 x41 h2a y22d7 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _42"> </span>pr<span class="_ _0"></span>oblem <span class="_ _42"> </span>with <span class="_ _23"> </span>this <span class="_ _42"> </span>solution <span class="_ _42"> </span>is <span class="_ _42"> </span>that <span class="_ _23"> </span>mor<span class="lsa42">ew<span class="_ _43"></span><span class="ls0">ork <span class="_ _23"> </span>is <span class="_ _42"> </span>required. <span class="_ _35"> </span>First,<span class="_ _35"> </span>the <span class="_ _42"> </span>shell</span></span></div><div class="t m0 x41 h26 y22d8 ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">ads <span class="_ _2"></span>the command and <span class="_ _2"></span>tries to<span class="_"> </span><span class="ff1a">execlp<span class="_ _66"> </span></span>the ﬁlename.<span class="_ _61"> </span>Because the shell <span class="_ _2"></span>script is</span></div><div class="t m0 x41 h2a y22d9 ff19 fsf fc0 sc0 ls0 ws0">an <span class="_ _66"> </span>executable <span class="_ _47"> </span>ﬁle <span class="_"> </span>but <span class="_ _47"> </span>isn’t <span class="_ _66"> </span>a <span class="_ _66"> </span>machine <span class="_ _47"> </span>executable, <span class="_ _66"> </span>an <span class="_ _47"> </span>error <span class="_"> </span>is <span class="_ _66"> </span>returned <span class="_ _66"> </span>and</div><div class="t m0 x41 h26 y22da ff1a fsf fc0 sc0 ls0 ws0">execlp<span class="_ _35"> </span><span class="ff19">assumes <span class="_ _42"> </span>that <span class="_ _42"> </span>the <span class="_ _42"> </span>ﬁle <span class="_ _42"> </span>is <span class="_ _23"> </span>a <span class="_ _42"> </span>shell <span class="_ _42"> </span>script <span class="_ _42"> </span>(which <span class="_ _42"> </span>it <span class="_ _42"> </span>is).<span class="_ _51"> </span>Then<span class="_ _44"> </span></span>/bin/sh<span class="_ _35"> </span><span class="ff19">is</span></div><div class="t m0 x41 h2a y22db ff19 fsf fc0 sc0 ls0 ws0">executed <span class="_ _66"> </span>with <span class="_ _47"> </span>the <span class="_ _47"> </span>pathname <span class="_ _66"> </span>of <span class="_ _47"> </span>the <span class="_ _66"> </span>shell <span class="_ _47"> </span>script <span class="_ _47"> </span>as <span class="_ _66"> </span>its <span class="_ _47"> </span>argument. <span class="_ _46"> </span>The<span class="_ _61"> </span>shell</div><div class="t m0 x41 h26 y22dc ff19 fsf fc0 sc0 ls0 ws0">correctly <span class="_ _23"> </span>runs <span class="_ _42"> </span>our <span class="_ _23"> </span>script, <span class="_ _42"> </span>but <span class="_ _42"> </span>to <span class="_ _42"> </span>run <span class="_ _23"> </span>the<span class="_ _44"> </span><span class="ff1a">awk<span class="_ _35"> </span></span>program, <span class="_ _23"> </span>the <span class="_ _42"> </span>shell <span class="_ _42"> </span>does <span class="_ _42"> </span>a<span class="_ _35"> </span><span class="ff1a">fork</span>,</div><div class="t m0 x41 h26 y22dd ff1a fsf fc0 sc0 ls0 ws0">exec<span class="ff19 lsa43">,a<span class="_ _26"></span><span class="ls0">nd<span class="_ _5a"> </span><span class="ff1a">wait</span><span class="lsa44">.T<span class="_ _95"></span><span class="ls0">hus <span class="_ _35"> </span>ther<span class="_ _0"></span>e<span class="_ _5a"> </span>is<span class="_ _51"> </span>mor<span class="lsa45">eo<span class="_ _7"></span><span class="ls0">verhead <span class="_ _45"> </span>involved <span class="_ _35"> </span>in <span class="_ _45"> </span>replacing <span class="_ _45"> </span>an</span></span></span></span></span></span></div><div class="t m0 x41 h2a y22de ff19 fsf fc0 sc0 ls0 ws0">interpreter script with a shell script.</div><div class="t m0 x3f h26 y22df ff19 fsf fc0 sc0 ls0 ws0">3. <span class="_ _51"> </span>Interpreter <span class="_ _42"> </span>scripts <span class="_ _53"> </span>let <span class="_ _53"> </span>us <span class="_ _53"> </span>write <span class="_ _53"> </span>shell <span class="_ _53"> </span>scripts <span class="_ _e"> </span>using <span class="_ _53"> </span>shells <span class="_ _53"> </span>other <span class="_ _53"> </span>than<span class="_ _44"> </span><span class="ff1a">/bin/sh</span>.</div><div class="t m0 x41 h26 y22e0 ff19 fsf fc0 sc0 ls0 ws0">When <span class="_ _3"></span>it <span class="_ _9"></span>ﬁnds <span class="_ _3"></span>an <span class="_ _9"></span>executable <span class="_ _3"></span>ﬁle <span class="_ _9"></span>that <span class="_ _9"></span>isn’t <span class="_ _3"></span>a <span class="_ _9"></span>machine <span class="_ _3"></span>executable,<span class="_ _45"> </span><span class="ff1a">execlp<span class="_ _47"> </span></span>has <span class="_ _9"></span>to</div><div class="t m0 x41 h26 y22e1 ff19 fsf fc0 sc0 ls0 ws0">choose <span class="_ _53"> </span>a <span class="_ _e"> </span>shell <span class="_ _53"> </span>to <span class="_ _e"> </span>invoke, <span class="_ _e"> </span>and <span class="_ _53"> </span>it <span class="_ _e"> </span>always <span class="_ _53"> </span>uses<span class="_ _4b"> </span><span class="ff1a">/bin/sh</span><span class="lsa46">.U<span class="_ _52"></span><span class="ls0">sing <span class="_ _53"> </span>an <span class="_ _e"> </span>interpreter</span></span></div><div class="t m0 x41 h2a y22e2 ff19 fsf fc0 sc0 ls0 ws0">script, however<span class="_ _6"></span>,<span class="_"> </span>we<span class="_"> </span>can simply write</div><div class="t m0 x7d h57 y22e3 ff1a fs2d fc0 sc0 ls0 ws0">#!/bin/csh</div><div class="t m0 x7d h58 y22e4 ff1b fs2d fc0 sc0 ls0 ws0">(C shell script follows in the interpreter ﬁle)</div><div class="t m0 x41 h26 y1cb7 ff19 fsf fc0 sc0 ls0 ws0">Again, <span class="_ _3"></span>we <span class="_ _3"></span>could <span class="_ _3"></span>wrap <span class="_ _3"></span>all <span class="_ _3"></span>of <span class="_ _3"></span>this <span class="_ _3"></span>in <span class="_ _3"></span>a<span class="_ _45"> </span><span class="ff1a">/bin/sh<span class="_ _66"> </span></span>script <span class="_ _9"></span>(that <span class="_ _2"></span>invokes <span class="_ _9"></span>the <span class="_ _2"></span>C <span class="_ _9"></span>shell),</div><div class="t m0 x41 h2a y22e5 ff19 fsf fc0 sc0 ls0 ws0">as we described earlier<span class="_ _6"></span><span class="ls44">,b<span class="_ _5"></span><span class="ls0">ut mor<span class="ls44">eo<span class="_ _4f"></span><span class="ls0">verhead is requir<span class="_ _1"></span>ed.</span></span></span></span></div><div class="t m0 x32 h26 y16b ff19 fsf fc0 sc0 ls0 ws0">None of <span class="_ _2"></span>this <span class="_ _2"></span>would work <span class="_ _2"></span>as <span class="_ _2"></span>we’ve <span class="_ _2"></span>shown here<span class="_"> </span>if<span class="_ _66"> </span>the <span class="_ _2"></span>three shells <span class="_ _2"></span>and<span class="_ _66"> </span><span class="ff1a">awk<span class="_ _66"> </span></span>didn’t <span class="_ _2"></span>use <span class="_ _2"></span>the</div><div class="t m0 x32 h2a y16c ff19 fsf fc0 sc0 ls0 ws0">pound sign as their comment character<span class="_ _6"></span>.</div><div class="t m0 x35 h75 y6a8 ff16 fs2b fc0 sc0 ls0 ws0">8.13<span class="_ _6d"> </span><span class="ff1f">system<span class="_ _54"> </span></span>Function</div><div class="t m0 x32 h2a y22e6 ff19 fsf fc0 sc0 ls0 ws0">It <span class="_ _53"> </span>is <span class="_ _53"> </span>convenient <span class="_ _53"> </span>to <span class="_ _53"> </span>execute <span class="_ _53"> </span>a <span class="_ _53"> </span>command <span class="_ _53"> </span>string <span class="_ _53"> </span>from <span class="_ _53"> </span>within <span class="_ _53"> </span>a <span class="_ _53"> </span>program. <span class="_ _44"> </span>For<span class="_ _44"> </span>example,</div><div class="t m0 x32 h2a y22e7 ff19 fsf fc0 sc0 ls0 ws0">assume <span class="_ _2"></span>that <span class="_ _2"></span>we <span class="_ _3"></span>want <span class="_ _2"></span>to <span class="_ _3"></span>put <span class="_ _2"></span>a <span class="_ _2"></span>time-and-date <span class="_ _3"></span>stamp <span class="_ _2"></span>into <span class="_ _3"></span>a <span class="_ _2"></span>certain <span class="_ _2"></span>ﬁle.<span class="_ _16"> </span><span class="ls5f">We <span class="_ _e"> </span>c<span class="_ _23"></span></span>ould <span class="_ _2"></span>use <span class="_ _2"></span>the</div><div class="t m0 x32 h26 y22e8 ff19 fsf fc0 sc0 ls0 ws0">functions described <span class="_ _2"></span>in <span class="_ _2"></span>Section <span class="_ _2"></span>6.10 <span class="_ _2"></span>to <span class="_ _2"></span>do this: <span class="_ _2"></span>call<span class="_ _66"> </span><span class="ff1a">time<span class="_ _47"> </span></span>to get <span class="_ _2"></span>the <span class="_ _2"></span>current calendar <span class="_ _2"></span>time,</div><div class="t m0 x32 h26 y22e9 ff19 fsf fc0 sc0 ls0 ws0">then call<span class="_"> </span><span class="ff1a">localtime<span class="_ _80"> </span></span>to convert it <span class="_ _2"></span>to a broken-down time, then call<span class="_"> </span><span class="ff1a">strftime<span class="_ _80"> </span></span>to format</div><div class="t m0 x32 h2a y22ea ff19 fsf fc0 sc0 ls0 ws0">the result, and ﬁnally write the r<span class="_ _0"></span>esult to the ﬁle.<span class="_ _59"> </span>It is much easier<span class="_ _1"></span><span class="ls44">,h<span class="_ _d"></span><span class="ls0">owever<span class="_ _1"></span>,<span class="_"> </span>to<span class="_"> </span>say</span></span></div><div class="t m0 x3f h57 y22eb ff1a fs2d fc0 sc0 ls0 ws0">system(&quot;date &gt; file&quot;);</div><div class="t m0 x32 h26 y22ec ff19 fsf fc0 sc0 ls0 ws0">ISO <span class="_ _53"> </span>C <span class="_ _53"> </span>deﬁnes <span class="_ _e"> </span>the<span class="_ _44"> </span><span class="ff1a">system<span class="_ _4b"> </span></span>function, <span class="_ _53"> </span>but <span class="_ _e"> </span>its <span class="_ _53"> </span>operation <span class="_ _53"> </span>is <span class="_ _e"> </span>strongly <span class="_ _42"> </span>system <span class="_ _e"> </span>dependent.</div><div class="t m0 x32 h26 y22ed ff19 fsf fc0 sc0 ls0 ws0">POSIX.1 <span class="_ _9"></span>includes <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">system<span class="_ _45"> </span></span>interface, <span class="_ _9"></span>expanding <span class="_ _23"></span>on <span class="_ _9"></span>the <span class="_ _9"></span>ISO <span class="_ _9"></span>C <span class="_ _9"></span>deﬁnition <span class="_ _23"></span>to <span class="_ _9"></span>describe</div><div class="t m0 x32 h2a y22ee ff19 fsf fc0 sc0 ls0 ws0">its behavior in a POSIX environment.</div><a class="l" href="#pff" data-dest-detail='[15,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892634px;bottom:384.528903px;width:136.535698px;height:19.679016px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
