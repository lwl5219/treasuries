<div id="pf349" class="pf w4 h1f" data-page-no="349"><div class="pc pc349 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg349.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>21.5<span class="_ _eb"> </span>Source <span class="_"> </span>Code<span class="_ _1fb"> </span><span class="ff18">807</span></div><div class="t m0 x32 h26 y12f ff19 fsf fc0 sc0 ls0 ws0">The command used to submit a print job is shown next.<span class="_ _59"> </span>The C source ﬁle is<span class="_"> </span><span class="ff1a">print.c</span>.</div><div class="t m0 x140 h4e y59f9 ff1a fs28 fc0 sc0 ls1651 ws0">1/<span class="_ _244"></span><span class="ls0">*</span></div><div class="t m0 x140 h4e y59fa ff1a fs28 fc0 sc0 lsf75 ws0">2*<span class="_ _244"></span><span class="ls0">The client command for printing documents.<span class="_ _d9"> </span>Opens the file</span></div><div class="t m0 x140 h4e y5a8f ff1a fs28 fc0 sc0 lsf75 ws0">3*<span class="_ _244"></span><span class="ls0">and sends it to the printer spooling daemon.<span class="_ _d9"> </span>Usage:</span></div><div class="t m0 x140 h4e y5a90 ff1a fs28 fc0 sc0 ls0 ws0">4<span class="_ _15"> </span>*<span class="_ _15"> </span> print [-t] filename</div><div class="t m0 x140 h4e y5af8 ff1a fs28 fc0 sc0 lsf75 ws0">5*<span class="_ _19"></span><span class="ls0">/</span></div><div class="t m0 x140 h4e y5af9 ff1a fs28 fc0 sc0 ls1651 ws0">6#<span class="_ _244"></span><span class="ls0">include &quot;apue.h&quot;</span></div><div class="t m0 x140 h4e y5afa ff1a fs28 fc0 sc0 ls1651 ws0">7#<span class="_ _244"></span><span class="ls0">include &quot;print.h&quot;</span></div><div class="t m0 x140 h4e y5afb ff1a fs28 fc0 sc0 ls1651 ws0">8#<span class="_ _244"></span><span class="ls0">include &lt;fcntl.h&gt;</span></div><div class="t m0 x140 h4e y5afc ff1a fs28 fc0 sc0 ls1651 ws0">9#<span class="_ _244"></span><span class="ls0">include &lt;pwd.h&gt;</span></div><div class="t m0 x32 h4e y5afd ff1a fs28 fc0 sc0 ls0 ws0">10 <span class="_ _d9"> </span>/*</div><div class="t m0 x32 h4e y5afe ff1a fs28 fc0 sc0 ls0 ws0">11 <span class="_ _68"> </span>*<span class="_"> </span>Needed for logging funtions.</div><div class="t m0 x32 h4e y5aff ff1a fs28 fc0 sc0 ls0 ws0">12 <span class="_ _68"> </span>*/</div><div class="t m0 x32 h4e y5b00 ff1a fs28 fc0 sc0 ls0 ws0">13 <span class="_ _d9"> </span>int<span class="_"> </span>log_to_stderr = 1;</div><div class="t m0 x32 h4e y5b01 ff1a fs28 fc0 sc0 ls0 ws0">14 <span class="_ _d9"> </span>void<span class="_"> </span>submit_file(int, int, const char *, size_t, int);</div><div class="t m0 x32 h4e y5a94 ff1a fs28 fc0 sc0 ls0 ws0">15 <span class="_ _d9"> </span>int</div><div class="t m0 x32 h4e y5a95 ff1a fs28 fc0 sc0 ls0 ws0">16 <span class="_ _d9"> </span>main(int<span class="_"> </span>argc, char *argv[])</div><div class="t m0 x32 h4e y5a96 ff1a fs28 fc0 sc0 ls0 ws0">17 <span class="_ _d9"> </span>{</div><div class="t m0 x32 h4e y5a97 ff1a fs28 fc0 sc0 ls0 ws0">18 <span class="_ _8a"> </span>int<span class="_ _166"> </span>fd, sfd, err, text, c;</div><div class="t m0 x32 h4e y5a98 ff1a fs28 fc0 sc0 ls0 ws0">19 <span class="_ _8a"> </span>struct<span class="_"> </span>stat <span class="_ _15"> </span>sbuf;</div><div class="t m0 x32 h4e y5a99 ff1a fs28 fc0 sc0 ls0 ws0">20 <span class="_ _8a"> </span>char<span class="_ _82"> </span>*host;</div><div class="t m0 x32 h4e y5b02 ff1a fs28 fc0 sc0 ls0 ws0">21 <span class="_ _8a"> </span>struct<span class="_"> </span>addrinfo *ailist, *aip;</div><div class="t m0 x32 h4e y5b03 ff1a fs28 fc0 sc0 ls0 ws0">22 <span class="_ _8a"> </span>err<span class="_"> </span><span class="ls1b6">=0<span class="_ _1d"></span><span class="ls0">;</span></span></div><div class="t m0 x32 h4e y5b04 ff1a fs28 fc0 sc0 ls0 ws0">23 <span class="_ _8a"> </span>text<span class="_"> </span><span class="ls1b6">=0<span class="_ _1d"></span><span class="ls0">;</span></span></div><div class="t m0 x32 h4e y5b05 ff1a fs28 fc0 sc0 ls0 ws0">24 <span class="_ _8a"> </span>while<span class="_"> </span>((c = getopt(argc, argv, &quot;t&quot;)) != -1) {</div><div class="t m0 x32 h4e y5b06 ff1a fs28 fc0 sc0 ls0 ws0">25 <span class="_ _176"> </span>switch<span class="_"> </span>(c) {</div><div class="t m0 x32 h4e y5b07 ff1a fs28 fc0 sc0 ls0 ws0">26 <span class="_ _176"> </span>case<span class="_"> </span>’t’:</div><div class="t m0 x32 h4e y5b08 ff1a fs28 fc0 sc0 ls0 ws0">27 <span class="_ _166"> </span>text<span class="_"> </span><span class="ls1b6">=1<span class="_ _1d"></span><span class="ls0">;</span></span></div><div class="t m0 x32 h4e y5b09 ff1a fs28 fc0 sc0 ls0 ws0">28 <span class="_ _166"> </span>break;</div><div class="t m0 x32 h4e y5b0a ff1a fs28 fc0 sc0 ls0 ws0">29 <span class="_ _176"> </span>case<span class="_"> </span>’?’:</div><div class="t m0 x32 h4e y5b0b ff1a fs28 fc0 sc0 ls0 ws0">30 <span class="_ _166"> </span>err<span class="_"> </span><span class="ls1b6">=1<span class="_ _1d"></span><span class="ls0">;</span></span></div><div class="t m0 x32 h4e y5b0c ff1a fs28 fc0 sc0 ls0 ws0">31 <span class="_ _166"> </span>break;</div><div class="t m0 x32 h4e y5b0d ff1a fs28 fc0 sc0 ls0 ws0">32 <span class="_ _176"> </span>}</div><div class="t m0 x32 h4e y5b0e ff1a fs28 fc0 sc0 ls0 ws0">33 <span class="_ _8a"> </span>}</div><div class="t m0 x32 h54 y5b0f ff19 fs2c fc0 sc0 ls0 ws0">[1 <span class="_ _a"></span>– <span class="_ _a"></span>14]<span class="_ _288"> </span><span class="ls155">We <span class="_ _66"> </span>n<span class="_ _9"></span></span>eed <span class="_ _3"></span>to <span class="_ _9"></span>deﬁne <span class="_ _3"></span>an <span class="_ _3"></span>integer <span class="_ _3"></span>called<span class="_ _45"> </span><span class="ff1a">log_to_stderr<span class="_ _47"> </span></span>to <span class="_ _3"></span>be <span class="_ _3"></span>able <span class="_ _3"></span>to <span class="_ _9"></span>use <span class="_ _3"></span>the <span class="_ _3"></span>log</div><div class="t m0 x2d h55 y5b10 ff19 fs2c fc0 sc0 ls0 ws0">functions in <span class="_ _2"></span>our library<span class="_ _6"></span><span class="ls175a">.I<span class="_ _5b"></span><span class="ls175b">ft<span class="_ _d"></span><span class="ls0">his integer <span class="_ _2"></span>is <span class="_ _2"></span>set to <span class="_ _2"></span>a nonzer<span class="ls175b">ov<span class="_ _4f"></span><span class="ls0">alue, <span class="_ _2"></span>error messages</span></span></span></span></span></div><div class="t m0 x2d h55 y5b11 ff19 fs2c fc0 sc0 ls0 ws0">will <span class="_ _3"></span>be <span class="_ _9"></span>sent <span class="_ _3"></span>to <span class="_ _9"></span>the <span class="_ _3"></span>standar<span class="ls175c">de<span class="_ _b"></span><span class="ls0">rror <span class="_ _3"></span>stream <span class="_ _3"></span>instead <span class="_ _9"></span>of <span class="_ _3"></span>to <span class="_ _9"></span>a <span class="_ _3"></span>log <span class="_ _9"></span>ﬁle.<span class="_ _16"> </span>Although <span class="_ _3"></span>we</span></span></div><div class="t m0 x2d h54 y5b12 ff19 fs2c fc0 sc0 ls0 ws0">don’t <span class="_ _35"> </span>use <span class="_ _35"> </span>any <span class="_ _45"> </span>logging <span class="_ _35"> </span>functions <span class="_ _35"> </span>in<span class="_ _51"> </span><span class="ff1a">print.c</span>,<span class="_ _51"> </span>we<span class="_ _51"> </span>do<span class="_ _51"> </span>link<span class="_ _51"> </span><span class="ff1a">util.o<span class="_"> </span></span>with</div><div class="t m0 x2d h54 y5b13 ff1a fs2c fc0 sc0 ls0 ws0">print.o<span class="_ _61"> </span><span class="ff19">to <span class="_ _47"> </span>build <span class="_ _66"> </span>the <span class="_ _47"> </span>executable<span class="_ _61"> </span></span>print<span class="_ _61"> </span><span class="ff19">command, <span class="_ _47"> </span>and<span class="_ _61"> </span></span>util.c<span class="_ _61"> </span><span class="ff19">contains</span></div><div class="t m0 x2d h55 y5b14 ff19 fs2c fc0 sc0 ls0 ws0">functions for both user commands and daemons.</div><div class="t m0 x32 h54 y5b15 ff19 fs2c fc0 sc0 ls0 ws0">[15 <span class="_ _a"></span>– <span class="_ _a"></span>33]<span class="_ _65"> </span><span class="ls155">We <span class="_ _53"> </span>s<span class="_ _23"></span></span>upport one option,<span class="_ _66"> </span><span class="ff1a">-t</span><span class="ls175d">,t<span class="_ _d"></span><span class="ls175e">of<span class="_ _d"></span><span class="ls0">orce the ﬁle <span class="_ _2"></span>to be <span class="_ _2"></span>printed as <span class="_ _2"></span>text <span class="_ _2"></span>(instead of <span class="_ _2"></span>as a</span></span></span></div><div class="t m0 x2d h54 y5b16 ff19 fs2c fc0 sc0 ls0 ws0">PostScript <span class="_ _2"></span>program, <span class="_ _2"></span>for <span class="_ _2"></span>example).<span class="_ _16"> </span><span class="ls155">We <span class="_ _e"> </span>u<span class="_ _23"></span></span>se <span class="_ _2"></span>the<span class="_ _47"> </span><span class="ff1a">getopt<span class="_ _66"> </span></span>function <span class="_ _3"></span>(introduced <span class="_ _2"></span>in</div><div class="t m0 x2d h55 y5b17 ff19 fs2c fc0 sc0 ls0 ws0">Section 17.6) to process the command options.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
