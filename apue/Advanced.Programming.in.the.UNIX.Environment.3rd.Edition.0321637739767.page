<div id="pf2ff" class="pf w4 h1f" data-page-no="2ff"><div class="pc pc2ff w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg2ff.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h7a ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>19.6<span class="_ _30e"> </span>Using <span class="_"> </span>the<span class="_ _4b"> </span><span class="ff1a">pty<span class="_ _4b"> </span></span>Program<span class="_ _1b"> </span><span class="ff18">733</span></div><div class="t m0 x8a h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">if (signal_intr(SIGTERM, sig_term) == SIG_ERR)</div><div class="t m0 x9d h57 y426 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;signal_intr error for SIGTERM&quot;);</div><div class="t m0 x8a h57 y1307 ff1a fs2d fc0 sc0 ls0 ws0">for ( ; ; ) {</div><div class="t m0 x9d h57 y1308 ff1a fs2d fc0 sc0 ls0 ws0">if ((nread = read(ptym, buf, BUFFSIZE)) &lt;= 0)</div><div class="t m0 x1f h57 y3508 ff1a fs2d fc0 sc0 ls0 ws0">break; <span class="_ _8a"> </span>/*<span class="_"> </span>signal caught, error, or EOF */</div><div class="t m0 x9d h57 y3509 ff1a fs2d fc0 sc0 ls0 ws0">if (writen(STDOUT_FILENO, buf, nread) != nread)</div><div class="t m0 x1f h57 y350a ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;writen error to stdout&quot;);</div><div class="t m0 x8a h57 y350b ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y130d ff1a fs2d fc0 sc0 ls0 ws0">/*</div><div class="t m0 x214 h57 y130e ff1a fs2d fc0 sc0 ls15c ws0">*T<span class="_ _1d"></span><span class="ls0">here are three ways to get here: sig_term() below caught the</span></div><div class="t m0 x214 h57 y130f ff1a fs2d fc0 sc0 ls15c ws0">*S<span class="_ _1d"></span><span class="ls0">IGTERM from the child, we read an EOF on the pty master (which</span></div><div class="t m0 x214 h57 y1310 ff1a fs2d fc0 sc0 ls15c ws0">*m<span class="_ _1d"></span><span class="ls0">eans we have to signal the child to stop), or an error.</span></div><div class="t m0 x214 h57 y1311 ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 x8a h57 y1312 ff1a fs2d fc0 sc0 ls0 ws0">if (sigcaught == 0) /* tell child if it didn’t send us the signal */</div><div class="t m0 x9d h57 y1313 ff1a fs2d fc0 sc0 ls0 ws0">kill(child, SIGTERM);</div><div class="t m0 x8a h57 y1339 ff1a fs2d fc0 sc0 ls0 ws0">/*</div><div class="t m0 x214 h57 y3929 ff1a fs2d fc0 sc0 ls15c ws0">*P<span class="_ _1d"></span><span class="ls0">arent returns to caller.</span></div><div class="t m0 x214 h57 y1316 ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 x32 h57 y1317 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h57 y133d ff1a fs2d fc0 sc0 ls0 ws0">/*</div><div class="t m0 x140 h57 y133e ff1a fs2d fc0 sc0 ls15c ws0">*T<span class="_ _1d"></span><span class="ls0">he child sends us SIGTERM when it gets EOF on the pty slave or</span></div><div class="t m0 x140 h57 y133f ff1a fs2d fc0 sc0 ls15c ws0">*w<span class="_ _1d"></span><span class="ls0">hen read() fails.<span class="_ _3a"> </span>We probably interrupted the read() of ptym.</span></div><div class="t m0 x140 h57 y1340 ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 x32 h57 y1341 ff1a fs2d fc0 sc0 ls0 ws0">static void</div><div class="t m0 x32 h57 y1342 ff1a fs2d fc0 sc0 ls0 ws0">sig_term(int signo)</div><div class="t m0 x32 h57 y1343 ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y1344 ff1a fs2d fc0 sc0 ls0 ws0">sigcaught = 1;<span class="_ _189"> </span>/* just set flag and return */</div><div class="t m0 x32 h57 y1345 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x131 h5e y5448 ff18 fs10 fc0 sc0 ls0 ws0">Figure 19.12<span class="_ _5a"> </span><span class="ff19">The<span class="_"> </span><span class="ff1a">loop<span class="_ _e"> </span></span>function</span></div><div class="t m0 x32 h49 y5449 ff19 fs26 fc0 sc0 ls0 ws0">Note <span class="_ _2"></span>that <span class="_ _2"></span>because <span class="_ _2"></span>we <span class="_ _3"></span>use <span class="_ _2"></span>two <span class="_ _2"></span>processes, <span class="_ _2"></span>one <span class="_ _2"></span>has <span class="_ _2"></span>to <span class="_ _3"></span>notify <span class="_ _2"></span>the <span class="_ _2"></span>other <span class="_ _3"></span>when <span class="_ _2"></span>it <span class="_ _2"></span>terminates.</div><div class="t m0 x32 h4d y544a ff19 fs26 fc0 sc0 ls164 ws0">We <span class="_ _53"> </span>u<span class="_ _9"></span><span class="ls0">se the<span class="_"> </span><span class="ff1a">SIGTERM<span class="_ _66"> </span></span>signal for this notiﬁcation.</span></div><div class="t m0 x35 h7b y544b ff16 fs27 fc0 sc0 ls0 ws0">19.6 <span class="_ _93"> </span>Using<span class="_ _54"> </span>the<span class="_ _54"> </span><span class="ff1f">pty<span class="_ _54"> </span></span>Program</div><div class="t m0 x32 h4d y544c ff19 fs26 fc0 sc0 ls164 ws0">We<span class="_ _9"></span><span class="ls0">’ll <span class="_ _53"> </span>now <span class="_ _e"> </span>look <span class="_ _53"> </span>at <span class="_ _e"> </span>various <span class="_ _53"> </span>examples <span class="_ _e"> </span>with <span class="_ _53"> </span>the<span class="_ _4b"> </span><span class="ff1a">pty<span class="_ _4b"> </span></span>program, <span class="_ _53"> </span>seeing <span class="_ _53"> </span>the <span class="_ _53"> </span>need <span class="_ _e"> </span>for <span class="_ _53"> </span>the</span></div><div class="t m0 x32 h49 y544d ff19 fs26 fc0 sc0 ls0 ws0">command</div><div class="t m0 xc3 h49 y544e ff19 fs26 fc0 sc0 ls0 ws0">-</div><div class="t m0 xc4 h49 y544d ff19 fs26 fc0 sc0 ls0 ws0">line options.</div><div class="t m0 x3f h49 y544f ff19 fs26 fc0 sc0 ls0 ws0">If our shell is the Korn shell, we can execute the command</div><div class="t m0 x3f h4e y5450 ff1a fs28 fc0 sc0 ls0 ws0">pty ksh</div><div class="t m0 x32 h49 y5451 ff19 fs26 fc0 sc0 ls0 ws0">and get a brand-new invocation of the shell, running under a pseudo terminal.</div><div class="t m0 x3f h4d y5452 ff19 fs26 fc0 sc0 ls0 ws0">If <span class="_ _3"></span>the <span class="_ _3"></span>ﬁle<span class="_ _45"> </span><span class="ff1a">ttyname<span class="_ _47"> </span></span>is <span class="_ _3"></span>the <span class="_ _3"></span>program <span class="_ _3"></span>we <span class="_ _3"></span>showed <span class="_ _9"></span>in <span class="_ _3"></span>Figur<span class="ls15bd">e1<span class="_ _b"></span><span class="ls0">8.16, <span class="_ _9"></span>we <span class="_ _3"></span>can <span class="_ _3"></span>run <span class="_ _3"></span>the<span class="_ _45"> </span><span class="ff1a">pty</span></span></span></div><div class="t m0 x32 h49 y5453 ff19 fs26 fc0 sc0 ls0 ws0">program as follows:</div><a class="l" href="#pf13" data-dest-detail='[19,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.893467px;bottom:378.478809px;width:178.055306px;height:19.680008px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
