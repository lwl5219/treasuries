<div id="pfbc" class="pf w4 h1f" data-page-no="bc"><div class="pc pcbc w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bgbc.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">154<span class="_ _1b"> </span><span class="ff19">Standar<span class="ls30a">dI<span class="_ _55"></span><span class="ls0">/O <span class="_"> </span>Library<span class="_ _1c9"> </span>Chapter <span class="_"> </span>5</span></span></span></div><div class="t m0 x32 h57 y362 ff1a fs2d fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h57 y158c ff1a fs2d fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h57 y3c1 ff1a fs2d fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 x32 h57 y3c2 ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y3c3 ff1a fs2d fc0 sc0 ls0 ws0">int <span class="_ _15"> </span>c;</div><div class="t m0 x8a h57 y158d ff1a fs2d fc0 sc0 ls0 ws0">while ((c = getc(stdin)) != EOF)</div><div class="t m0 x9d h57 y158e ff1a fs2d fc0 sc0 ls0 ws0">if (putc(c, stdout) == EOF)</div><div class="t m0 x1f h57 y158f ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;output error&quot;);</div><div class="t m0 x8a h57 y1590 ff1a fs2d fc0 sc0 ls0 ws0">if (ferror(stdin))</div><div class="t m0 x9d h57 y1591 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;input error&quot;);</div><div class="t m0 x8a h57 y1592 ff1a fs2d fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h57 y1593 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x1d h5e y1594 ff18 fs10 fc0 sc0 ls0 ws0">Figure 5.4<span class="_ _5a"> </span><span class="ff19">Copy standar<span class="ls136">di<span class="_ _84"></span><span class="ls0">nput to standar<span class="ls136">do<span class="_ _5"></span><span class="ls0">utput using<span class="_"> </span><span class="ff1a">getc<span class="_ _e"> </span></span>and<span class="_"> </span><span class="ff1a">putc</span></span></span></span></span></span></div><div class="t m0 x32 h4d y1595 ff19 fs26 fc0 sc0 ls164 ws0">We <span class="_ _44"> </span>c<span class="_ _9"></span><span class="ls0">an <span class="_"> </span>make <span class="_"> </span>another <span class="_ _e"> </span>version <span class="_"> </span>of <span class="_ _e"> </span>this <span class="_"> </span>program <span class="_ _e"> </span>that <span class="_"> </span>uses<span class="_ _4b"> </span><span class="ff1a">fgetc<span class="_ _46"> </span></span>and<span class="_ _59"> </span><span class="ff1a">fputc</span><span class="ls6b5">,w<span class="_ _4a"></span><span class="ls0">hich</span></span></span></div><div class="t m0 x32 h49 y1596 ff19 fs26 fc0 sc0 ls0 ws0">should be <span class="_ _2"></span>functions, not <span class="_ _2"></span>macros. <span class="_"> </span>(W<span class="_ _6"></span><span class="ls6b6">ed<span class="_ _d"></span><span class="ls0">on’t show <span class="_ _2"></span>this <span class="_ _2"></span>trivial change <span class="_ _2"></span>to <span class="_ _2"></span>the source code.)</span></span></div><div class="t m0 x3f h49 y1597 ff19 fs26 fc0 sc0 ls0 ws0">Finally<span class="_ _4"></span>,<span class="_"> </span>we<span class="_"> </span>have a version that reads and writes lines, shown in Figur<span class="lsd3">e5<span class="_ _4f"></span><span class="ls0">.5.</span></span></div><div class="t m0 x32 h5d y1598 ff1a fs2f fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h5d y1599 ff1a fs2f fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h5d y159a ff1a fs2f fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 x32 h5d y159b ff1a fs2f fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h5d y159c ff1a fs2f fc0 sc0 ls0 ws0">char <span class="_ _68"> </span>buf[MAXLINE];</div><div class="t m0 x8a h5d y159d ff1a fs2f fc0 sc0 ls0 ws0">while (fgets(buf, MAXLINE, stdin) != NULL)</div><div class="t m0 x9d h5d y159e ff1a fs2f fc0 sc0 ls0 ws0">if (fputs(buf, stdout) == EOF)</div><div class="t m0 x1f h5d y159f ff1a fs2f fc0 sc0 ls0 ws0">err_sys(&quot;output error&quot;);</div><div class="t m0 x8a h5d y15a0 ff1a fs2f fc0 sc0 ls0 ws0">if (ferror(stdin))</div><div class="t m0 x9d h5d y15a1 ff1a fs2f fc0 sc0 ls0 ws0">err_sys(&quot;input error&quot;);</div><div class="t m0 x8a h5d y15a2 ff1a fs2f fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h5d y15a3 ff1a fs2f fc0 sc0 ls0 ws0">}</div><div class="t m0 x1b0 h6d y15a4 ff18 fs12 fc0 sc0 ls0 ws0">Figure 5.5<span class="_ _5a"> </span><span class="ff19">Copy standar<span class="ls38a">di<span class="_ _84"></span><span class="ls0">nput to standar<span class="ls38a">do<span class="_ _5"></span><span class="ls0">utput using<span class="_"> </span><span class="ff1a">fgets<span class="_ _e"> </span></span>and<span class="_"> </span><span class="ff1a">fputs</span></span></span></span></span></span></div><div class="t m0 x32 h50 y15a5 ff19 fs29 fc0 sc0 ls0 ws0">Note <span class="_ _42"> </span>that <span class="_ _23"> </span>we <span class="_ _42"> </span>do <span class="_ _42"> </span>not <span class="_ _42"> </span>close <span class="_ _42"> </span>the <span class="_ _23"> </span>standar<span class="ls6b7">dI<span class="_ _43"></span><span class="ls0">/O <span class="_ _23"> </span>streams <span class="_ _42"> </span>explicitly <span class="_ _23"> </span>in <span class="_ _42"> </span>either <span class="_ _42"> </span>Figur<span class="ls6b7">e5<span class="_ _43"></span><span class="ls0">.4 <span class="_ _23"> </span>or</span></span></span></span></div><div class="t m0 x32 h5c y15a6 ff19 fs29 fc0 sc0 ls0 ws0">Figur<span class="ls6b8">e5<span class="_ _b"></span><span class="ls0">.5. <span class="_ _47"> </span>Instead,<span class="_ _47"> </span>we <span class="_ _3"></span>know <span class="_ _3"></span>that <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">exit<span class="_ _47"> </span></span>function <span class="_ _3"></span>will <span class="_ _3"></span>ﬂush <span class="_ _3"></span>any <span class="_ _3"></span>unwritten <span class="_ _3"></span>data <span class="_ _3"></span>and</span></span></div><div class="t m0 x32 h50 y15a7 ff19 fs29 fc0 sc0 ls0 ws0">then <span class="_"> </span>close <span class="_"> </span>all <span class="_"> </span>open <span class="_ _66"> </span>streams. <span class="_ _46"> </span>(W<span class="_ _6"></span>e’ll <span class="_"> </span>discuss <span class="_"> </span>this <span class="_"> </span>in <span class="_ _66"> </span>Section <span class="_ _66"> </span>8.5.)<span class="_ _60"> </span>It <span class="_ _66"> </span>is <span class="_"> </span>interesting <span class="_"> </span>to</div><div class="t m0 x32 h50 y15a8 ff19 fs29 fc0 sc0 ls0 ws0">compar<span class="ls6b9">et<span class="_ _b"></span><span class="ls0">he <span class="_ _3"></span>timing <span class="_ _9"></span>of <span class="_ _23"></span>these <span class="_ _9"></span>three <span class="_ _3"></span>programs <span class="_ _9"></span>with <span class="_ _9"></span>the <span class="_ _9"></span>timing <span class="_ _9"></span>data <span class="_ _9"></span>from <span class="_ _9"></span>Figur<span class="ls6ba">e3<span class="_ _b"></span><span class="ls0">.6. <span class="_ _45"> </span>W<span class="_ _4"></span>e</span></span></span></span></div><div class="t m0 x32 h50 y15a9 ff19 fs29 fc0 sc0 ls0 ws0">show <span class="_"> </span>this <span class="_"> </span>data <span class="_"> </span>when <span class="_"> </span>operating <span class="_"> </span>on <span class="_"> </span>the <span class="_"> </span>same <span class="_"> </span>ﬁle <span class="_"> </span>(98.5 <span class="_"> </span>MB <span class="_"> </span>with <span class="_"> </span>3 <span class="_"> </span>million <span class="_"> </span>lines) <span class="_"> </span>in</div><div class="t m0 x32 h50 y15aa ff19 fs29 fc0 sc0 ls0 ws0">Figur<span class="lsdd">e5<span class="_ _4f"></span><span class="ls0">.6.</span></span></div><div class="t m0 x3f h50 y15ab ff19 fs29 fc0 sc0 ls0 ws0">For <span class="_ _23"></span>each <span class="_ _23"></span>of <span class="_ _23"></span>the <span class="_ _23"></span>thr<span class="_ _0"></span>ee <span class="_ _23"></span>standar<span class="ls6bb">dI<span class="_ _43"></span><span class="ls0">/O <span class="_ _23"></span>versions, <span class="_ _23"></span>the <span class="_ _23"></span>user <span class="_ _23"></span>CPU <span class="_ _23"></span>time <span class="_ _23"></span>is <span class="_ _23"></span>larger <span class="_ _9"></span>than <span class="_ _23"> </span>the</span></span></div><div class="t m0 x32 h5c y15ac ff19 fs29 fc0 sc0 ls0 ws0">best<span class="_ _51"> </span><span class="ff1a">read<span class="_"> </span></span>version <span class="_ _35"> </span>fr<span class="_ _0"></span>om <span class="_ _35"> </span>Figur<span class="_ _0"></span><span class="ls6bc">e3<span class="_ _7"></span><span class="ls0">.6, <span class="_ _35"> </span>because <span class="_ _35"> </span>the <span class="_ _45"> </span>character-at-a-time <span class="_ _45"> </span>standar<span class="ls6bc">dI<span class="_ _26"></span><span class="ls0">/O</span></span></span></span></div><div class="t m0 x32 h50 y15ad ff19 fs29 fc0 sc0 ls0 ws0">versions <span class="_ _23"> </span>have <span class="_ _23"> </span>a <span class="_ _23"> </span>loop <span class="_ _42"> </span>that <span class="_ _23"> </span>is <span class="_ _23"> </span>executed <span class="_ _23"> </span>100 <span class="_ _42"> </span>million <span class="_ _23"></span>times, <span class="_ _23"> </span>and <span class="_ _23"> </span>the <span class="_ _42"> </span>loop <span class="_ _23"></span>in <span class="_ _23"> </span>the <span class="_ _23"> </span>line-at-a-</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
