<div id="pf219" class="pf w4 h1f" data-page-no="219"><div class="pc pc219 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg219.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>14.4<span class="_ _2a5"> </span>I/O <span class="_"> </span>Multiplexing<span class="_ _1b"> </span><span class="ff18">503</span></div><div class="t m0 x3f h26 y12f ff1b fsf fc0 sc0 ls0 ws0">tvptr<span class="ff21">−</span>&gt;tv_sec<span class="_ _59"> </span><span class="ff1a">!=<span class="_ _46"> </span><span class="ff19">0<span class="_ _46"> </span></span>||<span class="_ _46"> </span></span>tvptr<span class="ff21">−</span>&gt;tv_usec<span class="_ _46"> </span><span class="ff1a">!=<span class="_ _59"> </span><span class="ff19">0</span></span></div><div class="t m0 x52 h2a y3a24 ff19 fsf fc0 sc0 ls5f ws0">Wa<span class="_ _9"></span><span class="ls0">it <span class="_ _2"></span>the <span class="_ _3"></span>speciﬁed <span class="_ _3"></span>number <span class="_ _2"></span>of <span class="_ _3"></span>seconds <span class="_ _2"></span>and <span class="_ _3"></span>microseconds. <span class="_ _66"> </span>Return<span class="_ _47"> </span>is <span class="_ _3"></span>made <span class="_ _2"></span>when</span></div><div class="t m0 x52 h2a y2241 ff19 fsf fc0 sc0 ls0 ws0">one <span class="_ _9"></span>of <span class="_ _9"></span>the <span class="_ _9"></span>speciﬁed <span class="_ _9"></span>descriptors <span class="_ _9"></span>is <span class="_ _9"></span>ready <span class="_ _9"></span>or <span class="_ _9"></span>when <span class="_ _9"></span>the <span class="_ _9"></span>timeout <span class="_ _9"></span>value <span class="_ _9"></span>expires. <span class="_ _45"> </span>If</div><div class="t m0 x52 h2a yc35 ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _3"></span>timeout <span class="_ _3"></span>expires <span class="_ _3"></span>befor<span class="ls1053">ea<span class="_ _b"></span><span class="ls0">ny <span class="_ _9"></span>of <span class="_ _3"></span>the <span class="_ _3"></span>descriptors <span class="_ _3"></span>is <span class="_ _9"></span>ready<span class="_ _4"></span><span class="ls31f">,t<span class="_ _8"></span><span class="ls0">he <span class="_ _3"></span>return <span class="_ _2"></span>value <span class="_ _9"></span>is <span class="_ _3"></span>0.</span></span></span></span></div><div class="t m0 x52 h2b y2242 ff19 fsf fc0 sc0 ls0 ws0">(If <span class="_ _2"></span>the <span class="_ _3"></span>system <span class="_ _3"></span>doesn’t <span class="_ _3"></span>provide <span class="_ _2"></span>microsecond <span class="_ _2"></span>resolution, <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1b">tvptr<span class="ff21">−</span>&gt;tv_usec<span class="_ _47"> </span></span>value</div><div class="t m0 x52 h2a yc36 ff19 fsf fc0 sc0 ls0 ws0">is <span class="_ _3"></span>rounded <span class="_ _2"></span>up <span class="_ _3"></span>to <span class="_ _3"></span>the <span class="_ _3"></span>nearest <span class="_ _2"></span>supported <span class="_ _3"></span>value.)<span class="_ _16"> </span>As <span class="_ _3"></span>with <span class="_ _3"></span>the <span class="_ _3"></span>ﬁrst <span class="_ _3"></span>condition, <span class="_ _3"></span>this</div><div class="t m0 x52 h2a yc37 ff19 fsf fc0 sc0 ls0 ws0">wait can also be interrupted by a caught signal.</div><div class="t m0 x76 h52 y3d98 ff19 fs2a fc0 sc0 ls0 ws0">POSIX.1 allows <span class="_ _2"></span>an <span class="_ _2"></span>implementation <span class="_ _2"></span>to <span class="_ _2"></span>modify <span class="_ _2"></span>the<span class="_ _80"> </span><span class="ff1a">timeval<span class="_ _e"> </span></span>structure, <span class="_ _2"></span>so after<span class="_ _80"> </span><span class="ff1a">select<span class="_ _80"> </span></span><span class="ls34e">re</span>turns,</div><div class="t m0 x76 h52 y3d99 ff19 fs2a fc0 sc0 ls0 ws0">you <span class="_"> </span>can’t <span class="_"> </span>rely <span class="_"> </span>on <span class="_"> </span>the <span class="_"> </span>structur<span class="ls1054">ec<span class="_ _c"></span><span class="ls0">ontaining <span class="_"> </span>the <span class="_"> </span>same <span class="_"> </span>values <span class="_"> </span>it <span class="_"> </span>did <span class="_"> </span>befor<span class="ls3fe">ec<span class="_ _43"></span><span class="ls0">alling<span class="_ _35"> </span><span class="ff1a">select</span>.</span></span></span></span></div><div class="t m0 x76 h51 y3d9a ff19 fs2a fc0 sc0 ls0 ws0">FreeBSD 8.0, Mac <span class="_ _2"></span>OS <span class="_ _2"></span>X <span class="_ _2"></span>10.6.8, and <span class="_ _2"></span>Solaris <span class="_ _2"></span>10 <span class="_ _2"></span>all leave <span class="_ _2"></span>the <span class="_ _2"></span>structur<span class="ls1055">eu<span class="_ _5"></span><span class="ls0">nchanged, but <span class="_ _2"></span>Linux <span class="_ _2"></span>3.2.0</span></span></div><div class="t m0 x76 h52 y3d9b ff19 fs2a fc0 sc0 ls0 ws0">will update it with the time remaining if<span class="_"> </span><span class="ff1a">select<span class="_ _53"> </span></span><span class="ls34e">re</span>turns befor<span class="lse9">et<span class="_ _84"></span><span class="ls0">he timeout value expires.</span></span></div><div class="t m0 x3f h2b y3045 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _44"> </span>middle <span class="_ _4b"> </span>three <span class="_ _44"> </span>arguments—<span class="ff1b ls45">re<span class="ls0">adfds</span></span>,<span class="_ _65"> </span><span class="ff1b">writefds</span><span class="ls1056">,a<span class="_ _52"></span><span class="ls0">nd<span class="_ _54"> </span><span class="ff1b">exceptfds</span>—ar<span class="ls1056">ep<span class="_ _64"></span><span class="ls0">ointers <span class="_ _4b"> </span>to</span></span></span></span></div><div class="t m0 x32 h2b y3d9c ff1b fsf fc0 sc0 ls0 ws0">descriptor <span class="_ _42"> </span>sets<span class="ff19 ls1057">.T<span class="_ _52"></span><span class="ls0">hese <span class="_ _53"> </span>three <span class="_ _42"> </span>sets <span class="_ _42"> </span>specify <span class="_ _53"> </span>which <span class="_ _53"> </span>descriptors <span class="_ _42"> </span>we’r<span class="ls1058">ei<span class="_ _c"></span><span class="ls0">nterested <span class="_ _42"> </span>in <span class="_ _53"> </span>and <span class="_ _42"> </span>for</span></span></span></span></div><div class="t m0 x32 h2a y3d9d ff19 fsf fc0 sc0 ls0 ws0">which <span class="_ _53"> </span>conditions <span class="_ _53"> </span>(readable, <span class="_ _42"> </span>writable, <span class="_ _53"> </span>or <span class="_ _53"> </span>an <span class="_ _53"> </span>exception <span class="_ _e"> </span>condition).<span class="_ _54"> </span><span class="ls35c">Ad<span class="_ _c"></span><span class="ls0">escriptor <span class="_ _e"> </span>set <span class="_ _53"> </span>is</span></span></div><div class="t m0 x32 h26 y3d9e ff19 fsf fc0 sc0 ls0 ws0">stored <span class="_ _2"></span>in <span class="_ _2"></span>an<span class="_ _47"> </span><span class="ff1a">fd_set<span class="_ _47"> </span></span>data <span class="_ _3"></span>type.<span class="_ _61"> </span>This <span class="_ _3"></span>data <span class="_ _3"></span>type <span class="_ _3"></span>is <span class="_ _2"></span>chosen <span class="_ _3"></span>by <span class="_ _3"></span>the <span class="_ _3"></span>implementation <span class="_ _2"></span>so <span class="_ _3"></span>that</div><div class="t m0 x32 h2a y3d9f ff19 fsf fc0 sc0 ls0 ws0">it <span class="_ _2"></span>can <span class="_ _2"></span>hold <span class="_ _3"></span>one <span class="_ _2"></span>bit <span class="_ _3"></span>for <span class="_ _2"></span>each <span class="_ _3"></span>possible <span class="_ _2"></span>descriptor<span class="_ _1"></span><span class="ls1059">.W<span class="_ _7"></span><span class="lsaf6">ec<span class="_ _4f"></span><span class="ls0">an <span class="_ _2"></span>consider <span class="_ _3"></span>it <span class="_ _2"></span>to <span class="_ _3"></span>be <span class="_ _2"></span>just <span class="_ _3"></span>a <span class="_ _2"></span>big <span class="_ _2"></span>array</span></span></span></div><div class="t m0 x32 h2a y3da0 ff19 fsf fc0 sc0 ls0 ws0">of bits, as shown in Figur<span class="ls44">e1<span class="_ _4f"></span><span class="ls0">4.15.</span></span></div><div class="t m0 xf6 h76 y3da1 ff1b fs2a fc0 sc0 ls34e ws0">re<span class="ls0">adfds</span></div><div class="t m0 x17c h5e y3da2 ff1a fs10 fc0 sc0 ls0 ws0">0</div><div class="t m0 x99 h4f y3da3 ff1a fs11 fc0 sc0 ls0 ws0">0</div><div class="t m0 x45 h6d y3da4 ff1a fs12 fc0 sc0 ls0 ws0">0</div><div class="t m0 x1fe h151 y3da5 ff18 fs13 fc0 sc0 ls673 ws0">...</div><div class="t m0 xb1 hca y3da6 ff1b fs13 fc0 sc0 ls0 ws0">writefds</div><div class="t m0 x17c h6f y3da7 ff1a fs14 fc0 sc0 ls0 ws0">0</div><div class="t m0 x99 h66 y3da8 ff1a fs15 fc0 sc0 ls0 ws0">0</div><div class="t m0 x45 h70 y3da9 ff1a fs16 fc0 sc0 ls0 ws0">0</div><div class="t m0 x1fe h152 y3daa ff18 fs36 fc0 sc0 lsdc9 ws0">...</div><div class="t m0 x137 hfc y3dab ff1b fs36 fc0 sc0 ls0 ws0">exceptfds</div><div class="t m0 x17c hcc y3dac ff1a fs17 fc0 sc0 ls0 ws0">0</div><div class="t m0 x99 hd4 y3dad ff1a fs18 fc0 sc0 ls0 ws0">0</div><div class="t m0 x45 hd5 y3dae ff1a fs19 fc0 sc0 ls0 ws0">0</div><div class="t m0 x1fe h153 y3daf ff18 fs1a fc0 sc0 lsa6b ws0">...</div><div class="t m0 x131 h37 y3db0 ff19 fs1a fc0 sc0 ls0 ws0">fd 0<span class="_ _5f"> </span>fd 1<span class="_ _50"> </span>fd 2</div><div class="t m0 x221 h88 y3db1 ff19 fs43 fc0 sc0 ls0 ws0">one bit per possible descriptor</div><div class="t m0 x95 h11c y3db2 ff1a fs20 fc0 sc0 ls0 ws0">fd_set<span class="_"> </span><span class="ff19">data type</span></div><div class="t m0 x197 h11c y3db3 ff18 fs20 fc0 sc0 ls0 ws0">Figure 14.15<span class="_ _5a"> </span><span class="ff19">Specifying the read, write, and exception descriptors for<span class="_"> </span><span class="ff1a">select</span></span></div><div class="t m0 x3f h154 y3db4 ff19 fsb6 fc0 sc0 ls0 ws0">The <span class="_ _9"></span>only <span class="_ _23"></span>thing <span class="_ _9"></span>we <span class="_ _23"></span>can <span class="_ _9"></span>do <span class="_ _23"></span>with <span class="_ _9"></span>the<span class="_ _35"> </span><span class="ff1a">fd_set<span class="_ _45"> </span></span>data <span class="_ _9"></span>type <span class="_ _23"></span>is <span class="_ _9"></span>allocate <span class="_ _23"></span>a <span class="_ _9"></span>variable <span class="_ _23"></span>of <span class="_ _9"></span>this</div><div class="t m0 x32 h155 y3db5 ff19 fsb6 fc0 sc0 ls0 ws0">type, assign a variable of this type to another variable of the same <span class="_ _2"></span>type, or use one of the</div><div class="t m0 x32 h155 y3db6 ff19 fsb6 fc0 sc0 ls0 ws0">following four functions on a variable of this type.</div><div class="t m0 x3f hb8 y3db7 ff1a fs62 fc0 sc0 ls0 ws0">#include &lt;sys/select.h&gt;</div><div class="t m0 x3f hb8 y3db8 ff1a fs62 fc0 sc0 ls0 ws0">int FD_ISSET(int<span class="_"> </span><span class="ff1b">fd</span><span class="ls105a">,f<span class="_ _1d"></span><span class="ls0">d_set *<span class="ff1b">fdset</span>);</span></span></div><div class="t m0 x74 h156 y3db9 ff19 fs62 fc0 sc0 ls0 ws0">Returns: nonzer<span class="ls105b">oi<span class="_ _d"></span><span class="ls0">f<span class="_"> </span><span class="ff1b">fd<span class="_"> </span></span>is in set, 0 otherwise</span></span></div><div class="t m0 x3f hb8 y3dba ff1a fs62 fc0 sc0 ls0 ws0">void FD_CLR(int<span class="_"> </span><span class="ff1b">fd</span><span class="ls105a">,f<span class="_ _1d"></span><span class="ls0">d_set *<span class="ff1b">fdset</span>);</span></span></div><div class="t m0 x3f hb8 y3dbb ff1a fs62 fc0 sc0 ls0 ws0">void FD_SET(int<span class="_"> </span><span class="ff1b">fd</span><span class="ls105a">,f<span class="_ _1d"></span><span class="ls0">d_set *<span class="ff1b">fdset</span>);</span></span></div><div class="t m0 x3f hb8 y3dbc ff1a fs62 fc0 sc0 ls0 ws0">void FD_ZERO(fd_set *<span class="ff1b">fdset</span>);</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
