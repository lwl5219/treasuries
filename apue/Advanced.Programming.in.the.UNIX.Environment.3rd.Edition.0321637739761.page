<div id="pf2f9" class="pf w4 h1f" data-page-no="2f9"><div class="pc pc2f9 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg2f9.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h7a ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>19.4<span class="_ _1c9"> </span><span class="ff1a">pty_fork<span class="_ _44"> </span></span>Function<span class="_ _1b"> </span><span class="ff18">727</span></div><div class="t m0 x3f h57 y1295 ff1a fs2d fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x3f h57 y53d4 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;termios.h&gt;</div><div class="t m0 x3f h57 y53d5 ff1a fs2d fc0 sc0 ls0 ws0">pid_t pty_fork(int *<span class="ff1b">ptrfdm</span><span class="ls15c">,c<span class="_ _1d"></span><span class="ls0">har *<span class="ff1b">slave_name</span><span class="ls15c">,i<span class="_ _5b"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">slave_namesz</span>,</span></span></span></span></div><div class="t m0 x12b h57 y53d6 ff1a fs2d fc0 sc0 ls0 ws0">const struct termios *<span class="ff1b">slave_termios</span>,</div><div class="t m0 x12b h57 y53d7 ff1a fs2d fc0 sc0 ls0 ws0">const struct winsize *<span class="ff1b">slave_winsize</span>);</div><div class="t m0 x128 h5f y53d8 ff19 fs2d fc0 sc0 ls0 ws0">Returns: 0 in child, process ID of child in par<span class="_ _0"></span>ent,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h4a y53d9 ff19 fs26 fc0 sc0 ls0 ws0">The ﬁle descriptor of the PTY master is returned thr<span class="_ _0"></span>ough the<span class="_"> </span><span class="ff1b">ptrfdm<span class="_"> </span></span>pointer<span class="_ _6"></span>.</div><div class="t m0 x3f h4a y53da ff19 fs26 fc0 sc0 ls0 ws0">If<span class="_"> </span><span class="ff1b">slave_name<span class="_ _47"> </span></span>is <span class="_ _2"></span>non-null, the <span class="_ _2"></span>name <span class="_ _2"></span>of <span class="_ _2"></span>the <span class="_ _2"></span>slave <span class="_ _2"></span>device <span class="_ _2"></span>is <span class="_ _2"></span>stored at <span class="_ _2"></span>that <span class="_ _2"></span>location.<span class="_ _61"> </span>The</div><div class="t m0 x32 h49 y53db ff19 fs26 fc0 sc0 ls0 ws0">caller is responsible for allocating the storage pointed to by this ar<span class="_ _0"></span>gument.</div><div class="t m0 x3f h4a y53dc ff19 fs26 fc0 sc0 ls0 ws0">If <span class="_ _23"></span>the <span class="_ _9"></span>pointer<span class="_ _35"> </span><span class="ff1b">slave_termios<span class="_ _35"> </span></span>is <span class="_ _9"></span>non-null, <span class="_ _23"> </span>the <span class="_ _23"> </span>system <span class="_ _23"></span>uses <span class="_ _23"></span>the <span class="_ _23"></span>refer<span class="_ _1"></span>enced <span class="_ _23"> </span>structur<span class="ls15aa">et<span class="_ _43"></span><span class="ls0">o</span></span></div><div class="t m0 x32 h49 y53dd ff19 fs26 fc0 sc0 ls0 ws0">initialize <span class="_ _3"></span>the <span class="_ _3"></span>terminal <span class="_ _9"></span>line <span class="_ _3"></span>discipline <span class="_ _3"></span>of <span class="_ _3"></span>the <span class="_ _9"></span>slave.<span class="_ _16"> </span>If <span class="_ _3"></span>this <span class="_ _9"></span>pointer <span class="_ _3"></span>is <span class="_ _3"></span>null, <span class="_ _3"></span>the <span class="_ _9"></span>system <span class="_ _3"></span>sets</div><div class="t m0 x32 h4d y53de ff19 fs26 fc0 sc0 ls0 ws0">the <span class="_ _23"> </span>slave’s<span class="_ _35"> </span><span class="ff1a">termios<span class="_ _44"> </span></span>structur<span class="_ _0"></span>e<span class="_ _35"> </span>to<span class="_ _35"> </span>an<span class="_ _35"> </span>implementation-deﬁned <span class="_ _42"> </span>initial <span class="_ _23"> </span>state.<span class="_ _51"> </span>Similarly<span class="_ _6"></span><span class="ls15ab">,i<span class="_ _43"></span><span class="ls0">f</span></span></div><div class="t m0 x32 h4a y53df ff19 fs26 fc0 sc0 ls0 ws0">the<span class="_ _61"> </span><span class="ff1b">slave_winsize<span class="_ _16"> </span></span>pointer <span class="_ _47"> </span>is <span class="_ _47"> </span>non-null, <span class="_ _66"> </span>the <span class="_ _47"> </span>referenced <span class="_ _66"> </span>structur<span class="ls15ac">ei<span class="_ _1d"></span><span class="ls0">nitializes <span class="_ _47"> </span>the <span class="_ _47"> </span>slave’s</span></span></div><div class="t m0 x32 h4d y53e0 ff19 fs26 fc0 sc0 ls0 ws0">window size.<span class="_ _59"> </span>If this pointer is null, the<span class="_"> </span><span class="ff1a">winsize<span class="_ _66"> </span></span>structure<span class="_"> </span>is<span class="_"> </span>normally initialized to 0.</div><div class="t m0 x3f h49 y53e1 ff19 fs26 fc0 sc0 ls0 ws0">Figur<span class="ls15ad">e1<span class="_ _1d"></span><span class="ls0">9.10 <span class="_ _66"> </span>shows <span class="_ _47"> </span>the <span class="_ _66"> </span>code <span class="_ _47"> </span>for <span class="_ _66"> </span>this <span class="_ _47"> </span>function.<span class="_ _50"> </span>It <span class="_ _66"> </span>works <span class="_ _47"> </span>on <span class="_ _66"> </span>all <span class="_ _47"> </span>four <span class="_ _66"> </span>platforms</span></span></div><div class="t m0 x32 h4d y53e2 ff19 fs26 fc0 sc0 ls0 ws0">described in this text, calling the<span class="_"> </span><span class="ff1a">ptym_open<span class="_ _80"> </span></span>and<span class="_"> </span><span class="ff1a">ptys_open<span class="_ _66"> </span></span>functions.</div><div class="t m0 x3f h4d y53e3 ff19 fs26 fc0 sc0 ls0 ws0">After opening <span class="_ _2"></span>the <span class="_ _2"></span>PTY <span class="_ _2"></span>master<span class="_ _1"></span>,<span class="_ _66"> </span><span class="ff1a">fork<span class="_ _66"> </span></span>is <span class="_ _2"></span>called.<span class="_ _61"> </span>As <span class="_ _2"></span>we <span class="_ _2"></span>mentioned <span class="_ _2"></span>before, we <span class="_ _2"></span>want to</div><div class="t m0 x32 h4d y53e4 ff19 fs26 fc0 sc0 ls0 ws0">wait <span class="_ _9"></span>to <span class="_ _23"></span>call<span class="_ _45"> </span><span class="ff1a">ptys_open<span class="_ _45"> </span></span>until <span class="_ _23"></span>in <span class="_ _9"></span>the <span class="_ _23"></span>child <span class="_ _9"></span>and <span class="_ _23"></span>after <span class="_ _9"></span>calling<span class="_ _45"> </span><span class="ff1a">setsid<span class="_ _35"> </span></span>to <span class="_ _9"></span>establish <span class="_ _23"></span>a <span class="_ _9"></span>new</div><div class="t m0 x32 h4d y53e5 ff19 fs26 fc0 sc0 ls0 ws0">session. <span class="_"> </span>When<span class="_ _66"> </span>it <span class="_ _2"></span>calls<span class="_"> </span><span class="ff1a">setsid</span><span class="ls15ae">,t<span class="_ _d"></span><span class="ls0">he <span class="_ _2"></span>child is <span class="_ _2"></span>not a <span class="_ _2"></span>process group leader<span class="_ _6"></span>,<span class="_ _66"> </span>so<span class="_ _66"> </span>the <span class="_ _2"></span>three steps</span></span></div><div class="t m0 x32 h49 y53e6 ff19 fs26 fc0 sc0 ls0 ws0">listed <span class="_ _42"> </span>in <span class="_ _53"> </span>Section <span class="_ _53"> </span>9.5 <span class="_ _53"> </span>occur: <span class="_ _53"> </span>(a) <span class="_ _42"> </span>a <span class="_ _53"> </span>new <span class="_ _53"> </span>session <span class="_ _53"> </span>is <span class="_ _42"> </span>created <span class="_ _53"> </span>with <span class="_ _42"> </span>the <span class="_ _53"> </span>child <span class="_ _53"> </span>as <span class="_ _53"> </span>the <span class="_ _53"> </span>session</div><div class="t m0 x32 h49 y53e7 ff19 fs26 fc0 sc0 ls0 ws0">leader<span class="_ _6"></span><span class="ls15af">,(<span class="_ _c"></span><span class="ls0">b) <span class="_ _53"> </span>a <span class="_ _e"> </span>new <span class="_ _e"> </span>process <span class="_ _53"> </span>group <span class="_ _53"> </span>is <span class="_ _e"> </span>created <span class="_ _53"> </span>for <span class="_ _e"> </span>the <span class="_ _53"> </span>child, <span class="_ _e"> </span>and <span class="_ _e"> </span>(c) <span class="_ _e"> </span>the <span class="_ _e"> </span>child <span class="_ _53"> </span>loses <span class="_ _e"> </span>any</span></span></div><div class="t m0 x32 h49 y53e8 ff19 fs26 fc0 sc0 ls0 ws0">association <span class="_ _2"></span>it <span class="_ _2"></span>might <span class="_ _3"></span>have <span class="_ _2"></span>had <span class="_ _2"></span>with <span class="_ _3"></span>its <span class="_ _2"></span>previous controlling <span class="_ _2"></span>terminal.<span class="_ _61"> </span>Under <span class="_ _3"></span>Linux, <span class="_ _2"></span>Mac</div><div class="t m0 x32 h49 y53e9 ff19 fs26 fc0 sc0 ls0 ws0">OS <span class="_ _3"></span>X, <span class="_ _3"></span>and <span class="_ _9"></span>Solaris, <span class="_ _3"></span>the <span class="_ _9"></span>slave <span class="_ _3"></span>becomes <span class="_ _3"></span>the <span class="_ _9"></span>controlling <span class="_ _2"></span>terminal <span class="_ _9"></span>of <span class="_ _3"></span>this <span class="_ _3"></span>new <span class="_ _9"></span>session <span class="_ _3"></span>when</div><div class="t m0 x32 h4d y53ea ff1a fs26 fc0 sc0 ls0 ws0">ptys_open<span class="_ _54"> </span><span class="ff19">is <span class="_ _44"> </span>called.<span class="_ _98"> </span>Under <span class="_ _44"> </span>FreeBSD, <span class="_ _35"> </span>we <span class="_ _44"> </span>have <span class="_ _44"> </span>to <span class="_ _44"> </span>use <span class="_ _44"> </span>the<span class="_ _54"> </span></span>TIOCSCTTY <span class="_ _3"></span>ioctl</div><div class="t m0 x32 h49 y53eb ff19 fs26 fc0 sc0 ls0 ws0">command <span class="_ _47"> </span>to <span class="_ _47"> </span>allocate <span class="_ _45"> </span>the <span class="_ _47"> </span>controlling <span class="_ _66"> </span>terminal.<span class="_ _1a3"> </span>(Recall <span class="_ _47"> </span>Figur<span class="ls15b0">e9<span class="_ _62"></span><span class="ls0">.8 <span class="_ _4"></span>— <span class="_ _84"></span>the<span class="_ _16"> </span>other <span class="_ _47"> </span>three</span></span></div><div class="t m0 x32 h4d y53ec ff19 fs26 fc0 sc0 ls0 ws0">platforms also support<span class="_"> </span><span class="ff1a">TIOCSCTTY</span><span class="lsd3">,b<span class="_ _d"></span><span class="ls0">ut we need to call it only on FreeBSD.)</span></span></div><div class="t m0 x3f h4d y53ed ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _2"></span>two <span class="_ _2"></span>structures<span class="_"> </span><span class="ff1a">termios<span class="_ _47"> </span></span>and<span class="_ _66"> </span><span class="ff1a">winsize<span class="_ _47"> </span></span>ar<span class="ls15b1">et<span class="_ _8"></span><span class="ls0">hen <span class="_ _2"></span>initialized <span class="_ _2"></span>in <span class="_ _2"></span>the <span class="_ _3"></span>child.<span class="_ _61"> </span>Finally<span class="_ _4"></span>,</span></span></div><div class="t m0 x32 h49 y53ee ff19 fs26 fc0 sc0 ls0 ws0">the <span class="_ _45"> </span>slave <span class="_ _45"> </span>ﬁle <span class="_ _45"> </span>descriptor <span class="_ _45"> </span>is <span class="_ _45"> </span>duplicated <span class="_ _45"> </span>onto <span class="_ _35"> </span>standar<span class="_ _0"></span><span class="ls15b2">di<span class="_ _26"></span><span class="ls0">nput, <span class="_ _45"> </span>standar<span class="ls15b3">do<span class="_ _26"></span><span class="ls0">utput, <span class="_ _45"> </span>and</span></span></span></span></div><div class="t m0 x32 h4d y53ef ff19 fs26 fc0 sc0 ls0 ws0">standar<span class="ls15b4">de<span class="_ _8"></span><span class="ls0">rror <span class="_ _2"></span>in the <span class="_ _2"></span>child.<span class="_ _61"> </span>This <span class="_ _2"></span>means that <span class="_ _2"></span>whatever <span class="_ _2"></span>process the <span class="_ _2"></span>caller<span class="_ _66"> </span><span class="ff1a">exec</span><span class="ls15b4">sf<span class="_ _d"></span><span class="lscc">ro<span class="ls15b4">mt<span class="_ _d"></span><span class="ls0">he</span></span></span></span></span></span></div><div class="t m0 x32 h49 y53f0 ff19 fs26 fc0 sc0 ls0 ws0">child <span class="_ _66"> </span>will <span class="_ _47"> </span>have <span class="_ _66"> </span>these <span class="_ _47"> </span>three <span class="_"> </span>descriptors <span class="_ _66"> </span>connected <span class="_ _47"> </span>to <span class="_ _66"> </span>the <span class="_ _47"> </span>slave <span class="_ _66"> </span>PTY <span class="_ _47"> </span>(its <span class="_ _66"> </span>controlling</div><div class="t m0 x32 h49 y53f1 ff19 fs26 fc0 sc0 ls0 ws0">terminal).</div><div class="t m0 x3f h4d y53f2 ff19 fs26 fc0 sc0 ls0 ws0">After <span class="_ _42"> </span>the <span class="_ _23"> </span>call <span class="_ _42"> </span>to<span class="_ _44"> </span><span class="ff1a">fork</span><span class="ls15b5">,t<span class="_ _43"></span><span class="ls0">he <span class="_ _23"> </span>parent <span class="_ _23"> </span>just <span class="_ _42"> </span>returns <span class="_ _42"> </span>the <span class="_ _23"> </span>PTY <span class="_ _42"> </span>master <span class="_ _42"> </span>descriptor <span class="_ _42"> </span>and <span class="_ _42"> </span>the</span></span></div><div class="t m0 x32 h4d y53f3 ff19 fs26 fc0 sc0 ls0 ws0">process <span class="_ _3"></span>ID <span class="_ _9"></span>of <span class="_ _9"></span>the <span class="_ _9"></span>child.<span class="_ _16"> </span>In <span class="_ _9"></span>the <span class="_ _9"></span>next <span class="_ _9"></span>section, <span class="_ _9"></span>we <span class="_ _9"></span>use <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">pty_fork<span class="_ _45"> </span></span>function <span class="_ _3"></span>in <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">pty</span></div><div class="t m0 x32 h49 y53f4 ff19 fs26 fc0 sc0 ls0 ws0">program.</div><div class="t m0 x32 h5d y53f5 ff1a fs2f fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h5d y53f6 ff1a fs2f fc0 sc0 ls0 ws0">#include &lt;termios.h&gt;</div><div class="t m0 x32 h5d y53f7 ff1a fs2f fc0 sc0 ls0 ws0">pid_t</div><div class="t m0 x32 h5d y53f8 ff1a fs2f fc0 sc0 ls0 ws0">pty_fork(int *ptrfdm, char *slave_name, int slave_namesz,</div><div class="t m0 x175 h5d y53f9 ff1a fs2f fc0 sc0 ls0 ws0">const struct termios *slave_termios,</div><div class="t m0 x175 h5d y53fa ff1a fs2f fc0 sc0 ls0 ws0">const struct winsize *slave_winsize)</div><div class="t m0 x32 h5d y53fb ff1a fs2f fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h5d y53fc ff1a fs2f fc0 sc0 ls0 ws0">int <span class="_ _15"> </span>fdm,<span class="_"> </span>fds;</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
