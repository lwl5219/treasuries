<div id="pf28e" class="pf w4 h1f" data-page-no="28e"><div class="pc pc28e w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg28e.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">620<span class="_ _1b"> </span><span class="ff19">Network <span class="_"> </span>IPC: <span class="_"> </span>Sockets<span class="_ _2c6"> </span>Chapter <span class="_"> </span>16</span></div><div class="t m0 x3f h2a y12f ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _53"> </span>other <span class="_ _e"> </span>choice <span class="_ _53"> </span>we <span class="_ _e"> </span>have <span class="_ _53"> </span>is <span class="_ _e"> </span>to <span class="_ _e"> </span>deal <span class="_ _53"> </span>with <span class="_ _e"> </span>the <span class="_ _53"> </span>error <span class="_ _53"> </span>by <span class="_ _e"> </span>letting <span class="_ _53"> </span>the <span class="_ _e"> </span>user <span class="_ _53"> </span>retry <span class="_ _53"> </span>the</div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">command. <span class="_ _5f"> </span>For<span class="_ _5f"> </span>simple <span class="_ _61"> </span>applications <span class="_ _16"> </span>this <span class="_ _16"> </span>might <span class="_ _5a"> </span>be <span class="_ _61"> </span>adequate, <span class="_ _16"> </span>but <span class="_ _16"> </span>for <span class="_ _16"> </span>complex</div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">applications <span class="_"> </span>it <span class="_"> </span>usually <span class="_"> </span>isn’t <span class="_"> </span>a <span class="_"> </span>viable <span class="_"> </span>alternative.<span class="_ _60"> </span>Thus, <span class="_"> </span>it <span class="_ _66"> </span>is <span class="_"> </span>generally <span class="_"> </span>better <span class="_"> </span>to <span class="_"> </span>use</div><div class="t m0 x32 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">connection-oriented sockets in this case.</div><div class="t m0 x3f h2a y133 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _e"> </span>drawbacks <span class="_ _e"> </span>to <span class="_ _e"> </span>connection-oriented <span class="_ _e"> </span>sockets <span class="_ _e"> </span>ar<span class="ls1377">et<span class="_ _55"></span><span class="ls0">hat <span class="_ _e"> </span>mor<span class="ls1377">ew<span class="_ _4a"></span><span class="ls0">ork <span class="_"> </span>and <span class="_ _53"> </span>time <span class="_ _e"> </span>are</span></span></span></span></div><div class="t m0 x32 h2a y134 ff19 fsf fc0 sc0 ls0 ws0">needed <span class="_ _23"></span>to <span class="_ _9"></span>establish <span class="_ _23"> </span>a <span class="_ _23"></span>connection, <span class="_ _9"></span>and <span class="_ _23"> </span>each <span class="_ _23"></span>connection <span class="_ _23"></span>consumes <span class="_ _9"></span>mor<span class="ls103e">er<span class="_ _43"></span><span class="ls0">esources <span class="_ _23"></span>fr<span class="_ _0"></span>om</span></span></div><div class="t m0 x32 h2a y135 ff19 fsf fc0 sc0 ls0 ws0">the operating system.</div><div class="t m0 x35 h27 y349 ff16 fsf fc0 sc0 ls0 ws0">Example <span class="_ _84"></span>— <span class="_ _84"></span>Connectionless<span class="_"> </span>Client</div><div class="t m0 x32 h26 y39d7 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _9"></span>program <span class="_ _9"></span>in <span class="_ _9"></span>Figur<span class="ls1378">e1<span class="_ _b"></span><span class="ls0">6.19 <span class="_ _9"></span>is <span class="_ _9"></span>a <span class="_ _23"></span>version <span class="_ _9"></span>of <span class="_ _23"></span>the<span class="_ _45"> </span><span class="ff1a">uptime<span class="_ _45"> </span></span>client <span class="_ _9"></span>command <span class="_ _23"></span>that <span class="_ _9"></span>uses <span class="_ _9"></span>the</span></span></div><div class="t m0 x32 h2a y39d8 ff19 fsf fc0 sc0 ls0 ws0">datagram socket interface.</div><div class="t m0 x32 h4e y39d9 ff1a fs28 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h4e y39da ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;netdb.h&gt;</div><div class="t m0 x32 h4e y39db ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;errno.h&gt;</div><div class="t m0 x32 h4e y39dc ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;sys/socket.h&gt;</div><div class="t m0 x32 h4e y4a26 ff1a fs28 fc0 sc0 ls0 ws0">#define BUFLEN<span class="_ _189"> </span>128</div><div class="t m0 x32 h4e y4a27 ff1a fs28 fc0 sc0 ls0 ws0">#define TIMEOUT<span class="_ _8a"> </span>20</div><div class="t m0 x32 h4e y39e0 ff1a fs28 fc0 sc0 ls0 ws0">void</div><div class="t m0 x32 h4e y39e1 ff1a fs28 fc0 sc0 ls0 ws0">sigalrm(int signo)</div><div class="t m0 x32 h4e y39e2 ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x32 h4e y39e3 ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h4e y4a28 ff1a fs28 fc0 sc0 ls0 ws0">void</div><div class="t m0 x32 h4e y4a29 ff1a fs28 fc0 sc0 ls0 ws0">print_uptime(int sockfd, struct addrinfo *aip)</div><div class="t m0 x32 h4e y4a2a ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y4a2b ff1a fs28 fc0 sc0 ls0 ws0">int <span class="_ _15"> </span>n;</div><div class="t m0 x8a h4e y4a2c ff1a fs28 fc0 sc0 ls0 ws0">char <span class="_ _68"> </span>buf[BUFLEN];</div><div class="t m0 x8a h4e y4a2d ff1a fs28 fc0 sc0 ls0 ws0">buf[0] = 0;</div><div class="t m0 x8a h4e y4a2e ff1a fs28 fc0 sc0 ls0 ws0">if (sendto(sockfd, buf, 1, 0, aip-&gt;ai_addr, aip-&gt;ai_addrlen) &lt; 0)</div><div class="t m0 x9d h4e y4a2f ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;sendto error&quot;);</div><div class="t m0 x8a h4e y4a30 ff1a fs28 fc0 sc0 ls0 ws0">alarm(TIMEOUT);</div><div class="t m0 x8a h4e y4a31 ff1a fs28 fc0 sc0 ls0 ws0">if ((n = recvfrom(sockfd, buf, BUFLEN, 0, NULL, NULL)) &lt; 0) {</div><div class="t m0 x9d h4e y4a32 ff1a fs28 fc0 sc0 ls0 ws0">if (errno != EINTR)</div><div class="t m0 x1f h4e y4a33 ff1a fs28 fc0 sc0 ls0 ws0">alarm(0);</div><div class="t m0 x9d h4e y4a34 ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;recv error&quot;);</div><div class="t m0 x8a h4e y4a35 ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h4e y4a36 ff1a fs28 fc0 sc0 ls0 ws0">alarm(0);</div><div class="t m0 x8a h4e y4a37 ff1a fs28 fc0 sc0 ls0 ws0">write(STDOUT_FILENO, buf, n);</div><div class="t m0 x32 h4e y4a38 ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h4e y4a39 ff1a fs28 fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h4e y4a3a ff1a fs28 fc0 sc0 ls0 ws0">main(int argc, char *argv[])</div><div class="t m0 x32 h4e y4a3b ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y4a3c ff1a fs28 fc0 sc0 ls0 ws0">struct addrinfo<span class="_ _8a"> </span>*ailist, *aip;</div><div class="t m0 x8a h4e y4a3d ff1a fs28 fc0 sc0 ls0 ws0">struct addrinfo<span class="_ _8a"> </span>hint;</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
