<div id="pf27f" class="pf w4 h1f" data-page-no="27f"><div class="pc pc27f w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg27f.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>16.4<span class="_ _1f"> </span>Connection <span class="_"> </span>Establishment<span class="_ _1b"> </span><span class="ff18">605</span></div><div class="t m0 x3f h2a y12f ff19 fsf fc0 sc0 ls49 ws0">•T<span class="_ _4d"></span><span class="ls0">he <span class="_ _2"></span>port <span class="_ _3"></span>number <span class="_ _3"></span>in <span class="_ _2"></span>the <span class="_ _3"></span>address <span class="_ _2"></span>cannot <span class="_ _3"></span>be <span class="_ _3"></span>less <span class="_ _2"></span>than <span class="_ _3"></span>1,024 <span class="_ _3"></span>unless <span class="_ _2"></span>the <span class="_ _3"></span>process <span class="_ _2"></span>has</span></div><div class="t m0 x15 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">the appropriate privilege (i.e., is the super<span class="_ _0"></span>user).</div><div class="t m0 x3f h2a y3eb ff19 fsf fc0 sc0 ls49 ws0">•U<span class="_ _4d"></span><span class="ls0">sually<span class="_ _4"></span><span class="lsbfb">,o<span class="_ _43"></span><span class="ls0">nly <span class="_ _42"> </span>one <span class="_ _42"> </span>socket <span class="_ _42"> </span>endpoint <span class="_ _23"> </span>can <span class="_ _42"> </span>be <span class="_ _42"> </span>bound <span class="_ _42"> </span>to <span class="_ _42"> </span>a <span class="_ _42"> </span>given <span class="_ _42"> </span>address, <span class="_ _23"></span>although</span></span></span></div><div class="t m0 x15 h2a y3ec ff19 fsf fc0 sc0 ls0 ws0">some protocols allow duplicate bindings.</div><div class="t m0 x32 h26 y3b2c ff19 fsf fc0 sc0 ls0 ws0">For <span class="_ _9"></span>the <span class="_ _23"></span>Internet <span class="_ _9"></span>domain, <span class="_ _9"></span>if <span class="_ _23"></span>we <span class="_ _9"></span>specify <span class="_ _23"></span>the <span class="_ _9"></span>special <span class="_ _9"></span>IP <span class="_ _23"></span>address<span class="_ _45"> </span><span class="ff1a">INADDR_ANY<span class="_ _45"> </span></span>(deﬁned <span class="_ _9"></span>in</div><div class="t m0 x32 h26 y1931 ff1a fsf fc0 sc0 ls0 ws0">&lt;netinet/in.h&gt;<span class="ff19">), <span class="_"> </span>the <span class="_ _e"> </span>socket <span class="_"> </span>endpoint <span class="_"> </span>will <span class="_ _e"> </span>be <span class="_"> </span>bound <span class="_"> </span>to <span class="_"> </span>all <span class="_ _e"> </span>the <span class="_"> </span>system’s <span class="_"> </span>network</span></div><div class="t m0 x32 h2a y1fe ff19 fsf fc0 sc0 ls0 ws0">interfaces. <span class="_ _35"> </span>This<span class="_ _35"> </span>means <span class="_ _23"></span>that <span class="_ _23"></span>we <span class="_ _23"></span>can <span class="_ _23"></span>receive <span class="_ _23"></span>packets <span class="_ _23"></span>from <span class="_ _9"></span>any <span class="_ _23"> </span>of <span class="_ _42"> </span>the <span class="_ _23"></span>network <span class="_ _23"></span>interface</div><div class="t m0 x32 h2a y1ff ff19 fsf fc0 sc0 ls0 ws0">cards installed in the system.<span class="_ _46"> </span><span class="ls5f">We<span class="_ _9"></span></span>’ll see <span class="_ _2"></span>in the next section that <span class="_ _2"></span>the system will choose <span class="_ _2"></span>an</div><div class="t m0 x32 h26 y200 ff19 fsf fc0 sc0 ls0 ws0">address <span class="_ _23"></span>and <span class="_ _42"> </span>bind <span class="_ _23"> </span>it <span class="_ _42"> </span>to <span class="_ _23"> </span>our <span class="_ _42"> </span>socket <span class="_ _42"> </span>for <span class="_ _23"> </span>us <span class="_ _42"> </span>if <span class="_ _42"> </span>we <span class="_ _23"> </span>call<span class="_ _44"> </span><span class="ff1a">connect<span class="_ _35"> </span></span>or<span class="_ _35"> </span><span class="ff1a">listen<span class="_ _44"> </span></span>without <span class="_ _23"> </span>ﬁrst</div><div class="t m0 x32 h2a y322 ff19 fsf fc0 sc0 ls0 ws0">binding an address to the socket.</div><div class="t m0 x3f h26 y323 ff19 fsf fc0 sc0 ls5f ws0">We <span class="_ _53"> </span>c<span class="_ _9"></span><span class="ls0">an use the<span class="_"> </span><span class="ff1a">getsockname<span class="_ _66"> </span></span>function to discover the address bound to a socket.</span></div><div class="t m0 x3f h57 y4878 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;sys/socket.h&gt;</div><div class="t m0 x3f h57 y4879 ff1a fs2d fc0 sc0 ls0 ws0">int getsockname(int<span class="_"> </span><span class="ff1b">sockfd</span><span class="ls15c">,s<span class="_ _1d"></span><span class="ls0">truct sockaddr *restrict<span class="_"> </span><span class="ff1b">addr</span>,</span></span></div><div class="t m0 x1dd h57 y487a ff1a fs2d fc0 sc0 ls0 ws0">socklen_t *restrict<span class="_"> </span><span class="ff1b">alenp</span>);</div><div class="t m0 x153 h5f y487b ff19 fs2d fc0 sc0 ls0 ws0">Returns: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h4d y487c ff19 fs26 fc0 sc0 ls0 ws0">Befor<span class="ls133f">ec<span class="_ _b"></span><span class="ls0">alling<span class="_ _47"> </span><span class="ff1a">getsockname</span>,<span class="_ _45"> </span>we<span class="_ _45"> </span>set<span class="_ _45"> </span><span class="ff1b">alenp<span class="_ _45"> </span></span>to <span class="_ _9"></span>point <span class="_ _9"></span>to <span class="_ _9"></span>an <span class="_ _9"></span>integer <span class="_ _23"></span>containing <span class="_ _9"></span>the <span class="_ _9"></span>size <span class="_ _9"></span>of</span></span></div><div class="t m0 x32 h4d y487d ff19 fs26 fc0 sc0 ls0 ws0">the<span class="_"> </span><span class="ff1a">sockaddr<span class="_ _66"> </span></span>buffer<span class="_ _6"></span><span class="ls1340">.O<span class="_ _4a"></span><span class="ls6e9">nr<span class="_ _4f"></span><span class="ls0">eturn, the <span class="_ _2"></span>integer is <span class="_ _2"></span>set to <span class="_ _2"></span>the size <span class="_ _2"></span>of the <span class="_ _2"></span>address returned. <span class="_"> </span>If</span></span></span></div><div class="t m0 x32 h49 y487e ff19 fs26 fc0 sc0 ls0 ws0">the <span class="_ _53"> </span>address <span class="_ _42"> </span>won’t <span class="_ _53"> </span>ﬁt <span class="_ _e"> </span>in <span class="_ _53"> </span>the <span class="_ _53"> </span>buffer <span class="_ _42"> </span>provided, <span class="_ _53"> </span>the <span class="_ _53"> </span>address <span class="_ _53"> </span>is <span class="_ _53"> </span>silently <span class="_ _53"> </span>truncated. <span class="_ _4b"> </span>If<span class="_ _44"> </span>no</div><div class="t m0 x32 h49 y487f ff19 fs26 fc0 sc0 ls0 ws0">address is curr<span class="_ _0"></span>ently bound to the socket, the r<span class="_ _0"></span>esults ar<span class="lsd3">eu<span class="_ _4f"></span><span class="ls0">ndeﬁned.</span></span></div><div class="t m0 x3f h49 y4880 ff19 fs26 fc0 sc0 ls0 ws0">If the <span class="_ _2"></span>socket <span class="_ _2"></span>is connected <span class="_ _2"></span>to <span class="_ _2"></span>a peer<span class="_ _1"></span>,<span class="_"> </span>we<span class="_ _47"> </span>can ﬁnd <span class="_ _2"></span>out the <span class="_ _2"></span>peer<span class="_ _9"></span>’s address by <span class="_ _2"></span>calling <span class="_ _2"></span>the</div><div class="t m0 x32 h4d y4881 ff1a fs26 fc0 sc0 ls0 ws0">getpeername<span class="_ _80"> </span><span class="ff19">function.</span></div><div class="t m0 x3f h4e y4882 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;sys/socket.h&gt;</div><div class="t m0 x3f h4e y4883 ff1a fs28 fc0 sc0 ls0 ws0">int getpeername(int<span class="_"> </span><span class="ff1b">sockfd</span><span class="ls1b6">,s<span class="_ _1d"></span><span class="ls0">truct sockaddr *restrict<span class="_"> </span><span class="ff1b">addr</span>,</span></span></div><div class="t m0 x1dd h4e y4884 ff1a fs28 fc0 sc0 ls0 ws0">socklen_t *restrict<span class="_"> </span><span class="ff1b">alenp</span>);</div><div class="t m0 x153 h7c y4885 ff19 fs28 fc0 sc0 ls0 ws0">Returns: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h54 y4886 ff19 fs2c fc0 sc0 ls0 ws0">Other <span class="_ _9"></span>than <span class="_ _9"></span>returning <span class="_ _3"></span>the <span class="_ _9"></span>peer<span class="_ _3"></span>’s <span class="_ _9"></span>address, <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">getpeername<span class="_ _47"> </span></span>function <span class="_ _9"></span>is <span class="_ _9"></span>identical <span class="_ _9"></span>to <span class="_ _9"></span>the</div><div class="t m0 x32 h54 y4887 ff1a fs2c fc0 sc0 ls0 ws0">getsockname<span class="_ _80"> </span><span class="ff19">function.</span></div><div class="t m0 x35 h99 y4888 ff16 fs3b fc0 sc0 ls0 ws0">16.4 <span class="_ _93"> </span>Connection<span class="_ _54"> </span>Establishment</div><div class="t m0 x32 h54 y4889 ff19 fs2c fc0 sc0 ls0 ws0">If <span class="_ _59"> </span>we’r<span class="ls1341">ed<span class="_ _5d"></span><span class="ls0">ealing <span class="_ _59"> </span>with <span class="_ _4b"> </span>a <span class="_ _59"> </span>connection-oriented <span class="_ _59"> </span>network <span class="_ _59"> </span>service <span class="_ _59"> </span>(<span class="ff1a">SOCK_STREAM<span class="_ _48"> </span></span>or</span></span></div><div class="t m0 x32 h54 y488a ff1a fs2c fc0 sc0 ls0 ws0">SOCK_SEQPACKET<span class="ff19">), <span class="_ _3"></span>then <span class="_ _9"></span>before<span class="_ _47"> </span>we<span class="_ _45"> </span>can <span class="_ _3"></span>exchange <span class="_ _9"></span>data, <span class="_ _3"></span>we <span class="_ _9"></span>need <span class="_ _3"></span>to <span class="_ _9"></span>create <span class="_ _3"></span>a <span class="_ _9"></span>connection</span></div><div class="t m0 x32 h55 y488b ff19 fs2c fc0 sc0 ls0 ws0">between <span class="_ _42"> </span>the <span class="_ _53"> </span>socket <span class="_ _53"> </span>of <span class="_ _53"> </span>the <span class="_ _53"> </span>process <span class="_ _42"> </span>requesting <span class="_ _53"> </span>the <span class="_ _42"> </span>service <span class="_ _53"> </span>(the <span class="_ _53"> </span>client) <span class="_ _53"> </span>and <span class="_ _53"> </span>the <span class="_ _53"> </span>process</div><div class="t m0 x32 h54 y488c ff19 fs2c fc0 sc0 ls0 ws0">providing the <span class="_ _2"></span>service <span class="_ _2"></span>(the <span class="_ _2"></span>server).<span class="_ _61"> </span><span class="ls155">We <span class="_ _e"> </span>u<span class="_ _9"></span></span>se <span class="_ _2"></span>the<span class="_ _47"> </span><span class="ff1a">connect<span class="_ _66"> </span></span>function <span class="_ _2"></span>to <span class="_ _2"></span>create a <span class="_ _2"></span>connection.</div><div class="t m0 x3f h5d y488d ff1a fs2f fc0 sc0 ls0 ws0">#include &lt;sys/socket.h&gt;</div><div class="t m0 x3f h5d y488e ff1a fs2f fc0 sc0 ls0 ws0">int connect(int<span class="_"> </span><span class="ff1b">sockfd</span><span class="ls395">,c<span class="_ _1d"></span><span class="ls0">onst struct sockaddr *<span class="ff1b">addr</span><span class="ls395">,s<span class="_ _5b"></span><span class="ls0">ocklen_t<span class="_"> </span><span class="ff1b">len</span>);</span></span></span></span></div><div class="t m0 x153 hc2 y488f ff19 fs2f fc0 sc0 ls0 ws0">Returns: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><a class="l" href="#pf12" data-dest-detail='[18,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.893050px;bottom:387.972932px;width:190.572502px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
