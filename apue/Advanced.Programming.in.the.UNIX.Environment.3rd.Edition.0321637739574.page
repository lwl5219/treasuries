<div id="pf23e" class="pf w4 h1f" data-page-no="23e"><div class="pc pc23e w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg23e.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">540<span class="_ _1b"> </span><span class="ff19">Interprocess <span class="_"> </span>Communication<span class="_ _2c"> </span>Chapter <span class="_"> </span>15</span></div><div class="t m0 x32 h57 y362 ff1a fs2d fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h57 y2f1c ff1a fs2d fc0 sc0 ls0 ws0">static int<span class="_ _d9"> </span>pfd1[2], pfd2[2];</div><div class="t m0 x32 h57 y1d79 ff1a fs2d fc0 sc0 ls0 ws0">void</div><div class="t m0 x32 h57 y1d7a ff1a fs2d fc0 sc0 ls0 ws0">TELL_WAIT(void)</div><div class="t m0 x32 h57 y1d7b ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y2197 ff1a fs2d fc0 sc0 ls0 ws0">if (pipe(pfd1) &lt; 0 || pipe(pfd2) &lt; 0)</div><div class="t m0 x9d h57 y2f21 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;pipe error&quot;);</div><div class="t m0 x32 h57 y2f22 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h57 y419a ff1a fs2d fc0 sc0 ls0 ws0">void</div><div class="t m0 x32 h57 y3b4c ff1a fs2d fc0 sc0 ls0 ws0">TELL_PARENT(pid_t pid)</div><div class="t m0 x32 h57 y3b4d ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y2f26 ff1a fs2d fc0 sc0 ls0 ws0">if (write(pfd2[1], &quot;c&quot;, 1) != 1)</div><div class="t m0 x9d h57 y2f27 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;write error&quot;);</div><div class="t m0 x32 h57 y2f28 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h57 y2c5f ff1a fs2d fc0 sc0 ls0 ws0">void</div><div class="t m0 x32 h57 y2c60 ff1a fs2d fc0 sc0 ls0 ws0">WAIT_PARENT(void)</div><div class="t m0 x32 h57 y2c61 ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y2c62 ff1a fs2d fc0 sc0 ls0 ws0">char <span class="_ _68"> </span>c;</div><div class="t m0 x8a h57 y419b ff1a fs2d fc0 sc0 ls0 ws0">if (read(pfd1[0], &amp;c, 1) != 1)</div><div class="t m0 x9d h57 y419c ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;read error&quot;);</div><div class="t m0 x8a h57 y33b8 ff1a fs2d fc0 sc0 ls0 ws0">if (c != ’p’)</div><div class="t m0 x9d h57 y33b9 ff1a fs2d fc0 sc0 ls0 ws0">err_quit(&quot;WAIT_PARENT: incorrect data&quot;);</div><div class="t m0 x32 h57 y33ba ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h57 y419d ff1a fs2d fc0 sc0 ls0 ws0">void</div><div class="t m0 x32 h57 y419e ff1a fs2d fc0 sc0 ls0 ws0">TELL_CHILD(pid_t pid)</div><div class="t m0 x32 h57 y419f ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y41a0 ff1a fs2d fc0 sc0 ls0 ws0">if (write(pfd1[1], &quot;p&quot;, 1) != 1)</div><div class="t m0 x9d h57 y41a1 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;write error&quot;);</div><div class="t m0 x32 h57 y41a2 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h57 y41a3 ff1a fs2d fc0 sc0 ls0 ws0">void</div><div class="t m0 x32 h57 y41a4 ff1a fs2d fc0 sc0 ls0 ws0">WAIT_CHILD(void)</div><div class="t m0 x32 h57 y41a5 ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y41a6 ff1a fs2d fc0 sc0 ls0 ws0">char <span class="_ _68"> </span>c;</div><div class="t m0 x8a h57 y41a7 ff1a fs2d fc0 sc0 ls0 ws0">if (read(pfd2[0], &amp;c, 1) != 1)</div><div class="t m0 x9d h57 y41a8 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;read error&quot;);</div><div class="t m0 x8a h57 y41a9 ff1a fs2d fc0 sc0 ls0 ws0">if (c != ’c’)</div><div class="t m0 x9d h57 y41aa ff1a fs2d fc0 sc0 ls0 ws0">err_quit(&quot;WAIT_CHILD: incorrect data&quot;);</div><div class="t m0 x32 h57 y41ab ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 xe9 h2d y1ce1 ff18 fs10 fc0 sc0 ls0 ws0">Figure 15.7<span class="_ _5a"> </span><span class="ff19">Routines to let a parent and child synchronize</span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
