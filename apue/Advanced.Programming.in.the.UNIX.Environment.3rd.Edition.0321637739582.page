<div id="pf246" class="pf w4 h1f" data-page-no="246"><div class="pc pc246 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg246.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">548<span class="_ _1b"> </span><span class="ff19">Interprocess <span class="_"> </span>Communication<span class="_ _2c"> </span>Chapter <span class="_"> </span>15</span></div><div class="t m0 x8a h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">if ((fpin = popen(&quot;myuclc&quot;, &quot;r&quot;)) == NULL)</div><div class="t m0 x9d h57 y426 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;popen error&quot;);</div><div class="t m0 x8a h57 y800 ff1a fs2d fc0 sc0 ls0 ws0">for ( ; ; ) {</div><div class="t m0 x9d h57 y801 ff1a fs2d fc0 sc0 ls0 ws0">fputs(&quot;prompt&gt; &quot;, stdout);</div><div class="t m0 x9d h57 y802 ff1a fs2d fc0 sc0 ls0 ws0">fflush(stdout);</div><div class="t m0 x9d h57 y803 ff1a fs2d fc0 sc0 ls0 ws0">if (fgets(line, MAXLINE, fpin) == NULL) /* read from pipe */</div><div class="t m0 x1f h57 y804 ff1a fs2d fc0 sc0 ls0 ws0">break;</div><div class="t m0 x9d h57 y805 ff1a fs2d fc0 sc0 ls0 ws0">if (fputs(line, stdout) == EOF)</div><div class="t m0 x1f h57 y806 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;fputs error to pipe&quot;);</div><div class="t m0 x8a h57 y807 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y808 ff1a fs2d fc0 sc0 ls0 ws0">if (pclose(fpin) == -1)</div><div class="t m0 x9d h57 y809 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;pclose error&quot;);</div><div class="t m0 x8a h57 y80a ff1a fs2d fc0 sc0 ls0 ws0">putchar(’\n’);</div><div class="t m0 x8a h57 y80b ff1a fs2d fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h57 y80c ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 xae h2d y4272 ff18 fs10 fc0 sc0 ls0 ws0">Figure 15.15<span class="_ _5a"> </span><span class="ff19">Invoke uppercase/lowercase ﬁlter to r<span class="_ _0"></span>ead commands</span></div><div class="t m0 x3f h4d y4273 ff19 fs26 fc0 sc0 ls164 ws0">We <span class="_ _47"> </span>n<span class="_ _9"></span><span class="ls0">eed <span class="_ _23"> </span>to <span class="_ _42"> </span>call<span class="_ _35"> </span><span class="ff1a">fflush<span class="_ _45"> </span></span>after <span class="_ _23"> </span>writing <span class="_ _42"> </span>the <span class="_ _23"></span>prompt, <span class="_ _9"></span>because <span class="_ _42"> </span>the <span class="_ _23"></span>standar<span class="ls119c">do<span class="_ _43"></span><span class="ls0">utput <span class="_ _23"></span>is</span></span></span></div><div class="t m0 x32 h49 y4274 ff19 fs26 fc0 sc0 ls0 ws0">normally line buffer<span class="_ _0"></span>ed, and the pr<span class="_ _0"></span>ompt does not contain a newline.</div><div class="t m0 x35 h99 y4275 ff16 fs3b fc0 sc0 ls0 ws0">15.4 <span class="_ _93"> </span>Coprocesses</div><div class="t m0 x32 h55 y4276 ff19 fs2c fc0 sc0 ls119d ws0">AU<span class="_ _1d"></span><span class="ls0">NIX <span class="_ _47"> </span>system <span class="_ _66"> </span>ﬁlter <span class="_ _47"> </span>is <span class="_ _66"> </span>a <span class="_ _47"> </span>program <span class="_"> </span>that <span class="_ _47"> </span>reads <span class="_"> </span>from <span class="_"> </span>standar<span class="ls119e">di<span class="_ _5b"></span><span class="ls0">nput <span class="_ _66"> </span>and <span class="_ _47"> </span>writes <span class="_ _66"> </span>to</span></span></span></div><div class="t m0 x32 h55 y4277 ff19 fs2c fc0 sc0 ls0 ws0">standar<span class="ls119f">do<span class="_ _4a"></span><span class="ls0">utput. <span class="_ _59"> </span>Filters<span class="_ _4b"> </span>ar<span class="ls119f">en<span class="_ _55"></span><span class="ls0">ormally <span class="_ _e"> </span>connected <span class="_"> </span>linearly <span class="_ _53"> </span>in <span class="_"> </span>shell <span class="_ _e"> </span>pipelines.<span class="_ _48"> </span><span class="ls11a0">Aﬁ<span class="_ _55"></span><span class="ls0">lter</span></span></span></span></span></span></div><div class="t m0 x32 h60 y4278 ff19 fs2c fc0 sc0 ls0 ws0">becomes <span class="_ _9"></span>a<span class="_ _35"> </span><span class="ff1b">copr<span class="_ _0"></span>ocess<span class="_ _45"> </span><span class="ff19">when <span class="_ _23"></span>the <span class="_ _9"></span>same <span class="_ _23"></span>program <span class="_ _9"></span>generates <span class="_ _9"></span>the <span class="_ _23"></span>ﬁlter<span class="_ _9"></span>’s <span class="_ _9"></span>input <span class="_ _23"></span>and <span class="_ _9"></span>reads <span class="_ _9"></span>the</span></span></div><div class="t m0 x32 h55 y4279 ff19 fs2c fc0 sc0 ls0 ws0">ﬁlter <span class="_ _a"></span>’s<span class="_"> </span>output.</div><div class="t m0 x3f h55 y427a ff19 fs2c fc0 sc0 ls0 ws0">The <span class="_ _2"></span>Korn <span class="_ _2"></span>shell <span class="_ _3"></span>provides coprocesses</div><div class="t m0 x10a h55 y427b ff19 fs2c fc0 sc0 ls0 ws0">[</div><div class="t m0 x1a4 h55 y427a ff19 fs2c fc0 sc0 ls0 ws0">Bolsky <span class="_ _2"></span>and <span class="_ _2"></span>Korn <span class="_ _3"></span>1995</div><div class="t m0 x164 h55 y427b ff19 fs2c fc0 sc0 ls0 ws0">]</div><div class="t m0 x43 h55 y427a ff19 fs2c fc0 sc0 ls11a1 ws0">.T<span class="_ _1d"></span><span class="ls0">he <span class="_ _3"></span>Bourne <span class="_ _2"></span>shell, <span class="_ _2"></span>the</span></div><div class="t m0 x32 h55 y427c ff19 fs2c fc0 sc0 ls0 ws0">Bourne-again shell, and the C shell don’t <span class="_ _2"></span>provide a way to connect processes together as</div><div class="t m0 x32 h55 y427d ff19 fs2c fc0 sc0 ls0 ws0">coprocesses. <span class="_ _16"> </span>A<span class="_ _16"> </span>coprocess <span class="_ _45"> </span>normally <span class="_ _47"> </span>runs <span class="_ _45"> </span>in <span class="_ _45"> </span>the <span class="_ _47"> </span>background <span class="_ _45"> </span>fr<span class="_ _0"></span>om <span class="_ _45"> </span>a <span class="_ _47"> </span>shell, <span class="_ _45"> </span>and <span class="_ _45"> </span>its</div><div class="t m0 x32 h55 y427e ff19 fs2c fc0 sc0 ls0 ws0">standar<span class="ls11a2">di<span class="_ _c"></span><span class="ls0">nput <span class="_ _42"> </span>and <span class="_ _42"> </span>standar<span class="ls11a2">do<span class="_ _43"></span><span class="ls0">utput <span class="_ _23"> </span>ar<span class="ls11a2">ec<span class="_ _43"></span><span class="ls0">onnected <span class="_ _23"> </span>to <span class="_ _42"> </span>another <span class="_ _53"> </span>program <span class="_ _23"> </span>using <span class="_ _42"> </span>a <span class="_ _42"> </span>pipe.</span></span></span></span></span></span></div><div class="t m0 x32 h55 y427f ff19 fs2c fc0 sc0 ls0 ws0">Although <span class="_ _53"> </span>the <span class="_ _53"> </span>shell <span class="_ _53"> </span>syntax <span class="_ _53"> </span>requir<span class="_ _0"></span>ed <span class="_ _53"> </span>to <span class="_ _53"> </span>initiate <span class="_ _53"> </span>a <span class="_ _53"> </span>coprocess <span class="_ _42"> </span>and <span class="_ _e"> </span>connect <span class="_ _53"> </span>its <span class="_ _53"> </span>input <span class="_ _53"> </span>and</div><div class="t m0 x32 h55 y4280 ff19 fs2c fc0 sc0 ls0 ws0">output to other processes is quite contorted (see pp. 62</div><div class="t m0 x212 h55 y4281 ff19 fs2c fc0 sc0 ls0 ws0">–</div><div class="t m0 xa2 h55 y4280 ff19 fs2c fc0 sc0 ls0 ws0">63 of Bolsky and Korn</div><div class="t m0 xd1 h55 y4282 ff19 fs2c fc0 sc0 ls0 ws0">[</div><div class="t m0 xd6 h55 y4280 ff19 fs2c fc0 sc0 ls0 ws0">1995</div><div class="t m0 x162 h55 y4282 ff19 fs2c fc0 sc0 ls0 ws0">]</div><div class="t m0 x192 h55 y4280 ff19 fs2c fc0 sc0 ls0 ws0">for</div><div class="t m0 x32 h55 y4283 ff19 fs2c fc0 sc0 ls0 ws0">all the details), coprocesses ar<span class="_ _0"></span><span class="ls142">ea<span class="_ _d"></span><span class="ls0">lso useful from a C pr<span class="_ _0"></span>ogram.</span></span></div><div class="t m0 x3f h54 y4284 ff19 fs2c fc0 sc0 ls0 ws0">Whereas<span class="_"> </span><span class="ff1a">popen<span class="_ _66"> </span></span>gives us <span class="_ _2"></span>a one-way <span class="_ _2"></span>pipe <span class="_ _2"></span>to the <span class="_ _2"></span>standar<span class="ls11a3">di<span class="_ _4f"></span><span class="ls0">nput or <span class="_ _2"></span>from the <span class="_ _2"></span>standard</span></span></div><div class="t m0 x32 h55 y4285 ff19 fs2c fc0 sc0 ls0 ws0">output <span class="_ _23"> </span>of <span class="_ _42"> </span>another <span class="_ _23"> </span>process, <span class="_ _23"> </span>with <span class="_ _23"> </span>a <span class="_ _42"> </span>coprocess <span class="_ _23"></span>we <span class="_ _23"> </span>have <span class="_ _42"> </span>two <span class="_ _23"> </span>one-way <span class="_ _42"> </span>pipes <span class="_ _23"> </span>to <span class="_ _23"> </span>the <span class="_ _42"> </span>other</div><div class="t m0 x32 h55 y4286 ff19 fs2c fc0 sc0 ls0 ws0">process: <span class="_ _3"></span>one <span class="_ _3"></span>to <span class="_ _9"></span>its <span class="_ _9"></span>standar<span class="ls11a4">di<span class="_ _b"></span><span class="ls0">nput <span class="_ _3"></span>and <span class="_ _9"></span>one <span class="_ _9"></span>from <span class="_ _3"></span>its <span class="_ _9"></span>standar<span class="ls11a5">do<span class="_ _b"></span><span class="ls0">utput. <span class="_ _47"> </span>W<span class="_ _6"></span><span class="ls11a5">ew<span class="_ _8"></span><span class="ls0">ant <span class="_ _9"></span>to <span class="_ _3"></span>write</span></span></span></span></span></span></div><div class="t m0 x32 h55 y4287 ff19 fs2c fc0 sc0 ls0 ws0">to its standar<span class="ls142">di<span class="_ _4f"></span><span class="ls0">nput, let it operate on the data, and then read from its standar<span class="_ _0"></span><span class="ls142">do<span class="_ _d"></span><span class="ls0">utput.</span></span></span></span></div><div class="t m0 x35 h61 y4288 ff16 fs2c fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h55 y4289 ff19 fs2c fc0 sc0 ls0 ws0">Let’s <span class="_ _23"> </span>look <span class="_ _42"> </span>at <span class="_ _42"> </span>coprocesses <span class="_ _23"> </span>with <span class="_ _42"> </span>an <span class="_ _23"> </span>example.<span class="_ _54"> </span>The <span class="_ _23"> </span>process <span class="_ _42"> </span>creates <span class="_ _23"></span>two <span class="_ _23"> </span>pipes: <span class="_ _42"> </span>one <span class="_ _42"> </span>is <span class="_ _42"> </span>the</div><div class="t m0 x32 h55 y428a ff19 fs2c fc0 sc0 ls0 ws0">standar<span class="ls11a6">di<span class="_ _43"></span><span class="ls0">nput <span class="_ _23"></span>of <span class="_ _9"></span>the <span class="_ _23"></span>coprocess <span class="_ _3"></span>and <span class="_ _23"></span>the <span class="_ _9"></span>other <span class="_ _23"></span>is <span class="_ _9"></span>the <span class="_ _9"></span>standar<span class="ls11a7">do<span class="_ _b"></span><span class="ls0">utput <span class="_ _9"></span>of <span class="_ _9"></span>the <span class="_ _23"></span>coprocess.</span></span></span></span></div><div class="t m0 x32 h55 y428b ff19 fs2c fc0 sc0 ls0 ws0">Figur<span class="ls142">e1<span class="_ _4f"></span><span class="ls0">5.16 shows this arrangement.</span></span></div><a class="l" href="#pf12" data-dest-detail='[18,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892842px;bottom:704.358878px;width:111.120590px;height:19.680023px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
