<div id="pfa6" class="pf w4 h1f" data-page-no="a6"><div class="pc pca6 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bga6.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">132<span class="_ _1b"> </span><span class="ff19">Files <span class="_"> </span>and <span class="_"> </span>Directories <span class="_ _18d"> </span>Chapter<span class="_ _4b"> </span>4</span></div><div class="t m0 x76 h52 y2a3 ff19 fs2a fc0 sc0 ls0 ws0">In <span class="_"> </span>SUSv4,<span class="_ _44"> </span><span class="ff1a">nftw<span class="_ _44"> </span></span>is <span class="_ _80"> </span>included <span class="_"> </span>as <span class="_ _80"> </span>part <span class="_"> </span>of <span class="_ _80"> </span>the <span class="_"> </span>XSI <span class="_ _80"> </span>option.<span class="_ _51"> </span>Implementations <span class="_"> </span>ar<span class="ls5ce">ei<span class="_ _c"></span><span class="ls0">ncluded <span class="_ _80"> </span>in</span></span></div><div class="t m0 x76 h52 y2a4 ff19 fs2a fc0 sc0 ls0 ws0">FreeBSD <span class="_ _9"></span>8.0, <span class="_ _23"> </span>Linux <span class="_ _23"> </span>3.2.0, <span class="_ _23"> </span>Mac <span class="_ _23"> </span>OS <span class="_ _9"> </span>X <span class="_ _23"> </span>10.6.8, <span class="_ _23"> </span>and <span class="_ _23"> </span>Solaris <span class="_ _23"> </span>10.<span class="_ _46"> </span>(In <span class="_ _23"> </span>SUSv4, <span class="_ _23"> </span>the<span class="_ _47"> </span><span class="ff1a">ftw<span class="_ _47"> </span></span>function <span class="_ _23"> </span>has</div><div class="t m0 x76 h51 y2a5 ff19 fs2a fc0 sc0 ls0 ws0">been <span class="_ _80"> </span>marked <span class="_ _80"> </span>as <span class="_ _80"> </span>obsolescent.)<span class="_ _51"> </span>BSD</div><div class="t m0 x45 h51 y12dd ff19 fs2a fc0 sc0 ls0 ws0">-</div><div class="t m0 x46 h52 y2a5 ff19 fs2a fc0 sc0 ls0 ws0">based <span class="_ _80"> </span>systems <span class="_ _80"> </span>have <span class="_ _80"> </span>a <span class="_ _80"> </span>differ<span class="_ _0"></span>ent <span class="_ _80"> </span>function,<span class="_ _44"> </span><span class="ff1a">fts</span></div><div class="t m0 x1b9 h51 y2f2 ff19 fs2a fc0 sc0 ls0 ws0">(</div><div class="t m0 x57 h51 y2a5 ff19 fs2a fc0 sc0 ls0 ws0">3</div><div class="t m0 xe6 h51 y2f2 ff19 fs2a fc0 sc0 ls0 ws0">)</div><div class="t m0 x14f h51 y2a5 ff19 fs2a fc0 sc0 ls5cf ws0">,t<span class="_ _c"></span><span class="ls0">hat</span></div><div class="t m0 x76 h51 y2a6 ff19 fs2a fc0 sc0 ls0 ws0">provides similar functionality<span class="_ _4"></span><span class="ls10f">.I<span class="_ _43"></span><span class="ls0">t<span class="_"> </span>is<span class="_"> </span>available in FreeBSD 8.0, Linux 3.2.0, and Mac OS X 10.6.8.</span></span></div><div class="t m0 x32 h4e y12de ff1a fs28 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h4e y12df ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;dirent.h&gt;</div><div class="t m0 x32 h4e y12e0 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;limits.h&gt;</div><div class="t m0 x32 h4e y12e1 ff1a fs28 fc0 sc0 ls0 ws0">/* function type that is called for each filename */</div><div class="t m0 x32 h4e y12e2 ff1a fs28 fc0 sc0 ls0 ws0">typedef int Myfunc(const char *, const struct stat *, int);</div><div class="t m0 x32 h4e y12e3 ff1a fs28 fc0 sc0 ls0 ws0">static Myfunc<span class="_ _68"> </span>myfunc;</div><div class="t m0 x32 h4e y12e4 ff1a fs28 fc0 sc0 ls0 ws0">static int<span class="_ _189"> </span>myftw(char *, Myfunc *);</div><div class="t m0 x32 h4e y12e5 ff1a fs28 fc0 sc0 ls0 ws0">static int<span class="_ _189"> </span>dopath(Myfunc *);</div><div class="t m0 x32 h4e y12e6 ff1a fs28 fc0 sc0 ls0 ws0">static long nreg, ndir, nblk, nchr, nfifo, nslink, nsock, ntot;</div><div class="t m0 x32 h4e y12e7 ff1a fs28 fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h4e y12e8 ff1a fs28 fc0 sc0 ls0 ws0">main(int argc, char *argv[])</div><div class="t m0 x32 h4e y12e9 ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y12ea ff1a fs28 fc0 sc0 ls0 ws0">int <span class="_ _15"> </span>ret;</div><div class="t m0 x8a h4e y12eb ff1a fs28 fc0 sc0 ls0 ws0">if (argc != 2)</div><div class="t m0 x9d h4e y12ec ff1a fs28 fc0 sc0 ls0 ws0">err_quit(&quot;usage: <span class="_"> </span>ftw <span class="_"> </span>&lt;starting-pathname&gt;&quot;);</div><div class="t m0 x8a h4e y12ed ff1a fs28 fc0 sc0 ls0 ws0">ret = myftw(argv[1], myfunc);<span class="_ _b7"> </span>/* does it all */</div><div class="t m0 x8a h4e y12ee ff1a fs28 fc0 sc0 ls0 ws0">ntot = nreg + ndir + nblk + nchr + nfifo + nslink + nsock;</div><div class="t m0 x8a h4e y12ef ff1a fs28 fc0 sc0 ls0 ws0">if (ntot == 0)</div><div class="t m0 x9d h4e y12f0 ff1a fs28 fc0 sc0 ls0 ws0">ntot = 1;<span class="_ _b7"> </span>/* avoid divide by 0; print 0 for all counts */</div><div class="t m0 x8a h4e y12f1 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;regular files<span class="_ _d9"> </span><span class="ls1b6">=%<span class="_ _5b"></span><span class="ls0">7ld, %5.2f %%\n&quot;, nreg,</span></span></div><div class="t m0 x194 h4e y12f2 ff1a fs28 fc0 sc0 ls0 ws0">nreg*100.0/ntot);</div><div class="t m0 x8a h4e y12f3 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;directories <span class="_ _68"> </span>=<span class="_"> </span>%7ld, %5.2f %%\n&quot;, ndir,</div><div class="t m0 x194 h4e y12f4 ff1a fs28 fc0 sc0 ls0 ws0">ndir*100.0/ntot);</div><div class="t m0 x8a h4e y12f5 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;block special<span class="_ _d9"> </span><span class="ls1b6">=%<span class="_ _5b"></span><span class="ls0">7ld, %5.2f %%\n&quot;, nblk,</span></span></div><div class="t m0 x194 h4e y12f6 ff1a fs28 fc0 sc0 ls0 ws0">nblk*100.0/ntot);</div><div class="t m0 x8a h4e y12f7 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;char special<span class="_ _68"> </span><span class="ls1b6">=%<span class="_ _5b"></span><span class="ls0">7ld, %5.2f %%\n&quot;, nchr,</span></span></div><div class="t m0 x194 h4e y12f8 ff1a fs28 fc0 sc0 ls0 ws0">nchr*100.0/ntot);</div><div class="t m0 x8a h4e y12f9 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;FIFOs <span class="_ _176"> </span>=<span class="_"> </span>%7ld, %5.2f %%\n&quot;, nfifo,</div><div class="t m0 x194 h4e y12fa ff1a fs28 fc0 sc0 ls0 ws0">nfifo*100.0/ntot);</div><div class="t m0 x8a h4e y12fb ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;symbolic links = %7ld, %5.2f %%\n&quot;, nslink,</div><div class="t m0 x194 h4e y12fc ff1a fs28 fc0 sc0 ls0 ws0">nslink*100.0/ntot);</div><div class="t m0 x8a h4e y12fd ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;sockets <span class="_ _b7"> </span>=<span class="_"> </span>%7ld, %5.2f %%\n&quot;, nsock,</div><div class="t m0 x194 h4e y12fe ff1a fs28 fc0 sc0 ls0 ws0">nsock*100.0/ntot);</div><div class="t m0 x8a h4e y12ff ff1a fs28 fc0 sc0 ls0 ws0">exit(ret);</div><div class="t m0 x32 h4e y1300 ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h4e y1301 ff1a fs28 fc0 sc0 ls0 ws0">/*</div><div class="t m0 x140 h4e y1302 ff1a fs28 fc0 sc0 ls1b6 ws0">*D<span class="_ _1d"></span><span class="ls0">escend through the hierarchy, starting at &quot;pathname&quot;.</span></div><div class="t m0 x140 h4e y1303 ff1a fs28 fc0 sc0 ls1b6 ws0">*T<span class="_ _1d"></span><span class="ls0">he callerâ€™s func() is called for every file.</span></div><div class="t m0 x140 h4e y1304 ff1a fs28 fc0 sc0 ls0 ws0">*/</div><div class="t m0 x32 h4e y1305 ff1a fs28 fc0 sc0 ls0 ws0">#define FTW_F<span class="_ _68"> </span><span class="ls5d0">1/<span class="_ _1c2"></span><span class="ls1b6">*f<span class="_ _1d"></span><span class="ls0">ile other than directory */</span></span></span></div><div class="t m0 x32 h4e y1306 ff1a fs28 fc0 sc0 ls0 ws0">#define FTW_D<span class="_ _68"> </span><span class="ls5d0">2/<span class="_ _1c2"></span><span class="ls1b6">*d<span class="_ _1d"></span><span class="ls0">irectory */</span></span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
