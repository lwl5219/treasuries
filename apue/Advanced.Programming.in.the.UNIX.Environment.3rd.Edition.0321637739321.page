<div id="pf141" class="pf w4 h1f" data-page-no="141"><div class="pc pc141 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg141.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>9.2<span class="_ _177"> </span><span class="ls719">Te<span class="_ _3"></span></span>rminal <span class="_"> </span>Logins<span class="_ _1b"> </span><span class="ff18">287</span></div><div class="t m0 x3f h26 y12f ff19 fsf fc0 sc0 ls0 ws0">It <span class="_ _53"> </span>is<span class="_ _4b"> </span><span class="ff1a">getty<span class="_ _4b"> </span></span>that <span class="_ _e"> </span>calls<span class="_ _4b"> </span><span class="ff1a">open<span class="_ _4b"> </span></span>for <span class="_ _53"> </span>the <span class="_ _e"> </span>terminal <span class="_ _e"> </span>device.<span class="_ _65"> </span>The <span class="_ _e"> </span>terminal <span class="_ _53"> </span>is <span class="_ _e"> </span>opened <span class="_ _e"> </span>for</div><div class="t m0 x32 h26 y130 ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">ading <span class="_ _23"></span>and <span class="_ _9"></span>writing.<span class="_ _51"> </span>If <span class="_ _9"></span>the <span class="_ _9"></span>device <span class="_ _23"></span>is <span class="_ _9"></span>a <span class="_ _23"></span>modem, <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">open<span class="_ _35"> </span></span>may <span class="_ _9"></span>delay <span class="_ _9"></span>inside <span class="_ _23"></span>the <span class="_ _9"></span>device</span></div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">driver <span class="_ _2"></span>until <span class="_ _3"></span>the <span class="_ _2"></span>modem <span class="_ _3"></span>is <span class="_ _3"></span>dialed <span class="_ _2"></span>and <span class="_ _3"></span>the <span class="_ _3"></span>call <span class="_ _2"></span>is <span class="_ _3"></span>answered. <span class="_ _66"> </span>Once<span class="_ _47"> </span>the <span class="_ _2"></span>device <span class="_ _3"></span>is <span class="_ _3"></span>open, <span class="_ _2"></span>ﬁle</div><div class="t m0 x32 h26 y132 ff19 fsf fc0 sc0 ls0 ws0">descriptors <span class="_"> </span>0, <span class="_ _66"> </span>1, <span class="_"> </span>and <span class="_ _66"> </span>2 <span class="_ _66"> </span>ar<span class="ls987">es<span class="_ _5b"></span><span class="ls0">et <span class="_ _66"> </span>to <span class="_ _66"> </span>the <span class="_ _66"> </span>device.<span class="_ _50"> </span>Then<span class="_ _46"> </span><span class="ff1a">getty<span class="_ _46"> </span></span>outputs <span class="_ _66"> </span>something <span class="_ _66"> </span>like</span></span></div><div class="t m0 x32 h26 y133 ff1a fsf fc0 sc0 ls0 ws0">login:<span class="_ _44"> </span><span class="ff19">and <span class="_ _53"> </span>waits <span class="_ _53"> </span>for <span class="_ _53"> </span>us <span class="_ _53"> </span>to <span class="_ _53"> </span>enter <span class="_ _53"> </span>our <span class="_ _53"> </span>user <span class="_ _53"> </span>name.<span class="_ _65"> </span>If <span class="_ _53"> </span>the <span class="_ _53"> </span>terminal <span class="_ _53"> </span>supports <span class="_ _53"> </span>multiple</span></div><div class="t m0 x32 h26 y134 ff19 fsf fc0 sc0 ls0 ws0">speeds,<span class="_ _35"> </span><span class="ff1a">getty<span class="_ _45"> </span></span>can <span class="_ _42"> </span>detect <span class="_ _23"></span>special <span class="_ _23"></span>characters <span class="_ _23"></span>that <span class="_ _23"></span>tell <span class="_ _23"></span>it <span class="_ _23"></span>to <span class="_ _23"> </span>change <span class="_ _23"> </span>the <span class="_ _23"> </span>terminal’s <span class="_ _23"> </span>speed</div><div class="t m0 x32 h26 y135 ff19 fsf fc0 sc0 ls0 ws0">(baud <span class="_ _23"> </span>rate).<span class="_ _51"> </span>Consult <span class="_ _23"> </span>your <span class="_ _42"> </span>UNIX <span class="_ _23"></span>system <span class="_ _23"> </span>manuals <span class="_ _23"> </span>for <span class="_ _42"> </span>additional <span class="_ _23"></span>details <span class="_ _23"> </span>on <span class="_ _23"> </span>the<span class="_ _35"> </span><span class="ff1a">getty</span></div><div class="t m0 x32 h26 y136 ff19 fsf fc0 sc0 ls0 ws0">program and the data ﬁles (<span class="ff1a">gettytab</span><span class="ls44">)t<span class="_ _4f"></span><span class="ls0">hat can drive its actions.</span></span></div><div class="t m0 x3f h26 y137 ff19 fsf fc0 sc0 ls0 ws0">When <span class="_ _42"> </span>we <span class="_ _42"> </span>enter <span class="_ _42"> </span>our <span class="_ _42"> </span>user <span class="_ _42"> </span>name,<span class="_ _44"> </span><span class="ff1a">getty</span>’s <span class="_ _42"> </span>job <span class="_ _42"> </span>is <span class="_ _42"> </span>complete, <span class="_ _42"> </span>and <span class="_ _42"> </span>it <span class="_ _42"> </span>then <span class="_ _42"> </span>invokes <span class="_ _42"> </span>the</div><div class="t m0 x32 h26 y138 ff1a fsf fc0 sc0 ls0 ws0">login<span class="_ _80"> </span><span class="ff19">program, similar to</span></div><div class="t m0 x3f h57 y253a ff1a fs2d fc0 sc0 ls0 ws0">execle(&quot;/bin/login&quot;, &quot;login&quot;, &quot;-p&quot;, username, (char *)0, envp);</div><div class="t m0 x32 h26 y253b ff19 fsf fc0 sc0 ls0 ws0">(Ther<span class="lsacd">ec<span class="_ _43"></span><span class="ls0">an <span class="_ _23"></span>be <span class="_ _23"></span>options <span class="_ _23"></span>in <span class="_ _9"></span>the<span class="_ _35"> </span><span class="ff1a">gettytab<span class="_ _35"> </span></span>ﬁle <span class="_ _9"></span>to <span class="_ _23"> </span>have <span class="_ _23"> </span>it <span class="_ _23"></span>invoke <span class="_ _23"></span>other <span class="_ _23"></span>pr<span class="_ _0"></span>ograms, <span class="_ _23"></span>but <span class="_ _23"></span>the</span></span></div><div class="t m0 x32 h26 y253c ff19 fsf fc0 sc0 ls0 ws0">default <span class="_"> </span>is <span class="_ _e"> </span>the<span class="_ _59"> </span><span class="ff1a">login<span class="_ _59"> </span></span>program.)<span class="_ _60"> </span><span class="ff1a">init<span class="_ _59"> </span></span>invokes<span class="_ _59"> </span><span class="ff1a">getty<span class="_ _59"> </span></span>with <span class="_"> </span>an <span class="_ _e"> </span>empty <span class="_"> </span>environment;</div><div class="t m0 x32 h26 y253d ff1a fsf fc0 sc0 ls0 ws0">getty<span class="_ _35"> </span><span class="ff19">creates <span class="_ _23"></span>an <span class="_ _23"> </span>environment <span class="_ _23"> </span>for<span class="_ _44"> </span></span>login<span class="_ _35"> </span><span class="ff19">(the<span class="_ _35"> </span></span>envp<span class="_ _35"> </span><span class="ff19">argument) <span class="_ _23"> </span>with <span class="_ _42"> </span>the <span class="_ _23"> </span>name <span class="_ _42"> </span>of <span class="_ _23"> </span>the</span></div><div class="t m0 x32 h26 y253e ff19 fsf fc0 sc0 ls0 ws0">terminal <span class="_ _9"></span>(something <span class="_ _9"></span>like<span class="_ _45"> </span><span class="ff1a">TERM=foo</span><span class="lsace">,w<span class="_ _b"></span><span class="ls0">her<span class="lsace">et<span class="_ _b"></span><span class="ls0">he <span class="_ _9"></span>type <span class="_ _9"></span>of <span class="_ _9"></span>terminal<span class="_ _45"> </span><span class="ff1a">foo<span class="_ _45"> </span></span>is <span class="_ _9"></span>taken <span class="_ _9"></span>from <span class="_ _3"></span>the</span></span></span></span></div><div class="t m0 x32 h26 y253f ff1a fsf fc0 sc0 ls0 ws0">gettytab<span class="_ _45"> </span><span class="ff19">ﬁle) <span class="_ _23"></span>and <span class="_ _9"></span>any <span class="_ _23"></span>envir<span class="_ _0"></span>onment <span class="_ _9"></span>strings <span class="_ _23"></span>that <span class="_ _9"></span>ar<span class="lsacf">es<span class="_ _b"></span><span class="ls0">peciﬁed <span class="_ _9"></span>in <span class="_ _9"></span>the<span class="_ _35"> </span><span class="ff1a">gettytab</span><span class="lsad0">.T<span class="_ _26"></span><span class="ls0">he</span></span></span></span></span></div><div class="t m0 x32 h26 y2540 ff1a fsf fc0 sc0 ls0 ws0">-p<span class="_ _66"> </span><span class="ff19">ﬂag <span class="_ _2"></span>to<span class="_ _47"> </span></span>login<span class="_ _47"> </span><span class="ff19">tells it <span class="_ _3"></span>to <span class="_ _2"></span>preserve <span class="_ _2"></span>the <span class="_ _2"></span>environment that <span class="_ _3"></span>it <span class="_ _2"></span>is <span class="_ _2"></span>passed <span class="_ _2"></span>and <span class="_ _3"></span>to <span class="_ _2"></span>add <span class="_ _2"></span>to <span class="_ _2"></span>that</span></div><div class="t m0 x32 h2a y2541 ff19 fsf fc0 sc0 ls0 ws0">environment, <span class="_ _42"> </span>not <span class="_ _42"> </span>replace <span class="_ _42"> </span>it.<span class="_ _54"> </span>Figur<span class="lsad1">e9<span class="_ _c"></span><span class="ls0">.2 <span class="_ _42"> </span>shows <span class="_ _53"> </span>the <span class="_ _42"> </span>state <span class="_ _42"> </span>of <span class="_ _53"> </span>these <span class="_ _42"> </span>processes <span class="_ _42"> </span>right <span class="_ _53"> </span>after</span></span></div><div class="t m0 x32 h26 y2542 ff1a fsf fc0 sc0 ls0 ws0">login<span class="_ _80"> </span><span class="ff19">has been invoked.</span></div><div class="t m0 xdd h5e y2543 ff1a fs10 fc0 sc0 ls0 ws0">init</div><div class="t m0 xdd h4f y2544 ff1a fs11 fc0 sc0 ls0 ws0">init</div><div class="t m0 x86 h6d y2545 ff1a fs12 fc0 sc0 ls0 ws0">getty</div><div class="t m0 x86 h63 yf7c ff1a fs13 fc0 sc0 ls0 ws0">login</div><div class="t m0 x1ac h6f y2546 ff1a fs14 fc0 sc0 ls0 ws0">fork</div><div class="t m0 x1ac h66 y2547 ff1a fs15 fc0 sc0 ls0 ws0">exec</div><div class="t m0 x67 h70 y2548 ff1a fs16 fc0 sc0 ls0 ws0">exec</div><div class="t m0 x205 h9d y2549 ff1b fs16 fc0 sc0 ls0 ws0">process ID 1</div><div class="t m0 x116 hcc y254a ff19 fs17 fc0 sc0 lsad2 ws0">re<span class="ls0">ads<span class="_"> </span><span class="ff1a">/etc/ttys</span>;</span></div><div class="t m0 x116 hcc y254b ff1a fs17 fc0 sc0 ls0 ws0">fork<span class="ff19 lsad3">so<span class="_ _84"></span><span class="ls0">nce per terminal;</span></span></div><div class="t m0 x116 h34 y254c ff19 fs17 fc0 sc0 ls0 ws0">creates empty envir<span class="_ _0"></span>onment</div><div class="t m0 x116 h35 y254d ff19 fs18 fc0 sc0 ls0 ws0">opens terminal device</div><div class="t m0 x116 h35 y254e ff19 fs18 fc0 sc0 ls0 ws0">(ﬁle descriptors 0, 1, 2);</div><div class="t m0 x116 h35 y254f ff19 fs18 fc0 sc0 lsad4 ws0">re<span class="ls0">ads user name;</span></div><div class="t m0 x116 h35 y2550 ff19 fs18 fc0 sc0 ls0 ws0">initial environment set</div><div class="t m0 x185 hd4 y2551 ff18 fs18 fc0 sc0 ls0 ws0">Figure 9.2<span class="_ _5a"> </span><span class="ff19">State of processes after<span class="_"> </span><span class="ff1a">login<span class="_ _53"> </span></span>has been invoked</span></div><div class="t m0 x32 h6a y2552 ff19 fs34 fc0 sc0 ls0 ws0">All the <span class="_ _2"></span>processes shown <span class="_ _2"></span>in Figur<span class="lsad5">e9<span class="_ _4f"></span><span class="ls0">.2 <span class="_ _2"></span>have <span class="_ _2"></span>superuser privileges, <span class="_ _2"></span>since <span class="_ _2"></span>the <span class="_ _2"></span>original<span class="_"> </span><span class="ff1a">init</span></span></span></div><div class="t m0 x32 h69 y2553 ff19 fs34 fc0 sc0 ls0 ws0">process <span class="_"> </span>has <span class="_"> </span>superuser <span class="_"> </span>privileges.<span class="_ _60"> </span>The <span class="_"> </span>process <span class="_"> </span>ID <span class="_"> </span>of <span class="_"> </span>the <span class="_ _66"> </span>bottom <span class="_"> </span>three <span class="_"> </span>processes <span class="_"> </span>in</div><div class="t m0 x32 h6a y2554 ff19 fs34 fc0 sc0 ls0 ws0">Figur<span class="lsad6">e9<span class="_ _b"></span><span class="ls0">.2 <span class="_ _3"></span>is <span class="_ _23"></span>the <span class="_ _9"></span>same, <span class="_ _9"></span>since <span class="_ _9"></span>the <span class="_ _23"></span>process <span class="_ _3"></span>ID <span class="_ _23"></span>does <span class="_ _9"></span>not <span class="_ _9"></span>change <span class="_ _23"></span>acr<span class="_ _0"></span>oss <span class="_ _9"></span>an<span class="_ _45"> </span><span class="ff1a">exec</span><span class="lsad7">.A<span class="_ _62"></span><span class="ls0">lso, <span class="_ _9"></span>all</span></span></span></span></div><div class="t m0 x32 h6a y2555 ff19 fs34 fc0 sc0 ls0 ws0">the processes other than the original<span class="_"> </span><span class="ff1a">init<span class="_ _80"> </span></span>process have a par<span class="_ _1"></span>ent process ID of 1.</div><div class="t m0 x3f h6a y2556 ff19 fs34 fc0 sc0 ls0 ws0">The<span class="_ _4b"> </span><span class="ff1a">login<span class="_ _59"> </span></span>program <span class="_ _e"> </span>does <span class="_"> </span>many <span class="_ _53"> </span>things.<span class="_ _48"> </span>Since <span class="_"> </span>it <span class="_ _e"> </span>has <span class="_"> </span>our <span class="_ _53"> </span>user <span class="_"> </span>name, <span class="_ _e"> </span>it <span class="_ _e"> </span>can <span class="_"> </span>call</div><div class="t m0 x32 h6a y2557 ff1a fs34 fc0 sc0 ls0 ws0">getpwnam<span class="_ _35"> </span><span class="ff19">to <span class="_ _23"></span>fetch <span class="_ _23"></span>our <span class="_ _23"></span>passwor<span class="lsad8">dﬁ<span class="_ _43"></span><span class="ls0">le <span class="_ _23"> </span>entry<span class="_ _4"></span><span class="lsad9">.T<span class="_ _26"></span><span class="ls0">hen<span class="_ _35"> </span><span class="ff1a">login<span class="_ _35"> </span></span>calls<span class="_ _35"> </span><span class="ff1a">getpass</span></span></span></span></span></span></div><div class="t m0 x37 h69 y2558 ff19 fs34 fc0 sc0 ls0 ws0">(</div><div class="t m0 x56 h69 y2557 ff19 fs34 fc0 sc0 ls0 ws0">3</div><div class="t m0 x204 h69 y2558 ff19 fs34 fc0 sc0 ls0 ws0">)</div><div class="t m0 xd5 h69 y2557 ff19 fs34 fc0 sc0 ls0 ws0">to <span class="_ _23"></span>display</div><div class="t m0 x32 h6a y2559 ff19 fs34 fc0 sc0 ls0 ws0">the <span class="_ _9"></span>prompt<span class="_ _45"> </span><span class="ff1a">Password:<span class="_ _35"> </span></span>and <span class="_ _9"></span>read <span class="_ _9"></span>our <span class="_ _23"></span>passwor<span class="_ _0"></span><span class="lsada">d(<span class="_ _b"></span><span class="ls0">with <span class="_ _9"></span>echoing <span class="_ _23"></span>disabled, <span class="_ _9"></span>of <span class="_ _23"></span>course).<span class="_ _5a"> </span>It</span></span></div><div class="t m0 x32 h6a y255a ff19 fs34 fc0 sc0 ls0 ws0">calls<span class="_ _35"> </span><span class="ff1a">crypt</span></div><div class="t m0 x139 h69 y255b ff19 fs34 fc0 sc0 ls0 ws0">(</div><div class="t m0 x198 h69 y255a ff19 fs34 fc0 sc0 ls0 ws0">3</div><div class="t m0 x16e h69 y255b ff19 fs34 fc0 sc0 ls0 ws0">)</div><div class="t m0 x206 h69 y255a ff19 fs34 fc0 sc0 ls0 ws0">to <span class="_ _42"> </span>encrypt <span class="_ _23"> </span>the <span class="_ _42"> </span>passwor<span class="lsadb">dt<span class="_ _43"></span><span class="ls0">hat <span class="_ _23"> </span>we <span class="_ _42"> </span>entered <span class="_ _23"> </span>and <span class="_ _42"> </span>compares <span class="_ _23"></span>the <span class="_ _42"> </span>encrypted</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
