<div id="pf1dc" class="pf w4 h1f" data-page-no="1dc"><div class="pc pc1dc w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg1dc.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">442<span class="_ _1b"> </span><span class="ff19">Thread <span class="_"> </span>Contr<span class="_ _0"></span>ol <span class="_ _177"> </span>Chapter<span class="_ _44"> </span>12</span></div><div class="t m0 x3f h26 y12f ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _3"></span>value <span class="_ _9"></span>of <span class="_ _9"></span>the<span class="_ _47"> </span><span class="ff1b">process-shared<span class="_ _47"> </span></span>attribute <span class="_ _9"></span>can <span class="_ _3"></span>be <span class="_ _9"></span>either<span class="_ _47"> </span><span class="ff1a">PTHREAD_PROCESS_SHARED</span></div><div class="t m0 x32 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">(accessible <span class="_ _4b"> </span>to <span class="_ _59"> </span>threads <span class="_ _4b"> </span>from <span class="_ _4b"> </span>multiple <span class="_ _4b"> </span>processes) <span class="_ _4b"> </span>or<span class="_ _48"> </span><span class="ff1a">PTHREAD_PROCESS_PRIVATE</span></div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">(accessible to only threads in the pr<span class="_ _0"></span>ocess that initialized the barrier).</div><div class="t m0 x35 h53 y134 ff16 fs2b fc0 sc0 ls0 ws0">12.5 <span class="_ _93"> </span>Reentrancy</div><div class="t m0 x32 h2a y370c ff19 fsf fc0 sc0 ls5f ws0">We <span class="_ _4b"> </span>d<span class="_ _9"></span><span class="ls0">iscussed <span class="_ _66"> </span>reentrant <span class="_"> </span>functions <span class="_"> </span>and <span class="_ _66"> </span>signal <span class="_ _66"> </span>handlers <span class="_ _66"> </span>in <span class="_ _66"> </span>Section <span class="_ _66"> </span>10.6.<span class="_ _50"> </span>Threads <span class="_"> </span>are</span></div><div class="t m0 x32 h2a y370d ff19 fsf fc0 sc0 ls0 ws0">similar <span class="_ _3"></span>to <span class="_ _9"></span>signal <span class="_ _9"></span>handlers <span class="_ _3"></span>when <span class="_ _9"></span>it <span class="_ _3"></span>comes <span class="_ _9"></span>to <span class="_ _9"></span>reentrancy<span class="_ _4"></span><span class="lsec6">.I<span class="_ _62"></span><span class="ls8a0">nb<span class="_ _8"></span><span class="ls0">oth <span class="_ _3"></span>cases, <span class="_ _9"></span>multiple <span class="_ _9"></span>threads</span></span></span></div><div class="t m0 x32 h2a y370e ff19 fsf fc0 sc0 ls0 ws0">of control can potentially call the same function at the same time.</div><div class="t m0 x21b h5e y370f ff1a fs10 fc0 sc0 ls0 ws0">basename <span class="_ _10b"> </span>getchar_unlocked<span class="_ _6e"> </span>getservent <span class="_ _6e"> </span>putc_unlocked</div><div class="t m0 x21b h5e y3710 ff1a fs10 fc0 sc0 ls0 ws0">catgets <span class="_ _9f"> </span>getdate<span class="_ _73"> </span>getutxent <span class="_ _75"> </span>putchar_unlocked</div><div class="t m0 x21b h5e y3711 ff1a fs10 fc0 sc0 ls0 ws0">crypt <span class="_ _a1"> </span>getenv<span class="_ _a4"> </span>getutxid <span class="_ _15"> </span>putenv</div><div class="t m0 x21b h5e y3712 ff1a fs10 fc0 sc0 ls0 ws0">dbm_clearerr <span class="_ _6e"> </span>getgrent<span class="_ _a0"> </span>getutxline <span class="_ _6e"> </span>pututxline</div><div class="t m0 x21b h5e y3713 ff1a fs10 fc0 sc0 ls0 ws0">dbm_close <span class="_ _6c"> </span>getgrgid<span class="_ _a0"> </span>gmtime <span class="_ _71"> </span>rand</div><div class="t m0 x21b h5e y3714 ff1a fs10 fc0 sc0 ls0 ws0">dbm_delete <span class="_ _15"> </span>getgrnam<span class="_ _a0"> </span>hcreate <span class="_ _6c"> </span>readdir</div><div class="t m0 x21b h5e y3715 ff1a fs10 fc0 sc0 ls0 ws0">dbm_error <span class="_ _6c"> </span>gethostent<span class="_ _7d"> </span>hdestroy <span class="_ _15"> </span>setenv</div><div class="t m0 x21b h5e y3716 ff1a fs10 fc0 sc0 ls0 ws0">dbm_fetch <span class="_ _6c"> </span>getlogin<span class="_ _a0"> </span>hsearch <span class="_ _6c"> </span>setgrent</div><div class="t m0 x21b h5e y3717 ff1a fs10 fc0 sc0 ls0 ws0">dbm_firstkey <span class="_ _6e"> </span>getnetbyaddr<span class="_ _10b"> </span>inet_ntoa <span class="_ _75"> </span>setkey</div><div class="t m0 x21b h5e y3718 ff1a fs10 fc0 sc0 ls0 ws0">dbm_nextkey <span class="_ _75"> </span>getnetbyname<span class="_ _10b"> </span>l64a <span class="_ _6f"> </span>setpwent</div><div class="t m0 x21b h5e y3719 ff1a fs10 fc0 sc0 ls0 ws0">dbm_open <span class="_ _10b"> </span>getnetent<span class="_ _6b"> </span>lgamma <span class="_ _10b"> </span>setutxent</div><div class="t m0 x21b h5e y371a ff1a fs10 fc0 sc0 ls0 ws0">dbm_store <span class="_ _6c"> </span>getopt<span class="_ _a4"> </span>lgammaf <span class="_ _6c"> </span>strerror</div><div class="t m0 x21b h5e y371b ff1a fs10 fc0 sc0 ls0 ws0">dirname <span class="_ _9f"> </span>getprotobyname<span class="_ _15"> </span>lgammal <span class="_ _6c"> </span>strsignal</div><div class="t m0 x21b h5e y371c ff1a fs10 fc0 sc0 ls0 ws0">dlerror <span class="_ _9f"> </span>getprotobynumber<span class="_ _6e"> </span>localeconv <span class="_ _6e"> </span>strtok</div><div class="t m0 x21b h5e y371d ff1a fs10 fc0 sc0 ls0 ws0">drand48 <span class="_ _9f"> </span>getprotoent<span class="_ _9f"> </span>localtime <span class="_ _75"> </span>system</div><div class="t m0 x21b h5e y371e ff1a fs10 fc0 sc0 ls0 ws0">encrypt <span class="_ _9f"> </span>getpwent<span class="_ _a0"> </span>lrand48 <span class="_ _6c"> </span>ttyname</div><div class="t m0 x21b h5e y371f ff1a fs10 fc0 sc0 ls0 ws0">endgrent <span class="_ _10b"> </span>getpwnam<span class="_ _291"> </span>mrand48 <span class="_ _6c"> </span>unsetenv</div><div class="t m0 x21b h5e y3720 ff1a fs10 fc0 sc0 ls0 ws0">endpwent <span class="_ _10b"> </span>getpwuid<span class="_ _291"> </span>nftw <span class="_ _7d"> </span>wcstombs</div><div class="t m0 x21b h5e y3721 ff1a fs10 fc0 sc0 ls0 ws0">endutxent <span class="_ _6c"> </span>getservbyname<span class="_ _6c"> </span>nl_langinfo <span class="_ _48"> </span>wctomb</div><div class="t m0 x21b h5e y3722 ff1a fs10 fc0 sc0 ls0 ws0">getc_unlocked <span class="_ _48"> </span>getservbyport<span class="_ _6c"> </span>ptsname</div><div class="t m0 xae h56 y3723 ff18 fs11 fc0 sc0 ls0 ws0">Figure 12.9<span class="_ _5a"> </span><span class="ff19">Functions<span class="_"> </span><span class="ff1b">not<span class="_"> </span></span>guaranteed to be thread-safe by POSIX.1</span></div><div class="t m0 x3f h55 y3724 ff19 fs2c fc0 sc0 ls0 ws0">If <span class="_ _3"></span>a <span class="_ _9"></span>function <span class="_ _3"></span>can <span class="_ _9"></span>be <span class="_ _9"></span>safely <span class="_ _3"></span>called <span class="_ _9"></span>by <span class="_ _3"></span>multiple <span class="_ _9"></span>threads <span class="_ _3"></span>at <span class="_ _9"></span>the <span class="_ _3"></span>same <span class="_ _9"></span>time, <span class="_ _3"></span>we <span class="_ _9"></span>say <span class="_ _9"></span>that</div><div class="t m0 x32 h60 y3725 ff19 fs2c fc0 sc0 ls0 ws0">the <span class="_ _42"> </span>function <span class="_ _42"> </span>is<span class="_ _44"> </span><span class="ff1b">thread-safe</span><span class="lsec7">.A<span class="_ _52"></span><span class="ls0">ll <span class="_ _42"> </span>functions <span class="_ _42"> </span>deﬁned <span class="_ _42"> </span>in <span class="_ _42"> </span>the <span class="_ _42"> </span>Single <span class="_ _42"> </span>UNIX <span class="_ _42"> </span>Speciﬁcation <span class="_ _42"> </span>are</span></span></div><div class="t m0 x32 h55 y3726 ff19 fs2c fc0 sc0 ls0 ws0">guaranteed <span class="_ _45"> </span>to <span class="_ _47"> </span>be <span class="_ _45"> </span>thread-safe, <span class="_ _47"> </span>except <span class="_ _45"> </span>those <span class="_ _45"> </span>listed <span class="_ _45"> </span>in <span class="_ _47"> </span>Figur<span class="lsec8">e1<span class="_ _62"></span><span class="ls0">2.9. <span class="_ _5a"> </span>In<span class="_ _16"> </span>addition, <span class="_ _45"> </span>the</span></span></div><div class="t m0 x32 h54 y3727 ff1a fs2c fc0 sc0 ls0 ws0">ctermid<span class="_ _66"> </span><span class="ff19">and<span class="_ _47"> </span></span>tmpnam<span class="_ _47"> </span><span class="ff19">functions <span class="_ _2"></span>ar<span class="lsec9">en<span class="_ _8"></span><span class="ls0">ot <span class="_ _3"></span>guaranteed <span class="_ _2"></span>to <span class="_ _2"></span>be <span class="_ _3"></span>thread-safe if <span class="_ _3"></span>they <span class="_ _2"></span>ar<span class="lseca">ep<span class="_ _4f"></span><span class="ls0">assed</span></span></span></span></span></div><div class="t m0 x32 h54 y3728 ff19 fs2c fc0 sc0 lsecb ws0">an<span class="_ _4a"></span><span class="ls0">ull <span class="_"> </span>pointer<span class="_ _6"></span><span class="lsecc">.S<span class="_ _5d"></span><span class="ls0">imilarly<span class="_ _4"></span><span class="lsecb">,t<span class="_ _4a"></span><span class="ls0">here<span class="_ _59"> </span>is<span class="_ _46"> </span>no<span class="_ _46"> </span>guarantee <span class="_"> </span>that<span class="_ _46"> </span><span class="ff1a">wcrtomb<span class="_ _46"> </span></span>and<span class="_ _46"> </span><span class="ff1a">wcsrtombs<span class="_ _46"> </span></span>are</span></span></span></span></span></div><div class="t m0 x32 h54 y3729 ff19 fs2c fc0 sc0 ls0 ws0">thread-safe when they ar<span class="_ _0"></span><span class="ls142">ep<span class="_ _d"></span><span class="ls0">assed a null pointer for their<span class="_"> </span><span class="ff1a">mbstate_t<span class="_ _80"> </span></span>argument.</span></span></div><div class="t m0 x3f h55 y372a ff19 fs2c fc0 sc0 ls0 ws0">Implementations <span class="_ _3a"> </span>that <span class="_ _141"> </span>support <span class="_ _3a"> </span>thread-safe <span class="_ _3a"> </span>functions <span class="_ _141"> </span>will <span class="_ _3a"> </span>deﬁne <span class="_ _141"> </span>the</div><div class="t m0 x32 h54 y372b ff1a fs2c fc0 sc0 ls0 ws0">_POSIX_THREAD_SAFE_FUNCTIONS<span class="_ _44"> </span><span class="ff19">symbol <span class="_ _53"> </span>in<span class="_ _4b"> </span></span>&lt;unistd.h&gt;<span class="ff19 lsecd">.A<span class="_ _52"></span><span class="ls0">pplications <span class="_ _53"> </span>can <span class="_ _53"> </span>also</span></span></div><div class="t m0 x32 h54 y372c ff19 fs2c fc0 sc0 ls0 ws0">use the<span class="_ _66"> </span><span class="ff1a">_SC_THREAD_SAFE_FUNCTIONS<span class="_ _47"> </span></span>ar<span class="_ _0"></span>gument with<span class="_ _47"> </span><span class="ff1a">sysconf<span class="_ _66"> </span></span>to check <span class="_ _2"></span>for <span class="_ _2"></span>support</div><div class="t m0 x32 h55 y372d ff19 fs2c fc0 sc0 ls0 ws0">of <span class="_ _2"></span>thread-safe <span class="_ _2"></span>functions <span class="_ _2"></span>at <span class="_ _3"></span>runtime. <span class="_ _66"> </span>Prior<span class="_ _47"> </span>to <span class="_ _2"></span>V<span class="_ _6"></span>ersion <span class="_ _2"></span>4 <span class="_ _3"></span>of <span class="_ _2"></span>the <span class="_ _3"></span>Single <span class="_ _2"></span>UNIX <span class="_ _2"></span>Speciﬁcation,</div><div class="t m0 x32 h55 y372e ff19 fs2c fc0 sc0 ls0 ws0">all <span class="_ _e"> </span>XSI-conforming <span class="_"> </span>implementations <span class="_ _e"> </span>wer<span class="lsece">er<span class="_ _4a"></span><span class="ls0">equir<span class="_ _0"></span>ed <span class="_"> </span>to <span class="_ _53"> </span>support <span class="_"> </span>thr<span class="_ _0"></span>ead-safe <span class="_ _e"> </span>functions.</span></span></div><div class="t m0 x32 h55 y372f ff19 fs2c fc0 sc0 ls6a4 ws0">Wi<span class="_ _3"></span><span class="ls0">th <span class="_ _51"> </span>SUSv4, <span class="_ _51"> </span>however<span class="_ _6"></span><span class="lsecf">,t<span class="_ _4d"></span><span class="ls0">hread-safe <span class="_ _51"> </span>function <span class="_ _51"> </span>support <span class="_ _5a"> </span>is <span class="_ _51"> </span>now <span class="_ _51"> </span>requir<span class="_ _0"></span>ed <span class="_ _51"> </span>for <span class="_ _51"> </span>an</span></span></span></div><div class="t m0 x32 h55 y3730 ff19 fs2c fc0 sc0 ls0 ws0">implementation to be considered POSIX conforming.</div><div class="t m0 x3f h55 y3731 ff19 fs2c fc0 sc0 ls6a4 ws0">Wi<span class="_ _3"></span><span class="ls0">th <span class="_ _16"> </span>thread-safe <span class="_ _61"> </span>functions, <span class="_ _16"> </span>implementations <span class="_ _16"> </span>provide <span class="_ _16"> </span>alternative, <span class="_ _16"> </span>thread-safe</span></div><div class="t m0 x32 h55 y3732 ff19 fs2c fc0 sc0 ls0 ws0">versions <span class="_ _3"></span>of <span class="_ _3"></span>some <span class="_ _3"></span>of <span class="_ _9"></span>the <span class="_ _3"></span>POSIX.1 <span class="_ _3"></span>functions <span class="_ _9"></span>that <span class="_ _3"></span>aren’t <span class="_ _2"></span>thread-safe. <span class="_ _47"> </span>Figur<span class="lsed0">e1<span class="_ _b"></span><span class="ls0">2.10 <span class="_ _9"></span>lists <span class="_ _3"></span>the</span></span></div><a class="l" href="#pf11" data-dest-detail='[17,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.893259px;bottom:1110.288916px;width:101.232392px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
