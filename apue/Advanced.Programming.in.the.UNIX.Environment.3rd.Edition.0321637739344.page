<div id="pf158" class="pf w4 h1f" data-page-no="158"><div class="pc pc158 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg158.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">310<span class="_ _1b"> </span><span class="ff19">Process <span class="_"> </span>Relationships<span class="_ _18d"> </span>Chapter <span class="_"> </span>9</span></div><div class="t m0 x35 h53 y12f ff16 fs2b fc0 sc0 ls0 ws0">9.11 <span class="_ _93"> </span>FreeBSD<span class="_ _54"> </span>Implementation</div><div class="t m0 x32 h2a y681 ff19 fsf fc0 sc0 ls0 ws0">Having <span class="_ _53"> </span>talked <span class="_ _53"> </span>about <span class="_ _53"> </span>the <span class="_ _53"> </span>various <span class="_ _53"> </span>attributes <span class="_ _53"> </span>of <span class="_ _53"> </span>a <span class="_ _53"> </span>process, <span class="_ _42"> </span>process <span class="_ _53"> </span>group, <span class="_ _42"> </span>session, <span class="_ _53"> </span>and</div><div class="t m0 x32 h2a y683 ff19 fsf fc0 sc0 ls0 ws0">controlling <span class="_ _3"></span>terminal, <span class="_ _3"></span>it’s <span class="_ _9"></span>worth <span class="_ _3"></span>looking <span class="_ _9"></span>at <span class="_ _3"></span>how <span class="_ _9"></span>all <span class="_ _9"></span>this <span class="_ _3"></span>can <span class="_ _9"></span>be <span class="_ _3"></span>implemented.<span class="_ _5a"> </span><span class="ls5f">We<span class="_ _9"></span></span>’ll <span class="_ _3"></span>look</div><div class="t m0 x32 h2a y685 ff19 fsf fc0 sc0 ls0 ws0">brieﬂy <span class="_ _5a"> </span>at <span class="_ _5a"> </span>the <span class="_ _5a"> </span>implementation <span class="_ _51"> </span>used <span class="_ _16"> </span>by <span class="_ _51"> </span>Fr<span class="_ _0"></span>eeBSD. <span class="_ _1a3"> </span>Some<span class="_ _1a3"> </span>details <span class="_ _51"> </span>of <span class="_ _5a"> </span>the <span class="_ _5a"> </span>SVR4</div><div class="t m0 x32 h2a y686 ff19 fsf fc0 sc0 ls0 ws0">implementation of these features can be found in W<span class="_ _6"></span>illiams</div><div class="t m0 x1d1 h2a y281f ff19 fsf fc0 sc0 ls0 ws0">[</div><div class="t m0 x1c7 h2a y686 ff19 fsf fc0 sc0 ls0 ws0">1989</div><div class="t m0 x13d h2a y281f ff19 fsf fc0 sc0 ls0 ws0">]</div><div class="t m0 x165 h2a y686 ff19 fsf fc0 sc0 lsb5c ws0">.F<span class="_ _4a"></span><span class="ls0">igur<span class="lsb5d">e9<span class="_ _4f"></span><span class="ls0">.13 shows the</span></span></span></div><div class="t m0 x32 h2a y687 ff19 fsf fc0 sc0 ls0 ws0">various data structur<span class="_ _0"></span>es used by FreeBSD.</div><div class="t m0 x183 h5e y2820 ff1a fs10 fc0 sc0 ls0 ws0">p_pglist</div><div class="t m0 x183 h4f y2821 ff1a fs11 fc0 sc0 ls0 ws0">p_pid</div><div class="t m0 x183 h6d y2822 ff1a fs12 fc0 sc0 ls0 ws0">p_pptr</div><div class="t m0 x183 h63 y2823 ff1a fs13 fc0 sc0 ls0 ws0">p_pgrp</div><div class="t m0 x14d h6f y2824 ff1a fs14 fc0 sc0 ls0 ws0">proc<span class="_ _53"> </span><span class="ff19">structure</span></div><div class="t m0 x15f h66 y2825 ff1a fs15 fc0 sc0 ls0 ws0">p_pglist</div><div class="t m0 x15f h70 y2826 ff1a fs16 fc0 sc0 ls0 ws0">p_pid</div><div class="t m0 x15f h71 y2827 ff1a fs36 fc0 sc0 ls0 ws0">p_pptr</div><div class="t m0 x15f hcc y2828 ff1a fs17 fc0 sc0 ls0 ws0">p_pgrp</div><div class="t m0 x13 hd4 y2829 ff1a fs18 fc0 sc0 ls0 ws0">proc<span class="_ _53"> </span><span class="ff19">structure</span></div><div class="t m0 x1c7 hd5 y282a ff1a fs19 fc0 sc0 ls0 ws0">p_pglist</div><div class="t m0 x1c7 h8d y282b ff1a fs1a fc0 sc0 ls0 ws0">p_pid</div><div class="t m0 x1c7 hd6 y282c ff1a fs1b fc0 sc0 ls0 ws0">p_pptr</div><div class="t m0 x1c7 hd7 y282d ff1a fs1c fc0 sc0 ls0 ws0">p_pgrp</div><div class="t m0 xad h128 y282e ff1a fs43 fc0 sc0 ls0 ws0">proc<span class="_ _53"> </span><span class="ff19">structure</span></div><div class="t m0 x4a h103 y282f ff1a fs1e fc0 sc0 ls0 ws0">pg_id</div><div class="t m0 x4a hde y2830 ff1a fs1f fc0 sc0 ls0 ws0">pg_session</div><div class="t m0 x4a h11c y2831 ff1a fs20 fc0 sc0 ls0 ws0">pg_members</div><div class="t m0 xac h11c y2832 ff1a fs20 fc0 sc0 ls0 ws0">pgrp<span class="_ _53"> </span><span class="ff19">structure</span></div><div class="t m0 xdc he1 y2833 ff1a fs21 fc0 sc0 ls0 ws0">s_count</div><div class="t m0 xdc h129 y2834 ff1a fs22 fc0 sc0 ls0 ws0">s_leader</div><div class="t m0 xdc h11f y2835 ff1a fs23 fc0 sc0 ls0 ws0">s_ttyvp</div><div class="t m0 xdc h12a y2836 ff1a fs24 fc0 sc0 ls0 ws0">s_ttyp</div><div class="t m0 xdc h12b y2837 ff1a fs85 fc0 sc0 ls0 ws0">s_sid</div><div class="t m0 x176 h12b y2838 ff1a fs85 fc0 sc0 ls0 ws0">session<span class="_ _53"> </span><span class="ff19">structure</span></div><div class="t m0 xb2 h12c y2839 ff1a fsa3 fc0 sc0 ls0 ws0">v_data</div><div class="t m0 x1c3 h12c y283a ff1a fsa3 fc0 sc0 ls0 ws0">vnode<span class="_ _53"> </span><span class="ff19">structure</span></div><div class="t m0 x6a h12d y283b ff1a fsa4 fc0 sc0 ls0 ws0">t_session</div><div class="t m0 x6a h12e y283c ff1a fs57 fc0 sc0 ls0 ws0">t_pgrp</div><div class="t m0 x6a h12f y283d ff1a fsa5 fc0 sc0 ls0 ws0">t_termios</div><div class="t m0 x6a hbd y283e ff1a fs67 fc0 sc0 ls0 ws0">t_winsize</div><div class="t m0 x1f4 h130 y283f ff1a fsa6 fc0 sc0 ls0 ws0">tty<span class="_ _53"> </span><span class="ff19">structure</span></div><div class="t m2a x180 h131 y2840 ff19 fsa7 fc0 sc0 ls0 ws0">foregr<span class="_ _0"></span>ound</div><div class="t m2a x1e5 h131 y2841 ff19 fsa7 fc0 sc0 ls0 ws0">process gr<span class="_ _0"></span>oup</div><div class="t m0 xe2 h132 y2842 ff19 fsa8 fc0 sc0 ls0 ws0">linked list of</div><div class="t m0 x1a6 h132 y2843 ff19 fsa8 fc0 sc0 ls0 ws0">process gr<span class="_ _0"></span>oup members</div><div class="t m0 xf6 h133 y2844 ff18 fsa9 fc0 sc0 ls0 ws0">Figure 9.13<span class="_ _5a"> </span><span class="ff19">FreeBSD implementation of sessions and process gr<span class="_ _0"></span>oups</span></div><div class="t m0 x12a h134 y2845 ff19 fsaa fc0 sc0 ls0 ws0">Let’s <span class="_ _9"></span>look <span class="_ _9"></span>at <span class="_ _9"></span>all <span class="_ _9"></span>the <span class="_ _9"></span>ﬁelds <span class="_ _9"></span>that <span class="_ _9"></span>we’ve <span class="_ _9"></span>labeled, <span class="_ _23"></span>starting <span class="_ _9"></span>with <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">session<span class="_ _45"> </span></span>structur<span class="_ _1"></span>e.</div><div class="t m0 x32 h134 y2846 ff19 fsaa fc0 sc0 ls0 ws0">One of these structur<span class="_ _0"></span>es is allocated for each session (e.g., each time<span class="_"> </span><span class="ff1a">setsid<span class="_ _80"> </span></span>is called).</div><div class="t m0 x12a h134 y2847 ff19 fsaa fc0 sc0 ls0 ws0">•<span class="_ _5c"> </span><span class="ff1a">s_count<span class="_ _45"> </span></span>is <span class="_ _9"></span>the <span class="_ _9"></span>number <span class="_ _9"></span>of <span class="_ _9"></span>process <span class="_ _3"></span>groups <span class="_ _9"></span>in <span class="_ _9"></span>the <span class="_ _9"></span>session.<span class="_ _5a"> </span>When <span class="_ _9"></span>this <span class="_ _9"></span>counter <span class="_ _9"></span>is</div><div class="t m0 x15 h135 y2848 ff19 fsaa fc0 sc0 ls0 ws0">decremented to 0, the str<span class="_ _0"></span>uctur<span class="lsb5e">ec<span class="_ _4f"></span><span class="ls0">an be freed.</span></span></div><a class="l" href="#pff" data-dest-detail='[15,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892409px;bottom:1236.288916px;width:182.027794px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
