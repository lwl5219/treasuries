<div id="pf24c" class="pf w4 h1f" data-page-no="24c"><div class="pc pc24c w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg24c.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">554<span class="_ _1b"> </span><span class="ff19">Interprocess <span class="_"> </span>Communication<span class="_ _2c"> </span>Chapter <span class="_"> </span>15</span></div><div class="t m0 x32 h26 y12f ff19 fsf fc0 sc0 ls0 ws0">interleaved. <span class="_ _45"> </span>As<span class="_ _45"> </span>with <span class="_ _3"></span>pipes, <span class="_ _23"></span>the <span class="_ _3"></span>constant<span class="_ _45"> </span><span class="ff1a">PIPE_BUF<span class="_ _45"> </span></span>speciﬁes <span class="_ _9"></span>the <span class="_ _9"></span>maximum <span class="_ _9"></span>amount <span class="_ _9"></span>of</div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">data that can be written atomically to a FIFO.</div><div class="t m0 x3f h2a y131 ff19 fsf fc0 sc0 ls0 ws0">Ther<span class="ls44">ea<span class="_ _4f"></span><span class="ls45">re <span class="_ _3"></span>t<span class="ls0">wo uses for FIFOs.</span></span></span></div><div class="t m0 x3f h2a y151 ff19 fsf fc0 sc0 ls0 ws0">1. <span class="_ _51"> </span>FIFOs<span class="_ _59"> </span>ar<span class="ls11c3">eu<span class="_ _4a"></span><span class="ls0">sed <span class="_"> </span>by <span class="_"> </span>shell <span class="_ _e"> </span>commands <span class="_"> </span>to <span class="_"> </span>pass <span class="_ _e"> </span>data <span class="_"> </span>from <span class="_ _e"> </span>one <span class="_"> </span>shell <span class="_"> </span>pipeline <span class="_"> </span>to</span></span></div><div class="t m0 x41 h2a ya63 ff19 fsf fc0 sc0 ls0 ws0">another without creating intermediate temporary ﬁles.</div><div class="t m0 x3f h2a y2a2c ff19 fsf fc0 sc0 ls0 ws0">2. <span class="_ _51"> </span>FIFOs<span class="_ _45"> </span>ar<span class="ls11c4">eu<span class="_ _b"></span><span class="ls0">sed <span class="_ _9"></span>as <span class="_ _23"></span>rendezvous <span class="_ _9"></span>points <span class="_ _9"></span>in <span class="_ _23"></span>client–server <span class="_ _9"></span>applications <span class="_ _23"></span>to <span class="_ _9"></span>pass <span class="_ _23"> </span>data</span></span></div><div class="t m0 x41 h2a y1f0d ff19 fsf fc0 sc0 ls0 ws0">between the clients and the servers.</div><div class="t m0 x32 h2a y153 ff19 fsf fc0 sc0 ls5f ws0">We <span class="_ _53"> </span>d<span class="_ _9"></span><span class="ls0">iscuss each of these uses with an example.</span></div><div class="t m0 x35 h27 y158 ff16 fsf fc0 sc0 ls0 ws0">Example <span class="_ _84"></span>— <span class="_ _84"></span>Using<span class="_"> </span>FIFOs to Duplicate Output Streams</div><div class="t m0 x32 h2a y1847 ff19 fsf fc0 sc0 ls0 ws0">FIFOs <span class="_ _23"></span>can <span class="_ _23"></span>be <span class="_ _9"></span>used <span class="_ _23"> </span>to <span class="_ _23"> </span>duplicate <span class="_ _23"> </span>an <span class="_ _23"></span>output <span class="_ _23"></span>stream <span class="_ _9"></span>in <span class="_ _23"></span>a <span class="_ _23"></span>series <span class="_ _23"></span>of <span class="_ _23"></span>shell <span class="_ _9"></span>commands.<span class="_ _51"> </span>This</div><div class="t m0 x32 h2a y1f0f ff19 fsf fc0 sc0 ls0 ws0">prevents <span class="_ _9"></span>writing <span class="_ _23"> </span>the <span class="_ _23"> </span>data <span class="_ _23"> </span>to <span class="_ _23"> </span>an <span class="_ _42"> </span>intermediate <span class="_ _23"></span>disk <span class="_ _23"></span>ﬁle <span class="_ _23"></span>(similar <span class="_ _23"></span>to <span class="_ _23"></span>using <span class="_ _23"></span>pipes <span class="_ _23"></span>to <span class="_ _23"></span>avoid</div><div class="t m0 x32 h2a y39a9 ff19 fsf fc0 sc0 ls0 ws0">intermediate <span class="_ _e"> </span>disk <span class="_ _e"> </span>ﬁles).<span class="_ _48"> </span>But <span class="_ _e"> </span>whereas <span class="_ _53"> </span>pipes <span class="_"> </span>can <span class="_ _53"> </span>be <span class="_ _e"> </span>used <span class="_"> </span>only <span class="_ _53"> </span>for <span class="_ _e"> </span>linear <span class="_ _e"> </span>connections</div><div class="t m0 x32 h2a y431f ff19 fsf fc0 sc0 ls0 ws0">between processes, a FIFO has a name, so it can be used for nonlinear connections.</div><div class="t m0 x3f h2a y4320 ff19 fsf fc0 sc0 ls0 ws0">Consider <span class="_ _59"> </span>a <span class="_ _59"> </span>procedur<span class="_ _1"></span><span class="ls11c5">et<span class="_ _64"></span><span class="ls0">hat <span class="_ _59"> </span>needs <span class="_ _59"> </span>to <span class="_ _59"> </span>process <span class="_ _4b"> </span>a <span class="_ _59"> </span>ﬁltered <span class="_ _4b"> </span>input <span class="_ _59"> </span>stream <span class="_ _59"> </span>twice.</span></span></div><div class="t m0 x32 h2a y4321 ff19 fsf fc0 sc0 ls0 ws0">Figur<span class="ls44">e1<span class="_ _4f"></span><span class="ls0">5.20 shows this arrangement.</span></span></div><div class="t m0 x12b h51 y4322 ff19 fs2a fc0 sc0 ls0 ws0">input</div><div class="t m0 xab h51 y4323 ff19 fs2a fc0 sc0 ls0 ws0">ﬁle</div><div class="t m0 x17 h5e y4324 ff1a fs10 fc0 sc0 ls0 ws0">prog1</div><div class="t m0 x1db h4f y4325 ff1a fs11 fc0 sc0 ls0 ws0">prog3</div><div class="t m0 x1db h6d y4326 ff1a fs12 fc0 sc0 ls0 ws0">prog2</div><div class="t m0 xae h31 y4327 ff18 fs14 fc0 sc0 ls0 ws0">Figure 15.20<span class="_ _5a"> </span><span class="ff19">Procedur<span class="ls56a">et<span class="_ _5"></span><span class="ls0">hat processes a ﬁltered input str<span class="_ _0"></span>eam twice</span></span></span></div><div class="t m0 x3f h9b y4328 ff19 fs49 fc0 sc0 ls11c6 ws0">Wi<span class="_ _3"></span><span class="ls0">th <span class="_ _e"> </span>a <span class="_ _e"> </span>FIFO <span class="_"> </span>and <span class="_ _53"> </span>the <span class="_"> </span>UNIX <span class="_ _53"> </span>program<span class="_ _4b"> </span><span class="ff1a">tee</span></span></div><div class="t m0 xa9 h96 y4329 ff19 fs49 fc0 sc0 ls0 ws0">(</div><div class="t m0 x93 h96 y4328 ff19 fs49 fc0 sc0 ls0 ws0">1</div><div class="t m0 x173 h96 y4329 ff19 fs49 fc0 sc0 ls0 ws0">)</div><div class="t m0 x19c h96 y4328 ff19 fs49 fc0 sc0 ls0 ws0">,<span class="_ _4b"> </span>we<span class="_ _59"> </span>can <span class="_ _e"> </span>accomplish <span class="_"> </span>this <span class="_ _53"> </span>procedur<span class="_ _0"></span>e</div><div class="t m0 x32 h9b y432a ff19 fs49 fc0 sc0 ls0 ws0">without <span class="_ _3"></span>using <span class="_ _2"></span>a <span class="_ _3"></span>temporary <span class="_ _3"></span>ﬁle.<span class="_ _16"> </span>(The<span class="_ _47"> </span><span class="ff1a">tee<span class="_ _45"> </span></span>pr<span class="_ _0"></span>ogram <span class="_ _2"></span>copies <span class="_ _3"></span>its <span class="_ _3"></span>standar<span class="ls11c7">di<span class="_ _8"></span><span class="ls0">nput <span class="_ _3"></span>to <span class="_ _3"></span>both <span class="_ _3"></span>its</span></span></div><div class="t m0 x32 h96 y432b ff19 fs49 fc0 sc0 ls0 ws0">standar<span class="ls48d">do<span class="_ _4f"></span><span class="ls0">utput and the ﬁle named on its command line.)</span></span></div><div class="t m0 x3f hc1 y432c ff1a fs69 fc0 sc0 ls0 ws0">mkfifo fifo1</div><div class="t m0 x3f hc1 y432d ff1a fs69 fc0 sc0 ls0 ws0">prog3 &lt; fifo1 &amp;</div><div class="t m0 x3f hc1 y432e ff1a fs69 fc0 sc0 ls0 ws0">prog1 &lt; infile | tee fifo1 | prog2</div><div class="t m0 x32 h9b y432f ff19 fs49 fc0 sc0 ls9ae ws0">We <span class="_ _53"> </span>c<span class="_ _9"></span><span class="ls4a6">re<span class="_ _2"></span><span class="ls0">ate the <span class="_ _2"></span>FIFO and then start<span class="_ _66"> </span><span class="ff1a">prog3<span class="_ _66"> </span></span>in the <span class="_ _2"></span>background, r<span class="_ _0"></span>eading from the FIFO.<span class="_ _46"> </span><span class="ls9ae">We</span></span></span></div><div class="t m0 x32 h9b y4330 ff19 fs49 fc0 sc0 ls0 ws0">then <span class="_ _45"> </span>start<span class="_ _51"> </span><span class="ff1a">prog1<span class="_"> </span></span>and <span class="_ _35"> </span>use<span class="_ _51"> </span><span class="ff1a">tee<span class="_"> </span></span>to <span class="_ _35"> </span>send <span class="_ _45"> </span>its <span class="_ _35"> </span>input <span class="_ _45"> </span>to <span class="_ _35"> </span>both <span class="_ _35"> </span>the <span class="_ _45"> </span>FIFO <span class="_ _35"> </span>and<span class="_ _5a"> </span><span class="ff1a">prog2</span>.</div><div class="t m0 x32 h96 y4331 ff19 fs49 fc0 sc0 ls0 ws0">Figur<span class="ls48d">e1<span class="_ _4f"></span><span class="ls0">5.21 shows the process arrangement.</span></span></div><div class="t m0 x35 hf8 y4332 ff16 fs33 fc0 sc0 ls0 ws0">Example <span class="_ _84"></span>— <span class="_ _84"></span>Client–Ser<span class="_ _2"></span>ver Communication Using a FIFO</div><div class="t m0 x32 h67 y4333 ff19 fs33 fc0 sc0 ls0 ws0">Another use <span class="_ _2"></span>for <span class="_ _2"></span>FIFOs <span class="_ _2"></span>is <span class="_ _2"></span>to <span class="_ _2"></span>send data <span class="_ _2"></span>between <span class="_ _2"></span>a <span class="_ _2"></span>client <span class="_ _2"></span>and <span class="_ _2"></span>a server<span class="_ _1"></span><span class="ls11c8">.I<span class="_ _4a"></span><span class="ls0">f<span class="_"> </span>we<span class="_ _66"> </span>have <span class="_ _2"></span>a <span class="_ _2"></span>server</span></span></div><div class="t m0 x32 h67 y4334 ff19 fs33 fc0 sc0 ls0 ws0">that <span class="_ _3"></span>is <span class="_ _3"></span>contacted <span class="_ _3"></span>by <span class="_ _9"></span>numerous <span class="_ _2"></span>clients, <span class="_ _3"></span>each <span class="_ _9"></span>client <span class="_ _3"></span>can <span class="_ _3"></span>write <span class="_ _3"></span>its <span class="_ _9"></span>request <span class="_ _2"></span>to <span class="_ _3"></span>a <span class="_ _9"></span>well-known</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
