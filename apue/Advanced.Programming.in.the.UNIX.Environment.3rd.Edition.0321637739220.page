<div id="pfdc" class="pf w4 h1f" data-page-no="dc"><div class="pc pcdc w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bgdc.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">186<span class="_ _1b"> </span><span class="ff19">System <span class="_"> </span>Data <span class="_"> </span>Files <span class="_"> </span>and <span class="_"> </span>Information<span class="_ _114"> </span>Chapter <span class="_"> </span>6</span></div><div class="t m0 x3f h2a y12f ff19 fsf fc0 sc0 ls0 ws0">The general principle is that every data ﬁle has at least three functions:</div><div class="t m0 x3f h26 y404 ff19 fsf fc0 sc0 ls0 ws0">1. <span class="_ _51"> </span>A<span class="_ _45"> </span><span class="ff1a">get<span class="_ _45"> </span></span>function <span class="_ _23"></span>that <span class="_ _9"></span>reads <span class="_ _9"></span>the <span class="_ _9"></span>next <span class="_ _23"></span>recor<span class="_ _1"></span>d, <span class="_ _23"></span>opening <span class="_ _9"></span>the <span class="_ _23"></span>ﬁle <span class="_ _9"></span>if <span class="_ _9"></span>necessary<span class="_ _6"></span><span class="ls7d1">.T<span class="_ _26"></span><span class="ls0">hese</span></span></div><div class="t m0 x41 h2a y405 ff19 fsf fc0 sc0 ls0 ws0">functions <span class="_ _42"> </span>normally <span class="_ _23"> </span>return <span class="_ _23"> </span>a <span class="_ _42"> </span>pointer <span class="_ _42"> </span>to <span class="_ _42"> </span>a <span class="_ _23"> </span>structure. <span class="_ _35"> </span>A<span class="_ _35"> </span>null <span class="_ _42"> </span>pointer <span class="_ _42"> </span>is <span class="_ _42"> </span>returned</div><div class="t m0 x41 h26 y1fb ff19 fsf fc0 sc0 ls0 ws0">when <span class="_ _2"></span>the <span class="_ _3"></span>end <span class="_ _3"></span>of <span class="_ _3"></span>ﬁle <span class="_ _3"></span>is <span class="_ _3"></span>reached. <span class="_ _47"> </span>Most<span class="_ _47"> </span>of <span class="_ _2"></span>the<span class="_ _47"> </span><span class="ff1a">get<span class="_ _47"> </span></span>functions <span class="_ _3"></span>return <span class="_ _2"></span>a <span class="_ _3"></span>pointer <span class="_ _3"></span>to <span class="_ _3"></span>a</div><div class="t m0 x41 h26 y1fc ff1a fsf fc0 sc0 ls0 ws0">static<span class="_ _66"> </span><span class="ff19">structur<span class="_ _0"></span>e, so <span class="_ _2"></span>we always <span class="_ _2"></span>have to <span class="_ _2"></span>copy <span class="_ _2"></span>the structur<span class="ls24c">ei<span class="_ _4f"></span><span class="ls0">f<span class="_ _66"> </span>we<span class="_ _66"> </span>want <span class="_ _2"></span>to save <span class="_ _2"></span>it.</span></span></span></div><div class="t m0 x3f h26 y1931 ff19 fsf fc0 sc0 ls0 ws0">2. <span class="_ _51"> </span>A<span class="_ _66"> </span><span class="ff1a">set<span class="_ _66"> </span></span>function <span class="_ _2"></span>that <span class="_ _2"></span>opens <span class="_ _2"></span>the <span class="_ _2"></span>ﬁle, <span class="_ _2"></span>if <span class="_ _2"></span>not <span class="_ _2"></span>already open, <span class="_ _2"></span>and <span class="_ _2"></span>rewinds the <span class="_ _2"></span>ﬁle.<span class="_ _61"> </span><span class="ls5f">We</span></div><div class="t m0 x41 h2a y1fe ff19 fsf fc0 sc0 ls0 ws0">use <span class="_ _3"></span>this <span class="_ _3"></span>function <span class="_ _3"></span>when <span class="_ _9"></span>we <span class="_ _3"></span>know <span class="_ _3"></span>we <span class="_ _3"></span>want <span class="_ _9"></span>to <span class="_ _3"></span>start <span class="_ _3"></span>again <span class="_ _3"></span>at <span class="_ _3"></span>the <span class="_ _9"></span>beginning <span class="_ _3"></span>of <span class="_ _3"></span>the</div><div class="t m0 x41 h2a y1ff ff19 fsf fc0 sc0 ls0 ws0">ﬁle.</div><div class="t m0 x3f h26 y1932 ff19 fsf fc0 sc0 ls0 ws0">3. <span class="_ _51"> </span>An<span class="_"> </span><span class="ff1a">end<span class="_ _66"> </span></span>entry <span class="_ _2"></span>that closes <span class="_ _2"></span>the data <span class="_ _2"></span>ﬁle.<span class="_ _46"> </span>As <span class="_ _2"></span>we mentioned <span class="_ _2"></span>earlier<span class="_ _6"></span>,<span class="_ _66"> </span>we<span class="_ _66"> </span>always <span class="_ _2"></span>have</div><div class="t m0 x41 h2a y201 ff19 fsf fc0 sc0 ls0 ws0">to call this function when we’r<span class="ls44">ed<span class="_ _4f"></span><span class="ls0">one, to close all the ﬁles.</span></span></div><div class="t m0 x32 h2a y1155 ff19 fsf fc0 sc0 ls0 ws0">Additionally<span class="_ _4"></span>,<span class="_ _66"> </span>if<span class="_ _66"> </span>the <span class="_ _2"></span>data ﬁle <span class="_ _2"></span>supports some <span class="_ _2"></span>form of <span class="_ _2"></span>keyed lookup, <span class="_ _2"></span>routines ar<span class="ls64b">ep<span class="_ _4f"></span><span class="ls45">ro<span class="_ _2"></span><span class="ls0">vided</span></span></span></div><div class="t m0 x32 h2a y961 ff19 fsf fc0 sc0 ls0 ws0">to <span class="_ _3"></span>search <span class="_ _9"></span>for <span class="_ _3"></span>a <span class="_ _9"></span>recor<span class="ls7d2">dw<span class="_ _b"></span><span class="ls0">ith <span class="_ _3"></span>a <span class="_ _9"></span>speciﬁc <span class="_ _9"></span>key<span class="_ _4"></span><span class="ls7d3">.F<span class="_ _1d"></span><span class="ls0">or <span class="_ _3"></span>example, <span class="_ _9"></span>two <span class="_ _9"></span>keyed <span class="_ _9"></span>lookup <span class="_ _9"></span>routines <span class="_ _3"></span>are</span></span></span></span></div><div class="t m0 x32 h26 y962 ff19 fsf fc0 sc0 ls0 ws0">provided <span class="_ _2"></span>for <span class="_ _2"></span>the <span class="_ _3"></span>passwor<span class="ls5be">dﬁ<span class="_ _8"></span><span class="ls0">le:<span class="_ _47"> </span><span class="ff1a">getpwnam<span class="_ _47"> </span></span>looks <span class="_ _2"></span>for <span class="_ _3"></span>a <span class="_ _3"></span>recor<span class="_ _0"></span><span class="ls7d4">dw<span class="_ _8"></span><span class="ls0">ith <span class="_ _3"></span>a <span class="_ _3"></span>speciﬁc <span class="_ _2"></span>user <span class="_ _3"></span>name,</span></span></span></span></div><div class="t m0 x32 h26 y963 ff19 fsf fc0 sc0 ls0 ws0">and<span class="_"> </span><span class="ff1a">getpwuid<span class="_ _80"> </span></span>looks for a recor<span class="ls44">dw<span class="_ _4f"></span><span class="ls0">ith a speciﬁc user ID.</span></span></div><div class="t m0 x3f h2a y964 ff19 fsf fc0 sc0 ls0 ws0">Figur<span class="ls3e1">e6<span class="_ _b"></span><span class="ls0">.6 <span class="_ _3"></span>shows <span class="_ _23"></span>some <span class="_ _9"></span>of <span class="_ _9"></span>these <span class="_ _23"></span>routines, <span class="_ _9"></span>which <span class="_ _9"></span>ar<span class="ls3e1">ec<span class="_ _b"></span><span class="ls0">ommon <span class="_ _9"></span>to <span class="_ _9"></span>UNIX <span class="_ _9"></span>systems.<span class="_ _51"> </span>In</span></span></span></span></div><div class="t m0 x32 h2a yebd ff19 fsf fc0 sc0 ls0 ws0">this <span class="_ _e"> </span>ﬁgure, <span class="_ _53"> </span>we <span class="_"> </span>show <span class="_ _53"> </span>the <span class="_"> </span>functions <span class="_ _53"> </span>for <span class="_ _e"> </span>the <span class="_"> </span>passwor<span class="_ _1"></span><span class="ls7d5">dﬁ<span class="_ _55"></span><span class="ls0">les <span class="_"> </span>and <span class="_ _53"> </span>group <span class="_ _e"> </span>ﬁle, <span class="_ _e"> </span>which <span class="_ _e"> </span>we</span></span></div><div class="t m0 x32 h26 yebe ff19 fsf fc0 sc0 ls0 ws0">discussed <span class="_ _2"></span>earlier <span class="_ _3"></span>in <span class="_ _3"></span>this <span class="_ _3"></span>chapter<span class="_ _6"></span><span class="ls590">,a<span class="_ _4f"></span><span class="ls0">nd <span class="_ _3"></span>some <span class="_ _2"></span>of <span class="_ _3"></span>the <span class="_ _3"></span>networking <span class="_ _3"></span>functions.<span class="_ _61"> </span>Ther<span class="ls81">ea<span class="_ _8"></span><span class="ls45">re<span class="_ _45"> </span><span class="ff1a ls0">get<span class="ff19">,</span></span></span></span></span></span></div><div class="t m0 x32 h26 yebf ff1a fsf fc0 sc0 ls0 ws0">set<span class="ff19 ls44">,a<span class="_ _d"></span><span class="ls0">nd<span class="_"> </span><span class="ff1a">end<span class="_ _66"> </span></span>functions for all the data ﬁles in this ﬁgure.</span></span></div><div class="t m0 x1c4 h2d y1933 ff19 fs10 fc0 sc0 ls0 ws0">Description <span class="_ _18"> </span>Data<span class="_"> </span>ﬁle <span class="_ _17c"> </span>Header<span class="_ _15"> </span>Structur<span class="ls7d6">eA<span class="_ _1fa"></span><span class="ls0">dditional keyed lookup functions</span></span></div><div class="t m0 x1c4 h4f y1934 ff19 fs11 fc0 sc0 ls0 ws0">passwords<span class="_ _141"> </span><span class="ff1a">/etc/passwd <span class="_ _9c"> </span>&lt;pwd.h&gt; <span class="_ _1fb"> </span>passwd<span class="_ _9c"> </span>getpwnam</span>,<span class="_"> </span><span class="ff1a">getpwuid</span></div><div class="t m0 x1c4 h4f y1935 ff19 fs11 fc0 sc0 ls0 ws0">groups<span class="_ _78"> </span><span class="ff1a">/etc/group <span class="_ _129"> </span>&lt;grp.h&gt;<span class="_ _129"> </span>group <span class="_ _1fb"> </span>getgrnam</span>,<span class="_"> </span><span class="ff1a">getgrgid</span></div><div class="t m0 x1c4 h4f y1936 ff19 fs11 fc0 sc0 ls0 ws0">shadow<span class="_ _76"> </span><span class="ff1a">/etc/shadow <span class="_ _1fb"> </span>&lt;shadow.h&gt;<span class="_ _5f"> </span>spwd <span class="_ _129"> </span>getspnam</span></div><div class="t m0 x1c4 h6d y1937 ff19 fs12 fc0 sc0 ls0 ws0">hosts<span class="_ _10b"> </span><span class="ff1a">/etc/hosts <span class="_ _129"> </span>&lt;netdb.h&gt;<span class="_ _6d"> </span>hostent <span class="_ _50"> </span>getnameinfo</span>,<span class="_"> </span><span class="ff1a">getaddrinfo</span></div><div class="t m0 x1c4 h6d y1938 ff19 fs12 fc0 sc0 ls0 ws0">networks<span class="_ _68"> </span><span class="ff1a">/etc/networks <span class="_ _5f"> </span>&lt;netdb.h&gt; <span class="_ _50"> </span>netent<span class="_ _1fb"> </span>getnetbyname</span>,<span class="_"> </span><span class="ff1a">getnetbyaddr</span></div><div class="t m0 x1c4 h6d y1939 ff19 fs12 fc0 sc0 ls0 ws0">protocols<span class="_ _87"> </span><span class="ff1a">/etc/protocols <span class="_ _47"> </span>&lt;netdb.h&gt;<span class="_ _6d"> </span>protoent <span class="_ _45"> </span>getprotobyname</span>,<span class="_"> </span><span class="ff1a">getprotobynumber</span></div><div class="t m0 x1c4 h6d y193a ff19 fs12 fc0 sc0 ls0 ws0">services<span class="_ _76"> </span><span class="ff1a">/etc/services <span class="_ _5f"> </span>&lt;netdb.h&gt; <span class="_ _5f"> </span>servent <span class="_ _50"> </span>getservbyname</span>,<span class="_"> </span><span class="ff1a">getservbyport</span></div><div class="t m0 x4 h30 y193b ff18 fs13 fc0 sc0 ls0 ws0">Figure 6.6<span class="_ _5a"> </span><span class="ff19">Similar routines for accessing system data ﬁles</span></div><div class="t m0 x76 h30 y193c ff19 fs13 fc0 sc0 ls0 ws0">Under <span class="_ _2"></span>Solaris, <span class="_ _2"></span>the <span class="_ _2"></span>last <span class="_ _3"></span>four <span class="_ _2"></span>data <span class="_ _2"></span>ﬁles <span class="_ _2"></span>in <span class="_ _3"></span>Figur<span class="ls7d7">e6<span class="_ _d"></span><span class="ls0">.6 <span class="_ _2"></span>ar<span class="ls7d7">es<span class="_ _5"></span><span class="ls0">ymbolic <span class="_ _2"></span>links <span class="_ _2"></span>to <span class="_ _3"></span>ﬁles <span class="_ _2"></span>of <span class="_ _2"></span>the <span class="_ _2"></span>same <span class="_ _3"></span>name</span></span></span></span></div><div class="t m0 x76 h63 y193d ff19 fs13 fc0 sc0 ls0 ws0">in <span class="_ _9"></span>the <span class="_ _3"></span>directory<span class="_ _66"> </span><span class="ff1a">/etc/inet</span><span class="ls7d8">.M<span class="_ _55"></span><span class="ls0">ost <span class="_ _9"></span>UNIX <span class="_ _3"></span>System <span class="_ _9"> </span>implementations <span class="_ _9"></span>have <span class="_ _9"></span>additional <span class="_ _9"></span>functions</span></span></div><div class="t m0 x76 h30 y193e ff19 fs13 fc0 sc0 ls0 ws0">that <span class="_ _9"></span>ar<span class="ls7d9">el<span class="_ _8"></span><span class="ls0">ike <span class="_ _9"></span>these, <span class="_ _9"></span>but <span class="_ _9"> </span>the <span class="_ _9"> </span>additional <span class="_ _9"> </span>functions <span class="_ _9"> </span>tend <span class="_ _9"> </span>to <span class="_ _9"> </span>deal <span class="_ _23"> </span>with <span class="_ _3"></span>system <span class="_ _9"> </span>administration <span class="_ _9"> </span>ﬁles</span></span></div><div class="t m0 x76 h30 y193f ff19 fs13 fc0 sc0 ls0 ws0">and ar<span class="ls673">es<span class="_ _5"></span><span class="ls0">peciﬁc to each implementation.</span></span></div><div class="t m0 x35 h78 y1940 ff16 fs3a fc0 sc0 ls0 ws0">6.8 <span class="_ _68"> </span>Login<span class="_ _54"> </span>Accounting</div><div class="t m0 x32 h64 y1941 ff19 fs31 fc0 sc0 ls7da ws0">Tw<span class="_ _9"></span><span class="ls7db">od<span class="_ _d"></span><span class="ls0">ata ﬁles provided with most UNIX systems ar<span class="ls7dc">et<span class="_ _d"></span><span class="ls0">he<span class="_"> </span><span class="ff1a">utmp<span class="_ _66"> </span></span>ﬁle, which keeps track of</span></span></span></span></div><div class="t m0 x32 h64 y1942 ff19 fs31 fc0 sc0 ls0 ws0">all <span class="_ _3"></span>the <span class="_ _9"></span>users <span class="_ _3"></span>currently <span class="_ _3"></span>logged <span class="_ _3"></span>in, <span class="_ _9"></span>and <span class="_ _3"></span>the<span class="_ _45"> </span><span class="ff1a">wtmp<span class="_ _47"> </span></span>ﬁle, <span class="_ _3"></span>which <span class="_ _9"></span>keeps <span class="_ _3"></span>track <span class="_ _3"></span>of <span class="_ _9"></span>all <span class="_ _3"></span>logins <span class="_ _9"></span>and</div><div class="t m0 x32 h6e y1943 ff19 fs31 fc0 sc0 ls0 ws0">logouts. <span class="_ _35"> </span>W<span class="_ _1"></span>ith <span class="_ _23"></span>V<span class="_ _4"></span>ersion <span class="_ _23"> </span>7, <span class="_ _23"> </span>one <span class="_ _23"> </span>type <span class="_ _42"> </span>of <span class="_ _23"></span>r<span class="_ _0"></span>ecor<span class="ls30c">dw<span class="_ _43"></span><span class="ls0">as <span class="_ _23"></span>written <span class="_ _23"> </span>to <span class="_ _23"> </span>both <span class="_ _23"> </span>ﬁles, <span class="_ _23"> </span>a <span class="_ _23"> </span>binary <span class="_ _23"> </span>record</span></span></div><div class="t m0 x32 h6e y1944 ff19 fs31 fc0 sc0 ls0 ws0">consisting of the following structur<span class="_ _0"></span>e:</div><a class="l" href="#pfe" data-dest-detail='[14,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.894300px;bottom:298.010992px;width:141.335899px;height:19.680008px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
