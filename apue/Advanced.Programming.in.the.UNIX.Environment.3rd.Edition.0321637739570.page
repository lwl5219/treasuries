<div id="pf23a" class="pf w4 h1f" data-page-no="23a"><div class="pc pc23a w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg23a.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">536<span class="_ _1b"> </span><span class="ff19">Interprocess <span class="_"> </span>Communication<span class="_ _2c"> </span>Chapter <span class="_"> </span>15</span></div><div class="t m0 x45 h5e y412d ff1a fs10 fc0 sc0 ls0 ws0">fork</div><div class="t m0 x20e h2e y412e ff19 fs11 fc0 sc0 ls0 ws0">parent<span class="_ _21e"> </span>child</div><div class="t m0 x185 h4f y412f ff1a fs11 fc0 sc0 ls0 ws0">fd[0]<span class="_ _6e"> </span>fd[1]<span class="_ _25"> </span>fd[0]<span class="_ _288"> </span>fd[1]</div><div class="t m0 x207 h2f y4130 ff19 fs12 fc0 sc0 ls0 ws0">kernel</div><div class="t m0 x67 h30 y4131 ff19 fs13 fc0 sc0 ls0 ws0">pipe</div><div class="t m0 xa7 h71 y4132 ff18 fs36 fc0 sc0 ls0 ws0">Figure 15.3<span class="_ _5a"> </span><span class="ff19">Half-duplex pipe after a<span class="_"> </span><span class="ff1a">fork</span></span></div><div class="t m0 x3f h73 y4133 ff19 fs38 fc0 sc0 ls0 ws0">What <span class="_ _23"> </span>happens <span class="_ _42"> </span>after <span class="_ _23"> </span>the<span class="_ _35"> </span><span class="ff1a">fork<span class="_ _35"> </span></span>depends <span class="_ _42"> </span>on <span class="_ _23"> </span>which <span class="_ _42"> </span>direction <span class="_ _23"></span>of <span class="_ _23"></span>data <span class="_ _23"> </span>ﬂow <span class="_ _42"> </span>we <span class="_ _23"> </span>want.</div><div class="t m0 x32 h74 y4134 ff19 fs38 fc0 sc0 ls0 ws0">For <span class="_ _e"> </span>a <span class="_ _e"> </span>pipe <span class="_ _e"> </span>from <span class="_ _53"> </span>the <span class="_ _e"> </span>parent <span class="_ _e"> </span>to <span class="_ _e"> </span>the <span class="_ _e"> </span>child, <span class="_ _e"> </span>the <span class="_ _e"> </span>parent <span class="_ _53"> </span>closes <span class="_"> </span>the <span class="_ _53"> </span>read <span class="_ _53"> </span>end <span class="_"> </span>of <span class="_ _53"> </span>the <span class="_ _e"> </span>pipe</div><div class="t m0 x32 h73 y4135 ff19 fs38 fc0 sc0 ls0 ws0">(<span class="ff1a">fd[0]</span>), <span class="_ _23"></span>and <span class="_ _23"> </span>the <span class="_ _23"> </span>child <span class="_ _23"> </span>closes <span class="_ _42"> </span>the <span class="_ _23"></span>write <span class="_ _23"> </span>end <span class="_ _23"> </span>(<span class="ff1a">fd[1]</span>). <span class="_ _35"> </span>Figur<span class="ls1162">e1<span class="_ _43"></span><span class="ls0">5.4 <span class="_ _23"> </span>shows <span class="_ _23"> </span>the <span class="_ _42"> </span>r<span class="_ _0"></span>esulting</span></span></div><div class="t m0 x32 h74 y4136 ff19 fs38 fc0 sc0 ls0 ws0">arrangement of descriptors.</div><div class="t m0 x20e h34 y4137 ff19 fs17 fc0 sc0 ls0 ws0">parent<span class="_ _21e"> </span>child</div><div class="t m0 xc0 hcc y4138 ff1a fs17 fc0 sc0 ls0 ws0">fd[1]<span class="_ _25"> </span>fd[0]</div><div class="t m0 x207 h35 y4139 ff19 fs18 fc0 sc0 ls0 ws0">kernel</div><div class="t m0 x67 h36 y413a ff19 fs19 fc0 sc0 ls0 ws0">pipe</div><div class="t m0 x145 h38 y413b ff18 fs1b fc0 sc0 ls0 ws0">Figure 15.4<span class="_ _5a"> </span><span class="ff19">Pipe from parent to child</span></div><div class="t m0 x32 hf9 y413c ff19 fs88 fc0 sc0 ls0 ws0">For <span class="_ _23"></span>a <span class="_ _23"></span>pipe <span class="_ _23"></span>from <span class="_ _9"></span>the <span class="_ _23"> </span>child <span class="_ _23"> </span>to <span class="_ _23"></span>the <span class="_ _23"></span>parent, <span class="_ _9"></span>the <span class="_ _23"> </span>parent <span class="_ _23"></span>closes<span class="_ _35"> </span><span class="ff1a">fd[1]</span><span class="ls1163">,a<span class="_ _43"></span><span class="ls0">nd <span class="_ _23"> </span>the <span class="_ _23"> </span>child <span class="_ _23"> </span>closes</span></span></div><div class="t m0 x32 hf9 y413d ff1a fs88 fc0 sc0 ls0 ws0">fd[0]<span class="ff19">.</span></div><div class="t m0 x3f hfa y413e ff19 fs88 fc0 sc0 ls0 ws0">When one end of a pipe is closed, two rules apply<span class="_ _4"></span>.</div><div class="t m0 x3f hf9 y413f ff19 fs88 fc0 sc0 ls0 ws0">1. <span class="_ _51"> </span>If<span class="_ _44"> </span>we<span class="_ _35"> </span><span class="ff1a">read<span class="_ _44"> </span></span>from <span class="_ _42"> </span>a <span class="_ _42"> </span>pipe <span class="_ _42"> </span>whose <span class="_ _42"> </span>write <span class="_ _42"> </span>end <span class="_ _42"> </span>has <span class="_ _42"> </span>been <span class="_ _42"> </span>closed,<span class="_ _44"> </span><span class="ff1a">read<span class="_ _44"> </span></span><span class="ls1067">re</span>turns <span class="_ _53"> </span>0 <span class="_ _42"> </span>to</div><div class="t m0 x41 hfa y4140 ff19 fs88 fc0 sc0 ls0 ws0">indicate <span class="_ _9"></span>an <span class="_ _9"></span>end <span class="_ _9"></span>of <span class="_ _9"></span>ﬁle <span class="_ _9"></span>after <span class="_ _9"></span>all <span class="_ _9"></span>the <span class="_ _9"></span>data <span class="_ _9"></span>has <span class="_ _9"></span>been <span class="_ _23"></span>r<span class="_ _0"></span>ead. <span class="_ _45"> </span>(T<span class="_ _6"></span>echnically<span class="_ _4"></span>,<span class="_ _45"> </span>we<span class="_ _45"> </span>should</div><div class="t m0 x41 hfa y4141 ff19 fs88 fc0 sc0 ls0 ws0">say <span class="_ _9"></span>that <span class="_ _9"></span>this <span class="_ _9"></span>end <span class="_ _3"></span>of <span class="_ _9"></span>ﬁle <span class="_ _9"></span>is <span class="_ _9"></span>not <span class="_ _9"></span>generated <span class="_ _9"></span>until <span class="_ _9"></span>ther<span class="ls1164">ea<span class="_ _b"></span><span class="ls1067">re <span class="_ _23"></span>n<span class="ls1165">om<span class="_ _8"></span><span class="ls0">or<span class="ls1165">ew<span class="_ _b"></span><span class="ls0">riters <span class="_ _3"></span>for <span class="_ _9"></span>the</span></span></span></span></span></span></div><div class="t m0 x41 hfa y4142 ff19 fs88 fc0 sc0 ls0 ws0">pipe. <span class="_ _66"> </span>It’s<span class="_ _66"> </span>possible <span class="_ _2"></span>to <span class="_ _2"></span>duplicate <span class="_ _3"></span>a <span class="_ _2"></span>pipe <span class="_ _2"></span>descriptor <span class="_ _2"></span>so <span class="_ _2"></span>that <span class="_ _2"></span>multiple <span class="_ _2"></span>processes have</div><div class="t m0 x41 hfa y4143 ff19 fs88 fc0 sc0 ls0 ws0">the <span class="_ _42"> </span>pipe <span class="_ _42"> </span>open <span class="_ _42"> </span>for <span class="_ _53"> </span>writing.<span class="_ _54"> </span>Normally<span class="_ _4"></span><span class="ls1166">,h<span class="_ _43"></span><span class="ls0">owever<span class="_ _6"></span><span class="ls1166">,t<span class="_ _43"></span><span class="ls0">here<span class="_ _35"> </span>is<span class="_ _44"> </span>a<span class="_ _44"> </span>single <span class="_ _42"> </span>reader <span class="_ _42"> </span>and <span class="_ _42"> </span>a</span></span></span></span></div><div class="t m0 x41 hfa y4144 ff19 fs88 fc0 sc0 ls0 ws0">single writer <span class="_ _2"></span>for <span class="_ _2"></span>a <span class="_ _2"></span>pipe.<span class="_ _46"> </span>When <span class="_ _2"></span>we <span class="_ _2"></span>get <span class="_ _2"></span>to <span class="_ _2"></span>FIFOs in <span class="_ _2"></span>the <span class="_ _2"></span>next <span class="_ _2"></span>section, we’ll <span class="_ _2"></span>see <span class="_ _2"></span>that</div><div class="t m0 x41 hfa y4145 ff19 fs88 fc0 sc0 ls0 ws0">often ther<span class="lsb06">ea<span class="_ _4f"></span><span class="ls1067">re <span class="_ _3"></span>m<span class="ls0">ultiple writers for a single FIFO.)</span></span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
