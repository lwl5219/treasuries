<div id="pf112" class="pf w4 h1f" data-page-no="112"><div class="pc pc112 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg112.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">240<span class="_ _1b"> </span><span class="ff19">Process <span class="_"> </span>Contr<span class="_ _0"></span>ol <span class="_ _222"> </span>Chapter<span class="_ _4b"> </span>8</span></div><div class="t m0 x32 h57 y362 ff1a fs2d fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h57 y3c0 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;sys/wait.h&gt;</div><div class="t m0 x32 h57 y13a0 ff1a fs2d fc0 sc0 ls0 ws0">void</div><div class="t m0 x32 h57 y846 ff1a fs2d fc0 sc0 ls0 ws0">pr_exit(int status)</div><div class="t m0 x32 h57 y847 ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y13a1 ff1a fs2d fc0 sc0 ls0 ws0">if (WIFEXITED(status))</div><div class="t m0 x9d h57 y1fb8 ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;normal termination, exit status = %d\n&quot;,</div><div class="t m0 x1ca h57 y1fb9 ff1a fs2d fc0 sc0 ls0 ws0">WEXITSTATUS(status));</div><div class="t m0 x8a h57 y1fba ff1a fs2d fc0 sc0 ls0 ws0">else if (WIFSIGNALED(status))</div><div class="t m0 x9d h57 y1fbb ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;abnormal termination, signal number = %d%s\n&quot;,</div><div class="t m0 x1ca h57 y1fbc ff1a fs2d fc0 sc0 ls0 ws0">WTERMSIG(status),</div><div class="t m0 x32 h57 y1fbd ff1a fs2d fc0 sc0 ls0 ws0">#ifdef <span class="_"> </span>WCOREDUMP</div><div class="t m0 x1ca h57 y1fbe ff1a fs2d fc0 sc0 ls0 ws0">WCOREDUMP(status) ? &quot; (core file generated)&quot; : &quot;&quot;);</div><div class="t m0 x32 h57 y1fbf ff1a fs2d fc0 sc0 ls0 ws0">#else</div><div class="t m0 x1ca h57 y1fc0 ff1a fs2d fc0 sc0 ls0 ws0">&quot;&quot;);</div><div class="t m0 x32 h57 y1fc1 ff1a fs2d fc0 sc0 ls0 ws0">#endif</div><div class="t m0 x8a h57 y1fc2 ff1a fs2d fc0 sc0 ls0 ws0">else if (WIFSTOPPED(status))</div><div class="t m0 x9d h57 y1fc3 ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;child stopped, signal number = %d\n&quot;,</div><div class="t m0 x1ca h57 y1fc4 ff1a fs2d fc0 sc0 ls0 ws0">WSTOPSIG(status));</div><div class="t m0 x32 h57 y1fc5 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x36 h5e y1fc6 ff18 fs10 fc0 sc0 ls0 ws0">Figure 8.5<span class="_ _5a"> </span><span class="ff19">Print a description of the<span class="_"> </span><span class="ff1a">exit<span class="_ _e"> </span></span>status</span></div><div class="t m0 x76 h5e y1fc7 ff19 fs10 fc0 sc0 ls0 ws0">FreeBSD <span class="_ _3"></span>8.0, <span class="_ _9"></span>Linux <span class="_ _9"></span>3.2.0, <span class="_ _3"></span>Mac <span class="_ _9"></span>OS <span class="_ _9"></span>X <span class="_ _9"></span>10.6.8, <span class="_ _3"></span>and <span class="_ _9"></span>Solaris <span class="_ _9"></span>10 <span class="_ _9"></span>all <span class="_ _9"></span>support <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">WCOREDUMP<span class="_ _66"> </span></span>macro.</div><div class="t m0 x76 h5e y1fc8 ff19 fs10 fc0 sc0 ls0 ws0">However<span class="_ _1"></span><span class="ls99e">,s<span class="_ _b"></span><span class="ls0">ome <span class="_ _23"> </span>platforms <span class="_"> </span>hide <span class="_ _23"> </span>its <span class="_"> </span>deﬁnition <span class="_ _23"> </span>if <span class="_"> </span>the<span class="_ _45"> </span><span class="ff1a">_POSIX_C_SOURCE<span class="_ _45"> </span></span>constant <span class="_ _42"> </span>is <span class="_ _42"> </span>deﬁned</span></span></div><div class="t m0 x76 h2d y1fc9 ff19 fs10 fc0 sc0 ls0 ws0">(recall Section 2.7).</div><div class="t m0 x3f h4d y1fca ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _23"> </span>program <span class="_ _42"> </span>shown <span class="_ _23"> </span>in <span class="_ _42"> </span>Figur<span class="ls99f">e8<span class="_ _43"></span><span class="ls0">.6 <span class="_ _23"> </span>calls <span class="_ _42"> </span>the<span class="_ _35"> </span><span class="ff1a">pr_exit<span class="_ _44"> </span></span>function, <span class="_ _23"> </span>demonstrating <span class="_ _42"> </span>the</span></span></div><div class="t m0 x32 h49 y1fcb ff19 fs26 fc0 sc0 ls0 ws0">various values for the termination status.<span class="_ _59"> </span>If we run the program in Figur<span class="lsd3">e8<span class="_ _4f"></span><span class="ls0">.6, we get</span></span></div><div class="t m0 x3f h4e y1fcc ff1a fs28 fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">./a.out</span></div><div class="t m0 x3f h4e y1fcd ff1a fs28 fc0 sc0 ls0 ws0">normal termination, exit status = 7</div><div class="t m0 x3f h4e y1fce ff1a fs28 fc0 sc0 ls0 ws0">abnormal termination, signal number = 6 (core file generated)</div><div class="t m0 x3f h4e y1fcf ff1a fs28 fc0 sc0 ls0 ws0">abnormal termination, signal number = 8 (core file generated)</div><div class="t m0 x32 h4d y1fd0 ff19 fs26 fc0 sc0 ls0 ws0">For now<span class="_ _1"></span>,<span class="_"> </span>we<span class="_ _47"> </span>print the <span class="_ _2"></span>signal <span class="_ _2"></span>number <span class="_ _2"></span>from<span class="_"> </span><span class="ff1a">WTERMSIG</span><span class="ls9a0">.W<span class="_ _26"></span><span class="ls9a1">ec<span class="_ _d"></span><span class="ls0">an <span class="_ _2"></span>look <span class="_ _2"></span>at <span class="_ _2"></span>the<span class="_"> </span><span class="ff1a">&lt;signal.h&gt;</span></span></span></span></div><div class="t m0 x32 h4d y1fd1 ff19 fs26 fc0 sc0 ls0 ws0">header <span class="_ _2"></span>to <span class="_ _2"></span>verify <span class="_ _2"></span>that<span class="_ _47"> </span><span class="ff1a">SIGABRT<span class="_ _47"> </span></span>has <span class="_ _2"></span>a <span class="_ _2"></span>value <span class="_ _2"></span>of <span class="_ _2"></span>6 <span class="_ _3"></span>and <span class="_ _2"></span>that<span class="_ _47"> </span><span class="ff1a">SIGFPE<span class="_ _66"> </span></span>has <span class="_ _2"></span>a <span class="_ _3"></span>value <span class="_ _2"></span>of <span class="_ _2"></span>8.<span class="_ _61"> </span><span class="ls164">We<span class="_ _23"></span></span>’ll</div><div class="t m0 x32 h49 y1fd2 ff19 fs26 fc0 sc0 ls0 ws0">see a portable way to map a signal number to a descriptive name in Section 10.22.</div><div class="t m0 x3f h54 y1fd3 ff19 fs2c fc0 sc0 ls0 ws0">As <span class="_ _3"></span>we <span class="_ _9"></span>mentioned, <span class="_ _3"></span>if <span class="_ _9"></span>we <span class="_ _3"></span>have <span class="_ _9"></span>mor<span class="ls9a2">et<span class="_ _b"></span><span class="ls0">han <span class="_ _3"></span>one <span class="_ _9"></span>child,<span class="_ _47"> </span><span class="ff1a">wait<span class="_ _45"> </span></span><span class="ls150">re</span>turns <span class="_ _9"></span>on <span class="_ _3"></span>termination <span class="_ _9"></span>of</span></span></div><div class="t m0 x32 h55 y1fd4 ff19 fs2c fc0 sc0 ls0 ws0">any <span class="_ _42"> </span>of <span class="_ _53"> </span>the <span class="_ _42"> </span>children. <span class="_ _44"> </span>But<span class="_ _44"> </span>what <span class="_ _42"> </span>if <span class="_ _42"> </span>we <span class="_ _53"> </span>want <span class="_ _42"> </span>to <span class="_ _53"> </span>wait <span class="_ _42"> </span>for <span class="_ _53"> </span>a <span class="_ _42"> </span>speciﬁc <span class="_ _53"> </span>process <span class="_ _42"> </span>to <span class="_ _42"> </span>terminate</div><div class="t m0 x32 h55 y1fd5 ff19 fs2c fc0 sc0 ls0 ws0">(assuming <span class="_ _23"></span>we <span class="_ _23"></span>know <span class="_ _23"></span>which <span class="_ _23"></span>process <span class="_ _9"></span>ID <span class="_ _23"> </span>we <span class="_ _23"> </span>want <span class="_ _23"> </span>to <span class="_ _23"> </span>wait <span class="_ _23"> </span>for)?<span class="_ _51"> </span>In <span class="_ _23"></span>older <span class="_ _23"></span>versions <span class="_ _23"></span>of <span class="_ _23"></span>the</div><div class="t m0 x32 h54 y1fd6 ff19 fs2c fc0 sc0 ls0 ws0">UNIX <span class="_ _9"></span>System, <span class="_ _3"></span>we <span class="_ _9"></span>would <span class="_ _9"></span>have <span class="_ _9"></span>to <span class="_ _9"></span>call<span class="_ _45"> </span><span class="ff1a">wait<span class="_ _45"> </span></span>and <span class="_ _3"></span>compar<span class="ls9a3">et<span class="_ _b"></span><span class="ls0">he <span class="_ _9"></span>returned <span class="_ _3"></span>process <span class="_ _3"></span>ID <span class="_ _9"></span>with</span></span></div><div class="t m0 x32 h55 y1fd7 ff19 fs2c fc0 sc0 ls0 ws0">the <span class="_ _23"> </span>one <span class="_ _42"> </span>we’r<span class="ls9a4">ei<span class="_ _43"></span><span class="ls0">nter<span class="_ _0"></span>ested <span class="_ _23"> </span>in.<span class="_ _54"> </span>If <span class="_ _23"> </span>the <span class="_ _42"> </span>terminated <span class="_ _23"> </span>process <span class="_ _23"> </span>wasn’t <span class="_ _42"> </span>the <span class="_ _23"> </span>one <span class="_ _42"> </span>we <span class="_ _42"> </span>wanted, <span class="_ _23"> </span>we</span></span></div><div class="t m0 x32 h54 y1fd8 ff19 fs2c fc0 sc0 ls0 ws0">would <span class="_ _42"> </span>have <span class="_ _53"> </span>to <span class="_ _53"> </span>save <span class="_ _42"> </span>the <span class="_ _53"> </span>process <span class="_ _42"> </span>ID <span class="_ _53"> </span>and <span class="_ _53"> </span>termination <span class="_ _42"> </span>status <span class="_ _53"> </span>and <span class="_ _53"> </span>call<span class="_ _44"> </span><span class="ff1a">wait<span class="_ _44"> </span></span>again. <span class="_ _4b"> </span>W<span class="_ _6"></span>e</div><div class="t m0 x32 h55 y1fd9 ff19 fs2c fc0 sc0 ls0 ws0">would <span class="_ _3"></span>need <span class="_ _3"></span>to <span class="_ _9"></span>continue <span class="_ _3"></span>doing <span class="_ _3"></span>this <span class="_ _3"></span>until <span class="_ _9"></span>the <span class="_ _3"></span>desired <span class="_ _3"></span>process <span class="_ _2"></span>terminated.<span class="_ _5a"> </span>The <span class="_ _3"></span>next <span class="_ _3"></span>time</div><div class="t m0 x32 h55 y1fda ff19 fs2c fc0 sc0 ls0 ws0">we <span class="_"> </span>wanted <span class="_ _53"> </span>to <span class="_"> </span>wait <span class="_ _e"> </span>for <span class="_"> </span>a <span class="_ _e"> </span>speciﬁc <span class="_"> </span>pr<span class="_ _0"></span>ocess, <span class="_"> </span>we <span class="_ _53"> </span>would <span class="_"> </span>go <span class="_ _e"> </span>through <span class="_"> </span>the <span class="_ _53"> </span>list <span class="_"> </span>of <span class="_"> </span>alr<span class="_ _1"></span>eady</div><div class="t m0 x32 h54 y1fdb ff19 fs2c fc0 sc0 ls0 ws0">terminated <span class="_ _3"></span>processes <span class="_ _2"></span>to <span class="_ _3"></span>see <span class="_ _3"></span>whether <span class="_ _3"></span>we <span class="_ _3"></span>had <span class="_ _3"></span>already <span class="_ _2"></span>waited <span class="_ _3"></span>for <span class="_ _3"></span>it, <span class="_ _3"></span>and <span class="_ _3"></span>if <span class="_ _3"></span>not, <span class="_ _3"></span>call<span class="_ _45"> </span><span class="ff1a">wait</span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
