<div id="pf2e9" class="pf w4 h1f" data-page-no="2e9"><div class="pc pc2e9 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg2e9.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>18.12<span class="_ _286"> </span><span class="ls719">Te<span class="_ _9"></span></span>rminal <span class="_"> </span>W<span class="_ _0"></span>indow <span class="_"> </span>Size<span class="_ _1b"> </span><span class="ff18">71<span class="_ _0"></span>1</span></div><div class="t m0 x3f h2a y12f ff19 fsf fc0 sc0 ls49 ws0">â€¢O<span class="_ _4d"></span><span class="ls0">ther <span class="_ _53"> </span>than <span class="_ _53"> </span>storing <span class="_ _53"> </span>the <span class="_ _53"> </span>current <span class="_ _42"> </span>value <span class="_ _53"> </span>of <span class="_ _53"> </span>the <span class="_ _53"> </span>structur<span class="ls12ba">ea<span class="_ _c"></span><span class="ls0">nd <span class="_ _53"> </span>generating <span class="_ _53"> </span>a <span class="_ _53"> </span>signal</span></span></span></div><div class="t m0 x15 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">when <span class="_ _45"> </span>the <span class="_ _47"> </span>value <span class="_ _45"> </span>changes, <span class="_ _45"> </span>the <span class="_ _47"> </span>kernel <span class="_ _45"> </span>does <span class="_ _45"> </span>nothing <span class="_ _47"> </span>else <span class="_ _45"> </span>with <span class="_ _45"> </span>this <span class="_ _47"> </span>structure.</div><div class="t m0 x15 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">Interpreting the str<span class="_ _0"></span>ucture<span class="_"> </span>is<span class="_"> </span>entir<span class="_ _0"></span>ely up to the application.</div><div class="t m0 x32 h26 y1fb ff19 fsf fc0 sc0 ls0 ws0">This featur<span class="ls81d">ei<span class="_ _4f"></span><span class="ls74f">sp<span class="_ _d"></span><span class="ls45">ro<span class="ls0">vided <span class="_ _2"></span>to <span class="_ _2"></span>notify <span class="_ _2"></span>applications <span class="_ _2"></span>(such <span class="_ _2"></span>as <span class="_ _2"></span>the<span class="_ _66"> </span><span class="ff1a">vi<span class="_ _47"> </span></span>editor) <span class="_ _2"></span>when the <span class="_ _2"></span>window</span></span></span></span></div><div class="t m0 x32 h2a y1fc ff19 fsf fc0 sc0 ls0 ws0">size <span class="_ _23"> </span>changes.<span class="_ _54"> </span>When <span class="_ _23"> </span>it <span class="_ _42"> </span>receives <span class="_ _23"></span>the <span class="_ _23"> </span>signal, <span class="_ _42"> </span>the <span class="_ _23"> </span>application <span class="_ _42"> </span>can <span class="_ _42"> </span>fetch <span class="_ _23"> </span>the <span class="_ _42"> </span>new <span class="_ _23"> </span>size <span class="_ _42"> </span>and</div><div class="t m0 x32 h2a y1fd ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">draw the screen.</span></div><div class="t m0 x35 h27 y407 ff16 fsf fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h2a y409 ff19 fsf fc0 sc0 ls0 ws0">Figur<span class="ls71b">e1<span class="_ _43"></span><span class="ls0">8.22 <span class="_ _23"></span>shows <span class="_ _23"> </span>a <span class="_ _23"> </span>program <span class="_ _23"> </span>that <span class="_ _23"> </span>prints <span class="_ _42"> </span>the <span class="_ _23"></span>current <span class="_ _23"></span>window <span class="_ _23"></span>size <span class="_ _23"> </span>and <span class="_ _23"> </span>goes <span class="_ _23"> </span>to <span class="_ _42"> </span>sleep.</span></span></div><div class="t m0 x32 h26 y40a ff19 fsf fc0 sc0 ls0 ws0">Each <span class="_ _9"></span>time <span class="_ _9"></span>the <span class="_ _23"></span>window <span class="_ _9"></span>size <span class="_ _23"></span>changes,<span class="_ _45"> </span><span class="ff1a">SIGWINCH<span class="_ _45"> </span></span>is <span class="_ _9"></span>caught <span class="_ _23"></span>and <span class="_ _9"></span>the <span class="_ _9"></span>new <span class="_ _23"></span>size <span class="_ _9"></span>is <span class="_ _9"></span>printed.</div><div class="t m0 x32 h2a y40b ff19 fsf fc0 sc0 ls5f ws0">We <span class="_ _53"> </span>h<span class="_ _9"></span><span class="ls0">ave to terminate this program with a signal.</span></div><div class="t m0 x32 h4e y5238 ff1a fs28 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h4e y5239 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;termios.h&gt;</div><div class="t m0 x32 h4e y523a ff1a fs28 fc0 sc0 ls0 ws0">#ifndef TIOCGWINSZ</div><div class="t m0 x32 h4e y523b ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;sys/ioctl.h&gt;</div><div class="t m0 x32 h4e y523c ff1a fs28 fc0 sc0 ls0 ws0">#endif</div><div class="t m0 x32 h4e y523d ff1a fs28 fc0 sc0 ls0 ws0">static void</div><div class="t m0 x32 h4e y523e ff1a fs28 fc0 sc0 ls0 ws0">pr_winsize(int fd)</div><div class="t m0 x32 h4e y523f ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y5240 ff1a fs28 fc0 sc0 ls0 ws0">struct winsize<span class="_ _d9"> </span>size;</div><div class="t m0 x8a h4e y5241 ff1a fs28 fc0 sc0 ls0 ws0">if (ioctl(fd, TIOCGWINSZ, (char *) &amp;size) &lt; 0)</div><div class="t m0 x9d h4e y5242 ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;TIOCGWINSZ error&quot;);</div><div class="t m0 x8a h4e y5243 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;%d rows, %d columns\n&quot;, size.ws_row, size.ws_col);</div><div class="t m0 x32 h4e y5244 ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h4e y5245 ff1a fs28 fc0 sc0 ls0 ws0">static void</div><div class="t m0 x32 h4e y5246 ff1a fs28 fc0 sc0 ls0 ws0">sig_winch(int signo)</div><div class="t m0 x32 h4e y5247 ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y5248 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;SIGWINCH received\n&quot;);</div><div class="t m0 x8a h4e y5249 ff1a fs28 fc0 sc0 ls0 ws0">pr_winsize(STDIN_FILENO);</div><div class="t m0 x32 h4e y524a ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h4e y524b ff1a fs28 fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h4e y524c ff1a fs28 fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 x32 h4e y524d ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y524e ff1a fs28 fc0 sc0 ls0 ws0">if (isatty(STDIN_FILENO) == 0)</div><div class="t m0 x9d h4e y524f ff1a fs28 fc0 sc0 ls0 ws0">exit(1);</div><div class="t m0 x8a h4e y5250 ff1a fs28 fc0 sc0 ls0 ws0">if (signal(SIGWINCH, sig_winch) == SIG_ERR)</div><div class="t m0 x9d h4e y5251 ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;signal error&quot;);</div><div class="t m0 x8a h4e y5252 ff1a fs28 fc0 sc0 ls0 ws0">pr_winsize(STDIN_FILENO); <span class="_ _d9"> </span>/*<span class="_"> </span>print initial size */</div><div class="t m0 x8a h4e y5253 ff1a fs28 fc0 sc0 ls0 ws0">for ( ; ; )<span class="_ _ce"> </span>/* and sleep forever */</div><div class="t m0 x9d h4e y5254 ff1a fs28 fc0 sc0 ls0 ws0">pause();</div><div class="t m0 x32 h4e y5255 ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x1cf h2e y5256 ff18 fs11 fc0 sc0 ls0 ws0">Figure 18.22<span class="_ _5a"> </span><span class="ff19">Print window size</span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
