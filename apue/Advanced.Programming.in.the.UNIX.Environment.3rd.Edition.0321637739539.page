<div id="pf21b" class="pf w4 h1f" data-page-no="21b"><div class="pc pc21b w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg21b.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>14.4<span class="_ _2a5"> </span>I/O <span class="_"> </span>Multiplexing<span class="_ _1b"> </span><span class="ff18">505</span></div><div class="t m0 x3f h2a y12f ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _2"></span>reason we <span class="_ _2"></span>have <span class="_ _2"></span>to <span class="_ _2"></span>add <span class="_ _2"></span>1 <span class="_ _2"></span>to <span class="_ _2"></span>the <span class="_ _2"></span>maximum <span class="_ _2"></span>descriptor <span class="_ _2"></span>number <span class="_ _2"></span>is <span class="_ _2"></span>that <span class="_ _2"></span>descriptors</div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">start <span class="_ _3"></span>at <span class="_ _3"></span>0, <span class="_ _3"></span>and <span class="_ _3"></span>the <span class="_ _3"></span>ﬁrst <span class="_ _3"></span>argument <span class="_ _2"></span>is <span class="_ _3"></span>really <span class="_ _2"></span>a <span class="_ _3"></span>count <span class="_ _3"></span>of <span class="_ _3"></span>the <span class="_ _3"></span>number <span class="_ _3"></span>of <span class="_ _3"></span>descriptors <span class="_ _3"></span>to <span class="_ _3"></span>check</div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">(starting with descriptor 0).</div><div class="t m0 x7b h52 y3de2 ff1a fs2a fc0 sc0 ls0 ws0">readset:</div><div class="t m0 x1d2 h5e y3de3 ff1a fs10 fc0 sc0 ls0 ws0">1</div><div class="t m0 x17c h4f y3de4 ff1a fs11 fc0 sc0 ls0 ws0">0</div><div class="t m0 x99 h6d y3de5 ff1a fs12 fc0 sc0 ls0 ws0">0</div><div class="t m0 x45 h63 y3de6 ff1a fs13 fc0 sc0 ls0 ws0">1</div><div class="t m0 x159 h6f y3de7 ff1a fs14 fc0 sc0 ls0 ws0">writeset:</div><div class="t m0 x1d2 h66 y3de8 ff1a fs15 fc0 sc0 ls0 ws0">0</div><div class="t m0 x17c h70 y3de9 ff1a fs16 fc0 sc0 ls0 ws0">1</div><div class="t m0 x99 h71 y3dea ff1a fs36 fc0 sc0 ls0 ws0">1</div><div class="t m0 x45 hcc y3deb ff1a fs17 fc0 sc0 ls0 ws0">0</div><div class="t m0 x27 h35 y3dec ff19 fs18 fc0 sc0 ls0 ws0">fd 0<span class="_ _5f"> </span>fd 1<span class="_ _50"> </span>fd 2<span class="_ _5f"> </span>fd 3</div><div class="t m0 xdc h37 y3ded ff19 fs1a fc0 sc0 ls0 ws0">none of these bits ar<span class="lsa6b">el<span class="_ _5"></span><span class="ls0">ooked at</span></span></div><div class="t m0 x9c h157 y3dee ff1b fs1b fc0 sc0 ls0 ws0">maxfdp1<span class="_"> </span><span class="ff19 ls1066">=4</span></div><div class="t m0 x26 hd6 y3def ff18 fs1b fc0 sc0 ls0 ws0">Figure 14.16<span class="_ _5a"> </span><span class="ff19">Example descriptor sets for<span class="_"> </span><span class="ff1a">select</span></span></div><div class="t m0 x3f hf9 y3df0 ff19 fs88 fc0 sc0 ls0 ws0">Ther<span class="lsb06">ea<span class="_ _4f"></span><span class="ls1067">re <span class="_ _3"></span>t<span class="ls0">hree possible return values fr<span class="_ _0"></span>om<span class="_"> </span><span class="ff1a">select</span>.</span></span></span></div><div class="t m0 x3f hfa y3df1 ff19 fs88 fc0 sc0 ls0 ws0">1. <span class="_ _51"> </span>A<span class="_ _61"> </span><span class="ls1067">re<span class="_ _2"></span></span>turn <span class="_ _47"> </span>value <span class="_ _47"> </span>of<span class="_ _61"> </span><span class="ff20">−</span><span class="ls1068">1m<span class="_ _5b"></span><span class="ls0">eans <span class="_ _47"> </span>that <span class="_ _47"> </span>an <span class="_ _66"> </span>error <span class="_ _47"> </span>occurred. <span class="_ _46"> </span>This<span class="_ _16"> </span>can <span class="_ _47"> </span>happen, <span class="_ _47"> </span>for</span></span></div><div class="t m0 x41 hfa y3df2 ff19 fs88 fc0 sc0 ls0 ws0">example, <span class="_ _9"></span>if <span class="_ _23"></span>a <span class="_ _9"></span>signal <span class="_ _9"></span>is <span class="_ _23"></span>caught <span class="_ _9"></span>befor<span class="ls1069">ea<span class="_ _b"></span><span class="ls0">ny <span class="_ _9"></span>of <span class="_ _9"></span>the <span class="_ _9"></span>speciﬁed <span class="_ _23"></span>descriptors <span class="_ _9"></span>ar<span class="ls1069">er<span class="_ _43"></span><span class="ls0">eady<span class="_ _6"></span>.</span></span></span></span></div><div class="t m0 x41 hfa y3df3 ff19 fs88 fc0 sc0 ls0 ws0">In this case, none of the descriptor sets will be modiﬁed.</div><div class="t m0 x3f hfa y3df4 ff19 fs88 fc0 sc0 ls0 ws0">2. <span class="_ _51"> </span>A<span class="_ _44"> </span><span class="ls1067">re</span>turn <span class="_ _42"> </span>value <span class="_ _42"> </span>of <span class="_ _42"> </span>0 <span class="_ _23"> </span>means <span class="_ _42"> </span>that <span class="_ _42"> </span>no <span class="_ _42"> </span>descriptors <span class="_ _42"> </span>ar<span class="ls106a">er<span class="_ _c"></span><span class="ls0">eady<span class="_ _4"></span><span class="ls106b">.T<span class="_ _7"></span><span class="ls0">his <span class="_ _42"> </span>happens <span class="_ _42"> </span>if <span class="_ _42"> </span>the</span></span></span></span></div><div class="t m0 x41 hfa y3df5 ff19 fs88 fc0 sc0 ls0 ws0">time <span class="_ _9"></span>limit <span class="_ _23"></span>expir<span class="_ _0"></span>es <span class="_ _9"></span>befor<span class="ls106c">ea<span class="_ _b"></span><span class="ls0">ny <span class="_ _9"></span>of <span class="_ _9"></span>the <span class="_ _23"></span>descriptors <span class="_ _9"></span>ar<span class="ls106d">er<span class="_ _43"></span><span class="ls0">eady<span class="_ _6"></span><span class="ls106e">.W<span class="_ _26"></span><span class="ls0">hen <span class="_ _23"></span>this <span class="_ _9"></span>happens,</span></span></span></span></span></span></div><div class="t m0 x41 hfa y3df6 ff19 fs88 fc0 sc0 ls0 ws0">all the descriptor sets will be zeroed out.</div><div class="t m0 x3f hfa y3df7 ff19 fs88 fc0 sc0 ls0 ws0">3. <span class="_ _51"> </span>A<span class="_ _47"> </span>positive <span class="_ _3"></span>return <span class="_ _3"></span>value <span class="_ _3"></span>speciﬁes <span class="_ _3"></span>the <span class="_ _9"></span>number <span class="_ _3"></span>of <span class="_ _3"></span>descriptors <span class="_ _3"></span>that <span class="_ _3"></span>ar<span class="ls106f">er<span class="_ _b"></span><span class="ls0">eady<span class="_ _6"></span><span class="ls1070">.T<span class="_ _62"></span><span class="ls0">his</span></span></span></span></div><div class="t m0 x41 hfa y3df8 ff19 fs88 fc0 sc0 ls0 ws0">value <span class="_ _66"> </span>is <span class="_ _47"> </span>the <span class="_ _47"> </span>sum <span class="_ _66"> </span>of <span class="_ _47"> </span>the <span class="_ _66"> </span>descriptors <span class="_ _47"> </span>ready <span class="_"> </span>in <span class="_ _47"> </span>all <span class="_ _66"> </span>three <span class="_ _47"> </span>sets, <span class="_ _66"> </span>so <span class="_ _47"> </span>if <span class="_ _66"> </span>the <span class="_ _47"> </span>same</div><div class="t m0 x41 h158 y3df9 ff19 fs88 fc0 sc0 ls0 ws0">descriptor <span class="_ _3"></span>is <span class="_ _3"></span>ready <span class="_ _2"></span>to <span class="_ _9"></span>be <span class="_ _3"></span>read<span class="_ _47"> </span><span class="ff1b">and<span class="_ _47"> </span></span>written, <span class="_ _3"></span>it <span class="_ _3"></span>will <span class="_ _3"></span>be <span class="_ _3"></span>counted <span class="_ _9"></span>twice <span class="_ _3"></span>in <span class="_ _3"></span>the <span class="_ _3"></span>return</div><div class="t m0 x41 hfa y3dfa ff19 fs88 fc0 sc0 ls0 ws0">value. <span class="_ _60"> </span>The<span class="_ _60"> </span>only <span class="_ _46"> </span>bits <span class="_ _46"> </span>left <span class="_ _46"> </span>on <span class="_ _46"> </span>in <span class="_ _46"> </span>the <span class="_ _46"> </span>three <span class="_ _59"> </span>descriptor <span class="_ _46"> </span>sets <span class="_ _46"> </span>ar<span class="ls1071">et<span class="_ _49"></span><span class="ls0">he <span class="_ _46"> </span>bits</span></span></div><div class="t m0 x41 hfa y3dfb ff19 fs88 fc0 sc0 ls0 ws0">corresponding to the descriptors that ar<span class="_ _0"></span><span class="lsb06">er<span class="_ _4f"></span><span class="ls0">eady<span class="_ _6"></span>.</span></span></div><div class="t m0 x3f hfa y3dfc ff19 fs88 fc0 sc0 lsb05 ws0">We <span class="_ _53"> </span>n<span class="_ _9"></span><span class="ls0">ow need to be mor<span class="lsb06">es<span class="_ _d"></span><span class="ls0">peciﬁc about what ‘<span class="_ _0"></span>‘ready’<span class="_ _1"></span><span class="lsb06">’m<span class="_ _d"></span><span class="ls0">eans.</span></span></span></span></span></div><div class="t m0 x3f hf9 y3dfd ff19 fs88 fc0 sc0 ls1072 ws0">•A<span class="_ _55"></span><span class="ls0">descriptor <span class="_ _53"> </span>in <span class="_ _42"> </span>the <span class="_ _53"> </span>read <span class="_ _42"> </span>set <span class="_ _53"> </span>(<span class="ff1b ls1067">re<span class="_ _2"></span><span class="ls0">adfds</span></span>)<span class="_ _44"> </span>is<span class="_ _44"> </span>considered <span class="_ _53"> </span>ready <span class="_ _42"> </span>if <span class="_ _42"> </span>a<span class="_ _4b"> </span><span class="ff1a">read<span class="_ _44"> </span></span>from <span class="_ _42"> </span>that</span></div><div class="t m0 x15 hfa y3dfe ff19 fs88 fc0 sc0 ls0 ws0">descriptor won’t block.</div><div class="t m0 x3f hf9 y3dff ff19 fs88 fc0 sc0 ls1072 ws0">•A<span class="_ _55"></span><span class="ls0">descriptor <span class="_ _42"> </span>in <span class="_ _53"> </span>the <span class="_ _42"> </span>write <span class="_ _53"> </span>set <span class="_ _42"> </span>(<span class="ff1b">writefds</span>)<span class="_ _44"> </span>is<span class="_ _44"> </span>considered <span class="_ _42"> </span>ready <span class="_ _42"> </span>if <span class="_ _53"> </span>a<span class="_ _44"> </span><span class="ff1a">write<span class="_ _44"> </span></span>to <span class="_ _42"> </span>that</span></div><div class="t m0 x15 hfa y3e00 ff19 fs88 fc0 sc0 ls0 ws0">descriptor won’t block.</div><div class="t m0 x3f h158 y3e01 ff19 fs88 fc0 sc0 ls1072 ws0">•A<span class="_ _5b"></span><span class="ls0">descriptor <span class="_ _9"></span>in <span class="_ _23"> </span>the <span class="_ _23"></span>exception <span class="_ _9"></span>set <span class="_ _23"></span>(<span class="ff1b">exceptfds</span>)<span class="_ _45"> </span>is<span class="_ _35"> </span>consider<span class="_ _0"></span>ed <span class="_ _9"></span>ready <span class="_ _23"></span>if <span class="_ _9"></span>an <span class="_ _23"></span>exception</span></div><div class="t m0 x15 hfa y3e02 ff19 fs88 fc0 sc0 ls0 ws0">condition <span class="_ _45"> </span>is <span class="_ _45"> </span>pending <span class="_ _47"> </span>on <span class="_ _45"> </span>that <span class="_ _45"> </span>descriptor<span class="_ _1"></span><span class="ls1073">.C<span class="_ _95"></span><span class="ls0">urrently<span class="_ _4"></span>,<span class="_ _5a"> </span>an<span class="_ _5a"> </span>exception <span class="_ _45"> </span>condition</span></span></div><div class="t m0 x15 hfa y3e03 ff19 fs88 fc0 sc0 ls0 ws0">corresponds to <span class="_ _2"></span>either <span class="_ _2"></span>the <span class="_ _2"></span>arrival <span class="_ _2"></span>of <span class="_ _2"></span>out-of-band <span class="_ _3"></span>data <span class="_ _2"></span>on <span class="_ _2"></span>a <span class="_ _2"></span>network <span class="_ _2"></span>connection <span class="_ _2"></span>or</div><div class="t m0 x15 hfa y3e04 ff19 fs88 fc0 sc0 ls0 ws0">certain <span class="_ _e"> </span>conditions <span class="_"> </span>occurring <span class="_ _53"> </span>on <span class="_"> </span>a <span class="_ _53"> </span>pseudo <span class="_"> </span>terminal <span class="_ _e"> </span>that <span class="_ _e"> </span>has <span class="_"> </span>been <span class="_ _53"> </span>placed <span class="_"> </span>into</div><div class="t m0 x15 hfa y3e05 ff19 fs88 fc0 sc0 ls0 ws0">packet mode.<span class="_ _59"> </span>(Section 15.10 of Stevens</div><div class="t m0 xaf hfa y3e06 ff19 fs88 fc0 sc0 ls0 ws0">[</div><div class="t m0 x15c hfa y3e05 ff19 fs88 fc0 sc0 ls0 ws0">1990</div><div class="t m0 x202 hfa y3e06 ff19 fs88 fc0 sc0 ls0 ws0">]</div><div class="t m0 x203 hfa y3e05 ff19 fs88 fc0 sc0 ls0 ws0">describes this latter condition.)</div><div class="t m0 x3f hfa y3e07 ff19 fs88 fc0 sc0 ls1072 ws0">•F<span class="_ _4d"></span><span class="ls0">ile <span class="_ _42"> </span>descriptors <span class="_ _23"> </span>for <span class="_ _42"> </span>regular <span class="_ _23"> </span>ﬁles <span class="_ _42"> </span>always <span class="_ _42"> </span>return <span class="_ _23"> </span>ready <span class="_ _23"> </span>for <span class="_ _42"> </span>reading, <span class="_ _23"> </span>writing, <span class="_ _42"> </span>and</span></div><div class="t m0 x15 hfa y3e08 ff19 fs88 fc0 sc0 ls0 ws0">exception conditions.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
