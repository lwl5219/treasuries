<div id="pf142" class="pf w4 h1f" data-page-no="142"><div class="pc pc142 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg142.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">288<span class="_ _1b"> </span><span class="ff19">Process <span class="_"> </span>Relationships<span class="_ _18d"> </span>Chapter <span class="_"> </span>9</span></div><div class="t m0 x32 h26 y12f ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">sult <span class="_ _47"> </span>to <span class="_ _66"> </span>the<span class="_ _61"> </span><span class="ff1a">pw_passwd<span class="_ _16"> </span></span>ﬁeld <span class="_ _66"> </span>from <span class="_ _66"> </span>our <span class="_ _47"> </span>shadow <span class="_ _66"> </span>passwor<span class="lsadc">dﬁ<span class="_ _5b"></span><span class="ls0">le <span class="_ _66"> </span>entry<span class="_ _6"></span><span class="lsadd">.I<span class="_ _49"></span><span class="lsadc">ft<span class="_ _1d"></span><span class="ls0">he <span class="_ _47"> </span>login</span></span></span></span></span></span></div><div class="t m0 x32 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">attempt <span class="_ _3"></span>fails <span class="_ _9"></span>because <span class="_ _3"></span>of <span class="_ _9"></span>an <span class="_ _3"></span>invalid <span class="_ _3"></span>passwor<span class="ls3ea">d(<span class="_ _8"></span><span class="ls0">after <span class="_ _3"></span>a <span class="_ _9"></span>few <span class="_ _3"></span>tries),<span class="_ _45"> </span><span class="ff1a">login<span class="_ _47"> </span></span>calls<span class="_ _47"> </span><span class="ff1a">exit<span class="_ _45"> </span></span>with</span></span></div><div class="t m0 x32 h26 y131 ff19 fsf fc0 sc0 ls0 ws0">an <span class="_ _2"></span>argument <span class="_ _2"></span>of <span class="_ _3"></span>1.<span class="_ _16"> </span>This <span class="_ _3"></span>termination <span class="_ _2"></span>will <span class="_ _3"></span>be <span class="_ _3"></span>noticed <span class="_ _3"></span>by <span class="_ _3"></span>the <span class="_ _2"></span>parent <span class="_ _2"></span>(<span class="ff1a">init</span>), <span class="_ _3"></span>and <span class="_ _3"></span>it <span class="_ _3"></span>will <span class="_ _3"></span>do</div><div class="t m0 x32 h26 y132 ff19 fsf fc0 sc0 ls0 ws0">another<span class="_ _66"> </span><span class="ff1a">fork<span class="_ _47"> </span></span>followed <span class="_ _2"></span>by <span class="_ _2"></span>an<span class="_ _66"> </span><span class="ff1a">exec<span class="_ _47"> </span></span>of<span class="_ _66"> </span><span class="ff1a">getty</span><span class="lsade">,s<span class="_ _4f"></span><span class="ls0">tarting <span class="_ _2"></span>the <span class="_ _3"></span>procedur<span class="_ _0"></span><span class="lsade">eo<span class="_ _4f"></span><span class="ls0">ver <span class="_ _2"></span>again <span class="_ _2"></span>for <span class="_ _2"></span>this</span></span></span></span></div><div class="t m0 x32 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">terminal.</div><div class="t m0 x3f h2a y134 ff19 fsf fc0 sc0 ls0 ws0">This <span class="_ _42"> </span>is <span class="_ _53"> </span>the <span class="_ _42"> </span>traditional <span class="_ _53"> </span>authentication <span class="_ _53"> </span>procedur<span class="_ _0"></span><span class="ls4fa">eu<span class="_ _c"></span><span class="ls0">sed <span class="_ _53"> </span>on <span class="_ _42"> </span>UNIX <span class="_ _53"> </span>systems.<span class="_ _54"> </span>Modern</span></span></div><div class="t m0 x32 h2a y135 ff19 fsf fc0 sc0 ls0 ws0">UNIX <span class="_ _9"></span>systems, <span class="_ _23"> </span>however<span class="_ _1"></span><span class="lsadf">,h<span class="_ _b"></span><span class="ls0">ave <span class="_ _9"></span>evolved <span class="_ _23"></span>to <span class="_ _9"></span>support <span class="_ _23"></span>multiple <span class="_ _9"></span>authentication <span class="_ _23"></span>procedur<span class="_ _0"></span>es.</span></span></div><div class="t m0 x32 h2a y136 ff19 fsf fc0 sc0 ls0 ws0">For <span class="_ _2"></span>example, <span class="_ _2"></span>FreeBSD, <span class="_ _2"></span>Linux, <span class="_ _2"></span>Mac <span class="_ _2"></span>OS <span class="_ _2"></span>X, <span class="_ _2"></span>and <span class="_ _3"></span>Solaris <span class="_ _2"></span>all <span class="_ _2"></span>support <span class="_ _2"></span>a <span class="_ _2"></span>mor<span class="ls474">eﬂ<span class="_ _4f"></span><span class="ls0">exible <span class="_ _2"></span>scheme</span></span></div><div class="t m0 x32 h2a y137 ff19 fsf fc0 sc0 ls0 ws0">known <span class="_ _9"></span>as <span class="_ _9"></span>P<span class="_ _6"></span>AM <span class="_ _23"></span>(Pluggable <span class="_ _9"></span>Authentication <span class="_ _9"></span>Modules).<span class="_ _5a"> </span><span class="ls5f">PA<span class="_ _23"></span><span class="lsae0">Ma<span class="_ _b"></span><span class="ls0">llows <span class="_ _9"></span>an <span class="_ _9"></span>administrator <span class="_ _9"></span>to</span></span></span></div><div class="t m0 x32 h2a y138 ff19 fsf fc0 sc0 ls0 ws0">conﬁgur<span class="ls7e0">et<span class="_ _43"></span><span class="ls0">he <span class="_ _23"></span>authentication <span class="_ _23"> </span>methods <span class="_ _23"> </span>to <span class="_ _23"> </span>be <span class="_ _42"> </span>used <span class="_ _23"></span>to <span class="_ _23"></span>access <span class="_ _23"> </span>services <span class="_ _23"> </span>that <span class="_ _23"> </span>ar<span class="ls7e0">ew<span class="_ _43"></span><span class="ls0">ritten <span class="_ _42"> </span>to</span></span></span></span></div><div class="t m0 x32 h2a y139 ff19 fsf fc0 sc0 ls0 ws0">use the P<span class="_ _6"></span>AM library<span class="_ _4"></span>.</div><div class="t m0 x3f h2a y13a ff19 fsf fc0 sc0 ls0 ws0">If <span class="_ _53"> </span>our <span class="_"> </span>application <span class="_ _53"> </span>needs <span class="_ _e"> </span>to <span class="_ _e"> </span>verify <span class="_ _e"> </span>that <span class="_ _e"> </span>a <span class="_ _e"> </span>user <span class="_ _e"> </span>has <span class="_ _e"> </span>the <span class="_ _53"> </span>appropriate <span class="_ _e"> </span>permission <span class="_ _e"> </span>to</div><div class="t m0 x32 h2a y254 ff19 fsf fc0 sc0 ls0 ws0">perform <span class="_ _44"> </span>a <span class="_ _4b"> </span>task, <span class="_ _44"> </span>we <span class="_ _4b"> </span>can <span class="_ _44"> </span>either <span class="_ _4b"> </span>har<span class="lsae1">dc<span class="_ _64"></span><span class="ls0">ode <span class="_ _4b"> </span>the <span class="_ _44"> </span>authentication <span class="_ _4b"> </span>mechanism <span class="_ _44"> </span>in <span class="_ _4b"> </span>the</span></span></div><div class="t m0 x32 h2a y255 ff19 fsf fc0 sc0 ls0 ws0">application <span class="_ _35"> </span>or <span class="_ _45"> </span>use <span class="_ _35"> </span>the <span class="_ _45"> </span>P<span class="_ _6"></span>AM <span class="_ _35"> </span>library <span class="_ _35"> </span>to <span class="_ _45"> </span>give <span class="_ _35"> </span>us <span class="_ _35"> </span>the <span class="_ _45"> </span>equivalent <span class="_ _35"> </span>functionality<span class="_ _4"></span><span class="lsae2">.T<span class="_ _95"></span><span class="ls0">he</span></span></div><div class="t m0 x32 h2a y13b ff19 fsf fc0 sc0 ls0 ws0">advantage <span class="_ _35"> </span>to <span class="_ _44"> </span>using <span class="_ _44"> </span>P<span class="_ _6"></span>AM <span class="_ _35"> </span>is <span class="_ _44"> </span>that <span class="_ _35"> </span>administrators <span class="_ _44"> </span>can <span class="_ _44"> </span>conﬁgur<span class="lsae3">ed<span class="_ _52"></span><span class="ls0">iffer<span class="_ _1"></span>ent <span class="_ _44"> </span>ways <span class="_ _44"> </span>to</span></span></div><div class="t m0 x32 h2a y13c ff19 fsf fc0 sc0 ls0 ws0">authenticate users for differ<span class="_ _0"></span>ent tasks, based on the local site policies.</div><div class="t m0 x3f h26 y256 ff19 fsf fc0 sc0 ls0 ws0">If we log in correctly<span class="_ _4"></span>,<span class="_"> </span><span class="ff1a">login<span class="_ _80"> </span></span>will</div><div class="t m0 x3f h26 y1d9 ff19 fsf fc0 sc0 ls49 ws0">•C<span class="_ _4d"></span><span class="ls0">hange to our home directory (<span class="ff1a">chdir</span>)</span></div><div class="t m0 x3f h26 y255c ff19 fsf fc0 sc0 ls49 ws0">•C<span class="_ _4d"></span><span class="ls0">hange the ownership of our terminal device (<span class="ff1a">chown</span>)<span class="_"> </span>so<span class="_"> </span>we<span class="_"> </span>own it</span></div><div class="t m0 x3f h2a y255d ff19 fsf fc0 sc0 ls49 ws0">•C<span class="_ _4d"></span><span class="ls0">hange the <span class="_ _2"></span>access <span class="_ _2"></span>permissions for <span class="_ _2"></span>our <span class="_ _2"></span>terminal <span class="_ _2"></span>device so <span class="_ _2"></span>we <span class="_ _2"></span>have permission <span class="_ _2"></span>to</span></div><div class="t m0 x15 h2a y255e ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">ad from and write to it</span></div><div class="t m0 x3f h26 y255f ff19 fsf fc0 sc0 ls49 ws0">•S<span class="_ _4d"></span><span class="ls0">et our group IDs by calling<span class="_"> </span><span class="ff1a">setgid<span class="_ _80"> </span></span>and<span class="_"> </span><span class="ff1a">initgroups</span></span></div><div class="t m0 x3f h26 y2560 ff19 fsf fc0 sc0 ls49 ws0">•I<span class="_ _4d"></span><span class="ls0">nitialize <span class="_ _42"> </span>the <span class="_ _42"> </span>environment <span class="_ _23"> </span>with <span class="_ _42"> </span>all <span class="_ _42"> </span>the <span class="_ _42"> </span>information <span class="_ _42"> </span>that<span class="_ _44"> </span><span class="ff1a">login<span class="_ _44"> </span></span>has: <span class="_ _42"> </span>our <span class="_ _42"> </span>home</span></div><div class="t m0 x15 h26 y2561 ff19 fsf fc0 sc0 ls0 ws0">directory <span class="_ _2"></span>(<span class="ff1a">HOME</span>), <span class="_ _9"></span>shell <span class="_ _3"></span>(<span class="ff1a">SHELL</span>), <span class="_ _9"></span>user <span class="_ _3"></span>name <span class="_ _9"></span>(<span class="ff1a">USER<span class="_ _45"> </span></span>and<span class="_ _47"> </span><span class="ff1a">LOGNAME</span>), <span class="_ _3"></span>and <span class="_ _9"></span>a <span class="_ _3"></span>default</div><div class="t m0 x15 h26 y2562 ff19 fsf fc0 sc0 ls0 ws0">path (<span class="ff1a">PATH</span>)</div><div class="t m0 x3f h26 y2563 ff19 fsf fc0 sc0 ls49 ws0">•C<span class="_ _4d"></span><span class="ls0">hange to our user ID (<span class="ff1a">setuid</span><span class="ls44">)a<span class="_ _d"></span><span class="ls0">nd invoke our login shell, as in</span></span></span></div><div class="t m0 x1aa h57 y1f91 ff1a fs2d fc0 sc0 ls0 ws0">execl(&quot;/bin/sh&quot;, &quot;-sh&quot;, (char *)0);</div><div class="t m0 x76 h52 y2564 ff19 fs2a fc0 sc0 ls0 ws0">The minus sign as the ﬁrst character of<span class="_"> </span><span class="ff1a">argv[0]<span class="_ _e"> </span></span>is a ﬂag to all the shells that indicates they <span class="_ _2"></span>are</div><div class="t m0 x76 h51 y2565 ff19 fs2a fc0 sc0 ls0 ws0">being <span class="_ _2"></span>invoked <span class="_ _3"></span>as <span class="_ _3"></span>a <span class="_ _3"></span>login <span class="_ _3"></span>shell.<span class="_ _4b"> </span>The <span class="_ _3"></span>shells <span class="_ _3"></span>can <span class="_ _3"></span>look <span class="_ _3"></span>at <span class="_ _3"></span>this <span class="_ _3"></span>character <span class="_ _3"></span>and <span class="_ _3"></span>modify <span class="_ _2"></span>their <span class="_ _3"></span>start-up</div><div class="t m0 x76 h51 y2566 ff19 fs2a fc0 sc0 ls0 ws0">accordingly<span class="_ _4"></span>.</div><div class="t m0 x3f h26 y2567 ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _59"> </span><span class="ff1a">login<span class="_ _59"> </span></span>program <span class="_ _e"> </span>really <span class="_"> </span>does <span class="_ _e"> </span>mor<span class="lsae4">et<span class="_ _4a"></span><span class="ls0">han <span class="_"> </span>we’ve <span class="_ _e"> </span>described <span class="_"> </span>here. <span class="_ _4b"> </span>It<span class="_ _59"> </span>optionally</span></span></div><div class="t m0 x32 h2a y2568 ff19 fsf fc0 sc0 ls0 ws0">prints <span class="_ _23"> </span>the <span class="_ _42"> </span>message-of-the-day <span class="_ _23"> </span>ﬁle, <span class="_ _42"> </span>checks <span class="_ _23"> </span>for <span class="_ _42"> </span>new <span class="_ _42"> </span>mail, <span class="_ _23"> </span>and <span class="_ _42"> </span>performs <span class="_ _23"> </span>other <span class="_ _42"> </span>tasks.<span class="_ _51"> </span>In</div><div class="t m0 x32 h2a y2569 ff19 fsf fc0 sc0 ls0 ws0">this chapter<span class="_ _6"></span><span class="ls44">,w<span class="_ _5"></span><span class="ls0">e’r<span class="ls44">ei<span class="_ _4f"></span><span class="ls0">nterested only in the features that we’ve described.</span></span></span></span></div><div class="t m0 x3f h26 y256a ff19 fsf fc0 sc0 ls0 ws0">Recall <span class="_ _42"> </span>from <span class="_ _23"></span>our <span class="_ _42"> </span>discussion <span class="_ _42"> </span>of <span class="_ _42"> </span>the<span class="_ _35"> </span><span class="ff1a">setuid<span class="_ _44"> </span></span>function <span class="_ _23"> </span>in <span class="_ _42"> </span>Section <span class="_ _42"> </span>8.1<span class="_ _1"></span><span class="lsae5">1t<span class="_ _43"></span><span class="ls0">hat <span class="_ _42"> </span>since <span class="_ _42"> </span>it <span class="_ _42"> </span>is</span></span></div><div class="t m0 x32 h26 y256b ff19 fsf fc0 sc0 ls0 ws0">called <span class="_ _53"> </span>by <span class="_"> </span>a <span class="_ _53"> </span>superuser <span class="_ _53"> </span>process,<span class="_ _4b"> </span><span class="ff1a">setuid<span class="_ _4b"> </span></span>changes <span class="_ _e"> </span>all <span class="_ _e"> </span>three <span class="_ _53"> </span>user <span class="_ _e"> </span>IDs: <span class="_ _e"> </span>the <span class="_ _e"> </span>real <span class="_ _53"> </span>user <span class="_ _e"> </span>ID,</div><div class="t m0 x32 h26 y256c ff19 fsf fc0 sc0 ls0 ws0">effective <span class="_ _9"></span>user <span class="_ _23"></span>ID, <span class="_ _9"></span>and <span class="_ _23"> </span>saved <span class="_ _23"></span>set-user-ID. <span class="_ _45"> </span>The<span class="_ _35"> </span>call <span class="_ _9"></span>to<span class="_ _35"> </span><span class="ff1a">setgid<span class="_ _45"> </span></span>that <span class="_ _23"> </span>was <span class="_ _23"></span>done <span class="_ _9"></span>earlier <span class="_ _23"> </span>by</div><div class="t m0 x32 h26 y256d ff1a fsf fc0 sc0 ls0 ws0">login<span class="_ _80"> </span><span class="ff19">has the same effect on all three gr<span class="_ _1"></span>oup IDs.</span></div><div class="t m0 x3f h26 y256e ff19 fsf fc0 sc0 ls0 ws0">At <span class="_ _3"></span>this <span class="_ _9"></span>point, <span class="_ _9"></span>our <span class="_ _9"></span>login <span class="_ _3"></span>shell <span class="_ _9"></span>is <span class="_ _9"></span>running. <span class="_ _45"> </span>Its<span class="_ _47"> </span>parent <span class="_ _3"></span>process <span class="_ _3"></span>ID <span class="_ _9"></span>is <span class="_ _9"></span>the <span class="_ _9"></span>original<span class="_ _45"> </span><span class="ff1a">init</span></div><div class="t m0 x32 h26 y256f ff19 fsf fc0 sc0 ls0 ws0">process <span class="_ _2"></span>(process <span class="_ _3"></span>ID <span class="_ _9"></span>1), <span class="_ _3"></span>so <span class="_ _9"></span>when <span class="_ _3"></span>our <span class="_ _9"></span>login <span class="_ _3"></span>shell <span class="_ _9"></span>terminates,<span class="_ _45"> </span><span class="ff1a">init<span class="_ _47"> </span></span>is <span class="_ _3"></span>notiﬁed <span class="_ _9"></span>(it <span class="_ _3"></span>is <span class="_ _9"></span>sent <span class="_ _3"></span>a</div><div class="t m0 x32 h26 y2570 ff1a fsf fc0 sc0 ls0 ws0">SIGCHLD<span class="_ _44"> </span><span class="ff19">signal) <span class="_ _42"> </span>and <span class="_ _42"> </span>it <span class="_ _42"> </span>starts <span class="_ _42"> </span>the <span class="_ _42"> </span>whole <span class="_ _42"> </span>procedur<span class="lsae6">eo<span class="_ _c"></span><span class="ls0">ver <span class="_ _42"> </span>again <span class="_ _42"> </span>for <span class="_ _42"> </span>this <span class="_ _53"> </span>terminal.<span class="_ _54"> </span>File</span></span></span></div><div class="t m0 x32 h2a y2571 ff19 fsf fc0 sc0 ls0 ws0">descriptors 0, 1, and 2 for <span class="_ _2"></span>our login shell ar<span class="lsae7">es<span class="_ _d"></span><span class="ls0">et to the terminal <span class="_ _2"></span>device.<span class="_ _46"> </span>Figur<span class="lsae7">e9<span class="_ _4f"></span><span class="ls0">.3 shows</span></span></span></span></div><div class="t m0 x32 h2a y2572 ff19 fsf fc0 sc0 ls0 ws0">this arrangement.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
