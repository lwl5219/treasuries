<div id="pfc6" class="pf w4 h1f" data-page-no="c6"><div class="pc pcc6 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bgc6.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">164<span class="_ _1b"> </span><span class="ff19">Standar<span class="ls30a">dI<span class="_ _55"></span><span class="ls0">/O <span class="_"> </span>Library<span class="_ _1c9"> </span>Chapter <span class="_"> </span>5</span></span></span></div><div class="t m0 x35 h53 y12f ff16 fs2b fc0 sc0 ls0 ws0">5.12 <span class="_ _93"> </span>Implementation<span class="_ _54"> </span>Details</div><div class="t m0 x32 h2a y4de ff19 fsf fc0 sc0 ls0 ws0">As <span class="_ _2"></span>we’ve <span class="_ _2"></span>mentioned, <span class="_ _3"></span>under <span class="_ _2"></span>the <span class="_ _3"></span>UNIX <span class="_ _2"></span>System, <span class="_ _2"></span>the <span class="_ _3"></span>standar<span class="ls70b">dI<span class="_ _8"></span><span class="ls0">/O <span class="_ _3"></span>library <span class="_ _2"></span>ends <span class="_ _3"></span>up <span class="_ _2"></span>calling</span></span></div><div class="t m0 x32 h2a y6d0 ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _53"> </span>I/O <span class="_ _53"> </span>routines <span class="_ _42"> </span>that <span class="_ _53"> </span>we <span class="_ _e"> </span>described <span class="_ _53"> </span>in <span class="_ _53"> </span>Chapter <span class="_ _53"> </span>3.<span class="_ _65"> </span>Each <span class="_ _53"> </span>standar<span class="ls70c">dI<span class="_ _c"></span><span class="ls0">/O <span class="_ _53"> </span>stream <span class="_ _42"> </span>has <span class="_ _53"> </span>an</span></span></div><div class="t m0 x32 h2a y6d1 ff19 fsf fc0 sc0 ls0 ws0">associated <span class="_"> </span>ﬁle <span class="_ _e"> </span>descriptor<span class="_ _1"></span><span class="ls70d">,a<span class="_ _4a"></span><span class="ls0">nd <span class="_"> </span>we <span class="_"> </span>can <span class="_"> </span>obtain <span class="_ _e"> </span>the <span class="_"> </span>descriptor <span class="_"> </span>for <span class="_ _e"> </span>a <span class="_"> </span>stream <span class="_ _e"> </span>by <span class="_"> </span>calling</span></span></div><div class="t m0 x32 h26 y6d2 ff1a fsf fc0 sc0 ls0 ws0">fileno<span class="ff19">.</span></div><div class="t m0 x76 h52 y16bc ff19 fs2a fc0 sc0 ls0 ws0">Note <span class="_ _23"> </span>that<span class="_ _45"> </span><span class="ff1a">fileno<span class="_ _47"> </span></span>is <span class="_ _42"> </span>not <span class="_ _23"> </span>part <span class="_ _23"> </span>of <span class="_ _23"> </span>the <span class="_ _23"> </span>ISO <span class="_ _42"> </span>C <span class="_ _23"> </span>standard, <span class="_ _23"> </span>but <span class="_ _23"> </span>rather <span class="_ _23"> </span>an <span class="_ _23"> </span>extension <span class="_ _23"> </span>supported <span class="_ _23"> </span>by</div><div class="t m0 x76 h51 y16bd ff19 fs2a fc0 sc0 ls0 ws0">POSIX.1.</div><div class="t m0 x3f h57 y16be ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;stdio.h&gt;</div><div class="t m0 x3f h57 y16bf ff1a fs2d fc0 sc0 ls0 ws0">int fileno(FILE *<span class="ff1b">fp</span>);</div><div class="t m0 x121 h5f y16c0 ff19 fs2d fc0 sc0 ls0 ws0">Returns: the ﬁle descriptor associated with the stream</div><div class="t m0 x32 h4d y16c1 ff19 fs26 fc0 sc0 ls164 ws0">We <span class="_ _53"> </span>n<span class="_ _9"></span><span class="ls0">eed this function if we want to call the<span class="_"> </span><span class="ff1a">dup<span class="_ _66"> </span></span>or<span class="_"> </span><span class="ff1a">fcntl<span class="_ _80"> </span></span>functions, for example.</span></div><div class="t m0 x3f h49 y16c2 ff19 fs26 fc0 sc0 ls164 ws0">To <span class="_ _45"> </span>l<span class="_ _9"></span><span class="ls0">ook <span class="_ _53"> </span>at <span class="_ _53"> </span>the <span class="_ _42"> </span>implementation <span class="_ _53"> </span>of <span class="_ _53"> </span>the <span class="_ _42"> </span>standar<span class="ls70e">dI<span class="_ _c"></span><span class="ls0">/O <span class="_ _53"> </span>library <span class="_ _42"> </span>on <span class="_ _53"> </span>your <span class="_ _53"> </span>system, <span class="_ _42"> </span>start</span></span></span></div><div class="t m0 x32 h4d y16c3 ff19 fs26 fc0 sc0 ls0 ws0">with <span class="_"> </span>the <span class="_"> </span>header<span class="_ _46"> </span><span class="ff1a">&lt;stdio.h&gt;</span><span class="ls70f">.T<span class="_ _5d"></span><span class="ls0">his <span class="_"> </span>will <span class="_"> </span>show <span class="_"> </span>how <span class="_ _66"> </span>the<span class="_ _46"> </span><span class="ff1a">FILE<span class="_ _46"> </span></span>object <span class="_"> </span>is <span class="_ _66"> </span>deﬁned, <span class="_"> </span>the</span></span></div><div class="t m0 x32 h4d y16c4 ff19 fs26 fc0 sc0 ls0 ws0">deﬁnitions <span class="_ _9"></span>of <span class="_ _23"> </span>the <span class="_ _23"></span>per-str<span class="_ _0"></span>eam <span class="_ _9"></span>ﬂags, <span class="_ _23"></span>and <span class="_ _23"></span>any <span class="_ _9"></span>standar<span class="ls710">dI<span class="_ _b"></span><span class="ls0">/O <span class="_ _9"></span>routines, <span class="_ _9"></span>such <span class="_ _23"></span>as<span class="_ _45"> </span><span class="ff1a">getc</span><span class="ls710">,t<span class="_ _b"></span><span class="ls0">hat</span></span></span></span></div><div class="t m0 x32 h49 y16c5 ff19 fs26 fc0 sc0 ls0 ws0">ar<span class="ls711">ed<span class="_ _62"></span><span class="ls0">eﬁned <span class="_ _47"> </span>as <span class="_ _47"> </span>macros. <span class="_ _61"> </span>Section<span class="_ _61"> </span>8.5 <span class="_ _47"> </span>of <span class="_ _47"> </span>Kernighan <span class="_ _66"> </span>and <span class="_ _47"> </span>Ritchie</span></span></div><div class="t m0 x68 h49 y16c6 ff19 fs26 fc0 sc0 ls0 ws0">[</div><div class="t m0 x13b h49 y16c5 ff19 fs26 fc0 sc0 ls0 ws0">1988</div><div class="t m0 x112 h49 y16c6 ff19 fs26 fc0 sc0 ls0 ws0">]</div><div class="t m0 x1cc h49 y16c5 ff19 fs26 fc0 sc0 ls0 ws0">has <span class="_ _47"> </span>a <span class="_ _66"> </span>sample</div><div class="t m0 x32 h49 y16c7 ff19 fs26 fc0 sc0 ls0 ws0">implementation <span class="_"> </span>that <span class="_"> </span>shows <span class="_"> </span>the <span class="_"> </span>ﬂavor <span class="_"> </span>of <span class="_"> </span>many <span class="_"> </span>implementations <span class="_"> </span>on <span class="_"> </span>UNIX <span class="_"> </span>systems.</div><div class="t m0 x32 h49 y16c8 ff19 fs26 fc0 sc0 ls0 ws0">Chapter <span class="_ _3"></span>12 <span class="_ _3"></span>of <span class="_ _3"></span>Plauger</div><div class="t m0 x134 h49 y16c9 ff19 fs26 fc0 sc0 ls0 ws0">[</div><div class="t m0 x91 h49 y16c8 ff19 fs26 fc0 sc0 ls0 ws0">1992</div><div class="t m0 x13c h49 y16c9 ff19 fs26 fc0 sc0 ls0 ws0">]</div><div class="t m0 x59 h49 y16c8 ff19 fs26 fc0 sc0 ls0 ws0">provides <span class="_ _2"></span>the <span class="_ _3"></span>complete <span class="_ _9"></span>source <span class="_ _2"></span>code <span class="_ _9"></span>for <span class="_ _3"></span>an <span class="_ _3"></span>implementation</div><div class="t m0 x32 h49 y16ca ff19 fs26 fc0 sc0 ls0 ws0">of <span class="_ _23"> </span>the <span class="_ _42"> </span>standar<span class="_ _0"></span><span class="ls712">dI<span class="_ _43"></span><span class="ls0">/O <span class="_ _23"> </span>library<span class="_ _6"></span><span class="ls713">.T<span class="_ _7"></span><span class="ls0">he <span class="_ _23"> </span>implementation <span class="_ _42"> </span>of <span class="_ _23"> </span>the <span class="_ _42"> </span>GNU <span class="_ _23"> </span>standar<span class="ls714">dI<span class="_ _43"></span><span class="ls0">/O <span class="_ _23"> </span>library <span class="_ _23"> </span>is</span></span></span></span></span></span></div><div class="t m0 x32 h49 y16cb ff19 fs26 fc0 sc0 ls0 ws0">also publicly available.</div><div class="t m0 x35 h4c y16cc ff16 fs26 fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h49 y16cd ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _2"></span>program in <span class="_ _2"></span>Figur<span class="ls715">e5<span class="_ _4f"></span><span class="ls0">.1<span class="_ _1"></span><span class="ls715">1p<span class="_ _4f"></span><span class="ls0">rints <span class="_ _3"></span>the <span class="_ _2"></span>buffering for <span class="_ _2"></span>the <span class="_ _3"></span>three standar<span class="ls716">ds<span class="_ _4f"></span><span class="ls0">treams and <span class="_ _2"></span>for <span class="_ _2"></span>a</span></span></span></span></span></span></div><div class="t m0 x32 h49 y16ce ff19 fs26 fc0 sc0 ls0 ws0">stream that is associated with a r<span class="_ _0"></span>egular ﬁle.</div><div class="t m0 x32 h5d y16cf ff1a fs2f fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h5d y16d0 ff1a fs2f fc0 sc0 ls0 ws0">void <span class="_ _68"> </span>pr_stdio(const<span class="_"> </span>char *, FILE *);</div><div class="t m0 x32 h5d y16d1 ff1a fs2f fc0 sc0 ls0 ws0">int <span class="_ _15"> </span>is_unbuffered(FILE<span class="_"> </span>*);</div><div class="t m0 x32 h5d y16d2 ff1a fs2f fc0 sc0 ls0 ws0">int <span class="_ _15"> </span>is_linebuffered(FILE<span class="_"> </span>*);</div><div class="t m0 x32 h5d y16d3 ff1a fs2f fc0 sc0 ls0 ws0">int <span class="_ _15"> </span>buffer_size(FILE<span class="_"> </span>*);</div><div class="t m0 x32 h5d y16d4 ff1a fs2f fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h5d y16d5 ff1a fs2f fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 x32 h5d y16d6 ff1a fs2f fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h5d y16d7 ff1a fs2f fc0 sc0 ls0 ws0">FILE <span class="_ _68"> </span>*fp;</div><div class="t m0 x8a h5d y16d8 ff1a fs2f fc0 sc0 ls0 ws0">fputs(&quot;enter any character\n&quot;, stdout);</div><div class="t m0 x8a h5d y16d9 ff1a fs2f fc0 sc0 ls0 ws0">if (getchar() == EOF)</div><div class="t m0 x9d h5d y16da ff1a fs2f fc0 sc0 ls0 ws0">err_sys(&quot;getchar error&quot;);</div><div class="t m0 x8a h5d y16db ff1a fs2f fc0 sc0 ls0 ws0">fputs(&quot;one line to standard error\n&quot;, stderr);</div><div class="t m0 x8a h5d y16dc ff1a fs2f fc0 sc0 ls0 ws0">pr_stdio(&quot;stdin&quot;, <span class="_"> </span>stdin);</div><div class="t m0 x8a h5d y16dd ff1a fs2f fc0 sc0 ls0 ws0">pr_stdio(&quot;stdout&quot;, stdout);</div><div class="t m0 x8a h5d y16de ff1a fs2f fc0 sc0 ls0 ws0">pr_stdio(&quot;stderr&quot;, stderr);</div><a class="l" href="#pfe" data-dest-detail='[14,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892409px;bottom:1236.288916px;width:170.699791px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
