<div id="pf16d" class="pf w4 h1f" data-page-no="16d"><div class="pc pc16d w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg16d.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>10.6<span class="_ _1c9"> </span>Reentrant <span class="_"> </span>Functions<span class="_ _1b"> </span><span class="ff18">331</span></div><div class="t m0 x1c4 h52 y597 ff1a fs2a fc0 sc0 ls0 ws0">abort <span class="_ _a1"> </span>faccessat<span class="_ _15"> </span>linkat <span class="_ _a4"> </span>select<span class="_ _9f"> </span>socketpair</div><div class="t m0 x1c4 h52 y598 ff1a fs2a fc0 sc0 ls0 ws0">accept <span class="_ _7d"> </span>fchmod<span class="_ _9f"> </span>listen <span class="_ _a4"> </span>sem_post<span class="_ _6c"> </span>stat</div><div class="t m0 x1c4 h52 y2a84 ff1a fs2a fc0 sc0 ls0 ws0">access <span class="_ _7d"> </span>fchmodat<span class="_ _6c"> </span>lseek <span class="_ _82"> </span>send<span class="_ _a1"> </span>symlink</div><div class="t m0 x1c4 h52 y2a85 ff1a fs2a fc0 sc0 ls0 ws0">aio_error <span class="_ _6c"> </span>fchown<span class="_ _9f"> </span>lstat <span class="_ _82"> </span>sendmsg<span class="_ _71"> </span>symlinkat</div><div class="t m0 x1c4 h52 y2a86 ff1a fs2a fc0 sc0 ls0 ws0">aio_return <span class="_ _15"> </span>fchownat <span class="_ _15"> </span>mkdir<span class="_ _167"> </span>sendto <span class="_ _10b"> </span>tcdrain</div><div class="t m0 x1c4 h52 y2a87 ff1a fs2a fc0 sc0 ls0 ws0">aio_suspend <span class="_ _75"> </span>fcntl<span class="_ _7d"> </span>mkdirat <span class="_ _73"> </span>setgid<span class="_ _130"> </span>tcflow</div><div class="t m0 x1c4 h52 y2a88 ff1a fs2a fc0 sc0 ls0 ws0">alarm <span class="_ _a1"> </span>fdatasync<span class="_ _15"> </span>mkfifo <span class="_ _a4"> </span>setpgid<span class="_ _71"> </span>tcflush</div><div class="t m0 x1c4 h52 y2a89 ff1a fs2a fc0 sc0 ls0 ws0">bind <span class="_ _a0"> </span>fexecve<span class="_ _71"> </span>mkfifoat <span class="_ _a0"> </span>setsid<span class="_ _9f"> </span>tcgetattr</div><div class="t m0 x1c4 h52 y2a8a ff1a fs2a fc0 sc0 ls0 ws0">cfgetispeed <span class="_ _75"> </span>fork<span class="_ _a1"> </span>mknod <span class="_ _82"> </span>setsockopt<span class="_ _75"> </span>tcgetpgrp</div><div class="t m0 x1c4 h52 y2a8b ff1a fs2a fc0 sc0 ls0 ws0">cfgetospeed <span class="_ _75"> </span>fstat<span class="_ _7d"> </span>mknodat <span class="_ _73"> </span>setuid<span class="_ _130"> </span>tcsendbreak</div><div class="t m0 x1c4 h52 y2a8c ff1a fs2a fc0 sc0 ls0 ws0">cfsetispeed <span class="_ _75"> </span>fstatat<span class="_ _10b"> </span>open <span class="_ _167"> </span>shutdown<span class="_ _6c"> </span>tcsetattr</div><div class="t m0 x1c4 h52 y2a8d ff1a fs2a fc0 sc0 ls0 ws0">cfsetospeed <span class="_ _75"> </span>fsync<span class="_ _7d"> </span>openat <span class="_ _a4"> </span>sigaction<span class="_ _15"> </span>tcsetpgrp</div><div class="t m0 x1c4 h52 y2a8e ff1a fs2a fc0 sc0 ls0 ws0">chdir <span class="_ _a1"> </span>ftruncate<span class="_ _15"> </span>pause <span class="_ _82"> </span>sigaddset<span class="_ _15"> </span>time</div><div class="t m0 x1c4 h52 y2a8f ff1a fs2a fc0 sc0 ls0 ws0">chmod <span class="_ _a1"> </span>futimens<span class="_ _6c"> </span>pipe <span class="_ _167"> </span>sigdelset<span class="_ _15"> </span>timer_getoverrun</div><div class="t m0 x1c4 h52 y2a90 ff1a fs2a fc0 sc0 ls0 ws0">chown <span class="_ _a1"> </span>getegid<span class="_ _71"> </span>poll <span class="_ _167"> </span>sigemptyset<span class="_ _6e"> </span>timer_gettime</div><div class="t m0 x1c4 h52 y2a91 ff1a fs2a fc0 sc0 ls0 ws0">clock_gettime <span class="_ _48"> </span>geteuid<span class="_ _71"> </span>posix_trace_event <span class="_ _48"> </span>sigfillset<span class="_ _75"> </span>timer_settime</div><div class="t m0 x1c4 h52 y2a92 ff1a fs2a fc0 sc0 ls0 ws0">close <span class="_ _a1"> </span>getgid<span class="_ _9f"> </span>pselect <span class="_ _73"> </span>sigismember<span class="_ _6e"> </span>times</div><div class="t m0 x1c4 h52 y2a93 ff1a fs2a fc0 sc0 ls0 ws0">connect <span class="_ _9f"> </span>getgroups<span class="_ _15"> </span>raise <span class="_ _82"> </span>signal<span class="_ _9f"> </span>umask</div><div class="t m0 x1c4 h52 y2a94 ff1a fs2a fc0 sc0 ls0 ws0">creat <span class="_ _a1"> </span>getpeername<span class="_ _6e"> </span>read <span class="_ _167"> </span>sigpause<span class="_ _dc"> </span>uname</div><div class="t m0 x1c4 h52 y2a95 ff1a fs2a fc0 sc0 ls0 ws0">dup <span class="_ _73"> </span>getpgrp<span class="_ _71"> </span>readlink <span class="_ _a0"> </span>sigpending<span class="_ _75"> </span>unlink</div><div class="t m0 x1c4 h52 y2a96 ff1a fs2a fc0 sc0 ls0 ws0">dup2 <span class="_ _a0"> </span>getpid<span class="_ _9f"> </span>readlinkat <span class="_ _7d"> </span>sigprocmask<span class="_ _6e"> </span>unlinkat</div><div class="t m0 x1c4 h52 y2a97 ff1a fs2a fc0 sc0 ls0 ws0">execl <span class="_ _a1"> </span>getppid<span class="_ _71"> </span>recv <span class="_ _167"> </span>sigqueue<span class="_ _dc"> </span>utime</div><div class="t m0 x1c4 h52 y2a98 ff1a fs2a fc0 sc0 ls0 ws0">execle <span class="_ _7d"> </span>getsockname<span class="_ _6e"> </span>recvfrom <span class="_ _a0"> </span>sigset<span class="_ _9f"> </span>utimensat</div><div class="t m0 x1c4 h52 y2a99 ff1a fs2a fc0 sc0 ls0 ws0">execv <span class="_ _a1"> </span>getsockopt<span class="_ _75"> </span>recvmsg <span class="_ _73"> </span>sigsuspend<span class="_ _75"> </span>utimes</div><div class="t m0 x1c4 h52 y2a9a ff1a fs2a fc0 sc0 ls0 ws0">execve <span class="_ _7d"> </span>getuid<span class="_ _9f"> </span>rename <span class="_ _a4"> </span>sleep<span class="_ _7d"> </span>wait</div><div class="t m0 x1c4 h52 y2a9b ff1a fs2a fc0 sc0 ls0 ws0">_Exit <span class="_ _a1"> </span>kill<span class="_ _a1"> </span>renameat <span class="_ _a0"> </span>sockatmark<span class="_ _75"> </span>waitpid</div><div class="t m0 x1c4 h52 y2a9c ff1a fs2a fc0 sc0 ls0 ws0">_exit <span class="_ _a1"> </span>link<span class="_ _a1"> </span>rmdir <span class="_ _82"> </span>socket<span class="_ _9f"> </span>write</div><div class="t m0 x148 h2d y2a9d ff18 fs10 fc0 sc0 ls0 ws0">Figure 10.4<span class="_ _5a"> </span><span class="ff19">Reentrant functions that may be called from a signal handler</span></div><div class="t m0 x32 h4d y2a9e ff19 fs26 fc0 sc0 ls0 ws0">stored <span class="_"> </span>in<span class="_ _16"> </span><span class="ff1a">main</span><span class="lsc22">.T<span class="_ _49"></span><span class="ls0">her<span class="_ _0"></span>efore, <span class="_"> </span>as <span class="_ _47"> </span>a <span class="_ _47"> </span>general <span class="_ _66"> </span>rule, <span class="_ _47"> </span>when <span class="_ _66"> </span>calling <span class="_ _47"> </span>the <span class="_ _47"> </span>functions <span class="_ _66"> </span>listed <span class="_ _47"> </span>in</span></span></div><div class="t m0 x32 h4d y2a9f ff19 fs26 fc0 sc0 ls0 ws0">Figur<span class="lsc23">e1<span class="_ _b"></span><span class="ls0">0.4 <span class="_ _3"></span>from <span class="_ _3"></span>a <span class="_ _3"></span>signal <span class="_ _3"></span>handler<span class="_ _1"></span>,<span class="_ _47"> </span>we<span class="_ _47"> </span>should <span class="_ _3"></span>save <span class="_ _9"></span>and <span class="_ _3"></span>restor<span class="_ _0"></span>e<span class="_ _47"> </span><span class="ff1a">errno</span><span class="lsc24">.(<span class="_ _1d"></span><span class="ls0">Be <span class="_ _3"></span>awar<span class="ls7b5">et<span class="_ _b"></span><span class="ls0">hat <span class="_ _3"></span>a</span></span></span></span></span></span></div><div class="t m0 x32 h4d y2aa0 ff19 fs26 fc0 sc0 ls0 ws0">commonly <span class="_ _42"> </span>caught <span class="_ _53"> </span>signal <span class="_ _53"> </span>is<span class="_ _44"> </span><span class="ff1a">SIGCHLD</span><span class="lsc25">,a<span class="_ _43"></span><span class="ls0">nd <span class="_ _42"> </span>its <span class="_ _53"> </span>signal <span class="_ _53"> </span>handler <span class="_ _42"> </span>usually <span class="_ _53"> </span>calls <span class="_ _53"> </span>one <span class="_ _53"> </span>of <span class="_ _53"> </span>the</span></span></div><div class="t m0 x32 h4d y2aa1 ff1a fs26 fc0 sc0 ls0 ws0">wait<span class="_ _80"> </span><span class="ff19">functions. <span class="_"> </span>All<span class="_"> </span>the<span class="_"> </span></span>wait<span class="_ _66"> </span><span class="ff19">functions can change<span class="_"> </span></span>errno<span class="ff19">.)</span></div><div class="t m0 x3f h4d y2aa2 ff19 fs26 fc0 sc0 ls0 ws0">Note <span class="_"> </span>that<span class="_ _59"> </span><span class="ff1a">longjmp<span class="_ _59"> </span></span>(Section <span class="_"> </span>7.10) <span class="_"> </span>and<span class="_ _4b"> </span><span class="ff1a">siglongjmp<span class="_ _46"> </span></span>(Section <span class="_"> </span>10.15) <span class="_ _e"> </span>ar<span class="lsc26">em<span class="_ _4a"></span><span class="ls0">issing</span></span></div><div class="t m0 x32 h49 y2aa3 ff19 fs26 fc0 sc0 ls0 ws0">from <span class="_ _42"> </span>Figur<span class="lsc27">e1<span class="_ _55"></span><span class="ls0">0.4, <span class="_ _53"> </span>because <span class="_ _53"> </span>the <span class="_ _42"> </span>signal <span class="_ _53"> </span>may <span class="_ _42"> </span>have <span class="_ _53"> </span>occurred <span class="_ _42"> </span>while <span class="_ _42"> </span>the <span class="_ _53"> </span>main <span class="_ _42"> </span>routine <span class="_ _42"> </span>was</span></span></div><div class="t m0 x32 h49 y2aa4 ff19 fs26 fc0 sc0 ls0 ws0">updating <span class="_ _9"></span>a <span class="_ _9"></span>data <span class="_ _3"></span>structure<span class="_ _45"> </span>in<span class="_ _47"> </span>a<span class="_ _45"> </span>nonreentrant <span class="_ _3"></span>way<span class="_ _6"></span><span class="lsc28">.T<span class="_ _62"></span><span class="ls0">his <span class="_ _9"></span>data <span class="_ _9"></span>structur<span class="_ _0"></span><span class="lsc29">ec<span class="_ _b"></span><span class="ls0">ould <span class="_ _9"></span>be <span class="_ _9"></span>left <span class="_ _9"></span>half</span></span></span></span></div><div class="t m0 x32 h4d y2aa5 ff19 fs26 fc0 sc0 ls0 ws0">updated <span class="_ _23"> </span>if <span class="_ _42"> </span>we <span class="_ _42"> </span>call<span class="_ _35"> </span><span class="ff1a">siglongjmp<span class="_ _35"> </span></span>instead <span class="_ _42"> </span>of <span class="_ _42"> </span>returning <span class="_ _23"></span>from <span class="_ _23"></span>the <span class="_ _42"> </span>signal <span class="_ _23"> </span>handler<span class="_ _1"></span><span class="lsc2a">.I<span class="_ _7"></span><span class="ls0">f<span class="_ _35"> </span>it<span class="_ _44"> </span>is</span></span></div><div class="t m0 x32 h49 y2aa6 ff19 fs26 fc0 sc0 ls0 ws0">going <span class="_ _42"> </span>to <span class="_ _42"> </span>do <span class="_ _42"> </span>such <span class="_ _42"> </span>things <span class="_ _42"> </span>as <span class="_ _42"> </span>update <span class="_ _53"> </span>global <span class="_ _42"> </span>data <span class="_ _42"> </span>structures, <span class="_ _23"> </span>as <span class="_ _42"> </span>we <span class="_ _53"> </span>describe <span class="_ _42"> </span>here, <span class="_ _42"> </span>while</div><div class="t m0 x32 h4d y2aa7 ff19 fs26 fc0 sc0 ls0 ws0">catching signals that cause<span class="_"> </span><span class="ff1a">sigsetjmp<span class="_ _80"> </span></span>to be executed, an application needs to block the</div><div class="t m0 x32 h49 y2aa8 ff19 fs26 fc0 sc0 ls0 ws0">signals while updating the data structur<span class="_ _0"></span>es.</div><div class="t m0 x35 h4c y2aa9 ff16 fs26 fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h4d y2aaa ff19 fs26 fc0 sc0 ls0 ws0">Figur<span class="lsc2b">e1<span class="_ _55"></span><span class="ls0">0.5 <span class="_ _53"> </span>shows <span class="_ _53"> </span>a <span class="_ _e"> </span>program <span class="_ _42"> </span>that <span class="_ _53"> </span>calls <span class="_ _e"> </span>the <span class="_ _53"> </span>nonreentrant <span class="_ _53"> </span>function<span class="_ _44"> </span><span class="ff1a">getpwnam<span class="_ _4b"> </span></span>from <span class="_ _53"> </span>a</span></span></div><div class="t m0 x32 h4d y2aab ff19 fs26 fc0 sc0 ls0 ws0">signal <span class="_ _35"> </span>handler <span class="_ _44"> </span>that <span class="_ _35"> </span>is <span class="_ _44"> </span>called <span class="_ _35"> </span>every <span class="_ _44"> </span>second.<span class="_ _98"> </span><span class="ls164">We <span class="_ _16"> </span>d<span class="_ _9"></span></span>escribe <span class="_ _44"> </span>the<span class="_ _51"> </span><span class="ff1a">alarm<span class="_ _54"> </span></span>function <span class="_ _44"> </span>in</div><div class="t m0 x32 h4d y2aac ff19 fs26 fc0 sc0 ls0 ws0">Section 10.10.<span class="_ _59"> </span><span class="ls164">We <span class="_ _e"> </span>u<span class="_ _9"></span></span>se it here<span class="_"> </span>to<span class="_"> </span>generate a<span class="_"> </span><span class="ff1a">SIGALRM<span class="_ _80"> </span></span>signal every second.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
