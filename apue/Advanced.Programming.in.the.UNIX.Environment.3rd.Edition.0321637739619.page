<div id="pf26b" class="pf w4 h1f" data-page-no="26b"><div class="pc pc26b w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg26b.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>15.1<span class="_ _1"></span><span class="ls12c1">1C<span class="_ _2c5"></span><span class="ls0">lient–Server <span class="_"> </span>Properties<span class="_ _1fb"> </span><span class="ff18">585</span></span></span></div><div class="t m0 x35 h53 y12f ff16 fs2b fc0 sc0 ls0 ws0">15.11 <span class="_ _66"> </span>Client–Server <span class="_"> </span>Proper <span class="_ _b"></span>ties</div><div class="t m0 x32 h2a y4de ff19 fsf fc0 sc0 ls0 ws0">Let’s <span class="_ _2"></span>detail <span class="_ _2"></span>some <span class="_ _3"></span>of <span class="_ _2"></span>the <span class="_ _3"></span>properties of <span class="_ _3"></span>clients <span class="_ _2"></span>and <span class="_ _2"></span>servers <span class="_ _3"></span>that <span class="_ _2"></span>ar<span class="ls146">ea<span class="_ _4f"></span><span class="ls45">ff<span class="ls0">ected <span class="_ _3"></span>by <span class="_ _2"></span>the <span class="_ _2"></span>various</span></span></span></div><div class="t m0 x32 h2a y6d0 ff19 fsf fc0 sc0 ls0 ws0">types <span class="_ _2"></span>of <span class="_ _3"></span>IPC <span class="_ _3"></span>used <span class="_ _2"></span>between <span class="_ _3"></span>them.<span class="_ _16"> </span>The <span class="_ _2"></span>simplest <span class="_ _3"></span>type <span class="_ _3"></span>of <span class="_ _3"></span>relationship <span class="_ _2"></span>is <span class="_ _2"></span>to <span class="_ _3"></span>have <span class="_ _3"></span>the <span class="_ _2"></span>client</div><div class="t m0 x32 h26 y6d1 ff1a fsf fc0 sc0 ls0 ws0">fork<span class="_ _44"> </span><span class="ff19">and<span class="_ _35"> </span></span>exec<span class="_ _44"> </span><span class="ff19">the <span class="_ _42"> </span>desired <span class="_ _42"> </span>server<span class="_ _1"></span><span class="ls12c2">.T<span class="_ _49"></span><span class="ls0">wo <span class="_ _42"> </span>half-duplex <span class="_ _53"> </span>pipes <span class="_ _42"> </span>can <span class="_ _42"> </span>be <span class="_ _42"> </span>created <span class="_ _42"> </span>befor<span class="ls12c3">et<span class="_ _c"></span><span class="ls0">he</span></span></span></span></span></div><div class="t m0 x32 h26 y6d2 ff1a fsf fc0 sc0 ls0 ws0">fork<span class="_ _45"> </span><span class="ff19">to <span class="_ _9"></span>allow <span class="_ _23"></span>data <span class="_ _9"></span>to <span class="_ _23"></span>be <span class="_ _9"></span>transferred <span class="_ _9"></span>in <span class="_ _23"></span>both <span class="_ _9"></span>directions. <span class="_ _45"> </span>Figur<span class="ls1b1">e1<span class="_ _43"></span><span class="ls0">5.16 <span class="_ _23"></span>is <span class="_ _9"></span>an <span class="_ _23"></span>example <span class="_ _9"></span>of</span></span></span></div><div class="t m0 x32 h2a y6d3 ff19 fsf fc0 sc0 ls0 ws0">this <span class="_ _23"></span>arrangement.<span class="_ _51"> </span>The <span class="_ _23"> </span>server <span class="_ _23"> </span>that <span class="_ _23"> </span>is <span class="_ _42"> </span>executed <span class="_ _23"></span>can <span class="_ _23"> </span>be <span class="_ _23"> </span>a <span class="_ _23"> </span>set-user-ID <span class="_ _23"> </span>program, <span class="_ _23"></span>giving <span class="_ _23"></span>it</div><div class="t m0 x32 h2a y6d4 ff19 fsf fc0 sc0 ls0 ws0">special <span class="_"> </span>privileges.<span class="_ _48"> </span>Also, <span class="_"> </span>the <span class="_"> </span>server <span class="_"> </span>can <span class="_ _e"> </span>determine <span class="_"> </span>the <span class="_"> </span>r<span class="_ _0"></span>eal <span class="_"> </span>identity <span class="_"> </span>of <span class="_ _e"> </span>the <span class="_"> </span>client <span class="_"> </span>by</div><div class="t m0 x32 h2a y6d5 ff19 fsf fc0 sc0 ls0 ws0">looking <span class="_ _2"></span>at <span class="_ _2"></span>its <span class="_ _2"></span>real user <span class="_ _2"></span>ID.<span class="_ _61"> </span>(Recall <span class="_ _2"></span>from Section <span class="_ _2"></span>8.10 <span class="_ _2"></span>that <span class="_ _2"></span>the <span class="_ _2"></span>real <span class="_ _2"></span>user <span class="_ _2"></span>ID <span class="_ _2"></span>and <span class="_ _2"></span>real group</div><div class="t m0 x32 h26 y6d6 ff19 fsf fc0 sc0 ls0 ws0">ID don’t change across an<span class="_"> </span><span class="ff1a">exec</span>.)</div><div class="t m0 x3f h2b y6d7 ff19 fsf fc0 sc0 ls65 ws0">Wi<span class="_ _3"></span><span class="ls0">th this arrangement, we can build an<span class="_"> </span><span class="ff1b">open server</span><span class="ls12c4">.(<span class="_ _4a"></span><span class="ls5f">We <span class="_ _53"> </span>s<span class="_ _9"></span><span class="ls0">how <span class="_ _2"></span>an implementation of</span></span></span></span></div><div class="t m0 x32 h2a y6d8 ff19 fsf fc0 sc0 ls0 ws0">this <span class="_ _3"></span>client–server <span class="_ _3"></span>mechanism <span class="_ _9"></span>in <span class="_ _3"></span>Section <span class="_ _3"></span>17.5.)<span class="_ _16"> </span>It <span class="_ _9"></span>opens <span class="_ _3"></span>ﬁles <span class="_ _3"></span>for <span class="_ _9"></span>the <span class="_ _3"></span>client <span class="_ _3"></span>instead <span class="_ _3"></span>of <span class="_ _9"></span>the</div><div class="t m0 x32 h26 y6d9 ff19 fsf fc0 sc0 ls0 ws0">client <span class="_"> </span>calling <span class="_ _47"> </span>the<span class="_ _46"> </span><span class="ff1a">open<span class="_ _61"> </span></span>function. <span class="_ _46"> </span>This<span class="_ _61"> </span>way<span class="_ _6"></span><span class="lsa35">,a<span class="_ _5b"></span><span class="ls0">dditional <span class="_"> </span>permission <span class="_ _47"> </span>checking <span class="_"> </span>can <span class="_ _66"> </span>be</span></span></div><div class="t m0 x32 h2a y6da ff19 fsf fc0 sc0 ls0 ws0">added, above <span class="_ _2"></span>and beyond <span class="_ _2"></span>the normal <span class="_ _2"></span>UNIX system user/group/other permissions.<span class="_ _61"> </span><span class="ls5f">We</span></div><div class="t m0 x32 h2a y6db ff19 fsf fc0 sc0 ls0 ws0">assume <span class="_ _9"></span>that <span class="_ _9"></span>the <span class="_ _23"></span>server <span class="_ _9"></span>is <span class="_ _9"></span>a <span class="_ _23"></span>set-user-ID <span class="_ _3"></span>program, <span class="_ _9"></span>giving <span class="_ _23"></span>it <span class="_ _9"></span>additional <span class="_ _9"></span>permissions <span class="_ _9"></span>(root</div><div class="t m0 x32 h2a y6dc ff19 fsf fc0 sc0 ls0 ws0">permission, <span class="_ _66"> </span>perhaps). <span class="_ _61"> </span>The<span class="_ _61"> </span>server <span class="_ _47"> </span>uses <span class="_ _66"> </span>the <span class="_ _47"> </span>real <span class="_ _66"> </span>user <span class="_ _47"> </span>ID <span class="_ _66"> </span>of <span class="_ _47"> </span>the <span class="_ _47"> </span>client <span class="_ _66"> </span>to <span class="_ _47"> </span>determine</div><div class="t m0 x32 h2a y6dd ff19 fsf fc0 sc0 ls0 ws0">whether <span class="_ _42"> </span>to <span class="_ _42"> </span>give <span class="_ _53"> </span>it <span class="_ _42"> </span>access <span class="_ _53"> </span>to <span class="_ _42"> </span>the <span class="_ _53"> </span>requested <span class="_ _42"> </span>ﬁle.<span class="_ _54"> </span>This <span class="_ _42"> </span>way<span class="_ _6"></span>,<span class="_ _44"> </span>we<span class="_ _44"> </span>can <span class="_ _42"> </span>build <span class="_ _42"> </span>a <span class="_ _53"> </span>server <span class="_ _42"> </span>that</div><div class="t m0 x32 h2a y6de ff19 fsf fc0 sc0 ls0 ws0">allows certain users permissions that they don’t normally have.</div><div class="t m0 x3f h2a y10cf ff19 fsf fc0 sc0 ls0 ws0">In this <span class="_ _2"></span>example, <span class="_ _2"></span>since <span class="_ _2"></span>the <span class="_ _2"></span>server <span class="_ _2"></span>is <span class="_ _2"></span>a <span class="_ _2"></span>child <span class="_ _2"></span>of <span class="_ _2"></span>the <span class="_ _2"></span>parent, all <span class="_ _2"></span>the <span class="_ _2"></span>server <span class="_ _2"></span>can <span class="_ _2"></span>do <span class="_ _2"></span>is <span class="_ _2"></span>pass</div><div class="t m0 x32 h2a y10d0 ff19 fsf fc0 sc0 ls0 ws0">back <span class="_ _3"></span>the <span class="_ _9"></span>contents <span class="_ _3"></span>of <span class="_ _9"></span>the <span class="_ _9"></span>ﬁle <span class="_ _3"></span>to <span class="_ _9"></span>the <span class="_ _3"></span>parent. <span class="_ _45"> </span>Although<span class="_ _47"> </span>this <span class="_ _9"></span>works <span class="_ _3"></span>ﬁne <span class="_ _9"></span>for <span class="_ _3"></span>regular <span class="_ _3"></span>ﬁles, <span class="_ _9"></span>it</div><div class="t m0 x32 h2a y4668 ff19 fsf fc0 sc0 ls0 ws0">can’t <span class="_ _2"></span>be <span class="_ _3"></span>used <span class="_ _2"></span>for <span class="_ _3"></span>special <span class="_ _3"></span>device <span class="_ _2"></span>ﬁles, <span class="_ _3"></span>for <span class="_ _3"></span>example.<span class="_ _61"> </span><span class="ls5f">We <span class="_ _80"> </span>w<span class="_ _9"></span></span>ould <span class="_ _3"></span>like <span class="_ _2"></span>to <span class="_ _3"></span>be <span class="_ _2"></span>able <span class="_ _3"></span>to <span class="_ _3"></span>have <span class="_ _2"></span>the</div><div class="t m0 x32 h2a y4669 ff19 fsf fc0 sc0 ls0 ws0">server <span class="_ _9"></span>open <span class="_ _9"></span>the <span class="_ _23"></span>requested <span class="_ _3"></span>ﬁle <span class="_ _23"></span>and <span class="_ _9"></span>pass <span class="_ _9"></span>back <span class="_ _23"></span>the <span class="_ _9"></span>ﬁle <span class="_ _9"></span>descriptor<span class="_ _1"></span><span class="ls12c5">.W<span class="_ _26"></span><span class="ls0">hereas <span class="_ _9"></span>a <span class="_ _23"></span>par<span class="_ _0"></span>ent <span class="_ _9"></span>can</span></span></div><div class="t m0 x32 h2a y6df ff19 fsf fc0 sc0 ls0 ws0">pass <span class="_ _53"> </span>a <span class="_ _53"> </span>child <span class="_ _53"> </span>an <span class="_ _53"> </span>open <span class="_ _53"> </span>descriptor<span class="_ _1"></span><span class="ls70c">,ac<span class="_ _c"></span><span class="ls0">hild <span class="_ _53"> </span>cannot <span class="_ _53"> </span>pass <span class="_ _53"> </span>a <span class="_ _53"> </span>descriptor <span class="_ _e"> </span>back <span class="_ _53"> </span>to <span class="_ _53"> </span>the <span class="_ _53"> </span>parent</span></span></div><div class="t m0 x32 h2a y6e0 ff19 fsf fc0 sc0 ls0 ws0">(unless special programming techniques ar<span class="_ _0"></span><span class="ls44">eu<span class="_ _d"></span><span class="ls0">sed, which we cover in Chapter 17).</span></span></div><div class="t m0 x3f h2a y6e1 ff19 fsf fc0 sc0 ls5f ws0">We <span class="_ _80"> </span>s<span class="_ _9"></span><span class="ls0">howed <span class="_ _2"></span>the <span class="_ _3"></span>next <span class="_ _3"></span>type <span class="_ _3"></span>of <span class="_ _3"></span>server <span class="_ _2"></span>in <span class="_ _3"></span>Figur<span class="ls12c6">e1<span class="_ _8"></span><span class="ls0">5.23. <span class="_ _47"> </span>The<span class="_ _47"> </span>server <span class="_ _3"></span>is <span class="_ _3"></span>a <span class="_ _2"></span>daemon <span class="_ _3"></span>process</span></span></span></div><div class="t m0 x32 h2a y6e2 ff19 fsf fc0 sc0 ls0 ws0">that <span class="_ _2"></span>is <span class="_ _3"></span>contacted <span class="_ _3"></span>using <span class="_ _2"></span>some <span class="_ _3"></span>form <span class="_ _3"></span>of <span class="_ _2"></span>IPC <span class="_ _3"></span>by <span class="_ _3"></span>all <span class="_ _3"></span>clients.<span class="_ _61"> </span><span class="ls5f">We <span class="_ _80"> </span>c<span class="_ _9"></span></span>an’t <span class="_ _3"></span>use <span class="_ _3"></span>pipes <span class="_ _2"></span>for <span class="_ _3"></span>this <span class="_ _3"></span>type</div><div class="t m0 x32 h2a y6e3 ff19 fsf fc0 sc0 ls0 ws0">of <span class="_"> </span>client–server <span class="_"> </span>arrangement.<span class="_ _60"> </span><span class="ls12c7">Af<span class="_ _5b"></span><span class="ls0">orm <span class="_"> </span>of <span class="_"> </span>named <span class="_"> </span>IPC <span class="_"> </span>is <span class="_"> </span>requir<span class="_ _0"></span>ed, <span class="_"> </span>such <span class="_"> </span>as <span class="_"> </span>FIFOs <span class="_"> </span>or</span></span></div><div class="t m0 x32 h2a y6e4 ff19 fsf fc0 sc0 ls0 ws0">message queues.<span class="_ _46"> </span><span class="ls65">Wi<span class="_ _3"></span></span>th FIFOs, <span class="_ _2"></span>we saw that an <span class="_ _2"></span>individual per-client FIFO is also required</div><div class="t m0 x32 h2a y466a ff19 fsf fc0 sc0 ls0 ws0">if the <span class="_ _2"></span>server is <span class="_ _2"></span>to <span class="_ _2"></span>send data <span class="_ _2"></span>back <span class="_ _2"></span>to the <span class="_ _2"></span>client.<span class="_ _46"> </span>If <span class="_ _2"></span>the <span class="_ _2"></span>client–server application <span class="_ _2"></span>sends <span class="_ _2"></span>data</div><div class="t m0 x32 h2a y466b ff19 fsf fc0 sc0 ls0 ws0">only from the client to the <span class="_ _2"></span>server<span class="_ _6"></span><span class="lsdb9">,as<span class="_ _d"></span><span class="ls0">ingle <span class="_ _2"></span>well-known FIFO sufﬁces. <span class="_"> </span>(The<span class="_"> </span>System <span class="_ _2"></span>V line</span></span></div><div class="t m0 x32 h26 y466c ff19 fsf fc0 sc0 ls0 ws0">printer <span class="_ _23"></span>spooler <span class="_ _23"></span>used <span class="_ _23"></span>this <span class="_ _23"></span>form <span class="_ _23"></span>of <span class="_ _23"> </span>client–server <span class="_ _23"> </span>arrangement.<span class="_ _51"> </span>The <span class="_ _23"></span>client <span class="_ _23"></span>was <span class="_ _23"></span>the<span class="_ _35"> </span><span class="ff1a">lp</span></div><div class="t m0 x40 h2a y466d ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 x1b2 h2a y466c ff19 fsf fc0 sc0 ls0 ws0">1</div><div class="t m0 x17e h2a y466d ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 x32 h26 y466e ff19 fsf fc0 sc0 ls0 ws0">command, <span class="_ _3"></span>and <span class="_ _3"></span>the <span class="_ _3"></span>server <span class="_ _3"></span>was <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">lpsched<span class="_ _45"> </span></span>daemon <span class="_ _2"></span>process. <span class="_ _47"> </span>A<span class="_ _47"> </span>single <span class="_ _3"></span>FIFO <span class="_ _3"></span>was <span class="_ _9"></span>used,</div><div class="t m0 x32 h2a y6a7 ff19 fsf fc0 sc0 ls0 ws0">since <span class="_ _3"></span>the <span class="_ _3"></span>ﬂow <span class="_ _3"></span>of <span class="_ _9"></span>data <span class="_ _3"></span>was <span class="_ _3"></span>only <span class="_ _9"></span>from <span class="_ _2"></span>the <span class="_ _3"></span>client <span class="_ _9"></span>to <span class="_ _3"></span>the <span class="_ _3"></span>server<span class="_ _1"></span><span class="ls12c8">.N<span class="_ _62"></span><span class="ls0">othing <span class="_ _9"></span>was <span class="_ _3"></span>sent <span class="_ _3"></span>back <span class="_ _9"></span>to</span></span></div><div class="t m0 x32 h2a y466f ff19 fsf fc0 sc0 ls0 ws0">the client.)</div><div class="t m0 x3f h2a y4670 ff19 fsf fc0 sc0 ls0 ws0">Multiple possibilities exist with message queues.</div><div class="t m0 x3f h2a y4671 ff19 fsf fc0 sc0 ls0 ws0">1. <span class="_ _51"> </span>A<span class="_"> </span>single queue <span class="_ _2"></span>can be used between <span class="_ _2"></span>the server and all <span class="_ _2"></span>the clients, using <span class="_ _2"></span>the type</div><div class="t m0 x41 h2a y4672 ff19 fsf fc0 sc0 ls0 ws0">ﬁeld <span class="_ _2"></span>of <span class="_ _2"></span>each <span class="_ _2"></span>message <span class="_ _2"></span>to <span class="_ _2"></span>indicate <span class="_ _2"></span>the <span class="_ _2"></span>message <span class="_ _2"></span>recipient. <span class="_"> </span>For<span class="_ _47"> </span>example, <span class="_ _2"></span>the <span class="_ _2"></span>clients</div><div class="t m0 x41 h2a y4673 ff19 fsf fc0 sc0 ls0 ws0">can <span class="_ _9"></span>send <span class="_ _9"></span>their <span class="_ _9"></span>requests <span class="_ _9"></span>with <span class="_ _9"></span>a <span class="_ _9"></span>type <span class="_ _23"></span>ﬁeld <span class="_ _9"></span>of <span class="_ _9"></span>1.<span class="_ _5a"> </span>Included <span class="_ _9"></span>in <span class="_ _9"></span>the <span class="_ _9"></span>request <span class="_ _9"></span>must <span class="_ _9"></span>be</div><div class="t m0 x41 h2a y4674 ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _9"></span>client’s <span class="_ _23"></span>process <span class="_ _9"></span>ID.<span class="_ _5a"> </span>The <span class="_ _23"></span>server <span class="_ _9"></span>then <span class="_ _23"></span>sends <span class="_ _9"></span>the <span class="_ _23"> </span>response <span class="_ _9"></span>with <span class="_ _23"></span>the <span class="_ _9"></span>type <span class="_ _23"></span>ﬁeld</div><div class="t m0 x41 h2a y4675 ff19 fsf fc0 sc0 ls0 ws0">set <span class="_ _2"></span>to <span class="_ _3"></span>the <span class="_ _2"></span>client’s <span class="_ _3"></span>process <span class="_ _2"></span>ID.<span class="_ _61"> </span>The <span class="_ _3"></span>server <span class="_ _2"></span>receives <span class="_ _2"></span>only <span class="_ _3"></span>the <span class="_ _2"></span>messages <span class="_ _3"></span>with <span class="_ _3"></span>a <span class="_ _2"></span>type</div><div class="t m0 x41 h26 y4676 ff19 fsf fc0 sc0 ls0 ws0">ﬁeld <span class="_ _42"> </span>of <span class="_ _53"> </span>1 <span class="_ _53"> </span>(the <span class="_ _53"> </span>fourth <span class="_ _53"> </span>argument <span class="_ _42"> </span>for<span class="_ _44"> </span><span class="ff1a">msgrcv</span>), <span class="_ _53"> </span>and <span class="_ _53"> </span>the <span class="_ _53"> </span>clients <span class="_ _53"> </span>receive <span class="_ _42"> </span>only <span class="_ _53"> </span>the</div><div class="t m0 x41 h2a y4677 ff19 fsf fc0 sc0 ls0 ws0">messages with a type ﬁeld equal to their process IDs.</div><div class="t m0 x3f h2a y4678 ff19 fsf fc0 sc0 ls0 ws0">2. <span class="_ _51"> </span>Alternatively<span class="_ _4"></span>,<span class="_ _45"> </span>an<span class="_ _45"> </span>individual <span class="_ _9"></span>message <span class="_ _9"></span>queue <span class="_ _9"></span>can <span class="_ _9"></span>be <span class="_ _9"></span>used <span class="_ _9"></span>for <span class="_ _9"></span>each <span class="_ _9"></span>client.<span class="_ _51"> </span>Befor<span class="_ _0"></span>e</div><div class="t m0 x41 h2a y4679 ff19 fsf fc0 sc0 ls0 ws0">sending <span class="_ _9"></span>the <span class="_ _9"></span>ﬁrst <span class="_ _23"></span>r<span class="_ _0"></span>equest <span class="_ _9"></span>to <span class="_ _9"></span>a <span class="_ _9"></span>server<span class="_ _1"></span><span class="ls183">,e<span class="_ _b"></span><span class="ls0">ach <span class="_ _9"></span>client <span class="_ _23"></span>creates <span class="_ _3"></span>its <span class="_ _23"></span>own <span class="_ _9"></span>message <span class="_ _9"></span>queue</span></span></div><a class="l" href="#pf12" data-dest-detail='[18,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892409px;bottom:1236.288916px;width:179.507805px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
