<div id="pf14b" class="pf w4 h1f" data-page-no="14b"><div class="pc pc14b w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg14b.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>9.6<span class="_ _1c1"> </span>Contr<span class="_ _1"></span>olling <span class="_"> </span>T<span class="_ _1"></span>erminal<span class="_ _1b"> </span><span class="ff18">297</span></div><div class="t m0 x3f h2a y12f ff19 fsf fc0 sc0 ls49 ws0">•W<span class="_ _4d"></span><span class="ls0">henever <span class="_ _42"> </span>we <span class="_ _23"> </span>press <span class="_ _42"> </span>the <span class="_ _42"> </span>terminal’s <span class="_ _42"> </span>quit <span class="_ _23"> </span>key <span class="_ _42"> </span>(often <span class="_ _42"> </span>Control-backslash), <span class="_ _23"> </span>the <span class="_ _42"> </span>quit</span></div><div class="t m0 x15 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">signal is sent to all processes in the for<span class="_ _0"></span>egr<span class="_ _0"></span>ound process gr<span class="_ _0"></span>oup.</div><div class="t m0 x3f h2a y3eb ff19 fsf fc0 sc0 ls49 ws0">•I<span class="_ _4d"></span><span class="lsb26">fam<span class="_ _43"></span><span class="ls0">odem <span class="_ _23"> </span>(or <span class="_ _53"> </span>network) <span class="_ _42"> </span>disconnect <span class="_ _42"> </span>is <span class="_ _42"> </span>detected <span class="_ _42"> </span>by <span class="_ _42"> </span>the <span class="_ _53"> </span>terminal <span class="_ _42"> </span>interface, <span class="_ _42"> </span>the</span></span></div><div class="t m0 x15 h2a y3ec ff19 fsf fc0 sc0 ls0 ws0">hang-up signal is sent to the controlling pr<span class="_ _0"></span>ocess (the session leader).</div><div class="t m0 x32 h2a y263c ff19 fsf fc0 sc0 ls0 ws0">These characteristics ar<span class="ls44">es<span class="_ _4f"></span><span class="ls0">hown in Figur<span class="ls44">e9<span class="_ _d"></span><span class="ls0">.7.</span></span></span></span></div><div class="t m0 x2d h2d y263d ff19 fs10 fc0 sc0 ls0 ws0">login shell</div><div class="t m0 xc0 h4f y263e ff1a fs11 fc0 sc0 ls0 ws0">proc1</div><div class="t m0 x10a h6d y263f ff1a fs12 fc0 sc0 ls0 ws0">proc2</div><div class="t m0 x1db h63 y2640 ff1a fs13 fc0 sc0 ls0 ws0">proc3</div><div class="t m0 x120 h6f y2641 ff1a fs14 fc0 sc0 ls0 ws0">proc4</div><div class="t m0 x44 h66 y2642 ff1a fs15 fc0 sc0 ls0 ws0">proc5</div><div class="t m0 xb8 h33 y2643 ff19 fs16 fc0 sc0 ls0 ws0">background pr<span class="_ _0"></span>ocess group</div><div class="t m0 x182 h33 y2644 ff19 fs16 fc0 sc0 ls0 ws0">session leader =</div><div class="t m0 x156 h33 y2645 ff19 fs16 fc0 sc0 ls0 ws0">controlling pr<span class="_ _0"></span>ocess</div><div class="t m0 xa7 h83 y2646 ff19 fs36 fc0 sc0 ls0 ws0">background pr<span class="_ _0"></span>ocess group</div><div class="t m0 x1ef h34 y2647 ff19 fs17 fc0 sc0 ls0 ws0">foregr<span class="_ _0"></span>ound process gr<span class="_ _0"></span>oup</div><div class="t m0 xde h69 y2648 ff19 fs34 fc0 sc0 ls0 ws0">session</div><div class="t m0 x8c h36 y2649 ff19 fs19 fc0 sc0 ls0 ws0">controlling</div><div class="t m0 x1e h36 y264a ff19 fs19 fc0 sc0 ls0 ws0">terminal</div><div class="t m1a x1f3 h113 y264b ff19 fs93 fc0 sc0 ls0 ws0">terminal input and</div><div class="t m1a x9c h113 y264c ff19 fs93 fc0 sc0 ls0 ws0">terminal-generated signals</div><div class="t m1b x180 h114 y264d ff19 fs94 fc0 sc0 ls0 ws0">modem disconnect</div><div class="t m1b xda h114 y264e ff19 fs94 fc0 sc0 ls0 ws0">(hang-up signal)</div><div class="t m0 xf6 h38 y264f ff18 fs1b fc0 sc0 ls0 ws0">Figure 9.7<span class="_ _5a"> </span><span class="ff19">Process groups and sessions showing contr<span class="_ _0"></span>olling terminal</span></div><div class="t m0 x3f hfa y2650 ff19 fs88 fc0 sc0 ls0 ws0">Usually<span class="_ _4"></span>,<span class="_ _4b"> </span>we<span class="_ _44"> </span>don’t <span class="_ _53"> </span>have <span class="_ _53"> </span>to <span class="_ _e"> </span>worry <span class="_ _53"> </span>about <span class="_ _53"> </span>the <span class="_ _53"> </span>controlling <span class="_ _42"> </span>terminal; <span class="_ _53"> </span>it <span class="_ _e"> </span>is <span class="_ _53"> </span>established</div><div class="t m0 x32 hfa y2651 ff19 fs88 fc0 sc0 ls0 ws0">automatically when we log in.</div><div class="t m0 x76 h38 y2652 ff19 fs1b fc0 sc0 ls0 ws0">POSIX.1 <span class="_ _2"></span>leaves <span class="_ _3"></span>the <span class="_ _2"></span>choice <span class="_ _3"></span>of <span class="_ _3"></span>the <span class="_ _2"></span>mechanism <span class="_ _3"></span>used <span class="_ _3"></span>to <span class="_ _2"></span>allocate <span class="_ _3"></span>a <span class="_ _3"></span>controlling <span class="_ _2"></span>terminal <span class="_ _2"></span>up <span class="_ _3"></span>to <span class="_ _3"></span>each</div><div class="t m0 x76 h38 y2653 ff19 fs1b fc0 sc0 ls0 ws0">individual implementation.<span class="_ _35"> </span><span class="lsb27">We<span class="_ _9"></span></span>’ll show the actual steps in Section 19.4.</div><div class="t m0 x76 h38 y2654 ff19 fs1b fc0 sc0 ls0 ws0">Systems <span class="_ _2"></span>derived <span class="_ _2"></span>from <span class="_ _2"></span>UNIX <span class="_ _2"></span>System <span class="_ _3"></span>V <span class="_ _2"></span>allocate <span class="_ _3"></span>the <span class="_ _2"></span>controlling <span class="_ _2"></span>terminal <span class="_ _2"></span>for <span class="_ _3"></span>a <span class="_ _2"></span>session <span class="_ _2"></span>when <span class="_ _3"></span>the</div><div class="t m0 x76 h38 y2655 ff19 fs1b fc0 sc0 ls0 ws0">session <span class="_ _3"></span>leader <span class="_ _9"></span>opens <span class="_ _3"></span>the <span class="_ _9"></span>ﬁrst <span class="_ _3"></span>terminal <span class="_ _9"></span>device <span class="_ _3"></span>that <span class="_ _9"></span>is <span class="_ _9"></span>not <span class="_ _3"></span>already <span class="_ _3"></span>associated <span class="_ _9"></span>with <span class="_ _3"></span>a <span class="_ _9"></span>session, <span class="_ _3"></span>as</div><div class="t m0 x76 hd6 y2656 ff19 fs1b fc0 sc0 ls0 ws0">long as the call to<span class="_"> </span><span class="ff1a">open<span class="_ _53"> </span></span>does not specify the<span class="_"> </span><span class="ff1a">O_NOCTTY<span class="_ _e"> </span></span>ﬂag (Section 3.3).</div><div class="t m0 x76 h38 y2657 ff19 fs1b fc0 sc0 ls0 ws0">BSD</div><div class="t m0 x206 h38 y2658 ff19 fs1b fc0 sc0 ls0 ws0">-</div><div class="t m0 xf6 h38 y2657 ff19 fs1b fc0 sc0 ls0 ws0">based systems <span class="_ _2"></span>allocate <span class="_ _2"></span>the <span class="_ _2"></span>controlling <span class="_ _2"></span>terminal <span class="_ _2"></span>for <span class="_ _2"></span>a <span class="_ _2"></span>session when <span class="_ _2"></span>the <span class="_ _2"></span>session <span class="_ _2"></span>leader <span class="_ _2"></span>calls</div><div class="t m0 x76 hd6 y2659 ff1a fs1b fc0 sc0 ls0 ws0">ioctl<span class="_ _45"> </span><span class="ff19">with <span class="_ _42"> </span>a<span class="_ _45"> </span><span class="ff1b lsb28">re<span class="ls0">quest<span class="_ _35"> </span></span></span>ar<span class="_ _0"></span>gument <span class="_ _42"> </span>of<span class="_ _45"> </span><span class="ff1a">TIOCSCTTY<span class="_ _45"> </span></span>(the <span class="_ _42"> </span>thir<span class="lsb29">da<span class="_ _b"></span><span class="lsb28">rg<span class="ls0">ument <span class="_ _23"> </span>is <span class="_ _42"> </span>a <span class="_ _42"> </span>null <span class="_ _42"> </span>pointer).<span class="_ _61"> </span>The</span></span></span></span></div><div class="t m0 x76 h38 y265a ff19 fs1b fc0 sc0 ls0 ws0">session <span class="_ _2"></span>cannot <span class="_ _2"></span>already <span class="_ _2"></span>have <span class="_ _2"></span>a <span class="_ _3"></span>controlling <span class="_ _2"></span>terminal <span class="_ _2"></span>for <span class="_ _3"></span>this <span class="_ _2"></span>call <span class="_ _2"></span>to <span class="_ _3"></span>succeed.<span class="_ _44"> </span>(Normally<span class="_ _1"></span><span class="lsb2a">,t<span class="_ _d"></span><span class="ls0">his <span class="_ _3"></span>call</span></span></div><div class="t m0 x76 hd6 y265b ff19 fs1b fc0 sc0 ls0 ws0">to<span class="_ _35"> </span><span class="ff1a">ioctl<span class="_ _45"> </span></span>follows <span class="_"> </span>a <span class="_ _42"> </span>call <span class="_"> </span>to<span class="_ _45"> </span><span class="ff1a">setsid</span><span class="lsb2b">,w<span class="_ _b"></span><span class="ls0">hich <span class="_ _42"> </span>guarantees <span class="_"> </span>that <span class="_ _42"> </span>the <span class="_ _42"> </span>process <span class="_ _42"> </span>is <span class="_"> </span>a <span class="_ _42"> </span>session <span class="_"> </span>leader</span></span></div><div class="t m0 x76 hd6 y265c ff19 fs1b fc0 sc0 ls0 ws0">without <span class="_ _47"> </span>a <span class="_ _47"> </span>controlling <span class="_ _66"> </span>terminal.)<span class="_ _48"> </span>The <span class="_ _47"> </span>POSIX.1<span class="_ _59"> </span><span class="ff1a">O_NOCTTY<span class="_ _46"> </span></span>ﬂag <span class="_ _47"> </span>to<span class="_ _46"> </span><span class="ff1a">open<span class="_ _46"> </span></span>is <span class="_ _47"> </span>not <span class="_ _47"> </span>used <span class="_ _47"> </span>by</div><div class="t m0 x76 h38 y265d ff19 fs1b fc0 sc0 ls0 ws0">BSD</div><div class="t m0 x206 h38 y265e ff19 fs1b fc0 sc0 ls0 ws0">-</div><div class="t m0 xf6 h38 y265d ff19 fs1b fc0 sc0 ls0 ws0">based systems, except in compatibility-mode support for other systems.</div><div class="t m0 x76 h38 y265f ff19 fs1b fc0 sc0 ls0 ws0">Figur<span class="lsb2c">e9<span class="_ _b"></span><span class="ls0">.8 <span class="_ _23"> </span>summarizes <span class="_ _23"> </span>the <span class="_ _23"> </span>way <span class="_ _23"> </span>each <span class="_ _23"> </span>platform <span class="_ _23"> </span>discussed <span class="_ _23"> </span>in <span class="_ _23"> </span>this <span class="_ _23"> </span>book <span class="_ _23"> </span>allocates <span class="_ _23"> </span>a <span class="_ _23"> </span>controlling</span></span></div><div class="t m0 x76 h38 y2660 ff19 fs1b fc0 sc0 ls0 ws0">terminal. <span class="_ _66"> </span>Note<span class="_ _66"> </span>that <span class="_ _3"></span>although <span class="_ _9"></span>Mac <span class="_ _3"></span>OS <span class="_ _3"></span>X <span class="_ _9"></span>10.6.8 <span class="_ _3"></span>is <span class="_ _9"></span>derived <span class="_ _3"></span>from <span class="_ _3"></span>BSD, <span class="_ _3"></span>it <span class="_ _9"></span>behaves <span class="_ _3"></span>like <span class="_ _9"></span>System <span class="_ _3"></span>V</div><div class="t m0 x76 h38 y2661 ff19 fs1b fc0 sc0 ls0 ws0">when allocating a controlling terminal.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
