<div id="pf334" class="pf w4 h1f" data-page-no="334"><div class="pc pc334 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg334.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">786<span class="_ _1b"> </span><span class="ff19 ls30a">AD<span class="_ _55"></span><span class="ls0">atabase <span class="_"> </span>Library<span class="_ _245"> </span>Chapter <span class="_"> </span>20</span></span></div><div class="t m0 x3f h2a y12f ff19 fsf fc0 sc0 ls0 ws0">Figur<span class="ls1347">e2<span class="_ _4f"></span><span class="ls0">0.9 is <span class="_ _2"></span>a graph <span class="_ _2"></span>of the <span class="_ _2"></span>data from Figur<span class="lsd9b">e2<span class="_ _4f"></span><span class="ls0">0.8 <span class="_ _2"></span>for advisory <span class="_ _2"></span>ﬁne-grained <span class="_ _2"></span>locking.</span></span></span></span></div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls5f ws0">We <span class="_ _66"> </span>p<span class="_ _9"></span><span class="ls0">lot <span class="_ _9"></span>the <span class="_ _9"></span>clock <span class="_ _9"></span>time <span class="_ _9"></span>as <span class="_ _9"></span>the <span class="_ _9"></span>number <span class="_ _9"></span>of <span class="_ _9"></span>processes <span class="_ _9"></span>goes <span class="_ _9"></span>fr<span class="_ _0"></span>om <span class="_ _9"></span>1 <span class="_ _9"></span>to <span class="_ _9"></span>16.<span class="_ _5a"> </span><span class="ls5f">We <span class="_ _66"> </span>a<span class="_ _9"></span></span>lso <span class="_ _9"></span>plot <span class="_ _9"></span>the</span></div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">user <span class="_ _9"></span>CPU <span class="_ _9"></span>time <span class="_ _23"></span>divided <span class="_ _9"></span>by <span class="_ _9"></span>the <span class="_ _9"></span>number <span class="_ _23"></span>of <span class="_ _9"></span>processes <span class="_ _3"></span>and <span class="_ _23"></span>the <span class="_ _9"></span>system <span class="_ _9"></span>CPU <span class="_ _9"></span>time <span class="_ _23"></span>divided</div><div class="t m0 x32 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">by the number of processes.</div><div class="t m0 x10f h2d y58be ff19 fs10 fc0 sc0 ls0 ws0">#processes</div><div class="t m0 x6a h2d y58bf ff19 fs10 fc0 sc0 ls0 ws0">clock time</div><div class="t m0 xf2 h2d y58c0 ff19 fs10 fc0 sc0 ls0 ws0">(seconds)</div><div class="t m0 x11e h2d y58c1 ff19 fs10 fc0 sc0 ls0 ws0">sys CPU/#proc,</div><div class="t m0 x16b h2d y58c2 ff19 fs10 fc0 sc0 ls0 ws0">user CPU/#proc</div><div class="t m0 x1e6 h2d y58c3 ff19 fs10 fc0 sc0 ls0 ws0">(seconds)</div><div class="t m0 x1e5 h2e y58c4 ff19 fs11 fc0 sc0 ls0 ws0">1</div><div class="t m0 x25 h2f y58c5 ff19 fs12 fc0 sc0 ls0 ws0">2</div><div class="t m0 x26 h30 y58c6 ff19 fs13 fc0 sc0 ls0 ws0">3</div><div class="t m0 xa5 h31 y58c7 ff19 fs14 fc0 sc0 ls0 ws0">4</div><div class="t m0 x11b h32 y58c8 ff19 fs15 fc0 sc0 ls0 ws0">5</div><div class="t m0 xf h33 y58c9 ff19 fs16 fc0 sc0 ls0 ws0">6</div><div class="t m0 xb6 h83 y58ca ff19 fs36 fc0 sc0 ls0 ws0">7</div><div class="t m0 x1df h34 y58cb ff19 fs17 fc0 sc0 ls0 ws0">8</div><div class="t m0 x1b3 h35 y58cc ff19 fs18 fc0 sc0 ls0 ws0">9</div><div class="t m0 x8d h36 y58cd ff19 fs19 fc0 sc0 ls0 ws0">10</div><div class="t m0 x1eb h37 y58ce ff19 fs1a fc0 sc0 ls16fe ws0">11</div><div class="t m0 x80 h38 y58cf ff19 fs1b fc0 sc0 ls0 ws0">12</div><div class="t m0 x1a3 h39 y58d0 ff19 fs1c fc0 sc0 ls0 ws0">13</div><div class="t m0 x1da h88 y58d1 ff19 fs43 fc0 sc0 ls0 ws0">14</div><div class="t m0 x195 h3c y58d2 ff19 fs1e fc0 sc0 ls0 ws0">15</div><div class="t m0 x111 h3d y58d3 ff19 fs1f fc0 sc0 ls0 ws0">16</div><div class="t m0 x211 h3e y58d4 ff19 fs20 fc0 sc0 ls0 ws0">0</div><div class="t m0 x139 h3f y58d5 ff19 fs21 fc0 sc0 ls0 ws0">10</div><div class="t m0 x139 h40 y58d6 ff19 fs22 fc0 sc0 ls0 ws0">20</div><div class="t m0 x139 h41 y58d7 ff19 fs23 fc0 sc0 ls0 ws0">30</div><div class="t m0 x139 h42 y58d8 ff19 fs24 fc0 sc0 ls0 ws0">40</div><div class="t m0 x139 hf4 y58d9 ff19 fs85 fc0 sc0 ls0 ws0">50</div><div class="t m0 x139 h148 y58da ff19 fsa3 fc0 sc0 ls0 ws0">60</div><div class="t m0 x139 h149 y58db ff19 fsa4 fc0 sc0 ls0 ws0">70</div><div class="t m0 x139 hab y58dc ff19 fs57 fc0 sc0 ls0 ws0">80</div><div class="t m0 x23d h14b y58dd ff19 fsa5 fc0 sc0 ls0 ws0">0</div><div class="t m0 x23d heb y58de ff19 fs67 fc0 sc0 ls0 ws0">2</div><div class="t m0 x23d h181 y58df ff19 fsa6 fc0 sc0 ls0 ws0">4</div><div class="t m0 x10e h19d y58e0 ff19 fsc4 fc0 sc0 ls0 ws0">6</div><div class="t m0 x10e h18c y58e1 ff19 fscd fc0 sc0 ls0 ws0">8</div><div class="t m0 x10c h19e y58e2 ff19 fsd7 fc0 sc0 ls0 ws0">•</div><div class="t m0 x10c h19f y58e3 ff20 fscd fc0 sc0 ls0 ws0">∗</div><div class="t m0 x1e5 h1a0 y58e4 ff20 fsd8 fc0 sc0 ls0 ws0">Δ</div><div class="t m0 x4 h19e y58e5 ff19 fsd7 fc0 sc0 ls0 ws0">•</div><div class="t m0 x4 h19f y58e6 ff20 fscd fc0 sc0 ls0 ws0">∗</div><div class="t m0 x25 h1a0 y58e7 ff20 fsd8 fc0 sc0 ls0 ws0">Δ</div><div class="t m0 x18f h1a1 y58e8 ff19 fsd9 fc0 sc0 ls0 ws0">•</div><div class="t m0 x18f h1a2 y58e9 ff20 fs86 fc0 sc0 ls0 ws0">∗</div><div class="t m0 x26 h1a3 y58ea ff20 fsda fc0 sc0 ls0 ws0">Δ</div><div class="t m0 x1d2 h1a4 y58eb ff19 fsdb fc0 sc0 ls0 ws0">•</div><div class="t m0 x1d2 h1a5 y58ec ff20 fsc2 fc0 sc0 ls0 ws0">∗</div><div class="t m0 xa5 h1a6 y58ed ff20 fsdc fc0 sc0 ls0 ws0">Δ</div><div class="t m0 x5a h1a7 y58ee ff19 fsdd fc0 sc0 ls0 ws0">•</div><div class="t m0 x5a h1a8 y58ef ff20 fsd0 fc0 sc0 ls0 ws0">∗</div><div class="t m0 x11b h1a9 y58f0 ff20 fsde fc0 sc0 ls0 ws0">Δ</div><div class="t m0 x1b7 h1aa y58f1 ff19 fsdf fc0 sc0 ls0 ws0">•</div><div class="t m0 x1b7 h1ab y58f2 ff20 fscf fc0 sc0 ls0 ws0">∗</div><div class="t m0 xf h1ac y58f3 ff20 fse0 fc0 sc0 ls0 ws0">Δ</div><div class="t m0 x99 h1ad y58f4 ff19 fse1 fc0 sc0 ls0 ws0">•</div><div class="t m0 x99 h1ae y58f5 ff20 fsd1 fc0 sc0 ls0 ws0">∗</div><div class="t m0 xb6 h1af y58f6 ff20 fse2 fc0 sc0 ls0 ws0">Δ</div><div class="t m0 x9c h1b0 y58f7 ff19 fse3 fc0 sc0 ls0 ws0">•</div><div class="t m0 x9c h1b1 y58f8 ff20 fsd3 fc0 sc0 ls0 ws0">∗</div><div class="t m0 x1df h1b2 y58f9 ff20 fse4 fc0 sc0 ls0 ws0">Δ</div><div class="t m0 x114 h1b3 y58fa ff19 fse5 fc0 sc0 ls0 ws0">•</div><div class="t m0 x114 h1b4 y58fb ff20 fsc5 fc0 sc0 ls0 ws0">∗</div><div class="t m0 x114 h1b5 y58fc ff20 fse6 fc0 sc0 ls0 ws0">Δ</div><div class="t m0 xaf h1b6 y58fd ff19 fse7 fc0 sc0 ls0 ws0">•</div><div class="t m0 xaf h1b7 y58fe ff20 fsd4 fc0 sc0 ls0 ws0">∗</div><div class="t m0 xaf h1b8 y58ff ff20 fse8 fc0 sc0 ls0 ws0">Δ</div><div class="t m0 x173 h1b9 y5900 ff19 fse9 fc0 sc0 ls0 ws0">•</div><div class="t m0 x173 h1ba y5901 ff20 fsb3 fc0 sc0 ls0 ws0">∗</div><div class="t m0 x174 h1bb y5902 ff20 fsea fc0 sc0 ls0 ws0">Δ</div><div class="t m0 x6d h1bc y5903 ff19 fseb fc0 sc0 ls0 ws0">•</div><div class="t m0 x6d h1bd y5904 ff20 fsd5 fc0 sc0 ls0 ws0">∗</div><div class="t m0 xb4 h1be y5905 ff20 fsec fc0 sc0 ls0 ws0">Δ</div><div class="t m0 x23e h1bf y5906 ff19 fsed fc0 sc0 ls0 ws0">•</div><div class="t m0 x23e h1c0 y5907 ff20 fsee fc0 sc0 ls0 ws0">∗</div><div class="t m0 x100 h1c1 y5908 ff20 fsef fc0 sc0 ls0 ws0">Δ</div><div class="t m0 xc8 h1c2 y5909 ff19 fsf0 fc0 sc0 ls0 ws0">•</div><div class="t m0 xc8 h1c3 y590a ff20 fsf1 fc0 sc0 ls0 ws0">∗</div><div class="t m0 x170 h1c4 y590b ff20 fsf2 fc0 sc0 ls0 ws0">Δ</div><div class="t m0 xfd h1c5 y590c ff19 fsf3 fc0 sc0 ls0 ws0">•</div><div class="t m0 xfd h1c6 y590d ff20 fsf4 fc0 sc0 ls0 ws0">∗</div><div class="t m0 x158 h1c7 y590e ff20 fsf5 fc0 sc0 ls0 ws0">Δ</div><div class="t m0 x5f h1c8 y590f ff19 fsf6 fc0 sc0 ls0 ws0">•</div><div class="t m0 x23f h1c9 y5910 ff20 fsf7 fc0 sc0 ls0 ws0">∗</div><div class="t m0 x23f h1ca y5911 ff20 fsf8 fc0 sc0 ls0 ws0">Δ</div><div class="t m0 x1d3 h132 y5912 ff19 fsa8 fc0 sc0 ls0 ws0">user CPU/#proc</div><div class="t m0 x146 h132 y5913 ff19 fsa8 fc0 sc0 ls0 ws0">system CPU/#proc</div><div class="t m0 x8e h132 y5914 ff19 fsa8 fc0 sc0 ls0 ws0">clock time</div><div class="t m0 x125 h133 y5915 ff18 fsa9 fc0 sc0 ls0 ws0">Figure 20.9<span class="_ _5a"> </span><span class="ff19 ls16ff">Va<span class="_ _9"></span><span class="ls0">lues from Figur<span class="_ _0"></span><span class="ls1700">e2<span class="_ _84"></span><span class="ls0">0.8 for advisory ﬁne-grained locking</span></span></span></span></div><div class="t m0 x32 h135 y5916 ff19 fsaa fc0 sc0 ls0 ws0">Note <span class="_ _9"></span>that <span class="_ _9"></span>both <span class="_ _9"></span>CPU <span class="_ _9"></span>times, <span class="_ _9"></span>divided <span class="_ _9"></span>by <span class="_ _9"></span>the <span class="_ _9"></span>number <span class="_ _23"></span>of <span class="_ _9"></span>processes, <span class="_ _3"></span>ar<span class="ls1701">el<span class="_ _b"></span><span class="ls0">inear <span class="_ _9"></span>but <span class="_ _9"></span>that <span class="_ _9"></span>the</span></span></div><div class="t m0 x32 h135 y5917 ff19 fsaa fc0 sc0 ls0 ws0">plot <span class="_ _23"></span>of <span class="_ _23"></span>the <span class="_ _23"></span>clock <span class="_ _23"></span>time <span class="_ _23"></span>is <span class="_ _9"></span>nonlinear<span class="_ _1"></span><span class="ls1702">.T<span class="_ _26"></span><span class="ls0">he <span class="_ _23"></span>probable <span class="_ _9"></span>reason <span class="_ _23"></span>is <span class="_ _23"></span>the <span class="_ _23"></span>added <span class="_ _23"></span>amount <span class="_ _23"></span>of <span class="_ _23"></span>CPU</span></span></div><div class="t m0 x32 h135 y5918 ff19 fsaa fc0 sc0 ls0 ws0">time <span class="_"> </span>used <span class="_"> </span>by <span class="_ _66"> </span>the <span class="_ _66"> </span>operating <span class="_ _66"> </span>system <span class="_"> </span>to <span class="_ _66"> </span>switch <span class="_ _66"> </span>between <span class="_ _66"> </span>processes <span class="_"> </span>as <span class="_"> </span>the <span class="_ _66"> </span>number <span class="_ _66"> </span>of</div><div class="t m0 x32 h135 y5919 ff19 fsaa fc0 sc0 ls0 ws0">processes <span class="_ _23"></span>increases. <span class="_ _45"> </span>This<span class="_ _35"> </span>operating <span class="_ _42"> </span>system <span class="_ _23"> </span>overhead <span class="_ _23"> </span>would <span class="_ _23"> </span>show <span class="_ _42"> </span>up <span class="_ _23"> </span>as <span class="_ _42"> </span>an <span class="_ _23"></span>increased</div><div class="t m0 x32 h135 y591a ff19 fsaa fc0 sc0 ls0 ws0">clock time, but shouldn’t affect the CPU times of the individual pr<span class="_ _0"></span>ocesses.</div><div class="t m0 x12a h135 y591b ff19 fsaa fc0 sc0 ls0 ws0">The <span class="_ _3"></span>reason <span class="_ _9"></span>the <span class="_ _3"></span>user <span class="_ _9"></span>CPU <span class="_ _9"></span>time <span class="_ _9"></span>increases <span class="_ _3"></span>with <span class="_ _9"></span>the <span class="_ _3"></span>number <span class="_ _9"></span>of <span class="_ _9"></span>processes <span class="_ _3"></span>is <span class="_ _9"></span>that <span class="_ _9"></span>there</div><div class="t m0 x32 h135 y591c ff19 fsaa fc0 sc0 ls0 ws0">ar<span class="ls1703">em<span class="_ _55"></span><span class="ls0">or<span class="ls1703">er<span class="_ _4a"></span><span class="ls0">ecords <span class="_ _53"> </span>in <span class="_ _e"> </span>the <span class="_ _53"> </span>database.<span class="_ _48"> </span>Each <span class="_ _53"> </span>hash <span class="_ _e"> </span>chain <span class="_ _53"> </span>is <span class="_ _e"> </span>getting <span class="_ _e"> </span>longer<span class="_ _6"></span>,<span class="_ _4b"> </span>so<span class="_ _4b"> </span>it<span class="_ _4b"> </span>takes <span class="_ _e"> </span>the</span></span></span></span></div><div class="t m0 x32 h134 y591d ff1a fsaa fc0 sc0 ls0 ws0">_db_find_and_lock<span class="_ _80"> </span><span class="ff19">function longer<span class="_ _1"></span>,<span class="_"> </span>on<span class="_"> </span>average, to ﬁnd a recor<span class="_ _0"></span>d.</span></div><div class="t m0 x35 h1cb y591e ff16 fsf9 fc0 sc0 ls0 ws0">20.10 <span class="_ _66"> </span>Summary</div><div class="t m0 x32 h135 y591f ff19 fsaa fc0 sc0 ls0 ws0">This <span class="_ _53"> </span>chapter <span class="_ _e"> </span>has <span class="_ _53"> </span>taken <span class="_ _e"> </span>a <span class="_ _53"> </span>long <span class="_ _e"> </span>look <span class="_ _53"> </span>at <span class="_ _e"> </span>the <span class="_ _53"> </span>design <span class="_ _e"> </span>and <span class="_ _53"> </span>implementation <span class="_ _e"> </span>of <span class="_ _53"> </span>a <span class="_ _e"> </span>database</div><div class="t m0 x32 h135 y5920 ff19 fsaa fc0 sc0 ls0 ws0">library<span class="_ _4"></span><span class="ls1704">.A<span class="_ _1d"></span><span class="ls0">lthough <span class="_ _3"></span>we’ve <span class="_ _3"></span>kept <span class="_ _3"></span>the <span class="_ _3"></span>library <span class="_ _3"></span>small <span class="_ _3"></span>and <span class="_ _3"></span>simple <span class="_ _3"></span>for <span class="_ _3"></span>presentation <span class="_ _2"></span>purposes, <span class="_ _3"></span>it</span></span></div><div class="t m0 x32 h135 y5921 ff19 fsaa fc0 sc0 ls0 ws0">contains the recor<span class="_ _0"></span><span class="lsb5e">dl<span class="_ _d"></span><span class="ls0">ocking requir<span class="_ _0"></span>ed to allow concurrent access by multiple pr<span class="_ _1"></span>ocesses.</span></span></div><div class="t m0 x12a h135 y5922 ff19 fsaa fc0 sc0 ls1705 ws0">We<span class="_ _9"></span><span class="ls0">’ve <span class="_ _66"> </span>also <span class="_ _66"> </span>looked <span class="_ _66"> </span>at <span class="_ _66"> </span>the <span class="_ _66"> </span>performance <span class="_ _66"> </span>of <span class="_ _66"> </span>this <span class="_ _47"> </span>library <span class="_"> </span>with <span class="_ _66"> </span>various <span class="_ _66"> </span>numbers <span class="_ _66"> </span>of</span></div><div class="t m0 x32 h135 y5923 ff19 fsaa fc0 sc0 ls0 ws0">processes <span class="_ _e"> </span>using <span class="_"> </span>no <span class="_ _e"> </span>locking, <span class="_"> </span>advisory <span class="_ _e"> </span>locking <span class="_"> </span>(ﬁne-grained <span class="_ _e"> </span>and <span class="_"> </span>coarse-grained), <span class="_ _e"> </span>and</div><div class="t m0 x32 h135 y5924 ff19 fsaa fc0 sc0 ls0 ws0">mandatory <span class="_ _3"></span>locking.<span class="_ _16"> </span><span class="ls1706">Wi<span class="_ _3"></span></span>th <span class="_ _3"></span>a <span class="_ _3"></span>single <span class="_ _3"></span>process, <span class="_ _3"></span>we <span class="_ _3"></span>saw <span class="_ _3"></span>that <span class="_ _3"></span>advisory <span class="_ _3"></span>locking <span class="_ _3"></span>adds <span class="_ _9"></span>between</div><a class="l" href="#pf13" data-dest-detail='[19,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.907742px;bottom:294.680395px;width:90.810501px;height:19.681000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
