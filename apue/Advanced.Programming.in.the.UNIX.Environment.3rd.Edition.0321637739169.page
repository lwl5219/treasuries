<div id="pfa9" class="pf w4 h1f" data-page-no="a9"><div class="pc pca9 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bga9.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h7a ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>4.23<span class="_ _1c0"> </span><span class="ff1a">chdir</span>,<span class="_ _4b"> </span><span class="ff1a">fchdir</span><span class="ls30a">,a<span class="_ _55"></span><span class="ls0">nd<span class="_ _4b"> </span><span class="ff1a">getcwd<span class="_ _4b"> </span></span>Functions<span class="_ _1b"> </span><span class="ff18">135</span></span></span></div><div class="t m0 x3f h26 y12f ff19 fsf fc0 sc0 ls5f ws0">To <span class="_ _e"> </span>i<span class="_ _23"></span><span class="ls0">llustrate <span class="_ _2"></span>the<span class="_ _47"> </span><span class="ff1a">ftw<span class="_ _47"> </span></span>and<span class="_ _66"> </span><span class="ff1a">nftw<span class="_ _47"> </span></span>functions, <span class="_ _2"></span>we <span class="_ _3"></span>have <span class="_ _3"></span>provided <span class="_ _2"></span>mor<span class="ls5d2">eg<span class="_ _8"></span><span class="ls0">enerality <span class="_ _2"></span>in <span class="_ _3"></span>this</span></span></span></div><div class="t m0 x32 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">program <span class="_ _66"> </span>than <span class="_ _47"> </span>needed.<span class="_ _5f"> </span>For <span class="_ _47"> </span>example, <span class="_ _47"> </span>the <span class="_ _47"> </span>function<span class="_ _16"> </span><span class="ff1a">myfunc<span class="_ _16"> </span></span>always <span class="_ _47"> </span>returns <span class="_ _47"> </span>0, <span class="_ _47"> </span>even</div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">though the function that calls it is prepar<span class="_ _0"></span>ed to handle a nonzer<span class="_ _0"></span><span class="ls44">or<span class="_ _4f"></span><span class="ls0">eturn.</span></span></div><div class="t m0 x3f h49 y1355 ff19 fs26 fc0 sc0 ls0 ws0">For <span class="_"> </span>additional <span class="_"> </span>information <span class="_ _e"> </span>on <span class="_"> </span>descending <span class="_"> </span>thr<span class="_ _0"></span>ough <span class="_"> </span>a <span class="_"> </span>ﬁle <span class="_ _e"> </span>system <span class="_"> </span>and <span class="_"> </span>using <span class="_"> </span>this</div><div class="t m0 x32 h4d y1356 ff19 fs26 fc0 sc0 ls0 ws0">technique <span class="_ _44"> </span>in <span class="_ _44"> </span>many <span class="_ _44"> </span>standar<span class="ls5d3">dU<span class="_ _52"></span><span class="ls0">NIX <span class="_ _35"> </span>System <span class="_ _44"> </span>commands<span class="_ _9"></span>—<span class="_ _9"></span><span class="ff1a">find</span>,<span class="_ _65"> </span><span class="ff1a">ls</span>,<span class="_ _54"> </span><span class="ff1a">tar</span><span class="ls5d4">,a<span class="_ _52"></span><span class="ls0">nd <span class="_ _44"> </span>so</span></span></span></span></div><div class="t m0 x32 h49 y1357 ff19 fs26 fc0 sc0 ls0 ws0">on <span class="_ _a"></span>— <span class="_ _a"></span>refer to Fowler<span class="_ _6"></span><span class="lsd3">,K<span class="_ _5"></span><span class="ls0">orn, and V<span class="_ _4"></span>o</span></span></div><div class="t m0 xed h49 y1358 ff19 fs26 fc0 sc0 ls0 ws0">[</div><div class="t m0 xd h49 y1357 ff19 fs26 fc0 sc0 ls0 ws0">1989</div><div class="t m0 x6c h49 y1358 ff19 fs26 fc0 sc0 ls0 ws0">]</div><div class="t m0 x154 h49 y1357 ff19 fs26 fc0 sc0 ls0 ws0">.</div><div class="t m0 x35 h7b y1359 ff16 fs27 fc0 sc0 ls0 ws0">4.23<span class="_ _6d"> </span><span class="ff1f">chdir</span>,<span class="_ _54"> </span><span class="ff1f">fchdir</span><span class="ls5d5">,a<span class="_ _52"></span><span class="ls0">nd<span class="_ _54"> </span><span class="ff1f">getcwd<span class="_ _54"> </span></span>Functions</span></span></div><div class="t m0 x32 h49 y135a ff19 fs26 fc0 sc0 ls0 ws0">Every process has <span class="_ _2"></span>a <span class="_ _2"></span>current working <span class="_ _2"></span>directory<span class="_ _4"></span><span class="ls5d6">.T<span class="_ _5b"></span><span class="ls0">his <span class="_ _2"></span>directory is wher<span class="ls5d7">et<span class="_ _4f"></span><span class="ls0">he <span class="_ _2"></span>search for <span class="_ _2"></span>all</span></span></span></span></div><div class="t m0 x32 h49 y135b ff19 fs26 fc0 sc0 lscc ws0">re<span class="ls0">lative pathnames starts <span class="_ _2"></span>(i.e., with all pathnames that do not begin with <span class="_ _2"></span>a slash).<span class="_ _46"> </span>When</span></div><div class="t m0 x32 h49 y135c ff19 fs26 fc0 sc0 ls5d8 ws0">au<span class="_ _43"></span><span class="ls0">ser <span class="_ _23"> </span>logs <span class="_ _23"> </span>in <span class="_ _23"> </span>to <span class="_ _23"> </span>a <span class="_ _23"> </span>UNIX <span class="_ _23"> </span>system, <span class="_ _23"> </span>the <span class="_ _23"> </span>current <span class="_ _23"></span>working <span class="_ _23"></span>directory <span class="_ _9"></span>normally <span class="_ _23"> </span>starts <span class="_ _23"> </span>at <span class="_ _23"> </span>the</span></div><div class="t m0 x32 h4d y135d ff19 fs26 fc0 sc0 ls0 ws0">directory <span class="_ _47"> </span>speciﬁed <span class="_ _45"> </span>by <span class="_ _45"> </span>the <span class="_ _45"> </span>sixth <span class="_ _45"> </span>ﬁeld <span class="_ _45"> </span>in <span class="_ _45"> </span>the<span class="_ _5a"> </span><span class="ff1a">/etc/passwd<span class="_"> </span></span>ﬁle <span class="_ _a"></span>— <span class="_ _a"></span>the<span class="_ _5a"> </span>user <span class="_ _a"></span>’s<span class="_ _5a"> </span>home</div><div class="t m0 x32 h49 y135e ff19 fs26 fc0 sc0 ls0 ws0">directory<span class="_ _4"></span><span class="ls5d9">.T<span class="_ _5b"></span><span class="ls0">he <span class="_ _2"></span>current working directory is <span class="_ _2"></span>an <span class="_ _2"></span>attribute <span class="_ _2"></span>of a <span class="_ _2"></span>process; the <span class="_ _2"></span>home <span class="_ _2"></span>directory</span></span></div><div class="t m0 x32 h49 y135f ff19 fs26 fc0 sc0 ls0 ws0">is an attribute of a login name.</div><div class="t m0 x3f h49 y1360 ff19 fs26 fc0 sc0 ls164 ws0">We <span class="_ _47"> </span>c<span class="_ _9"></span><span class="ls0">an <span class="_ _23"> </span>change <span class="_ _23"> </span>the <span class="_ _23"> </span>current <span class="_ _23"></span>working <span class="_ _23"></span>dir<span class="_ _0"></span>ectory <span class="_ _23"></span>of <span class="_ _23"></span>the <span class="_ _23"></span>calling <span class="_ _23"></span>process <span class="_ _9"></span>by <span class="_ _23"> </span>calling <span class="_ _23"> </span>the</span></div><div class="t m0 x32 h4d y1361 ff1a fs26 fc0 sc0 ls0 ws0">chdir<span class="_ _80"> </span><span class="ff19">or<span class="_"> </span></span>fchdir<span class="_ _66"> </span><span class="ff19">function.</span></div><div class="t m0 x3f h4e y1362 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;unistd.h&gt;</div><div class="t m0 x3f h4e y1363 ff1a fs28 fc0 sc0 ls0 ws0">int chdir(const char *<span class="ff1b">pathname</span>);</div><div class="t m0 x3f h4e y1364 ff1a fs28 fc0 sc0 ls0 ws0">int fchdir(int<span class="_"> </span><span class="ff1b">fd</span>);</div><div class="t m0 x1af h7c y1365 ff19 fs28 fc0 sc0 ls0 ws0">Both return: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>err<span class="_ _0"></span>or</div><div class="t m0 x32 h60 y1366 ff19 fs2c fc0 sc0 ls155 ws0">We <span class="_ _47"> </span>c<span class="_ _9"></span><span class="ls0">an <span class="_ _23"> </span>specify <span class="_ _23"> </span>the <span class="_ _23"> </span>new <span class="_ _23"> </span>current <span class="_ _23"></span>working <span class="_ _23"></span>dir<span class="_ _0"></span>ectory <span class="_ _23"></span>either <span class="_ _23"></span>as <span class="_ _23"></span>a<span class="_ _35"> </span><span class="ff1b">pathname<span class="_ _45"> </span></span>or <span class="_ _23"> </span>through <span class="_ _23"></span>an</span></div><div class="t m0 x32 h55 y1367 ff19 fs2c fc0 sc0 ls0 ws0">open ﬁle descriptor<span class="_ _6"></span>.</div><div class="t m0 x35 h61 y1368 ff16 fs2c fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h55 y1369 ff19 fs2c fc0 sc0 ls0 ws0">Because <span class="_"> </span>it <span class="_"> </span>is <span class="_"> </span>an <span class="_"> </span>attribute <span class="_"> </span>of <span class="_ _66"> </span>a <span class="_"> </span>process, <span class="_"> </span>the <span class="_"> </span>current <span class="_"> </span>working <span class="_"> </span>directory <span class="_"> </span>cannot <span class="_"> </span>affect</div><div class="t m0 x32 h54 y136a ff19 fs2c fc0 sc0 ls0 ws0">processes <span class="_ _59"> </span>that <span class="_ _59"> </span>invoke <span class="_ _46"> </span>the <span class="_ _46"> </span>process <span class="_ _59"> </span>that <span class="_ _59"> </span>executes <span class="_ _46"> </span>the<span class="_ _60"> </span><span class="ff1a">chdir</span><span class="ls5da">.(<span class="_ _4e"></span><span class="ls155">We <span class="_ _65"> </span>d<span class="_ _9"></span><span class="ls0">escribe <span class="_ _46"> </span>the</span></span></span></div><div class="t m0 x32 h55 y136b ff19 fs2c fc0 sc0 ls150 ws0">re<span class="ls0">lationship <span class="_ _2"></span>between <span class="_ _2"></span>processes in mor<span class="ls5db">ed<span class="_ _4f"></span><span class="ls0">etail <span class="_ _2"></span>in <span class="_ _2"></span>Chapter 8.)<span class="_ _61"> </span>As <span class="_ _2"></span>a result, the <span class="_ _2"></span>program in</span></span></span></div><div class="t m0 x32 h55 y136c ff19 fs2c fc0 sc0 ls0 ws0">Figur<span class="ls142">e4<span class="_ _4f"></span><span class="ls0">.23 doesn’t do what we might expect.</span></span></div><div class="t m0 x32 h62 y136d ff1a fs30 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h62 y136e ff1a fs30 fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h62 y136f ff1a fs30 fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 x32 h62 y1370 ff1a fs30 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h62 y1371 ff1a fs30 fc0 sc0 ls0 ws0">if (chdir(&quot;/tmp&quot;) &lt; 0)</div><div class="t m0 x9d h62 y1372 ff1a fs30 fc0 sc0 ls0 ws0">err_sys(&quot;chdir failed&quot;);</div><div class="t m0 x8a h62 y1373 ff1a fs30 fc0 sc0 ls0 ws0">printf(&quot;chdir to /tmp succeeded\n&quot;);</div><div class="t m0 x8a h62 y1374 ff1a fs30 fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h62 y1375 ff1a fs30 fc0 sc0 ls0 ws0">}</div><div class="t m0 x9e h63 y1376 ff18 fs13 fc0 sc0 ls0 ws0">Figure 4.23<span class="_ _5a"> </span><span class="ff19">Example of<span class="_"> </span><span class="ff1a">chdir<span class="_ _e"> </span></span>function</span></div><a class="l" href="#pfd" data-dest-detail='[13,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.894092px;bottom:1004.451043px;width:270.431992px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
