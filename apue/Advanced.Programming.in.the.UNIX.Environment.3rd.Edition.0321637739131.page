<div id="pf83" class="pf w4 h1f" data-page-no="83"><div class="pc pc83 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg83.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>4.3<span class="_ _183"> </span>File <span class="_"> </span>T<span class="_ _6"></span>ypes<span class="_ _1b"> </span><span class="ff18">97</span></div><div class="t m0 x1f h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">ptr = &quot;directory&quot;;</div><div class="t m0 x9d h57 y426 ff1a fs2d fc0 sc0 ls0 ws0">else if (S_ISCHR(buf.st_mode))</div><div class="t m0 x1f h57 y800 ff1a fs2d fc0 sc0 ls0 ws0">ptr = &quot;character special&quot;;</div><div class="t m0 x9d h57 y801 ff1a fs2d fc0 sc0 ls0 ws0">else if (S_ISBLK(buf.st_mode))</div><div class="t m0 x1f h57 y802 ff1a fs2d fc0 sc0 ls0 ws0">ptr = &quot;block special&quot;;</div><div class="t m0 x9d h57 y803 ff1a fs2d fc0 sc0 ls0 ws0">else if (S_ISFIFO(buf.st_mode))</div><div class="t m0 x1f h57 y804 ff1a fs2d fc0 sc0 ls0 ws0">ptr = &quot;fifo&quot;;</div><div class="t m0 x9d h57 y805 ff1a fs2d fc0 sc0 ls0 ws0">else if (S_ISLNK(buf.st_mode))</div><div class="t m0 x1f h57 y806 ff1a fs2d fc0 sc0 ls0 ws0">ptr = &quot;symbolic link&quot;;</div><div class="t m0 x9d h57 y807 ff1a fs2d fc0 sc0 ls0 ws0">else if (S_ISSOCK(buf.st_mode))</div><div class="t m0 x1f h57 y808 ff1a fs2d fc0 sc0 ls0 ws0">ptr = &quot;socket&quot;;</div><div class="t m0 x9d h57 y809 ff1a fs2d fc0 sc0 ls0 ws0">else</div><div class="t m0 x1f h57 y80a ff1a fs2d fc0 sc0 ls0 ws0">ptr = &quot;** unknown mode **&quot;;</div><div class="t m0 x9d h57 y80b ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;%s\n&quot;, ptr);</div><div class="t m0 x8a h57 y80c ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y80d ff1a fs2d fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h57 y80e ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x180 h2d ye4d ff18 fs10 fc0 sc0 ls0 ws0">Figure 4.3<span class="_ _5a"> </span><span class="ff19">Print type of ﬁle for each command</span></div><div class="t m0 x181 h2d ye4e ff19 fs10 fc0 sc0 ls0 ws0">-</div><div class="t m0 xa3 h2d ye4d ff19 fs10 fc0 sc0 ls0 ws0">line argument</div><div class="t m0 x32 h49 y38e ff19 fs26 fc0 sc0 ls0 ws0">Sample output from Figur<span class="_ _0"></span><span class="lsd3">e4<span class="_ _d"></span><span class="ls0">.3 is</span></span></div><div class="t m0 x3f h4e ye4f ff1a fs28 fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">./a.out /etc/passwd /etc /dev/log /dev/tty \</span></div><div class="t m0 x3f h4e ye50 ff1a fs28 fc0 sc0 ls0 ws0">&gt;<span class="_"> </span><span class="ff1f">/var/lib/oprofile/opd_pipe /dev/sr0 /dev/cdrom</span></div><div class="t m0 x3f h4e ye51 ff1a fs28 fc0 sc0 ls0 ws0">/etc/passwd: regular</div><div class="t m0 x3f h4e ye52 ff1a fs28 fc0 sc0 ls0 ws0">/etc: directory</div><div class="t m0 x3f h4e ye53 ff1a fs28 fc0 sc0 ls0 ws0">/dev/log: socket</div><div class="t m0 x3f h4e ye54 ff1a fs28 fc0 sc0 ls0 ws0">/dev/tty: character special</div><div class="t m0 x3f h4e ye55 ff1a fs28 fc0 sc0 ls0 ws0">/var/lib/oprofile/opd_pipe: fifo</div><div class="t m0 x3f h4e ye56 ff1a fs28 fc0 sc0 ls0 ws0">/dev/sr0: block special</div><div class="t m0 x3f h4e ye57 ff1a fs28 fc0 sc0 ls0 ws0">/dev/cdrom: symbolic link</div><div class="t m0 x32 h49 ye58 ff19 fs26 fc0 sc0 ls0 ws0">(Here, <span class="_ _53"> </span>we <span class="_ _e"> </span>have <span class="_ _e"> </span>explicitly <span class="_ _e"> </span>entered <span class="_ _53"> </span>a <span class="_ _e"> </span>backslash <span class="_ _e"> </span>at <span class="_ _e"> </span>the <span class="_ _e"> </span>end <span class="_ _e"> </span>of <span class="_ _e"> </span>the <span class="_ _e"> </span>ﬁrst <span class="_ _e"> </span>command <span class="_ _e"> </span>line,</div><div class="t m0 x32 h49 ye59 ff19 fs26 fc0 sc0 ls0 ws0">telling <span class="_ _9"></span>the <span class="_ _9"></span>shell <span class="_ _23"></span>that <span class="_ _9"></span>we <span class="_ _9"></span>want <span class="_ _23"></span>to <span class="_ _9"></span>continue <span class="_ _9"></span>entering <span class="_ _23"></span>the <span class="_ _9"></span>command <span class="_ _9"></span>on <span class="_ _23"></span>another <span class="_ _9"></span>line.<span class="_ _5a"> </span>The</div><div class="t m0 x32 h4d ye5a ff19 fs26 fc0 sc0 ls0 ws0">shell <span class="_"> </span>then <span class="_"> </span>prompted <span class="_"> </span>us <span class="_"> </span>with <span class="_"> </span>its <span class="_"> </span>secondary <span class="_"> </span>prompt,<span class="_ _59"> </span><span class="ff1a">&gt;</span>,<span class="_ _46"> </span>on<span class="_ _46"> </span>the <span class="_"> </span>next <span class="_ _66"> </span>line.)<span class="_ _60"> </span><span class="ls164">We <span class="_ _4b"> </span>h<span class="_ _9"></span></span>ave</div><div class="t m0 x32 h4d ye5b ff19 fs26 fc0 sc0 ls0 ws0">speciﬁcally <span class="_ _42"> </span>used <span class="_ _23"> </span>the<span class="_ _44"> </span><span class="ff1a">lstat<span class="_ _35"> </span></span>function <span class="_ _42"> </span>instead <span class="_ _42"> </span>of <span class="_ _23"> </span>the<span class="_ _44"> </span><span class="ff1a">stat<span class="_ _35"> </span></span>function <span class="_ _42"> </span>to <span class="_ _42"> </span>detect <span class="_ _42"> </span>symbolic</div><div class="t m0 x32 h4d ye5c ff19 fs26 fc0 sc0 ls0 ws0">links. <span class="_"> </span>If<span class="_"> </span>we used the<span class="_"> </span><span class="ff1a">stat<span class="_ _80"> </span></span>function, we would never see symbolic links.</div><div class="t m0 x3f h54 ye5d ff19 fs2c fc0 sc0 ls0 ws0">Historically<span class="_ _4"></span><span class="ls48e">,e<span class="_ _26"></span><span class="ls0">arly <span class="_ _35"> </span>versions <span class="_ _45"> </span>of <span class="_ _35"> </span>the <span class="_ _45"> </span>UNIX <span class="_ _35"> </span>System <span class="_ _35"> </span>didn’t <span class="_ _45"> </span>provide <span class="_ _45"> </span>the<span class="_ _51"> </span><span class="ff1a">S_ISxxx</span></span></span></div><div class="t m0 x32 h54 ye5e ff19 fs2c fc0 sc0 ls0 ws0">macros. <span class="_ _47"> </span>Instead,<span class="_ _45"> </span>we <span class="_ _9"></span>had <span class="_ _9"></span>to <span class="_ _23"></span>logically <span class="_ _3"></span>AND <span class="_ _23"></span>the<span class="_ _45"> </span><span class="ff1a">st_mode<span class="_ _45"> </span></span>value <span class="_ _3"></span>with <span class="_ _9"></span>the <span class="_ _23"></span>mask<span class="_ _45"> </span><span class="ff1a">S_IFMT</span></div><div class="t m0 x32 h54 ye5f ff19 fs2c fc0 sc0 ls0 ws0">and <span class="_"> </span>then <span class="_"> </span>compar<span class="ls48f">et<span class="_ _5b"></span><span class="ls0">he <span class="_"> </span>result <span class="_"> </span>with <span class="_"> </span>the <span class="_"> </span>constants <span class="_"> </span>whose <span class="_"> </span>names <span class="_"> </span>are<span class="_ _59"> </span><span class="ff1a">S_IFxxx</span><span class="ls490">.M<span class="_ _5d"></span><span class="ls0">ost</span></span></span></span></div><div class="t m0 x32 h54 ye60 ff19 fs2c fc0 sc0 ls0 ws0">systems <span class="_ _23"> </span>deﬁne <span class="_ _42"> </span>this <span class="_ _42"> </span>mask <span class="_ _42"> </span>and <span class="_ _23"> </span>the <span class="_ _42"> </span>related <span class="_ _23"> </span>constants <span class="_ _42"> </span>in <span class="_ _42"> </span>the <span class="_ _23"> </span>ﬁle<span class="_ _44"> </span><span class="ff1a">&lt;sys/stat.h&gt;</span><span class="ls491">.I<span class="_ _7"></span><span class="ls492">fw<span class="_ _43"></span><span class="ls0">e</span></span></span></div><div class="t m0 x32 h54 ye61 ff19 fs2c fc0 sc0 ls0 ws0">examine this ﬁle, we’ll ﬁnd the<span class="_"> </span><span class="ff1a">S_ISDIR<span class="_ _80"> </span></span>macr<span class="ls142">od<span class="_ _d"></span><span class="ls0">eﬁned something like</span></span></div><div class="t m0 x3f h5d ye62 ff1a fs2f fc0 sc0 ls0 ws0">#define <span class="_"> </span>S_ISDIR(mode) <span class="_"> </span>(((mode)<span class="_"> </span><span class="ls395">&amp;S<span class="_ _1d"></span><span class="ls0">_IFMT) == S_IFDIR)</span></span></div><div class="t m0 x3f h55 ye63 ff19 fs2c fc0 sc0 ls155 ws0">We<span class="_ _9"></span><span class="ls0">’ve <span class="_"> </span>said <span class="_"> </span>that <span class="_"> </span>regular <span class="_"> </span>ﬁles <span class="_"> </span>ar<span class="ls493">ep<span class="_ _5b"></span><span class="ls150">re<span class="_ _2"></span><span class="ls0">dominant, <span class="_"> </span>but <span class="_"> </span>it <span class="_"> </span>is <span class="_"> </span>interesting <span class="_"> </span>to <span class="_"> </span>see <span class="_"> </span>what</span></span></span></span></div><div class="t m0 x32 h55 ye64 ff19 fs2c fc0 sc0 ls0 ws0">percentage <span class="_ _23"> </span>of <span class="_ _42"> </span>the <span class="_ _53"> </span>ﬁles <span class="_ _42"> </span>on <span class="_ _42"> </span>a <span class="_ _42"> </span>given <span class="_ _42"> </span>system <span class="_ _42"> </span>are<span class="_ _44"> </span>of<span class="_ _44"> </span>each <span class="_ _42"> </span>ﬁle <span class="_ _42"> </span>type.<span class="_ _54"> </span>Figur<span class="ls494">e4<span class="_ _c"></span><span class="ls0">.4 <span class="_ _42"> </span>shows <span class="_ _42"> </span>the</span></span></div><div class="t m0 x32 h55 ye65 ff19 fs2c fc0 sc0 ls0 ws0">counts <span class="_ _42"> </span>and <span class="_ _42"> </span>percentages <span class="_ _23"> </span>for <span class="_ _42"> </span>a <span class="_ _42"> </span>Linux <span class="_ _42"> </span>system <span class="_ _42"> </span>that <span class="_ _42"> </span>is <span class="_ _42"> </span>used <span class="_ _42"> </span>as <span class="_ _42"> </span>a <span class="_ _42"> </span>single-user <span class="_ _42"> </span>workstation.</div><div class="t m0 x32 h55 ye66 ff19 fs2c fc0 sc0 ls0 ws0">This data was obtained from the pr<span class="_ _0"></span>ogram shown in Section 4.22.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
