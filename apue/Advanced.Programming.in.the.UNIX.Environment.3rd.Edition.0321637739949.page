<div id="pf3b5" class="pf w4 h1f" data-page-no="3b5"><div class="pc pc3b5 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg3b5.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Appendix <span class="_"> </span>C<span class="_ _322"> </span>Chapter <span class="_"> </span>5<span class="_ _54"> </span>Solutions<span class="_ _1b"> </span><span class="ff18">915</span></div><div class="t m0 x206 h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">ms-&gt;vsize = size;</div><div class="t m0 xc4 h57 y426 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 xc4 h57 y800 ff1a fs2d fc0 sc0 ls0 ws0">fp = funopen(ms, mstream_read, mstream_write,</div><div class="t m0 x1b0 h57 y801 ff1a fs2d fc0 sc0 ls0 ws0">mstream_seek, mstream_close);</div><div class="t m0 xc4 h57 y802 ff1a fs2d fc0 sc0 ls0 ws0">if (fp == NULL) {</div><div class="t m0 x206 h57 y803 ff1a fs2d fc0 sc0 ls0 ws0">if (ms-&gt;flags &amp; MS_MYBUF)</div><div class="t m0 xe9 h57 y804 ff1a fs2d fc0 sc0 ls0 ws0">free(ms-&gt;buf);</div><div class="t m0 x206 h57 y805 ff1a fs2d fc0 sc0 ls0 ws0">free(ms);</div><div class="t m0 xc4 h57 y806 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 xc4 h57 y807 ff1a fs2d fc0 sc0 ls0 ws0">return(fp);</div><div class="t m0 x215 h57 y808 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x215 h57 y31b7 ff1a fs2d fc0 sc0 ls0 ws0">static int</div><div class="t m0 x215 h57 y31b8 ff1a fs2d fc0 sc0 ls0 ws0">type_to_flags(const char *__restrict type)</div><div class="t m0 x215 h57 y31b9 ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 xc4 h57 y31ba ff1a fs2d fc0 sc0 ls0 ws0">const char *cp;</div><div class="t m0 xc4 h57 y31bb ff1a fs2d fc0 sc0 ls0 ws0">int flags = 0;</div><div class="t m0 xc4 h57 y1315 ff1a fs2d fc0 sc0 ls0 ws0">for (cp = type; *cp != 0; cp++) {</div><div class="t m0 x206 h57 y351c ff1a fs2d fc0 sc0 ls0 ws0">switch (*cp) {</div><div class="t m0 x206 h57 y351d ff1a fs2d fc0 sc0 ls0 ws0">case ’r’:</div><div class="t m0 xe9 h57 y351e ff1a fs2d fc0 sc0 ls0 ws0">if (flags != 0)</div><div class="t m0 xa6 h57 y351f ff1a fs2d fc0 sc0 ls0 ws0">return(0); <span class="_"> </span>/*<span class="_"> </span>error */</div><div class="t m0 xe9 h57 y3520 ff1a fs2d fc0 sc0 ls0 ws0">flags |= MS_READ;</div><div class="t m0 xe9 h57 y42b2 ff1a fs2d fc0 sc0 ls0 ws0">break;</div><div class="t m0 x206 h57 y131c ff1a fs2d fc0 sc0 ls0 ws0">case ’w’:</div><div class="t m0 xe9 h57 y131d ff1a fs2d fc0 sc0 ls0 ws0">if (flags != 0)</div><div class="t m0 xa6 h57 y131e ff1a fs2d fc0 sc0 ls0 ws0">return(0); <span class="_"> </span>/*<span class="_"> </span>error */</div><div class="t m0 xe9 h57 y131f ff1a fs2d fc0 sc0 ls0 ws0">flags |= MS_WRITE|MS_TRUNCATE;</div><div class="t m0 xe9 h57 y1320 ff1a fs2d fc0 sc0 ls0 ws0">break;</div><div class="t m0 x206 h57 y1346 ff1a fs2d fc0 sc0 ls0 ws0">case ’a’:</div><div class="t m0 xe9 h57 y1347 ff1a fs2d fc0 sc0 ls0 ws0">if (flags != 0)</div><div class="t m0 xa6 h57 y1323 ff1a fs2d fc0 sc0 ls0 ws0">return(0); <span class="_"> </span>/*<span class="_"> </span>error */</div><div class="t m0 xe9 h57 y1324 ff1a fs2d fc0 sc0 ls0 ws0">flags |= MS_APPEND;</div><div class="t m0 xe9 h57 y1325 ff1a fs2d fc0 sc0 ls0 ws0">break;</div><div class="t m0 x206 h57 y23f2 ff1a fs2d fc0 sc0 ls0 ws0">case ’+’:</div><div class="t m0 xe9 h57 y1327 ff1a fs2d fc0 sc0 ls0 ws0">if (flags == 0)</div><div class="t m0 xa6 h57 y1328 ff1a fs2d fc0 sc0 ls0 ws0">return(0); <span class="_"> </span>/*<span class="_"> </span>error */</div><div class="t m0 xe9 h57 y1329 ff1a fs2d fc0 sc0 ls0 ws0">flags |= MS_READ|MS_WRITE;</div><div class="t m0 xe9 h57 y132a ff1a fs2d fc0 sc0 ls0 ws0">break;</div><div class="t m0 x206 h57 y170d ff1a fs2d fc0 sc0 ls0 ws0">case ’b’:</div><div class="t m0 xe9 h57 y3acc ff1a fs2d fc0 sc0 ls0 ws0">if (flags == 0)</div><div class="t m0 xa6 h57 y132d ff1a fs2d fc0 sc0 ls0 ws0">return(0); <span class="_"> </span>/*<span class="_"> </span>error */</div><div class="t m0 xe9 h57 y132e ff1a fs2d fc0 sc0 ls0 ws0">break;</div><div class="t m0 x206 h57 y3518 ff1a fs2d fc0 sc0 ls0 ws0">default:</div><div class="t m0 xe9 h57 y3519 ff1a fs2d fc0 sc0 ls0 ws0">return(0); <span class="_ _8a"> </span>/*<span class="_"> </span>error */</div><div class="t m0 x206 h57 y351a ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 xc4 h57 y351b ff1a fs2d fc0 sc0 ls0 ws0">}</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
