<div id="pf2de" class="pf w4 h1f" data-page-no="2de"><div class="pc pc2de w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg2de.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">700<span class="_ _1b"> </span><span class="ff19 ls719">Te<span class="_ _9"></span><span class="ls0">rminal <span class="_"> </span>I/O<span class="_ _eb"> </span>Chapter <span class="_"> </span>18</span></span></div><div class="t m0 x32 h2a y12f ff19 fsf fc0 sc0 ls0 ws0">Running the program fr<span class="_ _0"></span>om Figur<span class="_ _0"></span><span class="ls44">e1<span class="_ _d"></span><span class="ls0">8.16 gives us</span></span></div><div class="t m0 x3f h57 ya9b ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">./a.out &lt; /dev/console 2&gt; /dev/null</span></div><div class="t m0 x3f h57 yac1 ff1a fs2d fc0 sc0 ls0 ws0">fd 0: /dev/console</div><div class="t m0 x3f h57 yac2 ff1a fs2d fc0 sc0 ls0 ws0">fd 1: /dev/ttys001</div><div class="t m0 x3f h57 yac3 ff1a fs2d fc0 sc0 ls0 ws0">fd 2: not a tty</div><div class="t m0 x35 h4b y5154 ff16 fs27 fc0 sc0 ls0 ws0">18.10 <span class="_ _66"> </span>Canonical<span class="_ _54"> </span>Mode</div><div class="t m0 x32 h49 y4113 ff19 fs26 fc0 sc0 ls0 ws0">Canonical <span class="_ _2"></span>mode <span class="_ _3"></span>is <span class="_ _3"></span>simple: <span class="_ _3"></span>we <span class="_ _3"></span>issue <span class="_ _3"></span>a <span class="_ _3"></span>read, <span class="_ _2"></span>and <span class="_ _3"></span>the <span class="_ _2"></span>terminal <span class="_ _3"></span>driver <span class="_ _3"></span>returns <span class="_ _2"></span>when <span class="_ _3"></span>a <span class="_ _3"></span>line</div><div class="t m0 x32 h49 y4114 ff19 fs26 fc0 sc0 ls0 ws0">has been entered. <span class="_"> </span>Several<span class="_"> </span>conditions cause the r<span class="_ _0"></span>ead to r<span class="_ _0"></span>eturn.</div><div class="t m0 x3f h49 y5155 ff19 fs26 fc0 sc0 ls15d ws0">•T<span class="_ _4d"></span><span class="ls0">he read <span class="_ _2"></span>returns when <span class="_ _2"></span>the <span class="_ _2"></span>requested number <span class="_ _2"></span>of bytes <span class="_ _2"></span>have <span class="_ _2"></span>been <span class="_ _2"></span>read. <span class="_"> </span>W<span class="_ _6"></span><span class="ls14f8">ed<span class="_ _d"></span><span class="ls0">on’t</span></span></span></div><div class="t m0 x15 h49 y5156 ff19 fs26 fc0 sc0 ls0 ws0">have <span class="_ _2"></span>to <span class="_ _2"></span>read a <span class="_ _2"></span>complete <span class="_ _2"></span>line.<span class="_ _61"> </span>If <span class="_ _2"></span>we <span class="_ _2"></span>read <span class="_ _2"></span>a <span class="_ _2"></span>partial <span class="_ _2"></span>line, <span class="_ _2"></span>no <span class="_ _2"></span>information <span class="_ _2"></span>is <span class="_ _2"></span>lost; <span class="_ _3"></span>the</div><div class="t m0 x15 h49 y5157 ff19 fs26 fc0 sc0 ls0 ws0">next read starts wher<span class="_ _0"></span><span class="lsd3">et<span class="_ _d"></span><span class="ls0">he previous r<span class="_ _0"></span>ead stopped.</span></span></div><div class="t m0 x3f h49 y5158 ff19 fs26 fc0 sc0 ls15d ws0">•T<span class="_ _4d"></span><span class="ls0">he <span class="_ _3"></span>read <span class="_ _3"></span>returns <span class="_ _2"></span>when <span class="_ _9"></span>a <span class="_ _3"></span>line <span class="_ _3"></span>delimiter <span class="_ _3"></span>is <span class="_ _9"></span>encountered. <span class="_ _47"> </span>Recall<span class="_ _47"> </span>from <span class="_ _2"></span>Section <span class="_ _9"></span>18.3</span></div><div class="t m0 x15 h49 y5159 ff19 fs26 fc0 sc0 ls0 ws0">that <span class="_ _23"> </span>the <span class="_ _23"> </span>following <span class="_ _42"> </span>characters <span class="_ _23"> </span>ar<span class="ls14f9">ei<span class="_ _43"></span><span class="ls0">nterpreted <span class="_ _23"></span>as <span class="_ _23"> </span>end <span class="_ _23"> </span>of <span class="_ _42"> </span>line <span class="_ _23"> </span>in <span class="_ _42"> </span>canonical <span class="_ _23"></span>mode:</span></span></div><div class="t m0 x15 h4d y515a ff19 fs26 fc0 sc0 ls0 ws0">NL, <span class="_ _2"></span>EOL, <span class="_ _2"></span>EOL2, <span class="_ _2"></span>and <span class="_ _2"></span>EOF<span class="_ _6"></span><span class="ls14fa">.A<span class="_ _5b"></span><span class="ls0">lso, <span class="_ _2"></span>recall <span class="_ _2"></span>from Section <span class="_ _2"></span>18.5 <span class="_ _2"></span>that <span class="_ _3"></span>if<span class="_ _66"> </span><span class="ff1a">ICRNL<span class="_ _47"> </span></span>is <span class="_ _2"></span>set <span class="_ _2"></span>and</span></span></div><div class="t m0 x15 h4d y515b ff19 fs26 fc0 sc0 ls0 ws0">if<span class="_ _47"> </span><span class="ff1a">IGNCR<span class="_ _66"> </span></span>is <span class="_ _3"></span>not <span class="_ _3"></span>set, <span class="_ _2"></span>then <span class="_ _3"></span>the <span class="_ _3"></span>CR <span class="_ _2"></span>character <span class="_ _3"></span>also <span class="_ _2"></span>terminates <span class="_ _3"></span>a <span class="_ _3"></span>line, <span class="_ _2"></span>since <span class="_ _3"></span>it <span class="_ _3"></span>acts <span class="_ _2"></span>just</div><div class="t m0 x15 h49 y515c ff19 fs26 fc0 sc0 ls0 ws0">like the NL character<span class="_ _6"></span>.</div><div class="t m0 x15 h49 y515d ff19 fs26 fc0 sc0 ls0 ws0">Of these <span class="_ _2"></span>ﬁve <span class="_ _2"></span>line <span class="_ _2"></span>delimiters, <span class="_ _2"></span>one</div><div class="t m0 x18c h49 y515e ff19 fs26 fc0 sc0 ls0 ws0">(</div><div class="t m0 x10a h49 y515d ff19 fs26 fc0 sc0 ls0 ws0">EOF</div><div class="t m0 xec h49 y515e ff19 fs26 fc0 sc0 ls0 ws0">)</div><div class="t m0 x8e h49 y515d ff19 fs26 fc0 sc0 ls0 ws0">is discarded <span class="_ _2"></span>by the <span class="_ _2"></span>terminal <span class="_ _2"></span>driver <span class="_ _2"></span>when</div><div class="t m0 x15 h49 y515f ff19 fs26 fc0 sc0 ls0 ws0">it’s <span class="_ _9"></span>processed. <span class="_ _45"> </span>The<span class="_ _35"> </span>other <span class="_ _9"></span>four <span class="_ _23"></span>ar<span class="ls14fb">er<span class="_ _43"></span><span class="ls0">eturned <span class="_ _9"></span>to <span class="_ _23"></span>the <span class="_ _23"></span>caller <span class="_ _9"></span>as <span class="_ _23"></span>the <span class="_ _9"></span>last <span class="_ _23"></span>character <span class="_ _9"></span>of</span></span></div><div class="t m0 x15 h49 y5160 ff19 fs26 fc0 sc0 ls0 ws0">the line.</div><div class="t m0 x3f h49 y5161 ff19 fs26 fc0 sc0 ls15d ws0">•T<span class="_ _4d"></span><span class="ls0">he read also <span class="_ _2"></span>returns if a <span class="_ _2"></span>signal is <span class="_ _2"></span>caught <span class="_ _2"></span>and if <span class="_ _2"></span>the <span class="_ _2"></span>function is <span class="_ _2"></span>not automatically</span></div><div class="t m0 x15 h49 y5162 ff19 fs26 fc0 sc0 lscc ws0">re<span class="ls0">started (Section 10.5).</span></div><div class="t m0 x35 h4d y5163 ff16 fs26 fc0 sc0 ls0 ws0">Example <span class="_ _84"></span>—<span class="_ _9"></span><span class="ff1f">getpass<span class="_ _66"> </span></span>Function</div><div class="t m0 x32 h4d y5164 ff19 fs26 fc0 sc0 ls164 ws0">We <span class="_ _53"> </span>n<span class="_ _23"></span><span class="ls0">ow examine <span class="_ _2"></span>the function<span class="_ _66"> </span><span class="ff1a">getpass</span><span class="ls14fc">,w<span class="_ _d"></span><span class="ls0">hich <span class="_ _2"></span>reads a passwor<span class="ls14fc">do<span class="_ _4f"></span><span class="ls14fd">fs<span class="_ _d"></span><span class="ls0">ome <span class="_ _2"></span>type from the</span></span></span></span></span></span></div><div class="t m0 x32 h4d y5165 ff19 fs26 fc0 sc0 ls0 ws0">user <span class="_ _2"></span>at <span class="_ _3"></span>a <span class="_ _3"></span>terminal.<span class="_ _16"> </span>This <span class="_ _3"></span>function <span class="_ _3"></span>is <span class="_ _3"></span>called <span class="_ _3"></span>by <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">login</span></div><div class="t m0 x104 h49 y1ec6 ff19 fs26 fc0 sc0 ls0 ws0">(</div><div class="t m0 x181 h49 y5165 ff19 fs26 fc0 sc0 ls0 ws0">1</div><div class="t m0 x1ef h49 y1ec6 ff19 fs26 fc0 sc0 ls0 ws0">)</div><div class="t m0 xc8 h4d y5165 ff19 fs26 fc0 sc0 ls0 ws0">and<span class="_ _47"> </span><span class="ff1a">crypt</span></div><div class="t m0 x169 h49 y1ec6 ff19 fs26 fc0 sc0 ls0 ws0">(</div><div class="t m0 x16b h49 y5165 ff19 fs26 fc0 sc0 ls0 ws0">1</div><div class="t m0 x235 h49 y1ec6 ff19 fs26 fc0 sc0 ls0 ws0">)</div><div class="t m0 x37 h49 y5165 ff19 fs26 fc0 sc0 ls0 ws0">programs. <span class="_ _66"> </span>T<span class="_ _6"></span>o</div><div class="t m0 x32 h49 y5166 ff19 fs26 fc0 sc0 lscc ws0">re<span class="ls0">ad <span class="_ _9"></span>the <span class="_ _9"></span>password, <span class="_ _3"></span>the <span class="_ _9"></span>function <span class="_ _9"></span>must <span class="_ _9"></span>turn <span class="_ _9"></span>of<span class="ls14fe">fe<span class="_ _b"></span><span class="ls0">choing, <span class="_ _9"></span>but <span class="_ _9"></span>it <span class="_ _9"></span>can <span class="_ _9"></span>leave <span class="_ _9"></span>the <span class="_ _9"></span>terminal <span class="_ _9"></span>in</span></span></span></div><div class="t m0 x32 h49 y5167 ff19 fs26 fc0 sc0 ls0 ws0">canonical <span class="_ _44"> </span>mode, <span class="_ _44"> </span>as <span class="_ _44"> </span>whatever <span class="_ _44"> </span>we <span class="_ _44"> </span>type <span class="_ _44"> </span>as <span class="_ _4b"> </span>the <span class="_ _44"> </span>passwor<span class="ls14ff">df<span class="_ _64"></span><span class="ls0">orms <span class="_ _4b"> </span>a <span class="_ _44"> </span>complete <span class="_ _44"> </span>line.</span></span></div><div class="t m0 x32 h49 y5168 ff19 fs26 fc0 sc0 ls0 ws0">Figur<span class="lsd3">e1<span class="_ _4f"></span><span class="ls0">8.17 shows a typical implementation on a UNIX system.</span></span></div><div class="t m0 x3f h49 y5169 ff19 fs26 fc0 sc0 ls0 ws0">Ther<span class="lsd3">ea<span class="_ _4f"></span><span class="lscc">re <span class="_ _3"></span>s<span class="ls0">everal points to consider in this example.</span></span></span></div><div class="t m0 x3f h4d y516a ff19 fs26 fc0 sc0 ls15d ws0">•I<span class="_ _4d"></span><span class="ls0">nstead <span class="_ _35"> </span>of <span class="_ _35"> </span>har<span class="_ _0"></span>d-wiring<span class="_ _51"> </span><span class="ff1a">/dev/tty<span class="_"> </span></span>into <span class="_ _35"> </span>the <span class="_ _35"> </span>program, <span class="_ _35"> </span>we <span class="_ _35"> </span>call <span class="_ _45"> </span>the <span class="_ _35"> </span>function</span></div><div class="t m0 x15 h4d y516b ff1a fs26 fc0 sc0 ls0 ws0">ctermid<span class="_ _80"> </span><span class="ff19">to open the controlling terminal.</span></div><div class="t m0 x3f h49 y516c ff19 fs26 fc0 sc0 ls15d ws0">•W<span class="_ _4e"></span><span class="ls1500">er<span class="_ _c"></span><span class="ls0">ead <span class="_ _53"> </span>and <span class="_ _42"> </span>write <span class="_ _53"> </span>only <span class="_ _53"> </span>to <span class="_ _42"> </span>the <span class="_ _53"> </span>controlling <span class="_ _42"> </span>terminal <span class="_ _42"> </span>and <span class="_ _53"> </span>return <span class="_ _42"> </span>an <span class="_ _42"> </span>error <span class="_ _42"> </span>if <span class="_ _42"> </span>we</span></span></div><div class="t m0 x15 h49 y516d ff19 fs26 fc0 sc0 ls0 ws0">can’t <span class="_ _9"></span>open <span class="_ _23"> </span>this <span class="_ _23"></span>device <span class="_ _9"></span>for <span class="_ _23"> </span>reading <span class="_ _9"></span>and <span class="_ _23"></span>writing.<span class="_ _5a"> </span>Ther<span class="ls1501">ea<span class="_ _b"></span><span class="lscc">re <span class="_ _23"> </span>o<span class="_ _2"></span><span class="ls0">ther <span class="_ _23"></span>conventions <span class="_ _9"></span>to</span></span></span></div><div class="t m0 x15 h4d y516e ff19 fs26 fc0 sc0 ls0 ws0">use. <span class="_ _45"> </span>The<span class="_ _45"> </span>version <span class="_ _9"></span>of<span class="_ _35"> </span><span class="ff1a">getpass<span class="_ _45"> </span></span>in <span class="_ _9"></span>the <span class="_ _9"></span>GNU <span class="_ _23"></span>C <span class="_ _9"></span>library <span class="_ _9"></span>reads <span class="_ _9"></span>from <span class="_ _9"></span>standar<span class="ls1502">di<span class="_ _43"></span><span class="ls0">nput</span></span></div><div class="t m0 x15 h49 y516f ff19 fs26 fc0 sc0 ls0 ws0">and <span class="_"> </span>writes <span class="_"> </span>to <span class="_"> </span>standar<span class="_ _0"></span><span class="lsfab">de<span class="_ _4a"></span><span class="ls0">rror <span class="_"> </span>if <span class="_ _e"> </span>the <span class="_"> </span>controlling <span class="_"> </span>terminal <span class="_"> </span>can’t <span class="_"> </span>be <span class="_"> </span>opened <span class="_ _e"> </span>for</span></span></div><div class="t m0 x15 h49 y5170 ff19 fs26 fc0 sc0 lscc ws0">re<span class="ls0">ading <span class="_ _e"> </span>and <span class="_ _53"> </span>writing.<span class="_ _65"> </span>The <span class="_ _53"> </span>Solaris <span class="_ _e"> </span>version <span class="_ _53"> </span>fails <span class="_ _e"> </span>if <span class="_ _53"> </span>it <span class="_ _53"> </span>can’t <span class="_ _e"> </span>open <span class="_ _53"> </span>the <span class="_ _53"> </span>controlling</span></div><div class="t m0 x15 h49 y5171 ff19 fs26 fc0 sc0 ls0 ws0">terminal.</div><a class="l" href="#pf13" data-dest-detail='[19,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892634px;bottom:1045.610992px;width:131.351692px;height:19.679992px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
