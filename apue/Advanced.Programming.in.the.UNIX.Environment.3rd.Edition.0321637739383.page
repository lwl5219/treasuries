<div id="pf17f" class="pf w4 h1f" data-page-no="17f"><div class="pc pc17f w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg17f.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h7a ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>10.14<span class="_ _275"> </span><span class="ff1a">sigaction<span class="_ _4b"> </span></span>Function<span class="_ _1b"> </span><span class="ff18">349</span></div><div class="t m0 x32 h26 y12f ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _3"></span>process <span class="_ _3"></span>blocks<span class="_ _45"> </span><span class="ff1a">SIGQUIT</span><span class="lsca6">,s<span class="_ _b"></span><span class="ls0">aving <span class="_ _9"></span>its <span class="_ _3"></span>current <span class="_ _3"></span>signal <span class="_ _9"></span>mask <span class="_ _3"></span>(to <span class="_ _9"></span>restor<span class="_ _0"></span><span class="lsca6">el<span class="_ _b"></span><span class="ls0">ater), <span class="_ _9"></span>and <span class="_ _3"></span>then</span></span></span></span></div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">goes <span class="_ _42"> </span>to <span class="_ _53"> </span>sleep <span class="_ _53"> </span>for <span class="_ _53"> </span>5 <span class="_ _42"> </span>seconds.<span class="_ _65"> </span>Any <span class="_ _53"> </span>occurrence <span class="_ _42"> </span>of <span class="_ _53"> </span>the <span class="_ _42"> </span>quit <span class="_ _53"> </span>signal <span class="_ _53"> </span>during <span class="_ _53"> </span>this <span class="_ _42"> </span>period <span class="_ _53"> </span>is</div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">blocked <span class="_ _47"> </span>and <span class="_ _66"> </span>won’t <span class="_ _47"> </span>be <span class="_ _47"> </span>delivered <span class="_ _66"> </span>until <span class="_ _47"> </span>the <span class="_ _47"> </span>signal <span class="_ _47"> </span>is <span class="_ _47"> </span>unblocked.<span class="_ _50"> </span>At <span class="_ _47"> </span>the <span class="_ _47"> </span>end <span class="_ _47"> </span>of <span class="_ _47"> </span>the</div><div class="t m0 x32 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">5-second sleep, we check whether the signal is pending and unblock the signal.</div><div class="t m0 x3f h2a y133 ff19 fsf fc0 sc0 ls0 ws0">Note <span class="_ _53"> </span>that <span class="_"> </span>we <span class="_ _53"> </span>saved <span class="_ _e"> </span>the <span class="_ _e"> </span>old <span class="_ _e"> </span>mask <span class="_ _e"> </span>when <span class="_ _e"> </span>we <span class="_ _e"> </span>blocked <span class="_ _e"> </span>the <span class="_ _53"> </span>signal.<span class="_ _48"> </span><span class="ls5f">To <span class="_ _35"> </span>u<span class="_ _23"></span></span>nblock <span class="_ _53"> </span>the</div><div class="t m0 x32 h26 y134 ff19 fsf fc0 sc0 ls0 ws0">signal, we <span class="_ _2"></span>did a<span class="_ _66"> </span><span class="ff1a">SIG_SETMASK<span class="_ _47"> </span></span>of the old <span class="_ _2"></span>mask.<span class="_ _61"> </span>Alternatively<span class="_ _4"></span>,<span class="_ _66"> </span>we<span class="_ _66"> </span>could<span class="_ _66"> </span><span class="ff1a">SIG_UNBLOCK</span></div><div class="t m0 x32 h2a y135 ff19 fsf fc0 sc0 ls0 ws0">only <span class="_ _2"></span>the <span class="_ _2"></span>signal <span class="_ _2"></span>that <span class="_ _2"></span>we <span class="_ _2"></span>had <span class="_ _2"></span>blocked.<span class="_ _61"> </span>Be <span class="_ _2"></span>aware, <span class="_ _2"></span>however<span class="_ _6"></span>,<span class="_ _47"> </span>if<span class="_"> </span>we<span class="_ _47"> </span>write <span class="_ _2"></span>a <span class="_ _2"></span>function <span class="_ _2"></span>that <span class="_ _2"></span>can</div><div class="t m0 x32 h2a y136 ff19 fsf fc0 sc0 ls0 ws0">be <span class="_ _e"> </span>called <span class="_"> </span>by <span class="_ _53"> </span>others <span class="_"> </span>and <span class="_ _e"> </span>if <span class="_ _e"> </span>we <span class="_"> </span>need <span class="_ _53"> </span>to <span class="_"> </span>block <span class="_ _e"> </span>a <span class="_"> </span>signal <span class="_ _53"> </span>in <span class="_"> </span>our <span class="_ _53"> </span>function, <span class="_"> </span>we <span class="_ _e"> </span>can’t <span class="_ _e"> </span>use</div><div class="t m0 x32 h26 y137 ff1a fsf fc0 sc0 ls0 ws0">SIG_UNBLOCK<span class="_ _45"> </span><span class="ff19">to <span class="_ _23"> </span>unblock <span class="_ _23"></span>the <span class="_ _9"></span>signal.<span class="_ _51"> </span>In <span class="_ _23"></span>this <span class="_ _9"></span>case, <span class="_ _23"> </span>we <span class="_ _23"></span>have <span class="_ _23"></span>to <span class="_ _9"></span>use<span class="_ _35"> </span></span>SIG_SETMASK<span class="_ _45"> </span><span class="ff19">and</span></div><div class="t m0 x32 h2a y138 ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">stor<span class="lsb4f">et<span class="_ _5b"></span><span class="ls0">he <span class="_ _66"> </span>signal <span class="_"> </span>mask <span class="_ _66"> </span>to <span class="_ _66"> </span>its <span class="_"> </span>prior <span class="_ _66"> </span>value, <span class="_ _66"> </span>because <span class="_"> </span>it’s <span class="_ _66"> </span>possible <span class="_ _66"> </span>that <span class="_"> </span>the <span class="_ _66"> </span>caller <span class="_ _66"> </span>had</span></span></span></div><div class="t m0 x32 h2a y139 ff19 fsf fc0 sc0 ls0 ws0">speciﬁcally <span class="_ _2"></span>blocked <span class="_ _3"></span>this <span class="_ _3"></span>signal <span class="_ _3"></span>befor<span class="ls4ef">ec<span class="_ _8"></span><span class="ls0">alling <span class="_ _3"></span>our <span class="_ _3"></span>function.<span class="_ _61"> </span><span class="ls5f">We<span class="_ _23"></span></span>’ll <span class="_ _2"></span>see <span class="_ _3"></span>an <span class="_ _3"></span>example <span class="_ _3"></span>of <span class="_ _2"></span>this</span></span></div><div class="t m0 x32 h26 y13a ff19 fsf fc0 sc0 ls0 ws0">in the<span class="_"> </span><span class="ff1a">system<span class="_ _80"> </span></span>function in Section 10.18.</div><div class="t m0 x3f h2a y254 ff19 fsf fc0 sc0 ls0 ws0">If <span class="_ _23"></span>we <span class="_ _9"></span>generate <span class="_ _23"> </span>the <span class="_ _23"> </span>quit <span class="_ _23"> </span>signal <span class="_ _23"></span>during <span class="_ _23"></span>this <span class="_ _23"></span>sleep <span class="_ _9"></span>period, <span class="_ _23"> </span>the <span class="_ _23"> </span>signal <span class="_ _23"></span>is <span class="_ _23"></span>now <span class="_ _23"></span>pending</div><div class="t m0 x32 h26 y255 ff19 fsf fc0 sc0 ls0 ws0">and <span class="_ _53"> </span>unblocked, <span class="_ _53"> </span>so <span class="_ _53"> </span>it <span class="_ _53"> </span>is <span class="_ _53"> </span>delivered <span class="_ _42"> </span>before<span class="_ _44"> </span><span class="ff1a">sigprocmask<span class="_ _44"> </span></span><span class="ls45">re<span class="_ _2"></span></span>turns. <span class="_ _4b"> </span>W<span class="_ _6"></span>e’ll <span class="_ _53"> </span>see <span class="_ _53"> </span>this <span class="_ _53"> </span>occur</div><div class="t m0 x32 h26 y13b ff19 fsf fc0 sc0 ls0 ws0">because <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">printf<span class="_ _45"> </span></span>in <span class="_ _2"></span>the <span class="_ _3"></span>signal <span class="_ _9"></span>handler <span class="_ _3"></span>is <span class="_ _3"></span>output <span class="_ _3"></span>befor<span class="lsca7">et<span class="_ _8"></span><span class="ls0">he<span class="_ _47"> </span><span class="ff1a">printf<span class="_ _47"> </span></span>that <span class="_ _9"></span>follows <span class="_ _3"></span>the</span></span></div><div class="t m0 x32 h26 y13c ff19 fsf fc0 sc0 ls0 ws0">call to<span class="_"> </span><span class="ff1a">sigprocmask</span>.</div><div class="t m0 x3f h2a y256 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _2"></span>process <span class="_ _2"></span>then <span class="_ _2"></span>goes <span class="_ _3"></span>to <span class="_ _2"></span>sleep <span class="_ _3"></span>for <span class="_ _2"></span>another <span class="_ _2"></span>5 <span class="_ _3"></span>seconds.<span class="_ _61"> </span>If <span class="_ _3"></span>we <span class="_ _2"></span>generate <span class="_ _3"></span>the <span class="_ _2"></span>quit <span class="_ _2"></span>signal</div><div class="t m0 x32 h2a y257 ff19 fsf fc0 sc0 ls0 ws0">during <span class="_ _53"> </span>this <span class="_ _53"> </span>sleep <span class="_ _53"> </span>period, <span class="_ _53"> </span>the <span class="_ _53"> </span>signal <span class="_ _53"> </span>should <span class="_ _53"> </span>terminate <span class="_ _53"> </span>the <span class="_ _53"> </span>process, <span class="_ _42"> </span>since <span class="_ _53"> </span>we <span class="_ _53"> </span>reset <span class="_ _42"> </span>the</div><div class="t m0 x32 h2a y258 ff19 fsf fc0 sc0 ls0 ws0">handling <span class="_ _23"> </span>of <span class="_ _42"> </span>the <span class="_ _42"> </span>signal <span class="_ _23"> </span>to <span class="_ _42"> </span>its <span class="_ _42"> </span>default <span class="_ _42"> </span>when <span class="_ _23"> </span>we <span class="_ _42"> </span>caught <span class="_ _42"> </span>it.<span class="_ _51"> </span>In <span class="_ _42"> </span>the <span class="_ _42"> </span>following <span class="_ _23"> </span>output, <span class="_ _42"> </span>the</div><div class="t m0 x32 h26 y161 ff19 fsf fc0 sc0 ls0 ws0">terminal prints<span class="_"> </span><span class="ff1a">ˆ\<span class="_ _80"> </span></span>when we input Control-backslash, the terminal quit character:</div><div class="t m0 x3f h57 y2c96 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">./a.out</span></div><div class="t m0 x3f h57 y2c97 ff1f fs2d fc0 sc0 ls0 ws0">ˆ\<span class="_ _22c"> </span><span class="ff1b">generate signal once (befor<span class="_ _0"></span><span class="ls110">e5s<span class="_ _5"></span><span class="ls0">econds ar<span class="ls110">eu<span class="_ _d"></span><span class="ls0">p)</span></span></span></span></span></div><div class="t m0 x3f h57 y2c98 ff1a fs2d fc0 sc0 ls0 ws0">SIGQUIT pending<span class="_ _1ec"> </span><span class="ff1b">after return from<span class="_"> </span></span>sleep</div><div class="t m0 x3f h57 y2c99 ff1a fs2d fc0 sc0 ls0 ws0">caught SIGQUIT<span class="_ _248"> </span><span class="ff1b">in signal handler</span></div><div class="t m0 x3f h57 y2c9a ff1a fs2d fc0 sc0 ls0 ws0">SIGQUIT unblocked<span class="_ _bc"> </span><span class="ff1b">after return from<span class="_"> </span></span>sigprocmask</div><div class="t m0 x3f h57 y2c9b ff1f fs2d fc0 sc0 ls0 ws0">ˆ\<span class="ff1a">Quit(coredump)<span class="_ _1f9"> </span><span class="ff1b">generate signal again</span></span></div><div class="t m0 x3f h57 y2c9c ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">./a.out</span></div><div class="t m0 x3f h57 y2c9d ff1f fs2d fc0 sc0 ls0 ws0">ˆ\ˆ\ˆ\ˆ\ˆ\ˆ\ˆ\ˆ\ˆ\ˆ\<span class="_ _9f"> </span><span class="ff1b">generate signal 10 times (befor<span class="ls110">e5s<span class="_ _d"></span><span class="ls0">econds ar<span class="ls110">eu<span class="_ _5"></span><span class="ls0">p)</span></span></span></span></span></div><div class="t m0 x3f h57 y2c9e ff1a fs2d fc0 sc0 ls0 ws0">SIGQUIT pending</div><div class="t m0 x3f h57 y2c9f ff1a fs2d fc0 sc0 ls0 ws0">caught SIGQUIT<span class="_ _248"> </span><span class="ff1b">signal is generated only once</span></div><div class="t m0 x3f h57 y2ca0 ff1a fs2d fc0 sc0 ls0 ws0">SIGQUIT unblocked</div><div class="t m0 x3f h57 y2ca1 ff1f fs2d fc0 sc0 ls0 ws0">ˆ\<span class="ff1a">Quit(coredump)<span class="_ _1f9"> </span><span class="ff1b">generate signal again</span></span></div><div class="t m0 x32 h26 y2ca2 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_"> </span>message<span class="_ _61"> </span><span class="ff1a">Quit(coredump)<span class="_ _46"> </span></span>is <span class="_ _66"> </span>printed <span class="_ _66"> </span>by <span class="_ _66"> </span>the <span class="_ _66"> </span>shell <span class="_ _47"> </span>when <span class="_"> </span>it <span class="_ _66"> </span>sees <span class="_ _66"> </span>that <span class="_ _66"> </span>its <span class="_ _66"> </span>child</div><div class="t m0 x32 h2a y2ca3 ff19 fsf fc0 sc0 ls0 ws0">terminated <span class="_"> </span>abnormally<span class="_ _6"></span><span class="lsca8">.N<span class="_ _49"></span><span class="ls0">ote <span class="_"> </span>that <span class="_"> </span>when <span class="_ _66"> </span>we <span class="_ _66"> </span>run <span class="_"> </span>the <span class="_"> </span>program <span class="_"> </span>the <span class="_"> </span>second <span class="_ _66"> </span>time, <span class="_"> </span>we</span></span></div><div class="t m0 x32 h2a y2ca4 ff19 fsf fc0 sc0 ls0 ws0">generate <span class="_ _2"></span>the <span class="_ _3"></span>quit <span class="_ _3"></span>signal <span class="_ _2"></span>ten <span class="_ _3"></span>times <span class="_ _3"></span>while <span class="_ _2"></span>the <span class="_ _3"></span>process <span class="_ _2"></span>is <span class="_ _3"></span>asleep, <span class="_ _2"></span>yet <span class="_ _3"></span>the <span class="_ _3"></span>signal <span class="_ _2"></span>is <span class="_ _3"></span>delivered</div><div class="t m0 x32 h2a y2ca5 ff19 fsf fc0 sc0 ls0 ws0">only <span class="_ _23"> </span>once <span class="_ _23"> </span>to <span class="_ _42"> </span>the <span class="_ _23"> </span>process <span class="_ _23"> </span>when <span class="_ _23"> </span>it’s <span class="_ _42"> </span>unblocked.<span class="_ _51"> </span>This <span class="_ _23"> </span>demonstrates <span class="_ _42"> </span>that <span class="_ _23"> </span>signals <span class="_ _23"> </span>ar<span class="lsca9">en<span class="_ _43"></span><span class="ls0">ot</span></span></div><div class="t m0 x32 h2a y2ca6 ff19 fsf fc0 sc0 ls0 ws0">queued on this system.</div><div class="t m0 x35 h7b y2ca7 ff16 fs27 fc0 sc0 ls0 ws0">10.14<span class="_ _5a"> </span><span class="ff1f">sigaction<span class="_ _54"> </span></span>Function</div><div class="t m0 x32 h4d y2ca8 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_"> </span><span class="ff1a">sigaction<span class="_ _80"> </span></span>function <span class="_ _2"></span>allows us to examine or modify (or <span class="_ _2"></span>both) the action associated</div><div class="t m0 x32 h4d y2ca9 ff19 fs26 fc0 sc0 ls0 ws0">with <span class="_ _53"> </span>a <span class="_ _53"> </span>particular <span class="_ _53"> </span>signal.<span class="_ _65"> </span>This <span class="_ _53"> </span>function <span class="_ _53"> </span>supersedes <span class="_ _53"> </span>the<span class="_ _4b"> </span><span class="ff1a">signal<span class="_ _4b"> </span></span>function <span class="_ _53"> </span>from <span class="_ _42"> </span>earlier</div><div class="t m0 x32 h49 y2caa ff19 fs26 fc0 sc0 lscc ws0">re<span class="ls0">leases <span class="_ _44"> </span>of <span class="_ _35"> </span>the <span class="_ _44"> </span>UNIX <span class="_ _44"> </span>System.<span class="_ _98"> </span>Indeed, <span class="_ _35"> </span>at <span class="_ _44"> </span>the <span class="_ _35"> </span>end <span class="_ _44"> </span>of <span class="_ _44"> </span>this <span class="_ _35"> </span>section, <span class="_ _44"> </span>we <span class="_ _35"> </span>show <span class="_ _44"> </span>an</span></div><div class="t m0 x32 h4d y2cab ff19 fs26 fc0 sc0 ls0 ws0">implementation of<span class="_"> </span><span class="ff1a">signal<span class="_ _80"> </span></span>using<span class="_"> </span><span class="ff1a">sigaction</span>.</div><a class="l" href="#pf10" data-dest-detail='[16,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892634px;bottom:261.048897px;width:158.135688px;height:19.680008px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
