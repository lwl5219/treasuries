<div id="pf168" class="pf w4 h1f" data-page-no="168"><div class="pc pc168 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg168.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">326<span class="_ _1b"> </span><span class="ff19">Signals <span class="_ _24b"> </span>Chapter<span class="_ _21"> </span>10</span></div><div class="t m0 x3f h26 y12f ff19 fsf fc0 sc0 ls0 ws0">These <span class="_ _23"></span>two <span class="_ _9"></span>calls <span class="_ _23"></span>to<span class="_ _45"> </span><span class="ff1a">signal<span class="_ _35"> </span></span>also <span class="_ _23"></span>show <span class="_ _9"></span>a <span class="_ _23"></span>limitation <span class="_ _23"></span>of <span class="_ _9"></span>the<span class="_ _35"> </span><span class="ff1a">signal<span class="_ _45"> </span></span>function: <span class="_ _23"> </span>we <span class="_ _23"></span>are</div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">not <span class="_ _35"> </span>able <span class="_ _44"> </span>to <span class="_ _35"> </span>determine <span class="_ _44"> </span>the <span class="_ _35"> </span>current <span class="_ _35"> </span>disposition <span class="_ _44"> </span>of <span class="_ _44"> </span>a <span class="_ _35"> </span>signal <span class="_ _44"> </span>without <span class="_ _35"> </span>changing <span class="_ _44"> </span>the</div><div class="t m0 x32 h26 y131 ff19 fsf fc0 sc0 ls0 ws0">disposition. <span class="_ _35"> </span>W<span class="_ _6"></span>e’ll <span class="_ _23"></span>see <span class="_ _23"> </span>later <span class="_ _23"> </span>in <span class="_ _23"> </span>this <span class="_ _42"> </span>chapter <span class="_ _23"></span>how <span class="_ _23"></span>the<span class="_ _35"> </span><span class="ff1a">sigaction<span class="_ _35"> </span></span>function <span class="_ _23"></span>allows <span class="_ _23"></span>us <span class="_ _23"> </span>to</div><div class="t m0 x32 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">determine a signal’s disposition without changing it.</div><div class="t m0 x35 h27 y134 ff16 fsf fc0 sc0 ls0 ws0">Process Creation</div><div class="t m0 x32 h26 y136 ff19 fsf fc0 sc0 ls0 ws0">When <span class="_ _42"> </span>a <span class="_ _53"> </span>process <span class="_ _42"> </span>calls<span class="_ _4b"> </span><span class="ff1a">fork</span><span class="ls1c0">,t<span class="_ _c"></span><span class="ls0">he <span class="_ _53"> </span>child <span class="_ _53"> </span>inherits <span class="_ _42"> </span>the <span class="_ _53"> </span>parent’s <span class="_ _53"> </span>signal <span class="_ _42"> </span>dispositions.<span class="_ _65"> </span>Here,</span></span></div><div class="t m0 x32 h2a y137 ff19 fsf fc0 sc0 ls0 ws0">since <span class="_ _23"> </span>the <span class="_ _42"> </span>child <span class="_ _23"> </span>starts <span class="_ _42"> </span>of<span class="lsbe7">fw<span class="_ _43"></span><span class="ls0">ith <span class="_ _23"></span>a <span class="_ _23"> </span>copy <span class="_ _42"> </span>of <span class="_ _23"> </span>the <span class="_ _42"> </span>parent’s <span class="_ _23"></span>memory <span class="_ _23"> </span>image, <span class="_ _42"> </span>the <span class="_ _23"> </span>address <span class="_ _23"></span>of <span class="_ _23"> </span>a</span></span></div><div class="t m0 x32 h2a y138 ff19 fsf fc0 sc0 ls0 ws0">signal-catching function has meaning in the child.</div><div class="t m0 x35 h53 y6d9 ff16 fs2b fc0 sc0 ls0 ws0">10.4 <span class="_ _93"> </span>Unreliable <span class="_"> </span>Signals</div><div class="t m0 x32 h2a y29ed ff19 fsf fc0 sc0 ls0 ws0">In <span class="_ _3"></span>earlier <span class="_ _3"></span>versions <span class="_ _9"></span>of <span class="_ _3"></span>the <span class="_ _9"></span>UNIX <span class="_ _3"></span>System <span class="_ _3"></span>(such <span class="_ _9"></span>as <span class="_ _3"></span>V<span class="_ _4"></span>ersion <span class="_ _9"></span>7), <span class="_ _3"></span>signals <span class="_ _9"></span>wer<span class="ls8d3">eu<span class="_ _b"></span><span class="ls0">nreliable. <span class="_ _47"> </span>By</span></span></div><div class="t m0 x32 h2a y29ee ff19 fsf fc0 sc0 ls0 ws0">this <span class="_ _23"> </span>we <span class="_ _42"> </span>mean <span class="_ _23"> </span>that <span class="_ _42"> </span>signals <span class="_ _23"> </span>could <span class="_ _42"> </span>get <span class="_ _23"> </span>lost: <span class="_ _42"> </span>a <span class="_ _23"> </span>signal <span class="_ _42"> </span>could <span class="_ _23"> </span>occur <span class="_ _23"> </span>and <span class="_ _42"> </span>the <span class="_ _23"> </span>process <span class="_ _23"> </span>would</div><div class="t m0 x32 h2a y29ef ff19 fsf fc0 sc0 ls0 ws0">never <span class="_ _23"> </span>know <span class="_ _42"> </span>about <span class="_ _23"> </span>it.<span class="_ _51"> </span>Also, <span class="_ _42"> </span>a <span class="_ _23"> </span>process <span class="_ _23"> </span>had <span class="_ _42"> </span>little <span class="_ _23"> </span>control <span class="_ _23"> </span>over <span class="_ _23"> </span>a <span class="_ _42"> </span>signal: <span class="_ _23"> </span>a <span class="_ _42"> </span>process <span class="_ _23"></span>could</div><div class="t m0 x32 h2a y29f0 ff19 fsf fc0 sc0 ls0 ws0">catch <span class="_ _42"> </span>the <span class="_ _53"> </span>signal <span class="_ _42"> </span>or <span class="_ _53"> </span>ignor<span class="lsbe8">ei<span class="_ _c"></span><span class="ls0">t. <span class="_ _44"> </span>Sometimes,<span class="_ _44"> </span>we <span class="_ _42"> </span>would <span class="_ _53"> </span>like <span class="_ _42"> </span>to <span class="_ _53"> </span>tell <span class="_ _53"> </span>the <span class="_ _42"> </span>kernel <span class="_ _53"> </span>to <span class="_ _42"> </span>block <span class="_ _53"> </span>a</span></span></div><div class="t m0 x32 h2a y29f1 ff19 fsf fc0 sc0 ls0 ws0">signal: don’t ignor<span class="ls44">ei<span class="_ _4f"></span><span class="ls0">t, just remember if it occurs, and tell us later when we’r<span class="ls44">er<span class="_ _4f"></span><span class="ls0">eady<span class="_ _4"></span>.</span></span></span></span></div><div class="t m0 x76 h76 y2359 ff19 fs2a fc0 sc0 ls0 ws0">Changes <span class="_ _3"></span>wer<span class="lsbe9">em<span class="_ _4f"></span><span class="ls0">ade <span class="_ _9"></span>with <span class="_ _3"></span>4.2BSD <span class="_ _3"></span>to <span class="_ _3"></span>provide <span class="_ _3"></span>what <span class="_ _3"></span>ar<span class="lsbea">ec<span class="_ _d"></span><span class="ls0">alled<span class="_ _66"> </span><span class="ff1b ls34e">re<span class="ls0">liable <span class="_ _3"></span>signals</span></span><span class="lsbeb">.A<span class="_ _84"></span><span class="ls0">different <span class="_ _3"></span>set <span class="_ _3"></span>of</span></span></span></span></span></span></div><div class="t m0 x76 h51 y29f2 ff19 fs2a fc0 sc0 ls0 ws0">changes was then made in SVR3 to provide reliable signals under System V<span class="_ _4"></span><span class="lsbec">.P<span class="_ _43"></span><span class="ls0">OSIX.1 chose the</span></span></div><div class="t m0 x76 h51 y29f3 ff19 fs2a fc0 sc0 ls0 ws0">BSD model to standardize.</div><div class="t m0 x3f h2a y784 ff19 fsf fc0 sc0 ls0 ws0">One <span class="_ _3"></span>problem <span class="_ _2"></span>with <span class="_ _9"></span>these <span class="_ _3"></span>early <span class="_ _3"></span>versions <span class="_ _9"></span>was <span class="_ _3"></span>that <span class="_ _3"></span>the <span class="_ _3"></span>action <span class="_ _9"></span>for <span class="_ _3"></span>a <span class="_ _3"></span>signal <span class="_ _3"></span>was <span class="_ _9"></span>reset <span class="_ _2"></span>to</div><div class="t m0 x32 h2a y785 ff19 fsf fc0 sc0 ls0 ws0">its <span class="_ _23"></span>default <span class="_ _23"></span>each <span class="_ _23"> </span>time <span class="_ _23"> </span>the <span class="_ _23"> </span>signal <span class="_ _23"> </span>occurred. <span class="_ _35"> </span>(In<span class="_ _35"> </span>the <span class="_ _23"></span>pr<span class="_ _0"></span>evious <span class="_ _23"></span>example, <span class="_ _23"> </span>when <span class="_ _23"> </span>we <span class="_ _23"> </span>ran <span class="_ _23"> </span>the</div><div class="t m0 x32 h2a ybc ff19 fsf fc0 sc0 ls0 ws0">program <span class="_ _2"></span>in <span class="_ _3"></span>Figur<span class="lsbed">e1<span class="_ _8"></span><span class="ls0">0.2, <span class="_ _3"></span>we <span class="_ _9"></span>avoided <span class="_ _3"></span>this <span class="_ _3"></span>detail <span class="_ _3"></span>by <span class="_ _9"></span>catching <span class="_ _3"></span>each <span class="_ _3"></span>signal <span class="_ _3"></span>only <span class="_ _9"></span>once.)<span class="_ _16"> </span>The</span></span></div><div class="t m0 x32 h2a y29f4 ff19 fsf fc0 sc0 ls0 ws0">classic <span class="_ _2"></span>example <span class="_ _3"></span>from <span class="_ _2"></span>programming <span class="_ _2"></span>books <span class="_ _3"></span>that <span class="_ _2"></span>described <span class="_ _3"></span>these <span class="_ _3"></span>earlier <span class="_ _3"></span>systems <span class="_ _2"></span>concerns</div><div class="t m0 x32 h2a y29f5 ff19 fsf fc0 sc0 ls0 ws0">how to handle the interrupt signal.<span class="_ _59"> </span>The code that was described usually looked like</div><div class="t m0 xc2 h57 y29f6 ff1a fs2d fc0 sc0 ls0 ws0">int <span class="_ _68"> </span>sig_int();<span class="_ _186"> </span>/* my signal handling function */</div><div class="t m0 x122 h57 y29f7 ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 x122 h57 y29f8 ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 x122 h57 y29f9 ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 xc2 h57 y29fa ff1a fs2d fc0 sc0 ls0 ws0">signal(SIGINT, sig_int); /* establish handler */</div><div class="t m0 x122 h57 y29fb ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 x122 h57 y29fc ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 x122 h57 y29fd ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 x3f h57 y29fe ff1a fs2d fc0 sc0 ls0 ws0">sig_int()</div><div class="t m0 x3f h57 y29ff ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 xc2 h57 y2a00 ff1a fs2d fc0 sc0 ls0 ws0">signal(SIGINT, sig_int); /* reestablish handler for next time */</div><div class="t m0 x122 h57 y2a01 ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 x122 h57 y2a02 ff1a fs2d fc0 sc0 lsbee ws0">./<span class="_ _26b"></span><span class="ls15c">*p<span class="_ _1d"></span><span class="ls0">rocess the signal ... */</span></span></div><div class="t m0 x122 h57 y2a03 ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 x3f h57 y2a04 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h2a y2a05 ff19 fsf fc0 sc0 ls0 ws0">(The <span class="_ _42"> </span>reason <span class="_ _42"> </span>the <span class="_ _42"> </span>signal <span class="_ _53"> </span>handler <span class="_ _42"> </span>is <span class="_ _53"> </span>declared <span class="_ _42"> </span>as <span class="_ _42"> </span>returning <span class="_ _42"> </span>an <span class="_ _42"> </span>integer <span class="_ _53"> </span>is <span class="_ _42"> </span>that <span class="_ _53"> </span>these <span class="_ _42"> </span>early</div><div class="t m0 x32 h26 y2a06 ff19 fsf fc0 sc0 ls0 ws0">systems didn’t support the ISO C<span class="_"> </span><span class="ff1a">void<span class="_ _80"> </span></span>data type.)</div><div class="t m0 x3f h2a y2a07 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _9"></span>problem <span class="_ _9"></span>with <span class="_ _23"> </span>this <span class="_ _23"></span>code <span class="_ _9"></span>fragment <span class="_ _23"></span>is <span class="_ _9"></span>that <span class="_ _23"></span>ther<span class="lsbef">ei<span class="_ _43"></span>sa <span class="_ _62"></span>w<span class="_ _b"></span><span class="ls0">indow <span class="_ _9"></span>of <span class="_ _9"></span>time<span class="_ _9"></span><span class="ls9d">—a<span class="_ _1"></span><span class="ls0">fter <span class="_ _9"></span>the</span></span></span></span></div><div class="t m0 x32 h26 y2a08 ff19 fsf fc0 sc0 ls0 ws0">signal <span class="_ _53"> </span>has <span class="_ _53"> </span>occurred, <span class="_ _53"> </span>but <span class="_ _53"> </span>befor<span class="lsbf0">et<span class="_ _55"></span><span class="ls0">he <span class="_ _e"> </span>call <span class="_ _53"> </span>to<span class="_ _4b"> </span><span class="ff1a">signal<span class="_ _44"> </span></span>in <span class="_ _e"> </span>the <span class="_ _53"> </span>signal <span class="_ _53"> </span>handler<span class="_ _9"></span><span class="ls9d">—w<span class="_ _1"></span><span class="ls0">hen <span class="_ _53"> </span>the</span></span></span></span></div><div class="t m0 x32 h2a y2a09 ff19 fsf fc0 sc0 ls0 ws0">interrupt <span class="_ _9"></span>signal <span class="_ _9"></span>could <span class="_ _9"></span>occur <span class="_ _9"></span>another <span class="_ _9"></span>time.<span class="_ _5a"> </span>This <span class="_ _9"></span>second <span class="_ _9"></span>signal <span class="_ _9"></span>would <span class="_ _9"></span>cause <span class="_ _9"></span>the <span class="_ _23"></span>default</div><a class="l" href="#pff" data-dest-detail='[15,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892634px;bottom:933.888916px;width:143.255699px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
