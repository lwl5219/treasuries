<div id="pf2e3" class="pf w4 h1f" data-page-no="2e3"><div class="pc pc2e3 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg2e3.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>18.1<span class="_ _1"></span><span class="ls150d">1N<span class="_ _111"></span><span class="ls0">oncanonical <span class="_"> </span>Mode<span class="_ _1b"> </span><span class="ff18">705</span></span></span></div><div class="t m0 x3f h26 y12f ff19 fsf fc0 sc0 lsbc ws0">Tw<span class="_ _9"></span><span class="ls1522">oa<span class="_ _b"></span><span class="ls0">dditional <span class="_ _9"></span>functions <span class="_ _9"></span>ar<span class="ls1522">ep<span class="_ _b"></span><span class="ls45">ro<span class="ls0">vided:<span class="_ _45"> </span><span class="ff1a">tty_atexit<span class="_ _35"> </span></span>can <span class="_ _9"></span>be <span class="_ _9"></span>established <span class="_ _9"></span>as <span class="_ _23"></span>an <span class="_ _9"></span>exit</span></span></span></span></span></div><div class="t m0 x32 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">handler to <span class="_ _2"></span>ensur<span class="ls1523">et<span class="_ _4f"></span><span class="ls0">hat <span class="_ _2"></span>the <span class="_ _2"></span>terminal <span class="_ _2"></span>mode <span class="_ _2"></span>is reset <span class="_ _2"></span>by<span class="_ _66"> </span><span class="ff1a">exit</span><span class="ls1523">,a<span class="_ _4f"></span><span class="ls0">nd<span class="_ _47"> </span><span class="ff1a">tty_termios<span class="_ _66"> </span></span><span class="ls45">re</span>turns <span class="_ _2"></span>a</span></span></span></span></div><div class="t m0 x32 h26 y131 ff19 fsf fc0 sc0 ls0 ws0">pointer to the original canonical mode<span class="_"> </span><span class="ff1a">termios<span class="_ _80"> </span></span>structure.</div><div class="t m0 x32 h4e y1106 ff1a fs28 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h4e y1107 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;termios.h&gt;</div><div class="t m0 x32 h4e y51c8 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;errno.h&gt;</div><div class="t m0 x32 h4e y51c9 ff1a fs28 fc0 sc0 ls0 ws0">static struct termios<span class="_ _b7"> </span>save_termios;</div><div class="t m0 x32 h4e y51ca ff1a fs28 fc0 sc0 ls0 ws0">static int<span class="_ _cb"> </span>ttysavefd = -1;</div><div class="t m0 x32 h4e y51cb ff1a fs28 fc0 sc0 ls0 ws0">static enum { RESET, RAW, CBREAK }<span class="_ _d9"> </span>ttystate = RESET;</div><div class="t m0 x32 h4e y51cc ff1a fs28 fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h4e y51cd ff1a fs28 fc0 sc0 ls0 ws0">tty_cbreak(int fd)<span class="_ _d9"> </span>/* put terminal into a cbreak mode */</div><div class="t m0 x32 h4e y51ce ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y51cf ff1a fs28 fc0 sc0 ls0 ws0">int <span class="_ _82"> </span>err;</div><div class="t m0 x8a h4e y51d0 ff1a fs28 fc0 sc0 ls0 ws0">struct termios<span class="_ _d9"> </span>buf;</div><div class="t m0 x8a h4e y51d1 ff1a fs28 fc0 sc0 ls0 ws0">if (ttystate != RESET) {</div><div class="t m0 x9d h4e y51d2 ff1a fs28 fc0 sc0 ls0 ws0">errno = EINVAL;</div><div class="t m0 x9d h4e y51d3 ff1a fs28 fc0 sc0 ls0 ws0">return(-1);</div><div class="t m0 x8a h4e y51d4 ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h4e y51d5 ff1a fs28 fc0 sc0 ls0 ws0">if (tcgetattr(fd, &amp;buf) &lt; 0)</div><div class="t m0 x9d h4e y51d6 ff1a fs28 fc0 sc0 ls0 ws0">return(-1);</div><div class="t m0 x8a h4e y51d7 ff1a fs28 fc0 sc0 ls0 ws0">save_termios = buf; /* structure copy */</div><div class="t m0 x8a h4e y51d8 ff1a fs28 fc0 sc0 ls0 ws0">/*</div><div class="t m0 x214 h4e y51d9 ff1a fs28 fc0 sc0 ls1b6 ws0">*E<span class="_ _1d"></span><span class="ls0">cho off, canonical mode off.</span></div><div class="t m0 x214 h4e y51da ff1a fs28 fc0 sc0 ls0 ws0">*/</div><div class="t m0 x8a h4e y51db ff1a fs28 fc0 sc0 ls0 ws0">buf.c_lflag &amp;= Ëœ(ECHO | ICANON);</div><div class="t m0 x8a h4e y51dc ff1a fs28 fc0 sc0 ls0 ws0">/*</div><div class="t m0 x214 h4e y51dd ff1a fs28 fc0 sc0 ls1b6 ws0">*C<span class="_ _1d"></span><span class="ls0">ase B: 1 byte at a time, no timer.</span></div><div class="t m0 x214 h4e y51de ff1a fs28 fc0 sc0 ls0 ws0">*/</div><div class="t m0 x8a h4e y51df ff1a fs28 fc0 sc0 ls0 ws0">buf.c_cc[VMIN] = 1;</div><div class="t m0 x8a h4e y51e0 ff1a fs28 fc0 sc0 ls0 ws0">buf.c_cc[VTIME] = 0;</div><div class="t m0 x8a h4e y51e1 ff1a fs28 fc0 sc0 ls0 ws0">if (tcsetattr(fd, TCSAFLUSH, &amp;buf) &lt; 0)</div><div class="t m0 x9d h4e y51e2 ff1a fs28 fc0 sc0 ls0 ws0">return(-1);</div><div class="t m0 x8a h4e y51e3 ff1a fs28 fc0 sc0 ls0 ws0">/*</div><div class="t m0 x214 h4e y51e4 ff1a fs28 fc0 sc0 ls1b6 ws0">*V<span class="_ _1d"></span><span class="ls0">erify that the changes stuck.<span class="_ _3a"> </span>tcsetattr can return 0 on</span></div><div class="t m0 x214 h4e y51e5 ff1a fs28 fc0 sc0 ls1b6 ws0">*p<span class="_ _1d"></span><span class="ls0">artial success.</span></div><div class="t m0 x214 h4e y51e6 ff1a fs28 fc0 sc0 ls0 ws0">*/</div><div class="t m0 x8a h4e y51e7 ff1a fs28 fc0 sc0 ls0 ws0">if (tcgetattr(fd, &amp;buf) &lt; 0) {</div><div class="t m0 x9d h4e y51e8 ff1a fs28 fc0 sc0 ls0 ws0">err = errno;</div><div class="t m0 x9d h4e y51e9 ff1a fs28 fc0 sc0 ls0 ws0">tcsetattr(fd, TCSAFLUSH, &amp;save_termios);</div><div class="t m0 x9d h4e y51ea ff1a fs28 fc0 sc0 ls0 ws0">errno = err;</div><div class="t m0 x9d h4e y51eb ff1a fs28 fc0 sc0 ls0 ws0">return(-1);</div><div class="t m0 x8a h4e y51ec ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h4e y51ed ff1a fs28 fc0 sc0 ls0 ws0">if ((buf.c_lflag &amp; (ECHO | ICANON)) || buf.c_cc[VMIN] != 1 ||</div><div class="t m0 x194 h4e y51ee ff1a fs28 fc0 sc0 ls0 ws0">buf.c_cc[VTIME] != 0) {</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
