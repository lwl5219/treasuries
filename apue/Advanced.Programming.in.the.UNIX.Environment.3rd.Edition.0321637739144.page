<div id="pf90" class="pf w4 h1f" data-page-no="90"><div class="pc pc90 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg90.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls153 ws0">11<span class="_ _2"></span><span class="ls0">0<span class="_ _1b"> </span><span class="ff19">Files <span class="_"> </span>and <span class="_"> </span>Directories <span class="_ _199"> </span>Chapter<span class="_ _4b"> </span>4</span></span></div><div class="t m0 x32 h2a y12f ff19 fsf fc0 sc0 ls0 ws0">These <span class="_ _9"></span>four <span class="_ _23"></span>functions <span class="_ _23"></span>operate <span class="_ _9"></span>similarly <span class="_ _23"></span>unless <span class="_ _9"></span>the <span class="_ _23"></span>refer<span class="_ _0"></span>enced <span class="_ _9"></span>ﬁle <span class="_ _23"> </span>is <span class="_ _23"></span>a <span class="_ _9"></span>symbolic <span class="_ _23"></span>link.<span class="_ _5a"> </span>In</div><div class="t m0 x32 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">that <span class="_ _9"></span>case,<span class="_ _35"> </span><span class="ff1a">lchown<span class="_ _45"> </span></span>and<span class="_ _35"> </span><span class="ff1a">fchownat<span class="_ _45"> </span></span>(with <span class="_ _9"></span>the<span class="_ _35"> </span><span class="ff1a">AT_SYMLINK_NOFOLLOW<span class="_ _45"> </span></span>ﬂag <span class="_ _23"></span>set) <span class="_ _9"></span>change</div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">the owners of the symbolic link itself, not the ﬁle pointed to by the symbolic link.</div><div class="t m0 x3f h26 y132 ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _35"> </span><span class="ff1a">fchown<span class="_ _45"> </span></span>function <span class="_ _23"> </span>changes <span class="_ _23"> </span>the <span class="_ _23"></span>ownership <span class="_ _23"></span>of <span class="_ _23"></span>the <span class="_ _23"></span>open <span class="_ _23"></span>ﬁle <span class="_ _23"></span>r<span class="_ _0"></span>eferenced <span class="_ _9"></span>by <span class="_ _23"> </span>the<span class="_ _35"> </span><span class="ff1b">fd</span></div><div class="t m0 x32 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">argument. <span class="_"> </span>Since<span class="_ _47"> </span>it <span class="_ _3"></span>operates <span class="_ _3"></span>on <span class="_ _2"></span>a <span class="_ _3"></span>ﬁle <span class="_ _2"></span>that <span class="_ _3"></span>is <span class="_ _3"></span>already <span class="_ _2"></span>open, <span class="_ _2"></span>it <span class="_ _3"></span>can’t <span class="_ _3"></span>be <span class="_ _2"></span>used <span class="_ _3"></span>to <span class="_ _2"></span>change <span class="_ _3"></span>the</div><div class="t m0 x32 h2a y134 ff19 fsf fc0 sc0 ls0 ws0">ownership of a symbolic link.</div><div class="t m0 x3f h26 y135 ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _45"> </span><span class="ff1a">fchownat<span class="_ _35"> </span></span>function <span class="_ _9"></span>behaves <span class="_ _23"></span>like <span class="_ _9"></span>either<span class="_ _35"> </span><span class="ff1a">chown<span class="_ _45"> </span></span>or<span class="_ _35"> </span><span class="ff1a">lchown<span class="_ _45"> </span></span>when <span class="_ _23"></span>the<span class="_ _45"> </span><span class="ff1b">pathname</span></div><div class="t m0 x32 h26 y136 ff19 fsf fc0 sc0 ls0 ws0">argument <span class="_ _66"> </span>is <span class="_ _47"> </span>absolute <span class="_ _47"> </span>or <span class="_ _47"> </span>when <span class="_ _45"> </span>the<span class="_ _61"> </span><span class="ff1b">fd<span class="_ _61"> </span></span>argument <span class="_ _47"> </span>has <span class="_ _47"> </span>the <span class="_ _47"> </span>value<span class="_ _16"> </span><span class="ff1a">AT_FDCWD<span class="_ _61"> </span></span>and <span class="_ _45"> </span>the</div><div class="t m0 x32 h26 y137 ff1b fsf fc0 sc0 ls0 ws0">pathname<span class="_ _16"> </span><span class="ff19">argument <span class="_ _47"> </span>is <span class="_ _47"> </span>relative. <span class="_ _16"> </span>In<span class="_ _16"> </span>these <span class="_ _45"> </span>cases,<span class="_ _16"> </span><span class="ff1a">fchownat<span class="_ _16"> </span></span>acts <span class="_ _45"> </span>like<span class="_ _61"> </span><span class="ff1a">lchown<span class="_"> </span></span>if <span class="_ _47"> </span>the</span></div><div class="t m0 x32 h26 y138 ff1a fsf fc0 sc0 ls0 ws0">AT_SYMLINK_NOFOLLOW<span class="_ _61"> </span><span class="ff19">ﬂag <span class="_ _45"> </span>is <span class="_ _66"> </span>set <span class="_ _45"> </span>in <span class="_ _66"> </span>the<span class="_ _16"> </span><span class="ff1b">ﬂag<span class="_ _16"> </span></span>argument, <span class="_ _47"> </span>or <span class="_ _47"> </span>it <span class="_ _47"> </span>acts <span class="_ _47"> </span>like<span class="_ _16"> </span></span>chown<span class="_ _16"> </span><span class="ff19">if</span></div><div class="t m0 x32 h26 y139 ff19 fsf fc0 sc0 ls0 ws0">the<span class="_ _46"> </span><span class="ff1a">AT_SYMLINK_NOFOLLOW<span class="_ _46"> </span></span>ﬂag <span class="_"> </span>is <span class="_"> </span>clear<span class="_ _1"></span><span class="ls4eb">.W<span class="_ _49"></span><span class="ls0">hen <span class="_ _66"> </span>the<span class="_ _46"> </span><span class="ff1b">fd<span class="_ _46"> </span></span>argument <span class="_"> </span>is <span class="_"> </span>set <span class="_ _66"> </span>to <span class="_"> </span>the <span class="_ _66"> </span>ﬁle</span></span></div><div class="t m0 x32 h2b y13a ff19 fsf fc0 sc0 ls0 ws0">descriptor <span class="_"> </span>of <span class="_ _e"> </span>an <span class="_"> </span>open <span class="_ _e"> </span>directory <span class="_ _e"> </span>and <span class="_"> </span>the<span class="_ _4b"> </span><span class="ff1b">pathname<span class="_ _59"> </span></span>argument <span class="_"> </span>is <span class="_ _53"> </span>a <span class="_"> </span>relative <span class="_ _e"> </span>pathname,</div><div class="t m0 x32 h26 y254 ff1a fsf fc0 sc0 ls0 ws0">fchownat<span class="_ _80"> </span><span class="ff19">evaluates the<span class="_"> </span><span class="ff1b">pathname<span class="_"> </span></span><span class="ls45">re<span class="_ _2"></span></span>lative to the open directory<span class="_ _4"></span>.</span></div><div class="t m0 x3f h2a y255 ff19 fsf fc0 sc0 ls0 ws0">Historically<span class="_ _4"></span><span class="ls4ec">,B<span class="_ _64"></span><span class="ls0">SD</span></span></div><div class="t m0 x188 h2a yfe6 ff19 fsf fc0 sc0 ls0 ws0">-</div><div class="t m0 x134 h2a y255 ff19 fsf fc0 sc0 ls0 ws0">based <span class="_ _59"> </span>systems <span class="_ _59"> </span>have <span class="_ _59"> </span>enforced <span class="_ _59"> </span>the <span class="_ _59"> </span>restriction <span class="_ _59"> </span>that <span class="_ _59"> </span>only <span class="_ _59"> </span>the</div><div class="t m0 x32 h2a y13b ff19 fsf fc0 sc0 ls0 ws0">superuser can change <span class="_ _2"></span>the ownership <span class="_ _2"></span>of a <span class="_ _2"></span>ﬁle.<span class="_ _46"> </span>This <span class="_ _2"></span>is to <span class="_ _2"></span>prevent users from giving <span class="_ _2"></span>away</div><div class="t m0 x32 h2a y13c ff19 fsf fc0 sc0 ls0 ws0">their <span class="_"> </span>ﬁles <span class="_ _e"> </span>to <span class="_"> </span>others, <span class="_"> </span>ther<span class="_ _1"></span>eby <span class="_"> </span>defeating <span class="_"> </span>any <span class="_ _e"> </span>disk <span class="_"> </span>space <span class="_"> </span>quota <span class="_ _e"> </span>restrictions. <span class="_ _59"> </span>System<span class="_ _59"> </span><span class="ls4ed">V,</span></div><div class="t m0 x32 h2a y256 ff19 fsf fc0 sc0 ls0 ws0">however<span class="_ _6"></span><span class="ls44">,h<span class="_ _5"></span><span class="ls0">as allowed all users to change the ownership of any ﬁles they own.</span></span></div><div class="t m0 x76 h51 yfe7 ff19 fs2a fc0 sc0 ls0 ws0">POSIX.1 <span class="_ _7f"> </span>allows <span class="_ _5e"> </span>either <span class="_ _7f"> </span>form <span class="_ _7f"> </span>of <span class="_ _7f"> </span>operation, <span class="_ _5e"> </span>depending <span class="_ _7f"> </span>on <span class="_ _7f"> </span>the <span class="_ _5e"> </span>value <span class="_ _7f"> </span>of</div><div class="t m0 x76 h52 yfe8 ff1a fs2a fc0 sc0 ls0 ws0">_POSIX_CHOWN_RESTRICTED<span class="ff19">.</span></div><div class="t m0 x76 h51 yfe9 ff19 fs2a fc0 sc0 ls341 ws0">Wi<span class="_ _2"></span><span class="ls0">th <span class="_ _9"></span>Solaris <span class="_ _3"></span>10, <span class="_ _9"></span>this <span class="_ _9"></span>functionality <span class="_ _3"></span>is <span class="_ _9"></span>a <span class="_ _3"></span>conﬁguration <span class="_ _9"></span>option, <span class="_ _3"></span>whose <span class="_ _9"></span>default <span class="_ _9"></span>value <span class="_ _3"></span>is <span class="_ _9"></span>to <span class="_ _3"></span>enforce</span></div><div class="t m0 x76 h52 yfea ff19 fs2a fc0 sc0 ls0 ws0">the <span class="_"> </span>r<span class="_ _0"></span>estriction. <span class="_ _35"> </span>FreeBSD <span class="_ _42"> </span>8.0, <span class="_"> </span>Linux <span class="_ _42"> </span>3.2.0, <span class="_"> </span>and <span class="_"> </span>Mac <span class="_ _42"> </span>OS <span class="_"> </span>X <span class="_ _42"> </span>10.6.8 <span class="_"> </span>always <span class="_"> </span>enfor<span class="_ _0"></span>ce <span class="_"> </span>the<span class="_ _35"> </span><span class="ff1a">chown</span></div><div class="t m0 x76 h51 yfeb ff19 fs2a fc0 sc0 ls34e ws0">re<span class="ls0">striction.</span></div><div class="t m0 x32 h26 yfec ff19 fsf fc0 sc0 ls0 ws0">Recall <span class="_ _9"></span>from <span class="_ _3"></span>Section <span class="_ _9"></span>2.6 <span class="_ _23"></span>that <span class="_ _3"></span>the<span class="_ _45"> </span><span class="ff1a">_POSIX_CHOWN_RESTRICTED<span class="_ _45"> </span></span>constant <span class="_ _23"></span>can <span class="_ _9"></span>optionally</div><div class="t m0 x32 h26 yfed ff19 fsf fc0 sc0 ls0 ws0">be <span class="_ _53"> </span>deﬁned <span class="_ _e"> </span>in <span class="_ _e"> </span>the <span class="_ _e"> </span>header<span class="_ _4b"> </span><span class="ff1a">&lt;unistd.h&gt;</span><span class="ls4ee">,a<span class="_ _c"></span><span class="ls0">nd <span class="_ _53"> </span>can <span class="_ _e"> </span>always <span class="_ _e"> </span>be <span class="_ _e"> </span>queried <span class="_ _e"> </span>using <span class="_ _e"> </span>either <span class="_ _e"> </span>the</span></span></div><div class="t m0 x32 h26 yfee ff1a fsf fc0 sc0 ls0 ws0">pathconf<span class="_"> </span><span class="ff19">function <span class="_ _47"> </span>or <span class="_ _45"> </span>the<span class="_ _16"> </span></span>fpathconf<span class="_"> </span><span class="ff19">function. <span class="_ _16"> </span>Also<span class="_ _5a"> </span><span class="ls45">re<span class="_ _2"></span></span>call <span class="_ _45"> </span>that <span class="_ _47"> </span>this <span class="_ _45"> </span>option <span class="_ _45"> </span>can</span></div><div class="t m0 x32 h2a yfef ff19 fsf fc0 sc0 ls0 ws0">depend <span class="_ _9"></span>on <span class="_ _9"></span>the <span class="_ _23"></span>r<span class="_ _0"></span>eferenced <span class="_ _3"></span>ﬁle; <span class="_ _23"></span>it <span class="_ _9"></span>can <span class="_ _9"></span>be <span class="_ _9"></span>enabled <span class="_ _23"></span>or <span class="_ _9"></span>disabled <span class="_ _9"></span>on <span class="_ _9"></span>a <span class="_ _9"></span>per <span class="_ _23"></span>ﬁle <span class="_ _9"></span>system <span class="_ _9"></span>basis.</div><div class="t m0 x32 h26 yff0 ff19 fsf fc0 sc0 ls5f ws0">We<span class="_ _9"></span><span class="ls0">’ll <span class="_"> </span>use <span class="_ _66"> </span>the <span class="_"> </span>phrase <span class="_ _66"> </span>‘‘if<span class="_ _59"> </span><span class="ff1a">_POSIX_CHOWN_RESTRICTED<span class="_ _46"> </span></span>is <span class="_ _66"> </span>in <span class="_ _66"> </span>effect,’<span class="_ _1"></span>’<span class="_ _61"> </span>to<span class="_ _46"> </span>mean <span class="_"> </span>‘‘if <span class="_"> </span>it</span></div><div class="t m0 x32 h2a yff1 ff19 fsf fc0 sc0 ls0 ws0">applies <span class="_ _2"></span>to <span class="_ _3"></span>the <span class="_ _3"></span>particular <span class="_ _3"></span>ﬁle <span class="_ _3"></span>that <span class="_ _3"></span>we’r<span class="ls4ef">et<span class="_ _8"></span><span class="ls0">alking <span class="_ _2"></span>about,’<span class="ls4ef">’r<span class="_ _b"></span><span class="ls0">egardless <span class="_ _2"></span>of <span class="_ _3"></span>whether <span class="_ _3"></span>this <span class="_ _3"></span>actual</span></span></span></span></div><div class="t m0 x32 h2a yff2 ff19 fsf fc0 sc0 ls0 ws0">constant is deﬁned in the header<span class="_ _6"></span>.</div><div class="t m0 x3f h26 yff3 ff19 fsf fc0 sc0 ls0 ws0">If<span class="_"> </span><span class="ff1a">_POSIX_CHOWN_RESTRICTED<span class="_ _80"> </span></span>is in effect for the speciﬁed ﬁle, then</div><div class="t m0 x3f h2a yff4 ff19 fsf fc0 sc0 ls0 ws0">1. <span class="_ _51"> </span>Only<span class="_"> </span><span class="ls44">as<span class="_ _d"></span><span class="ls0">uperuser process can change the user ID of the ﬁle.</span></span></div><div class="t m0 x3f h2a yff5 ff19 fsf fc0 sc0 ls0 ws0">2. <span class="_ _51"> </span>A<span class="_ _47"> </span>nonsuperuser <span class="_ _2"></span>process <span class="_ _3"></span>can <span class="_ _3"></span>change <span class="_ _2"></span>the <span class="_ _3"></span>group <span class="_ _3"></span>ID <span class="_ _2"></span>of <span class="_ _3"></span>the <span class="_ _3"></span>ﬁle <span class="_ _3"></span>if <span class="_ _3"></span>the <span class="_ _3"></span>process <span class="_ _2"></span>owns</div><div class="t m0 x41 h2b yff6 ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _2"></span>ﬁle <span class="_ _3"></span>(the <span class="_ _3"></span>effective <span class="_ _3"></span>user <span class="_ _3"></span>ID <span class="_ _2"></span>equals <span class="_ _3"></span>the <span class="_ _3"></span>user <span class="_ _3"></span>ID <span class="_ _3"></span>of <span class="_ _3"></span>the <span class="_ _3"></span>ﬁle),<span class="_ _47"> </span><span class="ff1b">owner<span class="_ _47"> </span></span>is <span class="_ _3"></span>speciﬁed <span class="_ _3"></span>as</div><div class="t m0 x41 h2b yff7 ff20 fsf fc0 sc0 ls0 ws0">−<span class="ff19">1<span class="_"> </span>or<span class="_"> </span>equals the user ID of <span class="_ _2"></span>the ﬁle, and<span class="_"> </span><span class="ff1b">group<span class="_"> </span></span>equals either the effective group ID</span></div><div class="t m0 x41 h2a yff8 ff19 fsf fc0 sc0 ls0 ws0">of the process or one of the pr<span class="_ _0"></span>ocess’s supplementary gr<span class="_ _0"></span>oup IDs.</div><div class="t m0 x32 h26 yff9 ff19 fsf fc0 sc0 ls0 ws0">This <span class="_ _9"></span>means <span class="_ _3"></span>that <span class="_ _9"></span>when<span class="_ _45"> </span><span class="ff1a">_POSIX_CHOWN_RESTRICTED<span class="_ _45"> </span></span>is <span class="_ _9"></span>in <span class="_ _3"></span>effect, <span class="_ _9"></span>you <span class="_ _9"></span>can’t <span class="_ _9"></span>change <span class="_ _3"></span>the</div><div class="t m0 x32 h2a yffa ff19 fsf fc0 sc0 ls0 ws0">user <span class="_ _23"></span>ID <span class="_ _9"></span>of <span class="_ _23"> </span>your <span class="_ _23"></span>ﬁles.<span class="_ _5a"> </span><span class="ls5f">Yo<span class="_ _23"></span><span class="ls485">uc<span class="_ _43"></span><span class="ls0">an <span class="_ _23"> </span>change <span class="_ _23"></span>the <span class="_ _23"></span>gr<span class="_ _0"></span>oup <span class="_ _23"></span>ID <span class="_ _9"></span>of <span class="_ _23"> </span>ﬁles <span class="_ _23"></span>that <span class="_ _23"></span>you <span class="_ _9"></span>own, <span class="_ _23"></span>but <span class="_ _23"></span>only <span class="_ _9"></span>to</span></span></span></div><div class="t m0 x32 h2a yffb ff19 fsf fc0 sc0 ls0 ws0">groups that you belong to.</div><div class="t m0 x3f h2a yffc ff19 fsf fc0 sc0 ls0 ws0">If <span class="_ _47"> </span>these <span class="_ _45"> </span>functions <span class="_ _47"> </span>ar<span class="ls4f0">ec<span class="_ _62"></span><span class="ls0">alled <span class="_ _47"> </span>by <span class="_ _45"> </span>a <span class="_ _47"> </span>process <span class="_ _47"> </span>other <span class="_ _45"> </span>than <span class="_ _47"> </span>a <span class="_ _47"> </span>superuser <span class="_ _45"> </span>pr<span class="_ _0"></span>ocess, <span class="_ _47"> </span>on</span></span></div><div class="t m0 x32 h2a yffd ff19 fsf fc0 sc0 ls0 ws0">successful return, both the set-user<span class="_ _0"></span>-ID and the set-gr<span class="_ _0"></span>oup-ID bits ar<span class="ls44">ec<span class="_ _4f"></span><span class="ls0">leared.</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
