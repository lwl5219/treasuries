<div id="pf9d" class="pf w4 h1f" data-page-no="9d"><div class="pc pc9d w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg9d.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>4.18<span class="_ _1a9"> </span>Creating <span class="_"> </span>and <span class="_"> </span>Reading <span class="_"> </span>Symbolic <span class="_"> </span>Links<span class="_ _1b"> </span><span class="ff18">123</span></div><div class="t m0 x3f h57 yf5f ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">ln -s /no/such/file myfile<span class="_ _82"> </span><span class="ff1b">create a symbolic link</span></span></div><div class="t m0 x3f h57 yf60 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">ls myfile</span></div><div class="t m0 x3f h57 yf61 ff1a fs2d fc0 sc0 ls0 ws0">myfile <span class="_ _37"> </span>ls<span class="_"> </span><span class="ff1b">says it’<span class="_ _1"></span><span class="ls110">st<span class="_ _84"></span><span class="ls0">here</span></span></span></div><div class="t m0 x3f h57 yf62 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">cat myfile<span class="_ _1aa"> </span><span class="ff1b">so we try to look at it</span></span></div><div class="t m0 x3f h57 yf63 ff1a fs2d fc0 sc0 ls0 ws0">cat: myfile: No such file or directory</div><div class="t m0 x3f h57 yf64 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">ls -l myfile<span class="_ _1ab"> </span><span class="ff1b">try<span class="_"> </span></span></span>-l<span class="_ _e"> </span><span class="ff1b">option</span></div><div class="t m0 x3f h57 yf65 ff1a fs2d fc0 sc0 ls0 ws0">lrwxrwxrwx <span class="_"> </span>1<span class="_"> </span>sar <span class="_ _189"> </span>13<span class="_"> </span>Jan 22 00:26 myfile -&gt; /no/such/file</div><div class="t m0 x32 h26 y11b4 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _53"> </span>ﬁle<span class="_ _44"> </span><span class="ff1a">myfile<span class="_ _4b"> </span></span>does <span class="_ _42"> </span>exist, <span class="_ _53"> </span>yet<span class="_ _4b"> </span><span class="ff1a">cat<span class="_ _44"> </span></span>says <span class="_ _53"> </span>there<span class="_ _44"> </span>is<span class="_ _4b"> </span>no<span class="_ _44"> </span>such <span class="_ _53"> </span>ﬁle, <span class="_ _53"> </span>because<span class="_ _4b"> </span><span class="ff1a">myfile<span class="_ _44"> </span></span>is <span class="_ _53"> </span>a</div><div class="t m0 x32 h26 y11b5 ff19 fsf fc0 sc0 ls0 ws0">symbolic <span class="_ _3"></span>link <span class="_ _9"></span>and <span class="_ _3"></span>the <span class="_ _9"></span>ﬁle <span class="_ _3"></span>pointed <span class="_ _9"></span>to <span class="_ _3"></span>by <span class="_ _9"></span>the <span class="_ _3"></span>symbolic <span class="_ _9"></span>link <span class="_ _3"></span>doesn’t <span class="_ _9"></span>exist.<span class="_ _16"> </span>The<span class="_ _45"> </span><span class="ff1a">-l<span class="_ _47"> </span></span>option</div><div class="t m0 x32 h26 y11b6 ff19 fsf fc0 sc0 ls0 ws0">to<span class="_ _45"> </span><span class="ff1a">ls<span class="_ _45"> </span></span>gives <span class="_ _9"></span>us <span class="_ _9"></span>two <span class="_ _23"></span>hints: <span class="_ _9"></span>the <span class="_ _9"></span>ﬁrst <span class="_ _23"></span>character <span class="_ _9"></span>is <span class="_ _9"></span>an<span class="_ _45"> </span><span class="ff1a">l</span><span class="ls571">,w<span class="_ _b"></span><span class="ls0">hich <span class="_ _9"></span>means <span class="_ _9"></span>a <span class="_ _23"></span>symbolic <span class="_ _9"></span>link, <span class="_ _9"></span>and</span></span></div><div class="t m0 x32 h26 y11b7 ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _23"></span>sequence<span class="_ _35"> </span><span class="ff1a">-&gt;<span class="_ _45"> </span></span>also <span class="_ _23"> </span>indicates <span class="_ _23"> </span>a <span class="_ _23"> </span>symbolic <span class="_ _23"> </span>link.<span class="_ _51"> </span>The<span class="_ _35"> </span><span class="ff1a">ls<span class="_ _35"> </span></span>command <span class="_ _23"></span>has <span class="_ _23"></span>another <span class="_ _23"></span>option</div><div class="t m0 x32 h26 y11b8 ff19 fsf fc0 sc0 ls0 ws0">(<span class="ff1a">-F</span><span class="ls572">)t<span class="_ _4f"></span><span class="ls0">hat <span class="_ _2"></span>appends <span class="_ _2"></span>an <span class="_ _3"></span>at-sign <span class="_ _2"></span>(@) <span class="_ _2"></span>to <span class="_ _3"></span>ﬁlenames <span class="_ _2"></span>that <span class="_ _2"></span>ar<span class="ls572">es<span class="_ _4f"></span><span class="ls0">ymbolic <span class="_ _2"></span>links, <span class="_ _2"></span>which <span class="_ _2"></span>can <span class="_ _3"></span>help <span class="_ _2"></span>us</span></span></span></span></div><div class="t m0 x32 h26 y11b9 ff19 fsf fc0 sc0 ls0 ws0">spot symbolic links in a directory listing without the<span class="_"> </span><span class="ff1a">-l<span class="_ _80"> </span></span>option.</div><div class="t m0 x35 h4b y11ba ff16 fs27 fc0 sc0 ls0 ws0">4.18 <span class="_ _93"> </span>Creating<span class="_ _54"> </span>and <span class="_"> </span>Reading <span class="_"> </span>Symbolic <span class="_"> </span>Links</div><div class="t m0 x32 h4d y11bb ff19 fs26 fc0 sc0 lsd3 ws0">As<span class="_ _d"></span><span class="ls0">ymbolic link is created with either the<span class="_"> </span><span class="ff1a">symlink<span class="_ _80"> </span></span>or<span class="_"> </span><span class="ff1a">symlinkat<span class="_ _80"> </span></span>function.</span></div><div class="t m0 x3f h4e y11bc ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;unistd.h&gt;</div><div class="t m0 x3f h4e y11bd ff1a fs28 fc0 sc0 ls0 ws0">int symlink(const char *<span class="ff1b">actualpath</span><span class="ls1b6">,c<span class="_ _1d"></span><span class="ls0">onst char *<span class="ff1b">sympath</span>);</span></span></div><div class="t m0 x3f h4e y11be ff1a fs28 fc0 sc0 ls0 ws0">int symlinkat(const char *<span class="ff1b">actualpath</span><span class="ls1b6">,i<span class="_ _1d"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">fd</span><span class="ls1b6">,c<span class="_ _5b"></span><span class="ls0">onst char *<span class="ff1b">sympath</span>);</span></span></span></span></div><div class="t m0 x1af h7c y11bf ff19 fs28 fc0 sc0 ls0 ws0">Both return: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>err<span class="_ _0"></span>or</div><div class="t m0 x32 h60 y11c0 ff19 fs2c fc0 sc0 ls573 ws0">An<span class="_ _43"></span><span class="ls0">ew <span class="_ _23"> </span>directory <span class="_ _23"> </span>entry<span class="_ _6"></span>,<span class="_ _35"> </span><span class="ff1b">sympath</span>,<span class="_ _44"> </span>is<span class="_ _35"> </span>c<span class="ls150">re</span>ated <span class="_ _42"> </span>that <span class="_ _42"> </span>points <span class="_ _23"> </span>to<span class="_ _44"> </span><span class="ff1b">actualpath</span><span class="ls574">.I<span class="_ _52"></span><span class="ls0">t<span class="_ _44"> </span>is<span class="_ _35"> </span>not <span class="_ _42"> </span>r<span class="_ _0"></span>equired</span></span></span></div><div class="t m0 x32 h60 y11c1 ff19 fs2c fc0 sc0 ls0 ws0">that<span class="_ _45"> </span><span class="ff1b">actualpath<span class="_ _45"> </span></span>exist <span class="_ _9"></span>when <span class="_ _9"></span>the <span class="_ _9"></span>symbolic <span class="_ _9"></span>link <span class="_ _9"></span>is <span class="_ _9"></span>created. <span class="_ _45"> </span>(W<span class="_ _6"></span><span class="ls575">es<span class="_ _b"></span><span class="ls0">aw <span class="_ _9"></span>this <span class="_ _9"></span>in <span class="_ _9"></span>the <span class="_ _9"></span>example <span class="_ _9"></span>at</span></span></div><div class="t m0 x32 h60 y11c2 ff19 fs2c fc0 sc0 ls0 ws0">the <span class="_ _42"> </span>end <span class="_ _42"> </span>of <span class="_ _42"> </span>the <span class="_ _42"> </span>previous <span class="_ _23"> </span>section.)<span class="_ _54"> </span>Also,<span class="_ _44"> </span><span class="ff1b">actualpath<span class="_ _44"> </span></span>and<span class="_ _35"> </span><span class="ff1b">sympath<span class="_ _44"> </span></span>need <span class="_ _42"> </span>not <span class="_ _42"> </span>reside <span class="_ _42"> </span>in <span class="_ _42"> </span>the</div><div class="t m0 x32 h55 y11c3 ff19 fs2c fc0 sc0 ls0 ws0">same ﬁle system.</div><div class="t m0 x3f h54 y11c4 ff19 fs2c fc0 sc0 ls0 ws0">The<span class="_ _61"> </span><span class="ff1a">symlinkat<span class="_ _61"> </span></span>function <span class="_ _47"> </span>is <span class="_ _47"> </span>similar <span class="_ _47"> </span>to<span class="_ _61"> </span><span class="ff1a">symlink</span><span class="ls576">,b<span class="_ _5b"></span><span class="ls0">ut <span class="_ _47"> </span>the<span class="_ _61"> </span><span class="ff1b">sympath<span class="_ _61"> </span></span>argument <span class="_ _47"> </span>is</span></span></div><div class="t m0 x32 h55 y11c5 ff19 fs2c fc0 sc0 ls0 ws0">evaluated <span class="_ _47"> </span>relative <span class="_ _47"> </span>to <span class="_ _45"> </span>the <span class="_ _47"> </span>directory <span class="_ _47"> </span>referenced <span class="_ _47"> </span>by <span class="_ _47"> </span>the <span class="_ _45"> </span>open <span class="_ _47"> </span>ﬁle <span class="_ _45"> </span>descriptor <span class="_ _47"> </span>for <span class="_ _45"> </span>that</div><div class="t m0 x32 h60 y11c6 ff19 fs2c fc0 sc0 ls0 ws0">directory <span class="_ _3"></span>(speciﬁed <span class="_ _9"></span>by <span class="_ _9"></span>the<span class="_ _47"> </span><span class="ff1b">fd<span class="_ _45"> </span></span>argument). <span class="_ _47"> </span>If<span class="_ _45"> </span>the<span class="_ _45"> </span><span class="ff1b">sympath<span class="_ _45"> </span></span>ar<span class="_ _0"></span>gument <span class="_ _3"></span>speciﬁes <span class="_ _9"></span>an <span class="_ _9"></span>absolute</div><div class="t m0 x32 h54 y11c7 ff19 fs2c fc0 sc0 ls0 ws0">pathname <span class="_"> </span>or <span class="_ _e"> </span>if <span class="_"> </span>the<span class="_ _4b"> </span><span class="ff1b">fd<span class="_ _59"> </span></span>argument <span class="_ _e"> </span>has <span class="_"> </span>the <span class="_ _e"> </span>special <span class="_"> </span>value<span class="_ _4b"> </span><span class="ff1a">AT_FDCWD</span><span class="ls577">,t<span class="_ _55"></span><span class="ls0">hen<span class="_ _59"> </span><span class="ff1a">symlinkat</span></span></span></div><div class="t m0 x32 h54 y11c8 ff19 fs2c fc0 sc0 ls0 ws0">behaves the same way as<span class="_"> </span><span class="ff1a">symlink</span>.</div><div class="t m0 x3f h54 y11c9 ff19 fs2c fc0 sc0 ls0 ws0">Because <span class="_ _2"></span>the<span class="_ _47"> </span><span class="ff1a">open<span class="_ _47"> </span></span>function <span class="_ _2"></span>follows <span class="_ _3"></span>a <span class="_ _3"></span>symbolic <span class="_ _2"></span>link, <span class="_ _3"></span>we <span class="_ _3"></span>need <span class="_ _2"></span>a <span class="_ _3"></span>way <span class="_ _2"></span>to <span class="_ _3"></span>open <span class="_ _3"></span>the <span class="_ _2"></span>link</div><div class="t m0 x32 h54 y11ca ff19 fs2c fc0 sc0 ls0 ws0">itself and read the name in the link.<span class="_ _46"> </span>The<span class="_"> </span><span class="ff1a">readlink<span class="_ _66"> </span></span>and<span class="_"> </span><span class="ff1a">readlinkat<span class="_ _66"> </span></span>functions do this.</div><div class="t m0 x3f h5d y11cb ff1a fs2f fc0 sc0 ls0 ws0">#include &lt;unistd.h&gt;</div><div class="t m0 x3f h5d y11cc ff1a fs2f fc0 sc0 ls0 ws0">ssize_t readlink(const char* restrict<span class="_"> </span><span class="ff1b">pathname</span><span class="ls395">,c<span class="_ _1d"></span><span class="ls0">har *restrict<span class="_"> </span><span class="ff1b">buf</span>,</span></span></div><div class="t m0 x8b h5d y11cd ff1a fs2f fc0 sc0 ls0 ws0">size_t<span class="_"> </span><span class="ff1b">bufsize</span>);</div><div class="t m0 x3f h5d y11ce ff1a fs2f fc0 sc0 ls0 ws0">ssize_t readlinkat(int<span class="_"> </span><span class="ff1b">fd</span><span class="ls395">,c<span class="_ _1d"></span><span class="ls0">onst char* restrict<span class="_"> </span><span class="ff1b">pathname</span>,</span></span></div><div class="t m0 xa5 h5d y11cf ff1a fs2f fc0 sc0 ls0 ws0">char *restrict<span class="_"> </span><span class="ff1b">buf</span><span class="ls395">,s<span class="_ _1d"></span><span class="ls0">ize_t<span class="_"> </span><span class="ff1b">bufsize</span>);</span></span></div><div class="t m0 xc6 hc2 y11d0 ff19 fs2f fc0 sc0 ls0 ws0">Both return: number of bytes r<span class="_ _0"></span>ead if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><a class="l" href="#pfd" data-dest-detail='[13,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892634px;bottom:852.200980px;width:264.731697px;height:19.679016px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
