<div id="pf62" class="pf w4 h1f" data-page-no="62"><div class="pc pc62 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg62.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">64<span class="_ _1b"> </span><span class="ff19">File <span class="_"> </span>I/O<span class="_ _169"> </span>Chapter <span class="_"> </span>3</span></div><div class="t m0 x32 h26 y12f ff1a fsf fc0 sc0 ls0 ws0">O_TTY_INIT<span class="_ _6e"> </span><span class="ff19">When <span class="_ _47"> </span>opening <span class="_ _47"> </span>a <span class="_ _47"> </span>terminal <span class="_ _45"> </span>device <span class="_ _47"> </span>that <span class="_ _47"> </span>is <span class="_ _47"> </span>not <span class="_ _47"> </span>already <span class="_ _47"> </span>open, <span class="_ _47"> </span>set <span class="_ _47"> </span>the</span></div><div class="t m0 xf6 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">nonstandard<span class="_"> </span><span class="ff1a">termios<span class="_ _66"> </span></span>parameters <span class="_ _2"></span>to <span class="_ _2"></span>values <span class="_ _2"></span>that <span class="_ _2"></span>result <span class="_ _2"></span>in <span class="_ _2"></span>behavior <span class="_ _2"></span>that</div><div class="t m0 xf6 h26 y131 ff19 fsf fc0 sc0 ls0 ws0">conforms <span class="_ _42"> </span>to <span class="_ _42"> </span>the <span class="_ _53"> </span>Single <span class="_ _42"> </span>UNIX <span class="_ _42"> </span>Speciﬁcation.<span class="_ _54"> </span><span class="ls5f">We <span class="_ _35"> </span>d<span class="_ _9"></span></span>iscuss <span class="_ _42"> </span>the<span class="_ _44"> </span><span class="ff1a">termios</span></div><div class="t m0 xf6 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">structur<span class="_ _0"></span><span class="ls44">ew<span class="_ _d"></span><span class="ls0">hen we discuss terminal I/O in Chapter 18.</span></span></div><div class="t m0 x32 h2a y1fc ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _2"></span>following <span class="_ _3"></span>two <span class="_ _3"></span>ﬂags <span class="_ _3"></span>ar<span class="ls34f">ea<span class="_ _8"></span><span class="ls0">lso <span class="_ _3"></span>optional.<span class="_ _16"> </span>They <span class="_ _3"></span>ar<span class="ls34f">ep<span class="_ _8"></span><span class="ls0">art <span class="_ _2"></span>of <span class="_ _3"></span>the <span class="_ _3"></span>synchronized <span class="_ _3"></span>input <span class="_ _3"></span>and</span></span></span></span></div><div class="t m0 x32 h2a y1fd ff19 fsf fc0 sc0 ls0 ws0">output option of the Single UNIX Speciﬁcation (and thus POSIX.1).</div><div class="t m0 x32 h26 y348 ff1a fsf fc0 sc0 ls0 ws0">O_DSYNC<span class="_ _14"> </span><span class="ff19">Have <span class="_ _2"></span>each<span class="_ _47"> </span></span>write<span class="_ _47"> </span><span class="ff19">wait <span class="_ _2"></span>for <span class="_ _3"></span>physical <span class="_ _3"></span>I/O <span class="_ _3"></span>to <span class="_ _2"></span>complete, <span class="_ _3"></span>but <span class="_ _3"></span>don’t <span class="_ _3"></span>wait <span class="_ _2"></span>for</span></div><div class="t m0 xf6 h2a y349 ff19 fsf fc0 sc0 ls0 ws0">ﬁle <span class="_ _23"></span>attributes <span class="_ _23"></span>to <span class="_ _23"> </span>be <span class="_ _23"> </span>updated <span class="_ _23"> </span>if <span class="_ _23"> </span>they <span class="_ _23"> </span>don’t <span class="_ _23"> </span>affect <span class="_ _23"></span>the <span class="_ _23"></span>ability <span class="_ _23"> </span>to <span class="_ _23"> </span>read <span class="_ _23"></span>the</div><div class="t m0 xf6 h2a y1d2 ff19 fsf fc0 sc0 ls0 ws0">data just written.</div><div class="t m0 x38 h52 ya43 ff19 fs2a fc0 sc0 ls0 ws0">The<span class="_ _80"> </span><span class="ff1a">O_DSYNC<span class="_ _80"> </span></span>and<span class="_ _80"> </span><span class="ff1a">O_SYNC<span class="_ _80"> </span></span>ﬂags <span class="_ _2"></span>ar<span class="ls350">es<span class="_ _5"></span><span class="ls0">imilar<span class="_ _1"></span><span class="ls350">,b<span class="_ _5"></span><span class="ls0">ut <span class="_ _2"></span>subtly <span class="_ _2"></span>different. <span class="_ _e"> </span>The<span class="_ _80"> </span><span class="ff1a">O_DSYNC<span class="_ _66"> </span></span>ﬂag</span></span></span></span></div><div class="t m0 x38 h51 ya44 ff19 fs2a fc0 sc0 ls0 ws0">affects a ﬁle’s attributes <span class="_ _2"></span>only when they <span class="_ _2"></span>need to <span class="_ _2"></span>be updated to <span class="_ _2"></span>reﬂect a change in <span class="_ _2"></span>the</div><div class="t m0 x38 h52 ya45 ff19 fs2a fc0 sc0 ls0 ws0">ﬁle’s data <span class="_ _2"></span>(for <span class="_ _2"></span>example, update <span class="_ _2"></span>the <span class="_ _2"></span>ﬁle’s <span class="_ _2"></span>size to <span class="_ _2"></span>reﬂect mor<span class="ls351">ed<span class="_ _5"></span><span class="ls0">ata). <span class="_ _e"> </span>With the<span class="_"> </span><span class="ff1a">O_SYNC</span></span></span></div><div class="t m0 x38 h51 ya46 ff19 fs2a fc0 sc0 ls0 ws0">ﬂag, <span class="_ _9"></span>data <span class="_ _9"></span>and <span class="_ _23"> </span>attributes <span class="_ _9"></span>ar<span class="ls352">ea<span class="_ _8"></span><span class="ls0">lways <span class="_ _9"></span>updated <span class="_ _9"> </span>synchronously<span class="_ _6"></span><span class="ls353">.W<span class="_ _4a"></span><span class="ls0">hen <span class="_ _9"> </span>overwriting <span class="_ _23"> </span>an</span></span></span></span></div><div class="t m0 x38 h52 ya47 ff19 fs2a fc0 sc0 ls0 ws0">existing <span class="_ _42"> </span>part <span class="_ _42"> </span>of <span class="_"> </span>a <span class="_ _42"> </span>ﬁle <span class="_ _42"> </span>opened <span class="_ _42"> </span>with <span class="_ _42"> </span>the<span class="_ _35"> </span><span class="ff1a">O_DSYNC<span class="_ _35"> </span></span>ﬂag, <span class="_ _42"> </span>the <span class="_ _42"> </span>ﬁle <span class="_ _42"> </span>times <span class="_"> </span>wouldn’t <span class="_ _23"> </span>be</div><div class="t m0 x38 h52 ya48 ff19 fs2a fc0 sc0 ls0 ws0">updated synchronously<span class="_ _6"></span><span class="ls354">.I<span class="_ _43"></span><span class="ls355">nc<span class="_ _d"></span><span class="ls0">ontrast, <span class="_ _2"></span>if <span class="_ _2"></span>we had <span class="_ _2"></span>opened <span class="_ _2"></span>the ﬁle <span class="_ _2"></span>with <span class="_ _2"></span>the<span class="_"> </span><span class="ff1a">O_SYNC<span class="_ _80"> </span></span>ﬂag,</span></span></span></div><div class="t m0 x38 h52 ya49 ff19 fs2a fc0 sc0 ls0 ws0">every<span class="_ _45"> </span><span class="ff1a">write<span class="_ _35"> </span></span>to <span class="_ _42"> </span>the <span class="_"> </span>ﬁle <span class="_ _42"> </span>would <span class="_ _42"> </span>update <span class="_ _42"> </span>the <span class="_"> </span>ﬁle’s <span class="_ _42"> </span>times <span class="_ _42"> </span>befor<span class="ls356">et<span class="_ _43"></span><span class="ls0">he<span class="_ _35"> </span><span class="ff1a">write<span class="_ _35"> </span></span><span class="ls34e">re</span>turns,</span></span></div><div class="t m0 x38 h51 ya4a ff19 fs2a fc0 sc0 ls34e ws0">re<span class="ls0">gardless of whether we wer<span class="lse9">ew<span class="_ _5"></span><span class="ls0">riting over existing bytes or appending to the ﬁle.</span></span></span></div><div class="t m0 x32 h26 ya4b ff1a fsf fc0 sc0 ls0 ws0">O_RSYNC<span class="_ _14"> </span><span class="ff19">Have each<span class="_ _66"> </span></span>read<span class="_ _66"> </span><span class="ff19">operation <span class="_ _2"></span>on <span class="_ _2"></span>the <span class="_ _2"></span>ﬁle descriptor <span class="_ _2"></span>wait <span class="_ _2"></span>until <span class="_ _2"></span>any pending</span></div><div class="t m0 xf6 h2a ya4c ff19 fsf fc0 sc0 ls0 ws0">writes for the same portion of the ﬁle ar<span class="ls44">ec<span class="_ _4f"></span><span class="ls0">omplete.</span></span></div><div class="t m0 x38 h51 ya4d ff19 fs2a fc0 sc0 ls0 ws0">Solaris <span class="_ _9"></span>10 <span class="_ _3"></span>supports <span class="_ _9"></span>all <span class="_ _9"></span>three <span class="_ _3"></span>synchronization <span class="_ _9"></span>ﬂags.<span class="_ _59"> </span>Historically<span class="_ _6"></span><span class="ls357">,F<span class="_ _4f"></span><span class="ls34e">re<span class="_ _2"></span><span class="ls0">eBSD <span class="_ _3"></span>(and <span class="_ _9"> </span>thus</span></span></span></div><div class="t m0 x38 h52 ya4e ff19 fs2a fc0 sc0 ls0 ws0">Mac <span class="_ _9"></span>OS <span class="_ _9"></span>X) <span class="_ _9"></span>have <span class="_ _9"></span>used <span class="_ _9"></span>the<span class="_ _66"> </span><span class="ff1a">O_FSYNC<span class="_ _47"> </span></span>ﬂag, <span class="_ _9"></span>which <span class="_ _9"></span>has <span class="_ _9"></span>the <span class="_ _9"></span>same <span class="_ _9"></span>behavior <span class="_ _9"></span>as<span class="_ _66"> </span><span class="ff1a">O_SYNC</span>.</div><div class="t m0 x38 h51 ya4f ff19 fs2a fc0 sc0 ls0 ws0">Because <span class="_ _9"></span>the <span class="_ _9"></span>two <span class="_ _9"></span>ﬂags <span class="_ _9"></span>ar<span class="ls358">ee<span class="_ _8"></span><span class="ls0">quivalent, <span class="_ _9"></span>they <span class="_ _9"></span>deﬁne <span class="_ _9"></span>the <span class="_ _9"></span>ﬂags <span class="_ _9"></span>to <span class="_ _9"></span>have <span class="_ _9"></span>the <span class="_ _9"></span>same <span class="_ _9"> </span>value.</span></span></div><div class="t m0 x38 h52 ya50 ff19 fs2a fc0 sc0 ls0 ws0">FreeBSD <span class="_ _23"> </span>8.0 <span class="_ _42"> </span>doesn’t <span class="_ _42"> </span>support <span class="_ _42"> </span>the<span class="_ _45"> </span><span class="ff1a">O_DSYNC<span class="_ _35"> </span></span>or<span class="_ _45"> </span><span class="ff1a">O_RSYNC<span class="_ _45"> </span></span>ﬂags. <span class="_ _35"> </span>Mac<span class="_ _45"> </span>OS <span class="_ _42"> </span>X <span class="_ _42"> </span>doesn’t</div><div class="t m0 x38 h52 ya51 ff19 fs2a fc0 sc0 ls0 ws0">support <span class="_ _2"></span>the<span class="_ _66"> </span><span class="ff1a">O_RSYNC<span class="_ _80"> </span></span>ﬂag, <span class="_ _3"></span>but <span class="_ _2"></span>deﬁnes <span class="_ _3"></span>the<span class="_ _66"> </span><span class="ff1a">O_DSYNC<span class="_ _80"> </span></span>ﬂag, <span class="_ _3"></span>treating <span class="_ _2"></span>it <span class="_ _2"></span>the <span class="_ _3"></span>same <span class="_ _3"></span>as <span class="_ _3"></span>the</div><div class="t m0 x38 h52 ya52 ff1a fs2a fc0 sc0 ls0 ws0">O_SYNC<span class="_ _47"> </span><span class="ff19">ﬂag. <span class="_ _47"> </span>Linux<span class="_ _47"> </span>3.2.0 <span class="_ _23"> </span>supports <span class="_ _9"></span>the<span class="_ _47"> </span></span>O_DSYNC<span class="_ _47"> </span><span class="ff19">ﬂag, <span class="_ _23"> </span>but <span class="_ _23"> </span>treats <span class="_ _9"></span>the<span class="_ _47"> </span></span>O_RSYNC<span class="_ _47"> </span><span class="ff19">ﬂag</span></div><div class="t m0 x38 h52 ya53 ff19 fs2a fc0 sc0 ls0 ws0">the same as<span class="_"> </span><span class="ff1a">O_SYNC</span>.</div><div class="t m0 x3f h26 ya54 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _23"></span>ﬁle <span class="_ _9"></span>descriptor <span class="_ _23"> </span>returned <span class="_ _23"></span>by<span class="_ _45"> </span><span class="ff1a">open<span class="_ _35"> </span></span>and<span class="_ _45"> </span><span class="ff1a">openat<span class="_ _35"> </span></span>is <span class="_ _23"></span>guaranteed <span class="_ _9"></span>to <span class="_ _23"> </span>be <span class="_ _23"> </span>the <span class="_ _23"></span>lowest-</div><div class="t m0 x32 h2a ya55 ff19 fsf fc0 sc0 ls0 ws0">numbered <span class="_ _2"></span>unused <span class="_ _2"></span>descriptor<span class="_ _1"></span><span class="ls359">.T<span class="_ _1d"></span><span class="ls0">his <span class="_ _3"></span>fact <span class="_ _3"></span>is <span class="_ _3"></span>used <span class="_ _2"></span>by <span class="_ _3"></span>some <span class="_ _3"></span>applications <span class="_ _3"></span>to <span class="_ _3"></span>open <span class="_ _2"></span>a <span class="_ _3"></span>new <span class="_ _3"></span>ﬁle</span></span></div><div class="t m0 x32 h2a ya56 ff19 fsf fc0 sc0 ls0 ws0">on <span class="_ _e"> </span>standar<span class="ls35a">di<span class="_ _4a"></span><span class="ls0">nput, <span class="_"> </span>standar<span class="_ _0"></span><span class="ls35a">do<span class="_ _55"></span><span class="ls0">utput, <span class="_ _53"> </span>or <span class="_"> </span>standar<span class="_ _0"></span><span class="ls35a">de<span class="_ _55"></span><span class="ls0">rror<span class="_ _6"></span><span class="ls35b">.F<span class="_ _64"></span><span class="ls0">or <span class="_ _e"> </span>example, <span class="_ _e"> </span>an <span class="_ _e"> </span>application</span></span></span></span></span></span></span></span></div><div class="t m0 x32 h2a ya57 ff19 fsf fc0 sc0 ls0 ws0">might <span class="_ _9"></span>close <span class="_ _9"></span>standar<span class="ls63">do<span class="_ _b"></span><span class="ls0">utput <span class="_ _a"></span>— <span class="_ _a"></span>normally<span class="_ _6"></span><span class="ls63">,ﬁ<span class="_ _b"></span><span class="ls0">le <span class="_ _9"></span>descriptor <span class="_ _9"></span>1<span class="_ _9"></span><span class="ls9d">—a<span class="_ _6"></span><span class="ls0">nd <span class="_ _23"></span>then <span class="_ _9"></span>open <span class="_ _9"></span>another <span class="_ _9"></span>ﬁle,</span></span></span></span></span></span></div><div class="t m0 x32 h2a ya58 ff19 fsf fc0 sc0 ls0 ws0">knowing <span class="_ _2"></span>that <span class="_ _3"></span>it <span class="_ _3"></span>will <span class="_ _3"></span>be <span class="_ _3"></span>opened <span class="_ _3"></span>on <span class="_ _3"></span>ﬁle <span class="_ _2"></span>descriptor <span class="_ _3"></span>1.<span class="_ _16"> </span><span class="ls5f">We<span class="_ _9"></span></span>’ll <span class="_ _3"></span>see <span class="_ _3"></span>a <span class="_ _3"></span>better <span class="_ _3"></span>way <span class="_ _3"></span>to <span class="_ _2"></span>guarantee</div><div class="t m0 x32 h26 ya59 ff19 fsf fc0 sc0 ls0 ws0">that <span class="_ _53"> </span>a <span class="_ _53"> </span>ﬁle <span class="_ _53"> </span>is <span class="_ _53"> </span>open <span class="_ _53"> </span>on <span class="_ _53"> </span>a <span class="_ _53"> </span>given <span class="_ _53"> </span>descriptor <span class="_ _53"> </span>in <span class="_ _e"> </span>Section <span class="_ _53"> </span>3.12, <span class="_ _53"> </span>when <span class="_ _53"> </span>we <span class="_ _53"> </span>explor<span class="ls35c">et<span class="_ _55"></span><span class="ls0">he<span class="_ _4b"> </span><span class="ff1a">dup2</span></span></span></div><div class="t m0 x32 h2a ya5a ff19 fsf fc0 sc0 ls0 ws0">function.</div><div class="t m0 x3f h26 ya5b ff19 fsf fc0 sc0 ls0 ws0">The<span class="_"> </span><span class="ff1b">fd<span class="_ _66"> </span></span>parameter <span class="_ _2"></span>distinguishes <span class="_ _2"></span>the<span class="_"> </span><span class="ff1a">openat<span class="_ _47"> </span></span>function from the<span class="_ _66"> </span><span class="ff1a">open<span class="_ _66"> </span></span>function. <span class="_ _66"> </span>There</div><div class="t m0 x32 h2a ya5c ff19 fsf fc0 sc0 ls0 ws0">ar<span class="ls44">et<span class="_ _4f"></span><span class="ls0">hree possibilities:</span></span></div><div class="t m0 x32 h2b ya5d ff19 fsf fc0 sc0 ls0 ws0">1. <span class="_ _51"> </span>The<span class="_ _47"> </span><span class="ff1b">path<span class="_ _66"> </span></span>parameter <span class="_ _3"></span>speciﬁes <span class="_ _3"></span>an <span class="_ _2"></span>absolute <span class="_ _3"></span>pathname.<span class="_ _61"> </span>In <span class="_ _3"></span>this <span class="_ _2"></span>case, <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1b">fd<span class="_ _66"> </span></span>parameter <span class="_ _3"></span>is</div><div class="t m0 x150 h26 ya5e ff19 fsf fc0 sc0 ls0 ws0">ignored and the<span class="_"> </span><span class="ff1a">openat<span class="_ _80"> </span></span>function behaves like the<span class="_"> </span><span class="ff1a">open<span class="_ _80"> </span></span>function.</div><div class="t m0 x32 h2b ya5f ff19 fsf fc0 sc0 ls0 ws0">2. <span class="_ _51"> </span>The<span class="_ _59"> </span><span class="ff1b">path<span class="_ _46"> </span></span>parameter <span class="_"> </span>speciﬁes <span class="_"> </span>a <span class="_ _e"> </span>relative <span class="_"> </span>pathname <span class="_ _e"> </span>and <span class="_"> </span>the<span class="_ _59"> </span><span class="ff1b">fd<span class="_ _59"> </span></span>parameter <span class="_"> </span>is <span class="_"> </span>a <span class="_"> </span>ﬁle</div><div class="t m0 x150 h2a ya60 ff19 fsf fc0 sc0 ls0 ws0">descriptor <span class="_ _42"> </span>that <span class="_ _42"> </span>speciﬁes <span class="_ _42"> </span>the <span class="_ _42"> </span>starting <span class="_ _42"> </span>location <span class="_ _42"> </span>in <span class="_ _42"> </span>the <span class="_ _53"> </span>ﬁle <span class="_ _42"> </span>system <span class="_ _42"> </span>wher<span class="ls35d">et<span class="_ _c"></span><span class="ls0">he <span class="_ _42"> </span>relative</span></span></div><div class="t m0 x150 h2b ya61 ff19 fsf fc0 sc0 ls0 ws0">pathname <span class="_ _2"></span>is <span class="_ _2"></span>to <span class="_ _2"></span>be <span class="_ _2"></span>evaluated.<span class="_ _61"> </span>The<span class="_ _47"> </span><span class="ff1b">fd<span class="_ _47"> </span></span>parameter is <span class="_ _3"></span>obtained <span class="_ _2"></span>by <span class="_ _2"></span>opening <span class="_ _2"></span>the <span class="_ _3"></span>directory</div><div class="t m0 x150 h2a ya62 ff19 fsf fc0 sc0 ls0 ws0">wher<span class="ls44">et<span class="_ _4f"></span><span class="ls0">he relative pathname is to be evaluated.</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
