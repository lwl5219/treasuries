<div id="pf3c9" class="pf w4 h1f" data-page-no="3c9"><div class="pc pc3c9 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg3c9.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Appendix <span class="_"> </span>C<span class="_ _89"> </span>Chapter <span class="_"> </span>15<span class="_ _54"> </span>Solutions<span class="_ _1b"> </span><span class="ff18">935</span></div><div class="t m0 xe2 h2a y12f ff19 fsf fc0 sc0 ls0 ws0">The following table shows the values calculated for our four platforms.</div><div class="t m0 x5b h2d y623c ff19 fs10 fc0 sc0 ls0 ws0">Platform <span class="_ _12b"> </span>Pipe<span class="_"> </span>Capacity (bytes)</div><div class="t m0 x1cf h2e y623d ff19 fs11 fc0 sc0 ls0 ws0">FreeBSD 8.0<span class="_ _be"> </span>65,536</div><div class="t m0 x1cf h2e y623e ff19 fs11 fc0 sc0 ls0 ws0">Linux 3.2.0<span class="_ _b3"> </span>65,536</div><div class="t m0 x1cf h2e y623f ff19 fs11 fc0 sc0 ls0 ws0">Mac OS X 10.6.8<span class="_ _13b"> </span>16,384</div><div class="t m0 x1cf h2e y6240 ff19 fs11 fc0 sc0 ls0 ws0">Solaris 10<span class="_ _b5"> </span>16,384</div><div class="t m0 xe2 h5c y6241 ff19 fs29 fc0 sc0 ls0 ws0">These <span class="_ _45"> </span>values <span class="_ _47"> </span>can <span class="_ _45"> </span>differ <span class="_ _47"> </span>from <span class="_ _47"> </span>the <span class="_ _45"> </span>corresponding<span class="_ _16"> </span><span class="ff1a">PIPE_BUF<span class="_"> </span></span>values, <span class="_ _47"> </span>because</div><div class="t m0 xe2 h5c y6242 ff1a fs29 fc0 sc0 ls0 ws0">PIPE_BUF<span class="_ _66"> </span><span class="ff19">is deﬁned <span class="_ _2"></span>to <span class="_ _2"></span>be <span class="_ _2"></span>the <span class="_ _2"></span>maximum amount <span class="_ _2"></span>of <span class="_ _2"></span>data <span class="_ _2"></span>that can <span class="_ _2"></span>be <span class="_ _2"></span>written <span class="_ _2"></span>to a</span></div><div class="t m0 xe2 h5b y6243 ff19 fs29 fc0 sc0 ls0 ws0">pipe<span class="_ _59"> </span><span class="ff1b">atomically</span><span class="ls1869">.H<span class="_ _5d"></span><span class="ls0">ere, <span class="_"> </span>we <span class="_ _e"> </span>calculate <span class="_"> </span>the <span class="_ _e"> </span>amount <span class="_"> </span>of <span class="_"> </span>data <span class="_ _e"> </span>that <span class="_"> </span>a <span class="_ _e"> </span>pipe <span class="_"> </span>can <span class="_"> </span>hold</span></span></div><div class="t m0 xe2 h50 y6244 ff19 fs29 fc0 sc0 ls0 ws0">independent of any atomicity constraints.</div><div class="t m0 x32 h50 y6245 ff18 fs29 fc0 sc0 ls0 ws0">14.10<span class="_ _5f"> </span><span class="ff19">Whether <span class="_ _23"></span>the <span class="_ _9"></span>program <span class="_ _9"></span>in <span class="_ _23"> </span>Figur<span class="ls186a">e1<span class="_ _b"></span><span class="ls0">4.27 <span class="_ _9"></span>updates <span class="_ _23"></span>the <span class="_ _9"></span>last-access <span class="_ _23"></span>time <span class="_ _23"></span>for <span class="_ _9"></span>the <span class="_ _23"></span>input</span></span></span></div><div class="t m0 xe2 h50 y6246 ff19 fs29 fc0 sc0 ls0 ws0">ﬁle <span class="_ _2"></span>depends <span class="_ _2"></span>on <span class="_ _2"></span>the operating <span class="_ _2"></span>system <span class="_ _2"></span>and <span class="_ _2"></span>the <span class="_ _2"></span>type <span class="_ _2"></span>of <span class="_ _2"></span>ﬁle <span class="_ _2"></span>system <span class="_ _2"></span>in <span class="_ _2"></span>which <span class="_ _2"></span>the <span class="_ _2"></span>ﬁle</div><div class="t m0 xe2 h50 y6247 ff19 fs29 fc0 sc0 lsdf ws0">re<span class="ls0">sides. <span class="_ _46"> </span>On<span class="_ _59"> </span>all <span class="_"> </span>four <span class="_"> </span>platforms, <span class="_ _e"> </span>the <span class="_"> </span>last-access <span class="_"> </span>time <span class="_ _e"> </span>is <span class="_"> </span>updated <span class="_"> </span>when <span class="_ _e"> </span>the <span class="_"> </span>ﬁle</span></div><div class="t m0 xe2 h50 y6248 ff19 fs29 fc0 sc0 lsdf ws0">re<span class="ls0">sides in the default ﬁle system type for the given operating system.</span></div><div class="t m0 x35 h5a y6249 ff16 fs29 fc0 sc0 ls0 ws0">Chapter <span class="_"> </span>15</div><div class="t m0 x32 h50 y624a ff18 fs29 fc0 sc0 ls0 ws0">15.1<span class="_ _210"> </span><span class="ff19">If <span class="_ _9"></span>the <span class="_ _9"></span>write <span class="_ _9"></span>end <span class="_ _9"></span>of <span class="_ _9"></span>the <span class="_ _3"></span>pipe <span class="_ _9"></span>is <span class="_ _9"></span>never <span class="_ _9"></span>closed, <span class="_ _9"></span>the <span class="_ _9"></span>reader <span class="_ _3"></span>never <span class="_ _9"></span>sees <span class="_ _9"></span>an <span class="_ _9"></span>end <span class="_ _3"></span>of <span class="_ _9"></span>ﬁle.</span></div><div class="t m0 xe2 h50 y624b ff19 fs29 fc0 sc0 ls0 ws0">The pager program blocks for<span class="_ _0"></span>ever r<span class="_ _0"></span>eading from its standar<span class="_ _0"></span><span class="lsdd">di<span class="_ _d"></span><span class="ls0">nput.</span></span></div><div class="t m0 x32 h50 y624c ff18 fs29 fc0 sc0 ls0 ws0">15.2<span class="_ _210"> </span><span class="ff19">The parent terminates right after writing the last line to the pipe.<span class="_ _46"> </span>The read end of</span></div><div class="t m0 xe2 h50 y624d ff19 fs29 fc0 sc0 ls0 ws0">the <span class="_ _23"> </span>pipe <span class="_ _23"> </span>is <span class="_ _42"> </span>automatically <span class="_ _23"> </span>closed <span class="_ _42"> </span>when <span class="_ _23"></span>the <span class="_ _23"> </span>parent <span class="_ _23"> </span>terminates.<span class="_ _51"> </span>But <span class="_ _42"> </span>the <span class="_ _23"> </span>parent <span class="_ _23"></span>is</div><div class="t m0 xe2 h50 y624e ff19 fs29 fc0 sc0 ls0 ws0">probably running ahead of the child by one <span class="_ _2"></span>pipe buffer<span class="_ _6"></span><span class="ls186b">,s<span class="_ _d"></span><span class="ls0">ince the <span class="_ _2"></span>child (the pager</span></span></div><div class="t m0 xe2 h50 y624f ff19 fs29 fc0 sc0 ls0 ws0">program) <span class="_ _3"></span>is <span class="_ _3"></span>waiting <span class="_ _9"></span>for <span class="_ _9"></span>us <span class="_ _3"></span>to <span class="_ _9"></span>look <span class="_ _9"></span>at <span class="_ _3"></span>a <span class="_ _9"></span>page <span class="_ _9"></span>of <span class="_ _3"></span>output.<span class="_ _5a"> </span>If <span class="_ _9"></span>we’r<span class="ls186c">er<span class="_ _b"></span><span class="ls0">unning <span class="_ _3"></span>a <span class="_ _9"></span>shell,</span></span></div><div class="t m0 xe2 h50 y6250 ff19 fs29 fc0 sc0 ls0 ws0">such <span class="_ _3"></span>as <span class="_ _9"></span>the <span class="_ _3"></span>Korn <span class="_ _9"></span>shell, <span class="_ _9"></span>with <span class="_ _3"></span>interactive <span class="_ _9"></span>command</div><div class="t m0 x101 h50 y6251 ff19 fs29 fc0 sc0 ls0 ws0">-</div><div class="t m0 x1ef h50 y6250 ff19 fs29 fc0 sc0 ls0 ws0">line <span class="_ _3"></span>editing <span class="_ _9"></span>enabled, <span class="_ _3"></span>the <span class="_ _9"></span>shell</div><div class="t m0 xe2 h50 y6252 ff19 fs29 fc0 sc0 ls0 ws0">probably <span class="_ _9"></span>changes <span class="_ _23"> </span>the <span class="_ _23"></span>terminal <span class="_ _23"></span>mode <span class="_ _23"></span>when <span class="_ _23"></span>our <span class="_ _9"></span>parent <span class="_ _23"></span>terminates <span class="_ _23"></span>and <span class="_ _23"></span>the <span class="_ _9"></span>shell</div><div class="t m0 xe2 h50 y6253 ff19 fs29 fc0 sc0 ls0 ws0">prints a prompt. <span class="_"> </span>This<span class="_"> </span>undoubtedly <span class="_ _2"></span>interferes with the pager program, which has</div><div class="t m0 xe2 h50 y6254 ff19 fs29 fc0 sc0 ls0 ws0">also <span class="_"> </span>modiﬁed <span class="_"> </span>the <span class="_ _e"> </span>terminal <span class="_"> </span>mode.<span class="_ _48"> </span>(Most <span class="_"> </span>pager <span class="_"> </span>programs <span class="_ _e"> </span>set <span class="_"> </span>the <span class="_"> </span>terminal <span class="_"> </span>to</div><div class="t m0 xe2 h50 y6255 ff19 fs29 fc0 sc0 ls0 ws0">noncanonical mode when awaiting input to proceed to the next page.)</div><div class="t m0 x32 h5c y6256 ff18 fs29 fc0 sc0 ls0 ws0">15.3<span class="_ _210"> </span><span class="ff19">The<span class="_ _45"> </span><span class="ff1a">popen<span class="_ _45"> </span></span>function <span class="_ _3"></span>returns <span class="_ _9"></span>a <span class="_ _3"></span>ﬁle <span class="_ _9"></span>pointer <span class="_ _9"></span>because <span class="_ _9"></span>the <span class="_ _3"></span>shell <span class="_ _9"></span>is <span class="_ _9"></span>executed.<span class="_ _5a"> </span>But <span class="_ _9"></span>the</span></div><div class="t m0 xe2 h50 y6257 ff19 fs29 fc0 sc0 ls0 ws0">shell can’t execute the nonexistent command, so it prints</div><div class="t m0 x175 h62 y6258 ff1a fs30 fc0 sc0 ls0 ws0">sh: line 1: ./a.out: No such file or directory</div><div class="t m0 xe2 h50 y6259 ff19 fs29 fc0 sc0 ls0 ws0">on <span class="_ _42"> </span>the <span class="_ _53"> </span>standar<span class="ls186d">de<span class="_ _c"></span><span class="ls0">rror <span class="_ _42"> </span>and <span class="_ _53"> </span>terminates <span class="_ _42"> </span>with <span class="_ _53"> </span>an <span class="_ _53"> </span>exit <span class="_ _42"> </span>status <span class="_ _53"> </span>of <span class="_ _53"> </span>127 <span class="_ _53"> </span>(although <span class="_ _42"> </span>the</span></span></div><div class="t m0 xe2 h5c y625a ff19 fs29 fc0 sc0 ls0 ws0">value <span class="_ _23"> </span>depends <span class="_ _42"> </span>on <span class="_ _23"></span>the <span class="_ _23"> </span>type <span class="_ _42"> </span>of <span class="_ _23"> </span>shell).<span class="_ _51"> </span><span class="ff1a">pclose<span class="_ _35"> </span></span><span class="lsdf">re<span class="_ _2"></span></span>turns <span class="_ _42"> </span>the <span class="_ _23"></span>termination <span class="_ _23"> </span>status <span class="_ _42"> </span>of</div><div class="t m0 xe2 h5c y625b ff19 fs29 fc0 sc0 ls0 ws0">the command as it is returned by<span class="_"> </span><span class="ff1a">waitpid</span>.</div><div class="t m0 x32 h50 y625c ff18 fs29 fc0 sc0 ls0 ws0">15.4<span class="_ _210"> </span><span class="ff19">When <span class="_ _2"></span>the <span class="_ _3"></span>parent terminates, <span class="_ _2"></span>look <span class="_ _2"></span>at <span class="_ _2"></span>its <span class="_ _2"></span>termination <span class="_ _2"></span>status <span class="_ _3"></span>with <span class="_ _2"></span>the <span class="_ _2"></span>shell.<span class="_ _61"> </span>For <span class="_ _2"></span>the</span></div><div class="t m0 xe2 h5c y625d ff19 fs29 fc0 sc0 ls0 ws0">Bourne <span class="_ _2"></span>shell, <span class="_ _3"></span>Bourne-again <span class="_ _2"></span>shell, <span class="_ _3"></span>and <span class="_ _2"></span>Korn <span class="_ _3"></span>shell, <span class="_ _2"></span>the <span class="_ _3"></span>command <span class="_ _2"></span>is<span class="_ _47"> </span><span class="ff1a">echo <span class="_ _d"></span>$?<span class="ff19 ls186e">.T<span class="_ _1d"></span><span class="ls0">he</span></span></span></div><div class="t m0 xe2 h50 y625e ff19 fs29 fc0 sc0 ls0 ws0">number printed is 128 plus the signal number<span class="_ _6"></span>.</div><div class="t m0 x32 h50 y625f ff18 fs29 fc0 sc0 ls0 ws0">15.5<span class="_ _210"> </span><span class="ff19">First add the declaration</span></div><div class="t m0 x175 h62 y6260 ff1a fs30 fc0 sc0 ls0 ws0">FILE <span class="_ _68"> </span>*fpin,<span class="_"> </span>*fpout;</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
