<div id="pf33c" class="pf w4 h1f" data-page-no="33c"><div class="pc pc33c w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg33c.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">794<span class="_ _1b"> </span><span class="ff19">Communicating <span class="_"> </span>with <span class="_"> </span>a <span class="_"> </span>Network <span class="_"> </span>Printer<span class="_ _23b"> </span>Chapter <span class="_"> </span>21</span></div><div class="t m0 x32 h2a y12f ff19 fsf fc0 sc0 ls0 ws0">chapter<span class="_ _6"></span><span class="ls172d">,o<span class="_ _49"></span><span class="ls0">ur <span class="_ _61"> </span>interest <span class="_ _61"> </span>is <span class="_ _61"> </span>not <span class="_ _16"> </span>in <span class="_ _61"> </span>these <span class="_ _16"> </span>spooling <span class="_ _61"> </span>systems <span class="_ _16"> </span>per <span class="_ _61"> </span>se, <span class="_ _16"> </span>but <span class="_ _61"> </span>rather <span class="_ _16"> </span>in</span></span></div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">communicating <span class="_ _2"></span>with <span class="_ _2"></span>a <span class="_ _3"></span>network <span class="_ _2"></span>printer<span class="_ _1"></span><span class="ls3ee">.W<span class="_ _7"></span><span class="ls3ed">en<span class="_ _4f"></span><span class="ls0">eed <span class="_ _2"></span>to <span class="_ _3"></span>develop <span class="_ _2"></span>a <span class="_ _3"></span>spooling <span class="_ _2"></span>system <span class="_ _3"></span>to <span class="_ _2"></span>solve</span></span></span></div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">the problem of multiuser access to a single r<span class="_ _0"></span>esour<span class="_ _0"></span>ce (the printer).</div><div class="t m0 x3f h2a y132 ff19 fsf fc0 sc0 ls5f ws0">We <span class="_ _35"> </span>u<span class="_ _23"></span><span class="ls0">se <span class="_ _53"> </span>a <span class="_"> </span>simple <span class="_ _53"> </span>command <span class="_"> </span>that <span class="_ _53"> </span>reads <span class="_ _e"> </span>a <span class="_ _e"> </span>ﬁle <span class="_ _e"> </span>and <span class="_"> </span>sends <span class="_ _53"> </span>it <span class="_"> </span>to <span class="_ _53"> </span>the <span class="_ _e"> </span>printer <span class="_"> </span>spooler</span></div><div class="t m0 x32 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">daemon. <span class="_ _45"> </span>The<span class="_ _35"> </span>command <span class="_ _23"></span>has <span class="_ _9"></span>one <span class="_ _23"> </span>option <span class="_ _23"></span>to <span class="_ _9"></span>force <span class="_ _23"></span>the <span class="_ _9"></span>ﬁle <span class="_ _23"> </span>to <span class="_ _23"></span>be <span class="_ _23"></span>tr<span class="_ _0"></span>eated <span class="_ _23"></span>as <span class="_ _9"></span>plaintext <span class="_ _23"> </span>(the</div><div class="t m0 x32 h26 y134 ff19 fsf fc0 sc0 ls0 ws0">default assumes that the ﬁle is PostScript).<span class="_ _59"> </span><span class="ls5f">We <span class="_ _e"> </span>c<span class="_ _9"></span></span>all this command<span class="_"> </span><span class="ff1a">print</span>.</div><div class="t m0 x3f h26 y135 ff19 fsf fc0 sc0 ls0 ws0">In <span class="_ _9"></span>our <span class="_ _9"></span>printer <span class="_ _23"></span>spooler <span class="_ _9"></span>daemon,<span class="_ _45"> </span><span class="ff1a">printd</span>,<span class="_ _45"> </span>we<span class="_ _35"> </span>use <span class="_ _9"></span>multiple <span class="_ _9"></span>threads <span class="_ _9"></span>to <span class="_ _9"></span>divide <span class="_ _23"></span>up <span class="_ _9"></span>the</div><div class="t m0 x32 h2a y136 ff19 fsf fc0 sc0 ls0 ws0">work that the daemon needs to accomplish.</div><div class="t m0 x3f h2a y408 ff19 fsf fc0 sc0 ls49 ws0">•O<span class="_ _4d"></span><span class="ls0">ne <span class="_"> </span>thread <span class="_"> </span>listens <span class="_ _66"> </span>on <span class="_ _66"> </span>a <span class="_ _66"> </span>socket <span class="_ _66"> </span>for <span class="_ _66"> </span>new <span class="_ _66"> </span>print <span class="_ _66"> </span>requests <span class="_"> </span>arriving <span class="_ _66"> </span>from <span class="_"> </span>clients</span></div><div class="t m0 x15 h26 y409 ff19 fsf fc0 sc0 ls4e ws0">ru<span class="ls0">nning the<span class="_"> </span><span class="ff1a">print<span class="_ _80"> </span></span>command.</span></div><div class="t m0 x3f h2a y323 ff19 fsf fc0 sc0 ls49 ws0">•A<span class="_ _1d"></span><span class="ls0">separate <span class="_ _23"></span>thread <span class="_ _9"></span>is <span class="_ _9"></span>spawned <span class="_ _9"></span>for <span class="_ _23"></span>each <span class="_ _9"></span>client <span class="_ _23"></span>to <span class="_ _9"></span>copy <span class="_ _9"></span>the <span class="_ _23"></span>ﬁle <span class="_ _9"></span>to <span class="_ _23"></span>be <span class="_ _9"></span>printed <span class="_ _9"></span>to <span class="_ _23"></span>a</span></div><div class="t m0 x15 h2a y324 ff19 fsf fc0 sc0 ls0 ws0">spooling area.</div><div class="t m0 x3f h2a y59d5 ff19 fsf fc0 sc0 ls49 ws0">•O<span class="_ _4d"></span><span class="ls0">ne thread communicates <span class="_ _2"></span>with <span class="_ _2"></span>the <span class="_ _2"></span>printer<span class="_ _1"></span><span class="ls4bd">,s<span class="_ _4f"></span><span class="ls0">ending <span class="_ _2"></span>it <span class="_ _2"></span>queued jobs <span class="_ _2"></span>one <span class="_ _2"></span>at <span class="_ _2"></span>a <span class="_ _2"></span>time.</span></span></span></div><div class="t m0 x3f h2a y205 ff19 fsf fc0 sc0 ls49 ws0">•O<span class="_ _4d"></span><span class="ls0">ne thread handles signals.</span></div><div class="t m0 x32 h2a ya69 ff19 fsf fc0 sc0 ls0 ws0">Figur<span class="ls44">e2<span class="_ _4f"></span><span class="ls0">1.6 shows how these components ﬁt together<span class="_ _1"></span>.</span></span></div><div class="t m0 xc2 h2d y59d6 ff19 fs10 fc0 sc0 ls0 ws0">ﬁle to</div><div class="t m0 x167 h2d y59d7 ff19 fs10 fc0 sc0 ls0 ws0">print</div><div class="t m0 xe7 h4f y59d8 ff1a fs11 fc0 sc0 ls0 ws0">print</div><div class="t m0 x12f h2e y59d9 ff19 fs11 fc0 sc0 ls0 ws0">command</div><div class="t m0 x1a4 h6d y59da ff1a fs12 fc0 sc0 ls0 ws0">printd</div><div class="t m0 x1ac h2f y59db ff19 fs12 fc0 sc0 ls0 ws0">printer</div><div class="t m0 x67 h2f y59dc ff19 fs12 fc0 sc0 ls0 ws0">spooler</div><div class="t m0 x103 h30 y59dd ff19 fs13 fc0 sc0 ls0 ws0">ﬁle 1</div><div class="t m0 x5e h31 y59de ff19 fs14 fc0 sc0 ls0 ws0">ﬁle 2</div><div class="t m0 x19e h32 y59df ff19 fs15 fc0 sc0 ls0 ws0">ﬁle 3</div><div class="t m0 xa0 h33 y59e0 ff19 fs16 fc0 sc0 ls0 ws0">conﬁg ﬁle</div><div class="t m0 x1ac h39 y59e1 ff19 fs1c fc0 sc0 ls0 ws0">printer</div><div class="t m0 x101 h3c y59e2 ff19 fs1e fc0 sc0 ls0 ws0">queue of ﬁles to be printed</div><div class="t m0 x1d2 h3c y59e3 ff18 fs1e fc0 sc0 ls0 ws0">Figure 21.6<span class="_ _5a"> </span><span class="ff19">Printer spooling components</span></div><div class="t m0 x3f h1cc y59e4 ff19 fs4b fc0 sc0 ls0 ws0">The <span class="_ _2"></span>print <span class="_ _3"></span>conﬁguration <span class="_ _2"></span>ﬁle <span class="_ _3"></span>is<span class="_ _47"> </span><span class="ff1a">/etc/printer.conf</span><span class="ls172e">.I<span class="_ _1d"></span><span class="ls172f">ti<span class="_ _4f"></span><span class="ls0">dentiﬁes <span class="_ _3"></span>the <span class="_ _2"></span>host <span class="_ _3"></span>name <span class="_ _3"></span>of</span></span></span></div><div class="t m0 x32 h16b y59e5 ff19 fs4b fc0 sc0 ls0 ws0">the <span class="_ _e"> </span>server <span class="_ _e"> </span>running <span class="_ _e"> </span>the <span class="_ _e"> </span>printer <span class="_"> </span>spooling <span class="_ _53"> </span>daemon <span class="_ _e"> </span>and <span class="_"> </span>the <span class="_ _53"> </span>host <span class="_ _e"> </span>name <span class="_"> </span>of <span class="_ _53"> </span>the <span class="_ _e"> </span>network</div><div class="t m0 x32 h1cc y59e6 ff19 fs4b fc0 sc0 ls0 ws0">printer<span class="_ _6"></span><span class="ls1730">.T<span class="_ _7"></span><span class="ls0">he <span class="_ _42"> </span>spooling <span class="_ _42"> </span>daemon <span class="_ _23"> </span>is <span class="_ _42"> </span>identiﬁed <span class="_ _42"> </span>by <span class="_ _23"> </span>a <span class="_ _42"> </span>line <span class="_ _42"> </span>starting <span class="_ _42"> </span>with <span class="_ _23"> </span>the<span class="_ _44"> </span><span class="ff1a">printserver</span></span></span></div><div class="t m0 x32 h16b y59e7 ff19 fs4b fc0 sc0 ls0 ws0">keyword, <span class="_ _53"> </span>followed <span class="_"> </span>by <span class="_ _53"> </span>white <span class="_"> </span>space <span class="_ _53"> </span>and <span class="_ _e"> </span>the <span class="_"> </span>host <span class="_ _53"> </span>name <span class="_"> </span>of <span class="_ _53"> </span>the <span class="_"> </span>server<span class="_ _6"></span><span class="ls1731">.T<span class="_ _64"></span><span class="ls0">he <span class="_ _e"> </span>printer <span class="_ _e"> </span>is</span></span></div><div class="t m0 x32 h1cc y59e8 ff19 fs4b fc0 sc0 ls0 ws0">identiﬁed <span class="_ _9"></span>by <span class="_ _23"></span>a <span class="_ _9"></span>line <span class="_ _23"></span>starting <span class="_ _9"></span>with <span class="_ _23"></span>the<span class="_ _45"> </span><span class="ff1a">printer<span class="_ _45"> </span></span>keyword, <span class="_ _9"></span>followed <span class="_ _9"></span>by <span class="_ _23"></span>white <span class="_ _9"></span>space <span class="_ _23"></span>and</div><div class="t m0 x32 h16b y59e9 ff19 fs4b fc0 sc0 ls0 ws0">the host name of the printer<span class="_ _6"></span>.</div><div class="t m0 x3f h16b y59ea ff19 fs4b fc0 sc0 ls510 ws0">As<span class="_ _d"></span><span class="ls0">ample printer conﬁguration ﬁle might contain the following lines:</span></div><div class="t m0 xf6 hb6 y59eb ff1a fs60 fc0 sc0 ls0 ws0">printserver <span class="_ _5e"> </span>fujin</div><div class="t m0 xf6 hb6 y59ec ff1a fs60 fc0 sc0 ls0 ws0">printer <span class="_ _7b"> </span>phaser8560</div><div class="t m0 x32 h1cc y59ed ff19 fs4b fc0 sc0 ls0 ws0">where<span class="_ _35"> </span><span class="ff1a">fujin<span class="_ _44"> </span></span>is <span class="_ _42"> </span>the <span class="_ _42"> </span>host <span class="_ _42"> </span>name <span class="_ _42"> </span>of <span class="_ _53"> </span>the <span class="_ _42"> </span>computer <span class="_ _42"> </span>system <span class="_ _42"> </span>running <span class="_ _42"> </span>the <span class="_ _42"> </span>printer <span class="_ _42"> </span>spooling</div><div class="t m0 x32 h1cc y59ee ff19 fs4b fc0 sc0 ls0 ws0">daemon, <span class="_ _9"></span>and<span class="_ _35"> </span><span class="ff1a">phaser8560<span class="_ _45"> </span></span>is <span class="_ _9"></span>the <span class="_ _23"></span>host <span class="_ _9"></span>name <span class="_ _23"></span>of <span class="_ _9"></span>the <span class="_ _23"></span>network <span class="_ _9"></span>printer<span class="_ _1"></span><span class="ls1732">.W<span class="_ _64"></span><span class="ls1733">ea<span class="_ _b"></span><span class="ls0">ssume <span class="_ _9"></span>these</span></span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
