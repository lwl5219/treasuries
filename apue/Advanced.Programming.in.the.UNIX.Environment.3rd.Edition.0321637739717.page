<div id="pf2cd" class="pf w4 h1f" data-page-no="2cd"><div class="pc pc2cd w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg2cd.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>18.5<span class="_ _307"> </span><span class="ls719">Te<span class="_ _9"></span></span>rminal <span class="_"> </span>Option <span class="_"> </span>Flags<span class="_ _1b"> </span><span class="ff18">683</span></div><div class="t m0 x35 h53 y12f ff16 fs2b fc0 sc0 ls0 ws0">18.4 <span class="_ _93"> </span>Getting<span class="_ _54"> </span>and <span class="_"> </span>Setting <span class="_"> </span>T<span class="_ _1"></span>erminal <span class="_"> </span>Attrib<span class="_ _0"></span>utes</div><div class="t m0 x32 h26 y4fbf ff19 fsf fc0 sc0 ls5f ws0">To <span class="_ _54"> </span>g<span class="_ _9"></span><span class="ls0">et <span class="_ _59"> </span>and <span class="_ _59"> </span>set <span class="_ _59"> </span>a<span class="_ _48"> </span><span class="ff1a">termios<span class="_ _60"> </span></span>structur<span class="_ _0"></span>e, <span class="_ _4b"> </span>we <span class="_ _59"> </span>call <span class="_ _59"> </span>two <span class="_ _59"> </span>functions:<span class="_ _60"> </span><span class="ff1a">tcgetattr<span class="_ _48"> </span></span>and</span></div><div class="t m0 x32 h26 y4fc0 ff1a fsf fc0 sc0 ls0 ws0">tcsetattr<span class="ff19 ls45b">.T<span class="_ _62"></span><span class="ls0">his <span class="_ _9"></span>is <span class="_ _3"></span>how <span class="_ _9"></span>we <span class="_ _3"></span>examine <span class="_ _9"></span>and <span class="_ _3"></span>modify <span class="_ _9"></span>the <span class="_ _3"></span>various <span class="_ _9"></span>option <span class="_ _3"></span>ﬂags <span class="_ _9"></span>and <span class="_ _3"></span>special</span></span></div><div class="t m0 x32 h2a y4fc1 ff19 fsf fc0 sc0 ls0 ws0">characters to make the terminal operate the way we want it to.</div><div class="t m0 x3f h57 y4fc2 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;termios.h&gt;</div><div class="t m0 x3f h57 y4fc3 ff1a fs2d fc0 sc0 ls0 ws0">int tcgetattr(int<span class="_"> </span><span class="ff1b">fd</span><span class="ls15c">,s<span class="_ _1d"></span><span class="ls0">truct termios *<span class="ff1b">termptr</span>);</span></span></div><div class="t m0 x3f h57 y4fc4 ff1a fs2d fc0 sc0 ls0 ws0">int tcsetattr(int<span class="_"> </span><span class="ff1b">fd</span><span class="ls15c">,i<span class="_ _1d"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">opt</span><span class="ls15c">,c<span class="_ _5b"></span><span class="ls0">onst struct termios *<span class="ff1b">termptr</span>);</span></span></span></span></div><div class="t m0 x1af h5f y4fc5 ff19 fs2d fc0 sc0 ls0 ws0">Both return: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>err<span class="_ _0"></span>or</div><div class="t m0 x32 h4d y4fc6 ff19 fs26 fc0 sc0 ls0 ws0">Both <span class="_ _e"> </span>functions <span class="_"> </span>take <span class="_ _53"> </span>a <span class="_"> </span>pointer <span class="_ _53"> </span>to <span class="_"> </span>a<span class="_ _4b"> </span><span class="ff1a">termios<span class="_ _59"> </span></span>structur<span class="ls1493">ea<span class="_ _4a"></span><span class="ls0">nd <span class="_ _e"> </span>either <span class="_"> </span>r<span class="_ _0"></span>eturn <span class="_ _e"> </span>the <span class="_ _e"> </span>current</span></span></div><div class="t m0 x32 h49 y4fc7 ff19 fs26 fc0 sc0 ls0 ws0">terminal <span class="_ _42"> </span>attributes <span class="_ _42"> </span>or <span class="_ _42"> </span>set <span class="_ _53"> </span>the <span class="_ _42"> </span>terminal’s <span class="_ _42"> </span>attributes.<span class="_ _54"> </span>Since <span class="_ _53"> </span>these <span class="_ _42"> </span>two <span class="_ _42"> </span>functions <span class="_ _42"> </span>operate</div><div class="t m0 x32 h4d y4fc8 ff19 fs26 fc0 sc0 ls0 ws0">only <span class="_ _2"></span>on <span class="_ _2"></span>terminal <span class="_ _3"></span>devices,<span class="_ _47"> </span><span class="ff1a">errno<span class="_ _66"> </span></span>is <span class="_ _3"></span>set <span class="_ _2"></span>to<span class="_ _47"> </span><span class="ff1a">ENOTTY<span class="_ _47"> </span></span>and<span class="_ _66"> </span><span class="ff20">−</span>1<span class="_ _47"> </span>is<span class="_ _47"> </span>returned if<span class="_ _47"> </span><span class="ff1b">fd<span class="_ _47"> </span></span>does <span class="_ _2"></span>not <span class="_ _2"></span>refer</div><div class="t m0 x32 h49 y4fc9 ff19 fs26 fc0 sc0 ls0 ws0">to a terminal device.</div><div class="t m0 x3f h4d y4fca ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _9"></span>argument<span class="_ _45"> </span><span class="ff1b">opt<span class="_ _45"> </span></span>for<span class="_ _45"> </span><span class="ff1a">tcsetattr<span class="_ _35"> </span></span>lets <span class="_ _9"></span>us <span class="_ _9"></span>specify <span class="_ _23"></span>when <span class="_ _9"></span>we <span class="_ _23"></span>want <span class="_ _9"></span>the <span class="_ _23"></span>new <span class="_ _9"></span>terminal</div><div class="t m0 x32 h49 y4fcb ff19 fs26 fc0 sc0 ls0 ws0">attributes to take effect. <span class="_"> </span>This<span class="_"> </span>ar<span class="_ _0"></span>gument is speciﬁed as one of the following constants.</div><div class="t m0 x3f h4d y4fcc ff1a fs26 fc0 sc0 ls0 ws0">TCSANOW<span class="_ _78"> </span><span class="ff19">The change occurs immediately<span class="_ _4"></span>.</span></div><div class="t m0 x3f h4d y4fcd ff1a fs26 fc0 sc0 ls0 ws0">TCSADRAIN<span class="_ _6e"> </span><span class="ff19">The <span class="_ _2"></span>change <span class="_ _2"></span>occurs <span class="_ _2"></span>after all <span class="_ _2"></span>output <span class="_ _2"></span>has <span class="_ _2"></span>been <span class="_ _2"></span>transmitted.<span class="_ _61"> </span>This <span class="_ _2"></span>option</span></div><div class="t m0 xe7 h49 y4fce ff19 fs26 fc0 sc0 ls0 ws0">should be used if we ar<span class="lsd3">ec<span class="_ _4f"></span><span class="ls0">hanging the output parameters.</span></span></div><div class="t m0 x3f h4d y4fcf ff1a fs26 fc0 sc0 ls0 ws0">TCSAFLUSH<span class="_ _6e"> </span><span class="ff19">The <span class="_ _48"> </span>change <span class="_ _60"> </span>occurs <span class="_ _48"> </span>after <span class="_ _48"> </span>all <span class="_ _60"> </span>output <span class="_ _48"> </span>has <span class="_ _48"> </span>been <span class="_ _60"> </span>transmitted.</span></div><div class="t m0 xe7 h49 y4fd0 ff19 fs26 fc0 sc0 ls0 ws0">Furthermore, when the change takes place, all input data that has not</div><div class="t m0 xe7 h49 y4fd1 ff19 fs26 fc0 sc0 ls0 ws0">been read is discar<span class="_ _0"></span>ded (ﬂushed).</div><div class="t m0 x3f h4d y4fd2 ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _23"> </span>return <span class="_ _42"> </span>status <span class="_ _23"> </span>of<span class="_ _44"> </span><span class="ff1a">tcsetattr<span class="_ _35"> </span></span>can <span class="_ _42"> </span>be <span class="_ _23"> </span>confusing <span class="_ _42"> </span>to <span class="_ _42"> </span>use <span class="_ _23"> </span>correctly<span class="_ _4"></span><span class="ls1494">.T<span class="_ _7"></span><span class="ls0">his <span class="_ _42"> </span>function</span></span></div><div class="t m0 x32 h4a y4fd3 ff19 fs26 fc0 sc0 lscc ws0">re<span class="ls0">turns <span class="_ _42"> </span>OK <span class="_ _42"> </span>if <span class="_ _42"> </span>it <span class="_ _42"> </span>was <span class="_ _42"> </span>able <span class="_ _42"> </span>to <span class="_ _53"> </span>perform<span class="_ _44"> </span><span class="ff1b">any<span class="_ _35"> </span></span>of <span class="_ _42"> </span>the <span class="_ _42"> </span>requested <span class="_ _42"> </span>actions, <span class="_ _42"> </span>even <span class="_ _42"> </span>if <span class="_ _42"> </span>it <span class="_ _42"> </span>couldn’t</span></div><div class="t m0 x32 h49 y4fd4 ff19 fs26 fc0 sc0 ls0 ws0">perform <span class="_ _3"></span>all <span class="_ _9"></span>the <span class="_ _3"></span>requested <span class="_ _3"></span>actions.<span class="_ _16"> </span>If <span class="_ _9"></span>the <span class="_ _3"></span>function <span class="_ _9"></span>returns <span class="_ _3"></span>OK, <span class="_ _3"></span>it <span class="_ _9"></span>is <span class="_ _3"></span>our <span class="_ _9"></span>responsibility <span class="_ _3"></span>to</div><div class="t m0 x32 h49 y4fd5 ff19 fs26 fc0 sc0 ls0 ws0">see <span class="_ _42"> </span>whether <span class="_ _42"> </span>all <span class="_ _42"> </span>the <span class="_ _42"> </span>requested <span class="_ _23"> </span>actions <span class="_ _42"> </span>wer<span class="ls1495">ep<span class="_ _43"></span><span class="ls0">erformed. <span class="_ _35"> </span>This<span class="_ _44"> </span>means <span class="_ _42"> </span>that <span class="_ _42"> </span>after <span class="_ _42"> </span>we <span class="_ _42"> </span>call</span></span></div><div class="t m0 x32 h4d y4fd6 ff1a fs26 fc0 sc0 ls0 ws0">tcsetattr<span class="_ _47"> </span><span class="ff19">to <span class="_ _9"></span>set <span class="_ _9"></span>the <span class="_ _3"></span>desired <span class="_ _9"></span>attributes, <span class="_ _3"></span>we <span class="_ _9"></span>need <span class="_ _3"></span>to <span class="_ _9"></span>call<span class="_ _45"> </span></span>tcgetattr<span class="_ _47"> </span><span class="ff19">and <span class="_ _9"></span>compar<span class="ls1496">et<span class="_ _b"></span><span class="ls0">he</span></span></span></div><div class="t m0 x32 h49 y4fd7 ff19 fs26 fc0 sc0 ls0 ws0">actual terminal’s attributes to the desired attributes to detect any dif<span class="_ _0"></span>fer<span class="_ _0"></span>ences.</div><div class="t m0 x3f h49 y4fd8 ff19 fs26 fc0 sc0 ls0 ws0">What <span class="_ _9"></span>ar<span class="ls10ca">et<span class="_ _b"></span><span class="ls0">he <span class="_ _3"></span>attributes <span class="_ _9"></span>of <span class="_ _9"></span>a <span class="_ _23"></span>terminal <span class="_ _3"></span>we <span class="_ _9"></span>open <span class="_ _9"></span>for <span class="_ _23"></span>the <span class="_ _3"></span>ﬁrst <span class="_ _9"></span>time?<span class="_ _5a"> </span>The <span class="_ _9"></span>answer <span class="_ _9"></span>is <span class="_ _9"></span>‘‘it</span></span></div><div class="t m0 x32 h49 y4fd9 ff19 fs26 fc0 sc0 ls0 ws0">depends.’<span class="_ _0"></span><span class="ls1497">’S<span class="_ _64"></span><span class="ls0">ome <span class="_ _53"> </span>systems <span class="_"> </span>might <span class="_ _53"> </span>initialize <span class="_ _e"> </span>the <span class="_"> </span>terminal <span class="_ _53"> </span>attributes <span class="_ _e"> </span>to <span class="_ _e"> </span>implementation-</span></span></div><div class="t m0 x32 h49 y4fda ff19 fs26 fc0 sc0 ls0 ws0">deﬁned <span class="_ _9"></span>values.<span class="_ _16"> </span>Other <span class="_ _9"></span>systems <span class="_ _9"></span>might <span class="_ _9"></span>leave <span class="_ _9"></span>the <span class="_ _9"></span>attributes <span class="_ _9"></span>with <span class="_ _9"></span>the <span class="_ _9"></span>values <span class="_ _9"></span>they <span class="_ _9"></span>had <span class="_ _9"></span>the</div><div class="t m0 x32 h49 y4fdb ff19 fs26 fc0 sc0 ls0 ws0">last <span class="_ _9"></span>time <span class="_ _9"></span>that <span class="_ _9"></span>the <span class="_ _23"></span>terminal <span class="_ _9"></span>was <span class="_ _9"></span>used.<span class="_ _5a"> </span>If <span class="_ _9"></span>we <span class="_ _9"></span>want <span class="_ _9"></span>to <span class="_ _23"></span>be <span class="_ _9"></span>sur<span class="ls1498">et<span class="_ _b"></span><span class="ls0">hat <span class="_ _3"></span>the <span class="_ _23"></span>terminal <span class="_ _9"></span>behavior</span></span></div><div class="t m0 x32 h4d y4fdc ff19 fs26 fc0 sc0 ls0 ws0">conforms <span class="_ _9"></span>to <span class="_ _3"></span>the <span class="_ _9"></span>standard, <span class="_ _9"></span>we <span class="_ _3"></span>can <span class="_ _9"></span>open <span class="_ _9"></span>the <span class="_ _9"></span>terminal <span class="_ _9"></span>device <span class="_ _9"></span>with <span class="_ _3"></span>the<span class="_ _45"> </span><span class="ff1a">O_TTY_INIT<span class="_ _45"> </span></span>ﬂag</div><div class="t m0 x32 h4d y4fdd ff19 fs26 fc0 sc0 ls0 ws0">(see <span class="_ _e"> </span>Section <span class="_ _e"> </span>3.3).<span class="_ _65"> </span>This <span class="_"> </span>will <span class="_ _53"> </span>ensur<span class="ls1499">et<span class="_ _4a"></span><span class="ls0">hat <span class="_"> </span>when <span class="_ _53"> </span>we <span class="_ _e"> </span>call<span class="_ _4b"> </span><span class="ff1a">tcgetattr</span><span class="ls13b8">,a<span class="_ _55"></span><span class="ls0">ny <span class="_"> </span>nonstandar<span class="_ _1"></span>d</span></span></span></span></div><div class="t m0 x32 h4d y4fde ff19 fs26 fc0 sc0 ls0 ws0">portions <span class="_ _53"> </span>of <span class="_ _e"> </span>the<span class="_ _4b"> </span><span class="ff1a">termios<span class="_ _4b"> </span></span>structur<span class="_ _0"></span><span class="ls149a">ew<span class="_ _55"></span><span class="ls0">ill <span class="_ _e"> </span>be <span class="_ _53"> </span>initialized <span class="_ _e"> </span>so <span class="_ _53"> </span>the <span class="_ _e"> </span>terminal <span class="_ _53"> </span>will <span class="_ _e"> </span>behave <span class="_ _e"> </span>as</span></span></div><div class="t m0 x32 h4d y4fdf ff19 fs26 fc0 sc0 ls0 ws0">expected when we change the attributes and call<span class="_"> </span><span class="ff1a">tcsetattr</span>.</div><div class="t m0 x35 h4b y4fe0 ff16 fs27 fc0 sc0 ls0 ws0">18.5 <span class="_ _93"> </span>T<span class="_ _6"></span>erminal <span class="_"> </span>Option <span class="_"> </span>Flags</div><div class="t m0 x32 h49 y4fe1 ff19 fs26 fc0 sc0 ls0 ws0">In <span class="_ _3"></span>this <span class="_ _9"></span>section, <span class="_ _9"></span>we <span class="_ _3"></span>list <span class="_ _9"></span>all <span class="_ _3"></span>the <span class="_ _9"></span>various <span class="_ _9"></span>terminal <span class="_ _3"></span>option <span class="_ _9"></span>ﬂags, <span class="_ _9"></span>expanding <span class="_ _3"></span>the <span class="_ _9"></span>descriptions</div><div class="t m0 x32 h49 y4fe2 ff19 fs26 fc0 sc0 ls0 ws0">from <span class="_ _9"></span>Figures <span class="_ _23"></span>18.3 <span class="_ _23"></span>through <span class="_ _9"></span>18.6.<span class="_ _51"> </span>This <span class="_ _23"> </span>list <span class="_ _23"> </span>is <span class="_ _23"> </span>alphabetical <span class="_ _23"> </span>and <span class="_ _23"> </span>indicates <span class="_ _23"> </span>in <span class="_ _23"> </span>which <span class="_ _23"> </span>of <span class="_ _23"> </span>the</div><div class="t m0 x32 h49 y4fe3 ff19 fs26 fc0 sc0 ls0 ws0">four <span class="_ _23"></span>terminal <span class="_ _23"></span>ﬂag <span class="_ _23"></span>ﬁelds <span class="_ _23"></span>the <span class="_ _23"></span>option <span class="_ _23"></span>appears.<span class="_ _51"> </span>(The <span class="_ _23"></span>ﬁeld <span class="_ _23"></span>that <span class="_ _23"></span>controls <span class="_ _9"></span>a <span class="_ _23"> </span>given <span class="_ _23"> </span>option <span class="_ _23"> </span>is</div><div class="t m0 x32 h49 y4fe4 ff19 fs26 fc0 sc0 ls0 ws0">usually not <span class="_ _2"></span>apparent <span class="_ _2"></span>from the <span class="_ _2"></span>option <span class="_ _2"></span>name <span class="_ _2"></span>alone.)<span class="_ _61"> </span><span class="ls164">We <span class="_ _e"> </span>a<span class="_ _9"></span></span>lso <span class="_ _2"></span>note <span class="_ _2"></span>whether <span class="_ _2"></span>each <span class="_ _2"></span>option <span class="_ _2"></span>is</div><div class="t m0 x32 h49 y4fe5 ff19 fs26 fc0 sc0 ls0 ws0">deﬁned by the Single UNIX Speciﬁcation and list the platforms that support it.</div><a class="l" href="#pf13" data-dest-detail='[19,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892409px;bottom:1236.288916px;width:272.411796px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pf13" data-dest-detail='[19,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.894733px;bottom:246.663916px;width:168.528702px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
