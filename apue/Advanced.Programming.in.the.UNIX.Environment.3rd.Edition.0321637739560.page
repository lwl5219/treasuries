<div id="pf230" class="pf w4 h1f" data-page-no="230"><div class="pc pc230 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg230.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">526<span class="_ _1b"> </span><span class="ff19">Advanced <span class="_"> </span>I/O<span class="_ _16b"> </span>Chapter <span class="_"> </span>14</span></div><div class="t m0 x1d0 h51 y405a ff19 fs2a fc0 sc0 ls0 ws0">stack</div><div class="t m0 x126 h51 y405b ff19 fs2a fc0 sc0 ls0 ws0">memory-mapped</div><div class="t m0 x161 h51 y405c ff19 fs2a fc0 sc0 ls0 ws0">portion of ﬁle</div><div class="t m0 x1d0 h51 y405d ff19 fs2a fc0 sc0 ls0 ws0">heap</div><div class="t m0 x1ca h2d y405e ff19 fs10 fc0 sc0 ls0 ws0">uninitialized data</div><div class="t m0 x18 h2d y405f ff19 fs10 fc0 sc0 ls0 ws0">(bss)</div><div class="t m0 xe9 h2e y4060 ff19 fs11 fc0 sc0 ls0 ws0">initialized data</div><div class="t m0 xbe h2f y4061 ff19 fs12 fc0 sc0 ls0 ws0">text</div><div class="t m0 x41 h30 y4062 ff19 fs13 fc0 sc0 ls0 ws0">high address</div><div class="t m0 x135 h30 y4063 ff19 fs13 fc0 sc0 ls0 ws0">low address</div><div class="t m0 xf7 h31 y4064 ff19 fs14 fc0 sc0 ls0 ws0">start addr</div><div class="t m0 x5 h9d y4065 ff1b fs16 fc0 sc0 ls0 ws0">len</div><div class="t m0 x181 h83 y4066 ff19 fs36 fc0 sc0 ls0 ws0">memory-mapped</div><div class="t m0 x48 h83 y4067 ff19 fs36 fc0 sc0 ls0 ws0">portion of ﬁle</div><div class="t m0 x115 h34 y4068 ff19 fs17 fc0 sc0 ls0 ws0">ﬁle:</div><div class="t m0 x225 h102 y4069 ff1b fs1a fc0 sc0 ls0 ws0">off</div><div class="t m0 x1 h15b y406a ff1b fs1c fc0 sc0 ls0 ws0">len</div><div class="t m0 x36 h88 y406b ff18 fs43 fc0 sc0 ls0 ws0">Figure 14.26<span class="_ _5a"> </span><span class="ff19">Example of a memory-mapped ﬁle</span></div><div class="t m0 x32 h150 y406c ff19 fsb5 fc0 sc0 ls0 ws0">the <span class="_"> </span>mapped <span class="_"> </span>memory <span class="_ _e"> </span>being <span class="_"> </span>somewher<span class="ls10f6">eb<span class="_ _4a"></span><span class="ls0">etween <span class="_"> </span>the <span class="_ _e"> </span>heap <span class="_"> </span>and <span class="_"> </span>the <span class="_"> </span>stack: <span class="_"> </span>this <span class="_ _e"> </span>is <span class="_"> </span>an</span></span></div><div class="t m0 x32 h150 y406d ff19 fsb5 fc0 sc0 ls0 ws0">implementation detail and may differ fr<span class="_ _0"></span>om one implementation to the next.</div><div class="t m0 x3f h15c y406e ff19 fsb5 fc0 sc0 ls0 ws0">The<span class="_"> </span><span class="ff1b">ﬂag<span class="_"> </span></span>argument af<span class="_ _0"></span>fects various attributes of the mapped r<span class="_ _0"></span>egion.</div><div class="t m0 x3f h14f y406f ff1a fsb5 fc0 sc0 ls0 ws0">MAP_FIXED<span class="_ _215"> </span><span class="ff19">The <span class="_ _3"></span>return <span class="_ _2"></span>value <span class="_ _3"></span>must <span class="_ _3"></span>equal<span class="_ _47"> </span><span class="ff1b">addr</span><span class="ls10f7">.U<span class="_ _1d"></span><span class="ls0">se <span class="_ _3"></span>of <span class="_ _2"></span>this <span class="_ _3"></span>ﬂag <span class="_ _3"></span>is <span class="_ _3"></span>discouraged,</span></span></span></div><div class="t m0 x14e h15c y4070 ff19 fsb5 fc0 sc0 ls0 ws0">as <span class="_ _9"></span>it <span class="_ _23"></span>hinders <span class="_ _9"></span>portability<span class="_ _4"></span><span class="ls10f8">.I<span class="_ _62"></span><span class="ls10f9">ft<span class="_ _b"></span><span class="ls0">his <span class="_ _9"></span>ﬂag <span class="_ _9"></span>is <span class="_ _23"></span>not <span class="_ _9"></span>speciﬁed <span class="_ _23"></span>and <span class="_ _9"></span>if<span class="_ _45"> </span><span class="ff1b">addr<span class="_ _45"> </span></span>is</span></span></span></div><div class="t m0 x14e h15c y4071 ff19 fsb5 fc0 sc0 ls0 ws0">nonzero, <span class="_ _3"></span>then <span class="_ _9"></span>the <span class="_ _3"></span>kernel <span class="_ _9"></span>uses<span class="_ _45"> </span><span class="ff1b">addr<span class="_ _47"> </span></span>as <span class="_ _9"></span>a <span class="_ _9"></span>hint <span class="_ _3"></span>of <span class="_ _9"></span>where<span class="_ _47"> </span>to<span class="_ _45"> </span>place <span class="_ _9"></span>the</div><div class="t m0 x14e h150 y4072 ff19 fsb5 fc0 sc0 ls0 ws0">mapped <span class="_ _45"> </span>r<span class="_ _0"></span>egion, <span class="_ _45"> </span>but <span class="_ _47"> </span>ther<span class="ls10fa">ei<span class="_ _62"></span><span class="ls0">s<span class="_ _16"> </span>no<span class="_ _5a"> </span>guarantee <span class="_ _45"> </span>that <span class="_ _45"> </span>the <span class="_ _47"> </span>requested</span></span></div><div class="t m0 x14e h150 y4073 ff19 fsb5 fc0 sc0 ls0 ws0">address <span class="_ _44"> </span>will <span class="_ _4b"> </span>be <span class="_ _4b"> </span>used.<span class="_ _7f"> </span>Maximum <span class="_ _4b"> </span>portability <span class="_ _4b"> </span>is <span class="_ _4b"> </span>obtained <span class="_ _59"> </span>by</div><div class="t m0 x14e h15c y4074 ff19 fsb5 fc0 sc0 ls0 ws0">specifying<span class="_"> </span><span class="ff1b">addr<span class="_"> </span></span>as 0.</div><div class="t m0 xc0 h128 y4075 ff19 fs43 fc0 sc0 ls0 ws0">Support <span class="_ _35"> </span>for <span class="_ _35"> </span>the<span class="_ _16"> </span><span class="ff1a">MAP_FIXED<span class="_ _16"> </span></span>ﬂag <span class="_ _35"> </span>is <span class="_ _35"> </span>optional <span class="_ _35"> </span>on <span class="_ _35"> </span>POSIX-conforming</div><div class="t m0 xc0 h88 y4076 ff19 fs43 fc0 sc0 ls0 ws0">systems, but requir<span class="_ _0"></span>ed on XSI-conforming systems.</div><div class="t m0 x3f h14f y4077 ff1a fsb5 fc0 sc0 ls0 ws0">MAP_SHARED<span class="_ _1b"> </span><span class="ff19">This <span class="_"> </span>ﬂag <span class="_"> </span>describes <span class="_"> </span>the <span class="_"> </span>disposition <span class="_ _66"> </span>of <span class="_"> </span>stor<span class="ls10fb">eo<span class="_ _5b"></span><span class="ls0">perations <span class="_ _66"> </span>into <span class="_"> </span>the</span></span></span></div><div class="t m0 x14e h150 y4078 ff19 fsb5 fc0 sc0 ls0 ws0">mapped <span class="_ _47"> </span>region <span class="_ _45"> </span>by <span class="_ _47"> </span>this <span class="_ _45"> </span>process. <span class="_ _61"> </span>This<span class="_ _5a"> </span>ﬂag <span class="_ _45"> </span>speciﬁes <span class="_ _47"> </span>that <span class="_ _45"> </span>store</div><div class="t m0 x14e h150 y4079 ff19 fsb5 fc0 sc0 ls0 ws0">operations <span class="_ _42"> </span>modify <span class="_ _23"> </span>the <span class="_ _42"> </span>mapped <span class="_ _42"> </span>ﬁle<span class="_ _9"></span><span class="ls10fc">—t<span class="_ _6"></span><span class="ls0">hat <span class="_ _42"> </span>is, <span class="_ _23"> </span>a <span class="_ _42"> </span>stor<span class="ls10fd">eo<span class="_ _43"></span><span class="ls0">peration <span class="_ _23"> </span>is</span></span></span></span></div><div class="t m0 x14e h14f y407a ff19 fsb5 fc0 sc0 ls0 ws0">equivalent <span class="_"> </span>to <span class="_"> </span>a<span class="_ _46"> </span><span class="ff1a">write<span class="_ _59"> </span></span>to <span class="_"> </span>the <span class="_"> </span>ﬁle.<span class="_ _60"> </span>Either <span class="_"> </span>this <span class="_ _66"> </span>ﬂag <span class="_"> </span>or <span class="_"> </span>the <span class="_"> </span>next</div><div class="t m0 x14e h14f y407b ff19 fsb5 fc0 sc0 ls0 ws0">(<span class="ff1a">MAP_PRIVATE</span>), but not both, must be speciﬁed.</div><div class="t m0 x3f h14f y407c ff1a fsb5 fc0 sc0 ls0 ws0">MAP_PRIVATE<span class="_ _6e"> </span><span class="ff19">This ﬂag says that stor<span class="ls10fe">eo<span class="_ _4f"></span><span class="ls0">perations into the mapped region cause a</span></span></span></div><div class="t m0 x14e h150 y407d ff19 fsb5 fc0 sc0 ls0 ws0">private <span class="_"> </span>copy <span class="_ _47"> </span>of <span class="_"> </span>the <span class="_ _66"> </span>mapped <span class="_ _47"> </span>ﬁle <span class="_"> </span>to <span class="_ _66"> </span>be <span class="_ _47"> </span>created. <span class="_ _46"> </span>All<span class="_ _46"> </span>successive</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
