<div id="pf8f" class="pf w4 h1f" data-page-no="8f"><div class="pc pc8f w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg8f.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h7a ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>4.1<span class="_ _1"></span>1<span class="_ _198"> </span><span class="ff1a">chown</span>,<span class="_ _4b"> </span><span class="ff1a">fchown</span>,<span class="_ _4b"> </span><span class="ff1a">fchownat</span><span class="ls30a">,a<span class="_ _55"></span><span class="ls0">nd<span class="_ _4b"> </span><span class="ff1a">lchown<span class="_ _59"> </span></span>Functions<span class="_ _1b"> </span><span class="ff18">109</span></span></span></div><div class="t m0 x32 h2a y12f ff19 fsf fc0 sc0 ls0 ws0">portion <span class="_ _9"></span>of <span class="_ _9"></span>a <span class="_ _23"></span>program <span class="_ _3"></span>is <span class="_ _23"></span>the <span class="_ _9"></span>machine <span class="_ _9"></span>instructions.) <span class="_ _45"> </span>The<span class="_ _45"> </span>program <span class="_ _9"></span>would <span class="_ _9"></span>then <span class="_ _23"></span>load <span class="_ _9"></span>into</div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">memory <span class="_ _66"> </span>mor<span class="ls4e2">eq<span class="_ _1d"></span><span class="ls0">uickly <span class="_ _47"> </span>the <span class="_ _47"> </span>next <span class="_ _66"> </span>time <span class="_ _47"> </span>it <span class="_ _47"> </span>was <span class="_ _66"> </span>executed, <span class="_ _47"> </span>because <span class="_ _47"> </span>the <span class="_ _47"> </span>swap <span class="_ _66"> </span>area <span class="_ _66"> </span>was</span></span></div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">handled <span class="_"> </span>as <span class="_ _53"> </span>a <span class="_"> </span>contiguous <span class="_"> </span>ﬁle, <span class="_ _53"> </span>as <span class="_"> </span>compared <span class="_ _e"> </span>to <span class="_"> </span>the <span class="_ _e"> </span>possibly <span class="_"> </span>random <span class="_ _e"> </span>location <span class="_"> </span>of <span class="_ _53"> </span>data</div><div class="t m0 x32 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">blocks <span class="_ _45"> </span>in <span class="_ _45"> </span>a <span class="_ _47"> </span>normal <span class="_ _45"> </span>UNIX <span class="_ _45"> </span>ﬁle <span class="_ _45"> </span>system.<span class="_ _5c"> </span>The <span class="_ _47"> </span>sticky <span class="_ _45"> </span>bit <span class="_ _45"> </span>was <span class="_ _45"> </span>often <span class="_ _45"> </span>set <span class="_ _45"> </span>for <span class="_ _45"> </span>common</div><div class="t m0 x32 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">application <span class="_ _45"> </span>programs, <span class="_ _45"> </span>such <span class="_ _45"> </span>as <span class="_ _35"> </span>the <span class="_ _45"> </span>text <span class="_ _45"> </span>editor <span class="_ _35"> </span>and <span class="_ _45"> </span>the <span class="_ _45"> </span>passes <span class="_ _45"> </span>of <span class="_ _35"> </span>the <span class="_ _45"> </span>C <span class="_ _45"> </span>compiler<span class="_ _1"></span>.</div><div class="t m0 x32 h2a y134 ff19 fsf fc0 sc0 ls0 ws0">Naturally<span class="_ _4"></span><span class="ls4e3">,t<span class="_ _8"></span><span class="ls0">her<span class="ls4e3">ew<span class="_ _b"></span><span class="ls0">as <span class="_ _9"></span>a <span class="_ _3"></span>limit <span class="_ _9"></span>to <span class="_ _3"></span>the <span class="_ _9"></span>number <span class="_ _3"></span>of <span class="_ _3"></span>sticky <span class="_ _9"></span>ﬁles <span class="_ _3"></span>that <span class="_ _9"></span>could <span class="_ _3"></span>be <span class="_ _9"></span>contained <span class="_ _3"></span>in <span class="_ _9"></span>the</span></span></span></span></div><div class="t m0 x32 h2a y135 ff19 fsf fc0 sc0 ls0 ws0">swap <span class="_ _9"></span>area <span class="_ _3"></span>befor<span class="ls4e4">er<span class="_ _b"></span><span class="ls0">unning <span class="_ _3"></span>out <span class="_ _9"></span>of <span class="_ _9"></span>swap <span class="_ _9"></span>space, <span class="_ _9"></span>but <span class="_ _9"></span>it <span class="_ _9"></span>was <span class="_ _9"></span>a <span class="_ _9"></span>useful <span class="_ _9"></span>technique.<span class="_ _16"> </span>The <span class="_ _9"></span>name</span></span></div><div class="t m0 x32 h2b y136 ff1b fsf fc0 sc0 ls0 ws0">sticky<span class="_"> </span><span class="ff19">came <span class="_ _2"></span>about because <span class="_ _2"></span>the text <span class="_ _2"></span>portion of <span class="_ _2"></span>the ﬁle <span class="_ _2"></span>stuck around in <span class="_ _2"></span>the swap <span class="_ _2"></span>area until</span></div><div class="t m0 x32 h2a y137 ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _42"> </span>system <span class="_ _53"> </span>was <span class="_ _53"> </span>rebooted. <span class="_ _44"> </span>Later<span class="_ _44"> </span>versions <span class="_ _42"> </span>of <span class="_ _53"> </span>the <span class="_ _53"> </span>UNIX <span class="_ _42"> </span>System <span class="_ _53"> </span>referred <span class="_ _42"> </span>to <span class="_ _42"> </span>this <span class="_ _53"> </span>as <span class="_ _53"> </span>the</div><div class="t m0 x32 h26 y138 ff1b fsf fc0 sc0 ls0 ws0">saved-text<span class="_ _47"> </span><span class="ff19">bit; <span class="_ _2"></span>hence <span class="_ _2"></span>the <span class="_ _3"></span>constant<span class="_ _47"> </span><span class="ff1a">S_ISVTX</span><span class="ls1c9">.W<span class="_ _26"></span><span class="ls0">ith <span class="_ _3"></span>today’s <span class="_ _2"></span>newer <span class="_ _3"></span>UNIX <span class="_ _2"></span>systems, <span class="_ _3"></span>most <span class="_ _3"></span>of</span></span></span></div><div class="t m0 x32 h2a y139 ff19 fsf fc0 sc0 ls0 ws0">which <span class="_ _47"> </span>have <span class="_ _45"> </span>a <span class="_ _45"> </span>virtual <span class="_ _47"> </span>memory <span class="_ _45"> </span>system <span class="_ _45"> </span>and <span class="_ _47"> </span>a <span class="_ _45"> </span>faster <span class="_ _47"> </span>ﬁle <span class="_ _45"> </span>system, <span class="_ _45"> </span>the <span class="_ _47"> </span>need <span class="_ _45"> </span>for <span class="_ _47"> </span>this</div><div class="t m0 x32 h2a y13a ff19 fsf fc0 sc0 ls0 ws0">technique has disappeared.</div><div class="t m0 x3f h2a y254 ff19 fsf fc0 sc0 ls0 ws0">On <span class="_ _9"></span>contemporary <span class="_ _9"></span>systems, <span class="_ _3"></span>the <span class="_ _9"></span>use <span class="_ _9"></span>of <span class="_ _9"></span>the <span class="_ _9"></span>sticky <span class="_ _9"></span>bit <span class="_ _9"></span>has <span class="_ _9"></span>been <span class="_ _9"></span>extended.<span class="_ _5a"> </span>The <span class="_ _9"></span>Single</div><div class="t m0 x32 h2a y255 ff19 fsf fc0 sc0 ls0 ws0">UNIX <span class="_ _9"></span>Speciﬁcation <span class="_ _23"> </span>allows <span class="_ _23"></span>the <span class="_ _23"></span>sticky <span class="_ _9"></span>bit <span class="_ _23"></span>to <span class="_ _23"></span>be <span class="_ _9"></span>set <span class="_ _23"></span>for <span class="_ _23"></span>a <span class="_ _9"></span>directory<span class="_ _4"></span><span class="ls4e5">.I<span class="_ _26"></span><span class="ls4e6">ft<span class="_ _b"></span><span class="ls0">he <span class="_ _9"></span>bit <span class="_ _23"> </span>is <span class="_ _23"></span>set <span class="_ _9"></span>for <span class="_ _23"> </span>a</span></span></span></div><div class="t m0 x32 h2a y13b ff19 fsf fc0 sc0 ls0 ws0">directory<span class="_ _4"></span><span class="ls4e7">,aﬁ<span class="_ _b"></span><span class="ls0">le <span class="_ _9"></span>in <span class="_ _9"></span>the <span class="_ _23"></span>directory <span class="_ _9"></span>can <span class="_ _9"></span>be <span class="_ _23"></span>removed <span class="_ _3"></span>or <span class="_ _23"></span>renamed <span class="_ _9"></span>only <span class="_ _9"></span>if <span class="_ _23"></span>the <span class="_ _9"></span>user <span class="_ _23"></span>has <span class="_ _9"></span>write</span></span></div><div class="t m0 x32 h2a y13c ff19 fsf fc0 sc0 ls0 ws0">permission for the directory and meets one of the following criteria:</div><div class="t m0 x3f h2a yfd0 ff19 fsf fc0 sc0 ls49 ws0">•O<span class="_ _4d"></span><span class="ls0">wns the ﬁle</span></div><div class="t m0 x3f h2a yfd1 ff19 fsf fc0 sc0 ls49 ws0">•O<span class="_ _4d"></span><span class="ls0">wns the directory</span></div><div class="t m0 x3f h2a yfd2 ff19 fsf fc0 sc0 ls49 ws0">•I<span class="_ _4d"></span><span class="ls44">st<span class="_ _d"></span><span class="ls0">he superuser</span></span></div><div class="t m0 x32 h26 yfd3 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _3"></span>directories<span class="_ _47"> </span><span class="ff1a">/tmp<span class="_ _47"> </span></span>and<span class="_ _45"> </span><span class="ff1a">/var/tmp<span class="_ _47"> </span></span>ar<span class="ls4e8">et<span class="_ _b"></span><span class="ls0">ypical <span class="_ _3"></span>candidates <span class="_ _9"></span>for <span class="_ _3"></span>the <span class="_ _3"></span>sticky <span class="_ _9"></span>bit<span class="_ _9"></span><span class="ls9d">—t<span class="_ _6"></span><span class="ls0">hey <span class="_ _3"></span>are</span></span></span></span></div><div class="t m0 x32 h2a yfd4 ff19 fsf fc0 sc0 ls0 ws0">directories <span class="_ _9"></span>in <span class="_ _9"></span>which <span class="_ _23"> </span>any <span class="_ _23"></span>user <span class="_ _9"></span>can <span class="_ _23"></span>typically <span class="_ _9"></span>create <span class="_ _23"></span>ﬁles.<span class="_ _5a"> </span>The <span class="_ _23"></span>permissions <span class="_ _9"></span>for <span class="_ _23"> </span>these <span class="_ _23"></span>two</div><div class="t m0 x32 h2a yfd5 ff19 fsf fc0 sc0 ls0 ws0">directories ar<span class="ls4e9">eo<span class="_ _4f"></span><span class="ls0">ften <span class="_ _2"></span>read, <span class="_ _2"></span>write, <span class="_ _3"></span>and <span class="_ _2"></span>execute <span class="_ _3"></span>for <span class="_ _3"></span>everyone <span class="_ _2"></span>(user<span class="_ _1"></span><span class="ls4ea">,g<span class="_ _4f"></span><span class="ls45">ro<span class="ls0">up, <span class="_ _3"></span>and <span class="_ _3"></span>other).<span class="_ _61"> </span>But</span></span></span></span></span></div><div class="t m0 x32 h2a yfd6 ff19 fsf fc0 sc0 ls0 ws0">users should not be able to delete or rename ﬁles owned by others.</div><div class="t m0 x76 h51 yfd7 ff19 fs2a fc0 sc0 ls0 ws0">The <span class="_ _23"> </span>saved-text <span class="_ _23"> </span>bit <span class="_ _23"> </span>is <span class="_ _23"> </span>not <span class="_ _42"> </span>part <span class="_ _23"> </span>of <span class="_ _23"> </span>POSIX.1.<span class="_ _46"> </span>It <span class="_ _42"> </span>is <span class="_ _23"> </span>part <span class="_ _23"> </span>of <span class="_ _23"> </span>the <span class="_ _23"> </span>XSI <span class="_ _42"> </span>option <span class="_ _23"> </span>deﬁned <span class="_ _23"> </span>in <span class="_ _23"> </span>the <span class="_ _23"> </span>Single</div><div class="t m0 x76 h51 yfd8 ff19 fs2a fc0 sc0 ls0 ws0">UNIX <span class="_"> </span>Speciﬁcation, <span class="_"> </span>and <span class="_"> </span>is <span class="_"> </span>supported <span class="_"> </span>by <span class="_"> </span>Fr<span class="_ _1"></span>eeBSD <span class="_"> </span>8.0, <span class="_"> </span>Linux <span class="_"> </span>3.2.0, <span class="_"> </span>Mac <span class="_"> </span>OS <span class="_"> </span>X <span class="_"> </span>10.6.8, <span class="_"> </span>and</div><div class="t m0 x76 h51 yfd9 ff19 fs2a fc0 sc0 ls0 ws0">Solaris 10.</div><div class="t m0 x76 h51 yfda ff19 fs2a fc0 sc0 ls0 ws0">Solaris <span class="_ _9"></span>10 <span class="_ _3"></span>places <span class="_ _9"></span>special <span class="_ _9"></span>meaning <span class="_ _9"></span>on <span class="_ _9"></span>the <span class="_ _3"></span>sticky <span class="_ _9"> </span>bit <span class="_ _9"></span>if <span class="_ _9"></span>it <span class="_ _9"></span>is <span class="_ _9"></span>set <span class="_ _3"></span>on <span class="_ _9"> </span>a <span class="_ _9"></span>regular <span class="_ _3"></span>ﬁle.<span class="_ _46"> </span>In <span class="_ _3"></span>this <span class="_ _9"> </span>case, <span class="_ _9"></span>if</div><div class="t m0 x76 h51 yfdb ff19 fs2a fc0 sc0 ls0 ws0">none of the execute bits is set, the operating system will not cache the contents of the ﬁle.</div><div class="t m0 x35 h75 yfdc ff16 fs2b fc0 sc0 ls0 ws0">4.11<span class="_ _6d"> </span><span class="ff1f">chown</span>,<span class="_ _54"> </span><span class="ff1f">fchown</span>,<span class="_ _54"> </span><span class="ff1f">fchownat</span><span class="ls1c3">,a<span class="_ _52"></span><span class="ls0">nd<span class="_ _54"> </span><span class="ff1f">lchown<span class="_ _65"> </span></span>Functions</span></span></div><div class="t m0 x32 h26 yfdd ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _45"> </span><span class="ff1a">chown<span class="_ _45"> </span></span>functions <span class="_ _9"></span>allow <span class="_ _9"></span>us <span class="_ _23"></span>to <span class="_ _9"></span>change <span class="_ _9"></span>a <span class="_ _23"></span>ﬁle’s <span class="_ _9"></span>user <span class="_ _9"></span>ID <span class="_ _9"></span>and <span class="_ _23"></span>gr<span class="_ _0"></span>oup <span class="_ _9"></span>ID, <span class="_ _9"></span>but <span class="_ _23"></span>if <span class="_ _9"></span>either <span class="_ _9"></span>of</div><div class="t m0 x32 h2b yfde ff19 fsf fc0 sc0 ls0 ws0">the arguments<span class="_"> </span><span class="ff1b">owner<span class="_"> </span></span>or<span class="_"> </span><span class="ff1b">gr<span class="_ _0"></span>oup<span class="_"> </span><span class="ff19">is<span class="_"> </span><span class="ff20">−</span>1, the corr<span class="_ _0"></span>esponding ID is left unchanged.</span></span></div><div class="t m0 x3f h57 yfdf ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;unistd.h&gt;</div><div class="t m0 x3f h57 yfe0 ff1a fs2d fc0 sc0 ls0 ws0">int chown(const char *<span class="ff1b">pathname</span><span class="ls15c">,u<span class="_ _1d"></span><span class="ls0">id_t<span class="_"> </span><span class="ff1b">owner</span><span class="ls15c">,g<span class="_ _5b"></span><span class="ls0">id_t<span class="_"> </span><span class="ff1b">group</span>);</span></span></span></span></div><div class="t m0 x3f h57 yfe1 ff1a fs2d fc0 sc0 ls0 ws0">int fchown(int<span class="_"> </span><span class="ff1b">fd</span><span class="ls15c">,u<span class="_ _1d"></span><span class="ls0">id_t<span class="_"> </span><span class="ff1b">owner</span><span class="ls15c">,g<span class="_ _5b"></span><span class="ls0">id_t<span class="_"> </span><span class="ff1b">group</span>);</span></span></span></span></div><div class="t m0 x3f h57 yfe2 ff1a fs2d fc0 sc0 ls0 ws0">int fchownat(int<span class="_"> </span><span class="ff1b">fd</span><span class="ls15c">,c<span class="_ _1d"></span><span class="ls0">onst char *<span class="ff1b">pathname</span><span class="ls15c">,u<span class="_ _5b"></span><span class="ls0">id_t<span class="_"> </span><span class="ff1b">owner</span><span class="ls15c">,g<span class="_ _1d"></span><span class="ls0">id_t<span class="_"> </span><span class="ff1b">group</span>,</span></span></span></span></span></span></div><div class="t m0 xf0 h57 yfe3 ff1a fs2d fc0 sc0 ls0 ws0">int<span class="_"> </span><span class="ff1b">ﬂag</span>);</div><div class="t m0 x3f h57 yfe4 ff1a fs2d fc0 sc0 ls0 ws0">int lchown(const char *<span class="ff1b">pathname</span><span class="ls15c">,u<span class="_ _1d"></span><span class="ls0">id_t<span class="_"> </span><span class="ff1b">owner</span><span class="ls15c">,g<span class="_ _5b"></span><span class="ls0">id_t<span class="_"> </span><span class="ff1b">group</span>);</span></span></span></span></div><div class="t m0 x17b h5f yfe5 ff19 fs2d fc0 sc0 ls0 ws0">All four return: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>err<span class="_ _0"></span>or</div><a class="l" href="#pfd" data-dest-detail='[13,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892842px;bottom:456.348928px;width:338.039612px;height:19.678986px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
