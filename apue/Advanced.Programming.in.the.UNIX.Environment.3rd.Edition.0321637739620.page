<div id="pf26c" class="pf w4 h1f" data-page-no="26c"><div class="pc pc26c w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg26c.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">586<span class="_ _1b"> </span><span class="ff19">Interprocess <span class="_"> </span>Communication<span class="_ _2c"> </span>Chapter <span class="_"> </span>15</span></div><div class="t m0 x41 h26 y12f ff19 fsf fc0 sc0 ls0 ws0">with <span class="_ _3"></span>a <span class="_ _9"></span>key <span class="_ _3"></span>of<span class="_ _45"> </span><span class="ff1a">IPC_PRIVATE</span><span class="ls12c9">.T<span class="_ _62"></span><span class="ls0">he <span class="_ _3"></span>server <span class="_ _9"></span>also <span class="_ _3"></span>has <span class="_ _3"></span>its <span class="_ _9"></span>own <span class="_ _3"></span>queue, <span class="_ _9"></span>with <span class="_ _3"></span>a <span class="_ _9"></span>key <span class="_ _3"></span>or</span></span></div><div class="t m0 x41 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">identiﬁer <span class="_ _23"></span>known <span class="_ _9"></span>to <span class="_ _23"> </span>all <span class="_ _23"></span>clients.<span class="_ _51"> </span>The <span class="_ _9"></span>client <span class="_ _23"></span>sends <span class="_ _23"></span>its <span class="_ _23"></span>ﬁrst <span class="_ _9"></span>request <span class="_ _23"></span>to <span class="_ _9"></span>the <span class="_ _23"> </span>server<span class="_ _9"></span>’s</div><div class="t m0 x41 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">well-known <span class="_ _9"></span>queue, <span class="_ _3"></span>and <span class="_ _9"></span>this <span class="_ _9"></span>request <span class="_ _9"></span>must <span class="_ _3"></span>contain <span class="_ _9"></span>the <span class="_ _9"></span>message <span class="_ _9"></span>queue <span class="_ _9"></span>ID <span class="_ _9"></span>of <span class="_ _9"></span>the</div><div class="t m0 x41 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">client’s <span class="_ _9"></span>queue.<span class="_ _5a"> </span>The <span class="_ _23"></span>server <span class="_ _9"></span>sends <span class="_ _9"></span>its <span class="_ _9"></span>ﬁrst <span class="_ _23"></span>response <span class="_ _3"></span>to <span class="_ _23"></span>the <span class="_ _9"></span>client’s <span class="_ _9"></span>queue, <span class="_ _9"></span>and <span class="_ _23"></span>all</div><div class="t m0 x41 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">futur<span class="ls44">er<span class="_ _4f"></span><span class="ls0">equests and responses ar<span class="_ _0"></span><span class="ls44">ee<span class="_ _d"></span><span class="ls0">xchanged on this queue.</span></span></span></span></div><div class="t m0 x41 h2a y3bd8 ff19 fsf fc0 sc0 ls0 ws0">One <span class="_ _23"></span>problem <span class="_ _9"></span>with <span class="_ _23"></span>this <span class="_ _23"></span>technique <span class="_ _23"></span>is <span class="_ _9"></span>that <span class="_ _23"> </span>each <span class="_ _23"> </span>client-speciﬁc <span class="_ _23"></span>queue <span class="_ _23"></span>usually <span class="_ _23"></span>has</div><div class="t m0 x41 h2a y3bd9 ff19 fsf fc0 sc0 ls0 ws0">only <span class="_ _23"></span>a <span class="_ _9"></span>single <span class="_ _23"> </span>message <span class="_ _23"></span>on <span class="_ _23"></span>it: <span class="_ _23"></span>a <span class="_ _9"></span>request <span class="_ _23"></span>for <span class="_ _9"></span>the <span class="_ _23"> </span>server <span class="_ _23"></span>or <span class="_ _23"></span>a <span class="_ _23"></span>r<span class="_ _0"></span>esponse <span class="_ _23"></span>for <span class="_ _9"></span>a <span class="_ _23"> </span>client.</div><div class="t m0 x41 h2a y2090 ff19 fsf fc0 sc0 ls0 ws0">This <span class="_ _2"></span>seems <span class="_ _3"></span>wasteful <span class="_ _2"></span>of <span class="_ _3"></span>a <span class="_ _3"></span>limited <span class="_ _2"></span>systemwide <span class="_ _3"></span>resour<span class="_ _0"></span>ce <span class="_ _2"></span>(a <span class="_ _3"></span>message <span class="_ _3"></span>queue), <span class="_ _2"></span>and <span class="_ _3"></span>a</div><div class="t m0 x41 h2a y3bda ff19 fsf fc0 sc0 ls0 ws0">FIFO <span class="_"> </span>can <span class="_"> </span>be <span class="_"> </span>used <span class="_ _66"> </span>instead.<span class="_ _50"> </span>Another <span class="_"> </span>problem <span class="_"> </span>is <span class="_"> </span>that <span class="_"> </span>the <span class="_"> </span>server <span class="_ _66"> </span>has <span class="_"> </span>to <span class="_ _66"> </span>read</div><div class="t m0 x41 h26 y2091 ff19 fsf fc0 sc0 ls0 ws0">messages <span class="_ _44"> </span>from <span class="_ _44"> </span>multiple <span class="_ _4b"> </span>queues.<span class="_ _93"> </span>Neither<span class="_ _65"> </span><span class="ff1a">select<span class="_ _65"> </span></span>nor<span class="_ _54"> </span><span class="ff1a">poll<span class="_ _65"> </span></span>works <span class="_ _4b"> </span>with</div><div class="t m0 x41 h2a y17b ff19 fsf fc0 sc0 ls0 ws0">message queues.</div><div class="t m0 x32 h2a y17d ff19 fsf fc0 sc0 ls0 ws0">Either <span class="_ _2"></span>of <span class="_ _2"></span>these <span class="_ _3"></span>two <span class="_ _2"></span>techniques <span class="_ _2"></span>using <span class="_ _3"></span>message <span class="_ _2"></span>queues <span class="_ _2"></span>can <span class="_ _3"></span>be <span class="_ _2"></span>implemented <span class="_ _3"></span>using <span class="_ _2"></span>shared</div><div class="t m0 x32 h2a y17e ff19 fsf fc0 sc0 ls0 ws0">memory segments and a synchronization method (a semaphor<span class="_ _0"></span>e<span class="_"> </span>or<span class="_"> </span>r<span class="_ _0"></span>ecor<span class="ls44">dl<span class="_ _4f"></span><span class="ls0">ocking).</span></span></div><div class="t m0 x3f h2a y17f ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _23"></span>problem <span class="_ _9"></span>with <span class="_ _23"> </span>this <span class="_ _23"> </span>type <span class="_ _23"></span>of <span class="_ _23"></span>client–server <span class="_ _23"></span>relationship <span class="_ _9"></span>(the <span class="_ _23"> </span>client <span class="_ _23"> </span>and <span class="_ _23"></span>the <span class="_ _23"></span>server</div><div class="t m0 x32 h2a y180 ff19 fsf fc0 sc0 ls0 ws0">being <span class="_ _3"></span>unrelated <span class="_ _3"></span>processes) <span class="_ _9"></span>is <span class="_ _3"></span>for <span class="_ _9"></span>the <span class="_ _9"></span>server <span class="_ _3"></span>to <span class="_ _9"></span>identify <span class="_ _9"></span>the <span class="_ _3"></span>client <span class="_ _9"></span>accurately<span class="_ _6"></span><span class="lsb5">.U<span class="_ _62"></span><span class="ls0">nless <span class="_ _3"></span>the</span></span></div><div class="t m0 x32 h2a y181 ff19 fsf fc0 sc0 ls0 ws0">server <span class="_ _2"></span>is <span class="_ _2"></span>performing <span class="_ _3"></span>a <span class="_ _2"></span>nonprivileged <span class="_ _3"></span>operation, <span class="_ _2"></span>it <span class="_ _2"></span>is <span class="_ _3"></span>essential <span class="_ _2"></span>that <span class="_ _3"></span>the <span class="_ _2"></span>server <span class="_ _2"></span>know <span class="_ _3"></span>who</div><div class="t m0 x32 h2a y182 ff19 fsf fc0 sc0 ls0 ws0">the <span class="_"> </span>client <span class="_"> </span>is.<span class="_ _60"> </span>This <span class="_ _66"> </span>is <span class="_"> </span>required, <span class="_"> </span>for <span class="_"> </span>example, <span class="_"> </span>if <span class="_"> </span>the <span class="_"> </span>server <span class="_ _66"> </span>is <span class="_"> </span>a <span class="_ _66"> </span>set-user-ID <span class="_"> </span>program.</div><div class="t m0 x32 h2a y183 ff19 fsf fc0 sc0 ls0 ws0">Although <span class="_ _3"></span>all <span class="_ _9"></span>these <span class="_ _9"></span>forms <span class="_ _3"></span>of <span class="_ _9"></span>IPC <span class="_ _9"></span>go <span class="_ _3"></span>through <span class="_ _3"></span>the <span class="_ _9"></span>kernel, <span class="_ _9"></span>there<span class="_ _47"> </span>is<span class="_ _45"> </span>no<span class="_ _47"> </span>facility <span class="_ _9"></span>provided <span class="_ _3"></span>by</div><div class="t m0 x32 h2a y184 ff19 fsf fc0 sc0 ls0 ws0">them to have the kernel identify the sender<span class="_ _6"></span>.</div><div class="t m0 x3f h2a y185 ff19 fsf fc0 sc0 ls65 ws0">Wi<span class="_ _3"></span><span class="ls0">th message <span class="_ _2"></span>queues, if <span class="_ _2"></span>a single <span class="_ _2"></span>queue is <span class="_ _2"></span>used between <span class="_ _2"></span>the client <span class="_ _2"></span>and <span class="_ _2"></span>the server <span class="_ _2"></span>(so</span></div><div class="t m0 x32 h26 y186 ff19 fsf fc0 sc0 ls0 ws0">that only a single message is on the queue at a time, for example), the<span class="_"> </span><span class="ff1a">msg_lspid<span class="_ _80"> </span></span>of the</div><div class="t m0 x32 h2a y187 ff19 fsf fc0 sc0 ls0 ws0">queue <span class="_ _23"> </span>contains <span class="_ _42"> </span>the <span class="_ _42"> </span>process <span class="_ _23"></span>ID <span class="_ _23"> </span>of <span class="_ _42"> </span>the <span class="_ _42"> </span>other <span class="_ _23"> </span>process. <span class="_ _35"> </span>But<span class="_ _44"> </span>when <span class="_ _23"> </span>writing <span class="_ _42"> </span>the <span class="_ _42"> </span>server<span class="_ _6"></span><span class="lsbae">,w<span class="_ _43"></span><span class="ls0">e</span></span></div><div class="t m0 x32 h2a y188 ff19 fsf fc0 sc0 ls0 ws0">want <span class="_ _3"></span>the <span class="_ _9"></span>effective <span class="_ _3"></span>user <span class="_ _9"></span>ID <span class="_ _3"></span>of <span class="_ _9"></span>the <span class="_ _9"></span>client, <span class="_ _3"></span>not <span class="_ _9"></span>its <span class="_ _9"></span>process <span class="_ _3"></span>ID.<span class="_ _16"> </span>There<span class="_ _47"> </span>is<span class="_ _45"> </span>no<span class="_ _45"> </span>portable <span class="_ _3"></span>way <span class="_ _9"></span>to</div><div class="t m0 x32 h2a y189 ff19 fsf fc0 sc0 ls0 ws0">obtain <span class="_ _2"></span>the <span class="_ _3"></span>effective user <span class="_ _3"></span>ID, <span class="_ _2"></span>given <span class="_ _3"></span>the <span class="_ _2"></span>process <span class="_ _2"></span>ID.<span class="_ _61"> </span>(Naturally<span class="_ _6"></span><span class="ls511">,t<span class="_ _8"></span><span class="ls0">he <span class="_ _3"></span>kernel <span class="_ _2"></span>maintains <span class="_ _3"></span>both</span></span></div><div class="t m0 x32 h2a y18a ff19 fsf fc0 sc0 ls0 ws0">values in the process table entry<span class="_ _4"></span><span class="lsb5d">,b<span class="_ _d"></span><span class="ls0">ut other than rummaging around thr<span class="_ _0"></span>ough the kernel’s</span></span></div><div class="t m0 x32 h2a y18b ff19 fsf fc0 sc0 ls0 ws0">memory<span class="_ _4"></span>,<span class="_"> </span>we<span class="_"> </span>can’t obtain one, given the other<span class="_ _1"></span>.)</div><div class="t m0 x3f h2a y18c ff19 fsf fc0 sc0 ls5f ws0">We<span class="_ _9"></span><span class="ls0">’ll <span class="_ _3"></span>use <span class="_ _9"></span>the <span class="_ _3"></span>following <span class="_ _9"></span>technique <span class="_ _3"></span>in <span class="_ _9"></span>Section <span class="_ _3"></span>17.2 <span class="_ _9"></span>to <span class="_ _3"></span>allow <span class="_ _9"></span>the <span class="_ _3"></span>server <span class="_ _3"></span>to <span class="_ _9"></span>identify <span class="_ _3"></span>the</span></div><div class="t m0 x32 h2a y18d ff19 fsf fc0 sc0 ls0 ws0">client. <span class="_ _47"> </span>The<span class="_ _45"> </span>same <span class="_ _3"></span>technique <span class="_ _3"></span>can <span class="_ _9"></span>be <span class="_ _3"></span>used <span class="_ _3"></span>with <span class="_ _9"></span>FIFOs, <span class="_ _3"></span>message <span class="_ _9"></span>queues, <span class="_ _3"></span>semaphores, <span class="_ _3"></span>and</div><div class="t m0 x32 h2a y18e ff19 fsf fc0 sc0 ls0 ws0">shared memory<span class="_ _6"></span><span class="ls12ca">.F<span class="_ _1d"></span><span class="ls0">or <span class="_ _3"></span>the <span class="_ _3"></span>following <span class="_ _2"></span>description, <span class="_ _3"></span>assume <span class="_ _2"></span>that <span class="_ _3"></span>FIFOs <span class="_ _3"></span>ar<span class="lsf72">eb<span class="_ _8"></span><span class="ls0">eing <span class="_ _2"></span>used, <span class="_ _3"></span>as <span class="_ _3"></span>in</span></span></span></span></div><div class="t m0 x32 h2a y18f ff19 fsf fc0 sc0 ls0 ws0">Figur<span class="ls17d">e1<span class="_ _b"></span><span class="ls0">5.23. <span class="_ _47"> </span>The<span class="_ _45"> </span>client <span class="_ _2"></span>must <span class="_ _3"></span>create <span class="_ _3"></span>its <span class="_ _3"></span>own <span class="_ _3"></span>FIFO <span class="_ _3"></span>and <span class="_ _9"></span>set <span class="_ _3"></span>the <span class="_ _3"></span>ﬁle <span class="_ _3"></span>access <span class="_ _3"></span>permissions <span class="_ _3"></span>of</span></span></div><div class="t m0 x32 h2a y190 ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _9"></span>FIFO <span class="_ _23"></span>so <span class="_ _9"></span>that <span class="_ _23"></span>only <span class="_ _9"></span>user-r<span class="_ _0"></span>ead <span class="_ _9"></span>and <span class="_ _23"></span>user<span class="_ _0"></span>-write <span class="_ _9"></span>ar<span class="ls12cb">eo<span class="_ _b"></span><span class="ls0">n. <span class="_ _45"> </span>W<span class="_ _6"></span><span class="ls12cc">ea<span class="_ _b"></span><span class="ls0">ssume <span class="_ _9"></span>that <span class="_ _9"></span>the <span class="_ _23"></span>server <span class="_ _9"></span>has</span></span></span></span></div><div class="t m0 x32 h2a y191 ff19 fsf fc0 sc0 ls0 ws0">superuser <span class="_ _3"></span>privileges <span class="_ _9"></span>(or <span class="_ _9"></span>else <span class="_ _9"></span>it <span class="_ _9"></span>probably <span class="_ _3"></span>wouldn’t <span class="_ _9"></span>car<span class="ls889">ea<span class="_ _b"></span><span class="ls0">bout <span class="_ _3"></span>the <span class="_ _9"></span>client’s <span class="_ _9"></span>true <span class="_ _9"></span>identity),</span></span></div><div class="t m0 x32 h2a y192 ff19 fsf fc0 sc0 ls0 ws0">so <span class="_ _2"></span>the <span class="_ _3"></span>server <span class="_ _3"></span>can <span class="_ _3"></span>still <span class="_ _2"></span>read <span class="_ _2"></span>and <span class="_ _3"></span>write <span class="_ _3"></span>to <span class="_ _3"></span>this <span class="_ _2"></span>FIFO.<span class="_ _16"> </span>When <span class="_ _3"></span>the <span class="_ _2"></span>server <span class="_ _3"></span>receives <span class="_ _2"></span>the <span class="_ _3"></span>client’s</div><div class="t m0 x32 h2a y1dc ff19 fsf fc0 sc0 ls0 ws0">ﬁrst <span class="_ _23"></span>request <span class="_ _9"></span>on <span class="_ _23"></span>the <span class="_ _23"></span>server<span class="_ _3"></span>’s <span class="_ _23"></span>well-known <span class="_ _23"></span>FIFO <span class="_ _23"></span>(which <span class="_ _9"></span>must <span class="_ _23"> </span>contain <span class="_ _23"> </span>the <span class="_ _23"></span>identity <span class="_ _23"></span>of <span class="_ _9"></span>the</div><div class="t m0 x32 h26 y1dd ff19 fsf fc0 sc0 ls0 ws0">client-speciﬁc <span class="_ _9"></span>FIFO), <span class="_ _9"></span>the <span class="_ _23"></span>server <span class="_ _9"></span>calls <span class="_ _23"></span>either<span class="_ _45"> </span><span class="ff1a">stat<span class="_ _45"> </span></span>or<span class="_ _45"> </span><span class="ff1a">fstat<span class="_ _45"> </span></span>on <span class="_ _9"></span>the <span class="_ _23"></span>client-speciﬁc <span class="_ _9"></span>FIFO.</div><div class="t m0 x32 h2a y1de ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _3"></span>server <span class="_ _3"></span>assumes <span class="_ _3"></span>that <span class="_ _3"></span>the <span class="_ _3"></span>effective <span class="_ _2"></span>user <span class="_ _3"></span>ID <span class="_ _3"></span>of <span class="_ _3"></span>the <span class="_ _3"></span>client <span class="_ _3"></span>is <span class="_ _3"></span>the <span class="_ _3"></span>owner <span class="_ _9"></span>of <span class="_ _2"></span>the <span class="_ _3"></span>FIFO <span class="_ _9"></span>(the</div><div class="t m0 x32 h26 y1df ff1a fsf fc0 sc0 ls0 ws0">st_uid<span class="_ _44"> </span><span class="ff19">ﬁeld <span class="_ _42"> </span>of <span class="_ _42"> </span>the<span class="_ _44"> </span></span>stat<span class="_ _44"> </span><span class="ff19">structur<span class="_ _0"></span>e). <span class="_ _44"> </span>The<span class="_ _35"> </span>server <span class="_ _53"> </span>veriﬁes <span class="_ _42"> </span>that <span class="_ _42"> </span>only <span class="_ _42"> </span>the <span class="_ _42"> </span>user-read <span class="_ _42"> </span>and</span></div><div class="t m0 x32 h2a y1e0 ff19 fsf fc0 sc0 ls0 ws0">user-write <span class="_ _42"> </span>permissions <span class="_ _42"> </span>ar<span class="lsf79">ee<span class="_ _c"></span><span class="ls0">nabled. <span class="_ _44"> </span>As<span class="_ _4b"> </span>another <span class="_ _42"> </span>check, <span class="_ _53"> </span>the <span class="_ _42"> </span>server <span class="_ _53"> </span>should <span class="_ _53"> </span>look <span class="_ _53"> </span>at <span class="_ _42"> </span>the</span></span></div><div class="t m0 x32 h26 y1e1 ff19 fsf fc0 sc0 ls0 ws0">three <span class="_ _2"></span>times <span class="_ _9"></span>associated <span class="_ _3"></span>with <span class="_ _3"></span>the <span class="_ _3"></span>FIFO <span class="_ _9"></span>(the<span class="_ _47"> </span><span class="ff1a">st_atime</span>,<span class="_ _45"> </span><span class="ff1a">st_mtime</span><span class="ls12cd">,a<span class="_ _b"></span><span class="ls0">nd<span class="_ _45"> </span><span class="ff1a">st_ctime<span class="_ _47"> </span></span>ﬁelds</span></span></div><div class="t m0 x32 h26 y467a ff19 fsf fc0 sc0 ls0 ws0">of <span class="_ _2"></span>the<span class="_ _47"> </span><span class="ff1a">stat<span class="_ _47"> </span></span>structure) <span class="_ _2"></span>to <span class="_ _3"></span>verify <span class="_ _3"></span>that <span class="_ _3"></span>they <span class="_ _2"></span>ar<span class="lscde">er<span class="_ _8"></span><span class="ls0">ecent <span class="_ _3"></span>(no <span class="_ _2"></span>older <span class="_ _3"></span>than <span class="_ _3"></span>15 <span class="_ _3"></span>or <span class="_ _3"></span>30 <span class="_ _2"></span>seconds, <span class="_ _3"></span>for</span></span></div><div class="t m0 x32 h2a y467b ff19 fsf fc0 sc0 ls0 ws0">example). <span class="_ _45"> </span>If<span class="_ _45"> </span><span class="ls870">am<span class="_ _b"></span><span class="ls0">alicious <span class="_ _9"></span>client <span class="_ _23"></span>can <span class="_ _9"></span>create <span class="_ _9"></span>a <span class="_ _9"></span>FIFO <span class="_ _23"></span>with <span class="_ _9"></span>someone <span class="_ _9"></span>else <span class="_ _23"></span>as <span class="_ _9"></span>the <span class="_ _23"></span>owner <span class="_ _9"></span>and</span></span></div><div class="t m0 x32 h2a y467c ff19 fsf fc0 sc0 ls0 ws0">set <span class="_ _2"></span>the <span class="_ _3"></span>ﬁle’s <span class="_ _3"></span>permission <span class="_ _2"></span>bits <span class="_ _3"></span>to <span class="_ _3"></span>user-r<span class="_ _1"></span>ead <span class="_ _3"></span>and <span class="_ _3"></span>user-write <span class="_ _2"></span>only<span class="_ _4"></span><span class="ls12ce">,t<span class="_ _4f"></span><span class="ls0">hen <span class="_ _3"></span>the <span class="_ _2"></span>system <span class="_ _3"></span>has <span class="_ _3"></span>other</span></span></div><div class="t m0 x32 h2a y467d ff19 fsf fc0 sc0 ls0 ws0">fundamental security problems.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
