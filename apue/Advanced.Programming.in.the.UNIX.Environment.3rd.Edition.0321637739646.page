<div id="pf286" class="pf w4 h1f" data-page-no="286"><div class="pc pc286 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg286.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">612<span class="_ _1b"> </span><span class="ff19">Network <span class="_"> </span>IPC: <span class="_"> </span>Sockets<span class="_ _2c6"> </span>Chapter <span class="_"> </span>16</span></div><div class="t m0 x3f h26 y12f ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _4b"> </span><span class="ff1a">recv<span class="_ _44"> </span></span>function <span class="_ _e"> </span>is <span class="_ _53"> </span>similar <span class="_ _e"> </span>to<span class="_ _4b"> </span><span class="ff1a">read</span><span class="ls135e">,b<span class="_ _55"></span><span class="ls0">ut <span class="_ _e"> </span>allows <span class="_ _53"> </span>us <span class="_ _e"> </span>to <span class="_ _53"> </span>specify <span class="_ _e"> </span>some <span class="_ _53"> </span>options <span class="_ _e"> </span>to</span></span></div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">control how we r<span class="_ _0"></span>eceive the data.</div><div class="t m0 x3f h57 y494c ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;sys/socket.h&gt;</div><div class="t m0 x3f h57 y494d ff1a fs2d fc0 sc0 ls0 ws0">ssize_t recv(int<span class="_"> </span><span class="ff1b">sockfd</span><span class="ls15c">,v<span class="_ _1d"></span><span class="ls0">oid *<span class="ff1b">buf</span><span class="ls15c">,s<span class="_ _5b"></span><span class="ls0">ize_t<span class="_"> </span><span class="ff1b">nbytes</span><span class="ls15c">,i<span class="_ _1d"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">ﬂags</span>);</span></span></span></span></span></span></div><div class="t m0 x187 h5f y494e ff19 fs2d fc0 sc0 ls0 ws0">Returns: length of message in bytes,</div><div class="t m0 xe9 h5f y494f ff19 fs2d fc0 sc0 ls0 ws0">0<span class="_"> </span>if<span class="_"> </span>no<span class="_"> </span>messages ar<span class="ls110">ea<span class="_ _d"></span><span class="ls0">vailable and peer has done an orderly shutdown,</span></span></div><div class="t m0 x11e h5f y4950 ff19 fs2d fc0 sc0 ls0 ws0">or<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h4d y4951 ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _23"></span>ﬂags <span class="_ _9"></span>that <span class="_ _23"> </span>can <span class="_ _23"></span>be <span class="_ _23"></span>passed <span class="_ _9"></span>to<span class="_ _35"> </span><span class="ff1a">recv<span class="_ _45"> </span></span>ar<span class="ls6e7">es<span class="_ _b"></span><span class="ls0">ummarized <span class="_ _9"></span>in <span class="_ _23"></span>Figur<span class="ls68a">e1<span class="_ _43"></span><span class="ls0">6.14. <span class="_ _35"> </span>Only<span class="_ _45"> </span>three <span class="_ _9"></span>are</span></span></span></span></div><div class="t m0 x32 h49 y4952 ff19 fs26 fc0 sc0 ls0 ws0">deﬁned by the Single UNIX Speciﬁcation.</div><div class="t m0 x6d h2e y4953 ff19 fs11 fc0 sc0 ls0 ws0">FreeBSD <span class="_ _141"> </span>Linux<span class="_ _3a"> </span>Mac OS X<span class="_ _7f"> </span>Solaris</div><div class="t m0 x1af h2e y4954 ff19 fs11 fc0 sc0 ls0 ws0">8.0 <span class="_ _215"> </span>3.2.0<span class="_ _76"> </span>10.6.8 <span class="_ _bf"> </span>10</div><div class="t m0 x150 h2e y4955 ff19 fs11 fc0 sc0 ls0 ws0">Flag<span class="_ _a6"> </span>Description<span class="_ _2d2"> </span>POSIX.1</div><div class="t m0 x22c h6d y4956 ff1a fs12 fc0 sc0 ls0 ws0">MSG_CMSG_CLOEXEC<span class="_ _112"> </span><span class="ff19">•<span class="_ _2d3"></span>Set the close-on-exec ﬂag for ﬁle</span></div><div class="t m0 x180 h2f y4957 ff19 fs12 fc0 sc0 ls0 ws0">descriptors received over a</div><div class="t m0 x180 h2f y4958 ff19 fs12 fc0 sc0 ls0 ws0">UNIX domain socket (see</div><div class="t m0 x180 h2f y4959 ff19 fs12 fc0 sc0 ls0 ws0">Section 17.4).</div><div class="t m0 x22c h6d y495a ff1a fs12 fc0 sc0 ls0 ws0">MSG_DONTWAIT<span class="_ _2d4"> </span><span class="ff19 ls7a2">•• <span class="_ _66"> </span>•<span class="_ _2d5"></span><span class="ls0">Enable nonblocking operation</span></span></div><div class="t m0 x180 h2f y495b ff19 fs12 fc0 sc0 ls0 ws0">(equivalent to using</div><div class="t m0 x180 h6d y495c ff1a fs12 fc0 sc0 ls0 ws0">O_NONBLOCK<span class="ff19">).</span></div><div class="t m0 x22c h6d y495d ff1a fs12 fc0 sc0 ls0 ws0">MSG_ERRQUEUE<span class="_ _2d6"> </span><span class="ff19">•<span class="_ _2d3"></span>Receive err<span class="_ _0"></span>or information as</span></div><div class="t m0 x180 h2f y495e ff19 fs12 fc0 sc0 ls0 ws0">ancillary data.</div><div class="t m0 x22c h6d y495f ff1a fs12 fc0 sc0 ls0 ws0">MSG_OOB<span class="_ _2d7"> </span><span class="ff19 ls7a2">•••••<span class="_ _2d5"></span><span class="ls0">Retrieve out-of-band data if</span></span></div><div class="t m0 x180 h2f y4960 ff19 fs12 fc0 sc0 ls0 ws0">supported by protocol (see</div><div class="t m0 x180 h2f y4961 ff19 fs12 fc0 sc0 ls0 ws0">Section 16.7).</div><div class="t m0 x22c h6d y4962 ff1a fs12 fc0 sc0 ls0 ws0">MSG_PEEK<span class="_ _2d8"> </span><span class="ff19 ls7a2">•••••<span class="_ _2d5"></span><span class="ls0">Return packet contents without</span></span></div><div class="t m0 x180 h2f y4963 ff19 fs12 fc0 sc0 ls0 ws0">consuming the packet.</div><div class="t m0 x22c h6d y4964 ff1a fs12 fc0 sc0 ls0 ws0">MSG_TRUNC<span class="_ _2d9"> </span><span class="ff19">•<span class="_ _2d3"></span>Request that the r<span class="_ _0"></span>eal length of</span></div><div class="t m0 x180 h2f y4965 ff19 fs12 fc0 sc0 ls0 ws0">the packet be returned, even</div><div class="t m0 x180 h2f y4966 ff19 fs12 fc0 sc0 ls0 ws0">if it was truncated.</div><div class="t m0 x22c h6d y4967 ff1a fs12 fc0 sc0 ls0 ws0">MSG_WAITALL<span class="_ _2da"> </span><span class="ff19 ls7a2">•••••<span class="_ _2d5"></span><span class="ls389">Wa<span class="_ _3"></span><span class="ls0">it until all data is available</span></span></span></div><div class="t m0 x180 h6d y4968 ff19 fs12 fc0 sc0 ls0 ws0">(<span class="ff1a">SOCK_STREAM<span class="_ _53"> </span></span>only).</div><div class="t m0 xbe h63 y4969 ff18 fs13 fc0 sc0 ls0 ws0">Figure 16.14<span class="_ _5a"> </span><span class="ff19">Flags used with<span class="_"> </span><span class="ff1a">recv<span class="_ _e"> </span></span>socket calls</span></div><div class="t m0 x3f h64 y496a ff19 fs31 fc0 sc0 ls0 ws0">When <span class="_"> </span>we <span class="_ _53"> </span>specify <span class="_"> </span>the<span class="_ _59"> </span><span class="ff1a">MSG_PEEK<span class="_ _4b"> </span></span>ﬂag, <span class="_"> </span>we <span class="_"> </span>can <span class="_ _53"> </span>peek <span class="_"> </span>at <span class="_ _e"> </span>the <span class="_"> </span>next <span class="_ _e"> </span>data <span class="_"> </span>to <span class="_ _e"> </span>be <span class="_"> </span>r<span class="_ _0"></span>ead</div><div class="t m0 x32 h64 y496b ff19 fs31 fc0 sc0 ls0 ws0">without <span class="_ _3"></span>actually <span class="_ _2"></span>consuming <span class="_ _3"></span>it.<span class="_ _16"> </span>The <span class="_ _3"></span>next <span class="_ _3"></span>call <span class="_ _3"></span>to<span class="_ _47"> </span><span class="ff1a">read<span class="_ _47"> </span></span>or <span class="_ _3"></span>one <span class="_ _3"></span>of <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">recv<span class="_ _47"> </span></span>functions <span class="_ _3"></span>will</div><div class="t m0 x32 h6e y496c ff19 fs31 fc0 sc0 ls225 ws0">re<span class="ls0">turn the same data we peeked at.</span></div><div class="t m0 x3f h64 y496d ff19 fs31 fc0 sc0 ls439 ws0">Wi<span class="_ _3"></span><span class="ls0">th<span class="_ _46"> </span><span class="ff1a">SOCK_STREAM<span class="_ _61"> </span></span>sockets, <span class="_"> </span>we <span class="_ _66"> </span>can <span class="_ _66"> </span>receive <span class="_"> </span>less <span class="_ _66"> </span>data <span class="_ _66"> </span>than <span class="_ _47"> </span>we <span class="_"> </span>requested. <span class="_ _46"> </span>The</span></div><div class="t m0 x32 h64 y496e ff1a fs31 fc0 sc0 ls0 ws0">MSG_WAITALL<span class="_ _47"> </span><span class="ff19">ﬂag <span class="_ _9"></span>inhibits <span class="_ _9"></span>this <span class="_ _3"></span>behavior<span class="_ _1"></span><span class="ls135f">,p<span class="_ _8"></span><span class="ls225">re<span class="ls0">venting<span class="_ _45"> </span><span class="ff1a">recv<span class="_ _45"> </span></span>fr<span class="_ _0"></span>om <span class="_ _3"></span>returning <span class="_ _3"></span>until <span class="_ _9"></span>all <span class="_ _9"></span>the</span></span></span></span></div><div class="t m0 x32 h64 y496f ff19 fs31 fc0 sc0 ls0 ws0">data <span class="_ _45"> </span>we <span class="_ _45"> </span>requested <span class="_ _45"> </span>has <span class="_ _45"> </span>been <span class="_ _45"> </span>received. <span class="_ _16"> </span>W<span class="_ _0"></span>ith<span class="_ _5a"> </span><span class="ff1a">SOCK_DGRAM<span class="_"> </span></span>and<span class="_ _5a"> </span><span class="ff1a">SOCK_SEQPACKET</span></div><div class="t m0 x32 h64 y4970 ff19 fs31 fc0 sc0 ls0 ws0">sockets, <span class="_ _4b"> </span>the<span class="_ _65"> </span><span class="ff1a">MSG_WAITALL<span class="_ _48"> </span></span>ﬂag <span class="_ _4b"> </span>provides <span class="_ _44"> </span>no <span class="_ _59"> </span>change <span class="_ _4b"> </span>in <span class="_ _4b"> </span>behavior<span class="_ _6"></span><span class="ls1360">,b<span class="_ _52"></span><span class="ls0">ecause <span class="_ _44"> </span>these</span></span></div><div class="t m0 x32 h6e y4971 ff19 fs31 fc0 sc0 ls0 ws0">message-based socket types already r<span class="_ _0"></span>eturn an entir<span class="_ _0"></span><span class="ls229">em<span class="_ _d"></span><span class="ls0">essage in a single read.</span></span></div><div class="t m0 x3f h64 y4972 ff19 fs31 fc0 sc0 ls0 ws0">If <span class="_"> </span>the <span class="_ _e"> </span>sender <span class="_"> </span>has <span class="_ _e"> </span>called<span class="_ _59"> </span><span class="ff1a">shutdown<span class="_ _59"> </span></span>(Section <span class="_"> </span>16.2) <span class="_ _e"> </span>to <span class="_"> </span>end <span class="_ _e"> </span>transmission, <span class="_"> </span>or <span class="_ _e"> </span>if <span class="_"> </span>the</div><div class="t m0 x32 h6e y4973 ff19 fs31 fc0 sc0 ls0 ws0">network <span class="_ _9"></span>protocol <span class="_ _3"></span>supports <span class="_ _9"></span>orderly <span class="_ _3"></span>shutdown <span class="_ _9"></span>by <span class="_ _3"></span>default <span class="_ _9"></span>and <span class="_ _9"></span>the <span class="_ _9"></span>sender <span class="_ _9"></span>has <span class="_ _3"></span>closed <span class="_ _9"></span>the</div><div class="t m0 x32 h64 y4974 ff19 fs31 fc0 sc0 ls0 ws0">socket, then<span class="_"> </span><span class="ff1a">recv<span class="_ _80"> </span></span>will return 0 when we have received all the data.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
