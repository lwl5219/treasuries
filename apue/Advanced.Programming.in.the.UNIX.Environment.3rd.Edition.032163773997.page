<div id="pf61" class="pf w4 h1f" data-page-no="61"><div class="pc pc61 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg61.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h7a ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>3.3<span class="_ _16a"> </span><span class="ff1a">open<span class="_ _4b"> </span></span>and<span class="_ _4b"> </span><span class="ff1a">openat<span class="_ _4b"> </span></span>Functions<span class="_ _1b"> </span><span class="ff18">63</span></div><div class="t m0 x38 h52 y2a3 ff19 fs2a fc0 sc0 ls0 ws0">The <span class="_ _2"></span>purpose <span class="_ _2"></span>of <span class="_ _2"></span>the<span class="_ _80"> </span><span class="ff1a">O_SEARCH<span class="_ _e"> </span></span>constant <span class="_ _3"></span>is <span class="_ _2"></span>to <span class="_ _2"></span>evaluate <span class="_ _2"></span>search permissions <span class="_ _2"></span>at <span class="_ _3"></span>the <span class="_ _2"></span>time</div><div class="t m0 x38 h51 y2a4 ff19 fs2a fc0 sc0 ls348 ws0">ad<span class="_ _8"></span><span class="ls0">irectory <span class="_ _9"></span>is <span class="_ _23"> </span>opened.<span class="_ _46"> </span>Further <span class="_ _23"> </span>operations <span class="_ _23"> </span>using <span class="_ _9"> </span>the <span class="_ _23"> </span>directory’s <span class="_ _9"> </span>ﬁle <span class="_ _23"> </span>descriptor <span class="_ _23"> </span>will</span></div><div class="t m0 x38 h51 y2a5 ff19 fs2a fc0 sc0 ls0 ws0">not <span class="_"> </span>reevaluate <span class="_ _80"> </span>permission <span class="_"> </span>to <span class="_ _80"> </span>search <span class="_ _e"> </span>the <span class="_ _80"> </span>directory<span class="_ _6"></span><span class="ls349">.N<span class="_ _7"></span><span class="ls0">one <span class="_ _80"> </span>of <span class="_ _e"> </span>the <span class="_ _80"> </span>versions <span class="_ _80"> </span>of <span class="_ _e"> </span>the</span></span></div><div class="t m0 x38 h52 y2a6 ff19 fs2a fc0 sc0 ls0 ws0">operating systems covered in this book support<span class="_"> </span><span class="ff1a">O_SEARCH<span class="_ _53"> </span></span>yet.</div><div class="t m0 x32 h2a ya1f ff19 fsf fc0 sc0 ls0 ws0">One <span class="_"> </span>and <span class="_ _e"> </span>only <span class="_"> </span>one <span class="_"> </span>of <span class="_ _e"> </span>the <span class="_"> </span>pr<span class="_ _0"></span>evious <span class="_"> </span>ﬁve <span class="_ _e"> </span>constants <span class="_"> </span>must <span class="_ _e"> </span>be <span class="_"> </span>speciﬁed.<span class="_ _48"> </span>The <span class="_"> </span>following</div><div class="t m0 x32 h2a ya20 ff19 fsf fc0 sc0 ls0 ws0">constants ar<span class="ls44">eo<span class="_ _4f"></span><span class="ls0">ptional:</span></span></div><div class="t m0 x32 h26 ya21 ff1a fsf fc0 sc0 ls0 ws0">O_APPEND<span class="_ _78"> </span><span class="ff19">Append <span class="_ _42"> </span>to <span class="_ _53"> </span>the <span class="_ _53"> </span>end <span class="_ _53"> </span>of <span class="_ _53"> </span>ﬁle <span class="_ _53"> </span>on <span class="_ _53"> </span>each <span class="_ _42"> </span>write.<span class="_ _65"> </span><span class="ls5f">We <span class="_ _35"> </span>d<span class="_ _9"></span></span>escribe <span class="_ _53"> </span>this <span class="_ _42"> </span>option <span class="_ _53"> </span>in</span></div><div class="t m0 xf6 h2a ya22 ff19 fsf fc0 sc0 ls0 ws0">detail in Section 3.1<span class="_ _1"></span>1.</div><div class="t m0 x32 h26 ya23 ff1a fsf fc0 sc0 ls0 ws0">O_CLOEXEC<span class="_ _1b"> </span><span class="ff19">Set <span class="_"> </span>the<span class="_ _46"> </span></span>FD_CLOEXEC<span class="_ _46"> </span><span class="ff19">ﬁle <span class="_"> </span>descriptor <span class="_"> </span>ﬂag.<span class="_ _60"> </span><span class="ls5f">We <span class="_ _4b"> </span>d<span class="_ _9"></span></span>iscuss <span class="_"> </span>ﬁle <span class="_"> </span>descriptor</span></div><div class="t m0 xf6 h2a ya24 ff19 fsf fc0 sc0 ls0 ws0">ﬂags in Section 3.14.</div><div class="t m0 x32 h26 ya25 ff1a fsf fc0 sc0 ls0 ws0">O_CREAT<span class="_ _14"> </span><span class="ff19">Cr<span class="_ _0"></span>eate <span class="_ _3"></span>the <span class="_ _3"></span>ﬁle <span class="_ _9"></span>if <span class="_ _3"></span>it <span class="_ _3"></span>doesn’t <span class="_ _9"></span>exist.<span class="_ _16"> </span>This <span class="_ _3"></span>option <span class="_ _9"></span>requir<span class="_ _1"></span>es <span class="_ _9"></span>a <span class="_ _3"></span>thir<span class="ls34a">da<span class="_ _b"></span><span class="ls45">rg<span class="_ _2"></span><span class="ls0">ument</span></span></span></span></div><div class="t m0 xf6 h26 ya26 ff19 fsf fc0 sc0 ls0 ws0">to <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">open<span class="_ _47"> </span></span>function <span class="_ _3"></span>(a <span class="_ _3"></span>fourth <span class="_ _9"></span>argument <span class="_ _2"></span>to <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">openat<span class="_ _47"> </span></span>function) <span class="_ _4"></span>— <span class="_ _84"></span>the</div><div class="t m0 xf6 h2b ya27 ff1b fsf fc0 sc0 ls0 ws0">mode<span class="ff19 ls34b">,w<span class="_ _8"></span><span class="ls0">hich <span class="_ _3"></span>speciﬁes <span class="_ _3"></span>the <span class="_ _3"></span>access <span class="_ _3"></span>permission <span class="_ _3"></span>bits <span class="_ _3"></span>of <span class="_ _3"></span>the <span class="_ _3"></span>new <span class="_ _3"></span>ﬁle.</span></span></div><div class="t m0 x141 h2a y17e ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 x142 h2a ya27 ff19 fsf fc0 sc0 ls0 ws0">When</div><div class="t m0 xf6 h2a ya28 ff19 fsf fc0 sc0 ls0 ws0">we <span class="_ _3"></span>describe <span class="_ _9"></span>a <span class="_ _9"></span>ﬁle’s <span class="_ _9"></span>access <span class="_ _9"></span>permission <span class="_ _3"></span>bits <span class="_ _9"></span>in <span class="_ _9"></span>Section <span class="_ _9"></span>4.5, <span class="_ _9"></span>we’ll <span class="_ _3"></span>see <span class="_ _9"></span>how</div><div class="t m0 xf6 h26 ya29 ff19 fsf fc0 sc0 ls0 ws0">to specify <span class="_ _2"></span>the<span class="_ _47"> </span><span class="ff1b">mode<span class="_ _66"> </span></span>and <span class="_ _2"></span>how <span class="_ _2"></span>it <span class="_ _2"></span>can <span class="_ _2"></span>be <span class="_ _2"></span>modiﬁed <span class="_ _2"></span>by <span class="_ _2"></span>the<span class="_ _66"> </span><span class="ff1a">umask<span class="_ _47"> </span></span>value of <span class="_ _2"></span>a</div><div class="t m0 xf6 h2a ya2a ff19 fsf fc0 sc0 ls0 ws0">process.)</div><div class="t m0 x32 h26 ya2b ff1a fsf fc0 sc0 ls0 ws0">O_DIRECTORY<span class="_"> </span><span class="ff19">Generate an error if<span class="_"> </span><span class="ff1b">path<span class="_"> </span></span>doesn’t r<span class="_ _0"></span>efer to a dir<span class="_ _0"></span>ectory<span class="_ _4"></span>.</span></div><div class="t m0 x32 h26 ya2c ff1a fsf fc0 sc0 ls0 ws0">O_EXCL<span class="_ _9f"> </span><span class="ff19">Generate <span class="_"> </span>an <span class="_"> </span>error <span class="_"> </span>if<span class="_ _59"> </span></span>O_CREAT<span class="_ _46"> </span><span class="ff19">is <span class="_"> </span>also <span class="_"> </span>speciﬁed <span class="_"> </span>and <span class="_"> </span>the <span class="_"> </span>ﬁle <span class="_"> </span>already</span></div><div class="t m0 xf6 h2a ya2d ff19 fsf fc0 sc0 ls0 ws0">exists. <span class="_ _45"> </span>This<span class="_ _35"> </span>test <span class="_ _23"></span>for <span class="_ _23"></span>whether <span class="_ _23"></span>the <span class="_ _23"></span>ﬁle <span class="_ _9"></span>already <span class="_ _23"></span>exists <span class="_ _23"></span>and <span class="_ _23"></span>the <span class="_ _9"></span>creation <span class="_ _23"></span>of</div><div class="t m0 xf6 h2a ya2e ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _42"> </span>ﬁle <span class="_ _42"> </span>if <span class="_ _42"> </span>it <span class="_ _42"> </span>doesn’t <span class="_ _53"> </span>exist <span class="_ _42"> </span>is <span class="_ _42"> </span>an <span class="_ _42"> </span>atomic <span class="_ _42"> </span>operation.<span class="_ _54"> </span><span class="ls5f">We <span class="_ _45"> </span>d<span class="_ _23"></span></span>escribe <span class="_ _42"> </span>atomic</div><div class="t m0 xf6 h2a ya2f ff19 fsf fc0 sc0 ls0 ws0">operations in mor<span class="ls44">ed<span class="_ _4f"></span><span class="ls0">etail in Section 3.1<span class="_ _0"></span>1.</span></span></div><div class="t m0 x32 h26 ya30 ff1a fsf fc0 sc0 ls0 ws0">O_NOCTTY<span class="_ _78"> </span><span class="ff19">If<span class="_ _4b"> </span><span class="ff1b">path<span class="_ _59"> </span></span><span class="ls45">re</span>fers <span class="_"> </span>to <span class="_ _e"> </span>a <span class="_ _e"> </span>terminal <span class="_"> </span>device, <span class="_ _53"> </span>do <span class="_"> </span>not <span class="_ _53"> </span>allocate <span class="_"> </span>the <span class="_ _e"> </span>device <span class="_ _e"> </span>as <span class="_"> </span>the</span></div><div class="t m0 xf6 h2a ya31 ff19 fsf fc0 sc0 ls0 ws0">controlling <span class="_ _59"> </span>terminal <span class="_ _61"> </span>for <span class="_ _46"> </span>this <span class="_ _46"> </span>process. <span class="_ _60"> </span>W<span class="_ _6"></span><span class="ls34c">et<span class="_ _49"></span><span class="ls0">alk <span class="_ _61"> </span>about <span class="_ _46"> </span>controlling</span></span></div><div class="t m0 xf6 h2a ya32 ff19 fsf fc0 sc0 ls0 ws0">terminals in Section 9.6.</div><div class="t m0 x32 h26 y332 ff1a fsf fc0 sc0 ls0 ws0">O_NOFOLLOW<span class="_ _6e"> </span><span class="ff19">Generate <span class="_ _2"></span>an <span class="_ _2"></span>error <span class="_ _2"></span>if<span class="_ _47"> </span><span class="ff1b">path<span class="_ _47"> </span></span><span class="ls45">re</span>fers <span class="_ _3"></span>to <span class="_ _2"></span>a <span class="_ _2"></span>symbolic <span class="_ _3"></span>link.<span class="_ _61"> </span><span class="ls5f">We <span class="_ _80"> </span>d<span class="_ _9"></span></span>iscuss <span class="_ _2"></span>symbolic</span></div><div class="t m0 xf6 h2a y333 ff19 fsf fc0 sc0 ls0 ws0">links in Section 4.17.</div><div class="t m0 x32 h26 ya33 ff1a fsf fc0 sc0 ls0 ws0">O_NONBLOCK<span class="_ _6e"> </span><span class="ff19">If<span class="_ _35"> </span><span class="ff1b">path<span class="_ _35"> </span></span><span class="ls45">re</span>fers <span class="_ _42"> </span>to <span class="_ _23"></span>a <span class="_ _23"> </span>FIFO, <span class="_ _23"> </span>a <span class="_ _42"> </span>block <span class="_ _23"></span>special <span class="_ _23"> </span>ﬁle, <span class="_ _23"> </span>or <span class="_ _42"> </span>a <span class="_ _23"></span>character <span class="_ _23"> </span>special <span class="_ _23"> </span>ﬁle,</span></div><div class="t m0 xf6 h2a ya34 ff19 fsf fc0 sc0 ls0 ws0">this <span class="_ _9"></span>option <span class="_ _23"></span>sets <span class="_ _9"></span>the <span class="_ _23"> </span>nonblocking <span class="_ _23"></span>mode <span class="_ _9"></span>for <span class="_ _23"></span>both <span class="_ _9"></span>the <span class="_ _23"></span>opening <span class="_ _9"></span>of <span class="_ _23"> </span>the <span class="_ _23"></span>ﬁle</div><div class="t m0 xf6 h2a ya35 ff19 fsf fc0 sc0 ls0 ws0">and subsequent I/O.<span class="_ _59"> </span><span class="ls5f">We <span class="_ _e"> </span>d<span class="_ _9"></span></span>escribe this mode in Section 14.2.</div><div class="t m0 x38 h52 ya36 ff19 fs2a fc0 sc0 ls0 ws0">In <span class="_ _3"></span>earlier <span class="_ _3"></span>releases <span class="_ _3"></span>of <span class="_ _3"></span>System <span class="_ _9"></span>V<span class="_ _6"></span><span class="ls34d">,t<span class="_ _4f"></span><span class="ls0">he<span class="_ _66"> </span><span class="ff1a">O_NDELAY<span class="_ _66"> </span></span>(no <span class="_ _3"></span>delay) <span class="_ _9"></span>ﬂag <span class="_ _3"></span>was <span class="_ _3"></span>introduced. <span class="_ _66"> </span>This</span></span></div><div class="t m0 x38 h52 ya37 ff19 fs2a fc0 sc0 ls0 ws0">option <span class="_ _23"> </span>is <span class="_ _23"> </span>similar <span class="_ _9"> </span>to <span class="_ _23"> </span>the<span class="_ _45"> </span><span class="ff1a">O_NONBLOCK<span class="_ _47"> </span></span>(nonblocking) <span class="_ _23"> </span>option, <span class="_ _23"> </span>but <span class="_ _23"> </span>an <span class="_ _23"> </span>ambiguity <span class="_ _23"> </span>was</div><div class="t m0 x38 h51 ya38 ff19 fs2a fc0 sc0 ls0 ws0">introduced <span class="_ _2"></span>in <span class="_ _2"></span>the <span class="_ _3"></span>return <span class="_ _2"></span>value <span class="_ _3"></span>from <span class="_ _2"></span>a <span class="_ _3"></span>read <span class="_ _2"></span>operation.<span class="_ _4b"> </span>The <span class="_ _2"></span>no-delay <span class="_ _3"></span>option <span class="_ _3"></span>causes <span class="_ _2"></span>a</div><div class="t m0 x38 h51 ya39 ff19 fs2a fc0 sc0 ls34e ws0">re<span class="ls0">ad <span class="_ _2"></span>operation <span class="_ _2"></span>to <span class="_ _3"></span>return 0 <span class="_ _2"></span>if <span class="_ _3"></span>there<span class="_"> </span>is<span class="_ _80"> </span>no<span class="_ _80"> </span>data <span class="_ _2"></span>to <span class="_ _2"></span>be <span class="_ _3"></span>read from <span class="_ _2"></span>a <span class="_ _2"></span>pipe, <span class="_ _2"></span>FIFO, <span class="_ _2"></span>or <span class="_ _3"></span>device,</span></div><div class="t m0 x38 h51 ya3a ff19 fs2a fc0 sc0 ls0 ws0">but <span class="_ _42"> </span>this <span class="_ _23"> </span>conﬂicts <span class="_ _42"> </span>with <span class="_ _42"> </span>a <span class="_ _42"> </span>return <span class="_ _23"> </span>value <span class="_ _42"> </span>of <span class="_ _42"> </span>0, <span class="_ _42"> </span>indicating <span class="_ _23"> </span>an <span class="_ _42"> </span>end <span class="_ _42"> </span>of <span class="_ _42"> </span>ﬁle.<span class="_ _61"> </span>SVR4</div><div class="t m0 x106 h51 ya3b ff19 fs2a fc0 sc0 ls0 ws0">-</div><div class="t m0 x14f h51 ya3a ff19 fs2a fc0 sc0 ls0 ws0">based</div><div class="t m0 x38 h51 ya3c ff19 fs2a fc0 sc0 ls0 ws0">systems <span class="_ _45"> </span>still <span class="_ _45"> </span>support <span class="_ _35"> </span>the <span class="_ _45"> </span>no-delay <span class="_ _45"> </span>option, <span class="_ _35"> </span>with <span class="_ _45"> </span>the <span class="_ _45"> </span>old <span class="_ _35"> </span>semantics, <span class="_ _45"> </span>but <span class="_ _45"> </span>new</div><div class="t m0 x38 h51 ya3d ff19 fs2a fc0 sc0 ls0 ws0">applications should use the nonblocking option instead.</div><div class="t m0 x32 h26 ya3e ff1a fsf fc0 sc0 ls0 ws0">O_SYNC<span class="_ _9f"> </span><span class="ff19">Have <span class="_ _e"> </span>each<span class="_ _4b"> </span></span>write<span class="_ _59"> </span><span class="ff19">wait <span class="_ _e"> </span>for <span class="_"> </span>physical <span class="_ _53"> </span>I/O <span class="_ _e"> </span>to <span class="_"> </span>complete, <span class="_ _53"> </span>including <span class="_ _e"> </span>I/O</span></div><div class="t m0 xf6 h26 ya3f ff19 fsf fc0 sc0 ls0 ws0">necessary <span class="_ _42"> </span>to <span class="_ _42"> </span>update <span class="_ _42"> </span>ﬁle <span class="_ _42"> </span>attributes <span class="_ _42"> </span>modiﬁed <span class="_ _42"> </span>as <span class="_ _42"> </span>a <span class="_ _42"> </span>result <span class="_ _42"> </span>of <span class="_ _42"> </span>the<span class="_ _35"> </span><span class="ff1a">write</span>.</div><div class="t m0 xf6 h2a ya40 ff19 fsf fc0 sc0 ls5f ws0">We <span class="_ _53"> </span>u<span class="_ _9"></span><span class="ls0">se this option in Section 3.14.</span></div><div class="t m0 x32 h26 ya41 ff1a fsf fc0 sc0 ls0 ws0">O_TRUNC<span class="_ _14"> </span><span class="ff19">If <span class="_ _3"></span>the <span class="_ _9"></span>ﬁle <span class="_ _9"></span>exists <span class="_ _3"></span>and <span class="_ _9"></span>if <span class="_ _9"></span>it <span class="_ _9"></span>is <span class="_ _3"></span>successfully <span class="_ _9"></span>opened <span class="_ _9"></span>for <span class="_ _9"></span>either <span class="_ _3"></span>write-only <span class="_ _9"></span>or</span></div><div class="t m0 xf6 h2a ya42 ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">ad–write, truncate its length to 0.</span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
