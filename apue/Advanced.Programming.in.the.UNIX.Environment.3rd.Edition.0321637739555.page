<div id="pf22b" class="pf w4 h1f" data-page-no="22b"><div class="pc pc22b w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg22b.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h7a ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>14.6<span class="_ _2ae"> </span><span class="ff1a">readv<span class="_ _4b"> </span></span>and<span class="_ _4b"> </span><span class="ff1a">writev<span class="_ _4b"> </span></span>Functions<span class="_ _1b"> </span><span class="ff18">521</span></div><div class="t m0 x35 h75 y12f ff16 fs2b fc0 sc0 ls0 ws0">14.6<span class="_ _6d"> </span><span class="ff1f">readv<span class="_ _54"> </span></span>and<span class="_ _54"> </span><span class="ff1f">writev<span class="_ _54"> </span></span>Functions</div><div class="t m0 x32 h26 y4de ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _60"> </span><span class="ff1a">readv<span class="_ _60"> </span></span>and<span class="_ _50"> </span><span class="ff1a">writev<span class="_ _60"> </span></span>functions <span class="_ _61"> </span>let <span class="_ _46"> </span>us <span class="_ _46"> </span>read <span class="_ _46"> </span>into <span class="_ _46"> </span>and <span class="_ _46"> </span>write <span class="_ _61"> </span>from <span class="_ _59"> </span>multiple</div><div class="t m0 x32 h2b y6d0 ff19 fsf fc0 sc0 ls0 ws0">noncontiguous <span class="_ _3"></span>buffers <span class="_ _9"></span>in <span class="_ _3"></span>a <span class="_ _9"></span>single <span class="_ _9"></span>function <span class="_ _9"></span>call.<span class="_ _16"> </span>These <span class="_ _9"></span>operations <span class="_ _9"></span>ar<span class="ls104e">ec<span class="_ _b"></span><span class="ls0">alled<span class="_ _47"> </span><span class="ff1b">scatter <span class="_ _9"></span>read</span></span></span></div><div class="t m0 x32 h2b y6d1 ff19 fsf fc0 sc0 ls0 ws0">and<span class="_"> </span><span class="ff1b">gather write</span>.</div><div class="t m0 x3f h57 y19a8 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;sys/uio.h&gt;</div><div class="t m0 x3f h57 y3fab ff1a fs2d fc0 sc0 ls0 ws0">ssize_t readv(int<span class="_"> </span><span class="ff1b">fd</span><span class="ls15c">,c<span class="_ _1d"></span><span class="ls0">onst struct iovec *<span class="ff1b">iov</span><span class="ls15c">,i<span class="_ _5b"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">iovcnt</span>);</span></span></span></span></div><div class="t m0 x3f h57 y3fac ff1a fs2d fc0 sc0 ls0 ws0">ssize_t writev(int<span class="_"> </span><span class="ff1b">fd</span><span class="ls15c">,c<span class="_ _1d"></span><span class="ls0">onst struct iovec *<span class="ff1b">iov</span><span class="ls15c">,i<span class="_ _5b"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">iovcnt</span>);</span></span></span></span></div><div class="t m0 xff h5f y3fad ff19 fs2d fc0 sc0 ls0 ws0">Both return: number of bytes r<span class="_ _0"></span>ead or written,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h4d y3fae ff19 fs26 fc0 sc0 ls0 ws0">The second argument to both functions is a pointer to an array of<span class="_"> </span><span class="ff1a">iovec<span class="_ _80"> </span></span>structur<span class="_ _0"></span>es:</div><div class="t m0 x3f h4e y3faf ff1a fs28 fc0 sc0 ls0 ws0">struct iovec {</div><div class="t m0 xf4 h4e y3fb0 ff1a fs28 fc0 sc0 ls0 ws0">void <span class="_ _d9"> </span>*iov_base;<span class="_ _3a"> </span>/* starting address of buffer */</div><div class="t m0 xf4 h4e y3fb1 ff1a fs28 fc0 sc0 ls0 ws0">size_t <span class="_"> </span>iov_len;<span class="_ _68"> </span>/* size of buffer */</div><div class="t m0 x3f h4e y3fb2 ff1a fs28 fc0 sc0 ls0 ws0">};</div><div class="t m0 x32 h4d y3fb3 ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _2"></span>number <span class="_ _3"></span>of <span class="_ _3"></span>elements <span class="_ _3"></span>in <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1b">iov<span class="_ _47"> </span></span>array <span class="_ _3"></span>is <span class="_ _3"></span>speciﬁed <span class="_ _2"></span>by<span class="_ _47"> </span><span class="ff1b">iovcnt</span><span class="lsee0">.I<span class="_ _5b"></span><span class="ls0">t<span class="_ _47"> </span>is<span class="_ _47"> </span>limited <span class="_ _2"></span>to<span class="_ _47"> </span><span class="ff1a">IOV_MAX</span></span></span></div><div class="t m0 x32 h49 y3fb4 ff19 fs26 fc0 sc0 ls0 ws0">(recall <span class="_ _3"></span>Figur<span class="ls10ca">e2<span class="_ _b"></span><span class="ls0">.1<span class="_ _1"></span>1). <span class="_ _45"> </span>Figur<span class="ls10cb">e1<span class="_ _b"></span><span class="ls0">4.22 <span class="_ _3"></span>shows <span class="_ _23"></span>a <span class="_ _3"></span>diagram <span class="_ _9"></span>relating <span class="_ _9"></span>the <span class="_ _9"></span>arguments <span class="_ _3"></span>to <span class="_ _9"></span>these <span class="_ _9"></span>two</span></span></span></span></div><div class="t m0 x32 h4d y3fb5 ff19 fs26 fc0 sc0 ls0 ws0">functions and the<span class="_"> </span><span class="ff1a">iovec<span class="_ _80"> </span></span>structure.</div><div class="t m0 x1e2 h2e y3fb6 ff19 fs11 fc0 sc0 ls0 ws0">len0</div><div class="t m0 x1e2 h2f y3fb7 ff19 fs12 fc0 sc0 ls0 ws0">len1</div><div class="t m0 x1b7 h159 y3fb8 ff18 fs31 fc0 sc0 ls229 ws0">...</div><div class="t m0 x13 hd2 y3fb9 ff19 fs14 fc0 sc0 ls0 ws0">len<span class="ff1b">N</span></div><div class="t m0 xa4 h32 y3fba ff19 fs15 fc0 sc0 ls0 ws0">buffer0</div><div class="t m0 xa4 h33 y3fbb ff19 fs16 fc0 sc0 ls0 ws0">buffer1</div><div class="t m0 x5f hfc y3fbc ff19 fs36 fc0 sc0 ls0 ws0">buffer<span class="ff1b">N</span></div><div class="t m0 x16e h71 y3fbd ff1b fs36 fc0 sc0 ls0 ws0">iov<span class="ff1a">[0].iov_base</span></div><div class="t m0 x16e h71 y3fbe ff1b fs36 fc0 sc0 ls0 ws0">iov<span class="ff1a">[0].iov_len</span></div><div class="t m0 x16e h71 y3fbf ff1b fs36 fc0 sc0 ls0 ws0">iov<span class="ff1a">[1].iov_base</span></div><div class="t m0 x16e h71 y3fc0 ff1b fs36 fc0 sc0 ls0 ws0">iov<span class="ff1a">[1].iov_len</span></div><div class="t m0 x79 h71 y3fbc ff1b fs36 fc0 sc0 ls0 ws0">iov<span class="ff1a">[</span>iovcnt<span class="ff20">−</span>1<span class="ff1a">].iov_base</span></div><div class="t m0 x79 h71 y3fc1 ff1b fs36 fc0 sc0 ls0 ws0">iov<span class="ff1a">[</span>iovcnt<span class="ff20">−</span>1<span class="ff1a">].iov_len</span></div><div class="t m0 x1da h36 y3fc2 ff19 fs19 fc0 sc0 ls0 ws0">len0</div><div class="t m0 x1da h39 y3fc3 ff19 fs1c fc0 sc0 ls0 ws0">len1</div><div class="t m0 x168 h15a y3fc4 ff19 fs1f fc0 sc0 ls0 ws0">len<span class="ff1b">N</span></div><div class="t m0 x4 hde y3fc5 ff18 fs1f fc0 sc0 ls0 ws0">Figure 14.22<span class="_ _5a"> </span><span class="ff19">The<span class="_"> </span><span class="ff1a">iovec<span class="_ _e"> </span></span>structur<span class="ls10cc">ef<span class="_ _5"></span><span class="ls0">or<span class="_"> </span><span class="ff1a">readv<span class="_ _e"> </span></span>and<span class="_"> </span><span class="ff1a">writev</span></span></span></span></div><div class="t m0 x32 hdb y3fc6 ff19 fs73 fc0 sc0 ls0 ws0">The<span class="_ _35"> </span><span class="ff1a">writev<span class="_ _35"> </span></span>function <span class="_ _23"> </span>gathers <span class="_ _42"> </span>the <span class="_ _23"> </span>output <span class="_ _42"> </span>data <span class="_ _23"> </span>from <span class="_ _23"></span>the <span class="_ _23"> </span>buffers <span class="_ _23"> </span>in <span class="_ _42"> </span>order:<span class="_ _45"> </span><span class="ff1b">iov[0]</span>,<span class="_ _44"> </span><span class="ff1b">iov[1]</span>,</div><div class="t m0 x32 hdb y3fc7 ff19 fs73 fc0 sc0 ls0 ws0">through<span class="_ _45"> </span><span class="ff1b">iov[iovcnt<span class="ff20">−</span>1]</span>;<span class="_ _45"> </span><span class="ff1a">writev<span class="_ _45"> </span></span><span class="ls10cd">re</span>turns <span class="_ _23"></span>the <span class="_ _9"></span>total <span class="_ _9"></span>number <span class="_ _23"></span>of <span class="_ _9"></span>bytes <span class="_ _9"></span>output, <span class="_ _23"></span>which <span class="_ _9"></span>should</div><div class="t m0 x32 hdd y3fc8 ff19 fs73 fc0 sc0 ls0 ws0">normally equal the sum of all the buffer lengths.</div><div class="t m0 x3f hdb y3fc9 ff19 fs73 fc0 sc0 ls0 ws0">The<span class="_ _35"> </span><span class="ff1a">readv<span class="_ _44"> </span></span>function <span class="_ _23"> </span>scatters <span class="_ _42"> </span>the <span class="_ _42"> </span>data <span class="_ _42"> </span>into <span class="_ _42"> </span>the <span class="_ _23"> </span>buffers <span class="_ _42"> </span>in <span class="_ _42"> </span>or<span class="_ _0"></span>der<span class="_ _6"></span><span class="ls10ce">,a<span class="_ _43"></span><span class="ls0">lways <span class="_ _42"> </span>ﬁlling <span class="_ _42"> </span>one</span></span></div><div class="t m0 x32 hdb y3fca ff19 fs73 fc0 sc0 ls0 ws0">buffer befor<span class="ls10cf">ep<span class="_ _4f"></span><span class="ls10cd">ro<span class="ls0">ceeding <span class="_ _2"></span>to <span class="_ _2"></span>the next.<span class="_ _61"> </span><span class="ff1a">readv<span class="_ _66"> </span></span></span>re<span class="_ _2"></span><span class="ls0">turns the <span class="_ _2"></span>total <span class="_ _2"></span>number of <span class="_ _2"></span>bytes <span class="_ _2"></span>that were</span></span></span></div><div class="t m0 x32 hdd y3fcb ff19 fs73 fc0 sc0 ls10cd ws0">re<span class="ls0">ad. <span class="_ _66"> </span>A<span class="_"> </span>count <span class="_ _2"></span>of 0 is returned if there<span class="_"> </span>is<span class="_"> </span>no<span class="_ _66"> </span>mor<span class="ls10d0">ed<span class="_ _4f"></span><span class="ls0">ata <span class="_ _2"></span>and the end <span class="_ _2"></span>of ﬁle is encountered.</span></span></span></div><div class="t m0 x76 h3d y3fcc ff19 fs1f fc0 sc0 ls0 ws0">These <span class="_ _2"></span>two <span class="_ _2"></span>functions <span class="_ _3"></span>originated <span class="_ _2"></span>in <span class="_ _2"></span>4.2BSD <span class="_ _3"></span>and <span class="_ _2"></span>wer<span class="ls10d1">el<span class="_ _d"></span><span class="ls0">ater <span class="_ _3"></span>added <span class="_ _2"></span>to <span class="_ _2"></span>SVR4.<span class="_ _4b"> </span>These <span class="_ _2"></span>two <span class="_ _2"></span>functions</span></span></div><div class="t m0 x76 h3d y3fcd ff19 fs1f fc0 sc0 ls0 ws0">ar<span class="ls10cc">ei<span class="_ _5"></span><span class="ls0">ncluded in the XSI option of the Single UNIX Speciﬁcation.</span></span></div><a class="l" href="#pf11" data-dest-detail='[17,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892409px;bottom:1236.288916px;width:213.886803px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
