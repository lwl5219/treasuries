<div id="pf308" class="pf w4 h1f" data-page-no="308"><div class="pc pc308 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg308.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">742<span class="_ _1b"> </span><span class="ff19">Pseudo <span class="_"> </span>T<span class="_ _6"></span>erminals <span class="_ _23a"> </span>Chapter<span class="_ _4b"> </span>19</span></div><div class="t m0 x32 h53 y12f ff16 fs2b fc0 sc0 ls0 ws0">Exer<span class="_ _0"></span>cises</div><div class="t m0 x32 h57 y1e2d ff18 fs2d fc0 sc0 ls0 ws0">19.1<span class="_ _288"> </span><span class="ff19">When <span class="_ _2"></span>we <span class="_ _2"></span>remotely <span class="_ _2"></span>log <span class="_ _2"></span>in <span class="_ _2"></span>to <span class="_ _2"></span>a <span class="_ _2"></span>BSD <span class="_ _2"></span>system <span class="_ _2"></span>using <span class="_ _2"></span>either<span class="_ _66"> </span><span class="ff1a">telnet<span class="_ _66"> </span></span>or<span class="_"> </span><span class="ff1a">rlogin</span><span class="ls15e6">,t<span class="_ _5"></span><span class="ls0">he <span class="_ _2"></span>ownership</span></span></span></div><div class="t m0 xe1 h5f y1e2e ff19 fs2d fc0 sc0 ls0 ws0">of <span class="_ _9"></span>the <span class="_ _23"> </span>PTY <span class="_ _9"></span>slave <span class="_ _23"> </span>and <span class="_ _23"></span>its <span class="_ _9"></span>permissions <span class="_ _23"> </span>ar<span class="ls15e7">es<span class="_ _b"></span><span class="ls0">et, <span class="_ _9"></span>as <span class="_ _23"></span>we <span class="_ _9"></span>described <span class="_ _23"> </span>in <span class="_ _9"></span>Section <span class="_ _23"> </span>19.3.<span class="_ _61"> </span>How <span class="_ _23"> </span>does</span></span></div><div class="t m0 xe1 h5f y1e2f ff19 fs2d fc0 sc0 ls0 ws0">this happen?</div><div class="t m0 x32 h57 y1e30 ff18 fs2d fc0 sc0 ls0 ws0">19.2<span class="_ _288"> </span><span class="ff19">Use <span class="_ _42"> </span>the<span class="_ _45"> </span><span class="ff1a">pty<span class="_ _35"> </span></span>program <span class="_ _23"> </span>to <span class="_ _23"> </span>determine <span class="_ _42"> </span>the <span class="_ _23"> </span>values <span class="_ _42"> </span>used <span class="_ _23"> </span>by <span class="_ _23"> </span>your <span class="_ _42"> </span>system <span class="_ _23"> </span>to <span class="_ _42"> </span>initialize <span class="_ _23"> </span>a <span class="_ _42"> </span>slave</span></div><div class="t m0 xe1 h57 y40da ff19 fs2d fc0 sc0 ls0 ws0">PTY’s<span class="_"> </span><span class="ff1a">termios<span class="_ _e"> </span></span>structur<span class="ls110">ea<span class="_ _5"></span><span class="ls0">nd<span class="_"> </span><span class="ff1a">winsize<span class="_ _e"> </span></span>structure.</span></span></div><div class="t m0 x32 h57 y1e33 ff18 fs2d fc0 sc0 ls0 ws0">19.3<span class="_ _288"> </span><span class="ff19">Recode the<span class="_"> </span><span class="ff1a">loop<span class="_ _80"> </span></span>function (Figur<span class="ls110">e1<span class="_ _5"></span><span class="ls0">9.12) as a single process using either<span class="_"> </span><span class="ff1a">select<span class="_ _e"> </span></span>or<span class="_"> </span><span class="ff1a">poll</span>.</span></span></span></div><div class="t m0 x32 h57 y5538 ff18 fs2d fc0 sc0 ls0 ws0">19.4<span class="_ _288"> </span><span class="ff19">In <span class="_ _45"> </span>the <span class="_ _45"> </span>child <span class="_ _47"> </span>process <span class="_ _45"> </span>after<span class="_ _61"> </span><span class="ff1a">pty_fork<span class="_"> </span></span><span class="ls1e7">re<span class="_ _2"></span></span>turns, <span class="_ _45"> </span>standar<span class="_ _0"></span><span class="ls15e8">di<span class="_ _1d"></span><span class="ls0">nput, <span class="_ _45"> </span>standar<span class="_ _0"></span><span class="ls15e8">do<span class="_ _1d"></span><span class="ls0">utput, <span class="_ _45"> </span>and</span></span></span></span></span></div><div class="t m0 xe1 h5f y1e35 ff19 fs2d fc0 sc0 ls0 ws0">standar<span class="ls15e9">de<span class="_ _d"></span><span class="ls0">rror ar<span class="ls15ea">ea<span class="_ _d"></span><span class="ls0">ll open <span class="_ _2"></span>for <span class="_ _2"></span>read–write. <span class="_"> </span>Can<span class="_ _80"> </span>you <span class="_ _2"></span>change <span class="_ _2"></span>standar<span class="ls15ea">di<span class="_ _d"></span><span class="ls0">nput to <span class="_ _2"></span>be <span class="_ _2"></span>read-only</span></span></span></span></span></span></div><div class="t m0 xe1 h5f y1e36 ff19 fs2d fc0 sc0 ls0 ws0">and the other two to be write-only?</div><div class="t m0 x32 h5f y1e37 ff18 fs2d fc0 sc0 ls0 ws0">19.5<span class="_ _288"> </span><span class="ff19">In <span class="_ _9"></span>Figur<span class="ls15eb">e1<span class="_ _8"></span><span class="ls0">9.13, <span class="_ _3"></span>identify <span class="_ _3"></span>which <span class="_ _3"></span>process <span class="_ _3"></span>groups <span class="_ _3"></span>are<span class="_ _66"> </span>in<span class="_ _66"> </span>the <span class="_ _9"></span>foregr<span class="_ _0"></span>ound <span class="_ _2"></span>and <span class="_ _9"></span>which <span class="_ _3"></span>are<span class="_ _66"> </span>in<span class="_ _66"> </span>the</span></span></span></div><div class="t m0 xe1 h5f y1e38 ff19 fs2d fc0 sc0 ls0 ws0">background, and identify the session leaders.</div><div class="t m0 x32 h5f y1e39 ff18 fs2d fc0 sc0 ls0 ws0">19.6<span class="_ _288"> </span><span class="ff19">In <span class="_ _42"> </span>Figur<span class="ls15ec">e1<span class="_ _43"></span><span class="ls0">9.13, <span class="_ _42"> </span>in <span class="_ _42"> </span>what <span class="_ _23"> </span>order <span class="_ _23"> </span>do <span class="_ _42"> </span>the <span class="_ _42"> </span>processes <span class="_ _23"> </span>terminate <span class="_ _42"> </span>when <span class="_ _23"> </span>we <span class="_ _42"> </span>type <span class="_ _42"> </span>the <span class="_ _23"> </span>end-of-ﬁle</span></span></span></div><div class="t m0 xe1 h5f y1e3a ff19 fs2d fc0 sc0 ls0 ws0">character? <span class="_"> </span>V<span class="_ _6"></span>erify this with process accounting, if possible.</div><div class="t m0 x32 h57 y1e3b ff18 fs2d fc0 sc0 ls0 ws0">19.7<span class="_ _288"> </span><span class="ff19">The<span class="_ _47"> </span><span class="ff1a">script</span></span></div><div class="t m0 x1e5 h5f y5539 ff19 fs2d fc0 sc0 ls0 ws0">(</div><div class="t m0 x184 h5f y1e3b ff19 fs2d fc0 sc0 ls0 ws0">1</div><div class="t m0 x180 h5f y5539 ff19 fs2d fc0 sc0 ls0 ws0">)</div><div class="t m0 x4 h5f y1e3b ff19 fs2d fc0 sc0 ls0 ws0">program <span class="_ _2"></span>normally <span class="_ _9"></span>adds <span class="_ _3"></span>to <span class="_ _9"></span>the <span class="_ _3"></span>beginning <span class="_ _9"></span>of <span class="_ _3"></span>the <span class="_ _3"></span>output <span class="_ _9"></span>ﬁle <span class="_ _3"></span>a <span class="_ _9"></span>line <span class="_ _3"></span>with <span class="_ _3"></span>the</div><div class="t m0 xe1 h5f y1e3c ff19 fs2d fc0 sc0 ls0 ws0">starting <span class="_ _23"> </span>time, <span class="_ _23"> </span>and <span class="_ _42"> </span>to <span class="_ _23"> </span>the <span class="_ _23"> </span>end <span class="_ _42"> </span>of <span class="_ _23"> </span>the <span class="_ _23"> </span>output <span class="_ _42"> </span>ﬁle <span class="_ _23"> </span>another <span class="_ _23"> </span>line <span class="_ _42"> </span>with <span class="_ _23"> </span>the <span class="_ _23"> </span>ending <span class="_ _23"> </span>time.<span class="_ _5a"> </span>Add</div><div class="t m0 xe1 h5f y553a ff19 fs2d fc0 sc0 ls0 ws0">these features to the simple shell script that we showed.</div><div class="t m0 x32 h57 y1e3f ff18 fs2d fc0 sc0 ls0 ws0">19.8<span class="_ _288"> </span><span class="ff19">Explain <span class="_"> </span>why <span class="_ _42"> </span>the <span class="_"> </span>contents <span class="_ _42"> </span>of <span class="_ _53"> </span>the <span class="_"> </span>ﬁle<span class="_ _35"> </span><span class="ff1a">data<span class="_ _44"> </span></span>ar<span class="ls15ed">eo<span class="_ _c"></span><span class="ls0">utput <span class="_"> </span>to <span class="_ _42"> </span>the <span class="_"> </span>terminal <span class="_ _42"> </span>in <span class="_ _53"> </span>the <span class="_"> </span>following</span></span></span></div><div class="t m0 xe1 h57 y553b ff19 fs2d fc0 sc0 ls0 ws0">example, <span class="_ _42"> </span>even <span class="_ _53"> </span>though <span class="_ _53"> </span>the <span class="_ _42"> </span>program<span class="_ _35"> </span><span class="ff1a">ttyname<span class="_ _44"> </span></span>(Figur<span class="ls15ee">e1<span class="_ _c"></span><span class="ls0">8.16) <span class="_ _53"> </span>only <span class="_ _53"> </span>generates <span class="_ _42"> </span>output <span class="_ _53"> </span>and</span></span></div><div class="t m0 xe1 h5f y40e4 ff19 fs2d fc0 sc0 ls0 ws0">never reads its input.</div><div class="t m0 x1c h57 y553c ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">cat data<span class="_ _191"> </span><span class="ff1b ls110">aﬁ<span class="_ _5"></span><span class="ls0">le with two lines</span></span></span></div><div class="t m0 x1c h57 y553d ff1a fs2d fc0 sc0 ls0 ws0">hello,</div><div class="t m0 x1c h57 y553e ff1a fs2d fc0 sc0 ls0 ws0">world</div><div class="t m0 x1c h57 y553f ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">pty -i &lt; data ttyname<span class="_ _170"> </span><span class="ff1b">-i says ignor<span class="ls110">ee<span class="_ _d"></span><span class="ls0">of on stdin</span></span></span></span></div><div class="t m0 x1c h57 y5540 ff1a fs2d fc0 sc0 ls0 ws0">hello,<span class="_ _29e"> </span><span class="ff1b">wher<span class="ls110">ed<span class="_ _d"></span><span class="ls0">id these two lines come from?</span></span></span></div><div class="t m0 x1c h57 y5541 ff1a fs2d fc0 sc0 ls0 ws0">world</div><div class="t m0 x1c h57 y5542 ff1a fs2d fc0 sc0 ls0 ws0">fd 0: /dev/ttys005<span class="_ _182"> </span><span class="ff1b">we expect these three lines from ttyname</span></div><div class="t m0 x1c h57 y5543 ff1a fs2d fc0 sc0 ls0 ws0">fd 1: /dev/ttys005</div><div class="t m0 x1c h57 y5544 ff1a fs2d fc0 sc0 ls0 ws0">fd 2: /dev/ttys005</div><div class="t m0 x32 h57 y5545 ff18 fs2d fc0 sc0 ls0 ws0">19.9<span class="_ _288"> </span><span class="ff19 ls467">Wr<span class="_ _9"></span><span class="ls0">ite <span class="_ _3"></span>a <span class="_ _3"></span>program <span class="_ _3"></span>that <span class="_ _9"></span>calls<span class="_ _66"> </span><span class="ff1a">pty_fork<span class="_ _47"> </span></span>and <span class="_ _3"></span>have <span class="_ _9"></span>the <span class="_ _3"></span>child<span class="_ _47"> </span><span class="ff1a">exec<span class="_ _66"> </span></span>another <span class="_ _9"></span>program <span class="_ _2"></span>that <span class="_ _9"></span>you</span></span></div><div class="t m0 xe1 h57 y5546 ff19 fs2d fc0 sc0 ls0 ws0">will <span class="_ _9"></span>write.<span class="_ _16"> </span>The <span class="_ _9"></span>new <span class="_ _23"> </span>program <span class="_ _9"></span>that <span class="_ _9"></span>the <span class="_ _23"></span>child<span class="_ _47"> </span><span class="ff1a">exec</span><span class="ls15ef">sm<span class="_ _8"></span><span class="ls0">ust <span class="_ _9"></span>catch<span class="_ _45"> </span><span class="ff1a">SIGTERM<span class="_ _45"> </span></span>and<span class="_ _47"> </span><span class="ff1a">SIGWINCH</span>.</span></span></div><div class="t m0 xe1 h5f y5547 ff19 fs2d fc0 sc0 ls0 ws0">When it catches a signal, the program should print that it did; for the latter signal, it should</div><div class="t m0 xe1 h57 y5548 ff19 fs2d fc0 sc0 ls0 ws0">also <span class="_ _23"> </span>print <span class="_ _23"> </span>the <span class="_ _23"> </span>terminal’s <span class="_ _23"> </span>window <span class="_ _23"> </span>size.<span class="_ _16"> </span>Then <span class="_ _23"> </span>have <span class="_ _23"> </span>the <span class="_ _23"> </span>parent <span class="_ _23"></span>process <span class="_ _9"></span>send <span class="_ _23"> </span>the<span class="_ _45"> </span><span class="ff1a">SIGTERM</span></div><div class="t m0 xe1 h57 y5549 ff19 fs2d fc0 sc0 ls0 ws0">signal <span class="_ _23"></span>to <span class="_ _9"></span>the <span class="_ _23"> </span>process <span class="_ _23"> </span>group <span class="_ _9"></span>of <span class="_ _23"> </span>the <span class="_ _23"> </span>PTY <span class="_ _9"></span>slave <span class="_ _23"> </span>with <span class="_ _23"> </span>the<span class="_ _45"> </span><span class="ff1a">ioctl<span class="_ _45"> </span></span>command <span class="_ _23"> </span>we <span class="_ _23"> </span>described <span class="_ _9"></span>in</div><div class="t m0 xe1 h5f y554a ff19 fs2d fc0 sc0 ls0 ws0">Section <span class="_ _9"></span>19.7.<span class="_ _16"> </span>Read <span class="_ _23"> </span>back <span class="_ _23"> </span>from <span class="_ _9"></span>the <span class="_ _9"></span>slave <span class="_ _23"> </span>to <span class="_ _23"> </span>verify <span class="_ _9"></span>that <span class="_ _23"> </span>the <span class="_ _23"></span>signal <span class="_ _9"></span>was <span class="_ _23"> </span>caught.<span class="_ _61"> </span>Follow <span class="_ _23"> </span>this</div><div class="t m0 xe1 h5f y554b ff19 fs2d fc0 sc0 ls0 ws0">with <span class="_ _9"></span>the <span class="_ _9"></span>parent <span class="_ _3"></span>setting <span class="_ _23"></span>the <span class="_ _3"></span>window <span class="_ _23"></span>size <span class="_ _3"></span>of <span class="_ _23"></span>the <span class="_ _3"></span>PTY <span class="_ _23"></span>slave, <span class="_ _3"></span>and <span class="_ _23"></span>then <span class="_ _3"></span>read <span class="_ _9"></span>back <span class="_ _9"></span>the <span class="_ _9"></span>slave’s</div><div class="t m0 xe1 h57 y554c ff19 fs2d fc0 sc0 ls0 ws0">output <span class="_ _66"> </span>again.<span class="_ _60"> </span>Have <span class="_ _66"> </span>the <span class="_ _66"> </span>parent<span class="_ _46"> </span><span class="ff1a">exit<span class="_ _46"> </span></span>and <span class="_ _66"> </span>determine <span class="_ _66"> </span>whether <span class="_ _47"> </span>the <span class="_ _66"> </span>slave <span class="_ _47"> </span>process <span class="_ _80"> </span>also</div><div class="t m0 xe1 h5f y554d ff19 fs2d fc0 sc0 ls0 ws0">terminates; if so, how does it terminate?</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
