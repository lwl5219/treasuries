<div id="pf206" class="pf w4 h1f" data-page-no="206"><div class="pc pc206 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg206.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">484<span class="_ _1b"> </span><span class="ff19">Advanced <span class="_"> </span>I/O<span class="_ _16b"> </span>Chapter <span class="_"> </span>14</span></div><div class="t m0 x3f h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">./a.out &lt; /etc/services 2&gt;stderr.out<span class="_ _182"> </span><span class="ff1b">output to terminal</span></span></div><div class="t m0 x12c h58 y426 ff1b fs2d fc0 sc0 ls0 ws0">lots of output to terminal ...</div><div class="t m0 x3f h57 y800 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">cat stderr.out</span></div><div class="t m0 x3f h57 y801 ff1a fs2d fc0 sc0 ls0 ws0">read 500000 bytes</div><div class="t m0 x3f h57 y802 ff1a fs2d fc0 sc0 ls0 ws0">nwrite = 999, errno = 0</div><div class="t m0 x3f h57 y803 ff1a fs2d fc0 sc0 ls0 ws0">nwrite = -1, errno = 35</div><div class="t m0 x3f h57 y804 ff1a fs2d fc0 sc0 ls0 ws0">nwrite = -1, errno = 35</div><div class="t m0 x3f h57 y805 ff1a fs2d fc0 sc0 ls0 ws0">nwrite = -1, errno = 35</div><div class="t m0 x3f h57 y806 ff1a fs2d fc0 sc0 ls0 ws0">nwrite = -1, errno = 35</div><div class="t m0 x3f h57 y807 ff1a fs2d fc0 sc0 ls0 ws0">nwrite = 1001, errno = 0</div><div class="t m0 x3f h57 y808 ff1a fs2d fc0 sc0 ls0 ws0">nwrite = -1, errno = 35</div><div class="t m0 x3f h57 y809 ff1a fs2d fc0 sc0 ls0 ws0">nwrite = 1002, errno = 0</div><div class="t m0 x3f h57 y80a ff1a fs2d fc0 sc0 ls0 ws0">nwrite = 1004, errno = 0</div><div class="t m0 x3f h57 y80b ff1a fs2d fc0 sc0 ls0 ws0">nwrite = 1003, errno = 0</div><div class="t m0 x3f h57 y80c ff1a fs2d fc0 sc0 ls0 ws0">nwrite = 1003, errno = 0</div><div class="t m0 x3f h57 y80d ff1a fs2d fc0 sc0 ls0 ws0">nwrite = 1005, errno = 0</div><div class="t m0 x3f h57 y80e ff1a fs2d fc0 sc0 ls0 ws0">nwrite = -1, errno = 35<span class="_ _23f"> </span><span class="ff1b">61 of these err<span class="_ _0"></span>ors</span></div><div class="t m0 x41 h57 y2f71 ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 x41 h57 y80f ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 x41 h57 y3b5d ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 x3f h57 y3b5e ff1a fs2d fc0 sc0 ls0 ws0">nwrite = 1006, errno = 0</div><div class="t m0 x3f h57 y3b5f ff1a fs2d fc0 sc0 ls0 ws0">nwrite = 1004, errno = 0</div><div class="t m0 x3f h57 y3b60 ff1a fs2d fc0 sc0 ls0 ws0">nwrite = 1005, errno = 0</div><div class="t m0 x3f h57 y3b61 ff1a fs2d fc0 sc0 ls0 ws0">nwrite = 1006, errno = 0</div><div class="t m0 x3f h57 y3b62 ff1a fs2d fc0 sc0 ls0 ws0">nwrite = -1, errno = 35<span class="_ _23f"> </span><span class="ff1b">108 of these err<span class="_ _0"></span>ors</span></div><div class="t m0 x41 h57 y815 ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 x41 h57 y3b63 ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 x41 h57 y3b64 ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 x3f h57 y3b65 ff1a fs2d fc0 sc0 ls0 ws0">nwrite = 1006, errno = 0</div><div class="t m0 x3f h57 y3b66 ff1a fs2d fc0 sc0 ls0 ws0">nwrite = 1005, errno = 0</div><div class="t m0 x3f h57 y3b67 ff1a fs2d fc0 sc0 ls0 ws0">nwrite = 1005, errno = 0</div><div class="t m0 x3f h57 y3b68 ff1a fs2d fc0 sc0 ls0 ws0">nwrite = -1, errno = 35<span class="_ _23f"> </span><span class="ff1b">681 of these err<span class="_ _0"></span>ors</span></div><div class="t m0 x41 h57 y3b69 ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 x41 h57 y3b6a ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 x41 h57 y3b6b ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 x12c h58 y3b6c ff1b fs2d fc0 sc0 ls0 ws0">and so on ...</div><div class="t m0 x3f h57 y3b6d ff1a fs2d fc0 sc0 ls0 ws0">nwrite = 347, errno = 0</div><div class="t m0 x32 h26 y3b6e ff19 fsf fc0 sc0 ls0 ws0">On <span class="_"> </span>this <span class="_ _e"> </span>system, <span class="_"> </span>the<span class="_ _59"> </span><span class="ff1a">errno<span class="_ _59"> </span></span>of <span class="_"> </span>35 <span class="_"> </span>is<span class="_ _4b"> </span><span class="ff1a">EAGAIN</span><span class="ls506">.T<span class="_ _64"></span><span class="ls0">he <span class="_"> </span>amount <span class="_ _e"> </span>of <span class="_"> </span>data <span class="_"> </span>accepted <span class="_ _e"> </span>by <span class="_"> </span>the</span></span></div><div class="t m0 x32 h2a y3b6f ff19 fsf fc0 sc0 ls0 ws0">terminal <span class="_ _3"></span>driver <span class="_ _9"></span>varies <span class="_ _3"></span>from <span class="_ _3"></span>system <span class="_ _9"></span>to <span class="_ _3"></span>system.<span class="_ _5a"> </span>The <span class="_ _9"></span>results <span class="_ _2"></span>will <span class="_ _9"></span>also <span class="_ _3"></span>vary <span class="_ _9"></span>depending <span class="_ _9"></span>on</div><div class="t m0 x32 h2a y3b70 ff19 fsf fc0 sc0 ls0 ws0">how <span class="_ _3"></span>you <span class="_ _3"></span>ar<span class="lsfca">el<span class="_ _8"></span><span class="ls0">ogged <span class="_ _3"></span>in <span class="_ _3"></span>to <span class="_ _9"></span>the <span class="_ _3"></span>system: <span class="_ _3"></span>on <span class="_ _9"></span>the <span class="_ _3"></span>system <span class="_ _3"></span>console, <span class="_ _3"></span>on <span class="_ _9"></span>a <span class="_ _3"></span>hard-wir<span class="_ _0"></span>ed <span class="_ _3"></span>terminal,</span></span></div><div class="t m0 x32 h2a y3b71 ff19 fsf fc0 sc0 ls0 ws0">on <span class="_ _42"> </span>a <span class="_ _53"> </span>network <span class="_ _42"> </span>connection <span class="_ _53"> </span>using <span class="_ _42"> </span>a <span class="_ _53"> </span>pseudo <span class="_ _42"> </span>terminal.<span class="_ _54"> </span>If <span class="_ _53"> </span>you <span class="_ _42"> </span>ar<span class="lsc13">er<span class="_ _c"></span><span class="ls0">unning <span class="_ _42"> </span>a <span class="_ _53"> </span>windowing</span></span></div><div class="t m0 x32 h2a y3b72 ff19 fsf fc0 sc0 ls0 ws0">system on your terminal, you ar<span class="ls44">ea<span class="_ _4f"></span><span class="ls0">lso going through a pseudo terminal device.</span></span></div><div class="t m0 x3f h4d y3b73 ff19 fs26 fc0 sc0 ls0 ws0">In <span class="_ _2"></span>this <span class="_ _3"></span>example, <span class="_ _2"></span>the <span class="_ _3"></span>program issues <span class="_ _3"></span>mor<span class="lsfcb">et<span class="_ _8"></span><span class="ls0">han <span class="_ _3"></span>9,000<span class="_ _47"> </span><span class="ff1a">write<span class="_ _66"> </span></span>calls, <span class="_ _3"></span>even <span class="_ _2"></span>though <span class="_ _3"></span>only</span></span></div><div class="t m0 x32 h49 y3b74 ff19 fs26 fc0 sc0 ls0 ws0">500 ar<span class="lsfcc">en<span class="_ _4f"></span><span class="ls0">eeded to output the data.<span class="_ _46"> </span>The rest just return an err<span class="_ _0"></span>or<span class="_ _6"></span><span class="lsfcd">.T<span class="_ _4a"></span><span class="ls0">his type of loop, called</span></span></span></span></div><div class="t m0 x32 h4a y3b75 ff1b fs26 fc0 sc0 ls0 ws0">polling<span class="ff19 ls93a">,i<span class="_ _4f"></span><span class="lsfce">saw<span class="_ _d"></span><span class="ls0">aste <span class="_ _2"></span>of CPU <span class="_ _2"></span>time <span class="_ _2"></span>on a <span class="_ _2"></span>multiuser <span class="_ _2"></span>system.<span class="_ _46"> </span>In <span class="_ _2"></span>Section 14.4, <span class="_ _2"></span>we’ll <span class="_ _2"></span>see that <span class="_ _2"></span>I/O</span></span></span></div><div class="t m0 x32 h49 y3b76 ff19 fs26 fc0 sc0 ls0 ws0">multiplexing with a nonblocking descriptor is a mor<span class="lsd3">ee<span class="_ _4f"></span><span class="lscc">fﬁ<span class="_ _2"></span><span class="ls0">cient way to do this.</span></span></span></div><div class="t m0 x3f h49 y3b77 ff19 fs26 fc0 sc0 ls0 ws0">Sometimes, <span class="_ _9"></span>we <span class="_ _9"></span>can <span class="_ _9"></span>avoid <span class="_ _23"></span>using <span class="_ _9"></span>nonblocking <span class="_ _9"></span>I/O <span class="_ _9"></span>by <span class="_ _9"></span>designing <span class="_ _23"></span>our <span class="_ _9"></span>applications <span class="_ _9"></span>to</div><div class="t m0 x32 h49 y3b78 ff19 fs26 fc0 sc0 ls0 ws0">use <span class="_ _2"></span>multiple <span class="_ _3"></span>threads <span class="_ _2"></span>(see <span class="_ _3"></span>Chapter <span class="_ _3"></span>1<span class="_ _1"></span>1). <span class="_ _47"> </span>W<span class="_ _6"></span><span class="lsfcf">ec<span class="_ _4f"></span><span class="ls0">an <span class="_ _3"></span>allow <span class="_ _2"></span>individual <span class="_ _3"></span>threads <span class="_ _2"></span>to <span class="_ _3"></span>block <span class="_ _3"></span>in <span class="_ _3"></span>I/O</span></span></div><div class="t m0 x32 h49 y3b79 ff19 fs26 fc0 sc0 ls0 ws0">calls if <span class="_ _2"></span>we <span class="_ _2"></span>can <span class="_ _2"></span>continue <span class="_ _2"></span>to <span class="_ _2"></span>make <span class="_ _2"></span>progr<span class="_ _0"></span>ess in <span class="_ _2"></span>other <span class="_ _2"></span>threads. <span class="_"> </span>This<span class="_ _66"> </span>can <span class="_ _2"></span>sometimes <span class="_ _2"></span>simplify</div><div class="t m0 x32 h49 y3b7a ff19 fs26 fc0 sc0 ls0 ws0">the <span class="_ _53"> </span>design, <span class="_ _e"> </span>as <span class="_ _e"> </span>we <span class="_ _53"> </span>shall <span class="_ _e"> </span>see <span class="_ _e"> </span>in <span class="_ _e"> </span>Chapter <span class="_ _53"> </span>21; <span class="_ _e"> </span>at <span class="_ _e"> </span>other <span class="_ _e"> </span>times, <span class="_ _53"> </span>however<span class="_ _1"></span><span class="lsfd0">,t<span class="_ _55"></span><span class="ls0">he <span class="_ _e"> </span>overhead <span class="_ _53"> </span>of</span></span></div><div class="t m0 x32 h49 y3b7b ff19 fs26 fc0 sc0 ls0 ws0">synchronization can add mor<span class="_ _0"></span><span class="lsd3">ec<span class="_ _d"></span><span class="ls0">omplexity than is saved from using thr<span class="_ _0"></span>eads.</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
