<div id="pfd7" class="pf w4 h1f" data-page-no="d7"><div class="pc pcd7 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bgd7.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>6.3<span class="_ _1ed"> </span>Shadow <span class="_"> </span>Passwords<span class="_ _1b"> </span><span class="ff18">181</span></div><div class="t m0 x32 h26 y12f ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _23"></span>call <span class="_ _9"></span>to<span class="_ _35"> </span><span class="ff1a">setpwent<span class="_ _45"> </span></span>at <span class="_ _23"></span>the <span class="_ _23"></span>beginning <span class="_ _9"></span>of <span class="_ _23"></span>this <span class="_ _23"></span>function <span class="_ _9"></span>is <span class="_ _23"> </span>self-defense: <span class="_ _23"></span>we <span class="_ _9"></span>ensur<span class="ls78e">et<span class="_ _b"></span><span class="ls0">hat</span></span></div><div class="t m0 x32 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _2"></span>ﬁles <span class="_ _3"></span>ar<span class="ls78f">er<span class="_ _b"></span><span class="ls0">ewound, <span class="_ _3"></span>in <span class="_ _3"></span>case <span class="_ _3"></span>the <span class="_ _3"></span>caller <span class="_ _3"></span>has <span class="_ _2"></span>already <span class="_ _2"></span>opened <span class="_ _3"></span>them <span class="_ _3"></span>by <span class="_ _3"></span>calling<span class="_ _47"> </span><span class="ff1a">getpwent</span>.</span></span></div><div class="t m0 x32 h26 y131 ff19 fsf fc0 sc0 ls5f ws0">We <span class="_ _e"> </span>c<span class="_ _9"></span><span class="ls0">all<span class="_ _47"> </span><span class="ff1a">endpwent<span class="_ _66"> </span></span>when <span class="_ _2"></span>we’r<span class="ls10a">ed<span class="_ _4f"></span><span class="ls0">one, <span class="_ _2"></span>because <span class="_ _2"></span>neither<span class="_ _47"> </span><span class="ff1a">getpwnam<span class="_ _66"> </span></span>nor<span class="_ _47"> </span><span class="ff1a">getpwuid<span class="_ _66"> </span></span>should</span></span></span></div><div class="t m0 x32 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">leave any of the ﬁles open.</div><div class="t m0 x35 h4b y1885 ff16 fs27 fc0 sc0 ls0 ws0">6.3 <span class="_ _68"> </span>Shado<span class="ls5d5">wP<span class="_ _5d"></span><span class="ls0">asswor<span class="_ _1"></span>ds</span></span></div><div class="t m0 x32 h49 y1886 ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _9"></span>encrypted <span class="_ _9"></span>password<span class="_ _47"> </span>is<span class="_ _45"> </span>a<span class="_ _45"> </span>copy <span class="_ _3"></span>of <span class="_ _9"></span>the <span class="_ _9"></span>user<span class="_ _9"></span>’s <span class="_ _9"></span>passwor<span class="ls790">dt<span class="_ _b"></span><span class="ls0">hat <span class="_ _9"></span>has <span class="_ _9"></span>been <span class="_ _9"></span>put <span class="_ _3"></span>through <span class="_ _9"></span>a</span></span></div><div class="t m0 x32 h49 y1887 ff19 fs26 fc0 sc0 ls0 ws0">one-way <span class="_ _23"></span>encryption <span class="_ _9"></span>algorithm.<span class="_ _51"> </span>Because <span class="_ _23"></span>this <span class="_ _9"></span>algorithm <span class="_ _23"> </span>is <span class="_ _23"></span>one-way<span class="_ _4"></span>,<span class="_ _35"> </span>we<span class="_ _45"> </span>can’t <span class="_ _23"> </span>guess <span class="_ _23"></span>the</div><div class="t m0 x32 h49 y1888 ff19 fs26 fc0 sc0 ls0 ws0">original passwor<span class="lsd3">df<span class="_ _4f"></span><span class="lscc">ro<span class="_ _2"></span><span class="lsd3">mt<span class="_ _d"></span><span class="ls0">he encrypted version.</span></span></span></span></div><div class="t m0 x3f h49 y1889 ff19 fs26 fc0 sc0 ls0 ws0">Historically<span class="_ _4"></span><span class="ls791">,t<span class="_ _b"></span><span class="ls0">he <span class="_ _9"></span>algorithm <span class="_ _23"></span>used <span class="_ _9"></span>always <span class="_ _9"></span>generated <span class="_ _23"></span>13 <span class="_ _9"></span>printable <span class="_ _9"></span>characters <span class="_ _23"></span>fr<span class="_ _0"></span>om <span class="_ _9"></span>the</span></span></div><div class="t m0 x32 h4d y188a ff19 fs26 fc0 sc0 ls0 ws0">64-character <span class="_"> </span>set<span class="_ _61"> </span><span class="ff1a">[a-zA-Z0-9./]<span class="_ _61"> </span></span>(see <span class="_"> </span>Morris <span class="_ _47"> </span>and <span class="_"> </span>Thompson</div><div class="t m0 x5f h49 y188b ff19 fs26 fc0 sc0 ls0 ws0">[</div><div class="t m0 x16a h49 y188a ff19 fs26 fc0 sc0 ls0 ws0">1979</div><div class="t m0 x11f h49 y188b ff19 fs26 fc0 sc0 ls0 ws0">]</div><div class="t m0 x120 h49 y188a ff19 fs26 fc0 sc0 ls0 ws0">). <span class="_ _46"> </span>Some<span class="_ _61"> </span>newer</div><div class="t m0 x32 h49 y188c ff19 fs26 fc0 sc0 ls0 ws0">systems <span class="_ _44"> </span>use <span class="_ _44"> </span>alternative <span class="_ _44"> </span>algorithms, <span class="_ _44"> </span>such <span class="_ _44"> </span>as <span class="_ _44"> </span>MD5 <span class="_ _44"> </span>or <span class="_ _44"> </span>SHA</div><div class="t m0 x164 h49 y188d ff19 fs26 fc0 sc0 ls0 ws0">-</div><div class="t m0 x43 h49 y188c ff19 fs26 fc0 sc0 ls0 ws0">1, <span class="_ _44"> </span>to <span class="_ _44"> </span>generate <span class="_ _44"> </span>longer</div><div class="t m0 x32 h49 y188e ff19 fs26 fc0 sc0 ls0 ws0">encrypted <span class="_ _4b"> </span>passwor<span class="ls792">ds<span class="_ _64"></span><span class="ls0">trings. <span class="_ _65"> </span>(The<span class="_ _65"> </span>mor<span class="ls792">ec<span class="_ _64"></span><span class="ls0">haracters <span class="_ _4b"> </span>used <span class="_ _4b"> </span>to <span class="_ _4b"> </span>stor<span class="ls792">et<span class="_ _64"></span><span class="ls0">he <span class="_ _44"> </span>encrypted</span></span></span></span></span></span></div><div class="t m0 x32 h49 y188f ff19 fs26 fc0 sc0 ls0 ws0">password, <span class="_ _e"> </span>the <span class="_"> </span>mor<span class="ls793">ec<span class="_ _4a"></span><span class="ls0">ombinations <span class="_"> </span>ther<span class="_ _1"></span><span class="ls793">ea<span class="_ _55"></span><span class="lscc">re<span class="ls793">,a<span class="_ _4a"></span><span class="ls0">nd <span class="_"> </span>the <span class="_"> </span>harder <span class="_ _e"> </span>it <span class="_"> </span>will <span class="_"> </span>be <span class="_ _e"> </span>to <span class="_"> </span>guess <span class="_"> </span>the</span></span></span></span></span></span></div><div class="t m0 x32 h49 y1890 ff19 fs26 fc0 sc0 ls0 ws0">password<span class="_ _35"> </span>by<span class="_ _35"> </span>trying <span class="_ _42"> </span>all <span class="_ _42"> </span>possible <span class="_ _42"> </span>variations.)<span class="_ _54"> </span>When <span class="_ _42"> </span>we <span class="_ _42"> </span>place <span class="_ _23"> </span>a <span class="_ _42"> </span>single <span class="_ _42"> </span>character <span class="_ _42"> </span>in <span class="_ _42"> </span>the</div><div class="t m0 x32 h49 y1891 ff19 fs26 fc0 sc0 ls0 ws0">encrypted <span class="_ _2"></span>passwor<span class="ls794">dﬁ<span class="_ _8"></span><span class="ls0">eld, <span class="_ _3"></span>we <span class="_ _3"></span>ensur<span class="ls794">et<span class="_ _8"></span><span class="ls0">hat <span class="_ _2"></span>an <span class="_ _3"></span>encrypted <span class="_ _3"></span>passwor<span class="ls794">dw<span class="_ _8"></span><span class="ls0">ill <span class="_ _3"></span>never <span class="_ _2"></span>match <span class="_ _3"></span>this</span></span></span></span></span></span></div><div class="t m0 x32 h49 y1892 ff19 fs26 fc0 sc0 ls0 ws0">value.</div><div class="t m0 x3f h49 y1893 ff19 fs26 fc0 sc0 ls0 ws0">Given <span class="_"> </span>an <span class="_ _e"> </span>encrypted <span class="_"> </span>password, <span class="_ _e"> </span>we <span class="_"> </span>can’t <span class="_"> </span>apply <span class="_"> </span>an <span class="_ _e"> </span>algorithm <span class="_"> </span>that <span class="_"> </span>inverts <span class="_ _e"> </span>it <span class="_"> </span>and</div><div class="t m0 x32 h49 y1894 ff19 fs26 fc0 sc0 lscc ws0">re<span class="ls0">turns <span class="_ _45"> </span>the <span class="_ _47"> </span>plaintext <span class="_ _47"> </span>password. <span class="_ _61"> </span>(The<span class="_ _16"> </span>plaintext <span class="_ _45"> </span>password<span class="_ _61"> </span>is<span class="_ _16"> </span>what <span class="_ _47"> </span>we <span class="_ _45"> </span>enter <span class="_ _47"> </span>at <span class="_ _47"> </span>the</span></div><div class="t m0 x32 h4d y1895 ff1a fs26 fc0 sc0 ls0 ws0">Password:<span class="_ _4b"> </span><span class="ff19">prompt.) <span class="_ _4b"> </span>But<span class="_ _59"> </span>we <span class="_ _e"> </span>could <span class="_ _e"> </span>guess <span class="_"> </span>a <span class="_ _53"> </span>password, <span class="_ _53"> </span>run <span class="_"> </span>it <span class="_ _53"> </span>through <span class="_ _e"> </span>the <span class="_ _e"> </span>one-way</span></div><div class="t m0 x32 h49 y1896 ff19 fs26 fc0 sc0 ls0 ws0">algorithm, <span class="_ _9"></span>and <span class="_ _3"></span>compar<span class="ls795">et<span class="_ _b"></span><span class="ls0">he <span class="_ _9"></span>result <span class="_ _3"></span>to <span class="_ _9"></span>the <span class="_ _9"></span>encrypted <span class="_ _9"></span>password. <span class="_ _47"> </span>If<span class="_ _45"> </span>user <span class="_ _3"></span>passwords <span class="_ _9"></span>were</span></span></div><div class="t m0 x32 h49 y1897 ff19 fs26 fc0 sc0 ls0 ws0">randomly <span class="_ _4b"> </span>chosen, <span class="_ _59"> </span>this <span class="_ _59"> </span>brute-for<span class="_ _0"></span>ce <span class="_ _4b"> </span>approach <span class="_ _59"> </span>wouldn’t <span class="_ _4b"> </span>be <span class="_ _59"> </span>too <span class="_ _4b"> </span>successful.<span class="_ _5e"> </span>Users,</div><div class="t m0 x32 h49 y1898 ff19 fs26 fc0 sc0 ls0 ws0">however<span class="_ _6"></span><span class="ls796">,t<span class="_ _b"></span><span class="ls0">end <span class="_ _23"></span>to <span class="_ _9"></span>choose <span class="_ _9"></span>nonrandom <span class="_ _23"></span>passwords, <span class="_ _9"></span>such <span class="_ _9"></span>as <span class="_ _23"></span>spouse’s <span class="_ _9"></span>name, <span class="_ _23"></span>street <span class="_ _3"></span>names,</span></span></div><div class="t m0 x32 h49 y1899 ff19 fs26 fc0 sc0 ls0 ws0">or <span class="_ _3"></span>pet <span class="_ _9"></span>names.<span class="_ _16"> </span><span class="ls797">Ac<span class="_ _8"></span><span class="ls0">ommon <span class="_ _3"></span>experiment <span class="_ _9"></span>is <span class="_ _3"></span>for <span class="_ _9"></span>someone <span class="_ _3"></span>to <span class="_ _9"></span>obtain <span class="_ _3"></span>a <span class="_ _9"></span>copy <span class="_ _3"></span>of <span class="_ _9"></span>the <span class="_ _3"></span>password</span></span></div><div class="t m0 x32 h49 y189a ff19 fs26 fc0 sc0 ls0 ws0">ﬁle <span class="_"> </span>and <span class="_"> </span>try <span class="_"> </span>guessing <span class="_"> </span>the <span class="_"> </span>passwor<span class="_ _1"></span>ds. <span class="_ _46"> </span>(Chapter<span class="_ _59"> </span>4<span class="_ _46"> </span>of<span class="_ _46"> </span>Garﬁnkel <span class="_"> </span>et <span class="_"> </span>al.</div><div class="t m0 x11c h49 y189b ff19 fs26 fc0 sc0 ls0 ws0">[</div><div class="t m0 x1ad h49 y189a ff19 fs26 fc0 sc0 ls0 ws0">2003</div><div class="t m0 xd5 h49 y189b ff19 fs26 fc0 sc0 ls0 ws0">]</div><div class="t m0 x4e h49 y189a ff19 fs26 fc0 sc0 ls0 ws0">contains</div><div class="t m0 x32 h49 y189c ff19 fs26 fc0 sc0 ls0 ws0">additional <span class="_ _2"></span>details <span class="_ _3"></span>and <span class="_ _3"></span>history <span class="_ _2"></span>on <span class="_ _3"></span>passwords <span class="_ _2"></span>and <span class="_ _3"></span>the <span class="_ _2"></span>passwor<span class="ls798">de<span class="_ _8"></span><span class="ls0">ncryption <span class="_ _3"></span>scheme <span class="_ _3"></span>used</span></span></div><div class="t m0 x32 h49 y189d ff19 fs26 fc0 sc0 ls0 ws0">on UNIX systems.)</div><div class="t m0 x3f h49 y189e ff19 fs26 fc0 sc0 ls164 ws0">To <span class="_ _45"> </span>m<span class="_ _9"></span><span class="ls0">ake <span class="_ _42"> </span>it <span class="_ _53"> </span>mor<span class="ls799">ed<span class="_ _c"></span><span class="ls0">ifﬁcult <span class="_ _42"> </span>to <span class="_ _42"> </span>obtain <span class="_ _42"> </span>the <span class="_ _42"> </span>raw <span class="_ _53"> </span>materials <span class="_ _42"> </span>(the <span class="_ _42"> </span>encrypted <span class="_ _42"> </span>passwords),</span></span></span></div><div class="t m0 x32 h4a y189f ff19 fs26 fc0 sc0 ls0 ws0">systems <span class="_"> </span>now <span class="_"> </span>stor<span class="ls79a">et<span class="_ _5b"></span><span class="ls0">he <span class="_"> </span>encrypted <span class="_"> </span>password<span class="_ _59"> </span>in<span class="_ _46"> </span>another <span class="_"> </span>ﬁle, <span class="_"> </span>often <span class="_"> </span>called <span class="_"> </span>the<span class="_ _46"> </span><span class="ff1b">shadow</span></span></span></div><div class="t m0 x32 h4a y18a0 ff1b fs26 fc0 sc0 ls0 ws0">password <span class="_"> </span>ﬁle<span class="ff19 ls79b">.M<span class="_ _49"></span><span class="ls0">inimally<span class="_ _6"></span><span class="ls79c">,t<span class="_ _5b"></span><span class="ls0">his <span class="_ _66"> </span>ﬁle <span class="_ _47"> </span>has <span class="_"> </span>to <span class="_ _47"> </span>contain <span class="_"> </span>the <span class="_ _47"> </span>user <span class="_"> </span>name <span class="_ _47"> </span>and <span class="_"> </span>the <span class="_ _47"> </span>encrypted</span></span></span></span></div><div class="t m0 x32 h49 y18a1 ff19 fs26 fc0 sc0 ls0 ws0">password. <span class="_"> </span>Other<span class="_"> </span>information r<span class="_ _0"></span>elating to the passwor<span class="_ _0"></span>d<span class="_"> </span>is<span class="_"> </span>also stored her<span class="_ _0"></span><span class="lsd3">e(<span class="_ _d"></span><span class="ls0">Figur<span class="lsd3">e6<span class="_ _d"></span><span class="ls0">.3).</span></span></span></span></div><div class="t m0 x104 h4f y18a2 ff1a fs11 fc0 sc0 ls0 ws0">struct spwd</div><div class="t m0 x1d1 h2e y18a3 ff19 fs11 fc0 sc0 ls0 ws0">member</div><div class="t m0 x1d2 h2e y18a4 ff19 fs11 fc0 sc0 ls0 ws0">Description</div><div class="t m0 xb0 h6d y18a5 ff19 fs12 fc0 sc0 ls0 ws0">user login name<span class="_ _d5"> </span><span class="ff1a">char *sp_namp</span></div><div class="t m0 xb0 h6d y18a6 ff19 fs12 fc0 sc0 ls0 ws0">encrypted password<span class="_ _1ee"> </span><span class="ff1a">char *sp_pwdp</span></div><div class="t m0 xb0 h6d y18a7 ff19 fs12 fc0 sc0 ls0 ws0">days since Epoch of last passwor<span class="ls38a">dc<span class="_ _5"></span><span class="ls0">hange<span class="_ _6e"> </span><span class="ff1a">int <span class="_ _7f"> </span>sp_lstchg</span></span></span></div><div class="t m0 xb0 h6d y18a8 ff19 fs12 fc0 sc0 ls0 ws0">days until change allowed<span class="_ _13e"> </span><span class="ff1a">int <span class="_ _93"> </span>sp_min</span></div><div class="t m0 xb0 h6d y18a9 ff19 fs12 fc0 sc0 ls0 ws0">days befor<span class="ls38a">ec<span class="_ _5"></span><span class="ls0">hange required<span class="_ _bd"> </span><span class="ff1a">int <span class="_ _7f"> </span>sp_max</span></span></span></div><div class="t m0 xb0 h6d y18aa ff19 fs12 fc0 sc0 ls0 ws0">days warning for expiration<span class="_ _1d7"> </span><span class="ff1a">int <span class="_ _93"> </span>sp_warn</span></div><div class="t m0 xb0 h6d y18ab ff19 fs12 fc0 sc0 ls0 ws0">days befor<span class="ls38a">ea<span class="_ _5"></span><span class="ls0">ccount inactive<span class="_ _1ef"> </span><span class="ff1a">int <span class="_ _7f"> </span>sp_inact</span></span></span></div><div class="t m0 xb0 h6d y18ac ff19 fs12 fc0 sc0 ls0 ws0">days since Epoch when account expires<span class="_ _13"> </span><span class="ff1a">int <span class="_ _93"> </span>sp_expire</span></div><div class="t m0 xb0 h6d y18ad ff19 fs12 fc0 sc0 ls222 ws0">re<span class="ls0">served<span class="_ _1e6"> </span><span class="ff1a">unsigned int sp_flag</span></span></div><div class="t m0 xc0 h63 y18ae ff18 fs13 fc0 sc0 ls0 ws0">Figure 6.3<span class="_ _5a"> </span><span class="ff19">Fields in<span class="_"> </span><span class="ff1a">/etc/shadow<span class="_ _e"> </span></span>ﬁle</span></div><a class="l" href="#pfe" data-dest-detail='[14,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892634px;bottom:1092.651043px;width:150.840690px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
