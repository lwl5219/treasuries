<div id="pf218" class="pf w4 h1f" data-page-no="218"><div class="pc pc218 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg218.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">502<span class="_ _1b"> </span><span class="ff19">Advanced <span class="_"> </span>I/O<span class="_ _16b"> </span>Chapter <span class="_"> </span>14</span></div><div class="t m0 x76 h52 y2a3 ff19 fs2a fc0 sc0 ls0 ws0">I/O <span class="_"> </span>multiplexing <span class="_ _80"> </span>was <span class="_ _80"> </span>provided <span class="_"> </span>with <span class="_ _e"> </span>the<span class="_ _4b"> </span><span class="ff1a">select<span class="_ _44"> </span></span>function <span class="_ _e"> </span>in <span class="_ _80"> </span>4.2BSD.<span class="_ _51"> </span>This <span class="_ _e"> </span>function <span class="_ _80"> </span>has</div><div class="t m0 x76 h51 y2a4 ff19 fs2a fc0 sc0 ls0 ws0">always <span class="_ _42"> </span>worked <span class="_ _42"> </span>with <span class="_ _42"> </span>any <span class="_"> </span>descriptor<span class="_ _6"></span><span class="ls104c">,a<span class="_ _b"></span><span class="ls0">lthough <span class="_ _42"> </span>its <span class="_ _42"> </span>main <span class="_ _42"> </span>use <span class="_ _42"> </span>has <span class="_ _42"> </span>been <span class="_ _42"> </span>for <span class="_"> </span>terminal <span class="_ _23"> </span>I/O <span class="_"> </span>and</span></span></div><div class="t m0 x76 h52 y2a5 ff19 fs2a fc0 sc0 ls0 ws0">network <span class="_ _23"> </span>I/O.<span class="_ _61"> </span>SVR3 <span class="_ _23"> </span>added <span class="_ _23"> </span>the<span class="_ _45"> </span><span class="ff1a">poll<span class="_ _45"> </span></span>function <span class="_ _23"> </span>when <span class="_ _23"> </span>the <span class="_ _23"> </span>STREAMS <span class="_ _23"> </span>mechanism <span class="_ _42"> </span>was <span class="_ _23"> </span>added.</div><div class="t m0 x76 h52 y2a6 ff19 fs2a fc0 sc0 ls0 ws0">Initially<span class="_ _6"></span>,<span class="_ _47"> </span><span class="ff1a">poll<span class="_ _45"> </span></span>worked <span class="_ _23"> </span>only <span class="_ _9"> </span>with <span class="_ _23"> </span>STREAMS <span class="_ _23"> </span>devices.<span class="_ _46"> </span>In <span class="_ _23"> </span>SVR4, <span class="_ _23"> </span>support <span class="_ _23"> </span>was <span class="_ _23"> </span>added <span class="_ _23"> </span>to <span class="_ _23"> </span>allow</div><div class="t m0 x76 h52 y2a7 ff1a fs2a fc0 sc0 ls0 ws0">poll<span class="_ _53"> </span><span class="ff19">to work on any descriptor<span class="_ _1"></span>.</span></div><div class="t m0 x32 h75 y2a2c ff16 fs2b fc0 sc0 ls0 ws0">14.4.1<span class="_ _5e"> </span><span class="ff1f">select<span class="_ _54"> </span></span>and<span class="_ _54"> </span><span class="ff1f">pselect<span class="_ _54"> </span></span>Functions</div><div class="t m0 x32 h26 y3d7b ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _65"> </span><span class="ff1a">select<span class="_ _65"> </span></span>function <span class="_ _4b"> </span>lets <span class="_ _4b"> </span>us <span class="_ _4b"> </span>do <span class="_ _4b"> </span>I/O <span class="_ _4b"> </span>multiplexing <span class="_ _4b"> </span>under <span class="_ _4b"> </span>all <span class="_ _4b"> </span>POSIX-compatible</div><div class="t m0 x32 h26 y3d7c ff19 fsf fc0 sc0 ls0 ws0">platforms. <span class="_"> </span>The<span class="_"> </span>arguments we pass to<span class="_"> </span><span class="ff1a">select<span class="_ _80"> </span></span>tell the kernel</div><div class="t m0 x3f h2a y3d7d ff19 fsf fc0 sc0 ls49 ws0">•W<span class="_ _4d"></span><span class="ls0">hich descriptors we’r<span class="ls44">ei<span class="_ _4f"></span><span class="ls0">nterested in.</span></span></span></div><div class="t m0 x3f h2a y3d7e ff19 fsf fc0 sc0 ls49 ws0">•W<span class="_ _4d"></span><span class="ls0">hich <span class="_ _9"></span>conditions <span class="_ _23"></span>we’r<span class="ls104d">ei<span class="_ _43"></span><span class="ls0">nterested <span class="_ _9"></span>in <span class="_ _23"></span>for <span class="_ _9"></span>each <span class="_ _23"></span>descriptor<span class="_ _6"></span><span class="lsc3a">.(<span class="_ _62"></span><span class="ls0">Do <span class="_ _9"></span>we <span class="_ _23"></span>want <span class="_ _9"></span>to <span class="_ _23"></span>read</span></span></span></span></span></div><div class="t m0 x15 h2a y3d7f ff19 fsf fc0 sc0 ls0 ws0">from <span class="_ _23"></span>a <span class="_ _23"></span>given <span class="_ _23"> </span>descriptor?<span class="_ _51"> </span>Do <span class="_ _42"> </span>we <span class="_ _23"></span>want <span class="_ _23"> </span>to <span class="_ _23"> </span>write <span class="_ _42"> </span>to <span class="_ _23"> </span>a <span class="_ _23"> </span>given <span class="_ _42"> </span>descriptor?<span class="_ _51"> </span>Ar<span class="lsd07">ew<span class="_ _43"></span><span class="ls0">e</span></span></div><div class="t m0 x15 h2a y3d80 ff19 fsf fc0 sc0 ls0 ws0">interested in an exception condition for a given descriptor?)</div><div class="t m0 x3f h2a y3d81 ff19 fsf fc0 sc0 ls49 ws0">•H<span class="_ _4d"></span><span class="ls0">ow <span class="_ _3"></span>long <span class="_ _9"></span>we <span class="_ _9"></span>want <span class="_ _9"></span>to <span class="_ _3"></span>wait.<span class="_ _5a"> </span>(W<span class="_ _6"></span><span class="ls104e">ec<span class="_ _8"></span><span class="ls0">an <span class="_ _3"></span>wait <span class="_ _9"></span>forever<span class="_ _6"></span><span class="ls104e">,w<span class="_ _8"></span><span class="ls0">ait <span class="_ _3"></span>a <span class="_ _9"></span>ﬁxed <span class="_ _9"></span>amount <span class="_ _9"></span>of <span class="_ _3"></span>time,</span></span></span></span></span></div><div class="t m0 x15 h2a y3d82 ff19 fsf fc0 sc0 ls0 ws0">or not wait at all.)</div><div class="t m0 x32 h26 y3d83 ff19 fsf fc0 sc0 ls0 ws0">On the return fr<span class="_ _0"></span>om<span class="_"> </span><span class="ff1a">select</span><span class="ls44">,t<span class="_ _d"></span><span class="ls0">he kernel tells us</span></span></div><div class="t m0 x3f h2a y3d84 ff19 fsf fc0 sc0 ls49 ws0">•T<span class="_ _4d"></span><span class="ls0">he total count of the number of descriptors that ar<span class="ls44">er<span class="_ _4f"></span><span class="ls0">eady</span></span></span></div><div class="t m0 x3f h2a y3d85 ff19 fsf fc0 sc0 ls49 ws0">•W<span class="_ _4d"></span><span class="ls0">hich <span class="_ _e"> </span>descriptors <span class="_ _e"> </span>ar<span class="ls104f">er<span class="_ _4a"></span><span class="ls0">eady <span class="_ _e"> </span>for <span class="_ _e"> </span>each <span class="_ _e"> </span>of <span class="_ _e"> </span>the <span class="_ _e"> </span>three <span class="_ _e"> </span>conditions <span class="_ _e"> </span>(read, <span class="_ _53"> </span>write, <span class="_ _e"> </span>or</span></span></span></div><div class="t m0 x15 h2a y3d86 ff19 fsf fc0 sc0 ls0 ws0">exception condition)</div><div class="t m0 x32 h26 y3d87 ff19 fsf fc0 sc0 ls65 ws0">Wi<span class="_ _3"></span><span class="ls0">th <span class="_ _2"></span>this <span class="_ _2"></span>return information, <span class="_ _2"></span>we <span class="_ _2"></span>can <span class="_ _2"></span>call <span class="_ _2"></span>the <span class="_ _2"></span>appropriate I/O <span class="_ _2"></span>function <span class="_ _2"></span>(usually<span class="_ _47"> </span><span class="ff1a">read<span class="_ _66"> </span></span>or</span></div><div class="t m0 x32 h26 y3d88 ff1a fsf fc0 sc0 ls0 ws0">write<span class="ff19 ls44">)a<span class="_ _d"></span><span class="ls0">nd know that the function won’t block.</span></span></div><div class="t m0 x21a h57 y3d89 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;sys/select.h&gt;</div><div class="t m0 x21a h57 y3d8a ff1a fs2d fc0 sc0 ls0 ws0">int select(int<span class="_"> </span><span class="ff1b">maxfdp1</span><span class="ls15c">,f<span class="_ _1d"></span><span class="ls0">d_set *restrict<span class="_"> </span><span class="ff1b ls1e7">re<span class="_ _2"></span><span class="ls0">adfds</span></span>,</span></span></div><div class="t m0 x8 h57 y3d8b ff1a fs2d fc0 sc0 ls0 ws0">fd_set *restrict<span class="_"> </span><span class="ff1b">writefds</span><span class="ls15c">,f<span class="_ _1d"></span><span class="ls0">d_set *restrict<span class="_"> </span><span class="ff1b">exceptfds</span>,</span></span></div><div class="t m0 x8 h57 y3d8c ff1a fs2d fc0 sc0 ls0 ws0">struct timeval *restrict<span class="_"> </span><span class="ff1b">tvptr</span>);</div><div class="t m0 x64 h5f y3d8d ff19 fs2d fc0 sc0 ls0 ws0">Returns: count of ready descriptors, 0 on timeout,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>err<span class="_ _0"></span>or</div><div class="t m0 x3f h49 y3d8e ff19 fs26 fc0 sc0 ls0 ws0">Let’s <span class="_ _2"></span>look <span class="_ _3"></span>at <span class="_ _3"></span>the <span class="_ _2"></span>last <span class="_ _3"></span>argument <span class="_ _2"></span>ﬁrst.<span class="_ _16"> </span>It <span class="_ _2"></span>speciﬁes <span class="_ _3"></span>how <span class="_ _3"></span>long <span class="_ _2"></span>we <span class="_ _3"></span>want <span class="_ _3"></span>to <span class="_ _3"></span>wait <span class="_ _2"></span>in <span class="_ _3"></span>terms</div><div class="t m0 x32 h49 y3d8f ff19 fs26 fc0 sc0 ls0 ws0">of seconds and microseconds (r<span class="_ _0"></span>ecall Section 4.20).<span class="_ _59"> </span>Ther<span class="lsd3">ea<span class="_ _d"></span><span class="lscc">re <span class="_ _2"></span>t<span class="_ _2"></span><span class="ls0">hree conditions.</span></span></span></div><div class="t m0 x3f h4d y3d90 ff1b fs26 fc0 sc0 ls0 ws0">tvptr<span class="_ _59"> </span><span class="ff1a">== <span class="_ _6"></span>NULL</span></div><div class="t m0 x52 h49 y3d91 ff19 fs26 fc0 sc0 ls164 ws0">Wa<span class="_ _9"></span><span class="ls0">it <span class="_ _9"></span>forever<span class="_ _6"></span><span class="ls1050">.T<span class="_ _62"></span><span class="ls0">his <span class="_ _9"></span>inﬁnite <span class="_ _3"></span>wait <span class="_ _9"></span>can <span class="_ _3"></span>be <span class="_ _9"></span>interrupted <span class="_ _3"></span>if <span class="_ _9"></span>we <span class="_ _9"></span>catch <span class="_ _3"></span>a <span class="_ _9"></span>signal.<span class="_ _16"> </span>Return</span></span></span></div><div class="t m0 x52 h49 y3d92 ff19 fs26 fc0 sc0 ls0 ws0">is <span class="_ _e"> </span>made <span class="_ _e"> </span>when <span class="_"> </span>one <span class="_ _53"> </span>of <span class="_ _e"> </span>the <span class="_"> </span>speciﬁed <span class="_ _53"> </span>descriptors <span class="_"> </span>is <span class="_ _53"> </span>ready <span class="_ _53"> </span>or <span class="_"> </span>when <span class="_ _53"> </span>a <span class="_"> </span>signal <span class="_ _53"> </span>is</div><div class="t m0 x52 h4d y3d93 ff19 fs26 fc0 sc0 ls0 ws0">caught. <span class="_"> </span>If<span class="_"> </span><span class="lsd3">as<span class="_ _d"></span><span class="ls0">ignal is caught,<span class="_"> </span><span class="ff1a">select<span class="_ _66"> </span></span><span class="lscc">re</span>turns<span class="_"> </span><span class="ff20">−</span><span class="lsd3">1w<span class="_ _5"></span><span class="ls0">ith<span class="_"> </span><span class="ff1a">errno<span class="_ _80"> </span></span>set to<span class="_"> </span><span class="ff1a">EINTR</span>.</span></span></span></span></div><div class="t m0 x3f h4d y3d94 ff1b fs26 fc0 sc0 ls0 ws0">tvptr<span class="ff21">−</span>&gt;tv_sec<span class="_ _59"> </span><span class="ff1a">==<span class="_ _46"> </span><span class="ff19">0<span class="_ _46"> </span></span>&amp;&amp;<span class="_ _46"> </span></span>tvptr<span class="ff21">−</span>&gt;tv_usec<span class="_ _46"> </span><span class="ff1a">==<span class="_ _59"> </span><span class="ff19">0</span></span></div><div class="t m0 x52 h49 y3d95 ff19 fs26 fc0 sc0 ls0 ws0">Don’t <span class="_ _23"> </span>wait <span class="_ _42"> </span>at <span class="_ _23"> </span>all.<span class="_ _54"> </span>All <span class="_ _23"> </span>the <span class="_ _23"> </span>speciﬁed <span class="_ _42"> </span>descriptors <span class="_ _23"> </span>ar<span class="ls1051">et<span class="_ _43"></span><span class="ls0">ested, <span class="_ _23"> </span>and <span class="_ _42"> </span>return <span class="_ _23"></span>is <span class="_ _23"> </span>made</span></span></div><div class="t m0 x52 h49 y3d96 ff19 fs26 fc0 sc0 ls0 ws0">immediately<span class="_ _4"></span><span class="ls1052">.T<span class="_ _1d"></span><span class="ls0">his <span class="_ _3"></span>is <span class="_ _3"></span>a <span class="_ _3"></span>way <span class="_ _3"></span>to <span class="_ _3"></span>poll <span class="_ _3"></span>the <span class="_ _3"></span>system <span class="_ _3"></span>to <span class="_ _3"></span>ﬁnd <span class="_ _3"></span>out <span class="_ _3"></span>the <span class="_ _3"></span>status <span class="_ _3"></span>of <span class="_ _3"></span>multiple</span></span></div><div class="t m0 x52 h4d y3d97 ff19 fs26 fc0 sc0 ls0 ws0">descriptors without blocking in the<span class="_"> </span><span class="ff1a">select<span class="_ _80"> </span></span>function.</div><a class="l" href="#pf11" data-dest-detail='[17,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:156.494092px;bottom:1089.288916px;width:235.655014px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
