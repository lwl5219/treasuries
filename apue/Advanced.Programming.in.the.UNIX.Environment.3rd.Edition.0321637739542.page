<div id="pf21e" class="pf w4 h1f" data-page-no="21e"><div class="pc pc21e w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg21e.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">508<span class="_ _1b"> </span><span class="ff19">Advanced <span class="_"> </span>I/O<span class="_ _16b"> </span>Chapter <span class="_"> </span>14</span></div><div class="t m0 x3f h2a y12f ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _47"> </span>ﬁrst <span class="_ _66"> </span>four <span class="_ _47"> </span>rows <span class="_ _47"> </span>of <span class="_ _66"> </span>Figur<span class="ls1089">e1<span class="_ _1d"></span><span class="ls0">4.17 <span class="_ _47"> </span>test <span class="_ _47"> </span>for <span class="_ _47"> </span>readability<span class="_ _4"></span><span class="ls1089">,t<span class="_ _1d"></span><span class="ls0">he <span class="_ _47"> </span>next <span class="_ _47"> </span>three <span class="_ _66"> </span>test <span class="_ _47"> </span>for</span></span></span></span></div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">writability<span class="_ _4"></span><span class="ls25e">,a<span class="_ _4a"></span><span class="ls0">nd <span class="_"> </span>the <span class="_"> </span>ﬁnal <span class="_"> </span>thr<span class="_ _0"></span>ee <span class="_"> </span>ar<span class="_ _0"></span><span class="ls25e">ef<span class="_ _4a"></span><span class="ls0">or <span class="_"> </span>exception <span class="_"> </span>conditions.<span class="_ _48"> </span>The <span class="_"> </span>last <span class="_"> </span>thr<span class="_ _0"></span>ee <span class="_"> </span>r<span class="_ _0"></span>ows <span class="_"> </span>in</span></span></span></span></div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">Figur<span class="ls108a">e1<span class="_ _62"></span><span class="ls0">4.17 <span class="_ _47"> </span>ar<span class="ls108a">es<span class="_ _62"></span><span class="ls0">et <span class="_ _45"> </span>by <span class="_ _47"> </span>the <span class="_ _47"> </span>kernel <span class="_ _45"> </span>on <span class="_ _47"> </span>return. <span class="_ _61"> </span>These<span class="_ _16"> </span>three <span class="_ _47"> </span>values <span class="_ _45"> </span>ar<span class="_ _0"></span><span class="lsfd1">er<span class="_ _62"></span><span class="ls0">eturned <span class="_ _47"> </span>in</span></span></span></span></span></span></div><div class="t m0 x32 h26 y132 ff1a fsf fc0 sc0 ls0 ws0">revents<span class="_ _66"> </span><span class="ff19">when <span class="_ _2"></span>the <span class="_ _2"></span>condition occurs, <span class="_ _2"></span>even <span class="_ _2"></span>if <span class="_ _2"></span>they <span class="_ _2"></span>weren’t speciﬁed <span class="_ _2"></span>in <span class="_ _2"></span>the<span class="_ _66"> </span></span>events<span class="_ _47"> </span><span class="ff19">ﬁeld.</span></div><div class="t m0 x76 h76 y3e47 ff19 fs2a fc0 sc0 ls0 ws0">The poll event <span class="_ _2"></span>names containing <span class="_ _2"></span>the term<span class="_ _e"> </span><span class="ff1b">BAND<span class="_ _80"> </span></span><span class="ls34e">re</span>fer <span class="_ _2"></span>to priority bands <span class="_ _2"></span>in STREAMS.<span class="_ _44"> </span>Refer to</div><div class="t m0 x76 h51 y3e48 ff19 fs2a fc0 sc0 ls0 ws0">Rago</div><div class="t m0 x71 h51 y3e49 ff19 fs2a fc0 sc0 ls0 ws0">[</div><div class="t m0 x143 h51 y3e48 ff19 fs2a fc0 sc0 ls0 ws0">1993</div><div class="t m0 x161 h51 y3e49 ff19 fs2a fc0 sc0 ls0 ws0">]</div><div class="t m0 x10d h51 y3e48 ff19 fs2a fc0 sc0 ls0 ws0">for mor<span class="lse9">ei<span class="_ _5"></span><span class="ls0">nformation about STREAMS and priority bands.</span></span></div><div class="t m0 x3f h26 y3000 ff19 fsf fc0 sc0 ls0 ws0">When <span class="_ _2"></span>a <span class="_ _3"></span>descriptor <span class="_ _2"></span>is <span class="_ _3"></span>hung <span class="_ _3"></span>up <span class="_ _2"></span>(<span class="ff1a">POLLHUP</span>), <span class="_ _3"></span>we <span class="_ _3"></span>can <span class="_ _2"></span>no <span class="_ _3"></span>longer <span class="_ _2"></span>write <span class="_ _3"></span>to <span class="_ _3"></span>the <span class="_ _2"></span>descriptor<span class="_ _1"></span>.</div><div class="t m0 x32 h2a y3e4a ff19 fsf fc0 sc0 ls0 ws0">Ther<span class="ls44">em<span class="_ _4f"></span><span class="ls0">ay<span class="_ _6"></span><span class="ls44">,h<span class="_ _d"></span><span class="ls0">owever<span class="_ _1"></span><span class="ls44">,s<span class="_ _d"></span><span class="ls0">till be data to be read fr<span class="_ _0"></span>om the descriptor<span class="_ _6"></span>.</span></span></span></span></span></span></div><div class="t m0 x3f h26 y3e4b ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _3"></span>ﬁnal <span class="_ _3"></span>argument <span class="_ _3"></span>to<span class="_ _47"> </span><span class="ff1a">poll<span class="_ _47"> </span></span>speciﬁes <span class="_ _9"></span>how <span class="_ _3"></span>long <span class="_ _3"></span>we <span class="_ _3"></span>want <span class="_ _3"></span>to <span class="_ _9"></span>wait.<span class="_ _61"> </span>As <span class="_ _9"></span>with<span class="_ _47"> </span><span class="ff1a">select</span>,</div><div class="t m0 x32 h2a y3e4c ff19 fsf fc0 sc0 ls0 ws0">ther<span class="ls44">ea<span class="_ _4f"></span><span class="ls45">re <span class="_ _3"></span>t<span class="ls0">hree cases.</span></span></span></div><div class="t m0 x3f h26 y3e4d ff1b fsf fc0 sc0 ls0 ws0">timeout<span class="_ _59"> </span><span class="ff1a">==<span class="_ _46"> </span><span class="ff20">−<span class="ff19">1</span></span></span></div><div class="t m0 x52 h26 y3e4e ff19 fsf fc0 sc0 ls5f ws0">Wa<span class="_ _9"></span><span class="ls0">it <span class="_ _23"></span>forever<span class="_ _6"></span><span class="ls108b">.(<span class="_ _26"></span><span class="ls0">Some <span class="_ _23"></span>systems <span class="_ _9"></span>deﬁne <span class="_ _23"> </span>the <span class="_ _23"></span>constant<span class="_ _35"> </span><span class="ff1a">INFTIM<span class="_ _45"> </span></span>in<span class="_ _35"> </span><span class="ff1a">&lt;stropts.h&gt;<span class="_ _45"> </span></span>as</span></span></span></div><div class="t m0 x52 h2a y3e4f ff20 fsf fc0 sc0 ls0 ws0">−<span class="ff19">1.) <span class="_ _47"> </span>W<span class="_ _6"></span><span class="ls830">er<span class="_ _b"></span><span class="ls0">eturn <span class="_ _9"></span>when <span class="_ _3"></span>one <span class="_ _3"></span>of <span class="_ _9"></span>the <span class="_ _3"></span>speciﬁed <span class="_ _3"></span>descriptors <span class="_ _3"></span>is <span class="_ _9"></span>ready <span class="_ _2"></span>or <span class="_ _3"></span>when <span class="_ _9"></span>a <span class="_ _3"></span>signal</span></span></span></div><div class="t m0 x52 h26 y3e50 ff19 fsf fc0 sc0 ls0 ws0">is caught.<span class="_ _59"> </span>If a signal is caught,<span class="_"> </span><span class="ff1a">poll<span class="_ _66"> </span></span><span class="ls45">re</span>turns<span class="_"> </span><span class="ff20">−</span><span class="ls44">1w<span class="_ _5"></span><span class="ls0">ith<span class="_"> </span><span class="ff1a">errno<span class="_ _80"> </span></span>set to<span class="_"> </span><span class="ff1a">EINTR</span>.</span></span></div><div class="t m0 x3f h26 y3e51 ff1b fsf fc0 sc0 ls0 ws0">timeout<span class="_ _59"> </span><span class="ff1a">==<span class="_ _46"> </span><span class="ff19">0</span></span></div><div class="t m0 x52 h2a y3e52 ff19 fsf fc0 sc0 ls0 ws0">Don’t <span class="_ _2"></span>wait.<span class="_ _61"> </span>All <span class="_ _2"></span>the <span class="_ _2"></span>speciﬁed <span class="_ _2"></span>descriptors <span class="_ _2"></span>ar<span class="lse76">et<span class="_ _4f"></span><span class="ls0">ested, <span class="_ _2"></span>and <span class="_ _2"></span>we <span class="_ _2"></span>return <span class="_ _2"></span>immediately<span class="_ _4"></span>.</span></span></div><div class="t m0 x52 h2a y3e53 ff19 fsf fc0 sc0 ls0 ws0">This <span class="_ _9"></span>is <span class="_ _23"> </span>a <span class="_ _23"></span>way <span class="_ _9"></span>to <span class="_ _23"></span>poll <span class="_ _23"></span>the <span class="_ _9"></span>system <span class="_ _23"></span>to <span class="_ _9"></span>ﬁnd <span class="_ _23"> </span>out <span class="_ _23"></span>the <span class="_ _9"></span>status <span class="_ _23"></span>of <span class="_ _9"></span>multiple <span class="_ _23"> </span>descriptors,</div><div class="t m0 x52 h26 y3e54 ff19 fsf fc0 sc0 ls0 ws0">without blocking in the call to<span class="_"> </span><span class="ff1a">poll</span>.</div><div class="t m0 x3f h26 y3e55 ff1b fsf fc0 sc0 ls0 ws0">timeout<span class="_ _59"> </span><span class="ff1a">&gt;<span class="_ _46"> </span><span class="ff19">0</span></span></div><div class="t m0 x52 h2b y3e56 ff19 fsf fc0 sc0 ls5f ws0">Wa<span class="_ _9"></span><span class="ls0">it<span class="_ _35"> </span><span class="ff1b">timeout<span class="_ _35"> </span></span>milliseconds. <span class="_ _35"> </span>W<span class="_ _6"></span><span class="ls108c">er<span class="_ _43"></span><span class="ls0">eturn <span class="_ _23"></span>when <span class="_ _23"></span>one <span class="_ _23"></span>of <span class="_ _23"> </span>the <span class="_ _23"> </span>speciﬁed <span class="_ _23"> </span>descriptors <span class="_ _42"> </span>is</span></span></span></div><div class="t m0 x52 h2b y3e57 ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">ady <span class="_"> </span>or <span class="_"> </span>when <span class="_ _e"> </span>the<span class="_ _59"> </span><span class="ff1b">timeout<span class="_ _46"> </span></span>expires. <span class="_ _4b"> </span>If<span class="_ _59"> </span>the<span class="_ _46"> </span><span class="ff1b">timeout<span class="_ _59"> </span></span>expires <span class="_ _e"> </span>befor<span class="ls108d">ea<span class="_ _4a"></span><span class="ls0">ny <span class="_"> </span>of <span class="_"> </span>the</span></span></span></div><div class="t m0 x52 h2a y3e58 ff19 fsf fc0 sc0 ls0 ws0">descriptors <span class="_"> </span>is <span class="_"> </span>r<span class="_ _1"></span>eady<span class="_ _6"></span><span class="ls108e">,t<span class="_ _4a"></span><span class="ls0">he <span class="_"> </span>return <span class="_ _e"> </span>value <span class="_"> </span>is <span class="_"> </span>0.<span class="_ _48"> </span>(If <span class="_"> </span>your <span class="_"> </span>system <span class="_"> </span>doesn’t <span class="_ _e"> </span>provide</span></span></div><div class="t m0 x52 h2b y3e59 ff19 fsf fc0 sc0 ls0 ws0">millisecond resolution,<span class="_"> </span><span class="ff1b">timeout<span class="_"> </span></span>is r<span class="_ _0"></span>ounded up to the near<span class="_ _0"></span>est supported value.)</div><div class="t m0 x3f h2a y3e5a ff19 fsf fc0 sc0 ls0 ws0">It <span class="_ _42"> </span>is <span class="_ _53"> </span>important <span class="_ _42"> </span>to <span class="_ _53"> </span>realize <span class="_ _42"> </span>the <span class="_ _42"> </span>difference <span class="_ _42"> </span>between <span class="_ _42"> </span>an <span class="_ _53"> </span>end <span class="_ _42"> </span>of <span class="_ _53"> </span>ﬁle <span class="_ _42"> </span>and <span class="_ _53"> </span>a <span class="_ _42"> </span>hangup.<span class="_ _65"> </span>If</div><div class="t m0 x32 h26 y3e5b ff19 fsf fc0 sc0 ls0 ws0">we’r<span class="ls108f">ee<span class="_ _4a"></span><span class="ls0">ntering <span class="_"> </span>data <span class="_ _53"> </span>from <span class="_ _53"> </span>the <span class="_ _e"> </span>terminal <span class="_ _e"> </span>and <span class="_ _e"> </span>type <span class="_ _e"> </span>the <span class="_ _e"> </span>end-of-ﬁle <span class="_ _e"> </span>character<span class="_ _6"></span>,<span class="_ _59"> </span><span class="ff1a">POLLIN<span class="_ _4b"> </span></span>is</span></span></div><div class="t m0 x32 h26 y3e5c ff19 fsf fc0 sc0 ls0 ws0">turned <span class="_ _23"></span>on <span class="_ _9"></span>so <span class="_ _23"> </span>we <span class="_ _23"></span>can <span class="_ _9"></span>read <span class="_ _23"></span>the <span class="_ _9"></span>end-of-ﬁle <span class="_ _23"> </span>indication <span class="_ _23"></span>(<span class="ff1a">read<span class="_ _45"> </span></span><span class="ls45">re<span class="_ _2"></span></span>turns <span class="_ _23"></span>0).<span class="_ _5a"> </span><span class="ff1a">POLLHUP<span class="_ _35"> </span></span>is <span class="_ _23"></span>not</div><div class="t m0 x32 h26 y3e5d ff19 fsf fc0 sc0 ls0 ws0">turned <span class="_ _3"></span>on <span class="_ _3"></span>in<span class="_ _47"> </span><span class="ff1a">revents</span><span class="ls1090">.I<span class="_ _1d"></span><span class="ls274">fw<span class="_ _8"></span><span class="ls0">e’r<span class="ls274">er<span class="_ _b"></span><span class="ls0">eading <span class="_ _3"></span>from <span class="_ _3"></span>a <span class="_ _3"></span>modem <span class="_ _3"></span>and <span class="_ _9"></span>the <span class="_ _3"></span>telephone <span class="_ _3"></span>line <span class="_ _3"></span>is <span class="_ _3"></span>hung</span></span></span></span></span></div><div class="t m0 x32 h26 y3e5e ff19 fsf fc0 sc0 ls0 ws0">up, we’ll receive the<span class="_"> </span><span class="ff1a">POLLHUP<span class="_ _80"> </span></span>notiﬁcation.</div><div class="t m0 x3f h26 y3e5f ff19 fsf fc0 sc0 ls0 ws0">As <span class="_ _e"> </span>with<span class="_ _59"> </span><span class="ff1a">select</span><span class="ls1091">,w<span class="_ _55"></span><span class="ls0">hether <span class="_ _e"> </span>a <span class="_"> </span>descriptor <span class="_ _53"> </span>is <span class="_"> </span>blocking <span class="_ _e"> </span>doesn’t <span class="_"> </span>af<span class="_ _1"></span>fect <span class="_"> </span>whether<span class="_ _4b"> </span><span class="ff1a">poll</span></span></span></div><div class="t m0 x32 h2a y3e60 ff19 fsf fc0 sc0 ls0 ws0">blocks.</div><div class="t m0 x35 h26 y3e61 ff16 fsf fc0 sc0 ls0 ws0">Interruptibility of<span class="_"> </span><span class="ff1f">select<span class="_ _66"> </span></span>and<span class="_"> </span><span class="ff1f">poll</span></div><div class="t m0 x32 h2a y3e62 ff19 fsf fc0 sc0 ls0 ws0">When <span class="_ _3"></span>the <span class="_ _9"></span>automatic <span class="_ _3"></span>restarting <span class="_ _3"></span>of <span class="_ _3"></span>interrupted <span class="_ _3"></span>system <span class="_ _9"></span>calls <span class="_ _3"></span>was <span class="_ _9"></span>introduced <span class="_ _2"></span>with <span class="_ _9"></span>4.2BSD</div><div class="t m0 x32 h26 y3e63 ff19 fsf fc0 sc0 ls0 ws0">(Section <span class="_ _23"></span>10.5), <span class="_ _23"> </span>the<span class="_ _35"> </span><span class="ff1a">select<span class="_ _35"> </span></span>function <span class="_ _23"></span>was <span class="_ _23"></span>never <span class="_ _23"> </span>restarted. <span class="_ _35"> </span>This<span class="_ _45"> </span>characteristic <span class="_ _42"> </span>continues</div><div class="t m0 x32 h26 y3e64 ff19 fsf fc0 sc0 ls0 ws0">with <span class="_ _53"> </span>most <span class="_ _53"> </span>systems <span class="_ _53"> </span>even <span class="_ _53"> </span>if <span class="_ _53"> </span>the<span class="_ _44"> </span><span class="ff1a">SA_RESTART<span class="_ _4b"> </span></span>option <span class="_ _53"> </span>is <span class="_ _53"> </span>speciﬁed.<span class="_ _65"> </span>But <span class="_ _53"> </span>under <span class="_ _53"> </span>SVR4, <span class="_ _53"> </span>if</div><div class="t m0 x32 h26 y3e65 ff1a fsf fc0 sc0 ls0 ws0">SA_RESTART<span class="_ _45"> </span><span class="ff19">was <span class="_ _23"></span>speciﬁed, <span class="_ _9"></span>even<span class="_ _35"> </span></span>select<span class="_ _45"> </span><span class="ff19">and<span class="_ _35"> </span></span>poll<span class="_ _45"> </span><span class="ff19">wer<span class="ls1092">ea<span class="_ _43"></span><span class="ls0">utomatically <span class="_ _23"></span>restarted. <span class="_ _45"> </span>T<span class="_ _6"></span>o</span></span></span></div><div class="t m0 x32 h2a y3e66 ff19 fsf fc0 sc0 ls0 ws0">prevent <span class="_ _23"></span>this <span class="_ _23"> </span>from <span class="_ _23"></span>catching <span class="_ _23"> </span>us <span class="_ _42"> </span>when <span class="_ _23"> </span>we <span class="_ _23"> </span>port <span class="_ _42"> </span>software<span class="_ _45"> </span>to<span class="_ _44"> </span>systems <span class="_ _23"></span>derived <span class="_ _23"> </span>from <span class="_ _23"> </span>SVR4,</div><div class="t m0 x32 h26 y3e67 ff19 fsf fc0 sc0 ls0 ws0">we’ll <span class="_ _2"></span>always <span class="_ _3"></span>use <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">signal_intr<span class="_ _47"> </span></span>function <span class="_ _3"></span>(Figur<span class="ls989">e1<span class="_ _8"></span><span class="ls0">0.19) <span class="_ _3"></span>if <span class="_ _3"></span>the <span class="_ _3"></span>signal <span class="_ _3"></span>could <span class="_ _3"></span>interrupt</span></span></div><div class="t m0 x32 h26 y3e68 ff19 fsf fc0 sc0 ls44 ws0">ac<span class="_ _d"></span><span class="ls0">all to<span class="_"> </span><span class="ff1a">select<span class="_ _66"> </span></span>or<span class="_"> </span><span class="ff1a">poll</span>.</span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
