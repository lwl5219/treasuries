<div id="pfcd" class="pf w4 h1f" data-page-no="cd"><div class="pc pccd w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bgcd.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>5.14<span class="_ _1e8"> </span>Memory <span class="_"> </span>Streams<span class="_ _1b"> </span><span class="ff18">171</span></div><div class="t m0 x3f h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">trying to create second temp file...</div><div class="t m0 x3f h57 y426 ff1a fs2d fc0 sc0 ls0 ws0">Segmentation fault</div><div class="t m0 x3f h2a y427 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _47"> </span>difference <span class="_ _47"> </span>in <span class="_ _47"> </span>behavior <span class="_ _45"> </span>comes <span class="_ _47"> </span>from <span class="_ _47"> </span>the <span class="_ _45"> </span>way <span class="_ _47"> </span>the <span class="_ _45"> </span>two <span class="_ _47"> </span>template <span class="_ _45"> </span>strings <span class="_ _47"> </span>are</div><div class="t m0 x32 h2a y428 ff19 fsf fc0 sc0 ls0 ws0">declared. <span class="_ _47"> </span>For<span class="_ _45"> </span>the <span class="_ _9"></span>ﬁrst <span class="_ _9"></span>template, <span class="_ _9"></span>the <span class="_ _9"></span>name <span class="_ _9"></span>is <span class="_ _9"></span>allocated <span class="_ _9"></span>on <span class="_ _9"></span>the <span class="_ _9"></span>stack, <span class="_ _9"></span>because <span class="_ _9"></span>we <span class="_ _9"></span>use <span class="_ _9"></span>an</div><div class="t m0 x32 h2a y429 ff19 fsf fc0 sc0 ls0 ws0">array <span class="_ _3"></span>variable.<span class="_ _5a"> </span>For <span class="_ _9"></span>the <span class="_ _9"></span>second <span class="_ _3"></span>name, <span class="_ _9"></span>however<span class="_ _1"></span>,<span class="_ _45"> </span>we<span class="_ _47"> </span>use <span class="_ _9"></span>a <span class="_ _9"></span>pointer<span class="_ _6"></span><span class="ls731">.I<span class="_ _62"></span><span class="ls732">nt<span class="_ _8"></span><span class="ls0">his <span class="_ _9"></span>case, <span class="_ _9"></span>only <span class="_ _3"></span>the</span></span></span></div><div class="t m0 x32 h2a y42a ff19 fsf fc0 sc0 ls0 ws0">memory for the <span class="_ _2"></span>pointer itself resides on the stack; <span class="_ _2"></span>the compiler arranges <span class="_ _2"></span>for the string <span class="_ _2"></span>to</div><div class="t m0 x32 h26 y42b ff19 fsf fc0 sc0 ls0 ws0">be <span class="_ _2"></span>stored in <span class="_ _2"></span>the <span class="_ _3"></span>read-only segment <span class="_ _2"></span>of <span class="_ _2"></span>the <span class="_ _3"></span>executable.<span class="_ _61"> </span>When <span class="_ _2"></span>the<span class="_ _66"> </span><span class="ff1a">mkstemp<span class="_ _47"> </span></span>function <span class="_ _2"></span>tries</div><div class="t m0 x32 h2a y42c ff19 fsf fc0 sc0 ls0 ws0">to modify the string, a segmentation fault occurs.</div><div class="t m0 x35 h4b y17a3 ff16 fs27 fc0 sc0 ls0 ws0">5.14 <span class="_ _93"> </span>Memor<span class="ls5d5">yS<span class="_ _52"></span><span class="ls0">treams</span></span></div><div class="t m0 x32 h49 y17a4 ff19 fs26 fc0 sc0 ls0 ws0">As <span class="_ _3"></span>we’ve <span class="_ _9"></span>seen, <span class="_ _3"></span>the <span class="_ _9"></span>standar<span class="ls733">dI<span class="_ _b"></span><span class="ls0">/O <span class="_ _9"></span>library <span class="_ _3"></span>buffers <span class="_ _3"></span>data <span class="_ _9"></span>in <span class="_ _3"></span>memory<span class="_ _6"></span>,<span class="_ _47"> </span>so<span class="_ _45"> </span>operations <span class="_ _3"></span>such <span class="_ _9"></span>as</span></span></div><div class="t m0 x32 h49 y17a5 ff19 fs26 fc0 sc0 ls0 ws0">character-at-a-time <span class="_ _3"></span>I/O <span class="_ _9"></span>and <span class="_ _23"></span>line-at-a-time <span class="_ _3"></span>I/O <span class="_ _23"></span>ar<span class="ls734">em<span class="_ _b"></span><span class="ls0">or<span class="_ _1"></span><span class="ls734">ee<span class="_ _b"></span><span class="lscc">fﬁ<span class="_ _2"></span><span class="ls0">cient. <span class="_ _45"> </span>W<span class="_ _6"></span>e’ve <span class="_ _9"></span>also <span class="_ _9"></span>seen <span class="_ _23"></span>that</span></span></span></span></span></div><div class="t m0 x32 h4d y17a6 ff19 fs26 fc0 sc0 ls0 ws0">we can <span class="_ _2"></span>provide our own <span class="_ _2"></span>buffer for the <span class="_ _2"></span>library <span class="_ _2"></span>to use <span class="_ _2"></span>by calling<span class="_ _47"> </span><span class="ff1a">setbuf<span class="_ _66"> </span></span>or<span class="_"> </span><span class="ff1a">setvbuf</span><span class="ls735">.I<span class="_ _4a"></span><span class="ls0">n</span></span></div><div class="t m0 x32 h4a y17a7 ff19 fs26 fc0 sc0 ls736 ws0">Ve<span class="_ _23"></span><span class="ls0">rsion <span class="_ _9"></span>4, <span class="_ _9"></span>the <span class="_ _23"></span>Single <span class="_ _9"></span>UNIX <span class="_ _23"></span>Speciﬁcation <span class="_ _9"></span>added <span class="_ _9"></span>support <span class="_ _23"></span>for<span class="_ _45"> </span><span class="ff1b">memory <span class="_ _9"></span>streams</span><span class="ls737">.T<span class="_ _26"></span><span class="ls0">hese <span class="_ _23"></span>are</span></span></span></div><div class="t m0 x32 h49 y17a8 ff19 fs26 fc0 sc0 ls0 ws0">standar<span class="ls738">dI<span class="_ _c"></span><span class="ls0">/O <span class="_ _42"> </span>streams <span class="_ _42"> </span>for <span class="_ _42"> </span>which <span class="_ _42"> </span>ther<span class="ls738">ea<span class="_ _c"></span><span class="lscc">re <span class="_"> </span>n<span class="ls738">ou<span class="_ _c"></span><span class="ls0">nderlying <span class="_ _53"> </span>ﬁles, <span class="_ _42"> </span>although <span class="_ _42"> </span>they <span class="_ _42"> </span>ar<span class="ls739">es<span class="_ _c"></span><span class="ls0">till</span></span></span></span></span></span></span></span></div><div class="t m0 x32 h4d y17a9 ff19 fs26 fc0 sc0 ls0 ws0">accessed <span class="_ _2"></span>with<span class="_ _47"> </span><span class="ff1a">FILE<span class="_ _47"> </span></span>pointers. <span class="_ _47"> </span>All<span class="_ _66"> </span>I/O <span class="_ _3"></span>is <span class="_ _3"></span>done <span class="_ _2"></span>by <span class="_ _3"></span>transferring <span class="_ _2"></span>bytes <span class="_ _3"></span>to <span class="_ _3"></span>and <span class="_ _2"></span>from <span class="_ _2"></span>buffers</div><div class="t m0 x32 h49 y17aa ff19 fs26 fc0 sc0 ls0 ws0">in <span class="_ _42"> </span>main <span class="_ _53"> </span>memory<span class="_ _6"></span><span class="ls73a">.A<span class="_ _52"></span><span class="ls0">s<span class="_ _44"> </span>we<span class="_ _44"> </span>shall <span class="_ _42"> </span>see, <span class="_ _53"> </span>even <span class="_ _53"> </span>though <span class="_ _42"> </span>these <span class="_ _53"> </span>streams <span class="_ _42"> </span>look <span class="_ _53"> </span>like <span class="_ _42"> </span>ﬁle <span class="_ _53"> </span>streams,</span></span></div><div class="t m0 x32 h49 y17ab ff19 fs26 fc0 sc0 ls0 ws0">several features make them mor<span class="_ _0"></span><span class="lsd3">es<span class="_ _d"></span><span class="ls0">uited for manipulating character strings.</span></span></div><div class="t m0 x3f h4d y17ac ff19 fs26 fc0 sc0 ls0 ws0">Three functions ar<span class="_ _0"></span><span class="lsd3">ea<span class="_ _d"></span><span class="ls0">vailable to create memory str<span class="_ _0"></span>eams. <span class="_"> </span>The<span class="_"> </span>ﬁrst is<span class="_"> </span><span class="ff1a">fmemopen</span>.</span></span></div><div class="t m0 x3f h4e y17ad ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;stdio.h&gt;</div><div class="t m0 x3f h4e y17ae ff1a fs28 fc0 sc0 ls0 ws0">FILE *fmemopen(void *restrict<span class="_"> </span><span class="ff1b">buf</span><span class="ls1b6">,s<span class="_ _1d"></span><span class="ls0">ize_t<span class="_"> </span><span class="ff1b">size</span>,</span></span></div><div class="t m0 x12b h4e y17af ff1a fs28 fc0 sc0 ls0 ws0">const char *restrict<span class="_"> </span><span class="ff1b">type</span>);</div><div class="t m0 x113 h4e y17b0 ff19 fs28 fc0 sc0 ls0 ws0">Returns: stream pointer if OK,<span class="_"> </span><span class="ff1a">NULL<span class="_ _e"> </span></span>on error</div><div class="t m0 x32 h54 y17b1 ff19 fs2c fc0 sc0 ls0 ws0">The<span class="_ _66"> </span><span class="ff1a">fmemopen<span class="_ _47"> </span></span>function <span class="_ _2"></span>allows <span class="_ _2"></span>the <span class="_ _2"></span>caller <span class="_ _2"></span>to <span class="_ _2"></span>provide <span class="_ _2"></span>a <span class="_ _2"></span>buffer to <span class="_ _2"></span>be <span class="_ _2"></span>used <span class="_ _3"></span>for <span class="_ _2"></span>the <span class="_ _2"></span>memory</div><div class="t m0 x32 h60 y17b2 ff19 fs2c fc0 sc0 ls0 ws0">stream: <span class="_ _23"></span>the<span class="_ _35"> </span><span class="ff1b">buf<span class="_ _35"> </span></span>argument <span class="_ _23"> </span>points <span class="_ _42"> </span>to <span class="_ _23"> </span>the <span class="_ _42"> </span>beginning <span class="_ _42"> </span>of <span class="_ _23"> </span>the <span class="_ _42"> </span>buffer <span class="_ _23"></span>and <span class="_ _23"> </span>the<span class="_ _35"> </span><span class="ff1b">size<span class="_ _44"> </span></span>argument</div><div class="t m0 x32 h54 y17b3 ff19 fs2c fc0 sc0 ls0 ws0">speciﬁes <span class="_ _3"></span>the <span class="_ _3"></span>size <span class="_ _3"></span>of <span class="_ _9"></span>the <span class="_ _3"></span>buffer <span class="_ _3"></span>in <span class="_ _3"></span>bytes.<span class="_ _16"> </span>If <span class="_ _3"></span>the<span class="_ _45"> </span><span class="ff1b">buf<span class="_ _47"> </span></span>argument <span class="_ _2"></span>is <span class="_ _3"></span>null, <span class="_ _9"></span>then <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">fmemopen</span></div><div class="t m0 x32 h60 y17b4 ff19 fs2c fc0 sc0 ls0 ws0">function <span class="_ _9"></span>allocates <span class="_ _9"></span>a <span class="_ _23"></span>buffer <span class="_ _3"></span>of<span class="_ _45"> </span><span class="ff1b">size<span class="_ _35"> </span></span>bytes. <span class="_ _45"> </span>In<span class="_ _45"> </span>this <span class="_ _9"></span>case, <span class="_ _9"></span>the <span class="_ _23"></span>buf<span class="_ _0"></span>fer <span class="_ _9"></span>will <span class="_ _9"></span>be <span class="_ _23"></span>freed <span class="_ _3"></span>when <span class="_ _23"></span>the</div><div class="t m0 x32 h55 y17b5 ff19 fs2c fc0 sc0 ls0 ws0">stream is closed.</div><div class="t m0 x3f h60 y17b6 ff19 fs2c fc0 sc0 ls0 ws0">The<span class="_ _35"> </span><span class="ff1b">type<span class="_ _35"> </span></span>argument <span class="_ _23"> </span>controls <span class="_ _23"> </span>how <span class="_ _42"> </span>the <span class="_ _23"> </span>stream <span class="_ _23"> </span>can <span class="_ _42"> </span>be <span class="_ _23"> </span>used.<span class="_ _51"> </span>The <span class="_ _42"> </span>possible <span class="_ _23"> </span>values <span class="_ _42"> </span>for</div><div class="t m0 x32 h60 y17b7 ff1b fs2c fc0 sc0 ls0 ws0">type<span class="_"> </span><span class="ff19">ar<span class="ls142">es<span class="_ _4f"></span><span class="ls0">ummarized in Figur<span class="ls142">e5<span class="_ _d"></span><span class="ls0">.14.</span></span></span></span></span></div><div class="t m0 x1ca hd1 y17b8 ff1b fs12 fc0 sc0 ls0 ws0">type<span class="_ _180"> </span><span class="ff19">Description</span></div><div class="t m0 x198 h63 y17b9 ff1a fs13 fc0 sc0 ls0 ws0">r<span class="_"> </span><span class="ff19">or<span class="_ _59"> </span></span>rb<span class="_ _be"> </span><span class="ff19">open for reading</span></div><div class="t m0 x198 h63 y17ba ff1a fs13 fc0 sc0 ls0 ws0">w<span class="_"> </span><span class="ff19">or<span class="_ _59"> </span></span>wb<span class="_ _be"> </span><span class="ff19">open for writing</span></div><div class="t m0 x198 h63 y17bb ff1a fs13 fc0 sc0 ls0 ws0">a<span class="_"> </span><span class="ff19">or<span class="_ _59"> </span></span>ab<span class="_ _be"> </span><span class="ff19">append; open for writing at ﬁrst null byte</span></div><div class="t m0 x198 h63 y17bc ff1a fs13 fc0 sc0 ls0 ws0">r+<span class="_"> </span><span class="ff19">or<span class="_ _59"> </span></span>r+b<span class="_"> </span><span class="ff19">or<span class="_ _59"> </span></span>rb+<span class="_ _6e"> </span><span class="ff19">open for reading and writing</span></div><div class="t m0 x198 h63 y17bd ff1a fs13 fc0 sc0 ls0 ws0">w+<span class="_"> </span><span class="ff19">or<span class="_ _59"> </span></span>w+b<span class="_"> </span><span class="ff19">or<span class="_ _59"> </span></span>wb+<span class="_ _6e"> </span><span class="ff19">truncate to 0 length and open for reading and writing</span></div><div class="t m0 x198 h63 y17be ff1a fs13 fc0 sc0 ls0 ws0">a+<span class="_"> </span><span class="ff19">or<span class="_ _59"> </span></span>a+b<span class="_"> </span><span class="ff19">or<span class="_ _59"> </span></span>ab+<span class="_ _6e"> </span><span class="ff19">append; open for reading and writing at ﬁrst null byte</span></div><div class="t m0 x180 hd2 y17bf ff18 fs14 fc0 sc0 ls0 ws0">Figure 5.14<span class="_ _5a"> </span><span class="ff19">The<span class="_"> </span><span class="ff1b">type<span class="_"> </span></span>argument for opening a memory stream</span></div><div class="t m0 x32 h96 y17c0 ff19 fs49 fc0 sc0 ls0 ws0">Note <span class="_ _9"></span>that <span class="_ _3"></span>these <span class="_ _9"></span>values <span class="_ _9"></span>correspond <span class="_ _3"></span>to <span class="_ _9"></span>the <span class="_ _9"></span>ones <span class="_ _9"></span>for <span class="_ _9"></span>ﬁle-based <span class="_ _9"></span>standar<span class="ls73b">dI<span class="_ _b"></span><span class="ls0">/O <span class="_ _3"></span>streams, <span class="_ _9"></span>but</span></span></div><div class="t m0 x32 h96 y17c1 ff19 fs49 fc0 sc0 ls0 ws0">ther<span class="ls73c">ea<span class="_ _5b"></span><span class="ls4a6">re <span class="_ _47"> </span>s<span class="ls0">ome <span class="_"> </span>subtle <span class="_"> </span>differ<span class="_ _0"></span>ences. <span class="_ _59"> </span>First,<span class="_ _46"> </span>whenever <span class="_"> </span>a <span class="_"> </span>memory <span class="_"> </span>str<span class="_ _0"></span>eam <span class="_"> </span>is <span class="_"> </span>opened <span class="_ _e"> </span>for</span></span></span></div><a class="l" href="#pfe" data-dest-detail='[14,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892634px;bottom:977.151043px;width:136.151695px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
