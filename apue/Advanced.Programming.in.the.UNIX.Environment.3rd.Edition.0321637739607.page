<div id="pf25f" class="pf w4 h1f" data-page-no="25f"><div class="pc pc25f w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg25f.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>15.9<span class="_ _24c"> </span>Shar<span class="_ _0"></span>ed <span class="_"> </span>Memory<span class="_ _1b"> </span><span class="ff18">573</span></div><div class="t m0 x3f h26 y12f ff19 fsf fc0 sc0 ls0 ws0">•<span class="_ _5c"> </span><span class="ff1a">shm_lpid</span>,<span class="_"> </span><span class="ff1a">shm_nattch</span>,<span class="_"> </span><span class="ff1a">shm_atime</span><span class="ls44">,a<span class="_ _5"></span><span class="ls0">nd<span class="_"> </span><span class="ff1a">shm_dtime<span class="_ _80"> </span></span>ar<span class="ls44">ea<span class="_ _d"></span><span class="ls0">ll set to 0.</span></span></span></span></div><div class="t m0 x3f h26 y95d ff19 fsf fc0 sc0 ls0 ws0">•<span class="_ _5c"> </span><span class="ff1a">shm_ctime<span class="_ _66"> </span></span>is set to the current time.</div><div class="t m0 x3f h26 y95e ff19 fsf fc0 sc0 ls0 ws0">•<span class="_ _5c"> </span><span class="ff1a">shm_segsz<span class="_ _66"> </span></span>is set to the<span class="_"> </span><span class="ff1b">size<span class="_"> </span></span><span class="ls45">re</span>quested.</div><div class="t m0 x3f h2b ya1f ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _50"> </span><span class="ff1b">size<span class="_ _5f"> </span></span>parameter <span class="_ _61"> </span>is <span class="_ _61"> </span>the <span class="_ _16"> </span>size <span class="_ _61"> </span>of <span class="_ _16"> </span>the <span class="_ _61"> </span>shared <span class="_ _61"> </span>memory <span class="_ _61"> </span>segment <span class="_ _16"> </span>in <span class="_ _61"> </span>bytes.</div><div class="t m0 x32 h2a ya20 ff19 fsf fc0 sc0 ls0 ws0">Implementations <span class="_ _2"></span>will <span class="_ _2"></span>usually <span class="_ _2"></span>round <span class="_ _2"></span>up <span class="_ _2"></span>this <span class="_ _3"></span>size <span class="_ _2"></span>to <span class="_ _2"></span>a <span class="_ _2"></span>multiple <span class="_ _3"></span>of <span class="_ _2"></span>the <span class="_ _2"></span>system’s <span class="_ _3"></span>page <span class="_ _2"></span>size,</div><div class="t m0 x32 h2b yd7d ff19 fsf fc0 sc0 ls0 ws0">but <span class="_ _e"> </span>if <span class="_ _e"> </span>an <span class="_ _e"> </span>application <span class="_ _e"> </span>speciﬁes<span class="_ _4b"> </span><span class="ff1b">size<span class="_ _59"> </span></span>as <span class="_ _e"> </span>a <span class="_ _e"> </span>value <span class="_ _e"> </span>other <span class="_ _e"> </span>than <span class="_"> </span>an <span class="_ _53"> </span>integral <span class="_ _e"> </span>multiple <span class="_ _e"> </span>of <span class="_ _e"> </span>the</div><div class="t m0 x32 h2a ya21 ff19 fsf fc0 sc0 ls0 ws0">system’s <span class="_ _3"></span>page <span class="_ _3"></span>size, <span class="_ _3"></span>the <span class="_ _9"></span>remainder <span class="_ _2"></span>of <span class="_ _3"></span>the <span class="_ _9"></span>last <span class="_ _3"></span>page <span class="_ _3"></span>will <span class="_ _3"></span>be <span class="_ _9"></span>unavailable <span class="_ _3"></span>for <span class="_ _3"></span>use.<span class="_ _16"> </span>If <span class="_ _3"></span>a <span class="_ _9"></span>new</div><div class="t m0 x32 h2b ya22 ff19 fsf fc0 sc0 ls0 ws0">segment <span class="_ _23"> </span>is <span class="_ _42"> </span>being <span class="_ _23"> </span>created <span class="_ _23"> </span>(typically <span class="_ _42"> </span>by <span class="_ _23"> </span>the <span class="_ _42"> </span>server), <span class="_ _42"> </span>we <span class="_ _23"> </span>must <span class="_ _42"> </span>specify <span class="_ _23"> </span>its<span class="_ _35"> </span><span class="ff1b">size</span><span class="ls1268">.I<span class="_ _7"></span><span class="ls0">f<span class="_ _44"> </span>we<span class="_ _35"> </span>a<span class="ls45">re</span></span></span></div><div class="t m0 x32 h2b yd7e ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">ferencing an existing segment (a client), we can specify<span class="_"> </span><span class="ff1b">size<span class="_"> </span></span>as 0.<span class="_ _46"> </span>When a new segment</span></div><div class="t m0 x32 h2a yd7f ff19 fsf fc0 sc0 ls0 ws0">is created, the contents of the segment ar<span class="_ _0"></span><span class="ls44">ei<span class="_ _d"></span><span class="ls0">nitialized with zeros.</span></span></div><div class="t m0 x3f h26 yd80 ff19 fsf fc0 sc0 ls0 ws0">The<span class="_"> </span><span class="ff1a">shmctl<span class="_ _80"> </span></span>function is the catchall for various shared memory operations.</div><div class="t m0 x3f h57 y454f ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;sys/shm.h&gt;</div><div class="t m0 x3f h57 y4550 ff1a fs2d fc0 sc0 ls0 ws0">int shmctl(int<span class="_"> </span><span class="ff1b">shmid</span><span class="ls15c">,i<span class="_ _1d"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">cmd</span><span class="ls15c">,s<span class="_ _5b"></span><span class="ls0">truct shmid_ds *<span class="ff1b">buf<span class="_ _42"> </span></span>);</span></span></span></span></div><div class="t m0 x153 h5f y4551 ff19 fs2d fc0 sc0 ls0 ws0">Returns: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x3f h4a y4552 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _45"> </span><span class="ff1b">cmd<span class="_ _35"> </span></span>ar<span class="_ _0"></span>gument <span class="_ _9"></span>speciﬁes <span class="_ _23"></span>one <span class="_ _9"></span>of <span class="_ _23"> </span>the <span class="_ _23"></span>following <span class="_ _9"></span>ﬁve <span class="_ _23"></span>commands <span class="_ _9"></span>to <span class="_ _23"></span>be <span class="_ _9"></span>performed,</div><div class="t m0 x32 h4a y4553 ff19 fs26 fc0 sc0 ls0 ws0">on the segment speciﬁed by<span class="_"> </span><span class="ff1b">shmid</span>.</div><div class="t m0 x3f h4d y4554 ff1a fs26 fc0 sc0 ls0 ws0">IPC_STAT<span class="_ _6e"> </span><span class="ff19">Fetch <span class="_ _45"> </span>the<span class="_ _16"> </span></span>shmid_ds<span class="_"> </span><span class="ff19">structur<span class="_ _0"></span><span class="ls1269">ef<span class="_ _26"></span><span class="ls0">or <span class="_ _45"> </span>this <span class="_ _45"> </span>segment, <span class="_ _45"> </span>storing <span class="_ _47"> </span>it <span class="_ _45"> </span>in <span class="_ _45"> </span>the</span></span></span></div><div class="t m0 x1e5 h4a y4555 ff19 fs26 fc0 sc0 ls0 ws0">structur<span class="_ _0"></span><span class="lsd3">ep<span class="_ _d"></span><span class="ls0">ointed to by<span class="_"> </span><span class="ff1b">buf</span>.</span></span></div><div class="t m0 x3f h4d y4556 ff1a fs26 fc0 sc0 ls0 ws0">IPC_SET<span class="_ _1b"> </span><span class="ff19">Set <span class="_ _23"></span>the <span class="_ _23"></span>following <span class="_ _23"> </span>three <span class="_ _23"></span>ﬁelds <span class="_ _23"></span>from <span class="_ _9"></span>the <span class="_ _23"> </span>structur<span class="ls126a">ep<span class="_ _43"></span><span class="ls0">ointed <span class="_ _23"> </span>to <span class="_ _23"> </span>by<span class="_ _35"> </span><span class="ff1b">buf<span class="_ _35"> </span></span>in</span></span></span></div><div class="t m0 x1e5 h4d y4557 ff19 fs26 fc0 sc0 ls0 ws0">the<span class="_"> </span><span class="ff1a">shmid_ds<span class="_ _66"> </span></span>structur<span class="ls126b">ea<span class="_ _4f"></span><span class="ls0">ssociated <span class="_ _2"></span>with <span class="_ _2"></span>this shared memory <span class="_ _2"></span>segment:</span></span></div><div class="t m0 x1e5 h4d y4558 ff1a fs26 fc0 sc0 ls0 ws0">shm_perm.uid<span class="ff19">,<span class="_ _3a"> </span></span>shm_perm.gid<span class="ff19 ls126c">,a<span class="_ _96"></span><span class="ls0">nd<span class="_ _3a"> </span><span class="ff1a">shm_perm.mode</span><span class="ls126d">.T<span class="_ _256"></span><span class="ls0">his</span></span></span></span></div><div class="t m0 x1e5 h49 y4559 ff19 fs26 fc0 sc0 ls0 ws0">command <span class="_ _9"></span>can <span class="_ _9"></span>be <span class="_ _23"></span>executed <span class="_ _9"></span>only <span class="_ _9"></span>by <span class="_ _23"></span>a <span class="_ _9"></span>process <span class="_ _9"></span>whose <span class="_ _9"></span>effective <span class="_ _9"></span>user <span class="_ _9"></span>ID</div><div class="t m0 x1e5 h4d y455a ff19 fs26 fc0 sc0 ls0 ws0">equals<span class="_ _16"> </span><span class="ff1a">shm_perm.cuid<span class="_"> </span></span>or<span class="_ _61"> </span><span class="ff1a">shm_perm.uid<span class="_"> </span></span>or <span class="_ _47"> </span>by <span class="_ _47"> </span>a <span class="_ _47"> </span>process <span class="_ _47"> </span>with</div><div class="t m0 x1e5 h49 y455b ff19 fs26 fc0 sc0 ls0 ws0">superuser privileges.</div><div class="t m0 x3f h4d y455c ff1a fs26 fc0 sc0 ls0 ws0">IPC_RMID<span class="_ _6e"> </span><span class="ff19">Remove <span class="_ _42"> </span>the <span class="_ _42"> </span>shar<span class="_ _0"></span>ed <span class="_ _42"> </span>memory <span class="_ _42"> </span>segment <span class="_ _42"> </span>set <span class="_ _23"> </span>from <span class="_ _42"> </span>the <span class="_ _42"> </span>system.<span class="_ _51"> </span>Since <span class="_ _42"> </span>an</span></div><div class="t m0 x1e5 h49 y455d ff19 fs26 fc0 sc0 ls0 ws0">attachment <span class="_"> </span>count <span class="_ _66"> </span>is <span class="_ _66"> </span>maintained <span class="_ _66"> </span>for <span class="_ _66"> </span>shared <span class="_"> </span>memory <span class="_ _66"> </span>segments <span class="_ _66"> </span>(the</div><div class="t m0 x1e5 h4d y455e ff1a fs26 fc0 sc0 ls0 ws0">shm_nattch<span class="_ _59"> </span><span class="ff19">ﬁeld <span class="_"> </span>in <span class="_ _e"> </span>the<span class="_ _59"> </span></span>shmid_ds<span class="_ _59"> </span><span class="ff19">structure), <span class="_ _e"> </span>the <span class="_"> </span>segment <span class="_ _e"> </span>is <span class="_"> </span>not</span></div><div class="t m0 x1e5 h49 y455f ff19 fs26 fc0 sc0 lscc ws0">re<span class="ls0">moved <span class="_ _44"> </span>until <span class="_ _35"> </span>the <span class="_ _35"> </span>last <span class="_ _35"> </span>process <span class="_ _35"> </span>using <span class="_ _35"> </span>the <span class="_ _35"> </span>segment <span class="_ _44"> </span>terminates <span class="_ _35"> </span>or</span></div><div class="t m0 x1e5 h49 y4560 ff19 fs26 fc0 sc0 ls0 ws0">detaches <span class="_"> </span>it.<span class="_ _48"> </span>Regardless <span class="_"> </span>of <span class="_"> </span>whether <span class="_ _e"> </span>the <span class="_"> </span>segment <span class="_"> </span>is <span class="_"> </span>still <span class="_"> </span>in <span class="_ _e"> </span>use, <span class="_"> </span>the</div><div class="t m0 x1e5 h4d y4561 ff19 fs26 fc0 sc0 ls0 ws0">segment’s <span class="_ _e"> </span>identiﬁer <span class="_ _e"> </span>is <span class="_ _e"> </span>immediately <span class="_ _e"> </span>removed <span class="_ _53"> </span>so <span class="_ _e"> </span>that<span class="_ _4b"> </span><span class="ff1a">shmat<span class="_ _59"> </span></span>can <span class="_ _53"> </span>no</div><div class="t m0 x1e5 h49 y4562 ff19 fs26 fc0 sc0 ls0 ws0">longer <span class="_ _9"></span>attach <span class="_ _3"></span>the <span class="_ _9"></span>segment.<span class="_ _5a"> </span>This <span class="_ _9"></span>command <span class="_ _9"></span>can <span class="_ _3"></span>be <span class="_ _9"></span>executed <span class="_ _9"></span>only <span class="_ _9"></span>by <span class="_ _9"></span>a</div><div class="t m0 x1e5 h4d y4563 ff19 fs26 fc0 sc0 ls0 ws0">process <span class="_ _65"> </span>whose <span class="_ _48"> </span>effective <span class="_ _65"> </span>user <span class="_ _48"> </span>ID <span class="_ _48"> </span>equals<span class="_ _7f"> </span><span class="ff1a">shm_perm.cuid<span class="_ _93"> </span></span>or</div><div class="t m0 x1e5 h4d y4564 ff1a fs26 fc0 sc0 ls0 ws0">shm_perm.uid<span class="_ _80"> </span><span class="ff19">or by a process with superuser privileges.</span></div><div class="t m0 x32 h49 y4565 ff19 fs26 fc0 sc0 lsf94 ws0">Tw<span class="_ _9"></span><span class="ls126e">oa<span class="_ _43"></span><span class="ls0">dditional <span class="_ _42"> </span>commands <span class="_ _23"></span>ar<span class="ls126e">ep<span class="_ _43"></span><span class="lscc">ro<span class="ls0">vided <span class="_ _23"> </span>by <span class="_ _23"> </span>Linux <span class="_ _42"> </span>and <span class="_ _23"></span>Solaris, <span class="_ _23"></span>but <span class="_ _23"></span>ar<span class="ls126f">en<span class="_ _43"></span><span class="ls0">ot <span class="_ _23"></span>part <span class="_ _23"> </span>of <span class="_ _23"> </span>the</span></span></span></span></span></span></span></div><div class="t m0 x32 h49 y4566 ff19 fs26 fc0 sc0 ls0 ws0">Single UNIX Speciﬁcation.</div><div class="t m0 x3f h4d y4567 ff1a fs26 fc0 sc0 ls0 ws0">SHM_LOCK<span class="_ _78"> </span><span class="ff19">Lock <span class="_ _9"></span>the <span class="_ _9"></span>shared <span class="_ _9"></span>memory <span class="_ _23"></span>segment <span class="_ _9"></span>in <span class="_ _9"></span>memory<span class="_ _6"></span><span class="ls1270">.T<span class="_ _26"></span><span class="ls0">his <span class="_ _23"></span>command <span class="_ _9"></span>can</span></span></span></div><div class="t m0 x38 h49 y4568 ff19 fs26 fc0 sc0 ls0 ws0">be executed only by the superuser<span class="_ _6"></span>.</div><div class="t m0 x3f h4d y4569 ff1a fs26 fc0 sc0 ls0 ws0">SHM_UNLOCK<span class="_ _6e"> </span><span class="ff19">Unlock <span class="_ _4b"> </span>the <span class="_ _4b"> </span>shared <span class="_ _44"> </span>memory <span class="_ _4b"> </span>segment.<span class="_ _93"> </span>This <span class="_ _4b"> </span>command <span class="_ _4b"> </span>can <span class="_ _4b"> </span>be</span></div><div class="t m0 x38 h49 y456a ff19 fs26 fc0 sc0 ls0 ws0">executed only by the superuser<span class="_ _6"></span>.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
