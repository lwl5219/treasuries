<div id="pf257" class="pf w4 h1f" data-page-no="257"><div class="pc pc257 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg257.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>15.8<span class="_ _e9"> </span>Semaphor<span class="_ _0"></span>es<span class="_ _1b"> </span><span class="ff18">565</span></div><div class="t m0 x35 h27 y12f ff16 fsf fc0 sc0 ls0 ws0">Example <span class="_ _84"></span>— <span class="_ _84"></span>Timing<span class="_"> </span>Comparison of Messa<span class="ls1233">ge Q</span>ueues and Full</div><div class="t m0 x104 h27 y5cc ff16 fsf fc0 sc0 ls0 ws0">-</div><div class="t m0 x181 h27 y12f ff16 fsf fc0 sc0 ls0 ws0">Duple<span class="ls12e">xP<span class="_ _8"></span><span class="ls0">ipes</span></span></div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">If <span class="_ _3"></span>we <span class="_ _3"></span>need <span class="_ _9"></span>a <span class="_ _3"></span>bidirectional <span class="_ _3"></span>ﬂow <span class="_ _3"></span>of <span class="_ _9"></span>data <span class="_ _3"></span>between <span class="_ _3"></span>a <span class="_ _9"></span>client <span class="_ _3"></span>and <span class="_ _3"></span>a <span class="_ _9"></span>server<span class="_ _6"></span>,<span class="_ _45"> </span>we<span class="_ _47"> </span>can <span class="_ _3"></span>use <span class="_ _9"></span>either</div><div class="t m0 x32 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">message queues or <span class="_ _2"></span>full-duplex pipes.<span class="_ _46"> </span>(Recall <span class="_ _2"></span>from Figur<span class="lsb18">e1<span class="_ _4f"></span><span class="ls0">5.1 that full-duplex <span class="_ _2"></span>pipes are</span></span></div><div class="t m0 x32 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">available <span class="_ _23"></span>thr<span class="_ _0"></span>ough <span class="_ _23"></span>the <span class="_ _9"></span>UNIX <span class="_ _23"> </span>domain <span class="_ _23"></span>sockets <span class="_ _9"></span>mechanism <span class="_ _23"> </span>[Section <span class="_ _23"></span>17.2], <span class="_ _23"></span>although <span class="_ _9"></span>some</div><div class="t m0 x32 h26 y134 ff19 fsf fc0 sc0 ls0 ws0">platforms provide a full-duplex pipe mechanism thr<span class="_ _0"></span>ough the<span class="_"> </span><span class="ff1a">pipe<span class="_ _80"> </span></span>function.)</div><div class="t m0 x3f h2a y135 ff19 fsf fc0 sc0 ls0 ws0">Figur<span class="ls110b">e1<span class="_ _55"></span><span class="ls0">5.27 <span class="_ _53"> </span>shows <span class="_ _53"> </span>a <span class="_ _53"> </span>timing <span class="_ _e"> </span>comparison <span class="_ _53"> </span>of <span class="_ _53"> </span>three <span class="_ _42"> </span>of <span class="_ _e"> </span>these <span class="_ _53"> </span>techniques <span class="_ _53"> </span>on <span class="_ _53"> </span>Solaris:</span></span></div><div class="t m0 x32 h2a y136 ff19 fsf fc0 sc0 ls0 ws0">message <span class="_ _23"> </span>queues, <span class="_ _42"> </span>full-duplex</div><div class="t m0 x186 h2a y5ce ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 x11b h2a y136 ff19 fsf fc0 sc0 ls0 ws0">STREAMS</div><div class="t m0 x222 h2a y5ce ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 x12e h2a y136 ff19 fsf fc0 sc0 ls0 ws0">pipes, <span class="_ _23"> </span>and <span class="_ _42"> </span>UNIX <span class="_ _23"> </span>domain <span class="_ _42"> </span>sockets.<span class="_ _51"> </span>The <span class="_ _23"> </span>tests</div><div class="t m0 x32 h26 y137 ff19 fsf fc0 sc0 ls0 ws0">consisted <span class="_ _9"></span>of <span class="_ _9"></span>a <span class="_ _9"></span>program <span class="_ _3"></span>that <span class="_ _9"></span>created <span class="_ _9"></span>the <span class="_ _9"></span>IPC <span class="_ _9"></span>channel, <span class="_ _9"></span>called<span class="_ _45"> </span><span class="ff1a">fork</span><span class="lsf6a">,a<span class="_ _b"></span><span class="ls0">nd <span class="_ _9"></span>then <span class="_ _9"></span>sent <span class="_ _9"></span>about</span></span></div><div class="t m0 x32 h2a y138 ff19 fsf fc0 sc0 ls0 ws0">200 <span class="_ _23"> </span>megabytes <span class="_ _23"> </span>of <span class="_ _23"> </span>data <span class="_ _42"> </span>from <span class="_ _23"></span>the <span class="_ _23"></span>parent <span class="_ _9"></span>to <span class="_ _42"> </span>the <span class="_ _23"></span>child.<span class="_ _51"> </span>The <span class="_ _23"> </span>data <span class="_ _23"> </span>was <span class="_ _42"> </span>sent <span class="_ _23"> </span>using <span class="_ _23"> </span>100,000</div><div class="t m0 x32 h26 y139 ff19 fsf fc0 sc0 ls0 ws0">calls <span class="_"> </span>to<span class="_ _4b"> </span><span class="ff1a">msgsnd</span><span class="ls1234">,w<span class="_ _55"></span><span class="ls0">ith <span class="_ _e"> </span>a <span class="_"> </span>message <span class="_ _e"> </span>length <span class="_"> </span>of <span class="_ _e"> </span>2,000 <span class="_"> </span>bytes <span class="_ _e"> </span>for <span class="_"> </span>the <span class="_ _e"> </span>message <span class="_"> </span>queue, <span class="_"> </span>and</span></span></div><div class="t m0 x32 h26 y13a ff19 fsf fc0 sc0 ls0 ws0">100,000 <span class="_ _9"></span>calls <span class="_ _9"></span>to<span class="_ _45"> </span><span class="ff1a">write</span><span class="ls4e4">,w<span class="_ _b"></span><span class="ls0">ith <span class="_ _3"></span>a <span class="_ _9"></span>length <span class="_ _9"></span>of <span class="_ _9"></span>2,000 <span class="_ _9"></span>bytes <span class="_ _9"></span>for <span class="_ _9"></span>the <span class="_ _9"></span>full-duplex <span class="_ _9"></span>pipe <span class="_ _9"></span>and <span class="_ _9"></span>UNIX</span></span></div><div class="t m0 x32 h2a y254 ff19 fsf fc0 sc0 ls0 ws0">domain socket.<span class="_ _59"> </span>The times ar<span class="ls44">ea<span class="_ _d"></span><span class="ls0">ll in seconds.</span></span></div><div class="t m0 x1d2 h2d y4465 ff19 fs10 fc0 sc0 ls0 ws0">Operation <span class="_ _1eb"> </span>User<span class="_ _87"> </span>System <span class="_ _6d"> </span>Clock</div><div class="t m0 x134 h2e y4466 ff19 fs11 fc0 sc0 ls0 ws0">message queue<span class="_ _13b"> </span>0.58 <span class="_ _15"> </span>4.16 <span class="_ _2a8"> </span>5.09</div><div class="t m0 x134 h2e y4467 ff19 fs11 fc0 sc0 ls0 ws0">full-duplex pipe<span class="_ _1c7"> </span>0.61 <span class="_ _15"> </span>4.30 <span class="_ _2a8"> </span>5.24</div><div class="t m0 x134 h2e y4468 ff19 fs11 fc0 sc0 ls0 ws0">UNIX domain socket<span class="_ _1fb"> </span>0.59 <span class="_ _15"> </span>5.58 <span class="_ _15"> </span>7.49</div><div class="t m0 xda h2f y4469 ff18 fs12 fc0 sc0 ls0 ws0">Figure 15.27<span class="_ _5a"> </span><span class="ff19 ls3b5">Ti<span class="_ _3"></span><span class="ls0">ming comparison of IPC alternatives on Solaris</span></span></div><div class="t m0 x3f h50 y446a ff19 fs29 fc0 sc0 ls0 ws0">These <span class="_ _23"> </span>numbers <span class="_ _42"> </span>show <span class="_ _23"> </span>us <span class="_ _42"> </span>that <span class="_ _23"> </span>message <span class="_ _42"> </span>queues, <span class="_ _23"> </span>originally <span class="_ _42"> </span>implemented <span class="_ _23"> </span>to <span class="_ _42"> </span>provide</div><div class="t m0 x32 h50 y446b ff19 fs29 fc0 sc0 ls0 ws0">higher-than-normal-speed <span class="_ _2"></span>IPC, <span class="_ _9"></span>are<span class="_ _66"> </span>no<span class="_ _45"> </span>longer <span class="_ _3"></span>that <span class="_ _3"></span>much <span class="_ _3"></span>faster <span class="_ _9"></span>than <span class="_ _3"></span>other <span class="_ _3"></span>forms <span class="_ _9"></span>of <span class="_ _3"></span>IPC.</div><div class="t m0 x32 h50 y446c ff19 fs29 fc0 sc0 ls0 ws0">(When <span class="_ _23"> </span>message <span class="_ _42"> </span>queues <span class="_ _42"> </span>wer<span class="ls1235">ei<span class="_ _c"></span><span class="ls0">mplemented, <span class="_ _42"> </span>the <span class="_ _42"> </span>only <span class="_ _23"> </span>other <span class="_ _42"> </span>form <span class="_ _42"> </span>of <span class="_ _23"> </span>IPC <span class="_ _42"> </span>available <span class="_ _42"> </span>was</span></span></div><div class="t m0 x32 h50 y446d ff19 fs29 fc0 sc0 ls0 ws0">half-duplex <span class="_ _4b"> </span>pipes.)<span class="_ _7f"> </span>When <span class="_ _59"> </span>we <span class="_ _4b"> </span>consider <span class="_ _59"> </span>the <span class="_ _4b"> </span>problems <span class="_ _4b"> </span>in <span class="_ _59"> </span>using <span class="_ _59"> </span>message <span class="_ _4b"> </span>queues</div><div class="t m0 x32 h50 y446e ff19 fs29 fc0 sc0 ls0 ws0">(Section <span class="_ _45"> </span>15.6.4), <span class="_ _47"> </span>we <span class="_ _45"> </span>come <span class="_ _47"> </span>to <span class="_ _45"> </span>the <span class="_ _45"> </span>conclusion <span class="_ _47"> </span>that <span class="_ _45"> </span>we <span class="_ _45"> </span>shouldn’t <span class="_ _47"> </span>use <span class="_ _45"> </span>them <span class="_ _47"> </span>for <span class="_ _45"> </span>new</div><div class="t m0 x32 h50 y446f ff19 fs29 fc0 sc0 ls0 ws0">applications.</div><div class="t m0 x35 h78 yd70 ff16 fs3a fc0 sc0 ls0 ws0">15.8 <span class="_ _93"> </span>Semaphores</div><div class="t m0 x32 h6e yd72 ff19 fs31 fc0 sc0 ls1236 ws0">As<span class="_ _55"></span><span class="ls0">emaphor<span class="ls1236">ei<span class="_ _4a"></span><span class="ls0">sn’t <span class="_ _e"> </span>a <span class="_"> </span>form <span class="_ _53"> </span>of <span class="_"> </span>IPC <span class="_ _53"> </span>similar <span class="_"> </span>to <span class="_ _e"> </span>the <span class="_ _e"> </span>others <span class="_"> </span>that <span class="_ _53"> </span>we’ve <span class="_"> </span>described <span class="_ _53"> </span>(pipes,</span></span></span></div><div class="t m0 x32 h6e y4470 ff19 fs31 fc0 sc0 ls0 ws0">FIFOs, <span class="_ _42"> </span>and <span class="_ _53"> </span>message <span class="_ _42"> </span>queues).<span class="_ _65"> </span><span class="ls1237">As<span class="_ _c"></span><span class="ls0">emaphore<span class="_ _44"> </span>is<span class="_ _44"> </span>a<span class="_ _44"> </span>counter <span class="_ _53"> </span>used <span class="_ _42"> </span>to <span class="_ _53"> </span>provide <span class="_ _42"> </span>access <span class="_ _53"> </span>to <span class="_ _42"> </span>a</span></span></div><div class="t m0 x32 h6e y4471 ff19 fs31 fc0 sc0 ls0 ws0">shared data object for multiple pr<span class="_ _0"></span>ocesses.</div><div class="t m0 x76 h30 y4472 ff19 fs13 fc0 sc0 ls0 ws0">The <span class="_ _23"> </span>Single <span class="_ _9"> </span>UNIX <span class="_ _23"> </span>Speciﬁcation <span class="_ _23"> </span>includes <span class="_ _23"> </span>an <span class="_ _23"> </span>alternative <span class="_ _9"> </span>set <span class="_ _23"> </span>of <span class="_ _23"> </span>semaphor<span class="ls1238">ei<span class="_ _b"></span><span class="ls0">nterfaces <span class="_ _23"> </span>that <span class="_ _23"> </span>were</span></span></div><div class="t m0 x76 h30 y4473 ff19 fs13 fc0 sc0 ls0 ws0">originally part of its real-time extensions.<span class="_ _35"> </span><span class="ls9b5">We <span class="_ _42"> </span>d<span class="_ _3"></span></span>iscuss these interfaces in Section 15.10.</div><div class="t m0 x32 h6e y4474 ff19 fs31 fc0 sc0 ls43f ws0">To <span class="_ _53"> </span>o<span class="_ _9"></span><span class="ls0">btain a shared resour<span class="_ _1"></span>ce, a process needs to do the following:</span></div><div class="t m0 x3f h6e y4475 ff19 fs31 fc0 sc0 ls0 ws0">1. <span class="_ _51"> </span>T<span class="_ _6"></span>est the semaphor<span class="ls229">et<span class="_ _4f"></span><span class="ls0">hat controls the resour<span class="_ _0"></span>ce.</span></span></div><div class="t m0 x3f h6e y4476 ff19 fs31 fc0 sc0 ls0 ws0">2. <span class="_ _51"> </span>If<span class="_ _35"> </span>the <span class="_ _23"></span>value <span class="_ _23"></span>of <span class="_ _23"></span>the <span class="_ _23"></span>semaphore<span class="_ _45"> </span>is<span class="_ _35"> </span>positive, <span class="_ _23"> </span>the <span class="_ _23"> </span>process <span class="_ _23"></span>can <span class="_ _23"></span>use <span class="_ _23"></span>the <span class="_ _23"></span>resour<span class="_ _0"></span>ce. <span class="_ _45"> </span>In</div><div class="t m0 x41 h6e y4477 ff19 fs31 fc0 sc0 ls0 ws0">this <span class="_ _23"> </span>case, <span class="_ _42"> </span>the <span class="_ _42"> </span>process <span class="_ _23"></span>decrements <span class="_ _23"> </span>the <span class="_ _42"> </span>semaphor<span class="_ _0"></span><span class="ls1239">ev<span class="_ _43"></span><span class="ls0">alue <span class="_ _23"> </span>by <span class="_ _42"> </span>1, <span class="_ _42"> </span>indicating <span class="_ _23"> </span>that <span class="_ _42"> </span>it</span></span></div><div class="t m0 x41 h6e y4478 ff19 fs31 fc0 sc0 ls0 ws0">has used one unit of the resour<span class="_ _0"></span>ce.</div><div class="t m0 x3f h6e y4479 ff19 fs31 fc0 sc0 ls0 ws0">3. <span class="_ _51"> </span>Otherwise,<span class="_ _47"> </span>if <span class="_ _2"></span>the <span class="_ _2"></span>value <span class="_ _3"></span>of <span class="_ _3"></span>the <span class="_ _2"></span>semaphore<span class="_ _66"> </span>is<span class="_ _47"> </span>0,<span class="_ _47"> </span>the <span class="_ _2"></span>process <span class="_ _2"></span>goes <span class="_ _3"></span>to <span class="_ _2"></span>sleep <span class="_ _3"></span>until <span class="_ _2"></span>the</div><div class="t m0 x41 h6e y447a ff19 fs31 fc0 sc0 ls0 ws0">semaphor<span class="ls123a">ev<span class="_ _c"></span><span class="ls0">alue <span class="_ _42"> </span>is <span class="_ _42"> </span>greater <span class="_ _23"> </span>than <span class="_ _42"> </span>0.<span class="_ _54"> </span>When <span class="_ _42"> </span>the <span class="_ _42"> </span>process <span class="_ _23"> </span>wakes <span class="_ _42"> </span>up, <span class="_ _42"> </span>it <span class="_ _42"> </span>returns <span class="_ _23"> </span>to</span></span></div><div class="t m0 x41 h6e y447b ff19 fs31 fc0 sc0 ls0 ws0">step 1.</div><a class="l" href="#pf12" data-dest-detail='[18,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.893467px;bottom:513.053095px;width:108.024300px;height:19.679992px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
