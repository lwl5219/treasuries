<div id="pfd1" class="pf w4 h1f" data-page-no="d1"><div class="pc pcd1 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bgd1.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Chapter <span class="_"> </span>5<span class="_ _1c8"> </span>Exercises<span class="_ _1b"> </span><span class="ff18">175</span></div><div class="t m0 x32 h2b y12f ff19 fsf fc0 sc0 ls0 ws0">Section <span class="_ _42"> </span>7.8).<span class="_ _51"> </span>As <span class="_ _42"> </span>with <span class="_ _42"> </span>the<span class="_ _44"> </span><span class="ff1b">sﬁo<span class="_ _44"> </span></span>package, <span class="_ _42"> </span>ASI <span class="_ _42"> </span>attempts <span class="_ _23"> </span>to <span class="_ _42"> </span>minimize <span class="_ _42"> </span>the <span class="_ _42"> </span>amount <span class="_ _42"> </span>of <span class="_ _42"> </span>data</div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">copying by using pointers.</div><div class="t m0 x3f h2a y131 ff19 fsf fc0 sc0 ls0 ws0">Several <span class="_ _2"></span>implementations <span class="_ _2"></span>of <span class="_ _2"></span>the standar<span class="ls757">dI<span class="_ _4f"></span><span class="ls0">/O <span class="_ _2"></span>library <span class="_ _2"></span>ar<span class="ls757">ea<span class="_ _4f"></span><span class="ls0">vailable <span class="_ _2"></span>in <span class="_ _2"></span>C <span class="_ _2"></span>libraries <span class="_ _2"></span>that</span></span></span></span></div><div class="t m0 x32 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">wer<span class="ls758">ed<span class="_ _b"></span><span class="ls0">esigned <span class="_ _3"></span>for <span class="_ _23"></span>systems <span class="_ _9"></span>with <span class="_ _9"></span>small <span class="_ _9"></span>memory <span class="_ _23"></span>footprints, <span class="_ _9"></span>such <span class="_ _9"></span>as <span class="_ _9"></span>embedded <span class="_ _23"></span>systems.</span></span></div><div class="t m0 x32 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">These <span class="_ _35"> </span>implementations <span class="_ _44"> </span>emphasize <span class="_ _35"> </span>modest <span class="_ _44"> </span>memory <span class="_ _35"> </span>requirements <span class="_ _35"> </span>over <span class="_ _35"> </span>portability<span class="_ _6"></span>,</div><div class="t m0 x32 h2a y134 ff19 fsf fc0 sc0 ls0 ws0">speed, <span class="_ _45"> </span>or <span class="_ _35"> </span>functionality<span class="_ _4"></span><span class="ls759">.T<span class="_ _184"></span><span class="ls0">wo <span class="_ _45"> </span>such <span class="_ _35"> </span>implementations <span class="_ _45"> </span>ar<span class="ls75a">et<span class="_ _26"></span><span class="ls0">he <span class="_ _45"> </span>uClibc <span class="_ _35"> </span>C <span class="_ _45"> </span>library <span class="_ _45"> </span>(see</span></span></span></span></div><div class="t m0 x32 h26 y135 ff1a fsf fc0 sc0 ls0 ws0">http://www.uclibc.org<span class="_ _98"> </span><span class="ff19">for <span class="_ _51"> </span>mor<span class="ls75b">ei<span class="_ _4d"></span><span class="ls0">nformation) <span class="_ _51"> </span>and <span class="_ _54"> </span>the <span class="_ _51"> </span>Newlib <span class="_ _54"> </span>C <span class="_ _54"> </span>library</span></span></span></div><div class="t m0 x32 h26 y136 ff19 fsf fc0 sc0 ls0 ws0">(<span class="ff1a">http://sources.redhat.com/newlib</span>).</div><div class="t m0 x35 h53 y139 ff16 fs2b fc0 sc0 ls0 ws0">5.16 <span class="_ _93"> </span>Summary</div><div class="t m0 x32 h2a y68e ff19 fsf fc0 sc0 ls0 ws0">The standar<span class="ls21c">dI<span class="_ _4f"></span><span class="ls0">/O <span class="_ _2"></span>library is <span class="_ _2"></span>used by <span class="_ _2"></span>most UNIX applications.<span class="_ _61"> </span>In this <span class="_ _2"></span>chapter<span class="_ _6"></span>,<span class="_ _66"> </span>we<span class="_ _66"> </span>looked</span></span></div><div class="t m0 x32 h2a y68f ff19 fsf fc0 sc0 ls0 ws0">at <span class="_ _23"> </span>many <span class="_ _42"> </span>of <span class="_ _23"></span>the <span class="_ _23"> </span>functions <span class="_ _42"> </span>provided <span class="_ _23"></span>by <span class="_ _23"></span>this <span class="_ _23"> </span>library<span class="_ _6"></span>,<span class="_ _35"> </span>as<span class="_ _35"> </span>well <span class="_ _23"> </span>as <span class="_ _42"> </span>at <span class="_ _23"> </span>some <span class="_ _42"> </span>implementation</div><div class="t m0 x32 h2a y690 ff19 fsf fc0 sc0 ls0 ws0">details <span class="_ _23"> </span>and <span class="_ _42"> </span>efﬁciency <span class="_ _23"> </span>considerations.<span class="_ _54"> </span>Be <span class="_ _42"> </span>aware<span class="_ _35"> </span>of<span class="_ _35"> </span>the <span class="_ _42"> </span>buffering <span class="_ _23"></span>that <span class="_ _23"> </span>takes <span class="_ _42"> </span>place <span class="_ _42"> </span>with</div><div class="t m0 x32 h2a y691 ff19 fsf fc0 sc0 ls0 ws0">this library<span class="_ _4"></span>,<span class="_"> </span>as<span class="_"> </span>this is the area that generates the most problems and confusion.</div><div class="t m0 x32 h53 y665 ff16 fs2b fc0 sc0 ls0 ws0">Exer<span class="_ _0"></span>cises</div><div class="t m0 x32 h57 y180d ff18 fs2d fc0 sc0 ls0 ws0">5.1<span class="_ _6e"> </span><span class="ff19">Implement<span class="_"> </span><span class="ff1a">setbuf<span class="_ _80"> </span></span>using<span class="_"> </span><span class="ff1a">setvbuf</span>.</span></div><div class="t m0 x32 h57 y180e ff18 fs2d fc0 sc0 ls0 ws0">5.2<span class="_ _6e"> </span><span class="ff19 ls75c">Ty<span class="_ _9"></span><span class="ls0">pe <span class="_ _23"> </span>in <span class="_ _23"> </span>the <span class="_ _42"> </span>program <span class="_ _9"></span>that <span class="_ _23"> </span>copies <span class="_ _42"> </span>a <span class="_ _23"> </span>ﬁle <span class="_ _23"> </span>using <span class="_ _23"> </span>line-at-a-time <span class="_ _23"> </span>I/O <span class="_ _23"> </span>(<span class="ff1a">fgets<span class="_ _45"> </span></span>and<span class="_ _35"> </span><span class="ff1a">fputs</span><span class="ls75d">)f<span class="_ _b"></span><span class="ls1e7">ro<span class="ls0">m</span></span></span></span></span></div><div class="t m0 x90 h57 y180f ff19 fs2d fc0 sc0 ls0 ws0">Figur<span class="ls75e">e5<span class="_ _d"></span><span class="ls0">.5, but <span class="_ _2"></span>use a<span class="_ _80"> </span><span class="ff1a">MAXLINE<span class="_ _80"> </span></span>of <span class="_ _2"></span>4.<span class="_ _4b"> </span>What <span class="_ _2"></span>happens if you <span class="_ _2"></span>copy lines <span class="_ _2"></span>that exceed this <span class="_ _2"></span>length?</span></span></div><div class="t m0 x90 h5f y1810 ff19 fs2d fc0 sc0 ls0 ws0">Explain what is happening.</div><div class="t m0 x32 h57 y1811 ff18 fs2d fc0 sc0 ls0 ws0">5.3<span class="_ _6e"> </span><span class="ff19">What does a return value of 0 from<span class="_"> </span><span class="ff1a">printf<span class="_ _e"> </span></span>mean?</span></div><div class="t m0 x32 h5f y1812 ff18 fs2d fc0 sc0 ls0 ws0">5.4<span class="_ _6e"> </span><span class="ff19">The <span class="_ _23"></span>following <span class="_ _9"></span>code <span class="_ _9"></span>works <span class="_ _9"></span>correctly <span class="_ _9"></span>on <span class="_ _9"></span>some <span class="_ _23"></span>machines, <span class="_ _9"></span>but <span class="_ _9"></span>not <span class="_ _9"></span>on <span class="_ _23"></span>others.<span class="_ _61"> </span>What <span class="_ _9"></span>could <span class="_ _9"></span>be</span></div><div class="t m0 x90 h5f y1813 ff19 fs2d fc0 sc0 ls0 ws0">the problem?</div><div class="t m0 x138 h57 y1814 ff1a fs2d fc0 sc0 ls0 ws0">#include <span class="_ _68"> </span>&lt;stdio.h&gt;</div><div class="t m0 x138 h57 y1815 ff1a fs2d fc0 sc0 ls0 ws0">int</div><div class="t m0 x138 h57 y1816 ff1a fs2d fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 x138 h57 y1817 ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x1d h57 y1818 ff1a fs2d fc0 sc0 ls0 ws0">char <span class="_ _68"> </span>c;</div><div class="t m0 x1d h57 y1819 ff1a fs2d fc0 sc0 ls0 ws0">while ((c = getchar()) != EOF)</div><div class="t m0 x1b h57 y181a ff1a fs2d fc0 sc0 ls0 ws0">putchar(c);</div><div class="t m0 x138 h57 y181b ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h57 y181c ff18 fs2d fc0 sc0 ls0 ws0">5.5<span class="_ _6e"> </span><span class="ff19">How would you use the<span class="_"> </span><span class="ff1a">fsync<span class="_ _80"> </span></span>function (Section 3.13) with a standar<span class="ls110">dI<span class="_ _5"></span><span class="ls0">/O stream?</span></span></span></div><div class="t m0 x32 h5f y181d ff18 fs2d fc0 sc0 ls0 ws0">5.6<span class="_ _6e"> </span><span class="ff19">In <span class="_"> </span>the <span class="_ _42"> </span>programs <span class="_ _42"> </span>in <span class="_"> </span>Figur<span class="_ _0"></span>es <span class="_ _53"> </span>1.7 <span class="_ _53"> </span>and <span class="_ _53"> </span>1.10, <span class="_ _53"> </span>the <span class="_"> </span>pr<span class="_ _1"></span>ompt <span class="_"> </span>that <span class="_ _42"> </span>is <span class="_"> </span>printed <span class="_ _42"> </span>does <span class="_ _53"> </span>not <span class="_ _53"> </span>contain <span class="_"> </span>a</span></div><div class="t m0 x90 h57 y181e ff19 fs2d fc0 sc0 ls0 ws0">newline, and we don’t call<span class="_"> </span><span class="ff1a">fflush</span><span class="ls614">.W<span class="_ _55"></span><span class="ls0">hat causes the prompt to be output?</span></span></div><div class="t m0 x32 h5f y181f ff18 fs2d fc0 sc0 ls0 ws0">5.7<span class="_ _6e"> </span><span class="ff19">BSD</span></div><div class="t m0 x167 h5f y1820 ff19 fs2d fc0 sc0 ls0 ws0">-</div><div class="t m0 x9d h57 y181f ff19 fs2d fc0 sc0 ls0 ws0">based <span class="_ _42"> </span>systems <span class="_ _53"> </span>provide <span class="_ _42"> </span>a <span class="_ _42"> </span>function <span class="_ _53"> </span>called<span class="_ _44"> </span><span class="ff1a">funopen<span class="_ _35"> </span></span>that <span class="_ _42"> </span>allows <span class="_ _53"> </span>us <span class="_ _53"> </span>to <span class="_ _42"> </span>intercept <span class="_ _42"> </span>read,</div><div class="t m0 x90 h57 y1821 ff19 fs2d fc0 sc0 ls0 ws0">write, <span class="_ _42"> </span>seek, <span class="_"> </span>and <span class="_ _42"> </span>close <span class="_ _42"> </span>calls <span class="_"> </span>on <span class="_ _42"> </span>a <span class="_ _42"> </span>stream. <span class="_ _44"> </span>Use<span class="_ _35"> </span>this <span class="_ _53"> </span>function <span class="_ _53"> </span>to <span class="_ _53"> </span>implement<span class="_ _35"> </span><span class="ff1a">fmemopen<span class="_ _44"> </span></span>for</div><div class="t m0 x90 h5f y1822 ff19 fs2d fc0 sc0 ls0 ws0">FreeBSD and Mac OS X.</div><a class="l" href="#pfe" data-dest-detail='[14,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.893259px;bottom:984.288916px;width:90.804398px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="http://www.uclibc.org"><div class="d m1" style="border-style:none;position:absolute;left:156.492009px;bottom:1088.621130px;width:125.998001px;height:14.979980px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="http://sources.redhat.com/newlib"><div class="d m1" style="border-style:none;position:absolute;left:161.756686px;bottom:1066.644574px;width:194.593994px;height:10.135010px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
