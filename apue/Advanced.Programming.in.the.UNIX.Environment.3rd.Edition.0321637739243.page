<div id="pff3" class="pf w4 h1f" data-page-no="f3"><div class="pc pcf3 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bgf3.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>7.8<span class="_ _20f"> </span>Memory <span class="_"> </span>Allocation<span class="_ _1b"> </span><span class="ff18">209</span></div><div class="t m0 x32 h2a y12f ff19 fsf fc0 sc0 ls0 ws0">objects. <span class="_ _44"> </span>These<span class="_ _44"> </span>objects <span class="_ _42"> </span>can <span class="_ _53"> </span>be <span class="_ _42"> </span>unrelated <span class="_ _42"> </span>to <span class="_ _42"> </span>the <span class="_ _53"> </span>code <span class="_ _42"> </span>corrupting <span class="_ _53"> </span>them, <span class="_ _42"> </span>making <span class="_ _53"> </span>it <span class="_ _42"> </span>even</div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">mor<span class="ls44">ed<span class="_ _4f"></span><span class="ls0">ifﬁcult to ﬁnd the source of the corr<span class="_ _0"></span>uption.</span></span></div><div class="t m0 x3f h2a y131 ff19 fsf fc0 sc0 ls0 ws0">Other possible <span class="_ _2"></span>errors that <span class="_ _2"></span>can <span class="_ _2"></span>be fatal <span class="_ _2"></span>ar<span class="ls88c">ef<span class="_ _4f"></span><span class="ls45">re<span class="_ _2"></span><span class="ls0">eing a <span class="_ _2"></span>block <span class="_ _2"></span>that <span class="_ _2"></span>was already <span class="_ _2"></span>freed and</span></span></span></div><div class="t m0 x32 h26 y132 ff19 fsf fc0 sc0 ls0 ws0">calling<span class="_ _16"> </span><span class="ff1a">free<span class="_ _16"> </span></span>with <span class="_ _47"> </span>a <span class="_ _47"> </span>pointer <span class="_ _45"> </span>that <span class="_ _47"> </span>was <span class="_ _47"> </span>not <span class="_ _47"> </span>obtained <span class="_ _47"> </span>from <span class="_ _47"> </span>one <span class="_ _47"> </span>of <span class="_ _45"> </span>the <span class="_ _47"> </span>three<span class="_ _61"> </span><span class="ff1a">alloc</span></div><div class="t m0 x32 h26 y133 ff19 fsf fc0 sc0 ls0 ws0">functions. <span class="_ _44"> </span>If<span class="_ _35"> </span><span class="ls486">ap<span class="_ _43"></span><span class="ls45">ro<span class="ls0">cess <span class="_ _53"> </span>calls<span class="_ _44"> </span><span class="ff1a">malloc<span class="_ _35"> </span></span>but <span class="_ _53"> </span>forgets <span class="_ _23"> </span>to <span class="_ _53"> </span>call<span class="_ _44"> </span><span class="ff1a">free</span><span class="ls88d">,i<span class="_ _c"></span><span class="ls0">ts <span class="_ _53"> </span>memory <span class="_ _42"> </span>usage <span class="_ _42"> </span>will</span></span></span></span></span></div><div class="t m0 x32 h26 y134 ff19 fsf fc0 sc0 ls0 ws0">continually <span class="_ _42"> </span>increase; <span class="_ _42"> </span>this <span class="_ _53"> </span>is <span class="_ _42"> </span>called <span class="_ _53"> </span>leakage.<span class="_ _54"> </span>If <span class="_ _53"> </span>we <span class="_ _53"> </span>do <span class="_ _42"> </span>not <span class="_ _53"> </span>call<span class="_ _44"> </span><span class="ff1a">free<span class="_ _44"> </span></span>to <span class="_ _53"> </span>return <span class="_ _42"> </span>unused</div><div class="t m0 x32 h2a y135 ff19 fsf fc0 sc0 ls0 ws0">space, the size of a process’s addr<span class="_ _0"></span>ess space will slowly increase until no fr<span class="_ _0"></span>ee space is left.</div><div class="t m0 x32 h2a y136 ff19 fsf fc0 sc0 ls0 ws0">During this time, performance can degrade from excess paging over<span class="_ _0"></span>head.</div><div class="t m0 x3f h2a y137 ff19 fsf fc0 sc0 ls0 ws0">Because memory <span class="_ _2"></span>allocation errors ar<span class="ls88e">ed<span class="_ _4f"></span><span class="ls0">ifﬁcult to <span class="_ _2"></span>track down, <span class="_ _2"></span>some systems <span class="_ _2"></span>provide</span></span></div><div class="t m0 x32 h2a y138 ff19 fsf fc0 sc0 ls0 ws0">versions <span class="_ _2"></span>of <span class="_ _2"></span>these <span class="_ _2"></span>functions that <span class="_ _2"></span>do <span class="_ _2"></span>additional <span class="_ _2"></span>error <span class="_ _2"></span>checking <span class="_ _2"></span>every <span class="_ _2"></span>time <span class="_ _2"></span>one <span class="_ _2"></span>of <span class="_ _2"></span>the <span class="_ _2"></span>three</div><div class="t m0 x32 h26 y139 ff1a fsf fc0 sc0 ls0 ws0">alloc<span class="_ _45"> </span><span class="ff19">functions <span class="_ _9"></span>or<span class="_ _45"> </span></span>free<span class="_ _45"> </span><span class="ff19">is <span class="_ _23"></span>called.<span class="_ _5a"> </span>These <span class="_ _9"></span>versions <span class="_ _9"></span>of <span class="_ _9"></span>the <span class="_ _23"></span>functions <span class="_ _9"></span>ar<span class="ls88f">eo<span class="_ _b"></span><span class="ls0">ften <span class="_ _9"></span>speciﬁed</span></span></span></div><div class="t m0 x32 h2a y13a ff19 fsf fc0 sc0 ls0 ws0">by <span class="_"> </span>including <span class="_"> </span>a <span class="_"> </span>special <span class="_"> </span>library <span class="_ _e"> </span>for <span class="_"> </span>the <span class="_"> </span>link <span class="_"> </span>editor<span class="_ _6"></span><span class="ls890">.T<span class="_ _5d"></span><span class="ls0">her<span class="ls891">ea<span class="_ _4a"></span><span class="ls45">re <span class="_ _66"> </span>a<span class="_ _2"></span><span class="ls0">lso <span class="_"> </span>publicly <span class="_"> </span>available</span></span></span></span></span></div><div class="t m0 x32 h2a y254 ff19 fsf fc0 sc0 ls0 ws0">sources that you can compile with special ﬂags to enable additional r<span class="_ _0"></span>untime checking.</div><div class="t m0 x76 h51 y1c44 ff19 fs2a fc0 sc0 ls0 ws0">FreeBSD, <span class="_ _47"> </span>Mac <span class="_ _45"> </span>OS <span class="_ _47"> </span>X, <span class="_ _45"> </span>and <span class="_ _45"> </span>Linux <span class="_ _47"> </span>support <span class="_ _45"> </span>additional <span class="_ _45"> </span>debugging <span class="_ _47"> </span>through <span class="_ _45"> </span>the <span class="_ _47"> </span>setting <span class="_ _45"> </span>of</div><div class="t m0 x76 h51 y1c45 ff19 fs2a fc0 sc0 ls0 ws0">environment <span class="_ _2"></span>variables.<span class="_ _4b"> </span>In <span class="_ _2"></span>addition, <span class="_ _3"></span>options <span class="_ _3"></span>can <span class="_ _2"></span>be <span class="_ _3"></span>passed <span class="_ _3"></span>to <span class="_ _2"></span>the <span class="_ _3"></span>FreeBSD <span class="_ _2"></span>library <span class="_ _3"></span>through <span class="_ _2"></span>the</div><div class="t m0 x76 h52 y1c46 ff19 fs2a fc0 sc0 ls0 ws0">symbolic link<span class="_"> </span><span class="ff1a">/etc/malloc.conf</span>.</div><div class="t m0 x35 h27 y1c47 ff16 fsf fc0 sc0 ls0 ws0">Alternate Memor<span class="ls12e">yA<span class="_ _4f"></span><span class="ls0">llocators</span></span></div><div class="t m0 x32 h26 y1c48 ff19 fsf fc0 sc0 ls0 ws0">Many <span class="_ _2"></span>replacements <span class="_ _2"></span>for<span class="_ _47"> </span><span class="ff1a">malloc<span class="_ _47"> </span></span>and<span class="_ _66"> </span><span class="ff1a">free<span class="_ _47"> </span></span>ar<span class="ls892">ea<span class="_ _8"></span><span class="ls0">vailable. <span class="_ _47"> </span>Some<span class="_ _47"> </span>systems <span class="_ _2"></span>already <span class="_ _2"></span>include</span></span></div><div class="t m0 x32 h2a y1c49 ff19 fsf fc0 sc0 ls0 ws0">libraries <span class="_ _35"> </span>providing <span class="_ _44"> </span>alternative <span class="_ _35"> </span>memory <span class="_ _44"> </span>allocator <span class="_ _44"> </span>implementations.<span class="_ _98"> </span>Other <span class="_ _35"> </span>systems</div><div class="t m0 x32 h2a y1c4a ff19 fsf fc0 sc0 ls0 ws0">provide <span class="_ _9"></span>only <span class="_ _9"></span>the <span class="_ _23"></span>standar<span class="_ _0"></span><span class="ls893">da<span class="_ _b"></span><span class="ls0">llocator<span class="_ _6"></span><span class="ls893">,l<span class="_ _b"></span><span class="ls0">eaving <span class="_ _9"></span>it <span class="_ _23"></span>up <span class="_ _9"></span>to <span class="_ _23"></span>softwar<span class="_ _0"></span><span class="ls893">ed<span class="_ _b"></span><span class="ls0">evelopers <span class="_ _9"></span>to <span class="_ _9"></span>download</span></span></span></span></span></span></div><div class="t m0 x32 h2a y1c4b ff19 fsf fc0 sc0 ls0 ws0">alternatives, if desired. <span class="_"> </span>W<span class="_ _4"></span><span class="ls44">ed<span class="_ _5"></span><span class="ls0">iscuss some of the alternatives here.</span></span></div><div class="t m0 x35 h26 y1c4c ff1f fsf fc0 sc0 ls0 ws0">libmalloc</div><div class="t m0 x32 h2a y1c4d ff19 fsf fc0 sc0 ls0 ws0">SVR4</div><div class="t m0 x156 h2a y1c4e ff19 fsf fc0 sc0 ls0 ws0">-</div><div class="t m0 xe1 h26 y1c4d ff19 fsf fc0 sc0 ls0 ws0">based <span class="_ _3"></span>systems, <span class="_ _3"></span>such <span class="_ _3"></span>as <span class="_ _3"></span>Solaris, <span class="_ _9"></span>include <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">libmalloc<span class="_ _47"> </span></span>library<span class="_ _6"></span><span class="ls8a">,w<span class="_ _8"></span><span class="ls0">hich <span class="_ _3"></span>provides <span class="_ _2"></span>a</span></span></div><div class="t m0 x32 h26 y1c4f ff19 fsf fc0 sc0 ls0 ws0">set <span class="_ _53"> </span>of <span class="_ _e"> </span>interfaces <span class="_ _e"> </span>matching <span class="_ _e"> </span>the <span class="_ _e"> </span>ISO <span class="_ _e"> </span>C <span class="_ _e"> </span>memory <span class="_ _53"> </span>allocation <span class="_ _e"> </span>functions.<span class="_ _48"> </span>The<span class="_ _4b"> </span><span class="ff1a">libmalloc</span></div><div class="t m0 x32 h26 y1c50 ff19 fsf fc0 sc0 ls0 ws0">library <span class="_ _9"></span>includes<span class="_ _45"> </span><span class="ff1a">mallopt</span><span class="ls894">,af<span class="_ _b"></span><span class="ls0">unction <span class="_ _9"></span>that <span class="_ _9"></span>allows <span class="_ _9"></span>a <span class="_ _9"></span>process <span class="_ _9"></span>to <span class="_ _9"></span>set <span class="_ _9"></span>certain <span class="_ _9"></span>variables <span class="_ _9"></span>that</span></span></div><div class="t m0 x32 h26 y1c51 ff19 fsf fc0 sc0 ls0 ws0">control <span class="_"> </span>the <span class="_"> </span>operation <span class="_"> </span>of <span class="_"> </span>the <span class="_"> </span>storage <span class="_ _66"> </span>allocator<span class="_ _1"></span><span class="ls895">.A<span class="_ _d"></span><span class="ls0">function <span class="_"> </span>called<span class="_ _61"> </span><span class="ff1a">mallinfo<span class="_ _46"> </span></span>is <span class="_"> </span>also</span></span></div><div class="t m0 x32 h2a y1c52 ff19 fsf fc0 sc0 ls0 ws0">available to provide statistics on the memory allocator<span class="_ _6"></span>.</div><div class="t m0 x35 h26 y1c53 ff1f fsf fc0 sc0 ls0 ws0">vmalloc</div><div class="t m0 x32 h2a y1c54 ff19 fsf fc0 sc0 lsc1 ws0">Vo</div><div class="t m0 x14a h2a y1c55 ff19 fsf fc0 sc0 ls0 ws0">[</div><div class="t m0 x3f h2a y1c54 ff19 fsf fc0 sc0 ls0 ws0">1996</div><div class="t m0 x14 h2a y1c55 ff19 fsf fc0 sc0 ls0 ws0">]</div><div class="t m0 xc3 h2a y1c54 ff19 fsf fc0 sc0 ls0 ws0">describes <span class="_ _3"></span>a <span class="_ _3"></span>memory <span class="_ _3"></span>allocator <span class="_ _9"></span>that <span class="_ _3"></span>allows <span class="_ _3"></span>processes <span class="_ _3"></span>to <span class="_ _3"></span>allocate <span class="_ _3"></span>memory <span class="_ _9"></span>using</div><div class="t m0 x32 h2a y1c56 ff19 fsf fc0 sc0 ls0 ws0">differ<span class="_ _0"></span>ent <span class="_ _47"> </span>techniques <span class="_ _47"> </span>for <span class="_ _47"> </span>dif<span class="_ _0"></span>ferent <span class="_ _66"> </span>regions <span class="_ _47"> </span>of <span class="_ _47"> </span>memory<span class="_ _4"></span><span class="ls896">.I<span class="_ _49"></span><span class="ls897">na<span class="_ _62"></span><span class="ls0">ddition <span class="_ _47"> </span>to <span class="_ _47"> </span>the <span class="_ _47"> </span>functions</span></span></span></div><div class="t m0 x32 h26 y1c57 ff19 fsf fc0 sc0 ls0 ws0">speciﬁc <span class="_ _23"> </span>to<span class="_ _35"> </span><span class="ff1a">vmalloc</span><span class="ls898">,t<span class="_ _43"></span><span class="ls0">he <span class="_ _23"> </span>library <span class="_ _42"> </span>provides <span class="_ _9"></span>emulations <span class="_ _42"> </span>of <span class="_ _23"></span>the <span class="_ _23"> </span>ISO <span class="_ _23"> </span>C <span class="_ _23"> </span>memory <span class="_ _42"> </span>allocation</span></span></div><div class="t m0 x32 h2a y1c58 ff19 fsf fc0 sc0 ls0 ws0">functions.</div><div class="t m0 x35 h26 y1c59 ff1f fsf fc0 sc0 ls0 ws0">quick-fit</div><div class="t m0 x32 h26 y1c5a ff19 fsf fc0 sc0 ls0 ws0">Historically<span class="_ _4"></span><span class="ls487">,t<span class="_ _b"></span><span class="ls0">he <span class="_ _9"></span>standard<span class="_ _45"> </span><span class="ff1a">malloc<span class="_ _45"> </span></span>algorithm <span class="_ _3"></span>used <span class="_ _9"></span>either <span class="_ _9"></span>a <span class="_ _9"></span>best-ﬁt <span class="_ _9"></span>or <span class="_ _9"></span>a <span class="_ _9"></span>ﬁrst-ﬁt <span class="_ _9"></span>memory</span></span></div><div class="t m0 x32 h2a y1c5b ff19 fsf fc0 sc0 ls0 ws0">allocation <span class="_ _66"> </span>strategy<span class="_ _6"></span><span class="ls899">.Q<span class="_ _49"></span><span class="ls0">uick-ﬁt <span class="_ _66"> </span>is <span class="_ _47"> </span>faster <span class="_ _66"> </span>than <span class="_ _47"> </span>either<span class="_ _1"></span><span class="ls89a">,b<span class="_ _1d"></span><span class="ls0">ut <span class="_ _47"> </span>tends <span class="_ _47"> </span>to <span class="_ _66"> </span>use <span class="_ _47"> </span>mor<span class="ls89a">em<span class="_ _1d"></span><span class="ls0">emory<span class="_ _4"></span>.</span></span></span></span></span></span></div><div class="t m0 x32 h2a y1c5c ff19 fsf fc0 sc0 ls5f ws0">We<span class="_ _9"></span><span class="ls0">instock <span class="_"> </span>and <span class="_ _47"> </span>W<span class="_ _1"></span>ulf</span></div><div class="t m0 xa0 h2a y1c5d ff19 fsf fc0 sc0 ls0 ws0">[</div><div class="t m0 xab h2a y1c5c ff19 fsf fc0 sc0 ls0 ws0">1988</div><div class="t m0 x9e h2a y1c5d ff19 fsf fc0 sc0 ls0 ws0">]</div><div class="t m0 x59 h2a y1c5c ff19 fsf fc0 sc0 ls0 ws0">describe <span class="_"> </span>the <span class="_ _66"> </span>algorithm, <span class="_ _66"> </span>which <span class="_ _66"> </span>is <span class="_ _66"> </span>based <span class="_ _66"> </span>on <span class="_ _66"> </span>splitting <span class="_ _66"> </span>up</div><div class="t m0 x32 h2a y1c5e ff19 fsf fc0 sc0 ls0 ws0">memory <span class="_ _9"></span>into <span class="_ _9"></span>buffers <span class="_ _3"></span>of <span class="_ _9"></span>various <span class="_ _9"></span>sizes <span class="_ _9"></span>and <span class="_ _9"></span>maintaining <span class="_ _9"></span>unused <span class="_ _9"></span>buffers <span class="_ _9"></span>on <span class="_ _9"></span>differ<span class="_ _0"></span>ent <span class="_ _9"></span>free</div><div class="t m0 x32 h2a y1c5f ff19 fsf fc0 sc0 ls0 ws0">lists, depending on the buffer sizes.<span class="_ _59"> </span>Most modern allocators ar<span class="ls44">eb<span class="_ _4f"></span><span class="ls0">ased on quick-ﬁt.</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
