<div id="pf11c" class="pf w4 h1f" data-page-no="11c"><div class="pc pc11c w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg11c.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">250<span class="_ _1b"> </span><span class="ff19">Process <span class="_"> </span>Contr<span class="_ _0"></span>ol <span class="_ _222"> </span>Chapter<span class="_ _4b"> </span>8</span></div><div class="t m0 x3f h2a y12f ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _45"> </span>ﬁrst <span class="_ _45"> </span>difference <span class="_ _45"> </span>in <span class="_ _45"> </span>these <span class="_ _45"> </span>functions <span class="_ _35"> </span>is <span class="_ _45"> </span>that <span class="_ _45"> </span>the <span class="_ _45"> </span>ﬁrst <span class="_ _35"> </span>four <span class="_ _45"> </span>take <span class="_ _45"> </span>a <span class="_ _35"> </span>pathname</div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">argument, the next two take a ﬁlename argument, and the last one takes a ﬁle descriptor</div><div class="t m0 x32 h2b y131 ff19 fsf fc0 sc0 ls0 ws0">argument. <span class="_"> </span>When<span class="_"> </span>a<span class="_"> </span><span class="ff1b">ﬁlename<span class="_"> </span></span>ar<span class="_ _0"></span>gument is speciﬁed,</div><div class="t m0 x3f h2b y20ea ff19 fsf fc0 sc0 ls49 ws0">•I<span class="_ _4d"></span><span class="ls0">f<span class="_"> </span><span class="ff1b">ﬁlename<span class="_"> </span></span>contains a slash, it is taken as a pathname.</span></div><div class="t m0 x3f h2a y20eb ff19 fsf fc0 sc0 ls49 ws0">•O<span class="_ _4d"></span><span class="ls0">therwise, <span class="_ _9"></span>the <span class="_ _23"></span>executable <span class="_ _9"></span>ﬁle <span class="_ _23"></span>is <span class="_ _9"></span>searched <span class="_ _9"></span>for <span class="_ _9"></span>in <span class="_ _23"></span>the <span class="_ _9"></span>directories <span class="_ _9"></span>speciﬁed <span class="_ _23"></span>by <span class="_ _9"></span>the</span></div><div class="t m0 x15 h26 y20ec ff1a fsf fc0 sc0 ls0 ws0">PATH<span class="_ _80"> </span><span class="ff19">environment variable.</span></div><div class="t m0 x32 h26 y941 ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _45"> </span><span class="ff1a">PATH<span class="_ _47"> </span></span>variable <span class="_ _9"></span>contains <span class="_ _9"></span>a <span class="_ _9"></span>list <span class="_ _9"></span>of <span class="_ _9"></span>directories, <span class="_ _3"></span>called <span class="_ _9"></span>path <span class="_ _9"></span>preﬁxes, <span class="_ _3"></span>that <span class="_ _9"></span>ar<span class="ls9df">es<span class="_ _b"></span><span class="ls0">eparated</span></span></div><div class="t m0 x32 h2b y20ed ff19 fsf fc0 sc0 ls0 ws0">by colons.<span class="_ _59"> </span>For example, the<span class="_"> </span><span class="ff1b">name=value<span class="_"> </span></span>environment string</div><div class="t m0 x3f h57 y20ee ff1a fs2d fc0 sc0 ls0 ws0">PATH=/bin:/usr/bin:/usr/local/bin/:.</div><div class="t m0 x32 h2a y20ef ff19 fsf fc0 sc0 ls0 ws0">speciﬁes <span class="_ _9"></span>four <span class="_ _23"></span>directories <span class="_ _9"></span>to <span class="_ _9"></span>search. <span class="_ _45"> </span>The<span class="_ _35"> </span>last <span class="_ _9"></span>path <span class="_ _9"></span>preﬁx <span class="_ _23"></span>speciﬁes <span class="_ _9"></span>the <span class="_ _23"></span>curr<span class="_ _0"></span>ent <span class="_ _9"></span>directory<span class="_ _4"></span>.</div><div class="t m0 x32 h2a y20f0 ff19 fsf fc0 sc0 ls0 ws0">(A <span class="_ _3"></span>zero-length <span class="_ _3"></span>preﬁx <span class="_ _3"></span>also <span class="_ _9"></span>means <span class="_ _3"></span>the <span class="_ _9"></span>current <span class="_ _3"></span>directory<span class="_ _4"></span><span class="ls87f">.I<span class="_ _62"></span><span class="ls880">tc<span class="_ _8"></span><span class="ls0">an <span class="_ _9"></span>be <span class="_ _3"></span>speciﬁed <span class="_ _9"></span>as <span class="_ _3"></span>a <span class="_ _9"></span>colon <span class="_ _9"></span>at</span></span></span></div><div class="t m0 x32 h2b y20f1 ff19 fsf fc0 sc0 ls0 ws0">the beginning of the<span class="_"> </span><span class="ff1b">value</span><span class="ls44">,t<span class="_ _d"></span><span class="ls0">wo colons in a row<span class="_ _6"></span>,<span class="_"> </span>or<span class="_"> </span>a<span class="_"> </span>colon at the end of the<span class="_"> </span><span class="ff1b">value</span>.)</span></span></div><div class="t m0 x76 h76 y20f2 ff19 fs2a fc0 sc0 ls0 ws0">Ther<span class="ls9e0">ea<span class="_ _b"></span><span class="ls34e">re <span class="_ _42"> </span>s<span class="ls0">ecurity <span class="_ _42"> </span>reasons <span class="_ _23"> </span>for<span class="_ _45"> </span><span class="ff1b">never<span class="_ _47"> </span></span>including <span class="_ _42"> </span>the <span class="_ _23"> </span>current <span class="_ _23"> </span>directory <span class="_ _23"> </span>in <span class="_ _42"> </span>the <span class="_ _23"> </span>search <span class="_ _23"> </span>path.<span class="_ _61"> </span>See</span></span></span></div><div class="t m0 x76 h51 y20f3 ff19 fs2a fc0 sc0 ls0 ws0">Garﬁnkel et al.</div><div class="t m0 x36 h51 y20f4 ff19 fs2a fc0 sc0 ls0 ws0">[</div><div class="t m0 xbe h51 y20f3 ff19 fs2a fc0 sc0 ls0 ws0">2003</div><div class="t m0 x124 h51 y20f4 ff19 fs2a fc0 sc0 ls0 ws0">]</div><div class="t m0 xb7 h51 y20f3 ff19 fs2a fc0 sc0 ls0 ws0">.</div><div class="t m0 x3f h26 y20f5 ff19 fsf fc0 sc0 ls0 ws0">If <span class="_ _3"></span>either<span class="_ _45"> </span><span class="ff1a">execlp<span class="_ _47"> </span></span>or<span class="_ _47"> </span><span class="ff1a">execvp<span class="_ _45"> </span></span>ﬁnds <span class="_ _3"></span>an <span class="_ _3"></span>executable <span class="_ _9"></span>ﬁle <span class="_ _3"></span>using <span class="_ _9"></span>one <span class="_ _3"></span>of <span class="_ _9"></span>the <span class="_ _3"></span>path <span class="_ _3"></span>preﬁxes,</div><div class="t m0 x32 h2a y20f6 ff19 fsf fc0 sc0 ls0 ws0">but the ﬁle <span class="_ _2"></span>isn’t a machine <span class="_ _2"></span>executable that was <span class="_ _2"></span>generated by the <span class="_ _2"></span>link editor<span class="_ _1"></span><span class="ls9e1">,t<span class="_ _d"></span><span class="ls0">he function</span></span></div><div class="t m0 x32 h26 y20f7 ff19 fsf fc0 sc0 ls0 ws0">assumes <span class="_ _9"></span>that <span class="_ _23"></span>the <span class="_ _9"></span>ﬁle <span class="_ _23"></span>is <span class="_ _9"></span>a <span class="_ _23"></span>shell <span class="_ _9"></span>script <span class="_ _9"></span>and <span class="_ _23"></span>tries <span class="_ _9"></span>to <span class="_ _23"></span>invoke<span class="_ _45"> </span><span class="ff1a">/bin/sh<span class="_ _45"> </span></span>with <span class="_ _23"></span>the<span class="_ _45"> </span><span class="ff1b">ﬁlename<span class="_ _45"> </span></span>as</div><div class="t m0 x32 h2a y20f8 ff19 fsf fc0 sc0 ls0 ws0">input to the shell.</div><div class="t m0 x3f h26 y20f9 ff19 fsf fc0 sc0 ls65 ws0">Wi<span class="_ _3"></span><span class="ls0">th<span class="_ _45"> </span><span class="ff1a">fexecve</span>,<span class="_ _45"> </span>we<span class="_ _45"> </span>avoid <span class="_ _23"></span>the <span class="_ _9"></span>issue <span class="_ _9"></span>of <span class="_ _23"></span>ﬁnding <span class="_ _9"></span>the <span class="_ _9"></span>correct <span class="_ _9"></span>executable <span class="_ _9"></span>ﬁle <span class="_ _23"></span>altogether</span></div><div class="t m0 x32 h2a y20fa ff19 fsf fc0 sc0 ls0 ws0">and rely on the caller <span class="_ _2"></span>to do <span class="_ _2"></span>this.<span class="_ _46"> </span>By using a <span class="_ _2"></span>ﬁle descriptor<span class="_ _1"></span><span class="ls9e2">,t<span class="_ _d"></span><span class="ls0">he caller <span class="_ _2"></span>can verify the <span class="_ _2"></span>ﬁle is</span></span></div><div class="t m0 x32 h2a y20fb ff19 fsf fc0 sc0 ls0 ws0">in <span class="_ _2"></span>fact <span class="_ _2"></span>the <span class="_ _3"></span>intended <span class="_ _2"></span>ﬁle <span class="_ _2"></span>and <span class="_ _3"></span>execute <span class="_ _2"></span>it <span class="_ _2"></span>without <span class="_ _3"></span>a <span class="_ _2"></span>race.<span class="_ _61"> </span>Otherwise, <span class="_ _3"></span>a <span class="_ _2"></span>malicious <span class="_ _2"></span>user <span class="_ _3"></span>with</div><div class="t m0 x32 h2a y20fc ff19 fsf fc0 sc0 ls0 ws0">appropriate <span class="_ _3"></span>privileges <span class="_ _9"></span>could <span class="_ _9"></span>replace <span class="_ _9"></span>the <span class="_ _9"></span>executable <span class="_ _9"></span>ﬁle <span class="_ _9"></span>(or <span class="_ _9"></span>a <span class="_ _9"></span>portion <span class="_ _23"></span>of <span class="_ _9"></span>the <span class="_ _9"></span>path <span class="_ _9"></span>to <span class="_ _9"></span>the</div><div class="t m0 x32 h2a y20fd ff19 fsf fc0 sc0 ls0 ws0">executable <span class="_ _2"></span>ﬁle) <span class="_ _2"></span>after <span class="_ _3"></span>it <span class="_ _2"></span>has <span class="_ _3"></span>been <span class="_ _2"></span>located <span class="_ _2"></span>and <span class="_ _3"></span>veriﬁed, <span class="_ _2"></span>but <span class="_ _3"></span>befor<span class="ls211">et<span class="_ _8"></span><span class="ls0">he <span class="_ _2"></span>caller <span class="_ _3"></span>can <span class="_ _2"></span>execute <span class="_ _2"></span>it</span></span></div><div class="t m0 x32 h2a y20fe ff19 fsf fc0 sc0 ls0 ws0">(recall the discussion of T<span class="_ _0"></span>OCTT<span class="_ _0"></span>OU errors in Section 3.3).</div><div class="t m0 x3f h26 y20ff ff19 fsf fc0 sc0 ls0 ws0">The next <span class="_ _2"></span>differ<span class="_ _0"></span>ence concerns <span class="_ _2"></span>the passing <span class="_ _2"></span>of the <span class="_ _2"></span>argument list (<span class="ff1a">l<span class="_ _66"> </span></span>stands <span class="_ _2"></span>for list <span class="_ _2"></span>and<span class="_"> </span><span class="ff1a">v</span></div><div class="t m0 x32 h26 y2100 ff19 fsf fc0 sc0 ls0 ws0">stands <span class="_ _e"> </span>for <span class="_"> </span>vector).<span class="_ _65"> </span>The <span class="_"> </span>functions<span class="_ _4b"> </span><span class="ff1a">execl</span>,<span class="_ _59"> </span><span class="ff1a">execlp</span><span class="ls9e3">,a<span class="_ _55"></span><span class="ls0">nd<span class="_ _4b"> </span><span class="ff1a">execle<span class="_ _59"> </span></span><span class="ls45">re<span class="_ _2"></span></span>quir<span class="ls9e4">ee<span class="_ _4a"></span><span class="ls0">ach <span class="_"> </span>of <span class="_ _53"> </span>the</span></span></span></span></div><div class="t m0 x32 h2a y2101 ff19 fsf fc0 sc0 ls0 ws0">command</div><div class="t m0 xc3 h2a y2102 ff19 fsf fc0 sc0 ls0 ws0">-</div><div class="t m0 xc4 h2a y2101 ff19 fsf fc0 sc0 ls0 ws0">line <span class="_ _42"> </span>arguments <span class="_ _23"></span>to <span class="_ _42"> </span>the <span class="_ _42"> </span>new <span class="_ _42"> </span>pr<span class="_ _0"></span>ogram <span class="_ _42"> </span>to <span class="_ _42"> </span>be <span class="_ _23"> </span>speciﬁed <span class="_ _42"> </span>as <span class="_ _42"> </span>separate <span class="_ _42"> </span>arguments.</div><div class="t m0 x32 h2a y2103 ff19 fsf fc0 sc0 ls5f ws0">We <span class="_ _45"> </span>m<span class="_ _9"></span><span class="ls0">ark <span class="_ _42"> </span>the <span class="_ _42"> </span>end <span class="_ _42"> </span>of <span class="_ _42"> </span>the <span class="_ _42"> </span>arguments <span class="_ _23"> </span>with <span class="_ _42"> </span>a <span class="_ _42"> </span>null <span class="_ _42"> </span>pointer<span class="_ _1"></span><span class="ls9e5">.F<span class="_ _7"></span><span class="ls0">or <span class="_ _42"> </span>the <span class="_ _42"> </span>other <span class="_ _42"> </span>four <span class="_ _42"> </span>functions</span></span></span></div><div class="t m0 x32 h26 y2104 ff19 fsf fc0 sc0 ls0 ws0">(<span class="ff1a">execv</span>,<span class="_ _47"> </span><span class="ff1a">execvp</span>,<span class="_ _45"> </span><span class="ff1a">execve</span><span class="ls9e6">,a<span class="_ _b"></span><span class="ls0">nd<span class="_ _45"> </span><span class="ff1a">fexecve</span>), <span class="_ _2"></span>we <span class="_ _9"></span>have <span class="_ _3"></span>to <span class="_ _3"></span>build <span class="_ _9"></span>an <span class="_ _3"></span>array <span class="_ _3"></span>of <span class="_ _3"></span>pointers <span class="_ _9"></span>to <span class="_ _3"></span>the</span></span></div><div class="t m0 x32 h2a y2105 ff19 fsf fc0 sc0 ls0 ws0">arguments, and the addr<span class="_ _0"></span>ess of this array is the ar<span class="_ _0"></span>gument to these three functions.</div><div class="t m0 x3f h2a y2106 ff19 fsf fc0 sc0 ls0 ws0">Befor<span class="ls9e7">eu<span class="_ _52"></span><span class="ls0">sing <span class="_ _35"> </span>ISO <span class="_ _44"> </span>C <span class="_ _35"> </span>prototypes, <span class="_ _45"> </span>the <span class="_ _44"> </span>normal <span class="_ _35"> </span>way <span class="_ _35"> </span>to <span class="_ _35"> </span>show <span class="_ _35"> </span>the <span class="_ _35"> </span>command</span></span></div><div class="t m0 x17d h2a y2107 ff19 fsf fc0 sc0 ls0 ws0">-</div><div class="t m0 x61 h2a y2106 ff19 fsf fc0 sc0 ls0 ws0">line</div><div class="t m0 x32 h26 y2108 ff19 fsf fc0 sc0 ls0 ws0">arguments for the thr<span class="_ _0"></span>ee functions<span class="_"> </span><span class="ff1a">execl</span>,<span class="_"> </span><span class="ff1a">execle</span><span class="ls44">,a<span class="_ _d"></span><span class="ls0">nd<span class="_"> </span><span class="ff1a">execlp<span class="_ _80"> </span></span>was</span></span></div><div class="t m0 x3f h57 y2109 ff1a fs2d fc0 sc0 ls0 ws0">char *<span class="ff1b">arg0</span><span class="ls15c">,c<span class="_ _1d"></span><span class="ls0">har *<span class="ff1b">arg1</span><span class="ls15c">,.<span class="_ _1d"></span><span class="ls0">.., char *<span class="ff1b">argn</span><span class="ls15c">,(<span class="_ _1d"></span><span class="ls0">char *)0</span></span></span></span></span></span></div><div class="t m0 x32 h2a y210a ff19 fsf fc0 sc0 ls0 ws0">This syntax <span class="_ _2"></span>explicitly shows <span class="_ _2"></span>that the <span class="_ _2"></span>ﬁnal command</div><div class="t m0 x117 h2a y210b ff19 fsf fc0 sc0 ls0 ws0">-</div><div class="t m0 x1d9 h2a y210a ff19 fsf fc0 sc0 ls0 ws0">line argument is followed <span class="_ _2"></span>by <span class="_ _2"></span>a null</div><div class="t m0 x32 h26 y210c ff19 fsf fc0 sc0 ls0 ws0">pointer<span class="_ _6"></span><span class="ls9e8">.I<span class="_ _5b"></span><span class="ls9e9">ft<span class="_ _d"></span><span class="ls0">his <span class="_ _2"></span>null <span class="_ _2"></span>pointer <span class="_ _2"></span>is <span class="_ _2"></span>speciﬁed <span class="_ _2"></span>by <span class="_ _2"></span>the <span class="_ _2"></span>constant<span class="_ _47"> </span><span class="ff1a">0</span>,<span class="_ _66"> </span>we<span class="_ _47"> </span>must cast <span class="_ _3"></span>it <span class="_ _2"></span>to <span class="_ _2"></span>a <span class="_ _2"></span>pointer; <span class="_ _2"></span>if</span></span></span></div><div class="t m0 x32 h2a y210d ff19 fsf fc0 sc0 ls0 ws0">we <span class="_ _23"></span>don’t, <span class="_ _23"></span>it’s <span class="_ _23"> </span>interpreted <span class="_ _23"></span>as <span class="_ _23"></span>an <span class="_ _23"></span>integer <span class="_ _23"></span>argument. <span class="_ _45"> </span>If<span class="_ _35"> </span>the <span class="_ _23"></span>size <span class="_ _23"> </span>of <span class="_ _23"> </span>an <span class="_ _23"> </span>integer <span class="_ _23"> </span>is <span class="_ _23"> </span>different</div><div class="t m0 x32 h26 y210e ff19 fsf fc0 sc0 ls0 ws0">from the size of a<span class="_"> </span><span class="ff1a">char <span class="_ _4f"></span>*<span class="ff19 ls44">,t<span class="_ _d"></span><span class="ls0">he actual arguments to the<span class="_"> </span><span class="ff1a">exec<span class="_ _80"> </span></span>function will be wrong.</span></span></span></div><div class="t m0 x3f h2a y210f ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _2"></span>ﬁnal <span class="_ _3"></span>difference <span class="_ _2"></span>is <span class="_ _3"></span>the <span class="_ _3"></span>passing <span class="_ _3"></span>of <span class="_ _2"></span>the <span class="_ _3"></span>environment <span class="_ _3"></span>list <span class="_ _2"></span>to <span class="_ _3"></span>the <span class="_ _3"></span>new <span class="_ _3"></span>program. <span class="_ _47"> </span>The</div><div class="t m0 x32 h26 y2110 ff19 fsf fc0 sc0 ls0 ws0">three functions <span class="_ _3"></span>whose <span class="_ _2"></span>names <span class="_ _3"></span>end <span class="_ _2"></span>in <span class="_ _3"></span>an<span class="_ _47"> </span><span class="ff1a">e<span class="_ _66"> </span></span>(<span class="ff1a">execle</span>,<span class="_ _47"> </span><span class="ff1a">execve</span><span class="ls414">,a<span class="_ _4f"></span><span class="ls0">nd<span class="_ _47"> </span><span class="ff1a">fexecve</span><span class="ls414">)a<span class="_ _8"></span><span class="ls0">llow <span class="_ _3"></span>us <span class="_ _2"></span>to</span></span></span></span></div><div class="t m0 x32 h2a y2111 ff19 fsf fc0 sc0 ls0 ws0">pass <span class="_"> </span>a <span class="_ _66"> </span>pointer <span class="_"> </span>to <span class="_ _66"> </span>an <span class="_ _66"> </span>array <span class="_ _66"> </span>of <span class="_ _66"> </span>pointers <span class="_ _66"> </span>to <span class="_ _66"> </span>the <span class="_"> </span>environment <span class="_"> </span>strings.<span class="_ _50"> </span>The <span class="_"> </span>other <span class="_ _66"> </span>four</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
