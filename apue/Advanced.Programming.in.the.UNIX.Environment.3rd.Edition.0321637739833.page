<div id="pf341" class="pf w4 h1f" data-page-no="341"><div class="pc pc341 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg341.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>21.5<span class="_ _eb"> </span>Source <span class="_"> </span>Code<span class="_ _1fb"> </span><span class="ff18">799</span></div><div class="t m0 x32 h26 y12f ff19 fsf fc0 sc0 ls0 ws0">The next ﬁle is the<span class="_"> </span><span class="ff1a">print.h<span class="_ _80"> </span></span>header<span class="_ _1"></span>.</div><div class="t m0 x140 h4e y59f9 ff1a fs28 fc0 sc0 ls1651 ws0">1#<span class="_ _244"></span><span class="ls0">ifndef _PRINT_H</span></div><div class="t m0 x140 h4e y59fa ff1a fs28 fc0 sc0 ls1651 ws0">2#<span class="_ _244"></span><span class="ls0">define _PRINT_H</span></div><div class="t m0 x140 h4e y5a43 ff1a fs28 fc0 sc0 ls1651 ws0">3/<span class="_ _244"></span><span class="ls0">*</span></div><div class="t m0 x140 h4e y5a44 ff1a fs28 fc0 sc0 lsf75 ws0">4*<span class="_ _244"></span><span class="ls0">Print server header file.</span></div><div class="t m0 x140 h4e y5a45 ff1a fs28 fc0 sc0 lsf75 ws0">5*<span class="_ _19"></span><span class="ls0">/</span></div><div class="t m0 x140 h4e y5a46 ff1a fs28 fc0 sc0 ls1651 ws0">6#<span class="_ _244"></span><span class="ls0">include &lt;sys/socket.h&gt;</span></div><div class="t m0 x140 h4e y5a47 ff1a fs28 fc0 sc0 ls1651 ws0">7#<span class="_ _244"></span><span class="ls0">include &lt;arpa/inet.h&gt;</span></div><div class="t m0 x140 h4e y5a48 ff1a fs28 fc0 sc0 ls1651 ws0">8#<span class="_ _244"></span><span class="ls0">include &lt;netdb.h&gt;</span></div><div class="t m0 x140 h4e y5a49 ff1a fs28 fc0 sc0 ls1651 ws0">9#<span class="_ _244"></span><span class="ls0">include &lt;errno.h&gt;</span></div><div class="t m0 x32 h4e y5a4a ff1a fs28 fc0 sc0 ls0 ws0">10 <span class="_ _d9"> </span>#define<span class="_"> </span>CONFIG_FILE <span class="_ _87"> </span>&quot;/etc/printer.conf&quot;</div><div class="t m0 x32 h4e y5a4b ff1a fs28 fc0 sc0 ls0 ws0">11 <span class="_ _d9"> </span>#define<span class="_"> </span>SPOOLDIR <span class="_ _88"> </span>&quot;/var/spool/printer&quot;</div><div class="t m0 x32 h4e y5a4c ff1a fs28 fc0 sc0 ls0 ws0">12 <span class="_ _d9"> </span>#define<span class="_"> </span>JOBFILE <span class="_ _90"> </span>&quot;jobno&quot;</div><div class="t m0 x32 h4e y5a4d ff1a fs28 fc0 sc0 ls0 ws0">13 <span class="_ _d9"> </span>#define<span class="_"> </span>DATADIR <span class="_ _90"> </span>&quot;data&quot;</div><div class="t m0 x32 h4e y5a4e ff1a fs28 fc0 sc0 ls0 ws0">14 <span class="_ _d9"> </span>#define<span class="_"> </span>REQDIR <span class="_ _186"> </span>&quot;reqs&quot;</div><div class="t m0 x32 h4e y5a4f ff1a fs28 fc0 sc0 ls0 ws0">15 <span class="_ _d9"> </span>#if<span class="_"> </span>defined(BSD)</div><div class="t m0 x32 h4e y5a50 ff1a fs28 fc0 sc0 ls0 ws0">16 <span class="_ _d9"> </span>#define<span class="_"> </span>LPNAME <span class="_ _186"> </span>&quot;daemon&quot;</div><div class="t m0 x32 h4e y5a51 ff1a fs28 fc0 sc0 ls0 ws0">17 <span class="_ _d9"> </span>#elif<span class="_"> </span>defined(MACOS)</div><div class="t m0 x32 h4e y5a52 ff1a fs28 fc0 sc0 ls0 ws0">18 <span class="_ _d9"> </span>#define<span class="_"> </span>LPNAME <span class="_ _186"> </span>&quot;_lp&quot;</div><div class="t m0 x32 h4e y5a53 ff1a fs28 fc0 sc0 ls0 ws0">19 <span class="_ _d9"> </span>#else</div><div class="t m0 x32 h4e y5a54 ff1a fs28 fc0 sc0 ls0 ws0">20 <span class="_ _d9"> </span>#define<span class="_"> </span>LPNAME <span class="_ _186"> </span>&quot;lp&quot;</div><div class="t m0 x32 h4e y5a55 ff1a fs28 fc0 sc0 ls0 ws0">21 <span class="_ _d9"> </span>#endif</div><div class="t m0 x32 h55 y5a56 ff19 fs2c fc0 sc0 ls0 ws0">[1 <span class="_ _a"></span>– <span class="_ _a"></span>9]<span class="_ _75"> </span><span class="ls155">We <span class="_ _45"> </span>i<span class="_ _9"></span></span>nclude <span class="_ _23"> </span>all <span class="_ _42"> </span>header <span class="_ _23"> </span>ﬁles <span class="_ _42"> </span>that <span class="_ _23"> </span>an <span class="_ _42"> </span>application <span class="_ _23"> </span>might <span class="_ _42"> </span>need <span class="_ _23"> </span>if <span class="_ _42"> </span>it <span class="_ _23"> </span>included <span class="_ _42"> </span>this</div><div class="t m0 x2d h54 y5a57 ff19 fs2c fc0 sc0 ls0 ws0">header<span class="_ _6"></span><span class="ls173d">.T<span class="_ _49"></span><span class="ls0">his <span class="_ _47"> </span>makes <span class="_ _47"> </span>it <span class="_ _47"> </span>easy <span class="_ _45"> </span>for <span class="_ _47"> </span>applications <span class="_ _45"> </span>to <span class="_ _47"> </span>include<span class="_ _16"> </span><span class="ff1a">print.h<span class="_"> </span></span>without</span></span></div><div class="t m0 x2d h55 y5a58 ff19 fs2c fc0 sc0 ls0 ws0">having to track down all the header dependencies.</div><div class="t m0 x32 h55 y5a59 ff19 fs2c fc0 sc0 ls0 ws0">[10 <span class="_ _a"></span>– <span class="_ _a"></span>14]<span class="_ _65"> </span><span class="ls155">We <span class="_ _66"> </span>d<span class="_ _9"></span></span>eﬁne <span class="_ _23"></span>the <span class="_ _9"></span>ﬁles <span class="_ _9"></span>and <span class="_ _23"></span>dir<span class="_ _0"></span>ectories <span class="_ _9"></span>for <span class="_ _9"></span>the <span class="_ _23"></span>implementation.<span class="_ _5a"> </span>The <span class="_ _9"></span>conﬁguration</div><div class="t m0 x2d h55 y5a5a ff19 fs2c fc0 sc0 ls0 ws0">ﬁle <span class="_ _35"> </span>containing <span class="_ _35"> </span>the <span class="_ _35"> </span>host <span class="_ _35"> </span>names <span class="_ _35"> </span>of <span class="_ _35"> </span>the <span class="_ _35"> </span>printer <span class="_ _35"> </span>spooling <span class="_ _35"> </span>daemon <span class="_ _35"> </span>and <span class="_ _35"> </span>the</div><div class="t m0 x2d h54 y5a5b ff19 fs2c fc0 sc0 ls0 ws0">network-attached <span class="_ _42"> </span>printer <span class="_ _42"> </span>is<span class="_ _44"> </span><span class="ff1a">/etc/printer.conf</span><span class="ls173e">.C<span class="_ _52"></span><span class="ls0">opies <span class="_ _42"> </span>of <span class="_ _42"> </span>the <span class="_ _53"> </span>ﬁles <span class="_ _42"> </span>to <span class="_ _42"> </span>be</span></span></div><div class="t m0 x2d h54 y5a5c ff19 fs2c fc0 sc0 ls0 ws0">printed <span class="_ _47"> </span>will <span class="_ _47"> </span>be <span class="_ _47"> </span>stored <span class="_ _47"> </span>in <span class="_ _47"> </span>the <span class="_ _47"> </span>directory<span class="_ _61"> </span><span class="ff1a">/var/spool/printer/data<span class="_ _16"> </span></span>and</div><div class="t m0 x2d h55 y5a5d ff19 fs2c fc0 sc0 ls0 ws0">control <span class="_ _16"> </span>information <span class="_ _5a"> </span>for <span class="_ _16"> </span>each <span class="_ _5a"> </span>request <span class="_ _16"> </span>will <span class="_ _5a"> </span>be <span class="_ _5a"> </span>stored <span class="_ _16"> </span>in <span class="_ _5a"> </span>the <span class="_ _5a"> </span>directory</div><div class="t m0 x2d h54 y5a5e ff1a fs2c fc0 sc0 ls0 ws0">/var/spool/printer/reqs<span class="ff19 ls173f">.T<span class="_ _49"></span><span class="ls0">he <span class="_"> </span>ﬁle <span class="_ _66"> </span>containing <span class="_ _66"> </span>the <span class="_ _66"> </span>next <span class="_ _66"> </span>job <span class="_ _66"> </span>number <span class="_ _66"> </span>is</span></span></div><div class="t m0 x2d h54 y5a5f ff1a fs2c fc0 sc0 ls0 ws0">/var/spool/printer/jobno<span class="ff19">.</span></div><div class="t m0 x2d h55 y5a60 ff19 fs2c fc0 sc0 ls0 ws0">The directories must be created by an administrator <span class="_ _2"></span>and be owned <span class="_ _2"></span>by the same</div><div class="t m0 x2d h55 y5a61 ff19 fs2c fc0 sc0 ls0 ws0">user <span class="_ _e"> </span>account <span class="_ _e"> </span>under <span class="_ _e"> </span>which <span class="_ _e"> </span>the <span class="_ _e"> </span>printer <span class="_"> </span>spooling <span class="_ _53"> </span>daemon <span class="_ _e"> </span>runs. <span class="_ _4b"> </span>The<span class="_ _4b"> </span>daemon</div><div class="t m0 x2d h55 y5a62 ff19 fs2c fc0 sc0 ls0 ws0">won’t <span class="_ _42"> </span>try <span class="_ _53"> </span>to <span class="_ _53"> </span>create <span class="_ _42"> </span>these <span class="_ _42"> </span>directories <span class="_ _42"> </span>if <span class="_ _53"> </span>they <span class="_ _53"> </span>don’t <span class="_ _42"> </span>exist, <span class="_ _53"> </span>because <span class="_ _53"> </span>the <span class="_ _42"> </span>daemon</div><div class="t m0 x2d h54 y5a63 ff19 fs2c fc0 sc0 ls0 ws0">would <span class="_ _42"> </span>need <span class="_ _23"> </span>root <span class="_ _23"> </span>privileges <span class="_ _42"> </span>to <span class="_ _42"> </span>create <span class="_ _23"> </span>directories <span class="_ _23"> </span>in<span class="_ _44"> </span><span class="ff1a">/var/spool</span><span class="ls1740">.W<span class="_ _5d"></span><span class="ls1741">ed<span class="_ _43"></span><span class="ls0">esign</span></span></span></div><div class="t m0 x2d h55 y5a64 ff19 fs2c fc0 sc0 ls0 ws0">the <span class="_ _23"> </span>daemon <span class="_ _23"> </span>to <span class="_ _23"> </span>do <span class="_ _42"> </span>as <span class="_ _23"></span>little <span class="_ _23"> </span>as <span class="_ _23"> </span>possible <span class="_ _23"> </span>while <span class="_ _42"> </span>running <span class="_ _23"></span>as <span class="_ _23"></span>root <span class="_ _23"></span>to <span class="_ _23"></span>minimize <span class="_ _23"> </span>the</div><div class="t m0 x2d h55 y5a65 ff19 fs2c fc0 sc0 ls0 ws0">chance of creating a security hole.</div><div class="t m0 x32 h55 y5a66 ff19 fs2c fc0 sc0 ls0 ws0">[15 <span class="_ _a"></span>– <span class="_ _a"></span>21]<span class="_ _65"> </span>Next, <span class="_ _23"></span>we <span class="_ _9"></span>deﬁne <span class="_ _23"> </span>the <span class="_ _23"></span>account <span class="_ _9"></span>name <span class="_ _23"> </span>under <span class="_ _23"></span>which <span class="_ _23"></span>the <span class="_ _9"></span>printer <span class="_ _23"> </span>spooling <span class="_ _23"></span>daemon</div><div class="t m0 x2d h54 y5a67 ff19 fs2c fc0 sc0 ls0 ws0">will <span class="_ _23"></span>run. <span class="_ _45"> </span>On<span class="_ _35"> </span>Linux <span class="_ _9"></span>and <span class="_ _23"> </span>Solaris, <span class="_ _23"> </span>this <span class="_ _23"> </span>name <span class="_ _23"></span>is<span class="_ _45"> </span><span class="ff1a">lp</span><span class="ls1742">.O<span class="_ _26"></span><span class="lsfa2">nM<span class="_ _b"></span><span class="ls0">ac <span class="_ _23"></span>OS <span class="_ _9"></span>X, <span class="_ _23"> </span>the <span class="_ _23"> </span>name <span class="_ _23"></span>is</span></span></span></div><div class="t m0 x2d h54 y5a68 ff1a fs2c fc0 sc0 ls0 ws0">_lp<span class="ff19 ls1743">.F<span class="_ _49"></span><span class="ls150">re<span class="ls0">eBSD, <span class="_ _47"> </span>however<span class="_ _6"></span><span class="ls1744">,d<span class="_ _5b"></span><span class="ls0">oesn’t <span class="_ _66"> </span>deﬁne <span class="_ _47"> </span>a <span class="_"> </span>separate <span class="_ _66"> </span>account <span class="_ _47"> </span>for <span class="_"> </span>the <span class="_ _66"> </span>printer</span></span></span></span></span></div><div class="t m0 x2d h55 y5a69 ff19 fs2c fc0 sc0 ls0 ws0">spooling daemon, so we use the account reserved for system daemons.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
