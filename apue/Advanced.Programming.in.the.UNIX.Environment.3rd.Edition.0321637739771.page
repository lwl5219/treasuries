<div id="pf303" class="pf w4 h1f" data-page-no="303"><div class="pc pc303 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg303.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h7a ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>19.6<span class="_ _30e"> </span>Using <span class="_"> </span>the<span class="_ _4b"> </span><span class="ff1a">pty<span class="_ _4b"> </span></span>Program<span class="_ _1b"> </span><span class="ff18">737</span></div><div class="t m0 x32 h26 y12f ff19 fsf fc0 sc0 ls0 ws0">In <span class="_ _47"> </span>this <span class="_ _45"> </span>example, <span class="_ _47"> </span>we <span class="_ _45"> </span>assume <span class="_ _47"> </span>that <span class="_ _45"> </span>the<span class="_ _16"> </span><span class="ff1a">SHELL<span class="_"> </span></span>variable <span class="_ _47"> </span>is <span class="_ _45"> </span>the <span class="_ _47"> </span>Korn <span class="_ _45"> </span>shell <span class="_ _47"> </span>(probably</div><div class="t m0 x32 h26 y130 ff1a fsf fc0 sc0 ls0 ws0">/bin/ksh<span class="ff19">). <span class="_ _45"> </span>As<span class="_ _45"> </span>we <span class="_ _3"></span>mentioned <span class="_ _9"></span>earlier<span class="_ _1"></span>,<span class="_ _45"> </span><span class="ff1a">script<span class="_ _45"> </span></span>copies <span class="_ _9"></span>only <span class="_ _9"></span>what <span class="_ _9"></span>is <span class="_ _9"></span>output <span class="_ _9"></span>by <span class="_ _9"></span>the <span class="_ _9"></span>new</span></div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">shell <span class="_ _2"></span>(and <span class="_ _3"></span>any <span class="_ _3"></span>processes <span class="_ _3"></span>that <span class="_ _3"></span>it <span class="_ _2"></span>invokes), <span class="_ _3"></span>but <span class="_ _3"></span>since <span class="_ _3"></span>the <span class="_ _3"></span>line <span class="_ _3"></span>discipline <span class="_ _3"></span>module <span class="_ _3"></span>above <span class="_ _3"></span>the</div><div class="t m0 x32 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">PTY <span class="_ _e"> </span>slave <span class="_ _e"> </span>normally <span class="_"> </span>has <span class="_ _53"> </span>echo <span class="_"> </span>enabled, <span class="_ _53"> </span>most <span class="_"> </span>of <span class="_ _53"> </span>what <span class="_ _e"> </span>we <span class="_"> </span>type <span class="_ _53"> </span>is <span class="_"> </span>also <span class="_ _53"> </span>written <span class="_"> </span>to <span class="_ _53"> </span>the</div><div class="t m0 x32 h26 y133 ff1a fsf fc0 sc0 ls0 ws0">typescript<span class="_ _80"> </span><span class="ff19">ﬁle.</span></div><div class="t m0 x35 h27 y3bd9 ff16 fsf fc0 sc0 ls0 ws0">Running Coprocesses</div><div class="t m0 x32 h2a y3bda ff19 fsf fc0 sc0 ls0 ws0">In Figur<span class="ls15c8">e1<span class="_ _4f"></span><span class="ls0">5.18, the coprocess couldn’t use the standar<span class="ls15c8">dI<span class="_ _d"></span><span class="ls0">/O functions, because standard</span></span></span></span></div><div class="t m0 x32 h2a y2091 ff19 fsf fc0 sc0 ls0 ws0">input and standar<span class="ls15c9">do<span class="_ _4f"></span><span class="ls0">utput do not refer to a terminal, so the standar<span class="ls864">dI<span class="_ _d"></span><span class="ls0">/O functions treat</span></span></span></span></div><div class="t m0 x32 h26 y17b ff19 fsf fc0 sc0 ls0 ws0">them as fully buffer<span class="_ _0"></span>ed. <span class="_"> </span>If<span class="_"> </span>we run the copr<span class="_ _0"></span>ocess under<span class="_"> </span><span class="ff1a">pty<span class="_ _80"> </span></span>by replacing the line</div><div class="t m0 x3f h57 y54d7 ff1a fs2d fc0 sc0 ls0 ws0">if (execl(&quot;./add2&quot;, &quot;add2&quot;, (char *)0) &lt; 0)</div><div class="t m0 x32 h2a y54d8 ff19 fsf fc0 sc0 ls0 ws0">with</div><div class="t m0 x3f h57 y54d9 ff1a fs2d fc0 sc0 ls0 ws0">if (execl(&quot;./pty&quot;, &quot;pty&quot;, &quot;-e&quot;, &quot;add2&quot;, (char *)0) &lt; 0)</div><div class="t m0 x32 h2a y54da ff19 fsf fc0 sc0 ls0 ws0">the program now works, even if the copr<span class="_ _0"></span>ocess uses standar<span class="_ _0"></span><span class="ls44">dI<span class="_ _d"></span><span class="ls0">/O.</span></span></div><div class="t m0 x3f h2a y54db ff19 fsf fc0 sc0 ls0 ws0">Figur<span class="ls36a">e1<span class="_ _8"></span><span class="ls0">9.15 <span class="_ _2"></span>shows <span class="_ _2"></span>the <span class="_ _2"></span>arrangement <span class="_ _2"></span>of <span class="_ _2"></span>processes when <span class="_ _2"></span>we <span class="_ _2"></span>run <span class="_ _2"></span>the <span class="_ _2"></span>coprocess with <span class="_ _2"></span>a</span></span></div><div class="t m0 x32 h2a y54dc ff19 fsf fc0 sc0 ls0 ws0">pseudo <span class="_ _3"></span>terminal <span class="_ _9"></span>as <span class="_ _3"></span>its <span class="_ _9"></span>input <span class="_ _3"></span>and <span class="_ _9"></span>output.<span class="_ _5a"> </span>It <span class="_ _3"></span>is <span class="_ _9"></span>an <span class="_ _3"></span>expansion <span class="_ _9"></span>of <span class="_ _3"></span>Figur<span class="ls15ca">e1<span class="_ _b"></span><span class="ls0">9.6, <span class="_ _9"></span>showing <span class="_ _9"></span>all</span></span></div><div class="t m0 x32 h2a y54dd ff19 fsf fc0 sc0 ls0 ws0">the <span class="_"> </span>process <span class="_ _66"> </span>connections <span class="_ _66"> </span>and <span class="_ _66"> </span>data <span class="_ _47"> </span>ﬂow<span class="_ _6"></span><span class="ls15cb">.T<span class="_ _49"></span><span class="ls0">he <span class="_"> </span>box <span class="_ _47"> </span>labeled <span class="_"> </span>‘‘driving <span class="_"> </span>program’<span class="_ _1"></span>’<span class="_ _61"> </span>is<span class="_ _46"> </span>the</span></span></div><div class="t m0 x32 h26 y54de ff19 fsf fc0 sc0 ls0 ws0">program fr<span class="_ _0"></span>om Figur<span class="_ _0"></span><span class="ls44">e1<span class="_ _d"></span><span class="ls0">5.18, with the<span class="_"> </span><span class="ff1a">execl<span class="_ _66"> </span></span>changed as described previously<span class="_ _4"></span>.</span></span></div><div class="t m0 x76 h2d y54df ff19 fs10 fc0 sc0 ls0 ws0">driving program</div><div class="t m0 x11b h4f y54e0 ff1a fs11 fc0 sc0 ls0 ws0">fork</div><div class="t m0 x11b h4f y54e1 ff1a fs11 fc0 sc0 ls0 ws0">exec</div><div class="t m0 xcc h6d y54e2 ff1a fs12 fc0 sc0 ls0 ws0">pty</div><div class="t m0 x1bb h2f y54e3 ff19 fs12 fc0 sc0 ls0 ws0">parent</div><div class="t m0 x1de h63 y54e4 ff1a fs13 fc0 sc0 ls0 ws0">fork</div><div class="t m0 x1cb h6f y54e5 ff1a fs14 fc0 sc0 ls0 ws0">pty</div><div class="t m0 x1af h31 y54e6 ff19 fs14 fc0 sc0 ls0 ws0">child</div><div class="t m0 x11f h66 y54e7 ff1a fs15 fc0 sc0 ls0 ws0">add2</div><div class="t m0 xe3 h32 y54e8 ff19 fs15 fc0 sc0 ls0 ws0">(coprocess)</div><div class="t m0 xd8 h33 y54e9 ff19 fs16 fc0 sc0 ls0 ws0">terminal</div><div class="t m0 xc2 h33 y54ea ff19 fs16 fc0 sc0 ls0 ws0">line discipline</div><div class="t m0 x175 h83 y54eb ff19 fs36 fc0 sc0 ls0 ws0">terminal</div><div class="t m0 x167 h83 y54ec ff19 fs36 fc0 sc0 ls0 ws0">device driver</div><div class="t m0 xbd h34 y54ed ff19 fs17 fc0 sc0 ls0 ws0">terminal</div><div class="t m0 x1ea h34 y54ee ff19 fs17 fc0 sc0 ls0 ws0">line discipline</div><div class="t m0 x160 h35 y54ef ff19 fs18 fc0 sc0 ls0 ws0">PTY slave</div><div class="t m0 x95 h36 y54f0 ff19 fs19 fc0 sc0 ls0 ws0">PTY master</div><div class="t m0 x17b h8d y54f1 ff1a fs1a fc0 sc0 ls0 ws0">fork<span class="ff19">,<span class="_"> </span></span>exec</div><div class="t m0 x66 h18c y54f2 ff19 fscd fc0 sc0 ls0 ws0">pipe2</div><div class="t m0 x66 h193 y54f3 ff19 fsd0 fc0 sc0 ls0 ws0">pipe1</div><div class="t m0 xd8 h194 y54f4 ff19 fsd1 fc0 sc0 ls0 ws0">user at a</div><div class="t m0 xd8 h194 y54f5 ff19 fsd1 fc0 sc0 ls0 ws0">terminal</div><div class="t m0 x11a h194 y54f6 ff18 fsd1 fc0 sc0 ls0 ws0">Figure 19.15<span class="_ _5a"> </span><span class="ff19">Running a coprocess with a pseudo terminal as its input and output</span></div><div class="t m0 x12a h195 y54f7 ff19 fsd2 fc0 sc0 ls0 ws0">This example <span class="_ _2"></span>shows <span class="_ _2"></span>the <span class="_ _2"></span>need <span class="_ _2"></span>for <span class="_ _2"></span>the<span class="_ _66"> </span><span class="ff1a">-e<span class="_ _66"> </span></span>(no <span class="_ _2"></span>echo) <span class="_ _2"></span>option <span class="_ _2"></span>for <span class="_ _2"></span>the<span class="_ _66"> </span><span class="ff1a">pty<span class="_ _47"> </span></span>program. <span class="_"> </span>The</div><div class="t m0 x32 h195 y54f8 ff1a fsd2 fc0 sc0 ls0 ws0">pty<span class="_ _66"> </span><span class="ff19">program is <span class="_ _2"></span>not <span class="_ _2"></span>running interactively<span class="_ _6"></span><span class="ls15cc">,b<span class="_ _4f"></span><span class="ls0">ecause <span class="_ _2"></span>its <span class="_ _2"></span>standar<span class="ls15cc">di<span class="_ _4f"></span><span class="ls0">nput is <span class="_ _2"></span>not <span class="_ _2"></span>connected <span class="_ _2"></span>to</span></span></span></span></span></div><div class="t m0 x32 h195 y54f9 ff19 fsd2 fc0 sc0 ls15cd ws0">at<span class="_ _43"></span><span class="ls0">erminal. <span class="_ _35"> </span>In<span class="_ _44"> </span>Figur<span class="ls15cd">e1<span class="_ _c"></span><span class="ls0">9.1<span class="_ _1"></span>1, <span class="_ _42"> </span>the<span class="_ _44"> </span><span class="ff1a">interactive<span class="_ _44"> </span></span>ﬂag <span class="_ _42"> </span>defaults <span class="_ _42"> </span>to <span class="_ _42"> </span>false, <span class="_ _42"> </span>since <span class="_ _42"> </span>the <span class="_ _42"> </span>call <span class="_ _42"> </span>to</span></span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
