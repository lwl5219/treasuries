<div id="pf117" class="pf w4 h1f" data-page-no="117"><div class="pc pc117 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg117.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>8.9<span class="_ _22e"> </span>Race <span class="_"> </span>Conditions<span class="_ _1b"> </span><span class="ff18">245</span></div><div class="t m0 x35 h75 y12f ff16 fs2b fc0 sc0 ls0 ws0">8.8<span class="_ _72"> </span><span class="ff1f">wait3<span class="_ _54"> </span></span>and<span class="_ _54"> </span><span class="ff1f">wait4<span class="_ _65"> </span></span>Functions</div><div class="t m0 x32 h26 y4de ff19 fsf fc0 sc0 ls0 ws0">Most <span class="_ _66"> </span>UNIX <span class="_ _47"> </span>system <span class="_ _66"> </span>implementations <span class="_ _47"> </span>pr<span class="_ _0"></span>ovide <span class="_ _66"> </span>two <span class="_ _47"> </span>additional <span class="_ _66"> </span>functions:<span class="_ _61"> </span><span class="ff1a">wait3<span class="_ _61"> </span></span>and</div><div class="t m0 x32 h26 y6d0 ff1a fsf fc0 sc0 ls0 ws0">wait4<span class="ff19 ls9c0">.H<span class="_ _64"></span><span class="ls0">istorically<span class="_ _4"></span><span class="ls9c1">,t<span class="_ _55"></span><span class="ls0">hese <span class="_ _e"> </span>two <span class="_"> </span>variants <span class="_ _53"> </span>descend <span class="_"> </span>fr<span class="_ _0"></span>om <span class="_ _e"> </span>the <span class="_ _e"> </span>BSD <span class="_"> </span>branch <span class="_ _53"> </span>of <span class="_"> </span>the <span class="_ _53"> </span>UNIX</span></span></span></span></div><div class="t m0 x32 h2a y6d1 ff19 fsf fc0 sc0 ls0 ws0">System. <span class="_ _35"> </span>The<span class="_ _35"> </span>only <span class="_ _42"> </span>featur<span class="ls9c2">ep<span class="_ _43"></span><span class="ls45">ro<span class="ls0">vided <span class="_ _23"> </span>by <span class="_ _42"> </span>these <span class="_ _23"> </span>two <span class="_ _42"> </span>functions <span class="_ _23"> </span>that <span class="_ _42"> </span>isn’t <span class="_ _23"> </span>provided <span class="_ _23"> </span>by <span class="_ _42"> </span>the</span></span></span></div><div class="t m0 x32 h26 y6d2 ff1a fsf fc0 sc0 ls0 ws0">wait<span class="ff19">,<span class="_"> </span></span>waitid<span class="ff19 ls9c3">,a<span class="_ _d"></span><span class="ls0">nd<span class="_"> </span><span class="ff1a">waitpid<span class="_ _66"> </span></span>functions is an additional argument that allows the kernel</span></span></div><div class="t m0 x32 h2a y6d3 ff19 fsf fc0 sc0 ls0 ws0">to <span class="_ _23"></span>r<span class="_ _0"></span>eturn <span class="_ _23"></span>a <span class="_ _9"></span>summary <span class="_ _23"></span>of <span class="_ _23"></span>the <span class="_ _9"></span>resources <span class="_ _9"></span>used <span class="_ _23"></span>by <span class="_ _9"></span>the <span class="_ _23"> </span>terminated <span class="_ _23"></span>process <span class="_ _9"></span>and <span class="_ _23"></span>all <span class="_ _9"></span>its <span class="_ _23"> </span>child</div><div class="t m0 x32 h2a y6d4 ff19 fsf fc0 sc0 ls0 ws0">processes.</div><div class="t m0 x3f h57 y2055 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;sys/types.h&gt;</div><div class="t m0 x3f h57 y2056 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;sys/wait.h&gt;</div><div class="t m0 x3f h57 y2057 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;sys/time.h&gt;</div><div class="t m0 x3f h57 y2058 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;sys/resource.h&gt;</div><div class="t m0 x3f h57 y2059 ff1a fs2d fc0 sc0 ls0 ws0">pid_t wait3(int *<span class="ff1b">statloc</span><span class="ls15c">,i<span class="_ _1d"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">options</span><span class="ls15c">,s<span class="_ _5b"></span><span class="ls0">truct rusage *<span class="ff1b">rusage</span>);</span></span></span></span></div><div class="t m0 x3f h57 y205a ff1a fs2d fc0 sc0 ls0 ws0">pid_t wait4(pid_t<span class="_"> </span><span class="ff1b">pid</span><span class="ls15c">,i<span class="_ _1d"></span><span class="ls0">nt *<span class="ff1b">statloc</span><span class="ls15c">,i<span class="_ _5b"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">options</span><span class="ls15c">,s<span class="_ _1d"></span><span class="ls0">truct rusage *<span class="ff1b">rusage</span>);</span></span></span></span></span></span></div><div class="t m0 x1ac h5f y205b ff19 fs2d fc0 sc0 ls0 ws0">Both return: pr<span class="_ _0"></span>ocess ID if OK, 0, or<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x3f h49 y205c ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _9"></span>resour<span class="_ _0"></span>ce <span class="_ _9"></span>information <span class="_ _9"></span>includes <span class="_ _23"></span>such <span class="_ _9"></span>statistics <span class="_ _9"></span>as <span class="_ _9"></span>the <span class="_ _23"></span>amount <span class="_ _9"></span>of <span class="_ _9"></span>user <span class="_ _9"></span>CPU <span class="_ _23"></span>time,</div><div class="t m0 x32 h49 y205d ff19 fs26 fc0 sc0 ls0 ws0">amount of system CPU time, number of page faults, number of signals received, and the</div><div class="t m0 x32 h4d y205e ff19 fs26 fc0 sc0 ls0 ws0">like. <span class="_ _4b"> </span>Refer<span class="_ _4b"> </span>to <span class="_ _e"> </span>the<span class="_ _4b"> </span><span class="ff1a">getrusage</span></div><div class="t m0 xac h49 y205f ff19 fs26 fc0 sc0 ls0 ws0">(</div><div class="t m0 x15e h49 y205e ff19 fs26 fc0 sc0 ls0 ws0">2</div><div class="t m0 x1e2 h49 y205f ff19 fs26 fc0 sc0 ls0 ws0">)</div><div class="t m0 xc1 h49 y205e ff19 fs26 fc0 sc0 ls0 ws0">manual <span class="_ _53"> </span>page <span class="_"> </span>for <span class="_ _53"> </span>additional <span class="_ _53"> </span>details.<span class="_ _48"> </span>(This <span class="_ _e"> </span>resource</div><div class="t m0 x32 h49 y2060 ff19 fs26 fc0 sc0 ls0 ws0">information <span class="_ _23"></span>differs <span class="_ _9"></span>from <span class="_ _9"></span>the <span class="_ _23"> </span>resource <span class="_ _9"></span>limits <span class="_ _23"></span>we <span class="_ _23"></span>described <span class="_ _23"></span>in <span class="_ _9"></span>Section <span class="_ _23"> </span>7.1<span class="_ _1"></span>1.) <span class="_ _35"> </span>Figur<span class="ls9c4">e8<span class="_ _43"></span><span class="ls0">.1<span class="_ _1"></span>1</span></span></div><div class="t m0 x32 h4d y2061 ff19 fs26 fc0 sc0 ls0 ws0">details the various arguments supported by the<span class="_"> </span><span class="ff1a">wait<span class="_ _80"> </span></span>functions.</div><div class="t m0 x1f9 h2e y2062 ff19 fs11 fc0 sc0 ls0 ws0">FreeBSD <span class="_ _141"> </span>Linux<span class="_ _3a"> </span>Mac OS X<span class="_ _7f"> </span>Solaris</div><div class="t m0 x5d h2e y2063 ff19 fs11 fc0 sc0 ls0 ws0">8.0 <span class="_ _215"> </span>3.2.0<span class="_ _76"> </span>10.6.8 <span class="_ _bf"> </span>10</div><div class="t m0 x33 h56 y2064 ff19 fs11 fc0 sc0 ls0 ws0">Function<span class="_ _28"> </span><span class="ff1b">pid<span class="_ _1fb"> </span>options<span class="_ _df"> </span>rusage<span class="_ _6e"> </span></span>POSIX.1</div><div class="t m0 x156 h6d y2065 ff1a fs12 fc0 sc0 ls0 ws0">wait<span class="_ _22d"> </span><span class="ff19 ls9c5">••<span class="_ _5b"></span><span class="ls7a2">•••</span></span></div><div class="t m0 x156 h6d y2066 ff1a fs12 fc0 sc0 ls0 ws0">waitid<span class="_ _1a8"> </span><span class="ff19 ls9c6">•• <span class="_ _16"> </span>•<span class="_ _176"> </span><span class="ls7a2">•••</span></span></div><div class="t m0 x156 h6d y2067 ff1a fs12 fc0 sc0 ls0 ws0">waitpid<span class="_ _13"> </span><span class="ff19 ls9c6">•• <span class="_ _16"> </span>•<span class="_ _7f"> </span><span class="ls7a2">••••</span></span></div><div class="t m0 x156 h63 y2068 ff1a fs13 fc0 sc0 ls0 ws0">wait3<span class="_ _1f8"> </span><span class="ff19 ls9c7">•• <span class="_ _1c3"> </span>•<span class="_ _44"> </span><span class="ls9c8">•••</span></span></div><div class="t m0 x156 h63 y2069 ff1a fs13 fc0 sc0 ls0 ws0">wait4<span class="_ _14"> </span><span class="ff19 ls9c7">••• <span class="_ _179"> </span>•<span class="_ _4b"> </span><span class="ls9c8">•••</span></span></div><div class="t m0 x1f h6f y206a ff18 fs14 fc0 sc0 ls0 ws0">Figure 8.1<span class="_ _0"></span>1<span class="_ _5a"> </span><span class="ff19">Arguments supported by<span class="_"> </span><span class="ff1a">wait<span class="_ _53"> </span></span>functions on various systems</span></div><div class="t m0 x76 h6f y206b ff19 fs14 fc0 sc0 ls0 ws0">The<span class="_ _45"> </span><span class="ff1a">wait3<span class="_ _35"> </span></span>function <span class="_ _42"> </span>was <span class="_"> </span>included <span class="_ _23"> </span>in <span class="_"> </span>earlier <span class="_ _23"> </span>versions <span class="_"> </span>of <span class="_ _42"> </span>the <span class="_ _42"> </span>Single <span class="_ _42"> </span>UNIX <span class="_ _42"> </span>Speciﬁcation.<span class="_ _16"> </span>In</div><div class="t m0 x76 h6f y206c ff19 fs14 fc0 sc0 ls9c9 ws0">Ve<span class="_"> </span><span class="ls0">rsion <span class="_ _47"> </span>2,<span class="_ _61"> </span><span class="ff1a">wait3<span class="_ _16"> </span></span>was <span class="_ _45"> </span>moved <span class="_ _45"> </span>to <span class="_ _45"> </span>the <span class="_ _45"> </span>legacy <span class="_ _45"> </span>category;<span class="_ _46"> </span><span class="ff1a">wait3<span class="_ _61"> </span></span>was <span class="_ _45"> </span>removed <span class="_ _45"> </span>from <span class="_ _47"> </span>the</span></div><div class="t m0 x76 h31 y206d ff19 fs14 fc0 sc0 ls0 ws0">speciﬁcation in V<span class="_ _6"></span>ersion 3.</div><div class="t m0 x35 hfb y206e ff16 fs89 fc0 sc0 ls0 ws0">8.9 <span class="_ _68"> </span>Race<span class="_ _54"> </span>Conditions</div><div class="t m0 x32 h96 y206f ff19 fs49 fc0 sc0 ls0 ws0">For <span class="_ _53"> </span>our <span class="_ _53"> </span>purposes, <span class="_ _e"> </span>a <span class="_ _53"> </span>race <span class="_ _53"> </span>condition <span class="_ _e"> </span>occurs <span class="_ _53"> </span>when <span class="_ _53"> </span>multiple <span class="_ _e"> </span>processes <span class="_ _42"> </span>ar<span class="ls9ca">et<span class="_ _c"></span><span class="ls0">rying <span class="_ _53"> </span>to <span class="_ _53"> </span>do</span></span></div><div class="t m0 x32 h96 y2070 ff19 fs49 fc0 sc0 ls0 ws0">something <span class="_ _9"></span>with <span class="_ _9"></span>shared <span class="_ _9"></span>data <span class="_ _9"></span>and <span class="_ _23"></span>the <span class="_ _9"></span>ﬁnal <span class="_ _9"></span>outcome <span class="_ _9"></span>depends <span class="_ _23"></span>on <span class="_ _9"></span>the <span class="_ _9"></span>order <span class="_ _9"></span>in <span class="_ _9"></span>which <span class="_ _9"></span>the</div><div class="t m0 x32 h9b y2071 ff19 fs49 fc0 sc0 ls0 ws0">processes run. <span class="_"> </span>The<span class="_ _47"> </span><span class="ff1a">fork<span class="_ _66"> </span></span>function is <span class="_ _2"></span>a <span class="_ _2"></span>lively <span class="_ _2"></span>breeding ground for <span class="_ _2"></span>race <span class="_ _2"></span>conditions, <span class="_ _2"></span>if any</div><div class="t m0 x32 h9b y2072 ff19 fs49 fc0 sc0 ls0 ws0">of <span class="_ _2"></span>the <span class="_ _3"></span>logic <span class="_ _2"></span>after <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">fork<span class="_ _47"> </span></span>either <span class="_ _2"></span>explicitly <span class="_ _3"></span>or <span class="_ _2"></span>implicitly <span class="_ _3"></span>depends <span class="_ _3"></span>on <span class="_ _2"></span>whether <span class="_ _3"></span>the <span class="_ _3"></span>parent</div><div class="t m0 x32 h9b y2073 ff19 fs49 fc0 sc0 ls0 ws0">or child runs ﬁrst after <span class="_ _2"></span>the<span class="_"> </span><span class="ff1a">fork</span><span class="ls9cb">.I<span class="_ _4a"></span><span class="ls9cc">ng<span class="_ _d"></span><span class="ls0">eneral, we cannot <span class="_ _2"></span>predict which process runs ﬁrst.</span></span></span></div><div class="t m0 x32 h96 y2074 ff19 fs49 fc0 sc0 ls0 ws0">Even <span class="_ _3"></span>if <span class="_ _9"></span>we <span class="_ _3"></span>knew <span class="_ _3"></span>which <span class="_ _9"></span>process <span class="_ _3"></span>would <span class="_ _3"></span>run <span class="_ _3"></span>ﬁrst, <span class="_ _9"></span>what <span class="_ _3"></span>happens <span class="_ _9"></span>after <span class="_ _3"></span>that <span class="_ _3"></span>process <span class="_ _3"></span>starts</div><div class="t m0 x32 h96 y2075 ff19 fs49 fc0 sc0 ls9cd ws0">ru<span class="ls0">nning depends on the system load and the kernel’s scheduling algorithm.</span></div><a class="l" href="#pff" data-dest-detail='[15,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892409px;bottom:1236.288916px;width:206.686790px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pff" data-dest-detail='[15,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.893259px;bottom:315.315003px;width:134.016403px;height:19.680008px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
