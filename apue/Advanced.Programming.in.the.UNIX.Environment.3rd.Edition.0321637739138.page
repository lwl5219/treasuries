<div id="pf8a" class="pf w4 h1f" data-page-no="8a"><div class="pc pc8a w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg8a.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">104<span class="_ _1b"> </span><span class="ff19">Files <span class="_"> </span>and <span class="_"> </span>Directories <span class="_ _18d"> </span>Chapter<span class="_ _4b"> </span>4</span></div><div class="t m0 x32 h2a y12f ff19 fsf fc0 sc0 ls0 ws0">In <span class="_ _47"> </span>this <span class="_ _47"> </span>example, <span class="_ _47"> </span>the <span class="_ _47"> </span>set-user-ID <span class="_ _47"> </span>program <span class="_ _66"> </span>can <span class="_ _47"> </span>determine <span class="_ _47"> </span>that <span class="_ _47"> </span>the <span class="_ _45"> </span>r<span class="_ _0"></span>eal <span class="_ _47"> </span>user <span class="_ _47"> </span>cannot</div><div class="t m0 x32 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">normally read the ﬁle, even though the<span class="_"> </span><span class="ff1a">open<span class="_ _80"> </span></span>function will succeed.</div><div class="t m0 x76 h2d yf10 ff19 fs10 fc0 sc0 ls0 ws0">In the preceding example and in <span class="_ _2"></span>Chapter 8, we’ll <span class="_ _2"></span>sometimes switch to <span class="_ _2"></span>become the superuser to</div><div class="t m0 x76 h2d yf11 ff19 fs10 fc0 sc0 ls0 ws0">demonstrate <span class="_ _66"> </span>how <span class="_ _66"> </span>something <span class="_ _66"> </span>works.<span class="_ _54"> </span>If <span class="_ _66"> </span>you’r<span class="ls4c4">eo<span class="_ _55"></span><span class="ls4c5">nam<span class="_ _55"></span><span class="ls0">ultiuser <span class="_ _66"> </span>system <span class="_ _66"> </span>and <span class="_ _66"> </span>do <span class="_ _66"> </span>not <span class="_ _66"> </span>have</span></span></span></div><div class="t m0 x76 h2d yf12 ff19 fs10 fc0 sc0 ls0 ws0">superuser permission, you won’t be able to duplicate these examples completely<span class="_ _6"></span>.</div><div class="t m0 x35 h7b yf13 ff16 fs27 fc0 sc0 ls0 ws0">4.8<span class="_ _72"> </span><span class="ff1f">umask<span class="_ _54"> </span></span>Function</div><div class="t m0 x32 h49 yf14 ff19 fs26 fc0 sc0 ls0 ws0">Now <span class="_ _23"></span>that <span class="_ _23"></span>we’ve <span class="_ _23"></span>described <span class="_ _23"></span>the <span class="_ _23"></span>nine <span class="_ _23"></span>permission <span class="_ _9"></span>bits <span class="_ _23"> </span>associated <span class="_ _23"> </span>with <span class="_ _23"> </span>every <span class="_ _23"> </span>ﬁle, <span class="_ _23"> </span>we <span class="_ _23"> </span>can</div><div class="t m0 x32 h49 yf15 ff19 fs26 fc0 sc0 ls0 ws0">describe the ﬁle mode creation mask that is associated with every pr<span class="_ _0"></span>ocess.</div><div class="t m0 x3f h4d yf16 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_"> </span><span class="ff1a">umask<span class="_ _66"> </span></span>function <span class="_ _2"></span>sets <span class="_ _2"></span>the ﬁle <span class="_ _2"></span>mode <span class="_ _2"></span>creation mask for <span class="_ _2"></span>the <span class="_ _2"></span>process and returns the</div><div class="t m0 x32 h49 yf17 ff19 fs26 fc0 sc0 ls0 ws0">previous value.<span class="_ _59"> </span>(This is one of the few functions that doesn’t have an error r<span class="_ _0"></span>eturn.)</div><div class="t m0 x3f h4e yf18 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;sys/stat.h&gt;</div><div class="t m0 x3f h4e yf19 ff1a fs28 fc0 sc0 ls0 ws0">mode_t umask(mode_t<span class="_"> </span><span class="ff1b">cmask</span>);</div><div class="t m0 x77 h7c yf1a ff19 fs28 fc0 sc0 ls0 ws0">Returns: previous ﬁle mode cr<span class="_ _0"></span>eation mask</div><div class="t m0 x32 h60 yf1b ff19 fs2c fc0 sc0 ls0 ws0">The<span class="_ _4b"> </span><span class="ff1b">cmask<span class="_ _44"> </span></span>argument <span class="_ _53"> </span>is <span class="_ _53"> </span>formed <span class="_ _e"> </span>as <span class="_ _53"> </span>the <span class="_ _e"> </span>bitwise <span class="_ _53"> </span>OR <span class="_ _e"> </span>of <span class="_ _53"> </span>any <span class="_ _53"> </span>of <span class="_ _e"> </span>the <span class="_ _53"> </span>nine <span class="_ _e"> </span>constants <span class="_ _53"> </span>from</div><div class="t m0 x32 h54 yf1c ff19 fs2c fc0 sc0 ls0 ws0">Figur<span class="ls142">e4<span class="_ _4f"></span><span class="ls0">.6:<span class="_"> </span><span class="ff1a">S_IRUSR</span>,<span class="_"> </span><span class="ff1a">S_IWUSR</span><span class="ls142">,a<span class="_ _5"></span><span class="ls0">nd so on.</span></span></span></span></div><div class="t m0 x3f h55 yf1d ff19 fs2c fc0 sc0 ls0 ws0">The <span class="_ _23"></span>ﬁle <span class="_ _23"></span>mode <span class="_ _23"> </span>creation <span class="_ _23"></span>mask <span class="_ _23"></span>is <span class="_ _23"></span>used <span class="_ _23"></span>whenever <span class="_ _23"></span>the <span class="_ _23"></span>process <span class="_ _9"></span>creates <span class="_ _23"></span>a <span class="_ _23"></span>new <span class="_ _23"> </span>ﬁle <span class="_ _23"> </span>or <span class="_ _23"> </span>a</div><div class="t m0 x32 h54 yf1e ff19 fs2c fc0 sc0 ls0 ws0">new directory<span class="_ _4"></span><span class="ls4c6">.(<span class="_ _4a"></span><span class="ls0">Recall from Sections <span class="_ _2"></span>3.3 <span class="_ _2"></span>and <span class="_ _2"></span>3.4 <span class="_ _2"></span>our <span class="_ _2"></span>description <span class="_ _2"></span>of <span class="_ _2"></span>the<span class="_ _66"> </span><span class="ff1a">open<span class="_ _47"> </span></span>and<span class="_"> </span><span class="ff1a">creat</span></span></span></div><div class="t m0 x32 h60 yf1f ff19 fs2c fc0 sc0 ls0 ws0">functions. <span class="_ _45"> </span>Both<span class="_ _45"> </span>accept <span class="_ _9"></span>a<span class="_ _45"> </span><span class="ff1b">mode<span class="_ _45"> </span></span>argument <span class="_ _9"></span>that <span class="_ _9"></span>speciﬁes <span class="_ _23"></span>the <span class="_ _9"></span>new <span class="_ _9"></span>ﬁle’s <span class="_ _9"></span>access <span class="_ _23"></span>permission</div><div class="t m0 x32 h60 yf20 ff19 fs2c fc0 sc0 ls0 ws0">bits.) <span class="_ _66"> </span>W<span class="_ _6"></span><span class="ls4c7">ed<span class="_ _4f"></span><span class="ls0">escribe <span class="_ _3"></span>how <span class="_ _2"></span>to <span class="_ _2"></span>create <span class="_ _2"></span>a <span class="_ _2"></span>new <span class="_ _3"></span>directory <span class="_ _2"></span>in <span class="_ _2"></span>Section <span class="_ _2"></span>4.21.<span class="_ _61"> </span>Any <span class="_ _3"></span>bits <span class="_ _2"></span>that <span class="_ _3"></span>are<span class="_"> </span><span class="ff1b">on<span class="_ _47"> </span></span>in</span></span></div><div class="t m0 x32 h60 yf21 ff19 fs2c fc0 sc0 ls0 ws0">the ﬁle mode creation mask ar<span class="_ _0"></span><span class="ls142">et<span class="_ _d"></span><span class="ls0">urned<span class="_"> </span><span class="ff1b">off<span class="_"> </span></span>in the ﬁle’s<span class="_"> </span><span class="ff1b">mode</span>.</span></span></div><div class="t m0 x35 h61 yf22 ff16 fs2c fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h54 yf23 ff19 fs2c fc0 sc0 ls0 ws0">The <span class="_ _53"> </span>program <span class="_ _42"> </span>in <span class="_ _53"> </span>Figur<span class="ls4c8">e4<span class="_ _c"></span><span class="ls0">.9 <span class="_ _53"> </span>creates <span class="_ _42"> </span>two <span class="_ _53"> </span>ﬁles: <span class="_ _53"> </span>one <span class="_ _53"> </span>with <span class="_ _53"> </span>a<span class="_ _4b"> </span><span class="ff1a">umask<span class="_ _44"> </span></span>of <span class="_ _53"> </span>0 <span class="_ _53"> </span>and <span class="_ _53"> </span>one <span class="_ _e"> </span>with <span class="_ _53"> </span>a</span></span></div><div class="t m0 x32 h54 yf24 ff1a fs2c fc0 sc0 ls0 ws0">umask<span class="_ _80"> </span><span class="ff19">that disables all the group and other permission bits.</span></div><div class="t m0 x32 h62 yf25 ff1a fs30 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h62 yf26 ff1a fs30 fc0 sc0 ls0 ws0">#include &lt;fcntl.h&gt;</div><div class="t m0 x32 h62 yf27 ff1a fs30 fc0 sc0 ls0 ws0">#define RWRWRW (S_IRUSR|S_IWUSR|S_IRGRP|S_IWGRP|S_IROTH|S_IWOTH)</div><div class="t m0 x32 h62 yf28 ff1a fs30 fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h62 yf29 ff1a fs30 fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 x32 h62 yf2a ff1a fs30 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h62 yf2b ff1a fs30 fc0 sc0 ls0 ws0">umask(0);</div><div class="t m0 x8a h62 yf2c ff1a fs30 fc0 sc0 ls0 ws0">if (creat(&quot;foo&quot;, RWRWRW) &lt; 0)</div><div class="t m0 x9d h62 yf2d ff1a fs30 fc0 sc0 ls0 ws0">err_sys(&quot;creat error for foo&quot;);</div><div class="t m0 x8a h62 yf2e ff1a fs30 fc0 sc0 ls0 ws0">umask(S_IRGRP | S_IWGRP | S_IROTH | S_IWOTH);</div><div class="t m0 x8a h62 yf2f ff1a fs30 fc0 sc0 ls0 ws0">if (creat(&quot;bar&quot;, RWRWRW) &lt; 0)</div><div class="t m0 x9d h62 yf30 ff1a fs30 fc0 sc0 ls0 ws0">err_sys(&quot;creat error for bar&quot;);</div><div class="t m0 x8a h62 yf31 ff1a fs30 fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h62 yf32 ff1a fs30 fc0 sc0 ls0 ws0">}</div><div class="t m0 xc0 h63 yf33 ff18 fs13 fc0 sc0 ls0 ws0">Figure 4.9<span class="_ _5a"> </span><span class="ff19">Example of<span class="_"> </span><span class="ff1a">umask<span class="_ _e"> </span></span>function</span></div><a class="l" href="#pfd" data-dest-detail='[13,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892201px;bottom:1059.890965px;width:129.335907px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
