<div id="pf277" class="pf w4 h1f" data-page-no="277"><div class="pc pc277 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg277.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>16.3<span class="_ _2c7"> </span>Addressing<span class="_ _1fb"> </span><span class="ff18">597</span></div><div class="t m0 x32 h53 y12f ff16 fs2b fc0 sc0 ls0 ws0">16.3.3 <span class="_ _54"> </span>Address <span class="_"> </span>Lookup</div><div class="t m0 x32 h2a y681 ff19 fsf fc0 sc0 ls0 ws0">Ideally<span class="_ _4"></span>,<span class="_ _59"> </span>an<span class="_ _59"> </span>application <span class="_"> </span>won’t <span class="_ _53"> </span>have <span class="_"> </span>to <span class="_ _e"> </span>be <span class="_"> </span>awar<span class="_ _0"></span>e<span class="_ _4b"> </span>of<span class="_ _59"> </span>the <span class="_"> </span>internal <span class="_ _e"> </span>structure<span class="_ _4b"> </span>of<span class="_ _59"> </span>a<span class="_ _59"> </span>socket</div><div class="t m0 x32 h26 y683 ff19 fsf fc0 sc0 ls0 ws0">address. <span class="_ _51"> </span>If<span class="_ _51"> </span>an <span class="_ _35"> </span>application <span class="_ _44"> </span>simply <span class="_ _35"> </span>passes <span class="_ _35"> </span>socket <span class="_ _35"> </span>addresses <span class="_ _35"> </span>around <span class="_ _35"> </span>as<span class="_ _54"> </span><span class="ff1a">sockaddr</span></div><div class="t m0 x32 h2a y685 ff19 fsf fc0 sc0 ls0 ws0">structur<span class="_ _0"></span>es <span class="_ _23"></span>and <span class="_ _23"> </span>doesn’t <span class="_ _23"> </span>rely <span class="_ _23"></span>on <span class="_ _23"></span>any <span class="_ _23"></span>protocol-speciﬁc <span class="_ _9"></span>features, <span class="_ _23"></span>then <span class="_ _23"></span>the <span class="_ _23"> </span>application <span class="_ _23"> </span>will</div><div class="t m0 x32 h2a y686 ff19 fsf fc0 sc0 ls0 ws0">work with many differ<span class="_ _0"></span>ent pr<span class="_ _0"></span>otocols that provide the same type of service.</div><div class="t m0 x3f h2a y687 ff19 fsf fc0 sc0 ls0 ws0">Historically<span class="_ _4"></span><span class="ls132a">,t<span class="_ _55"></span><span class="ls0">he <span class="_"> </span>BSD <span class="_ _e"> </span>networking <span class="_"> </span>softwar<span class="_ _0"></span><span class="ls132a">eh<span class="_ _4a"></span><span class="ls0">as <span class="_"> </span>pr<span class="_ _0"></span>ovided <span class="_"> </span>interfaces <span class="_ _e"> </span>to <span class="_"> </span>access <span class="_ _e"> </span>the</span></span></span></span></div><div class="t m0 x32 h2a y689 ff19 fsf fc0 sc0 ls0 ws0">various <span class="_ _e"> </span>network <span class="_"> </span>conﬁguration <span class="_ _53"> </span>information.<span class="_ _60"> </span>In <span class="_ _e"> </span>Section <span class="_"> </span>6.7, <span class="_ _53"> </span>we <span class="_"> </span>brieﬂy <span class="_ _e"> </span>discussed <span class="_ _e"> </span>the</div><div class="t m0 x32 h2a y68a ff19 fsf fc0 sc0 ls0 ws0">networking <span class="_ _2"></span>data <span class="_ _2"></span>ﬁles <span class="_ _3"></span>and <span class="_ _2"></span>the <span class="_ _3"></span>functions <span class="_ _2"></span>used <span class="_ _2"></span>to <span class="_ _3"></span>access <span class="_ _2"></span>them.<span class="_ _61"> </span>In <span class="_ _3"></span>this <span class="_ _2"></span>section, <span class="_ _3"></span>we <span class="_ _2"></span>discuss</div><div class="t m0 x32 h2a y68b ff19 fsf fc0 sc0 ls0 ws0">them <span class="_ _45"> </span>in <span class="_ _45"> </span>a <span class="_ _45"> </span>little <span class="_ _47"> </span>mor<span class="lsbca">ed<span class="_ _62"></span><span class="ls0">etail <span class="_ _45"> </span>and <span class="_ _45"> </span>introduce <span class="_ _47"> </span>the <span class="_ _45"> </span>newer <span class="_ _45"> </span>functions <span class="_ _45"> </span>used <span class="_ _45"> </span>to <span class="_ _45"> </span>look <span class="_ _45"> </span>up</span></span></div><div class="t m0 x32 h2a y68c ff19 fsf fc0 sc0 ls0 ws0">addressing information.</div><div class="t m0 x3f h2a y68d ff19 fsf fc0 sc0 ls0 ws0">The network <span class="_ _2"></span>conﬁguration <span class="_ _2"></span>information <span class="_ _2"></span>returned by <span class="_ _2"></span>these <span class="_ _2"></span>functions <span class="_ _2"></span>can <span class="_ _2"></span>be <span class="_ _2"></span>kept in <span class="_ _2"></span>a</div><div class="t m0 x32 h26 y68e ff19 fsf fc0 sc0 ls0 ws0">number <span class="_ _66"> </span>of <span class="_ _66"> </span>places.<span class="_ _50"> </span>This <span class="_ _47"> </span>information <span class="_ _66"> </span>can <span class="_ _47"> </span>be <span class="_"> </span>kept <span class="_ _47"> </span>in <span class="_ _66"> </span>static <span class="_ _47"> </span>ﬁles <span class="_"> </span>(e.g.,<span class="_ _61"> </span><span class="ff1a">/etc/hosts</span>,</div><div class="t m0 x32 h26 y68f ff1a fsf fc0 sc0 ls0 ws0">/etc/services<span class="ff19">), <span class="_ _e"> </span>or <span class="_ _e"> </span>it <span class="_ _e"> </span>can <span class="_"> </span>be <span class="_ _53"> </span>managed <span class="_ _e"> </span>by <span class="_ _e"> </span>a <span class="_"> </span>name <span class="_ _53"> </span>service, <span class="_ _e"> </span>such <span class="_"> </span>as <span class="_ _53"> </span>DNS <span class="_ _e"> </span>(Domain</span></div><div class="t m0 x32 h2a y690 ff19 fsf fc0 sc0 ls0 ws0">Name <span class="_ _44"> </span>System) <span class="_ _44"> </span>or <span class="_ _44"> </span>NIS <span class="_ _44"> </span>(Network <span class="_ _44"> </span>Information <span class="_ _44"> </span>Service).<span class="_ _93"> </span>Regardless <span class="_ _44"> </span>of <span class="_ _44"> </span>wher<span class="_ _0"></span><span class="ls132b">et<span class="_ _52"></span><span class="ls0">he</span></span></div><div class="t m0 x32 h2a y691 ff19 fsf fc0 sc0 ls0 ws0">information is kept, the same functions can be used to access it.</div><div class="t m0 x3f h26 y692 ff19 fsf fc0 sc0 ls0 ws0">The hosts known by a given computer system ar<span class="ls44">ef<span class="_ _4f"></span><span class="ls0">ound by calling<span class="_"> </span><span class="ff1a">gethostent</span>.</span></span></div><div class="t m0 x3f h57 y47a8 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;netdb.h&gt;</div><div class="t m0 x3f h57 y47a9 ff1a fs2d fc0 sc0 ls0 ws0">struct hostent *gethostent(void);</div><div class="t m0 x1d3 h57 y47aa ff19 fs2d fc0 sc0 ls0 ws0">Returns: pointer if OK,<span class="_"> </span><span class="ff1a">NULL<span class="_ _e"> </span></span>on error</div><div class="t m0 x3f h57 y47ab ff1a fs2d fc0 sc0 ls0 ws0">void sethostent(int<span class="_"> </span><span class="ff1b">stayopen</span>);</div><div class="t m0 x3f h57 y47ac ff1a fs2d fc0 sc0 ls0 ws0">void endhostent(void);</div><div class="t m0 x32 h4d y47ad ff19 fs26 fc0 sc0 ls0 ws0">If the <span class="_ _2"></span>host database <span class="_ _2"></span>ﬁle isn’t <span class="_ _2"></span>already open,<span class="_"> </span><span class="ff1a">gethostent<span class="_ _66"> </span></span>will open <span class="_ _2"></span>it.<span class="_ _46"> </span>The<span class="_ _66"> </span><span class="ff1a">gethostent</span></div><div class="t m0 x32 h4d y47ae ff19 fs26 fc0 sc0 ls0 ws0">function <span class="_ _3"></span>returns <span class="_ _2"></span>the <span class="_ _3"></span>next <span class="_ _3"></span>entry <span class="_ _3"></span>in <span class="_ _9"></span>the <span class="_ _3"></span>ﬁle.<span class="_ _16"> </span>The<span class="_ _47"> </span><span class="ff1a">sethostent<span class="_ _47"> </span></span>function <span class="_ _3"></span>will <span class="_ _3"></span>open <span class="_ _3"></span>the <span class="_ _9"></span>ﬁle</div><div class="t m0 x32 h4a y47af ff19 fs26 fc0 sc0 ls0 ws0">or <span class="_ _2"></span>rewind it <span class="_ _2"></span>if <span class="_ _3"></span>it <span class="_ _2"></span>is <span class="_ _2"></span>already open.<span class="_ _61"> </span>When <span class="_ _3"></span>the<span class="_ _66"> </span><span class="ff1b">stayopen<span class="_ _47"> </span></span>argument is <span class="_ _2"></span>set <span class="_ _2"></span>to <span class="_ _3"></span>a <span class="_ _2"></span>nonzer<span class="ls132c">ov<span class="_ _8"></span><span class="ls0">alue,</span></span></div><div class="t m0 x32 h4d y47b0 ff19 fs26 fc0 sc0 ls0 ws0">the <span class="_ _e"> </span>ﬁle <span class="_ _e"> </span>remains <span class="_ _53"> </span>open <span class="_"> </span>after <span class="_ _53"> </span>calling<span class="_ _59"> </span><span class="ff1a">gethostent</span><span class="ls132d">.T<span class="_ _64"></span><span class="ls0">he<span class="_ _4b"> </span><span class="ff1a">endhostent<span class="_ _59"> </span></span>function <span class="_ _53"> </span>can <span class="_"> </span>be</span></span></div><div class="t m0 x32 h49 y47b1 ff19 fs26 fc0 sc0 ls0 ws0">used to close the ﬁle.</div><div class="t m0 x3f h4d y47b2 ff19 fs26 fc0 sc0 ls0 ws0">When<span class="_ _47"> </span><span class="ff1a">gethostent<span class="_ _47"> </span></span><span class="lscc">re</span>turns, <span class="_ _3"></span>we <span class="_ _3"></span>get <span class="_ _2"></span>a <span class="_ _3"></span>pointer <span class="_ _3"></span>to <span class="_ _3"></span>a<span class="_ _47"> </span><span class="ff1a">hostent<span class="_ _47"> </span></span>structure, which <span class="_ _3"></span>might</div><div class="t m0 x32 h4d y47b3 ff19 fs26 fc0 sc0 ls0 ws0">point <span class="_ _42"> </span>to <span class="_ _42"> </span>a <span class="_ _42"> </span>static <span class="_ _42"> </span>data <span class="_ _42"> </span>buffer <span class="_ _42"> </span>that <span class="_ _42"> </span>is <span class="_ _42"> </span>overwritten <span class="_ _42"> </span>each <span class="_ _42"> </span>time <span class="_ _42"> </span>we <span class="_ _42"> </span>call<span class="_ _44"> </span><span class="ff1a">gethostent</span><span class="ls132e">.T<span class="_ _52"></span><span class="ls0">he</span></span></div><div class="t m0 x32 h4d y47b4 ff1a fs26 fc0 sc0 ls0 ws0">hostent<span class="_ _80"> </span><span class="ff19">structure<span class="_"> </span>is<span class="_"> </span>deﬁned to have at least the following members:</span></div><div class="t m0 x3f h4e y47b5 ff1a fs28 fc0 sc0 ls0 ws0">struct hostent {</div><div class="t m0 xf4 h4e y47b6 ff1a fs28 fc0 sc0 ls0 ws0">char <span class="_ _d9"> </span>*h_name;<span class="_ _90"> </span>/* name of host */</div><div class="t m0 xf4 h4e y47b7 ff1a fs28 fc0 sc0 ls0 ws0">char <span class="_"> </span>**h_aliases;<span class="_ _15"> </span>/* pointer to alternate host name array */</div><div class="t m0 xf4 h4e y47b8 ff1a fs28 fc0 sc0 ls0 ws0">int <span class="_ _15"> </span>h_addrtype;<span class="_ _68"> </span>/* address type */</div><div class="t m0 xf4 h4e y47b9 ff1a fs28 fc0 sc0 ls0 ws0">int <span class="_ _15"> </span>h_length; <span class="_ _15"> </span>/*<span class="_"> </span>length in bytes of address */</div><div class="t m0 xf4 h4e y47ba ff1a fs28 fc0 sc0 ls0 ws0">char <span class="_"> </span>**h_addr_list; <span class="_"> </span>/*<span class="_"> </span>pointer to array of network addresses */</div><div class="t m0 xf4 h4e y47bb ff1a fs28 fc0 sc0 ls0 ws0">.</div><div class="t m0 xf4 h4e y47bc ff1a fs28 fc0 sc0 ls0 ws0">.</div><div class="t m0 xf4 h4e y47bd ff1a fs28 fc0 sc0 ls0 ws0">.</div><div class="t m0 x3f h4e y47be ff1a fs28 fc0 sc0 ls0 ws0">};</div><div class="t m0 x32 h49 y47bf ff19 fs26 fc0 sc0 ls0 ws0">The addresses r<span class="_ _0"></span>eturned ar<span class="_ _0"></span>e<span class="_"> </span>in<span class="_"> </span>network byte order<span class="_ _6"></span>.</div><div class="t m0 x3f h4d y47c0 ff19 fs26 fc0 sc0 lsf94 ws0">Tw<span class="_ _9"></span><span class="ls132f">oa<span class="_ _52"></span><span class="ls0">dditional <span class="_ _44"> </span>functions<span class="_ _9"></span>—<span class="_ _9"></span><span class="ff1a">gethostbyname<span class="_ _54"> </span></span>and<span class="_ _65"> </span><span class="ff1a">gethostbyaddr<span class="_ _9"></span></span><span class="ls161">—o<span class="_ _6"></span><span class="ls0">riginally</span></span></span></span></div><div class="t m0 x32 h4d y47c1 ff19 fs26 fc0 sc0 ls0 ws0">wer<span class="ls10c4">ei<span class="_ _4a"></span><span class="ls0">ncluded <span class="_"> </span>with <span class="_ _53"> </span>the<span class="_ _4b"> </span><span class="ff1a">hostent<span class="_ _4b"> </span></span>functions, <span class="_"> </span>but <span class="_ _53"> </span>ar<span class="ls10c4">en<span class="_ _55"></span><span class="ls0">ow <span class="_ _53"> </span>considered <span class="_ _e"> </span>to <span class="_ _e"> </span>be <span class="_ _e"> </span>obsolete.</span></span></span></span></div><div class="t m0 x32 h49 y47c2 ff19 fs26 fc0 sc0 ls0 ws0">They <span class="_ _45"> </span>wer<span class="ls1330">er<span class="_ _7"></span><span class="ls0">emoved <span class="_ _35"> </span>from <span class="_ _45"> </span>V<span class="_ _4"></span>ersion <span class="_ _35"> </span>4 <span class="_ _45"> </span>of <span class="_ _35"> </span>the <span class="_ _45"> </span>Single <span class="_ _35"> </span>UNIX <span class="_ _45"> </span>Speciﬁcation.<span class="_ _5c"> </span><span class="ls164">We<span class="_ _9"></span></span>’ll <span class="_ _35"> </span>see</span></span></div><div class="t m0 x32 h49 y47c3 ff19 fs26 fc0 sc0 lscc ws0">re<span class="ls0">placements for them shortly<span class="_ _6"></span>.</span></div><a class="l" href="#pf12" data-dest-detail='[18,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:156.492009px;bottom:1236.288916px;width:141.264008px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
