<div id="pf69" class="pf w4 h1f" data-page-no="69"><div class="pc pc69 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg69.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h7a ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>3.7<span class="_ _eb"> </span><span class="ff1a">read<span class="_ _44"> </span></span>Function<span class="_ _1b"> </span><span class="ff18">71</span></div><div class="t m0 x35 h75 y12f ff16 fs2b fc0 sc0 ls0 ws0">3.7<span class="_ _72"> </span><span class="ff1f">read<span class="_ _54"> </span></span>Function</div><div class="t m0 x32 h26 y681 ff19 fsf fc0 sc0 ls0 ws0">Data is read fr<span class="_ _0"></span>om an open ﬁle with the<span class="_"> </span><span class="ff1a">read<span class="_ _80"> </span></span>function.</div><div class="t m0 x3f h57 yb37 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;unistd.h&gt;</div><div class="t m0 x3f h57 yb38 ff1a fs2d fc0 sc0 ls0 ws0">ssize_t read(int<span class="_"> </span><span class="ff1b">fd</span><span class="ls15c">,v<span class="_ _1d"></span><span class="ls0">oid *<span class="ff1b">buf</span><span class="ls15c">,s<span class="_ _5b"></span><span class="ls0">ize_t<span class="_"> </span><span class="ff1b">nbytes</span>);</span></span></span></span></div><div class="t m0 x4b h5f yb39 ff19 fs2d fc0 sc0 ls0 ws0">Returns: number of bytes read, 0 if end of ﬁle,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>err<span class="_ _0"></span>or</div><div class="t m0 x32 h4d yb3a ff19 fs26 fc0 sc0 ls0 ws0">If <span class="_ _42"> </span>the<span class="_ _4b"> </span><span class="ff1a">read<span class="_ _44"> </span></span>is <span class="_ _53"> </span>successful, <span class="_ _53"> </span>the <span class="_ _53"> </span>number <span class="_ _53"> </span>of <span class="_ _53"> </span>bytes <span class="_ _53"> </span>read <span class="_ _42"> </span>is <span class="_ _53"> </span>returned. <span class="_ _44"> </span>If<span class="_ _44"> </span>the <span class="_ _53"> </span>end <span class="_ _53"> </span>of <span class="_ _53"> </span>ﬁle <span class="_ _53"> </span>is</div><div class="t m0 x32 h49 yb3b ff19 fs26 fc0 sc0 ls0 ws0">encountered, 0 is r<span class="_ _0"></span>eturned.</div><div class="t m0 x3f h49 yb3c ff19 fs26 fc0 sc0 ls0 ws0">Ther<span class="ls3a5">ea<span class="_ _b"></span><span class="lscc">re <span class="_ _23"></span>s<span class="ls0">everal <span class="_ _9"></span>cases <span class="_ _9"></span>in <span class="_ _9"></span>which <span class="_ _9"></span>the <span class="_ _9"></span>number <span class="_ _9"></span>of <span class="_ _9"></span>bytes <span class="_ _9"></span>actually <span class="_ _9"></span>read <span class="_ _9"></span>is <span class="_ _9"></span>less <span class="_ _9"></span>than <span class="_ _9"></span>the</span></span></span></div><div class="t m0 x32 h49 yb3d ff19 fs26 fc0 sc0 ls0 ws0">amount requested:</div><div class="t m0 x3f h49 yb3e ff19 fs26 fc0 sc0 ls15d ws0">•W<span class="_ _4d"></span><span class="ls0">hen <span class="_ _47"> </span>reading <span class="_ _47"> </span>from <span class="_ _47"> </span>a <span class="_ _45"> </span>r<span class="_ _0"></span>egular <span class="_ _47"> </span>ﬁle, <span class="_ _45"> </span>if <span class="_ _47"> </span>the <span class="_ _45"> </span>end <span class="_ _47"> </span>of <span class="_ _47"> </span>ﬁle <span class="_ _45"> </span>is <span class="_ _47"> </span>reached <span class="_ _47"> </span>befor<span class="ls3a6">et<span class="_ _62"></span><span class="ls0">he</span></span></span></div><div class="t m0 x15 h49 yb3f ff19 fs26 fc0 sc0 lscc ws0">re<span class="ls0">quested <span class="_ _3"></span>number <span class="_ _3"></span>of <span class="_ _3"></span>bytes <span class="_ _3"></span>has <span class="_ _3"></span>been <span class="_ _3"></span>read. <span class="_ _47"> </span>For<span class="_ _47"> </span>example, <span class="_ _3"></span>if <span class="_ _3"></span>30 <span class="_ _3"></span>bytes <span class="_ _3"></span>remain <span class="_ _2"></span>until</span></div><div class="t m0 x15 h4d yb40 ff19 fs26 fc0 sc0 ls0 ws0">the <span class="_ _3"></span>end <span class="_ _3"></span>of <span class="_ _3"></span>ﬁle <span class="_ _3"></span>and <span class="_ _9"></span>we <span class="_ _3"></span>try <span class="_ _3"></span>to <span class="_ _3"></span>read <span class="_ _2"></span>100 <span class="_ _9"></span>bytes,<span class="_ _47"> </span><span class="ff1a">read<span class="_ _47"> </span></span><span class="lscc">re<span class="_ _2"></span></span>turns <span class="_ _3"></span>30.<span class="_ _16"> </span>The <span class="_ _3"></span>next <span class="_ _3"></span>time <span class="_ _9"></span>we</div><div class="t m0 x15 h4d yb41 ff19 fs26 fc0 sc0 ls0 ws0">call<span class="_"> </span><span class="ff1a">read</span>,<span class="_"> </span>it<span class="_"> </span>will return 0 (end of ﬁle).</div><div class="t m0 x3f h49 yb42 ff19 fs26 fc0 sc0 ls15d ws0">•W<span class="_ _4d"></span><span class="ls0">hen reading from a terminal device.<span class="_ _61"> </span>Normally<span class="_ _4"></span>,<span class="_ _66"> </span>up<span class="_ _66"> </span>to<span class="_"> </span>one <span class="_ _2"></span>line is <span class="_ _2"></span>read at a time.</span></div><div class="t m0 x15 h49 yb43 ff19 fs26 fc0 sc0 ls0 ws0">(W<span class="_ _6"></span>e’ll see how to change this default in Chapter 18.)</div><div class="t m0 x3f h49 yb44 ff19 fs26 fc0 sc0 ls15d ws0">•W<span class="_ _4d"></span><span class="ls0">hen <span class="_ _42"> </span>reading <span class="_ _42"> </span>from <span class="_ _42"> </span>a <span class="_ _53"> </span>network.<span class="_ _54"> </span>Buffering <span class="_ _42"> </span>within <span class="_ _53"> </span>the <span class="_ _42"> </span>network <span class="_ _53"> </span>may <span class="_ _53"> </span>cause <span class="_ _42"> </span>less</span></div><div class="t m0 x15 h49 yb45 ff19 fs26 fc0 sc0 ls0 ws0">than the requested amount to be r<span class="_ _0"></span>eturned.</div><div class="t m0 x3f h49 yb46 ff19 fs26 fc0 sc0 ls15d ws0">•W<span class="_ _4d"></span><span class="ls0">hen <span class="_"> </span>reading <span class="_ _66"> </span>from <span class="_"> </span>a <span class="_ _47"> </span>pipe <span class="_"> </span>or <span class="_ _47"> </span>FIFO.<span class="_ _60"> </span>If <span class="_ _47"> </span>the <span class="_"> </span>pipe <span class="_ _47"> </span>contains <span class="_"> </span>fewer <span class="_ _47"> </span>bytes <span class="_"> </span>than</span></div><div class="t m0 x15 h4d yb47 ff19 fs26 fc0 sc0 lscc ws0">re<span class="ls0">quested,<span class="_"> </span><span class="ff1a">read<span class="_ _66"> </span></span>will return only what is available.</span></div><div class="t m0 x3f h49 yb48 ff19 fs26 fc0 sc0 ls15d ws0">•W<span class="_ _4d"></span><span class="ls0">hen <span class="_"> </span>r<span class="_ _0"></span>eading <span class="_"> </span>from <span class="_ _e"> </span>a <span class="_"> </span>recor<span class="_ _0"></span>d-oriented <span class="_"> </span>device.<span class="_ _48"> </span>Some <span class="_"> </span>record-oriented <span class="_ _e"> </span>devices,</span></div><div class="t m0 x15 h49 yb49 ff19 fs26 fc0 sc0 ls0 ws0">such as magnetic tape, can return up to a single r<span class="_ _0"></span>ecor<span class="_ _0"></span>d<span class="_"> </span>at<span class="_"> </span>a<span class="_"> </span>time.</div><div class="t m0 x3f h49 yb4a ff19 fs26 fc0 sc0 ls15d ws0">•W<span class="_ _4d"></span><span class="ls0">hen <span class="_ _42"> </span>interrupted <span class="_ _53"> </span>by <span class="_ _42"> </span>a <span class="_ _53"> </span>signal <span class="_ _42"> </span>and <span class="_ _53"> </span>a <span class="_ _53"> </span>partial <span class="_ _42"> </span>amount <span class="_ _53"> </span>of <span class="_ _53"> </span>data <span class="_ _42"> </span>has <span class="_ _53"> </span>already <span class="_ _42"> </span>been</span></div><div class="t m0 x15 h49 yb4b ff19 fs26 fc0 sc0 lscc ws0">re<span class="ls0">ad. <span class="_"> </span>W<span class="_ _6"></span><span class="lsd3">ed<span class="_ _5"></span><span class="ls0">iscuss this further in Section 10.5.</span></span></span></div><div class="t m0 x3f h49 yb4c ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _9"></span>read <span class="_ _3"></span>operation <span class="_ _9"></span>starts <span class="_ _9"></span>at <span class="_ _9"></span>the <span class="_ _3"></span>ﬁle’s <span class="_ _9"></span>current <span class="_ _9"></span>offset. <span class="_ _47"> </span>Befor<span class="ls3a7">eas<span class="_ _b"></span><span class="ls0">uccessful <span class="_ _9"></span>return, <span class="_ _3"></span>the</span></span></div><div class="t m0 x32 h49 yb4d ff19 fs26 fc0 sc0 ls0 ws0">offset is incr<span class="_ _0"></span>emented by the number of bytes actually r<span class="_ _0"></span>ead.</div><div class="t m0 x3f h49 yb4e ff19 fs26 fc0 sc0 ls0 ws0">POSIX.1 <span class="_ _47"> </span>changed <span class="_ _47"> </span>the <span class="_ _47"> </span>prototype <span class="_ _47"> </span>for <span class="_ _47"> </span>this <span class="_ _47"> </span>function <span class="_ _45"> </span>in <span class="_ _47"> </span>several <span class="_ _47"> </span>ways.<span class="_ _5f"> </span>The <span class="_ _47"> </span>classic</div><div class="t m0 x32 h49 yb4f ff19 fs26 fc0 sc0 ls0 ws0">deﬁnition is</div><div class="t m0 x3f h4e yb50 ff1a fs28 fc0 sc0 ls0 ws0">int read(int<span class="_"> </span><span class="ff1b">fd</span><span class="ls1b6">,c<span class="_ _1d"></span><span class="ls0">har *<span class="ff1b">buf</span><span class="ls1b6">,u<span class="_ _5b"></span><span class="ls0">nsigned<span class="_"> </span><span class="ff1b">nbytes</span>);</span></span></span></span></div><div class="t m0 x3f h4d yb51 ff19 fs26 fc0 sc0 ls15d ws0">•F<span class="_ _4d"></span><span class="ls0">irst, the <span class="_ _2"></span>second argument was <span class="_ _2"></span>changed from<span class="_"> </span><span class="ff1a">char <span class="_ _d"></span>*<span class="_ _66"> </span><span class="ff19">to<span class="_"> </span></span>void <span class="_ _d"></span>*<span class="_ _66"> </span><span class="ff19">to <span class="_ _2"></span>be consistent</span></span></span></div><div class="t m0 x15 h4d yb52 ff19 fs26 fc0 sc0 ls0 ws0">with ISO C: the type<span class="_"> </span><span class="ff1a">void <span class="_ _4f"></span>*<span class="_ _66"> </span><span class="ff19">is used for generic pointers.</span></span></div><div class="t m0 x3f h4d yb53 ff19 fs26 fc0 sc0 ls15d ws0">•N<span class="_ _4d"></span><span class="ls0">ext, the <span class="_ _2"></span>return value was <span class="_ _2"></span>required to be <span class="_ _2"></span>a signed <span class="_ _2"></span>integer <span class="_ _2"></span>(<span class="ff1a">ssize_t</span>)<span class="_"> </span>to<span class="_ _66"> </span>return a</span></div><div class="t m0 x15 h49 yb54 ff19 fs26 fc0 sc0 ls0 ws0">positive byte count, 0 (for end of ﬁle), or<span class="_"> </span><span class="ff20">−</span><span class="lsd3">1(<span class="_ _d"></span><span class="ls0">for an error).</span></span></div><div class="t m0 x3f h49 yb55 ff19 fs26 fc0 sc0 ls15d ws0">•F<span class="_ _4d"></span><span class="ls0">inally<span class="_ _4"></span><span class="ls3a8">,t<span class="_ _8"></span><span class="ls0">he <span class="_ _9"></span>thir<span class="ls3a8">da<span class="_ _b"></span><span class="lscc">rg<span class="ls0">ument <span class="_ _9"></span>historically <span class="_ _3"></span>has <span class="_ _3"></span>been <span class="_ _9"></span>an <span class="_ _3"></span>unsigned <span class="_ _3"></span>integer<span class="_ _1"></span><span class="ls3a8">,t<span class="_ _8"></span><span class="ls3a9">oa<span class="_ _8"></span><span class="ls0">llow <span class="_ _3"></span>a</span></span></span></span></span></span></span></span></span></div><div class="t m0 x15 h49 yb56 ff19 fs26 fc0 sc0 ls0 ws0">16</div><div class="t m0 x9d h49 yb57 ff19 fs26 fc0 sc0 ls0 ws0">-</div><div class="t m0 x8f h49 yb56 ff19 fs26 fc0 sc0 ls0 ws0">bit <span class="_ _42"> </span>implementation <span class="_ _23"> </span>to <span class="_ _42"> </span>read <span class="_ _23"> </span>or <span class="_ _42"> </span>write <span class="_ _42"> </span>up <span class="_ _42"> </span>to <span class="_ _23"> </span>65,534 <span class="_ _42"> </span>bytes <span class="_ _42"> </span>at <span class="_ _42"> </span>a <span class="_ _23"> </span>time.<span class="_ _54"> </span><span class="ls3aa">Wi<span class="_ _3"></span></span>th <span class="_ _42"> </span>the</div><div class="t m0 x15 h4d yb58 ff19 fs26 fc0 sc0 ls0 ws0">1990 POSIX.1 standard, the primitive system data type<span class="_"> </span><span class="ff1a">ssize_t<span class="_ _66"> </span></span>was introduced</div><div class="t m0 x15 h4d yb59 ff19 fs26 fc0 sc0 ls0 ws0">to <span class="_ _3"></span>provide <span class="_ _9"></span>the <span class="_ _3"></span>signed <span class="_ _9"></span>return <span class="_ _3"></span>value, <span class="_ _9"></span>and <span class="_ _9"></span>the <span class="_ _9"></span>unsigned<span class="_ _45"> </span><span class="ff1a">size_t<span class="_ _47"> </span></span>was <span class="_ _9"></span>used <span class="_ _9"></span>for <span class="_ _3"></span>the</div><div class="t m0 x15 h4d yb5a ff19 fs26 fc0 sc0 ls0 ws0">thir<span class="lsd3">da<span class="_ _4f"></span><span class="lscc">rg<span class="_ _2"></span><span class="ls0">ument. <span class="_"> </span>(Recall<span class="_"> </span>the<span class="_"> </span><span class="ff1a">SSIZE_MAX<span class="_ _80"> </span></span>constant from Section 2.5.2.)</span></span></span></div><a class="l" href="#pfc" data-dest-detail='[12,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892409px;bottom:1236.288916px;width:122.135795px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
