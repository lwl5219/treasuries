<div id="pf114" class="pf w4 h1f" data-page-no="114"><div class="pc pc114 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg114.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">242<span class="_ _1b"> </span><span class="ff19">Process <span class="_"> </span>Contr<span class="_ _0"></span>ol <span class="_ _222"> </span>Chapter<span class="_ _4b"> </span>8</span></div><div class="t m0 x32 h26 y12f ff19 fsf fc0 sc0 ls0 ws0">The<span class="_"> </span><span class="ff1a">waitpid<span class="_ _66"> </span></span>function <span class="_ _2"></span>returns the process ID of <span class="_ _2"></span>the child <span class="_ _2"></span>that terminated <span class="_ _2"></span>and <span class="_ _2"></span>stores the</div><div class="t m0 x32 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">child’s <span class="_ _3"></span>termination <span class="_ _3"></span>status <span class="_ _3"></span>in <span class="_ _3"></span>the <span class="_ _9"></span>memory <span class="_ _3"></span>location <span class="_ _3"></span>pointed <span class="_ _3"></span>to <span class="_ _3"></span>by<span class="_ _45"> </span><span class="ff1b">statloc</span><span class="ls9a9">.W<span class="_ _7"></span><span class="ls0">ith<span class="_ _45"> </span><span class="ff1a">wait</span><span class="ls9aa">,t<span class="_ _b"></span><span class="ls0">he</span></span></span></span></div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">only real error is if the calling process has no <span class="_ _2"></span>children. <span class="_"> </span>(Another<span class="_"> </span>error r<span class="_ _0"></span>eturn is possible,</div><div class="t m0 x32 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">in <span class="_ _42"> </span>case <span class="_ _23"> </span>the <span class="_ _42"> </span>function <span class="_ _42"> </span>call <span class="_ _42"> </span>is <span class="_ _42"> </span>interrupted <span class="_ _23"> </span>by <span class="_ _42"> </span>a <span class="_ _42"> </span>signal.<span class="_ _54"> </span><span class="ls5f">We<span class="_ _9"></span></span>’ll <span class="_ _42"> </span>discuss <span class="_ _42"> </span>this <span class="_ _23"> </span>in <span class="_ _42"> </span>Chapter <span class="_ _42"> </span>10.)</div><div class="t m0 x32 h26 y133 ff19 fsf fc0 sc0 ls65 ws0">Wi<span class="_ _3"></span><span class="ls0">th<span class="_ _44"> </span><span class="ff1a">waitpid</span><span class="ls9ab">,h<span class="_ _c"></span><span class="ls0">owever<span class="_ _1"></span><span class="ls9ab">,i<span class="_ _c"></span><span class="ls0">t’s <span class="_ _53"> </span>also <span class="_ _53"> </span>possible <span class="_ _53"> </span>to <span class="_ _53"> </span>get <span class="_ _53"> </span>an <span class="_ _53"> </span>error <span class="_ _42"> </span>if <span class="_ _53"> </span>the <span class="_ _42"> </span>speciﬁed <span class="_ _53"> </span>process <span class="_ _42"> </span>or</span></span></span></span></span></div><div class="t m0 x32 h2a y134 ff19 fsf fc0 sc0 ls0 ws0">process gr<span class="_ _0"></span>oup does not exist or is not a child of the calling pr<span class="_ _0"></span>ocess.</div><div class="t m0 x3f h26 y135 ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _16"> </span><span class="ff1b">options<span class="_ _5a"> </span></span>argument <span class="_ _47"> </span>lets <span class="_ _45"> </span>us <span class="_ _45"> </span>further <span class="_ _45"> </span>contr<span class="_ _0"></span>ol <span class="_ _45"> </span>the <span class="_ _47"> </span>operation <span class="_ _45"> </span>of<span class="_ _5a"> </span><span class="ff1a">waitpid</span><span class="ls9ac">.T<span class="_ _95"></span><span class="ls0">his</span></span></div><div class="t m0 x32 h2a y136 ff19 fsf fc0 sc0 ls0 ws0">argument either is <span class="_ _2"></span>0 or <span class="_ _2"></span>is <span class="_ _2"></span>constructed from the <span class="_ _2"></span>bitwise OR <span class="_ _2"></span>of <span class="_ _2"></span>the constants <span class="_ _2"></span>in <span class="_ _2"></span>Figur<span class="ls9ad">e8<span class="_ _8"></span><span class="ls0">.7.</span></span></div><div class="t m0 x76 h52 y1ff5 ff19 fs2a fc0 sc0 ls0 ws0">FreeBSD 8.0 and Solaris 10 support one additional, but nonstandard,<span class="_"> </span><span class="ff1b">option<span class="_"> </span></span>constant.<span class="_ _35"> </span><span class="ff1a">WNOWAIT</span></div><div class="t m0 x76 h52 y1ff6 ff19 fs2a fc0 sc0 ls0 ws0">has <span class="_ _9"></span>the <span class="_ _9"></span>system <span class="_ _9"></span>keep <span class="_ _9"></span>the <span class="_ _9"></span>process <span class="_ _9"></span>whose <span class="_ _9"></span>termination <span class="_ _9"></span>status <span class="_ _9"></span>is <span class="_ _9"></span>returned <span class="_ _3"></span>by<span class="_ _47"> </span><span class="ff1a">waitpid<span class="_ _47"> </span></span>in <span class="_ _9"></span>a <span class="_ _9"></span>wait</div><div class="t m0 x76 h51 y1ff7 ff19 fs2a fc0 sc0 ls0 ws0">state, so that it may be waited for again.</div><div class="t m0 x7c h2d y1ff8 ff19 fs10 fc0 sc0 ls0 ws0">Constant <span class="_ _22b"> </span>Description</div><div class="t m0 xc2 h4f y1ff9 ff1a fs11 fc0 sc0 ls0 ws0">WCONTINUED<span class="_ _6e"> </span><span class="ff19">If the implementation supports job control, the status of any child</span></div><div class="t m0 x12b h56 y1ffa ff19 fs11 fc0 sc0 ls0 ws0">speciﬁed by<span class="_"> </span><span class="ff1b">pid<span class="_"> </span></span>that has been continued after being stopped, but</div><div class="t m0 x12b h2e y1ffb ff19 fs11 fc0 sc0 ls0 ws0">whose status has not yet been reported, is r<span class="_ _0"></span>eturned (XSI option).</div><div class="t m0 xc2 h6d y1ffc ff1a fs12 fc0 sc0 ls0 ws0">WNOHANG<span class="_ _6c"> </span><span class="ff19">The<span class="_"> </span></span>waitpid<span class="_ _e"> </span><span class="ff19">function will not block if a child speciﬁed by<span class="_"> </span><span class="ff1b">pid<span class="_"> </span></span>is not</span></div><div class="t m0 x12b h2f y1ffd ff19 fs12 fc0 sc0 ls0 ws0">immediately available.<span class="_ _35"> </span>In this case, the return value is 0.</div><div class="t m0 xc2 h63 y1ffe ff1a fs13 fc0 sc0 ls0 ws0">WUNTRACED<span class="_ _75"> </span><span class="ff19">If the implementation supports job control, the status of any child</span></div><div class="t m0 x12b hca y1fff ff19 fs13 fc0 sc0 ls0 ws0">speciﬁed by<span class="_"> </span><span class="ff1b">pid<span class="_"> </span></span>that has stopped, and whose status has not been</div><div class="t m0 x12b h63 y2000 ff19 fs13 fc0 sc0 ls4d0 ws0">re<span class="ls0">ported since it has stopped, is returned. <span class="_"> </span>The<span class="_"> </span><span class="ff1a">WIFSTOPPED<span class="_ _53"> </span></span>macro</span></div><div class="t m0 x12b h30 y2001 ff19 fs13 fc0 sc0 ls0 ws0">determines whether the return value corr<span class="_ _0"></span>esponds to a stopped child</div><div class="t m0 x12b h30 y2002 ff19 fs13 fc0 sc0 ls0 ws0">process.</div><div class="t m0 xbf h6f y2003 ff18 fs14 fc0 sc0 ls0 ws0">Figure 8.7<span class="_ _35"> </span><span class="ff19">The<span class="_"> </span><span class="ff1b">options<span class="_"> </span></span>constants for<span class="_"> </span><span class="ff1a">waitpid</span></span></div><div class="t m0 x3f h9b y2004 ff19 fs49 fc0 sc0 ls0 ws0">The<span class="_ _44"> </span><span class="ff1a">waitpid<span class="_ _44"> </span></span>function <span class="_ _53"> </span>provides <span class="_ _53"> </span>three <span class="_ _42"> </span>features <span class="_ _42"> </span>that <span class="_ _53"> </span>aren’t <span class="_ _42"> </span>provided <span class="_ _42"> </span>by <span class="_ _53"> </span>the<span class="_ _4b"> </span><span class="ff1a">wait</span></div><div class="t m0 x32 h96 y2005 ff19 fs49 fc0 sc0 ls0 ws0">function.</div><div class="t m0 x3f h9b y2006 ff19 fs49 fc0 sc0 ls0 ws0">1. <span class="_ _51"> </span>The<span class="_ _66"> </span><span class="ff1a">waitpid<span class="_ _66"> </span></span>function <span class="_ _2"></span>lets <span class="_ _2"></span>us <span class="_ _2"></span>wait for <span class="_ _2"></span>one <span class="_ _2"></span>particular <span class="_ _2"></span>process, whereas the<span class="_ _66"> </span><span class="ff1a">wait</span></div><div class="t m0 x41 h96 y2007 ff19 fs49 fc0 sc0 ls0 ws0">function <span class="_ _9"></span>returns <span class="_ _3"></span>the <span class="_ _9"></span>status <span class="_ _9"></span>of <span class="_ _9"></span>any <span class="_ _9"></span>terminated <span class="_ _3"></span>child.<span class="_ _5a"> </span><span class="ls9ae">We<span class="_ _23"></span></span>’ll <span class="_ _3"></span>return <span class="_ _9"></span>to <span class="_ _9"></span>this <span class="_ _9"></span>feature</div><div class="t m0 x41 h9b y2008 ff19 fs49 fc0 sc0 ls0 ws0">when we discuss the<span class="_"> </span><span class="ff1a">popen<span class="_ _80"> </span></span>function.</div><div class="t m0 x3f h9b y2009 ff19 fs49 fc0 sc0 ls0 ws0">2. <span class="_ _51"> </span>The<span class="_ _46"> </span><span class="ff1a">waitpid<span class="_ _46"> </span></span>function <span class="_ _66"> </span>provides <span class="_"> </span>a <span class="_"> </span>nonblocking <span class="_ _66"> </span>version <span class="_ _66"> </span>of<span class="_ _46"> </span><span class="ff1a">wait</span><span class="ls9af">.T<span class="_ _5d"></span><span class="ls0">her<span class="ls9b0">ea<span class="_ _5b"></span><span class="ls4a6">re</span></span></span></span></div><div class="t m0 x41 h96 y200a ff19 fs49 fc0 sc0 ls0 ws0">times when we want to fetch a child’s status, but we don’t want to block.</div><div class="t m0 x3f h9b y200b ff19 fs49 fc0 sc0 ls0 ws0">3. <span class="_ _51"> </span>The<span class="_ _44"> </span><span class="ff1a">waitpid<span class="_ _35"> </span></span>function <span class="_ _42"> </span>provides <span class="_ _42"> </span>support <span class="_ _42"> </span>for <span class="_ _42"> </span>job <span class="_ _42"> </span>control <span class="_ _42"> </span>with <span class="_ _42"> </span>the<span class="_ _44"> </span><span class="ff1a">WUNTRACED</span></div><div class="t m0 x41 h9b y200c ff19 fs49 fc0 sc0 ls0 ws0">and<span class="_"> </span><span class="ff1a">WCONTINUED<span class="_ _80"> </span></span>options.</div><div class="t m0 x35 h97 y200d ff16 fs49 fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h96 y200e ff19 fs49 fc0 sc0 ls0 ws0">Recall <span class="_ _e"> </span>our <span class="_ _e"> </span>discussion <span class="_ _e"> </span>in <span class="_ _e"> </span>Section <span class="_ _e"> </span>8.5 <span class="_"> </span>about <span class="_ _53"> </span>zombie <span class="_ _e"> </span>processes. <span class="_ _4b"> </span>If<span class="_ _4b"> </span>we <span class="_ _e"> </span>want <span class="_"> </span>to <span class="_ _53"> </span>write <span class="_ _e"> </span>a</div><div class="t m0 x32 h9b y200f ff19 fs49 fc0 sc0 ls0 ws0">process so <span class="_ _3"></span>that <span class="_ _2"></span>it<span class="_ _47"> </span><span class="ff1a">fork</span><span class="ls9b1">sac<span class="_ _8"></span><span class="ls0">hild <span class="_ _3"></span>but <span class="_ _2"></span>we <span class="_ _3"></span>don’t <span class="_ _2"></span>want <span class="_ _2"></span>to <span class="_ _3"></span>wait <span class="_ _2"></span>for <span class="_ _2"></span>the <span class="_ _3"></span>child <span class="_ _2"></span>to <span class="_ _2"></span>complete <span class="_ _3"></span>and</span></span></div><div class="t m0 x32 h9b y2010 ff19 fs49 fc0 sc0 ls0 ws0">we don’t <span class="_ _2"></span>want <span class="_ _2"></span>the <span class="_ _2"></span>child <span class="_ _2"></span>to <span class="_ _2"></span>become <span class="_ _2"></span>a <span class="_ _2"></span>zombie <span class="_ _2"></span>until <span class="_ _2"></span>we <span class="_ _2"></span>terminate, the <span class="_ _2"></span>trick <span class="_ _2"></span>is <span class="_ _2"></span>to <span class="_ _2"></span>call<span class="_ _47"> </span><span class="ff1a">fork</span></div><div class="t m0 x32 h96 y2011 ff19 fs49 fc0 sc0 ls0 ws0">twice. <span class="_"> </span>The<span class="_"> </span>program in Figur<span class="_ _0"></span><span class="ls48d">e8<span class="_ _d"></span><span class="ls0">.8 does this.</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
