<div id="pf24b" class="pf w4 h1f" data-page-no="24b"><div class="pc pc24b w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg24b.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>15.5<span class="_ _2b8"> </span>FIFOs<span class="_ _1b"> </span><span class="ff18">553</span></div><div class="t m0 x3f h57 y1295 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;sys/stat.h&gt;</div><div class="t m0 x3f h57 y19f8 ff1a fs2d fc0 sc0 ls0 ws0">int mkfifo(const char *<span class="ff1b">path</span><span class="ls15c">,m<span class="_ _1d"></span><span class="ls0">ode_t<span class="_"> </span><span class="ff1b">mode</span>);</span></span></div><div class="t m0 x3f h57 y19f9 ff1a fs2d fc0 sc0 ls0 ws0">int mkfifoat(int<span class="_"> </span><span class="ff1b">fd</span><span class="ls15c">,c<span class="_ _1d"></span><span class="ls0">onst char *<span class="ff1b">path</span><span class="ls15c">,m<span class="_ _5b"></span><span class="ls0">ode_t<span class="_"> </span><span class="ff1b">mode</span>);</span></span></span></span></div><div class="t m0 x1af h5f y19fa ff19 fs2d fc0 sc0 ls0 ws0">Both return: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>err<span class="_ _0"></span>or</div><div class="t m0 x32 h4d y19fb ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _4b"> </span>speciﬁcation <span class="_ _4b"> </span>of <span class="_ _4b"> </span>the<span class="_ _65"> </span><span class="ff1b">mode<span class="_ _65"> </span></span>argument <span class="_ _44"> </span>is <span class="_ _4b"> </span>the <span class="_ _4b"> </span>same <span class="_ _4b"> </span>as <span class="_ _4b"> </span>for <span class="_ _4b"> </span>the<span class="_ _65"> </span><span class="ff1a">open<span class="_ _48"> </span></span>function</div><div class="t m0 x32 h49 y19fc ff19 fs26 fc0 sc0 ls0 ws0">(Section <span class="_ _2"></span>3.3).<span class="_ _46"> </span>The <span class="_ _2"></span>rules <span class="_ _2"></span>for <span class="_ _2"></span>the <span class="_ _2"></span>user <span class="_ _2"></span>and <span class="_ _2"></span>group <span class="_ _2"></span>ownership <span class="_ _2"></span>of <span class="_ _2"></span>the <span class="_ _2"></span>new <span class="_ _2"></span>FIFO <span class="_ _2"></span>ar<span class="ls40a">et<span class="_ _8"></span><span class="ls0">he <span class="_ _2"></span>same</span></span></div><div class="t m0 x32 h49 y19fd ff19 fs26 fc0 sc0 ls0 ws0">as we described in Section 4.6.</div><div class="t m0 x3f h4d y19fe ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_"> </span><span class="ff1a">mkfifoat<span class="_ _80"> </span></span>function is <span class="_ _2"></span>similar to the<span class="_"> </span><span class="ff1a">mkfifo<span class="_ _66"> </span></span>function, except that it can be used</div><div class="t m0 x32 h4a y19ff ff19 fs26 fc0 sc0 ls0 ws0">to <span class="_ _47"> </span>create <span class="_ _47"> </span>a <span class="_ _47"> </span>FIFO <span class="_ _45"> </span>in <span class="_ _47"> </span>a <span class="_ _47"> </span>location <span class="_ _45"> </span>r<span class="_ _0"></span>elative <span class="_ _47"> </span>to <span class="_ _45"> </span>the <span class="_ _47"> </span>directory <span class="_ _47"> </span>repr<span class="_ _1"></span>esented <span class="_ _45"> </span>by <span class="_ _47"> </span>the<span class="_ _16"> </span><span class="ff1b">fd<span class="_ _16"> </span></span>ﬁle</div><div class="t m0 x32 h4d y1a00 ff19 fs26 fc0 sc0 ls0 ws0">descriptor argument. <span class="_"> </span>Like<span class="_"> </span>the other<span class="_"> </span><span class="ff1a">*at<span class="_ _80"> </span></span>functions, ther<span class="lsd3">ea<span class="_ _4f"></span><span class="lscc">re <span class="_ _2"></span>t<span class="_ _2"></span><span class="ls0">hree cases:</span></span></span></div><div class="t m0 x3f h4a y4301 ff19 fs26 fc0 sc0 ls0 ws0">1. <span class="_ _51"> </span>If<span class="_ _35"> </span>the<span class="_ _35"> </span><span class="ff1b">path<span class="_ _35"> </span></span>parameter <span class="_ _23"></span>speciﬁes <span class="_ _23"> </span>an <span class="_ _23"> </span>absolute <span class="_ _23"> </span>pathname, <span class="_ _42"> </span>then <span class="_ _23"></span>the<span class="_ _35"> </span><span class="ff1b">fd<span class="_ _35"> </span></span>parameter <span class="_ _23"></span>is</div><div class="t m0 x41 h4d y4302 ff19 fs26 fc0 sc0 ls0 ws0">ignored and the<span class="_"> </span><span class="ff1a">mkfifoat<span class="_ _80"> </span></span>function behaves like the<span class="_"> </span><span class="ff1a">mkfifo<span class="_ _80"> </span></span>function.</div><div class="t m0 x3f h4a y4303 ff19 fs26 fc0 sc0 ls0 ws0">2. <span class="_ _51"> </span>If<span class="_ _44"> </span>the<span class="_ _4b"> </span><span class="ff1b">path<span class="_ _44"> </span></span>parameter <span class="_ _53"> </span>speciﬁes <span class="_ _42"> </span>a <span class="_ _53"> </span>relative <span class="_ _42"> </span>pathname <span class="_ _53"> </span>and <span class="_ _53"> </span>the<span class="_ _44"> </span><span class="ff1b">fd<span class="_ _4b"> </span></span>parameter <span class="_ _53"> </span>is <span class="_ _42"> </span>a</div><div class="t m0 x41 h49 y4304 ff19 fs26 fc0 sc0 ls0 ws0">valid <span class="_ _2"></span>ﬁle <span class="_ _3"></span>descriptor <span class="_ _3"></span>for <span class="_ _3"></span>an <span class="_ _3"></span>open <span class="_ _3"></span>directory<span class="_ _4"></span><span class="ls11bb">,t<span class="_ _8"></span><span class="ls0">he <span class="_ _3"></span>pathname <span class="_ _3"></span>is <span class="_ _3"></span>evaluated <span class="_ _3"></span>relative <span class="_ _2"></span>to</span></span></div><div class="t m0 x41 h49 y4305 ff19 fs26 fc0 sc0 ls0 ws0">this directory<span class="_ _4"></span>.</div><div class="t m0 x3f h4a y4306 ff19 fs26 fc0 sc0 ls0 ws0">3. <span class="_ _51"> </span>If<span class="_ _47"> </span>the<span class="_ _47"> </span><span class="ff1b">path<span class="_ _47"> </span></span>parameter <span class="_ _2"></span>speciﬁes <span class="_ _3"></span>a <span class="_ _3"></span>relative <span class="_ _2"></span>pathname <span class="_ _3"></span>and <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1b">fd<span class="_ _47"> </span></span>parameter <span class="_ _2"></span>has <span class="_ _3"></span>the</div><div class="t m0 x41 h4d y4307 ff19 fs26 fc0 sc0 ls0 ws0">special <span class="_ _66"> </span>value<span class="_ _61"> </span><span class="ff1a">AT_FDCWD</span><span class="ls11bc">,t<span class="_ _5b"></span><span class="ls0">he <span class="_ _66"> </span>pathname <span class="_ _47"> </span>is <span class="_ _66"> </span>evaluated <span class="_ _66"> </span>starting <span class="_ _47"> </span>in <span class="_ _66"> </span>the <span class="_ _47"> </span>current</span></span></div><div class="t m0 x41 h4d y4308 ff19 fs26 fc0 sc0 ls0 ws0">working directory<span class="_ _4"></span><span class="lsd3">,a<span class="_ _d"></span><span class="ls0">nd<span class="_"> </span><span class="ff1a">mkfifoat<span class="_ _80"> </span></span>behaves like<span class="_"> </span><span class="ff1a">mkfifo</span>.</span></span></div><div class="t m0 x3f h4d y4309 ff19 fs26 fc0 sc0 ls0 ws0">Once <span class="_ _2"></span>we <span class="_ _2"></span>have <span class="_ _3"></span>used<span class="_ _47"> </span><span class="ff1a">mkfifo<span class="_ _66"> </span></span>or<span class="_ _47"> </span><span class="ff1a">mkfifoat<span class="_ _47"> </span></span>to <span class="_ _2"></span>create a <span class="_ _3"></span>FIFO, <span class="_ _2"></span>we <span class="_ _3"></span>open <span class="_ _2"></span>it <span class="_ _2"></span>using<span class="_ _47"> </span><span class="ff1a">open</span>.</div><div class="t m0 x32 h4d y430a ff19 fs26 fc0 sc0 ls0 ws0">Indeed, <span class="_ _53"> </span>the <span class="_ _e"> </span>normal <span class="_ _e"> </span>ﬁle <span class="_ _e"> </span>I/O <span class="_ _e"> </span>functions <span class="_ _e"> </span>(e.g.,<span class="_"> </span><span class="ff1a">close</span>,<span class="_ _4b"> </span><span class="ff1a">read</span>,<span class="_ _4b"> </span><span class="ff1a">write</span>,<span class="_ _4b"> </span><span class="ff1a">unlink</span><span class="ls11bd">)a<span class="_ _c"></span><span class="ls0">ll <span class="_ _53"> </span>work</span></span></div><div class="t m0 x32 h49 y430b ff19 fs26 fc0 sc0 ls0 ws0">with FIFOs.</div><div class="t m0 x76 h5e y430c ff19 fs10 fc0 sc0 ls0 ws0">Applications <span class="_"> </span>can <span class="_"> </span>cr<span class="_ _0"></span>eate <span class="_"> </span>FIFOs <span class="_"> </span>with <span class="_ _42"> </span>the<span class="_ _44"> </span><span class="ff1a">mknod<span class="_ _35"> </span></span>and<span class="_ _35"> </span><span class="ff1a">mknodat<span class="_ _44"> </span></span>functions. <span class="_ _35"> </span>Because<span class="_ _35"> </span>POSIX.1</div><div class="t m0 x76 h5e y430d ff19 fs10 fc0 sc0 ls0 ws0">originally <span class="_ _9"></span>didn’t <span class="_ _9"></span>include<span class="_ _47"> </span><span class="ff1a">mknod</span><span class="ls11be">,t<span class="_ _8"></span><span class="ls0">he<span class="_ _47"> </span><span class="ff1a">mkfifo<span class="_ _47"> </span></span>function <span class="_ _9"></span>was <span class="_ _9"></span>invented <span class="_ _9"></span>speciﬁcally <span class="_ _9"> </span>for <span class="_ _9"> </span>POSIX.1.</span></span></div><div class="t m0 x76 h5e y430e ff19 fs10 fc0 sc0 ls0 ws0">The<span class="_"> </span><span class="ff1a">mknod<span class="_ _53"> </span></span>and<span class="_"> </span><span class="ff1a">mknodat<span class="_ _e"> </span></span>functions ar<span class="ls136">ei<span class="_ _84"></span><span class="ls0">ncluded in the XSI option in POSIX.1.</span></span></div><div class="t m0 x76 h5e y430f ff19 fs10 fc0 sc0 ls0 ws0">POSIX.1 <span class="_ _9"></span>also <span class="_ _9"></span>includes <span class="_ _9"></span>support <span class="_ _9"></span>for <span class="_ _9"></span>the<span class="_ _66"> </span><span class="ff1a">mkfifo</span></div><div class="t m0 x116 h2d y4310 ff19 fs10 fc0 sc0 ls0 ws0">(</div><div class="t m0 x225 h2d y430f ff19 fs10 fc0 sc0 ls0 ws0">1</div><div class="t m0 x187 h2d y4310 ff19 fs10 fc0 sc0 ls0 ws0">)</div><div class="t m0 x1d9 h2d y430f ff19 fs10 fc0 sc0 ls0 ws0">command. <span class="_ _66"> </span>All<span class="_ _47"> </span>four <span class="_ _9"></span>platforms <span class="_ _9"></span>discussed <span class="_ _9"></span>in</div><div class="t m0 x76 h2d y4311 ff19 fs10 fc0 sc0 ls0 ws0">this <span class="_ _2"></span>text <span class="_ _2"></span>provide this <span class="_ _3"></span>command.<span class="_ _44"> </span>As <span class="_ _2"></span>a <span class="_ _2"></span>result, <span class="_ _2"></span>we <span class="_ _2"></span>can <span class="_ _2"></span>create <span class="_ _2"></span>a <span class="_ _2"></span>FIFO <span class="_ _2"></span>using <span class="_ _2"></span>a <span class="_ _3"></span>shell <span class="_ _2"></span>command <span class="_ _2"></span>and</div><div class="t m0 x76 h2d y4312 ff19 fs10 fc0 sc0 ls0 ws0">then access it with the normal shell I/O redir<span class="_ _0"></span>ection.</div><div class="t m0 x3f h4d y4313 ff19 fs26 fc0 sc0 ls0 ws0">When we<span class="_"> </span><span class="ff1a">open<span class="_ _80"> </span></span><span class="lsd3">aF<span class="_ _5"></span><span class="ls0">IFO, the nonblocking ﬂag (<span class="ff1a">O_NONBLOCK</span><span class="lsd3">)a<span class="_ _d"></span><span class="lscc">ff<span class="ls0">ects what happens.</span></span></span></span></span></div><div class="t m0 x3f h4d y4314 ff19 fs26 fc0 sc0 ls15d ws0">•I<span class="_ _4d"></span><span class="ls11bf">nt<span class="_ _b"></span><span class="ls0">he <span class="_ _9"></span>normal <span class="_ _23"></span>case <span class="_ _23"></span>(without<span class="_ _45"> </span><span class="ff1a">O_NONBLOCK</span>), <span class="_ _23"> </span>an<span class="_ _35"> </span><span class="ff1a">open<span class="_ _45"> </span></span>for <span class="_ _23"> </span>read-only <span class="_ _9"></span>blocks <span class="_ _23"> </span>until</span></span></div><div class="t m0 x15 h4d y4315 ff19 fs26 fc0 sc0 ls0 ws0">some <span class="_ _42"> </span>other <span class="_ _42"> </span>process <span class="_ _23"> </span>opens <span class="_ _53"> </span>the <span class="_ _42"> </span>FIFO <span class="_ _42"> </span>for <span class="_ _42"> </span>writing.<span class="_ _54"> </span>Similarly<span class="_ _4"></span><span class="ls11c0">,a<span class="_ _43"></span><span class="ls0">n<span class="_ _44"> </span><span class="ff1a">open<span class="_ _35"> </span></span>for <span class="_ _42"> </span>write-</span></span></div><div class="t m0 x15 h49 y4316 ff19 fs26 fc0 sc0 ls0 ws0">only blocks until some other process opens the FIFO for r<span class="_ _0"></span>eading.</div><div class="t m0 x3f h4d y4317 ff19 fs26 fc0 sc0 ls15d ws0">•I<span class="_ _4d"></span><span class="ls0">f<span class="_ _47"> </span><span class="ff1a">O_NONBLOCK<span class="_ _47"> </span></span>is <span class="_ _3"></span>speciﬁed, <span class="_ _3"></span>an<span class="_ _47"> </span><span class="ff1a">open<span class="_ _47"> </span></span>for <span class="_ _3"></span>read-only <span class="_ _2"></span>returns <span class="_ _3"></span>immediately<span class="_ _4"></span><span class="ls11c1">.B<span class="_ _1d"></span><span class="ls0">ut <span class="_ _3"></span>an</span></span></span></div><div class="t m0 x15 h4d y4318 ff1a fs26 fc0 sc0 ls0 ws0">open<span class="_ _45"> </span><span class="ff19">for <span class="_ _23"> </span>write-only <span class="_ _23"> </span>returns<span class="_ _45"> </span><span class="ff20">−</span><span class="ls11c2">1w<span class="_ _b"></span><span class="ls0">ith<span class="_ _45"> </span><span class="ff1a">errno<span class="_ _35"> </span></span>set <span class="_ _23"></span>to<span class="_ _45"> </span><span class="ff1a">ENXIO<span class="_ _35"> </span></span>if <span class="_ _23"></span>no <span class="_ _23"></span>process <span class="_ _9"></span>has <span class="_ _23"></span>the</span></span></span></div><div class="t m0 x15 h49 y4319 ff19 fs26 fc0 sc0 ls0 ws0">FIFO open for reading.</div><div class="t m0 x32 h4d y431a ff19 fs26 fc0 sc0 ls0 ws0">As <span class="_ _3"></span>with <span class="_ _3"></span>a <span class="_ _9"></span>pipe, <span class="_ _3"></span>if <span class="_ _9"></span>we<span class="_ _47"> </span><span class="ff1a">write<span class="_ _45"> </span></span>to <span class="_ _3"></span>a <span class="_ _3"></span>FIFO <span class="_ _9"></span>that <span class="_ _3"></span>no <span class="_ _3"></span>process <span class="_ _3"></span>has <span class="_ _9"></span>open <span class="_ _3"></span>for <span class="_ _3"></span>reading, <span class="_ _3"></span>the <span class="_ _9"></span>signal</div><div class="t m0 x32 h4d y431b ff1a fs26 fc0 sc0 ls0 ws0">SIGPIPE<span class="_ _66"> </span><span class="ff19">is <span class="_ _2"></span>generated.<span class="_ _61"> </span>When <span class="_ _2"></span>the <span class="_ _2"></span>last writer <span class="_ _2"></span>for <span class="_ _2"></span>a <span class="_ _2"></span>FIFO <span class="_ _2"></span>closes <span class="_ _2"></span>the <span class="_ _2"></span>FIFO, <span class="_ _2"></span>an <span class="_ _2"></span>end <span class="_ _2"></span>of <span class="_ _2"></span>ﬁle <span class="_ _2"></span>is</span></div><div class="t m0 x32 h49 y431c ff19 fs26 fc0 sc0 ls0 ws0">generated for the reader of the FIFO.</div><div class="t m0 x3f h49 y431d ff19 fs26 fc0 sc0 ls0 ws0">It is <span class="_ _2"></span>common to <span class="_ _2"></span>have multiple <span class="_ _2"></span>writers for <span class="_ _2"></span>a given <span class="_ _2"></span>FIFO.<span class="_ _46"> </span>This <span class="_ _2"></span>means that <span class="_ _2"></span>we have <span class="_ _2"></span>to</div><div class="t m0 x32 h49 y431e ff19 fs26 fc0 sc0 ls0 ws0">worry <span class="_ _23"> </span>about <span class="_ _23"> </span>atomic <span class="_ _42"> </span>writes <span class="_ _23"> </span>if <span class="_ _42"> </span>we <span class="_ _23"></span>don’t <span class="_ _23"> </span>want <span class="_ _42"> </span>the <span class="_ _23"> </span>writes <span class="_ _23"> </span>from <span class="_ _23"> </span>multiple <span class="_ _23"> </span>processes <span class="_ _23"> </span>to <span class="_ _42"> </span>be</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
