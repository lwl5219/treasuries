<div id="pf2f5" class="pf w4 h1f" data-page-no="2f5"><div class="pc pc2f5 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg2f5.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>19.3<span class="_ _31"> </span>Opening <span class="_"> </span>Pseudo-T<span class="_ _4"></span>erminal <span class="_"> </span>Devices<span class="_ _1b"> </span><span class="ff18">723</span></div><div class="t m0 x32 h2b y12f ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _45"> </span><span class="ff1b">oﬂag<span class="_ _35"> </span></span>argument <span class="_ _9"></span>is <span class="_ _23"> </span>a <span class="_ _23"> </span>bitmask <span class="_ _23"></span>that <span class="_ _23"></span>speciﬁes <span class="_ _23"></span>how <span class="_ _9"></span>the <span class="_ _23"> </span>master <span class="_ _23"> </span>device <span class="_ _23"></span>is <span class="_ _23"></span>to <span class="_ _23"></span>be <span class="_ _9"></span>opened,</div><div class="t m0 x32 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">similar <span class="_ _53"> </span>to <span class="_ _53"> </span>the <span class="_ _53"> </span>same <span class="_ _42"> </span>argument <span class="_ _53"> </span>used <span class="_ _53"> </span>with<span class="_ _44"> </span><span class="ff1a">open</span></div><div class="t m0 x1fe h2a y29cf ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 x1ff h2a y130 ff19 fsf fc0 sc0 ls0 ws0">2</div><div class="t m0 x1d3 h2a y29cf ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 x5d h2a y130 ff19 fsf fc0 sc0 ls1591 ws0">.N<span class="_ _52"></span><span class="ls0">ot <span class="_ _42"> </span>all <span class="_ _53"> </span>open <span class="_ _53"> </span>ﬂags <span class="_ _53"> </span>ar<span class="ls1592">es<span class="_ _c"></span><span class="ls0">upported,</span></span></span></div><div class="t m0 x32 h26 y131 ff19 fsf fc0 sc0 ls0 ws0">however<span class="_ _6"></span><span class="ls731">.W<span class="_ _26"></span><span class="ls0">ith<span class="_ _47"> </span><span class="ff1a">posix_openpt</span>,<span class="_ _45"> </span>we<span class="_ _45"> </span>can <span class="_ _3"></span>specify<span class="_ _45"> </span><span class="ff1a">O_RDWR<span class="_ _45"> </span></span>to <span class="_ _3"></span>open <span class="_ _9"></span>the <span class="_ _9"></span>master <span class="_ _3"></span>device <span class="_ _9"></span>for</span></span></div><div class="t m0 x32 h26 y132 ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">ading <span class="_ _9"></span>and <span class="_ _9"></span>writing, <span class="_ _9"></span>and <span class="_ _3"></span>we <span class="_ _9"></span>can <span class="_ _9"></span>specify<span class="_ _45"> </span><span class="ff1a">O_NOCTTY<span class="_ _47"> </span></span>to <span class="_ _9"></span>prevent <span class="_ _3"></span>the <span class="_ _9"></span>master <span class="_ _9"></span>device <span class="_ _3"></span>from</span></div><div class="t m0 x32 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">becoming <span class="_ _2"></span>a <span class="_ _2"></span>controlling terminal <span class="_ _2"></span>for <span class="_ _2"></span>the <span class="_ _2"></span>caller<span class="_ _1"></span><span class="ls1593">.A<span class="_ _5b"></span><span class="ls0">ll <span class="_ _2"></span>other <span class="_ _2"></span>open <span class="_ _2"></span>ﬂags <span class="_ _2"></span>result <span class="_ _2"></span>in <span class="_ _2"></span>unspeciﬁed</span></span></div><div class="t m0 x32 h2a y134 ff19 fsf fc0 sc0 ls0 ws0">behavior<span class="_ _6"></span>.</div><div class="t m0 x3f h2a y135 ff19 fsf fc0 sc0 ls0 ws0">Befor<span class="lsfdf">eas<span class="_ _8"></span><span class="ls0">lave <span class="_ _2"></span>pseudo <span class="_ _2"></span>terminal <span class="_ _2"></span>device <span class="_ _2"></span>can <span class="_ _2"></span>be <span class="_ _3"></span>used, <span class="_ _2"></span>its <span class="_ _2"></span>permissions <span class="_ _2"></span>need <span class="_ _2"></span>to <span class="_ _2"></span>be <span class="_ _2"></span>set <span class="_ _2"></span>so</span></span></div><div class="t m0 x32 h26 y136 ff19 fsf fc0 sc0 ls0 ws0">that it is <span class="_ _2"></span>accessible to applications.<span class="_ _46"> </span>The<span class="_ _66"> </span><span class="ff1a">grantpt<span class="_ _66"> </span></span>function does <span class="_ _2"></span>just this.<span class="_ _46"> </span>It sets <span class="_ _2"></span>the user</div><div class="t m0 x32 h2a y137 ff19 fsf fc0 sc0 ls0 ws0">ID <span class="_ _2"></span>of <span class="_ _2"></span>the <span class="_ _3"></span>slave’s <span class="_ _2"></span>device <span class="_ _3"></span>node <span class="_ _2"></span>to <span class="_ _2"></span>the <span class="_ _3"></span>caller<span class="_ _9"></span>’s <span class="_ _2"></span>real <span class="_ _2"></span>user <span class="_ _2"></span>ID <span class="_ _2"></span>and <span class="_ _3"></span>sets <span class="_ _2"></span>the <span class="_ _3"></span>node’s <span class="_ _2"></span>group <span class="_ _2"></span>ID <span class="_ _2"></span>to</div><div class="t m0 x32 h2a y138 ff19 fsf fc0 sc0 ls0 ws0">an <span class="_"> </span>unspeciﬁed <span class="_ _e"> </span>value, <span class="_"> </span>usually <span class="_ _e"> </span>some <span class="_"> </span>group <span class="_ _e"> </span>that <span class="_"> </span>has <span class="_ _e"> </span>access <span class="_"> </span>to <span class="_"> </span>terminal <span class="_ _e"> </span>devices.<span class="_ _60"> </span>The</div><div class="t m0 x32 h2a y139 ff19 fsf fc0 sc0 ls0 ws0">permissions ar<span class="ls9c3">es<span class="_ _4f"></span><span class="ls0">et to allow <span class="_ _2"></span>read and write access to individual owners and write access</span></span></div><div class="t m0 x32 h2a y13a ff19 fsf fc0 sc0 ls0 ws0">to group owners</div><div class="t m0 xae h2a ye85 ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 x50 h2a y13a ff19 fsf fc0 sc0 ls0 ws0">0620</div><div class="t m0 x12b h2a ye85 ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 x171 h2a y13a ff19 fsf fc0 sc0 ls0 ws0">.</div><div class="t m0 x3f h2a y254 ff19 fsf fc0 sc0 ls0 ws0">Implementations <span class="_ _53"> </span>commonly <span class="_ _53"> </span>set <span class="_ _53"> </span>the <span class="_ _53"> </span>group <span class="_ _42"> </span>ownership <span class="_ _53"> </span>of <span class="_ _53"> </span>the <span class="_ _53"> </span>slave <span class="_ _53"> </span>PTY <span class="_ _53"> </span>device <span class="_ _e"> </span>to</div><div class="t m0 x32 h26 y255 ff19 fsf fc0 sc0 ls0 ws0">group<span class="_ _59"> </span><span class="ff1a">tty</span><span class="ls1594">.P<span class="_ _5d"></span><span class="ls45">ro<span class="ls0">grams <span class="_"> </span>that <span class="_"> </span>need <span class="_"> </span>permission <span class="_"> </span>to <span class="_"> </span>write <span class="_"> </span>to <span class="_"> </span>all <span class="_"> </span>active <span class="_"> </span>terminals <span class="_"> </span>on <span class="_"> </span>the</span></span></span></div><div class="t m0 x32 h26 y13b ff19 fsf fc0 sc0 ls0 ws0">system ar<span class="ls80a">es<span class="_ _4f"></span><span class="ls0">et-group-ID to <span class="_ _2"></span>the <span class="_ _2"></span>group<span class="_"> </span><span class="ff1a">tty</span><span class="ls1595">.E<span class="_ _5b"></span><span class="ls0">xamples <span class="_ _2"></span>of such <span class="_ _2"></span>programs are<span class="_"> </span><span class="ff1a">wall</span></span></span></span></span></div><div class="t m0 x193 h2a y643 ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 x232 h2a y13b ff19 fsf fc0 sc0 ls0 ws0">1</div><div class="t m0 xe6 h2a y643 ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 x238 h2a y13b ff19 fsf fc0 sc0 ls0 ws0">and</div><div class="t m0 x32 h26 y13c ff1a fsf fc0 sc0 ls0 ws0">write</div><div class="t m0 x182 h2a y1544 ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 x183 h2a y13c ff19 fsf fc0 sc0 ls0 ws0">1</div><div class="t m0 x14 h2a y1544 ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 x138 h2a y13c ff19 fsf fc0 sc0 ls1596 ws0">.B<span class="_ _26"></span><span class="ls0">ecause <span class="_ _23"></span>the <span class="_ _9"></span>group <span class="_ _9"></span>write <span class="_ _9"></span>permission <span class="_ _23"></span>is <span class="_ _9"></span>enabled <span class="_ _9"></span>on <span class="_ _23"></span>slave <span class="_ _9"></span>PTY <span class="_ _9"></span>devices, <span class="_ _23"></span>these</span></div><div class="t m0 x32 h2a y256 ff19 fsf fc0 sc0 ls0 ws0">programs can write to them.</div><div class="t m0 x3f h57 y5387 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;stdlib.h&gt;</div><div class="t m0 x3f h57 y5388 ff1a fs2d fc0 sc0 ls0 ws0">int grantpt(int<span class="_"> </span><span class="ff1b">fd</span>);</div><div class="t m0 x3f h57 y5389 ff1a fs2d fc0 sc0 ls0 ws0">int unlockpt(int<span class="_"> </span><span class="ff1b">fd</span>);</div><div class="t m0 x225 h5f y538a ff19 fs2d fc0 sc0 ls0 ws0">Both return: 0 on success,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>err<span class="_ _0"></span>or</div><div class="t m0 x3f h4d y18d3 ff19 fs26 fc0 sc0 ls164 ws0">To <span class="_ _80"> </span>c<span class="_ _9"></span><span class="ls0">hange <span class="_ _3"></span>permission <span class="_ _9"></span>on <span class="_ _3"></span>the <span class="_ _3"></span>slave <span class="_ _3"></span>device <span class="_ _3"></span>node,<span class="_ _45"> </span><span class="ff1a">grantpt<span class="_ _47"> </span></span>might <span class="_ _3"></span>need <span class="_ _3"></span>to<span class="_ _47"> </span><span class="ff1a">fork<span class="_ _47"> </span></span>and</span></div><div class="t m0 x32 h4d y18d4 ff1a fs26 fc0 sc0 ls0 ws0">exec<span class="_ _66"> </span><span class="ff19 ls140f">as<span class="_ _4f"></span><span class="ls0">et-user-ID <span class="_ _2"></span>program (<span class="ff1a">/usr/lib/pt_chmod<span class="_ _66"> </span></span>on <span class="_ _2"></span>Solaris, <span class="_ _2"></span>for <span class="_ _2"></span>example).<span class="_ _61"> </span>Thus, <span class="_ _2"></span>the</span></span></div><div class="t m0 x32 h4d y18d5 ff19 fs26 fc0 sc0 ls0 ws0">behavior is unspeciﬁed if the caller is catching<span class="_"> </span><span class="ff1a">SIGCHLD</span>.</div><div class="t m0 x3f h4d y18d6 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _66"> </span><span class="ff1a">unlockpt<span class="_ _66"> </span></span>function <span class="_ _2"></span>is <span class="_ _2"></span>used <span class="_ _2"></span>to <span class="_ _2"></span>grant <span class="_ _2"></span>access <span class="_ _2"></span>to <span class="_ _2"></span>the <span class="_ _2"></span>slave <span class="_ _2"></span>pseudo <span class="_ _2"></span>terminal <span class="_ _2"></span>device,</div><div class="t m0 x32 h49 y18d8 ff19 fs26 fc0 sc0 ls0 ws0">thereby <span class="_ _9"></span>allowing <span class="_ _23"></span>applications <span class="_ _23"></span>to <span class="_ _23"></span>open <span class="_ _9"></span>the <span class="_ _23"> </span>device.<span class="_ _51"> </span>By <span class="_ _23"></span>preventing <span class="_ _9"></span>others <span class="_ _23"></span>from <span class="_ _9"></span>opening</div><div class="t m0 x32 h49 y18d9 ff19 fs26 fc0 sc0 ls0 ws0">the slave device, applications setting up the devices have <span class="_ _2"></span>an opportunity to initialize the</div><div class="t m0 x32 h49 y18da ff19 fs26 fc0 sc0 ls0 ws0">slave and master devices properly befor<span class="_ _0"></span><span class="lsd3">et<span class="_ _d"></span><span class="ls0">hey can be used.</span></span></div><div class="t m0 x3f h4d y18db ff19 fs26 fc0 sc0 ls0 ws0">Note <span class="_ _9"></span>that <span class="_ _9"></span>in <span class="_ _9"></span>both<span class="_ _45"> </span><span class="ff1a">grantpt<span class="_ _45"> </span></span>and<span class="_ _45"> </span><span class="ff1a">unlockpt</span><span class="lse49">,t<span class="_ _b"></span><span class="ls0">he <span class="_ _9"></span>ﬁle <span class="_ _9"></span>descriptor <span class="_ _23"></span>ar<span class="_ _0"></span>gument <span class="_ _9"></span>is <span class="_ _9"></span>the <span class="_ _9"></span>ﬁle</span></span></div><div class="t m0 x32 h49 y18dc ff19 fs26 fc0 sc0 ls0 ws0">descriptor associated with the master pseudo terminal device.</div><div class="t m0 x3f h4d y18dd ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _45"> </span><span class="ff1a">ptsname<span class="_ _35"> </span></span>function <span class="_ _23"></span>is <span class="_ _23"></span>used <span class="_ _23"></span>to <span class="_ _23"></span>ﬁnd <span class="_ _9"></span>the <span class="_ _23"> </span>pathname <span class="_ _23"> </span>of <span class="_ _23"> </span>the <span class="_ _23"></span>slave <span class="_ _23"></span>pseudo <span class="_ _23"></span>terminal</div><div class="t m0 x32 h49 y18de ff19 fs26 fc0 sc0 ls0 ws0">device, <span class="_ _9"></span>given <span class="_ _23"></span>the <span class="_ _9"></span>ﬁle <span class="_ _9"></span>descriptor <span class="_ _23"></span>of <span class="_ _9"></span>the <span class="_ _9"></span>master<span class="_ _1"></span><span class="ls1597">.T<span class="_ _62"></span><span class="ls0">his <span class="_ _9"></span>allows <span class="_ _9"></span>applications <span class="_ _23"></span>to <span class="_ _9"></span>identify <span class="_ _23"></span>the</span></span></div><div class="t m0 x32 h49 y18df ff19 fs26 fc0 sc0 ls0 ws0">slave <span class="_ _e"> </span>independent <span class="_ _e"> </span>of <span class="_ _e"> </span>any <span class="_ _e"> </span>particular <span class="_ _e"> </span>conventions <span class="_ _e"> </span>that <span class="_ _e"> </span>might <span class="_ _e"> </span>be <span class="_ _e"> </span>followed <span class="_ _e"> </span>by <span class="_ _e"> </span>a <span class="_ _e"> </span>given</div><div class="t m0 x32 h49 y18e0 ff19 fs26 fc0 sc0 ls0 ws0">platform. <span class="_ _45"> </span>Note<span class="_ _35"> </span>that <span class="_ _9"></span>the <span class="_ _23"> </span>name <span class="_ _23"></span>returned <span class="_ _9"></span>might <span class="_ _23"></span>be <span class="_ _9"></span>stored <span class="_ _23"></span>in <span class="_ _9"></span>static <span class="_ _23"> </span>memory<span class="_ _4"></span>,<span class="_ _35"> </span>so<span class="_ _45"> </span>it<span class="_ _35"> </span>can <span class="_ _23"></span>be</div><div class="t m0 x32 h49 y18e1 ff19 fs26 fc0 sc0 ls0 ws0">overwritten on successive calls.</div><div class="t m0 x3f h4e y538b ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;stdlib.h&gt;</div><div class="t m0 x3f h4e y538c ff1a fs28 fc0 sc0 ls0 ws0">char *ptsname(int<span class="_"> </span><span class="ff1b">fd</span>);</div><div class="t m0 x146 h4e y538d ff19 fs28 fc0 sc0 ls0 ws0">Returns: pointer to name of PTY slave if OK,<span class="_"> </span><span class="ff1a">NULL<span class="_ _e"> </span></span>on error</div><div class="t m0 x3f h55 y538e ff19 fs2c fc0 sc0 ls0 ws0">Figur<span class="ls1598">e1<span class="_ _5d"></span><span class="ls0">9.8 <span class="_ _59"> </span>summarizes <span class="_ _4b"> </span>the <span class="_ _4b"> </span>pseudo <span class="_ _59"> </span>terminal <span class="_ _4b"> </span>functions <span class="_ _4b"> </span>in <span class="_ _59"> </span>the <span class="_ _4b"> </span>Single <span class="_ _59"> </span>UNIX</span></span></div><div class="t m0 x32 h55 y538f ff19 fs2c fc0 sc0 ls0 ws0">Speciﬁcation and <span class="_ _2"></span>indicates which <span class="_ _2"></span>functions <span class="_ _2"></span>ar<span class="ls1599">es<span class="_ _4f"></span><span class="ls0">upported by <span class="_ _2"></span>the <span class="_ _2"></span>platforms discussed <span class="_ _2"></span>in</span></span></div><div class="t m0 x32 h55 y5390 ff19 fs2c fc0 sc0 ls0 ws0">this text.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
