<div id="pfa4" class="pf w4 h1f" data-page-no="a4"><div class="pc pca4 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bga4.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">130<span class="_ _1b"> </span><span class="ff19">Files <span class="_"> </span>and <span class="_"> </span>Directories <span class="_ _18d"> </span>Chapter<span class="_ _4b"> </span>4</span></div><div class="t m0 x3f h57 y1295 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;unistd.h&gt;</div><div class="t m0 x3f h57 y1296 ff1a fs2d fc0 sc0 ls0 ws0">int rmdir(const char *<span class="ff1b">pathname</span>);</div><div class="t m0 x153 h5f y1297 ff19 fs2d fc0 sc0 ls0 ws0">Returns: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h49 y1298 ff19 fs26 fc0 sc0 ls0 ws0">If the <span class="_ _2"></span>link count <span class="_ _2"></span>of the <span class="_ _2"></span>directory becomes 0 with <span class="_ _2"></span>this call, <span class="_ _2"></span>and if <span class="_ _2"></span>no other <span class="_ _2"></span>process has the</div><div class="t m0 x32 h49 y1299 ff19 fs26 fc0 sc0 ls0 ws0">directory <span class="_"> </span>open, <span class="_"> </span>then <span class="_"> </span>the <span class="_ _66"> </span>space <span class="_ _66"> </span>occupied <span class="_"> </span>by <span class="_ _66"> </span>the <span class="_ _66"> </span>directory <span class="_"> </span>is <span class="_ _66"> </span>freed. <span class="_ _46"> </span>If<span class="_ _46"> </span>one <span class="_"> </span>or <span class="_ _66"> </span>more</div><div class="t m0 x32 h49 y129a ff19 fs26 fc0 sc0 ls0 ws0">processes <span class="_"> </span>have <span class="_ _47"> </span>the <span class="_ _47"> </span>directory <span class="_ _66"> </span>open <span class="_ _47"> </span>when <span class="_ _47"> </span>the <span class="_ _66"> </span>link <span class="_ _47"> </span>count <span class="_ _47"> </span>reaches <span class="_ _66"> </span>0, <span class="_ _47"> </span>the <span class="_ _47"> </span>last <span class="_ _47"> </span>link <span class="_ _66"> </span>is</div><div class="t m0 x32 h49 y129b ff19 fs26 fc0 sc0 lscc ws0">re<span class="ls0">moved <span class="_"> </span>and <span class="_ _e"> </span>the <span class="_"> </span>dot <span class="_ _e"> </span>and <span class="_"> </span>dot-dot <span class="_ _e"> </span>entries <span class="_"> </span>ar<span class="_ _1"></span><span class="ls2c6">er<span class="_ _4a"></span><span class="ls0">emoved <span class="_"> </span>befor<span class="ls2c6">et<span class="_ _4a"></span><span class="ls0">his <span class="_ _e"> </span>function <span class="_"> </span>returns.</span></span></span></span></span></div><div class="t m0 x32 h49 y129c ff19 fs26 fc0 sc0 ls0 ws0">Additionally<span class="_ _4"></span>,<span class="_ _44"> </span>no<span class="_ _35"> </span>new <span class="_ _42"> </span>ﬁles <span class="_ _23"> </span>can <span class="_ _42"> </span>be <span class="_ _42"> </span>created <span class="_ _23"> </span>in <span class="_ _42"> </span>the <span class="_ _23"> </span>directory<span class="_ _4"></span><span class="ls5b5">.T<span class="_ _7"></span><span class="ls0">he <span class="_ _42"> </span>directory <span class="_ _23"> </span>is <span class="_ _42"> </span>not <span class="_ _42"> </span>freed,</span></span></div><div class="t m0 x32 h49 y129d ff19 fs26 fc0 sc0 ls0 ws0">however<span class="_ _6"></span><span class="ls5b6">,u<span class="_ _55"></span><span class="ls0">ntil <span class="_"> </span>the <span class="_ _e"> </span>last <span class="_"> </span>process <span class="_ _e"> </span>closes <span class="_"> </span>it.<span class="_ _48"> </span>(Even <span class="_"> </span>though <span class="_"> </span>some <span class="_ _e"> </span>other <span class="_"> </span>pr<span class="_ _0"></span>ocess <span class="_"> </span>has <span class="_ _e"> </span>the</span></span></div><div class="t m0 x32 h49 y129e ff19 fs26 fc0 sc0 ls0 ws0">directory open, <span class="_ _2"></span>it <span class="_ _2"></span>can’t <span class="_ _2"></span>be <span class="_ _2"></span>doing <span class="_ _2"></span>much <span class="_ _2"></span>in <span class="_ _2"></span>the <span class="_ _2"></span>directory<span class="_ _4"></span>,<span class="_ _47"> </span>as<span class="_"> </span>the <span class="_ _2"></span>directory <span class="_ _2"></span>had <span class="_ _2"></span>to <span class="_ _2"></span>be <span class="_ _2"></span>empty</div><div class="t m0 x32 h4d y129f ff19 fs26 fc0 sc0 ls0 ws0">for the<span class="_"> </span><span class="ff1a">rmdir<span class="_ _80"> </span></span>function to succeed.)</div><div class="t m0 x35 h4b y12a0 ff16 fs27 fc0 sc0 ls0 ws0">4.22 <span class="_ _93"> </span>Reading<span class="_ _54"> </span>Directories</div><div class="t m0 x32 h49 y12a1 ff19 fs26 fc0 sc0 ls0 ws0">Directories can <span class="_ _3"></span>be <span class="_ _2"></span>read <span class="_ _2"></span>by <span class="_ _2"></span>anyone <span class="_ _3"></span>who <span class="_ _2"></span>has <span class="_ _2"></span>access <span class="_ _3"></span>permission <span class="_ _2"></span>to <span class="_ _3"></span>read the <span class="_ _3"></span>directory<span class="_ _4"></span><span class="ls5b7">.B<span class="_ _1d"></span><span class="ls0">ut</span></span></div><div class="t m0 x32 h49 y12a2 ff19 fs26 fc0 sc0 ls0 ws0">only <span class="_ _e"> </span>the <span class="_ _e"> </span>kernel <span class="_ _e"> </span>can <span class="_"> </span>write <span class="_ _53"> </span>to <span class="_ _e"> </span>a <span class="_ _e"> </span>directory<span class="_ _4"></span>,<span class="_ _59"> </span>to<span class="_ _4b"> </span>p<span class="lscc">re<span class="_ _2"></span></span>serve <span class="_ _e"> </span>ﬁle <span class="_ _e"> </span>system <span class="_"> </span>sanity<span class="_ _4"></span><span class="ls5b8">.R<span class="_ _64"></span><span class="ls0">ecall <span class="_ _53"> </span>from</span></span></div><div class="t m0 x32 h49 y12a3 ff19 fs26 fc0 sc0 ls0 ws0">Section <span class="_ _42"> </span>4.5 <span class="_ _42"> </span>that <span class="_ _42"> </span>the <span class="_ _42"> </span>write <span class="_ _42"> </span>permission <span class="_ _42"> </span>bits <span class="_ _42"> </span>and <span class="_ _42"> </span>execute <span class="_ _42"> </span>permission <span class="_ _42"> </span>bits <span class="_ _42"> </span>for <span class="_ _53"> </span>a <span class="_ _42"> </span>directory</div><div class="t m0 x32 h49 y12a4 ff19 fs26 fc0 sc0 ls0 ws0">determine <span class="_ _45"> </span>if <span class="_ _47"> </span>we <span class="_ _45"> </span>can <span class="_ _45"> </span>cr<span class="_ _0"></span>eate <span class="_ _45"> </span>new <span class="_ _47"> </span>ﬁles <span class="_ _45"> </span>in <span class="_ _45"> </span>the <span class="_ _47"> </span>directory <span class="_ _45"> </span>and <span class="_ _47"> </span>remove <span class="_ _47"> </span>ﬁles <span class="_ _45"> </span>from <span class="_ _47"> </span>the</div><div class="t m0 x32 h49 y12a5 ff19 fs26 fc0 sc0 ls0 ws0">directory <span class="_ _84"></span>— <span class="_ _4"></span>they<span class="_"> </span>don’t specify if we can write to the dir<span class="_ _1"></span>ectory itself.</div><div class="t m0 x3f h49 y12a6 ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _2"></span>actual <span class="_ _3"></span>format <span class="_ _3"></span>of <span class="_ _3"></span>a <span class="_ _3"></span>directory <span class="_ _2"></span>depends <span class="_ _3"></span>on <span class="_ _3"></span>the <span class="_ _3"></span>UNIX <span class="_ _3"></span>System <span class="_ _3"></span>implementation <span class="_ _3"></span>and</div><div class="t m0 x32 h49 y12a7 ff19 fs26 fc0 sc0 ls0 ws0">the <span class="_ _2"></span>design <span class="_ _2"></span>of <span class="_ _3"></span>the <span class="_ _2"></span>ﬁle <span class="_ _2"></span>system.<span class="_ _61"> </span>Earlier <span class="_ _3"></span>systems, <span class="_ _2"></span>such <span class="_ _2"></span>as <span class="_ _3"></span>V<span class="_ _4"></span>ersion <span class="_ _3"></span>7, <span class="_ _2"></span>had <span class="_ _2"></span>a <span class="_ _3"></span>simple <span class="_ _2"></span>structure:</div><div class="t m0 x32 h49 y12a8 ff19 fs26 fc0 sc0 ls0 ws0">each <span class="_ _23"> </span>directory <span class="_ _23"> </span>entry <span class="_ _42"> </span>was <span class="_ _42"> </span>16 <span class="_ _23"> </span>bytes, <span class="_ _42"> </span>with <span class="_ _23"> </span>14 <span class="_ _42"> </span>bytes <span class="_ _42"> </span>for <span class="_ _23"> </span>the <span class="_ _42"> </span>ﬁlename <span class="_ _23"> </span>and <span class="_ _42"> </span>2 <span class="_ _42"> </span>bytes <span class="_ _23"> </span>for <span class="_ _42"> </span>the</div><div class="t m0 x32 h49 y12a9 ff19 fs26 fc0 sc0 ls0 ws0">i-node <span class="_"> </span>number<span class="_ _6"></span><span class="ls5b9">.W<span class="_ _5d"></span><span class="ls0">hen <span class="_"> </span>longer <span class="_"> </span>ﬁlenames <span class="_ _66"> </span>wer<span class="ls5ba">ea<span class="_ _5b"></span><span class="ls0">dded <span class="_"> </span>to <span class="_ _66"> </span>4.2BSD, <span class="_"> </span>each <span class="_"> </span>entry <span class="_ _66"> </span>became</span></span></span></span></div><div class="t m0 x32 h49 y12aa ff19 fs26 fc0 sc0 ls0 ws0">variable <span class="_ _23"> </span>length, <span class="_ _42"> </span>which <span class="_ _42"> </span>means <span class="_ _23"> </span>that <span class="_ _42"> </span>any <span class="_ _42"> </span>program <span class="_ _23"> </span>that <span class="_ _42"> </span>reads <span class="_ _23"></span>a <span class="_ _42"> </span>dir<span class="_ _0"></span>ectory <span class="_ _42"> </span>is <span class="_ _23"> </span>now <span class="_ _42"> </span>system</div><div class="t m0 x32 h49 y12ab ff19 fs26 fc0 sc0 ls0 ws0">dependent. <span class="_ _35"> </span>T<span class="_ _6"></span><span class="ls5bb">os<span class="_ _43"></span><span class="ls0">implify <span class="_ _42"> </span>the <span class="_ _42"> </span>pr<span class="_ _0"></span>ocess <span class="_ _42"> </span>of <span class="_ _23"> </span>reading <span class="_ _42"> </span>a <span class="_ _23"> </span>directory<span class="_ _4"></span><span class="ls5bb">,as<span class="_ _43"></span><span class="ls0">et <span class="_ _42"> </span>of <span class="_ _42"> </span>dir<span class="_ _0"></span>ectory <span class="_ _42"> </span>r<span class="_ _0"></span>outines</span></span></span></span></div><div class="t m0 x32 h49 y12ac ff19 fs26 fc0 sc0 ls0 ws0">wer<span class="ls5bc">ed<span class="_ _b"></span><span class="ls0">eveloped <span class="_ _3"></span>and <span class="_ _9"></span>ar<span class="ls5bc">ep<span class="_ _b"></span><span class="ls0">art <span class="_ _9"></span>of <span class="_ _9"></span>POSIX.1.<span class="_ _5a"> </span>Many <span class="_ _9"></span>implementations <span class="_ _23"></span>pr<span class="_ _0"></span>event <span class="_ _9"></span>applications</span></span></span></span></div><div class="t m0 x32 h4d y12ad ff19 fs26 fc0 sc0 ls0 ws0">from <span class="_"> </span>using <span class="_"> </span>the<span class="_ _59"> </span><span class="ff1a">read<span class="_ _59"> </span></span>function <span class="_"> </span>to <span class="_"> </span>access <span class="_"> </span>the <span class="_"> </span>contents <span class="_"> </span>of <span class="_"> </span>directories, <span class="_"> </span>ther<span class="_ _0"></span>eby <span class="_"> </span>further</div><div class="t m0 x32 h49 y12ae ff19 fs26 fc0 sc0 ls0 ws0">isolating applications from the implementation-speciﬁc details of dir<span class="_ _0"></span>ectory formats.</div><div class="t m0 x3f h4e y12af ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;dirent.h&gt;</div><div class="t m0 x3f h4e y12b0 ff1a fs28 fc0 sc0 ls0 ws0">DIR *opendir(const char *<span class="ff1b">pathname</span>);</div><div class="t m0 x3f h4e y12b1 ff1a fs28 fc0 sc0 ls0 ws0">DIR *fdopendir(int<span class="_"> </span><span class="ff1b">fd</span>);</div><div class="t m0 x8e h4e y12b2 ff19 fs28 fc0 sc0 ls0 ws0">Both return: pointer if OK,<span class="_"> </span><span class="ff1a">NULL<span class="_ _e"> </span></span>on error</div><div class="t m0 x3f h4e y12b3 ff1a fs28 fc0 sc0 ls0 ws0">struct dirent *readdir(DIR *<span class="ff1b">dp</span>);</div><div class="t m0 x1b7 h4e y12b4 ff19 fs28 fc0 sc0 ls0 ws0">Returns: pointer if OK,<span class="_"> </span><span class="ff1a">NULL<span class="_ _e"> </span></span>at end of directory or error</div><div class="t m0 x3f h4e y12b5 ff1a fs28 fc0 sc0 ls0 ws0">void rewinddir(DIR *<span class="ff1b">dp</span>);</div><div class="t m0 x3f h4e y12b6 ff1a fs28 fc0 sc0 ls0 ws0">int closedir(DIR *<span class="ff1b">dp</span>);</div><div class="t m0 x153 h7c y12b7 ff19 fs28 fc0 sc0 ls0 ws0">Returns: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x3f h4e y12b8 ff1a fs28 fc0 sc0 ls0 ws0">long telldir(DIR *<span class="ff1b">dp</span>);</div><div class="t m0 xf hc4 y12b9 ff19 fs28 fc0 sc0 ls0 ws0">Returns: current location in dir<span class="_ _0"></span>ectory associated with<span class="_"> </span><span class="ff1b">dp</span></div><div class="t m0 x3f h4e y12ba ff1a fs28 fc0 sc0 ls0 ws0">void seekdir(DIR *<span class="ff1b">dp</span><span class="ls1b6">,l<span class="_ _1d"></span><span class="ls0">ong<span class="_"> </span><span class="ff1b">loc</span>);</span></span></div><a class="l" href="#pfd" data-dest-detail='[13,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.894733px;bottom:873.702907px;width:152.699692px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
