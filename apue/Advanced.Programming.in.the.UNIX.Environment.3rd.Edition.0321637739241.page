<div id="pff1" class="pf w4 h1f" data-page-no="f1"><div class="pc pcf1 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bgf1.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>7.8<span class="_ _20f"> </span>Memory <span class="_"> </span>Allocation<span class="_ _1b"> </span><span class="ff18">207</span></div><div class="t m0 x32 h26 y12f ff19 fsf fc0 sc0 ls0 ws0">an <span class="_ _9"></span>example <span class="_ _23"></span>of <span class="_ _9"></span>the <span class="_ _23"></span>size <span class="_ _9"></span>differences, <span class="_ _9"></span>the <span class="_ _9"></span>following <span class="_ _23"></span>executable <span class="_ _9"></span>ﬁle<span class="_ _9"></span><span class="ls9d">—t<span class="_ _1"></span><span class="ls0">he <span class="_ _9"></span>classic<span class="_ _35"> </span><span class="ff1a">hello.c</span></span></span></div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">program <span class="_ _84"></span>— <span class="_ _4"></span>was<span class="_"> </span>ﬁrst cr<span class="_ _1"></span>eated without shared libraries:</div><div class="t m0 x3f h57 y1c09 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">gcc -static hello1.c<span class="_ _16e"> </span><span class="ff1b">prevent gcc from using shar<span class="_ _0"></span>ed libraries</span></span></div><div class="t m0 x3f h57 y1c0a ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">ls -l a.out</span></div><div class="t m0 x3f h57 y1c0b ff1a fs2d fc0 sc0 ls0 ws0">-rwxr-xr-x <span class="_"> </span>1<span class="_"> </span>sar <span class="_ _15"> </span>879443<span class="_"> </span>Sep 2 10:39 a.out</div><div class="t m0 x3f h57 y1c0c ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">size a.out</span></div><div class="t m0 x41 h57 y1c0d ff1a fs2d fc0 sc0 ls0 ws0">text <span class="_ _68"> </span>data <span class="_ _87"> </span>bss<span class="_ _8a"> </span>dec <span class="_ _15"> </span>hex<span class="_ _d9"> </span>filename</div><div class="t m0 x90 h57 y1c0e ff1a fs2d fc0 sc0 ls0 ws0">787775 <span class="_ _68"> </span>6128<span class="_ _3a"> </span>11272 <span class="_"> </span>805175<span class="_ _87"> </span>c4937 <span class="_"> </span>a.out</div><div class="t m0 x32 h2a y1c0f ff19 fsf fc0 sc0 ls0 ws0">If <span class="_"> </span>we <span class="_ _66"> </span>compile <span class="_ _66"> </span>this <span class="_ _66"> </span>program <span class="_"> </span>to <span class="_ _66"> </span>use <span class="_ _66"> </span>shared <span class="_"> </span>libraries, <span class="_ _66"> </span>the <span class="_ _66"> </span>text <span class="_ _66"> </span>and <span class="_ _66"> </span>data <span class="_ _66"> </span>sizes <span class="_ _66"> </span>of <span class="_ _66"> </span>the</div><div class="t m0 x32 h2a y1c10 ff19 fsf fc0 sc0 ls0 ws0">executable ﬁle ar<span class="ls44">eg<span class="_ _4f"></span><span class="ls45">re<span class="_ _2"></span><span class="ls0">atly decreased:</span></span></span></div><div class="t m0 x3f h57 y1c11 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">gcc hello1.c<span class="_ _1a0"> </span><span class="ff1b">gcc defaults to use shared libraries</span></span></div><div class="t m0 x3f h57 y1c12 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">ls -l a.out</span></div><div class="t m0 x3f h57 y1c13 ff1a fs2d fc0 sc0 ls0 ws0">-rwxr-xr-x <span class="_"> </span>1<span class="_"> </span>sar <span class="_ _189"> </span>8378<span class="_"> </span>Sep 2 10:39 a.out</div><div class="t m0 x3f h57 y1c14 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">size a.out</span></div><div class="t m0 x41 h57 y1c15 ff1a fs2d fc0 sc0 ls0 ws0">text <span class="_ _68"> </span>data <span class="_ _87"> </span>bss<span class="_ _8a"> </span>dec <span class="_ _15"> </span>hex<span class="_ _d9"> </span>filename</div><div class="t m0 x41 h57 y1c16 ff1a fs2d fc0 sc0 ls0 ws0">1176 <span class="_ _15"> </span>504 <span class="_ _15"> </span>16<span class="_ _15"> </span>1696 <span class="_ _15"> </span>6a0<span class="_ _d9"> </span>a.out</div><div class="t m0 x35 h53 y1c17 ff16 fs2b fc0 sc0 ls0 ws0">7.8 <span class="_ _68"> </span>Memor<span class="ls1c3">yA<span class="_ _52"></span><span class="ls0">llocation</span></span></div><div class="t m0 x32 h2a y1c18 ff19 fsf fc0 sc0 ls0 ws0">ISO C speciﬁes three functions for memory allocation:</div><div class="t m0 x3f h26 y1c19 ff19 fsf fc0 sc0 ls0 ws0">1.<span class="_ _5c"> </span><span class="ff1a">malloc</span><span class="ls877">,w<span class="_ _c"></span><span class="ls0">hich <span class="_ _e"> </span>allocates <span class="_ _53"> </span>a <span class="_ _53"> </span>speciﬁed <span class="_ _53"> </span>number <span class="_ _53"> </span>of <span class="_ _53"> </span>bytes <span class="_ _e"> </span>of <span class="_ _53"> </span>memory<span class="_ _4"></span><span class="ls878">.T<span class="_ _52"></span><span class="ls0">he <span class="_ _53"> </span>initial</span></span></span></span></div><div class="t m0 x41 h2a y1c1a ff19 fsf fc0 sc0 ls0 ws0">value of the memory is indeterminate.</div><div class="t m0 x3f h26 y1c1b ff19 fsf fc0 sc0 ls0 ws0">2.<span class="_ _5c"> </span><span class="ff1a">calloc</span><span class="ls879">,w<span class="_ _b"></span><span class="ls0">hich <span class="_ _23"></span>allocates <span class="_ _9"></span>space <span class="_ _23"> </span>for <span class="_ _23"></span>a <span class="_ _23"></span>speciﬁed <span class="_ _9"></span>number <span class="_ _23"> </span>of <span class="_ _23"></span>objects <span class="_ _23"></span>of <span class="_ _9"></span>a <span class="_ _23"> </span>speciﬁed</span></span></div><div class="t m0 x41 h2a y1c1c ff19 fsf fc0 sc0 ls0 ws0">size. <span class="_"> </span>The<span class="_"> </span>space is initialized to all 0 bits.</div><div class="t m0 x3f h26 y1c1d ff19 fsf fc0 sc0 ls0 ws0">3.<span class="_ _5c"> </span><span class="ff1a">realloc</span><span class="ls87a">,w<span class="_ _b"></span><span class="ls0">hich <span class="_ _23"></span>incr<span class="_ _0"></span>eases <span class="_ _23"></span>or <span class="_ _9"></span>decreases <span class="_ _9"></span>the <span class="_ _23"> </span>size <span class="_ _23"></span>of <span class="_ _9"></span>a <span class="_ _23"> </span>previously <span class="_ _9"></span>allocated <span class="_ _23"></span>area.</span></span></div><div class="t m0 x41 h2a y1c1e ff19 fsf fc0 sc0 ls0 ws0">When <span class="_ _23"> </span>the <span class="_ _42"> </span>size <span class="_ _42"> </span>increases, <span class="_ _23"> </span>it <span class="_ _42"> </span>may <span class="_ _23"> </span>involve <span class="_ _42"> </span>moving <span class="_ _42"> </span>the <span class="_ _42"> </span>previously <span class="_ _23"></span>allocated <span class="_ _42"> </span>ar<span class="_ _0"></span>ea</div><div class="t m0 x41 h2a y1c1f ff19 fsf fc0 sc0 ls0 ws0">somewher<span class="ls87b">ee<span class="_ _8"></span><span class="ls0">lse, <span class="_ _2"></span>to <span class="_ _3"></span>provide the <span class="_ _2"></span>additional <span class="_ _3"></span>room at <span class="_ _3"></span>the <span class="_ _2"></span>end.<span class="_ _61"> </span>Also, <span class="_ _3"></span>when <span class="_ _2"></span>the <span class="_ _2"></span>size</span></span></div><div class="t m0 x41 h2a y1c20 ff19 fsf fc0 sc0 ls0 ws0">increases, <span class="_ _2"></span>the <span class="_ _3"></span>initial <span class="_ _3"></span>value <span class="_ _9"></span>of <span class="_ _2"></span>the <span class="_ _9"></span>space <span class="_ _3"></span>between <span class="_ _3"></span>the <span class="_ _3"></span>old <span class="_ _3"></span>contents <span class="_ _3"></span>and <span class="_ _3"></span>the <span class="_ _9"></span>end <span class="_ _3"></span>of</div><div class="t m0 x41 h2a y1c21 ff19 fsf fc0 sc0 ls0 ws0">the new area is indeterminate.</div><div class="t m0 x3f h57 y1c22 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;stdlib.h&gt;</div><div class="t m0 x3f h57 y1c23 ff1a fs2d fc0 sc0 ls0 ws0">void *malloc(size_t<span class="_"> </span><span class="ff1b">size</span>);</div><div class="t m0 x3f h57 y1c24 ff1a fs2d fc0 sc0 ls0 ws0">void *calloc(size_t<span class="_"> </span><span class="ff1b">nobj</span><span class="ls15c">,s<span class="_ _1d"></span><span class="ls0">ize_t<span class="_"> </span><span class="ff1b">size</span>);</span></span></div><div class="t m0 x3f h57 y1c25 ff1a fs2d fc0 sc0 ls0 ws0">void *realloc(void *<span class="ff1b">ptr</span><span class="ls15c">,s<span class="_ _1d"></span><span class="ls0">ize_t<span class="_"> </span><span class="ff1b">newsize</span>);</span></span></div><div class="t m0 xc1 h57 y1c26 ff19 fs2d fc0 sc0 ls0 ws0">All three r<span class="_ _0"></span>eturn: non-null pointer if OK,<span class="_"> </span><span class="ff1a">NULL<span class="_ _e"> </span></span>on error</div><div class="t m0 x3f h57 y1c27 ff1a fs2d fc0 sc0 ls0 ws0">void free(void *<span class="ff1b">ptr</span>);</div><div class="t m0 x32 h49 y1c28 ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_"> </span>pointer <span class="_"> </span>r<span class="_ _1"></span>eturned <span class="_"> </span>by <span class="_"> </span>the <span class="_"> </span>thr<span class="_ _0"></span>ee <span class="_"> </span>allocation <span class="_"> </span>functions <span class="_ _e"> </span>is <span class="_"> </span>guaranteed <span class="_"> </span>to <span class="_"> </span>be <span class="_ _e"> </span>suitably</div><div class="t m0 x32 h49 y1c29 ff19 fs26 fc0 sc0 ls0 ws0">aligned <span class="_ _9"></span>so <span class="_ _23"></span>that <span class="_ _23"></span>it <span class="_ _9"></span>can <span class="_ _23"></span>be <span class="_ _9"></span>used <span class="_ _23"></span>for <span class="_ _23"></span>any <span class="_ _9"></span>data <span class="_ _23"></span>object.<span class="_ _5a"> </span>For <span class="_ _23"></span>example, <span class="_ _9"></span>if <span class="_ _23"></span>the <span class="_ _23"></span>most <span class="_ _9"></span>restrictive</div><div class="t m0 x32 h4d y1c2a ff19 fs26 fc0 sc0 ls0 ws0">alignment <span class="_"> </span>requirement <span class="_"> </span>on <span class="_"> </span>a <span class="_"> </span>particular <span class="_"> </span>system <span class="_ _66"> </span>requires <span class="_"> </span>that<span class="_ _46"> </span><span class="ff1a">double</span><span class="ls87c">sm<span class="_ _5b"></span><span class="ls0">ust <span class="_ _66"> </span>start <span class="_ _66"> </span>at</span></span></div><div class="t m0 x32 h49 y1c2b ff19 fs26 fc0 sc0 ls0 ws0">memory <span class="_"> </span>locations <span class="_ _e"> </span>that <span class="_"> </span>ar<span class="_ _1"></span><span class="ls87d">em<span class="_ _55"></span><span class="ls0">ultiples <span class="_"> </span>of <span class="_ _e"> </span>8, <span class="_"> </span>then <span class="_ _e"> </span>all <span class="_"> </span>pointers <span class="_ _e"> </span>returned <span class="_ _e"> </span>by <span class="_"> </span>these <span class="_ _e"> </span>three</span></span></div><div class="t m0 x32 h49 y1c2c ff19 fs26 fc0 sc0 ls0 ws0">functions would be so aligned.</div><a class="l" href="#pfe" data-dest-detail='[14,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.891993px;bottom:775.128903px;width:146.807000px;height:19.679992px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
