<div id="pf91" class="pf w4 h1f" data-page-no="91"><div class="pc pc91 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg91.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>4.12<span class="_ _97"> </span>File <span class="_"> </span>Size<span class="_ _1b"> </span><span class="ff18 ls153">111</span></div><div class="t m0 x35 h53 y12f ff16 fs2b fc0 sc0 ls0 ws0">4.12 <span class="_ _93"> </span>File<span class="_ _54"> </span>Siz <span class="_ _b"></span>e</div><div class="t m0 x32 h26 yffe ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _47"> </span><span class="ff1a">st_size<span class="_ _45"> </span></span>member <span class="_ _3"></span>of <span class="_ _9"></span>the<span class="_ _47"> </span><span class="ff1a">stat<span class="_ _45"> </span></span>structur<span class="_ _0"></span><span class="ls4f1">ec<span class="_ _b"></span><span class="ls0">ontains <span class="_ _9"></span>the <span class="_ _3"></span>size <span class="_ _9"></span>of <span class="_ _9"></span>the <span class="_ _3"></span>ﬁle <span class="_ _9"></span>in <span class="_ _3"></span>bytes.<span class="_ _16"> </span>This</span></span></div><div class="t m0 x32 h2a yfff ff19 fsf fc0 sc0 ls0 ws0">ﬁeld is meaningful only for regular ﬁles, dir<span class="_ _0"></span>ectories, and symbolic links.</div><div class="t m0 x76 h51 y1000 ff19 fs2a fc0 sc0 ls0 ws0">FreeBSD 8.0, Mac OS X 10.6.8, and Solaris 10 also deﬁne the ﬁle size for a pipe as the number of</div><div class="t m0 x76 h51 y1001 ff19 fs2a fc0 sc0 ls0 ws0">bytes that ar<span class="lse9">ea<span class="_ _5"></span><span class="ls0">vailable for reading from the pipe.<span class="_ _35"> </span><span class="lsed">We<span class="_ _9"></span></span>’ll discuss pipes in Section 15.2.</span></span></div><div class="t m0 x3f h2a y1002 ff19 fsf fc0 sc0 ls0 ws0">For a regular ﬁle, a <span class="_ _2"></span>ﬁle size of <span class="_ _2"></span>0 is allowed.<span class="_ _46"> </span><span class="ls5f">We<span class="_ _23"></span></span>’ll get an end-of-ﬁle <span class="_ _2"></span>indication on the</div><div class="t m0 x32 h2a y1003 ff19 fsf fc0 sc0 ls0 ws0">ﬁrst <span class="_ _2"></span>read <span class="_ _2"></span>of <span class="_ _2"></span>the <span class="_ _2"></span>ﬁle.<span class="_ _16"> </span>For <span class="_ _2"></span>a <span class="_ _3"></span>directory<span class="_ _4"></span><span class="ls4f2">,t<span class="_ _4f"></span><span class="ls0">he <span class="_ _2"></span>ﬁle <span class="_ _2"></span>size <span class="_ _3"></span>is <span class="_ _2"></span>usually <span class="_ _3"></span>a <span class="_ _2"></span>multiple <span class="_ _2"></span>of <span class="_ _3"></span>a <span class="_ _2"></span>number<span class="_ _1"></span><span class="ls7a">,s<span class="_ _4f"></span><span class="ls0">uch</span></span></span></span></div><div class="t m0 x32 h2a y1004 ff19 fsf fc0 sc0 ls0 ws0">as 16 or 512.<span class="_ _59"> </span><span class="ls5f">We <span class="_ _e"> </span>t<span class="_ _9"></span></span>alk about reading dir<span class="_ _0"></span>ectories in Section 4.22.</div><div class="t m0 x3f h2a y1005 ff19 fsf fc0 sc0 ls0 ws0">For <span class="_ _66"> </span>a <span class="_ _66"> </span>symbolic <span class="_ _47"> </span>link, <span class="_ _66"> </span>the <span class="_ _47"> </span>ﬁle <span class="_"> </span>size <span class="_ _47"> </span>is <span class="_"> </span>the <span class="_ _47"> </span>number <span class="_ _66"> </span>of <span class="_ _47"> </span>bytes <span class="_"> </span>in <span class="_ _47"> </span>the <span class="_"> </span>ﬁlename.<span class="_ _50"> </span>For</div><div class="t m0 x32 h26 y1006 ff19 fsf fc0 sc0 ls0 ws0">example, in the following case, the ﬁle size of 7 is the length of the pathname<span class="_"> </span><span class="ff1a">usr/lib</span>:</div><div class="t m0 x3f h57 y1007 ff1a fs2d fc0 sc0 ls0 ws0">lrwxrwxrwx <span class="_"> </span>1<span class="_"> </span>root <span class="_ _bd"> </span>7<span class="_"> </span>Sep 25 07:14 lib -&gt; usr/lib</div><div class="t m0 x32 h2a y1008 ff19 fsf fc0 sc0 ls0 ws0">(Note <span class="_ _2"></span>that <span class="_ _3"></span>symbolic <span class="_ _2"></span>links <span class="_ _2"></span>do <span class="_ _3"></span>not <span class="_ _2"></span>contain <span class="_ _3"></span>the <span class="_ _2"></span>normal <span class="_ _3"></span>C <span class="_ _2"></span>null <span class="_ _3"></span>byte <span class="_ _2"></span>at <span class="_ _3"></span>the <span class="_ _2"></span>end <span class="_ _3"></span>of <span class="_ _2"></span>the <span class="_ _3"></span>name,</div><div class="t m0 x32 h26 y1009 ff19 fsf fc0 sc0 ls0 ws0">as the length is always speciﬁed by<span class="_"> </span><span class="ff1a">st_size</span>.)</div><div class="t m0 x3f h26 y100a ff19 fsf fc0 sc0 ls0 ws0">Most <span class="_ _65"> </span>contemporary <span class="_ _48"> </span>UNIX <span class="_ _65"> </span>systems <span class="_ _48"> </span>provide <span class="_ _65"> </span>the <span class="_ _65"> </span>ﬁelds<span class="_ _7f"> </span><span class="ff1a">st_blksize<span class="_ _7f"> </span></span>and</div><div class="t m0 x32 h26 y100b ff1a fsf fc0 sc0 ls0 ws0">st_blocks<span class="ff19 ls4f3">.T<span class="_ _5b"></span><span class="ls0">he <span class="_ _2"></span>ﬁrst is <span class="_ _2"></span>the <span class="_ _2"></span>preferr<span class="_ _0"></span>ed block <span class="_ _2"></span>size <span class="_ _2"></span>for I/O <span class="_ _2"></span>for <span class="_ _2"></span>the <span class="_ _2"></span>ﬁle, and <span class="_ _2"></span>the <span class="_ _2"></span>latter is <span class="_ _2"></span>the</span></span></div><div class="t m0 x32 h2a y100c ff19 fsf fc0 sc0 ls0 ws0">actual <span class="_ _42"> </span>number <span class="_ _53"> </span>of <span class="_ _53"> </span>512</div><div class="t m0 x188 h2a y100d ff19 fsf fc0 sc0 ls0 ws0">-</div><div class="t m0 x134 h2a y100c ff19 fsf fc0 sc0 ls0 ws0">byte <span class="_ _42"> </span>blocks <span class="_ _53"> </span>that <span class="_ _53"> </span>ar<span class="ls4f4">ea<span class="_ _c"></span><span class="ls0">llocated. <span class="_ _44"> </span>Recall<span class="_ _44"> </span>from <span class="_ _42"> </span>Section <span class="_ _53"> </span>3.9 <span class="_ _53"> </span>that <span class="_ _53"> </span>we</span></span></div><div class="t m0 x32 h2a y100e ff19 fsf fc0 sc0 ls0 ws0">encountered <span class="_"> </span>the <span class="_ _47"> </span>minimum <span class="_ _47"> </span>amount <span class="_ _66"> </span>of <span class="_ _47"> </span>time <span class="_ _47"> </span>requir<span class="_ _1"></span>ed <span class="_ _47"> </span>to <span class="_ _47"> </span>read <span class="_"> </span>a <span class="_ _47"> </span>ﬁle <span class="_ _47"> </span>when <span class="_ _66"> </span>we <span class="_ _47"> </span>used</div><div class="t m0 x32 h26 y100f ff1a fsf fc0 sc0 ls0 ws0">st_blksize<span class="_ _47"> </span><span class="ff19">for <span class="_ _3"></span>the<span class="_ _47"> </span></span>read<span class="_ _45"> </span><span class="ff19">operations. <span class="_ _47"> </span>The<span class="_ _47"> </span>standar<span class="ls4f5">dI<span class="_ _b"></span><span class="ls0">/O <span class="_ _9"></span>library<span class="_ _4"></span><span class="ls4f5">,w<span class="_ _8"></span><span class="ls0">hich <span class="_ _3"></span>we <span class="_ _9"></span>describe <span class="_ _3"></span>in</span></span></span></span></span></div><div class="t m0 x32 h26 y1010 ff19 fsf fc0 sc0 ls0 ws0">Chapter 5, also tries to read or write<span class="_"> </span><span class="ff1a">st_blksize<span class="_ _80"> </span></span>bytes at a time, for efﬁciency<span class="_ _4"></span>.</div><div class="t m0 x76 h51 y1011 ff19 fs2a fc0 sc0 ls0 ws0">Be <span class="_ _3"></span>awar<span class="ls4f6">et<span class="_ _4f"></span><span class="ls0">hat <span class="_ _9"></span>differ<span class="_ _0"></span>ent <span class="_ _3"></span>versions <span class="_ _9"></span>of <span class="_ _3"></span>the <span class="_ _9"></span>UNIX <span class="_ _3"></span>System <span class="_ _9"></span>use <span class="_ _3"></span>units <span class="_ _9"></span>other <span class="_ _3"></span>than <span class="_ _9"></span>512</span></span></div><div class="t m0 x189 h51 y1012 ff19 fs2a fc0 sc0 ls0 ws0">-</div><div class="t m0 x4c h51 y1011 ff19 fs2a fc0 sc0 ls0 ws0">byte <span class="_ _3"></span>blocks <span class="_ _9"></span>for</div><div class="t m0 x76 h52 y1013 ff1a fs2a fc0 sc0 ls0 ws0">st_blocks<span class="ff19 ls10f">.U<span class="_ _43"></span><span class="ls0">se of this value is nonportable.</span></span></div><div class="t m0 x35 h27 y1014 ff16 fsf fc0 sc0 ls0 ws0">Holes in a File</div><div class="t m0 x32 h2a y1015 ff19 fsf fc0 sc0 ls0 ws0">In <span class="_ _42"> </span>Section <span class="_ _53"> </span>3.6, <span class="_ _42"> </span>we <span class="_ _53"> </span>mentioned <span class="_ _53"> </span>that <span class="_ _42"> </span>a <span class="_ _53"> </span>regular <span class="_ _42"> </span>ﬁle <span class="_ _42"> </span>can <span class="_ _53"> </span>contain <span class="_ _53"> </span>‘<span class="_ _0"></span>‘holes.’<span class="_ _1"></span><span class="ls4f7">’W<span class="_ _5d"></span><span class="ls4f8">es<span class="_ _c"></span><span class="ls0">howed <span class="_ _53"> </span>an</span></span></span></div><div class="t m0 x32 h2a y1016 ff19 fsf fc0 sc0 ls0 ws0">example <span class="_ _9"></span>of <span class="_ _3"></span>this <span class="_ _9"></span>in <span class="_ _9"></span>Figur<span class="ls4f9">e3<span class="_ _b"></span><span class="ls0">.2. <span class="_ _45"> </span>Holes<span class="_ _45"> </span>ar<span class="_ _0"></span><span class="ls4f9">ec<span class="_ _b"></span><span class="ls45">re<span class="_ _2"></span><span class="ls0">ated <span class="_ _9"></span>by <span class="_ _3"></span>seeking <span class="_ _9"></span>past <span class="_ _9"></span>the <span class="_ _9"></span>current <span class="_ _3"></span>end <span class="_ _9"></span>of <span class="_ _9"></span>ﬁle</span></span></span></span></span></div><div class="t m0 x32 h2a y1017 ff19 fsf fc0 sc0 ls0 ws0">and writing some data.<span class="_ _59"> </span>As an example, consider the following:</div><div class="t m0 x3f h57 y1018 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">ls -l core</span></div><div class="t m0 x3f h57 y1019 ff1a fs2d fc0 sc0 ls0 ws0">-rw-r--r-- <span class="_"> </span>1<span class="_"> </span>sar <span class="_ _d9"> </span>8483248<span class="_"> </span>Nov 18 12:18 core</div><div class="t m0 x3f h57 y101a ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">du -s core</span></div><div class="t m0 x3f h57 y101b ff1a fs2d fc0 sc0 ls0 ws0">272 <span class="_ _15"> </span>core</div><div class="t m0 x32 h26 y101c ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _9"></span>size <span class="_ _9"></span>of <span class="_ _9"></span>the <span class="_ _9"></span>ﬁle<span class="_ _45"> </span><span class="ff1a">core<span class="_ _45"> </span></span>is <span class="_ _9"></span>slightly <span class="_ _9"></span>mor<span class="ls1af">et<span class="_ _b"></span><span class="ls0">han <span class="_ _3"></span>8 <span class="_ _9"></span>MB, <span class="_ _9"></span>yet <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">du<span class="_ _45"> </span></span>command <span class="_ _9"></span>reports <span class="_ _9"></span>that</span></span></div><div class="t m0 x32 h2a y101d ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _47"> </span>amount <span class="_ _47"> </span>of <span class="_ _47"> </span>disk <span class="_ _47"> </span>space <span class="_ _47"> </span>used <span class="_ _47"> </span>by <span class="_ _47"> </span>the <span class="_ _47"> </span>ﬁle <span class="_ _47"> </span>is <span class="_ _47"> </span>272 <span class="_ _47"> </span>512</div><div class="t m0 xa4 h2a y101e ff19 fsf fc0 sc0 ls0 ws0">-</div><div class="t m0 x15b h2a y101d ff19 fsf fc0 sc0 ls0 ws0">byte <span class="_ _47"> </span>blocks <span class="_ _47"> </span>(139,264 <span class="_ _47"> </span>bytes).</div><div class="t m0 x32 h2a y101f ff19 fsf fc0 sc0 ls0 ws0">Obviously<span class="_ _4"></span><span class="ls44">,t<span class="_ _5"></span><span class="ls0">his ﬁle has many holes.</span></span></div><div class="t m0 x76 h52 y1020 ff19 fs2a fc0 sc0 ls0 ws0">The<span class="_ _45"> </span><span class="ff1a">du<span class="_ _35"> </span></span>command <span class="_ _42"> </span>on <span class="_ _42"> </span>many <span class="_ _42"> </span>BSD-derived <span class="_ _42"> </span>systems <span class="_ _42"> </span>reports <span class="_ _42"> </span>the <span class="_ _42"> </span>number <span class="_ _42"> </span>of <span class="_ _42"> </span>1,024</div><div class="t m0 x18a h51 y1021 ff19 fs2a fc0 sc0 ls0 ws0">-</div><div class="t m0 x18b h51 y1020 ff19 fs2a fc0 sc0 ls0 ws0">byte <span class="_ _42"> </span>blocks.</div><div class="t m0 x76 h51 y1022 ff19 fs2a fc0 sc0 ls0 ws0">Solaris <span class="_ _23"> </span>reports <span class="_ _9"></span>the <span class="_ _23"> </span>number <span class="_ _23"> </span>of <span class="_ _23"> </span>512</div><div class="t m0 x6c h51 y1023 ff19 fs2a fc0 sc0 ls0 ws0">-</div><div class="t m0 x18c h51 y1022 ff19 fs2a fc0 sc0 ls0 ws0">byte <span class="_ _23"> </span>blocks.<span class="_ _46"> </span>On <span class="_ _23"> </span>Linux, <span class="_ _23"> </span>the <span class="_ _23"> </span>units <span class="_ _23"> </span>reported <span class="_ _9"></span>depend <span class="_ _23"> </span>on <span class="_ _23"> </span>the</div><div class="t m0 x76 h52 y1024 ff19 fs2a fc0 sc0 ls0 ws0">whether <span class="_ _3"></span>the<span class="_ _80"> </span><span class="ff1a">POSIXLY_CORRECT<span class="_ _66"> </span></span>environment <span class="_ _3"></span>is <span class="_ _3"></span>set.<span class="_ _4b"> </span>When <span class="_ _3"></span>it <span class="_ _3"></span>is <span class="_ _9"></span>set, <span class="_ _2"></span>the<span class="_ _66"> </span><span class="ff1a">du<span class="_ _66"> </span></span>command <span class="_ _3"></span>reports</div><div class="t m0 x76 h51 y1025 ff19 fs2a fc0 sc0 ls0 ws0">1,024</div><div class="t m0 xf6 h51 y1026 ff19 fs2a fc0 sc0 ls0 ws0">-</div><div class="t m0 xdf h51 y1025 ff19 fs2a fc0 sc0 ls0 ws0">byte block units; when it is not set, the command reports 512</div><div class="t m0 x5e h51 y1026 ff19 fs2a fc0 sc0 ls0 ws0">-</div><div class="t m0 x111 h51 y1025 ff19 fs2a fc0 sc0 ls0 ws0">byte block units.</div><div class="t m0 x3f h26 y1027 ff19 fsf fc0 sc0 ls0 ws0">As <span class="_ _9"></span>we <span class="_ _9"></span>mentioned <span class="_ _9"></span>in <span class="_ _23"></span>Section <span class="_ _9"></span>3.6, <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">read<span class="_ _45"> </span></span>function <span class="_ _9"></span>returns <span class="_ _3"></span>data <span class="_ _23"></span>bytes <span class="_ _9"></span>of <span class="_ _9"></span>0 <span class="_ _9"></span>for <span class="_ _9"></span>any</div><div class="t m0 x32 h2a y1028 ff19 fsf fc0 sc0 ls0 ws0">byte <span class="_ _23"> </span>positions <span class="_ _23"> </span>that <span class="_ _42"> </span>have <span class="_ _23"> </span>not <span class="_ _23"> </span>been <span class="_ _42"> </span>written.<span class="_ _51"> </span>If <span class="_ _23"></span>we <span class="_ _23"> </span>execute <span class="_ _42"> </span>the <span class="_ _23"></span>following <span class="_ _23"> </span>command, <span class="_ _23"> </span>we</div><div class="t m0 x32 h2a y1029 ff19 fsf fc0 sc0 ls0 ws0">can see that the normal I/O operations read up thr<span class="_ _0"></span>ough the size of the ﬁle:</div><a class="l" href="#pfd" data-dest-detail='[13,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892409px;bottom:1236.288916px;width:87.479805px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
