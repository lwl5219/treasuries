<div id="pf1c0" class="pf w4 h1f" data-page-no="1c0"><div class="pc pc1c0 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg1c0.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">414<span class="_ _1b"> </span><span class="ff19">Threads <span class="_ _24b"> </span>Chapter<span class="_ _78"> </span><span class="ls7ed">11</span></span></div><div class="t m0 x32 h2a y12f ff19 fsf fc0 sc0 ls0 ws0">variable, <span class="_ _35"> </span>but <span class="_ _44"> </span>if <span class="_ _44"> </span>the <span class="_ _35"> </span>condition <span class="_ _44"> </span>variable <span class="_ _35"> </span>is <span class="_ _44"> </span>allocated <span class="_ _35"> </span>dynamically<span class="_ _6"></span>,<span class="_ _54"> </span>we<span class="_ _51"> </span>can <span class="_ _44"> </span>use <span class="_ _35"> </span>the</div><div class="t m0 x32 h26 y130 ff1a fsf fc0 sc0 ls0 ws0">pthread_cond_init<span class="_ _80"> </span><span class="ff19">function to initialize it.</span></div><div class="t m0 x3f h26 y131 ff19 fsf fc0 sc0 ls5f ws0">We <span class="_ _46"> </span>c<span class="_ _9"></span><span class="ls0">an <span class="_ _45"> </span>use <span class="_ _47"> </span>the<span class="_ _5a"> </span><span class="ff1a">pthread_cond_destroy<span class="_"> </span></span>function <span class="_ _47"> </span>to <span class="_ _45"> </span>deinitialize <span class="_ _47"> </span>a <span class="_ _45"> </span>condition</span></div><div class="t m0 x32 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">variable befor<span class="ls44">ef<span class="_ _4f"></span><span class="ls45">re<span class="_ _2"></span><span class="ls0">eing its underlying memory<span class="_ _6"></span>.</span></span></span></div><div class="t m0 x3f h57 y126b ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;pthread.h&gt;</div><div class="t m0 x3f h57 y3449 ff1a fs2d fc0 sc0 ls0 ws0">int pthread_cond_init(pthread_cond_t *restrict<span class="_"> </span><span class="ff1b">cond</span>,</div><div class="t m0 x146 h57 y344a ff1a fs2d fc0 sc0 ls0 ws0">const pthread_condattr_t *restrict<span class="_"> </span><span class="ff1b">attr</span>);</div><div class="t m0 x3f h57 y344b ff1a fs2d fc0 sc0 ls0 ws0">int pthread_cond_destroy(pthread_cond_t *<span class="ff1b">cond</span>);</div><div class="t m0 xca h5f y344c ff19 fs2d fc0 sc0 ls0 ws0">Both return: 0 if OK, err<span class="_ _0"></span>or number on failure</div><div class="t m0 x32 h4a y344d ff19 fs26 fc0 sc0 ls0 ws0">Unless <span class="_ _53"> </span>you <span class="_ _e"> </span>need <span class="_ _53"> </span>to <span class="_ _e"> </span>create <span class="_ _53"> </span>a <span class="_ _e"> </span>conditional <span class="_ _53"> </span>variable <span class="_ _e"> </span>with <span class="_ _e"> </span>nondefault <span class="_ _53"> </span>attributes, <span class="_ _e"> </span>the<span class="_ _4b"> </span><span class="ff1b">attr</span></div><div class="t m0 x32 h4d y344e ff19 fs26 fc0 sc0 ls0 ws0">argument <span class="_"> </span>to<span class="_ _59"> </span><span class="ff1a">pthread_cond_init<span class="_ _46"> </span></span>can <span class="_"> </span>be <span class="_"> </span>set <span class="_"> </span>to<span class="_ _46"> </span><span class="ff1a">NULL</span><span class="lse2d">.W<span class="_ _95"></span><span class="lse2e">ew<span class="_ _4a"></span><span class="ls0">ill <span class="_"> </span>discuss <span class="_"> </span>condition</span></span></span></div><div class="t m0 x32 h49 y344f ff19 fs26 fc0 sc0 ls0 ws0">variable attributes in Section 12.4.3.</div><div class="t m0 x3f h4d y3450 ff19 fs26 fc0 sc0 ls164 ws0">We <span class="_ _44"> </span>u<span class="_ _9"></span><span class="ls0">se<span class="_ _46"> </span><span class="ff1a">pthread_cond_wait<span class="_ _46"> </span></span>to <span class="_"> </span>wait <span class="_"> </span>for <span class="_"> </span>a <span class="_"> </span>condition <span class="_"> </span>to <span class="_ _e"> </span>be <span class="_"> </span>true. <span class="_ _59"> </span>A<span class="_ _46"> </span>variant <span class="_"> </span>is</span></div><div class="t m0 x32 h49 y3451 ff19 fs26 fc0 sc0 ls0 ws0">provided <span class="_ _9"></span>to <span class="_ _23"></span>return <span class="_ _9"></span>an <span class="_ _23"></span>error <span class="_ _9"></span>code <span class="_ _23"></span>if <span class="_ _23"></span>the <span class="_ _23"></span>condition <span class="_ _9"></span>hasn’t <span class="_ _23"> </span>been <span class="_ _23"></span>satisﬁed <span class="_ _23"></span>in <span class="_ _9"></span>the <span class="_ _23"> </span>speciﬁed</div><div class="t m0 x32 h49 y3452 ff19 fs26 fc0 sc0 ls0 ws0">amount of time.</div><div class="t m0 x3f h4e y3453 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;pthread.h&gt;</div><div class="t m0 x3f h4e y3454 ff1a fs28 fc0 sc0 ls0 ws0">int pthread_cond_wait(pthread_cond_t *restrict<span class="_"> </span><span class="ff1b">cond</span>,</div><div class="t m0 x146 h4e y3455 ff1a fs28 fc0 sc0 ls0 ws0">pthread_mutex_t *restrict<span class="_"> </span><span class="ff1b">mutex</span>);</div><div class="t m0 x3f h4e y3456 ff1a fs28 fc0 sc0 ls0 ws0">int pthread_cond_timedwait(pthread_cond_t *restrict<span class="_"> </span><span class="ff1b">cond</span>,</div><div class="t m0 x99 h4e y3457 ff1a fs28 fc0 sc0 ls0 ws0">pthread_mutex_t *restrict<span class="_"> </span><span class="ff1b">mutex</span>,</div><div class="t m0 x99 h4e y3458 ff1a fs28 fc0 sc0 ls0 ws0">const struct timespec *restrict<span class="_"> </span><span class="ff1b">tsptr</span>);</div><div class="t m0 xca h7c y3459 ff19 fs28 fc0 sc0 ls0 ws0">Both return: 0 if OK, err<span class="_ _0"></span>or number on failure</div><div class="t m0 x3f h54 y345a ff19 fs2c fc0 sc0 ls0 ws0">The <span class="_ _47"> </span>mutex <span class="_ _47"> </span>passed <span class="_ _66"> </span>to<span class="_ _16"> </span><span class="ff1a">pthread_cond_wait<span class="_ _61"> </span></span>protects <span class="_ _47"> </span>the <span class="_ _47"> </span>condition.<span class="_ _50"> </span>The <span class="_ _47"> </span>caller</div><div class="t m0 x32 h55 y345b ff19 fs2c fc0 sc0 ls0 ws0">passes <span class="_ _9"></span>it <span class="_ _3"></span>locked <span class="_ _9"></span>to <span class="_ _9"></span>the <span class="_ _9"></span>function, <span class="_ _9"></span>which <span class="_ _3"></span>then <span class="_ _9"></span>atomically <span class="_ _9"></span>places <span class="_ _9"></span>the <span class="_ _9"></span>calling <span class="_ _3"></span>thread <span class="_ _9"></span>on <span class="_ _3"></span>the</div><div class="t m0 x32 h55 y345c ff19 fs2c fc0 sc0 ls0 ws0">list of <span class="_ _2"></span>threads waiting <span class="_ _2"></span>for <span class="_ _2"></span>the <span class="_ _2"></span>condition and <span class="_ _2"></span>unlocks <span class="_ _2"></span>the <span class="_ _2"></span>mutex.<span class="_ _46"> </span>This <span class="_ _2"></span>closes <span class="_ _2"></span>the <span class="_ _2"></span>window</div><div class="t m0 x32 h55 y345d ff19 fs2c fc0 sc0 ls0 ws0">between the time that the condition is checked and <span class="_ _2"></span>the time that the thread goes to sleep</div><div class="t m0 x32 h55 y345e ff19 fs2c fc0 sc0 ls0 ws0">waiting <span class="_ _42"> </span>for <span class="_ _53"> </span>the <span class="_ _53"> </span>condition <span class="_ _42"> </span>to <span class="_ _53"> </span>change, <span class="_ _53"> </span>so <span class="_ _53"> </span>that <span class="_ _42"> </span>the <span class="_ _53"> </span>thread <span class="_ _42"> </span>doesn’t <span class="_ _53"> </span>miss <span class="_ _42"> </span>a <span class="_ _53"> </span>change <span class="_ _53"> </span>in <span class="_ _42"> </span>the</div><div class="t m0 x32 h54 y345f ff19 fs2c fc0 sc0 ls0 ws0">condition. <span class="_"> </span>When<span class="_"> </span><span class="ff1a">pthread_cond_wait<span class="_ _80"> </span></span><span class="ls150">re<span class="_ _2"></span></span>turns, the mutex is again locked.</div><div class="t m0 x3f h54 y3460 ff19 fs2c fc0 sc0 ls0 ws0">The<span class="_ _35"> </span><span class="ff1a">pthread_cond_timedwait<span class="_ _35"> </span></span>function <span class="_ _23"> </span>provides <span class="_ _23"> </span>the <span class="_ _42"> </span>same <span class="_ _23"> </span>functionality <span class="_ _42"> </span>as <span class="_ _23"> </span>the</div><div class="t m0 x32 h54 y3461 ff1a fs2c fc0 sc0 ls0 ws0">pthread_cond_wait<span class="_ _35"> </span><span class="ff19">function <span class="_ _42"> </span>with <span class="_ _42"> </span>the <span class="_ _42"> </span>addition <span class="_ _23"> </span>of <span class="_ _42"> </span>the <span class="_ _42"> </span>timeout <span class="_ _42"> </span>(<span class="ff1b">tsptr</span>). <span class="_ _35"> </span>The<span class="_ _35"> </span>timeout</span></div><div class="t m0 x32 h54 y3462 ff19 fs2c fc0 sc0 ls0 ws0">value speciﬁes how long we ar<span class="ls142">ew<span class="_ _4f"></span><span class="ls0">illing to wait expressed as a<span class="_"> </span><span class="ff1a">timespec<span class="_ _80"> </span></span>structure.</span></span></div><div class="t m0 x3f h55 y3463 ff19 fs2c fc0 sc0 ls0 ws0">Just <span class="_ _3"></span>as <span class="_ _3"></span>we <span class="_ _9"></span>saw <span class="_ _3"></span>in <span class="_ _3"></span>Figur<span class="lse2f">e1<span class="_ _43"></span><span class="ls0">1.13, <span class="_ _9"></span>we <span class="_ _3"></span>need <span class="_ _3"></span>to <span class="_ _9"></span>specify <span class="_ _3"></span>how <span class="_ _3"></span>long <span class="_ _3"></span>we <span class="_ _9"></span>ar<span class="lse30">ew<span class="_ _b"></span><span class="ls0">illing <span class="_ _3"></span>to <span class="_ _9"></span>wait</span></span></span></span></div><div class="t m0 x32 h55 y3464 ff19 fs2c fc0 sc0 ls0 ws0">as <span class="_ _9"></span>an <span class="_ _9"></span>absolute <span class="_ _9"></span>time <span class="_ _9"></span>instead <span class="_ _9"></span>of <span class="_ _23"></span>a <span class="_ _9"></span>r<span class="_ _0"></span>elative <span class="_ _9"></span>time.<span class="_ _5a"> </span>For <span class="_ _9"></span>example, <span class="_ _9"></span>suppose <span class="_ _9"></span>we <span class="_ _9"></span>ar<span class="lse31">ew<span class="_ _b"></span><span class="ls0">illing <span class="_ _9"></span>to</span></span></div><div class="t m0 x32 h54 y3465 ff19 fs2c fc0 sc0 ls0 ws0">wait <span class="_ _2"></span>3 <span class="_ _2"></span>minutes.<span class="_ _46"> </span>Instead <span class="_ _2"></span>of <span class="_ _2"></span>translating <span class="_ _2"></span>3 <span class="_ _2"></span>minutes <span class="_ _2"></span>into <span class="_ _2"></span>a<span class="_ _47"> </span><span class="ff1a">timespec<span class="_ _66"> </span></span>structure, we <span class="_ _2"></span>need <span class="_ _2"></span>to</div><div class="t m0 x32 h54 y3466 ff19 fs2c fc0 sc0 ls0 ws0">translate now<span class="_ _42"> </span><span class="ff1c">+<span class="_ _53"> </span></span><span class="ls142">3m<span class="_ _d"></span><span class="ls0">inutes into a<span class="_"> </span><span class="ff1a">timespec<span class="_ _66"> </span></span>structur<span class="_ _0"></span>e.</span></span></div><div class="t m0 x3f h54 y3467 ff19 fs2c fc0 sc0 ls155 ws0">We <span class="_ _35"> </span>c<span class="_ _9"></span><span class="ls0">an <span class="_ _e"> </span>use <span class="_ _e"> </span>the<span class="_ _59"> </span><span class="ff1a">clock_gettime<span class="_ _4b"> </span></span>function <span class="_ _e"> </span>(Section <span class="_ _e"> </span>6.10) <span class="_ _e"> </span>to <span class="_ _e"> </span>get <span class="_ _e"> </span>the <span class="_ _e"> </span>current <span class="_ _53"> </span>time</span></div><div class="t m0 x32 h54 y3468 ff19 fs2c fc0 sc0 ls0 ws0">expressed <span class="_ _2"></span>as <span class="_ _3"></span>a<span class="_ _47"> </span><span class="ff1a">timespec<span class="_ _47"> </span></span>structure. <span class="_ _47"> </span>However<span class="_ _6"></span><span class="lse32">,t<span class="_ _4f"></span><span class="ls0">his <span class="_ _3"></span>function <span class="_ _3"></span>is <span class="_ _3"></span>not <span class="_ _3"></span>yet <span class="_ _3"></span>supported <span class="_ _3"></span>on <span class="_ _3"></span>all</span></span></div><div class="t m0 x32 h54 y3469 ff19 fs2c fc0 sc0 ls0 ws0">platforms. <span class="_ _44"> </span>Alternatively<span class="_ _6"></span>,<span class="_ _44"> </span>we<span class="_ _4b"> </span>can <span class="_ _42"> </span>use <span class="_ _53"> </span>the<span class="_ _4b"> </span><span class="ff1a">gettimeofday<span class="_ _44"> </span></span>function <span class="_ _53"> </span>to <span class="_ _53"> </span>get <span class="_ _53"> </span>the <span class="_ _53"> </span>current</div><div class="t m0 x32 h54 y346a ff19 fs2c fc0 sc0 ls0 ws0">time <span class="_ _9"></span>expressed <span class="_ _3"></span>as <span class="_ _9"></span>a<span class="_ _45"> </span><span class="ff1a">timeval<span class="_ _45"> </span></span>structur<span class="_ _0"></span><span class="lse33">ea<span class="_ _b"></span><span class="ls0">nd <span class="_ _9"></span>translate <span class="_ _9"></span>it <span class="_ _9"></span>into <span class="_ _9"></span>a<span class="_ _45"> </span><span class="ff1a">timespec<span class="_ _45"> </span></span>structur<span class="_ _1"></span>e. <span class="_ _45"> </span>T<span class="_ _6"></span>o</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
