<div id="pf266" class="pf w4 h1f" data-page-no="266"><div class="pc pc266 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg266.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">580<span class="_ _1b"> </span><span class="ff19">Interprocess <span class="_"> </span>Communication<span class="_ _2c"> </span>Chapter <span class="_"> </span>15</span></div><div class="t m0 x32 h2a y12f ff19 fsf fc0 sc0 ls0 ws0">creation <span class="_ _23"> </span>mask <span class="_ _42"> </span>(Sections <span class="_ _42"> </span>4.5 <span class="_ _42"> </span>and <span class="_ _42"> </span>4.8).<span class="_ _54"> </span>Note, <span class="_ _23"> </span>however<span class="_ _1"></span><span class="ls1298">,t<span class="_ _43"></span><span class="ls0">hat <span class="_ _42"> </span>only <span class="_ _42"> </span>read <span class="_ _23"> </span>and <span class="_ _42"> </span>write <span class="_ _42"> </span>access</span></span></div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">matter<span class="_ _6"></span><span class="lscb7">,b<span class="_ _4f"></span><span class="ls0">ut <span class="_ _3"></span>the <span class="_ _3"></span>interfaces <span class="_ _2"></span>don’t <span class="_ _3"></span>allow <span class="_ _3"></span>us <span class="_ _3"></span>to <span class="_ _3"></span>specify <span class="_ _3"></span>the <span class="_ _3"></span>mode <span class="_ _3"></span>when <span class="_ _3"></span>we <span class="_ _3"></span>open <span class="_ _3"></span>an <span class="_ _3"></span>existing</span></span></div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">semaphore. <span class="_"> </span>Implementations<span class="_"> </span>usually open semaphor<span class="_ _0"></span>es for both r<span class="_ _0"></span>eading and writing.</div><div class="t m0 x3f h2b y132 ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _47"> </span><span class="ff1b">value<span class="_ _45"> </span></span>argument <span class="_ _3"></span>is <span class="_ _9"></span>used <span class="_ _3"></span>to <span class="_ _9"></span>specify <span class="_ _3"></span>the <span class="_ _9"></span>initial <span class="_ _9"></span>value <span class="_ _3"></span>for <span class="_ _9"></span>the <span class="_ _3"></span>semaphor<span class="ls2da">ew<span class="_ _b"></span><span class="ls0">hen <span class="_ _9"></span>we</span></span></div><div class="t m0 x32 h26 y133 ff19 fsf fc0 sc0 ls0 ws0">create it.<span class="_ _59"> </span>It can take on any value from 0 to<span class="_"> </span><span class="ff1a">SEM_VALUE_MAX<span class="_ _80"> </span></span>(Figur<span class="ls44">e2<span class="_ _4f"></span><span class="ls0">.9).</span></span></div><div class="t m0 x3f h2b y134 ff19 fsf fc0 sc0 ls0 ws0">If <span class="_"> </span>we <span class="_ _e"> </span>want <span class="_"> </span>to <span class="_"> </span>ensur<span class="_ _0"></span><span class="ls4a9">et<span class="_ _4a"></span><span class="ls0">hat <span class="_"> </span>we <span class="_"> </span>ar<span class="_ _0"></span><span class="ls4a9">ec<span class="_ _4a"></span><span class="ls45">re<span class="ls0">ating <span class="_"> </span>the <span class="_"> </span>semaphore, <span class="_ _e"> </span>we <span class="_"> </span>can <span class="_"> </span>set <span class="_ _e"> </span>the<span class="_ _59"> </span><span class="ff1b">oﬂag</span></span></span></span></span></span></div><div class="t m0 x32 h26 y135 ff19 fsf fc0 sc0 ls0 ws0">argument <span class="_ _42"> </span>to<span class="_ _4b"> </span><span class="ff1a">O_CREAT|O_EXCL</span><span class="ls1299">.T<span class="_ _52"></span><span class="ls0">his <span class="_ _53"> </span>will <span class="_ _53"> </span>cause<span class="_ _4b"> </span><span class="ff1a">sem_open<span class="_ _4b"> </span></span>to <span class="_ _e"> </span>fail <span class="_ _53"> </span>if <span class="_ _e"> </span>the <span class="_ _53"> </span>semaphore</span></span></div><div class="t m0 x32 h2a y136 ff19 fsf fc0 sc0 ls0 ws0">already exists.</div><div class="t m0 x3f h2a y137 ff19 fsf fc0 sc0 ls5f ws0">To <span class="_ _46"> </span>p<span class="_ _23"></span><span class="ls45">ro<span class="ls0">mote <span class="_ _45"> </span>portability<span class="_ _6"></span>,<span class="_ _5a"> </span>we<span class="_ _5a"> </span>must <span class="_ _45"> </span>follow <span class="_ _45"> </span>certain <span class="_ _45"> </span>conventions <span class="_ _35"> </span>when <span class="_ _45"> </span>selecting <span class="_ _45"> </span>a</span></span></div><div class="t m0 x32 h2a y138 ff19 fsf fc0 sc0 ls0 ws0">semaphor<span class="ls44">en<span class="_ _4f"></span><span class="ls0">ame.</span></span></div><div class="t m0 x3f h2a ya24 ff19 fsf fc0 sc0 ls49 ws0">•T<span class="_ _4d"></span><span class="ls0">he <span class="_ _e"> </span>ﬁrst <span class="_"> </span>character <span class="_ _53"> </span>in <span class="_"> </span>the <span class="_ _e"> </span>name <span class="_"> </span>should <span class="_ _53"> </span>be <span class="_"> </span>a <span class="_ _e"> </span>slash <span class="_ _e"> </span>(/).<span class="_ _60"> </span>Although <span class="_ _e"> </span>there<span class="_ _4b"> </span>is<span class="_ _59"> </span>no</span></div><div class="t m0 x15 h2a y34a ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">quirement <span class="_ _3"></span>that <span class="_ _9"></span>an <span class="_ _9"></span>implementation <span class="_ _9"></span>of <span class="_ _9"></span>POSIX <span class="_ _3"></span>semaphores <span class="_ _9"></span>uses <span class="_ _3"></span>the <span class="_ _9"></span>ﬁle <span class="_ _9"></span>system,</span></div><div class="t m0 x15 h2b ya65 ff19 fsf fc0 sc0 ls0 ws0">if <span class="_ _23"> </span>the <span class="_ _23"> </span>ﬁle <span class="_ _23"> </span>system<span class="_ _35"> </span><span class="ff1b">is<span class="_ _35"> </span></span>used, <span class="_ _23"> </span>we <span class="_ _42"> </span>want <span class="_ _23"></span>to <span class="_ _23"> </span>remove <span class="_ _23"></span>any <span class="_ _23"> </span>ambiguity <span class="_ _23"> </span>as <span class="_ _42"> </span>to <span class="_ _23"></span>the <span class="_ _23"> </span>starting</div><div class="t m0 x15 h2a ya66 ff19 fsf fc0 sc0 ls0 ws0">point from which the name is interpr<span class="_ _0"></span>eted.</div><div class="t m0 x3f h2a ya28 ff19 fsf fc0 sc0 ls49 ws0">•T<span class="_ _4d"></span><span class="ls0">he <span class="_"> </span>name <span class="_"> </span>should <span class="_"> </span>contain <span class="_"> </span>no <span class="_"> </span>other <span class="_"> </span>slashes <span class="_ _66"> </span>to <span class="_"> </span>avoid <span class="_"> </span>implementation-deﬁned</span></div><div class="t m0 x15 h26 ya29 ff19 fsf fc0 sc0 ls0 ws0">behavior<span class="_ _6"></span><span class="ls129a">.F<span class="_ _49"></span><span class="ls0">or <span class="_ _47"> </span>example, <span class="_ _47"> </span>if <span class="_ _47"> </span>the <span class="_ _45"> </span>ﬁle <span class="_ _47"> </span>system <span class="_ _45"> </span>is <span class="_ _47"> </span>used, <span class="_ _47"> </span>the <span class="_ _45"> </span>names<span class="_ _61"> </span><span class="ff1a">/mysem<span class="_"> </span></span>and</span></span></div><div class="t m0 x15 h26 ya2a ff1a fsf fc0 sc0 ls0 ws0">//mysem<span class="_ _16"> </span><span class="ff19">would <span class="_ _45"> </span>evaluate <span class="_ _47"> </span>to <span class="_ _45"> </span>the <span class="_ _45"> </span>same <span class="_ _47"> </span>ﬁlename, <span class="_ _45"> </span>but <span class="_ _47"> </span>if <span class="_ _45"> </span>the <span class="_ _47"> </span>implementation</span></div><div class="t m0 x15 h2a y155d ff19 fsf fc0 sc0 ls0 ws0">doesn’t use <span class="_ _2"></span>the ﬁle <span class="_ _2"></span>system, the <span class="_ _2"></span>two <span class="_ _2"></span>names could <span class="_ _2"></span>be treated as <span class="_ _2"></span>differ<span class="_ _0"></span>ent (consider</div><div class="t m0 x15 h2a y155e ff19 fsf fc0 sc0 ls0 ws0">what <span class="_ _3"></span>would <span class="_ _3"></span>happen <span class="_ _3"></span>if <span class="_ _3"></span>the <span class="_ _3"></span>implementation <span class="_ _3"></span>hashed <span class="_ _3"></span>the <span class="_ _3"></span>name <span class="_ _3"></span>to <span class="_ _3"></span>an <span class="_ _3"></span>integer <span class="_ _9"></span>value</div><div class="t m0 x15 h2a y45f6 ff19 fsf fc0 sc0 ls0 ws0">used to identify the semaphore).</div><div class="t m0 x3f h2a y1cb2 ff19 fsf fc0 sc0 ls49 ws0">•T<span class="_ _4d"></span><span class="ls0">he <span class="_ _23"></span>maximum <span class="_ _23"> </span>length <span class="_ _23"> </span>of <span class="_ _23"> </span>the <span class="_ _42"> </span>semaphor<span class="ls129b">en<span class="_ _43"></span><span class="ls0">ame <span class="_ _23"></span>is <span class="_ _23"> </span>implementation <span class="_ _23"> </span>deﬁned.<span class="_ _51"> </span>The</span></span></span></div><div class="t m0 x15 h26 y1cb3 ff19 fsf fc0 sc0 ls0 ws0">name <span class="_"> </span>should <span class="_ _47"> </span>be <span class="_"> </span>no <span class="_ _66"> </span>longer <span class="_ _47"> </span>than<span class="_ _46"> </span><span class="ff1a">_POSIX_NAME_MAX<span class="_ _61"> </span></span>(Figur<span class="ls129c">e2<span class="_ _1d"></span><span class="ls0">.8) <span class="_ _47"> </span>characters,</span></span></div><div class="t m0 x15 h2a y45f7 ff19 fsf fc0 sc0 ls0 ws0">because this is the minimum acceptable limit <span class="_ _2"></span>to the maximum name length if <span class="_ _2"></span>the</div><div class="t m0 x15 h2a y45f8 ff19 fsf fc0 sc0 ls0 ws0">implementation does use the ﬁle system.</div><div class="t m0 x3f h26 y28df ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _4b"> </span><span class="ff1a">sem_open<span class="_ _59"> </span></span>function <span class="_ _e"> </span>returns <span class="_ _53"> </span>a <span class="_ _e"> </span>semaphor<span class="ls129d">ep<span class="_ _55"></span><span class="ls0">ointer <span class="_ _e"> </span>that <span class="_ _e"> </span>we <span class="_ _e"> </span>can <span class="_"> </span>pass <span class="_ _53"> </span>to <span class="_ _e"> </span>other</span></span></div><div class="t m0 x32 h2a y28e0 ff19 fsf fc0 sc0 ls0 ws0">semaphor<span class="ls129e">ef<span class="_ _b"></span><span class="ls0">unctions <span class="_ _3"></span>when <span class="_ _9"></span>we <span class="_ _9"></span>want <span class="_ _9"></span>to <span class="_ _23"></span>operate <span class="_ _3"></span>on <span class="_ _9"></span>the <span class="_ _9"></span>semaphore. <span class="_ _45"> </span>When<span class="_ _45"> </span>we <span class="_ _9"></span>ar<span class="ls24a">ed<span class="_ _b"></span><span class="ls0">one</span></span></span></span></div><div class="t m0 x32 h26 y28e1 ff19 fsf fc0 sc0 ls0 ws0">with <span class="_"> </span>the <span class="_"> </span>semaphor<span class="_ _0"></span>e, <span class="_"> </span>we <span class="_"> </span>can <span class="_ _e"> </span>call <span class="_"> </span>the<span class="_ _59"> </span><span class="ff1a">sem_close<span class="_ _46"> </span></span>function <span class="_"> </span>to <span class="_"> </span>release <span class="_ _e"> </span>any <span class="_"> </span>resour<span class="_ _0"></span>ces</div><div class="t m0 x32 h2a y28e2 ff19 fsf fc0 sc0 ls0 ws0">associated with the semaphore.</div><div class="t m0 x3f h57 y45f9 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;semaphore.h&gt;</div><div class="t m0 x3f h57 y45fa ff1a fs2d fc0 sc0 ls0 ws0">int sem_close(sem_t *<span class="ff1b">sem</span>);</div><div class="t m0 x153 h5f y45fb ff19 fs2d fc0 sc0 ls0 ws0">Returns: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x3f h4d y45fc ff19 fs26 fc0 sc0 ls0 ws0">If our process exits without having <span class="_ _2"></span>ﬁrst called<span class="_"> </span><span class="ff1a">sem_close</span><span class="ls129f">,t<span class="_ _d"></span><span class="ls0">he <span class="_ _2"></span>kernel will close <span class="_ _2"></span>any</span></span></div><div class="t m0 x32 h49 y45fd ff19 fs26 fc0 sc0 ls0 ws0">open semaphores <span class="_ _2"></span>automatically<span class="_ _4"></span><span class="ls12a0">.N<span class="_ _4a"></span><span class="ls0">ote that <span class="_ _2"></span>this <span class="_ _2"></span>doesn’t <span class="_ _2"></span>affect the <span class="_ _2"></span>state <span class="_ _2"></span>of <span class="_ _2"></span>the <span class="_ _2"></span>semaphore</span></span></div><div class="t m0 x32 h49 y45fe ff19 fs26 fc0 sc0 ls0 ws0">value <span class="_ _a"></span>— <span class="_ _a"></span>if<span class="_ _46"> </span>we <span class="_"> </span>have <span class="_ _e"> </span>incremented <span class="_"> </span>its <span class="_ _e"> </span>value, <span class="_"> </span>this <span class="_ _e"> </span>doesn’t <span class="_"> </span>change <span class="_"> </span>just <span class="_ _e"> </span>because <span class="_"> </span>we <span class="_"> </span>exit.</div><div class="t m0 x32 h4d y45ff ff19 fs26 fc0 sc0 ls0 ws0">Similarly<span class="_ _4"></span>,<span class="_ _16"> </span>if<span class="_ _5a"> </span>we<span class="_ _16"> </span>call<span class="_ _16"> </span><span class="ff1a">sem_close</span><span class="ls12a1">,t<span class="_ _1d"></span><span class="ls0">he <span class="_ _47"> </span>semaphor<span class="ls12a1">ev<span class="_ _62"></span><span class="ls0">alue <span class="_ _45"> </span>is <span class="_ _47"> </span>unaffected. <span class="_ _16"> </span>There<span class="_ _61"> </span>is<span class="_ _5a"> </span>no</span></span></span></span></div><div class="t m0 x32 h4d y4600 ff19 fs26 fc0 sc0 ls0 ws0">mechanism equivalent to the<span class="_"> </span><span class="ff1a">SEM_UNDO<span class="_ _80"> </span></span>ﬂag found with XSI semaphores.</div><div class="t m0 x3f h4d y4601 ff19 fs26 fc0 sc0 ls164 ws0">To <span class="_ _53"> </span>d<span class="_ _9"></span><span class="ls0">estroy a named semaphore, we can use the<span class="_"> </span><span class="ff1a">sem_unlink<span class="_ _e"> </span></span>function.</span></div><div class="t m0 x3f h4e y4602 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;semaphore.h&gt;</div><div class="t m0 x3f h4e y4603 ff1a fs28 fc0 sc0 ls0 ws0">int sem_unlink(const char *<span class="ff1b">name</span>);</div><div class="t m0 x153 h7c y4604 ff19 fs28 fc0 sc0 ls0 ws0">Returns: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
