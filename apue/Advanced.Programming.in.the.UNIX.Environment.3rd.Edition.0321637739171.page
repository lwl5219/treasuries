<div id="pfab" class="pf w4 h1f" data-page-no="ab"><div class="pc pcab w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bgab.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>4.24<span class="_ _9a"> </span>Device <span class="_"> </span>Special <span class="_"> </span>Files<span class="_ _1b"> </span><span class="ff18">137</span></div><div class="t m0 x32 h57 y362 ff1a fs2d fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h57 y363 ff1a fs2d fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h57 y13a0 ff1a fs2d fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 x32 h57 y846 ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y847 ff1a fs2d fc0 sc0 ls0 ws0">char <span class="_ _68"> </span>*ptr;</div><div class="t m0 x8a h57 y13a1 ff1a fs2d fc0 sc0 ls0 ws0">size_t <span class="_ _8a"> </span>size;</div><div class="t m0 x8a h57 y368 ff1a fs2d fc0 sc0 ls0 ws0">if (chdir(&quot;/usr/spool/uucppublic&quot;) &lt; 0)</div><div class="t m0 x9d h57 y848 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;chdir failed&quot;);</div><div class="t m0 x8a h57 y36a ff1a fs2d fc0 sc0 ls0 ws0">ptr = path_alloc(&amp;size);<span class="_ _15"> </span>/* our own function */</div><div class="t m0 x8a h57 y36b ff1a fs2d fc0 sc0 ls0 ws0">if (getcwd(ptr, size) == NULL)</div><div class="t m0 x9d h57 y84b ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;getcwd failed&quot;);</div><div class="t m0 x8a h57 y36d ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;cwd = %s\n&quot;, ptr);</div><div class="t m0 x8a h57 y13a2 ff1a fs2d fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h57 y13a3 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 xa5 h5e y13a4 ff18 fs10 fc0 sc0 ls0 ws0">Figure 4.24<span class="_ _5a"> </span><span class="ff19">Example of<span class="_"> </span><span class="ff1a">getcwd<span class="_ _e"> </span></span>function</span></div><div class="t m0 x32 h4d y13a5 ff19 fs26 fc0 sc0 ls0 ws0">Note <span class="_ _9"></span>that<span class="_ _45"> </span><span class="ff1a">chdir<span class="_ _45"> </span></span>follows <span class="_ _3"></span>the <span class="_ _9"></span>symbolic <span class="_ _9"></span>link<span class="_ _9"></span><span class="ls161">—a<span class="_ _1"></span><span class="ls0">s<span class="_ _45"> </span>we<span class="_ _45"> </span>expect <span class="_ _3"></span>it <span class="_ _9"></span>to, <span class="_ _9"></span>from <span class="_ _9"></span>Figur<span class="ls5ea">e4<span class="_ _b"></span><span class="ls0">.17 <span class="_ _84"></span>— <span class="_ _4"></span>but</span></span></span></span></div><div class="t m0 x32 h4d y13a6 ff19 fs26 fc0 sc0 ls0 ws0">when <span class="_ _9"></span>it <span class="_ _9"></span>goes <span class="_ _23"></span>up <span class="_ _9"></span>the <span class="_ _9"></span>directory <span class="_ _9"></span>tree,<span class="_ _45"> </span><span class="ff1a">getcwd<span class="_ _45"> </span></span>has <span class="_ _9"></span>no <span class="_ _9"></span>idea <span class="_ _23"></span>when <span class="_ _9"></span>it <span class="_ _9"></span>hits <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">/var/spool</span></div><div class="t m0 x32 h4d y13a7 ff19 fs26 fc0 sc0 ls0 ws0">directory that <span class="_ _2"></span>it <span class="_ _2"></span>is <span class="_ _3"></span>pointed <span class="_ _2"></span>to <span class="_ _2"></span>by <span class="_ _2"></span>the <span class="_ _2"></span>symbolic <span class="_ _2"></span>link<span class="_ _47"> </span><span class="ff1a">/usr/spool</span><span class="ls5eb">.T<span class="_ _5b"></span><span class="ls0">his <span class="_ _2"></span>is <span class="_ _2"></span>a <span class="_ _2"></span>characteristic</span></span></div><div class="t m0 x32 h49 y13a8 ff19 fs26 fc0 sc0 ls0 ws0">of symbolic links.</div><div class="t m0 x3f h54 y13a9 ff19 fs2c fc0 sc0 ls0 ws0">The<span class="_ _66"> </span><span class="ff1a">getcwd<span class="_ _47"> </span></span>function <span class="_ _2"></span>is <span class="_ _2"></span>useful <span class="_ _3"></span>when <span class="_ _2"></span>we <span class="_ _2"></span>have <span class="_ _3"></span>an <span class="_ _2"></span>application <span class="_ _2"></span>that <span class="_ _3"></span>needs <span class="_ _2"></span>to <span class="_ _2"></span>return <span class="_ _2"></span>to</div><div class="t m0 x32 h55 y13aa ff19 fs2c fc0 sc0 ls0 ws0">the <span class="_ _2"></span>location <span class="_ _3"></span>in <span class="_ _2"></span>the <span class="_ _3"></span>ﬁle <span class="_ _2"></span>system <span class="_ _3"></span>where<span class="_ _66"> </span>it<span class="_ _47"> </span>started <span class="_ _2"></span>out.<span class="_ _16"> </span><span class="ls155">We <span class="_ _80"> </span>c<span class="_ _9"></span></span>an <span class="_ _2"></span>save <span class="_ _3"></span>the <span class="_ _2"></span>starting <span class="_ _3"></span>location <span class="_ _2"></span>by</div><div class="t m0 x32 h54 y13ab ff19 fs2c fc0 sc0 ls0 ws0">calling<span class="_ _16"> </span><span class="ff1a">getcwd<span class="_"> </span></span>befor<span class="_ _0"></span>e<span class="_ _16"> </span>we<span class="_ _5a"> </span>change <span class="_ _47"> </span>our <span class="_ _45"> </span>working <span class="_ _47"> </span>directory<span class="_ _4"></span><span class="ls5ec">.A<span class="_ _56"></span><span class="ls0">fter <span class="_ _45"> </span>we <span class="_ _45"> </span>complete <span class="_ _47"> </span>our</span></span></div><div class="t m0 x32 h54 y13ac ff19 fs2c fc0 sc0 ls0 ws0">processing, we <span class="_ _2"></span>can <span class="_ _2"></span>pass <span class="_ _2"></span>the <span class="_ _2"></span>pathname <span class="_ _2"></span>obtained from<span class="_ _66"> </span><span class="ff1a">getcwd<span class="_ _47"> </span></span>to<span class="_"> </span><span class="ff1a">chdir<span class="_ _47"> </span></span>to return to <span class="_ _2"></span>our</div><div class="t m0 x32 h55 y13ad ff19 fs2c fc0 sc0 ls0 ws0">starting location in the ﬁle system.</div><div class="t m0 x3f h54 y13ae ff19 fs2c fc0 sc0 ls0 ws0">The<span class="_"> </span><span class="ff1a">fchdir<span class="_ _80"> </span></span>function provides us with an easy way to accomplish this task.<span class="_ _46"> </span>Instead</div><div class="t m0 x32 h54 y13af ff19 fs2c fc0 sc0 ls0 ws0">of calling<span class="_ _66"> </span><span class="ff1a">getcwd</span>,<span class="_ _66"> </span>we<span class="_ _47"> </span>can<span class="_"> </span><span class="ff1a">open<span class="_ _66"> </span></span>the <span class="_ _2"></span>current directory and <span class="_ _2"></span>save the <span class="_ _2"></span>ﬁle <span class="_ _2"></span>descriptor before</div><div class="t m0 x32 h55 y13b0 ff19 fs2c fc0 sc0 ls0 ws0">we <span class="_ _3"></span>change <span class="_ _9"></span>to <span class="_ _9"></span>a <span class="_ _3"></span>different <span class="_ _3"></span>location <span class="_ _3"></span>in <span class="_ _9"></span>the <span class="_ _9"></span>ﬁle <span class="_ _3"></span>system.<span class="_ _5a"> </span>When <span class="_ _9"></span>we <span class="_ _3"></span>want <span class="_ _9"></span>to <span class="_ _9"></span>return <span class="_ _3"></span>to <span class="_ _3"></span>where</div><div class="t m0 x32 h54 y13b1 ff19 fs2c fc0 sc0 ls0 ws0">we started, we can simply pass the ﬁle descriptor to<span class="_"> </span><span class="ff1a">fchdir</span>.</div><div class="t m0 x35 h99 y13b2 ff16 fs3b fc0 sc0 ls0 ws0">4.24 <span class="_ _93"> </span>Device <span class="_"> </span>Special <span class="_"> </span>Files</div><div class="t m0 x32 h54 y13b3 ff19 fs2c fc0 sc0 ls0 ws0">The <span class="_ _2"></span>two <span class="_ _3"></span>ﬁelds<span class="_ _47"> </span><span class="ff1a">st_dev<span class="_ _47"> </span></span>and<span class="_ _66"> </span><span class="ff1a">st_rdev<span class="_ _47"> </span></span>ar<span class="ls5ed">eo<span class="_ _8"></span><span class="ls0">ften <span class="_ _3"></span>confused.<span class="_ _61"> </span><span class="ls155">We<span class="_ _23"></span></span>’ll <span class="_ _2"></span>need <span class="_ _3"></span>to <span class="_ _2"></span>use <span class="_ _3"></span>these <span class="_ _2"></span>ﬁelds</span></span></div><div class="t m0 x32 h54 y13b4 ff19 fs2c fc0 sc0 ls0 ws0">in Section <span class="_ _2"></span>18.9 when <span class="_ _2"></span>we <span class="_ _2"></span>write the<span class="_ _66"> </span><span class="ff1a">ttyname<span class="_ _66"> </span></span>function. <span class="_ _66"> </span>The<span class="_ _66"> </span><span class="ls5ee">ru<span class="_ _2"></span></span>les for <span class="_ _2"></span>their use <span class="_ _2"></span>ar<span class="ls5ef">es<span class="_ _4f"></span><span class="ls0">imple.</span></span></div><div class="t m0 x3f h55 y13b5 ff19 fs2c fc0 sc0 ls237 ws0">•E<span class="_ _4d"></span><span class="ls0">very <span class="_ _9"></span>ﬁle <span class="_ _23"></span>system <span class="_ _23"></span>is <span class="_ _9"></span>known <span class="_ _23"></span>by <span class="_ _9"></span>its <span class="_ _23"></span>major <span class="_ _9"></span>and <span class="_ _23"></span>minor <span class="_ _9"></span>device <span class="_ _23"> </span>numbers, <span class="_ _23"></span>which <span class="_ _9"></span>are</span></div><div class="t m0 x15 h54 y13b6 ff19 fs2c fc0 sc0 ls0 ws0">encoded <span class="_ _2"></span>in <span class="_ _3"></span>the <span class="_ _3"></span>primitive <span class="_ _3"></span>system <span class="_ _2"></span>data <span class="_ _3"></span>type<span class="_ _47"> </span><span class="ff1a">dev_t</span><span class="ls5f0">.T<span class="_ _5b"></span><span class="ls0">he <span class="_ _2"></span>major <span class="_ _3"></span>number <span class="_ _3"></span>identiﬁes</span></span></div><div class="t m0 x15 h55 y13b7 ff19 fs2c fc0 sc0 ls0 ws0">the <span class="_ _51"> </span>device <span class="_ _51"> </span>driver <span class="_ _51"> </span>and <span class="_ _51"> </span>sometimes <span class="_ _51"> </span>encodes <span class="_ _51"> </span>which <span class="_ _54"> </span>peripheral <span class="_ _51"> </span>boar<span class="ls5f1">dt<span class="_ _4d"></span><span class="ls0">o</span></span></div><div class="t m0 x15 h55 y13b8 ff19 fs2c fc0 sc0 ls0 ws0">communicate <span class="_ _23"> </span>with; <span class="_ _42"> </span>the <span class="_ _23"> </span>minor <span class="_ _42"> </span>number <span class="_ _23"> </span>identiﬁes <span class="_ _42"> </span>the <span class="_ _23"> </span>speciﬁc <span class="_ _42"> </span>subdevice.<span class="_ _51"> </span>Recall</div><div class="t m0 x15 h55 y13b9 ff19 fs2c fc0 sc0 ls0 ws0">from <span class="_ _9"></span>Figur<span class="ls5f2">e4<span class="_ _43"></span><span class="ls0">.13 <span class="_ _23"></span>that <span class="_ _9"></span>a <span class="_ _23"></span>disk <span class="_ _9"></span>drive <span class="_ _9"></span>often <span class="_ _23"></span>contains <span class="_ _9"></span>several <span class="_ _9"></span>ﬁle <span class="_ _23"></span>systems.<span class="_ _5a"> </span>Each <span class="_ _9"></span>ﬁle</span></span></div><div class="t m0 x15 h55 y13ba ff19 fs2c fc0 sc0 ls0 ws0">system <span class="_ _3"></span>on <span class="_ _2"></span>the <span class="_ _3"></span>same <span class="_ _3"></span>disk <span class="_ _3"></span>drive <span class="_ _3"></span>would <span class="_ _3"></span>usually <span class="_ _3"></span>have <span class="_ _3"></span>the <span class="_ _3"></span>same <span class="_ _3"></span>major <span class="_ _3"></span>number<span class="_ _1"></span><span class="ls5f3">,b<span class="_ _8"></span><span class="ls0">ut</span></span></div><div class="t m0 x15 h55 y13bb ff19 fs2c fc0 sc0 ls142 ws0">ad<span class="_ _d"></span><span class="ls0">ifferent minor number<span class="_ _6"></span>.</span></div><a class="l" href="#pfd" data-dest-detail='[13,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.891576px;bottom:387.044699px;width:157.224205px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
