<div id="pf12c" class="pf w4 h1f" data-page-no="12c"><div class="pc pc12c w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg12c.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">266<span class="_ _1b"> </span><span class="ff19">Process <span class="_"> </span>Contr<span class="_ _0"></span>ol <span class="_ _222"> </span>Chapter<span class="_ _4b"> </span>8</span></div><div class="t m0 x32 h57 y362 ff1a fs2d fc0 sc0 ls0 ws0">#include <span class="_ _68"> </span>&lt;sys/wait.h&gt;</div><div class="t m0 x32 h57 y3c0 ff1a fs2d fc0 sc0 ls0 ws0">#include <span class="_ _68"> </span>&lt;errno.h&gt;</div><div class="t m0 x32 h57 y845 ff1a fs2d fc0 sc0 ls0 ws0">#include <span class="_ _68"> </span>&lt;unistd.h&gt;</div><div class="t m0 x32 h57 y3c2 ff1a fs2d fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h57 y3c3 ff1a fs2d fc0 sc0 ls0 ws0">system(const char *cmdstring)<span class="_ _68"> </span>/* version without signal handling */</div><div class="t m0 x32 h57 y3c4 ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y3c5 ff1a fs2d fc0 sc0 ls0 ws0">pid_t <span class="_ _d9"> </span>pid;</div><div class="t m0 x8a h57 y3c6 ff1a fs2d fc0 sc0 ls0 ws0">int <span class="_ _15"> </span>status;</div><div class="t m0 x8a h57 y3c7 ff1a fs2d fc0 sc0 ls0 ws0">if (cmdstring == NULL)</div><div class="t m0 x9d h57 y3c8 ff1a fs2d fc0 sc0 ls0 ws0">return(1); <span class="_ _8a"> </span>/*<span class="_"> </span>always a command processor with UNIX */</div><div class="t m0 x8a h57 y1d37 ff1a fs2d fc0 sc0 ls0 ws0">if ((pid = fork()) &lt; 0) {</div><div class="t m0 x9d h57 y1d38 ff1a fs2d fc0 sc0 ls0 ws0">status = -1;<span class="_ _15"> </span>/* probably out of processes */</div><div class="t m0 x8a h57 y3cb ff1a fs2d fc0 sc0 ls15c ws0">}e<span class="_ _1d"></span><span class="ls0">lse if (pid == 0) {<span class="_ _b9"> </span>/* child */</span></div><div class="t m0 x9d h57 y3cc ff1a fs2d fc0 sc0 ls0 ws0">execl(&quot;/bin/sh&quot;, &quot;sh&quot;, &quot;-c&quot;, cmdstring, (char *)0);</div><div class="t m0 x9d h57 y3cd ff1a fs2d fc0 sc0 ls0 ws0">_exit(127); <span class="_ _15"> </span>/*<span class="_"> </span>execl error */</div><div class="t m0 x8a h57 y3ce ff1a fs2d fc0 sc0 ls15c ws0">}e<span class="_ _1d"></span><span class="ls0">lse {<span class="_ _1aa"> </span>/* parent */</span></div><div class="t m0 x9d h57 y3cf ff1a fs2d fc0 sc0 ls0 ws0">while (waitpid(pid, &amp;status, 0) &lt; 0) {</div><div class="t m0 x1f h57 y3d0 ff1a fs2d fc0 sc0 ls0 ws0">if (errno != EINTR) {</div><div class="t m0 x1ca h57 y3d1 ff1a fs2d fc0 sc0 ls0 ws0">status = -1; /* error other than EINTR from waitpid() */</div><div class="t m0 x1ca h57 y1cca ff1a fs2d fc0 sc0 ls0 ws0">break;</div><div class="t m0 x1f h57 y1ccb ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x9d h57 y2315 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y2316 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y3d6 ff1a fs2d fc0 sc0 ls0 ws0">return(status);</div><div class="t m0 x32 h57 y3d7 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x185 h5e y2317 ff18 fs10 fc0 sc0 ls0 ws0">Figure 8.22<span class="_ _5a"> </span><span class="ff19">The<span class="_"> </span><span class="ff1a">system<span class="_ _e"> </span></span>function, without signal handling</span></div><div class="t m0 x3f h4d y2318 ff19 fs26 fc0 sc0 ls164 ws0">We <span class="_ _47"> </span>c<span class="_ _9"></span><span class="ls0">an <span class="_ _23"></span>test <span class="_ _23"></span>this <span class="_ _23"></span>version <span class="_ _23"></span>of<span class="_ _45"> </span><span class="ff1a">system<span class="_ _35"> </span></span>with <span class="_ _23"></span>the <span class="_ _23"></span>pr<span class="_ _0"></span>ogram <span class="_ _23"></span>shown <span class="_ _23"></span>in <span class="_ _9"></span>Figur<span class="lsa53">e8<span class="_ _b"></span><span class="ls0">.23. <span class="_ _45"> </span>(The</span></span></span></div><div class="t m0 x32 h4d y2319 ff1a fs26 fc0 sc0 ls0 ws0">pr_exit<span class="_ _4b"> </span><span class="ff19">function <span class="_"> </span>was <span class="_ _53"> </span>deÔ¨Åned <span class="_"> </span>in <span class="_ _53"> </span>Figur<span class="ls6e6">e8<span class="_ _4a"></span><span class="ls0">.5.) <span class="_ _59"> </span>Running<span class="_ _4b"> </span>the <span class="_"> </span>pr<span class="_ _0"></span>ogram <span class="_ _e"> </span>in <span class="_ _e"> </span>Figur<span class="ls6e6">e8<span class="_ _55"></span><span class="ls0">.23</span></span></span></span></span></div><div class="t m0 x32 h49 y231a ff19 fs26 fc0 sc0 ls0 ws0">gives us</div><div class="t m0 x3f h4e y231b ff1a fs28 fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">./a.out</span></div><div class="t m0 x3f h4e y231c ff1a fs28 fc0 sc0 ls0 ws0">Sat Feb 25 19:36:59 EST 2012</div><div class="t m0 x3f h4e y231d ff1a fs28 fc0 sc0 ls0 ws0">normal termination, exit status = 0<span class="_ _8a"> </span><span class="ff1b">for<span class="_ _61"> </span></span>date</div><div class="t m0 x3f h4e y231e ff1a fs28 fc0 sc0 ls0 ws0">sh: nosuchcommand: command not found</div><div class="t m0 x3f h4e y231f ff1a fs28 fc0 sc0 ls0 ws0">normal termination, exit status = 127<span class="_ _68"> </span><span class="ff1b">for<span class="_ _16"> </span></span>nosuchcommand</div><div class="t m0 x3f h4e y2320 ff1a fs28 fc0 sc0 ls0 ws0">sar <span class="_ _8a"> </span>console<span class="_ _d9"> </span>Jan <span class="_"> </span>1<span class="_"> </span>14:59</div><div class="t m0 x3f h4e y2321 ff1a fs28 fc0 sc0 ls0 ws0">sar <span class="_ _8a"> </span>ttys000<span class="_ _d9"> </span>Feb <span class="_"> </span>7<span class="_"> </span>19:08</div><div class="t m0 x3f h4e y2322 ff1a fs28 fc0 sc0 ls0 ws0">sar <span class="_ _8a"> </span>ttys001<span class="_ _d9"> </span>Jan 15 15:28</div><div class="t m0 x3f h4e y2323 ff1a fs28 fc0 sc0 ls0 ws0">sar <span class="_ _8a"> </span>ttys002<span class="_ _d9"> </span>Jan 15 21:50</div><div class="t m0 x3f h4e y2324 ff1a fs28 fc0 sc0 ls0 ws0">sar <span class="_ _8a"> </span>ttys003<span class="_ _d9"> </span>Jan 21 16:02</div><div class="t m0 x3f h4e y2325 ff1a fs28 fc0 sc0 ls0 ws0">normal termination, exit status = 44<span class="_ _15"> </span><span class="ff1b">for<span class="_ _61"> </span></span>exit</div><div class="t m0 x3f h4d y2326 ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _23"></span>advantage <span class="_ _9"></span>in <span class="_ _23"> </span>using<span class="_ _35"> </span><span class="ff1a">system</span><span class="lsa54">,i<span class="_ _b"></span><span class="ls0">nstead <span class="_ _9"></span>of <span class="_ _23"></span>using<span class="_ _45"> </span><span class="ff1a">fork<span class="_ _35"> </span></span>and<span class="_ _35"> </span><span class="ff1a">exec<span class="_ _45"> </span></span>directly<span class="_ _4"></span>,<span class="_ _35"> </span>is<span class="_ _45"> </span>that</span></span></div><div class="t m0 x32 h4d y2327 ff1a fs26 fc0 sc0 ls0 ws0">system<span class="_ _66"> </span><span class="ff19">does <span class="_ _2"></span>all <span class="_ _2"></span>the <span class="_ _3"></span>requir<span class="_ _1"></span>ed <span class="_ _3"></span>error handling <span class="_ _2"></span>and <span class="_ _2"></span>(in <span class="_ _2"></span>our <span class="_ _3"></span>next <span class="_ _2"></span>version <span class="_ _2"></span>of <span class="_ _2"></span>this <span class="_ _2"></span>function <span class="_ _2"></span>in</span></div><div class="t m0 x32 h49 y2328 ff19 fs26 fc0 sc0 ls0 ws0">Section 10.18) all the requir<span class="_ _0"></span>ed signal handling.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
