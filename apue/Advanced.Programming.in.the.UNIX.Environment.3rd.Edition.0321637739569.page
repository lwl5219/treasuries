<div id="pf239" class="pf w4 h1f" data-page-no="239"><div class="pc pc239 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg239.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>15.2<span class="_ _2b5"> </span>Pipes<span class="_ _1b"> </span><span class="ff18">535</span></div><div class="t m0 x3f h2a y12f ff19 fsf fc0 sc0 ls0 ws0">Despite <span class="_ _3"></span>these <span class="_ _3"></span>limitations, <span class="_ _9"></span>half-duplex <span class="_ _3"></span>pipes <span class="_ _3"></span>ar<span class="ls23c">es<span class="_ _8"></span><span class="ls0">till <span class="_ _3"></span>the <span class="_ _9"></span>most <span class="_ _3"></span>commonly <span class="_ _3"></span>used <span class="_ _9"></span>form</span></span></div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">of <span class="_ _42"> </span>IPC.<span class="_ _65"> </span>Every <span class="_ _53"> </span>time <span class="_ _53"> </span>you <span class="_ _53"> </span>type <span class="_ _53"> </span>a <span class="_ _42"> </span>sequence <span class="_ _53"> </span>of <span class="_ _53"> </span>commands <span class="_ _53"> </span>in <span class="_ _53"> </span>a <span class="_ _53"> </span>pipeline <span class="_ _53"> </span>for <span class="_ _42"> </span>the <span class="_ _53"> </span>shell <span class="_ _53"> </span>to</div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">execute, <span class="_ _9"></span>the <span class="_ _23"></span>shell <span class="_ _9"></span>creates <span class="_ _9"></span>a <span class="_ _23"></span>separate <span class="_ _9"></span>process <span class="_ _9"></span>for <span class="_ _23"></span>each <span class="_ _9"></span>command <span class="_ _23"></span>and <span class="_ _9"></span>links <span class="_ _23"></span>the <span class="_ _9"></span>standard</div><div class="t m0 x32 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">output of one process to the standar<span class="_ _0"></span><span class="ls44">di<span class="_ _d"></span><span class="ls0">nput of the next using a pipe.</span></span></div><div class="t m0 x3f h26 y133 ff19 fsf fc0 sc0 ls44 ws0">Ap<span class="_ _d"></span><span class="ls0">ipe is created by calling the<span class="_"> </span><span class="ff1a">pipe<span class="_ _80"> </span></span>function.</span></div><div class="t m0 x3f h57 y2280 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;unistd.h&gt;</div><div class="t m0 x3f h57 y4111 ff1a fs2d fc0 sc0 ls0 ws0">int pipe(int<span class="_"> </span><span class="ff1b">fd[2]</span>);</div><div class="t m0 x153 h5f y4112 ff19 fs2d fc0 sc0 ls0 ws0">Returns: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h4a y4113 ff19 fs26 fc0 sc0 lsf94 ws0">Tw<span class="_ _9"></span><span class="ls1157">oﬁ<span class="_ _4f"></span><span class="ls0">le <span class="_ _2"></span>descriptors <span class="_ _2"></span>ar<span class="ls1157">er<span class="_ _8"></span><span class="ls0">eturned <span class="_ _2"></span>through the<span class="_ _66"> </span><span class="ff1b">fd<span class="_ _47"> </span></span>argument:<span class="_"> </span><span class="ff1b">fd[0]<span class="_"> </span></span>is <span class="_ _2"></span>open <span class="_ _2"></span>for <span class="_ _2"></span>reading, and</span></span></span></span></div><div class="t m0 x32 h4a y4114 ff1b fs26 fc0 sc0 ls0 ws0">fd[1]<span class="_"> </span><span class="ff19">is open for writing.<span class="_ _59"> </span>The output of<span class="_"> </span></span>fd[1]<span class="_"> </span><span class="ff19">is the input for<span class="_"> </span></span>fd[0]<span class="ff19">.</span></div><div class="t m0 x76 h2d y4115 ff19 fs10 fc0 sc0 ls0 ws0">Originally <span class="_ _2"></span>in <span class="_ _2"></span>4.3BSD <span class="_ _2"></span>and <span class="_ _2"></span>4.4BSD, <span class="_ _2"></span>pipes <span class="_ _2"></span>wer<span class="ls1158">ei<span class="_ _5"></span><span class="ls0">mplemented <span class="_ _2"></span>using <span class="_ _2"></span>UNIX <span class="_ _2"></span>domain <span class="_ _2"></span>sockets.<span class="_ _44"> </span>Even</span></span></div><div class="t m0 x76 h2d y4116 ff19 fs10 fc0 sc0 ls0 ws0">though <span class="_ _2"></span>UNIX <span class="_ _3"></span>domain <span class="_ _3"></span>sockets <span class="_ _3"></span>ar<span class="ls1159">ef<span class="_ _d"></span><span class="ls0">ull <span class="_ _2"></span>duplex <span class="_ _3"></span>by <span class="_ _3"></span>default, <span class="_ _3"></span>these <span class="_ _3"></span>operating <span class="_ _2"></span>systems <span class="_ _3"></span>hobbled <span class="_ _3"></span>the</span></span></div><div class="t m0 x76 h2d y4117 ff19 fs10 fc0 sc0 ls0 ws0">sockets used with pipes so that they operated in half-duplex mode only<span class="_ _6"></span>.</div><div class="t m0 x76 h2d y4118 ff19 fs10 fc0 sc0 ls0 ws0">POSIX.1 <span class="_ _2"></span>allows <span class="_ _2"></span>for <span class="_ _3"></span>implementations <span class="_ _2"></span>to <span class="_ _2"></span>support <span class="_ _3"></span>full-duplex <span class="_ _2"></span>pipes.<span class="_ _4b"> </span>For <span class="_ _2"></span>these <span class="_ _2"></span>implementations,</div><div class="t m0 x76 h77 y4119 ff1b fs10 fc0 sc0 ls0 ws0">fd[0]<span class="_"> </span><span class="ff19">and<span class="_"> </span></span>fd[1]<span class="_"> </span><span class="ff19">ar<span class="ls136">eo<span class="_ _5"></span><span class="ls0">pen for both reading and writing.</span></span></span></div><div class="t m0 x3f h49 y411a ff19 fs26 fc0 sc0 lsf94 ws0">Tw<span class="_ _9"></span><span class="ls115a">ow<span class="_ _b"></span><span class="ls0">ays <span class="_ _9"></span>to <span class="_ _23"></span>pictur<span class="ls115a">eah<span class="_ _43"></span><span class="ls0">alf-duplex <span class="_ _23"></span>pipe <span class="_ _23"></span>ar<span class="ls13b">es<span class="_ _43"></span><span class="ls0">hown <span class="_ _23"></span>in <span class="_ _9"></span>Figur<span class="ls13b">e1<span class="_ _b"></span><span class="ls0">5.2. <span class="_ _45"> </span>The<span class="_ _45"> </span>left <span class="_ _23"> </span>half <span class="_ _23"></span>of</span></span></span></span></span></span></span></span></div><div class="t m0 x32 h49 y411b ff19 fs26 fc0 sc0 ls0 ws0">the <span class="_ _3"></span>ﬁgur<span class="ls115b">es<span class="_ _b"></span><span class="ls0">hows <span class="_ _9"></span>the <span class="_ _3"></span>two <span class="_ _3"></span>ends <span class="_ _3"></span>of <span class="_ _3"></span>the <span class="_ _9"></span>pipe <span class="_ _3"></span>connected <span class="_ _3"></span>in <span class="_ _3"></span>a <span class="_ _3"></span>single <span class="_ _9"></span>process. <span class="_ _66"> </span>The<span class="_ _45"> </span>right <span class="_ _2"></span>half</span></span></div><div class="t m0 x32 h49 y411c ff19 fs26 fc0 sc0 ls0 ws0">of the ﬁgur<span class="lsd3">ee<span class="_ _4f"></span><span class="ls0">mphasizes that the data in the pipe ﬂows through the kernel.</span></span></div><div class="t m0 xcc h2e y411d ff19 fs11 fc0 sc0 ls0 ws0">or</div><div class="t m0 x138 h6d y411e ff1a fs12 fc0 sc0 ls0 ws0">fd[0]<span class="_ _6e"> </span>fd[1]</div><div class="t m0 x11a h30 y411f ff19 fs13 fc0 sc0 ls0 ws0">user process<span class="_ _147"> </span>user pr<span class="_ _0"></span>ocess</div><div class="t m0 x101 h63 y4120 ff1a fs13 fc0 sc0 ls0 ws0">fd[0]<span class="_ _6e"> </span>fd[1]</div><div class="t m0 x133 h31 y4121 ff19 fs14 fc0 sc0 ls0 ws0">kernel</div><div class="t m0 x155 h32 y4122 ff19 fs15 fc0 sc0 ls0 ws0">pipe</div><div class="t m0 x26 h83 y4123 ff18 fs36 fc0 sc0 ls0 ws0">Figure 15.2<span class="_ _5a"> </span><span class="ff19 ls872">Tw<span class="_ _9"></span><span class="lsdc9">ow<span class="_ _84"></span><span class="ls0">ays to view a half-duplex pipe</span></span></span></div><div class="t m0 x3f h73 y4124 ff19 fs38 fc0 sc0 ls0 ws0">The<span class="_ _66"> </span><span class="ff1a">fstat<span class="_ _66"> </span></span>function <span class="_ _2"></span>(Section <span class="_ _2"></span>4.2) <span class="_ _2"></span>returns <span class="_ _2"></span>a <span class="_ _2"></span>ﬁle <span class="_ _2"></span>type <span class="_ _2"></span>of <span class="_ _2"></span>FIFO <span class="_ _2"></span>for <span class="_ _2"></span>the <span class="_ _2"></span>ﬁle <span class="_ _2"></span>descriptor of</div><div class="t m0 x32 h73 y4125 ff19 fs38 fc0 sc0 ls0 ws0">either end of a pipe.<span class="_ _59"> </span><span class="lsdc6">We <span class="_ _e"> </span>c<span class="_ _9"></span></span>an test for a pipe with the<span class="_"> </span><span class="ff1a">S_ISFIFO<span class="_ _80"> </span></span>macro.</div><div class="t m0 x76 h71 y4126 ff19 fs36 fc0 sc0 ls0 ws0">POSIX.1 <span class="_ _9"></span>states <span class="_ _23"> </span>that <span class="_ _9"></span>the<span class="_ _47"> </span><span class="ff1a">st_size<span class="_ _47"> </span></span>member <span class="_ _23"> </span>of <span class="_ _9"></span>the<span class="_ _47"> </span><span class="ff1a">stat<span class="_ _47"> </span></span>structur<span class="ls115c">ei<span class="_ _8"></span><span class="ls115d">su<span class="_ _8"></span><span class="ls0">ndeﬁned <span class="_ _23"> </span>for <span class="_ _9"></span>pipes.<span class="_ _46"> </span>But</span></span></span></div><div class="t m0 x76 h71 y4127 ff19 fs36 fc0 sc0 ls0 ws0">when <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">fstat<span class="_ _66"> </span></span>function <span class="_ _9"></span>is <span class="_ _9"></span>applied <span class="_ _3"></span>to <span class="_ _9"></span>the <span class="_ _9"></span>ﬁle <span class="_ _9"></span>descriptor <span class="_ _9"></span>for <span class="_ _3"></span>the <span class="_ _9"></span>read <span class="_ _3"></span>end <span class="_ _9"></span>of <span class="_ _9"></span>the <span class="_ _9"></span>pipe, <span class="_ _9"></span>many</div><div class="t m0 x76 h71 y4128 ff19 fs36 fc0 sc0 ls0 ws0">systems <span class="_ _42"> </span>stor<span class="ls115e">ei<span class="_ _43"></span><span class="ls0">n<span class="_ _35"> </span><span class="ff1a">st_size<span class="_ _35"> </span></span>the <span class="_ _42"> </span>number <span class="_"> </span>of <span class="_ _42"> </span>bytes <span class="_ _42"> </span>available <span class="_"> </span>for <span class="_ _42"> </span>reading <span class="_ _42"> </span>in <span class="_ _42"> </span>the <span class="_"> </span>pipe.<span class="_ _61"> </span>This <span class="_"> </span>is,</span></span></div><div class="t m0 x76 h83 y4129 ff19 fs36 fc0 sc0 ls0 ws0">however<span class="_ _1"></span><span class="lsdc9">,n<span class="_ _84"></span><span class="ls0">onportable.</span></span></div><div class="t m0 x3f h73 y412a ff19 fs38 fc0 sc0 ls115f ws0">Ap<span class="_ _b"></span><span class="ls0">ipe <span class="_ _9"></span>in <span class="_ _9"></span>a <span class="_ _3"></span>single <span class="_ _9"></span>process <span class="_ _3"></span>is <span class="_ _9"></span>next <span class="_ _3"></span>to <span class="_ _9"></span>useless.<span class="_ _16"> </span>Normally<span class="_ _6"></span><span class="ls1160">,t<span class="_ _b"></span><span class="ls0">he <span class="_ _9"></span>process <span class="_ _3"></span>that <span class="_ _9"></span>calls<span class="_ _45"> </span><span class="ff1a">pipe</span></span></span></span></div><div class="t m0 x32 h73 y412b ff19 fs38 fc0 sc0 ls0 ws0">then <span class="_ _42"> </span>calls<span class="_ _44"> </span><span class="ff1a">fork</span><span class="ls1161">,c<span class="_ _43"></span><span class="ls875">re<span class="ls0">ating <span class="_ _42"> </span>an <span class="_ _53"> </span>IPC <span class="_ _42"> </span>channel <span class="_ _42"> </span>from <span class="_ _42"> </span>the <span class="_ _53"> </span>parent <span class="_ _42"> </span>to <span class="_ _42"> </span>the <span class="_ _42"> </span>child, <span class="_ _53"> </span>or <span class="_ _42"> </span>vice <span class="_ _42"> </span>versa.</span></span></span></div><div class="t m0 x32 h74 y412c ff19 fs38 fc0 sc0 ls0 ws0">Figur<span class="lsdcb">e1<span class="_ _4f"></span><span class="ls0">5.3 shows this scenario.</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
