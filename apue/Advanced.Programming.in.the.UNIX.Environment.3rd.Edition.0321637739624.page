<div id="pf270" class="pf w4 h1f" data-page-no="270"><div class="pc pc270 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg270.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">590<span class="_ _1b"> </span><span class="ff19">Network <span class="_"> </span>IPC: <span class="_"> </span>Sockets<span class="_ _2c6"> </span>Chapter <span class="_"> </span>16</span></div><div class="t m0 x35 h53 y12f ff16 fs2b fc0 sc0 ls0 ws0">16.2 <span class="_ _93"> </span>Socket <span class="_"> </span>Descriptor<span class="_ _1"></span>s</div><div class="t m0 x32 h2a y681 ff19 fsf fc0 sc0 ls12ed ws0">As<span class="_ _43"></span><span class="ls0">ocket <span class="_ _23"> </span>is <span class="_ _42"> </span>an <span class="_ _42"> </span>abstraction <span class="_ _42"> </span>of <span class="_ _42"> </span>a <span class="_ _42"> </span>communication <span class="_ _42"> </span>endpoint.<span class="_ _54"> </span>Just <span class="_ _42"> </span>as <span class="_ _42"> </span>they <span class="_ _42"> </span>would <span class="_ _42"> </span>use <span class="_ _23"> </span>ﬁle</span></div><div class="t m0 x32 h2a y683 ff19 fsf fc0 sc0 ls0 ws0">descriptors <span class="_ _9"></span>to <span class="_ _9"></span>access <span class="_ _9"></span>ﬁles, <span class="_ _3"></span>applications <span class="_ _9"></span>use <span class="_ _9"></span>socket <span class="_ _9"></span>descriptors <span class="_ _9"></span>to <span class="_ _9"></span>access <span class="_ _9"></span>sockets.<span class="_ _5a"> </span>Socket</div><div class="t m0 x32 h2a y685 ff19 fsf fc0 sc0 ls0 ws0">descriptors <span class="_ _9"></span>ar<span class="ls12ee">ei<span class="_ _b"></span><span class="ls0">mplemented <span class="_ _9"></span>as <span class="_ _23"></span>ﬁle <span class="_ _9"></span>descriptors <span class="_ _23"></span>in <span class="_ _9"></span>the <span class="_ _23"></span>UNIX <span class="_ _9"></span>System.<span class="_ _51"> </span>Indeed, <span class="_ _9"></span>many <span class="_ _23"></span>of</span></span></div><div class="t m0 x32 h26 y686 ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _2"></span>functions <span class="_ _3"></span>that <span class="_ _2"></span>deal <span class="_ _3"></span>with <span class="_ _3"></span>ﬁle <span class="_ _2"></span>descriptors, <span class="_ _3"></span>such <span class="_ _2"></span>as<span class="_ _47"> </span><span class="ff1a">read<span class="_ _47"> </span></span>and<span class="_ _47"> </span><span class="ff1a">write</span><span class="ls12ef">,w<span class="_ _8"></span><span class="ls0">ill <span class="_ _3"></span>work <span class="_ _2"></span>with <span class="_ _3"></span>a</span></span></div><div class="t m0 x32 h2a y687 ff19 fsf fc0 sc0 ls0 ws0">socket descriptor<span class="_ _6"></span>.</div><div class="t m0 x3f h26 y689 ff19 fsf fc0 sc0 ls5f ws0">To <span class="_ _53"> </span>c<span class="_ _9"></span><span class="ls45">re<span class="_ _2"></span><span class="ls0">ate a socket, we call the<span class="_"> </span><span class="ff1a">socket<span class="_ _80"> </span></span>function.</span></span></div><div class="t m0 x3f h57 y381f ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;sys/socket.h&gt;</div><div class="t m0 x3f h57 y46c6 ff1a fs2d fc0 sc0 ls0 ws0">int socket(int<span class="_"> </span><span class="ff1b">domain</span><span class="ls15c">,i<span class="_ _1d"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">type</span><span class="ls15c">,i<span class="_ _5b"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">protocol</span>);</span></span></span></span></div><div class="t m0 xdd h5f y46c7 ff19 fs2d fc0 sc0 ls0 ws0">Returns: ﬁle (socket) descriptor if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h4a y3e82 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _16"> </span><span class="ff1b">domain<span class="_ _5a"> </span></span>argument <span class="_ _47"> </span>determines <span class="_ _45"> </span>the <span class="_ _47"> </span>nature<span class="_ _16"> </span>of<span class="_ _5a"> </span>the <span class="_ _45"> </span>communication, <span class="_ _47"> </span>including <span class="_ _45"> </span>the</div><div class="t m0 x32 h49 y46c8 ff19 fs26 fc0 sc0 ls0 ws0">address <span class="_ _9"></span>format <span class="_ _23"> </span>(described <span class="_ _42"> </span>in <span class="_ _23"></span>mor<span class="ls126f">ed<span class="_ _43"></span><span class="ls0">etail <span class="_ _23"></span>in <span class="_ _23"></span>the <span class="_ _23"> </span>next <span class="_ _23"> </span>section). <span class="_ _23"> </span>Figur<span class="ls126f">e1<span class="_ _43"></span><span class="ls0">6.1 <span class="_ _23"> </span>summarizes</span></span></span></span></div><div class="t m0 x32 h4d y46c9 ff19 fs26 fc0 sc0 ls0 ws0">the <span class="_ _53"> </span>domains <span class="_"> </span>speciﬁed <span class="_ _53"> </span>by <span class="_ _53"> </span>POSIX.1.<span class="_ _48"> </span>The <span class="_ _e"> </span>constants <span class="_ _e"> </span>start <span class="_ _e"> </span>with<span class="_ _4b"> </span><span class="ff1a">AF_<span class="_ _59"> </span></span>(for<span class="_ _4b"> </span><span class="ff1b">address <span class="_ _53"> </span>family</span>)</div><div class="t m0 x32 h49 y46ca ff19 fs26 fc0 sc0 ls0 ws0">because each domain has its own format for repr<span class="_ _0"></span>esenting an addr<span class="_ _0"></span>ess.</div><div class="t m0 x89 h2e y46cb ff19 fs11 fc0 sc0 ls0 ws0">Domain <span class="_ _18a"> </span>Description</div><div class="t m0 xe9 h6d y46cc ff1a fs12 fc0 sc0 ls0 ws0">AF_INET<span class="_ _15"> </span><span class="ff19">IPv4 Internet domain</span></div><div class="t m0 xe9 h6d y46cd ff1a fs12 fc0 sc0 ls0 ws0">AF_INET6<span class="_ _75"> </span><span class="ff19">IPv6 Internet domain (optional in POSIX.1)</span></div><div class="t m0 xe9 h6d y46ce ff1a fs12 fc0 sc0 ls0 ws0">AF_UNIX<span class="_ _15"> </span><span class="ff19">UNIX domain</span></div><div class="t m0 xe9 h6d y46cf ff1a fs12 fc0 sc0 ls0 ws0">AF_UNSPEC<span class="_ _6e"> </span><span class="ff19">unspeciﬁed</span></div><div class="t m0 x27 h30 y46d0 ff18 fs13 fc0 sc0 ls0 ws0">Figure 16.1<span class="_ _5a"> </span><span class="ff19">Socket communication domains</span></div><div class="t m0 x3f h64 y46d1 ff19 fs31 fc0 sc0 ls43f ws0">We <span class="_ _66"> </span>d<span class="_ _9"></span><span class="ls0">iscuss <span class="_ _23"></span>the <span class="_ _9"></span>UNIX <span class="_ _23"></span>domain <span class="_ _9"></span>in <span class="_ _9"></span>Section <span class="_ _23"></span>17.2.<span class="_ _5a"> </span>Most <span class="_ _9"></span>systems <span class="_ _23"></span>deﬁne <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">AF_LOCAL</span></span></div><div class="t m0 x32 h64 y46d2 ff19 fs31 fc0 sc0 ls0 ws0">domain also, which <span class="_ _2"></span>is an <span class="_ _2"></span>alias for<span class="_ _66"> </span><span class="ff1a">AF_UNIX</span><span class="ls12f0">.T<span class="_ _4a"></span><span class="ls0">he<span class="_"> </span><span class="ff1a">AF_UNSPEC<span class="_ _66"> </span></span>domain is <span class="_ _2"></span>a wildcar<span class="ls12f1">dt<span class="_ _d"></span><span class="ls0">hat</span></span></span></span></div><div class="t m0 x32 h6e y46d3 ff19 fs31 fc0 sc0 ls225 ws0">re<span class="ls0">presents <span class="_ _9"></span>‘‘any’<span class="_ _1"></span><span class="ls12f2">’d<span class="_ _b"></span><span class="ls0">omain. <span class="_ _45"> </span>Historically<span class="_ _4"></span><span class="ls12f2">,s<span class="_ _b"></span><span class="ls0">ome <span class="_ _9"></span>platforms <span class="_ _23"></span>provide <span class="_ _3"></span>support <span class="_ _23"></span>for <span class="_ _9"></span>additional</span></span></span></span></span></div><div class="t m0 x32 h64 y46d4 ff19 fs31 fc0 sc0 ls0 ws0">network <span class="_ _47"> </span>protocols, <span class="_ _47"> </span>such <span class="_ _45"> </span>as<span class="_ _16"> </span><span class="ff1a">AF_IPX<span class="_ _16"> </span></span>for <span class="_ _45"> </span>the <span class="_ _47"> </span>NetW<span class="_ _6"></span>ar<span class="ls12f3">ep<span class="_ _62"></span><span class="ls225">ro<span class="ls0">tocol <span class="_ _45"> </span>family<span class="_ _4"></span><span class="ls12f4">,b<span class="_ _1d"></span><span class="ls0">ut <span class="_ _47"> </span>domain</span></span></span></span></span></div><div class="t m0 x32 h6e y46d5 ff19 fs31 fc0 sc0 ls0 ws0">constants for these protocols ar<span class="_ _0"></span><span class="ls229">en<span class="_ _d"></span><span class="ls0">ot deﬁned by the POSIX.1 standard.</span></span></div><div class="t m0 x3f h79 y9bc ff19 fs31 fc0 sc0 ls0 ws0">The<span class="_ _47"> </span><span class="ff1b">type<span class="_ _47"> </span></span>argument <span class="_ _3"></span>determines <span class="_ _3"></span>the <span class="_ _9"></span>type <span class="_ _3"></span>of <span class="_ _3"></span>the <span class="_ _3"></span>socket, <span class="_ _9"></span>which <span class="_ _3"></span>further <span class="_ _3"></span>determines <span class="_ _3"></span>the</div><div class="t m0 x32 h6e y9bd ff19 fs31 fc0 sc0 ls0 ws0">communication characteristics.<span class="_ _46"> </span>The socket types deﬁned by POSIX.1 <span class="_ _2"></span>ar<span class="ls12f5">es<span class="_ _4f"></span><span class="ls0">ummarized in</span></span></div><div class="t m0 x32 h6e y9be ff19 fs31 fc0 sc0 ls0 ws0">Figur<span class="ls229">e1<span class="_ _4f"></span><span class="ls0">6.2, but implementations ar<span class="ls229">ef<span class="_ _d"></span><span class="ls225">re<span class="_ _2"></span><span class="ls0">e<span class="_"> </span>to<span class="_"> </span>add support for additional types.</span></span></span></span></span></div><div class="t m0 x16e h31 y46d6 ff19 fs14 fc0 sc0 ls99b ws0">Ty<span class="_ _3"></span><span class="ls0">pe <span class="_ _22c"> </span>Description</span></div><div class="t m0 x52 h66 y46d7 ff1a fs15 fc0 sc0 ls0 ws0">SOCK_DGRAM<span class="_ _10b"> </span><span class="ff19">ﬁxed</span></div><div class="t m0 x66 h32 y46d8 ff19 fs15 fc0 sc0 ls0 ws0">-</div><div class="t m0 x11b h32 y46d7 ff19 fs15 fc0 sc0 ls0 ws0">length, connectionless, unreliable messages</div><div class="t m0 x52 h66 y46d9 ff1a fs15 fc0 sc0 ls0 ws0">SOCK_RAW<span class="_ _7d"> </span><span class="ff19">datagram interface to IP (optional in POSIX.1)</span></div><div class="t m0 x52 h66 y46da ff1a fs15 fc0 sc0 ls0 ws0">SOCK_SEQPACKET<span class="_ _6e"> </span><span class="ff19">ﬁxed</span></div><div class="t m0 x66 h32 y46db ff19 fs15 fc0 sc0 ls0 ws0">-</div><div class="t m0 x11b h32 y46da ff19 fs15 fc0 sc0 ls0 ws0">length, sequenced, reliable, connection-oriented messages</div><div class="t m0 x52 h66 y46dc ff1a fs15 fc0 sc0 ls0 ws0">SOCK_STREAM<span class="_ _6c"> </span><span class="ff19">sequenced, reliable, bidirectional, connection-oriented byte str<span class="_ _0"></span>eams</span></div><div class="t m0 xf h33 y46dd ff18 fs16 fc0 sc0 ls0 ws0">Figure 16.2<span class="_ _5a"> </span><span class="ff19">Socket types</span></div><div class="t m0 x3f h16a y46de ff19 fs6a fc0 sc0 ls0 ws0">The<span class="_ _35"> </span><span class="ff1b">protocol<span class="_ _35"> </span></span>argument <span class="_ _42"> </span>is <span class="_ _42"> </span>usually <span class="_ _42"> </span>zero, <span class="_ _23"> </span>to <span class="_ _42"> </span>select <span class="_ _42"> </span>the <span class="_ _42"> </span>default <span class="_ _42"> </span>protocol <span class="_ _23"> </span>for <span class="_ _42"> </span>the <span class="_ _42"> </span>given</div><div class="t m0 x32 hc5 y46df ff19 fs6a fc0 sc0 ls0 ws0">domain <span class="_ _3"></span>and <span class="_ _9"></span>socket <span class="_ _3"></span>type.<span class="_ _5a"> </span>When <span class="_ _3"></span>multiple <span class="_ _9"></span>protocols <span class="_ _3"></span>ar<span class="ls12f6">es<span class="_ _b"></span><span class="ls0">upported <span class="_ _9"></span>for <span class="_ _3"></span>the <span class="_ _9"></span>same <span class="_ _3"></span>domain</span></span></div><div class="t m0 x32 h16a y46e0 ff19 fs6a fc0 sc0 ls0 ws0">and <span class="_ _23"></span>socket <span class="_ _9"></span>type, <span class="_ _23"> </span>we <span class="_ _23"></span>can <span class="_ _23"></span>use <span class="_ _9"></span>the<span class="_ _35"> </span><span class="ff1b">protocol<span class="_ _45"> </span></span>argument <span class="_ _9"></span>to <span class="_ _23"></span>select <span class="_ _23"></span>a <span class="_ _9"></span>particular <span class="_ _23"> </span>protocol. <span class="_ _45"> </span>The</div><div class="t m0 x32 hc8 y46e1 ff19 fs6a fc0 sc0 ls0 ws0">default <span class="_ _3"></span>protocol <span class="_ _3"></span>for <span class="_ _9"></span>a<span class="_ _47"> </span><span class="ff1a">SOCK_STREAM<span class="_ _45"> </span></span>socket <span class="_ _3"></span>in <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">AF_INET<span class="_ _47"> </span></span>communication <span class="_ _9"></span>domain <span class="_ _3"></span>is</div><a class="l" href="#pf12" data-dest-detail='[18,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892409px;bottom:1236.288916px;width:148.283806px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
