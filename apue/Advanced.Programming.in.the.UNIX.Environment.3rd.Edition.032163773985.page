<div id="pf55" class="pf w4 h1f" data-page-no="55"><div class="pc pc55 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg55.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>2.5<span class="_ _c2"> </span>Limits<span class="_ _1b"> </span><span class="ff18">51</span></div><div class="t m0 x9d h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">errno = 0;</div><div class="t m0 x9d h57 y426 ff1a fs2d fc0 sc0 ls0 ws0">if ((pathmax = pathconf(&quot;/&quot;, _PC_PATH_MAX)) &lt; 0) {</div><div class="t m0 x1f h57 y800 ff1a fs2d fc0 sc0 ls0 ws0">if (errno == 0)</div><div class="t m0 x126 h57 y801 ff1a fs2d fc0 sc0 ls0 ws0">pathmax = PATH_MAX_GUESS;<span class="_ _68"> </span>/* it’s indeterminate */</div><div class="t m0 x1f h57 y802 ff1a fs2d fc0 sc0 ls0 ws0">else</div><div class="t m0 x126 h57 y803 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;pathconf error for _PC_PATH_MAX&quot;);</div><div class="t m0 x9d h57 y804 ff1a fs2d fc0 sc0 ls15c ws0">}e<span class="_ _1d"></span><span class="ls0">lse {</span></div><div class="t m0 x1f h57 y805 ff1a fs2d fc0 sc0 ls0 ws0">pathmax++; <span class="_ _8a"> </span>/*<span class="_"> </span>add one since it’s relative to root */</div><div class="t m0 x9d h57 y806 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y807 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y8d8 ff1a fs2d fc0 sc0 ls0 ws0">/*</div><div class="t m0 xe1 h57 y8d9 ff1a fs2d fc0 sc0 ls15c ws0">*B<span class="_ _1d"></span><span class="ls0">efore POSIX.1-2001, we aren’t guaranteed that PATH_MAX includes</span></div><div class="t m0 xe1 h57 y8da ff1a fs2d fc0 sc0 ls15c ws0">*t<span class="_ _1d"></span><span class="ls0">he terminating null byte.<span class="_ _3a"> </span>Same goes for XPG3.</span></div><div class="t m0 xe1 h57 y8db ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 x8a h57 y8dc ff1a fs2d fc0 sc0 ls0 ws0">if ((posix_version &lt; 200112L) &amp;&amp; (xsi_version &lt; 4))</div><div class="t m0 x9d h57 y8dd ff1a fs2d fc0 sc0 ls0 ws0">size = pathmax + 1;</div><div class="t m0 x8a h57 y8de ff1a fs2d fc0 sc0 ls0 ws0">else</div><div class="t m0 x9d h57 y8df ff1a fs2d fc0 sc0 ls0 ws0">size = pathmax;</div><div class="t m0 x8a h57 y8e0 ff1a fs2d fc0 sc0 ls0 ws0">if ((ptr = malloc(size)) == NULL)</div><div class="t m0 x9d h57 y8e1 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;malloc error for pathname&quot;);</div><div class="t m0 x8a h57 y8e2 ff1a fs2d fc0 sc0 ls0 ws0">if (sizep != NULL)</div><div class="t m0 x9d h57 y8e3 ff1a fs2d fc0 sc0 ls0 ws0">*sizep = size;</div><div class="t m0 x8a h57 y8e4 ff1a fs2d fc0 sc0 ls0 ws0">return(ptr);</div><div class="t m0 x32 h57 y8e5 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x30 h2d y8e6 ff18 fs10 fc0 sc0 ls0 ws0">Figure 2.16<span class="_ _5a"> </span><span class="ff19">Dynamically allocate space for a pathname</span></div><div class="t m0 x35 h4c y8e7 ff16 fs26 fc0 sc0 ls0 ws0">Maximum Number of Open Files</div><div class="t m0 x32 h49 y8e8 ff19 fs26 fc0 sc0 ls2e3 ws0">Ac<span class="_ _7"></span><span class="ls0">ommon <span class="_ _35"> </span>sequence <span class="_ _35"> </span>of <span class="_ _35"> </span>code <span class="_ _35"> </span>in <span class="_ _35"> </span>a <span class="_ _45"> </span>daemon <span class="_ _35"> </span>process <span class="_ _a"></span>— <span class="_ _a"></span>a<span class="_ _51"> </span>process <span class="_ _35"> </span>that <span class="_ _45"> </span>runs <span class="_ _35"> </span>in <span class="_ _35"> </span>the</span></div><div class="t m0 x32 h49 y8e9 ff19 fs26 fc0 sc0 ls0 ws0">background, <span class="_"> </span>not <span class="_ _47"> </span>connected <span class="_ _47"> </span>to <span class="_ _47"> </span>a <span class="_ _47"> </span>terminal<span class="_ _9"></span><span class="ls161">—i<span class="_ _6"></span><span class="ls2e4">so<span class="_ _1d"></span><span class="ls0">ne <span class="_ _47"> </span>that <span class="_ _47"> </span>closes <span class="_ _47"> </span>all <span class="_ _66"> </span>open <span class="_ _47"> </span>ﬁles.<span class="_ _5f"> </span>Some</span></span></span></div><div class="t m0 x32 h4d y8ea ff19 fs26 fc0 sc0 ls0 ws0">programs <span class="_ _47"> </span>have <span class="_ _45"> </span>the <span class="_ _45"> </span>following <span class="_ _45"> </span>code <span class="_ _47"> </span>sequence, <span class="_ _45"> </span>assuming <span class="_ _45"> </span>the <span class="_ _45"> </span>constant<span class="_ _16"> </span><span class="ff1a">NOFILE<span class="_"> </span></span>was</div><div class="t m0 x32 h4d y8eb ff19 fs26 fc0 sc0 ls0 ws0">deﬁned in the<span class="_"> </span><span class="ff1a">&lt;sys/param.h&gt;<span class="_ _80"> </span></span>header:</div><div class="t m0 x3f h4e y8ec ff1a fs28 fc0 sc0 ls0 ws0">#include <span class="_"> </span>&lt;sys/param.h&gt;</div><div class="t m0 x3f h4e y8ed ff1a fs28 fc0 sc0 ls0 ws0">for (i = 0; i &lt; NOFILE; i++)</div><div class="t m0 xc2 h4e y8ee ff1a fs28 fc0 sc0 ls0 ws0">close(i);</div><div class="t m0 x32 h4d y8ef ff19 fs26 fc0 sc0 ls0 ws0">Other <span class="_ _2"></span>programs <span class="_ _2"></span>use <span class="_ _2"></span>the <span class="_ _3"></span>constant<span class="_ _47"> </span><span class="ff1a">_NFILE<span class="_ _47"> </span></span>that <span class="_ _2"></span>some <span class="_ _2"></span>versions <span class="_ _3"></span>of<span class="_ _47"> </span><span class="ff1a">&lt;stdio.h&gt;<span class="_ _66"> </span></span>provide <span class="_ _2"></span>as</div><div class="t m0 x32 h49 y8f0 ff19 fs26 fc0 sc0 ls0 ws0">the <span class="_ _66"> </span>upper <span class="_ _47"> </span>limit.<span class="_ _50"> </span>Some <span class="_ _47"> </span>har<span class="ls2e5">dc<span class="_ _1d"></span><span class="ls0">ode <span class="_ _47"> </span>the <span class="_ _66"> </span>upper <span class="_ _47"> </span>limit <span class="_ _47"> </span>as <span class="_ _66"> </span>20.<span class="_ _5f"> </span>However<span class="_ _6"></span><span class="ls2e6">,n<span class="_ _5b"></span><span class="ls0">one <span class="_ _47"> </span>of <span class="_ _47"> </span>these</span></span></span></span></div><div class="t m0 x32 h49 y8f1 ff19 fs26 fc0 sc0 ls0 ws0">approaches is portable.</div><div class="t m0 x3f h4d y8f2 ff19 fs26 fc0 sc0 ls164 ws0">We <span class="_ _59"> </span>w<span class="_ _9"></span><span class="ls0">ould <span class="_ _47"> </span>hope <span class="_ _47"> </span>to <span class="_ _47"> </span>use <span class="_ _47"> </span>the <span class="_ _47"> </span>POSIX.1 <span class="_ _47"> </span>value<span class="_ _16"> </span><span class="ff1a">OPEN_MAX<span class="_ _16"> </span></span>to <span class="_ _47"> </span>determine <span class="_ _47"> </span>this <span class="_ _47"> </span>value</span></div><div class="t m0 x32 h49 y8f3 ff19 fs26 fc0 sc0 ls0 ws0">portably<span class="_ _4"></span><span class="ls2e7">,b<span class="_ _43"></span><span class="ls0">ut <span class="_ _42"> </span>if <span class="_ _42"> </span>the <span class="_ _53"> </span>value <span class="_ _42"> </span>is <span class="_ _53"> </span>indeterminate, <span class="_ _42"> </span>we <span class="_ _53"> </span>still <span class="_ _42"> </span>have <span class="_ _53"> </span>a <span class="_ _42"> </span>problem. <span class="_ _44"> </span>If<span class="_ _44"> </span>we <span class="_ _42"> </span>wrote <span class="_ _42"> </span>the</span></span></div><div class="t m0 x32 h4d y8f4 ff19 fs26 fc0 sc0 ls0 ws0">following <span class="_ _53"> </span>code <span class="_ _e"> </span>and <span class="_ _e"> </span>if<span class="_ _4b"> </span><span class="ff1a">OPEN_MAX<span class="_ _4b"> </span></span>was <span class="_"> </span>indeterminate, <span class="_ _42"> </span>the <span class="_"> </span>loop <span class="_ _42"> </span>would <span class="_"> </span>never <span class="_ _53"> </span>execute,</div><div class="t m0 x32 h4d y8f5 ff19 fs26 fc0 sc0 ls0 ws0">since<span class="_"> </span><span class="ff1a">sysconf<span class="_ _80"> </span></span>would return<span class="_"> </span><span class="ff20">−</span>1:</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
