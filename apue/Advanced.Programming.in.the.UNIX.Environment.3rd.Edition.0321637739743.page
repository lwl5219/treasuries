<div id="pf2e7" class="pf w4 h1f" data-page-no="2e7"><div class="pc pc2e7 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg2e7.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>18.1<span class="_ _1"></span><span class="ls150d">1N<span class="_ _111"></span><span class="ls0">oncanonical <span class="_"> </span>Mode<span class="_ _1b"> </span><span class="ff18">709</span></span></span></div><div class="t m0 x32 h57 y362 ff1a fs2d fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h57 y363 ff1a fs2d fc0 sc0 ls0 ws0">static void</div><div class="t m0 x32 h57 y13a0 ff1a fs2d fc0 sc0 ls0 ws0">sig_catch(int signo)</div><div class="t m0 x32 h57 y846 ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y847 ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;signal caught\n&quot;);</div><div class="t m0 x8a h57 y13a1 ff1a fs2d fc0 sc0 ls0 ws0">tty_reset(STDIN_FILENO);</div><div class="t m0 x8a h57 y1fb8 ff1a fs2d fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h57 y1fb9 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h57 y849 ff1a fs2d fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h57 y84a ff1a fs2d fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 x32 h57 y1fdc ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y331b ff1a fs2d fc0 sc0 ls0 ws0">int <span class="_ _15"> </span>i;</div><div class="t m0 x8a h57 y520c ff1a fs2d fc0 sc0 ls0 ws0">char <span class="_ _68"> </span>c;</div><div class="t m0 x8a h57 y84e ff1a fs2d fc0 sc0 ls0 ws0">if (signal(SIGINT, sig_catch) == SIG_ERR)<span class="_ _68"> </span>/* catch signals */</div><div class="t m0 x9d h57 y84f ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;signal(SIGINT) error&quot;);</div><div class="t m0 x8a h57 y850 ff1a fs2d fc0 sc0 ls0 ws0">if (signal(SIGQUIT, sig_catch) == SIG_ERR)</div><div class="t m0 x9d h57 y851 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;signal(SIGQUIT) error&quot;);</div><div class="t m0 x8a h57 y852 ff1a fs2d fc0 sc0 ls0 ws0">if (signal(SIGTERM, sig_catch) == SIG_ERR)</div><div class="t m0 x9d h57 y853 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;signal(SIGTERM) error&quot;);</div><div class="t m0 x8a h57 y1d3e ff1a fs2d fc0 sc0 ls0 ws0">if (tty_raw(STDIN_FILENO) &lt; 0)</div><div class="t m0 x9d h57 y855 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;tty_raw error&quot;);</div><div class="t m0 x8a h57 y1d3f ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;Enter raw mode characters, terminate with DELETE\n&quot;);</div><div class="t m0 x8a h57 y2aad ff1a fs2d fc0 sc0 ls0 ws0">while ((i = read(STDIN_FILENO, &amp;c, 1)) == 1) {</div><div class="t m0 x9d h57 y2aae ff1a fs2d fc0 sc0 ls0 ws0">if ((c &amp;= 255) == 0177)<span class="_ _8a"> </span>/* 0177 = ASCII DELETE */</div><div class="t m0 x1f h57 y2aaf ff1a fs2d fc0 sc0 ls0 ws0">break;</div><div class="t m0 x9d h57 y2ba7 ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;%o\n&quot;, c);</div><div class="t m0 x8a h57 y2ba8 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y2ba9 ff1a fs2d fc0 sc0 ls0 ws0">if (tty_reset(STDIN_FILENO) &lt; 0)</div><div class="t m0 x9d h57 y2baa ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;tty_reset error&quot;);</div><div class="t m0 x8a h57 y331f ff1a fs2d fc0 sc0 ls0 ws0">if (i &lt;= 0)</div><div class="t m0 x9d h57 y520d ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;read error&quot;);</div><div class="t m0 x8a h57 y520e ff1a fs2d fc0 sc0 ls0 ws0">if (tty_cbreak(STDIN_FILENO) &lt; 0)</div><div class="t m0 x9d h57 y520f ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;tty_cbreak error&quot;);</div><div class="t m0 x8a h57 y5210 ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;\nEnter cbreak mode characters, terminate with SIGINT\n&quot;);</div><div class="t m0 x8a h57 y5211 ff1a fs2d fc0 sc0 ls0 ws0">while ((i = read(STDIN_FILENO, &amp;c, 1)) == 1) {</div><div class="t m0 x9d h57 y5212 ff1a fs2d fc0 sc0 ls0 ws0">c<span class="_"> </span>&amp;=<span class="_"> </span>255;</div><div class="t m0 x9d h57 y5213 ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;%o\n&quot;, c);</div><div class="t m0 x8a h57 y5214 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y5215 ff1a fs2d fc0 sc0 ls0 ws0">if (tty_reset(STDIN_FILENO) &lt; 0)</div><div class="t m0 x9d h57 y5216 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;tty_reset error&quot;);</div><div class="t m0 x8a h57 y1cdc ff1a fs2d fc0 sc0 ls0 ws0">if (i &lt;= 0)</div><div class="t m0 x9d h57 y1cdd ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;read error&quot;);</div><div class="t m0 x8a h57 y5217 ff1a fs2d fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h57 y5218 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x18f h2d y5219 ff18 fs10 fc0 sc0 ls0 ws0">Figure 18.21<span class="_ _5a"> </span><span class="ff19 ls292">Te<span class="_ _9"></span><span class="ls0">st raw and cbreak terminal modes</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
