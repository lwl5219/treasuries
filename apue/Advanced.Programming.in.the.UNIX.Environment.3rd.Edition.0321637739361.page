<div id="pf169" class="pf w4 h1f" data-page-no="169"><div class="pc pc169 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg169.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>10.5<span class="_ _26c"> </span>Interrupted <span class="_"> </span>System <span class="_"> </span>Calls<span class="_ _1b"> </span><span class="ff18">327</span></div><div class="t m0 x32 h2a y12f ff19 fsf fc0 sc0 ls0 ws0">action <span class="_"> </span>to <span class="_ _66"> </span>occur<span class="_ _1"></span><span class="lsbf1">,w<span class="_ _5b"></span><span class="ls0">hich <span class="_ _66"> </span>for <span class="_ _66"> </span>this <span class="_ _66"> </span>signal <span class="_ _66"> </span>terminates <span class="_ _66"> </span>the <span class="_ _47"> </span>pr<span class="_ _0"></span>ocess. <span class="_ _46"> </span>This<span class="_ _46"> </span>is <span class="_ _66"> </span>one <span class="_ _47"> </span>of <span class="_"> </span>those</span></span></div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">conditions <span class="_ _9"></span>that <span class="_ _23"> </span>works <span class="_ _23"></span>correctly <span class="_ _9"></span>most <span class="_ _23"></span>of <span class="_ _9"></span>the <span class="_ _23"> </span>time, <span class="_ _23"></span>causing <span class="_ _9"></span>us <span class="_ _23"> </span>to <span class="_ _23"></span>think <span class="_ _9"></span>that <span class="_ _23"> </span>it <span class="_ _23"></span>is <span class="_ _9"></span>correct,</div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">when it isn’t.</div><div class="t m0 x3f h2a y132 ff19 fsf fc0 sc0 ls0 ws0">Another problem with these <span class="_ _2"></span>earlier systems was <span class="_ _2"></span>that the <span class="_ _2"></span>process was unable to <span class="_ _2"></span>turn</div><div class="t m0 x32 h2a y133 ff19 fsf fc0 sc0 ls88c ws0">as<span class="_ _4f"></span><span class="ls0">ignal <span class="_ _2"></span>of<span class="ls88c">fw<span class="_ _4f"></span><span class="ls0">hen <span class="_ _2"></span>it didn’t <span class="_ _2"></span>want <span class="_ _2"></span>the <span class="_ _2"></span>signal to <span class="_ _2"></span>occur<span class="_ _1"></span><span class="lsbf2">.A<span class="_ _5b"></span><span class="ls0">ll <span class="_ _2"></span>the <span class="_ _2"></span>process could do <span class="_ _2"></span>was <span class="_ _2"></span>ignore</span></span></span></span></span></div><div class="t m0 x32 h2a y134 ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _47"> </span>signal.<span class="_ _5f"> </span>Ther<span class="lsbf3">ea<span class="_ _62"></span><span class="ls45">re <span class="_ _45"> </span>t<span class="_ _2"></span><span class="ls0">imes <span class="_ _45"> </span>when <span class="_ _47"> </span>we <span class="_ _47"> </span>would <span class="_ _47"> </span>like <span class="_ _45"> </span>to <span class="_ _47"> </span>tell <span class="_ _47"> </span>the <span class="_ _47"> </span>system <span class="_ _45"> </span>‘<span class="_ _1"></span>‘prevent <span class="_ _47"> </span>the</span></span></span></div><div class="t m0 x32 h2a y135 ff19 fsf fc0 sc0 ls0 ws0">following <span class="_ _42"> </span>signals <span class="_ _42"> </span>from <span class="_ _42"> </span>interrupting <span class="_ _23"> </span>me, <span class="_ _42"> </span>but <span class="_ _53"> </span>remember <span class="_ _23"> </span>if <span class="_ _42"> </span>they <span class="_ _53"> </span>do <span class="_ _42"> </span>occur<span class="_ _6"></span>.’<span class="lsbf4">’T<span class="_ _52"></span><span class="ls0">he <span class="_ _42"> </span>classic</span></span></div><div class="t m0 x32 h2a y136 ff19 fsf fc0 sc0 ls0 ws0">example <span class="_ _9"></span>that <span class="_ _23"> </span>demonstrates <span class="_ _23"></span>this <span class="_ _9"></span>ﬂaw <span class="_ _23"> </span>is <span class="_ _23"></span>shown <span class="_ _9"></span>by <span class="_ _23"></span>a <span class="_ _23"></span>piece <span class="_ _9"></span>of <span class="_ _23"></span>code <span class="_ _23"></span>that <span class="_ _9"></span>catches <span class="_ _23"></span>a <span class="_ _9"></span>signal</div><div class="t m0 x32 h2a y137 ff19 fsf fc0 sc0 ls0 ws0">and sets a ﬂag for the process that indicates that the signal occurr<span class="_ _0"></span>ed:</div><div class="t m0 x3f h57 y146f ff1a fs2d fc0 sc0 ls0 ws0">int <span class="_ _d9"> </span>sig_int();<span class="_ _13d"> </span>/* my signal handling function */</div><div class="t m0 x3f h57 y1470 ff1a fs2d fc0 sc0 ls0 ws0">int <span class="_ _d9"> </span>sig_int_flag;<span class="_ _26d"> </span>/* set nonzero when signal occurs */</div><div class="t m0 x3f h57 y2a0a ff1a fs2d fc0 sc0 ls0 ws0">main()</div><div class="t m0 x3f h57 y2a0b ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 xc2 h57 y2a0c ff1a fs2d fc0 sc0 ls0 ws0">signal(SIGINT, sig_int); /* establish handler */</div><div class="t m0 x122 h57 y2a0d ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 x122 h57 y2a0e ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 x122 h57 y2a0f ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 xc2 h57 y2a10 ff1a fs2d fc0 sc0 ls0 ws0">while (sig_int_flag == 0)</div><div class="t m0 x16e h57 y2a11 ff1a fs2d fc0 sc0 ls0 ws0">pause(); <span class="_ _82"> </span>/*<span class="_"> </span>go to sleep, waiting for signal */</div><div class="t m0 x122 h57 y2a12 ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 x122 h57 y2a13 ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 x122 h57 y2a14 ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 x3f h57 y2a15 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x3f h57 y2a16 ff1a fs2d fc0 sc0 ls0 ws0">sig_int()</div><div class="t m0 x3f h57 y2a17 ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 xc2 h57 y2a18 ff1a fs2d fc0 sc0 ls0 ws0">signal(SIGINT, sig_int); /* reestablish handler for next time */</div><div class="t m0 xc2 h57 y2a19 ff1a fs2d fc0 sc0 ls0 ws0">sig_int_flag = 1;<span class="_ _186"> </span>/* set flag for main loop to examine */</div><div class="t m0 x3f h57 y2a1a ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h26 y2a1b ff19 fsf fc0 sc0 ls0 ws0">Here, the <span class="_ _2"></span>process <span class="_ _2"></span>is <span class="_ _2"></span>calling <span class="_ _2"></span>the<span class="_ _66"> </span><span class="ff1a">pause<span class="_ _47"> </span></span>function <span class="_ _2"></span>to <span class="_ _2"></span>put <span class="_ _2"></span>it <span class="_ _2"></span>to <span class="_ _2"></span>sleep <span class="_ _3"></span>until <span class="_ _2"></span>a <span class="_ _2"></span>signal <span class="_ _2"></span>is <span class="_ _2"></span>caught.</div><div class="t m0 x32 h26 y2a1c ff19 fsf fc0 sc0 ls0 ws0">When <span class="_ _53"> </span>the <span class="_ _53"> </span>signal <span class="_ _53"> </span>is <span class="_ _42"> </span>caught, <span class="_ _53"> </span>the <span class="_ _53"> </span>signal <span class="_ _53"> </span>handler <span class="_ _53"> </span>just <span class="_ _53"> </span>sets <span class="_ _53"> </span>the <span class="_ _53"> </span>ﬂag<span class="_ _4b"> </span><span class="ff1a">sig_int_flag<span class="_ _44"> </span></span>to <span class="_ _53"> </span>a</div><div class="t m0 x32 h2a y2a1d ff19 fsf fc0 sc0 ls0 ws0">nonzer<span class="lsbf5">ov<span class="_ _c"></span><span class="ls0">alue. <span class="_ _44"> </span>The<span class="_ _35"> </span>process <span class="_ _42"> </span>is <span class="_ _42"> </span>automatically <span class="_ _42"> </span>awakened <span class="_ _42"> </span>by <span class="_ _42"> </span>the <span class="_ _42"> </span>kernel <span class="_ _42"> </span>after <span class="_ _23"> </span>the <span class="_ _42"> </span>signal</span></span></div><div class="t m0 x32 h2a y2a1e ff19 fsf fc0 sc0 ls0 ws0">handler <span class="_ _2"></span>returns, <span class="_ _3"></span>notices <span class="_ _3"></span>that <span class="_ _2"></span>the <span class="_ _3"></span>ﬂag <span class="_ _3"></span>is <span class="_ _3"></span>nonzero, <span class="_ _2"></span>and <span class="_ _3"></span>does <span class="_ _3"></span>whatever <span class="_ _3"></span>it <span class="_ _3"></span>needs <span class="_ _3"></span>to <span class="_ _3"></span>do.<span class="_ _61"> </span>But</div><div class="t m0 x32 h2a y2a1f ff19 fsf fc0 sc0 ls0 ws0">there<span class="_ _66"> </span>is<span class="_ _45"> </span>a<span class="_ _47"> </span>window <span class="_ _2"></span>of <span class="_ _3"></span>time <span class="_ _9"></span>when <span class="_ _2"></span>things <span class="_ _9"></span>can <span class="_ _2"></span>go <span class="_ _9"></span>wrong. <span class="_ _66"> </span>If<span class="_ _45"> </span>the <span class="_ _2"></span>signal <span class="_ _3"></span>occurs <span class="_ _3"></span>after <span class="_ _3"></span>the <span class="_ _3"></span>test</div><div class="t m0 x32 h26 y2a20 ff19 fsf fc0 sc0 ls0 ws0">of<span class="_ _45"> </span><span class="ff1a">sig_int_flag<span class="_ _35"> </span></span>but <span class="_ _23"></span>befor<span class="_ _0"></span><span class="ls7df">et<span class="_ _b"></span><span class="ls0">he <span class="_ _9"></span>call <span class="_ _23"></span>to<span class="_ _45"> </span><span class="ff1a">pause</span><span class="ls485">,t<span class="_ _b"></span><span class="ls0">he <span class="_ _9"></span>process <span class="_ _23"></span>could <span class="_ _9"></span>go <span class="_ _23"> </span>to <span class="_ _23"></span>sleep <span class="_ _23"></span>for<span class="_ _0"></span>ever</span></span></span></span></div><div class="t m0 x32 h2a y2a21 ff19 fsf fc0 sc0 ls0 ws0">(assuming that the signal is <span class="_ _2"></span>never generated again).<span class="_ _46"> </span>This <span class="_ _2"></span>occurrence of the signal is lost.</div><div class="t m0 x32 h2a y2a22 ff19 fsf fc0 sc0 ls0 ws0">This <span class="_ _42"> </span>is <span class="_ _42"> </span>another <span class="_ _42"> </span>example <span class="_ _42"> </span>of <span class="_ _42"> </span>some <span class="_ _42"> </span>code <span class="_ _42"> </span>that <span class="_ _42"> </span>isn’t <span class="_ _42"> </span>right, <span class="_ _42"> </span>yet <span class="_ _42"> </span>it <span class="_ _42"> </span>works <span class="_ _42"> </span>most <span class="_ _42"> </span>of <span class="_ _42"> </span>the <span class="_ _42"> </span>time.</div><div class="t m0 x32 h2a y2a23 ff19 fsf fc0 sc0 ls0 ws0">Debugging this type of problem can be dif<span class="_ _0"></span>ﬁcult.</div><div class="t m0 x35 h53 y2a24 ff16 fs2b fc0 sc0 ls0 ws0">10.5 <span class="_ _93"> </span>Interrupted<span class="_ _54"> </span>System <span class="_"> </span>Calls</div><div class="t m0 x32 h2a y2a25 ff19 fsf fc0 sc0 lsbf6 ws0">Ac<span class="_ _8"></span><span class="ls0">haracteristic <span class="_ _3"></span>of <span class="_ _3"></span>earlier <span class="_ _3"></span>UNIX <span class="_ _3"></span>systems <span class="_ _9"></span>was <span class="_ _3"></span>that <span class="_ _3"></span>if <span class="_ _3"></span>a <span class="_ _3"></span>process <span class="_ _3"></span>caught <span class="_ _3"></span>a <span class="_ _3"></span>signal <span class="_ _3"></span>while <span class="_ _3"></span>the</span></div><div class="t m0 x32 h2a y2a26 ff19 fsf fc0 sc0 ls0 ws0">process <span class="_ _53"> </span>was <span class="_"> </span>blocked <span class="_ _53"> </span>in <span class="_"> </span>a <span class="_ _e"> </span>‘<span class="_ _0"></span>‘slow’<span class="_ _1"></span><span class="lsbf7">’s<span class="_ _55"></span><span class="ls0">ystem <span class="_"> </span>call, <span class="_ _53"> </span>the <span class="_"> </span>system <span class="_ _53"> </span>call <span class="_"> </span>was <span class="_ _e"> </span>interrupted. <span class="_ _4b"> </span>The</span></span></div><div class="t m0 x32 h26 y2a27 ff19 fsf fc0 sc0 ls0 ws0">system <span class="_ _9"></span>call <span class="_ _23"></span>returned <span class="_ _9"></span>an <span class="_ _9"></span>error <span class="_ _9"></span>and<span class="_ _45"> </span><span class="ff1a">errno<span class="_ _35"> </span></span>was <span class="_ _9"></span>set <span class="_ _23"></span>to<span class="_ _45"> </span><span class="ff1a">EINTR</span><span class="lsbf8">.T<span class="_ _26"></span><span class="ls0">his <span class="_ _23"></span>was <span class="_ _9"></span>done <span class="_ _23"></span>under <span class="_ _9"></span>the</span></span></div><div class="t m0 x32 h2a y2a28 ff19 fsf fc0 sc0 ls0 ws0">assumption that since a signal occurred and the process caught it, there<span class="_"> </span>is<span class="_"> </span>a<span class="_"> </span>good chance</div><div class="t m0 x32 h2a y2a29 ff19 fsf fc0 sc0 ls0 ws0">that something has happened that should wake up the blocked system call.</div><div class="t m0 x76 h51 y2a2a ff19 fs2a fc0 sc0 ls0 ws0">Here, <span class="_ _2"></span>we <span class="_ _3"></span>have <span class="_ _2"></span>to <span class="_ _3"></span>differentiate <span class="_ _2"></span>between <span class="_ _2"></span>a <span class="_ _3"></span>system <span class="_ _3"></span>call <span class="_ _3"></span>and <span class="_ _2"></span>a <span class="_ _3"></span>function.<span class="_ _4b"> </span>It <span class="_ _3"></span>is <span class="_ _3"></span>a <span class="_ _2"></span>system <span class="_ _3"></span>call <span class="_ _3"></span>within</div><div class="t m0 x76 h51 y2a2b ff19 fs2a fc0 sc0 ls0 ws0">the kernel that is interrupted when a signal is caught.</div><a class="l" href="#pff" data-dest-detail='[15,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.893675px;bottom:314.680799px;width:184.044189px;height:19.680008px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
