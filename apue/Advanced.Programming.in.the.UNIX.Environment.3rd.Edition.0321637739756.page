<div id="pf2f4" class="pf w4 h1f" data-page-no="2f4"><div class="pc pc2f4 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg2f4.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">722<span class="_ _1b"> </span><span class="ff19">Pseudo <span class="_"> </span>T<span class="_ _6"></span>erminals <span class="_ _23a"> </span>Chapter<span class="_ _4b"> </span>19</span></div><div class="t m0 xa0 h51 y5320 ff19 fs2a fc0 sc0 ls0 ws0">terminal</div><div class="t m0 x25 h51 y5321 ff19 fs2a fc0 sc0 ls0 ws0">device driver</div><div class="t m0 xcc h2d y5322 ff19 fs10 fc0 sc0 ls0 ws0">PTY master</div><div class="t m0 x75 h2e y5323 ff19 fs11 fc0 sc0 ls0 ws0">PTY slave</div><div class="t m0 x108 h2f y5324 ff19 fs12 fc0 sc0 ls0 ws0">terminal</div><div class="t m0 xe9 h2f y5325 ff19 fs12 fc0 sc0 ls0 ws0">line discipline</div><div class="t m0 x48 h30 y5326 ff19 fs13 fc0 sc0 ls0 ws0">terminal</div><div class="t m0 x104 h30 y5327 ff19 fs13 fc0 sc0 ls0 ws0">line discipline</div><div class="t m0 x120 h31 y5328 ff19 fs14 fc0 sc0 ls0 ws0">kernel</div><div class="t m0 x3d h32 y536c ff19 fs15 fc0 sc0 ls0 ws0">login</div><div class="t m0 x3d h32 y536d ff19 fs15 fc0 sc0 ls0 ws0">shell</div><div class="t m0 x1ac h70 y536e ff1a fs16 fc0 sc0 ls0 ws0">pty</div><div class="t m0 x19a h33 y536f ff19 fs16 fc0 sc0 ls0 ws0">process</div><div class="t m0 x10a h83 y5370 ff19 fs36 fc0 sc0 ls0 ws0">output</div><div class="t m0 x1e7 h83 y5371 ff19 fs36 fc0 sc0 ls0 ws0">ﬁle</div><div class="t m0 x21f hcc y532e ff1a fs17 fc0 sc0 ls0 ws0">fork</div><div class="t m0 x21f hcc y532f ff1a fs17 fc0 sc0 ls0 ws0">exec</div><div class="t m0 x1ef hd4 y5331 ff1a fs18 fc0 sc0 ls0 ws0">slowout</div><div class="t m0 x225 hd5 y5332 ff1a fs19 fc0 sc0 ls0 ws0">fork</div><div class="t m0 x225 hd5 y5333 ff1a fs19 fc0 sc0 ls0 ws0">exec</div><div class="t m0 x1a8 h185 y5372 ff1b fs21 fc0 sc0 ls0 ws0">stdout</div><div class="t m0 xa1 h185 y5373 ff1b fs21 fc0 sc0 ls0 ws0">stderr</div><div class="t m0 x6e h185 y5372 ff1b fs21 fc0 sc0 ls0 ws0">stdin</div><div class="t m0 x108 h181 y5336 ff19 fsa6 fc0 sc0 ls0 ws0">user at a</div><div class="t m0 x108 h181 y5337 ff19 fsa6 fc0 sc0 ls0 ws0">terminal</div><div class="t m0 x22e h181 y5374 ff18 fsa6 fc0 sc0 ls0 ws0">Figure 19.7<span class="_ _5a"> </span><span class="ff19">Running a slow output program using a pseudo terminal</span></div><div class="t m0 x35 h186 y5375 ff16 fsc8 fc0 sc0 ls0 ws0">19.3 <span class="_ _93"> </span>Opening<span class="_ _54"> </span>Pseudo-T<span class="_ _6"></span>erminal <span class="_"> </span>Devices</div><div class="t m0 x32 h183 y5376 ff19 fsc7 fc0 sc0 ls0 ws0">PTYs <span class="_ _3"></span>act <span class="_ _9"></span>like <span class="_ _3"></span>physical <span class="_ _9"></span>terminal <span class="_ _9"></span>devices <span class="_ _3"></span>so <span class="_ _9"></span>that <span class="_ _3"></span>applications <span class="_ _9"></span>ar<span class="ls158d">eu<span class="_ _b"></span><span class="ls0">naware<span class="_ _47"> </span>of<span class="_ _45"> </span>which <span class="_ _3"></span>type</span></span></div><div class="t m0 x32 h182 y5377 ff19 fsc7 fc0 sc0 ls0 ws0">of <span class="_ _2"></span>device <span class="_ _2"></span>they <span class="_ _2"></span>ar<span class="ls158e">eu<span class="_ _4f"></span><span class="ls0">sing. <span class="_ _66"> </span>However<span class="_ _1"></span><span class="ls158e">,a<span class="_ _4f"></span><span class="ls0">pplications <span class="_ _2"></span>don’t <span class="_ _2"></span>need <span class="_ _2"></span>to <span class="_ _3"></span>set <span class="_ _2"></span>the<span class="_ _66"> </span><span class="ff1a">O_TTY_INIT<span class="_ _47"> </span></span>ﬂag</span></span></span></span></div><div class="t m0 x32 h183 y5378 ff19 fsc7 fc0 sc0 ls0 ws0">when <span class="_ _42"> </span>opening <span class="_ _42"> </span>PTY <span class="_ _53"> </span>device <span class="_ _42"> </span>ﬁles.<span class="_ _54"> </span>The <span class="_ _42"> </span>Single <span class="_ _53"> </span>UNIX <span class="_ _42"> </span>Speciﬁcation <span class="_ _53"> </span>already <span class="_ _42"> </span>r<span class="_ _0"></span>equires <span class="_ _42"> </span>that</div><div class="t m0 x32 h183 y5379 ff19 fsc7 fc0 sc0 ls0 ws0">implementations <span class="_ _3"></span>initialize <span class="_ _2"></span>the <span class="_ _3"></span>slave <span class="_ _3"></span>side <span class="_ _3"></span>of <span class="_ _3"></span>a <span class="_ _3"></span>PTY <span class="_ _3"></span>device <span class="_ _3"></span>when <span class="_ _3"></span>it <span class="_ _3"></span>is <span class="_ _3"></span>ﬁrst <span class="_ _3"></span>opened <span class="_ _3"></span>so <span class="_ _3"></span>that</div><div class="t m0 x32 h182 y537a ff19 fsc7 fc0 sc0 ls0 ws0">any <span class="_ _23"></span>nonstandard<span class="_ _45"> </span><span class="ff1a">termios<span class="_ _35"> </span></span>ﬂags <span class="_ _9"></span>needed <span class="_ _23"> </span>for <span class="_ _23"> </span>the <span class="_ _23"> </span>device <span class="_ _23"> </span>to <span class="_ _23"> </span>operate <span class="_ _23"> </span>as <span class="_ _23"></span>expected <span class="_ _23"></span>ar<span class="ls158f">es<span class="_ _43"></span><span class="ls0">et.</span></span></div><div class="t m0 x32 h183 y537b ff19 fsc7 fc0 sc0 ls0 ws0">This <span class="_ _3"></span>requirement <span class="_ _3"></span>is <span class="_ _3"></span>intended <span class="_ _9"></span>to <span class="_ _3"></span>allow <span class="_ _9"></span>the <span class="_ _9"></span>PTY <span class="_ _3"></span>device <span class="_ _9"></span>to <span class="_ _3"></span>operate <span class="_ _9"></span>properly <span class="_ _3"></span>with <span class="_ _9"></span>POSIX-</div><div class="t m0 x32 h182 y537c ff19 fsc7 fc0 sc0 ls0 ws0">conforming applications that call<span class="_"> </span><span class="ff1a">tcgetattr<span class="_ _80"> </span></span>and<span class="_"> </span><span class="ff1a">tcsetattr</span>.</div><div class="t m0 x3f h183 y537d ff19 fsc7 fc0 sc0 ls0 ws0">The <span class="_ _45"> </span>way <span class="_ _45"> </span>we <span class="_ _45"> </span>open <span class="_ _45"> </span>a <span class="_ _45"> </span>PTY <span class="_ _35"> </span>device <span class="_ _45"> </span>dif<span class="_ _0"></span>fers <span class="_ _45"> </span>among <span class="_ _45"> </span>platforms.<span class="_ _1a3"> </span>The <span class="_ _45"> </span>Single <span class="_ _35"> </span>UNIX</div><div class="t m0 x32 h183 y537e ff19 fsc7 fc0 sc0 ls0 ws0">Speciﬁcation <span class="_ _3"></span>includes <span class="_ _3"></span>several <span class="_ _3"></span>functions <span class="_ _3"></span>as <span class="_ _9"></span>part <span class="_ _3"></span>of <span class="_ _3"></span>the <span class="_ _3"></span>XSI <span class="_ _3"></span>option <span class="_ _3"></span>in <span class="_ _9"></span>an <span class="_ _3"></span>attempt <span class="_ _3"></span>to <span class="_ _3"></span>unify</div><div class="t m0 x32 h183 y537f ff19 fsc7 fc0 sc0 ls0 ws0">the <span class="_ _47"> </span>methods.<span class="_ _5f"> </span>These <span class="_ _45"> </span>extensions <span class="_ _47"> </span>ar<span class="ls1590">eb<span class="_ _62"></span><span class="ls0">ased <span class="_ _45"> </span>on <span class="_ _47"> </span>the <span class="_ _47"> </span>functions <span class="_ _45"> </span>originally <span class="_ _47"> </span>provided <span class="_ _47"> </span>to</span></span></div><div class="t m0 x32 h183 y5380 ff19 fsc7 fc0 sc0 ls0 ws0">manage <span class="_ _2"></span>STREAMS</div><div class="t m0 xe7 h183 y5381 ff19 fsc7 fc0 sc0 ls0 ws0">-</div><div class="t m0 xe8 h182 y5380 ff19 fsc7 fc0 sc0 ls0 ws0">based <span class="_ _2"></span>PTYs <span class="_ _3"></span>in <span class="_ _2"></span>System <span class="_ _3"></span>V <span class="_ _3"></span>Release <span class="_ _2"></span>4.<span class="_ _16"> </span>The<span class="_ _47"> </span><span class="ff1a">posix_openpt<span class="_ _47"> </span></span>function <span class="_ _2"></span>is</div><div class="t m0 x32 h183 y5382 ff19 fsc7 fc0 sc0 ls0 ws0">provided as a portable way to open an available PTY master device.</div><div class="t m0 x3f h187 y5383 ff1a fsc9 fc0 sc0 ls0 ws0">#include &lt;stdlib.h&gt;</div><div class="t m0 x3f h187 y5384 ff1a fsc9 fc0 sc0 ls0 ws0">#include &lt;fcntl.h&gt;</div><div class="t m0 x3f h187 y5385 ff1a fsc9 fc0 sc0 ls0 ws0">int posix_openpt(int<span class="_"> </span><span class="ff1b">oﬂag</span>);</div><div class="t m0 x25 h188 y5386 ff19 fsc9 fc0 sc0 ls0 ws0">Returns: ﬁle descriptor of next available PTY master if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><a class="l" href="#pf13" data-dest-detail='[19,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.901237px;bottom:580.280395px;width:239.843597px;height:19.681000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
