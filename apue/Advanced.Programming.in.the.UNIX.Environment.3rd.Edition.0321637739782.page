<div id="pf30e" class="pf w4 h1f" data-page-no="30e"><div class="pc pc30e w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg30e.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">748<span class="_ _1b"> </span><span class="ff19 ls30a">AD<span class="_ _55"></span><span class="ls0">atabase <span class="_"> </span>Library<span class="_ _245"> </span>Chapter <span class="_"> </span>20</span></span></div><div class="t m0 x3f h26 y12f ff19 fsf fc0 sc0 ls5f ws0">To <span class="_ _66"> </span>ﬁ<span class="_ _9"></span><span class="ls0">nd <span class="_ _9"></span>a <span class="_ _3"></span>record<span class="_ _47"> </span>in<span class="_ _45"> </span>the <span class="_ _9"></span>database <span class="_ _3"></span>given <span class="_ _9"></span>its <span class="_ _9"></span>key<span class="_ _6"></span>,<span class="_ _47"> </span><span class="ff1a">db_fetch<span class="_ _45"> </span></span>calculates <span class="_ _9"></span>the <span class="_ _9"></span>hash <span class="_ _3"></span>value</span></div><div class="t m0 x32 h2b y130 ff19 fsf fc0 sc0 ls0 ws0">of <span class="_ _2"></span>the <span class="_ _2"></span>key<span class="_ _6"></span><span class="lscf2">,w<span class="_ _8"></span><span class="ls0">hich <span class="_ _3"></span>leads <span class="_ _2"></span>to <span class="_ _2"></span>one <span class="_ _2"></span>hash <span class="_ _2"></span>chain <span class="_ _3"></span>in <span class="_ _2"></span>the <span class="_ _2"></span>hash <span class="_ _2"></span>table.<span class="_ _61"> </span>(The<span class="_ _47"> </span><span class="ff1b">chain <span class="_ _2"></span>ptr<span class="_ _47"> </span></span>ﬁeld <span class="_ _2"></span>could <span class="_ _2"></span>be</span></span></div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">0, <span class="_ _3"></span>indicating <span class="_ _9"></span>an <span class="_ _3"></span>empty <span class="_ _9"></span>chain.)<span class="_ _16"> </span><span class="ls5f">We <span class="_ _66"> </span>t<span class="_ _9"></span></span>hen <span class="_ _3"></span>follow <span class="_ _9"></span>this <span class="_ _3"></span>hash <span class="_ _9"></span>chain, <span class="_ _3"></span>which <span class="_ _9"></span>is <span class="_ _3"></span>a <span class="_ _9"></span>linked <span class="_ _3"></span>list <span class="_ _9"></span>of</div><div class="t m0 x32 h2b y132 ff19 fsf fc0 sc0 ls0 ws0">all <span class="_ _23"></span>the <span class="_ _9"></span>index <span class="_ _23"></span>recor<span class="_ _0"></span>ds <span class="_ _9"></span>with <span class="_ _23"> </span>this <span class="_ _23"></span>hash <span class="_ _23"></span>value.<span class="_ _5a"> </span>When <span class="_ _23"></span>we <span class="_ _23"></span>encounter <span class="_ _9"></span>a<span class="_ _35"> </span><span class="ff1b">chain <span class="_ _9"></span>ptr<span class="_ _35"> </span></span>value <span class="_ _23"></span>of <span class="_ _9"></span>0,</div><div class="t m0 x32 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">we’ve hit the end of the hash chain.</div><div class="t m0 x3f h2a y134 ff19 fsf fc0 sc0 ls0 ws0">Let’s <span class="_ _53"> </span>look <span class="_"> </span>at <span class="_ _53"> </span>an <span class="_ _53"> </span>actual <span class="_"> </span>database <span class="_ _53"> </span>ﬁle.<span class="_ _65"> </span>The <span class="_ _e"> </span>program <span class="_ _53"> </span>in <span class="_"> </span>Figur<span class="_ _0"></span><span class="ls1625">e2<span class="_ _55"></span><span class="ls0">0.3 <span class="_ _53"> </span>creates <span class="_ _e"> </span>a <span class="_ _e"> </span>new</span></span></div><div class="t m0 x32 h2a y135 ff19 fsf fc0 sc0 ls0 ws0">database <span class="_ _9"></span>and <span class="_ _9"></span>writes <span class="_ _9"></span>three <span class="_ _9"></span>recor<span class="_ _0"></span>ds <span class="_ _9"></span>to <span class="_ _9"></span>it.<span class="_ _5a"> </span>Since <span class="_ _9"></span>we <span class="_ _23"></span>stor<span class="_ _0"></span><span class="ls1626">ea<span class="_ _b"></span><span class="ls0">ll <span class="_ _9"></span>the <span class="_ _9"></span>ﬁelds <span class="_ _9"></span>in <span class="_ _9"></span>the <span class="_ _23"></span>database <span class="_ _9"></span>as</span></span></div><div class="t m0 x32 h2a y136 ff19 fsf fc0 sc0 ls0 ws0">ASCII <span class="_ _42"> </span>characters, <span class="_ _53"> </span>we <span class="_ _42"> </span>can <span class="_ _53"> </span>look <span class="_ _42"> </span>at <span class="_ _53"> </span>the <span class="_ _53"> </span>actual <span class="_ _42"> </span>index <span class="_ _53"> </span>ﬁle <span class="_ _42"> </span>and <span class="_ _53"> </span>data <span class="_ _42"> </span>ﬁle <span class="_ _53"> </span>using <span class="_ _53"> </span>any <span class="_ _42"> </span>of <span class="_ _53"> </span>the</div><div class="t m0 x32 h2a y137 ff19 fsf fc0 sc0 ls0 ws0">standar<span class="ls44">dU<span class="_ _4f"></span><span class="ls0">NIX System tools:</span></span></div><div class="t m0 x3f h57 y55dc ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">ls -l db4.*</span></div><div class="t m0 x3f h57 y55dd ff1a fs2d fc0 sc0 ls0 ws0">-rw-r--r-- <span class="_"> </span>1<span class="_"> </span>sar <span class="_ _b7"> </span>28<span class="_"> </span>Oct 19 21:33 db4.dat</div><div class="t m0 x3f h57 y55de ff1a fs2d fc0 sc0 ls0 ws0">-rw-r--r-- <span class="_"> </span>1<span class="_"> </span>sar <span class="_ _b7"> </span>72<span class="_"> </span>Oct 19 21:33 db4.idx</div><div class="t m0 x3f h57 y55df ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">cat db4.idx</span></div><div class="t m0 x22f h57 y55e0 ff1a fs2d fc0 sc0 ls0 ws0">0<span class="_ _d9"> </span>53<span class="_ _3a"> </span>3<span class="lsa73">50</span></div><div class="t m0 x22f h57 y55e1 ff1a fs2d fc0 sc0 ls1627 ws0">01<span class="_ _96"></span><span class="ls0">0Alpha:0:6</span></div><div class="t m0 x22f h57 y55e2 ff1a fs2d fc0 sc0 ls1627 ws0">01<span class="_ _96"></span><span class="ls0">0beta:6:14</span></div><div class="t m0 xf4 h57 y55e3 ff1a fs2d fc0 sc0 ls0 ws0">17 <span class="_"> </span>11gamma:20:8</div><div class="t m0 x3f h57 y55e4 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">cat db4.dat</span></div><div class="t m0 x3f h57 y55e5 ff1a fs2d fc0 sc0 ls0 ws0">data1</div><div class="t m0 x3f h57 y55e6 ff1a fs2d fc0 sc0 ls0 ws0">Data for beta</div><div class="t m0 x3f h57 y55e7 ff1a fs2d fc0 sc0 ls0 ws0">record3</div><div class="t m0 x32 h2b y55e8 ff19 fsf fc0 sc0 ls5f ws0">To <span class="_ _4b"> </span>k<span class="_ _23"></span><span class="ls0">eep <span class="_ _66"> </span>this <span class="_ _47"> </span>example <span class="_ _66"> </span>small, <span class="_ _47"> </span>we <span class="_ _66"> </span>have <span class="_ _47"> </span>set <span class="_ _66"> </span>the <span class="_ _47"> </span>size <span class="_ _66"> </span>of <span class="_ _47"> </span>each<span class="_ _61"> </span><span class="ff1b">ptr<span class="_ _61"> </span></span>ﬁeld <span class="_ _47"> </span>to <span class="_ _66"> </span>four <span class="_ _47"> </span>ASCII</span></div><div class="t m0 x32 h2b y55e9 ff19 fsf fc0 sc0 ls0 ws0">characters; <span class="_"> </span>the <span class="_"> </span>number <span class="_"> </span>of <span class="_"> </span>hash <span class="_"> </span>chains <span class="_"> </span>is <span class="_"> </span>set <span class="_"> </span>to <span class="_"> </span>3.<span class="_ _48"> </span>Since <span class="_"> </span>each<span class="_ _46"> </span><span class="ff1b">ptr<span class="_ _59"> </span></span>is <span class="_"> </span>a <span class="_"> </span>ﬁle <span class="_"> </span>offset, <span class="_"> </span>a</div><div class="t m0 x32 h2a y55ea ff19 fsf fc0 sc0 ls0 ws0">four-character <span class="_ _23"></span>ﬁeld <span class="_ _23"> </span>limits <span class="_ _42"> </span>the <span class="_ _42"> </span>total <span class="_ _23"> </span>size <span class="_ _42"> </span>of <span class="_ _23"> </span>the <span class="_ _42"> </span>index <span class="_ _42"> </span>ﬁle <span class="_ _23"> </span>and <span class="_ _42"> </span>data <span class="_ _23"> </span>ﬁle <span class="_ _42"> </span>to <span class="_ _42"> </span>10,000 <span class="_ _23"> </span>bytes.</div><div class="t m0 x32 h2a y55eb ff19 fsf fc0 sc0 ls0 ws0">When <span class="_ _9"></span>we <span class="_ _23"></span>do <span class="_ _9"></span>some <span class="_ _9"></span>performance <span class="_ _23"></span>measurements <span class="_ _3"></span>of <span class="_ _23"></span>the <span class="_ _9"></span>database <span class="_ _9"></span>system <span class="_ _23"></span>in <span class="_ _9"></span>Section <span class="_ _23"></span>20.9,</div><div class="t m0 x32 h2b y55ec ff19 fsf fc0 sc0 ls0 ws0">we set the size of each<span class="_"> </span><span class="ff1b">ptr<span class="_"> </span></span>ﬁeld to <span class="_ _2"></span>six characters (allowing ﬁle sizes up to 1 million <span class="_ _2"></span>bytes)</div><div class="t m0 x32 h2a y55ed ff19 fsf fc0 sc0 ls0 ws0">and the number of hash chains to mor<span class="ls44">et<span class="_ _4f"></span><span class="ls0">han 100.</span></span></div><div class="t m0 x3f h2a y55ee ff19 fsf fc0 sc0 ls0 ws0">The ﬁrst line in the index ﬁle</div><div class="t m0 x22f h57 y55ef ff1a fs2d fc0 sc0 ls0 ws0">0<span class="_ _d9"> </span>53<span class="_ _3a"> </span>3<span class="lsa73">50</span></div><div class="t m0 x32 h2a y55f0 ff19 fsf fc0 sc0 ls0 ws0">consists <span class="_"> </span>of <span class="_"> </span>the <span class="_"> </span>free-list <span class="_"> </span>pointer <span class="_"> </span>(0, <span class="_"> </span>the <span class="_"> </span>free <span class="_"> </span>list <span class="_"> </span>is <span class="_"> </span>empty) <span class="_"> </span>and <span class="_"> </span>the <span class="_"> </span>three <span class="_"> </span>hash <span class="_"> </span>chain</div><div class="t m0 x32 h2a y55f1 ff19 fsf fc0 sc0 ls0 ws0">pointers</div><div class="t m0 xc2 h2a y55f2 ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 x21b h2a y55f1 ff19 fsf fc0 sc0 ls0 ws0">53, 35, and 0</div><div class="t m0 x30 h2a y55f2 ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 xa0 h2a y55f1 ff19 fsf fc0 sc0 ls86 ws0">.T<span class="_ _4a"></span><span class="ls0">he next line</span></div><div class="t m0 x22f h57 y55f3 ff1a fs2d fc0 sc0 ls1627 ws0">01<span class="_ _96"></span><span class="ls0">0Alpha:0:6</span></div><div class="t m0 x32 h2a y55f4 ff19 fsf fc0 sc0 ls0 ws0">shows <span class="_ _42"> </span>the <span class="_ _42"> </span>format <span class="_ _53"> </span>of <span class="_ _42"> </span>each <span class="_ _42"> </span>index <span class="_ _53"> </span>recor<span class="_ _0"></span>d. <span class="_ _44"> </span>The<span class="_ _44"> </span>ﬁrst <span class="_ _42"> </span>ﬁeld</div><div class="t m0 x1bf h2a y55f5 ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 x1ef h2a y55f4 ff19 fsf fc0 sc0 ls0 ws0">0</div><div class="t m0 x1da h2a y55f5 ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 x12c h2a y55f4 ff19 fsf fc0 sc0 ls0 ws0">is <span class="_ _42"> </span>the <span class="_ _42"> </span>four-character <span class="_ _42"> </span>chain</div><div class="t m0 x32 h2a y55f6 ff19 fsf fc0 sc0 ls0 ws0">pointer<span class="_ _6"></span><span class="ls15e5">.T<span class="_ _4a"></span><span class="ls0">his record<span class="_"> </span>is<span class="_"> </span>the <span class="_ _2"></span>end <span class="_ _2"></span>of <span class="_ _2"></span>its hash <span class="_ _2"></span>chain.<span class="_ _61"> </span>The <span class="_ _2"></span>next ﬁeld</span></span></div><div class="t m0 xc h2a y55f7 ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 x6e h2a y55f6 ff19 fsf fc0 sc0 ls0 ws0">10</div><div class="t m0 x68 h2a y55f7 ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 x1ea h2a y55f6 ff19 fsf fc0 sc0 ls0 ws0">is the <span class="_ _2"></span>four-character</div><div class="t m0 x32 h2b y55f8 ff1b fsf fc0 sc0 ls0 ws0">idx <span class="_ _42"> </span>len<span class="ff19 ls1021">,t<span class="_ _43"></span><span class="ls0">he <span class="_ _42"> </span>length <span class="_ _42"> </span>of <span class="_ _42"> </span>the <span class="_ _42"> </span>remainder <span class="_ _42"> </span>of <span class="_ _42"> </span>this <span class="_ _53"> </span>index <span class="_ _42"> </span>record. <span class="_ _35"> </span>W<span class="_ _6"></span><span class="ls1628">er<span class="_ _c"></span><span class="ls0">ead <span class="_ _53"> </span>each <span class="_ _42"> </span>index <span class="_ _42"> </span>record</span></span></span></span></div><div class="t m0 x32 h26 y55f9 ff19 fsf fc0 sc0 ls0 ws0">using <span class="_ _23"> </span>two<span class="_ _44"> </span><span class="ff1a">read</span>s: <span class="_ _23"> </span>one <span class="_ _42"> </span>to <span class="_ _23"> </span>read <span class="_ _23"> </span>the <span class="_ _42"> </span>two <span class="_ _23"> </span>ﬁxed-size <span class="_ _42"> </span>ﬁelds <span class="_ _42"> </span>(the<span class="_ _35"> </span><span class="ff1b">chain <span class="_ _23"> </span>ptr<span class="_ _44"> </span></span>and<span class="_ _35"> </span><span class="ff1b">idx <span class="_ _42"> </span>len</span><span class="ls1629">)a<span class="_ _43"></span><span class="ls0">nd</span></span></div><div class="t m0 x32 h2a y55fa ff19 fsf fc0 sc0 ls0 ws0">another <span class="_ _61"> </span>to <span class="_ _16"> </span>read <span class="_ _61"> </span>the <span class="_ _16"> </span>remaining <span class="_ _61"> </span>(variable-length) <span class="_ _61"> </span>portion.<span class="_ _d9"> </span>The <span class="_ _16"> </span>remaining <span class="_ _61"> </span>three</div><div class="t m0 x32 h2b y55fb ff19 fsf fc0 sc0 ls0 ws0">ﬁelds—<span class="ff1b">key</span>,<span class="_ _45"> </span><span class="ff1b">dat <span class="_ _23"> </span>off</span><span class="ls1a4">,a<span class="_ _b"></span><span class="ls0">nd<span class="_ _45"> </span><span class="ff1b">dat <span class="_ _23"> </span>len</span>—ar<span class="ls1a4">ed<span class="_ _43"></span><span class="ls0">elimited <span class="_ _23"> </span>by <span class="_ _23"> </span>a <span class="_ _23"></span>separator <span class="_ _23"></span>character <span class="_ _23"></span>(a <span class="_ _9"></span>colon <span class="_ _23"> </span>in <span class="_ _23"> </span>this</span></span></span></span></div><div class="t m0 x32 h2a y55fc ff19 fsf fc0 sc0 ls0 ws0">case). <span class="_"> </span>W<span class="_ _6"></span><span class="lsd7c">en<span class="_ _d"></span><span class="ls0">eed the separator <span class="_ _2"></span>character<span class="_ _6"></span><span class="lsd7c">,s<span class="_ _5"></span><span class="ls0">ince each of these three ﬁelds is variable length.</span></span></span></span></div><div class="t m0 x32 h2a y55fd ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _2"></span>separator <span class="_ _3"></span>character <span class="_ _3"></span>can’t <span class="_ _3"></span>appear <span class="_ _2"></span>in <span class="_ _3"></span>the <span class="_ _3"></span>key<span class="_ _4"></span><span class="ls162a">.F<span class="_ _5b"></span><span class="ls0">inally<span class="_ _4"></span><span class="ls590">,an<span class="_ _4f"></span><span class="ls0">ewline <span class="_ _3"></span>terminates <span class="_ _3"></span>the <span class="_ _2"></span>index</span></span></span></span></div><div class="t m0 x32 h2b y55fe ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">cord. <span class="_ _45"> </span>The<span class="_ _45"> </span>newline <span class="_ _23"></span>isn’t <span class="_ _9"></span>required, <span class="_ _9"></span>since<span class="_ _45"> </span><span class="ff1b">idx <span class="_ _23"></span>len<span class="_ _45"> </span></span>contains <span class="_ _23"></span>the <span class="_ _9"></span>length <span class="_ _9"></span>of <span class="_ _23"></span>the <span class="_ _9"></span>record. <span class="_ _45"> </span>W<span class="_ _6"></span>e</span></div><div class="t m0 x32 h2a y55ff ff19 fsf fc0 sc0 ls0 ws0">stor<span class="ls162b">et<span class="_ _8"></span><span class="ls0">he <span class="_ _2"></span>newline <span class="_ _3"></span>to <span class="_ _2"></span>separate <span class="_ _3"></span>each <span class="_ _2"></span>index <span class="_ _2"></span>record<span class="_ _66"> </span>so<span class="_ _47"> </span>we<span class="_ _66"> </span>can <span class="_ _3"></span>use <span class="_ _2"></span>the <span class="_ _3"></span>normal <span class="_ _2"></span>UNIX <span class="_ _3"></span>System</span></span></div><div class="t m0 x32 h26 y5600 ff19 fsf fc0 sc0 ls0 ws0">tools, <span class="_ _3"></span>such <span class="_ _3"></span>as<span class="_ _47"> </span><span class="ff1a">cat<span class="_ _47"> </span></span>and<span class="_ _45"> </span><span class="ff1a">more</span><span class="ls8a3">,w<span class="_ _b"></span><span class="ls0">ith <span class="_ _3"></span>the <span class="_ _9"></span>index <span class="_ _3"></span>ﬁle.<span class="_ _61"> </span>The<span class="_ _45"> </span><span class="ff1b">key<span class="_ _47"> </span></span>is <span class="_ _2"></span>the <span class="_ _9"></span>value <span class="_ _3"></span>that <span class="_ _3"></span>we <span class="_ _3"></span>speciﬁed</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
