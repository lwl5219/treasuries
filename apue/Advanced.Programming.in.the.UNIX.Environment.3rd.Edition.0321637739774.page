<div id="pf306" class="pf w4 h1f" data-page-no="306"><div class="pc pc306 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg306.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">740<span class="_ _1b"> </span><span class="ff19">Pseudo <span class="_"> </span>T<span class="_ _6"></span>erminals <span class="_ _23a"> </span>Chapter<span class="_ _4b"> </span>19</span></div><div class="t m0 x1f h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;dup2 error to stdout&quot;);</div><div class="t m0 x9d h57 y426 ff1a fs2d fc0 sc0 ls0 ws0">if (pipe[0] != STDIN_FILENO &amp;&amp; pipe[0] != STDOUT_FILENO)</div><div class="t m0 x1f h57 y800 ff1a fs2d fc0 sc0 ls0 ws0">close(pipe[0]);</div><div class="t m0 x9d h57 yae9 ff1a fs2d fc0 sc0 ls0 ws0">/* leave stderr for driver alone */</div><div class="t m0 x9d h57 yaea ff1a fs2d fc0 sc0 ls0 ws0">execlp(driver, driver, (char *)0);</div><div class="t m0 x9d h57 yaeb ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;execlp error for: %s&quot;, driver);</div><div class="t m0 x8a h57 y16f9 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 yaed ff1a fs2d fc0 sc0 ls0 ws0">close(pipe[0]); <span class="_ _15"> </span>/*<span class="_"> </span>parent */</div><div class="t m0 x8a h57 y340d ff1a fs2d fc0 sc0 ls0 ws0">if (dup2(pipe[1], STDIN_FILENO) != STDIN_FILENO)</div><div class="t m0 x9d h57 y340e ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;dup2 error to stdin&quot;);</div><div class="t m0 x8a h57 y16fa ff1a fs2d fc0 sc0 ls0 ws0">if (dup2(pipe[1], STDOUT_FILENO) != STDOUT_FILENO)</div><div class="t m0 x9d h57 y340f ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;dup2 error to stdout&quot;);</div><div class="t m0 x8a h57 y3410 ff1a fs2d fc0 sc0 ls0 ws0">if (pipe[1] != STDIN_FILENO &amp;&amp; pipe[1] != STDOUT_FILENO)</div><div class="t m0 x9d h57 y3411 ff1a fs2d fc0 sc0 ls0 ws0">close(pipe[1]);</div><div class="t m0 x8a h57 y16fe ff1a fs2d fc0 sc0 ls0 ws0">/*</div><div class="t m0 x214 h57 y16ff ff1a fs2d fc0 sc0 ls15c ws0">*P<span class="_ _1d"></span><span class="ls0">arent returns, but with stdin and stdout connected</span></div><div class="t m0 x214 h57 y3413 ff1a fs2d fc0 sc0 ls0 ws0">*<span class="_"> </span>to<span class="_"> </span>the driver.</div><div class="t m0 x214 h57 y3414 ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 x32 h57 y3415 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x234 h5e y551d ff18 fs10 fc0 sc0 ls0 ws0">Figure 19.16<span class="_ _5a"> </span><span class="ff19">The<span class="_"> </span><span class="ff1a">do_driver<span class="_ _e"> </span></span>function for the<span class="_"> </span><span class="ff1a">pty<span class="_ _e"> </span></span>program</span></div><div class="t m0 x32 h4d y551e ff19 fs26 fc0 sc0 ls0 ws0">By <span class="_ _23"> </span>writing <span class="_ _42"> </span>our <span class="_ _23"></span>own <span class="_ _23"> </span>driver <span class="_ _42"> </span>program <span class="_ _23"></span>that <span class="_ _23"></span>is <span class="_ _23"> </span>invoked <span class="_ _42"> </span>by<span class="_ _35"> </span><span class="ff1a">pty</span>,<span class="_ _35"> </span>we<span class="_ _35"> </span>can <span class="_ _23"> </span>drive <span class="_ _42"> </span>interactive</div><div class="t m0 x32 h49 y551f ff19 fs26 fc0 sc0 ls0 ws0">programs <span class="_ _53"> </span>in <span class="_ _e"> </span>any <span class="_"> </span>way <span class="_ _53"> </span>desired. <span class="_ _4b"> </span>Even<span class="_ _4b"> </span>though <span class="_"> </span>it <span class="_ _53"> </span>has <span class="_ _e"> </span>its <span class="_"> </span>standar<span class="_ _1"></span><span class="ls15de">di<span class="_ _55"></span><span class="ls0">nput <span class="_"> </span>and <span class="_ _53"> </span>standard</span></span></div><div class="t m0 x32 h4d y5520 ff19 fs26 fc0 sc0 ls0 ws0">output <span class="_ _9"></span>connected <span class="_ _9"></span>to<span class="_ _35"> </span><span class="ff1a">pty</span><span class="ls15df">,t<span class="_ _b"></span><span class="ls0">he <span class="_ _9"></span>driver <span class="_ _9"></span>process <span class="_ _9"></span>can <span class="_ _9"></span>still <span class="_ _23"></span>interact <span class="_ _9"></span>with <span class="_ _9"></span>the <span class="_ _23"></span>user <span class="_ _9"></span>by <span class="_ _9"></span>reading</span></span></div><div class="t m0 x32 h4d y5521 ff19 fs26 fc0 sc0 ls0 ws0">and <span class="_ _3"></span>writing<span class="_ _47"> </span><span class="ff1a">/dev/tty</span><span class="ls15e0">.T<span class="_ _1d"></span><span class="ls0">his <span class="_ _3"></span>solution <span class="_ _3"></span>still <span class="_ _3"></span>isn’t <span class="_ _3"></span>as <span class="_ _9"></span>general <span class="_ _3"></span>as <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">expect<span class="_ _47"> </span></span>program, <span class="_ _3"></span>but</span></span></div><div class="t m0 x32 h4d y5522 ff19 fs26 fc0 sc0 ls0 ws0">it provides a useful option to<span class="_"> </span><span class="ff1a">pty<span class="_ _80"> </span></span>for fewer than 50 lines of code.</div><div class="t m0 x35 h4b y5523 ff16 fs27 fc0 sc0 ls0 ws0">19.7 <span class="_ _93"> </span>Ad<span class="ls7a5">va</span>nced <span class="_"> </span>Features</div><div class="t m0 x32 h49 y5524 ff19 fs26 fc0 sc0 ls0 ws0">Pseudo terminals <span class="_ _2"></span>have <span class="_ _2"></span>some additional <span class="_ _2"></span>capabilities <span class="_ _2"></span>that we <span class="_ _2"></span>brieﬂy <span class="_ _2"></span>mention here. <span class="_ _66"> </span>These</div><div class="t m0 x32 h49 y5525 ff19 fs26 fc0 sc0 ls0 ws0">capabilities <span class="_ _42"> </span>ar<span class="ls15e1">ef<span class="_ _c"></span><span class="ls0">urther <span class="_ _53"> </span>documented <span class="_ _53"> </span>in <span class="_ _42"> </span>Sun <span class="_ _53"> </span>Microsystems</span></span></div><div class="t m0 x1dc h49 y5526 ff19 fs26 fc0 sc0 ls0 ws0">[</div><div class="t m0 x12c h49 y5525 ff19 fs26 fc0 sc0 ls0 ws0">2005</div><div class="t m0 x1a1 h49 y5526 ff19 fs26 fc0 sc0 ls0 ws0">]</div><div class="t m0 x168 h4d y5525 ff19 fs26 fc0 sc0 ls0 ws0">and <span class="_ _42"> </span>the <span class="_ _53"> </span>BSD<span class="_ _44"> </span><span class="ff1a">pts</span>(4)</div><div class="t m0 x32 h49 y5527 ff19 fs26 fc0 sc0 ls0 ws0">manual page.</div><div class="t m0 x35 h4c y5528 ff16 fs26 fc0 sc0 ls15e2 ws0">Pa<span class="_ _2"></span><span class="ls15e3">ck<span class="ls0">et Mode</span></span></div><div class="t m0 x32 h49 y5529 ff19 fs26 fc0 sc0 ls0 ws0">Packet <span class="_ _23"></span>mode <span class="_ _23"></span>lets <span class="_ _23"></span>the <span class="_ _23"></span>PTY <span class="_ _23"></span>master <span class="_ _23"></span>learn <span class="_ _23"></span>of <span class="_ _23"></span>state <span class="_ _23"></span>changes <span class="_ _23"></span>in <span class="_ _23"></span>the <span class="_ _23"></span>PTY <span class="_ _23"></span>slave.<span class="_ _5a"> </span>On <span class="_ _23"> </span>Solaris,</div><div class="t m0 x32 h4d y552a ff19 fs26 fc0 sc0 ls0 ws0">this mode <span class="_ _2"></span>is enabled <span class="_ _2"></span>by pushing <span class="_ _2"></span>the STREAMS <span class="_ _2"></span>module<span class="_"> </span><span class="ff1a">pckt<span class="_ _66"> </span></span>onto <span class="_ _2"></span>the PTY <span class="_ _2"></span>master <span class="_ _2"></span>side.</div><div class="t m0 x32 h49 y552b ff19 fs26 fc0 sc0 ls164 ws0">We <span class="_ _47"> </span>s<span class="_ _23"></span><span class="ls0">howed <span class="_ _23"></span>this <span class="_ _23"> </span>optional <span class="_ _42"> </span>module <span class="_ _23"></span>in <span class="_ _23"> </span>Figur<span class="ls15e4">e1<span class="_ _43"></span><span class="ls0">9.2. <span class="_ _35"> </span>On<span class="_ _35"> </span>FreeBSD, <span class="_ _23"></span>Linux, <span class="_ _23"> </span>and <span class="_ _42"> </span>Mac <span class="_ _23"> </span>OS <span class="_ _23"> </span>X,</span></span></span></div><div class="t m0 x32 h4d y552c ff19 fs26 fc0 sc0 ls0 ws0">this mode is enabled with the<span class="_"> </span><span class="ff1a">TIOCPKT <span class="_ _b"></span>ioctl<span class="_ _80"> </span><span class="ff19">command.</span></span></div><div class="t m0 x3f h49 y552d ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _9"></span>details <span class="_ _9"></span>of <span class="_ _23"></span>packet <span class="_ _9"></span>mode <span class="_ _9"></span>differ <span class="_ _9"></span>between <span class="_ _9"></span>Solaris <span class="_ _9"></span>and <span class="_ _23"></span>the <span class="_ _9"></span>other <span class="_ _9"></span>platforms.<span class="_ _5a"> </span>Under</div><div class="t m0 x32 h4d y552e ff19 fs26 fc0 sc0 ls0 ws0">Solaris, <span class="_ _23"> </span>the <span class="_ _23"> </span>process <span class="_ _23"> </span>reading <span class="_ _23"></span>the <span class="_ _23"> </span>PTY <span class="_ _42"> </span>master <span class="_ _23"></span>has <span class="_ _23"> </span>to <span class="_ _23"> </span>call<span class="_ _44"> </span><span class="ff1a">getmsg<span class="_ _35"> </span></span>to <span class="_ _23"></span>fetch <span class="_ _23"> </span>the <span class="_ _23"> </span>messages</div><div class="t m0 x32 h4d y552f ff19 fs26 fc0 sc0 ls0 ws0">from <span class="_ _9"></span>the <span class="_ _23"></span>stream <span class="_ _9"></span>head, <span class="_ _23"> </span>because <span class="_ _23"></span>the<span class="_ _35"> </span><span class="ff1a">pckt<span class="_ _45"> </span></span>module <span class="_ _23"></span>converts <span class="_ _23"></span>certain <span class="_ _9"></span>events <span class="_ _23"> </span>into <span class="_ _23"> </span>nondata</div><div class="t m0 x32 h4d y5530 ff19 fs26 fc0 sc0 ls0 ws0">STREAMS messages.<span class="_ _61"> </span><span class="ls3aa">Wi<span class="_ _3"></span></span>th <span class="_ _2"></span>the <span class="_ _2"></span>other platforms, <span class="_ _2"></span>each<span class="_ _66"> </span><span class="ff1a">read<span class="_ _47"> </span></span>from the PTY <span class="_ _2"></span>master <span class="_ _2"></span>returns</div><div class="t m0 x32 h49 y5531 ff19 fs26 fc0 sc0 lsd3 ws0">as<span class="_ _d"></span><span class="ls0">tatus byte followed by optional data.</span></div><a class="l" href="#pf13" data-dest-detail='[19,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.893467px;bottom:516.889786px;width:149.615303px;height:19.680023px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
