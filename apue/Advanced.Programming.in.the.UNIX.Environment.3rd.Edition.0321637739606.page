<div id="pf25e" class="pf w4 h1f" data-page-no="25e"><div class="pc pc25e w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg25e.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">572<span class="_ _1b"> </span><span class="ff19">Interprocess <span class="_"> </span>Communication<span class="_ _2c"> </span>Chapter <span class="_"> </span>15</span></div><div class="t m0 x76 h51 y2a3 ff19 fs2a fc0 sc0 ls0 ws0">The <span class="_ _9"> </span>Single <span class="_ _23"> </span>UNIX <span class="_ _9"> </span>Speciﬁcation <span class="_ _23"> </span>shared <span class="_ _9"></span>memory <span class="_ _23"> </span>objects <span class="_ _9"></span>option <span class="_ _23"> </span>includes <span class="_ _9"></span>alternative <span class="_ _23"> </span>interfaces,</div><div class="t m0 x76 h51 y2a4 ff19 fs2a fc0 sc0 ls0 ws0">originally real-time extensions, to access shar<span class="_ _0"></span>ed memory<span class="_ _6"></span><span class="ls10f">.W<span class="_ _4a"></span><span class="lse9">ed<span class="_ _a"></span><span class="ls0">on’t discuss them in this text.</span></span></span></div><div class="t m0 x3f h2a y4526 ff19 fsf fc0 sc0 ls5f ws0">We<span class="_ _9"></span><span class="ls0">’ve <span class="_ _9"></span>already <span class="_ _9"></span>seen <span class="_ _9"></span>one <span class="_ _9"></span>form <span class="_ _9"></span>of <span class="_ _9"></span>shared <span class="_ _9"></span>memory <span class="_ _9"></span>when <span class="_ _9"></span>multiple <span class="_ _9"></span>processes <span class="_ _3"></span>map <span class="_ _23"></span>the</span></div><div class="t m0 x32 h2a y4527 ff19 fsf fc0 sc0 ls0 ws0">same <span class="_"> </span>ﬁle <span class="_ _e"> </span>into <span class="_"> </span>their <span class="_ _e"> </span>address <span class="_ _e"> </span>spaces.<span class="_ _48"> </span>The <span class="_"> </span>XSI <span class="_"> </span>shar<span class="_ _0"></span>ed <span class="_ _e"> </span>memory <span class="_"> </span>differs <span class="_ _e"> </span>from <span class="_ _e"> </span>memory-</div><div class="t m0 x32 h2a y4528 ff19 fsf fc0 sc0 ls0 ws0">mapped <span class="_ _9"></span>ﬁles <span class="_ _23"> </span>in <span class="_ _23"></span>that <span class="_ _9"></span>there<span class="_ _45"> </span>is<span class="_ _35"> </span>n<span class="ls1bb">oa<span class="_ _b"></span><span class="ls0">ssociated <span class="_ _9"></span>ﬁle.<span class="_ _5a"> </span>The <span class="_ _23"></span>XSI <span class="_ _23"></span>shar<span class="_ _0"></span>ed <span class="_ _9"></span>memory <span class="_ _23"> </span>segments <span class="_ _23"></span>are</span></span></div><div class="t m0 x32 h2a y4529 ff19 fsf fc0 sc0 ls0 ws0">anonymous segments of memory<span class="_ _4"></span>.</div><div class="t m0 x3f h2a y452a ff19 fsf fc0 sc0 ls0 ws0">The <span class="_"> </span>kernel <span class="_"> </span>maintains <span class="_"> </span>a <span class="_"> </span>structur<span class="_ _0"></span><span class="ls1263">ew<span class="_ _4a"></span><span class="ls0">ith <span class="_"> </span>at <span class="_"> </span>least <span class="_"> </span>the <span class="_"> </span>following <span class="_"> </span>members <span class="_"> </span>for <span class="_"> </span>each</span></span></div><div class="t m0 x32 h2a y452b ff19 fsf fc0 sc0 ls0 ws0">shared memory segment:</div><div class="t m0 x3f h57 y452c ff1a fs2d fc0 sc0 ls0 ws0">struct shmid_ds {</div><div class="t m0 xf4 h57 y452d ff1a fs2d fc0 sc0 ls0 ws0">struct ipc_perm<span class="_ _d9"> </span>shm_perm; <span class="_ _87"> </span>/*<span class="_"> </span>see Section 15.6.2 */</div><div class="t m0 xf4 h57 y452e ff1a fs2d fc0 sc0 ls0 ws0">size_t <span class="_ _74"> </span>shm_segsz;<span class="_ _87"> </span>/* size of segment in bytes */</div><div class="t m0 xf4 h57 y452f ff1a fs2d fc0 sc0 ls0 ws0">pid_t <span class="_ _bd"> </span>shm_lpid;<span class="_ _15"> </span>/* pid of last shmop() */</div><div class="t m0 xf4 h57 y4530 ff1a fs2d fc0 sc0 ls0 ws0">pid_t <span class="_ _bd"> </span>shm_cpid;<span class="_ _15"> </span>/* pid of creator */</div><div class="t m0 xf4 h57 y4531 ff1a fs2d fc0 sc0 ls0 ws0">shmatt_t <span class="_ _186"> </span>shm_nattch;<span class="_ _d9"> </span>/* number of current attaches */</div><div class="t m0 xf4 h57 y4532 ff1a fs2d fc0 sc0 ls0 ws0">time_t <span class="_ _74"> </span>shm_atime;<span class="_ _87"> </span>/* last-attach time */</div><div class="t m0 xf4 h57 y4533 ff1a fs2d fc0 sc0 ls0 ws0">time_t <span class="_ _74"> </span>shm_dtime;<span class="_ _87"> </span>/* last-detach time */</div><div class="t m0 xf4 h57 y4534 ff1a fs2d fc0 sc0 ls0 ws0">time_t <span class="_ _74"> </span>shm_ctime;<span class="_ _87"> </span>/* last-change time */</div><div class="t m0 xf4 h57 y4535 ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 xf4 h57 y4536 ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 xf4 h57 y4537 ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 x3f h57 y4538 ff1a fs2d fc0 sc0 ls0 ws0">};</div><div class="t m0 x32 h2a y4539 ff19 fsf fc0 sc0 ls0 ws0">(Implementations add other structur<span class="_ _0"></span><span class="ls44">em<span class="_ _d"></span><span class="ls0">embers to support shared memory segments.)</span></span></div><div class="t m0 x3f h26 y453a ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _53"> </span>type<span class="_ _44"> </span><span class="ff1a">shmatt_t<span class="_ _4b"> </span></span>is <span class="_ _53"> </span>deﬁned <span class="_ _53"> </span>to <span class="_ _53"> </span>be <span class="_ _53"> </span>an <span class="_ _53"> </span>unsigned <span class="_ _53"> </span>integer <span class="_ _53"> </span>at <span class="_ _53"> </span>least <span class="_ _53"> </span>as <span class="_ _53"> </span>large <span class="_ _53"> </span>as <span class="_ _53"> </span>an</div><div class="t m0 x32 h26 y453b ff1a fsf fc0 sc0 ls0 ws0">unsigned <span class="_ _b"></span>short<span class="ff19 ls86">.F<span class="_ _5b"></span><span class="ls0">igur<span class="ls44">e1<span class="_ _d"></span><span class="ls0">5.30 lists the system limits that affect shared memory<span class="_ _4"></span>.</span></span></span></span></div><div class="t m0 xc h2d y453c ff19 fs10 fc0 sc0 ls277 ws0">Ty<span class="_ _3"></span><span class="ls0">pical values</span></div><div class="t m0 x109 h2e y453d ff19 fs11 fc0 sc0 ls0 ws0">FreeBSD <span class="_ _93"> </span>Linux<span class="_ _1a3"> </span>Mac OS X<span class="_ _5e"> </span>Solaris</div><div class="t m0 x1a3 h2e y453e ff19 fs11 fc0 sc0 ls0 ws0">8.0 <span class="_ _79"> </span>3.2.0<span class="_ _28"> </span>10.6.8 <span class="_ _bf"> </span>10</div><div class="t m0 x89 h2e y453f ff19 fs11 fc0 sc0 ls0 ws0">Description</div><div class="t m0 x1d9 h2f y4540 ff19 fs12 fc0 sc0 ls0 ws0">33,554,432 <span class="_ _5a"> </span>32,768<span class="_ _7f"> </span>4,194,304 <span class="_ _60"> </span>derived<span class="_ _2c2"></span>maximum size in bytes of a shared memory segment</div><div class="t m0 x1dc h2f y4541 ff19 fs12 fc0 sc0 ls1264 ws0">11 <span class="_ _1b5"></span>1<span class="_ _6"></span><span class="ls0">1<span class="_ _2c0"></span>minimum size in bytes of a shared memory segment</span></div><div class="t m0 xd7 h2f y4542 ff19 fs12 fc0 sc0 ls0 ws0">192 <span class="_ _5e"> </span>4,096<span class="_ _17e"> </span>32 <span class="_ _1c3"> </span>128<span class="_ _2c0"></span>maximum number of shar<span class="_ _0"></span>ed memory segments, systemwide</div><div class="t m0 xd7 h2f y4543 ff19 fs12 fc0 sc0 ls0 ws0">128 <span class="_ _5e"> </span>4,096<span class="_ _2c3"> </span><span class="ls1265">81<span class="_ _2c4"></span><span class="ls0">28<span class="_ _2c0"></span>maximum number of shared memory segments, per process</span></span></div><div class="t m0 x12b h30 y4544 ff18 fs13 fc0 sc0 ls0 ws0">Figure 15.30<span class="_ _5a"> </span><span class="ff19">System limits that affect shared memory</span></div><div class="t m0 x3f h64 y4545 ff19 fs31 fc0 sc0 ls0 ws0">The ﬁrst function called is usually<span class="_"> </span><span class="ff1a">shmget</span>,<span class="_"> </span>to<span class="_"> </span>obtain a shared memory identiﬁer<span class="_ _6"></span>.</div><div class="t m0 x3f h65 y4546 ff1a fs32 fc0 sc0 ls0 ws0">#include &lt;sys/shm.h&gt;</div><div class="t m0 x3f h65 y4547 ff1a fs32 fc0 sc0 ls0 ws0">int shmget(key_t<span class="_"> </span><span class="ff1b">key</span><span class="ls441">,s<span class="_ _1d"></span><span class="ls0">ize_t<span class="_"> </span><span class="ff1b">size</span><span class="ls441">,i<span class="_ _5b"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">ﬂag</span>);</span></span></span></span></div><div class="t m0 x1e7 h92 y4548 ff19 fs32 fc0 sc0 ls0 ws0">Returns: shared memory ID if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>err<span class="_ _0"></span>or</div><div class="t m0 x32 h9a y4549 ff19 fs49 fc0 sc0 ls0 ws0">In <span class="_ _42"> </span>Section <span class="_ _42"> </span>15.6.1, <span class="_ _42"> </span>we <span class="_ _42"> </span>described <span class="_ _23"> </span>the <span class="_ _42"> </span>rules <span class="_ _42"> </span>for <span class="_ _42"> </span>converting <span class="_ _42"> </span>the<span class="_ _44"> </span><span class="ff1b">key<span class="_ _35"> </span></span>into <span class="_ _42"> </span>an <span class="_ _42"> </span>identiﬁer <span class="_ _42"> </span>and</div><div class="t m0 x32 h96 y454a ff19 fs49 fc0 sc0 ls0 ws0">whether <span class="_ _23"></span>a <span class="_ _23"></span>new <span class="_ _23"></span>segment <span class="_ _23"></span>is <span class="_ _23"></span>cr<span class="_ _0"></span>eated <span class="_ _23"></span>or <span class="_ _23"></span>an <span class="_ _23"></span>existing <span class="_ _23"></span>segment <span class="_ _23"></span>is <span class="_ _23"></span>refer<span class="_ _1"></span>enced. <span class="_ _35"> </span>When<span class="_ _35"> </span><span class="ls1266">an<span class="_ _43"></span><span class="ls0">ew</span></span></div><div class="t m0 x32 h9b y454b ff19 fs49 fc0 sc0 ls0 ws0">segment is created, the following members of the<span class="_"> </span><span class="ff1a">shmid_ds<span class="_ _80"> </span></span>structur<span class="_ _0"></span><span class="ls48d">ea<span class="_ _d"></span><span class="ls4a6">re <span class="_ _2"></span>i<span class="_ _2"></span><span class="ls0">nitialized.</span></span></span></div><div class="t m0 x3f h9b y454c ff19 fs49 fc0 sc0 ls1267 ws0">•T<span class="_ _4d"></span><span class="ls0">he<span class="_ _45"> </span><span class="ff1a">ipc_perm<span class="_ _45"> </span></span>structure<span class="_ _47"> </span>is<span class="_ _45"> </span>initialized <span class="_ _23"></span>as <span class="_ _9"></span>described <span class="_ _9"></span>in <span class="_ _9"></span>Section <span class="_ _9"></span>15.6.2.<span class="_ _5a"> </span>The<span class="_ _45"> </span><span class="ff1a">mode</span></span></div><div class="t m0 x15 h9a y454d ff19 fs49 fc0 sc0 ls0 ws0">member <span class="_"> </span>of <span class="_ _e"> </span>this <span class="_"> </span>structur<span class="_ _0"></span>e<span class="_ _59"> </span>is<span class="_ _59"> </span>set <span class="_"> </span>to <span class="_"> </span>the <span class="_ _e"> </span>corresponding <span class="_ _e"> </span>permission <span class="_"> </span>bits <span class="_"> </span>of<span class="_ _4b"> </span><span class="ff1b">ﬂag</span>.</div><div class="t m0 x15 h96 y454e ff19 fs49 fc0 sc0 ls0 ws0">These permissions ar<span class="ls48d">es<span class="_ _4f"></span><span class="ls0">peciﬁed with the values from Figur<span class="ls48d">e1<span class="_ _4f"></span><span class="ls0">5.24.</span></span></span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
