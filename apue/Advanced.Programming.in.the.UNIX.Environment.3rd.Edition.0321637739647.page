<div id="pf287" class="pf w4 h1f" data-page-no="287"><div class="pc pc287 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg287.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>16.5<span class="_ _2db"> </span>Data <span class="_"> </span>T<span class="_ _6"></span>ransfer<span class="_ _1b"> </span><span class="ff18">613</span></div><div class="t m0 x3f h26 y12f ff19 fsf fc0 sc0 ls0 ws0">If we ar<span class="ls9e1">ei<span class="_ _d"></span><span class="ls0">nterested in the identity of <span class="_ _2"></span>the sender<span class="_ _1"></span><span class="ls9e1">,w<span class="_ _d"></span><span class="ls1361">ec<span class="_ _d"></span><span class="ls0">an use<span class="_"> </span><span class="ff1a">recvfrom<span class="_ _66"> </span></span>to <span class="_ _2"></span>obtain the</span></span></span></span></span></div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">source addr<span class="_ _0"></span>ess fr<span class="_ _0"></span>om which the data was sent.</div><div class="t m0 x3f h57 y1a79 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;sys/socket.h&gt;</div><div class="t m0 x3f h57 y4975 ff1a fs2d fc0 sc0 ls0 ws0">ssize_t recvfrom(int<span class="_"> </span><span class="ff1b">sockfd</span><span class="ls15c">,v<span class="_ _1d"></span><span class="ls0">oid *restrict<span class="_"> </span><span class="ff1b">buf</span><span class="ls15c">,s<span class="_ _5b"></span><span class="ls0">ize_t<span class="_"> </span><span class="ff1b">len</span><span class="ls15c">,i<span class="_ _1d"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">ﬂags</span>,</span></span></span></span></span></span></div><div class="t m0 x8b h57 y4976 ff1a fs2d fc0 sc0 ls0 ws0">struct sockaddr *restrict<span class="_"> </span><span class="ff1b">addr</span>,</div><div class="t m0 x8b h57 y4977 ff1a fs2d fc0 sc0 ls0 ws0">socklen_t *restrict<span class="_"> </span><span class="ff1b">addrlen</span>);</div><div class="t m0 x187 h5f y4978 ff19 fs2d fc0 sc0 ls0 ws0">Returns: length of message in bytes,</div><div class="t m0 xe9 h5f y4979 ff19 fs2d fc0 sc0 ls0 ws0">0<span class="_"> </span>if<span class="_"> </span>no<span class="_"> </span>messages ar<span class="ls110">ea<span class="_ _d"></span><span class="ls0">vailable and peer has done an orderly shutdown,</span></span></div><div class="t m0 x11e h5f y497a ff19 fs2d fc0 sc0 ls0 ws0">or<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h4a y497b ff19 fs26 fc0 sc0 ls0 ws0">If<span class="_"> </span><span class="ff1b">addr<span class="_"> </span></span>is non-null, it will contain <span class="_ _2"></span>the address of the socket endpoint from which the data</div><div class="t m0 x32 h4d y497c ff19 fs26 fc0 sc0 ls0 ws0">was <span class="_ _3"></span>sent.<span class="_ _61"> </span>When <span class="_ _3"></span>calling<span class="_ _45"> </span><span class="ff1a">recvfrom</span>,<span class="_ _66"> </span>we<span class="_ _45"> </span>need <span class="_ _2"></span>to <span class="_ _3"></span>set <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1b">addrlen<span class="_ _47"> </span></span>parameter <span class="_ _3"></span>to <span class="_ _3"></span>point <span class="_ _3"></span>to <span class="_ _3"></span>an</div><div class="t m0 x32 h4a y497d ff19 fs26 fc0 sc0 ls0 ws0">integer containing <span class="_ _2"></span>the <span class="_ _2"></span>size <span class="_ _2"></span>in <span class="_ _2"></span>bytes <span class="_ _2"></span>of <span class="_ _2"></span>the <span class="_ _2"></span>socket buffer <span class="_ _2"></span>to which<span class="_ _47"> </span><span class="ff1b">addr<span class="_"> </span></span>points. <span class="_ _47"> </span>On<span class="_"> </span><span class="lscc">re<span class="_ _2"></span></span>turn,</div><div class="t m0 x32 h49 y497e ff19 fs26 fc0 sc0 ls0 ws0">the integer is set to the actual size of the address in bytes.</div><div class="t m0 x3f h4d y497f ff19 fs26 fc0 sc0 ls0 ws0">Because <span class="_ _42"> </span>it <span class="_ _42"> </span>allows <span class="_ _42"> </span>us <span class="_ _42"> </span>to <span class="_ _42"> </span>retrieve <span class="_ _42"> </span>the <span class="_ _42"> </span>addr<span class="_ _0"></span>ess <span class="_ _42"> </span>of <span class="_ _42"> </span>the <span class="_ _42"> </span>sender<span class="_ _1"></span>,<span class="_ _35"> </span><span class="ff1a">recvfrom<span class="_ _44"> </span></span>is <span class="_ _42"> </span>typically</div><div class="t m0 x32 h4d y4980 ff19 fs26 fc0 sc0 ls0 ws0">used with connectionless sockets.<span class="_ _59"> </span>Otherwise,<span class="_"> </span><span class="ff1a">recvfrom<span class="_ _66"> </span></span>behaves identically to<span class="_"> </span><span class="ff1a">recv</span>.</div><div class="t m0 x3f h4d y4981 ff19 fs26 fc0 sc0 ls164 ws0">To <span class="_ _80"> </span>r<span class="_ _9"></span><span class="ls0">eceive <span class="_ _3"></span>data <span class="_ _3"></span>into <span class="_ _3"></span>multiple <span class="_ _3"></span>buffers, <span class="_ _3"></span>similar <span class="_ _3"></span>to<span class="_ _47"> </span><span class="ff1a">readv<span class="_ _47"> </span></span>(Section <span class="_ _3"></span>14.6), <span class="_ _9"></span>or <span class="_ _3"></span>if <span class="_ _3"></span>we <span class="_ _3"></span>want</span></div><div class="t m0 x32 h4d y4982 ff19 fs26 fc0 sc0 ls0 ws0">to receive ancillary data (Section 17.4), we can use<span class="_"> </span><span class="ff1a">recvmsg</span>.</div><div class="t m0 x3f h4e y4983 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;sys/socket.h&gt;</div><div class="t m0 x3f h4e y4984 ff1a fs28 fc0 sc0 ls0 ws0">ssize_t recvmsg(int<span class="_"> </span><span class="ff1b">sockfd</span><span class="ls1b6">,s<span class="_ _1d"></span><span class="ls0">truct msghdr *<span class="ff1b">msg</span><span class="ls1b6">,i<span class="_ _5b"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">ﬂags</span>);</span></span></span></span></div><div class="t m0 x187 h7c y4985 ff19 fs28 fc0 sc0 ls0 ws0">Returns: length of message in bytes,</div><div class="t m0 xe9 h7c y4986 ff19 fs28 fc0 sc0 ls0 ws0">0<span class="_"> </span>if<span class="_"> </span>no<span class="_"> </span>messages ar<span class="ls396">ea<span class="_ _d"></span><span class="ls0">vailable and peer has done an orderly shutdown,</span></span></div><div class="t m0 x11e h7c y4987 ff19 fs28 fc0 sc0 ls0 ws0">or<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h54 y4988 ff19 fs2c fc0 sc0 ls0 ws0">The<span class="_ _4b"> </span><span class="ff1a">msghdr<span class="_ _4b"> </span></span>structur<span class="ls1176">e(<span class="_ _55"></span><span class="ls0">which <span class="_ _e"> </span>we <span class="_ _e"> </span>saw <span class="_ _e"> </span>used <span class="_ _e"> </span>with<span class="_ _4b"> </span><span class="ff1a">sendmsg</span>)<span class="_ _4b"> </span>is<span class="_ _59"> </span>used <span class="_ _53"> </span>by<span class="_ _59"> </span><span class="ff1a">recvmsg<span class="_ _4b"> </span></span>to</span></span></div><div class="t m0 x32 h60 y4989 ff19 fs2c fc0 sc0 ls0 ws0">specify the <span class="_ _2"></span>input <span class="_ _2"></span>buffers to be <span class="_ _2"></span>used <span class="_ _2"></span>to receive the <span class="_ _2"></span>data.<span class="_ _61"> </span><span class="ls155">We <span class="_ _e"> </span>c<span class="_ _9"></span></span>an <span class="_ _2"></span>set the<span class="_ _66"> </span><span class="ff1b">ﬂags<span class="_ _47"> </span></span>ar<span class="_ _0"></span>gument to</div><div class="t m0 x32 h54 y498a ff19 fs2c fc0 sc0 ls0 ws0">change <span class="_ _66"> </span>the <span class="_ _47"> </span>default <span class="_ _47"> </span>behavior <span class="_ _66"> </span>of<span class="_ _61"> </span><span class="ff1a">recvmsg</span><span class="ls1362">.O<span class="_ _49"></span><span class="ls1363">nr<span class="_ _1d"></span><span class="ls0">eturn, <span class="_ _47"> </span>the<span class="_ _46"> </span><span class="ff1a">msg_flags<span class="_ _16"> </span></span>ﬁeld <span class="_ _66"> </span>of <span class="_ _47"> </span>the</span></span></span></div><div class="t m0 x32 h54 y498b ff1a fs2c fc0 sc0 ls0 ws0">msghdr<span class="_ _44"> </span><span class="ff19">structure<span class="_ _35"> </span>is<span class="_ _4b"> </span>set <span class="_ _42"> </span>to <span class="_ _53"> </span>indicate <span class="_ _53"> </span>various <span class="_ _42"> </span>characteristics <span class="_ _53"> </span>of <span class="_ _53"> </span>the <span class="_ _42"> </span>data <span class="_ _53"> </span>received. <span class="_ _44"> </span>(The</span></div><div class="t m0 x32 h54 y498c ff1a fs2c fc0 sc0 ls0 ws0">msg_flags<span class="_ _47"> </span><span class="ff19">ﬁeld <span class="_ _3"></span>is <span class="_ _2"></span>ignored <span class="_ _3"></span>on <span class="_ _3"></span>entry <span class="_ _3"></span>to<span class="_ _47"> </span></span>recvmsg<span class="ff19">.) <span class="_ _47"> </span>The<span class="_ _47"> </span>possible <span class="_ _3"></span>values <span class="_ _3"></span>on <span class="_ _3"></span>return <span class="_ _2"></span>from</span></div><div class="t m0 x32 h54 y498d ff1a fs2c fc0 sc0 ls0 ws0">recvmsg<span class="_ _47"> </span><span class="ff19">ar<span class="ls1364">es<span class="_ _b"></span><span class="ls0">ummarized <span class="_ _9"></span>in <span class="_ _9"></span>Figur<span class="ls1364">e1<span class="_ _b"></span><span class="ls0">6.15. <span class="_ _47"> </span>W<span class="_ _6"></span>e’ll <span class="_ _9"></span>see <span class="_ _9"></span>an <span class="_ _3"></span>example <span class="_ _9"></span>that <span class="_ _9"></span>uses<span class="_ _47"> </span><span class="ff1a">recvmsg<span class="_ _45"> </span></span>in</span></span></span></span></span></div><div class="t m0 x32 h55 y498e ff19 fs2c fc0 sc0 ls0 ws0">Chapter 17.</div><div class="t m0 x6d h2f y498f ff19 fs12 fc0 sc0 ls0 ws0">FreeBSD <span class="_ _141"> </span>Linux<span class="_ _3a"> </span>Mac OS X<span class="_ _7f"> </span>Solaris</div><div class="t m0 x1af h2f y4990 ff19 fs12 fc0 sc0 ls0 ws0">8.0 <span class="_ _215"> </span>3.2.0<span class="_ _76"> </span>10.6.8 <span class="_ _bf"> </span>10</div><div class="t m0 x215 h2f y4991 ff19 fs12 fc0 sc0 ls0 ws0">Flag<span class="_ _166"> </span>Description<span class="_ _2d2"> </span>POSIX.1</div><div class="t m0 x2c h63 y4992 ff1a fs13 fc0 sc0 ls0 ws0">MSG_CTRUNC<span class="_ _2c9"> </span><span class="ff19 ls9c8">•••••<span class="_ _2d5"></span><span class="ls0">Contr<span class="_ _0"></span>ol data was truncated.</span></span></div><div class="t m0 x2c h63 y4993 ff1a fs13 fc0 sc0 ls0 ws0">MSG_EOR<span class="_ _2da"> </span><span class="ff19 ls9c8">•••••<span class="_ _2d5"></span><span class="ls0">End of r<span class="_ _0"></span>ecor<span class="ls673">dw<span class="_ _5"></span><span class="ls0">as received.</span></span></span></span></div><div class="t m0 x2c h63 y4994 ff1a fs13 fc0 sc0 ls0 ws0">MSG_ERRQUEUE<span class="_ _112"> </span><span class="ff19">•<span class="_ _2d3"></span>Error information was r<span class="_ _0"></span>eceived</span></div><div class="t m0 x180 h30 y4995 ff19 fs13 fc0 sc0 ls0 ws0">as ancillary data.</div><div class="t m0 x2c h63 y4996 ff1a fs13 fc0 sc0 ls0 ws0">MSG_OOB<span class="_ _2da"> </span><span class="ff19 ls9c8">•••••<span class="_ _2d5"></span><span class="ls0">Out-of-band data was r<span class="_ _0"></span>eceived.</span></span></div><div class="t m0 x2c h63 y4997 ff1a fs13 fc0 sc0 ls0 ws0">MSG_TRUNC<span class="_ _2ac"> </span><span class="ff19 ls9c8">•••••<span class="_ _2dc"></span><span class="ls0">Normal data was truncated.</span></span></div><div class="t m0 xea h6f y4998 ff18 fs14 fc0 sc0 ls0 ws0">Figure 16.15<span class="_ _5a"> </span><span class="ff19">Flags returned in<span class="_"> </span><span class="ff1a">msg_flags<span class="_ _53"> </span></span>by<span class="_"> </span><span class="ff1a">recvmsg</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
