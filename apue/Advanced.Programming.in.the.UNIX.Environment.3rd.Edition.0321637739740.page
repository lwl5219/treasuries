<div id="pf2e4" class="pf w4 h1f" data-page-no="2e4"><div class="pc pc2e4 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg2e4.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">706<span class="_ _1b"> </span><span class="ff19 ls719">Te<span class="_ _9"></span><span class="ls0">rminal <span class="_"> </span>I/O<span class="_ _eb"> </span>Chapter <span class="_"> </span>18</span></span></div><div class="t m0 x9d h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">/*</div><div class="t m0 x175 h57 y426 ff1a fs2d fc0 sc0 ls15c ws0">*O<span class="_ _1d"></span><span class="ls0">nly some of the changes were made.<span class="_ _3a"> </span>Restore the</span></div><div class="t m0 x175 h57 y800 ff1a fs2d fc0 sc0 ls15c ws0">*o<span class="_ _1d"></span><span class="ls0">riginal settings.</span></div><div class="t m0 x175 h57 y801 ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 x9d h57 y802 ff1a fs2d fc0 sc0 ls0 ws0">tcsetattr(fd, TCSAFLUSH, &amp;save_termios);</div><div class="t m0 x9d h57 y803 ff1a fs2d fc0 sc0 ls0 ws0">errno = EINVAL;</div><div class="t m0 x9d h57 y804 ff1a fs2d fc0 sc0 ls0 ws0">return(-1);</div><div class="t m0 x8a h57 y805 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y124f ff1a fs2d fc0 sc0 ls0 ws0">ttystate = CBREAK;</div><div class="t m0 x8a h57 y1250 ff1a fs2d fc0 sc0 ls0 ws0">ttysavefd = fd;</div><div class="t m0 x8a h57 y8d8 ff1a fs2d fc0 sc0 ls0 ws0">return(0);</div><div class="t m0 x32 h57 y8d9 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h57 y31b9 ff1a fs2d fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h57 y31ba ff1a fs2d fc0 sc0 ls0 ws0">tty_raw(int fd)<span class="_ _8a"> </span>/* put terminal into a raw mode */</div><div class="t m0 x32 h57 y31bb ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y2f71 ff1a fs2d fc0 sc0 ls0 ws0">int <span class="_ _82"> </span>err;</div><div class="t m0 x8a h57 y2f72 ff1a fs2d fc0 sc0 ls0 ws0">struct termios<span class="_ _d9"> </span>buf;</div><div class="t m0 x8a h57 y3814 ff1a fs2d fc0 sc0 ls0 ws0">if (ttystate != RESET) {</div><div class="t m0 x9d h57 y16eb ff1a fs2d fc0 sc0 ls0 ws0">errno = EINVAL;</div><div class="t m0 x9d h57 y16ec ff1a fs2d fc0 sc0 ls0 ws0">return(-1);</div><div class="t m0 x8a h57 y8e2 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y8e3 ff1a fs2d fc0 sc0 ls0 ws0">if (tcgetattr(fd, &amp;buf) &lt; 0)</div><div class="t m0 x9d h57 y8e4 ff1a fs2d fc0 sc0 ls0 ws0">return(-1);</div><div class="t m0 x8a h57 y8e5 ff1a fs2d fc0 sc0 ls0 ws0">save_termios = buf; /* structure copy */</div><div class="t m0 x8a h57 y38c0 ff1a fs2d fc0 sc0 ls0 ws0">/*</div><div class="t m0 x214 h57 y38c1 ff1a fs2d fc0 sc0 ls15c ws0">*E<span class="_ _1d"></span><span class="ls0">cho off, canonical mode off, extended input</span></div><div class="t m0 x214 h57 y42b5 ff1a fs2d fc0 sc0 ls15c ws0">*p<span class="_ _1d"></span><span class="ls0">rocessing off, signal chars off.</span></div><div class="t m0 x214 h57 y3f7e ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 x8a h57 y3f7f ff1a fs2d fc0 sc0 ls0 ws0">buf.c_lflag &amp;= ˜(ECHO | ICANON | IEXTEN | ISIG);</div><div class="t m0 x8a h57 y38c5 ff1a fs2d fc0 sc0 ls0 ws0">/*</div><div class="t m0 x214 h57 y42b6 ff1a fs2d fc0 sc0 ls0 ws0">*<span class="_"> </span>No<span class="_"> </span>SIGINT on BREAK, CR-to-NL off, input parity</div><div class="t m0 x214 h57 y42b7 ff1a fs2d fc0 sc0 ls15c ws0">*c<span class="_ _1d"></span><span class="ls0">heck off, don’t strip 8th bit on input, output</span></div><div class="t m0 x214 h57 y42b8 ff1a fs2d fc0 sc0 ls15c ws0">*f<span class="_ _1d"></span><span class="ls0">low control off.</span></div><div class="t m0 x214 h57 y42b9 ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 x8a h57 y42ba ff1a fs2d fc0 sc0 ls0 ws0">buf.c_iflag &amp;= ˜(BRKINT | ICRNL | INPCK | ISTRIP | IXON);</div><div class="t m0 x8a h57 y338d ff1a fs2d fc0 sc0 ls0 ws0">/*</div><div class="t m0 x214 h57 y338e ff1a fs2d fc0 sc0 ls15c ws0">*C<span class="_ _1d"></span><span class="ls0">lear size bits, parity checking off.</span></div><div class="t m0 x214 h57 y342a ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 x8a h57 y342b ff1a fs2d fc0 sc0 ls0 ws0">buf.c_cflag &amp;= ˜(CSIZE | PARENB);</div><div class="t m0 x8a h57 y4ddf ff1a fs2d fc0 sc0 ls0 ws0">/*</div><div class="t m0 x214 h57 y4de0 ff1a fs2d fc0 sc0 ls15c ws0">*S<span class="_ _1d"></span><span class="ls0">et 8 bits/char.</span></div><div class="t m0 x214 h57 y51ef ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 x8a h57 y51f0 ff1a fs2d fc0 sc0 ls0 ws0">buf.c_cflag |= CS8;</div><div class="t m0 x8a h57 y4de2 ff1a fs2d fc0 sc0 ls0 ws0">/*</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
