<div id="pf2f6" class="pf w4 h1f" data-page-no="2f6"><div class="pc pc2f6 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg2f6.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">724<span class="_ _1b"> </span><span class="ff19">Pseudo <span class="_"> </span>T<span class="_ _6"></span>erminals <span class="_ _23a"> </span>Chapter<span class="_ _4b"> </span>19</span></div><div class="t m0 x76 h52 y2a3 ff19 fs2a fc0 sc0 ls0 ws0">On <span class="_ _9"></span>FreeBSD,<span class="_ _66"> </span><span class="ff1a">grantpt<span class="_ _66"> </span></span>and<span class="_ _47"> </span><span class="ff1a">unlockpt<span class="_ _66"> </span></span>do <span class="_ _9"></span>nothing <span class="_ _9"></span>other <span class="_ _3"></span>than <span class="_ _9"> </span>argument <span class="_ _9"></span>validation; <span class="_ _9"></span>the <span class="_ _3"></span>PTYs</div><div class="t m0 x76 h51 y2a4 ff19 fs2a fc0 sc0 ls0 ws0">ar<span class="ls159a">ec<span class="_ _1d"></span><span class="ls34e">re<span class="ls0">ated <span class="_ _45"> </span>dynamically <span class="_ _45"> </span>with <span class="_ _45"> </span>the <span class="_ _45"> </span>correct <span class="_ _45"> </span>permissions.<span class="_ _48"> </span>Note <span class="_ _45"> </span>that <span class="_ _45"> </span>FreeBSD <span class="_ _47"> </span>deﬁnes <span class="_ _45"> </span>the</span></span></span></div><div class="t m0 x76 h52 y2a5 ff1a fs2a fc0 sc0 ls0 ws0">O_NOCTTY<span class="_ _45"> </span><span class="ff19">ﬂag <span class="_ _23"> </span>only <span class="_ _42"> </span>for <span class="_ _23"> </span>compatibility <span class="_ _42"> </span>with <span class="_ _23"> </span>applications <span class="_ _42"> </span>that <span class="_ _23"> </span>call<span class="_ _45"> </span></span>posix_openpt<span class="ff19 ls159b">.F<span class="_ _1d"></span><span class="ls34e">re<span class="_ _2"></span><span class="ls0">eBSD</span></span></span></div><div class="t m0 x76 h51 y2a6 ff19 fs2a fc0 sc0 ls0 ws0">does <span class="_ _23"> </span>not <span class="_ _9"></span>allocate <span class="_ _23"> </span>a <span class="_ _23"> </span>controlling <span class="_ _9"></span>terminal <span class="_ _23"> </span>as <span class="_ _9"> </span>a <span class="_ _23"> </span>side <span class="_ _23"> </span>effect <span class="_ _9"></span>of <span class="_ _23"> </span>opening <span class="_ _23"> </span>a <span class="_ _9"> </span>terminal <span class="_ _23"> </span>device, <span class="_ _23"> </span>so <span class="_ _9"> </span>the</div><div class="t m0 x76 h52 y2a7 ff1a fs2a fc0 sc0 ls0 ws0">O_NOCTTY<span class="_ _53"> </span><span class="ff19">ﬂag has no effect.</span></div><div class="t m0 x1ef h2d y5391 ff19 fs10 fc0 sc0 ls0 ws0">FreeBSD <span class="_"> </span>Linux <span class="_"> </span>Mac<span class="_"> </span>OS X<span class="_ _35"> </span>Solaris</div><div class="t m0 x118 h2d y5392 ff19 fs10 fc0 sc0 ls0 ws0">8.0 <span class="_ _d8"> </span>3.2.0<span class="_ _1bb"> </span>10.6.8 <span class="_ _9c"> </span>10</div><div class="t m0 x90 h2d y5393 ff19 fs10 fc0 sc0 ls0 ws0">Function<span class="_ _39"> </span>Description<span class="_ _1a"> </span>XSI</div><div class="t m0 xb8 h4f y5394 ff1a fs11 fc0 sc0 ls0 ws0">grantpt<span class="_ _9f"> </span><span class="ff19">change permissions of slave PTY device<span class="_ _1c3"> </span><span class="ls159c">••<span class="_ _b"></span><span class="ls1446">•• <span class="_ _a7"></span>•</span></span></span></div><div class="t m0 xb8 h4f y5395 ff1a fs11 fc0 sc0 ls0 ws0">posix_openpt<span class="_ _6e"> </span><span class="ff19">open a master PTY device<span class="_ _82"> </span><span class="ls159c">••<span class="_ _b"></span><span class="ls1446">•• <span class="_ _a7"></span>•</span></span></span></div><div class="t m0 xb8 h4f y5396 ff1a fs11 fc0 sc0 ls0 ws0">ptsname<span class="_ _9f"> </span><span class="ff19 ls293">re<span class="ls0">turn name of slave PTY device<span class="_ _77"> </span><span class="ls159c">••<span class="_ _b"></span><span class="ls1446">•• <span class="_ _a7"></span>•</span></span></span></span></div><div class="t m0 xb8 h4f y5397 ff1a fs11 fc0 sc0 ls0 ws0">unlockpt<span class="_ _10b"> </span><span class="ff19">allow slave PTY device to be opened<span class="_ _21"> </span><span class="ls159c">••<span class="_ _b"></span><span class="ls1446">•• <span class="_ _a7"></span>•</span></span></span></div><div class="t m0 x1f7 h2f y5398 ff18 fs12 fc0 sc0 ls0 ws0">Figure 19.8<span class="_ _5a"> </span><span class="ff19">XSI pseudo terminal functions</span></div><div class="t m0 x3f h50 y5399 ff19 fs29 fc0 sc0 ls0 ws0">The <span class="_ _2"></span>Single <span class="_ _2"></span>UNIX <span class="_ _2"></span>Speciﬁcation <span class="_ _3"></span>has <span class="_ _2"></span>improved <span class="_ _2"></span>portability <span class="_ _2"></span>in <span class="_ _2"></span>this <span class="_ _2"></span>area, <span class="_ _2"></span>but <span class="_ _2"></span>differences</div><div class="t m0 x32 h5c y539a ff19 fs29 fc0 sc0 lsdf ws0">re<span class="ls0">main. <span class="_ _45"> </span>W<span class="_ _6"></span><span class="ls159d">ep<span class="_ _b"></span><span class="lsdf">ro<span class="_ _2"></span><span class="ls0">vide <span class="_ _9"></span>two <span class="_ _9"></span>functions <span class="_ _23"></span>that <span class="_ _9"></span>handle <span class="_ _9"></span>all <span class="_ _9"></span>the <span class="_ _9"></span>details:<span class="_ _45"> </span><span class="ff1a">ptym_open<span class="_ _45"> </span></span>to <span class="_ _9"></span>open <span class="_ _9"></span>the</span></span></span></span></div><div class="t m0 x32 h5c y539b ff19 fs29 fc0 sc0 ls0 ws0">next <span class="_ _e"> </span>available <span class="_ _e"> </span>PTY <span class="_"> </span>master <span class="_ _53"> </span>device <span class="_"> </span>and<span class="_ _4b"> </span><span class="ff1a">ptys_open<span class="_ _4b"> </span></span>to <span class="_"> </span>open <span class="_ _53"> </span>the <span class="_"> </span>corr<span class="_ _0"></span>esponding <span class="_ _e"> </span>slave</div><div class="t m0 x32 h50 y539c ff19 fs29 fc0 sc0 ls0 ws0">device.</div><div class="t m0 x3f h62 y539d ff1a fs30 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x3f h62 y539e ff1a fs30 fc0 sc0 ls0 ws0">int ptym_open(char *<span class="ff1b">pts_name</span><span class="ls1185">,i<span class="_ _1d"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">pts_namesz</span>);</span></span></div><div class="t m0 xf hff y539f ff19 fs30 fc0 sc0 ls0 ws0">Returns: ﬁle descriptor of PTY master if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x3f h62 y53a0 ff1a fs30 fc0 sc0 ls0 ws0">int ptys_open(char *<span class="ff1b">pts_name</span>);</div><div class="t m0 xd hff y53a1 ff19 fs30 fc0 sc0 ls0 ws0">Returns: ﬁle descriptor of PTY slave if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h64 y53a2 ff19 fs31 fc0 sc0 ls0 ws0">Normally<span class="_ _4"></span>,<span class="_ _44"> </span>we<span class="_ _35"> </span>don’t <span class="_ _23"> </span>call <span class="_ _42"> </span>these <span class="_ _23"> </span>two <span class="_ _42"> </span>functions <span class="_ _42"> </span>dir<span class="_ _0"></span>ectly; <span class="_ _23"> </span>instead, <span class="_ _42"> </span>the <span class="_ _42"> </span>function<span class="_ _35"> </span><span class="ff1a">pty_fork</span></div><div class="t m0 x32 h64 y53a3 ff19 fs31 fc0 sc0 ls0 ws0">(Section 19.4) calls them and also<span class="_"> </span><span class="ff1a">fork</span><span class="ls229">sac<span class="_ _d"></span><span class="ls0">hild process.</span></span></div><div class="t m0 x3f h64 y53a4 ff19 fs31 fc0 sc0 ls0 ws0">The<span class="_ _4b"> </span><span class="ff1a">ptym_open<span class="_ _4b"> </span></span>function <span class="_ _53"> </span>opens <span class="_ _e"> </span>the <span class="_ _53"> </span>next <span class="_ _e"> </span>available <span class="_ _53"> </span>PTY <span class="_ _e"> </span>master<span class="_ _1"></span><span class="ls159e">.T<span class="_ _64"></span><span class="ls0">he <span class="_ _e"> </span>caller <span class="_ _53"> </span>must</span></span></div><div class="t m0 x32 h6e y53a5 ff19 fs31 fc0 sc0 ls0 ws0">allocate <span class="_ _42"> </span>an <span class="_ _42"> </span>array <span class="_ _42"> </span>to <span class="_ _42"> </span>hold <span class="_ _42"> </span>the <span class="_ _42"> </span>name <span class="_ _42"> </span>of <span class="_ _42"> </span>the <span class="_ _42"> </span>slave; <span class="_ _42"> </span>if <span class="_ _42"> </span>the <span class="_ _53"> </span>call <span class="_ _42"> </span>succeeds, <span class="_ _42"> </span>the <span class="_ _42"> </span>name <span class="_ _42"> </span>of <span class="_ _42"> </span>the</div><div class="t m0 x32 h79 y53a6 ff19 fs31 fc0 sc0 ls0 ws0">corresponding <span class="_ _45"> </span>slave <span class="_ _35"> </span>is <span class="_ _35"> </span>returned <span class="_ _45"> </span>through<span class="_ _5a"> </span><span class="ff1b">pts_name</span><span class="ls159f">.T<span class="_ _95"></span><span class="ls0">his <span class="_ _35"> </span>name <span class="_ _45"> </span>is <span class="_ _35"> </span>then <span class="_ _35"> </span>passed <span class="_ _35"> </span>to</span></span></div><div class="t m0 x32 h64 y53a7 ff1a fs31 fc0 sc0 ls0 ws0">ptys_open<span class="ff19 ls15a0">,w<span class="_ _b"></span><span class="ls0">hich <span class="_ _9"></span>opens <span class="_ _9"></span>the <span class="_ _3"></span>slave <span class="_ _9"></span>device.<span class="_ _5a"> </span>The <span class="_ _9"></span>length <span class="_ _3"></span>of <span class="_ _9"></span>the <span class="_ _9"></span>buffer <span class="_ _3"></span>in <span class="_ _9"></span>bytes <span class="_ _3"></span>is <span class="_ _9"></span>passed</span></span></div><div class="t m0 x32 h64 y53a8 ff19 fs31 fc0 sc0 ls0 ws0">in<span class="_ _47"> </span><span class="ff1b">pts_namesz<span class="_ _45"> </span></span>so <span class="_ _3"></span>that <span class="_ _9"></span>the<span class="_ _47"> </span><span class="ff1a">ptym_open<span class="_ _45"> </span></span>function <span class="_ _3"></span>doesn’t <span class="_ _3"></span>copy <span class="_ _9"></span>a <span class="_ _3"></span>string <span class="_ _9"></span>that <span class="_ _3"></span>is <span class="_ _9"></span>longer <span class="_ _3"></span>than</div><div class="t m0 x32 h6e y53a9 ff19 fs31 fc0 sc0 ls0 ws0">the buffer<span class="_ _6"></span>.</div><div class="t m0 x3f h6e y53aa ff19 fs31 fc0 sc0 ls0 ws0">The <span class="_ _47"> </span>reason <span class="_"> </span>for <span class="_ _47"> </span>providing <span class="_ _47"> </span>two <span class="_ _66"> </span>functions <span class="_ _47"> </span>to <span class="_ _47"> </span>open <span class="_ _47"> </span>the <span class="_ _47"> </span>two <span class="_ _47"> </span>devices <span class="_ _47"> </span>will <span class="_ _66"> </span>become</div><div class="t m0 x32 h64 y53ab ff19 fs31 fc0 sc0 ls0 ws0">obvious <span class="_ _3"></span>when <span class="_ _2"></span>we <span class="_ _3"></span>show <span class="_ _3"></span>the<span class="_ _45"> </span><span class="ff1a">pty_fork<span class="_ _66"> </span></span>function. <span class="_ _45"> </span>Normally<span class="_ _4"></span><span class="ls15a1">,ap<span class="_ _8"></span><span class="ls225">ro<span class="_ _2"></span><span class="ls0">cess <span class="_ _3"></span>calls<span class="_ _47"> </span><span class="ff1a">ptym_open</span></span></span></span></div><div class="t m0 x32 h64 y53ac ff19 fs31 fc0 sc0 ls0 ws0">to <span class="_ _3"></span>open <span class="_ _9"></span>the <span class="_ _3"></span>master <span class="_ _9"></span>and <span class="_ _3"></span>obtain <span class="_ _9"></span>the <span class="_ _3"></span>name <span class="_ _9"></span>of <span class="_ _3"></span>the <span class="_ _9"></span>slave.<span class="_ _16"> </span>The <span class="_ _3"></span>process <span class="_ _3"></span>then<span class="_ _45"> </span><span class="ff1a">fork</span>s, <span class="_ _3"></span>and <span class="_ _9"></span>the</div><div class="t m0 x32 h64 y53ad ff19 fs31 fc0 sc0 ls0 ws0">child calls<span class="_"> </span><span class="ff1a">ptys_open<span class="_ _66"> </span></span>to open the slave after calling<span class="_"> </span><span class="ff1a">setsid<span class="_ _66"> </span></span>to establish a new <span class="_ _2"></span>session.</div><div class="t m0 x32 h6e y53ae ff19 fs31 fc0 sc0 ls0 ws0">This is how the slave becomes the controlling terminal for the child.</div><div class="t m0 x32 hc1 y53af ff1a fs69 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 hc1 y53b0 ff1a fs69 fc0 sc0 ls0 ws0">#include &lt;errno.h&gt;</div><div class="t m0 x32 hc1 y53b1 ff1a fs69 fc0 sc0 ls0 ws0">#include &lt;fcntl.h&gt;</div><div class="t m0 x32 hc1 y53b2 ff1a fs69 fc0 sc0 ls0 ws0">#if defined(SOLARIS)</div><div class="t m0 x32 hc1 y53b3 ff1a fs69 fc0 sc0 ls0 ws0">#include &lt;stropts.h&gt;</div><div class="t m0 x32 hc1 y53b4 ff1a fs69 fc0 sc0 ls0 ws0">#endif</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
