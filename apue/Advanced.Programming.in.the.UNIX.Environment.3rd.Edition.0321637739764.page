<div id="pf2fc" class="pf w4 h1f" data-page-no="2fc"><div class="pc pc2fc w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg2fc.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">730<span class="_ _1b"> </span><span class="ff19">Pseudo <span class="_"> </span>T<span class="_ _6"></span>erminals <span class="_ _23a"> </span>Chapter<span class="_ _4b"> </span>19</span></div><div class="t m0 x8a h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">struct termios<span class="_ _d9"> </span>orig_termios;</div><div class="t m0 x8a h57 y426 ff1a fs2d fc0 sc0 ls0 ws0">struct winsize<span class="_ _d9"> </span>size;</div><div class="t m0 x8a h57 y8f7 ff1a fs2d fc0 sc0 ls0 ws0">interactive = isatty(STDIN_FILENO);</div><div class="t m0 x8a h57 yae9 ff1a fs2d fc0 sc0 ls0 ws0">ignoreeof = 0;</div><div class="t m0 x8a h57 yaea ff1a fs2d fc0 sc0 ls0 ws0">noecho = 0;</div><div class="t m0 x8a h57 yaeb ff1a fs2d fc0 sc0 ls0 ws0">verbose = 0;</div><div class="t m0 x8a h57 y16f9 ff1a fs2d fc0 sc0 ls0 ws0">driver = NULL;</div><div class="t m0 x8a h57 yaed ff1a fs2d fc0 sc0 ls0 ws0">opterr = 0;<span class="_ _8a"> </span>/* don’t want getopt() writing to stderr */</div><div class="t m0 x8a h57 y340d ff1a fs2d fc0 sc0 ls0 ws0">while ((c = getopt(argc, argv, OPTSTR)) != EOF) {</div><div class="t m0 x9d h57 y340e ff1a fs2d fc0 sc0 ls0 ws0">switch (c) {</div><div class="t m0 x9d h57 y16fa ff1a fs2d fc0 sc0 ls0 ws0">case ’d’:<span class="_ _b7"> </span>/* driver for stdin/stdout */</div><div class="t m0 x1f h57 y340f ff1a fs2d fc0 sc0 ls0 ws0">driver = optarg;</div><div class="t m0 x1f h57 y3410 ff1a fs2d fc0 sc0 ls0 ws0">break;</div><div class="t m0 x9d h57 y16fd ff1a fs2d fc0 sc0 ls0 ws0">case ’e’:<span class="_ _b7"> </span>/* noecho for slave pty’s line discipline */</div><div class="t m0 x1f h57 y16fe ff1a fs2d fc0 sc0 ls0 ws0">noecho = 1;</div><div class="t m0 x1f h57 y16ff ff1a fs2d fc0 sc0 ls0 ws0">break;</div><div class="t m0 x9d h57 y1316 ff1a fs2d fc0 sc0 ls0 ws0">case ’i’:<span class="_ _b7"> </span>/* ignore EOF on standard input */</div><div class="t m0 x1f h57 y1317 ff1a fs2d fc0 sc0 ls0 ws0">ignoreeof = 1;</div><div class="t m0 x1f h57 y1318 ff1a fs2d fc0 sc0 ls0 ws0">break;</div><div class="t m0 x9d h57 y23d3 ff1a fs2d fc0 sc0 ls0 ws0">case ’n’:<span class="_ _b7"> </span>/* not interactive */</div><div class="t m0 x1f h57 y3358 ff1a fs2d fc0 sc0 ls0 ws0">interactive = 0;</div><div class="t m0 x1f h57 y1700 ff1a fs2d fc0 sc0 ls0 ws0">break;</div><div class="t m0 x9d h57 y5418 ff1a fs2d fc0 sc0 ls0 ws0">case ’v’:<span class="_ _b7"> </span>/* verbose */</div><div class="t m0 x1f h57 y5419 ff1a fs2d fc0 sc0 ls0 ws0">verbose = 1;</div><div class="t m0 x1f h57 y541a ff1a fs2d fc0 sc0 ls0 ws0">break;</div><div class="t m0 x9d h57 y541b ff1a fs2d fc0 sc0 ls0 ws0">case ’?’:</div><div class="t m0 x1f h57 y541c ff1a fs2d fc0 sc0 ls0 ws0">err_quit(&quot;unrecognized option: -%c&quot;, optopt);</div><div class="t m0 x9d h57 y541d ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y541e ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y541f ff1a fs2d fc0 sc0 ls0 ws0">if (optind &gt;= argc)</div><div class="t m0 x9d h57 y3ac6 ff1a fs2d fc0 sc0 ls0 ws0">err_quit(&quot;usage: pty [ -d driver -einv ] program [ arg ... ]&quot;);</div><div class="t m0 x8a h57 y3510 ff1a fs2d fc0 sc0 ls0 ws0">if (interactive) {<span class="_ _d9"> </span>/* fetch current termios and window size */</div><div class="t m0 x9d h57 y3511 ff1a fs2d fc0 sc0 ls0 ws0">if (tcgetattr(STDIN_FILENO, &amp;orig_termios) &lt; 0)</div><div class="t m0 x1f h57 y3512 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;tcgetattr error on stdin&quot;);</div><div class="t m0 x9d h57 y3513 ff1a fs2d fc0 sc0 ls0 ws0">if (ioctl(STDIN_FILENO, TIOCGWINSZ, (char *) &amp;size) &lt; 0)</div><div class="t m0 x1f h57 y3514 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;TIOCGWINSZ error&quot;);</div><div class="t m0 x9d h57 y170d ff1a fs2d fc0 sc0 ls0 ws0">pid = pty_fork(&amp;fdm, slave_name, sizeof(slave_name),</div><div class="t m0 x76 h57 y3acc ff1a fs2d fc0 sc0 ls0 ws0">&amp;orig_termios, &amp;size);</div><div class="t m0 x8a h57 y132d ff1a fs2d fc0 sc0 ls15c ws0">}e<span class="_ _1d"></span><span class="ls0">lse {</span></div><div class="t m0 x9d h57 y132e ff1a fs2d fc0 sc0 ls0 ws0">pid = pty_fork(&amp;fdm, slave_name, sizeof(slave_name),</div><div class="t m0 x76 h57 y132f ff1a fs2d fc0 sc0 ls0 ws0">NULL, NULL);</div><div class="t m0 x8a h57 y1330 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y5420 ff1a fs2d fc0 sc0 ls0 ws0">if (pid &lt; 0) {</div><div class="t m0 x9d h57 y5421 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;fork error&quot;);</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
