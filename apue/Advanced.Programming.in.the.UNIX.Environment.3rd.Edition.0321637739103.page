<div id="pf67" class="pf w4 h1f" data-page-no="67"><div class="pc pc67 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg67.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h7a ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>3.6<span class="_ _16b"> </span><span class="ff1a">lseek<span class="_ _4b"> </span></span>Function<span class="_ _1b"> </span><span class="ff18">69</span></div><div class="t m0 x8a h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">if (lseek(fd, 16384, SEEK_SET) == -1)</div><div class="t m0 x9d h57 y426 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;lseek error&quot;);</div><div class="t m0 x8a h57 y800 ff1a fs2d fc0 sc0 ls0 ws0">/* offset now = 16384 */</div><div class="t m0 x8a h57 yae9 ff1a fs2d fc0 sc0 ls0 ws0">if (write(fd, buf2, 10) != 10)</div><div class="t m0 x9d h57 yaea ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;buf2 write error&quot;);</div><div class="t m0 x8a h57 yaeb ff1a fs2d fc0 sc0 ls0 ws0">/* offset now = 16394 */</div><div class="t m0 x8a h57 yaec ff1a fs2d fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h57 yaed ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x13c h2d yaee ff18 fs10 fc0 sc0 ls0 ws0">Figure 3.2<span class="_ _5a"> </span><span class="ff19">Create a ﬁle with a hole in it</span></div><div class="t m0 x32 h49 yaef ff19 fs26 fc0 sc0 ls0 ws0">Running this program gives us</div><div class="t m0 x3f h4e yaf0 ff1a fs28 fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">./a.out</span></div><div class="t m0 x3f h4e yaf1 ff1a fs28 fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">ls -l file.hole<span class="_ _c7"> </span><span class="ff1b">check its size</span></span></div><div class="t m0 x3f h4e yaf2 ff1a fs28 fc0 sc0 ls0 ws0">-rw-r--r-- <span class="_"> </span>1<span class="_"> </span>sar <span class="_ _88"> </span>16394<span class="_"> </span>Nov 25 01:01 file.hole</div><div class="t m0 x3f h4e yaf3 ff1a fs28 fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">od -c file.hole<span class="_ _c7"> </span><span class="ff1b">let’<span class="_ _0"></span><span class="ls396">sl<span class="_ _5"></span><span class="ls0">ook at the actual contents</span></span></span></span></div><div class="t m0 x3f h4e yaf4 ff1a fs28 fc0 sc0 ls0 ws0">0000000 <span class="_ _d9"> </span>a<span class="_ _3a"> </span><span class="ls397">bcdefghij<span class="_ _5b"></span><span class="ls0">\0 \0 \0 \0 \0 \0</span></span></div><div class="t m0 x3f h4e yaf5 ff1a fs28 fc0 sc0 ls0 ws0">0000020 <span class="_"> </span>\0<span class="_"> </span>\0 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0</div><div class="t m0 x3f h4e yaf6 ff1a fs28 fc0 sc0 ls0 ws0">*</div><div class="t m0 x3f h4e yaf7 ff1a fs28 fc0 sc0 ls0 ws0">0040000 <span class="_ _d9"> </span>A<span class="_ _3a"> </span><span class="ls397">BCDEFGHIJ</span></div><div class="t m0 x3f h4e yaf8 ff1a fs28 fc0 sc0 ls0 ws0">0040012</div><div class="t m0 x32 h4d yaf9 ff19 fs26 fc0 sc0 ls164 ws0">We <span class="_ _53"> </span>u<span class="_ _9"></span><span class="ls0">se <span class="_ _2"></span>the<span class="_"> </span><span class="ff1a">od</span></span></div><div class="t m0 x1d h49 yafa ff19 fs26 fc0 sc0 ls0 ws0">(</div><div class="t m0 x148 h49 yaf9 ff19 fs26 fc0 sc0 ls0 ws0">1</div><div class="t m0 x6 h49 yafa ff19 fs26 fc0 sc0 ls0 ws0">)</div><div class="t m0 x143 h4d yaf9 ff19 fs26 fc0 sc0 ls0 ws0">command to <span class="_ _2"></span>look at <span class="_ _2"></span>the contents <span class="_ _2"></span>of the ﬁle.<span class="_ _61"> </span>The<span class="_"> </span><span class="ff1a">-c<span class="_ _66"> </span></span>ﬂag <span class="_ _2"></span>tells it <span class="_ _2"></span>to print</div><div class="t m0 x32 h49 yafb ff19 fs26 fc0 sc0 ls0 ws0">the <span class="_ _9"></span>contents <span class="_ _9"></span>as <span class="_ _9"></span>characters.<span class="_ _5a"> </span><span class="ls164">We <span class="_ _66"> </span>c<span class="_ _23"></span></span>an <span class="_ _9"></span>see <span class="_ _9"></span>that <span class="_ _9"></span>the <span class="_ _9"></span>unwritten <span class="_ _9"></span>bytes <span class="_ _9"></span>in <span class="_ _9"></span>the <span class="_ _23"></span>middle <span class="_ _9"></span>ar<span class="ls398">er<span class="_ _43"></span><span class="ls0">ead</span></span></div><div class="t m0 x32 h49 yafc ff19 fs26 fc0 sc0 ls0 ws0">back <span class="_ _3"></span>as <span class="_ _3"></span>zero. <span class="_ _47"> </span>The<span class="_ _45"> </span>seven-digit <span class="_ _2"></span>number <span class="_ _9"></span>at <span class="_ _3"></span>the <span class="_ _3"></span>beginning <span class="_ _9"></span>of <span class="_ _3"></span>each <span class="_ _3"></span>line <span class="_ _3"></span>is <span class="_ _9"></span>the <span class="_ _3"></span>byte <span class="_ _3"></span>offset <span class="_ _3"></span>in</div><div class="t m0 x32 h49 yafd ff19 fs26 fc0 sc0 ls0 ws0">octal.</div><div class="t m0 x3f h49 yafe ff19 fs26 fc0 sc0 ls164 ws0">To <span class="_ _66"> </span>p<span class="_ _9"></span><span class="lscc">ro<span class="ls0">ve <span class="_ _9"></span>that <span class="_ _9"></span>there<span class="_ _45"> </span>is<span class="_ _47"> </span>really <span class="_ _3"></span>a <span class="_ _9"></span>hole <span class="_ _9"></span>in <span class="_ _9"></span>the <span class="_ _9"></span>ﬁle, <span class="_ _9"></span>let’s <span class="_ _9"></span>compar<span class="ls399">et<span class="_ _b"></span><span class="ls0">he <span class="_ _3"></span>ﬁle <span class="_ _9"></span>we <span class="_ _9"></span>just <span class="_ _9"></span>created</span></span></span></span></div><div class="t m0 x32 h49 yaff ff19 fs26 fc0 sc0 ls0 ws0">with a ﬁle of the same size, but without holes:</div><div class="t m0 x3f h4e yb00 ff1a fs28 fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">ls -ls file.hole file.nohole<span class="_ _15"> </span><span class="ff1b">compar<span class="ls396">es<span class="_ _d"></span><span class="ls0">izes</span></span></span></span></div><div class="t m0 xf4 h4e yb01 ff1a fs28 fc0 sc0 ls1b6 ws0">8-<span class="_ _1d"></span><span class="ls0">rw-r--r-- <span class="_"> </span>1<span class="_"> </span>sar <span class="_ _88"> </span>16394<span class="_"> </span>Nov 25 01:01 file.hole</span></div><div class="t m0 x90 h4e yb02 ff1a fs28 fc0 sc0 ls0 ws0">20 -rw-r--r--<span class="_ _d9"> </span><span class="ls1b6">1s<span class="_ _5b"></span><span class="ls0">ar <span class="_ _88"> </span>16394<span class="_"> </span>Nov 25 01:03 file.nohole</span></span></div><div class="t m0 x32 h49 yb03 ff19 fs26 fc0 sc0 ls0 ws0">Although <span class="_ _23"></span>both <span class="_ _9"></span>ﬁles <span class="_ _23"> </span>ar<span class="ls39a">et<span class="_ _43"></span><span class="ls0">he <span class="_ _23"> </span>same <span class="_ _23"></span>size, <span class="_ _23"></span>the <span class="_ _9"></span>ﬁle <span class="_ _23"></span>without <span class="_ _23"></span>holes <span class="_ _9"></span>consumes <span class="_ _23"> </span>20 <span class="_ _23"></span>disk <span class="_ _23"></span>blocks,</span></span></div><div class="t m0 x32 h49 yb04 ff19 fs26 fc0 sc0 ls0 ws0">whereas the ﬁle with holes consumes only 8 blocks.</div><div class="t m0 x3f h4d yb05 ff19 fs26 fc0 sc0 ls0 ws0">In <span class="_ _23"></span>this <span class="_ _23"></span>example, <span class="_ _9"></span>we <span class="_ _23"> </span>call <span class="_ _23"> </span>the<span class="_ _35"> </span><span class="ff1a">write<span class="_ _45"> </span></span>function <span class="_ _23"> </span>(Section <span class="_ _23"> </span>3.8).<span class="_ _51"> </span><span class="ls164">We<span class="_ _9"></span></span>’ll <span class="_ _23"></span>have <span class="_ _23"></span>more<span class="_ _45"> </span>to<span class="_ _35"> </span>say</div><div class="t m0 x32 h49 yb06 ff19 fs26 fc0 sc0 ls0 ws0">about ﬁles with holes in Section 4.12.</div><div class="t m0 x3f h54 yb07 ff19 fs2c fc0 sc0 ls0 ws0">Because <span class="_ _46"> </span>the <span class="_ _46"> </span>offset <span class="_ _46"> </span>address <span class="_ _59"> </span>that<span class="_ _50"> </span><span class="ff1a">lseek<span class="_ _60"> </span></span>uses <span class="_ _61"> </span>is <span class="_ _46"> </span>repr<span class="_ _0"></span>esented <span class="_ _46"> </span>by <span class="_ _46"> </span>an<span class="_ _50"> </span><span class="ff1a">off_t</span>,</div><div class="t m0 x32 h55 yb08 ff19 fs2c fc0 sc0 ls0 ws0">implementations ar<span class="ls39b">ea<span class="_ _4f"></span><span class="ls0">llowed <span class="_ _2"></span>to support <span class="_ _2"></span>whatever size <span class="_ _2"></span>is appropriate on <span class="_ _2"></span>their particular</span></span></div><div class="t m0 x32 h55 yb09 ff19 fs2c fc0 sc0 ls0 ws0">platform. <span class="_"> </span>Most<span class="_ _66"> </span>platforms <span class="_ _2"></span>today provide two <span class="_ _2"></span>sets of <span class="_ _2"></span>interfaces to <span class="_ _2"></span>manipulate <span class="_ _2"></span>ﬁle offsets:</div><div class="t m0 x32 h55 yb0a ff19 fs2c fc0 sc0 ls0 ws0">one set that uses 32</div><div class="t m0 x1b h55 yb0b ff19 fs2c fc0 sc0 ls0 ws0">-</div><div class="t m0 xf0 h55 yb0a ff19 fs2c fc0 sc0 ls0 ws0">bit ﬁle offsets and another set that uses 64</div><div class="t m0 x133 h55 yb0b ff19 fs2c fc0 sc0 ls0 ws0">-</div><div class="t m0 x155 h55 yb0a ff19 fs2c fc0 sc0 ls0 ws0">bit ﬁle offsets.</div><div class="t m0 x3f h55 yb0c ff19 fs2c fc0 sc0 ls0 ws0">The <span class="_ _3"></span>Single <span class="_ _3"></span>UNIX <span class="_ _9"></span>Speciﬁcation <span class="_ _3"></span>provides <span class="_ _3"></span>a <span class="_ _9"></span>way <span class="_ _3"></span>for <span class="_ _3"></span>applications <span class="_ _9"></span>to <span class="_ _3"></span>determine <span class="_ _9"></span>which</div><div class="t m0 x32 h54 yb0d ff19 fs2c fc0 sc0 ls0 ws0">environments <span class="_ _9"></span>ar<span class="ls39c">es<span class="_ _43"></span><span class="ls0">upported <span class="_ _23"> </span>through <span class="_ _9"></span>the<span class="_ _35"> </span><span class="ff1a">sysconf<span class="_ _45"> </span></span>function <span class="_ _23"> </span>(Section <span class="_ _23"></span>2.5.4).<span class="_ _51"> </span>Figur<span class="_ _0"></span><span class="ls39c">e3<span class="_ _b"></span><span class="ls0">.3</span></span></span></span></div><div class="t m0 x32 h54 yb0e ff19 fs2c fc0 sc0 ls0 ws0">summarizes the<span class="_"> </span><span class="ff1a">sysconf<span class="_ _80"> </span></span>constants that ar<span class="ls142">ed<span class="_ _d"></span><span class="ls0">eﬁned.</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
