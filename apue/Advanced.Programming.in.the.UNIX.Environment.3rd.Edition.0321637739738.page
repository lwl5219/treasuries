<div id="pf2e2" class="pf w4 h1f" data-page-no="2e2"><div class="pc pc2e2 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg2e2.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">704<span class="_ _1b"> </span><span class="ff19 ls719">Te<span class="_ _9"></span><span class="ls0">rminal <span class="_"> </span>I/O<span class="_ _eb"> </span>Chapter <span class="_"> </span>18</span></span></div><div class="t m0 x3f h2a y12f ff19 fsf fc0 sc0 ls0 ws0">Case C:<span class="_ _59"> </span>MIN == 0, TIME &gt; 0</div><div class="t m0 x52 h26 y51aa ff19 fsf fc0 sc0 ls0 ws0">TIME <span class="_ _3"></span>speciﬁes <span class="_ _3"></span>a <span class="_ _3"></span>read <span class="_ _3"></span>timer <span class="_ _3"></span>that <span class="_ _9"></span>is <span class="_ _3"></span>started <span class="_ _3"></span>when<span class="_ _47"> </span><span class="ff1a">read<span class="_ _45"> </span></span>is <span class="_ _3"></span>called.<span class="_ _16"> </span>(Compar<span class="lscb8">et<span class="_ _b"></span><span class="ls0">his</span></span></div><div class="t m0 x52 h2a y1f0a ff19 fsf fc0 sc0 ls0 ws0">to case <span class="_ _2"></span>A, <span class="_ _2"></span>in <span class="_ _2"></span>which <span class="_ _2"></span>a <span class="_ _2"></span>nonzer<span class="ls1512">oT<span class="_ _4f"></span><span class="ls0">IME represented an <span class="_ _2"></span>interbyte <span class="_ _2"></span>timer <span class="_ _2"></span>that was <span class="_ _2"></span>not</span></span></div><div class="t m0 x52 h26 y3194 ff19 fsf fc0 sc0 ls0 ws0">started <span class="_ _3"></span>until <span class="_ _9"></span>the <span class="_ _3"></span>ﬁrst <span class="_ _3"></span>byte <span class="_ _9"></span>was <span class="_ _3"></span>received.) <span class="_ _47"> </span>The<span class="_ _45"> </span><span class="ff1a">read<span class="_ _47"> </span></span><span class="ls45">re<span class="_ _2"></span></span>turns <span class="_ _3"></span>when <span class="_ _9"></span>a <span class="_ _3"></span>single <span class="_ _3"></span>byte</div><div class="t m0 x52 h26 y284b ff19 fsf fc0 sc0 ls0 ws0">is received or when the timer expir<span class="_ _0"></span>es. <span class="_"> </span>If<span class="_"> </span>the timer expir<span class="_ _0"></span>es,<span class="_"> </span><span class="ff1a">read<span class="_ _80"> </span></span><span class="ls45">re<span class="_ _2"></span></span>turns 0.</div><div class="t m0 x3f h2a y2a2c ff19 fsf fc0 sc0 ls0 ws0">Case D:<span class="_ _59"> </span>MIN == 0, TIME == 0</div><div class="t m0 x52 h26 y504c ff19 fsf fc0 sc0 ls0 ws0">If <span class="_ _3"></span>some <span class="_ _3"></span>data <span class="_ _3"></span>is <span class="_ _3"></span>available,<span class="_ _47"> </span><span class="ff1a">read<span class="_ _47"> </span></span><span class="ls45">re<span class="_ _2"></span></span>turns <span class="_ _3"></span>up <span class="_ _3"></span>to <span class="_ _3"></span>the <span class="_ _3"></span>number <span class="_ _3"></span>of <span class="_ _3"></span>bytes <span class="_ _3"></span>requested. <span class="_ _47"> </span>If</div><div class="t m0 x52 h26 y504d ff19 fsf fc0 sc0 ls0 ws0">no data is available,<span class="_"> </span><span class="ff1a">read<span class="_ _80"> </span></span><span class="ls45">re<span class="_ _2"></span></span>turns 0 immediately<span class="_ _4"></span>.</div><div class="t m0 x32 h2a y44fe ff19 fsf fc0 sc0 ls0 ws0">Realize <span class="_ _23"></span>in <span class="_ _9"></span>all <span class="_ _23"> </span>these <span class="_ _23"> </span>cases <span class="_ _23"></span>that <span class="_ _23"></span>MIN <span class="_ _9"></span>is <span class="_ _23"> </span>only <span class="_ _23"> </span>a <span class="_ _23"></span>minimum.<span class="_ _51"> </span>If <span class="_ _9"></span>the <span class="_ _23"> </span>program <span class="_ _23"></span>r<span class="_ _0"></span>equests <span class="_ _23"></span>more</div><div class="t m0 x32 h2a y44ff ff19 fsf fc0 sc0 ls0 ws0">than <span class="_ _9"></span>MIN <span class="_ _9"></span>bytes <span class="_ _23"></span>of <span class="_ _9"></span>data, <span class="_ _9"></span>it’s <span class="_ _23"></span>possible <span class="_ _9"></span>to <span class="_ _9"></span>receive <span class="_ _9"></span>up <span class="_ _9"></span>to <span class="_ _9"></span>the <span class="_ _23"></span>requested <span class="_ _3"></span>amount.<span class="_ _51"> </span>This <span class="_ _9"></span>also</div><div class="t m0 x32 h2a ya25 ff19 fsf fc0 sc0 ls0 ws0">applies to cases C and D, in which MIN is 0.</div><div class="t m0 x3f h2b ya26 ff19 fsf fc0 sc0 ls0 ws0">Figur<span class="ls1513">e1<span class="_ _4f"></span><span class="ls0">8.19 summarizes the <span class="_ _2"></span>four cases for noncanonical input.<span class="_ _46"> </span>In <span class="_ _2"></span>this ﬁgure,<span class="_"> </span><span class="ff1b">nbytes</span></span></span></div><div class="t m0 x32 h26 ya27 ff19 fsf fc0 sc0 ls0 ws0">is the thir<span class="ls44">da<span class="_ _4f"></span><span class="ls45">rg<span class="_ _2"></span><span class="ls0">ument to<span class="_"> </span><span class="ff1a">read<span class="_ _80"> </span></span>(the maximum number of bytes to return).</span></span></span></div><div class="t m0 x11b h51 ydc0 ff19 fs2a fc0 sc0 ls0 ws0">MIN <span class="_"> </span>&gt; <span class="_"> </span>0<span class="_ _10d"> </span>MIN <span class="_"> </span>== <span class="_"> </span>0</div><div class="t m0 x79 h2d y51ab ff19 fs10 fc0 sc0 ls0 ws0">TIME <span class="_"> </span>&gt; <span class="_"> </span>0</div><div class="t m0 x4 h5e y51ac ff18 fs10 fc0 sc0 ls0 ws0">A:<span class="_"> </span><span class="ff1a">read<span class="_ _53"> </span><span class="ff19 ls21d">re<span class="_ _2"></span><span class="ls0">turns</span></span></span></div><div class="t m0 xc7 h2d y51ad ff19 fs10 fc0 sc0 ls0 ws0">[</div><div class="t m0 x10 h77 y51ac ff19 fs10 fc0 sc0 ls0 ws0">MIN,<span class="_"> </span><span class="ff1b">nbytes</span></div><div class="t m0 xcb h2d y51ad ff19 fs10 fc0 sc0 ls0 ws0">]</div><div class="t m0 x6b h2d y51ae ff19 fs10 fc0 sc0 ls0 ws0">befor<span class="ls136">et<span class="_ _5"></span><span class="ls0">imer expires;</span></span></div><div class="t m0 x134 h5e y51af ff1a fs10 fc0 sc0 ls0 ws0">read<span class="_ _53"> </span><span class="ff19 ls21d">re<span class="_ _2"></span><span class="ls0">turns [1, MIN)</span></span></div><div class="t m0 x6b h2d y51b0 ff19 fs10 fc0 sc0 ls0 ws0">if timer expires.</div><div class="t m0 x4 h2d y51b1 ff19 fs10 fc0 sc0 ls0 ws0">(TIME = interbyte timer<span class="_ _1"></span>.</div><div class="t m0 x4 h2d y51b2 ff19 fs10 fc0 sc0 ls0 ws0">Caller can block indeﬁnitely<span class="_ _6"></span>.)</div><div class="t m0 x1e1 h5e y51ac ff18 fs10 fc0 sc0 ls0 ws0">C:<span class="_"> </span><span class="ff1a">read<span class="_ _53"> </span><span class="ff19 ls21d">re<span class="_ _2"></span><span class="ls0">turns</span></span></span></div><div class="t m0 x6e h2d y51ad ff19 fs10 fc0 sc0 ls0 ws0">[</div><div class="t m0 x213 h77 y51ac ff19 fs10 fc0 sc0 ls0 ws0">1,<span class="_"> </span><span class="ff1b">nbytes</span></div><div class="t m0 x11f h2d y51ad ff19 fs10 fc0 sc0 ls0 ws0">]</div><div class="t m0 x1e8 h2d y51ae ff19 fs10 fc0 sc0 ls0 ws0">befor<span class="ls136">et<span class="_ _5"></span><span class="ls0">imer expires;</span></span></div><div class="t m0 xb4 h5e y51af ff1a fs10 fc0 sc0 ls0 ws0">read<span class="_ _53"> </span><span class="ff19 ls21d">re<span class="_ _2"></span><span class="ls0">turns 0</span></span></div><div class="t m0 x1e8 h2d y51b0 ff19 fs10 fc0 sc0 ls0 ws0">if timer expires.</div><div class="t m0 x1e1 h5e y51b1 ff19 fs10 fc0 sc0 ls0 ws0">(TIME =<span class="_"> </span><span class="ff1a">read<span class="_ _53"> </span></span>timer<span class="_ _1"></span>.)</div><div class="t m0 x79 h2e y51b3 ff19 fs11 fc0 sc0 ls0 ws0">TIME <span class="_"> </span>== <span class="_"> </span>0</div><div class="t m0 x4 h4f y51b4 ff18 fs11 fc0 sc0 ls0 ws0">B<span class="ff19">:<span class="_"> </span><span class="ff1a">read<span class="_ _53"> </span></span><span class="ls293">re<span class="_ _2"></span></span>turns</span></div><div class="t m0 x1b7 h2e y51b5 ff19 fs11 fc0 sc0 ls0 ws0">[</div><div class="t m0 x157 h56 y51b4 ff19 fs11 fc0 sc0 ls0 ws0">MIN,<span class="_"> </span><span class="ff1b">nbytes</span></div><div class="t m0 x113 h2e y51b5 ff19 fs11 fc0 sc0 ls0 ws0">]</div><div class="t m0 x6b h2e y51b3 ff19 fs11 fc0 sc0 ls0 ws0">when available.</div><div class="t m0 x4 h2e y51b6 ff19 fs11 fc0 sc0 ls0 ws0">(Caller can block indeﬁnitely<span class="_ _6"></span>.)</div><div class="t m0 x1e1 h4f y51b4 ff18 fs11 fc0 sc0 ls0 ws0">D<span class="ff19">:<span class="_"> </span><span class="ff1a">read<span class="_ _53"> </span></span><span class="ls293">re<span class="_ _2"></span></span>turns</span></div><div class="t m0 xc9 h2e y51b5 ff19 fs11 fc0 sc0 ls0 ws0">[</div><div class="t m0 x43 h56 y51b4 ff19 fs11 fc0 sc0 ls0 ws0">0,<span class="_"> </span><span class="ff1b">nbytes</span></div><div class="t m0 x16b h2e y51b5 ff19 fs11 fc0 sc0 ls0 ws0">]</div><div class="t m0 x1e8 h2e y51b3 ff19 fs11 fc0 sc0 ls0 ws0">immediately<span class="_ _6"></span>.</div><div class="t m0 x217 h2f y5fa ff18 fs12 fc0 sc0 ls0 ws0">Figure 18.19<span class="_ _5a"> </span><span class="ff19">Four cases for noncanonical input</span></div><div class="t m0 x76 h6d y51b7 ff19 fs12 fc0 sc0 ls0 ws0">Be awar<span class="ls1514">et<span class="_ _5"></span><span class="ls0">hat POSIX.1 allows <span class="_ _2"></span>the subscripts<span class="_"> </span><span class="ff1a">VMIN<span class="_ _e"> </span></span>and<span class="_"> </span><span class="ff1a">VTIME<span class="_ _e"> </span></span>to <span class="_ _2"></span>have the same values as<span class="_ _e"> </span><span class="ff1a">VEOF</span></span></span></div><div class="t m0 x76 h6d y51b8 ff19 fs12 fc0 sc0 ls0 ws0">and<span class="_ _44"> </span><span class="ff1a">VEOL</span><span class="ls1515">,r<span class="_ _c"></span><span class="ls0">espectively<span class="_ _6"></span><span class="ls1516">.I<span class="_ _7"></span><span class="ls0">ndeed, <span class="_ _80"> </span>Solaris <span class="_ _80"> </span>does <span class="_ _80"> </span>this <span class="_ _66"> </span>for <span class="_ _80"> </span>backwar<span class="ls1517">dc<span class="_ _55"></span><span class="ls0">ompatibility <span class="_ _80"> </span>with <span class="_ _80"> </span>older</span></span></span></span></span></span></div><div class="t m0 x76 h2f y51b9 ff19 fs12 fc0 sc0 ls0 ws0">versions <span class="_ _44"> </span>of <span class="_ _35"> </span>System <span class="_ _44"> </span>V<span class="_ _6"></span><span class="ls1518">.T<span class="_ _56"></span><span class="ls0">his <span class="_ _44"> </span>creates <span class="_ _44"> </span>a <span class="_ _35"> </span>portability <span class="_ _44"> </span>problem, <span class="_ _44"> </span>however<span class="_ _6"></span><span class="ls1519">.I<span class="_ _49"></span><span class="ls151a">ng<span class="_ _7"></span><span class="ls0">oing <span class="_ _44"> </span>from</span></span></span></span></span></div><div class="t m0 x76 h6d y51ba ff19 fs12 fc0 sc0 ls0 ws0">noncanonical to <span class="_ _2"></span>canonical mode, <span class="_ _2"></span>we must <span class="_ _2"></span>now <span class="_ _2"></span>restor<span class="_ _0"></span>e<span class="_"> </span><span class="ff1a">VEOF<span class="_ _e"> </span></span>and<span class="_ _80"> </span><span class="ff1a">VEOL<span class="_ _e"> </span></span>as <span class="_ _2"></span>well.<span class="_ _44"> </span>If<span class="_"> </span><span class="ff1a">VMIN<span class="_ _80"> </span></span>equals</div><div class="t m0 x76 h6d y51bb ff1a fs12 fc0 sc0 ls0 ws0">VEOF<span class="_ _35"> </span><span class="ff19">and <span class="_"> </span>we <span class="_"> </span>don’t <span class="_"> </span>r<span class="_ _1"></span>estor<span class="ls151b">et<span class="_ _43"></span><span class="ls0">heir <span class="_"> </span>values, <span class="_"> </span>when <span class="_"> </span>we <span class="_ _42"> </span>set<span class="_ _35"> </span><span class="ff1a">VMIN<span class="_ _44"> </span></span>to <span class="_"> </span>its <span class="_ _42"> </span>typical <span class="_"> </span>value <span class="_"> </span>of <span class="_"> </span>1, <span class="_ _42"> </span>the</span></span></span></div><div class="t m0 x76 h2f y51bc ff19 fs12 fc0 sc0 ls0 ws0">end-of-ﬁle <span class="_ _9"></span>character <span class="_ _3"></span>becomes <span class="_ _9"> </span>Control</div><div class="t m0 x1e7 h2f y51bd ff19 fs12 fc0 sc0 ls0 ws0">-</div><div class="t m0 x92 h2f y51bc ff19 fs12 fc0 sc0 ls0 ws0">A. <span class="_ _66"> </span>The<span class="_ _47"> </span>easiest <span class="_ _3"></span>way <span class="_ _9"> </span>around <span class="_ _9"></span>this <span class="_ _9"></span>problem <span class="_ _3"></span>is <span class="_ _9"></span>to <span class="_ _9"></span>save <span class="_ _9"></span>the</div><div class="t m0 x76 h6d y51be ff19 fs12 fc0 sc0 ls0 ws0">entire<span class="_"> </span><span class="ff1a">termios<span class="_ _80"> </span></span>structur<span class="ls151c">ew<span class="_ _d"></span><span class="ls0">hen <span class="_ _3"></span>going <span class="_ _2"></span>into <span class="_ _2"></span>noncanonical <span class="_ _2"></span>mode <span class="_ _2"></span>and <span class="_ _2"></span>restore<span class="_ _e"> </span>it<span class="_ _80"> </span>when <span class="_ _2"></span>going <span class="_ _3"></span>back</span></span></div><div class="t m0 x76 h2f y51bf ff19 fs12 fc0 sc0 ls0 ws0">to canonical mode.</div><div class="t m0 x35 h5a y51c0 ff16 fs29 fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h5c y51c1 ff19 fs29 fc0 sc0 ls0 ws0">The <span class="_ _3"></span>program <span class="_ _9"></span>in <span class="_ _3"></span>Figur<span class="ls151d">e1<span class="_ _b"></span><span class="ls0">8.20 <span class="_ _9"></span>deﬁnes <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">tty_cbreak<span class="_ _47"> </span></span>and<span class="_ _45"> </span><span class="ff1a">tty_raw<span class="_ _45"> </span></span>functions <span class="_ _3"></span>that <span class="_ _9"></span>set</span></span></div><div class="t m0 x32 h5b y51c2 ff19 fs29 fc0 sc0 ls0 ws0">the <span class="_ _42"> </span>terminal <span class="_ _53"> </span>in<span class="_ _44"> </span><span class="ff1b">cbreak <span class="_ _42"> </span>mode<span class="_ _4b"> </span></span>and<span class="_ _44"> </span><span class="ff1b">raw <span class="_ _42"> </span>mode</span><span class="ls151e">.(<span class="_ _52"></span><span class="ls0">The <span class="_ _53"> </span>terms<span class="_ _44"> </span><span class="ff1b">cbreak<span class="_ _44"> </span></span>and<span class="_ _44"> </span><span class="ff1b">raw<span class="_ _44"> </span></span>come <span class="_ _53"> </span>from <span class="_ _42"> </span>the</span></span></div><div class="t m0 x32 h50 y51c3 ff19 fs29 fc0 sc0 lsde ws0">Ve<span class="_ _23"></span><span class="ls0">rsion 7 terminal driver<span class="_ _1"></span>.) <span class="_"> </span>W<span class="_ _6"></span><span class="ls151f">ec<span class="_ _d"></span><span class="ls0">an reset the terminal to its <span class="_ _2"></span>original state (the state before</span></span></span></div><div class="t m0 x32 h5c y51c4 ff19 fs29 fc0 sc0 ls0 ws0">either of these functions was called) by calling the function<span class="_"> </span><span class="ff1a">tty_reset</span>.</div><div class="t m0 x3f h5c y51c5 ff19 fs29 fc0 sc0 ls0 ws0">If <span class="_ _3"></span>we’ve <span class="_ _9"></span>called<span class="_ _45"> </span><span class="ff1a">tty_cbreak</span>,<span class="_ _45"> </span>we<span class="_ _47"> </span>need <span class="_ _9"></span>to <span class="_ _9"></span>call<span class="_ _45"> </span><span class="ff1a">tty_reset<span class="_ _47"> </span></span>befor<span class="ls1520">ec<span class="_ _b"></span><span class="ls0">alling<span class="_ _45"> </span><span class="ff1a">tty_raw</span>.</span></span></div><div class="t m0 x32 h5c y51c6 ff19 fs29 fc0 sc0 ls0 ws0">The <span class="_"> </span>same <span class="_ _66"> </span>goes <span class="_ _66"> </span>for <span class="_ _66"> </span>calling<span class="_ _46"> </span><span class="ff1a">tty_cbreak<span class="_ _61"> </span></span>after <span class="_"> </span>calling<span class="_ _61"> </span><span class="ff1a">tty_raw</span><span class="ls1521">.T<span class="_ _49"></span><span class="ls0">his <span class="_"> </span>improves <span class="_"> </span>the</span></span></div><div class="t m0 x32 h50 y51c7 ff19 fs29 fc0 sc0 ls0 ws0">chances that the terminal will be left in a usable state if we encounter any errors.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
