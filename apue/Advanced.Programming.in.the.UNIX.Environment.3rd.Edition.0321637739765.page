<div id="pf2fd" class="pf w4 h1f" data-page-no="2fd"><div class="pc pc2fd w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg2fd.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h7a ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>19.5<span class="_ _30d"> </span><span class="ff1a">pty<span class="_ _4b"> </span></span>Program<span class="_ _1fb"> </span><span class="ff18">731</span></div><div class="t m0 x8a h57 y425 ff1a fs2d fc0 sc0 ls15c ws0">}e<span class="_ _1d"></span><span class="ls0">lse if (pid == 0) {<span class="_ _88"> </span>/* child */</span></div><div class="t m0 x9d h57 y426 ff1a fs2d fc0 sc0 ls0 ws0">if (noecho)</div><div class="t m0 x1f h57 y800 ff1a fs2d fc0 sc0 ls0 ws0">set_noecho(STDIN_FILENO); <span class="_ _d9"> </span>/*<span class="_"> </span>stdin is slave pty */</div><div class="t m0 x9d h57 yae9 ff1a fs2d fc0 sc0 ls0 ws0">if (execvp(argv[optind], &amp;argv[optind]) &lt; 0)</div><div class="t m0 x1f h57 yaea ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;can’t execute: %s&quot;, argv[optind]);</div><div class="t m0 x8a h57 yaeb ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 yaec ff1a fs2d fc0 sc0 ls0 ws0">if (verbose) {</div><div class="t m0 x9d h57 yaed ff1a fs2d fc0 sc0 ls0 ws0">fprintf(stderr, &quot;slave name = %s\n&quot;, slave_name);</div><div class="t m0 x9d h57 y340d ff1a fs2d fc0 sc0 ls0 ws0">if (driver != NULL)</div><div class="t m0 x1f h57 y340e ff1a fs2d fc0 sc0 ls0 ws0">fprintf(stderr, &quot;driver = %s\n&quot;, driver);</div><div class="t m0 x8a h57 y16fa ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y16fb ff1a fs2d fc0 sc0 ls0 ws0">if (interactive &amp;&amp; driver == NULL) {</div><div class="t m0 x9d h57 y16fc ff1a fs2d fc0 sc0 ls0 ws0">if (tty_raw(STDIN_FILENO) &lt; 0)<span class="_ _d9"> </span>/* user’s tty to raw mode */</div><div class="t m0 x1f h57 y16fd ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;tty_raw error&quot;);</div><div class="t m0 x9d h57 y16fe ff1a fs2d fc0 sc0 ls0 ws0">if (atexit(tty_atexit) &lt; 0)<span class="_ _8a"> </span>/* reset user’s tty on exit */</div><div class="t m0 x1f h57 y16ff ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;atexit error&quot;);</div><div class="t m0 x8a h57 y3413 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y1317 ff1a fs2d fc0 sc0 ls0 ws0">if (driver)</div><div class="t m0 x9d h57 y1318 ff1a fs2d fc0 sc0 ls0 ws0">do_driver(driver); <span class="_"> </span>/*<span class="_"> </span>changes our stdin/stdout */</div><div class="t m0 x8a h57 y23d3 ff1a fs2d fc0 sc0 ls0 ws0">loop(fdm, ignoreeof);<span class="_ _68"> </span>/* copies stdin -&gt; ptym, ptym -&gt; stdout */</div><div class="t m0 x8a h57 y5422 ff1a fs2d fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h57 y5423 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h57 y5424 ff1a fs2d fc0 sc0 ls0 ws0">static void</div><div class="t m0 x32 h57 y5425 ff1a fs2d fc0 sc0 ls0 ws0">set_noecho(int fd)<span class="_ _189"> </span>/* turn off echo (for slave pty) */</div><div class="t m0 x32 h57 y5426 ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y541b ff1a fs2d fc0 sc0 ls0 ws0">struct termios<span class="_ _d9"> </span>stermios;</div><div class="t m0 x8a h57 y5427 ff1a fs2d fc0 sc0 ls0 ws0">if (tcgetattr(fd, &amp;stermios) &lt; 0)</div><div class="t m0 x9d h57 y5428 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;tcgetattr error&quot;);</div><div class="t m0 x8a h57 y5429 ff1a fs2d fc0 sc0 ls0 ws0">stermios.c_lflag &amp;= ˜(ECHO | ECHOE | ECHOK | ECHONL);</div><div class="t m0 x8a h57 y542a ff1a fs2d fc0 sc0 ls0 ws0">/*</div><div class="t m0 x214 h57 y542b ff1a fs2d fc0 sc0 ls15c ws0">*A<span class="_ _1d"></span><span class="ls0">lso turn off NL to CR/NL mapping on output.</span></div><div class="t m0 x214 h57 y542c ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 x8a h57 y542d ff1a fs2d fc0 sc0 ls0 ws0">stermios.c_oflag &amp;= ˜(ONLCR);</div><div class="t m0 x8a h57 y542e ff1a fs2d fc0 sc0 ls0 ws0">if (tcsetattr(fd, TCSANOW, &amp;stermios) &lt; 0)</div><div class="t m0 x9d h57 y542f ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;tcsetattr error&quot;);</div><div class="t m0 x32 h57 y5430 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 xa0 h5e y5431 ff18 fs10 fc0 sc0 ls0 ws0">Figure 19.1<span class="_ _0"></span>1<span class="_ _5a"> </span><span class="ff19">The<span class="_"> </span><span class="ff1a">main<span class="_ _e"> </span></span>function for the<span class="_"> </span><span class="ff1a">pty<span class="_ _e"> </span></span>program</span></div><div class="t m0 x32 h49 y5432 ff19 fs26 fc0 sc0 ls0 ws0">In <span class="_ _9"></span>the <span class="_ _23"></span>next <span class="_ _9"></span>section, <span class="_ _23"></span>we’ll <span class="_ _9"></span>look <span class="_ _9"></span>at <span class="_ _23"></span>the <span class="_ _9"></span>various <span class="_ _23"></span>command</div><div class="t m0 x1a3 h49 y5433 ff19 fs26 fc0 sc0 ls0 ws0">-</div><div class="t m0 x1e8 h49 y5432 ff19 fs26 fc0 sc0 ls0 ws0">line <span class="_ _9"></span>options <span class="_ _23"></span>when <span class="_ _9"></span>we <span class="_ _23"></span>examine</div><div class="t m0 x32 h4d y5434 ff19 fs26 fc0 sc0 ls0 ws0">differ<span class="_ _0"></span>ent <span class="_ _2"></span>uses <span class="_ _3"></span>of <span class="_ _3"></span>the<span class="_ _45"> </span><span class="ff1a">pty<span class="_ _66"> </span></span>program. <span class="_ _47"> </span>The<span class="_ _47"> </span><span class="ff1a">getopt<span class="_ _47"> </span></span>function <span class="_ _3"></span>helps <span class="_ _3"></span>us <span class="_ _3"></span>parse <span class="_ _3"></span>command</div><div class="t m0 x17d h49 y5435 ff19 fs26 fc0 sc0 ls0 ws0">-</div><div class="t m0 x61 h49 y5434 ff19 fs26 fc0 sc0 ls0 ws0">line</div><div class="t m0 x32 h49 y5436 ff19 fs26 fc0 sc0 ls0 ws0">arguments in a <span class="_ _2"></span>consistent manner<span class="_ _1"></span><span class="ls15b7">.T<span class="_ _26"></span><span class="ls15b8">oe<span class="_ _d"></span><span class="ls0">nforce POSIX behavior <span class="_ _2"></span>on Linux <span class="_ _2"></span>systems, we <span class="_ _2"></span>set</span></span></span></div><div class="t m0 x32 h49 y5437 ff19 fs26 fc0 sc0 ls0 ws0">the ﬁrst character of the option string to a plus sign.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
