<div id="pf3bd" class="pf w4 h1f" data-page-no="3bd"><div class="pc pc3bd w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg3bd.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Appendix <span class="_"> </span>C<span class="_ _322"> </span>Chapter <span class="_"> </span>9<span class="_ _54"> </span>Solutions<span class="_ _1b"> </span><span class="ff18">923</span></div><div class="t m0 x32 h2a y12f ff18 fsf fc0 sc0 ls0 ws0">8.6<span class="_ _9b"> </span><span class="ff19">The pr<span class="_ _1"></span>ogram in Figur<span class="ls44">eC<span class="_ _d"></span><span class="ls0">.10 creates a zombie.</span></span></span></div><div class="t m0 x215 h4e y6149 ff1a fs28 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x215 h4e y614a ff1a fs28 fc0 sc0 ls0 ws0">#ifdef SOLARIS</div><div class="t m0 x215 h4e y614b ff1a fs28 fc0 sc0 ls0 ws0">#define PSCMD<span class="_ _68"> </span>&quot;ps -a -o pid,ppid,s,tty,comm&quot;</div><div class="t m0 x215 h4e y614c ff1a fs28 fc0 sc0 ls0 ws0">#else</div><div class="t m0 x215 h4e y614d ff1a fs28 fc0 sc0 ls0 ws0">#define PSCMD<span class="_ _68"> </span>&quot;ps -o pid,ppid,state,tty,command&quot;</div><div class="t m0 x215 h4e y614e ff1a fs28 fc0 sc0 ls0 ws0">#endif</div><div class="t m0 x215 h4e y614f ff1a fs28 fc0 sc0 ls0 ws0">int</div><div class="t m0 x215 h4e y6150 ff1a fs28 fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 x215 h4e y6151 ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 xc4 h4e y6152 ff1a fs28 fc0 sc0 ls0 ws0">pid_t <span class="_ _d9"> </span>pid;</div><div class="t m0 xc4 h4e y6153 ff1a fs28 fc0 sc0 ls0 ws0">if ((pid = fork()) &lt; 0)</div><div class="t m0 x206 h4e y6154 ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;fork error&quot;);</div><div class="t m0 xc4 h4e y6155 ff1a fs28 fc0 sc0 ls0 ws0">else if (pid == 0)<span class="_ _189"> </span>/* child */</div><div class="t m0 x206 h4e y6156 ff1a fs28 fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 xc4 h4e y6157 ff1a fs28 fc0 sc0 ls0 ws0">/* parent */</div><div class="t m0 xc4 h4e y6158 ff1a fs28 fc0 sc0 ls0 ws0">sleep(4);</div><div class="t m0 xc4 h4e y6159 ff1a fs28 fc0 sc0 ls0 ws0">system(PSCMD);</div><div class="t m0 xc4 h4e y615a ff1a fs28 fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x215 h4e y615b ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x3c h4f y615c ff18 fs11 fc0 sc0 ls0 ws0">Figure C.10<span class="_ _5a"> </span><span class="ff19">Create a zombie and look at its status with<span class="_"> </span><span class="ff1a">ps</span></span></div><div class="t m0 x215 h54 y615d ff19 fs2c fc0 sc0 ls0 ws0">Zombies ar<span class="ls142">eu<span class="_ _4f"></span><span class="ls0">sually designated by<span class="_"> </span><span class="ff1a">ps</span></span></span></div><div class="t m0 xcb h55 y615e ff19 fs2c fc0 sc0 ls0 ws0">(</div><div class="t m0 x216 h55 y615d ff19 fs2c fc0 sc0 ls0 ws0">1</div><div class="t m0 x74 h55 y615e ff19 fs2c fc0 sc0 ls0 ws0">)</div><div class="t m0 x179 h54 y615d ff19 fs2c fc0 sc0 ls0 ws0">with a status of<span class="_"> </span><span class="ff1a">Z</span>:</div><div class="t m0 x1a7 h5d y615f ff1a fs2f fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">./a.out</span></div><div class="t m0 x11a h5d y6160 ff1a fs2f fc0 sc0 ls0 ws0">PID <span class="_"> </span>PPID<span class="_"> </span><span class="ls395">ST<span class="_ _1d"></span><span class="ls183a">TC<span class="_ _1c2"></span><span class="ls0">OMMAND</span></span></span></div><div class="t m0 x1a7 h5d y6161 ff1a fs2f fc0 sc0 ls0 ws0">2369 <span class="_"> </span>2208<span class="_"> </span><span class="ls395">Sp<span class="_ _1d"></span><span class="ls0">ts/2 <span class="_ _87"> </span>-bash</span></span></div><div class="t m0 x1a7 h5d y6162 ff1a fs2f fc0 sc0 ls0 ws0">7230 <span class="_"> </span>2369<span class="_"> </span><span class="ls395">Sp<span class="_ _1d"></span><span class="ls0">ts/2 <span class="_ _87"> </span>./a.out</span></span></div><div class="t m0 x1a7 h5d y6163 ff1a fs2f fc0 sc0 ls0 ws0">7231 <span class="_"> </span>7230<span class="_"> </span><span class="ls395">Zp<span class="_ _1d"></span><span class="ls0">ts/2 <span class="_ _87"> </span>[a.out]<span class="_"> </span>&lt;defunct&gt;</span></span></div><div class="t m0 x1a7 h5d y6164 ff1a fs2f fc0 sc0 ls0 ws0">7232 <span class="_"> </span>7230<span class="_"> </span><span class="ls395">Sp<span class="_ _1d"></span><span class="ls0">ts/2 <span class="_ _87"> </span>sh<span class="_"> </span>-c ps -o pid,ppid,state,tty,command</span></span></div><div class="t m0 x1a7 h5d y6165 ff1a fs2f fc0 sc0 ls0 ws0">7233 <span class="_"> </span>7232<span class="_"> </span><span class="ls395">Rp<span class="_ _1d"></span><span class="ls0">ts/2 <span class="_ _87"> </span>ps<span class="_"> </span>-o pid,ppid,state,tty,command</span></span></div><div class="t m0 x35 h61 y6166 ff16 fs2c fc0 sc0 ls0 ws0">Chapter <span class="_"> </span>9</div><div class="t m0 x32 h54 y6167 ff18 fs2c fc0 sc0 ls0 ws0">9.1<span class="_ _9b"> </span><span class="ff19">The<span class="_ _4b"> </span><span class="ff1a">init<span class="_ _59"> </span></span>process <span class="_ _e"> </span>learns <span class="_"> </span>when <span class="_ _e"> </span>a <span class="_"> </span>terminal <span class="_ _e"> </span>user <span class="_"> </span>logs <span class="_ _e"> </span>out, <span class="_"> </span>because<span class="_ _4b"> </span><span class="ff1a">init<span class="_ _59"> </span></span>is <span class="_"> </span>the</span></div><div class="t m0 x215 h54 y6168 ff19 fs2c fc0 sc0 ls0 ws0">parent <span class="_ _23"> </span>of <span class="_ _42"> </span>the <span class="_ _42"> </span>login <span class="_ _42"> </span>shell <span class="_ _53"> </span>and <span class="_ _42"> </span>receives <span class="_ _23"> </span>the<span class="_ _44"> </span><span class="ff1a">SIGCHLD<span class="_ _44"> </span></span>signal <span class="_ _42"> </span>when <span class="_ _42"> </span>the <span class="_ _42"> </span>login <span class="_ _42"> </span>shell</div><div class="t m0 x215 h55 y6169 ff19 fs2c fc0 sc0 ls0 ws0">terminates.</div><div class="t m0 x215 h54 y616a ff19 fs2c fc0 sc0 ls0 ws0">For <span class="_ _3"></span>a <span class="_ _3"></span>network <span class="_ _9"></span>login, <span class="_ _3"></span>however<span class="_ _1"></span>,<span class="_ _47"> </span><span class="ff1a">init<span class="_ _45"> </span></span>is <span class="_ _3"></span>not <span class="_ _3"></span>involved.<span class="_ _5a"> </span>Instead, <span class="_ _3"></span>the <span class="_ _9"></span>login <span class="_ _3"></span>entries <span class="_ _3"></span>in</div><div class="t m0 x215 h54 y616b ff19 fs2c fc0 sc0 ls0 ws0">the<span class="_ _46"> </span><span class="ff1a">utmp<span class="_ _46"> </span></span>and<span class="_ _46"> </span><span class="ff1a">wtmp<span class="_ _46"> </span></span>Ô¨Åles, <span class="_"> </span>and <span class="_"> </span>their <span class="_"> </span>corresponding <span class="_"> </span>logout <span class="_"> </span>entries, <span class="_"> </span>ar<span class="ls183b">eu<span class="_ _5b"></span><span class="ls0">sually</span></span></div><div class="t m0 x215 h54 y616c ff19 fs2c fc0 sc0 ls0 ws0">written <span class="_ _3"></span>by <span class="_ _3"></span>the <span class="_ _9"></span>process <span class="_ _2"></span>that <span class="_ _9"></span>handles <span class="_ _3"></span>the <span class="_ _3"></span>login <span class="_ _9"></span>and <span class="_ _3"></span>detects <span class="_ _3"></span>the <span class="_ _9"></span>logout <span class="_ _3"></span>(<span class="ff1a">telnetd<span class="_ _45"> </span></span>in</div><div class="t m0 x215 h55 y616d ff19 fs2c fc0 sc0 ls0 ws0">our example).</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
