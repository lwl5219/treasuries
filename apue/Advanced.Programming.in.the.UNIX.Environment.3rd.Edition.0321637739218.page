<div id="pfda" class="pf w4 h1f" data-page-no="da"><div class="pc pcda w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bgda.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">184<span class="_ _1b"> </span><span class="ff19">System <span class="_"> </span>Data <span class="_"> </span>Files <span class="_"> </span>and <span class="_"> </span>Information<span class="_ _114"> </span>Chapter <span class="_"> </span>6</span></div><div class="t m0 x3f h57 y18e9 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;unistd.h&gt;</div><div class="t m0 x3f h57 y18ea ff1a fs2d fc0 sc0 ls0 ws0">int getgroups(int<span class="_"> </span><span class="ff1b">gidsetsize</span><span class="ls15c">,g<span class="_ _1d"></span><span class="ls0">id_t<span class="_"> </span><span class="ff1b">grouplist</span>[]);</span></span></div><div class="t m0 x1e h5f y18eb ff19 fs2d fc0 sc0 ls0 ws0">Returns: number of supplementary group IDs if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>err<span class="_ _0"></span>or</div><div class="t m0 x3f h57 y18ec ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;grp.h&gt;<span class="_ _15"> </span>/* on Linux */</div><div class="t m0 x3f h57 y18ed ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;unistd.h&gt; /* on FreeBSD, Mac OS X, and Solaris */</div><div class="t m0 x3f h57 y18ee ff1a fs2d fc0 sc0 ls0 ws0">int setgroups(int<span class="_"> </span><span class="ff1b">ngroups</span><span class="ls15c">,c<span class="_ _1d"></span><span class="ls0">onst gid_t<span class="_"> </span><span class="ff1b">grouplist</span>[]);</span></span></div><div class="t m0 x3f h57 y18ef ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;grp.h&gt;<span class="_ _15"> </span>/* on Linux and Solaris */</div><div class="t m0 x3f h57 y18f0 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;unistd.h&gt; /* on FreeBSD and Mac OS X */</div><div class="t m0 x3f h57 y18f1 ff1a fs2d fc0 sc0 ls0 ws0">int initgroups(const char *<span class="ff1b">username</span><span class="ls15c">,g<span class="_ _1d"></span><span class="ls0">id_t<span class="_"> </span><span class="ff1b">basegid</span>);</span></span></div><div class="t m0 x1af h5f y18f2 ff19 fs2d fc0 sc0 ls0 ws0">Both return: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>err<span class="_ _0"></span>or</div><div class="t m0 x76 h5e y18f3 ff19 fs10 fc0 sc0 ls0 ws0">Of <span class="_ _3"></span>these <span class="_ _9"></span>three <span class="_ _3"></span>functions, <span class="_ _3"></span>only<span class="_ _66"> </span><span class="ff1a">getgroups<span class="_ _47"> </span></span>is <span class="_ _3"></span>speciﬁed <span class="_ _3"></span>by <span class="_ _9"></span>POSIX.1.<span class="_ _59"> </span>Because<span class="_ _66"> </span><span class="ff1a">setgroups<span class="_ _66"> </span></span>and</div><div class="t m0 x76 h5e y18f4 ff1a fs10 fc0 sc0 ls0 ws0">initgroups<span class="_ _35"> </span><span class="ff19">ar<span class="ls7b0">ep<span class="_ _43"></span><span class="ls0">rivileged <span class="_"> </span>operations, <span class="_"> </span>they <span class="_"> </span>ar<span class="ls7b0">en<span class="_ _c"></span><span class="ls0">ot <span class="_"> </span>part <span class="_"> </span>of <span class="_"> </span>POSIX.1.<span class="_ _5a"> </span>All <span class="_"> </span>four <span class="_"> </span>platforms</span></span></span></span></span></div><div class="t m0 x76 h77 y18f5 ff19 fs10 fc0 sc0 ls0 ws0">covered in <span class="_ _3"></span>this <span class="_ _2"></span>book <span class="_ _3"></span>support <span class="_ _2"></span>all <span class="_ _2"></span>three <span class="_ _2"></span>functions, <span class="_ _3"></span>but <span class="_ _2"></span>on <span class="_ _2"></span>Mac <span class="_ _3"></span>OS <span class="_ _2"></span>X <span class="_ _3"></span>10.6.8,<span class="_ _80"> </span><span class="ff1b">basegid<span class="_ _80"> </span></span>is <span class="_ _2"></span>declared <span class="_ _2"></span>to</div><div class="t m0 x76 h5e y18f6 ff19 fs10 fc0 sc0 ls0 ws0">be of type<span class="_"> </span><span class="ff1a">int</span>.</div><div class="t m0 x3f h4d y18f7 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _45"> </span><span class="ff1a">getgroups<span class="_ _45"> </span></span>function <span class="_ _9"></span>ﬁlls <span class="_ _9"></span>in <span class="_ _9"></span>the <span class="_ _9"></span>array<span class="_ _45"> </span><span class="ff1b">grouplist<span class="_ _45"> </span></span>with <span class="_ _9"></span>the <span class="_ _9"></span>supplementary <span class="_ _9"></span>group</div><div class="t m0 x32 h4a y18f8 ff19 fs26 fc0 sc0 ls0 ws0">IDs. <span class="_ _35"> </span>Up<span class="_ _35"> </span>to<span class="_ _35"> </span><span class="ff1b">gidsetsize<span class="_ _35"> </span></span>elements <span class="_ _42"> </span>ar<span class="ls7b1">es<span class="_ _43"></span><span class="ls0">tor<span class="_ _0"></span>ed <span class="_ _23"> </span>in <span class="_ _42"> </span>the <span class="_ _23"> </span>array<span class="_ _6"></span><span class="ls7b2">.T<span class="_ _7"></span><span class="ls0">he <span class="_ _23"> </span>number <span class="_ _42"> </span>of <span class="_ _23"> </span>supplementary</span></span></span></span></div><div class="t m0 x32 h49 y18f9 ff19 fs26 fc0 sc0 ls0 ws0">group IDs stor<span class="_ _0"></span>ed in the array is r<span class="_ _0"></span>eturned by the function.</div><div class="t m0 x3f h4a y18fa ff19 fs26 fc0 sc0 ls0 ws0">As <span class="_ _45"> </span>a <span class="_ _45"> </span>special <span class="_ _45"> </span>case, <span class="_ _35"> </span>if<span class="_ _5a"> </span><span class="ff1b">gidsetsize<span class="_ _5a"> </span></span>is <span class="_ _45"> </span>0, <span class="_ _35"> </span>the <span class="_ _45"> </span>function <span class="_ _45"> </span>returns <span class="_ _45"> </span>only <span class="_ _45"> </span>the <span class="_ _45"> </span>number <span class="_ _45"> </span>of</div><div class="t m0 x32 h4a y18fb ff19 fs26 fc0 sc0 ls0 ws0">supplementary group IDs.<span class="_ _46"> </span>The array<span class="_ _66"> </span><span class="ff1b">grouplist<span class="_"> </span></span>is <span class="_ _2"></span>not modiﬁed.<span class="_ _46"> </span>(This <span class="_ _2"></span>allows the <span class="_ _2"></span>caller to</div><div class="t m0 x32 h4a y18fc ff19 fs26 fc0 sc0 ls0 ws0">determine the size of the<span class="_"> </span><span class="ff1b">grouplist<span class="_"> </span></span>array to allocate.)</div><div class="t m0 x3f h4d y18fd ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _45"> </span><span class="ff1a">setgroups<span class="_ _45"> </span></span>function <span class="_ _9"></span>can <span class="_ _23"></span>be <span class="_ _9"></span>called <span class="_ _9"></span>by <span class="_ _23"></span>the <span class="_ _9"></span>superuser <span class="_ _9"></span>to <span class="_ _9"></span>set <span class="_ _23"></span>the <span class="_ _9"></span>supplementary</div><div class="t m0 x32 h4a y18fe ff19 fs26 fc0 sc0 ls0 ws0">group <span class="_ _53"> </span>ID <span class="_"> </span>list <span class="_ _e"> </span>for <span class="_"> </span>the <span class="_ _53"> </span>calling <span class="_"> </span>pr<span class="_ _0"></span>ocess:<span class="_ _59"> </span><span class="ff1b">grouplist<span class="_ _4b"> </span></span>contains <span class="_ _e"> </span>the <span class="_"> </span>array <span class="_ _e"> </span>of <span class="_"> </span>gr<span class="_ _1"></span>oup <span class="_"> </span>IDs, <span class="_ _e"> </span>and</div><div class="t m0 x32 h4a y18ff ff1b fs26 fc0 sc0 ls0 ws0">ngroups<span class="_ _45"> </span><span class="ff19">speciﬁes <span class="_ _9"></span>the <span class="_ _23"></span>number <span class="_ _9"></span>of <span class="_ _23"></span>elements <span class="_ _9"></span>in <span class="_ _9"></span>the <span class="_ _23"></span>array<span class="_ _6"></span><span class="ls7b3">.T<span class="_ _26"></span><span class="ls0">he <span class="_ _9"></span>value <span class="_ _23"></span>of<span class="_ _45"> </span><span class="ff1b">ngroups<span class="_ _45"> </span></span>cannot <span class="_ _9"></span>be</span></span></span></div><div class="t m0 x32 h4d y1900 ff19 fs26 fc0 sc0 ls0 ws0">larger than<span class="_"> </span><span class="ff1a">NGROUPS_MAX</span>.</div><div class="t m0 x3f h4d y1901 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _45"> </span><span class="ff1a">setgroups<span class="_ _35"> </span></span>function <span class="_ _23"></span>is <span class="_ _9"></span>usually <span class="_ _23"> </span>called <span class="_ _23"></span>from <span class="_ _9"></span>the<span class="_ _35"> </span><span class="ff1a">initgroups<span class="_ _45"> </span></span>function, <span class="_ _23"></span>which</div><div class="t m0 x32 h4d y1902 ff19 fs26 fc0 sc0 lscc ws0">re<span class="ls0">ads <span class="_ _3"></span>the <span class="_ _9"></span>entir<span class="ls7b4">eg<span class="_ _b"></span><span class="lscc">ro<span class="_ _2"></span><span class="ls0">up <span class="_ _3"></span>ﬁle<span class="_ _9"></span><span class="ls161">—w<span class="_ _6"></span><span class="ls0">ith <span class="_ _3"></span>the <span class="_ _3"></span>functions<span class="_ _45"> </span><span class="ff1a">getgrent</span>,<span class="_ _47"> </span><span class="ff1a">setgrent</span><span class="ls7b5">,a<span class="_ _8"></span><span class="ls0">nd<span class="_ _47"> </span><span class="ff1a">endgrent</span>,</span></span></span></span></span></span></span></span></div><div class="t m0 x32 h4a y1903 ff19 fs26 fc0 sc0 ls0 ws0">which <span class="_ _42"> </span>we <span class="_ _42"> </span>described <span class="_ _42"> </span>earlier<span class="_ _9"></span><span class="ls161">—a<span class="_ _6"></span><span class="ls0">nd <span class="_ _42"> </span>determines <span class="_ _42"> </span>the <span class="_ _42"> </span>group <span class="_ _42"> </span>membership <span class="_ _42"> </span>for<span class="_ _44"> </span><span class="ff1b">username</span><span class="ls7b6">.I<span class="_ _52"></span><span class="ls0">t</span></span></span></span></div><div class="t m0 x32 h4d y1904 ff19 fs26 fc0 sc0 ls0 ws0">then <span class="_ _23"> </span>calls<span class="_ _35"> </span><span class="ff1a">setgroups<span class="_ _35"> </span></span>to <span class="_ _23"> </span>initialize <span class="_ _23"> </span>the <span class="_ _23"> </span>supplementary <span class="_ _42"> </span>group <span class="_ _9"></span>ID <span class="_ _42"> </span>list <span class="_ _23"></span>for <span class="_ _23"> </span>the <span class="_ _23"> </span>user<span class="_ _1"></span><span class="ls7b7">.O<span class="_ _7"></span><span class="ls0">ne</span></span></div><div class="t m0 x32 h4d y1905 ff19 fs26 fc0 sc0 ls0 ws0">must <span class="_ _66"> </span>be <span class="_ _47"> </span>superuser <span class="_ _47"> </span>to <span class="_ _66"> </span>call<span class="_ _61"> </span><span class="ff1a">initgroups</span><span class="ls7b8">,s<span class="_ _5b"></span><span class="ls0">ince <span class="_ _47"> </span>it <span class="_ _47"> </span>calls<span class="_ _46"> </span><span class="ff1a">setgroups</span><span class="ls7b9">.I<span class="_ _49"></span><span class="ls7ba">na<span class="_ _5b"></span><span class="ls0">ddition <span class="_ _66"> </span>to</span></span></span></span></span></div><div class="t m0 x32 h4d y1906 ff19 fs26 fc0 sc0 ls0 ws0">ﬁnding <span class="_ _53"> </span>all <span class="_ _e"> </span>the <span class="_ _53"> </span>groups <span class="_ _53"> </span>that<span class="_ _4b"> </span><span class="ff1b">username<span class="_ _4b"> </span></span>is <span class="_ _e"> </span>a <span class="_ _53"> </span>member <span class="_ _e"> </span>of <span class="_ _e"> </span>in <span class="_ _53"> </span>the <span class="_ _e"> </span>group <span class="_ _53"> </span>ﬁle,<span class="_ _4b"> </span><span class="ff1a">initgroups</span></div><div class="t m0 x32 h4a y1907 ff19 fs26 fc0 sc0 ls0 ws0">includes<span class="_ _35"> </span><span class="ff1b">basegid<span class="_ _44"> </span></span>in <span class="_ _42"> </span>the <span class="_ _23"> </span>supplementary <span class="_ _42"> </span>group <span class="_ _42"> </span>ID <span class="_ _23"> </span>list;<span class="_ _44"> </span><span class="ff1b">basegid<span class="_ _35"> </span></span>is <span class="_ _42"> </span>the <span class="_ _42"> </span>group <span class="_ _23"> </span>ID <span class="_ _42"> </span>from <span class="_ _23"> </span>the</div><div class="t m0 x32 h4a y1908 ff19 fs26 fc0 sc0 ls0 ws0">passwor<span class="lsd3">dﬁ<span class="_ _4f"></span><span class="ls0">le for<span class="_"> </span><span class="ff1b">username</span>.</span></span></div><div class="t m0 x3f h4d y1909 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _5a"> </span><span class="ff1a">initgroups<span class="_"> </span></span>function <span class="_ _35"> </span>is <span class="_ _45"> </span>called <span class="_ _45"> </span>by <span class="_ _35"> </span>only <span class="_ _45"> </span>a <span class="_ _45"> </span>few <span class="_ _35"> </span>pr<span class="_ _0"></span>ograms. <span class="_ _5a"> </span>The<span class="_ _51"> </span><span class="ff1a">login</span></div><div class="t m0 x40 h49 y190a ff19 fs26 fc0 sc0 ls0 ws0">(</div><div class="t m0 x1b2 h49 y1909 ff19 fs26 fc0 sc0 ls0 ws0">1</div><div class="t m0 x17e h49 y190a ff19 fs26 fc0 sc0 ls0 ws0">)</div><div class="t m0 x32 h49 y190b ff19 fs26 fc0 sc0 ls0 ws0">program, for example, calls it when we log in.</div><div class="t m0 x35 h4b y190c ff16 fs27 fc0 sc0 ls0 ws0">6.6 <span class="_ _68"> </span>Implementation<span class="_ _54"> </span>Differences</div><div class="t m0 x32 h49 y190d ff19 fs26 fc0 sc0 ls164 ws0">We<span class="_ _9"></span><span class="ls0">’ve <span class="_ _53"> </span>already <span class="_ _53"> </span>discussed <span class="_ _e"> </span>the <span class="_ _53"> </span>shadow <span class="_ _e"> </span>passwor<span class="ls7bb">dﬁ<span class="_ _55"></span><span class="ls0">le <span class="_ _53"> </span>supported <span class="_ _e"> </span>by <span class="_ _53"> </span>Linux <span class="_ _e"> </span>and <span class="_ _53"> </span>Solaris.</span></span></span></div><div class="t m0 x32 h49 y190e ff19 fs26 fc0 sc0 ls0 ws0">FreeBSD <span class="_ _3"></span>and <span class="_ _23"></span>Mac <span class="_ _9"></span>OS <span class="_ _9"></span>X <span class="_ _9"></span>stor<span class="ls7bc">ee<span class="_ _b"></span><span class="ls0">ncrypted <span class="_ _9"></span>passwords <span class="_ _3"></span>differently<span class="_ _4"></span><span class="ls7bd">.F<span class="_ _26"></span><span class="ls0">igur<span class="ls7bc">e6<span class="_ _b"></span><span class="ls0">.5 <span class="_ _9"></span>summarizes</span></span></span></span></span></span></div><div class="t m0 x32 h49 y190f ff19 fs26 fc0 sc0 ls0 ws0">how the four platforms covered in this book stor<span class="_ _0"></span><span class="lsd3">eu<span class="_ _d"></span><span class="ls0">ser and group information.</span></span></div><a class="l" href="#pfe" data-dest-detail='[14,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892201px;bottom:211.446907px;width:196.583892px;height:19.680008px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
