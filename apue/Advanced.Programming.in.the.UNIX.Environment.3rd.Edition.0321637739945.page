<div id="pf3b1" class="pf w4 h1f" data-page-no="3b1"><div class="pc pc3b1 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg3b1.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Appendix <span class="_"> </span>C<span class="_ _323"> </span>Chapter <span class="_"> </span>5<span class="_ _54"> </span>Solutions<span class="_ _1b"> </span><span class="ff18">911</span></div><div class="t m0 x215 h2a y12f ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">stor<span class="ls5bd">et<span class="_ _43"></span><span class="ls0">he <span class="_ _23"> </span>modiﬁcation <span class="_ _42"> </span>time <span class="_ _23"> </span>from <span class="_ _23"> </span>the <span class="_ _23"> </span>archive; <span class="_ _23"> </span>instead, <span class="_ _42"> </span>the <span class="_ _23"> </span>modiﬁcation <span class="_ _23"> </span>time <span class="_ _42"> </span>is</span></span></span></div><div class="t m0 x215 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">set <span class="_ _2"></span>to <span class="_ _2"></span>the <span class="_ _3"></span>time <span class="_ _2"></span>of <span class="_ _2"></span>extraction.<span class="_ _61"> </span>In <span class="_ _3"></span>all <span class="_ _2"></span>cases <span class="_ _2"></span>with<span class="_ _47"> </span><span class="ff1a">tar</span><span class="lsf49">,t<span class="_ _4f"></span><span class="ls0">he <span class="_ _2"></span>access <span class="_ _2"></span>time <span class="_ _3"></span>after <span class="_ _2"></span>extraction</span></span></div><div class="t m0 x215 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">will be the time of extraction.</div><div class="t m0 x215 h26 y151 ff19 fsf fc0 sc0 ls0 ws0">In <span class="_ _42"> </span>contrast,<span class="_ _44"> </span><span class="ff1a">cpio<span class="_ _44"> </span></span>sets <span class="_ _42"> </span>the <span class="_ _42"> </span>access <span class="_ _42"> </span>time <span class="_ _42"> </span>and <span class="_ _53"> </span>the <span class="_ _42"> </span>modiﬁcation <span class="_ _42"> </span>time <span class="_ _53"> </span>to <span class="_ _42"> </span>the <span class="_ _42"> </span>time <span class="_ _42"> </span>of</div><div class="t m0 x215 h2a ya63 ff19 fsf fc0 sc0 ls0 ws0">extraction. <span class="_ _45"> </span>By<span class="_ _45"> </span>default, <span class="_ _23"></span>it <span class="_ _9"></span>doesn’t <span class="_ _9"></span>try <span class="_ _23"></span>to <span class="_ _9"></span>set <span class="_ _23"></span>the <span class="_ _9"></span>modiﬁcation <span class="_ _9"></span>time <span class="_ _23"></span>to <span class="_ _9"></span>the <span class="_ _23"></span>value <span class="_ _9"></span>on</div><div class="t m0 x215 h26 y31e ff19 fsf fc0 sc0 ls0 ws0">the <span class="_"> </span>archive. <span class="_ _46"> </span>The<span class="_ _46"> </span><span class="ff1a">-m<span class="_ _46"> </span></span>option <span class="_ _66"> </span>to<span class="_ _61"> </span><span class="ff1a">cpio<span class="_ _46"> </span></span>has <span class="_ _66"> </span>it <span class="_ _66"> </span>set <span class="_ _66"> </span>both <span class="_ _66"> </span>the <span class="_ _66"> </span>access <span class="_"> </span>time <span class="_ _66"> </span>and <span class="_ _66"> </span>the</div><div class="t m0 x215 h2a y31f ff19 fsf fc0 sc0 ls0 ws0">modiﬁcation time to the value that was archived.</div><div class="t m0 x32 h2a y1ff ff18 fsf fc0 sc0 ls0 ws0">4.16<span class="_ _1a3"> </span><span class="ff19">The <span class="_ _23"> </span>kernel <span class="_ _23"> </span>has <span class="_ _42"> </span>no <span class="_ _23"></span>inherent <span class="_ _9"></span>limit <span class="_ _23"> </span>on <span class="_ _23"> </span>the <span class="_ _42"> </span>depth <span class="_ _23"></span>of <span class="_ _23"></span>a <span class="_ _23"></span>directory <span class="_ _9"></span>tree. <span class="_ _35"> </span>Nevertheless,</span></div><div class="t m0 x215 h26 y200 ff19 fsf fc0 sc0 ls0 ws0">many <span class="_ _53"> </span>commands <span class="_ _53"> </span>will <span class="_ _53"> </span>fail <span class="_ _42"> </span>on <span class="_ _53"> </span>pathnames <span class="_ _53"> </span>that <span class="_ _53"> </span>exceed<span class="_ _4b"> </span><span class="ff1a">PATH_MAX</span><span class="ls1819">.T<span class="_ _52"></span><span class="ls0">he <span class="_ _42"> </span>program</span></span></div><div class="t m0 x215 h2a y322 ff19 fsf fc0 sc0 ls0 ws0">shown <span class="_ _23"> </span>in <span class="_ _23"> </span>Figur<span class="lsc40">eC<span class="_ _43"></span><span class="ls0">.3 <span class="_ _23"> </span>creates <span class="_ _23"> </span>a <span class="_ _42"> </span>directory <span class="_ _9"></span>tree <span class="_ _23"> </span>that <span class="_ _42"> </span>is <span class="_ _23"></span>1,000 <span class="_ _23"> </span>levels <span class="_ _42"> </span>deep, <span class="_ _23"></span>with <span class="_ _23"> </span>each</span></span></div><div class="t m0 x215 h2a y323 ff19 fsf fc0 sc0 ls0 ws0">level <span class="_ _47"> </span>being <span class="_ _47"> </span>a <span class="_ _47"> </span>45-character <span class="_ _47"> </span>name.<span class="_ _50"> </span><span class="ls5f">We <span class="_ _46"> </span>a<span class="_ _9"></span><span class="ls45">re <span class="_ _45"> </span>a<span class="_ _2"></span></span></span>ble <span class="_ _47"> </span>to <span class="_ _47"> </span>create <span class="_ _66"> </span>this <span class="_ _47"> </span>structure<span class="_ _61"> </span>on<span class="_ _16"> </span>all</div><div class="t m0 x215 h2a y324 ff19 fsf fc0 sc0 ls0 ws0">platforms; <span class="_ _23"></span>however<span class="_ _6"></span>,<span class="_ _35"> </span>we<span class="_ _35"> </span>cannot <span class="_ _9"></span>obtain <span class="_ _23"> </span>the <span class="_ _23"> </span>absolute <span class="_ _23"> </span>pathname <span class="_ _23"></span>of <span class="_ _23"></span>the <span class="_ _23"></span>directory <span class="_ _9"></span>at</div><div class="t m0 x215 h26 y325 ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _42"> </span>1,000th <span class="_ _53"> </span>level <span class="_ _42"> </span>using<span class="_ _44"> </span><span class="ff1a">getcwd<span class="_ _44"> </span></span>on <span class="_ _53"> </span>all <span class="_ _42"> </span>platforms.<span class="_ _65"> </span>On <span class="_ _42"> </span>Mac <span class="_ _53"> </span>OS <span class="_ _42"> </span>X <span class="_ _53"> </span>10.6.8, <span class="_ _42"> </span>we <span class="_ _53"> </span>can</div><div class="t m0 x215 h26 y326 ff19 fsf fc0 sc0 ls0 ws0">never <span class="_ _9"></span>get<span class="_ _45"> </span><span class="ff1a">getcwd<span class="_ _35"> </span></span>to <span class="_ _9"></span>succeed <span class="_ _9"></span>while <span class="_ _9"></span>in <span class="_ _23"></span>the <span class="_ _9"></span>directory <span class="_ _9"></span>at <span class="_ _9"></span>the <span class="_ _23"></span>end <span class="_ _9"></span>of <span class="_ _9"></span>this <span class="_ _23"></span>long <span class="_ _9"></span>path.</div><div class="t m0 x215 h2a y327 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _42"> </span>program <span class="_ _23"> </span>is <span class="_ _42"> </span>able <span class="_ _42"> </span>to <span class="_ _42"> </span>retrieve <span class="_ _42"> </span>the <span class="_ _42"> </span>pathname <span class="_ _42"> </span>on <span class="_ _42"> </span>FreeBSD <span class="_ _23"> </span>8.0, <span class="_ _42"> </span>Linux <span class="_ _42"> </span>3.2.0, <span class="_ _42"> </span>and</div><div class="t m0 x215 h26 y206 ff19 fsf fc0 sc0 ls0 ws0">Solaris <span class="_ _2"></span>10, <span class="_ _3"></span>but <span class="_ _3"></span>we <span class="_ _3"></span>have <span class="_ _2"></span>to <span class="_ _3"></span>call<span class="_ _47"> </span><span class="ff1a">realloc<span class="_ _47"> </span></span>numerous <span class="_ _2"></span>times <span class="_ _3"></span>to <span class="_ _3"></span>obtain <span class="_ _3"></span>a <span class="_ _2"></span>buffer <span class="_ _3"></span>that <span class="_ _2"></span>is</div><div class="t m0 x215 h2a y1f12 ff19 fsf fc0 sc0 ls0 ws0">large enough.<span class="_ _59"> </span>Running this program on Linux 3.2.0 gives us</div><div class="t m0 x1a7 h57 y6064 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">./a.out</span></div><div class="t m0 x1a7 h57 y6065 ff1a fs2d fc0 sc0 ls0 ws0">getcwd failed, size = 4096: Numerical result out of range</div><div class="t m0 x1a7 h57 y6066 ff1a fs2d fc0 sc0 ls0 ws0">getcwd failed, size = 4196: Numerical result out of range</div><div class="t m0 x1a7 h57 y6067 ff1a fs2d fc0 sc0 ls0 ws0">...<span class="_ _23f"> </span><span class="ff1b">418 mor<span class="_ _0"></span><span class="ls110">el<span class="_ _5"></span><span class="ls0">ines</span></span></span></div><div class="t m0 x1a7 h57 y6068 ff1a fs2d fc0 sc0 ls0 ws0">getcwd failed, size = 45896: Numerical result out of range</div><div class="t m0 x1a7 h57 y6069 ff1a fs2d fc0 sc0 ls0 ws0">getcwd failed, size = 45996: Numerical result out of range</div><div class="t m0 x1a7 h57 y606a ff1a fs2d fc0 sc0 ls0 ws0">length = 46004</div><div class="t m0 x1ac h58 y606b ff1b fs2d fc0 sc0 ls0 ws0">the 46,004-byte pathname is printed here</div><div class="t m0 x215 h26 y33dc ff19 fsf fc0 sc0 ls5f ws0">We <span class="_ _80"> </span>a<span class="_ _9"></span><span class="ls45">re <span class="_ _23"></span>n<span class="ls0">ot <span class="_ _9"></span>able <span class="_ _3"></span>to <span class="_ _9"></span>archive <span class="_ _2"></span>this <span class="_ _9"></span>directory<span class="_ _4"></span><span class="ls5c3">,h<span class="_ _8"></span><span class="ls0">owever<span class="_ _6"></span><span class="ls5c3">,u<span class="_ _8"></span><span class="ls0">sing<span class="_ _45"> </span><span class="ff1a">cpio</span><span class="ls13a5">.I<span class="_ _62"></span><span class="ls5c3">tc<span class="_ _8"></span><span class="ls0">omplains <span class="_ _3"></span>that</span></span></span></span></span></span></span></span></span></div><div class="t m0 x215 h26 y33dd ff19 fsf fc0 sc0 ls0 ws0">many <span class="_ _66"> </span>of <span class="_ _47"> </span>the <span class="_ _47"> </span>ﬁlenames <span class="_ _66"> </span>ar<span class="ls428">et<span class="_ _1d"></span><span class="ls0">oo <span class="_ _47"> </span>long.<span class="_ _50"> </span>In <span class="_ _47"> </span>fact,<span class="_ _46"> </span><span class="ff1a">cpio<span class="_ _16"> </span></span>is <span class="_ _66"> </span>unable <span class="_ _47"> </span>to <span class="_ _47"> </span>archive <span class="_"> </span>this</span></span></div><div class="t m0 x215 h2a y33de ff19 fsf fc0 sc0 ls0 ws0">directory <span class="_ _23"></span>on <span class="_ _23"> </span>all <span class="_ _23"> </span>four <span class="_ _42"> </span>platforms.<span class="_ _51"> </span>In <span class="_ _23"> </span>contrast, <span class="_ _42"> </span>we <span class="_ _23"> </span>can <span class="_ _42"> </span>ar<span class="_ _0"></span>chive <span class="_ _23"> </span>this <span class="_ _42"> </span>directory <span class="_ _23"></span>using</div><div class="t m0 x215 h26 y33df ff1a fsf fc0 sc0 ls0 ws0">tar<span class="_ _80"> </span><span class="ff19">on <span class="_ _2"></span>FreeBSD 8.0, Linux 3.2.0, <span class="_ _2"></span>and Mac OS <span class="_ _2"></span>X 10.6.8.<span class="_ _46"> </span>However<span class="_ _1"></span>,<span class="_"> </span>we<span class="_ _66"> </span>a<span class="ls45">re <span class="_ _3"></span>u<span class="_ _2"></span></span>nable to</span></div><div class="t m0 x215 h2a y606c ff19 fsf fc0 sc0 ls0 ws0">extract the directory hierar<span class="_ _0"></span>chy fr<span class="_ _0"></span>om the archive on Linux 3.2.0.</div><div class="t m0 x32 h26 y606d ff18 fsf fc0 sc0 ls0 ws0">4.17<span class="_ _1a3"> </span><span class="ff19">The<span class="_ _44"> </span><span class="ff1a">/dev<span class="_ _4b"> </span></span>directory <span class="_ _42"> </span>has <span class="_ _42"> </span>write <span class="_ _53"> </span>permissions <span class="_ _53"> </span>turned <span class="_ _42"> </span>off<span class="_ _44"> </span>to<span class="_ _44"> </span>p<span class="ls45">re<span class="_ _2"></span></span>vent <span class="_ _42"> </span>a <span class="_ _53"> </span>normal <span class="_ _53"> </span>user</span></div><div class="t m0 x215 h26 y606e ff19 fsf fc0 sc0 ls0 ws0">from <span class="_ _47"> </span>removing <span class="_ _66"> </span>the <span class="_ _45"> </span>ﬁlenames <span class="_ _47"> </span>in <span class="_ _47"> </span>the <span class="_ _45"> </span>dir<span class="_ _0"></span>ectory<span class="_ _4"></span><span class="ls181a">.T<span class="_ _49"></span><span class="ls0">his <span class="_ _47"> </span>means <span class="_ _47"> </span>that <span class="_ _47"> </span>the<span class="_ _16"> </span><span class="ff1a">unlink</span></span></span></div><div class="t m0 x215 h2a y606f ff19 fsf fc0 sc0 ls0 ws0">attempt fails.</div><div class="t m0 x35 h27 y6070 ff16 fsf fc0 sc0 ls0 ws0">Chapter <span class="_"> </span>5</div><div class="t m0 x32 h26 y6071 ff18 fsf fc0 sc0 ls0 ws0">5.2<span class="_ _9b"> </span><span class="ff19">The<span class="_"> </span><span class="ff1a">fgets<span class="_ _47"> </span></span>function <span class="_ _2"></span>reads <span class="_ _2"></span>up <span class="_ _3"></span>through <span class="_ _2"></span>and <span class="_ _2"></span>including <span class="_ _3"></span>the <span class="_ _2"></span>next <span class="_ _3"></span>newline<span class="_ _66"> </span><span class="ff1b">or<span class="_ _47"> </span></span>until <span class="_ _3"></span>the</span></div><div class="t m0 x215 h2a y6072 ff19 fsf fc0 sc0 ls0 ws0">buffer <span class="_ _53"> </span>is <span class="_ _e"> </span>full</div><div class="t m0 xf0 h2a y6073 ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 x25 h2a y6072 ff19 fsf fc0 sc0 ls0 ws0">leaving <span class="_ _e"> </span>room, <span class="_ _53"> </span>of <span class="_ _e"> </span>course, <span class="_"> </span>for <span class="_ _53"> </span>the <span class="_ _e"> </span>terminating <span class="_ _e"> </span>null</div><div class="t m0 x120 h2a y6073 ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 x3a h26 y6072 ff19 fsf fc0 sc0 ls181b ws0">.A<span class="_ _64"></span><span class="ls0">lso,<span class="_ _4b"> </span><span class="ff1a">fputs</span></span></div><div class="t m0 x215 h2a y6074 ff19 fsf fc0 sc0 ls0 ws0">writes <span class="_ _9"></span>everything <span class="_ _23"></span>in <span class="_ _9"></span>the <span class="_ _23"></span>buffer <span class="_ _9"></span>until <span class="_ _23"></span>it <span class="_ _9"></span>hits <span class="_ _23"></span>a <span class="_ _9"></span>null <span class="_ _23"></span>byte; <span class="_ _9"></span>it <span class="_ _23"></span>doesn’t <span class="_ _9"></span>car<span class="ls181c">ew<span class="_ _b"></span><span class="ls0">hether <span class="_ _9"></span>a</span></span></div><div class="t m0 x215 h26 y6075 ff19 fsf fc0 sc0 ls0 ws0">newline <span class="_ _23"> </span>is <span class="_ _42"> </span>in <span class="_ _42"> </span>the <span class="_ _42"> </span>buffer<span class="_ _6"></span><span class="ls181d">.S<span class="_ _52"></span><span class="ls0">o, <span class="_ _42"> </span>if<span class="_ _44"> </span><span class="ff1a">MAXLINE<span class="_ _35"> </span></span>is <span class="_ _42"> </span>too <span class="_ _23"> </span>small, <span class="_ _42"> </span>both <span class="_ _42"> </span>functions <span class="_ _23"> </span>still <span class="_ _42"> </span>work;</span></span></div><div class="t m0 x215 h2a y6076 ff19 fsf fc0 sc0 ls0 ws0">they’r<span class="ls44">ej<span class="_ _4f"></span><span class="ls0">ust called mor<span class="ls44">eo<span class="_ _d"></span><span class="ls0">ften than they would be if the buffer wer<span class="ls44">el<span class="_ _4f"></span><span class="ls0">arger<span class="_ _6"></span>.</span></span></span></span></span></span></div><div class="t m0 x215 h26 y6077 ff19 fsf fc0 sc0 ls0 ws0">If either <span class="_ _2"></span>of <span class="_ _2"></span>these functions <span class="_ _2"></span>removed or <span class="_ _2"></span>added <span class="_ _2"></span>the newline <span class="_ _2"></span>(as<span class="_ _66"> </span><span class="ff1a">gets<span class="_ _66"> </span></span>and<span class="_ _47"> </span><span class="ff1a">puts<span class="_ _66"> </span></span>do),</div><div class="t m0 x215 h2a y6078 ff19 fsf fc0 sc0 ls0 ws0">we would have to ensur<span class="ls44">et<span class="_ _4f"></span><span class="ls0">hat our buffer was big enough for the largest line.</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
