<div id="pf110" class="pf w4 h1f" data-page-no="110"><div class="pc pc110 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg110.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">238<span class="_ _1b"> </span><span class="ff19">Process <span class="_"> </span>Contr<span class="_ _0"></span>ol <span class="_ _222"> </span>Chapter<span class="_ _4b"> </span>8</span></div><div class="t m0 x3f h2a y12f ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _3"></span>ﬁnal <span class="_ _3"></span>condition <span class="_ _3"></span>to <span class="_ _3"></span>consider <span class="_ _9"></span>is <span class="_ _3"></span>this: <span class="_ _3"></span>What <span class="_ _3"></span>happens <span class="_ _3"></span>when <span class="_ _3"></span>a <span class="_ _9"></span>process <span class="_ _2"></span>that <span class="_ _3"></span>has <span class="_ _3"></span>been</div><div class="t m0 x32 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">inherited <span class="_ _2"></span>by<span class="_ _45"> </span><span class="ff1a">init<span class="_ _66"> </span></span>terminates? <span class="_ _47"> </span>Does<span class="_ _47"> </span>it <span class="_ _3"></span>become <span class="_ _3"></span>a <span class="_ _3"></span>zombie?<span class="_ _16"> </span>The <span class="_ _3"></span>answer <span class="_ _3"></span>is <span class="_ _3"></span>‘<span class="_ _0"></span>‘no,’<span class="_ _1"></span><span class="ls989">’b<span class="_ _4f"></span><span class="ls0">ecause</span></span></div><div class="t m0 x32 h26 y131 ff1a fsf fc0 sc0 ls0 ws0">init<span class="_ _45"> </span><span class="ff19">is <span class="_ _9"></span>written <span class="_ _23"></span>so <span class="_ _9"></span>that <span class="_ _9"></span>whenever <span class="_ _23"></span>one <span class="_ _9"></span>of <span class="_ _23"></span>its <span class="_ _9"></span>children <span class="_ _9"></span>terminates,<span class="_ _45"> </span></span>init<span class="_ _45"> </span><span class="ff19">calls <span class="_ _23"></span>one <span class="_ _9"></span>of <span class="_ _9"></span>the</span></div><div class="t m0 x32 h26 y132 ff1a fsf fc0 sc0 ls0 ws0">wait<span class="_ _66"> </span><span class="ff19">functions to fetch <span class="_ _2"></span>the termination <span class="_ _2"></span>status.<span class="_ _46"> </span>By doing <span class="_ _2"></span>this,<span class="_"> </span></span>init<span class="_ _66"> </span><span class="ff19">prevents the system</span></div><div class="t m0 x32 h26 y133 ff19 fsf fc0 sc0 ls0 ws0">from <span class="_ _53"> </span>being <span class="_ _e"> </span>clogged <span class="_ _e"> </span>by <span class="_ _e"> </span>zombies.<span class="_ _65"> </span>When <span class="_ _e"> </span>we <span class="_ _e"> </span>say <span class="_ _e"> </span>‘‘one <span class="_ _53"> </span>of<span class="_ _4b"> </span><span class="ff1a">init</span>’s <span class="_ _e"> </span>children,’<span class="_ _1"></span><span class="ls98a">’w<span class="_ _55"></span><span class="ls98b">em<span class="_ _c"></span><span class="ls0">ean</span></span></span></div><div class="t m0 x32 h26 y134 ff19 fsf fc0 sc0 ls0 ws0">either <span class="_ _53"> </span>a <span class="_ _e"> </span>process <span class="_ _42"> </span>that<span class="_ _4b"> </span><span class="ff1a">init<span class="_ _4b"> </span></span>generates <span class="_ _e"> </span>directly <span class="_ _53"> </span>(such <span class="_ _53"> </span>as<span class="_ _4b"> </span><span class="ff1a">getty</span><span class="ls98c">,w<span class="_ _c"></span><span class="ls0">hich <span class="_ _53"> </span>we <span class="_ _e"> </span>describe <span class="_ _53"> </span>in</span></span></div><div class="t m0 x32 h2a y135 ff19 fsf fc0 sc0 ls0 ws0">Section <span class="_"> </span>9.2) <span class="_ _66"> </span>or <span class="_ _66"> </span>a <span class="_ _66"> </span>process <span class="_"> </span>whose <span class="_ _66"> </span>parent <span class="_"> </span>has <span class="_ _47"> </span>terminated <span class="_"> </span>and <span class="_ _66"> </span>has <span class="_ _66"> </span>been <span class="_ _66"> </span>subsequently</div><div class="t m0 x32 h26 y136 ff19 fsf fc0 sc0 ls0 ws0">inherited by<span class="_"> </span><span class="ff1a">init</span>.</div><div class="t m0 x35 h75 y139 ff16 fs2b fc0 sc0 ls0 ws0">8.6<span class="_ _72"> </span><span class="ff1f">wait<span class="_ _54"> </span></span>and<span class="_ _54"> </span><span class="ff1f">waitpid<span class="_ _65"> </span></span>Functions</div><div class="t m0 x32 h2a y6d9 ff19 fsf fc0 sc0 ls0 ws0">When a <span class="_ _2"></span>process terminates, either <span class="_ _2"></span>normally or <span class="_ _2"></span>abnormally<span class="_ _4"></span><span class="ls98d">,t<span class="_ _d"></span><span class="ls0">he <span class="_ _2"></span>kernel notiﬁes <span class="_ _2"></span>the <span class="_ _2"></span>parent</span></span></div><div class="t m0 x32 h26 y6da ff19 fsf fc0 sc0 ls0 ws0">by <span class="_ _9"></span>sending <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">SIGCHLD<span class="_ _47"> </span></span>signal <span class="_ _9"></span>to <span class="_ _9"></span>the <span class="_ _9"></span>parent. <span class="_ _45"> </span>Because<span class="_ _45"> </span>the <span class="_ _3"></span>termination <span class="_ _9"></span>of <span class="_ _9"></span>a <span class="_ _9"></span>child <span class="_ _9"></span>is <span class="_ _9"></span>an</div><div class="t m0 x32 h2a y6db ff19 fsf fc0 sc0 ls0 ws0">asynchronous <span class="_"> </span>event<span class="_ _3"></span><span class="ls9d">—i<span class="_ _6"></span><span class="ls98e">tc<span class="_ _4a"></span><span class="ls0">an <span class="_"> </span>happen <span class="_"> </span>at <span class="_"> </span>any <span class="_"> </span>time <span class="_"> </span>while <span class="_"> </span>the <span class="_"> </span>parent <span class="_"> </span>is <span class="_"> </span>running <span class="_ _84"></span>— <span class="_ _4"></span>this</span></span></span></div><div class="t m0 x32 h2a y6dc ff19 fsf fc0 sc0 ls0 ws0">signal <span class="_ _23"> </span>is <span class="_ _42"> </span>the <span class="_ _23"> </span>asynchronous <span class="_ _23"> </span>notiﬁcation <span class="_ _42"> </span>from <span class="_ _23"> </span>the <span class="_ _42"> </span>kernel <span class="_ _23"> </span>to <span class="_ _42"> </span>the <span class="_ _23"> </span>parent. <span class="_ _35"> </span>The<span class="_ _35"> </span>parent <span class="_ _23"> </span>can</div><div class="t m0 x32 h2a y6dd ff19 fsf fc0 sc0 ls0 ws0">choose <span class="_ _9"></span>to <span class="_ _9"></span>ignor<span class="ls98f">et<span class="_ _b"></span><span class="ls0">his <span class="_ _9"></span>signal, <span class="_ _9"></span>or <span class="_ _9"></span>it <span class="_ _9"></span>can <span class="_ _9"></span>provide <span class="_ _9"></span>a <span class="_ _9"></span>function <span class="_ _9"></span>that <span class="_ _9"></span>is <span class="_ _23"></span>called <span class="_ _9"></span>when <span class="_ _9"></span>the <span class="_ _9"></span>signal</span></span></div><div class="t m0 x32 h2a y6de ff19 fsf fc0 sc0 ls0 ws0">occurs: <span class="_ _2"></span>a <span class="_ _2"></span>signal <span class="_ _2"></span>handler<span class="_ _1"></span><span class="ls990">.T<span class="_ _5b"></span><span class="ls0">he <span class="_ _2"></span>default <span class="_ _2"></span>action <span class="_ _2"></span>for <span class="_ _2"></span>this <span class="_ _2"></span>signal <span class="_ _3"></span>is <span class="_ _2"></span>to <span class="_ _2"></span>be <span class="_ _2"></span>ignored. <span class="_ _66"> </span>W<span class="_ _6"></span><span class="ls2de">ed<span class="_ _4f"></span><span class="ls0">escribe</span></span></span></span></div><div class="t m0 x32 h2a y10cf ff19 fsf fc0 sc0 ls0 ws0">these <span class="_ _42"> </span>options <span class="_ _42"> </span>in <span class="_ _42"> </span>Chapter <span class="_ _42"> </span>10.<span class="_ _54"> </span>For <span class="_ _42"> </span>now<span class="_ _6"></span>,<span class="_ _44"> </span>we<span class="_ _44"> </span>need <span class="_ _42"> </span>to <span class="_ _42"> </span>be <span class="_ _42"> </span>awar<span class="ls991">et<span class="_ _43"></span><span class="ls0">hat <span class="_ _42"> </span>a <span class="_ _42"> </span>process <span class="_ _23"> </span>that <span class="_ _42"> </span>calls</span></span></div><div class="t m0 x32 h26 y10d0 ff1a fsf fc0 sc0 ls0 ws0">wait<span class="_ _80"> </span><span class="ff19">or<span class="_"> </span></span>waitpid<span class="_ _66"> </span><span class="ff19">can</span></div><div class="t m0 x3f h2a y1f8b ff19 fsf fc0 sc0 ls49 ws0">•B<span class="_ _4d"></span><span class="ls0">lock, if all of its children ar<span class="_ _0"></span><span class="ls44">es<span class="_ _d"></span><span class="ls0">till running</span></span></span></div><div class="t m0 x3f h2a y1f8c ff19 fsf fc0 sc0 ls49 ws0">•R<span class="_ _4d"></span><span class="ls0">eturn <span class="_ _45"> </span>immediately <span class="_ _45"> </span>with <span class="_ _45"> </span>the <span class="_ _45"> </span>termination <span class="_ _35"> </span>status <span class="_ _45"> </span>of <span class="_ _45"> </span>a <span class="_ _45"> </span>child, <span class="_ _45"> </span>if <span class="_ _45"> </span>a <span class="_ _35"> </span>child <span class="_ _45"> </span>has</span></div><div class="t m0 x15 h2a y1f8d ff19 fsf fc0 sc0 ls0 ws0">terminated and is waiting for its termination status to be fetched</div><div class="t m0 x3f h2a y1f8e ff19 fsf fc0 sc0 ls49 ws0">•R<span class="_ _4d"></span><span class="ls0">eturn immediately with an error<span class="_ _6"></span>,<span class="_"> </span>if<span class="_"> </span>it<span class="_"> </span>doesn’t have any child processes</span></div><div class="t m0 x32 h26 y1f8f ff19 fsf fc0 sc0 ls0 ws0">If the process is calling<span class="_"> </span><span class="ff1a">wait<span class="_ _66"> </span></span>because it received the<span class="_"> </span><span class="ff1a">SIGCHLD<span class="_ _66"> </span></span>signal, we expect<span class="_"> </span><span class="ff1a">wait<span class="_ _66"> </span></span>to</div><div class="t m0 x32 h2a y1f90 ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">turn immediately<span class="_ _6"></span><span class="ls86">.B<span class="_ _4a"></span><span class="ls0">ut if we call it at any random point in time, it can block.</span></span></span></div><div class="t m0 x3f h57 y1f91 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;sys/wait.h&gt;</div><div class="t m0 x3f h57 y1f92 ff1a fs2d fc0 sc0 ls0 ws0">pid_t wait(int *<span class="ff1b">statloc</span>);</div><div class="t m0 x3f h57 y1f93 ff1a fs2d fc0 sc0 ls0 ws0">pid_t waitpid(pid_t<span class="_"> </span><span class="ff1b">pid</span><span class="ls15c">,i<span class="_ _1d"></span><span class="ls0">nt *<span class="ff1b">statloc</span><span class="ls15c">,i<span class="_ _5b"></span><span class="ls0">nt<span class="_"> </span><span class="ff1b">options</span>);</span></span></span></span></div><div class="t m0 x1f6 h5f y1f94 ff19 fs2d fc0 sc0 ls0 ws0">Both return: pr<span class="_ _0"></span>ocess ID if OK, 0 (see later), or<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h49 y1f95 ff19 fs26 fc0 sc0 ls0 ws0">The differ<span class="_ _0"></span>ences between these two functions ar<span class="_ _0"></span>e<span class="_"> </span>as<span class="_"> </span>follows:</div><div class="t m0 x3f h4d y1f96 ff19 fs26 fc0 sc0 ls15d ws0">•T<span class="_ _4d"></span><span class="ls0">he<span class="_ _47"> </span><span class="ff1a">wait<span class="_ _66"> </span></span>function <span class="_ _3"></span>can <span class="_ _3"></span>block <span class="_ _2"></span>the <span class="_ _3"></span>caller <span class="_ _2"></span>until <span class="_ _3"></span>a <span class="_ _3"></span>child <span class="_ _2"></span>process <span class="_ _2"></span>terminates, <span class="_ _3"></span>whereas</span></div><div class="t m0 x15 h4d y1f97 ff1a fs26 fc0 sc0 ls0 ws0">waitpid<span class="_ _80"> </span><span class="ff19">has an option that prevents it from blocking.</span></div><div class="t m0 x3f h4d y1f98 ff19 fs26 fc0 sc0 ls15d ws0">•T<span class="_ _4d"></span><span class="ls0">he<span class="_ _35"> </span><span class="ff1a">waitpid<span class="_ _35"> </span></span>function <span class="_ _42"> </span>doesn’t <span class="_ _23"> </span>wait <span class="_ _23"> </span>for <span class="_ _42"> </span>the <span class="_ _23"> </span>child <span class="_ _42"> </span>that <span class="_ _23"> </span>terminates <span class="_ _42"> </span>ﬁrst; <span class="_ _23"> </span>it <span class="_ _42"> </span>has <span class="_ _23"> </span>a</span></div><div class="t m0 x15 h49 y1f99 ff19 fs26 fc0 sc0 ls0 ws0">number of options that control which pr<span class="_ _0"></span>ocess it waits for<span class="_ _6"></span>.</div><div class="t m0 x32 h4d y1f9a ff19 fs26 fc0 sc0 ls0 ws0">If <span class="_ _3"></span>a <span class="_ _9"></span>child <span class="_ _9"></span>has <span class="_ _9"></span>already <span class="_ _3"></span>terminated <span class="_ _9"></span>and <span class="_ _3"></span>is <span class="_ _9"></span>a <span class="_ _9"></span>zombie,<span class="_ _45"> </span><span class="ff1a">wait<span class="_ _47"> </span></span><span class="lscc">re<span class="_ _2"></span></span>turns <span class="_ _9"></span>immediately <span class="_ _9"></span>with <span class="_ _3"></span>that</div><div class="t m0 x32 h49 y1f9b ff19 fs26 fc0 sc0 ls0 ws0">child’s status.<span class="_ _46"> </span>Otherwise, it <span class="_ _2"></span>blocks the <span class="_ _2"></span>caller until a <span class="_ _2"></span>child terminates.<span class="_ _46"> </span>If <span class="_ _2"></span>the caller <span class="_ _2"></span>blocks</div><div class="t m0 x32 h4d y1f9c ff19 fs26 fc0 sc0 ls0 ws0">and <span class="_"> </span>has <span class="_"> </span>multiple <span class="_ _e"> </span>children,<span class="_ _59"> </span><span class="ff1a">wait<span class="_ _59"> </span></span><span class="lscc">re<span class="_ _2"></span></span>turns <span class="_"> </span>when <span class="_"> </span>one <span class="_ _e"> </span>terminates.<span class="_ _60"> </span><span class="ls164">We <span class="_ _44"> </span>c<span class="_ _9"></span></span>an <span class="_"> </span>always <span class="_"> </span>tell</div><div class="t m0 x32 h49 y1f9d ff19 fs26 fc0 sc0 ls0 ws0">which child terminated, because the process ID is r<span class="_ _0"></span>eturned by the function.</div><a class="l" href="#pff" data-dest-detail='[15,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.890952px;bottom:984.288916px;width:213.887497px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
