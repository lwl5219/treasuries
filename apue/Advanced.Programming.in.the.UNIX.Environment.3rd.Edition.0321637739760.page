<div id="pf2f8" class="pf w4 h1f" data-page-no="2f8"><div class="pc pc2f8 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg2f8.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">726<span class="_ _1b"> </span><span class="ff19">Pseudo <span class="_"> </span>T<span class="_ _6"></span>erminals <span class="_ _23a"> </span>Chapter<span class="_ _4b"> </span>19</span></div><div class="t m0 x9d h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">if (ioctl(fds, I_PUSH, &quot;ttcompat&quot;) &lt; 0) {</div><div class="t m0 x32 h57 y426 ff1a fs2d fc0 sc0 ls0 ws0">errout:</div><div class="t m0 x1f h57 y800 ff1a fs2d fc0 sc0 ls0 ws0">err = errno;</div><div class="t m0 x1f h57 y801 ff1a fs2d fc0 sc0 ls0 ws0">close(fds);</div><div class="t m0 x1f h57 y802 ff1a fs2d fc0 sc0 ls0 ws0">errno = err;</div><div class="t m0 x1f h57 y803 ff1a fs2d fc0 sc0 ls0 ws0">return(-1);</div><div class="t m0 x9d h57 y804 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y805 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h57 y806 ff1a fs2d fc0 sc0 ls0 ws0">#endif</div><div class="t m0 x8a h57 y807 ff1a fs2d fc0 sc0 ls0 ws0">return(fds);</div><div class="t m0 x32 h57 y808 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x27 h2d y36b6 ff18 fs10 fc0 sc0 ls0 ws0">Figure 19.9<span class="_ _5a"> </span><span class="ff19">Pseudo-terminal open functions</span></div><div class="t m0 x3f h4d y53b6 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _45"> </span><span class="ff1a">ptym_open<span class="_ _35"> </span></span>function <span class="_ _9"></span>uses <span class="_ _23"></span>the <span class="_ _9"></span>XSI <span class="_ _23"></span>PTY <span class="_ _9"></span>functions <span class="_ _23"></span>to <span class="_ _9"></span>ﬁnd <span class="_ _23"></span>and <span class="_ _23"></span>open <span class="_ _9"></span>an <span class="_ _23"></span>unused</div><div class="t m0 x32 h4d y53b7 ff19 fs26 fc0 sc0 ls0 ws0">PTY <span class="_ _2"></span>master <span class="_ _3"></span>device <span class="_ _3"></span>and <span class="_ _3"></span>initialize <span class="_ _3"></span>the <span class="_ _3"></span>corresponding <span class="_ _2"></span>PTY <span class="_ _3"></span>slave <span class="_ _3"></span>device.<span class="_ _16"> </span>The<span class="_ _47"> </span><span class="ff1a">ptys_open</span></div><div class="t m0 x32 h49 y53b8 ff19 fs26 fc0 sc0 ls0 ws0">function <span class="_ _3"></span>opens <span class="_ _9"></span>the <span class="_ _9"></span>slave <span class="_ _9"></span>PTY <span class="_ _3"></span>device.<span class="_ _5a"> </span>On <span class="_ _9"></span>a <span class="_ _3"></span>Solaris <span class="_ _9"></span>system, <span class="_ _9"></span>however<span class="_ _6"></span>,<span class="_ _45"> </span>we<span class="_ _45"> </span>might <span class="_ _3"></span>need <span class="_ _9"></span>to</div><div class="t m0 x32 h49 y53b9 ff19 fs26 fc0 sc0 ls0 ws0">take additional steps befor<span class="lsd3">et<span class="_ _4f"></span><span class="ls0">he slave PTY device will behave like a terminal.</span></span></div><div class="t m0 x3f h49 y53ba ff19 fs26 fc0 sc0 ls0 ws0">On <span class="_ _3"></span>Solaris, <span class="_ _3"></span>after <span class="_ _9"></span>opening <span class="_ _3"></span>the <span class="_ _9"></span>slave <span class="_ _3"></span>device, <span class="_ _3"></span>we <span class="_ _9"></span>might <span class="_ _3"></span>need <span class="_ _3"></span>to <span class="_ _9"></span>push <span class="_ _3"></span>three <span class="_ _3"></span>STREAMS</div><div class="t m0 x32 h49 y53bb ff19 fs26 fc0 sc0 ls0 ws0">modules <span class="_"> </span>onto <span class="_"> </span>the <span class="_"> </span>slave’s <span class="_"> </span>str<span class="_ _0"></span>eam. <span class="_ _59"> </span>T<span class="_ _6"></span>ogether<span class="_ _1"></span><span class="ls15a2">,t<span class="_ _4a"></span><span class="ls0">he <span class="_"> </span>pseudo <span class="_"> </span>terminal <span class="_"> </span>emulation <span class="_"> </span>module</span></span></div><div class="t m0 x32 h4d y53bc ff19 fs26 fc0 sc0 ls0 ws0">(<span class="ff1a">ptem</span><span class="ls185">)a<span class="_ _b"></span><span class="ls0">nd <span class="_ _9"></span>the <span class="_ _9"></span>terminal <span class="_ _23"></span>line <span class="_ _9"></span>discipline <span class="_ _23"></span>module <span class="_ _9"></span>(<span class="ff1a">ldterm</span><span class="ls185">)a<span class="_ _b"></span><span class="ls0">ct <span class="_ _9"></span>like <span class="_ _23"></span>a <span class="_ _9"></span>real <span class="_ _9"></span>terminal.<span class="_ _5a"> </span>The</span></span></span></span></div><div class="t m0 x32 h4d y53bd ff1a fs26 fc0 sc0 ls0 ws0">ttcompat<span class="_ _45"> </span><span class="ff19">module <span class="_ _9"></span>provides <span class="_ _9"></span>compatibility <span class="_ _23"></span>for <span class="_ _9"></span>older <span class="_ _23"></span>V7, <span class="_ _9"></span>4BSD, <span class="_ _23"></span>and <span class="_ _9"></span>Xenix<span class="_ _45"> </span></span>ioctl<span class="_ _45"> </span><span class="ff19">calls.</span></div><div class="t m0 x32 h49 y53be ff19 fs26 fc0 sc0 ls0 ws0">It’s an optional <span class="_ _2"></span>module, but since <span class="_ _2"></span>it’s automatically pushed <span class="_ _2"></span>for network logins, <span class="_ _2"></span>we push</div><div class="t m0 x32 h49 y53bf ff19 fs26 fc0 sc0 ls0 ws0">it onto the slave’s stream.</div><div class="t m0 x3f h4a y53c0 ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _3"></span>reason <span class="_ _3"></span>why <span class="_ _3"></span>we <span class="_ _9"></span>might<span class="_ _47"> </span><span class="ff1b">not<span class="_ _45"> </span></span>need <span class="_ _3"></span>to <span class="_ _3"></span>push <span class="_ _9"></span>these <span class="_ _3"></span>three <span class="_ _3"></span>modules <span class="_ _3"></span>is <span class="_ _9"></span>that <span class="_ _3"></span>they <span class="_ _3"></span>might</div><div class="t m0 x32 h4a y53c1 ff19 fs26 fc0 sc0 ls0 ws0">be <span class="_ _23"></span>ther<span class="ls15a3">ea<span class="_ _43"></span><span class="ls0">lready<span class="_ _4"></span><span class="ls15a4">.T<span class="_ _7"></span><span class="ls0">he <span class="_ _23"> </span>STREAMS <span class="_ _23"> </span>system <span class="_ _23"> </span>supports <span class="_ _23"> </span>a <span class="_ _23"> </span>facility <span class="_ _23"></span>known <span class="_ _23"></span>as<span class="_ _35"> </span><span class="ff1b">autopush</span><span class="lsef3">,w<span class="_ _43"></span><span class="ls0">hich</span></span></span></span></span></span></div><div class="t m0 x32 h49 y53c2 ff19 fs26 fc0 sc0 ls0 ws0">allows <span class="_"> </span>an <span class="_ _53"> </span>administrator <span class="_"> </span>to <span class="_ _e"> </span>conﬁgur<span class="ls15a5">eal<span class="_ _4a"></span><span class="ls0">ist <span class="_"> </span>of <span class="_ _e"> </span>modules <span class="_"> </span>to <span class="_ _e"> </span>be <span class="_"> </span>pushed <span class="_ _e"> </span>onto <span class="_"> </span>a <span class="_ _53"> </span>stream</span></span></div><div class="t m0 x32 h49 y53c3 ff19 fs26 fc0 sc0 ls0 ws0">whenever <span class="_ _9"></span>a <span class="_ _9"></span>particular <span class="_ _3"></span>device <span class="_ _9"></span>is <span class="_ _9"></span>opened <span class="_ _9"></span>(see <span class="_ _9"></span>Rago</div><div class="t m0 x22b h49 y53c4 ff19 fs26 fc0 sc0 ls0 ws0">[</div><div class="t m0 x202 h49 y53c3 ff19 fs26 fc0 sc0 ls0 ws0">1993</div><div class="t m0 x100 h49 y53c4 ff19 fs26 fc0 sc0 ls0 ws0">]</div><div class="t m0 x1ef h49 y53c3 ff19 fs26 fc0 sc0 ls0 ws0">for <span class="_ _9"></span>mor<span class="lsee2">ed<span class="_ _b"></span><span class="ls0">etails). <span class="_ _47"> </span>W<span class="_ _6"></span><span class="lsee2">eu<span class="_ _8"></span><span class="ls0">se <span class="_ _9"></span>the</span></span></span></span></div><div class="t m0 x32 h4d y53c5 ff1a fs26 fc0 sc0 ls0 ws0">I_FIND <span class="_ _d"></span>ioctl<span class="_ _45"> </span><span class="ff19">command <span class="_ _9"></span>to <span class="_ _9"></span>see <span class="_ _23"></span>whether<span class="_ _45"> </span></span>ldterm<span class="_ _45"> </span><span class="ff19">is <span class="_ _9"></span>already <span class="_ _9"></span>present <span class="_ _3"></span>on <span class="_ _23"></span>the <span class="_ _9"></span>stream. <span class="_ _45"> </span>If</span></div><div class="t m0 x32 h49 y53c6 ff19 fs26 fc0 sc0 ls0 ws0">so, <span class="_ _42"> </span>we <span class="_ _42"> </span>assume <span class="_ _23"> </span>that <span class="_ _42"> </span>the <span class="_ _42"> </span>stream <span class="_ _42"> </span>has <span class="_ _23"> </span>been <span class="_ _42"> </span>conﬁgured <span class="_ _42"> </span>by <span class="_ _42"> </span>the <span class="_ _23"> </span>autopush <span class="_ _42"> </span>mechanism <span class="_ _42"> </span>and</div><div class="t m0 x32 h49 y53c7 ff19 fs26 fc0 sc0 ls0 ws0">avoid pushing the modules a second time.</div><div class="t m0 x3f h49 y53c8 ff19 fs26 fc0 sc0 ls0 ws0">Linux, Mac <span class="_ _2"></span>OS <span class="_ _2"></span>X, <span class="_ _2"></span>and Solaris <span class="_ _2"></span>follow <span class="_ _2"></span>the <span class="_ _2"></span>historical System <span class="_ _2"></span>V <span class="_ _2"></span>behavior: <span class="_ _2"></span>if the <span class="_ _2"></span>caller <span class="_ _2"></span>is</div><div class="t m0 x32 h4d y53c9 ff19 fs26 fc0 sc0 ls15a6 ws0">as<span class="_ _55"></span><span class="ls0">ession <span class="_ _e"> </span>leader <span class="_ _e"> </span>that <span class="_ _e"> </span>does <span class="_ _e"> </span>not <span class="_ _e"> </span>already <span class="_ _53"> </span>have <span class="_ _e"> </span>a <span class="_ _e"> </span>controlling <span class="_ _53"> </span>terminal, <span class="_ _e"> </span>the <span class="_ _e"> </span>call <span class="_ _e"> </span>to<span class="_ _59"> </span><span class="ff1a">open</span></span></div><div class="t m0 x32 h49 y53ca ff19 fs26 fc0 sc0 ls0 ws0">allocates the <span class="_ _2"></span>PTY slave <span class="_ _2"></span>as the <span class="_ _2"></span>controlling terminal.<span class="_ _46"> </span>If we <span class="_ _2"></span>didn’t want <span class="_ _2"></span>this to <span class="_ _2"></span>happen, we</div><div class="t m0 x32 h4d y53cb ff19 fs26 fc0 sc0 ls0 ws0">could specify the<span class="_"> </span><span class="ff1a">O_NOCTTY<span class="_ _66"> </span></span>ﬂag for<span class="_"> </span><span class="ff1a">open</span><span class="ls15a7">.H<span class="_ _4a"></span><span class="ls0">owever<span class="_ _6"></span>,<span class="_"> </span>on<span class="_ _66"> </span>F<span class="lscc">re<span class="_ _2"></span></span>eBSD, the<span class="_"> </span><span class="ff1a">open<span class="_ _66"> </span></span>of the slave</span></span></div><div class="t m0 x32 h49 y53cc ff19 fs26 fc0 sc0 ls0 ws0">PTY <span class="_ _2"></span>does <span class="_ _2"></span>not <span class="_ _2"></span>have the <span class="_ _2"></span>side <span class="_ _2"></span>effect <span class="_ _2"></span>of <span class="_ _2"></span>allocating <span class="_ _2"></span>the <span class="_ _2"></span>device <span class="_ _2"></span>as <span class="_ _2"></span>the <span class="_ _2"></span>controlling terminal.<span class="_ _61"> </span>In</div><div class="t m0 x32 h49 y53cd ff19 fs26 fc0 sc0 ls0 ws0">the <span class="_ _42"> </span>next <span class="_ _53"> </span>section, <span class="_ _42"> </span>we’ll <span class="_ _53"> </span>see <span class="_ _42"> </span>how <span class="_ _53"> </span>to <span class="_ _53"> </span>allocate <span class="_ _42"> </span>the <span class="_ _53"> </span>controlling <span class="_ _42"> </span>terminal <span class="_ _42"> </span>when <span class="_ _53"> </span>running <span class="_ _42"> </span>on</div><div class="t m0 x32 h49 y53ce ff19 fs26 fc0 sc0 ls0 ws0">FreeBSD.</div><div class="t m0 x35 h7b y53cf ff16 fs27 fc0 sc0 ls0 ws0">19.4<span class="_ _6d"> </span><span class="ff1f">pty_fork<span class="_ _54"> </span></span>Function</div><div class="t m0 x32 h4d y53d0 ff19 fs26 fc0 sc0 ls164 ws0">We <span class="_ _e"> </span>n<span class="_ _9"></span><span class="ls0">ow <span class="_ _3"></span>use <span class="_ _2"></span>the <span class="_ _2"></span>two <span class="_ _3"></span>functions <span class="_ _2"></span>from <span class="_ _2"></span>the <span class="_ _2"></span>previous <span class="_ _2"></span>section,<span class="_ _66"> </span><span class="ff1a">ptym_open<span class="_ _47"> </span></span>and<span class="_ _47"> </span><span class="ff1a">ptys_open</span>,</span></div><div class="t m0 x32 h4d y53d1 ff19 fs26 fc0 sc0 ls0 ws0">to <span class="_"> </span>write <span class="_ _66"> </span>a <span class="_ _66"> </span>new <span class="_ _66"> </span>function <span class="_ _66"> </span>that <span class="_ _47"> </span>we <span class="_"> </span>call<span class="_ _61"> </span><span class="ff1a">pty_fork</span><span class="ls15a8">.T<span class="_ _49"></span><span class="ls0">his <span class="_"> </span>new <span class="_ _66"> </span>function <span class="_ _47"> </span>combines <span class="_"> </span>the</span></span></div><div class="t m0 x32 h4d y53d2 ff19 fs26 fc0 sc0 ls0 ws0">opening <span class="_ _42"> </span>of <span class="_ _53"> </span>the <span class="_ _53"> </span>master <span class="_ _53"> </span>and <span class="_ _53"> </span>the <span class="_ _53"> </span>slave <span class="_ _53"> </span>with <span class="_ _53"> </span>a <span class="_ _42"> </span>call <span class="_ _53"> </span>to<span class="_ _4b"> </span><span class="ff1a">fork</span><span class="ls15a9">,e<span class="_ _c"></span><span class="ls0">stablishing <span class="_ _53"> </span>the <span class="_ _53"> </span>child <span class="_ _53"> </span>as <span class="_ _53"> </span>a</span></span></div><div class="t m0 x32 h49 y53d3 ff19 fs26 fc0 sc0 ls0 ws0">session leader with a controlling terminal.</div><a class="l" href="#pf13" data-dest-detail='[19,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892409px;bottom:249.916807px;width:150.935798px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
