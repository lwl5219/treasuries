<div id="pf2b" class="pf w4 h1f" data-page-no="2b"><div class="pc pc2b w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg2b.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>1.5<span class="_ _83"> </span>Input <span class="_"> </span>and <span class="_"> </span>Output<span class="_ _1b"> </span><span class="ff18">9</span></div><div class="t m0 x32 h57 y362 ff1a fs2d fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h57 y363 ff1a fs2d fc0 sc0 ls0 ws0">#define BUFFSIZE<span class="_ _15"> </span>4096</div><div class="t m0 x32 h57 y364 ff1a fs2d fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h57 y365 ff1a fs2d fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 x32 h57 y366 ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y367 ff1a fs2d fc0 sc0 ls0 ws0">int <span class="_ _15"> </span>n;</div><div class="t m0 x8a h57 y368 ff1a fs2d fc0 sc0 ls0 ws0">char <span class="_ _68"> </span>buf[BUFFSIZE];</div><div class="t m0 x8a h57 y369 ff1a fs2d fc0 sc0 ls0 ws0">while ((n = read(STDIN_FILENO, buf, BUFFSIZE)) &gt; 0)</div><div class="t m0 x9d h57 y36a ff1a fs2d fc0 sc0 ls0 ws0">if (write(STDOUT_FILENO, buf, n) != n)</div><div class="t m0 x1f h57 y36b ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;write error&quot;);</div><div class="t m0 x8a h57 y36c ff1a fs2d fc0 sc0 ls0 ws0">if (n &lt; 0)</div><div class="t m0 x9d h57 y36d ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;read error&quot;);</div><div class="t m0 x8a h57 y36e ff1a fs2d fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h57 y36f ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 xab h2d y370 ff18 fs10 fc0 sc0 ls0 ws0">Figure 1.4<span class="_ _5a"> </span><span class="ff19">Copy standar<span class="ls136">di<span class="_ _84"></span><span class="ls0">nput to standar<span class="ls136">do<span class="_ _5"></span><span class="ls0">utput</span></span></span></span></span></div><div class="t m0 x32 h4d y371 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _47"> </span><span class="ff1a">&lt;unistd.h&gt;<span class="_ _47"> </span></span>header<span class="_ _1"></span><span class="ls137">,i<span class="_ _8"></span><span class="ls0">ncluded <span class="_ _3"></span>by<span class="_ _45"> </span><span class="ff1a">apue.h</span><span class="ls137">,a<span class="_ _b"></span><span class="ls0">nd <span class="_ _3"></span>the <span class="_ _9"></span>two <span class="_ _3"></span>constants<span class="_ _47"> </span><span class="ff1a">STDIN_FILENO</span></span></span></span></span></div><div class="t m0 x32 h4d y372 ff19 fs26 fc0 sc0 ls0 ws0">and<span class="_ _44"> </span><span class="ff1a">STDOUT_FILENO<span class="_ _4b"> </span></span>ar<span class="ls138">ep<span class="_ _55"></span><span class="ls0">art <span class="_ _53"> </span>of <span class="_ _e"> </span>the <span class="_ _53"> </span>POSIX <span class="_ _53"> </span>standar<span class="ls139">d(<span class="_ _55"></span><span class="ls0">about <span class="_ _e"> </span>which <span class="_ _53"> </span>we’ll <span class="_ _53"> </span>have <span class="_ _53"> </span>a <span class="_ _53"> </span>lot</span></span></span></span></div><div class="t m0 x32 h49 y373 ff19 fs26 fc0 sc0 ls0 ws0">more<span class="_ _66"> </span>to<span class="_ _47"> </span>say <span class="_ _3"></span>in <span class="_ _3"></span>the <span class="_ _3"></span>next <span class="_ _3"></span>chapter).<span class="_ _16"> </span>This <span class="_ _3"></span>header <span class="_ _3"></span>contains <span class="_ _3"></span>function <span class="_ _3"></span>prototypes <span class="_ _2"></span>for <span class="_ _3"></span>many <span class="_ _3"></span>of</div><div class="t m0 x32 h4d y374 ff19 fs26 fc0 sc0 ls0 ws0">the UNIX system services, such as the<span class="_"> </span><span class="ff1a">read<span class="_ _80"> </span></span>and<span class="_"> </span><span class="ff1a">write<span class="_ _66"> </span></span>functions that we call.</div><div class="t m0 x3f h4d y375 ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _23"> </span>constants<span class="_ _35"> </span><span class="ff1a">STDIN_FILENO<span class="_ _44"> </span></span>and<span class="_ _35"> </span><span class="ff1a">STDOUT_FILENO<span class="_ _35"> </span></span>ar<span class="ls13a">ed<span class="_ _43"></span><span class="ls0">eﬁned <span class="_ _23"></span>in<span class="_ _35"> </span><span class="ff1a">&lt;unistd.h&gt;</span></span></span></div><div class="t m0 x32 h49 y376 ff19 fs26 fc0 sc0 ls0 ws0">and <span class="_ _23"></span>specify <span class="_ _9"></span>the <span class="_ _23"></span>ﬁle <span class="_ _23"></span>descriptors <span class="_ _9"></span>for <span class="_ _23"> </span>standar<span class="ls13b">di<span class="_ _43"></span><span class="ls0">nput <span class="_ _23"> </span>and <span class="_ _23"></span>standar<span class="ls13b">do<span class="_ _43"></span><span class="ls0">utput. <span class="_ _35"> </span>These<span class="_ _45"> </span>values</span></span></span></span></div><div class="t m0 x32 h49 y377 ff19 fs26 fc0 sc0 ls0 ws0">ar<span class="ls13c">e0a<span class="_ _4f"></span><span class="ls0">nd 1, <span class="_ _2"></span>respectively<span class="_ _4"></span>,<span class="_"> </span>as<span class="_"> </span>required by POSIX.1, but <span class="_ _2"></span>we’ll use <span class="_ _2"></span>the names for <span class="_ _2"></span>readability<span class="_ _4"></span>.</span></span></div><div class="t m0 x3f h4d y378 ff19 fs26 fc0 sc0 ls0 ws0">In <span class="_ _9"></span>Section <span class="_ _9"></span>3.9, <span class="_ _9"></span>we’ll <span class="_ _9"></span>examine <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">BUFFSIZE<span class="_ _45"> </span></span>constant <span class="_ _9"></span>in <span class="_ _9"></span>detail, <span class="_ _9"></span>seeing <span class="_ _23"></span>how <span class="_ _9"></span>various</div><div class="t m0 x32 h49 y379 ff19 fs26 fc0 sc0 ls0 ws0">values <span class="_ _42"> </span>affect <span class="_ _53"> </span>the <span class="_ _42"> </span>efﬁciency <span class="_ _53"> </span>of <span class="_ _42"> </span>the <span class="_ _53"> </span>program. <span class="_ _44"> </span>Regardless <span class="_ _42"> </span>of <span class="_ _53"> </span>the <span class="_ _53"> </span>value <span class="_ _53"> </span>of <span class="_ _42"> </span>this <span class="_ _53"> </span>constant,</div><div class="t m0 x32 h49 y37a ff19 fs26 fc0 sc0 ls0 ws0">however<span class="_ _6"></span><span class="lsd3">,t<span class="_ _5"></span><span class="ls0">his program still copies any r<span class="_ _1"></span>egular ﬁle.</span></span></div><div class="t m0 x3f h4d y37b ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _66"> </span><span class="ff1a">read<span class="_ _47"> </span></span>function <span class="_ _2"></span>returns the <span class="_ _3"></span>number <span class="_ _2"></span>of <span class="_ _2"></span>bytes <span class="_ _2"></span>that <span class="_ _3"></span>ar<span class="ls13d">er<span class="_ _b"></span><span class="ls0">ead, <span class="_ _3"></span>and <span class="_ _2"></span>this <span class="_ _2"></span>value <span class="_ _2"></span>is <span class="_ _3"></span>used</span></span></div><div class="t m0 x32 h4d y37c ff19 fs26 fc0 sc0 ls0 ws0">as <span class="_ _9"></span>the <span class="_ _23"></span>number <span class="_ _9"></span>of <span class="_ _23"> </span>bytes <span class="_ _23"></span>to <span class="_ _9"></span>write.<span class="_ _51"> </span>When <span class="_ _9"></span>the <span class="_ _23"></span>end <span class="_ _9"></span>of <span class="_ _23"></span>the <span class="_ _9"></span>input <span class="_ _23"></span>ﬁle <span class="_ _23"></span>is <span class="_ _9"></span>encountered,<span class="_ _45"> </span><span class="ff1a">read</span></div><div class="t m0 x32 h4d y37d ff19 fs26 fc0 sc0 lscc ws0">re<span class="ls0">turns <span class="_ _23"></span>0 <span class="_ _9"></span>and <span class="_ _9"></span>the <span class="_ _9"></span>program <span class="_ _9"></span>stops.<span class="_ _5a"> </span>If <span class="_ _9"></span>a <span class="_ _23"></span>r<span class="_ _0"></span>ead <span class="_ _9"></span>error <span class="_ _9"></span>occurs,<span class="_ _45"> </span><span class="ff1a">read<span class="_ _45"> </span></span><span class="lscc">re<span class="_ _2"></span></span>turns<span class="_ _45"> </span><span class="ff20">−</span>1. <span class="_ _45"> </span>Most<span class="_ _45"> </span>of <span class="_ _9"></span>the</span></div><div class="t m0 x32 h49 y37e ff19 fs26 fc0 sc0 ls0 ws0">system functions return<span class="_"> </span><span class="ff20">−</span><span class="lsd3">1w<span class="_ _4f"></span><span class="ls0">hen an error occurs.</span></span></div><div class="t m0 x3f h4d y37f ff19 fs26 fc0 sc0 ls0 ws0">If we compile the program into the standar<span class="_ _0"></span><span class="lsd3">dn<span class="_ _d"></span><span class="ls0">ame (<span class="ff1a">a.out</span><span class="lsd3">)a<span class="_ _d"></span><span class="ls0">nd execute it as</span></span></span></span></div><div class="t m0 x3f h4e y380 ff1a fs28 fc0 sc0 ls0 ws0">./a.out &gt; data</div><div class="t m0 x32 h4d y381 ff19 fs26 fc0 sc0 ls0 ws0">standar<span class="ls13e">di<span class="_ _5b"></span><span class="ls0">nput <span class="_"> </span>is <span class="_"> </span>the <span class="_"> </span>terminal, <span class="_"> </span>standar<span class="ls13e">do<span class="_ _5b"></span><span class="ls0">utput <span class="_"> </span>is <span class="_"> </span>redirected <span class="_ _e"> </span>to <span class="_"> </span>the <span class="_"> </span>ﬁle<span class="_ _46"> </span><span class="ff1a">data</span><span class="ls13f">,a<span class="_ _4a"></span><span class="ls0">nd</span></span></span></span></span></span></div><div class="t m0 x32 h49 y382 ff19 fs26 fc0 sc0 ls0 ws0">standar<span class="ls140">de<span class="_ _8"></span><span class="ls0">rror <span class="_ _2"></span>is also <span class="_ _2"></span>the <span class="_ _2"></span>terminal.<span class="_ _61"> </span>If <span class="_ _2"></span>this output <span class="_ _2"></span>ﬁle <span class="_ _2"></span>doesn’t <span class="_ _2"></span>exist, <span class="_ _2"></span>the <span class="_ _2"></span>shell creates <span class="_ _2"></span>it by</span></span></div><div class="t m0 x32 h49 y383 ff19 fs26 fc0 sc0 ls0 ws0">default. <span class="_"> </span>The<span class="_ _66"> </span>program copies <span class="_ _2"></span>lines <span class="_ _2"></span>that we <span class="_ _2"></span>type <span class="_ _2"></span>to the <span class="_ _2"></span>standar<span class="ls141">do<span class="_ _4f"></span><span class="ls0">utput <span class="_ _2"></span>until we <span class="_ _2"></span>type <span class="_ _2"></span>the</span></span></div><div class="t m0 x32 h49 y384 ff19 fs26 fc0 sc0 ls0 ws0">end-of-ﬁle character (usually Control</div><div class="t m0 x99 h49 y385 ff19 fs26 fc0 sc0 ls0 ws0">-</div><div class="t m0 x9a h49 y384 ff19 fs26 fc0 sc0 ls0 ws0">D).</div><div class="t m0 x3f h49 y386 ff19 fs26 fc0 sc0 ls0 ws0">If we run</div><div class="t m0 x3f h4e y387 ff1a fs28 fc0 sc0 ls0 ws0">./a.out &lt; infile &gt; outfile</div><div class="t m0 x32 h4d y388 ff19 fs26 fc0 sc0 ls0 ws0">then the ﬁle named<span class="_"> </span><span class="ff1a">infile<span class="_ _80"> </span></span>will be copied to the ﬁle named<span class="_"> </span><span class="ff1a">outfile</span>.</div><div class="t m0 x3f h55 y389 ff19 fs2c fc0 sc0 ls0 ws0">In Chapter 3, we describe the unbuffer<span class="_ _0"></span>ed I/O functions in mor<span class="_ _0"></span><span class="ls142">ed<span class="_ _d"></span><span class="ls0">etail.</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
