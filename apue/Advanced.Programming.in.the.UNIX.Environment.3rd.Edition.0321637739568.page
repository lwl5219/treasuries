<div id="pf238" class="pf w4 h1f" data-page-no="238"><div class="pc pc238 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg238.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">534<span class="_ _1b"> </span><span class="ff19">Interprocess <span class="_"> </span>Communication<span class="_ _2c"> </span>Chapter <span class="_"> </span>15</span></div><div class="t m0 x1cd h51 y597 ff19 fs2a fc0 sc0 ls0 ws0">FreeBSD <span class="_ _72"> </span>Linux<span class="_ _17"> </span>Mac OS X<span class="_ _1fb"> </span>Solaris</div><div class="t m0 x7f h51 y598 ff19 fs2a fc0 sc0 ls0 ws0">8.0 <span class="_ _12c"> </span>3.2.0<span class="_ _db"> </span>10.6.8 <span class="_ _10b"> </span>10</div><div class="t m0 x227 h51 y599 ff19 fs2a fc0 sc0 ls0 ws0">IPC type<span class="_ _bd"> </span>SUS</div><div class="t m0 x33 h2d y59a ff19 fs10 fc0 sc0 ls0 ws0">half-duplex pipes<span class="_ _21b"> </span><span class="ls1145">•(<span class="_ _2b1"></span><span class="ls0">full) <span class="_ _dd"> </span>•<span class="_ _133"> </span><span class="ls1146">•(<span class="_ _2b2"></span><span class="ls0">full)</span></span></span></span></div><div class="t m0 x33 h2d y59b ff19 fs10 fc0 sc0 ls0 ws0">FIFOs <span class="_ _17f"> </span>•<span class="_ _137"> </span><span class="ls1147">••••</span></div><div class="t m0 x33 h2e y40ef ff19 fs11 fc0 sc0 ls0 ws0">full-duplex pipes<span class="_ _73"> </span>allowed <span class="_ _129"> </span>•,<span class="_"> </span>UDS <span class="_ _1c4"> </span>UDS<span class="_ _136"> </span>UDS <span class="_ _78"> </span>•,<span class="_"> </span>UDS</div><div class="t m0 x33 h2e y40f0 ff19 fs11 fc0 sc0 ls0 ws0">named full-duplex pipes<span class="_ _129"> </span>obsolescent <span class="_ _13"> </span>UDS<span class="_ _136"> </span>UDS <span class="_ _c0"> </span>UDS<span class="_ _dc"> </span>•, UDS</div><div class="t m0 x33 h2f y40f1 ff19 fs12 fc0 sc0 ls0 ws0">XSI message queues<span class="_ _7e"> </span>XSI <span class="_ _d7"> </span>•<span class="_ _133"> </span><span class="ls1148">•••</span></div><div class="t m0 x33 h2f y40f2 ff19 fs12 fc0 sc0 ls0 ws0">XSI semaphores <span class="_ _2b3"> </span>XSI<span class="_ _1e"> </span><span class="ls1148">••••</span></div><div class="t m0 x33 h2f y40f3 ff19 fs12 fc0 sc0 ls0 ws0">XSI shared memory<span class="_ _74"> </span>XSI <span class="_ _d7"> </span>•<span class="_ _133"> </span><span class="ls1148">•••</span></div><div class="t m0 x33 h30 y21db ff19 fs13 fc0 sc0 ls0 ws0">message queues (real-time) <span class="_ _5e"> </span>MSG<span class="_"> </span>option <span class="_ _1a8"> </span>•<span class="_ _133"> </span><span class="ls1149">••</span></div><div class="t m0 x33 h30 y40f4 ff19 fs13 fc0 sc0 ls0 ws0">semaphores <span class="_ _1a0"> </span>•<span class="_ _182"> </span><span class="ls114a">••••</span></div><div class="t m0 x33 h30 y40f5 ff19 fs13 fc0 sc0 ls0 ws0">shared memory (r<span class="_ _0"></span>eal-time) <span class="_ _141"> </span>SHM<span class="_"> </span>option <span class="_ _1a8"> </span>•<span class="_ _77"> </span><span class="ls114a">•••</span></div><div class="t m0 x33 h31 y40f6 ff19 fs14 fc0 sc0 ls0 ws0">sockets <span class="_ _2b4"> </span>•<span class="_ _137"> </span><span class="ls114b">••••</span></div><div class="t m0 x33 h31 y40f7 ff19 fs14 fc0 sc0 ls0 ws0">STREAMS <span class="_ _166"> </span>obsolescent<span class="_ _23d"> </span>•</div><div class="t m0 x224 h32 y40f8 ff18 fs15 fc0 sc0 ls0 ws0">Figure 15.1<span class="_ _5a"> </span><span class="ff19">Summary of UNIX System IPC</span></div><div class="t m0 x3f h67 y40f9 ff19 fs33 fc0 sc0 ls0 ws0">Named <span class="_ _3"></span>full-duplex <span class="_ _3"></span>pipes <span class="_ _3"></span>ar<span class="ls114c">ep<span class="_ _8"></span><span class="ls1d5">ro<span class="_ _2"></span><span class="ls0">vided <span class="_ _3"></span>as <span class="_ _3"></span>mounted <span class="_ _3"></span>STREAMS</span></span></span></div><div class="t m0 x11 h67 y40fa ff19 fs33 fc0 sc0 ls0 ws0">-</div><div class="t m0 x1fc h67 y40f9 ff19 fs33 fc0 sc0 ls0 ws0">based <span class="_ _3"></span>pipes, <span class="_ _3"></span>but <span class="_ _3"></span>are</div><div class="t m0 x32 h67 y40fb ff19 fs33 fc0 sc0 ls0 ws0">marked obsolescent in the Single UNIX Speciﬁcation.</div><div class="t m0 x76 h32 y40fc ff19 fs15 fc0 sc0 ls0 ws0">Although <span class="_ _2"></span>support <span class="_ _2"></span>for <span class="_ _3"></span>STREAMS <span class="_ _2"></span>on <span class="_ _2"></span>Linux <span class="_ _3"></span>is <span class="_ _2"></span>available <span class="_ _2"></span>in <span class="_ _3"></span>the <span class="_ _2"></span>‘‘Linux Fast-STREAMS’<span class="ls114d">’p<span class="_ _d"></span><span class="ls0">ackage</span></span></div><div class="t m0 x76 h32 y40fd ff19 fs15 fc0 sc0 ls0 ws0">from <span class="_ _2"></span>the <span class="_ _3"></span>OpenSS7 <span class="_ _3"></span>project, <span class="_ _3"></span>the <span class="_ _3"></span>package <span class="_ _3"></span>hasn’t <span class="_ _3"></span>been <span class="_ _3"></span>updated <span class="_ _3"></span>recently<span class="_ _6"></span><span class="ls114e">.T<span class="_ _55"></span><span class="ls0">he <span class="_ _3"></span>latest <span class="_ _3"></span>release <span class="_ _2"></span>of <span class="_ _3"></span>the</span></span></div><div class="t m0 x76 h32 y40fe ff19 fs15 fc0 sc0 ls0 ws0">package from 2008 claims to work with kernels up to Linux 2.6.26.</div><div class="t m0 x3f h67 y40ff ff19 fs33 fc0 sc0 ls0 ws0">The <span class="_"> </span>ﬁrst <span class="_ _e"> </span>ten <span class="_"> </span>forms <span class="_"> </span>of <span class="_ _e"> </span>IPC <span class="_"> </span>in <span class="_ _e"> </span>Figur<span class="ls114f">e1<span class="_ _4a"></span><span class="ls0">5.1 <span class="_"> </span>ar<span class="_ _0"></span><span class="ls1150">eu<span class="_ _4a"></span><span class="ls0">sually <span class="_"> </span>restricted <span class="_ _e"> </span>to <span class="_"> </span>IPC <span class="_ _e"> </span>between</span></span></span></span></div><div class="t m0 x32 h67 y4100 ff19 fs33 fc0 sc0 ls0 ws0">processes on <span class="_ _3"></span>the <span class="_ _2"></span>same <span class="_ _3"></span>host.<span class="_ _61"> </span>The <span class="_ _3"></span>ﬁnal <span class="_ _2"></span>two <span class="_ _3"></span>rows <span class="_ _84"></span>— <span class="_ _4"></span>sockets<span class="_"> </span>and <span class="_ _3"></span>STREAMS<span class="_ _9"></span><span class="ls1151">—a<span class="_ _6"></span><span class="ls1d5">re <span class="_ _9"></span>t<span class="_ _2"></span><span class="ls0">he <span class="_ _2"></span>only</span></span></span></div><div class="t m0 x32 h67 y4101 ff19 fs33 fc0 sc0 ls0 ws0">two forms that ar<span class="ls1d7">eg<span class="_ _4f"></span><span class="ls0">enerally supported for IPC between processes on differ<span class="_ _0"></span>ent hosts.</span></span></div><div class="t m0 x3f h67 y4102 ff19 fs33 fc0 sc0 ls1d9 ws0">We <span class="_ _35"> </span>h<span class="_ _23"></span><span class="ls0">ave <span class="_ _e"> </span>divided <span class="_ _e"> </span>the <span class="_"> </span>discussion <span class="_ _53"> </span>of <span class="_"> </span>IPC <span class="_ _53"> </span>into <span class="_"> </span>thr<span class="_ _0"></span>ee <span class="_ _e"> </span>chapters.<span class="_ _48"> </span>In <span class="_"> </span>this <span class="_ _53"> </span>chapter<span class="_ _1"></span><span class="ls1152">,w<span class="_ _55"></span><span class="ls0">e</span></span></span></div><div class="t m0 x32 h67 y4103 ff19 fs33 fc0 sc0 ls0 ws0">examine <span class="_ _2"></span>classical <span class="_ _3"></span>IPC: <span class="_ _3"></span>pipes, <span class="_ _3"></span>FIFOs, <span class="_ _2"></span>message <span class="_ _3"></span>queues, <span class="_ _3"></span>semaphores, <span class="_ _2"></span>and <span class="_ _3"></span>shared <span class="_ _2"></span>memory<span class="_ _6"></span>.</div><div class="t m0 x32 h67 y4104 ff19 fs33 fc0 sc0 ls0 ws0">In <span class="_ _42"> </span>the <span class="_ _23"> </span>next <span class="_ _42"> </span>chapter<span class="_ _1"></span>,<span class="_ _35"> </span>we<span class="_ _44"> </span>take <span class="_ _42"> </span>a <span class="_ _23"> </span>look <span class="_ _42"> </span>at <span class="_ _42"> </span>network <span class="_ _42"> </span>IPC <span class="_ _42"> </span>using <span class="_ _23"> </span>the <span class="_ _42"> </span>sockets <span class="_ _42"> </span>mechanism.<span class="_ _51"> </span>In</div><div class="t m0 x32 h67 y4105 ff19 fs33 fc0 sc0 ls0 ws0">Chapter 17, we take a look at some advanced features of IPC.</div><div class="t m0 x35 hec y4106 ff16 fs80 fc0 sc0 ls0 ws0">15.2 <span class="_ _93"> </span>Pipes</div><div class="t m0 x32 h67 y4107 ff19 fs33 fc0 sc0 ls0 ws0">Pipes <span class="_ _9"></span>ar<span class="ls1153">et<span class="_ _b"></span><span class="ls0">he <span class="_ _3"></span>oldest <span class="_ _9"></span>form <span class="_ _9"></span>of <span class="_ _9"></span>UNIX <span class="_ _9"></span>System <span class="_ _9"></span>IPC <span class="_ _9"></span>and <span class="_ _9"></span>ar<span class="ls1153">ep<span class="_ _b"></span><span class="ls1d5">ro<span class="ls0">vided <span class="_ _9"></span>by <span class="_ _9"></span>all <span class="_ _9"></span>UNIX <span class="_ _9"></span>systems.</span></span></span></span></span></div><div class="t m0 x32 h67 y4108 ff19 fs33 fc0 sc0 ls0 ws0">Pipes have two limitations.</div><div class="t m0 x3f h67 y4109 ff19 fs33 fc0 sc0 ls0 ws0">1. <span class="_ _51"> </span>Historically<span class="_ _4"></span><span class="ls1154">,t<span class="_ _b"></span><span class="ls0">hey <span class="_ _23"></span>have <span class="_ _9"></span>been <span class="_ _9"></span>half <span class="_ _9"></span>duplex <span class="_ _9"></span>(i.e., <span class="_ _9"></span>data <span class="_ _23"></span>ﬂows <span class="_ _9"></span>in <span class="_ _9"></span>only <span class="_ _9"></span>one <span class="_ _9"></span>direction).</span></span></div><div class="t m0 x41 h67 y410a ff19 fs33 fc0 sc0 ls0 ws0">Some <span class="_ _3"></span>systems <span class="_ _3"></span>now <span class="_ _9"></span>provide <span class="_ _2"></span>full-duplex <span class="_ _9"></span>pipes, <span class="_ _3"></span>but <span class="_ _3"></span>for <span class="_ _9"></span>maximum <span class="_ _3"></span>portability<span class="_ _6"></span><span class="ls1155">,w<span class="_ _8"></span><span class="ls0">e</span></span></div><div class="t m0 x41 h67 y410b ff19 fs33 fc0 sc0 ls0 ws0">should never assume that this is the case.</div><div class="t m0 x3f h67 y410c ff19 fs33 fc0 sc0 ls0 ws0">2. <span class="_ _51"> </span>Pipes<span class="_ _5a"> </span>can <span class="_ _45"> </span>be <span class="_ _45"> </span>used <span class="_ _45"> </span>only <span class="_ _45"> </span>between <span class="_ _45"> </span>processes <span class="_ _47"> </span>that <span class="_ _45"> </span>have <span class="_ _45"> </span>a <span class="_ _45"> </span>common <span class="_ _45"> </span>ancestor<span class="_ _1"></span>.</div><div class="t m0 x41 h68 y410d ff19 fs33 fc0 sc0 ls0 ws0">Normally<span class="_ _4"></span><span class="ls1156">,ap<span class="_ _4f"></span><span class="ls0">ipe <span class="_ _3"></span>is <span class="_ _2"></span>created by <span class="_ _2"></span>a <span class="_ _2"></span>process, <span class="_ _2"></span>that <span class="_ _2"></span>process calls<span class="_ _47"> </span><span class="ff1a">fork</span><span class="ls1156">,a<span class="_ _4f"></span><span class="ls0">nd <span class="_ _2"></span>the <span class="_ _2"></span>pipe <span class="_ _2"></span>is</span></span></span></span></div><div class="t m0 x41 h67 y410e ff19 fs33 fc0 sc0 ls0 ws0">used between the parent and the child.</div><div class="t m0 x32 h67 y410f ff19 fs33 fc0 sc0 ls1d9 ws0">We<span class="_ _9"></span><span class="ls0">’ll <span class="_ _53"> </span>see <span class="_ _53"> </span>that <span class="_ _e"> </span>FIFOs <span class="_ _53"> </span>(Section <span class="_ _53"> </span>15.5) <span class="_ _e"> </span>get <span class="_ _53"> </span>around <span class="_ _53"> </span>the <span class="_ _53"> </span>second <span class="_ _53"> </span>limitation, <span class="_ _53"> </span>and <span class="_ _e"> </span>that <span class="_ _53"> </span>UNIX</span></div><div class="t m0 x32 h67 y4110 ff19 fs33 fc0 sc0 ls0 ws0">domain sockets (Section 17.2) get around both limitations.</div><a class="l" href="#pf11" data-dest-detail='[17,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.894941px;bottom:443.333132px;width:68.016594px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
