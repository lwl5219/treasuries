<div id="pf14c" class="pf w4 h1f" data-page-no="14c"><div class="pc pc14c w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg14c.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">298<span class="_ _1b"> </span><span class="ff19">Process <span class="_"> </span>Relationships<span class="_ _18d"> </span>Chapter <span class="_"> </span>9</span></div><div class="t m0 x19a h51 y597 ff19 fs2a fc0 sc0 ls0 ws0">FreeBSD <span class="_ _141"> </span>Linux<span class="_ _3a"> </span>Mac OS X<span class="_ _7f"> </span>Solaris</div><div class="t m0 x114 h51 y598 ff19 fs2a fc0 sc0 ls0 ws0">8.0 <span class="_ _215"> </span>3.2.0<span class="_ _76"> </span>10.6.8 <span class="_ _bf"> </span>10</div><div class="t m0 x12b h51 y599 ff19 fs2a fc0 sc0 ls0 ws0">Method</div><div class="t m0 x1b0 h5e y59a ff1a fs10 fc0 sc0 ls0 ws0">open<span class="_ _53"> </span><span class="ff19">without<span class="_"> </span></span>O_NOCTTY<span class="_ _122"> </span><span class="ff19 ls76e">•••</span></div><div class="t m0 x1b0 h5e y59b ff1a fs10 fc0 sc0 ls0 ws0">TIOCSCTTY ioctl<span class="_ _53"> </span><span class="ff19">command <span class="_ _1a8"> </span>•<span class="_ _2e"> </span><span class="ls76e">•••</span></span></div><div class="t m0 x13a h2e y2662 ff18 fs11 fc0 sc0 ls0 ws0">Figure 9.8<span class="_ _5a"> </span><span class="ff19">How various implementations allocate controlling terminals</span></div><div class="t m0 x3f h55 y2663 ff19 fs2c fc0 sc0 ls0 ws0">Ther<span class="lsb2d">ea<span class="_ _4f"></span><span class="ls150">re <span class="_ _3"></span>t<span class="ls0">imes when a program wants to talk to the controlling terminal, r<span class="_ _0"></span>egardless</span></span></span></div><div class="t m0 x32 h55 y2664 ff19 fs2c fc0 sc0 ls0 ws0">of <span class="_ _42"> </span>whether <span class="_ _42"> </span>the <span class="_ _42"> </span>standar<span class="lsb2e">di<span class="_ _c"></span><span class="ls0">nput <span class="_ _42"> </span>or <span class="_ _42"> </span>standar<span class="lsb2e">do<span class="_ _c"></span><span class="ls0">utput <span class="_ _42"> </span>is <span class="_ _42"> </span>redirected. <span class="_ _35"> </span>The<span class="_ _44"> </span>way <span class="_ _42"> </span>a <span class="_ _42"> </span>pr<span class="_ _0"></span>ogram</span></span></span></span></div><div class="t m0 x32 h54 y2665 ff19 fs2c fc0 sc0 ls0 ws0">guarantees <span class="_ _23"> </span>that <span class="_ _23"> </span>it <span class="_ _42"> </span>is <span class="_ _23"> </span>talking <span class="_ _42"> </span>to <span class="_ _23"></span>the <span class="_ _23"> </span>controlling <span class="_ _23"> </span>terminal <span class="_ _23"> </span>is <span class="_ _42"> </span>to<span class="_ _35"> </span><span class="ff1a">open<span class="_ _35"> </span></span>the <span class="_ _23"> </span>ﬁle<span class="_ _35"> </span><span class="ff1a">/dev/tty</span>.</div><div class="t m0 x32 h55 y2666 ff19 fs2c fc0 sc0 ls0 ws0">This <span class="_ _3"></span>special <span class="_ _3"></span>ﬁle <span class="_ _9"></span>is <span class="_ _3"></span>a <span class="_ _9"></span>synonym <span class="_ _3"></span>within <span class="_ _3"></span>the <span class="_ _9"></span>kernel <span class="_ _3"></span>for <span class="_ _9"></span>the <span class="_ _3"></span>controlling <span class="_ _3"></span>terminal.<span class="_ _16"> </span>Naturally<span class="_ _6"></span>,</div><div class="t m0 x32 h54 y2667 ff19 fs2c fc0 sc0 ls0 ws0">if the program doesn’t have a contr<span class="_ _0"></span>olling terminal, the<span class="_"> </span><span class="ff1a">open<span class="_ _80"> </span></span>of this device will fail.</div><div class="t m0 x3f h54 y2668 ff19 fs2c fc0 sc0 ls0 ws0">The <span class="_"> </span>classic <span class="_ _53"> </span>example <span class="_"> </span>is <span class="_ _e"> </span>the<span class="_ _59"> </span><span class="ff1a">getpass</span></div><div class="t m0 x67 h55 y2669 ff19 fs2c fc0 sc0 ls0 ws0">(</div><div class="t m0 x1cd h55 y2668 ff19 fs2c fc0 sc0 ls0 ws0">3</div><div class="t m0 xca h55 y2669 ff19 fs2c fc0 sc0 ls0 ws0">)</div><div class="t m0 x74 h55 y2668 ff19 fs2c fc0 sc0 ls0 ws0">function, <span class="_"> </span>which <span class="_ _53"> </span>reads <span class="_"> </span>a <span class="_ _53"> </span>passwor<span class="lsb2f">d(<span class="_ _4a"></span><span class="ls0">with</span></span></div><div class="t m0 x32 h54 y266a ff19 fs2c fc0 sc0 ls0 ws0">terminal echoing turned off, of course).<span class="_ _59"> </span>This function is called by the<span class="_"> </span><span class="ff1a">crypt</span></div><div class="t m0 x204 h55 y266b ff19 fs2c fc0 sc0 ls0 ws0">(</div><div class="t m0 x20a h55 y266a ff19 fs2c fc0 sc0 ls0 ws0">1</div><div class="t m0 x1a2 h55 y266b ff19 fs2c fc0 sc0 ls0 ws0">)</div><div class="t m0 xd6 h55 y266a ff19 fs2c fc0 sc0 ls0 ws0">program</div><div class="t m0 x32 h55 y266c ff19 fs2c fc0 sc0 ls0 ws0">and can be used in a pipeline.<span class="_ _59"> </span>For example,</div><div class="t m0 x3f h5d y266d ff1a fs2f fc0 sc0 ls0 ws0">crypt &lt; salaries | lpr</div><div class="t m0 x32 h54 y266e ff19 fs2c fc0 sc0 ls0 ws0">decrypts <span class="_ _9"></span>the <span class="_ _9"></span>ﬁle<span class="_ _45"> </span><span class="ff1a">salaries<span class="_ _45"> </span></span>and <span class="_ _9"></span>pipes <span class="_ _23"></span>the <span class="_ _9"></span>output <span class="_ _9"></span>to <span class="_ _9"></span>the <span class="_ _9"></span>print <span class="_ _9"></span>spooler<span class="_ _1"></span><span class="lsb30">.B<span class="_ _62"></span><span class="ls0">ecause<span class="_ _45"> </span><span class="ff1a">crypt</span></span></span></div><div class="t m0 x32 h55 y266f ff19 fs2c fc0 sc0 ls150 ws0">re<span class="ls0">ads <span class="_ _23"></span>its <span class="_ _9"></span>input <span class="_ _9"></span>ﬁle <span class="_ _23"></span>on <span class="_ _9"></span>its <span class="_ _9"></span>standar<span class="lsb31">di<span class="_ _b"></span><span class="ls0">nput, <span class="_ _9"></span>the <span class="_ _9"></span>standar<span class="lsb31">di<span class="_ _b"></span><span class="ls0">nput <span class="_ _9"></span>can’t <span class="_ _9"></span>be <span class="_ _9"></span>used <span class="_ _23"></span>to <span class="_ _9"></span>enter <span class="_ _9"></span>the</span></span></span></span></span></div><div class="t m0 x32 h54 y2670 ff19 fs2c fc0 sc0 ls0 ws0">password. <span class="_ _47"> </span>Also,<span class="_ _45"> </span><span class="ff1a">crypt<span class="_ _45"> </span></span>is <span class="_ _9"></span>designed <span class="_ _9"></span>so <span class="_ _9"></span>that <span class="_ _9"></span>we <span class="_ _9"></span>have <span class="_ _9"></span>to <span class="_ _23"></span>enter <span class="_ _3"></span>the <span class="_ _23"></span>encryption <span class="_ _3"></span>password</div><div class="t m0 x32 h55 y2671 ff19 fs2c fc0 sc0 ls0 ws0">each <span class="_ _2"></span>time <span class="_ _3"></span>we <span class="_ _3"></span>run <span class="_ _2"></span>the <span class="_ _3"></span>program, <span class="_ _2"></span>to <span class="_ _3"></span>prevent <span class="_ _2"></span>us <span class="_ _3"></span>from <span class="_ _2"></span>saving <span class="_ _3"></span>the <span class="_ _3"></span>password<span class="_ _66"> </span>in<span class="_ _47"> </span>a<span class="_ _47"> </span>ﬁle <span class="_ _3"></span>(which</div><div class="t m0 x32 h55 y2672 ff19 fs2c fc0 sc0 ls0 ws0">could be a security hole).</div><div class="t m0 x3f h54 y2673 ff19 fs2c fc0 sc0 ls0 ws0">Ther<span class="lsb32">ea<span class="_ _55"></span><span class="ls150">re <span class="_"> </span>k<span class="ls0">nown <span class="_ _53"> </span>ways <span class="_ _53"> </span>to <span class="_ _53"> </span>break <span class="_ _53"> </span>the <span class="_ _53"> </span>encoding <span class="_ _53"> </span>used <span class="_ _53"> </span>by <span class="_ _53"> </span>the<span class="_ _4b"> </span><span class="ff1a">crypt<span class="_ _44"> </span></span>program. <span class="_ _44"> </span>See</span></span></span></div><div class="t m0 x32 h55 y2674 ff19 fs2c fc0 sc0 ls0 ws0">Garﬁnkel et al.</div><div class="t m0 x13a h55 y2675 ff19 fs2c fc0 sc0 ls0 ws0">[</div><div class="t m0 x6 h55 y2674 ff19 fs2c fc0 sc0 ls0 ws0">2003</div><div class="t m0 xe9 h55 y2675 ff19 fs2c fc0 sc0 ls0 ws0">]</div><div class="t m0 x30 h55 y2674 ff19 fs2c fc0 sc0 ls0 ws0">for mor<span class="ls142">ed<span class="_ _4f"></span><span class="ls0">etails on encrypting ﬁles.</span></span></div><div class="t m0 x35 h7d y2676 ff16 fs3b fc0 sc0 ls0 ws0">9.7<span class="_ _72"> </span><span class="ff1f">tcgetpgrp</span>,<span class="_ _54"> </span><span class="ff1f">tcsetpgrp</span><span class="lsb33">,a<span class="_ _52"></span><span class="ls0">nd<span class="_ _54"> </span><span class="ff1f">tcgetsid<span class="_ _65"> </span></span>Functions</span></span></div><div class="t m0 x32 h55 y2677 ff19 fs2c fc0 sc0 ls155 ws0">We <span class="_ _80"> </span>n<span class="_ _9"></span><span class="ls0">eed <span class="_ _3"></span>a <span class="_ _3"></span>way <span class="_ _3"></span>to <span class="_ _9"></span>tell <span class="_ _2"></span>the <span class="_ _9"></span>kernel <span class="_ _3"></span>which <span class="_ _3"></span>process <span class="_ _2"></span>group <span class="_ _3"></span>is <span class="_ _3"></span>the <span class="_ _3"></span>foregr<span class="_ _0"></span>ound <span class="_ _3"></span>process <span class="_ _2"></span>group,</span></div><div class="t m0 x32 h55 y2678 ff19 fs2c fc0 sc0 ls0 ws0">so <span class="_ _53"> </span>that <span class="_ _e"> </span>the <span class="_ _e"> </span>terminal <span class="_ _53"> </span>device <span class="_ _e"> </span>driver <span class="_ _e"> </span>knows <span class="_ _53"> </span>where<span class="_ _4b"> </span>to<span class="_ _4b"> </span>send <span class="_ _e"> </span>the <span class="_ _53"> </span>terminal <span class="_ _e"> </span>input <span class="_ _e"> </span>and <span class="_ _53"> </span>the</div><div class="t m0 x32 h55 y2679 ff19 fs2c fc0 sc0 ls0 ws0">terminal-generated signals (Figur<span class="ls142">e9<span class="_ _4f"></span><span class="ls0">.7).</span></span></div><div class="t m0 x3f h5d y267a ff1a fs2f fc0 sc0 ls0 ws0">#include &lt;unistd.h&gt;</div><div class="t m0 x3f h5d y267b ff1a fs2f fc0 sc0 ls0 ws0">pid_t tcgetpgrp(int<span class="_"> </span><span class="ff1b">fd</span>);</div><div class="t m0 x132 hc2 y267c ff19 fs2f fc0 sc0 ls0 ws0">Returns: process gr<span class="_ _0"></span>oup ID of foregr<span class="_ _0"></span>ound process gr<span class="_ _1"></span>oup if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x3f h5d y267d ff1a fs2f fc0 sc0 ls0 ws0">int tcsetpgrp(int<span class="_"> </span><span class="ff1b">fd</span><span class="ls395">,p<span class="_ _1d"></span><span class="ls0">id_t<span class="_"> </span><span class="ff1b">pgrpid</span>);</span></span></div><div class="t m0 x153 hc2 y267e ff19 fs2f fc0 sc0 ls0 ws0">Returns: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h5c y267f ff19 fs29 fc0 sc0 ls0 ws0">The function<span class="_ _47"> </span><span class="ff1a">tcgetpgrp<span class="_ _66"> </span></span><span class="lsdf">re<span class="_ _2"></span></span>turns <span class="_ _2"></span>the <span class="_ _2"></span>process group ID <span class="_ _2"></span>of <span class="_ _2"></span>the <span class="_ _2"></span>foreground process group</div><div class="t m0 x32 h5b y2680 ff19 fs29 fc0 sc0 ls0 ws0">associated with the terminal open on<span class="_"> </span><span class="ff1b">fd</span>.</div><div class="t m0 x3f h5c y2681 ff19 fs29 fc0 sc0 ls0 ws0">If <span class="_ _3"></span>the <span class="_ _3"></span>process <span class="_ _3"></span>has <span class="_ _9"></span>a <span class="_ _3"></span>controlling <span class="_ _2"></span>terminal, <span class="_ _9"></span>the <span class="_ _3"></span>process <span class="_ _3"></span>can <span class="_ _3"></span>call<span class="_ _45"> </span><span class="ff1a">tcsetpgrp<span class="_ _47"> </span></span>to <span class="_ _3"></span>set <span class="_ _9"></span>the</div><div class="t m0 x32 h5b y2682 ff19 fs29 fc0 sc0 ls0 ws0">foregr<span class="_ _0"></span>ound <span class="_ _3"></span>process <span class="_ _3"></span>group <span class="_ _9"></span>ID <span class="_ _3"></span>to<span class="_ _45"> </span><span class="ff1b">pgrpid</span><span class="lsb34">.T<span class="_ _62"></span><span class="ls0">he <span class="_ _9"></span>value <span class="_ _9"></span>of<span class="_ _45"> </span><span class="ff1b">pgrpid<span class="_ _47"> </span></span>must <span class="_ _9"></span>be <span class="_ _9"></span>the <span class="_ _3"></span>process <span class="_ _9"></span>group</span></span></div><div class="t m0 x32 h5b y2683 ff19 fs29 fc0 sc0 ls0 ws0">ID <span class="_ _3"></span>of <span class="_ _3"></span>a <span class="_ _3"></span>process <span class="_ _3"></span>group <span class="_ _3"></span>in <span class="_ _3"></span>the <span class="_ _3"></span>same <span class="_ _3"></span>session, <span class="_ _9"></span>and<span class="_ _47"> </span><span class="ff1b">fd<span class="_ _47"> </span></span>must <span class="_ _9"></span>refer <span class="_ _2"></span>to <span class="_ _3"></span>the <span class="_ _3"></span>controlling <span class="_ _3"></span>terminal</div><div class="t m0 x32 h50 y2684 ff19 fs29 fc0 sc0 ls0 ws0">of the session.</div><a class="l" href="#pff" data-dest-detail='[15,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.894300px;bottom:561.686986px;width:335.232918px;height:19.680023px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
