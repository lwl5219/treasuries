<div id="pf1e5" class="pf w4 h1f" data-page-no="1e5"><div class="pc pc1e5 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg1e5.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>12.7<span class="_ _f1"> </span>Cancel <span class="_"> </span>Options<span class="_ _1b"> </span><span class="ff18">451</span></div><div class="t m0 x35 h53 y12f ff16 fs2b fc0 sc0 ls0 ws0">12.7 <span class="_ _93"> </span>Cancel<span class="_ _54"> </span>Options</div><div class="t m0 x32 h26 y1403 ff19 fsf fc0 sc0 lsbc ws0">Tw<span class="_ _9"></span><span class="ls95a">ot<span class="_ _b"></span><span class="ls0">hread <span class="_ _9"></span>attributes <span class="_ _9"></span>that <span class="_ _9"></span>ar<span class="ls95a">en<span class="_ _b"></span><span class="ls0">ot <span class="_ _9"></span>included <span class="_ _23"></span>in <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">pthread_attr_t<span class="_ _45"> </span></span>structur<span class="lsf06">ea<span class="_ _b"></span><span class="ls45">re <span class="_ _23"></span>t<span class="ls0">he</span></span></span></span></span></span></span></div><div class="t m0 x32 h2b y1404 ff1b fsf fc0 sc0 ls0 ws0">cancelability <span class="_"> </span>state<span class="_ _4b"> </span><span class="ff19">and <span class="_"> </span>the<span class="_ _59"> </span></span>cancelability <span class="_"> </span>type<span class="ff19 lsf07">.T<span class="_ _5d"></span><span class="ls0">hese <span class="_"> </span>attributes <span class="_"> </span>af<span class="_ _0"></span>fect <span class="_"> </span>the <span class="_ _e"> </span>behavior <span class="_"> </span>of <span class="_"> </span>a</span></span></div><div class="t m0 x32 h26 y1405 ff19 fsf fc0 sc0 ls0 ws0">thread in r<span class="_ _0"></span>esponse to a call to<span class="_"> </span><span class="ff1a">pthread_cancel<span class="_ _80"> </span></span>(Section 1<span class="_ _1"></span>1.5).</div><div class="t m0 x3f h26 y34a5 ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _60"> </span><span class="ff1b">cancelability <span class="_ _61"> </span>state<span class="_ _60"> </span></span>attribute <span class="_ _61"> </span>can <span class="_ _46"> </span>be <span class="_ _61"> </span>either<span class="_ _60"> </span><span class="ff1a">PTHREAD_CANCEL_ENABLE<span class="_ _50"> </span></span>or</div><div class="t m0 x32 h26 y34a6 ff1a fsf fc0 sc0 ls0 ws0">PTHREAD_CANCEL_DISABLE<span class="ff19 lsf08">.A<span class="_ _d"></span><span class="ls0">thread <span class="_ _47"> </span>can <span class="_ _66"> </span>change <span class="_ _47"> </span>its<span class="_ _16"> </span><span class="ff1b">cancelability <span class="_ _47"> </span>state<span class="_ _16"> </span></span>by <span class="_ _47"> </span>calling</span></span></div><div class="t m0 x32 h26 y34a7 ff1a fsf fc0 sc0 ls0 ws0">pthread_setcancelstate<span class="ff19">.</span></div><div class="t m0 x3f h57 y381f ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;pthread.h&gt;</div><div class="t m0 x3f h57 y3820 ff1a fs2d fc0 sc0 ls0 ws0">int pthread_setcancelstate(int<span class="_"> </span><span class="ff1b">state</span><span class="ls15c">,i<span class="_ _1d"></span><span class="ls0">nt *<span class="ff1b">oldstate</span>);</span></span></div><div class="t m0 x78 h5f y3821 ff19 fs2d fc0 sc0 ls0 ws0">Returns: 0 if OK, error number on failur<span class="_ _0"></span>e</div><div class="t m0 x32 h4d y3822 ff19 fs26 fc0 sc0 ls0 ws0">In <span class="_ _2"></span>one <span class="_ _2"></span>atomic <span class="_ _3"></span>operation,<span class="_ _47"> </span><span class="ff1a">pthread_setcancelstate<span class="_ _66"> </span></span>sets <span class="_ _2"></span>the <span class="_ _3"></span>current<span class="_ _66"> </span><span class="ff1b">cancelability <span class="_ _2"></span>state</span></div><div class="t m0 x32 h4a y3823 ff19 fs26 fc0 sc0 ls0 ws0">to<span class="_ _45"> </span><span class="ff1b">state<span class="_ _45"> </span></span>and <span class="_ _9"></span>stores <span class="_ _9"></span>the <span class="_ _9"></span>previous<span class="_ _45"> </span><span class="ff1b">cancelability <span class="_ _9"></span>state<span class="_ _45"> </span></span>in <span class="_ _23"></span>the <span class="_ _9"></span>memory <span class="_ _9"></span>location <span class="_ _9"></span>pointed <span class="_ _23"></span>to <span class="_ _9"></span>by</div><div class="t m0 x32 h4a y3824 ff1b fs26 fc0 sc0 ls0 ws0">oldstate<span class="ff19">.</span></div><div class="t m0 x3f h4d y3825 ff19 fs26 fc0 sc0 ls0 ws0">Recall from Section <span class="_ _2"></span>1<span class="_ _1"></span>1.5 <span class="_ _2"></span>that <span class="_ _2"></span>a call <span class="_ _2"></span>to<span class="_ _66"> </span><span class="ff1a">pthread_cancel<span class="_ _66"> </span></span>doesn’t <span class="_ _2"></span>wait for <span class="_ _2"></span>a <span class="_ _2"></span>thread to</div><div class="t m0 x32 h49 y3826 ff19 fs26 fc0 sc0 ls0 ws0">terminate. <span class="_ _4b"> </span>In<span class="_ _44"> </span>the <span class="_ _e"> </span>default <span class="_ _53"> </span>case, <span class="_ _e"> </span>a <span class="_ _53"> </span>thread <span class="_ _53"> </span>will <span class="_ _53"> </span>continue <span class="_ _e"> </span>to <span class="_ _53"> </span>execute <span class="_ _e"> </span>after <span class="_ _53"> </span>a <span class="_ _e"> </span>cancellation</div><div class="t m0 x32 h4a y3827 ff19 fs26 fc0 sc0 lscc ws0">re<span class="ls0">quest <span class="_ _42"> </span>is <span class="_ _23"> </span>made <span class="_ _42"> </span>until <span class="_ _23"> </span>the <span class="_ _42"> </span>thr<span class="_ _0"></span>ead <span class="_ _23"> </span>reaches <span class="_ _23"> </span>a<span class="_ _35"> </span><span class="ff1b">cancellation <span class="_ _42"> </span>point</span><span class="ls7b2">.A<span class="_ _d"></span><span class="ls0">cancellation <span class="_ _23"> </span>point <span class="_ _42"> </span>is <span class="_ _23"> </span>a</span></span></span></div><div class="t m0 x32 h49 y3828 ff19 fs26 fc0 sc0 ls0 ws0">place <span class="_ _e"> </span>wher<span class="lsd36">et<span class="_ _4a"></span><span class="ls0">he <span class="_"> </span>thr<span class="_ _0"></span>ead <span class="_ _e"> </span>checks <span class="_"> </span>whether <span class="_ _53"> </span>it <span class="_"> </span>has <span class="_ _53"> </span>been <span class="_"> </span>canceled, <span class="_ _e"> </span>and <span class="_ _e"> </span>if <span class="_"> </span>so, <span class="_ _53"> </span>acts <span class="_"> </span>on <span class="_ _e"> </span>the</span></span></div><div class="t m0 x32 h49 y3829 ff19 fs26 fc0 sc0 lscc ws0">re<span class="ls0">quest. <span class="_ _47"> </span>POSIX.1<span class="_ _66"> </span>guarantees <span class="_ _2"></span>that <span class="_ _3"></span>cancellation <span class="_ _2"></span>points <span class="_ _2"></span>will <span class="_ _2"></span>occur <span class="_ _2"></span>when <span class="_ _3"></span>a <span class="_ _2"></span>thread calls <span class="_ _3"></span>any</span></div><div class="t m0 x32 h49 y382a ff19 fs26 fc0 sc0 ls0 ws0">of the functions listed in Figur<span class="lsd3">e1<span class="_ _4f"></span><span class="ls0">2.14.</span></span></div><div class="t m0 x1a0 h4f y382b ff1a fs11 fc0 sc0 ls0 ws0">accept <span class="_ _a0"> </span>mq_timedsend<span class="_ _a4"> </span>pthread_join <span class="_ _9f"> </span>sendto</div><div class="t m0 x1a0 h4f y382c ff1a fs11 fc0 sc0 ls0 ws0">aio_suspend <span class="_ _6c"> </span>msgrcv<span class="_ _294"> </span>pthread_testcancel <span class="_ _48"> </span>sigsuspend</div><div class="t m0 x1a0 h4f y382d ff1a fs11 fc0 sc0 ls0 ws0">clock_nanosleep <span class="_ _48"> </span>msgsnd<span class="_ _294"> </span>pwrite <span class="_ _82"> </span>sigtimedwait</div><div class="t m0 x1a0 h4f y382e ff1a fs11 fc0 sc0 ls0 ws0">close <span class="_ _73"> </span>msync<span class="_ _1db"> </span>read <span class="_ _1e2"> </span>sigwait</div><div class="t m0 x1a0 h4f y382f ff1a fs11 fc0 sc0 ls0 ws0">connect <span class="_ _a1"> </span>nanosleep<span class="_ _1e2"> </span>readv <span class="_ _167"> </span>sigwaitinfo</div><div class="t m0 x1a0 h4f y3830 ff1a fs11 fc0 sc0 ls0 ws0">creat <span class="_ _73"> </span>open<span class="_ _264"> </span>recv <span class="_ _1e2"> </span>sleep</div><div class="t m0 x1a0 h4f y3831 ff1a fs11 fc0 sc0 ls0 ws0">fcntl <span class="_ _73"> </span>openat<span class="_ _294"> </span>recvfrom <span class="_ _73"> </span>system</div><div class="t m0 x1a0 h4f y3832 ff1a fs11 fc0 sc0 ls0 ws0">fdatasync <span class="_ _9f"> </span>pause<span class="_ _1db"> </span>recvmsg <span class="_ _a4"> </span>tcdrain</div><div class="t m0 x1a0 h4f y3833 ff1a fs11 fc0 sc0 ls0 ws0">fsync <span class="_ _73"> </span>poll<span class="_ _264"> </span>select <span class="_ _1f8"> </span>wait</div><div class="t m0 x1a0 h4f y3834 ff1a fs11 fc0 sc0 ls0 ws0">lockf <span class="_ _73"> </span>pread<span class="_ _1db"> </span>sem_timedwait <span class="_ _71"> </span>waitid</div><div class="t m0 x1a0 h4f y3835 ff1a fs11 fc0 sc0 ls0 ws0">mq_receive <span class="_ _10b"> </span>pselect<span class="_ _1da"> </span>sem_wait <span class="_ _295"> </span>waitpid</div><div class="t m0 x1a0 h4f y3836 ff1a fs11 fc0 sc0 ls0 ws0">mq_send <span class="_ _a1"> </span>pthread_cond_timedwait<span class="_ _6e"> </span>send <span class="_ _1e2"> </span>write</div><div class="t m0 x1a0 h4f y3837 ff1a fs11 fc0 sc0 ls0 ws0">mq_timedreceive <span class="_ _48"> </span>pthread_cond_wait<span class="_ _9f"> </span>sendmsg <span class="_ _a4"> </span>writev</div><div class="t m0 x108 h2f y3838 ff18 fs12 fc0 sc0 ls0 ws0">Figure 12.14<span class="_ _5a"> </span><span class="ff19">Cancellation points deﬁned by POSIX.1</span></div><div class="t m0 x3f h5c y3839 ff19 fs29 fc0 sc0 lsf09 ws0">At<span class="_ _1d"></span><span class="ls0">hread <span class="_ _66"> </span>starts <span class="_ _47"> </span>with <span class="_ _47"> </span>a <span class="_ _66"> </span>default<span class="_ _61"> </span><span class="ff1b">cancelability <span class="_ _47"> </span>state<span class="_ _61"> </span></span>of<span class="_ _61"> </span><span class="ff1a">PTHREAD_CANCEL_ENABLE</span>.</span></div><div class="t m0 x32 h5c y383a ff19 fs29 fc0 sc0 ls0 ws0">When <span class="_ _9"></span>the <span class="_ _9"></span>state <span class="_ _3"></span>is <span class="_ _9"></span>set <span class="_ _9"></span>to<span class="_ _45"> </span><span class="ff1a">PTHREAD_CANCEL_DISABLE</span><span class="lsf0a">,ac<span class="_ _b"></span><span class="ls0">all <span class="_ _9"></span>to<span class="_ _45"> </span><span class="ff1a">pthread_cancel<span class="_ _45"> </span></span>will</span></span></div><div class="t m0 x32 h50 y383b ff19 fs29 fc0 sc0 ls0 ws0">not <span class="_ _42"> </span>kill <span class="_ _42"> </span>the <span class="_ _42"> </span>thread. <span class="_ _44"> </span>Instead,<span class="_ _35"> </span>the <span class="_ _53"> </span>cancellation <span class="_ _42"> </span>request <span class="_ _42"> </span>r<span class="_ _0"></span>emains <span class="_ _42"> </span>pending <span class="_ _42"> </span>for <span class="_ _42"> </span>the <span class="_ _42"> </span>thread.</div><div class="t m0 x32 h50 y383c ff19 fs29 fc0 sc0 ls0 ws0">When <span class="_ _47"> </span>the <span class="_ _66"> </span>state <span class="_ _47"> </span>is <span class="_ _47"> </span>enabled <span class="_ _47"> </span>again, <span class="_ _47"> </span>the <span class="_ _66"> </span>thread <span class="_ _47"> </span>will <span class="_ _66"> </span>act <span class="_ _47"> </span>on <span class="_ _47"> </span>any <span class="_ _47"> </span>pending <span class="_ _47"> </span>cancellation</div><div class="t m0 x32 h50 y383d ff19 fs29 fc0 sc0 lsdf ws0">re<span class="ls0">quests at the next cancellation point.</span></div><div class="t m0 x3f h50 y383e ff19 fs29 fc0 sc0 ls0 ws0">In <span class="_ _23"> </span>addition <span class="_ _23"> </span>to <span class="_ _23"> </span>the <span class="_ _42"> </span>functions <span class="_ _23"> </span>listed <span class="_ _23"> </span>in <span class="_ _23"> </span>Figur<span class="lsf0b">e1<span class="_ _43"></span><span class="ls0">2.14, <span class="_ _42"> </span>POSIX.1 <span class="_ _23"></span>speciﬁes <span class="_ _23"> </span>the <span class="_ _23"> </span>functions</span></span></div><div class="t m0 x32 h50 y383f ff19 fs29 fc0 sc0 ls0 ws0">listed in Figur<span class="lsdd">e1<span class="_ _4f"></span><span class="ls0">2.15 as optional cancellation points.</span></span></div><a class="l" href="#pf11" data-dest-detail='[17,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892409px;bottom:1236.288916px;width:127.355797px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
