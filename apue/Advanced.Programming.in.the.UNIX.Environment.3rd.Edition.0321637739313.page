<div id="pf139" class="pf w4 h1f" data-page-no="139"><div class="pc pc139 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg139.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>8.16<span class="_ _245"> </span>Process <span class="_"> </span>Scheduling<span class="_ _1fb"> </span><span class="ff18">279</span></div><div class="t m0 x9d h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;fork failed&quot;);</div><div class="t m0 x8a h57 y426 ff1a fs2d fc0 sc0 ls15c ws0">}e<span class="_ _1d"></span><span class="ls0">lse if (pid == 0) {<span class="_ _3a"> </span>/* child */</span></div><div class="t m0 x9d h57 y800 ff1a fs2d fc0 sc0 ls15c ws0">s=&quot;<span class="_ _1d"></span><span class="ls0">child&quot;;</span></div><div class="t m0 x9d h57 y801 ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;current nice value in child is %d, adjusting by %d\n&quot;,</div><div class="t m0 x76 h57 y802 ff1a fs2d fc0 sc0 ls0 ws0">nice(0)+nzero, adj);</div><div class="t m0 x9d h57 y803 ff1a fs2d fc0 sc0 ls0 ws0">errno = 0;</div><div class="t m0 x9d h57 y804 ff1a fs2d fc0 sc0 ls0 ws0">if ((ret = nice(adj)) == -1 &amp;&amp; errno != 0)</div><div class="t m0 x1f h57 y805 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;child set scheduling priority&quot;);</div><div class="t m0 x9d h57 y806 ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;now child nice value is %d\n&quot;, ret+nzero);</div><div class="t m0 x8a h57 y807 ff1a fs2d fc0 sc0 ls15c ws0">}e<span class="_ _1d"></span><span class="ls0">lse {<span class="_ _186"> </span>/* parent */</span></div><div class="t m0 x9d h57 y808 ff1a fs2d fc0 sc0 ls15c ws0">s=&quot;<span class="_ _1d"></span><span class="ls0">parent&quot;;</span></div><div class="t m0 x9d h57 y809 ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;current nice value in parent is %d\n&quot;, nice(0)+nzero);</div><div class="t m0 x8a h57 y80a ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y80b ff1a fs2d fc0 sc0 ls0 ws0">for(;;) {</div><div class="t m0 x9d h57 y80c ff1a fs2d fc0 sc0 ls0 ws0">if (++count == 0)</div><div class="t m0 x1f h57 y80d ff1a fs2d fc0 sc0 ls0 ws0">err_quit(&quot;%s counter wrap&quot;, s);</div><div class="t m0 x9d h57 y80e ff1a fs2d fc0 sc0 ls0 ws0">checktime(s);</div><div class="t m0 x8a h57 y80f ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h57 y810 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x25 h2d y2489 ff18 fs10 fc0 sc0 ls0 ws0">Figure 8.30<span class="_ _5a"> </span><span class="ff19">Evaluate the effect of changing the nice value</span></div><div class="t m0 x3f h49 y248a ff19 fs26 fc0 sc0 ls164 ws0">We <span class="_ _35"> </span>r<span class="_ _3"></span><span class="ls0">un <span class="_ _e"> </span>the <span class="_ _53"> </span>program <span class="_ _42"> </span>twice: <span class="_ _e"> </span>once <span class="_ _53"> </span>with <span class="_ _53"> </span>the <span class="_ _53"> </span>default <span class="_ _e"> </span>nice <span class="_ _53"> </span>value, <span class="_ _53"> </span>and <span class="_ _53"> </span>once <span class="_ _53"> </span>with <span class="_ _e"> </span>the</span></div><div class="t m0 x32 h49 y248b ff19 fs26 fc0 sc0 ls0 ws0">highest <span class="_ _2"></span>valid <span class="_ _2"></span>nice <span class="_ _2"></span>value <span class="_ _2"></span>(the <span class="_ _2"></span>lowest <span class="_ _2"></span>scheduling <span class="_ _2"></span>priority).<span class="_ _61"> </span><span class="ls164">We <span class="_ _e"> </span>r<span class="_ _23"></span></span>un this <span class="_ _2"></span>on <span class="_ _2"></span>a <span class="_ _3"></span>uniprocessor</div><div class="t m0 x32 h49 y248c ff19 fs26 fc0 sc0 ls0 ws0">Linux <span class="_ _47"> </span>system <span class="_ _45"> </span>to <span class="_ _47"> </span>show <span class="_ _45"> </span>how <span class="_ _47"> </span>the <span class="_ _45"> </span>scheduler <span class="_ _47"> </span>shares <span class="_ _47"> </span>the <span class="_ _45"> </span>CPU <span class="_ _47"> </span>among <span class="_ _45"> </span>processes <span class="_ _47"> </span>with</div><div class="t m0 x32 h49 y248d ff19 fs26 fc0 sc0 ls0 ws0">differ<span class="_ _0"></span>ent <span class="_ _53"> </span>nice <span class="_ _e"> </span>values.<span class="_ _48"> </span><span class="ls3aa">Wi<span class="_ _3"></span></span>th <span class="_ _e"> </span>an <span class="_ _e"> </span>otherwise <span class="_ _e"> </span>idle <span class="_ _e"> </span>system, <span class="_ _e"> </span>a <span class="_ _e"> </span>multiprocessor <span class="_ _53"> </span>system <span class="_ _e"> </span>(or <span class="_ _e"> </span>a</div><div class="t m0 x32 h49 y248e ff19 fs26 fc0 sc0 ls0 ws0">multicor<span class="lsaa0">eC<span class="_ _43"></span><span class="ls0">PU) <span class="_ _23"></span>would <span class="_ _23"></span>allow <span class="_ _23"> </span>both <span class="_ _23"> </span>processes <span class="_ _23"></span>to <span class="_ _23"></span>run <span class="_ _23"></span>without <span class="_ _23"></span>the <span class="_ _23"></span>need <span class="_ _23"></span>to <span class="_ _23"> </span>shar<span class="lsaa1">eaC<span class="_ _43"></span><span class="ls0">PU,</span></span></span></span></div><div class="t m0 x32 h49 y248f ff19 fs26 fc0 sc0 ls0 ws0">and we <span class="_ _2"></span>wouldn’t <span class="_ _2"></span>see <span class="_ _2"></span>much <span class="_ _2"></span>differ<span class="_ _0"></span>ence between <span class="_ _2"></span>two <span class="_ _2"></span>processes with <span class="_ _2"></span>different nice values.</div><div class="t m0 x3f h4e y2490 ff1a fs28 fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">./a.out</span></div><div class="t m0 x3f h4e y2491 ff1a fs28 fc0 sc0 ls0 ws0">NZERO = 20</div><div class="t m0 x3f h4e y2492 ff1a fs28 fc0 sc0 ls0 ws0">current nice value in parent is 20</div><div class="t m0 x3f h4e y2493 ff1a fs28 fc0 sc0 ls0 ws0">current nice value in child is 20, adjusting by 0</div><div class="t m0 x3f h4e y2494 ff1a fs28 fc0 sc0 ls0 ws0">now child nice value is 20</div><div class="t m0 x3f h4e y2495 ff1a fs28 fc0 sc0 ls0 ws0">child count = 1859362</div><div class="t m0 x3f h4e y2496 ff1a fs28 fc0 sc0 ls0 ws0">parent count = 1845338</div><div class="t m0 x3f h4e y2497 ff1a fs28 fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">./a.out 20</span></div><div class="t m0 x3f h4e y2498 ff1a fs28 fc0 sc0 ls0 ws0">NZERO = 20</div><div class="t m0 x3f h4e y2499 ff1a fs28 fc0 sc0 ls0 ws0">current nice value in parent is 20</div><div class="t m0 x3f h4e y249a ff1a fs28 fc0 sc0 ls0 ws0">current nice value in child is 20, adjusting by 20</div><div class="t m0 x3f h4e y249b ff1a fs28 fc0 sc0 ls0 ws0">now child nice value is 39</div><div class="t m0 x3f h4e y249c ff1a fs28 fc0 sc0 ls0 ws0">parent count = 3595709</div><div class="t m0 x3f h4e y249d ff1a fs28 fc0 sc0 ls0 ws0">child count = 52111</div><div class="t m0 x3f h49 y249e ff19 fs26 fc0 sc0 ls0 ws0">When <span class="_ _2"></span>both <span class="_ _2"></span>processes have <span class="_ _2"></span>the <span class="_ _2"></span>same <span class="_ _2"></span>nice <span class="_ _2"></span>value, <span class="_ _2"></span>the <span class="_ _2"></span>parent process <span class="_ _2"></span>gets <span class="_ _2"></span>50.2% <span class="_ _2"></span>of <span class="_ _2"></span>the</div><div class="t m0 x32 h49 y249f ff19 fs26 fc0 sc0 ls0 ws0">CPU <span class="_ _9"></span>and <span class="_ _23"></span>the <span class="_ _9"></span>child <span class="_ _23"></span>gets <span class="_ _9"></span>49.8% <span class="_ _23"></span>of <span class="_ _9"></span>the <span class="_ _9"></span>CPU.<span class="_ _51"> </span>Note <span class="_ _9"></span>that <span class="_ _23"></span>the <span class="_ _9"></span>two <span class="_ _23"></span>processes <span class="_ _3"></span>ar<span class="ls37d">ee<span class="_ _b"></span><span class="lscc">ff<span class="ls0">ectively</span></span></span></div><div class="t m0 x32 h49 y24a0 ff19 fs26 fc0 sc0 ls0 ws0">treated <span class="_ _3"></span>equally<span class="_ _6"></span><span class="ls935">.T<span class="_ _26"></span><span class="ls0">he <span class="_ _23"></span>percentages <span class="_ _3"></span>aren’t <span class="_ _9"></span>exactly <span class="_ _9"></span>equal, <span class="_ _23"></span>because <span class="_ _9"></span>process <span class="_ _3"></span>scheduling <span class="_ _23"></span>isn’t</span></span></div><div class="t m0 x32 h49 y24a1 ff19 fs26 fc0 sc0 ls0 ws0">exact, <span class="_ _47"> </span>and <span class="_ _45"> </span>because <span class="_ _47"> </span>the <span class="_ _45"> </span>child <span class="_ _47"> </span>and <span class="_ _45"> </span>parent <span class="_ _47"> </span>perform <span class="_ _47"> </span>different <span class="_ _47"> </span>amounts <span class="_ _47"> </span>of <span class="_ _45"> </span>processing</div><div class="t m0 x32 h49 y24a2 ff19 fs26 fc0 sc0 ls0 ws0">between <span class="_ _9"></span>the <span class="_ _9"></span>time <span class="_ _9"></span>that <span class="_ _9"></span>the <span class="_ _9"></span>end <span class="_ _9"></span>time <span class="_ _9"></span>is <span class="_ _9"></span>calculated <span class="_ _9"></span>and <span class="_ _9"></span>the <span class="_ _23"></span>time <span class="_ _3"></span>that <span class="_ _23"></span>the <span class="_ _3"></span>processing <span class="_ _9"></span>loop</div><div class="t m0 x32 h49 y24a3 ff19 fs26 fc0 sc0 ls0 ws0">begins.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
