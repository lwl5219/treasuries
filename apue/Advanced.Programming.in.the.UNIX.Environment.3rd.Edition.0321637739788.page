<div id="pf314" class="pf w4 h1f" data-page-no="314"><div class="pc pc314 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg314.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">754<span class="_ _1b"> </span><span class="ff19 ls30a">AD<span class="_ _55"></span><span class="ls0">atabase <span class="_"> </span>Library<span class="_ _245"> </span>Chapter <span class="_"> </span>20</span></span></div><div class="t m0 x140 h57 y362 ff1a fs2d fc0 sc0 lsa73 ws0">1#<span class="_ _244"></span><span class="ls0">ifndef _APUE_DB_H</span></div><div class="t m0 x140 h57 y3c0 ff1a fs2d fc0 sc0 lsa73 ws0">2#<span class="_ _244"></span><span class="ls0">define _APUE_DB_H</span></div><div class="t m0 x140 h57 y2f1d ff1a fs2d fc0 sc0 lsa73 ws0">3t<span class="_ _244"></span><span class="ls0">ypedef <span class="_ _68"> </span>void<span class="_"> </span><span class="ls1627">*D<span class="_ _96"></span><span class="ls0">BHANDLE;</span></span></span></div><div class="t m0 x140 h57 y1d7a ff1a fs2d fc0 sc0 lsa73 ws0">4D<span class="_ _244"></span><span class="ls0">BHANDLE <span class="_"> </span>db_open(const<span class="_"> </span>char *, int, ...);</span></div><div class="t m0 x140 h57 y1d7b ff1a fs2d fc0 sc0 lsa73 ws0">5v<span class="_ _244"></span><span class="ls0">oid <span class="_ _12e"> </span>db_close(DBHANDLE);</span></div><div class="t m0 x140 h57 y2197 ff1a fs2d fc0 sc0 lsa73 ws0">6c<span class="_ _244"></span><span class="ls0">har <span class="_ _2a8"> </span>*db_fetch(DBHANDLE,<span class="_"> </span>const char *);</span></div><div class="t m0 x140 h57 y2f21 ff1a fs2d fc0 sc0 lsa73 ws0">7i<span class="_ _244"></span><span class="ls0">nt <span class="_ _12c"> </span>db_store(DBHANDLE,<span class="_"> </span>const char *, const char *, int);</span></div><div class="t m0 x140 h57 y2f22 ff1a fs2d fc0 sc0 lsa73 ws0">8i<span class="_ _244"></span><span class="ls0">nt <span class="_ _12c"> </span>db_delete(DBHANDLE,<span class="_"> </span>const char *);</span></div><div class="t m0 x140 h57 y2f23 ff1a fs2d fc0 sc0 lsa73 ws0">9v<span class="_ _244"></span><span class="ls0">oid <span class="_ _12e"> </span>db_rewind(DBHANDLE);</span></div><div class="t m0 x32 h57 y2f24 ff1a fs2d fc0 sc0 ls0 ws0">10 <span class="_ _d9"> </span>char<span class="_ _8a"> </span>*db_nextrec(DBHANDLE, char *);</div><div class="t m0 x32 h57 y3b4d ff1a fs2d fc0 sc0 ls0 ws0">11 <span class="_ _d9"> </span>/*</div><div class="t m0 x32 h57 y2f26 ff1a fs2d fc0 sc0 ls0 ws0">12 <span class="_ _68"> </span>*<span class="_"> </span>Flags for db_store().</div><div class="t m0 x32 h57 y2f27 ff1a fs2d fc0 sc0 ls0 ws0">13 <span class="_ _68"> </span>*/</div><div class="t m0 x32 h57 y2f28 ff1a fs2d fc0 sc0 ls0 ws0">14 <span class="_ _d9"> </span>#define<span class="_"> </span>DB_INSERT <span class="_ _15"> </span>1<span class="_ _15"> </span>/* insert new record only */</div><div class="t m0 x32 h57 y2f29 ff1a fs2d fc0 sc0 ls0 ws0">15 <span class="_ _d9"> </span>#define<span class="_"> </span>DB_REPLACE <span class="_ _87"> </span>2 <span class="_ _68"> </span>/*<span class="_"> </span>replace existing record */</div><div class="t m0 x32 h57 y2f2a ff1a fs2d fc0 sc0 ls0 ws0">16 <span class="_ _d9"> </span>#define<span class="_"> </span>DB_STORE <span class="_ _8a"> </span>3<span class="_ _15"> </span>/* replace or insert */</div><div class="t m0 x32 h57 y2c61 ff1a fs2d fc0 sc0 ls0 ws0">17 <span class="_ _d9"> </span>/*</div><div class="t m0 x32 h57 y2c62 ff1a fs2d fc0 sc0 ls0 ws0">18 <span class="_ _68"> </span>*<span class="_"> </span>Implementation limits.</div><div class="t m0 x32 h57 y5689 ff1a fs2d fc0 sc0 ls0 ws0">19 <span class="_ _68"> </span>*/</div><div class="t m0 x32 h57 y568a ff1a fs2d fc0 sc0 ls0 ws0">20 <span class="_ _d9"> </span>#define<span class="_"> </span>IDXLEN_MIN <span class="_ _87"> </span>6 <span class="_ _68"> </span>/*<span class="_"> </span>key, sep, start, sep, length, \n */</div><div class="t m0 x32 h57 y568b ff1a fs2d fc0 sc0 ls0 ws0">21 <span class="_ _d9"> </span>#define<span class="_"> </span>IDXLEN_MAX 1024<span class="_ _15"> </span>/* arbitrary */</div><div class="t m0 x32 h57 y568c ff1a fs2d fc0 sc0 ls0 ws0">22 <span class="_ _d9"> </span>#define<span class="_"> </span>DATLEN_MIN <span class="_ _87"> </span>2 <span class="_ _68"> </span>/*<span class="_"> </span>data byte, newline */</div><div class="t m0 x32 h57 y568d ff1a fs2d fc0 sc0 ls0 ws0">23 <span class="_ _d9"> </span>#define<span class="_"> </span>DATLEN_MAX 1024<span class="_ _15"> </span>/* arbitrary */</div><div class="t m0 x32 h57 y568e ff1a fs2d fc0 sc0 ls0 ws0">24 <span class="_ _d9"> </span>#endif<span class="_"> </span>/* _APUE_DB_H */</div><div class="t m0 x32 h4d y568f ff19 fs26 fc0 sc0 ls0 ws0">[1 <span class="_ _a"></span>– <span class="_ _a"></span>3]<span class="_ _75"> </span><span class="ls164">We <span class="_ _80"> </span>u<span class="_ _23"></span></span>se <span class="_ _3"></span>the<span class="_ _45"> </span><span class="ff1a">_APUE_DB_H<span class="_ _47"> </span></span>symbol <span class="_ _3"></span>to <span class="_ _9"></span>ensur<span class="ls1646">et<span class="_ _b"></span><span class="ls0">hat <span class="_ _9"></span>the <span class="_ _3"></span>contents <span class="_ _9"></span>of <span class="_ _3"></span>the <span class="_ _9"></span>header <span class="_ _3"></span>ﬁle</span></span></div><div class="t m0 x2d h4d y5690 ff19 fs26 fc0 sc0 ls0 ws0">ar<span class="ls1647">ei<span class="_ _b"></span><span class="ls0">ncluded <span class="_ _3"></span>only <span class="_ _9"></span>once.<span class="_ _5a"> </span>The<span class="_ _45"> </span><span class="ff1a">DBHANDLE<span class="_ _45"> </span></span>type <span class="_ _3"></span>represents <span class="_ _3"></span>an <span class="_ _9"></span>active <span class="_ _9"></span>refer<span class="_ _0"></span>ence <span class="_ _3"></span>to</span></span></div><div class="t m0 x2d h49 y5691 ff19 fs26 fc0 sc0 ls0 ws0">the <span class="_ _47"> </span>database <span class="_ _47"> </span>and <span class="_ _47"> </span>is <span class="_ _47"> </span>used <span class="_ _47"> </span>to <span class="_ _47"> </span>isolate <span class="_ _47"> </span>applications <span class="_ _47"> </span>fr<span class="_ _0"></span>om <span class="_ _47"> </span>the <span class="_ _47"> </span>implementation</div><div class="t m0 x2d h49 y5692 ff19 fs26 fc0 sc0 ls0 ws0">details <span class="_ _53"> </span>of <span class="_ _53"> </span>the <span class="_ _53"> </span>database.<span class="_ _54"> </span>Compar<span class="ls1648">et<span class="_ _c"></span><span class="ls0">his <span class="_ _53"> </span>technique <span class="_ _53"> </span>with <span class="_ _53"> </span>the <span class="_ _53"> </span>way <span class="_ _53"> </span>the <span class="_ _53"> </span>standard</span></span></div><div class="t m0 x2d h4d y5693 ff19 fs26 fc0 sc0 ls0 ws0">I/O library exposes the<span class="_"> </span><span class="ff1a">FILE<span class="_ _80"> </span></span>structure<span class="_"> </span>to<span class="_"> </span>applications.</div><div class="t m0 x32 h49 y5694 ff19 fs26 fc0 sc0 ls0 ws0">[4 <span class="_ _a"></span>– <span class="_ _a"></span>10]<span class="_ _288"> </span>Next, <span class="_"> </span>we <span class="_ _53"> </span>declar<span class="ls6a3">et<span class="_ _4a"></span><span class="ls0">he <span class="_"> </span>pr<span class="_ _1"></span>ototypes <span class="_ _e"> </span>for <span class="_ _e"> </span>the <span class="_ _e"> </span>database <span class="_ _e"> </span>library’s <span class="_ _e"> </span>public <span class="_ _e"> </span>functions.</span></span></div><div class="t m0 x2d h49 y5695 ff19 fs26 fc0 sc0 ls0 ws0">Since <span class="_ _23"></span>this <span class="_ _9"></span>header <span class="_ _23"> </span>is <span class="_ _23"></span>included <span class="_ _23"></span>by <span class="_ _23"></span>applications <span class="_ _9"></span>that <span class="_ _23"> </span>want <span class="_ _23"></span>to <span class="_ _23"></span>use <span class="_ _9"></span>the <span class="_ _23"> </span>library<span class="_ _6"></span><span class="ls1374">,w<span class="_ _43"></span><span class="ls0">e</span></span></div><div class="t m0 x2d h49 y5696 ff19 fs26 fc0 sc0 ls0 ws0">don’t declar<span class="lsd3">et<span class="_ _4f"></span><span class="ls0">he prototypes for the library’s private functions here.</span></span></div><div class="t m0 x32 h4d y5697 ff19 fs26 fc0 sc0 ls0 ws0">[1<span class="_ _1"></span><span class="ls161">1–2<span class="_ _6"></span><span class="ls0">4] <span class="_ _59"> </span>The<span class="_ _45"> </span>legal <span class="_ _3"></span>ﬂags <span class="_ _3"></span>that <span class="_ _9"></span>can <span class="_ _3"></span>be <span class="_ _9"></span>passed <span class="_ _3"></span>to <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">db_store<span class="_ _47"> </span></span>function <span class="_ _9"></span>ar<span class="lsd6">ed<span class="_ _b"></span><span class="ls0">eﬁned <span class="_ _3"></span>next,</span></span></span></span></div><div class="t m0 x2d h49 y5698 ff19 fs26 fc0 sc0 ls0 ws0">followed <span class="_ _53"> </span>by <span class="_ _53"> </span>fundamental <span class="_ _53"> </span>limits <span class="_ _42"> </span>of <span class="_ _53"> </span>the <span class="_ _53"> </span>implementation.<span class="_ _65"> </span>These <span class="_ _53"> </span>limits <span class="_ _53"> </span>can <span class="_ _53"> </span>be</div><div class="t m0 x2d h49 y5699 ff19 fs26 fc0 sc0 ls0 ws0">changed, if desired, to support bigger databases.</div><div class="t m0 x2d h4d y569a ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _59"> </span>minimum <span class="_ _59"> </span>index <span class="_ _59"> </span>recor<span class="ls1649">dl<span class="_ _49"></span><span class="ls0">ength <span class="_ _46"> </span>is <span class="_ _59"> </span>speciﬁed <span class="_ _59"> </span>by<span class="_ _60"> </span><span class="ff1a">IDXLEN_MIN</span><span class="ls164a">.T<span class="_ _4e"></span><span class="ls0">his</span></span></span></span></div><div class="t m0 x2d h49 y569b ff19 fs26 fc0 sc0 lscc ws0">re<span class="ls0">presents <span class="_ _e"> </span>a <span class="_"> </span>1</span></div><div class="t m0 x91 h49 y569c ff19 fs26 fc0 sc0 ls0 ws0">-</div><div class="t m0 x36 h49 y569b ff19 fs26 fc0 sc0 ls0 ws0">byte <span class="_ _e"> </span>key<span class="_ _6"></span><span class="ls164b">,a1</span></div><div class="t m0 x17 h49 y569c ff19 fs26 fc0 sc0 ls0 ws0">-</div><div class="t m0 x9b h49 y569b ff19 fs26 fc0 sc0 ls0 ws0">byte <span class="_ _e"> </span>separator<span class="_ _1"></span><span class="ls164b">,a1</span></div><div class="t m0 xd7 h49 y569c ff19 fs26 fc0 sc0 ls0 ws0">-</div><div class="t m0 xad h49 y569b ff19 fs26 fc0 sc0 ls0 ws0">byte <span class="_ _e"> </span>starting <span class="_"> </span>of<span class="_ _0"></span>fset, <span class="_ _e"> </span>another</div><div class="t m0 x2d h49 y569d ff19 fs26 fc0 sc0 ls0 ws0">1</div><div class="t m0 x1c h49 y569e ff19 fs26 fc0 sc0 ls0 ws0">-</div><div class="t m0 x175 h49 y569d ff19 fs26 fc0 sc0 ls0 ws0">byte <span class="_ _3"></span>separator<span class="_ _1"></span><span class="ls164c">,a1</span></div><div class="t m0 x63 h49 y569e ff19 fs26 fc0 sc0 ls0 ws0">-</div><div class="t m0 x64 h49 y569d ff19 fs26 fc0 sc0 ls0 ws0">byte <span class="_ _3"></span>length, <span class="_ _9"></span>and <span class="_ _3"></span>a <span class="_ _3"></span>terminating <span class="_ _9"></span>newline <span class="_ _3"></span>character<span class="_ _1"></span><span class="ls164d">.(<span class="_ _62"></span><span class="ls0">Recall</span></span></div><div class="t m0 x2d h49 y569f ff19 fs26 fc0 sc0 ls0 ws0">the <span class="_ _3"></span>format <span class="_ _9"></span>of <span class="_ _3"></span>an <span class="_ _9"></span>index <span class="_ _3"></span>recor<span class="ls164e">df<span class="_ _b"></span><span class="lscc">ro<span class="ls164e">mF<span class="_ _8"></span><span class="ls0">igur<span class="ls164e">e2<span class="_ _b"></span><span class="ls0">0.2.) <span class="_ _45"> </span>An<span class="_ _47"> </span>index <span class="_ _9"></span>recor<span class="_ _1"></span><span class="ls164e">dw<span class="_ _8"></span><span class="ls0">ill <span class="_ _9"></span>usually</span></span></span></span></span></span></span></span></div><div class="t m0 x2d h4d y56a0 ff19 fs26 fc0 sc0 ls0 ws0">be larger than<span class="_"> </span><span class="ff1a">IDXLEN_MIN<span class="_ _80"> </span></span>bytes, but this is the bar<span class="lsd3">em<span class="_ _4f"></span><span class="ls0">inimum size.</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
