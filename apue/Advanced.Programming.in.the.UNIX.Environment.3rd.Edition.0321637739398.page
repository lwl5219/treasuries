<div id="pf18e" class="pf w4 h1f" data-page-no="18e"><div class="pc pc18e w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg18e.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">364<span class="_ _1b"> </span><span class="ff19">Signals <span class="_ _24b"> </span>Chapter<span class="_ _21"> </span>10</span></div><div class="t m0 x32 h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y426 ff1a fs2d fc0 sc0 ls0 ws0">while (sigflag == 0)</div><div class="t m0 x9d h57 y800 ff1a fs2d fc0 sc0 ls0 ws0">sigsuspend(&amp;zeromask); <span class="_"> </span>/*<span class="_"> </span>and wait for child */</div><div class="t m0 x8a h57 y801 ff1a fs2d fc0 sc0 ls0 ws0">sigflag = 0;</div><div class="t m0 x8a h57 y23c8 ff1a fs2d fc0 sc0 ls0 ws0">/* Reset signal mask to original value */</div><div class="t m0 x8a h57 y23c9 ff1a fs2d fc0 sc0 ls0 ws0">if (sigprocmask(SIG_SETMASK, &amp;oldmask, NULL) &lt; 0)</div><div class="t m0 x9d h57 y23ca ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;SIG_SETMASK error&quot;);</div><div class="t m0 x32 h57 y23cb ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x50 h2d y2e9f ff18 fs10 fc0 sc0 ls0 ws0">Figure 10.24<span class="_ _5a"> </span><span class="ff19">Routines to allow a parent and child to synchronize</span></div><div class="t m0 x3f h4d y2ea0 ff19 fs26 fc0 sc0 ls164 ws0">We <span class="_ _53"> </span>u<span class="_ _9"></span><span class="ls0">se the two <span class="_ _2"></span>user-deﬁned signals:<span class="_"> </span><span class="ff1a">SIGUSR1<span class="_ _80"> </span></span>is sent by the <span class="_ _2"></span>parent to the child, and</span></div><div class="t m0 x32 h4d y2ea1 ff1a fs26 fc0 sc0 ls0 ws0">SIGUSR2<span class="_ _51"> </span><span class="ff19">is <span class="_ _44"> </span>sent <span class="_ _35"> </span>by <span class="_ _44"> </span>the <span class="_ _35"> </span>child <span class="_ _44"> </span>to <span class="_ _35"> </span>the <span class="_ _35"> </span>parent. <span class="_ _54"> </span>In<span class="_ _51"> </span>Figur<span class="lsce9">e1<span class="_ _52"></span><span class="ls0">5.7, <span class="_ _44"> </span>we <span class="_ _35"> </span>show <span class="_ _44"> </span>another</span></span></span></div><div class="t m0 x32 h49 y2ea2 ff19 fs26 fc0 sc0 ls0 ws0">implementation of these ﬁve functions using pipes.</div><div class="t m0 x3f h54 y2ea3 ff19 fs2c fc0 sc0 ls0 ws0">The<span class="_"> </span><span class="ff1a">sigsuspend<span class="_ _80"> </span></span>function <span class="_ _2"></span>is ﬁne if we want to go <span class="_ _2"></span>to sleep while we’r<span class="lscea">ew<span class="_ _d"></span><span class="ls0">aiting for a</span></span></div><div class="t m0 x32 h55 y2ea4 ff19 fs2c fc0 sc0 ls0 ws0">signal <span class="_ _2"></span>to <span class="_ _3"></span>occur <span class="_ _3"></span>(as <span class="_ _3"></span>we’ve <span class="_ _3"></span>shown <span class="_ _3"></span>in <span class="_ _3"></span>the <span class="_ _3"></span>previous <span class="_ _2"></span>two <span class="_ _3"></span>examples), <span class="_ _3"></span>but <span class="_ _3"></span>what <span class="_ _3"></span>if <span class="_ _3"></span>we <span class="_ _2"></span>want <span class="_ _3"></span>to</div><div class="t m0 x32 h55 y2ea5 ff19 fs2c fc0 sc0 ls0 ws0">call <span class="_ _42"> </span>other <span class="_ _42"> </span>system <span class="_ _42"> </span>functions <span class="_ _42"> </span>while <span class="_ _53"> </span>we’r<span class="lsceb">ew<span class="_ _c"></span><span class="ls0">aiting? <span class="_ _44"> </span>Unfortunately<span class="_ _4"></span><span class="lsceb">,t<span class="_ _43"></span><span class="ls0">his <span class="_ _42"> </span>problem <span class="_ _23"> </span>has <span class="_ _53"> </span>no</span></span></span></span></div><div class="t m0 x32 h55 y2ea6 ff19 fs2c fc0 sc0 ls0 ws0">bulletproof <span class="_ _9"></span>solution <span class="_ _23"></span>unless <span class="_ _23"></span>we <span class="_ _23"></span>use <span class="_ _23"></span>multiple <span class="_ _9"></span>threads <span class="_ _23"></span>and <span class="_ _23"></span>dedicate <span class="_ _9"></span>a <span class="_ _23"> </span>separate <span class="_ _23"> </span>thread <span class="_ _9"></span>to</div><div class="t m0 x32 h55 y2ea7 ff19 fs2c fc0 sc0 ls0 ws0">handling signals, as we discuss in Section 12.8.</div><div class="t m0 x3f h55 y2ea8 ff19 fs2c fc0 sc0 ls6a4 ws0">Wi<span class="_ _3"></span><span class="ls0">thout <span class="_ _23"></span>using <span class="_ _23"></span>threads, <span class="_ _9"></span>the <span class="_ _23"> </span>best <span class="_ _23"></span>we <span class="_ _23"></span>can <span class="_ _23"></span>do <span class="_ _23"></span>is <span class="_ _23"></span>to <span class="_ _23"></span>set <span class="_ _23"></span>a <span class="_ _9"></span>global <span class="_ _23"> </span>variable <span class="_ _23"> </span>in <span class="_ _23"> </span>the <span class="_ _23"> </span>signal</span></div><div class="t m0 x32 h54 y2ea9 ff19 fs2c fc0 sc0 ls0 ws0">handler <span class="_ _9"></span>when <span class="_ _9"></span>the <span class="_ _23"></span>signal <span class="_ _9"></span>occurs.<span class="_ _5a"> </span>For <span class="_ _9"></span>example, <span class="_ _23"></span>if <span class="_ _9"></span>we <span class="_ _9"></span>catch <span class="_ _9"></span>both<span class="_ _35"> </span><span class="ff1a">SIGINT<span class="_ _45"> </span></span>and<span class="_ _45"> </span><span class="ff1a">SIGALRM</span></div><div class="t m0 x32 h54 y2eaa ff19 fs2c fc0 sc0 ls0 ws0">and <span class="_ _47"> </span>install <span class="_ _47"> </span>the <span class="_ _45"> </span>signal <span class="_ _47"> </span>handlers <span class="_ _47"> </span>using <span class="_ _47"> </span>the<span class="_ _16"> </span><span class="ff1a">signal_intr<span class="_"> </span></span>function, <span class="_ _66"> </span>the <span class="_ _45"> </span>signals <span class="_ _47"> </span>will</div><div class="t m0 x32 h55 y2eab ff19 fs2c fc0 sc0 ls0 ws0">interrupt <span class="_ _53"> </span>any <span class="_ _53"> </span>slow <span class="_ _e"> </span>system <span class="_ _53"> </span>call <span class="_ _53"> </span>that <span class="_ _e"> </span>is <span class="_ _53"> </span>blocked.<span class="_ _48"> </span>The <span class="_ _53"> </span>signals <span class="_ _53"> </span>ar<span class="lscec">em<span class="_ _c"></span><span class="ls0">ost <span class="_ _53"> </span>likely <span class="_ _53"> </span>to <span class="_ _e"> </span>occur</span></span></div><div class="t m0 x32 h54 y2eac ff19 fs2c fc0 sc0 ls0 ws0">when <span class="_ _2"></span>we’r<span class="lsced">eb<span class="_ _8"></span><span class="ls0">locked <span class="_ _2"></span>in <span class="_ _2"></span>a <span class="_ _2"></span>call <span class="_ _2"></span>to <span class="_ _2"></span>the<span class="_ _47"> </span><span class="ff1a">read<span class="_ _66"> </span></span>function <span class="_ _2"></span>waiting <span class="_ _2"></span>for <span class="_ _2"></span>input <span class="_ _2"></span>from a <span class="_ _2"></span>slow <span class="_ _2"></span>device.</span></span></div><div class="t m0 x32 h54 y2ead ff19 fs2c fc0 sc0 ls0 ws0">(This <span class="_ _23"> </span>is <span class="_ _23"> </span>especially <span class="_ _42"> </span>true <span class="_ _23"></span>for<span class="_ _35"> </span><span class="ff1a">SIGALRM</span><span class="lscee">,s<span class="_ _43"></span><span class="ls0">ince <span class="_ _42"> </span>we <span class="_ _23"></span>set <span class="_ _23"> </span>the <span class="_ _23"> </span>alarm <span class="_ _42"> </span>clock <span class="_ _23"> </span>to <span class="_ _23"> </span>prevent <span class="_ _23"> </span>us <span class="_ _42"> </span>from</span></span></div><div class="t m0 x32 h55 y2eae ff19 fs2c fc0 sc0 ls0 ws0">waiting forever for input.)<span class="_ _59"> </span>The code to handle this looks similar to the following:</div><div class="t m0 xc2 h5d y2eaf ff1a fs2f fc0 sc0 ls0 ws0">if (intr_flag)<span class="_ _189"> </span>/* flag set by our SIGINT handler */</div><div class="t m0 x16e h5d y2eb0 ff1a fs2f fc0 sc0 ls0 ws0">handle_intr();</div><div class="t m0 xc2 h5d y2eb1 ff1a fs2f fc0 sc0 ls0 ws0">if (alrm_flag)<span class="_ _189"> </span>/* flag set by our SIGALRM handler */</div><div class="t m0 x16e h5d y2eb2 ff1a fs2f fc0 sc0 ls0 ws0">handle_alrm();</div><div class="t m0 xc2 h5d y2eb3 ff1a fs2f fc0 sc0 ls0 ws0">/* signals occurring in here are lost */</div><div class="t m0 xc2 h5d y2eb4 ff1a fs2f fc0 sc0 ls0 ws0">while (read( ... ) &lt; 0) {</div><div class="t m0 x16e h5d y2eb5 ff1a fs2f fc0 sc0 ls0 ws0">if (errno == EINTR) {</div><div class="t m0 xda h5d y2eb6 ff1a fs2f fc0 sc0 ls0 ws0">if (alrm_flag)</div><div class="t m0 x1dd h5d y2eb7 ff1a fs2f fc0 sc0 ls0 ws0">handle_alrm();</div><div class="t m0 xda h5d y2eb8 ff1a fs2f fc0 sc0 ls0 ws0">else if (intr_flag)</div><div class="t m0 x1dd h5d y2eb9 ff1a fs2f fc0 sc0 ls0 ws0">handle_intr();</div><div class="t m0 x16e h5d y2eba ff1a fs2f fc0 sc0 ls395 ws0">}e<span class="_ _1d"></span><span class="ls0">lse {</span></div><div class="t m0 xda h5d y2ebb ff1a fs2f fc0 sc0 ls0 ws0">/* some other error */</div><div class="t m0 x16e h5d y2ebc ff1a fs2f fc0 sc0 ls0 ws0">}</div><div class="t m0 xc2 h5d y2ebd ff1a fs2f fc0 sc0 ls395 ws0">}e<span class="_ _1d"></span><span class="ls0">lse if (n == 0) {</span></div><div class="t m0 x16e h5d y2ebe ff1a fs2f fc0 sc0 ls0 ws0">/* end of file */</div><div class="t m0 xc2 h5d y2ebf ff1a fs2f fc0 sc0 ls395 ws0">}e<span class="_ _1d"></span><span class="ls0">lse {</span></div><div class="t m0 x16e h5d y2ec0 ff1a fs2f fc0 sc0 ls0 ws0">/* process input */</div><div class="t m0 xc2 h5d y2ec1 ff1a fs2f fc0 sc0 ls0 ws0">}</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
