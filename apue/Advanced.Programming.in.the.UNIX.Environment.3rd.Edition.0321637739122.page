<div id="pf7a" class="pf w4 h1f" data-page-no="7a"><div class="pc pc7a w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg7a.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">88<span class="_ _1b"> </span><span class="ff19">File <span class="_"> </span>I/O<span class="_ _169"> </span>Chapter <span class="_"> </span>3</span></div><div class="t m0 x76 h52 y2a3 ff19 fs2a fc0 sc0 ls0 ws0">The<span class="_ _47"> </span><span class="ff1a">ioctl<span class="_ _47"> </span></span>function <span class="_ _9"></span>was <span class="_ _23"> </span>included <span class="_ _9"></span>in <span class="_ _23"> </span>the <span class="_ _9"></span>Single <span class="_ _9"> </span>UNIX <span class="_ _23"> </span>Speciﬁcation <span class="_ _9"></span>only <span class="_ _23"> </span>as <span class="_ _9"></span>an <span class="_ _23"> </span>extension <span class="_ _9"></span>for</div><div class="t m0 x76 h51 y2a4 ff19 fs2a fc0 sc0 ls0 ws0">dealing <span class="_ _2"></span>with <span class="_ _2"></span>STREAMS <span class="_ _2"></span>devices</div><div class="t m0 xf5 h51 y2f1 ff19 fs2a fc0 sc0 ls0 ws0">[</div><div class="t m0 x9b h51 y2a4 ff19 fs2a fc0 sc0 ls0 ws0">Rago <span class="_ _2"></span>1993</div><div class="t m0 x8e h51 y2f1 ff19 fs2a fc0 sc0 ls0 ws0">]</div><div class="t m0 x176 h51 y2a4 ff19 fs2a fc0 sc0 ls444 ws0">,b<span class="_ _5"></span><span class="ls0">ut <span class="_ _2"></span>it <span class="_ _2"></span>was <span class="_ _2"></span>moved <span class="_ _2"></span>to <span class="_ _2"></span>obsolescent <span class="_ _2"></span>status <span class="_ _2"></span>in <span class="_ _2"></span>SUSv4.</span></div><div class="t m0 x76 h52 y2a5 ff19 fs2a fc0 sc0 ls0 ws0">UNIX <span class="_ _9"></span>System <span class="_ _9"> </span>implementations <span class="_ _23"> </span>use<span class="_ _47"> </span><span class="ff1a">ioctl<span class="_ _66"> </span></span>for <span class="_ _23"> </span>many <span class="_ _9"></span>miscellaneous <span class="_ _9"></span>device <span class="_ _23"> </span>operations.<span class="_ _59"> </span>Some</div><div class="t m0 x76 h51 y2a6 ff19 fs2a fc0 sc0 ls0 ws0">implementations have even extended it for use with regular ﬁles.</div><div class="t m0 x3f h2a ya1f ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _9"></span>prototype <span class="_ _23"></span>that <span class="_ _9"></span>we <span class="_ _23"> </span>show <span class="_ _23"></span>corresponds <span class="_ _9"></span>to <span class="_ _23"></span>POSIX.1.<span class="_ _5a"> </span>FreeBSD <span class="_ _9"></span>8.0 <span class="_ _23"></span>and <span class="_ _23"></span>Mac <span class="_ _9"></span>OS <span class="_ _23"></span>X</div><div class="t m0 x32 h26 ya20 ff19 fsf fc0 sc0 ls0 ws0">10.6.8 <span class="_ _9"></span>declar<span class="ls3e5">et<span class="_ _b"></span><span class="ls0">he <span class="_ _9"></span>second <span class="_ _9"></span>argument <span class="_ _3"></span>as <span class="_ _23"></span>an<span class="_ _45"> </span><span class="ff1a">unsigned <span class="_ _4f"></span>long<span class="ff19 ls445">.T<span class="_ _62"></span><span class="ls0">his <span class="_ _9"></span>detail <span class="_ _23"></span>doesn’t <span class="_ _9"></span>matter<span class="_ _6"></span>,</span></span></span></span></span></div><div class="t m0 x32 h26 yd7d ff19 fsf fc0 sc0 ls0 ws0">since the second argument is always a<span class="_"> </span><span class="ff1a">#define</span><span class="ls44">dn<span class="_ _4f"></span><span class="ls0">ame from a header<span class="_ _6"></span>.</span></span></div><div class="t m0 x3f h2a ya21 ff19 fsf fc0 sc0 ls0 ws0">For the <span class="_ _2"></span>ISO <span class="_ _2"></span>C prototype, an <span class="_ _2"></span>ellipsis <span class="_ _2"></span>is used <span class="_ _2"></span>for <span class="_ _2"></span>the remaining arguments. <span class="_"> </span>Normally<span class="_ _6"></span>,</div><div class="t m0 x32 h2a ya22 ff19 fsf fc0 sc0 ls0 ws0">however<span class="_ _6"></span><span class="ls446">,t<span class="_ _8"></span><span class="ls0">here<span class="_ _47"> </span>is<span class="_ _45"> </span>only <span class="_ _3"></span>one <span class="_ _9"></span>mor<span class="ls446">ea<span class="_ _b"></span><span class="ls45">rg<span class="ls0">ument, <span class="_ _9"></span>and <span class="_ _9"></span>it’s <span class="_ _3"></span>usually <span class="_ _9"></span>a <span class="_ _9"></span>pointer <span class="_ _3"></span>to <span class="_ _9"></span>a <span class="_ _9"></span>variable <span class="_ _3"></span>or <span class="_ _9"></span>a</span></span></span></span></span></div><div class="t m0 x32 h2a yd7e ff19 fsf fc0 sc0 ls0 ws0">structur<span class="_ _0"></span>e.</div><div class="t m0 x3f h2a yd7f ff19 fsf fc0 sc0 ls0 ws0">In <span class="_ _45"> </span>this <span class="_ _47"> </span>prototype, <span class="_ _45"> </span>we <span class="_ _45"> </span>show <span class="_ _47"> </span>only <span class="_ _45"> </span>the <span class="_ _45"> </span>headers <span class="_ _45"> </span>requir<span class="_ _1"></span>ed <span class="_ _45"> </span>for <span class="_ _45"> </span>the <span class="_ _45"> </span>function <span class="_ _45"> </span>itself.</div><div class="t m0 x32 h26 yd80 ff19 fsf fc0 sc0 ls0 ws0">Normally<span class="_ _4"></span><span class="ls447">,a<span class="_ _4a"></span><span class="ls0">dditional <span class="_"> </span>device-speciﬁc <span class="_"> </span>headers <span class="_"> </span>ar<span class="ls447">er<span class="_ _5b"></span><span class="ls0">equired. <span class="_ _59"> </span>For<span class="_ _46"> </span>example, <span class="_"> </span>the<span class="_ _46"> </span><span class="ff1a">ioctl</span></span></span></span></span></div><div class="t m0 x32 h2a yd81 ff19 fsf fc0 sc0 ls0 ws0">commands <span class="_"> </span>for <span class="_"> </span>terminal <span class="_"> </span>I/O, <span class="_"> </span>beyond <span class="_"> </span>the <span class="_"> </span>basic <span class="_"> </span>operations <span class="_"> </span>speciﬁed <span class="_ _e"> </span>by <span class="_"> </span>POSIX.1, <span class="_"> </span>all</div><div class="t m0 x32 h26 yd82 ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">quir<span class="ls44">et<span class="_ _d"></span><span class="ls0">he<span class="_"> </span><span class="ff1a">&lt;termios.h&gt;<span class="_ _66"> </span></span>header<span class="_ _6"></span>.</span></span></span></div><div class="t m0 x3f h26 yd83 ff19 fsf fc0 sc0 ls0 ws0">Each <span class="_ _47"> </span>device <span class="_ _47"> </span>driver <span class="_ _47"> </span>can <span class="_ _45"> </span>deﬁne <span class="_ _47"> </span>its <span class="_ _47"> </span>own <span class="_ _47"> </span>set <span class="_ _47"> </span>of<span class="_ _16"> </span><span class="ff1a">ioctl<span class="_ _16"> </span></span>commands. <span class="_ _16"> </span>The<span class="_ _16"> </span>system,</div><div class="t m0 x32 h26 yd84 ff19 fsf fc0 sc0 ls0 ws0">however<span class="_ _6"></span><span class="ls448">,p<span class="_ _4f"></span><span class="ls45">ro<span class="_ _2"></span><span class="ls0">vides <span class="_ _2"></span>generic<span class="_ _47"> </span><span class="ff1a">ioctl<span class="_ _47"> </span></span>commands <span class="_ _2"></span>for <span class="_ _3"></span>differ<span class="_ _0"></span>ent <span class="_ _2"></span>classes <span class="_ _3"></span>of <span class="_ _2"></span>devices.<span class="_ _16"> </span>Examples</span></span></span></div><div class="t m0 x32 h26 yd85 ff19 fsf fc0 sc0 ls0 ws0">of <span class="_ _2"></span>some <span class="_ _3"></span>of <span class="_ _2"></span>the <span class="_ _3"></span>categories <span class="_ _3"></span>for <span class="_ _2"></span>these <span class="_ _3"></span>generic<span class="_ _47"> </span><span class="ff1a">ioctl<span class="_ _47"> </span></span>commands <span class="_ _2"></span>supported <span class="_ _3"></span>in <span class="_ _2"></span>FreeBSD <span class="_ _2"></span>are</div><div class="t m0 x32 h2a yd86 ff19 fsf fc0 sc0 ls0 ws0">summarized in Figur<span class="ls44">e3<span class="_ _4f"></span><span class="ls0">.15.</span></span></div><div class="t m0 x131 h2d yd87 ff19 fs10 fc0 sc0 ls0 ws0">Constant <span class="_ _17f"> </span>Number<span class="_"> </span>of</div><div class="t m0 x4a h5e yd88 ff19 fs10 fc0 sc0 ls0 ws0">names<span class="_ _180"> </span><span class="ff1a">ioctl</span>s</div><div class="t m0 xe7 h2d yd89 ff19 fs10 fc0 sc0 ls0 ws0">Category<span class="_ _181"> </span>Header</div><div class="t m0 xae h4f yd8a ff19 fs11 fc0 sc0 ls0 ws0">disk labels<span class="_ _bf"> </span><span class="ff1a">DIOxxx <span class="_ _6e"> </span>&lt;sys/disklabel.h&gt;<span class="_ _7b"> </span></span>4</div><div class="t m0 xae h4f yd8b ff19 fs11 fc0 sc0 ls0 ws0">ﬁle I/O<span class="_ _dd"> </span><span class="ff1a">FIOxxx <span class="_ _6e"> </span>&lt;sys/filio.h&gt;<span class="_ _182"> </span></span>14</div><div class="t m0 xae h4f yd8c ff19 fs11 fc0 sc0 ls0 ws0">mag tape I/O<span class="_ _6e"> </span><span class="ff1a">MTIOxxx <span class="_ _48"> </span>&lt;sys/mtio.h&gt;<span class="_ _bc"> </span></span><span class="ls449">11</span></div><div class="t m0 xae h4f yd8d ff19 fs11 fc0 sc0 ls0 ws0">socket I/O<span class="_ _129"> </span><span class="ff1a">SIOxxx <span class="_ _6e"> </span>&lt;sys/sockio.h&gt;<span class="_ _77"> </span></span>73</div><div class="t m0 xae h4f yd8e ff19 fs11 fc0 sc0 ls0 ws0">terminal I/O<span class="_ _2b"> </span><span class="ff1a">TIOxxx <span class="_ _6e"> </span>&lt;sys/ttycom.h&gt;<span class="_ _77"> </span></span>43</div><div class="t m0 x26 h6d yd8f ff18 fs12 fc0 sc0 ls0 ws0">Figure 3.15<span class="_ _5a"> </span><span class="ff19">Common FreeBSD<span class="_"> </span><span class="ff1a">ioctl<span class="_ _53"> </span></span>operations</span></div><div class="t m0 x3f h50 yd90 ff19 fs29 fc0 sc0 ls0 ws0">The <span class="_ _23"> </span>mag <span class="_ _42"> </span>tape <span class="_ _42"> </span>operations <span class="_ _23"> </span>allow <span class="_ _42"> </span>us <span class="_ _42"> </span>to <span class="_ _42"> </span>write <span class="_ _23"> </span>end-of-ﬁle <span class="_ _42"> </span>marks <span class="_ _42"> </span>on <span class="_ _23"> </span>a <span class="_ _42"> </span>tape, <span class="_ _42"> </span>r<span class="_ _0"></span>ewind <span class="_ _23"> </span>a</div><div class="t m0 x32 h50 yd91 ff19 fs29 fc0 sc0 ls0 ws0">tape, <span class="_ _9"></span>space <span class="_ _23"></span>forwar<span class="ls44a">do<span class="_ _43"></span><span class="ls0">ver <span class="_ _23"></span>a <span class="_ _9"></span>speciﬁed <span class="_ _23"></span>number <span class="_ _9"></span>of <span class="_ _23"></span>ﬁles <span class="_ _9"></span>or <span class="_ _9"></span>records, <span class="_ _9"></span>and <span class="_ _9"></span>the <span class="_ _23"></span>like.<span class="_ _5a"> </span>None <span class="_ _23"></span>of</span></span></div><div class="t m0 x32 h5c yd92 ff19 fs29 fc0 sc0 ls0 ws0">these operations <span class="_ _2"></span>is easily <span class="_ _2"></span>expressed in terms <span class="_ _2"></span>of the <span class="_ _2"></span>other functions <span class="_ _2"></span>in the <span class="_ _2"></span>chapter (<span class="ff1a">read</span>,</div><div class="t m0 x32 h5c yd93 ff1a fs29 fc0 sc0 ls0 ws0">write<span class="ff19">,<span class="_ _47"> </span></span>lseek<span class="ff19 ls44b">,a<span class="_ _8"></span><span class="ls0">nd <span class="_ _9"></span>so <span class="_ _3"></span>on), <span class="_ _9"></span>so <span class="_ _3"></span>the <span class="_ _3"></span>easiest <span class="_ _9"></span>way <span class="_ _3"></span>to <span class="_ _9"></span>handle <span class="_ _3"></span>these <span class="_ _9"></span>devices <span class="_ _3"></span>has <span class="_ _9"></span>always <span class="_ _3"></span>been</span></span></div><div class="t m0 x32 h5c yd94 ff19 fs29 fc0 sc0 ls0 ws0">to access their operations using<span class="_"> </span><span class="ff1a">ioctl</span>.</div><div class="t m0 x3f h5c yd95 ff19 fs29 fc0 sc0 lse2 ws0">We <span class="_ _80"> </span>u<span class="_ _9"></span><span class="ls0">se <span class="_ _9"></span>the<span class="_ _47"> </span><span class="ff1a">ioctl<span class="_ _45"> </span></span>function <span class="_ _3"></span>in <span class="_ _3"></span>Section <span class="_ _3"></span>18.12 <span class="_ _9"></span>to <span class="_ _3"></span>fetch <span class="_ _9"></span>and <span class="_ _3"></span>set <span class="_ _3"></span>the <span class="_ _9"></span>size <span class="_ _3"></span>of <span class="_ _3"></span>a <span class="_ _9"></span>terminal’s</span></div><div class="t m0 x32 h50 yd96 ff19 fs29 fc0 sc0 ls0 ws0">window<span class="_ _6"></span><span class="ls44c">,a<span class="_ _d"></span><span class="ls0">nd in Section <span class="_ _2"></span>19.7 when we <span class="_ _2"></span>access the advanced <span class="_ _2"></span>features of pseudo terminals.</span></span></div><div class="t m0 x35 h93 yd97 ff16 fs2e fc0 sc0 ls0 ws0">3.16<span class="_ _6d"> </span><span class="ff1f">/dev/fd</span></div><div class="t m0 x32 h5c yd98 ff19 fs29 fc0 sc0 ls0 ws0">Newer systems <span class="_ _2"></span>provide a directory named<span class="_ _66"> </span><span class="ff1a">/dev/fd<span class="_ _66"> </span></span>whose <span class="_ _2"></span>entries <span class="_ _2"></span>ar<span class="ls44d">eﬁ<span class="_ _4f"></span><span class="ls0">les named<span class="_ _66"> </span><span class="ff1a">0</span>,<span class="_ _66"> </span><span class="ff1a">1</span>,</span></span></div><div class="t m0 x32 h5c yd99 ff1a fs29 fc0 sc0 ls0 ws0">2<span class="ff19 ls44e">,a<span class="_ _43"></span><span class="ls0">nd <span class="_ _23"> </span>so <span class="_ _42"> </span>on.<span class="_ _54"> </span>Opening <span class="_ _42"> </span>the <span class="_ _42"> </span>ﬁle<span class="_ _35"> </span><span class="ff1a">/dev/fd/<span class="ff1b">n<span class="_ _44"> </span></span></span>is <span class="_ _23"> </span>equivalent <span class="_ _42"> </span>to <span class="_ _42"> </span>duplicating <span class="_ _42"> </span>descriptor<span class="_ _44"> </span><span class="ff1b">n</span>,</span></span></div><div class="t m0 x32 h5b yd9a ff19 fs29 fc0 sc0 ls0 ws0">assuming that descriptor<span class="_"> </span><span class="ff1b">n<span class="_"> </span></span>is open.</div><div class="t m0 x76 h6d yd9b ff19 fs12 fc0 sc0 ls0 ws0">The<span class="_ _45"> </span><span class="ff1a">/dev/fd<span class="_ _45"> </span></span>featur<span class="ls44f">ew<span class="_ _b"></span><span class="ls0">as <span class="_ _23"> </span>developed <span class="_ _42"> </span>by <span class="_ _42"> </span>T<span class="_ _6"></span>om <span class="_ _42"> </span>Duf<span class="ls44f">fa<span class="_ _b"></span><span class="ls0">nd <span class="_ _23"> </span>appeared <span class="_ _42"> </span>in <span class="_ _42"> </span>the <span class="_ _23"> </span>8th <span class="_ _42"> </span>Edition <span class="_ _42"> </span>of <span class="_ _42"> </span>the</span></span></span></span></div><div class="t m0 x76 h2f yd9c ff19 fs12 fc0 sc0 ls0 ws0">Research <span class="_ _2"></span>UNIX <span class="_ _3"></span>System.<span class="_ _4b"> </span>It <span class="_ _3"></span>is <span class="_ _9"></span>supported <span class="_ _2"></span>by <span class="_ _3"></span>all <span class="_ _9"></span>of <span class="_ _2"></span>the <span class="_ _9"></span>systems <span class="_ _2"></span>described <span class="_ _3"></span>in <span class="_ _9"></span>this <span class="_ _2"></span>book: <span class="_ _3"></span>FreeBSD</div><div class="t m0 x76 h2f yd9d ff19 fs12 fc0 sc0 ls0 ws0">8.0, Linux 3.2.0, Mac OS X 10.6.8, and Solaris 10.<span class="_ _35"> </span>It is not part of POSIX.1.</div><a class="l" href="#pfd" data-dest-detail='[13,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.894508px;bottom:294.648897px;width:86.399811px;height:19.680008px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
