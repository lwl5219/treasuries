<div id="pfa2" class="pf w4 h1f" data-page-no="a2"><div class="pc pca2 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bga2.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">128<span class="_ _1b"> </span><span class="ff19">Files <span class="_"> </span>and <span class="_"> </span>Directories <span class="_ _18d"> </span>Chapter<span class="_ _4b"> </span>4</span></div><div class="t m0 x32 h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y426 ff1a fs2d fc0 sc0 ls0 ws0">int <span class="_ _82"> </span>i,<span class="_"> </span>fd;</div><div class="t m0 x8a h57 y800 ff1a fs2d fc0 sc0 ls0 ws0">struct stat<span class="_ _8a"> </span>statbuf;</div><div class="t m0 x8a h57 y801 ff1a fs2d fc0 sc0 ls0 ws0">struct timespec times[2];</div><div class="t m0 x8a h57 y124b ff1a fs2d fc0 sc0 ls0 ws0">for (i = 1; i &lt; argc; i++) {</div><div class="t m0 x9d h57 y124c ff1a fs2d fc0 sc0 ls0 ws0">if (stat(argv[i], &amp;statbuf) &lt; 0) {<span class="_ _d9"> </span>/* fetch current times */</div><div class="t m0 x1f h57 y124d ff1a fs2d fc0 sc0 ls0 ws0">err_ret(&quot;%s: stat error&quot;, argv[i]);</div><div class="t m0 x1f h57 y124e ff1a fs2d fc0 sc0 ls0 ws0">continue;</div><div class="t m0 x9d h57 y124f ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x9d h57 y1250 ff1a fs2d fc0 sc0 ls0 ws0">if ((fd = open(argv[i], O_RDWR | O_TRUNC)) &lt; 0) { /* truncate */</div><div class="t m0 x1f h57 y8d8 ff1a fs2d fc0 sc0 ls0 ws0">err_ret(&quot;%s: open error&quot;, argv[i]);</div><div class="t m0 x1f h57 y8d9 ff1a fs2d fc0 sc0 ls0 ws0">continue;</div><div class="t m0 x9d h57 y8da ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x9d h57 y8db ff1a fs2d fc0 sc0 ls0 ws0">times[0] = statbuf.st_atim;</div><div class="t m0 x9d h57 y8dc ff1a fs2d fc0 sc0 ls0 ws0">times[1] = statbuf.st_mtim;</div><div class="t m0 x9d h57 y8dd ff1a fs2d fc0 sc0 ls0 ws0">if (futimens(fd, times) &lt; 0)<span class="_ _186"> </span>/* reset times */</div><div class="t m0 x1f h57 y8de ff1a fs2d fc0 sc0 ls0 ws0">err_ret(&quot;%s: futimens error&quot;, argv[i]);</div><div class="t m0 x9d h57 y8df ff1a fs2d fc0 sc0 ls0 ws0">close(fd);</div><div class="t m0 x8a h57 y1251 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y1252 ff1a fs2d fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h57 y1253 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x27 h5e y1254 ff18 fs10 fc0 sc0 ls0 ws0">Figure 4.21<span class="_ _5a"> </span><span class="ff19">Example of<span class="_"> </span><span class="ff1a">futimens<span class="_ _e"> </span></span>function</span></div><div class="t m0 x32 h49 y1255 ff19 fs26 fc0 sc0 ls164 ws0">We <span class="_ _53"> </span>c<span class="_ _9"></span><span class="ls0">an demonstrate the program in Figur<span class="ls5a2">e4<span class="_ _4f"></span><span class="ls0">.21 on Linux with the following commands:</span></span></span></div><div class="t m0 x3f h4e y1256 ff1a fs28 fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">ls -l changemod times<span class="_ _176"> </span><span class="ff1b">look at sizes and last-modiﬁcation times</span></span></div><div class="t m0 x3f h4e y1257 ff1a fs28 fc0 sc0 ls0 ws0">-rwxr-xr-x <span class="_"> </span>1<span class="_"> </span>sar <span class="_ _d9"> </span>13792<span class="_"> </span>Jan 22 01:26 changemod</div><div class="t m0 x3f h4e y1258 ff1a fs28 fc0 sc0 ls0 ws0">-rwxr-xr-x <span class="_"> </span>1<span class="_"> </span>sar <span class="_ _d9"> </span>13824<span class="_"> </span>Jan 22 01:26 times</div><div class="t m0 x3f h4e y1259 ff1a fs28 fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">ls -lu changemod times<span class="_ _186"> </span><span class="ff1b">look at last-access times</span></span></div><div class="t m0 x3f h4e y125a ff1a fs28 fc0 sc0 ls0 ws0">-rwxr-xr-x <span class="_"> </span>1<span class="_"> </span>sar <span class="_ _d9"> </span>13792<span class="_"> </span>Jan 22 22:22 changemod</div><div class="t m0 x3f h4e y125b ff1a fs28 fc0 sc0 ls0 ws0">-rwxr-xr-x <span class="_"> </span>1<span class="_"> </span>sar <span class="_ _d9"> </span>13824<span class="_"> </span>Jan 22 22:22 times</div><div class="t m0 x3f h4e y125c ff1a fs28 fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">date<span class="_ _1ab"> </span><span class="ff1b">print today’<span class="_ _1"></span><span class="ls396">sd<span class="_ _5"></span><span class="ls0">ate</span></span></span></span></div><div class="t m0 x3f h4e y125d ff1a fs28 fc0 sc0 ls0 ws0">Fri Jan 27 20:53:46 EST 2012</div><div class="t m0 x3f h4e y125e ff1a fs28 fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">./a.out changemod times<span class="_ _b7"> </span><span class="ff1b">run the program in Figur<span class="ls396">e4<span class="_ _d"></span><span class="ls0">.21</span></span></span></span></div><div class="t m0 x3f h4e y125f ff1a fs28 fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">ls -l changemod times<span class="_ _176"> </span><span class="ff1b">and check the results</span></span></div><div class="t m0 x3f h4e y1260 ff1a fs28 fc0 sc0 ls0 ws0">-rwxr-xr-x <span class="_"> </span>1<span class="_"> </span>sar <span class="_ _189"> </span>0<span class="_"> </span>Jan 22 01:26 changemod</div><div class="t m0 x3f h4e y1261 ff1a fs28 fc0 sc0 ls0 ws0">-rwxr-xr-x <span class="_"> </span>1<span class="_"> </span>sar <span class="_ _189"> </span>0<span class="_"> </span>Jan 22 01:26 times</div><div class="t m0 x3f h4e y1262 ff1a fs28 fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">ls -lu changemod times<span class="_ _186"> </span><span class="ff1b">check the last-access times also</span></span></div><div class="t m0 x3f h4e y1263 ff1a fs28 fc0 sc0 ls0 ws0">-rwxr-xr-x <span class="_"> </span>1<span class="_"> </span>sar <span class="_ _189"> </span>0<span class="_"> </span>Jan 22 22:22 changemod</div><div class="t m0 x3f h4e y1264 ff1a fs28 fc0 sc0 ls0 ws0">-rwxr-xr-x <span class="_"> </span>1<span class="_"> </span>sar <span class="_ _189"> </span>0<span class="_"> </span>Jan 22 22:22 times</div><div class="t m0 x3f h4e y1265 ff1a fs28 fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">ls -lc changemod times<span class="_ _186"> </span><span class="ff1b">and the changed-status times</span></span></div><div class="t m0 x3f h4e y1266 ff1a fs28 fc0 sc0 ls0 ws0">-rwxr-xr-x <span class="_"> </span>1<span class="_"> </span>sar <span class="_ _189"> </span>0<span class="_"> </span>Jan 27 20:53 changemod</div><div class="t m0 x3f h4e y1267 ff1a fs28 fc0 sc0 ls0 ws0">-rwxr-xr-x <span class="_"> </span>1<span class="_"> </span>sar <span class="_ _189"> </span>0<span class="_"> </span>Jan 27 20:53 times</div><div class="t m0 x32 h49 y1268 ff19 fs26 fc0 sc0 ls0 ws0">As <span class="_ _e"> </span>we <span class="_ _e"> </span>would <span class="_"> </span>expect, <span class="_ _53"> </span>the <span class="_"> </span>last-modiﬁcation <span class="_ _53"> </span>times <span class="_"> </span>and <span class="_ _53"> </span>the <span class="_ _e"> </span>last-access <span class="_"> </span>times <span class="_ _53"> </span>have <span class="_"> </span>not</div><div class="t m0 x32 h49 y1269 ff19 fs26 fc0 sc0 ls0 ws0">changed. <span class="_ _5a"> </span>The<span class="_ _5a"> </span>changed-status <span class="_ _45"> </span>times, <span class="_ _45"> </span>however<span class="_ _6"></span><span class="ls5a3">,h<span class="_ _62"></span><span class="ls0">ave <span class="_ _45"> </span>changed <span class="_ _45"> </span>to <span class="_ _45"> </span>the <span class="_ _47"> </span>time <span class="_ _45"> </span>that <span class="_ _45"> </span>the</span></span></div><div class="t m0 x32 h49 y126a ff19 fs26 fc0 sc0 ls0 ws0">program was r<span class="_ _0"></span>un.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
