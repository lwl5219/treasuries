<div id="pf10e" class="pf w4 h1f" data-page-no="10e"><div class="pc pc10e w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg10e.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">236<span class="_ _1b"> </span><span class="ff19">Process <span class="_"> </span>Contr<span class="_ _0"></span>ol <span class="_ _222"> </span>Chapter<span class="_ _4b"> </span>8</span></div><div class="t m0 x76 h52 y2a3 ff19 fs2a fc0 sc0 ls0 ws0">Most <span class="_"> </span>modern <span class="_ _e"> </span>implementations <span class="_ _80"> </span>of<span class="_ _44"> </span><span class="ff1a">exit<span class="_ _44"> </span></span>do <span class="_"> </span>not <span class="_"> </span>bother <span class="_ _80"> </span>to <span class="_"> </span>close <span class="_ _e"> </span>the <span class="_ _80"> </span>streams. <span class="_ _35"> </span>Because<span class="_ _44"> </span>the</div><div class="t m0 x76 h51 y2a4 ff19 fs2a fc0 sc0 ls0 ws0">process <span class="_"> </span>is <span class="_ _42"> </span>about <span class="_"> </span>to <span class="_"> </span>exit, <span class="_"> </span>the <span class="_"> </span>kernel <span class="_"> </span>will <span class="_"> </span>close <span class="_ _42"> </span>all <span class="_"> </span>the <span class="_"> </span>ﬁle <span class="_"> </span>descriptors <span class="_"> </span>open <span class="_"> </span>in <span class="_"> </span>the <span class="_"> </span>pr<span class="_ _0"></span>ocess.</div><div class="t m0 x76 h51 y2a5 ff19 fs2a fc0 sc0 ls0 ws0">Closing them in the library simply adds overhead without any beneﬁt.</div><div class="t m0 x3f h49 y1f54 ff19 fs26 fc0 sc0 ls0 ws0">Section <span class="_ _35"> </span>5.6 <span class="_ _35"> </span>of <span class="_ _35"> </span>McKusick <span class="_ _35"> </span>et <span class="_ _45"> </span>al.</div><div class="t m0 x1f2 h49 y1f55 ff19 fs26 fc0 sc0 ls0 ws0">[</div><div class="t m0 xc5 h49 y1f54 ff19 fs26 fc0 sc0 ls0 ws0">1996</div><div class="t m0 xcb h49 y1f55 ff19 fs26 fc0 sc0 ls0 ws0">]</div><div class="t m0 x8d h49 y1f54 ff19 fs26 fc0 sc0 ls0 ws0">contains <span class="_ _35"> </span>additional <span class="_ _35"> </span>information <span class="_ _35"> </span>on <span class="_ _35"> </span>the</div><div class="t m0 x32 h4d y1f56 ff19 fs26 fc0 sc0 ls0 ws0">implementation <span class="_ _44"> </span>issues <span class="_ _44"> </span>of<span class="_ _54"> </span><span class="ff1a">fork<span class="_ _54"> </span></span>and<span class="_ _54"> </span><span class="ff1a">vfork</span><span class="ls971">.E<span class="_ _4d"></span><span class="ls0">xer<span class="_ _0"></span>cises <span class="_ _44"> </span>8.1 <span class="_ _44"> </span>and <span class="_ _44"> </span>8.2 <span class="_ _44"> </span>continue <span class="_ _44"> </span>the</span></span></div><div class="t m0 x32 h4d y1f57 ff19 fs26 fc0 sc0 ls0 ws0">discussion of<span class="_"> </span><span class="ff1a">vfork</span>.</div><div class="t m0 x35 h7b y1f58 ff16 fs27 fc0 sc0 ls0 ws0">8.5<span class="_ _72"> </span><span class="ff1f">exit<span class="_ _54"> </span></span>Functions</div><div class="t m0 x32 h49 y1f59 ff19 fs26 fc0 sc0 ls0 ws0">As we described in Section 7.3, a process can terminate normally in ﬁve ways:</div><div class="t m0 x3f h4d y1f5a ff19 fs26 fc0 sc0 ls0 ws0">1. <span class="_ _51"> </span>Executing<span class="_ _45"> </span>a<span class="_ _45"> </span><span class="ff1a">return<span class="_ _45"> </span></span>from <span class="_ _3"></span>the<span class="_ _45"> </span><span class="ff1a">main<span class="_ _45"> </span></span>function. <span class="_ _45"> </span>As<span class="_ _45"> </span>we <span class="_ _9"></span>saw <span class="_ _23"></span>in <span class="_ _9"></span>Section <span class="_ _9"></span>7.3, <span class="_ _9"></span>this <span class="_ _9"></span>is</div><div class="t m0 x41 h4d y1f5b ff19 fs26 fc0 sc0 ls0 ws0">equivalent to calling<span class="_"> </span><span class="ff1a">exit</span>.</div><div class="t m0 x3f h4d y1f5c ff19 fs26 fc0 sc0 ls0 ws0">2. <span class="_ _51"> </span>Calling<span class="_ _45"> </span>the<span class="_ _45"> </span><span class="ff1a">exit<span class="_ _45"> </span></span>function. <span class="_ _45"> </span>This<span class="_ _45"> </span>function <span class="_ _9"></span>is <span class="_ _9"></span>deﬁned <span class="_ _9"></span>by <span class="_ _9"></span>ISO <span class="_ _9"></span>C <span class="_ _9"></span>and <span class="_ _9"></span>includes <span class="_ _9"></span>the</div><div class="t m0 x41 h4d y1f5d ff19 fs26 fc0 sc0 ls0 ws0">calling <span class="_ _53"> </span>of <span class="_"> </span>all <span class="_ _53"> </span>exit <span class="_ _e"> </span>handlers <span class="_ _e"> </span>that <span class="_ _e"> </span>have <span class="_ _e"> </span>been <span class="_ _e"> </span>register<span class="_ _0"></span>ed <span class="_ _53"> </span>by <span class="_"> </span>calling<span class="_ _44"> </span><span class="ff1a">atexit<span class="_ _59"> </span></span>and</div><div class="t m0 x41 h49 y1f5e ff19 fs26 fc0 sc0 ls0 ws0">closing <span class="_ _45"> </span>all <span class="_ _45"> </span>standar<span class="ls972">dI<span class="_ _26"></span><span class="ls0">/O <span class="_ _45"> </span>streams. <span class="_ _16"> </span>Because<span class="_ _5a"> </span>ISO <span class="_ _45"> </span>C <span class="_ _45"> </span>does <span class="_ _45"> </span>not <span class="_ _45"> </span>deal <span class="_ _45"> </span>with <span class="_ _45"> </span>ﬁle</span></span></div><div class="t m0 x41 h49 y1f5f ff19 fs26 fc0 sc0 ls0 ws0">descriptors, <span class="_ _47"> </span>multiple <span class="_ _45"> </span>pr<span class="_ _0"></span>ocesses <span class="_ _47"> </span>(parents <span class="_ _47"> </span>and <span class="_ _45"> </span>childr<span class="_ _0"></span>en), <span class="_ _47"> </span>and <span class="_ _45"> </span>job <span class="_ _47"> </span>control, <span class="_ _47"> </span>the</div><div class="t m0 x41 h49 y1f60 ff19 fs26 fc0 sc0 ls0 ws0">deﬁnition of this function is incomplete for a UNIX system.</div><div class="t m0 x3f h4d y1f61 ff19 fs26 fc0 sc0 ls0 ws0">3. <span class="_ _51"> </span>Calling<span class="_ _45"> </span>the<span class="_ _35"> </span><span class="ff1a">_exit<span class="_ _45"> </span></span>or<span class="_ _45"> </span><span class="ff1a">_Exit<span class="_ _45"> </span></span>function. <span class="_ _45"> </span>ISO<span class="_ _35"> </span><span class="ls973">Cd<span class="_ _b"></span><span class="ls0">eﬁnes<span class="_ _45"> </span><span class="ff1a">_Exit<span class="_ _45"> </span></span>to <span class="_ _9"></span>provide <span class="_ _9"></span>a <span class="_ _23"></span>way</span></span></div><div class="t m0 x41 h49 y1f62 ff19 fs26 fc0 sc0 ls0 ws0">for <span class="_ _e"> </span>a <span class="_ _e"> </span>process <span class="_ _e"> </span>to <span class="_ _e"> </span>terminate <span class="_ _e"> </span>without <span class="_"> </span>running <span class="_ _53"> </span>exit <span class="_ _e"> </span>handlers <span class="_"> </span>or <span class="_ _53"> </span>signal <span class="_"> </span>handlers.</div><div class="t m0 x41 h49 y1f63 ff19 fs26 fc0 sc0 ls0 ws0">Whether <span class="_ _2"></span>standar<span class="ls974">dI<span class="_ _8"></span><span class="ls0">/O <span class="_ _2"></span>streams <span class="_ _2"></span>ar<span class="ls974">eﬂ<span class="_ _8"></span><span class="ls0">ushed <span class="_ _2"></span>depends <span class="_ _2"></span>on <span class="_ _2"></span>the <span class="_ _2"></span>implementation.<span class="_ _61"> </span>On</span></span></span></span></div><div class="t m0 x41 h4d y1f64 ff19 fs26 fc0 sc0 ls0 ws0">UNIX <span class="_ _23"></span>systems,<span class="_ _45"> </span><span class="ff1a">_Exit<span class="_ _35"> </span></span>and<span class="_ _45"> </span><span class="ff1a">_exit<span class="_ _35"> </span></span>ar<span class="ls975">es<span class="_ _43"></span><span class="ls0">ynonymous <span class="_ _23"></span>and <span class="_ _23"></span>do <span class="_ _9"></span>not <span class="_ _23"> </span>ﬂush <span class="_ _23"> </span>standard</span></span></div><div class="t m0 x41 h4d y1f65 ff19 fs26 fc0 sc0 ls0 ws0">I/O <span class="_ _e"> </span>streams. <span class="_ _4b"> </span>The<span class="_ _4b"> </span><span class="ff1a">_exit<span class="_ _59"> </span></span>function <span class="_ _e"> </span>is <span class="_ _e"> </span>called <span class="_"> </span>by<span class="_ _44"> </span><span class="ff1a">exit<span class="_ _59"> </span></span>and <span class="_ _e"> </span>handles <span class="_"> </span>the <span class="_ _53"> </span>UNIX</div><div class="t m0 x41 h4d y1f66 ff19 fs26 fc0 sc0 ls0 ws0">system-speciﬁc details;<span class="_"> </span><span class="ff1a">_exit<span class="_ _80"> </span></span>is speciﬁed by POSIX.1.</div><div class="t m0 x38 h5e y1f67 ff19 fs10 fc0 sc0 ls0 ws0">In <span class="_ _42"> </span>most <span class="_"> </span>UNIX <span class="_ _42"> </span>system <span class="_"> </span>implementations,<span class="_ _45"> </span><span class="ff1a">exit</span></div><div class="t m0 x153 h2d y1f68 ff19 fs10 fc0 sc0 ls0 ws0">(</div><div class="t m0 x1da h2d y1f67 ff19 fs10 fc0 sc0 ls0 ws0">3</div><div class="t m0 x1dc h2d y1f68 ff19 fs10 fc0 sc0 ls0 ws0">)</div><div class="t m0 x12d h2d y1f67 ff19 fs10 fc0 sc0 ls0 ws0">is <span class="_ _42"> </span>a <span class="_"> </span>function <span class="_ _42"> </span>in <span class="_"> </span>the <span class="_ _42"> </span>standar<span class="ls976">dC</span></div><div class="t m0 x38 h5e y1f69 ff19 fs10 fc0 sc0 ls0 ws0">library<span class="_ _6"></span><span class="ls136">,w<span class="_ _84"></span><span class="ls0">hereas<span class="_"> </span><span class="ff1a">_exit</span></span></span></div><div class="t m0 x1f5 h2d y1f6a ff19 fs10 fc0 sc0 ls0 ws0">(</div><div class="t m0 xc5 h2d y1f69 ff19 fs10 fc0 sc0 ls0 ws0">2</div><div class="t m0 xde h2d y1f6a ff19 fs10 fc0 sc0 ls0 ws0">)</div><div class="t m0 x88 h2d y1f69 ff19 fs10 fc0 sc0 ls0 ws0">is a system call.</div><div class="t m0 x3f h4d y1f6b ff19 fs26 fc0 sc0 ls0 ws0">4. <span class="_ _51"> </span>Executing<span class="_ _66"> </span>a<span class="_ _47"> </span><span class="ff1a">return<span class="_ _66"> </span></span>from <span class="_ _2"></span>the <span class="_ _2"></span>start <span class="_ _2"></span>routine <span class="_ _2"></span>of <span class="_ _2"></span>the <span class="_ _2"></span>last <span class="_ _3"></span>thread in <span class="_ _2"></span>the <span class="_ _3"></span>process. <span class="_"> </span>The</div><div class="t m0 x41 h49 y1f6c ff19 fs26 fc0 sc0 lscc ws0">re<span class="ls0">turn <span class="_ _47"> </span>value <span class="_ _47"> </span>of <span class="_ _47"> </span>the <span class="_ _47"> </span>thread <span class="_"> </span>is <span class="_ _47"> </span>not <span class="_ _47"> </span>used <span class="_ _47"> </span>as <span class="_ _47"> </span>the <span class="_ _47"> </span>return <span class="_ _66"> </span>value <span class="_ _47"> </span>of <span class="_ _47"> </span>the <span class="_ _47"> </span>process,</span></div><div class="t m0 x41 h49 y1f6d ff19 fs26 fc0 sc0 ls0 ws0">however<span class="_ _6"></span><span class="ls977">.W<span class="_ _26"></span><span class="ls0">hen <span class="_ _23"> </span>the <span class="_ _23"></span>last <span class="_ _9"></span>thread <span class="_ _23"></span>returns <span class="_ _9"></span>from <span class="_ _9"></span>its <span class="_ _23"></span>start <span class="_ _9"></span>routine, <span class="_ _23"></span>the <span class="_ _9"></span>process <span class="_ _23"></span>exits</span></span></div><div class="t m0 x41 h49 y1f6e ff19 fs26 fc0 sc0 ls0 ws0">with a termination status of 0.</div><div class="t m0 x3f h4d y1f6f ff19 fs26 fc0 sc0 ls0 ws0">5. <span class="_ _51"> </span>Calling<span class="_ _4b"> </span>the<span class="_ _4b"> </span><span class="ff1a">pthread_exit<span class="_ _44"> </span></span>function <span class="_ _e"> </span>from <span class="_ _53"> </span>the <span class="_ _53"> </span>last <span class="_ _53"> </span>thread <span class="_ _53"> </span>in <span class="_ _53"> </span>the <span class="_ _e"> </span>process. <span class="_ _44"> </span>As</div><div class="t m0 x41 h49 y1f70 ff19 fs26 fc0 sc0 ls0 ws0">with the <span class="_ _2"></span>previous case, <span class="_ _2"></span>the <span class="_ _2"></span>exit status <span class="_ _2"></span>of <span class="_ _2"></span>the <span class="_ _2"></span>process in <span class="_ _2"></span>this situation <span class="_ _2"></span>is <span class="_ _2"></span>always <span class="_ _2"></span>0,</div><div class="t m0 x41 h4d y1f71 ff19 fs26 fc0 sc0 lscc ws0">re<span class="ls0">gardless <span class="_ _53"> </span>of <span class="_ _53"> </span>the <span class="_ _53"> </span>argument <span class="_ _42"> </span>passed <span class="_ _53"> </span>to<span class="_ _4b"> </span><span class="ff1a">pthread_exit</span><span class="ls978">.W<span class="_ _49"></span><span class="ls0">e’ll <span class="_ _53"> </span>say <span class="_ _53"> </span>mor<span class="ls979">ea<span class="_ _55"></span><span class="ls0">bout</span></span></span></span></span></div><div class="t m0 x41 h4d y1f72 ff1a fs26 fc0 sc0 ls0 ws0">pthread_exit<span class="_ _80"> </span><span class="ff19">in Section 1<span class="_ _1"></span>1.5.</span></div><div class="t m0 x32 h49 y1f73 ff19 fs26 fc0 sc0 ls0 ws0">The three forms of abnormal termination ar<span class="_ _0"></span>e<span class="_"> </span>as<span class="_"> </span>follows:</div><div class="t m0 x3f h4d y1f74 ff19 fs26 fc0 sc0 ls0 ws0">1. <span class="_ _51"> </span>Calling<span class="_ _46"> </span><span class="ff1a">abort</span><span class="ls97a">.T<span class="_ _49"></span><span class="ls0">his <span class="_ _47"> </span>is <span class="_"> </span>a <span class="_ _66"> </span>special <span class="_ _47"> </span>case <span class="_"> </span>of <span class="_ _66"> </span>the <span class="_ _47"> </span>next <span class="_"> </span>item, <span class="_ _66"> </span>as <span class="_ _47"> </span>it <span class="_"> </span>generates <span class="_ _66"> </span>the</span></span></div><div class="t m0 x41 h4d y1f75 ff1a fs26 fc0 sc0 ls0 ws0">SIGABRT<span class="_ _80"> </span><span class="ff19">signal.</span></div><div class="t m0 x3f h49 y1f76 ff19 fs26 fc0 sc0 ls0 ws0">2. <span class="_ _51"> </span>When<span class="_"> </span>the <span class="_ _2"></span>process r<span class="_ _0"></span>eceives certain signals.<span class="_ _61"> </span>(W<span class="_ _6"></span><span class="ls97b">ed<span class="_ _d"></span><span class="ls0">escribe signals <span class="_ _2"></span>in mor<span class="ls97b">ed<span class="_ _4f"></span><span class="ls0">etail <span class="_ _2"></span>in</span></span></span></span></div><div class="t m0 x41 h49 y1f77 ff19 fs26 fc0 sc0 ls0 ws0">Chapter <span class="_ _23"></span>10.)<span class="_ _5a"> </span>The <span class="_ _23"> </span>signal <span class="_ _23"> </span>can <span class="_ _23"> </span>be <span class="_ _23"></span>generated <span class="_ _23"></span>by <span class="_ _23"></span>the <span class="_ _23"></span>pr<span class="_ _0"></span>ocess <span class="_ _23"></span>itself <span class="_ _9"></span>(e.g., <span class="_ _23"> </span>by <span class="_ _23"> </span>calling</div><div class="t m0 x41 h4d y1f78 ff19 fs26 fc0 sc0 ls0 ws0">the<span class="_ _59"> </span><span class="ff1a">abort<span class="_ _4b"> </span></span>function), <span class="_"> </span>by <span class="_ _e"> </span>some <span class="_"> </span>other <span class="_ _e"> </span>process, <span class="_ _e"> </span>or <span class="_ _e"> </span>by <span class="_"> </span>the <span class="_ _e"> </span>kernel.<span class="_ _48"> </span>Examples <span class="_"> </span>of</div><a class="l" href="#pff" data-dest-detail='[15,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892842px;bottom:1009.490965px;width:128.807602px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
