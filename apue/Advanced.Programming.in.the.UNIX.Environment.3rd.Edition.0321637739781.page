<div id="pf30d" class="pf w4 h1f" data-page-no="30d"><div class="pc pc30d w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg30d.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>20.4<span class="_ _310"> </span>Implementation <span class="_"> </span>Overview<span class="_ _1b"> </span><span class="ff18">747</span></div><div class="t m0 x3f h26 y12f ff19 fsf fc0 sc0 ls65 ws0">Wi<span class="_ _3"></span><span class="ls0">th<span class="_ _45"> </span><span class="ff1a">db_store</span><span class="ls571">,o<span class="_ _b"></span><span class="ls0">nly <span class="_ _9"></span>one <span class="_ _9"></span>recor<span class="ls571">df<span class="_ _b"></span><span class="ls0">or <span class="_ _3"></span>each <span class="_ _23"></span>key <span class="_ _9"></span>is <span class="_ _9"></span>allowed.<span class="_ _5a"> </span>Some <span class="_ _23"></span>database <span class="_ _9"></span>systems</span></span></span></span></span></div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">allow <span class="_ _9"></span>a <span class="_ _23"></span>key <span class="_ _9"></span>to <span class="_ _23"></span>have <span class="_ _9"></span>multiple <span class="_ _9"></span>records <span class="_ _9"></span>and <span class="_ _9"></span>then <span class="_ _23"></span>provide <span class="_ _3"></span>a <span class="_ _23"></span>way <span class="_ _9"></span>to <span class="_ _23"></span>access <span class="_ _9"></span>all <span class="_ _23"></span>the <span class="_ _9"></span>records</div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">associated <span class="_ _42"> </span>with <span class="_ _23"> </span>a <span class="_ _42"> </span>given <span class="_ _42"> </span>key<span class="_ _4"></span><span class="lsb8b">.A<span class="_ _7"></span><span class="ls0">dditionally<span class="_ _6"></span>,<span class="_ _35"> </span>we<span class="_ _35"> </span>have <span class="_ _42"> </span>only <span class="_ _42"> </span>a <span class="_ _42"> </span>single <span class="_ _23"> </span>index <span class="_ _42"> </span>ﬁle, <span class="_ _42"> </span>meaning</span></span></div><div class="t m0 x32 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">that <span class="_ _42"> </span>each <span class="_ _23"> </span>data <span class="_ _42"> </span>recor<span class="_ _0"></span><span class="ls161c">dc<span class="_ _43"></span><span class="ls0">an <span class="_ _23"> </span>have <span class="_ _42"> </span>only <span class="_ _42"> </span>a <span class="_ _42"> </span>single <span class="_ _23"> </span>key <span class="_ _42"> </span>(we <span class="_ _42"> </span>don’t <span class="_ _42"> </span>support <span class="_ _23"> </span>secondary <span class="_ _42"> </span>keys).</span></span></div><div class="t m0 x32 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">Some database systems allow each recor<span class="_ _0"></span>d<span class="_"> </span>to<span class="_"> </span>have multiple keys and often use one index</div><div class="t m0 x32 h2a y134 ff19 fsf fc0 sc0 ls0 ws0">ﬁle <span class="_ _e"> </span>per <span class="_ _e"> </span>key<span class="_ _6"></span><span class="ls984">.E<span class="_ _64"></span><span class="ls0">ach <span class="_ _e"> </span>time <span class="_ _e"> </span>a <span class="_"> </span>new <span class="_ _53"> </span>recor<span class="_ _0"></span><span class="ls985">di<span class="_ _55"></span><span class="ls161d">si<span class="_ _55"></span><span class="ls0">nserted <span class="_ _e"> </span>or <span class="_ _e"> </span>deleted, <span class="_"> </span>all <span class="_ _53"> </span>index <span class="_"> </span>ﬁles <span class="_ _53"> </span>must <span class="_"> </span>be</span></span></span></span></span></div><div class="t m0 x32 h2a y135 ff19 fsf fc0 sc0 ls0 ws0">updated <span class="_ _9"></span>accordingly<span class="_ _4"></span><span class="ls161e">.(<span class="_ _62"></span><span class="ls0">An <span class="_ _9"></span>example <span class="_ _23"></span>of <span class="_ _9"></span>a <span class="_ _23"></span>ﬁle <span class="_ _9"></span>with <span class="_ _23"></span>multiple <span class="_ _9"></span>indexes <span class="_ _23"></span>is <span class="_ _9"></span>an <span class="_ _23"></span>employee <span class="_ _9"></span>ﬁle.</span></span></div><div class="t m0 x32 h2a y136 ff19 fsf fc0 sc0 ls5f ws0">We <span class="_ _66"> </span>c<span class="_ _9"></span><span class="ls0">ould <span class="_ _9"></span>have <span class="_ _9"></span>one <span class="_ _3"></span>index <span class="_ _9"></span>whose <span class="_ _9"></span>key <span class="_ _9"></span>is <span class="_ _9"></span>the <span class="_ _9"></span>employee <span class="_ _9"></span>ID <span class="_ _3"></span>and <span class="_ _9"></span>another <span class="_ _9"></span>whose <span class="_ _9"></span>key <span class="_ _9"></span>is <span class="_ _9"></span>the</span></div><div class="t m0 x32 h2a y137 ff19 fsf fc0 sc0 ls0 ws0">employee’s <span class="_ _3"></span>Social <span class="_ _3"></span>Security <span class="_ _3"></span>number<span class="_ _6"></span><span class="ls9fc">.H<span class="_ _1d"></span><span class="ls0">aving <span class="_ _3"></span>an <span class="_ _9"></span>index <span class="_ _2"></span>whose <span class="_ _3"></span>key <span class="_ _3"></span>is <span class="_ _9"></span>the <span class="_ _2"></span>employee <span class="_ _3"></span>name</span></span></div><div class="t m0 x32 h2a y138 ff19 fsf fc0 sc0 ls0 ws0">could be a problem, as names ar<span class="_ _0"></span><span class="ls44">en<span class="_ _d"></span><span class="ls0">ot always unique.)</span></span></div><div class="t m0 x3f h2a y139 ff19 fsf fc0 sc0 ls0 ws0">Figur<span class="ls44">e2<span class="_ _4f"></span><span class="ls0">0.2 shows a general picture<span class="_"> </span>of<span class="_"> </span>the database implementation.</span></span></div><div class="t m0 x8a h2a y55b3 ff19 fsf fc0 sc0 ls0 ws0">index ﬁle:</div><div class="t m0 x143 h2d y55b4 ff19 fs10 fc0 sc0 ls0 ws0">free</div><div class="t m0 x1e5 h2d y55b5 ff19 fs10 fc0 sc0 ls0 ws0">ptr</div><div class="t m0 x1ce h2e y55b6 ff19 fs11 fc0 sc0 ls0 ws0">chain</div><div class="t m0 xa0 h2e y55b7 ff19 fs11 fc0 sc0 ls0 ws0">ptr</div><div class="t m0 x6b h2f y55b8 ff19 fs12 fc0 sc0 ls0 ws0">chain</div><div class="t m0 xa5 h2f y55b9 ff19 fs12 fc0 sc0 ls0 ws0">ptr</div><div class="t m0 x1d6 h159 y55ba ff18 fs31 fc0 sc0 ls229 ws0">...</div><div class="t m0 x84 h31 y55bb ff19 fs14 fc0 sc0 ls0 ws0">chain</div><div class="t m0 x1f2 h31 y55bc ff19 fs14 fc0 sc0 ls0 ws0">ptr</div><div class="t m0 x12e h66 y55bd ff1a fs15 fc0 sc0 ls0 ws0">\n</div><div class="t m0 x59 h83 y55be ff19 fs36 fc0 sc0 ls0 ws0">chain</div><div class="t m0 x11b h83 y55bf ff19 fs36 fc0 sc0 ls0 ws0">ptr</div><div class="t m0 xd h34 y55c0 ff19 fs17 fc0 sc0 ls0 ws0">idx</div><div class="t m0 x23 h34 y55c1 ff19 fs17 fc0 sc0 ls0 ws0">len</div><div class="t m0 xeb h35 y55c2 ff19 fs18 fc0 sc0 ls0 ws0">key</div><div class="t m0 x73 h36 y55c3 ff19 fs19 fc0 sc0 ls0 ws0">sep</div><div class="t m0 x1ef h37 y55c4 ff19 fs1a fc0 sc0 ls0 ws0">dat</div><div class="t m0 xd7 h37 y55c5 ff19 fs1a fc0 sc0 ls0 ws0">off</div><div class="t m0 x14c h38 y55c6 ff19 fs1b fc0 sc0 ls0 ws0">sep</div><div class="t m0 x49 h39 y2695 ff19 fs1c fc0 sc0 ls0 ws0">dat</div><div class="t m0 x49 h39 y55c7 ff19 fs1c fc0 sc0 ls0 ws0">len</div><div class="t m0 x1a5 h128 y55c8 ff1a fs43 fc0 sc0 ls0 ws0">\n</div><div class="t m0 x156 h16b y55c9 ff19 fs4b fc0 sc0 ls0 ws0">data ﬁle:</div><div class="t m0 x1f5 h3d y55ca ff19 fs1f fc0 sc0 ls0 ws0">data</div><div class="t m0 x1ff h11c y55cb ff1a fs20 fc0 sc0 ls0 ws0">\n</div><div class="t m0 xee h41 y55cc ff19 fs23 fc0 sc0 ls0 ws0">hash table</div><div class="t m0 xc8 hf4 y55cd ff19 fs85 fc0 sc0 ls0 ws0">index recor<span class="_ _0"></span>ds</div><div class="t m0 x95 hab y55ce ff19 fs57 fc0 sc0 ls0 ws0">one index recor<span class="_ _0"></span>d</div><div class="t m0 x1fe h181 y55cf ff19 fsa6 fc0 sc0 ls0 ws0">idx len</div><div class="t m0 xe h196 y55d0 ff19 fs86 fc0 sc0 ls0 ws0">one data recor<span class="_ _0"></span>d</div><div class="t m0 xc5 h191 y55d1 ff19 fscf fc0 sc0 ls0 ws0">dat len</div><div class="t m0 x12b h197 y55d2 ff19 fsd3 fc0 sc0 ls0 ws0">offset of ﬁrst index</div><div class="t m0 x12b h197 y55d3 ff19 fsd3 fc0 sc0 ls161f ws0">re<span class="ls0">cord<span class="_"> </span>on<span class="_"> </span>f</span>re<span class="ls1620">el<span class="_ _84"></span><span class="ls0">ist</span></span></div><div class="t m0 x9d h198 y55d4 ff19 fsd4 fc0 sc0 ls0 ws0">offset of ﬁrst index</div><div class="t m0 x1f8 h198 y55d5 ff19 fsd4 fc0 sc0 ls1621 ws0">re<span class="ls0">cord<span class="_"> </span>on<span class="_"> </span>this hash chain</span></div><div class="t m0 x198 h199 y55d6 ff19 fsd5 fc0 sc0 ls0 ws0">offset of next index</div><div class="t m0 xf1 h199 y55d7 ff19 fsd5 fc0 sc0 ls1622 ws0">re<span class="ls0">cord<span class="_"> </span>on<span class="_"> </span>this hash chain</span></div><div class="t m0 xab h199 y55d8 ff18 fsd5 fc0 sc0 ls0 ws0">Figure 20.2<span class="_ _5a"> </span><span class="ff19">Arrangement of index ﬁle and data ﬁle</span></div><div class="t m0 x32 h19a y55d9 ff19 fsd6 fc0 sc0 ls0 ws0">The <span class="_ _42"> </span>index <span class="_ _53"> </span>ﬁle <span class="_ _42"> </span>consists <span class="_ _53"> </span>of <span class="_ _42"> </span>three <span class="_ _42"> </span>portions: <span class="_ _53"> </span>the <span class="_ _42"> </span>free-list <span class="_ _42"> </span>pointer<span class="_ _1"></span><span class="ls1623">,t<span class="_ _c"></span><span class="ls0">he <span class="_ _53"> </span>hash <span class="_ _42"> </span>table, <span class="_ _53"> </span>and <span class="_ _42"> </span>the</span></span></div><div class="t m0 x32 h19b y55da ff19 fsd6 fc0 sc0 ls0 ws0">index <span class="_ _3"></span>recor<span class="_ _0"></span>ds. <span class="_ _47"> </span>In<span class="_ _47"> </span>Figur<span class="ls1624">e2<span class="_ _b"></span><span class="ls0">0.2, <span class="_ _3"></span>all <span class="_ _9"></span>the <span class="_ _2"></span>ﬁelds <span class="_ _3"></span>called<span class="_ _45"> </span><span class="ff1b">ptr<span class="_ _47"> </span></span>ar<span class="ls1624">es<span class="_ _b"></span><span class="ls0">imply <span class="_ _3"></span>ﬁle <span class="_ _3"></span>offsets <span class="_ _2"></span>stored <span class="_ _3"></span>as <span class="_ _3"></span>an</span></span></span></span></div><div class="t m0 x32 h19a y55db ff19 fsd6 fc0 sc0 ls0 ws0">ASCII number<span class="_ _6"></span>.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
