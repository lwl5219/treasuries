<div id="pfd8" class="pf w4 h1f" data-page-no="d8"><div class="pc pcd8 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bgd8.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">182<span class="_ _1b"> </span><span class="ff19">System <span class="_"> </span>Data <span class="_"> </span>Files <span class="_"> </span>and <span class="_"> </span>Information<span class="_ _114"> </span>Chapter <span class="_"> </span>6</span></div><div class="t m0 x3f h2a y12f ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _3"></span>only <span class="_ _3"></span>two <span class="_ _3"></span>mandatory <span class="_ _3"></span>ﬁelds <span class="_ _3"></span>ar<span class="ls79d">et<span class="_ _8"></span><span class="ls0">he <span class="_ _3"></span>user<span class="_ _9"></span>’s <span class="_ _3"></span>login <span class="_ _3"></span>name <span class="_ _3"></span>and <span class="_ _3"></span>encrypted <span class="_ _3"></span>password.</span></span></div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _42"> </span>other <span class="_ _23"> </span>ﬁelds <span class="_ _42"> </span>control <span class="_ _42"> </span>how <span class="_ _42"> </span>often <span class="_ _23"> </span>the <span class="_ _42"> </span>password<span class="_ _35"> </span>is<span class="_ _44"> </span>to<span class="_ _35"> </span>change <span class="_ _4"></span>— <span class="_ _84"></span>known<span class="_ _44"> </span>as <span class="_ _42"> </span>‘<span class="_ _1"></span>‘password</div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">aging’<span class="_ _0"></span><span class="ls9d">’—a<span class="_ _6"></span><span class="ls0">nd how long an account is allowed to remain active.</span></span></div><div class="t m0 x3f h2a y132 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _66"> </span>shadow <span class="_ _47"> </span>passwor<span class="ls79e">dﬁ<span class="_ _1d"></span><span class="ls0">le <span class="_ _47"> </span>should <span class="_ _66"> </span>not <span class="_ _47"> </span>be <span class="_ _47"> </span>r<span class="_ _0"></span>eadable <span class="_ _66"> </span>by <span class="_ _47"> </span>the <span class="_ _47"> </span>world.<span class="_ _50"> </span>Only <span class="_ _47"> </span>a <span class="_ _66"> </span>few</span></span></div><div class="t m0 x32 h26 y133 ff19 fsf fc0 sc0 ls0 ws0">programs <span class="_ _61"> </span>need <span class="_ _16"> </span>to <span class="_ _16"> </span>access <span class="_ _16"> </span>encrypted <span class="_ _16"> </span>passwords <span class="_ _a"></span>—<span class="_ _9"></span><span class="ff1a">login</span></div><div class="t m0 x98 h2a y18af ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 x1 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">1</div><div class="t m0 xba h2a y18af ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 x15a h26 y133 ff19 fsf fc0 sc0 ls0 ws0">and<span class="_ _5f"> </span><span class="ff1a">passwd</span></div><div class="t m0 xd2 h2a y18af ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 x193 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">1</div><div class="t m0 x142 h2a y18af ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 x106 h2a y133 ff19 fsf fc0 sc0 ls79f ws0">,f<span class="_ _56"></span><span class="ls0">or</span></div><div class="t m0 x32 h2a y134 ff19 fsf fc0 sc0 ls0 ws0">example <span class="_ _a"></span>— <span class="_ _a"></span>and<span class="_ _47"> </span>these <span class="_ _3"></span>programs <span class="_ _2"></span>ar<span class="ls4ef">eo<span class="_ _8"></span><span class="ls0">ften <span class="_ _3"></span>set-user-ID <span class="_ _2"></span>root. <span class="_ _47"> </span>W<span class="_ _1"></span>ith <span class="_ _3"></span>shadow <span class="_ _3"></span>passwords, <span class="_ _2"></span>the</span></span></div><div class="t m0 x32 h26 y135 ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">gular passwor<span class="ls44">dﬁ<span class="_ _d"></span><span class="ls0">le,<span class="_"> </span><span class="ff1a">/etc/passwd</span><span class="ls44">,c<span class="_ _d"></span><span class="ls0">an be left readable by the world.</span></span></span></span></span></div><div class="t m0 x3f h2a y136 ff19 fsf fc0 sc0 ls0 ws0">On <span class="_ _9"></span>Linux <span class="_ _23"></span>3.2.0 <span class="_ _9"></span>and <span class="_ _9"></span>Solaris <span class="_ _23"></span>10, <span class="_ _9"></span>a <span class="_ _9"></span>separate <span class="_ _23"></span>set <span class="_ _9"></span>of <span class="_ _23"></span>functions <span class="_ _9"></span>is <span class="_ _9"></span>available <span class="_ _23"></span>to <span class="_ _9"></span>access <span class="_ _9"></span>the</div><div class="t m0 x32 h2a y137 ff19 fsf fc0 sc0 ls0 ws0">shadow passwor<span class="ls44">dﬁ<span class="_ _4f"></span><span class="ls0">le, similar to the set of functions used to access the passwor<span class="ls44">dﬁ<span class="_ _d"></span><span class="ls0">le.</span></span></span></span></div><div class="t m0 x3f h57 y16be ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;shadow.h&gt;</div><div class="t m0 x3f h57 y18b0 ff1a fs2d fc0 sc0 ls0 ws0">struct spwd *getspnam(const char *<span class="ff1b">name</span>);</div><div class="t m0 x3f h57 y18b1 ff1a fs2d fc0 sc0 ls0 ws0">struct spwd *getspent(void);</div><div class="t m0 x8e h57 y18b2 ff19 fs2d fc0 sc0 ls0 ws0">Both return: pointer if OK,<span class="_"> </span><span class="ff1a">NULL<span class="_ _e"> </span></span>on error</div><div class="t m0 x3f h57 y18b3 ff1a fs2d fc0 sc0 ls0 ws0">void setspent(void);</div><div class="t m0 x3f h57 y18b4 ff1a fs2d fc0 sc0 ls0 ws0">void endspent(void);</div><div class="t m0 x3f h49 y18b5 ff19 fs26 fc0 sc0 ls0 ws0">On <span class="_ _3"></span>FreeBSD <span class="_ _3"></span>8.0 <span class="_ _3"></span>and <span class="_ _9"></span>Mac <span class="_ _3"></span>OS <span class="_ _9"></span>X <span class="_ _3"></span>10.6.8, <span class="_ _9"></span>there<span class="_ _47"> </span>is<span class="_ _47"> </span>no<span class="_ _45"> </span>shadow <span class="_ _3"></span>passwor<span class="ls7a0">ds<span class="_ _b"></span><span class="ls0">tructure. <span class="_ _47"> </span>The</span></span></div><div class="t m0 x32 h49 y18b6 ff19 fs26 fc0 sc0 ls0 ws0">additional account information is stored in the passwor<span class="_ _0"></span><span class="lsd3">dﬁ<span class="_ _d"></span><span class="ls0">le (refer back to Figur<span class="_ _0"></span><span class="lsd3">e6<span class="_ _d"></span><span class="ls0">.1).</span></span></span></span></div><div class="t m0 x35 h4b y18b7 ff16 fs27 fc0 sc0 ls0 ws0">6.4 <span class="_ _68"> </span>Group <span class="_"> </span>File</div><div class="t m0 x32 h49 y18b8 ff19 fs26 fc0 sc0 ls0 ws0">The UNIX System’s <span class="_ _2"></span>group ﬁle, called <span class="_ _2"></span>the group database by <span class="_ _2"></span>POSIX.1, contains <span class="_ _2"></span>the ﬁelds</div><div class="t m0 x32 h4d y18b9 ff19 fs26 fc0 sc0 ls0 ws0">shown <span class="_ _3"></span>in <span class="_ _9"></span>Figur<span class="ls733">e6<span class="_ _b"></span><span class="ls0">.4. <span class="_ _45"> </span>These<span class="_ _47"> </span>ﬁelds <span class="_ _9"></span>ar<span class="ls733">ec<span class="_ _b"></span><span class="ls0">ontained <span class="_ _3"></span>in <span class="_ _9"></span>a<span class="_ _47"> </span><span class="ff1a">group<span class="_ _45"> </span></span>structur<span class="ls733">et<span class="_ _b"></span><span class="ls0">hat <span class="_ _3"></span>is <span class="_ _9"></span>deﬁned <span class="_ _3"></span>in</span></span></span></span></span></span></div><div class="t m0 x32 h4d y18ba ff1a fs26 fc0 sc0 ls0 ws0">&lt;grp.h&gt;<span class="ff19">.</span></div><div class="t m0 x145 h4f y18bb ff1a fs11 fc0 sc0 ls0 ws0">struct group<span class="_ _1f0"> </span><span class="ff19">FreeBSD <span class="_ _141"> </span>Linux<span class="_ _3a"> </span>Mac OS X<span class="_ _7f"> </span>Solaris</span></div><div class="t m0 x17c h2e y18bc ff19 fs11 fc0 sc0 ls0 ws0">member <span class="_ _1f1"> </span>8.0<span class="_ _dc"> </span>3.2.0 <span class="_ _17"> </span>10.6.8<span class="_ _1a8"> </span>10</div><div class="t m0 xc2 h2e y18bd ff19 fs11 fc0 sc0 ls0 ws0">Description<span class="_ _c4"> </span>POSIX.1</div><div class="t m0 x130 h6d y18be ff19 fs12 fc0 sc0 ls0 ws0">group name<span class="_ _1f2"> </span><span class="ff1a">char <span class="_"> </span>*gr_name<span class="_ _dc"> </span></span><span class="ls7a1">•• <span class="_ _172"></span>• <span class="_ _1f3"></span>• <span class="_ _1f3"></span>•</span></div><div class="t m0 x130 h6d y18bf ff19 fs12 fc0 sc0 ls0 ws0">encrypted password<span class="_ _16e"> </span><span class="ff1a">char <span class="_"> </span>*gr_passwd<span class="_ _7e"> </span></span><span class="ls7a2">••••</span></div><div class="t m0 x130 h6d y18c0 ff19 fs12 fc0 sc0 ls0 ws0">numerical group ID<span class="_ _77"> </span><span class="ff1a">int <span class="_ _1bb"> </span>gr_gid<span class="_ _10b"> </span></span><span class="ls7a1">•• <span class="_ _1f4"></span>• <span class="_ _1f4"></span>• <span class="_ _1f4"></span>•</span></div><div class="t m0 x1e h6d y18c1 ff1a fs12 fc0 sc0 ls0 ws0">char **gr_mem<span class="_ _136"> </span><span class="ff19 ls7a1">•• <span class="_ _1f3"></span>• <span class="_ _1f4"></span>• <span class="_ _1f4"></span>•<span class="_ _1f5"></span><span class="ls0">array of pointers to individual</span></span></div><div class="t m0 x156 h2f y18c2 ff19 fs12 fc0 sc0 ls0 ws0">user names</div><div class="t m0 x145 h63 y18c3 ff18 fs13 fc0 sc0 ls0 ws0">Figure 6.4<span class="_ _5a"> </span><span class="ff19">Fields in<span class="_"> </span><span class="ff1a">/etc/group<span class="_ _e"> </span></span>ﬁle</span></div><div class="t m0 x3f h64 y18c4 ff19 fs31 fc0 sc0 ls0 ws0">The ﬁeld<span class="_"> </span><span class="ff1a">gr_mem<span class="_ _66"> </span></span>is an array of pointers to <span class="_ _2"></span>the user names that belong <span class="_ _2"></span>to this group.</div><div class="t m0 x32 h6e y18c5 ff19 fs31 fc0 sc0 ls0 ws0">This array is terminated by a null pointer<span class="_ _6"></span>.</div><div class="t m0 x3f h6e y18c6 ff19 fs31 fc0 sc0 ls43f ws0">We <span class="_ _47"> </span>c<span class="_ _9"></span><span class="ls0">an <span class="_ _23"> </span>look <span class="_ _23"> </span>up <span class="_ _23"> </span>either <span class="_ _23"> </span>a <span class="_ _23"> </span>group <span class="_ _23"></span>name <span class="_ _23"></span>or <span class="_ _23"> </span>a <span class="_ _23"> </span>numerical <span class="_ _23"> </span>group <span class="_ _23"></span>ID <span class="_ _23"></span>with <span class="_ _23"></span>the <span class="_ _23"></span>following</span></div><div class="t m0 x32 h6e y18c7 ff19 fs31 fc0 sc0 ls0 ws0">two functions, which ar<span class="ls229">ed<span class="_ _4f"></span><span class="ls0">eﬁned by POSIX.1.</span></span></div><div class="t m0 x3f h65 y18c8 ff1a fs32 fc0 sc0 ls0 ws0">#include &lt;grp.h&gt;</div><div class="t m0 x3f h65 y18c9 ff1a fs32 fc0 sc0 ls0 ws0">struct group *getgrgid(gid_t<span class="_"> </span><span class="ff1b">gid</span>);</div><div class="t m0 x3f h65 y18ca ff1a fs32 fc0 sc0 ls0 ws0">struct group *getgrnam(const char *<span class="ff1b">name</span>);</div><div class="t m0 x8e h65 y18cb ff19 fs32 fc0 sc0 ls0 ws0">Both return: pointer if OK,<span class="_"> </span><span class="ff1a">NULL<span class="_ _e"> </span></span>on error</div><a class="l" href="#pfe" data-dest-detail='[14,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892634px;bottom:707.340905px;width:99.107689px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
