<div id="pf6a" class="pf w4 h1f" data-page-no="6a"><div class="pc pc6a w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg6a.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">72<span class="_ _1b"> </span><span class="ff19">File <span class="_"> </span>I/O<span class="_ _169"> </span>Chapter <span class="_"> </span>3</span></div><div class="t m0 x35 h75 y12f ff16 fs2b fc0 sc0 ls0 ws0">3.8<span class="_ _72"> </span><span class="ff1f">write<span class="_ _54"> </span></span>Function</div><div class="t m0 x32 h26 y681 ff19 fsf fc0 sc0 ls0 ws0">Data is written to an open ﬁle with the<span class="_"> </span><span class="ff1a">write<span class="_ _80"> </span></span>function.</div><div class="t m0 x3f h57 yb37 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;unistd.h&gt;</div><div class="t m0 x3f h57 yb5b ff1a fs2d fc0 sc0 ls0 ws0">ssize_t write(int<span class="_"> </span><span class="ff1b">fd</span><span class="ls15c">,c<span class="_ _1d"></span><span class="ls0">onst void *<span class="ff1b">buf</span><span class="ls15c">,s<span class="_ _5b"></span><span class="ls0">ize_t<span class="_"> </span><span class="ff1b">nbytes</span>);</span></span></span></span></div><div class="t m0 x84 h5f yb5c ff19 fs2d fc0 sc0 ls0 ws0">Returns: number of bytes written if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h4a yb5d ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _66"> </span>return <span class="_"> </span>value <span class="_ _47"> </span>is <span class="_ _66"> </span>usually <span class="_ _47"> </span>equal <span class="_ _66"> </span>to <span class="_ _47"> </span>the<span class="_ _46"> </span><span class="ff1b">nbytes<span class="_ _61"> </span></span>argument; <span class="_ _66"> </span>otherwise, <span class="_ _47"> </span>an <span class="_"> </span>error <span class="_ _66"> </span>has</div><div class="t m0 x32 h4d yb5e ff19 fs26 fc0 sc0 ls0 ws0">occurred. <span class="_"> </span>A<span class="_"> </span>common <span class="_ _2"></span>cause <span class="_ _2"></span>for a<span class="_ _66"> </span><span class="ff1a">write<span class="_ _47"> </span></span>err<span class="_ _0"></span>or is <span class="_ _2"></span>either <span class="_ _2"></span>ﬁlling up <span class="_ _2"></span>a <span class="_ _2"></span>disk or <span class="_ _2"></span>exceeding <span class="_ _2"></span>the</div><div class="t m0 x32 h49 yb5f ff19 fs26 fc0 sc0 ls0 ws0">ﬁle size limit for a given process (Section 7.1<span class="_ _6"></span><span class="lsd3">1a<span class="_ _5"></span><span class="ls0">nd Exercise 10.1<span class="_ _6"></span>1).</span></span></div><div class="t m0 x3f h49 yb60 ff19 fs26 fc0 sc0 ls0 ws0">For <span class="_ _66"> </span>a <span class="_ _47"> </span>regular <span class="_ _66"> </span>ﬁle, <span class="_ _47"> </span>the <span class="_ _47"> </span>write <span class="_ _66"> </span>operation <span class="_ _47"> </span>starts <span class="_ _47"> </span>at <span class="_ _66"> </span>the <span class="_ _47"> </span>ﬁle’s <span class="_ _47"> </span>current <span class="_"> </span>offset. <span class="_ _61"> </span>If<span class="_ _61"> </span>the</div><div class="t m0 x32 h4d yb61 ff1a fs26 fc0 sc0 ls0 ws0">O_APPEND<span class="_ _45"> </span><span class="ff19">option <span class="_ _3"></span>was <span class="_ _9"></span>speciﬁed <span class="_ _9"></span>when <span class="_ _9"></span>the <span class="_ _9"></span>ﬁle <span class="_ _9"></span>was <span class="_ _9"></span>opened, <span class="_ _9"></span>the <span class="_ _9"></span>ﬁle’s <span class="_ _9"></span>offset <span class="_ _3"></span>is <span class="_ _9"></span>set <span class="_ _9"></span>to <span class="_ _9"></span>the</span></div><div class="t m0 x32 h49 yb62 ff19 fs26 fc0 sc0 ls0 ws0">current <span class="_ _2"></span>end <span class="_ _3"></span>of <span class="_ _3"></span>ﬁle <span class="_ _3"></span>befor<span class="ls3ab">ee<span class="_ _8"></span><span class="ls0">ach <span class="_ _3"></span>write <span class="_ _3"></span>operation.<span class="_ _16"> </span>After <span class="_ _3"></span>a <span class="_ _3"></span>successful <span class="_ _3"></span>write, <span class="_ _3"></span>the <span class="_ _3"></span>ﬁle’s <span class="_ _3"></span>offset</span></span></div><div class="t m0 x32 h49 yb63 ff19 fs26 fc0 sc0 ls0 ws0">is incremented by the number of bytes actually written.</div><div class="t m0 x35 h4b yb64 ff16 fs27 fc0 sc0 ls0 ws0">3.9 <span class="_ _68"> </span>I/O<span class="_ _54"> </span>Efﬁciency</div><div class="t m0 x32 h4d yb65 ff19 fs26 fc0 sc0 ls0 ws0">The program in Figur<span class="_ _0"></span><span class="lsd3">e3<span class="_ _d"></span><span class="ls0">.5 copies a ﬁle, using only the<span class="_"> </span><span class="ff1a">read<span class="_ _80"> </span></span>and<span class="_"> </span><span class="ff1a">write<span class="_ _66"> </span></span>functions.</span></span></div><div class="t m0 x32 h5d yb66 ff1a fs2f fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h5d yb67 ff1a fs2f fc0 sc0 ls0 ws0">#define BUFFSIZE<span class="_ _15"> </span>4096</div><div class="t m0 x32 h5d yb68 ff1a fs2f fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h5d yb69 ff1a fs2f fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 x32 h5d yb6a ff1a fs2f fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h5d yb6b ff1a fs2f fc0 sc0 ls0 ws0">int <span class="_ _15"> </span>n;</div><div class="t m0 x8a h5d yb6c ff1a fs2f fc0 sc0 ls0 ws0">char <span class="_ _68"> </span>buf[BUFFSIZE];</div><div class="t m0 x8a h5d yb6d ff1a fs2f fc0 sc0 ls0 ws0">while ((n = read(STDIN_FILENO, buf, BUFFSIZE)) &gt; 0)</div><div class="t m0 x9d h5d yb6e ff1a fs2f fc0 sc0 ls0 ws0">if (write(STDOUT_FILENO, buf, n) != n)</div><div class="t m0 x1f h5d yb6f ff1a fs2f fc0 sc0 ls0 ws0">err_sys(&quot;write error&quot;);</div><div class="t m0 x8a h5d yb70 ff1a fs2f fc0 sc0 ls0 ws0">if (n &lt; 0)</div><div class="t m0 x9d h5d yb71 ff1a fs2f fc0 sc0 ls0 ws0">err_sys(&quot;read error&quot;);</div><div class="t m0 x8a h5d yb72 ff1a fs2f fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h5d yb73 ff1a fs2f fc0 sc0 ls0 ws0">}</div><div class="t m0 xab h2f yb74 ff18 fs12 fc0 sc0 ls0 ws0">Figure 3.5<span class="_ _5a"> </span><span class="ff19">Copy standar<span class="ls38a">di<span class="_ _84"></span><span class="ls0">nput to standar<span class="ls38a">do<span class="_ _5"></span><span class="ls0">utput</span></span></span></span></span></div><div class="t m0 x32 h50 yb75 ff19 fs29 fc0 sc0 ls0 ws0">The following caveats apply to this program.</div><div class="t m0 x3f h50 yb76 ff19 fs29 fc0 sc0 ls3ac ws0">•I<span class="_ _4d"></span><span class="ls3ad">tr<span class="_ _8"></span><span class="ls0">eads <span class="_ _2"></span>from <span class="_ _2"></span>standar<span class="ls3ad">di<span class="_ _8"></span><span class="ls0">nput <span class="_ _3"></span>and <span class="_ _2"></span>writes <span class="_ _2"></span>to <span class="_ _2"></span>standar<span class="ls3ad">do<span class="_ _4f"></span><span class="ls0">utput, <span class="_ _2"></span>assuming <span class="_ _2"></span>that <span class="_ _2"></span>these</span></span></span></span></span></span></div><div class="t m0 x15 h50 yb77 ff19 fs29 fc0 sc0 ls0 ws0">have <span class="_"> </span>been <span class="_ _66"> </span>set <span class="_"> </span>up <span class="_ _66"> </span>by <span class="_ _66"> </span>the <span class="_ _66"> </span>shell <span class="_ _66"> </span>befor<span class="ls3ae">et<span class="_ _5b"></span><span class="ls0">his <span class="_ _66"> </span>program <span class="_"> </span>is <span class="_"> </span>executed.<span class="_ _50"> </span>Indeed, <span class="_"> </span>all</span></span></div><div class="t m0 x15 h50 yb78 ff19 fs29 fc0 sc0 ls0 ws0">normal UNIX <span class="_ _2"></span>system <span class="_ _2"></span>shells <span class="_ _2"></span>provide a way <span class="_ _2"></span>to <span class="_ _2"></span>open <span class="_ _2"></span>a ﬁle <span class="_ _2"></span>for <span class="_ _2"></span>reading on <span class="_ _2"></span>standard</div><div class="t m0 x15 h50 yb79 ff19 fs29 fc0 sc0 ls0 ws0">input <span class="_ _53"> </span>and <span class="_ _e"> </span>to <span class="_ _53"> </span>create <span class="_ _53"> </span>(or <span class="_ _e"> </span>rewrite) <span class="_ _53"> </span>a <span class="_ _53"> </span>ﬁle <span class="_ _e"> </span>on <span class="_ _53"> </span>standar<span class="ls3af">do<span class="_ _55"></span><span class="ls0">utput. <span class="_ _4b"> </span>This<span class="_ _4b"> </span>prevents <span class="_ _53"> </span>the</span></span></div><div class="t m0 x15 h50 yb7a ff19 fs29 fc0 sc0 ls0 ws0">program <span class="_ _2"></span>from <span class="_ _2"></span>having <span class="_ _9"></span>to <span class="_ _3"></span>open <span class="_ _3"></span>the <span class="_ _3"></span>input <span class="_ _3"></span>and <span class="_ _3"></span>output <span class="_ _3"></span>ﬁles, <span class="_ _3"></span>and <span class="_ _3"></span>allows <span class="_ _3"></span>the <span class="_ _9"></span>user <span class="_ _3"></span>to</div><div class="t m0 x15 h50 yb7b ff19 fs29 fc0 sc0 ls0 ws0">take advantage of the shell’s I/O redir<span class="_ _0"></span>ection facilities.</div><a class="l" href="#pfc" data-dest-detail='[12,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892409px;bottom:1236.288916px;width:129.335808px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfc" data-dest-detail='[12,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892634px;bottom:814.862982px;width:115.247703px;height:19.679016px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
