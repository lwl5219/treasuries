<div id="pf225" class="pf w4 h1f" data-page-no="225"><div class="pc pc225 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg225.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>14.5<span class="_ _20d"> </span>Asynchronous <span class="_"> </span>I/O<span class="_ _1b"> </span><span class="ff18">515</span></div><div class="t m0 x3f h26 y12f ff19 fsf fc0 sc0 ls0 ws0">If <span class="_ _9"></span>an <span class="_ _9"></span>asynchronous <span class="_ _9"></span>I/O <span class="_ _9"></span>operation <span class="_ _23"></span>is <span class="_ _9"></span>successfully <span class="_ _9"></span>canceled, <span class="_ _9"></span>calling <span class="_ _23"></span>the<span class="_ _45"> </span><span class="ff1a">aio_error</span></div><div class="t m0 x32 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">function <span class="_ _23"></span>on <span class="_ _9"></span>the <span class="_ _23"> </span>corresponding <span class="_ _9"></span>AIO <span class="_ _23"></span>control <span class="_ _9"></span>block <span class="_ _23"></span>will <span class="_ _23"></span>return <span class="_ _9"></span>the <span class="_ _23"></span>error<span class="_ _45"> </span><span class="ff1a">ECANCELED</span><span class="lsa43">.I<span class="_ _26"></span><span class="ls0">f</span></span></div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">the operation <span class="_ _2"></span>can’t <span class="_ _2"></span>be <span class="_ _2"></span>canceled, <span class="_ _2"></span>then the <span class="_ _2"></span>corresponding AIO <span class="_ _2"></span>control block <span class="_ _2"></span>is <span class="_ _2"></span>unchanged</div><div class="t m0 x32 h26 y132 ff19 fsf fc0 sc0 ls0 ws0">by the call to<span class="_"> </span><span class="ff1a">aio_cancel</span>.</div><div class="t m0 x3f h2a y133 ff19 fsf fc0 sc0 ls0 ws0">One additional <span class="_ _2"></span>function is <span class="_ _2"></span>included <span class="_ _2"></span>with the <span class="_ _2"></span>asynchronous I/O <span class="_ _2"></span>interfaces, although</div><div class="t m0 x32 h26 y134 ff19 fsf fc0 sc0 ls0 ws0">it <span class="_ _9"></span>can <span class="_ _9"></span>be <span class="_ _9"></span>used <span class="_ _9"></span>in <span class="_ _23"></span>either <span class="_ _9"></span>a <span class="_ _9"></span>synchronous <span class="_ _3"></span>or <span class="_ _9"></span>an <span class="_ _23"></span>asynchronous <span class="_ _3"></span>manner<span class="_ _1"></span><span class="ls10b9">.T<span class="_ _26"></span><span class="ls0">he<span class="_ _45"> </span><span class="ff1a">lio_listio</span></span></span></div><div class="t m0 x32 h2a y135 ff19 fsf fc0 sc0 ls0 ws0">function submits a set of I/O requests described by a list of AIO contr<span class="_ _0"></span>ol blocks.</div><div class="t m0 x3f h57 y3f24 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;aio.h&gt;</div><div class="t m0 x3f h57 y3f25 ff1a fs2d fc0 sc0 ls0 ws0">int lio_listio(int<span class="_"> </span><span class="ff1b">mode</span><span class="ls15c">,s<span class="_ _1d"></span><span class="ls0">truct aiocb *restrict const<span class="_"> </span><span class="ff1b">list</span>[restrict],</span></span></div><div class="t m0 x12b h57 y3f26 ff1a fs2d fc0 sc0 ls0 ws0">int<span class="_"> </span><span class="ff1b">nent</span><span class="ls15c">,s<span class="_ _1d"></span><span class="ls0">truct sigevent *restrict<span class="_"> </span><span class="ff1b">sigev</span>);</span></span></div><div class="t m0 x153 h5f y3f27 ff19 fs2d fc0 sc0 ls0 ws0">Returns: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h4a y3f28 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_"> </span><span class="ff1b">mode<span class="_"> </span></span>argument determines whether the I/O is truly asynchronous. <span class="_"> </span>When<span class="_"> </span>it is set to</div><div class="t m0 x32 h4d y3f29 ff1a fs26 fc0 sc0 ls0 ws0">LIO_WAIT<span class="ff19 ls10ba">,t<span class="_ _5b"></span><span class="ls0">he<span class="_ _46"> </span><span class="ff1a">lio_listio<span class="_ _61"> </span></span>function <span class="_"> </span>won’t <span class="_ _66"> </span>return <span class="_"> </span>until <span class="_ _66"> </span>all <span class="_ _66"> </span>of <span class="_ _66"> </span>the <span class="_ _66"> </span>I/O <span class="_ _66"> </span>operations</span></span></div><div class="t m0 x32 h4a y3f2a ff19 fs26 fc0 sc0 ls0 ws0">speciﬁed <span class="_ _2"></span>by <span class="_ _2"></span>the <span class="_ _2"></span>list <span class="_ _3"></span>ar<span class="ls10bb">ec<span class="_ _8"></span><span class="ls0">omplete. <span class="_ _47"> </span>In<span class="_ _66"> </span>this <span class="_ _3"></span>case, <span class="_ _2"></span>the<span class="_ _47"> </span><span class="ff1b">sigev<span class="_ _66"> </span></span>argument <span class="_ _2"></span>is <span class="_ _2"></span>ignored. <span class="_"> </span>When<span class="_ _47"> </span>the</span></span></div><div class="t m0 x32 h4d y3f2b ff1b fs26 fc0 sc0 ls0 ws0">mode<span class="_"> </span><span class="ff19">argument is set to<span class="_"> </span><span class="ff1a">LIO_NOWAIT</span><span class="ls10bc">,t<span class="_ _d"></span><span class="ls0">hen the<span class="_ _66"> </span><span class="ff1a">lio_listio<span class="_ _66"> </span></span>function returns as soon as</span></span></span></div><div class="t m0 x32 h49 y3f2c ff19 fs26 fc0 sc0 ls0 ws0">the <span class="_ _23"> </span>I/O <span class="_ _42"> </span>requests <span class="_ _23"></span>ar<span class="ls10bd">eq<span class="_ _43"></span><span class="ls0">ueued. <span class="_ _35"> </span>The<span class="_ _35"> </span>process <span class="_ _23"> </span>is <span class="_ _42"> </span>notiﬁed <span class="_ _23"> </span>asynchronously <span class="_ _23"> </span>when <span class="_ _42"> </span>all <span class="_ _23"> </span>of <span class="_ _42"> </span>the</span></span></div><div class="t m0 x32 h4a y3f2d ff19 fs26 fc0 sc0 ls0 ws0">I/O <span class="_ _42"> </span>operations <span class="_ _42"> </span>complete, <span class="_ _23"> </span>as <span class="_ _42"> </span>speciﬁed <span class="_ _42"> </span>by <span class="_ _42"> </span>the<span class="_ _44"> </span><span class="ff1b">sigev<span class="_ _35"> </span></span>argument. <span class="_ _35"> </span>If<span class="_ _44"> </span>we <span class="_ _42"> </span>don’t <span class="_ _23"> </span>want <span class="_ _42"> </span>to <span class="_ _42"> </span>be</div><div class="t m0 x32 h4d y3f2e ff19 fs26 fc0 sc0 ls0 ws0">notiﬁed, <span class="_ _45"> </span>we <span class="_ _45"> </span>can <span class="_ _45"> </span>set<span class="_ _5a"> </span><span class="ff1b">sigev<span class="_ _5a"> </span></span>to<span class="_ _5a"> </span><span class="ff1a">NULL</span><span class="ls10be">.N<span class="_ _95"></span><span class="ls0">ote <span class="_ _45"> </span>that <span class="_ _45"> </span>the <span class="_ _45"> </span>individual <span class="_ _45"> </span>AIO <span class="_ _45"> </span>control <span class="_ _47"> </span>blocks</span></span></div><div class="t m0 x32 h49 y3f2f ff19 fs26 fc0 sc0 ls0 ws0">themselves <span class="_ _42"> </span>may <span class="_ _53"> </span>also <span class="_ _53"> </span>enable <span class="_ _53"> </span>asynchronous <span class="_ _42"> </span>notiﬁcation <span class="_ _42"> </span>when <span class="_ _53"> </span>an <span class="_ _53"> </span>individual <span class="_ _53"> </span>operation</div><div class="t m0 x32 h4a y3f30 ff19 fs26 fc0 sc0 ls0 ws0">completes. <span class="_"> </span>The<span class="_ _47"> </span>asynchronous notiﬁcation <span class="_ _2"></span>speciﬁed <span class="_ _2"></span>by the<span class="_ _47"> </span><span class="ff1b">sigev<span class="_"> </span></span>argument <span class="_ _2"></span>is in <span class="_ _2"></span>addition</div><div class="t m0 x32 h49 y3f31 ff19 fs26 fc0 sc0 ls0 ws0">to these, and is sent only when all of the I/O operations complete.</div><div class="t m0 x3f h4a y3f32 ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _51"> </span><span class="ff1b">list<span class="_ _51"> </span></span>ar<span class="_ _0"></span>gument <span class="_ _35"> </span>points <span class="_ _35"> </span>to <span class="_ _45"> </span>a <span class="_ _35"> </span>list <span class="_ _35"> </span>of <span class="_ _35"> </span>AIO <span class="_ _35"> </span>contr<span class="_ _0"></span>ol <span class="_ _35"> </span>blocks <span class="_ _45"> </span>specifying <span class="_ _35"> </span>the <span class="_ _35"> </span>I/O</div><div class="t m0 x32 h4a y3f33 ff19 fs26 fc0 sc0 ls0 ws0">operations to perform.<span class="_ _46"> </span>The<span class="_"> </span><span class="ff1b">nent<span class="_"> </span></span>argument speciﬁes the number of elements in the <span class="_ _2"></span>array<span class="_ _4"></span>.</div><div class="t m0 x32 h4d y3f34 ff19 fs26 fc0 sc0 ls0 ws0">The list of AIO control blocks can contain<span class="_"> </span><span class="ff1a">NULL<span class="_ _80"> </span></span>pointers; these entries ar<span class="lsd3">ei<span class="_ _4f"></span><span class="ls0">gnored.</span></span></div><div class="t m0 x3f h4d y3f35 ff19 fs26 fc0 sc0 ls0 ws0">In <span class="_ _45"> </span>each <span class="_ _35"> </span>AIO <span class="_ _45"> </span>control <span class="_ _45"> </span>block, <span class="_ _45"> </span>the<span class="_ _51"> </span><span class="ff1a">aio_lio_opcode<span class="_"> </span></span>ﬁeld <span class="_ _45"> </span>speciﬁes <span class="_ _45"> </span>whether <span class="_ _35"> </span>the</div><div class="t m0 x32 h4d y3f36 ff19 fs26 fc0 sc0 ls0 ws0">operation <span class="_ _3"></span>is <span class="_ _3"></span>a <span class="_ _9"></span>read <span class="_ _2"></span>(<span class="ff1a">LIO_READ</span>), <span class="_ _9"></span>a <span class="_ _3"></span>write <span class="_ _9"></span>(<span class="ff1a">LIO_WRITE</span>), <span class="_ _3"></span>or <span class="_ _3"></span>a <span class="_ _9"></span>no-op <span class="_ _3"></span>(<span class="ff1a">LIO_NOP</span>), <span class="_ _3"></span>which <span class="_ _9"></span>is</div><div class="t m0 x32 h49 y3f37 ff19 fs26 fc0 sc0 ls0 ws0">ignored. <span class="_"> </span>A<span class="_"> </span><span class="lscc">re<span class="_ _2"></span></span>ad <span class="_ _2"></span>is treated as <span class="_ _2"></span>if <span class="_ _2"></span>the <span class="_ _2"></span>corresponding AIO control block <span class="_ _2"></span>had <span class="_ _2"></span>been <span class="_ _2"></span>passed to</div><div class="t m0 x32 h4d y3f38 ff19 fs26 fc0 sc0 ls0 ws0">the<span class="_ _44"> </span><span class="ff1a">aio_read<span class="_ _44"> </span></span>function. <span class="_ _35"> </span>Similarly<span class="_ _6"></span><span class="ls10bf">,aw<span class="_ _43"></span><span class="ls0">rite <span class="_ _42"> </span>is <span class="_ _42"> </span>treated <span class="_ _23"> </span>as <span class="_ _53"> </span>if <span class="_ _42"> </span>the <span class="_ _42"> </span>AIO <span class="_ _53"> </span>control <span class="_ _42"> </span>block <span class="_ _42"> </span>had</span></span></div><div class="t m0 x32 h4d y3f39 ff19 fs26 fc0 sc0 ls0 ws0">been passed to<span class="_"> </span><span class="ff1a">aio_write</span>.</div><div class="t m0 x3f h49 y3f3a ff19 fs26 fc0 sc0 ls0 ws0">Implementations <span class="_"> </span>can <span class="_"> </span>limit <span class="_"> </span>the <span class="_"> </span>number <span class="_"> </span>of <span class="_ _66"> </span>asynchronous <span class="_"> </span>I/O <span class="_"> </span>operations <span class="_"> </span>we <span class="_"> </span>are</div><div class="t m0 x32 h49 y3f3b ff19 fs26 fc0 sc0 ls0 ws0">allowed <span class="_ _2"></span>to <span class="_ _2"></span>have <span class="_ _2"></span>outstanding.<span class="_ _46"> </span>The <span class="_ _2"></span>limits <span class="_ _2"></span>ar<span class="ls10c0">er<span class="_ _4f"></span><span class="ls0">untime <span class="_ _2"></span>invariants, <span class="_ _2"></span>and <span class="_ _2"></span>ar<span class="ls10c0">es<span class="_ _4f"></span><span class="ls0">ummarized <span class="_ _2"></span>in</span></span></span></span></div><div class="t m0 x32 h49 y3f3c ff19 fs26 fc0 sc0 ls0 ws0">Figur<span class="lsd3">e1<span class="_ _4f"></span><span class="ls0">4.19.</span></span></div><div class="t m0 x1a7 h2e y3f3d ff19 fs11 fc0 sc0 ls0 ws0">Name <span class="_ _191"> </span>Description<span class="_ _19d"> </span>Minimum acceptable value</div><div class="t m0 x6a h6d y3f3e ff1a fs12 fc0 sc0 ls0 ws0">AIO_LISTIO_MAX <span class="_ _2aa"> </span>_POSIX_AIO_LISTIO_MAX</div><div class="t m0 xe5 h6d y3f3f ff1a fs12 fc0 sc0 ls0 ws0">(</div><div class="t m0 x58 h6d y3f3e ff1a fs12 fc0 sc0 ls0 ws0">2</div><div class="t m0 x61 h6d y3f3f ff1a fs12 fc0 sc0 ls0 ws0">)</div><div class="t m0 x8b h2f y3f3e ff19 fs12 fc0 sc0 ls0 ws0">maximum number of I/O operations</div><div class="t m0 x145 h2f y3f40 ff19 fs12 fc0 sc0 ls0 ws0">in a single list I/O call</div><div class="t m0 x6a h6d y3f41 ff1a fs12 fc0 sc0 ls0 ws0">AIO_MAX <span class="_ _2ab"> </span>_POSIX_AIO_MAX</div><div class="t m0 xb3 h6d y3f42 ff1a fs12 fc0 sc0 ls0 ws0">(</div><div class="t m0 x1d4 h6d y3f41 ff1a fs12 fc0 sc0 ls0 ws0">1</div><div class="t m0 x4d h6d y3f42 ff1a fs12 fc0 sc0 ls0 ws0">)</div><div class="t m0 x8b h2f y3f41 ff19 fs12 fc0 sc0 ls0 ws0">maximum number of outstanding</div><div class="t m0 x145 h2f y3f43 ff19 fs12 fc0 sc0 ls0 ws0">asynchronous I/O operations</div><div class="t m0 x6a h6d y3f44 ff1a fs12 fc0 sc0 ls0 ws0">AIO_PRIO_DELTA_MAX<span class="_ _2ac"> </span><span class="ff19">0<span class="_ _2ad"></span>maximum amount by which a process</span></div><div class="t m0 x145 h2f y3f45 ff19 fs12 fc0 sc0 ls0 ws0">can decrease its asynchr<span class="_ _0"></span>onous</div><div class="t m0 x145 h2f y3f46 ff19 fs12 fc0 sc0 ls0 ws0">I/O priority level</div><div class="t m0 x6 h30 y3f47 ff18 fs13 fc0 sc0 ls0 ws0">Figure 14.19<span class="_ _5a"> </span><span class="ff19">POSIX.1 runtime invariant values for asynchronous I/O</span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
