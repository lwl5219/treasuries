<div id="pf2e0" class="pf w4 h1f" data-page-no="2e0"><div class="pc pc2e0 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg2e0.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">702<span class="_ _1b"> </span><span class="ff19 ls719">Te<span class="_ _9"></span><span class="ls0">rminal <span class="_"> </span>I/O<span class="_ _eb"> </span>Chapter <span class="_"> </span>18</span></span></div><div class="t m0 x52 h26 y12f ff19 fsf fc0 sc0 ls0 ws0">handle <span class="_ _42"> </span>these <span class="_ _42"> </span>signals.<span class="_ _65"> </span>Some <span class="_ _42"> </span>versions <span class="_ _53"> </span>just <span class="_ _42"> </span>ignore<span class="_ _44"> </span><span class="ff1a">SIGINT<span class="_ _44"> </span></span>(saving <span class="_ _42"> </span>its <span class="_ _42"> </span>previous</div><div class="t m0 x52 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">action) <span class="_ _53"> </span>while <span class="_ _e"> </span>in<span class="_ _4b"> </span><span class="ff1a">getpass</span><span class="ls1507">,r<span class="_ _55"></span><span class="ls0">esetting <span class="_ _53"> </span>the <span class="_ _e"> </span>action <span class="_ _53"> </span>for <span class="_ _e"> </span>this <span class="_ _53"> </span>signal <span class="_ _e"> </span>to <span class="_ _53"> </span>its <span class="_ _e"> </span>previous</span></span></div><div class="t m0 x52 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">value <span class="_ _3"></span>befor<span class="ls138b">er<span class="_ _b"></span><span class="ls0">eturning. <span class="_ _47"> </span>This<span class="_ _45"> </span>means <span class="_ _3"></span>that <span class="_ _9"></span>any <span class="_ _9"></span>occurrence <span class="_ _3"></span>of <span class="_ _3"></span>the <span class="_ _9"></span>signal <span class="_ _3"></span>while <span class="_ _9"></span>it’s</span></span></div><div class="t m0 x52 h26 y132 ff19 fsf fc0 sc0 ls0 ws0">ignored is <span class="_ _3"></span>lost.<span class="_ _61"> </span>Other <span class="_ _3"></span>versions <span class="_ _2"></span>catch<span class="_ _47"> </span><span class="ff1a">SIGINT<span class="_ _47"> </span></span>(saving <span class="_ _2"></span>its <span class="_ _2"></span>previous <span class="_ _2"></span>action) <span class="_ _3"></span>and <span class="_ _2"></span>if</div><div class="t m0 x52 h26 y133 ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _42"> </span>signal <span class="_ _23"> </span>is <span class="_ _42"> </span>caught, <span class="_ _42"> </span>send <span class="_ _42"> </span>themselves <span class="_ _42"> </span>the <span class="_ _42"> </span>signal <span class="_ _23"> </span>with <span class="_ _42"> </span>the<span class="_ _44"> </span><span class="ff1a">kill<span class="_ _35"> </span></span>function <span class="_ _42"> </span>after</div><div class="t m0 x52 h26 y134 ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">setting <span class="_ _2"></span>the <span class="_ _3"></span>terminal <span class="_ _2"></span>state <span class="_ _2"></span>and <span class="_ _2"></span>signal <span class="_ _2"></span>action.<span class="_ _61"> </span>None <span class="_ _2"></span>of <span class="_ _2"></span>the <span class="_ _2"></span>versions <span class="_ _2"></span>of<span class="_ _47"> </span><span class="ff1a">getpass</span></span></div><div class="t m0 x52 h26 y135 ff19 fsf fc0 sc0 ls0 ws0">catch, <span class="_"> </span>ignor<span class="_ _1"></span>e, <span class="_"> </span>or <span class="_ _e"> </span>block<span class="_ _59"> </span><span class="ff1a">SIGQUIT</span>,<span class="_ _59"> </span>so<span class="_ _59"> </span>entering <span class="_"> </span>the <span class="_ _e"> </span>QUIT <span class="_"> </span>character <span class="_ _e"> </span>aborts <span class="_"> </span>the</div><div class="t m0 x52 h2a y136 ff19 fsf fc0 sc0 ls0 ws0">program and pr<span class="_ _0"></span>obably leaves the terminal with echoing disabled.</div><div class="t m0 x3f h2a y153 ff19 fsf fc0 sc0 ls1508 ws0">•B<span class="_ _de"></span><span class="ls1509">ea<span class="_ _62"></span><span class="ls0">war<span class="ls1509">et<span class="_ _26"></span><span class="ls0">hat <span class="_ _45"> </span>some <span class="_ _45"> </span>shells, <span class="_ _45"> </span>notably <span class="_ _47"> </span>the <span class="_ _45"> </span>Korn <span class="_ _45"> </span>shell, <span class="_ _47"> </span>turn <span class="_ _45"> </span>echoing <span class="_ _45"> </span>back <span class="_ _45"> </span>on</span></span></span></span></div><div class="t m0 x52 h2a y155 ff19 fsf fc0 sc0 ls0 ws0">whenever <span class="_ _42"> </span>they <span class="_ _42"> </span>read <span class="_ _23"> </span>interactive <span class="_ _42"> </span>input.<span class="_ _54"> </span>These <span class="_ _42"> </span>shells <span class="_ _42"> </span>ar<span class="ls150a">et<span class="_ _43"></span><span class="ls0">he <span class="_ _42"> </span>ones <span class="_ _42"> </span>that <span class="_ _42"> </span>provide</span></span></div><div class="t m0 x52 h2a y10aa ff19 fsf fc0 sc0 ls0 ws0">command</div><div class="t m0 x132 h2a y517a ff19 fsf fc0 sc0 ls0 ws0">-</div><div class="t m0 xe7 h2a y10aa ff19 fsf fc0 sc0 ls0 ws0">line <span class="_ _3"></span>editing <span class="_ _9"></span>and <span class="_ _3"></span>therefor<span class="ls92b">em<span class="_ _b"></span><span class="ls0">anipulate <span class="_ _3"></span>the <span class="_ _9"></span>state <span class="_ _3"></span>of <span class="_ _9"></span>the <span class="_ _3"></span>terminal <span class="_ _9"></span>every</span></span></div><div class="t m0 x52 h2a y1846 ff19 fsf fc0 sc0 ls0 ws0">time <span class="_ _23"> </span>we <span class="_ _42"> </span>enter <span class="_ _42"> </span>an <span class="_ _23"> </span>interactive <span class="_ _42"> </span>command.<span class="_ _51"> </span>So, <span class="_ _42"> </span>if <span class="_ _42"> </span>we <span class="_ _23"> </span>invoke <span class="_ _42"> </span>this <span class="_ _42"> </span>program <span class="_ _23"></span>under</div><div class="t m0 x52 h2a y2243 ff19 fsf fc0 sc0 ls0 ws0">one of these shells and abort it <span class="_ _2"></span>with the QUIT character<span class="_ _1"></span>,<span class="_"> </span>it<span class="_"> </span>may reenable echoing</div><div class="t m0 x52 h2a y507f ff19 fsf fc0 sc0 ls0 ws0">for <span class="_ _2"></span>us.<span class="_ _61"> </span>Other <span class="_ _3"></span>shells <span class="_ _2"></span>that <span class="_ _3"></span>don’t <span class="_ _2"></span>provide <span class="_ _2"></span>this <span class="_ _3"></span>form <span class="_ _2"></span>of <span class="_ _2"></span>command</div><div class="t m0 x1b5 h2a y517b ff19 fsf fc0 sc0 ls0 ws0">-</div><div class="t m0 x169 h2a y507f ff19 fsf fc0 sc0 ls0 ws0">line <span class="_ _2"></span>editing, <span class="_ _3"></span>such</div><div class="t m0 x52 h2a y517c ff19 fsf fc0 sc0 ls0 ws0">as <span class="_ _23"></span>the <span class="_ _23"></span>Bourne <span class="_ _9"></span>shell, <span class="_ _23"> </span>will <span class="_ _23"> </span>abort <span class="_ _23"> </span>the <span class="_ _23"> </span>program <span class="_ _9"></span>and <span class="_ _23"> </span>leave <span class="_ _23"> </span>the <span class="_ _23"> </span>terminal <span class="_ _23"> </span>in <span class="_ _23"></span>no-echo</div><div class="t m0 x52 h26 y517d ff19 fsf fc0 sc0 ls0 ws0">mode. <span class="_"> </span>If<span class="_"> </span>we do this to our terminal, the<span class="_"> </span><span class="ff1a">stty<span class="_ _80"> </span></span>command can reenable echoing.</div><div class="t m0 x3f h2a y15f ff19 fsf fc0 sc0 ls1508 ws0">•W<span class="_ _30b"></span><span class="ls150b">eu<span class="_ _4f"></span><span class="ls0">se <span class="_ _2"></span>standar<span class="ls150b">dI<span class="_ _4f"></span><span class="ls0">/O <span class="_ _2"></span>to read and <span class="_ _2"></span>write <span class="_ _2"></span>the controlling terminal.<span class="_ _61"> </span><span class="ls5f">We <span class="_ _e"> </span>s<span class="_ _9"></span></span>peciﬁcally</span></span></span></span></div><div class="t m0 x52 h2a y160 ff19 fsf fc0 sc0 ls0 ws0">set <span class="_ _42"> </span>the <span class="_ _53"> </span>stream <span class="_ _42"> </span>to <span class="_ _53"> </span>be <span class="_ _53"> </span>unbuffer<span class="_ _0"></span>ed; <span class="_ _42"> </span>otherwise, <span class="_ _53"> </span>ther<span class="ls150c">em<span class="_ _c"></span><span class="ls0">ight <span class="_ _53"> </span>be <span class="_ _42"> </span>some <span class="_ _53"> </span>interactions</span></span></div><div class="t m0 x52 h2a y2a2d ff19 fsf fc0 sc0 ls0 ws0">between <span class="_ _23"></span>the <span class="_ _23"></span>writing <span class="_ _23"></span>and <span class="_ _23"></span>reading <span class="_ _23"></span>of <span class="_ _23"></span>the <span class="_ _23"></span>str<span class="_ _0"></span>eam <span class="_ _23"></span>(we <span class="_ _23"></span>would <span class="_ _23"></span>need <span class="_ _23"> </span>some <span class="_ _23"> </span>calls <span class="_ _23"> </span>to</div><div class="t m0 x52 h26 y2a2e ff1a fsf fc0 sc0 ls0 ws0">fflush<span class="ff19">). <span class="_ _47"> </span>W<span class="_ _6"></span><span class="ls830">ec<span class="_ _8"></span><span class="ls0">ould <span class="_ _3"></span>have <span class="_ _9"></span>also <span class="_ _3"></span>used <span class="_ _3"></span>unbuffered <span class="_ _2"></span>I/O <span class="_ _3"></span>(Chapter <span class="_ _9"></span>3), <span class="_ _3"></span>but <span class="_ _3"></span>we <span class="_ _3"></span>would</span></span></span></div><div class="t m0 x52 h26 y2a2f ff19 fsf fc0 sc0 ls0 ws0">have to simulate the<span class="_"> </span><span class="ff1a">getc<span class="_ _80"> </span></span>function using<span class="_"> </span><span class="ff1a">read</span>.</div><div class="t m0 x3f h2a y25a ff19 fsf fc0 sc0 ls1508 ws0">•W<span class="_ _30b"></span><span class="ls993">es<span class="_ _d"></span><span class="ls0">tor<span class="ls993">eo<span class="_ _d"></span><span class="ls0">nly up to eight characters as the password. <span class="_"> </span>Any<span class="_"> </span>additional characters</span></span></span></span></div><div class="t m0 x52 h2a y164 ff19 fsf fc0 sc0 ls0 ws0">that ar<span class="ls44">ee<span class="_ _4f"></span><span class="ls0">ntered ar<span class="ls44">ei<span class="_ _4f"></span><span class="ls0">gnored.</span></span></span></span></div><div class="t m0 x3f h26 y165 ff19 fsf fc0 sc0 ls0 ws0">The program in Figur<span class="_ _0"></span><span class="ls647">e1<span class="_ _d"></span><span class="ls0">8.18 calls<span class="_"> </span><span class="ff1a">getpass<span class="_ _66"> </span></span>and prints what we enter to let us <span class="_ _2"></span>verify</span></span></div><div class="t m0 x32 h2a y167 ff19 fsf fc0 sc0 ls0 ws0">that the ERASE and KILL characters work (as they should in canonical mode).</div><div class="t m0 x32 h4e y517e ff1a fs28 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h4e y517f ff1a fs28 fc0 sc0 ls0 ws0">char <span class="_ _68"> </span>*getpass(const<span class="_"> </span>char *);</div><div class="t m0 x32 h4e y5180 ff1a fs28 fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h4e y5181 ff1a fs28 fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 x32 h4e y5182 ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y5183 ff1a fs28 fc0 sc0 ls0 ws0">char <span class="_ _68"> </span>*ptr;</div><div class="t m0 x8a h4e y5184 ff1a fs28 fc0 sc0 ls0 ws0">if ((ptr = getpass(&quot;Enter password:&quot;)) == NULL)</div><div class="t m0 x9d h4e y5185 ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;getpass error&quot;);</div><div class="t m0 x8a h4e y5186 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;password: %s\n&quot;, ptr);</div><div class="t m0 x8a h4e y5187 ff1a fs28 fc0 sc0 ls0 ws0">/* now use password (probably encrypt it) ... */</div><div class="t m0 x8a h4e y5188 ff1a fs28 fc0 sc0 ls0 ws0">while (*ptr != 0)</div><div class="t m0 x9d h4e y5189 ff1a fs28 fc0 sc0 ls0 ws0">*ptr++ = 0;<span class="_ _8a"> </span>/* zero it out when we’re done with it */</div><div class="t m0 x8a h4e y518a ff1a fs28 fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h4e y518b ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x7 h4f y518c ff18 fs11 fc0 sc0 ls0 ws0">Figure 18.18<span class="_ _5a"> </span><span class="ff19">Call the<span class="_"> </span><span class="ff1a">getpass<span class="_ _e"> </span></span>function</span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
