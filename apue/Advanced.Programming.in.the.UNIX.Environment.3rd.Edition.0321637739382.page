<div id="pf17e" class="pf w4 h1f" data-page-no="17e"><div class="pc pc17e w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg17e.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">348<span class="_ _1b"> </span><span class="ff19">Signals <span class="_ _24b"> </span>Chapter<span class="_ _21"> </span>10</span></div><div class="t m0 x35 h27 y12f ff16 fsf fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">Figur<span class="ls44">e1<span class="_ _4f"></span><span class="ls0">0.15 shows many of the signal features that we’ve been describing.</span></span></div><div class="t m0 x32 h4e y245e ff1a fs28 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h4e y2c72 ff1a fs28 fc0 sc0 ls0 ws0">static void sig_quit(int);</div><div class="t m0 x32 h4e y2c73 ff1a fs28 fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h4e y2c74 ff1a fs28 fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 x32 h4e y2c75 ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y2c76 ff1a fs28 fc0 sc0 ls0 ws0">sigset_t <span class="_ _68"> </span>newmask,<span class="_"> </span>oldmask, pendmask;</div><div class="t m0 x8a h4e y2c77 ff1a fs28 fc0 sc0 ls0 ws0">if (signal(SIGQUIT, sig_quit) == SIG_ERR)</div><div class="t m0 x9d h4e y2c78 ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;can’t catch SIGQUIT&quot;);</div><div class="t m0 x8a h4e y2c79 ff1a fs28 fc0 sc0 ls0 ws0">/*</div><div class="t m0 x214 h4e y2c7a ff1a fs28 fc0 sc0 ls1b6 ws0">*B<span class="_ _1d"></span><span class="ls0">lock SIGQUIT and save current signal mask.</span></div><div class="t m0 x214 h4e y2c7b ff1a fs28 fc0 sc0 ls0 ws0">*/</div><div class="t m0 x8a h4e y2c7c ff1a fs28 fc0 sc0 ls0 ws0">sigemptyset(&amp;newmask);</div><div class="t m0 x8a h4e y2c7d ff1a fs28 fc0 sc0 ls0 ws0">sigaddset(&amp;newmask, SIGQUIT);</div><div class="t m0 x8a h4e y2c7e ff1a fs28 fc0 sc0 ls0 ws0">if (sigprocmask(SIG_BLOCK, &amp;newmask, &amp;oldmask) &lt; 0)</div><div class="t m0 x9d h4e y2c7f ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;SIG_BLOCK error&quot;);</div><div class="t m0 x8a h4e y2c80 ff1a fs28 fc0 sc0 ls0 ws0">sleep(5); <span class="_ _d9"> </span>/*<span class="_"> </span>SIGQUIT here will remain pending */</div><div class="t m0 x8a h4e y2c81 ff1a fs28 fc0 sc0 ls0 ws0">if (sigpending(&amp;pendmask) &lt; 0)</div><div class="t m0 x9d h4e y2c82 ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;sigpending error&quot;);</div><div class="t m0 x8a h4e y2c83 ff1a fs28 fc0 sc0 ls0 ws0">if (sigismember(&amp;pendmask, SIGQUIT))</div><div class="t m0 x9d h4e y2c84 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;\nSIGQUIT pending\n&quot;);</div><div class="t m0 x8a h4e y2c85 ff1a fs28 fc0 sc0 ls0 ws0">/*</div><div class="t m0 x214 h4e y2c86 ff1a fs28 fc0 sc0 ls1b6 ws0">*R<span class="_ _1d"></span><span class="ls0">estore signal mask which unblocks SIGQUIT.</span></div><div class="t m0 x214 h4e y2c87 ff1a fs28 fc0 sc0 ls0 ws0">*/</div><div class="t m0 x8a h4e y2c88 ff1a fs28 fc0 sc0 ls0 ws0">if (sigprocmask(SIG_SETMASK, &amp;oldmask, NULL) &lt; 0)</div><div class="t m0 x9d h4e y2c89 ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;SIG_SETMASK error&quot;);</div><div class="t m0 x8a h4e y2c8a ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;SIGQUIT unblocked\n&quot;);</div><div class="t m0 x8a h4e y2c8b ff1a fs28 fc0 sc0 ls0 ws0">sleep(5); <span class="_ _d9"> </span>/*<span class="_"> </span>SIGQUIT here will terminate with core file */</div><div class="t m0 x8a h4e y2c8c ff1a fs28 fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h4e y2c8d ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h4e y2c8e ff1a fs28 fc0 sc0 ls0 ws0">static void</div><div class="t m0 x32 h4e y2c8f ff1a fs28 fc0 sc0 ls0 ws0">sig_quit(int signo)</div><div class="t m0 x32 h4e y2c90 ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y2c91 ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;caught SIGQUIT\n&quot;);</div><div class="t m0 x8a h4e y2c92 ff1a fs28 fc0 sc0 ls0 ws0">if (signal(SIGQUIT, SIG_DFL) == SIG_ERR)</div><div class="t m0 x9d h4e y2c93 ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;can’t reset SIGQUIT&quot;);</div><div class="t m0 x32 h4e y2c94 ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x14e h4f y2c95 ff18 fs11 fc0 sc0 ls0 ws0">Figure 10.15<span class="_ _5a"> </span><span class="ff19">Example of signal sets and<span class="_"> </span><span class="ff1a">sigprocmask</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
