<div id="pf196" class="pf w4 h1f" data-page-no="196"><div class="pc pc196 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg196.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">372<span class="_ _1b"> </span><span class="ff19">Signals <span class="_ _24b"> </span>Chapter<span class="_ _21"> </span>10</span></div><div class="t m0 x32 h26 y12f ff19 fsf fc0 sc0 ls0 ws0">When <span class="_ _53"> </span>we <span class="_ _53"> </span>terminate <span class="_ _e"> </span>the<span class="_ _44"> </span><span class="ff1a">sleep<span class="_ _4b"> </span></span>call <span class="_ _e"> </span>with <span class="_ _53"> </span>the <span class="_ _53"> </span>interrupt <span class="_ _53"> </span>signal, <span class="_ _e"> </span>the<span class="_ _4b"> </span><span class="ff1a">pr_exit<span class="_ _44"> </span></span>function</div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">(Figur<span class="lsd20">e8<span class="_ _43"></span><span class="ls0">.5) <span class="_ _23"></span>thinks <span class="_ _9"></span>that <span class="_ _23"></span>it <span class="_ _9"></span>terminated <span class="_ _9"></span>normally<span class="_ _6"></span><span class="ls2e8">.T<span class="_ _26"></span><span class="ls0">he <span class="_ _23"></span>same <span class="_ _9"></span>thing <span class="_ _9"></span>happens <span class="_ _23"></span>when <span class="_ _9"></span>we <span class="_ _23"></span>kill</span></span></span></span></div><div class="t m0 x32 h26 y131 ff19 fsf fc0 sc0 ls0 ws0">the<span class="_ _47"> </span><span class="ff1a">sleep<span class="_ _47"> </span></span>call <span class="_ _2"></span>with <span class="_ _3"></span>the <span class="_ _2"></span>quit <span class="_ _3"></span>key<span class="_ _6"></span><span class="lsd21">.A<span class="_ _1d"></span><span class="lsd22">st<span class="_ _4f"></span><span class="ls0">his <span class="_ _2"></span>example <span class="_ _3"></span>demonstrates, <span class="_ _3"></span>the <span class="_ _2"></span>Bourne <span class="_ _3"></span>shell <span class="_ _3"></span>has <span class="_ _2"></span>a</span></span></span></div><div class="t m0 x32 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">poorly <span class="_ _47"> </span>documented <span class="_ _45"> </span>featur<span class="_ _0"></span>e<span class="_ _16"> </span>in<span class="_ _16"> </span>which <span class="_ _45"> </span>its <span class="_ _47"> </span>termination <span class="_ _45"> </span>status <span class="_ _47"> </span>is <span class="_ _47"> </span>128 <span class="_ _45"> </span>plus <span class="_ _47"> </span>the <span class="_ _45"> </span>signal</div><div class="t m0 x32 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">number<span class="_ _6"></span><span class="ls3e2">,w<span class="_ _d"></span><span class="ls0">hen <span class="_ _2"></span>the <span class="_ _2"></span>command it <span class="_ _2"></span>was <span class="_ _2"></span>executing <span class="_ _2"></span>is <span class="_ _2"></span>terminated <span class="_ _2"></span>by <span class="_ _2"></span>a <span class="_ _2"></span>signal.<span class="_ _46"> </span><span class="ls5f">We <span class="_ _80"> </span>c<span class="_ _9"></span></span>an <span class="_ _2"></span>see <span class="_ _2"></span>this</span></span></div><div class="t m0 x32 h2a y134 ff19 fsf fc0 sc0 ls0 ws0">with the shell interactively<span class="_ _4"></span>.</div><div class="t m0 x3f h57 y1713 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">sh<span class="_ _27d"> </span><span class="ff1b">make sur<span class="ls110">ew<span class="_ _d"></span><span class="ls0">e’r<span class="ls110">er<span class="_ _5"></span><span class="ls0">unning the Bourne shell</span></span></span></span></span></span></div><div class="t m0 x3f h57 y1714 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">sh -c &quot;sleep 30&quot;</span></div><div class="t m0 x3f h57 y1715 ff1f fs2d fc0 sc0 ls0 ws0">ˆC<span class="_ _23d"> </span><span class="ff1b">press the interrupt key</span></div><div class="t m0 x3f h57 y1716 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">echo $?<span class="_ _279"> </span><span class="ff1b">print termination status of last command</span></span></div><div class="t m0 x3f h57 y1717 ff1a fs2d fc0 sc0 ls0 ws0">130</div><div class="t m0 x3f h57 y1718 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">sh -c &quot;sleep 30&quot;</span></div><div class="t m0 x3f h57 y1719 ff1f fs2d fc0 sc0 ls0 ws0">ˆ\<span class="ff1a">sh: 962 Quit - core dumped<span class="_ _e0"> </span><span class="ff1b">press the quit key</span></span></div><div class="t m0 x3f h57 y171a ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">echo $?<span class="_ _279"> </span><span class="ff1b">print termination status of last command</span></span></div><div class="t m0 x3f h57 y171b ff1a fs2d fc0 sc0 ls0 ws0">131</div><div class="t m0 x3f h57 y171c ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">exit<span class="_ _27c"> </span><span class="ff1b">leave Bourne shell</span></span></div><div class="t m0 x32 h26 y2fad ff19 fsf fc0 sc0 ls0 ws0">On <span class="_ _42"> </span>the <span class="_ _42"> </span>system <span class="_ _42"> </span>being <span class="_ _42"> </span>used,<span class="_ _44"> </span><span class="ff1a">SIGINT<span class="_ _44"> </span></span>has <span class="_ _42"> </span>a <span class="_ _42"> </span>value <span class="_ _42"> </span>of <span class="_ _42"> </span>2 <span class="_ _42"> </span>and<span class="_ _44"> </span><span class="ff1a">SIGQUIT<span class="_ _44"> </span></span>has <span class="_ _42"> </span>a <span class="_ _42"> </span>value <span class="_ _42"> </span>of <span class="_ _42"> </span>3,</div><div class="t m0 x32 h2a y2fae ff19 fsf fc0 sc0 ls0 ws0">giving us the shell’s termination statuses of 130 and 131.</div><div class="t m0 x3f h2a y2faf ff19 fsf fc0 sc0 ls0 ws0">Let’s try <span class="_ _2"></span>a <span class="_ _2"></span>similar <span class="_ _2"></span>example, <span class="_ _2"></span>but this <span class="_ _2"></span>time <span class="_ _2"></span>we’ll <span class="_ _2"></span>send <span class="_ _2"></span>a signal <span class="_ _2"></span>directly to <span class="_ _2"></span>the <span class="_ _2"></span>shell <span class="_ _2"></span>and</div><div class="t m0 x32 h26 y2fb0 ff19 fsf fc0 sc0 ls0 ws0">see what is returned by<span class="_"> </span><span class="ff1a">system</span>:</div><div class="t m0 x3f h57 y2fb1 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">tsys &quot;sleep 30&quot; &amp;<span class="_ _ce"> </span><span class="ff1b">start it in backgr<span class="_ _0"></span>ound this time</span></span></div><div class="t m0 x3f h57 y2fb2 ff1a fs2d fc0 sc0 ls0 ws0">9257</div><div class="t m0 x3f h57 y2fb3 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">ps -f<span class="_ _27e"> </span><span class="ff1b">look at the process IDs</span></span></div><div class="t m0 x1c h57 y2fb4 ff1a fs2d fc0 sc0 ls0 ws0">UID <span class="_ _d9"> </span>PID<span class="_ _3a"> </span>PPID <span class="_"> </span>TTY<span class="_ _88"> </span>TIME CMD</div><div class="t m0 x1c h57 y2fb5 ff1a fs2d fc0 sc0 ls0 ws0">sar <span class="_"> </span>9260<span class="_ _68"> </span>949 <span class="_"> </span>pts/5<span class="_ _15"> </span>0:00 ps -f</div><div class="t m0 x1c h57 y2fb6 ff1a fs2d fc0 sc0 ls0 ws0">sar <span class="_"> </span>9258 <span class="_"> </span>9257 <span class="_"> </span>pts/5<span class="_ _15"> </span>0:00 sh -c sleep 30</div><div class="t m0 x1c h57 y2fb7 ff1a fs2d fc0 sc0 ls0 ws0">sar <span class="_ _d9"> </span>949 <span class="_ _3a"> </span>947<span class="_ _3a"> </span>pts/5 <span class="_ _87"> </span>0:01<span class="_"> </span>/bin/sh</div><div class="t m0 x1c h57 y2fb8 ff1a fs2d fc0 sc0 ls0 ws0">sar <span class="_"> </span>9257<span class="_ _68"> </span>949 <span class="_"> </span>pts/5<span class="_ _15"> </span>0:00 tsys sleep 30</div><div class="t m0 x1c h57 y2fb9 ff1a fs2d fc0 sc0 ls0 ws0">sar <span class="_"> </span>9259 <span class="_"> </span>9258 <span class="_"> </span>pts/5<span class="_ _15"> </span>0:00 sleep 30</div><div class="t m0 x3f h57 y2fba ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">kill -KILL 9258<span class="_ _1e9"> </span><span class="ff1b">kill the shell itself</span></span></div><div class="t m0 x3f h57 y2fbb ff1a fs2d fc0 sc0 ls0 ws0">abnormal termination, signal number = 9</div><div class="t m0 x32 h26 y2fbc ff19 fsf fc0 sc0 ls0 ws0">Here, <span class="_ _9"></span>we <span class="_ _9"></span>can <span class="_ _23"> </span>see <span class="_ _23"></span>that <span class="_ _9"></span>the <span class="_ _23"></span>return <span class="_ _9"></span>value <span class="_ _23"></span>from<span class="_ _45"> </span><span class="ff1a">system<span class="_ _45"> </span></span><span class="ls45">re</span>ports <span class="_ _23"> </span>an <span class="_ _23"></span>abnormal <span class="_ _9"></span>termination</div><div class="t m0 x32 h2a y2fbd ff19 fsf fc0 sc0 ls0 ws0">only when the shell itself terminates abnormally<span class="_ _4"></span>.</div><div class="t m0 x76 h52 y2fbe ff19 fs2a fc0 sc0 ls0 ws0">Other <span class="_ _23"> </span>shells <span class="_ _42"> </span>behave <span class="_ _42"> </span>differ<span class="_ _0"></span>ently <span class="_ _42"> </span>when <span class="_ _23"> </span>handling <span class="_ _42"> </span>terminal-generated <span class="_ _42"> </span>signals, <span class="_ _23"> </span>such <span class="_ _42"> </span>as<span class="_ _45"> </span><span class="ff1a">SIGINT</span></div><div class="t m0 x76 h52 y2fbf ff19 fs2a fc0 sc0 ls0 ws0">and<span class="_"> </span><span class="ff1a">SIGQUIT</span><span class="lsd23">.W<span class="_ _55"></span><span class="ls0">ith<span class="_"> </span><span class="ff1a">bash<span class="_ _e"> </span></span>and<span class="_ _e"> </span><span class="ff1a">dash</span><span class="lsd24">,f<span class="_ _84"></span><span class="ls0">or example, <span class="_ _2"></span>pressing the interrupt or quit key will result</span></span></span></span></div><div class="t m0 x76 h51 y2fc0 ff19 fs2a fc0 sc0 ls0 ws0">in <span class="_"> </span>an <span class="_ _80"> </span>exit <span class="_"> </span>status <span class="_ _80"> </span>indicating <span class="_"> </span>abnormal <span class="_ _e"> </span>termination <span class="_ _80"> </span>with <span class="_"> </span>the <span class="_ _80"> </span>corresponding <span class="_"> </span>signal <span class="_"> </span>number<span class="_ _0"></span>.</div><div class="t m0 x76 h52 y2fc1 ff19 fs2a fc0 sc0 ls0 ws0">However<span class="_ _1"></span>,<span class="_ _45"> </span>if<span class="_ _45"> </span>we<span class="_ _45"> </span>ﬁnd <span class="_ _23"> </span>our <span class="_ _23"> </span>process <span class="_ _23"> </span>executing<span class="_ _45"> </span><span class="ff1a">sleep<span class="_ _45"> </span></span>and <span class="_ _23"> </span>send <span class="_ _42"> </span>it <span class="_ _23"> </span>a <span class="_ _42"> </span>signal <span class="_ _23"> </span>directly<span class="_ _6"></span>,<span class="_ _45"> </span>so<span class="_ _45"> </span>that <span class="_ _23"> </span>the</div><div class="t m0 x76 h51 y2fc2 ff19 fs2a fc0 sc0 ls0 ws0">signal <span class="_ _3"></span>goes <span class="_ _3"></span>only <span class="_ _9"></span>to <span class="_ _3"></span>the <span class="_ _9"></span>individual <span class="_ _3"></span>process <span class="_ _3"></span>instead <span class="_ _3"></span>of <span class="_ _3"></span>the <span class="_ _9"></span>entir<span class="lsd25">ef<span class="_ _4f"></span><span class="ls0">oreground <span class="_ _2"></span>process <span class="_ _3"></span>group, <span class="_ _3"></span>we</span></span></div><div class="t m0 x76 h51 y2fc3 ff19 fs2a fc0 sc0 ls0 ws0">will <span class="_ _23"> </span>ﬁnd <span class="_ _42"> </span>that <span class="_ _23"> </span>these <span class="_ _42"> </span>shells <span class="_ _23"> </span>behave <span class="_ _42"> </span>like <span class="_ _23"> </span>the <span class="_ _42"> </span>Bourne <span class="_ _23"> </span>shell <span class="_ _42"> </span>and <span class="_ _23"> </span>exit <span class="_ _23"> </span>with <span class="_ _42"> </span>a <span class="_ _23"> </span>normal <span class="_ _42"> </span>termination</div><div class="t m0 x76 h51 y2fc4 ff19 fs2a fc0 sc0 ls0 ws0">status of 128 plus the signal number<span class="_ _1"></span>.</div><div class="t m0 x3f h26 y2fc5 ff19 fsf fc0 sc0 ls0 ws0">When <span class="_"> </span>writing <span class="_ _e"> </span>programs <span class="_ _e"> </span>that <span class="_"> </span>use <span class="_"> </span>the<span class="_ _4b"> </span><span class="ff1a">system<span class="_ _59"> </span></span>function, <span class="_"> </span>be <span class="_"> </span>sur<span class="_ _0"></span>e<span class="_ _59"> </span>to<span class="_ _59"> </span>interpret <span class="_ _e"> </span>the</div><div class="t m0 x32 h26 y2fc6 ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">turn <span class="_"> </span>value <span class="_"> </span>corr<span class="_ _0"></span>ectly<span class="_ _4"></span><span class="lsd26">.I<span class="_ _5d"></span><span class="lsd27">fy<span class="_ _55"></span><span class="ls0">ou <span class="_"> </span>call<span class="_ _4b"> </span><span class="ff1a">fork</span>,<span class="_ _46"> </span><span class="ff1a">exec</span><span class="lsd28">,a<span class="_ _4a"></span><span class="ls0">nd<span class="_ _59"> </span><span class="ff1a">wait<span class="_ _59"> </span></span>yourself, <span class="_"> </span>the <span class="_"> </span>termination</span></span></span></span></span></span></div><div class="t m0 x32 h26 y2fc7 ff19 fsf fc0 sc0 ls0 ws0">status is not the same as if you call<span class="_"> </span><span class="ff1a">system</span>.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
