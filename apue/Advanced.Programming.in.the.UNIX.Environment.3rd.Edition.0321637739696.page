<div id="pf2b8" class="pf w4 h1f" data-page-no="2b8"><div class="pc pc2b8 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg2b8.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">662<span class="_ _1b"> </span><span class="ff19">Advanced <span class="_"> </span>IPC<span class="_ _e8"> </span>Chapter <span class="_"> </span>17</span></div><div class="t m0 x1f h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">return;</div><div class="t m0 x9d h57 y426 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y800 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y801 ff1a fs2d fc0 sc0 ls0 ws0">log_quit(&quot;can’t find client entry for fd %d&quot;, fd);</div><div class="t m0 x32 h57 y802 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x134 h5e y2e4d ff18 fs10 fc0 sc0 ls0 ws0">Figure 17.27<span class="_ _5a"> </span><span class="ff19">Functions to manipulate<span class="_"> </span><span class="ff1a">client<span class="_ _e"> </span></span>array</span></div><div class="t m0 x3f h4d y2e4e ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _42"> </span>ﬁrst <span class="_ _23"> </span>time<span class="_ _44"> </span><span class="ff1a">client_add<span class="_ _35"> </span></span>is <span class="_ _42"> </span>called, <span class="_ _42"> </span>it <span class="_ _23"> </span>calls<span class="_ _44"> </span><span class="ff1a">client_alloc</span><span class="ls13fe">,w<span class="_ _43"></span><span class="ls0">hich <span class="_ _23"> </span>in <span class="_ _42"> </span>turn <span class="_ _42"> </span>calls</span></span></div><div class="t m0 x32 h4d y2e4f ff1a fs26 fc0 sc0 ls0 ws0">malloc<span class="_ _45"> </span><span class="ff19">to <span class="_ _23"> </span>allocate <span class="_ _23"></span>space <span class="_ _23"></span>for <span class="_ _23"></span>ten <span class="_ _9"></span>entries <span class="_ _23"> </span>in <span class="_ _23"></span>the <span class="_ _23"></span>array<span class="_ _4"></span><span class="ls13ff">.A<span class="_ _26"></span><span class="ls0">fter <span class="_ _23"></span>these <span class="_ _23"></span>ten <span class="_ _23"></span>entries <span class="_ _9"></span>ar<span class="ls1400">ea<span class="_ _b"></span><span class="ls0">ll <span class="_ _9"></span>in</span></span></span></span></span></div><div class="t m0 x32 h4d y2e50 ff19 fs26 fc0 sc0 ls0 ws0">use, <span class="_ _66"> </span>a <span class="_ _47"> </span>later <span class="_ _66"> </span>call <span class="_ _47"> </span>to<span class="_ _46"> </span><span class="ff1a">client_add<span class="_ _61"> </span></span>causes<span class="_ _61"> </span><span class="ff1a">realloc<span class="_ _61"> </span></span>to <span class="_ _47"> </span>allocate <span class="_ _66"> </span>additional <span class="_ _47"> </span>space.<span class="_ _50"> </span>By</div><div class="t m0 x32 h4d y2e51 ff19 fs26 fc0 sc0 ls0 ws0">dynamically allocating <span class="_ _2"></span>space this <span class="_ _2"></span>way<span class="_ _4"></span>,<span class="_ _66"> </span>we<span class="_ _66"> </span>have <span class="_ _2"></span>not <span class="_ _2"></span>limited the <span class="_ _2"></span>size of <span class="_ _2"></span>the<span class="_"> </span><span class="ff1a">client<span class="_ _66"> </span></span>array</div><div class="t m0 x32 h49 y4de3 ff19 fs26 fc0 sc0 ls0 ws0">at <span class="_ _3"></span>compile <span class="_ _9"></span>time <span class="_ _3"></span>to <span class="_ _3"></span>some <span class="_ _9"></span>value <span class="_ _3"></span>that <span class="_ _9"></span>we <span class="_ _3"></span>guessed <span class="_ _9"></span>and <span class="_ _3"></span>put <span class="_ _3"></span>into <span class="_ _9"></span>a <span class="_ _3"></span>header<span class="_ _1"></span><span class="ls1401">.T<span class="_ _1d"></span><span class="ls0">hese <span class="_ _3"></span>functions</span></span></div><div class="t m0 x32 h4d y4de4 ff19 fs26 fc0 sc0 ls0 ws0">call the<span class="_ _47"> </span><span class="ff1a">log_<span class="_ _66"> </span></span>functions <span class="_ _2"></span>(Appendix <span class="_ _2"></span>B) <span class="_ _2"></span>if an <span class="_ _2"></span>error <span class="_ _2"></span>occurs, <span class="_ _2"></span>since we <span class="_ _2"></span>assume <span class="_ _2"></span>that <span class="_ _2"></span>the <span class="_ _2"></span>server</div><div class="t m0 x32 h49 y4de5 ff19 fs26 fc0 sc0 ls0 ws0">is a daemon.</div><div class="t m0 x3f h49 y4de6 ff19 fs26 fc0 sc0 ls0 ws0">Normally <span class="_ _9"></span>the <span class="_ _9"></span>server <span class="_ _23"></span>will <span class="_ _9"></span>run <span class="_ _9"></span>as <span class="_ _9"></span>a <span class="_ _9"></span>daemon, <span class="_ _23"></span>but <span class="_ _9"></span>we <span class="_ _9"></span>want <span class="_ _9"></span>to <span class="_ _23"></span>provide <span class="_ _3"></span>an <span class="_ _23"></span>option <span class="_ _9"></span>that</div><div class="t m0 x32 h49 y4de7 ff19 fs26 fc0 sc0 ls0 ws0">allows <span class="_ _42"> </span>it <span class="_ _42"> </span>to <span class="_ _42"> </span>be <span class="_ _42"> </span>run <span class="_ _42"> </span>in <span class="_ _42"> </span>the <span class="_ _53"> </span>foregr<span class="_ _0"></span>ound, <span class="_ _42"> </span>with <span class="_ _42"> </span>diagnostic <span class="_ _42"> </span>messages <span class="_ _42"> </span>sent <span class="_ _42"> </span>to <span class="_ _53"> </span>the <span class="_ _42"> </span>standard</div><div class="t m0 x32 h49 y4de8 ff19 fs26 fc0 sc0 ls0 ws0">error<span class="_ _6"></span><span class="ls1402">.T<span class="_ _1d"></span><span class="ls0">his <span class="_ _3"></span>should <span class="_ _2"></span>make <span class="_ _3"></span>the <span class="_ _2"></span>server <span class="_ _3"></span>easier <span class="_ _2"></span>to <span class="_ _3"></span>test <span class="_ _3"></span>and <span class="_ _2"></span>debug, <span class="_ _3"></span>especially <span class="_ _2"></span>if <span class="_ _3"></span>we <span class="_ _2"></span>don’t <span class="_ _3"></span>have</span></span></div><div class="t m0 x32 h49 y4de9 ff19 fs26 fc0 sc0 ls0 ws0">permission <span class="_ _53"> </span>to <span class="_ _e"> </span>read <span class="_ _42"> </span>the <span class="_ _e"> </span>log <span class="_ _e"> </span>ﬁle <span class="_ _53"> </span>wher<span class="ls1403">et<span class="_ _55"></span><span class="ls0">he <span class="_ _e"> </span>diagnostic <span class="_ _53"> </span>messages <span class="_ _e"> </span>ar<span class="ls1404">en<span class="_ _55"></span><span class="ls0">ormally <span class="_ _53"> </span>written.</span></span></span></span></div><div class="t m0 x32 h49 y4dea ff19 fs26 fc0 sc0 ls164 ws0">We<span class="_ _9"></span><span class="ls0">’ll <span class="_ _9"></span>use <span class="_ _9"></span>a <span class="_ _9"></span>command</span></div><div class="t m0 x10d h49 y4deb ff19 fs26 fc0 sc0 ls0 ws0">-</div><div class="t m0 x108 h49 y4dea ff19 fs26 fc0 sc0 ls0 ws0">line <span class="_ _9"></span>option <span class="_ _9"></span>to <span class="_ _9"></span>control <span class="_ _9"></span>whether <span class="_ _9"></span>the <span class="_ _9"></span>server <span class="_ _9"></span>runs <span class="_ _9"></span>in <span class="_ _9"></span>the <span class="_ _9"></span>foregr<span class="_ _0"></span>ound</div><div class="t m0 x32 h49 y4dec ff19 fs26 fc0 sc0 ls0 ws0">or as a daemon in the background.</div><div class="t m0 x3f h49 y4ded ff19 fs26 fc0 sc0 ls0 ws0">It is important that <span class="_ _2"></span>all commands on <span class="_ _2"></span>a system follow <span class="_ _2"></span>the same conventions, because</div><div class="t m0 x32 h49 y4dee ff19 fs26 fc0 sc0 ls0 ws0">this <span class="_"> </span>makes <span class="_ _e"> </span>them <span class="_"> </span>easier <span class="_"> </span>to <span class="_ _e"> </span>use.<span class="_ _48"> </span>If <span class="_"> </span>someone <span class="_"> </span>is <span class="_ _e"> </span>familiar <span class="_"> </span>with <span class="_"> </span>the <span class="_ _e"> </span>way <span class="_"> </span>command</div><div class="t m0 x17d h49 y4def ff19 fs26 fc0 sc0 ls0 ws0">-</div><div class="t m0 x61 h49 y4dee ff19 fs26 fc0 sc0 ls0 ws0">line</div><div class="t m0 x32 h49 y4df0 ff19 fs26 fc0 sc0 ls0 ws0">options <span class="_ _23"> </span>ar<span class="ls1405">ef<span class="_ _43"></span><span class="ls0">ormed <span class="_ _23"> </span>with <span class="_ _42"> </span>one <span class="_ _42"> </span>command, <span class="_ _42"> </span>it <span class="_ _23"> </span>would <span class="_ _42"> </span>create <span class="_ _23"> </span>mor<span class="ls1405">ec<span class="_ _43"></span><span class="ls0">hances <span class="_ _23"> </span>for <span class="_ _42"> </span>mistakes <span class="_ _42"> </span>if</span></span></span></span></div><div class="t m0 x32 h49 y4df1 ff19 fs26 fc0 sc0 ls0 ws0">another command followed differ<span class="_ _0"></span>ent conventions.</div><div class="t m0 x3f h49 y4df2 ff19 fs26 fc0 sc0 ls0 ws0">This <span class="_ _2"></span>problem <span class="_ _2"></span>is <span class="_ _2"></span>sometimes <span class="_ _3"></span>visible <span class="_ _2"></span>when <span class="_ _3"></span>dealing <span class="_ _2"></span>with <span class="_ _3"></span>white <span class="_ _2"></span>space <span class="_ _3"></span>on <span class="_ _2"></span>the <span class="_ _3"></span>command</div><div class="t m0 x32 h49 y4df3 ff19 fs26 fc0 sc0 ls0 ws0">line. <span class="_ _45"> </span>Some<span class="_ _47"> </span>commands <span class="_ _9"></span>requir<span class="_ _0"></span><span class="ls1406">et<span class="_ _b"></span><span class="ls0">hat <span class="_ _9"></span>an <span class="_ _3"></span>option <span class="_ _9"></span>be <span class="_ _9"></span>separated <span class="_ _9"></span>from <span class="_ _3"></span>its <span class="_ _3"></span>argument <span class="_ _9"></span>by <span class="_ _3"></span>white</span></span></div><div class="t m0 x32 h49 y4df4 ff19 fs26 fc0 sc0 ls0 ws0">space, but <span class="_ _2"></span>other <span class="_ _2"></span>commands <span class="_ _2"></span>requir<span class="_ _0"></span><span class="ls1407">et<span class="_ _4f"></span><span class="ls0">he <span class="_ _2"></span>argument to <span class="_ _2"></span>follow immediately <span class="_ _2"></span>after <span class="_ _2"></span>its <span class="_ _2"></span>option,</span></span></div><div class="t m0 x32 h49 y4df5 ff19 fs26 fc0 sc0 ls0 ws0">without <span class="_ _2"></span>any <span class="_ _3"></span>intervening <span class="_ _2"></span>spaces.<span class="_ _61"> </span><span class="ls3aa">Wi<span class="_ _9"></span></span>thout <span class="_ _2"></span>a <span class="_ _2"></span>consistent <span class="_ _3"></span>set <span class="_ _2"></span>of <span class="_ _3"></span>rules <span class="_ _2"></span>to <span class="_ _3"></span>follow<span class="_ _6"></span><span class="ls1408">,u<span class="_ _4f"></span><span class="ls0">sers <span class="_ _2"></span>either</span></span></div><div class="t m0 x32 h49 y4df6 ff19 fs26 fc0 sc0 ls0 ws0">have <span class="_ _53"> </span>to <span class="_"> </span>memorize <span class="_ _53"> </span>the <span class="_ _e"> </span>syntax <span class="_ _e"> </span>of <span class="_ _e"> </span>all <span class="_ _e"> </span>commands <span class="_ _e"> </span>or <span class="_ _e"> </span>resort <span class="_ _53"> </span>to <span class="_ _e"> </span>a <span class="_ _e"> </span>trial-and-error <span class="_ _53"> </span>process</div><div class="t m0 x32 h49 y4df7 ff19 fs26 fc0 sc0 ls0 ws0">when invoking them.</div><div class="t m0 x3f h49 y4df8 ff19 fs26 fc0 sc0 ls0 ws0">The <span class="_ _53"> </span>Single <span class="_ _53"> </span>UNIX <span class="_ _53"> </span>Speciﬁcation <span class="_ _e"> </span>includes <span class="_ _53"> </span>a <span class="_ _53"> </span>set <span class="_ _e"> </span>of <span class="_ _53"> </span>conventions <span class="_ _53"> </span>and <span class="_ _53"> </span>guidelines <span class="_ _e"> </span>that</div><div class="t m0 x32 h49 y4df9 ff19 fs26 fc0 sc0 ls0 ws0">promote <span class="_ _23"></span>consistent <span class="_ _23"></span>command</div><div class="t m0 x64 h49 y4dfa ff19 fs26 fc0 sc0 ls0 ws0">-</div><div class="t m0 x131 h49 y4df9 ff19 fs26 fc0 sc0 ls0 ws0">line <span class="_ _23"> </span>syntax.<span class="_ _51"> </span>They <span class="_ _23"> </span>include <span class="_ _42"> </span>such <span class="_ _23"></span>suggestions <span class="_ _23"> </span>as <span class="_ _23"> </span>‘‘Restrict</div><div class="t m0 x32 h49 y4dfb ff19 fs26 fc0 sc0 ls0 ws0">each command</div><div class="t m0 x13a h49 y4dfc ff19 fs26 fc0 sc0 ls0 ws0">-</div><div class="t m0 x22e h49 y4dfb ff19 fs26 fc0 sc0 ls0 ws0">line option <span class="_ _2"></span>to a <span class="_ _2"></span>single <span class="_ _2"></span>alphanumeric character<span class="_ _9"></span><span class="ls937">’’ <span class="_ _9"></span>a<span class="_ _3"></span></span>nd ‘‘All options should</div><div class="t m0 x32 h49 y4dfd ff19 fs26 fc0 sc0 ls0 ws0">be preceded by a<span class="_"> </span><span class="ff20">−<span class="_ _80"> </span></span>character<span class="_ _6"></span>.’’</div><div class="t m0 x3f h4d y4dfe ff19 fs26 fc0 sc0 ls0 ws0">Luckily<span class="_ _4"></span><span class="ls1409">,t<span class="_ _49"></span><span class="ls0">he<span class="_ _50"> </span><span class="ff1a">getopt<span class="_ _50"> </span></span>function <span class="_ _16"> </span>exists <span class="_ _61"> </span>to <span class="_ _16"> </span>help <span class="_ _61"> </span>command <span class="_ _61"> </span>developers <span class="_ _16"> </span>process</span></span></div><div class="t m0 x32 h49 y4dff ff19 fs26 fc0 sc0 ls0 ws0">command</div><div class="t m0 xc3 h49 y4e00 ff19 fs26 fc0 sc0 ls0 ws0">-</div><div class="t m0 xc4 h49 y4dff ff19 fs26 fc0 sc0 ls0 ws0">line options in a consistent manner<span class="_ _6"></span>.</div><div class="t m0 x3f h4e y4e01 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;unistd.h&gt;</div><div class="t m0 x3f h4e y4e02 ff1a fs28 fc0 sc0 ls0 ws0">int getopt(int<span class="_"> </span><span class="ff1b">argc</span><span class="ls1b6">,c<span class="_ _1d"></span><span class="ls0">har * const<span class="_"> </span><span class="ff1b">argv</span>[], const char *<span class="ff1b">options</span>);</span></span></div><div class="t m0 x3f h4e y4e03 ff1a fs28 fc0 sc0 ls0 ws0">extern int optind, opterr, optopt;</div><div class="t m0 x3f h4e y4e04 ff1a fs28 fc0 sc0 ls0 ws0">extern char *optarg;</div><div class="t m0 x87 h7c y4e05 ff19 fs28 fc0 sc0 ls0 ws0">Returns: the next option character<span class="_ _1"></span><span class="ls396">,o<span class="_ _5"></span><span class="ls0">r</span></span></div><div class="t m0 x78 h7c y4e06 ff20 fs28 fc0 sc0 ls0 ws0">−<span class="ff19 ls396">1w<span class="_ _5"></span><span class="ls0">hen all options have been processed</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
