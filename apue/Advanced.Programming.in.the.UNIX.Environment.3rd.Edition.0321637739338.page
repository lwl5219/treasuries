<div id="pf152" class="pf w4 h1f" data-page-no="152"><div class="pc pc152 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg152.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">304<span class="_ _1b"> </span><span class="ff19">Process <span class="_"> </span>Relationships<span class="_ _18d"> </span>Chapter <span class="_"> </span>9</span></div><div class="t m0 x32 h2a y12f ff19 fsf fc0 sc0 ls0 ws0">This <span class="_ _2"></span>shell <span class="_ _2"></span>doesn’t <span class="_ _3"></span>know <span class="_ _2"></span>about <span class="_ _2"></span>job <span class="_ _3"></span>control, so <span class="_ _3"></span>the <span class="_ _2"></span>background <span class="_ _2"></span>job <span class="_ _2"></span>is <span class="_ _3"></span>not <span class="_ _2"></span>put <span class="_ _2"></span>into <span class="_ _3"></span>its <span class="_ _2"></span>own</div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">process gr<span class="_ _0"></span>oup and the contr<span class="_ _0"></span>olling terminal isn’t taken away from the backgr<span class="_ _0"></span>ound job.</div><div class="t m0 x3f h2a y131 ff19 fsf fc0 sc0 ls0 ws0">Now let’s look at how the Bourne shell handles a pipeline.<span class="_ _59"> </span>When we execute</div><div class="t m0 x3f h57 y273f ff1a fs2d fc0 sc0 ls0 ws0">ps -o pid,ppid,pgid,sid,comm | cat1</div><div class="t m0 x32 h2a y2740 ff19 fsf fc0 sc0 ls0 ws0">the output is</div><div class="t m0 xf4 h57 y2741 ff1a fs2d fc0 sc0 ls0 ws0">PID <span class="_"> </span>PPID <span class="_"> </span>PGID<span class="_ _68"> </span>SID COMMAND</div><div class="t m0 xf4 h57 y2742 ff1a fs2d fc0 sc0 ls0 ws0">949 <span class="_ _d9"> </span>947 <span class="_ _3a"> </span>949 <span class="_ _3a"> </span>949<span class="_"> </span>sh</div><div class="t m0 x90 h57 y2743 ff1a fs2d fc0 sc0 ls0 ws0">1823 <span class="_ _d9"> </span>949 <span class="_ _3a"> </span>949 <span class="_ _3a"> </span>949<span class="_"> </span>cat1</div><div class="t m0 x90 h57 y2744 ff1a fs2d fc0 sc0 ls0 ws0">1824 <span class="_"> </span>1823<span class="_ _68"> </span>949 <span class="_ _3a"> </span>949<span class="_"> </span>ps</div><div class="t m0 x32 h26 y2745 ff19 fsf fc0 sc0 ls0 ws0">(The <span class="_ _3"></span>program<span class="_ _47"> </span><span class="ff1a">cat1<span class="_ _47"> </span></span>is <span class="_ _3"></span>just <span class="_ _9"></span>a <span class="_ _3"></span>copy <span class="_ _3"></span>of <span class="_ _3"></span>the <span class="_ _9"></span>standard<span class="_ _47"> </span><span class="ff1a">cat<span class="_ _47"> </span></span>program, <span class="_ _2"></span>with <span class="_ _9"></span>a <span class="_ _3"></span>differ<span class="_ _0"></span>ent <span class="_ _3"></span>name.</div><div class="t m0 x32 h26 y2746 ff19 fsf fc0 sc0 ls5f ws0">We <span class="_ _e"> </span>h<span class="_ _9"></span><span class="ls0">ave <span class="_ _2"></span>another <span class="_ _3"></span>copy <span class="_ _2"></span>of<span class="_ _66"> </span><span class="ff1a">cat<span class="_ _47"> </span></span>with <span class="_ _2"></span>the <span class="_ _2"></span>name<span class="_ _47"> </span><span class="ff1a">cat2</span><span class="ls6a8">,w<span class="_ _4f"></span><span class="ls0">hich <span class="_ _2"></span>we’ll <span class="_ _2"></span>use <span class="_ _2"></span>later <span class="_ _2"></span>in <span class="_ _2"></span>this <span class="_ _3"></span>section.</span></span></span></div><div class="t m0 x32 h26 y2747 ff19 fsf fc0 sc0 ls0 ws0">When <span class="_ _9"></span>we <span class="_ _3"></span>have <span class="_ _9"></span>two <span class="_ _9"></span>copies <span class="_ _9"></span>of<span class="_ _45"> </span><span class="ff1a">cat<span class="_ _45"> </span></span>in <span class="_ _3"></span>a <span class="_ _9"></span>pipeline, <span class="_ _9"></span>the <span class="_ _9"></span>differ<span class="_ _0"></span>ent <span class="_ _9"></span>names <span class="_ _9"></span>let <span class="_ _3"></span>us <span class="_ _9"></span>differentiate</div><div class="t m0 x32 h2a y2748 ff19 fsf fc0 sc0 ls0 ws0">between <span class="_ _2"></span>the <span class="_ _2"></span>two <span class="_ _2"></span>programs.) <span class="_"> </span>Note<span class="_ _47"> </span>that <span class="_ _2"></span>the <span class="_ _2"></span>last <span class="_ _2"></span>process in <span class="_ _2"></span>the <span class="_ _2"></span>pipeline <span class="_ _2"></span>is <span class="_ _3"></span>the <span class="_ _2"></span>child <span class="_ _2"></span>of <span class="_ _2"></span>the</div><div class="t m0 x32 h2a y2749 ff19 fsf fc0 sc0 ls0 ws0">shell <span class="_ _9"></span>and <span class="_ _23"></span>that <span class="_ _9"></span>the <span class="_ _23"></span>ﬁrst <span class="_ _9"></span>process <span class="_ _23"></span>in <span class="_ _9"></span>the <span class="_ _23"></span>pipeline <span class="_ _9"></span>is <span class="_ _23"></span>a <span class="_ _9"></span>child <span class="_ _23"></span>of <span class="_ _9"></span>the <span class="_ _23"></span>last <span class="_ _9"></span>process. <span class="_ _45"> </span>It<span class="_ _35"> </span>appears</div><div class="t m0 x32 h26 y274a ff19 fsf fc0 sc0 ls0 ws0">that <span class="_ _3"></span>the <span class="_ _9"></span>shell<span class="_ _45"> </span><span class="ff1a">fork</span><span class="lsb49">sac<span class="_ _b"></span><span class="ls0">opy <span class="_ _3"></span>of <span class="_ _9"></span>itself <span class="_ _9"></span>and <span class="_ _3"></span>that <span class="_ _9"></span>this <span class="_ _3"></span>copy <span class="_ _9"></span>then<span class="_ _45"> </span><span class="ff1a">fork</span>s<span class="_ _47"> </span>to<span class="_ _45"> </span>make <span class="_ _3"></span>each <span class="_ _3"></span>of <span class="_ _9"></span>the</span></span></div><div class="t m0 x32 h2a y274b ff19 fsf fc0 sc0 ls0 ws0">previous pr<span class="_ _0"></span>ocesses in the pipeline.</div><div class="t m0 x3f h2a y274c ff19 fsf fc0 sc0 ls0 ws0">If we execute the pipeline in the background,</div><div class="t m0 x3f h57 y274d ff1a fs2d fc0 sc0 ls0 ws0">ps -o pid,ppid,pgid,sid,comm | cat1 &amp;</div><div class="t m0 x32 h2a y274e ff19 fsf fc0 sc0 ls0 ws0">only <span class="_ _53"> </span>the <span class="_ _53"> </span>process <span class="_ _53"> </span>IDs <span class="_ _53"> </span>change.<span class="_ _65"> </span>Since <span class="_ _e"> </span>the <span class="_ _53"> </span>shell <span class="_ _e"> </span>doesn’t <span class="_ _53"> </span>handle <span class="_ _53"> </span>job <span class="_ _e"> </span>control, <span class="_ _42"> </span>the <span class="_ _e"> </span>process</div><div class="t m0 x32 h2a y274f ff19 fsf fc0 sc0 ls0 ws0">group ID <span class="_ _3"></span>of <span class="_ _3"></span>the <span class="_ _2"></span>background <span class="_ _2"></span>processes <span class="_ _2"></span>remains <span class="_ _2"></span>949, <span class="_ _3"></span>as <span class="_ _3"></span>does <span class="_ _2"></span>the <span class="_ _3"></span>process <span class="_ _2"></span>group <span class="_ _2"></span>ID <span class="_ _2"></span>of <span class="_ _3"></span>the</div><div class="t m0 x32 h2a y2750 ff19 fsf fc0 sc0 ls0 ws0">session.</div><div class="t m0 x3f h2a y2751 ff19 fsf fc0 sc0 ls0 ws0">What <span class="_ _2"></span>happens <span class="_ _3"></span>in <span class="_ _3"></span>this <span class="_ _3"></span>case <span class="_ _3"></span>if <span class="_ _2"></span>a <span class="_ _3"></span>background <span class="_ _2"></span>process <span class="_ _2"></span>tries <span class="_ _3"></span>to <span class="_ _3"></span>read <span class="_ _2"></span>from <span class="_ _2"></span>its <span class="_ _3"></span>controlling</div><div class="t m0 x32 h2a y2752 ff19 fsf fc0 sc0 ls0 ws0">terminal? <span class="_"> </span>For<span class="_"> </span>example, suppose that we execute</div><div class="t m0 x3f h57 y2753 ff1a fs2d fc0 sc0 ls0 ws0">cat &gt; temp.foo &amp;</div><div class="t m0 x32 h2a y2754 ff19 fsf fc0 sc0 ls65 ws0">Wi<span class="_ _3"></span><span class="ls0">th <span class="_"> </span>job <span class="_ _53"> </span>control, <span class="_"> </span>this <span class="_ _53"> </span>is <span class="_"> </span>handled <span class="_ _e"> </span>by <span class="_"> </span>placing <span class="_ _e"> </span>the <span class="_"> </span>backgr<span class="_ _0"></span>ound <span class="_ _e"> </span>job <span class="_"> </span>into <span class="_ _e"> </span>a <span class="_"> </span>backgr<span class="_ _0"></span>ound</span></div><div class="t m0 x32 h26 y2755 ff19 fsf fc0 sc0 ls0 ws0">process <span class="_ _2"></span>group, <span class="_ _2"></span>which <span class="_ _3"></span>causes <span class="_ _3"></span>the <span class="_ _3"></span>signal<span class="_ _45"> </span><span class="ff1a">SIGTTIN<span class="_ _47"> </span></span>to <span class="_ _2"></span>be <span class="_ _3"></span>generated <span class="_ _3"></span>if <span class="_ _3"></span>the <span class="_ _3"></span>background <span class="_ _3"></span>job</div><div class="t m0 x32 h2a y2756 ff19 fsf fc0 sc0 ls0 ws0">tries <span class="_ _2"></span>to <span class="_ _3"></span>read <span class="_ _2"></span>from <span class="_ _2"></span>the <span class="_ _3"></span>controlling <span class="_ _2"></span>terminal.<span class="_ _61"> </span>The <span class="_ _3"></span>way <span class="_ _3"></span>this <span class="_ _2"></span>is <span class="_ _3"></span>handled <span class="_ _3"></span>without <span class="_ _2"></span>job <span class="_ _3"></span>control</div><div class="t m0 x32 h2a y2757 ff19 fsf fc0 sc0 ls0 ws0">is <span class="_ _9"></span>that <span class="_ _23"> </span>the <span class="_ _23"></span>shell <span class="_ _9"></span>automatically <span class="_ _23"> </span>redir<span class="_ _0"></span>ects <span class="_ _9"></span>the <span class="_ _23"> </span>standar<span class="lsb4a">di<span class="_ _b"></span><span class="ls0">nput <span class="_ _9"></span>of <span class="_ _9"></span>a <span class="_ _23"> </span>background <span class="_ _9"></span>process <span class="_ _9"></span>to</span></span></div><div class="t m0 x32 h26 y2758 ff1a fsf fc0 sc0 ls0 ws0">/dev/null<span class="ff19">,<span class="_ _54"> </span>if<span class="_ _65"> </span>the <span class="_ _4b"> </span>process <span class="_ _44"> </span>doesn’t <span class="_ _4b"> </span>redir<span class="_ _0"></span>ect <span class="_ _44"> </span>standar<span class="lsb4b">di<span class="_ _52"></span><span class="ls0">nput <span class="_ _44"> </span>itself.<span class="_ _93"> </span><span class="lsb4b">Ar<span class="_ _64"></span><span class="ls0">ead <span class="_ _4b"> </span>from</span></span></span></span></span></div><div class="t m0 x32 h26 y2759 ff1a fsf fc0 sc0 ls0 ws0">/dev/null<span class="_ _4b"> </span><span class="ff19">generates <span class="_ _53"> </span>an <span class="_ _e"> </span>end <span class="_ _e"> </span>of <span class="_ _e"> </span>ﬁle.<span class="_ _65"> </span>This <span class="_ _e"> </span>means <span class="_ _e"> </span>that <span class="_ _53"> </span>our <span class="_ _e"> </span>background<span class="_ _4b"> </span></span>cat<span class="_ _4b"> </span><span class="ff19">process</span></div><div class="t m0 x32 h2a y275a ff19 fsf fc0 sc0 ls0 ws0">immediately reads an end of ﬁle and terminates normally<span class="_ _4"></span>.</div><div class="t m0 x3f h2a y275b ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _66"> </span>previous <span class="_ _47"> </span>paragraph <span class="_ _66"> </span>adequately <span class="_ _47"> </span>handles <span class="_ _47"> </span>the <span class="_ _47"> </span>case <span class="_ _66"> </span>of <span class="_ _47"> </span>a <span class="_ _47"> </span>background <span class="_"> </span>process</div><div class="t m0 x32 h2a y275c ff19 fsf fc0 sc0 ls0 ws0">accessing <span class="_ _42"> </span>the <span class="_ _53"> </span>controlling <span class="_ _42"> </span>terminal <span class="_ _53"> </span>through <span class="_ _42"> </span>its <span class="_ _53"> </span>standar<span class="ls17b">di<span class="_ _55"></span><span class="ls0">nput, <span class="_ _53"> </span>but <span class="_ _53"> </span>what <span class="_ _53"> </span>happens <span class="_ _42"> </span>if <span class="_ _53"> </span>a</span></span></div><div class="t m0 x32 h26 y275d ff19 fsf fc0 sc0 ls0 ws0">background <span class="_ _45"> </span>process <span class="_ _45"> </span>speciﬁcally <span class="_ _35"> </span>opens<span class="_ _51"> </span><span class="ff1a">/dev/tty<span class="_ _51"> </span></span>and <span class="_ _35"> </span>r<span class="_ _0"></span>eads <span class="_ _35"> </span>fr<span class="_ _0"></span>om <span class="_ _35"> </span>the <span class="_ _45"> </span>controlling</div><div class="t m0 x32 h2a y275e ff19 fsf fc0 sc0 ls0 ws0">terminal? <span class="_"> </span>The<span class="_"> </span>answer <span class="_ _2"></span>is ‘‘It depends,’<span class="_ _1"></span><span class="lsb4c">’b<span class="_ _d"></span><span class="ls0">ut <span class="_ _2"></span>the result is probably not what <span class="_ _2"></span>we want.<span class="_ _46"> </span>For</span></span></div><div class="t m0 x32 h2a y275f ff19 fsf fc0 sc0 ls0 ws0">example,</div><div class="t m0 x3f h57 y2760 ff1a fs2d fc0 sc0 ls0 ws0">crypt &lt; salaries | lpr &amp;</div><div class="t m0 x32 h26 y2761 ff19 fsf fc0 sc0 ls0 ws0">is <span class="_ _47"> </span>such <span class="_ _47"> </span>a <span class="_ _45"> </span>pipeline.<span class="_ _50"> </span><span class="ls5f">We <span class="_ _46"> </span>r<span class="_ _9"></span></span>un <span class="_ _45"> </span>it <span class="_ _47"> </span>in <span class="_ _47"> </span>the <span class="_ _47"> </span>background, <span class="_ _47"> </span>but <span class="_ _47"> </span>the<span class="_ _5a"> </span><span class="ff1a">crypt<span class="_ _61"> </span></span>program <span class="_ _47"> </span>opens</div><div class="t m0 x32 h26 y2762 ff1a fsf fc0 sc0 ls0 ws0">/dev/tty<span class="ff19 lsb4d">,c<span class="_ _55"></span><span class="ls0">hanges <span class="_ _e"> </span>the <span class="_ _e"> </span>terminal <span class="_"> </span>characteristics <span class="_ _53"> </span>(to <span class="_"> </span>disable <span class="_ _53"> </span>echoing), <span class="_"> </span>r<span class="_ _0"></span>eads <span class="_ _e"> </span>from <span class="_ _53"> </span>the</span></span></div><div class="t m0 x32 h2a y2763 ff19 fsf fc0 sc0 ls0 ws0">device, <span class="_ _47"> </span>and <span class="_ _47"> </span>resets <span class="_ _47"> </span>the <span class="_ _47"> </span>terminal <span class="_ _47"> </span>characteristics.<span class="_ _5f"> </span>When <span class="_ _47"> </span>we <span class="_ _47"> </span>execute <span class="_ _45"> </span>this <span class="_ _66"> </span>background</div><div class="t m0 x32 h26 y2764 ff19 fsf fc0 sc0 ls0 ws0">pipeline, <span class="_ _9"></span>the <span class="_ _9"></span>prompt<span class="_ _47"> </span><span class="ff1a">Password:<span class="_ _45"> </span></span>from<span class="_ _47"> </span><span class="ff1a">crypt<span class="_ _45"> </span></span>is <span class="_ _9"></span>printed <span class="_ _9"></span>on <span class="_ _9"></span>the <span class="_ _9"></span>terminal, <span class="_ _9"></span>but <span class="_ _9"></span>what <span class="_ _9"></span>we</div><div class="t m0 x32 h2a y2765 ff19 fsf fc0 sc0 ls0 ws0">enter <span class="_ _3"></span>(the <span class="_ _3"></span>encryption <span class="_ _3"></span>password) <span class="_ _2"></span>is <span class="_ _3"></span>read <span class="_ _3"></span>by <span class="_ _3"></span>the <span class="_ _3"></span>shell, <span class="_ _3"></span>which <span class="_ _3"></span>tries <span class="_ _3"></span>to <span class="_ _3"></span>execute <span class="_ _3"></span>a <span class="_ _3"></span>command</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
