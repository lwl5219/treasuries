<div id="pf346" class="pf w4 h1f" data-page-no="346"><div class="pc pc346 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg346.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">804<span class="_ _1b"> </span><span class="ff19">Communicating <span class="_"> </span>with <span class="_"> </span>a <span class="_"> </span>Network <span class="_"> </span>Printer<span class="_ _23b"> </span>Chapter <span class="_"> </span>21</span></div><div class="t m0 x32 h57 y362 ff1a fs2d fc0 sc0 ls0 ws0">64 <span class="_ _d9"> </span>/*</div><div class="t m0 x32 h57 y3c0 ff1a fs2d fc0 sc0 ls0 ws0">65 <span class="_ _68"> </span>*<span class="_"> </span>Return the host name running the print server or NULL on error.</div><div class="t m0 x32 h57 y845 ff1a fs2d fc0 sc0 ls0 ws0">66 <span class="_ _68"> </span>*</div><div class="t m0 x32 h57 y56c4 ff1a fs2d fc0 sc0 ls0 ws0">67 <span class="_ _68"> </span>*<span class="_"> </span>LOCKING: none.</div><div class="t m0 x32 h57 y56c5 ff1a fs2d fc0 sc0 ls0 ws0">68 <span class="_ _68"> </span>*/</div><div class="t m0 x32 h57 y56c6 ff1a fs2d fc0 sc0 ls0 ws0">69 <span class="_ _d9"> </span>char<span class="_"> </span>*</div><div class="t m0 x32 h57 y56c7 ff1a fs2d fc0 sc0 ls0 ws0">70 <span class="_ _d9"> </span>get_printserver(void)</div><div class="t m0 x32 h57 y56c8 ff1a fs2d fc0 sc0 ls0 ws0">71 <span class="_ _d9"> </span>{</div><div class="t m0 x32 h57 y56c9 ff1a fs2d fc0 sc0 ls0 ws0">72 <span class="_ _8a"> </span>return(scan_configfile(&quot;printserver&quot;));</div><div class="t m0 x32 h57 y56ca ff1a fs2d fc0 sc0 ls0 ws0">73 <span class="_ _d9"> </span>}</div><div class="t m0 x32 h57 y1d7e ff1a fs2d fc0 sc0 ls0 ws0">74 <span class="_ _d9"> </span>/*</div><div class="t m0 x32 h57 y1d7f ff1a fs2d fc0 sc0 ls0 ws0">75 <span class="_ _68"> </span>*<span class="_"> </span>Return the address of the network printer or NULL on error.</div><div class="t m0 x32 h57 y1d80 ff1a fs2d fc0 sc0 ls0 ws0">76 <span class="_ _68"> </span>*</div><div class="t m0 x32 h57 y2c5b ff1a fs2d fc0 sc0 ls0 ws0">77 <span class="_ _68"> </span>*<span class="_"> </span>LOCKING: none.</div><div class="t m0 x32 h57 y2c5c ff1a fs2d fc0 sc0 ls0 ws0">78 <span class="_ _68"> </span>*/</div><div class="t m0 x32 h57 y2c5d ff1a fs2d fc0 sc0 ls0 ws0">79 <span class="_ _d9"> </span>struct<span class="_"> </span>addrinfo *</div><div class="t m0 x32 h57 y2c5e ff1a fs2d fc0 sc0 ls0 ws0">80 <span class="_ _d9"> </span>get_printaddr(void)</div><div class="t m0 x32 h57 y2c5f ff1a fs2d fc0 sc0 ls0 ws0">81 <span class="_ _d9"> </span>{</div><div class="t m0 x32 h57 y2c60 ff1a fs2d fc0 sc0 ls0 ws0">82 <span class="_ _8a"> </span>int<span class="_ _166"> </span>err;</div><div class="t m0 x32 h57 y2c61 ff1a fs2d fc0 sc0 ls0 ws0">83 <span class="_ _8a"> </span>char<span class="_ _82"> </span>*p;</div><div class="t m0 x32 h57 y2c62 ff1a fs2d fc0 sc0 ls0 ws0">84 <span class="_ _8a"> </span>struct<span class="_"> </span>addrinfo *ailist;</div><div class="t m0 x32 h57 y4d72 ff1a fs2d fc0 sc0 ls0 ws0">85 <span class="_ _8a"> </span>if<span class="_"> </span>((p = scan_configfile(&quot;printer&quot;)) != NULL) {</div><div class="t m0 x32 h57 y4d73 ff1a fs2d fc0 sc0 ls0 ws0">86 <span class="_ _176"> </span>if<span class="_"> </span>((err = getaddrlist(p, &quot;ipp&quot;, &amp;ailist)) != 0) {</div><div class="t m0 x32 h57 y2c64 ff1a fs2d fc0 sc0 ls0 ws0">87 <span class="_ _166"> </span>log_msg(&quot;no<span class="_"> </span>address information for %s&quot;, p);</div><div class="t m0 x32 h57 y2c65 ff1a fs2d fc0 sc0 ls0 ws0">88 <span class="_ _166"> </span>return(NULL);</div><div class="t m0 x32 h57 y4d74 ff1a fs2d fc0 sc0 ls0 ws0">89 <span class="_ _176"> </span>}</div><div class="t m0 x32 h57 y5abe ff1a fs2d fc0 sc0 ls0 ws0">90 <span class="_ _176"> </span>return(ailist);</div><div class="t m0 x32 h57 y5abf ff1a fs2d fc0 sc0 ls0 ws0">91 <span class="_ _8a"> </span>}</div><div class="t m0 x32 h57 y5ac0 ff1a fs2d fc0 sc0 ls0 ws0">92 <span class="_ _8a"> </span>log_msg(&quot;no<span class="_"> </span>printer address specified&quot;);</div><div class="t m0 x32 h57 y3b50 ff1a fs2d fc0 sc0 ls0 ws0">93 <span class="_ _8a"> </span>return(NULL);</div><div class="t m0 x32 h57 y3b51 ff1a fs2d fc0 sc0 ls0 ws0">94 <span class="_ _d9"> </span>}</div><div class="t m0 x32 h4d y5ac1 ff19 fs26 fc0 sc0 ls0 ws0">[64 <span class="_ _a"></span>– <span class="_ _a"></span>73]<span class="_ _65"> </span>The<span class="_ _16"> </span><span class="ff1a">get_printserver<span class="_"> </span></span>function <span class="_ _47"> </span>is <span class="_ _45"> </span>simply <span class="_ _47"> </span>a <span class="_ _45"> </span>wrapper <span class="_ _45"> </span>function <span class="_ _47"> </span>that <span class="_ _45"> </span>calls</div><div class="t m0 x2d h4d y5ac2 ff1a fs26 fc0 sc0 ls0 ws0">scan_configfile<span class="_ _16"> </span><span class="ff19">to <span class="_ _45"> </span>ﬁnd <span class="_ _47"> </span>the <span class="_ _45"> </span>name <span class="_ _45"> </span>of <span class="_ _47"> </span>the <span class="_ _45"> </span>computer <span class="_ _47"> </span>system <span class="_ _45"> </span>wher<span class="lsd3d">et<span class="_ _26"></span><span class="ls0">he</span></span></span></div><div class="t m0 x2d h49 y5ac3 ff19 fs26 fc0 sc0 ls0 ws0">printer spooling daemon is running.</div><div class="t m0 x32 h4d y5ac4 ff19 fs26 fc0 sc0 ls0 ws0">[74 <span class="_ _a"></span>– <span class="_ _a"></span>94]<span class="_ _65"> </span><span class="ls164">We <span class="_ _59"> </span>u<span class="_ _23"></span></span>se <span class="_ _47"> </span>the<span class="_ _16"> </span><span class="ff1a">get_printaddr<span class="_ _16"> </span></span>function <span class="_ _45"> </span>to <span class="_ _47"> </span>get <span class="_ _47"> </span>the <span class="_ _45"> </span>addr<span class="_ _0"></span>ess <span class="_ _47"> </span>of <span class="_ _47"> </span>the <span class="_ _45"> </span>network</div><div class="t m0 x2d h49 y5ac5 ff19 fs26 fc0 sc0 ls0 ws0">printer<span class="_ _6"></span><span class="ls174f">.I<span class="_ _52"></span><span class="ls0">t<span class="_ _44"> </span>is<span class="_ _4b"> </span>similar <span class="_ _53"> </span>to <span class="_ _53"> </span>the <span class="_ _53"> </span>previous <span class="_ _53"> </span>function <span class="_ _53"> </span>except <span class="_ _53"> </span>that <span class="_ _53"> </span>when <span class="_ _53"> </span>we <span class="_ _53"> </span>ﬁnd <span class="_ _e"> </span>the</span></span></div><div class="t m0 x2d h49 y5ac6 ff19 fs26 fc0 sc0 ls0 ws0">name <span class="_"> </span>of <span class="_ _53"> </span>the <span class="_"> </span>printer <span class="_ _e"> </span>in <span class="_"> </span>the <span class="_ _e"> </span>conﬁguration <span class="_"> </span>ﬁle, <span class="_ _e"> </span>we <span class="_"> </span>use <span class="_ _53"> </span>the <span class="_"> </span>name <span class="_ _e"> </span>to <span class="_"> </span>ﬁnd <span class="_ _e"> </span>the</div><div class="t m0 x2d h49 y5ac7 ff19 fs26 fc0 sc0 ls0 ws0">corresponding network addr<span class="_ _0"></span>ess.</div><div class="t m0 x2d h4d y5ac8 ff19 fs26 fc0 sc0 ls0 ws0">Both<span class="_ _47"> </span><span class="ff1a">get_printserver<span class="_ _47"> </span></span>and<span class="_ _47"> </span><span class="ff1a">get_printaddr<span class="_ _47"> </span></span>call<span class="_ _47"> </span><span class="ff1a">scan_configfile</span><span class="ls1750">.I<span class="_ _5b"></span><span class="ls6fe">fi<span class="_ _8"></span><span class="ls0">t</span></span></span></div><div class="t m0 x2d h4d y5ac9 ff19 fs26 fc0 sc0 ls0 ws0">can’t <span class="_ _2"></span>open <span class="_ _2"></span>the <span class="_ _3"></span>printer <span class="_ _2"></span>conﬁguration <span class="_ _3"></span>ﬁle,<span class="_ _66"> </span><span class="ff1a">scan_configfile<span class="_ _47"> </span></span>calls<span class="_ _47"> </span><span class="ff1a">log_sys<span class="_ _66"> </span></span>to</div><div class="t m0 x2d h4d y5aca ff19 fs26 fc0 sc0 ls0 ws0">print <span class="_ _3"></span>an <span class="_ _3"></span>error <span class="_ _2"></span>message <span class="_ _3"></span>and <span class="_ _3"></span>exit.<span class="_ _16"> </span>Although<span class="_ _47"> </span><span class="ff1a">get_printserver<span class="_ _47"> </span></span>is <span class="_ _3"></span>meant <span class="_ _3"></span>to <span class="_ _3"></span>be</div><div class="t m0 x2d h4d y5acb ff19 fs26 fc0 sc0 ls0 ws0">called from a <span class="_ _2"></span>client <span class="_ _2"></span>command <span class="_ _2"></span>and<span class="_ _66"> </span><span class="ff1a">get_printaddr<span class="_ _66"> </span></span>is <span class="_ _2"></span>meant <span class="_ _2"></span>to be <span class="_ _2"></span>called <span class="_ _2"></span>from</div><div class="t m0 x2d h4d y5acc ff19 fs26 fc0 sc0 ls0 ws0">the <span class="_ _3"></span>daemon, <span class="_ _3"></span>having <span class="_ _9"></span>both <span class="_ _3"></span>call<span class="_ _45"> </span><span class="ff1a">log_sys<span class="_ _47"> </span></span>is <span class="_ _3"></span>OK, <span class="_ _9"></span>because <span class="_ _3"></span>we <span class="_ _3"></span>can <span class="_ _9"></span>arrange <span class="_ _3"></span>for <span class="_ _3"></span>the</div><div class="t m0 x2d h49 y5acd ff19 fs26 fc0 sc0 ls0 ws0">log functions <span class="_ _2"></span>to <span class="_ _2"></span>print <span class="_ _2"></span>to the <span class="_ _2"></span>standar<span class="ls1751">de<span class="_ _4f"></span><span class="ls0">rror instead <span class="_ _2"></span>of <span class="_ _2"></span>to the <span class="_ _2"></span>log <span class="_ _2"></span>ﬁle <span class="_ _2"></span>by setting <span class="_ _2"></span>a</span></span></div><div class="t m0 x2d h49 y5ace ff19 fs26 fc0 sc0 ls0 ws0">global variable.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
