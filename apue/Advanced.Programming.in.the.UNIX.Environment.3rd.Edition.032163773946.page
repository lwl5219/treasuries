<div id="pf2e" class="pf w4 h1f" data-page-no="2e"><div class="pc pc2e w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg2e.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">12<span class="_ _1b"> </span><span class="ff19">UNIX <span class="_"> </span>System <span class="_"> </span>Overview<span class="_ _85"> </span>Chapter <span class="_"> </span>1</span></div><div class="t m0 x32 h57 y362 ff1a fs2d fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h57 y3c0 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;sys/wait.h&gt;</div><div class="t m0 x32 h57 y3c1 ff1a fs2d fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h57 y3c2 ff1a fs2d fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 x32 h57 y3c3 ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y3c4 ff1a fs2d fc0 sc0 ls0 ws0">char <span class="_ _68"> </span>buf[MAXLINE];<span class="_ _87"> </span>/* from apue.h */</div><div class="t m0 x8a h57 y3c5 ff1a fs2d fc0 sc0 ls0 ws0">pid_t <span class="_ _3a"> </span>pid;</div><div class="t m0 x8a h57 y3c6 ff1a fs2d fc0 sc0 ls0 ws0">int <span class="_ _15"> </span>status;</div><div class="t m0 x8a h57 y3c7 ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;%% &quot;);<span class="_ _3a"> </span>/* print prompt (printf requires %% to print %) */</div><div class="t m0 x8a h57 y3c8 ff1a fs2d fc0 sc0 ls0 ws0">while (fgets(buf, MAXLINE, stdin) != NULL) {</div><div class="t m0 x9d h57 y3c9 ff1a fs2d fc0 sc0 ls0 ws0">if (buf[strlen(buf) - 1] == ’\n’)</div><div class="t m0 x1f h57 y3ca ff1a fs2d fc0 sc0 ls0 ws0">buf[strlen(buf) - 1] = 0; /* replace newline with null */</div><div class="t m0 x9d h57 y3cb ff1a fs2d fc0 sc0 ls0 ws0">if ((pid = fork()) &lt; 0) {</div><div class="t m0 x1f h57 y3cc ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;fork error&quot;);</div><div class="t m0 x9d h57 y3cd ff1a fs2d fc0 sc0 ls15c ws0">}e<span class="_ _1d"></span><span class="ls0">lse if (pid == 0) {<span class="_ _88"> </span>/* child */</span></div><div class="t m0 x1f h57 y3ce ff1a fs2d fc0 sc0 ls0 ws0">execlp(buf, buf, (char *)0);</div><div class="t m0 x1f h57 y3cf ff1a fs2d fc0 sc0 ls0 ws0">err_ret(&quot;couldn’t execute: %s&quot;, buf);</div><div class="t m0 x1f h57 y3d0 ff1a fs2d fc0 sc0 ls0 ws0">exit(127);</div><div class="t m0 x9d h57 y3d1 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x9d h57 y3d2 ff1a fs2d fc0 sc0 ls0 ws0">/* parent */</div><div class="t m0 x9d h57 y3d3 ff1a fs2d fc0 sc0 ls0 ws0">if ((pid = waitpid(pid, &amp;status, 0)) &lt; 0)</div><div class="t m0 x1f h57 y3d4 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;waitpid error&quot;);</div><div class="t m0 x9d h57 y3d5 ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;%% &quot;);</div><div class="t m0 x8a h57 y3d6 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y3d7 ff1a fs2d fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h57 y3d8 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 xae h2d y3d9 ff18 fs10 fc0 sc0 ls0 ws0">Figure 1.7<span class="_ _5a"> </span><span class="ff19">Read commands from standar<span class="ls136">di<span class="_ _5"></span><span class="ls0">nput and execute them</span></span></span></div><div class="t m0 x32 h49 y3da ff19 fs26 fc0 sc0 ls0 ws0">Ther<span class="lsd3">ea<span class="_ _4f"></span><span class="lscc">re <span class="_ _3"></span>s<span class="ls0">everal features to consider in this 30</span></span></span></div><div class="t m0 xaf h49 y3db ff19 fs26 fc0 sc0 ls0 ws0">-</div><div class="t m0 x78 h49 y3da ff19 fs26 fc0 sc0 ls0 ws0">line program.</div><div class="t m0 x3f h4d y3dc ff19 fs26 fc0 sc0 ls15d ws0">•W<span class="_ _4e"></span><span class="ls15e">eu<span class="_ _43"></span><span class="ls0">se <span class="_ _42"> </span>the <span class="_ _42"> </span>standar<span class="ls15e">dI<span class="_ _c"></span><span class="ls0">/O <span class="_ _53"> </span>function<span class="_ _44"> </span><span class="ff1a">fgets<span class="_ _35"> </span></span>to <span class="_ _53"> </span>read <span class="_ _23"> </span>one <span class="_ _53"> </span>line <span class="_ _42"> </span>at <span class="_ _42"> </span>a <span class="_ _42"> </span>time <span class="_ _53"> </span>from <span class="_ _23"> </span>the</span></span></span></span></div><div class="t m0 x15 h49 y3dd ff19 fs26 fc0 sc0 ls0 ws0">standar<span class="ls15f">di<span class="_ _64"></span><span class="ls0">nput. <span class="_ _65"> </span>When<span class="_ _65"> </span>we <span class="_ _4b"> </span>type <span class="_ _44"> </span>the <span class="_ _4b"> </span>end-of-ﬁle <span class="_ _4b"> </span>character <span class="_ _44"> </span>(which <span class="_ _4b"> </span>is <span class="_ _4b"> </span>often</span></span></div><div class="t m0 x15 h49 y3de ff19 fs26 fc0 sc0 ls0 ws0">Control</div><div class="t m0 xb0 h49 y3df ff19 fs26 fc0 sc0 ls0 ws0">-</div><div class="t m0 xb1 h4d y3de ff19 fs26 fc0 sc0 ls0 ws0">D) <span class="_ _3"></span>as <span class="_ _3"></span>the <span class="_ _3"></span>ﬁrst <span class="_ _3"></span>character <span class="_ _3"></span>of <span class="_ _3"></span>a <span class="_ _3"></span>line,<span class="_ _47"> </span><span class="ff1a">fgets<span class="_ _45"> </span></span><span class="lscc">re</span>turns <span class="_ _3"></span>a <span class="_ _3"></span>null <span class="_ _3"></span>pointer<span class="_ _1"></span><span class="ls160">,t<span class="_ _8"></span><span class="ls0">he <span class="_ _3"></span>loop</span></span></div><div class="t m0 x15 h49 y3e0 ff19 fs26 fc0 sc0 ls0 ws0">stops, <span class="_ _53"> </span>and <span class="_ _e"> </span>the <span class="_ _53"> </span>process <span class="_ _53"> </span>terminates.<span class="_ _65"> </span>In <span class="_ _e"> </span>Chapter <span class="_ _53"> </span>18, <span class="_ _e"> </span>we <span class="_ _53"> </span>describe <span class="_ _e"> </span>all <span class="_ _53"> </span>the <span class="_ _e"> </span>special</div><div class="t m0 x15 h49 y3e1 ff19 fs26 fc0 sc0 ls0 ws0">terminal <span class="_ _9"></span>characters<span class="_ _9"></span><span class="ls161">—e<span class="_ _6"></span><span class="ls0">nd <span class="_ _9"></span>of <span class="_ _9"></span>ﬁle, <span class="_ _23"></span>backspace <span class="_ _9"></span>one <span class="_ _9"></span>character<span class="_ _6"></span><span class="ls162">,e<span class="_ _b"></span><span class="ls0">rase <span class="_ _23"></span>entir<span class="_ _0"></span><span class="ls162">el<span class="_ _b"></span><span class="ls0">ine, <span class="_ _9"></span>and</span></span></span></span></span></span></div><div class="t m0 x15 h49 y3e2 ff19 fs26 fc0 sc0 ls0 ws0">so on<span class="_ _9"></span><span class="ls161">—a<span class="_ _6"></span><span class="ls0">nd how to change them.</span></span></div><div class="t m0 x3f h4d y3e3 ff19 fs26 fc0 sc0 ls15d ws0">•B<span class="_ _4d"></span><span class="ls0">ecause <span class="_ _42"> </span>each <span class="_ _53"> </span>line <span class="_ _53"> </span>returned <span class="_ _42"> </span>by<span class="_ _44"> </span><span class="ff1a">fgets<span class="_ _4b"> </span></span>is <span class="_ _42"> </span>terminated <span class="_ _53"> </span>with <span class="_ _53"> </span>a <span class="_ _42"> </span>newline <span class="_ _53"> </span>character<span class="_ _1"></span>,</span></div><div class="t m0 x15 h4d y3e4 ff19 fs26 fc0 sc0 ls0 ws0">followed <span class="_ _2"></span>by <span class="_ _2"></span>a <span class="_ _2"></span>null <span class="_ _2"></span>byte, <span class="_ _3"></span>we <span class="_ _2"></span>use <span class="_ _2"></span>the <span class="_ _2"></span>standar<span class="ls163">dCf<span class="_ _4f"></span><span class="ls0">unction<span class="_ _66"> </span><span class="ff1a">strlen<span class="_ _47"> </span></span>to <span class="_ _2"></span>calculate <span class="_ _2"></span>the</span></span></div><div class="t m0 x15 h49 y3e5 ff19 fs26 fc0 sc0 ls0 ws0">length <span class="_ _9"></span>of <span class="_ _9"></span>the <span class="_ _23"></span>string, <span class="_ _9"></span>and <span class="_ _9"></span>then <span class="_ _23"></span>r<span class="_ _0"></span>eplace <span class="_ _9"></span>the <span class="_ _9"></span>newline <span class="_ _23"></span>with <span class="_ _9"></span>a <span class="_ _9"></span>null <span class="_ _23"></span>byte.<span class="_ _5a"> </span><span class="ls164">We <span class="_ _66"> </span>d<span class="_ _9"></span><span class="ls165">ot<span class="_ _b"></span><span class="ls0">his</span></span></span></div><div class="t m0 x15 h4d y3e6 ff19 fs26 fc0 sc0 ls0 ws0">because <span class="_ _46"> </span>the<span class="_ _50"> </span><span class="ff1a">execlp<span class="_ _60"> </span></span>function <span class="_ _46"> </span>wants <span class="_ _61"> </span>a <span class="_ _46"> </span>null-terminated <span class="_ _61"> </span>argument, <span class="_ _59"> </span>not <span class="_ _61"> </span>a</div><div class="t m0 x15 h49 y3e7 ff19 fs26 fc0 sc0 ls0 ws0">newline-terminated argument.</div><div class="t m0 x3f h4d y3e8 ff19 fs26 fc0 sc0 ls15d ws0">•W<span class="_ _4e"></span><span class="ls160">ec<span class="_ _4f"></span><span class="ls0">all<span class="_ _47"> </span><span class="ff1a">fork<span class="_ _47"> </span></span>to <span class="_ _3"></span>create <span class="_ _3"></span>a <span class="_ _3"></span>new <span class="_ _3"></span>process, <span class="_ _2"></span>which <span class="_ _3"></span>is <span class="_ _3"></span>a <span class="_ _3"></span>copy <span class="_ _3"></span>of <span class="_ _9"></span>the <span class="_ _2"></span>caller<span class="_ _1"></span><span class="ls166">.W<span class="_ _7"></span><span class="ls167">es<span class="_ _8"></span><span class="ls0">ay <span class="_ _3"></span>that</span></span></span></span></span></div><div class="t m0 x15 h49 y3e9 ff19 fs26 fc0 sc0 ls0 ws0">the <span class="_ _42"> </span>caller <span class="_ _42"> </span>is <span class="_ _53"> </span>the <span class="_ _42"> </span>parent <span class="_ _42"> </span>and <span class="_ _42"> </span>that <span class="_ _53"> </span>the <span class="_ _42"> </span>newly <span class="_ _53"> </span>created <span class="_ _42"> </span>process <span class="_ _23"> </span>is <span class="_ _53"> </span>the <span class="_ _42"> </span>child.<span class="_ _54"> </span>Then</div><div class="t m0 x15 h4d y3ea ff1a fs26 fc0 sc0 ls0 ws0">fork<span class="_ _66"> </span><span class="ff19 lscc">re<span class="ls0">turns <span class="_ _2"></span>the non-negative <span class="_ _2"></span>process ID <span class="_ _2"></span>of the <span class="_ _2"></span>new child <span class="_ _2"></span>process to <span class="_ _2"></span>the parent,</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
