<div id="pf26d" class="pf w4 h1f" data-page-no="26d"><div class="pc pc26d w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg26d.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Chapter <span class="_"> </span>15<span class="_ _183"> </span>Exercises<span class="_ _1fb"> </span><span class="ff18">587</span></div><div class="t m0 x3f h26 y12f ff19 fsf fc0 sc0 ls5f ws0">To <span class="_ _47"> </span>u<span class="_ _9"></span><span class="ls0">se <span class="_ _23"></span>this <span class="_ _23"></span>technique <span class="_ _23"></span>with <span class="_ _23"></span>XSI <span class="_ _9"></span>IPC, <span class="_ _23"> </span>recall <span class="_ _23"></span>that <span class="_ _9"></span>the<span class="_ _35"> </span><span class="ff1a">ipc_perm<span class="_ _35"> </span></span>structur<span class="_ _0"></span><span class="ls12cf">ea<span class="_ _43"></span><span class="ls0">ssociated</span></span></span></div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">with <span class="_ _47"> </span>each <span class="_ _47"> </span>message <span class="_ _47"> </span>queue, <span class="_ _47"> </span>semaphore, <span class="_ _47"> </span>and <span class="_ _47"> </span>shared <span class="_ _66"> </span>memory <span class="_ _47"> </span>segment <span class="_ _47"> </span>identiﬁes <span class="_ _47"> </span>the</div><div class="t m0 x32 h26 y131 ff19 fsf fc0 sc0 ls0 ws0">creator <span class="_ _23"> </span>of <span class="_ _53"> </span>the <span class="_ _42"> </span>IPC <span class="_ _42"> </span>structur<span class="ls12d0">e(<span class="_ _c"></span><span class="ls0">the<span class="_ _44"> </span><span class="ff1a">cuid<span class="_ _44"> </span></span>and<span class="_ _44"> </span><span class="ff1a">cgid<span class="_ _44"> </span></span>ﬁelds). <span class="_ _44"> </span>As<span class="_ _44"> </span>with <span class="_ _42"> </span>the <span class="_ _42"> </span>example <span class="_ _42"> </span>using</span></span></div><div class="t m0 x32 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">FIFOs, the server should requir<span class="ls12d1">et<span class="_ _4f"></span><span class="ls0">he client <span class="_ _2"></span>to create the IPC structur<span class="lsd7c">ea<span class="_ _4f"></span><span class="ls0">nd have <span class="_ _2"></span>the client</span></span></span></span></div><div class="t m0 x32 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">set <span class="_ _9"></span>the <span class="_ _9"></span>access <span class="_ _9"></span>permissions <span class="_ _9"></span>to <span class="_ _9"></span>user-r<span class="_ _0"></span>ead <span class="_ _9"></span>and <span class="_ _9"></span>user-write <span class="_ _3"></span>only<span class="_ _6"></span><span class="ls12d2">.T<span class="_ _26"></span><span class="ls0">he <span class="_ _23"></span>times <span class="_ _3"></span>associated <span class="_ _9"></span>with</span></span></div><div class="t m0 x32 h2a y134 ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _42"> </span>IPC <span class="_ _53"> </span>structur<span class="ls12d3">es<span class="_ _c"></span><span class="ls0">hould <span class="_ _53"> </span>also <span class="_ _42"> </span>be <span class="_ _53"> </span>veriﬁed <span class="_ _53"> </span>by <span class="_ _53"> </span>the <span class="_ _53"> </span>server <span class="_ _53"> </span>to <span class="_ _53"> </span>be <span class="_ _42"> </span>recent <span class="_ _53"> </span>(since <span class="_ _53"> </span>these <span class="_ _42"> </span>IPC</span></span></div><div class="t m0 x32 h2a y135 ff19 fsf fc0 sc0 ls0 ws0">structur<span class="_ _0"></span>es hang around until explicitly deleted).</div><div class="t m0 x3f h2a y136 ff19 fsf fc0 sc0 ls5f ws0">We<span class="_ _9"></span><span class="ls0">’ll <span class="_ _3"></span>see <span class="_ _9"></span>in <span class="_ _3"></span>Section <span class="_ _3"></span>17.3 <span class="_ _9"></span>that <span class="_ _3"></span>a <span class="_ _3"></span>far <span class="_ _9"></span>better <span class="_ _3"></span>way <span class="_ _3"></span>of <span class="_ _9"></span>doing <span class="_ _3"></span>this <span class="_ _3"></span>authentication <span class="_ _9"></span>is <span class="_ _3"></span>for <span class="_ _3"></span>the</span></div><div class="t m0 x32 h2a y137 ff19 fsf fc0 sc0 ls0 ws0">kernel <span class="_ _2"></span>to <span class="_ _2"></span>provide <span class="_ _2"></span>the <span class="_ _2"></span>effective <span class="_ _2"></span>user <span class="_ _2"></span>ID <span class="_ _2"></span>and <span class="_ _2"></span>effective <span class="_ _2"></span>group <span class="_ _2"></span>ID <span class="_ _2"></span>of <span class="_ _2"></span>the <span class="_ _3"></span>client.<span class="_ _61"> </span>This <span class="_ _2"></span>is <span class="_ _2"></span>done</div><div class="t m0 x32 h2a y138 ff19 fsf fc0 sc0 ls0 ws0">by the socket subsystem when ﬁle descriptors ar<span class="ls44">ep<span class="_ _4f"></span><span class="ls0">assed between processes.</span></span></div><div class="t m0 x35 h53 y68e ff16 fs2b fc0 sc0 ls0 ws0">15.12 <span class="_ _66"> </span>Summary</div><div class="t m0 x32 h2a y467e ff19 fsf fc0 sc0 ls5f ws0">We<span class="_ _9"></span><span class="ls0">’ve <span class="_ _e"> </span>detailed <span class="_ _e"> </span>numerous <span class="_ _53"> </span>forms <span class="_"> </span>of <span class="_ _53"> </span>interprocess <span class="_ _53"> </span>communication: <span class="_ _e"> </span>pipes, <span class="_ _e"> </span>named <span class="_ _e"> </span>pipes</span></div><div class="t m0 x32 h2a y467f ff19 fsf fc0 sc0 ls0 ws0">(FIFOs), the three forms <span class="_ _2"></span>of IPC commonly <span class="_ _2"></span>called XSI <span class="_ _2"></span>IPC (message queues, <span class="_ _2"></span>semaphores,</div><div class="t m0 x32 h2a y4680 ff19 fsf fc0 sc0 ls0 ws0">and <span class="_ _42"> </span>shared <span class="_ _42"> </span>memory), <span class="_ _53"> </span>and <span class="_ _42"> </span>an <span class="_ _53"> </span>alternative <span class="_ _53"> </span>semaphor<span class="ls4f8">em<span class="_ _c"></span><span class="ls0">echanism <span class="_ _42"> </span>provided <span class="_ _42"> </span>by <span class="_ _53"> </span>POSIX.</span></span></div><div class="t m0 x32 h2a y4681 ff19 fsf fc0 sc0 ls0 ws0">Semaphores <span class="_ _3"></span>ar<span class="ls12d4">er<span class="_ _b"></span><span class="ls0">eally <span class="_ _3"></span>a <span class="_ _9"></span>synchronization <span class="_ _3"></span>primitive, <span class="_ _9"></span>not <span class="_ _9"></span>true <span class="_ _9"></span>IPC, <span class="_ _9"></span>and <span class="_ _9"></span>ar<span class="ls16a">eo<span class="_ _b"></span><span class="ls0">ften <span class="_ _3"></span>used <span class="_ _9"></span>to</span></span></span></span></div><div class="t m0 x32 h2a y4682 ff19 fsf fc0 sc0 ls0 ws0">synchronize access to a <span class="_ _2"></span>shared r<span class="_ _0"></span>esource, such as a shared memory <span class="_ _2"></span>segment.<span class="_ _46"> </span><span class="ls65">Wi<span class="_ _3"></span></span>th pipes,</div><div class="t m0 x32 h26 y4683 ff19 fsf fc0 sc0 ls0 ws0">we <span class="_ _e"> </span>looked <span class="_ _e"> </span>at <span class="_ _e"> </span>the <span class="_"> </span>implementation <span class="_ _53"> </span>of <span class="_ _e"> </span>the<span class="_ _59"> </span><span class="ff1a">popen<span class="_ _4b"> </span></span>function, <span class="_ _e"> </span>at <span class="_"> </span>copr<span class="_ _1"></span>ocesses, <span class="_"> </span>and <span class="_ _53"> </span>at <span class="_ _e"> </span>the</div><div class="t m0 x32 h2a y4684 ff19 fsf fc0 sc0 ls0 ws0">pitfalls that can be encountered with the standar<span class="_ _0"></span><span class="ls44">dI<span class="_ _d"></span><span class="ls0">/O library’s buffering.</span></span></div><div class="t m0 x3f h2a y4685 ff19 fsf fc0 sc0 ls0 ws0">After <span class="_ _45"> </span>comparing <span class="_ _47"> </span>the <span class="_ _45"> </span>timing <span class="_ _45"> </span>of <span class="_ _45"> </span>message <span class="_ _45"> </span>queues <span class="_ _45"> </span>versus <span class="_ _47"> </span>full-duplex <span class="_ _45"> </span>pipes, <span class="_ _45"> </span>and</div><div class="t m0 x32 h2a y4686 ff19 fsf fc0 sc0 ls0 ws0">semaphores <span class="_ _2"></span>versus <span class="_ _3"></span>recor<span class="lsd59">dl<span class="_ _b"></span><span class="ls0">ocking, <span class="_ _3"></span>we <span class="_ _9"></span>can <span class="_ _3"></span>make <span class="_ _3"></span>the <span class="_ _3"></span>following <span class="_ _9"></span>recommendations: <span class="_ _2"></span>learn</span></span></div><div class="t m0 x32 h2a y4687 ff19 fsf fc0 sc0 ls0 ws0">pipes <span class="_ _47"> </span>and <span class="_ _66"> </span>FIFOs, <span class="_ _47"> </span>since <span class="_ _47"> </span>these <span class="_ _47"> </span>two <span class="_ _47"> </span>basic <span class="_ _47"> </span>techniques <span class="_ _47"> </span>can <span class="_ _66"> </span>still <span class="_ _47"> </span>be <span class="_ _47"> </span>used <span class="_ _47"> </span>effectively <span class="_ _66"> </span>in</div><div class="t m0 x32 h2a y4688 ff19 fsf fc0 sc0 ls0 ws0">numerous <span class="_"> </span>applications.<span class="_ _60"> </span><span class="ls5f">Av<span class="_ _9"></span></span>oid <span class="_ _66"> </span>using <span class="_ _47"> </span>message <span class="_"> </span>queues <span class="_"> </span>and <span class="_ _66"> </span>semaphores <span class="_"> </span>in <span class="_ _66"> </span>any <span class="_ _66"> </span>new</div><div class="t m0 x32 h2a y4689 ff19 fsf fc0 sc0 ls0 ws0">applications. <span class="_ _4b"> </span>Full-duplex<span class="_ _44"> </span>pipes <span class="_ _e"> </span>and <span class="_ _53"> </span>recor<span class="ls12d5">dl<span class="_ _55"></span><span class="ls0">ocking <span class="_ _53"> </span>should <span class="_ _e"> </span>be <span class="_ _53"> </span>considered <span class="_ _53"> </span>instead, <span class="_ _53"> </span>as</span></span></div><div class="t m0 x32 h2a y468a ff19 fsf fc0 sc0 ls0 ws0">they <span class="_ _9"></span>ar<span class="ls599">ef<span class="_ _b"></span><span class="ls0">ar <span class="_ _9"></span>simpler<span class="_ _1"></span><span class="ls12d6">.S<span class="_ _26"></span><span class="ls0">hared <span class="_ _9"></span>memory <span class="_ _23"></span>still <span class="_ _9"></span>has <span class="_ _23"></span>its <span class="_ _9"></span>use, <span class="_ _23"> </span>although <span class="_ _23"></span>the <span class="_ _9"></span>same <span class="_ _23"></span>functionality</span></span></span></span></div><div class="t m0 x32 h26 y468b ff19 fsf fc0 sc0 ls0 ws0">can be provided thr<span class="_ _0"></span>ough the use of the<span class="_"> </span><span class="ff1a">mmap<span class="_ _80"> </span></span>function (Section 14.8).</div><div class="t m0 x3f h2a y468c ff19 fsf fc0 sc0 ls0 ws0">In <span class="_ _53"> </span>the <span class="_ _e"> </span>next <span class="_ _e"> </span>chapter<span class="_ _1"></span>,<span class="_ _4b"> </span>we<span class="_ _4b"> </span>will <span class="_ _53"> </span>look <span class="_ _e"> </span>at <span class="_ _e"> </span>network <span class="_ _e"> </span>IPC, <span class="_ _53"> </span>which <span class="_ _e"> </span>can <span class="_ _e"> </span>allow <span class="_ _e"> </span>processes <span class="_ _53"> </span>to</div><div class="t m0 x32 h2a y468d ff19 fsf fc0 sc0 ls0 ws0">communicate across machine boundaries.</div><div class="t m0 x32 h53 y468e ff16 fs2b fc0 sc0 ls0 ws0">Exer<span class="_ _0"></span>cises</div><div class="t m0 x32 h57 y468f ff18 fs2d fc0 sc0 ls0 ws0">15.1<span class="_ _288"> </span><span class="ff19">In <span class="_ _9"></span>the <span class="_ _9"></span>program <span class="_ _3"></span>shown <span class="_ _3"></span>in <span class="_ _9"></span>Figur<span class="ls12d7">e1<span class="_ _8"></span><span class="ls0">5.6, <span class="_ _9"></span>remove <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">close<span class="_ _47"> </span></span>right <span class="_ _3"></span>befor<span class="ls12d7">et<span class="_ _8"></span><span class="ls0">he<span class="_ _47"> </span><span class="ff1a">waitpid<span class="_ _47"> </span></span>at <span class="_ _9"></span>the</span></span></span></span></span></div><div class="t m0 xe1 h5f y4690 ff19 fs2d fc0 sc0 ls0 ws0">end of the parent code.<span class="_ _44"> </span>Explain what happens.</div><div class="t m0 x32 h57 y4691 ff18 fs2d fc0 sc0 ls0 ws0">15.2<span class="_ _288"> </span><span class="ff19">In <span class="_ _2"></span>the <span class="_ _2"></span>program <span class="_ _2"></span>in <span class="_ _2"></span>Figur<span class="ls12d8">e1<span class="_ _4f"></span><span class="ls0">5.6, <span class="_ _2"></span>remove <span class="_ _2"></span>the<span class="_ _80"> </span><span class="ff1a">waitpid<span class="_ _66"> </span></span>at <span class="_ _2"></span>the <span class="_ _2"></span>end <span class="_ _2"></span>of <span class="_ _2"></span>the <span class="_ _2"></span>parent code.<span class="_ _59"> </span>Explain</span></span></span></div><div class="t m0 xe1 h5f y4692 ff19 fs2d fc0 sc0 ls0 ws0">what happens.</div><div class="t m0 x32 h57 y4693 ff18 fs2d fc0 sc0 ls0 ws0">15.3<span class="_ _288"> </span><span class="ff19">What <span class="_ _66"> </span>happens <span class="_ _47"> </span>if <span class="_ _80"> </span>the <span class="_ _47"> </span>argument <span class="_"> </span>to<span class="_ _46"> </span><span class="ff1a">popen<span class="_ _59"> </span></span>is <span class="_ _66"> </span>a <span class="_ _66"> </span>nonexistent <span class="_ _66"> </span>command?<span class="_ _60"> </span><span class="ls467">Wr<span class="_ _3"></span></span>ite <span class="_ _66"> </span>a <span class="_ _66"> </span>small</span></div><div class="t m0 xe1 h5f y4694 ff19 fs2d fc0 sc0 ls0 ws0">program to test this.</div><div class="t m0 x32 h5f y4695 ff18 fs2d fc0 sc0 ls0 ws0">15.4<span class="_ _288"> </span><span class="ff19">In <span class="_ _42"> </span>the <span class="_ _23"> </span>program <span class="_ _23"> </span>shown <span class="_ _23"> </span>in <span class="_ _23"> </span>Figur<span class="ls12d9">e1<span class="_ _b"></span><span class="ls0">5.18, <span class="_ _23"></span>remove <span class="_ _9"></span>the <span class="_ _42"> </span>signal <span class="_ _23"> </span>handler<span class="_ _1"></span><span class="ls12da">,e<span class="_ _b"></span><span class="ls0">xecute <span class="_ _23"> </span>the <span class="_ _23"> </span>program,</span></span></span></span></span></div><div class="t m0 xe1 h5f y4696 ff19 fs2d fc0 sc0 ls0 ws0">and <span class="_ _42"> </span>then <span class="_ _42"> </span>terminate <span class="_ _42"> </span>the <span class="_ _53"> </span>child.<span class="_ _51"> </span>After <span class="_ _42"> </span>entering <span class="_ _42"> </span>a <span class="_ _42"> </span>line <span class="_ _42"> </span>of <span class="_ _42"> </span>input, <span class="_ _53"> </span>how <span class="_ _42"> </span>can <span class="_ _42"> </span>you <span class="_ _53"> </span>tell <span class="_ _42"> </span>that <span class="_ _42"> </span>the</div><div class="t m0 xe1 h57 y4697 ff19 fs2d fc0 sc0 ls0 ws0">parent was terminated by<span class="_"> </span><span class="ff1a">SIGPIPE</span>?</div><div class="t m0 x32 h5f y4698 ff18 fs2d fc0 sc0 ls0 ws0">15.5<span class="_ _288"> </span><span class="ff19">In <span class="_ _23"> </span>the <span class="_ _9"></span>program <span class="_ _9"></span>in <span class="_ _9"></span>Figur<span class="ls12db">e1<span class="_ _b"></span><span class="ls0">5.18, <span class="_ _9"></span>use <span class="_ _23"> </span>the <span class="_ _9"></span>standar<span class="ls12db">dI<span class="_ _b"></span><span class="ls0">/O <span class="_ _9"></span>library <span class="_ _23"> </span>for <span class="_ _9"></span>reading <span class="_ _9"></span>and <span class="_ _9"></span>writing <span class="_ _9"></span>the</span></span></span></span></span></div><div class="t m0 xe1 h57 y4699 ff19 fs2d fc0 sc0 ls0 ws0">pipes instead of<span class="_"> </span><span class="ff1a">read<span class="_ _e"> </span></span>and<span class="_"> </span><span class="ff1a">write</span>.</div><a class="l" href="#pf12" data-dest-detail='[18,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892201px;bottom:938.928966px;width:90.803909px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
