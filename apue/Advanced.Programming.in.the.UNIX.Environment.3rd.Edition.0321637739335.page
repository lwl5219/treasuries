<div id="pf14f" class="pf w4 h1f" data-page-no="14f"><div class="pc pc14f w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg14f.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>9.8<span class="_ _247"> </span>Job <span class="_"> </span>Control<span class="_ _1fb"> </span><span class="ff18">301</span></div><div class="t m0 x3f h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">fg %1<span class="_ _d4"> </span><span class="ff1b">bring job number 1 into the for<span class="_ _0"></span>eground</span></span></div><div class="t m0 x3f h57 y426 ff1a fs2d fc0 sc0 ls0 ws0">cat &gt; temp.foo<span class="_ _248"> </span><span class="ff1b">the shell tells us which job is now in the foregr<span class="_ _0"></span>ound</span></div><div class="t m0 x3f h57 y800 ff1f fs2d fc0 sc0 ls0 ws0">hello, world<span class="_ _196"> </span><span class="ff1b">enter one line</span></div><div class="t m0 x3f h57 y801 ff1f fs2d fc0 sc0 ls0 ws0">ˆD<span class="_ _22c"> </span><span class="ff1b">type the end-of-ﬁle character</span></div><div class="t m0 x3f h57 y802 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">cat temp.foo<span class="_ _248"> </span><span class="ff1b">check that the one line was put into the ﬁle</span></span></div><div class="t m0 x3f h57 y803 ff1a fs2d fc0 sc0 ls0 ws0">hello, world</div><div class="t m0 x76 h52 y26cd ff19 fs2a fc0 sc0 ls0 ws0">Note <span class="_ _42"> </span>that <span class="_ _42"> </span>this <span class="_ _42"> </span>example <span class="_ _23"> </span>doesn’t <span class="_ _42"> </span>work <span class="_ _42"> </span>on <span class="_ _42"> </span>Mac <span class="_ _42"> </span>OS <span class="_ _42"> </span>X <span class="_ _42"> </span>10.6.8.<span class="_ _16"> </span>When <span class="_ _42"> </span>we <span class="_ _42"> </span>try <span class="_ _42"> </span>to <span class="_ _42"> </span>bring <span class="_ _42"> </span>the<span class="_ _45"> </span><span class="ff1a">cat</span></div><div class="t m0 x76 h52 y26ce ff19 fs2a fc0 sc0 ls0 ws0">command <span class="_ _9"></span>into <span class="_ _23"> </span>the <span class="_ _9"></span>foreground, <span class="_ _9"></span>the<span class="_ _47"> </span><span class="ff1a">read<span class="_ _47"> </span></span>fails <span class="_ _9"></span>with<span class="_ _47"> </span><span class="ff1a">errno<span class="_ _47"> </span></span>set <span class="_ _23"> </span>to<span class="_ _47"> </span><span class="ff1a">EINTR</span><span class="lsb3d">.S<span class="_ _4a"></span><span class="ls0">ince <span class="_ _9"></span>Mac <span class="_ _23"> </span>OS <span class="_ _9"></span>X <span class="_ _9"> </span>is</span></span></div><div class="t m0 x76 h51 y26cf ff19 fs2a fc0 sc0 ls0 ws0">based on FreeBSD, and Fr<span class="_ _0"></span>eeBSD works as expected, this must be a bug in Mac OS X.</div><div class="t m0 x32 h26 y26d0 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _e"> </span>shell <span class="_"> </span>starts <span class="_ _53"> </span>the<span class="_ _59"> </span><span class="ff1a">cat<span class="_ _4b"> </span></span>process <span class="_ _e"> </span>in <span class="_"> </span>the <span class="_ _53"> </span>background, <span class="_ _e"> </span>but <span class="_ _e"> </span>when<span class="_ _59"> </span><span class="ff1a">cat<span class="_ _4b"> </span></span>tries <span class="_"> </span>to <span class="_ _e"> </span>read <span class="_ _53"> </span>its</div><div class="t m0 x32 h2a y26d1 ff19 fsf fc0 sc0 ls0 ws0">standar<span class="lsb3e">di<span class="_ _1d"></span><span class="ls0">nput <span class="_ _66"> </span>(the <span class="_ _47"> </span>controlling <span class="_"> </span>terminal), <span class="_"> </span>the <span class="_ _66"> </span>terminal <span class="_ _66"> </span>driver<span class="_ _1"></span><span class="ls4f3">,k<span class="_ _5b"></span><span class="ls0">nowing <span class="_ _66"> </span>that <span class="_ _47"> </span>it <span class="_"> </span>is <span class="_ _66"> </span>a</span></span></span></span></div><div class="t m0 x32 h26 y26d2 ff19 fsf fc0 sc0 ls0 ws0">background job, sends <span class="_ _2"></span>the<span class="_"> </span><span class="ff1a">SIGTTIN<span class="_ _66"> </span></span>signal <span class="_ _2"></span>to <span class="_ _2"></span>the background job.<span class="_ _61"> </span>The shell <span class="_ _2"></span>detects this</div><div class="t m0 x32 h26 y26d3 ff19 fsf fc0 sc0 ls0 ws0">change <span class="_ _2"></span>in <span class="_ _2"></span>status <span class="_ _2"></span>of <span class="_ _2"></span>its <span class="_ _2"></span>child <span class="_ _2"></span>(recall <span class="_ _2"></span>our <span class="_ _2"></span>discussion <span class="_ _2"></span>of <span class="_ _2"></span>the<span class="_ _47"> </span><span class="ff1a">wait<span class="_ _66"> </span></span>and<span class="_ _47"> </span><span class="ff1a">waitpid<span class="_ _66"> </span></span>function <span class="_ _2"></span>in</div><div class="t m0 x32 h2a y26d4 ff19 fsf fc0 sc0 ls0 ws0">Section <span class="_ _9"></span>8.6) <span class="_ _9"></span>and <span class="_ _9"></span>tells <span class="_ _9"></span>us <span class="_ _9"></span>that <span class="_ _23"></span>the <span class="_ _9"></span>job <span class="_ _9"></span>has <span class="_ _9"></span>been <span class="_ _9"></span>stopped.<span class="_ _5a"> </span><span class="ls5f">We <span class="_ _66"> </span>t<span class="_ _23"></span></span>hen <span class="_ _9"></span>move <span class="_ _9"></span>the <span class="_ _9"></span>stopped <span class="_ _9"></span>job</div><div class="t m0 x32 h26 y26d5 ff19 fsf fc0 sc0 ls0 ws0">into <span class="_ _23"> </span>the <span class="_ _42"> </span>foregr<span class="_ _0"></span>ound <span class="_ _23"> </span>with <span class="_ _42"> </span>the <span class="_ _23"> </span>shell’s<span class="_ _35"> </span><span class="ff1a">fg<span class="_ _35"> </span></span>command. <span class="_ _44"> </span>(Refer<span class="_ _35"> </span>to <span class="_ _23"> </span>the <span class="_ _42"> </span>manual <span class="_ _23"> </span>page <span class="_ _42"> </span>for <span class="_ _23"> </span>the</div><div class="t m0 x32 h26 y26d6 ff19 fsf fc0 sc0 ls0 ws0">shell <span class="_ _3"></span>that <span class="_ _9"></span>you <span class="_ _3"></span>ar<span class="ls92b">eu<span class="_ _b"></span><span class="ls0">sing <span class="_ _9"></span>for <span class="_ _3"></span>all <span class="_ _9"></span>the <span class="_ _3"></span>details <span class="_ _9"></span>on <span class="_ _3"></span>its <span class="_ _9"></span>job <span class="_ _3"></span>control <span class="_ _3"></span>commands, <span class="_ _9"></span>such <span class="_ _3"></span>as<span class="_ _45"> </span><span class="ff1a">fg<span class="_ _47"> </span></span>and</span></span></div><div class="t m0 x32 h26 y26d7 ff1a fsf fc0 sc0 ls0 ws0">bg<span class="ff19 ls758">,a<span class="_ _b"></span><span class="ls0">nd <span class="_ _9"></span>the <span class="_ _9"></span>various <span class="_ _9"></span>ways <span class="_ _23"></span>to <span class="_ _9"></span>identify <span class="_ _9"></span>the <span class="_ _23"></span>dif<span class="_ _0"></span>ferent <span class="_ _3"></span>jobs.)<span class="_ _51"> </span>Doing <span class="_ _9"></span>this <span class="_ _9"></span>causes <span class="_ _9"></span>the <span class="_ _23"></span>shell <span class="_ _9"></span>to</span></span></div><div class="t m0 x32 h26 y26d8 ff19 fsf fc0 sc0 ls0 ws0">place <span class="_ _42"> </span>the <span class="_ _23"> </span>job <span class="_ _42"> </span>into <span class="_ _42"> </span>the <span class="_ _42"> </span>foregr<span class="_ _1"></span>ound <span class="_ _42"> </span>process <span class="_ _23"> </span>group <span class="_ _42"> </span>(<span class="ff1a">tcsetpgrp</span><span class="lsa42">)a<span class="_ _43"></span><span class="ls0">nd <span class="_ _23"> </span>send <span class="_ _42"> </span>the <span class="_ _42"> </span>continue</span></span></div><div class="t m0 x32 h26 y26d9 ff19 fsf fc0 sc0 ls0 ws0">signal (<span class="ff1a">SIGCONT</span>)<span class="_"> </span>to<span class="_ _66"> </span>the process group. <span class="_"> </span>Since<span class="_"> </span>it <span class="_ _2"></span>is now in <span class="_ _2"></span>the foreground pr<span class="_ _0"></span>ocess group,</div><div class="t m0 x32 h2a y26da ff19 fsf fc0 sc0 ls0 ws0">the job can read fr<span class="_ _0"></span>om the contr<span class="_ _0"></span>olling terminal.</div><div class="t m0 x3f h2a y26db ff19 fsf fc0 sc0 ls0 ws0">What <span class="_ _53"> </span>happens <span class="_ _e"> </span>if <span class="_ _e"> </span>a <span class="_ _53"> </span>background <span class="_ _53"> </span>job <span class="_ _e"> </span>sends <span class="_ _e"> </span>its <span class="_ _e"> </span>output <span class="_ _53"> </span>to <span class="_ _e"> </span>the <span class="_ _e"> </span>controlling <span class="_ _53"> </span>terminal?</div><div class="t m0 x32 h26 y26dc ff19 fsf fc0 sc0 ls0 ws0">This <span class="_ _47"> </span>is <span class="_ _45"> </span>an <span class="_ _45"> </span>option <span class="_ _47"> </span>that <span class="_ _45"> </span>we <span class="_ _47"> </span>can <span class="_ _45"> </span>allow <span class="_ _45"> </span>or <span class="_ _47"> </span>disallow<span class="_ _6"></span><span class="lsb3f">.N<span class="_ _56"></span><span class="ls0">ormally<span class="_ _6"></span>,<span class="_ _16"> </span>we<span class="_ _5a"> </span>use <span class="_ _47"> </span>the<span class="_ _5a"> </span><span class="ff1a">stty</span></span></span></div><div class="t m0 x40 h2a y26dd ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 x1b2 h2a y26dc ff19 fsf fc0 sc0 ls0 ws0">1</div><div class="t m0 x17e h2a y26dd ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 x32 h2a y26de ff19 fsf fc0 sc0 ls0 ws0">command <span class="_ _e"> </span>to <span class="_"> </span>change <span class="_ _53"> </span>this <span class="_"> </span>option.<span class="_ _65"> </span>(W<span class="_ _6"></span>e’ll <span class="_ _e"> </span>see <span class="_"> </span>in <span class="_ _53"> </span>Chapter <span class="_"> </span>18 <span class="_ _53"> </span>how <span class="_"> </span>we <span class="_ _53"> </span>can <span class="_"> </span>change <span class="_ _53"> </span>this</div><div class="t m0 x32 h2a y26df ff19 fsf fc0 sc0 ls0 ws0">option from a pr<span class="_ _0"></span>ogram.) <span class="_"> </span>The<span class="_"> </span>following example shows how this works:</div><div class="t m0 x3f h57 y26e0 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">cat temp.foo &amp;<span class="_ _9f"> </span><span class="ff1b">execute in background</span></span></div><div class="t m0 x3f h57 y26e1 ff1a fs2d fc0 sc0 ls0 ws0">[1] <span class="_ _15"> </span>1719</div><div class="t m0 x3f h57 y26e2 ff1a fs2d fc0 sc0 ls15c ws0">$h<span class="_ _1d"></span><span class="ls0">ello, world<span class="_ _b2"> </span><span class="ff1b">the output fr<span class="_ _1"></span>om the background job appears after the prompt</span></span></div><div class="t m0 x136 h58 y26e3 ff1b fs2d fc0 sc0 ls0 ws0">we press RETURN</div><div class="t m0 x3f h57 y26e4 ff1a fs2d fc0 sc0 ls0 ws0">[1] +<span class="_ _d9"> </span>Done <span class="_ _88"> </span>cat<span class="_"> </span>temp.foo &amp;</div><div class="t m0 x3f h57 y26e5 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">stty tostop<span class="_ _bc"> </span><span class="ff1b">disable ability of background jobs to output to controlling terminal</span></span></div><div class="t m0 x3f h57 y26e6 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">cat temp.foo &amp;<span class="_ _9f"> </span><span class="ff1b">try it again in the background</span></span></div><div class="t m0 x3f h57 y26e7 ff1a fs2d fc0 sc0 ls0 ws0">[1] <span class="_ _15"> </span>1721</div><div class="t m0 x3f h57 y26e8 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_ _192"> </span><span class="ff1b">we press RETURN and ﬁnd the job is stopped</span></div><div class="t m0 x3f h57 y26e9 ff1a fs2d fc0 sc0 ls0 ws0">[1] + Stopped(SIGTTOU)<span class="_ _189"> </span>cat temp.foo &amp;</div><div class="t m0 x3f h57 y26ea ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">fg %1<span class="_ _142"> </span><span class="ff1b ls1e7">re<span class="_ _2"></span><span class="ls0">sume stopped job in the foregr<span class="_ _0"></span>ound</span></span></span></div><div class="t m0 x3f h57 y26eb ff1a fs2d fc0 sc0 ls0 ws0">cat temp.foo<span class="_ _1f9"> </span><span class="ff1b">the shell tells us which job is now in the foreground</span></div><div class="t m0 x3f h57 y26ec ff1a fs2d fc0 sc0 ls0 ws0">hello, world<span class="_ _1f9"> </span><span class="ff1b">and here<span class="_"> </span>is<span class="_"> </span>its output</span></div><div class="t m0 x32 h26 y26ed ff19 fsf fc0 sc0 ls0 ws0">When <span class="_ _9"></span>we <span class="_ _23"></span>disallow <span class="_ _9"></span>background <span class="_ _9"></span>jobs <span class="_ _9"></span>from <span class="_ _9"></span>writing <span class="_ _9"></span>to <span class="_ _23"></span>the <span class="_ _9"></span>controlling <span class="_ _9"></span>terminal,<span class="_ _45"> </span><span class="ff1a">cat<span class="_ _45"> </span></span>will</div><div class="t m0 x32 h2a y26ee ff19 fsf fc0 sc0 ls0 ws0">block <span class="_ _2"></span>when <span class="_ _2"></span>it <span class="_ _2"></span>tries to <span class="_ _2"></span>write <span class="_ _2"></span>to <span class="_ _2"></span>its <span class="_ _2"></span>standar<span class="lsb40">do<span class="_ _4f"></span><span class="ls0">utput, <span class="_ _2"></span>because <span class="_ _2"></span>the <span class="_ _2"></span>terminal <span class="_ _2"></span>driver <span class="_ _2"></span>identiﬁes</span></span></div><div class="t m0 x32 h26 y26ef ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _3"></span>write <span class="_ _3"></span>as <span class="_ _9"></span>coming <span class="_ _3"></span>from <span class="_ _3"></span>a <span class="_ _3"></span>background <span class="_ _3"></span>process <span class="_ _2"></span>and <span class="_ _9"></span>sends <span class="_ _3"></span>the <span class="_ _3"></span>job <span class="_ _9"></span>the<span class="_ _47"> </span><span class="ff1a">SIGTTOU<span class="_ _45"> </span></span>signal.</div><div class="t m0 x32 h26 y26f0 ff19 fsf fc0 sc0 ls0 ws0">As <span class="_ _23"></span>with <span class="_ _9"></span>the <span class="_ _23"> </span>previous <span class="_ _9"></span>example, <span class="_ _23"> </span>when <span class="_ _23"></span>we <span class="_ _23"></span>use <span class="_ _9"></span>the <span class="_ _23"> </span>shell’s<span class="_ _35"> </span><span class="ff1a">fg<span class="_ _45"> </span></span>command <span class="_ _23"> </span>to <span class="_ _23"></span>bring <span class="_ _23"></span>the <span class="_ _9"></span>job</div><div class="t m0 x32 h2a y26f1 ff19 fsf fc0 sc0 ls0 ws0">into the foregr<span class="_ _0"></span>ound, the job completes.</div><div class="t m0 x3f h2a y26f2 ff19 fsf fc0 sc0 ls0 ws0">Figur<span class="lsb41">e9<span class="_ _52"></span><span class="ls0">.9 <span class="_ _35"> </span>summarizes <span class="_ _44"> </span>some <span class="_ _35"> </span>of <span class="_ _44"> </span>the <span class="_ _44"> </span>featur<span class="_ _0"></span>es <span class="_ _35"> </span>of <span class="_ _44"> </span>job <span class="_ _44"> </span>contr<span class="_ _0"></span>ol <span class="_ _35"> </span>that <span class="_ _44"> </span>we’ve <span class="_ _44"> </span>been</span></span></div><div class="t m0 x32 h2a y26f3 ff19 fsf fc0 sc0 ls0 ws0">describing. <span class="_ _47"> </span>The<span class="_ _47"> </span>solid <span class="_ _2"></span>lines <span class="_ _3"></span>through <span class="_ _2"></span>the <span class="_ _3"></span>terminal <span class="_ _3"></span>driver <span class="_ _3"></span>box <span class="_ _3"></span>mean <span class="_ _2"></span>that <span class="_ _3"></span>the <span class="_ _3"></span>terminal <span class="_ _3"></span>I/O</div><div class="t m0 x32 h2a y26f4 ff19 fsf fc0 sc0 ls0 ws0">and <span class="_ _9"></span>the <span class="_ _23"> </span>terminal-generated <span class="_ _23"></span>signals <span class="_ _23"></span>ar<span class="_ _0"></span><span class="ls87a">ea<span class="_ _b"></span><span class="ls0">lways <span class="_ _9"></span>connected <span class="_ _23"></span>from <span class="_ _9"></span>the <span class="_ _23"></span>for<span class="_ _0"></span>eground <span class="_ _9"></span>process</span></span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
