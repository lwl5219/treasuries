<div id="pf3c3" class="pf w4 h1f" data-page-no="3c3"><div class="pc pc3c3 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg3c3.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Appendix <span class="_"> </span>C<span class="_ _89"> </span>Chapter <span class="_"> </span>13<span class="_ _54"> </span>Solutions<span class="_ _1b"> </span><span class="ff18">929</span></div><div class="t m0 xe2 h57 y362 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;unistd.h&gt;</div><div class="t m0 xe2 h57 y3c0 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;time.h&gt;</div><div class="t m0 xe2 h57 y845 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;sys/select.h&gt;</div><div class="t m0 xe2 h57 y2f1e ff1a fs2d fc0 sc0 ls0 ws0">unsigned</div><div class="t m0 xe2 h57 y2f1f ff1a fs2d fc0 sc0 ls0 ws0">sleep(unsigned seconds)</div><div class="t m0 xe2 h57 y2f20 ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x60 h57 y583e ff1a fs2d fc0 sc0 ls0 ws0">int n;</div><div class="t m0 x60 h57 y583f ff1a fs2d fc0 sc0 ls0 ws0">unsigned slept;</div><div class="t m0 x60 h57 y5710 ff1a fs2d fc0 sc0 ls0 ws0">time_t start, end;</div><div class="t m0 x60 h57 y5711 ff1a fs2d fc0 sc0 ls0 ws0">struct timeval tv;</div><div class="t m0 x60 h57 y2f25 ff1a fs2d fc0 sc0 ls0 ws0">tv.tv_sec = seconds;</div><div class="t m0 x60 h57 y5712 ff1a fs2d fc0 sc0 ls0 ws0">tv.tv_usec = 0;</div><div class="t m0 x60 h57 y5713 ff1a fs2d fc0 sc0 ls0 ws0">time(&amp;start);</div><div class="t m0 x60 h57 y5714 ff1a fs2d fc0 sc0 ls15c ws0">n=s<span class="_ _1d"></span><span class="ls0">elect(0, NULL, NULL, NULL, &amp;tv);</span></div><div class="t m0 x60 h57 y5715 ff1a fs2d fc0 sc0 ls0 ws0">if (n == 0)</div><div class="t m0 xb9 h57 y5716 ff1a fs2d fc0 sc0 ls0 ws0">return(0);</div><div class="t m0 x60 h57 y5717 ff1a fs2d fc0 sc0 ls0 ws0">time(&amp;end);</div><div class="t m0 x60 h57 y5844 ff1a fs2d fc0 sc0 ls0 ws0">slept = end - start;</div><div class="t m0 x60 h57 y5845 ff1a fs2d fc0 sc0 ls0 ws0">if (slept &gt;= seconds)</div><div class="t m0 xb9 h57 y5846 ff1a fs2d fc0 sc0 ls0 ws0">return(0);</div><div class="t m0 x60 h57 y5847 ff1a fs2d fc0 sc0 ls0 ws0">return(seconds - slept);</div><div class="t m0 xe2 h57 y5ae2 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x27 h5e y61b3 ff18 fs10 fc0 sc0 ls0 ws0">Figure C.13<span class="_ _5a"> </span><span class="ff19 ls136">At<span class="_ _84"></span><span class="ls0">hread-safe implementation of<span class="_"> </span><span class="ff1a">sleep</span></span></span></div><div class="t m0 x32 h49 y61b4 ff18 fs26 fc0 sc0 ls0 ws0">13.3<span class="_ _210"> </span><span class="ff19">Figur<span class="lsd3">eC<span class="_ _d"></span><span class="ls0">.14 shows a solution.</span></span></span></div><div class="t m0 xe2 h5d y61b5 ff1a fs2f fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 xe2 h5d y61b6 ff1a fs2f fc0 sc0 ls0 ws0">int</div><div class="t m0 xe2 h5d y61b7 ff1a fs2f fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 xe2 h5d y61b8 ff1a fs2f fc0 sc0 ls0 ws0">{</div><div class="t m0 x60 h5d y61b9 ff1a fs2f fc0 sc0 ls0 ws0">FILE *fp;</div><div class="t m0 x60 h5d y61ba ff1a fs2f fc0 sc0 ls0 ws0">char *p;</div><div class="t m0 x60 h5d y61bb ff1a fs2f fc0 sc0 ls0 ws0">daemonize(&quot;getlog&quot;);</div><div class="t m0 x60 h5d y61bc ff1a fs2f fc0 sc0 ls395 ws0">p=g<span class="_ _1d"></span><span class="ls0">etlogin();</span></div><div class="t m0 x60 h5d y61bd ff1a fs2f fc0 sc0 ls0 ws0">fp = fopen(&quot;/tmp/getlog.out&quot;, &quot;w&quot;);</div><div class="t m0 x60 h5d y61be ff1a fs2f fc0 sc0 ls0 ws0">if (fp != NULL) {</div><div class="t m0 xb9 h5d y61bf ff1a fs2f fc0 sc0 ls0 ws0">if (p == NULL)</div><div class="t m0 x1ce h5d y61c0 ff1a fs2f fc0 sc0 ls0 ws0">fprintf(fp, &quot;no login name\n&quot;);</div><div class="t m0 xb9 h5d y61c1 ff1a fs2f fc0 sc0 ls0 ws0">else</div><div class="t m0 x1ce h5d y61c2 ff1a fs2f fc0 sc0 ls0 ws0">fprintf(fp, &quot;login name: %s\n&quot;, p);</div><div class="t m0 x60 h5d y61c3 ff1a fs2f fc0 sc0 ls0 ws0">}</div><div class="t m0 x60 h5d y61c4 ff1a fs2f fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 xe2 h5d y61c5 ff1a fs2f fc0 sc0 ls0 ws0">}</div><div class="t m0 x3d h6d y61c6 ff18 fs12 fc0 sc0 ls0 ws0">Figure C.14<span class="_ _5a"> </span><span class="ff19">Call<span class="_"> </span><span class="ff1a">daemonize<span class="_ _e"> </span></span>and then obtain login name</span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
