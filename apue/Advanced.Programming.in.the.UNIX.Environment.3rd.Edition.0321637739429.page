<div id="pf1ad" class="pf w4 h1f" data-page-no="1ad"><div class="pc pc1ad w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg1ad.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>1<span class="_ _1"></span>1.5 <span class="_ _1c9"> </span>Thr<span class="_ _1"></span>ead <span class="_"> </span>T<span class="_ _1"></span>ermination<span class="_ _1b"> </span><span class="ff18">395</span></div><div class="t m0 x32 h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y426 ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;thread 1 start\n&quot;);</div><div class="t m0 x8a h57 y800 ff1a fs2d fc0 sc0 ls0 ws0">pthread_cleanup_push(cleanup, &quot;thread 1 first handler&quot;);</div><div class="t m0 x8a h57 y801 ff1a fs2d fc0 sc0 ls0 ws0">pthread_cleanup_push(cleanup, &quot;thread 1 second handler&quot;);</div><div class="t m0 x8a h57 y802 ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;thread 1 push complete\n&quot;);</div><div class="t m0 x8a h57 y803 ff1a fs2d fc0 sc0 ls0 ws0">if (arg)</div><div class="t m0 x9d h57 y804 ff1a fs2d fc0 sc0 ls0 ws0">return((void *)1);</div><div class="t m0 x8a h57 y805 ff1a fs2d fc0 sc0 ls0 ws0">pthread_cleanup_pop(0);</div><div class="t m0 x8a h57 y806 ff1a fs2d fc0 sc0 ls0 ws0">pthread_cleanup_pop(0);</div><div class="t m0 x8a h57 y807 ff1a fs2d fc0 sc0 ls0 ws0">return((void *)1);</div><div class="t m0 x32 h57 y808 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h57 y8d9 ff1a fs2d fc0 sc0 ls0 ws0">void *</div><div class="t m0 x32 h57 y8da ff1a fs2d fc0 sc0 ls0 ws0">thr_fn2(void *arg)</div><div class="t m0 x32 h57 y8db ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y8dc ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;thread 2 start\n&quot;);</div><div class="t m0 x8a h57 y8dd ff1a fs2d fc0 sc0 ls0 ws0">pthread_cleanup_push(cleanup, &quot;thread 2 first handler&quot;);</div><div class="t m0 x8a h57 y8de ff1a fs2d fc0 sc0 ls0 ws0">pthread_cleanup_push(cleanup, &quot;thread 2 second handler&quot;);</div><div class="t m0 x8a h57 y8df ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;thread 2 push complete\n&quot;);</div><div class="t m0 x8a h57 y1251 ff1a fs2d fc0 sc0 ls0 ws0">if (arg)</div><div class="t m0 x9d h57 y1252 ff1a fs2d fc0 sc0 ls0 ws0">pthread_exit((void *)2);</div><div class="t m0 x8a h57 y1253 ff1a fs2d fc0 sc0 ls0 ws0">pthread_cleanup_pop(0);</div><div class="t m0 x8a h57 y3261 ff1a fs2d fc0 sc0 ls0 ws0">pthread_cleanup_pop(0);</div><div class="t m0 x8a h57 y3262 ff1a fs2d fc0 sc0 ls0 ws0">pthread_exit((void *)2);</div><div class="t m0 x32 h57 y3263 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h57 y31bc ff1a fs2d fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h57 y3264 ff1a fs2d fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 x32 h57 y3265 ff1a fs2d fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h57 y3266 ff1a fs2d fc0 sc0 ls0 ws0">int <span class="_ _186"> </span>err;</div><div class="t m0 x8a h57 y3267 ff1a fs2d fc0 sc0 ls0 ws0">pthread_t <span class="_ _d9"> </span>tid1,<span class="_"> </span>tid2;</div><div class="t m0 x8a h57 y3268 ff1a fs2d fc0 sc0 ls0 ws0">void <span class="_ _b7"> </span>*tret;</div><div class="t m0 x8a h57 y2f7e ff1a fs2d fc0 sc0 ls0 ws0">err = pthread_create(&amp;tid1, NULL, thr_fn1, (void *)1);</div><div class="t m0 x8a h57 y3269 ff1a fs2d fc0 sc0 ls0 ws0">if (err != 0)</div><div class="t m0 x9d h57 y326a ff1a fs2d fc0 sc0 ls0 ws0">err_exit(err, &quot;can’t create thread 1&quot;);</div><div class="t m0 x8a h57 y326b ff1a fs2d fc0 sc0 ls0 ws0">err = pthread_create(&amp;tid2, NULL, thr_fn2, (void *)1);</div><div class="t m0 x8a h57 y326c ff1a fs2d fc0 sc0 ls0 ws0">if (err != 0)</div><div class="t m0 x9d h57 y326d ff1a fs2d fc0 sc0 ls0 ws0">err_exit(err, &quot;can’t create thread 2&quot;);</div><div class="t m0 x8a h57 y326e ff1a fs2d fc0 sc0 ls0 ws0">err = pthread_join(tid1, &amp;tret);</div><div class="t m0 x8a h57 y326f ff1a fs2d fc0 sc0 ls0 ws0">if (err != 0)</div><div class="t m0 x9d h57 y3270 ff1a fs2d fc0 sc0 ls0 ws0">err_exit(err, &quot;can’t join with thread 1&quot;);</div><div class="t m0 x8a h57 y3271 ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;thread 1 exit code %ld\n&quot;, (long)tret);</div><div class="t m0 x8a h57 y3272 ff1a fs2d fc0 sc0 ls0 ws0">err = pthread_join(tid2, &amp;tret);</div><div class="t m0 x8a h57 y3273 ff1a fs2d fc0 sc0 ls0 ws0">if (err != 0)</div><div class="t m0 x9d h57 y3274 ff1a fs2d fc0 sc0 ls0 ws0">err_exit(err, &quot;can’t join with thread 2&quot;);</div><div class="t m0 x8a h57 y3275 ff1a fs2d fc0 sc0 ls0 ws0">printf(&quot;thread 2 exit code %ld\n&quot;, (long)tret);</div><div class="t m0 x8a h57 y3276 ff1a fs2d fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h57 y3277 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x145 h2d y1354 ff18 fs10 fc0 sc0 ls0 ws0">Figure 1<span class="_ _0"></span>1.5<span class="_ _d9"> </span><span class="ff19">Thread cleanup handler</span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
