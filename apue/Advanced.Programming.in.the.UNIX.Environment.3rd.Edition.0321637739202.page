<div id="pfca" class="pf w4 h1f" data-page-no="ca"><div class="pc pcca w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bgca.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">168<span class="_ _1b"> </span><span class="ff19">Standar<span class="ls30a">dI<span class="_ _55"></span><span class="ls0">/O <span class="_"> </span>Library<span class="_ _1c9"> </span>Chapter <span class="_"> </span>5</span></span></span></div><div class="t m0 x32 h26 y12f ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _44"> </span><span class="ff1a">tmpnam<span class="_ _4b"> </span></span>function <span class="_ _53"> </span>generates <span class="_ _53"> </span>a <span class="_ _e"> </span>string <span class="_ _53"> </span>that <span class="_ _53"> </span>is <span class="_ _e"> </span>a <span class="_ _53"> </span>valid <span class="_ _53"> </span>pathname <span class="_ _53"> </span>and <span class="_ _e"> </span>that <span class="_ _53"> </span>does <span class="_ _53"> </span>not</div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">match <span class="_ _3"></span>the <span class="_ _3"></span>name <span class="_ _3"></span>of <span class="_ _3"></span>any <span class="_ _3"></span>existing <span class="_ _9"></span>ﬁle.<span class="_ _61"> </span>This <span class="_ _3"></span>function <span class="_ _9"></span>generates <span class="_ _3"></span>a <span class="_ _3"></span>differ<span class="_ _0"></span>ent <span class="_ _3"></span>pathname <span class="_ _3"></span>each</div><div class="t m0 x32 h26 y131 ff19 fsf fc0 sc0 ls0 ws0">time it is called, up to<span class="_"> </span><span class="ff1a">TMP_MAX<span class="_ _80"> </span></span>times.<span class="_ _46"> </span><span class="ff1a">TMP_MAX<span class="_ _80"> </span></span>is deﬁned in<span class="_"> </span><span class="ff1a">&lt;stdio.h&gt;</span>.</div><div class="t m0 x76 h52 yba0 ff19 fs2a fc0 sc0 ls0 ws0">Although <span class="_ _9"></span>ISO <span class="_ _9"></span>C <span class="_ _9"> </span>deﬁnes<span class="_ _47"> </span><span class="ff1a">TMP_MAX</span><span class="ls722">,t<span class="_ _4f"></span><span class="ls0">he <span class="_ _9"></span>C <span class="_ _9"> </span>standar<span class="ls722">dr<span class="_ _8"></span><span class="ls0">equires <span class="_ _9"></span>only <span class="_ _9"></span>that <span class="_ _9"> </span>its <span class="_ _23"> </span>value <span class="_ _9"></span>be <span class="_ _9"></span>at <span class="_ _9"></span>least <span class="_ _9"> </span>25.</span></span></span></span></div><div class="t m0 x76 h51 yba1 ff19 fs2a fc0 sc0 ls0 ws0">The Single UNIX Speciﬁcation, however<span class="_ _1"></span><span class="ls723">,r<span class="_ _5"></span><span class="ls0">equires that XSI-conforming systems support a value</span></span></div><div class="t m0 x76 h51 yba2 ff19 fs2a fc0 sc0 ls0 ws0">of <span class="_ _47"> </span>at <span class="_ _45"> </span>least <span class="_ _45"> </span>10,000.<span class="_ _65"> </span>This <span class="_ _45"> </span>minimum <span class="_ _47"> </span>value <span class="_ _45"> </span>allows <span class="_ _45"> </span>an <span class="_ _47"> </span>implementation <span class="_ _45"> </span>to <span class="_ _47"> </span>use <span class="_ _45"> </span>four <span class="_ _47"> </span>digits</div><div class="t m0 x76 h51 y1737 ff19 fs2a fc0 sc0 ls0 ws0">(</div><div class="t m0 x198 h51 yba3 ff19 fs2a fc0 sc0 ls0 ws0">0000</div><div class="t m0 xb9 h51 y13bf ff19 fs2a fc0 sc0 ls0 ws0">–</div><div class="t m0 x12f h51 yba3 ff19 fs2a fc0 sc0 ls0 ws0">9999</div><div class="t m0 xea h51 y1737 ff19 fs2a fc0 sc0 ls0 ws0">)</div><div class="t m0 x30 h51 yba3 ff19 fs2a fc0 sc0 lse9 ws0">,a<span class="_ _84"></span><span class="ls0">lthough most implementations on UNIX systems use alphanumeric characters.</span></div><div class="t m0 x76 h52 y1738 ff19 fs2a fc0 sc0 ls0 ws0">The<span class="_ _47"> </span><span class="ff1a">tmpnam<span class="_ _45"> </span></span>function <span class="_ _9"></span>is <span class="_ _23"> </span>marked <span class="_ _23"> </span>obsolescent <span class="_ _23"> </span>in <span class="_ _9"> </span>SUSv4, <span class="_ _23"> </span>but <span class="_ _23"> </span>the <span class="_ _23"> </span>ISO <span class="_ _9"> </span>C <span class="_ _23"> </span>standar<span class="ls724">dc<span class="_ _8"></span><span class="ls0">ontinues <span class="_ _23"> </span>to</span></span></div><div class="t m0 x76 h51 y1739 ff19 fs2a fc0 sc0 ls0 ws0">support it.</div><div class="t m0 x3f h26 y173a ff19 fsf fc0 sc0 ls0 ws0">If<span class="_"> </span><span class="ff1b">ptr<span class="_ _66"> </span></span>is<span class="_ _66"> </span><span class="ff1a">NULL</span><span class="ls725">,t<span class="_ _d"></span><span class="ls0">he <span class="_ _2"></span>generated pathname <span class="_ _2"></span>is stored in <span class="_ _2"></span>a <span class="_ _2"></span>static area, and <span class="_ _2"></span>a pointer <span class="_ _2"></span>to <span class="_ _2"></span>this</span></span></div><div class="t m0 x32 h26 y173b ff19 fsf fc0 sc0 ls0 ws0">area is <span class="_ _2"></span>returned <span class="_ _2"></span>as <span class="_ _2"></span>the <span class="_ _2"></span>value <span class="_ _3"></span>of <span class="_ _2"></span>the <span class="_ _2"></span>function.<span class="_ _61"> </span>Subsequent <span class="_ _3"></span>calls <span class="_ _2"></span>to<span class="_ _66"> </span><span class="ff1a">tmpnam<span class="_ _47"> </span></span>can <span class="_ _2"></span>overwrite</div><div class="t m0 x32 h2a y173c ff19 fsf fc0 sc0 ls0 ws0">this <span class="_ _3"></span>static <span class="_ _3"></span>area. <span class="_ _47"> </span>(Thus,<span class="_ _45"> </span>if <span class="_ _2"></span>we <span class="_ _9"></span>call <span class="_ _3"></span>this <span class="_ _3"></span>function <span class="_ _9"></span>mor<span class="ls429">et<span class="_ _b"></span><span class="ls0">han <span class="_ _3"></span>once <span class="_ _9"></span>and <span class="_ _3"></span>we <span class="_ _3"></span>want <span class="_ _3"></span>to <span class="_ _9"></span>save <span class="_ _3"></span>the</span></span></div><div class="t m0 x32 h2b y173d ff19 fsf fc0 sc0 ls0 ws0">pathname, <span class="_ _3"></span>we <span class="_ _3"></span>have <span class="_ _3"></span>to <span class="_ _3"></span>save <span class="_ _3"></span>a <span class="_ _3"></span>copy <span class="_ _3"></span>of <span class="_ _3"></span>the <span class="_ _3"></span>pathname, <span class="_ _3"></span>not <span class="_ _3"></span>a <span class="_ _3"></span>copy <span class="_ _3"></span>of <span class="_ _3"></span>the <span class="_ _3"></span>pointer<span class="_ _6"></span>.) <span class="_ _47"> </span>If<span class="_ _47"> </span><span class="ff1b">ptr<span class="_ _45"> </span></span>is</div><div class="t m0 x32 h26 y173e ff19 fsf fc0 sc0 ls0 ws0">not<span class="_ _47"> </span><span class="ff1a">NULL</span>,<span class="_ _66"> </span>it<span class="_ _47"> </span>is<span class="_ _47"> </span>assumed <span class="_ _3"></span>that <span class="_ _2"></span>it <span class="_ _3"></span>points <span class="_ _3"></span>to <span class="_ _2"></span>an <span class="_ _3"></span>array <span class="_ _3"></span>of <span class="_ _2"></span>at <span class="_ _3"></span>least<span class="_ _47"> </span><span class="ff1a">L_tmpnam<span class="_ _47"> </span></span>characters. <span class="_ _47"> </span>(The</div><div class="t m0 x32 h26 y173f ff19 fsf fc0 sc0 ls0 ws0">constant<span class="_ _35"> </span><span class="ff1a">L_tmpnam<span class="_ _44"> </span></span>is <span class="_ _42"> </span>deﬁned <span class="_ _42"> </span>in<span class="_ _35"> </span><span class="ff1a">&lt;stdio.h&gt;</span>.) <span class="_ _44"> </span>The<span class="_ _35"> </span>generated <span class="_ _42"> </span>pathname <span class="_ _42"> </span>is <span class="_ _42"> </span>stored <span class="_ _23"> </span>in</div><div class="t m0 x32 h2b y1740 ff19 fsf fc0 sc0 ls0 ws0">this array<span class="_ _4"></span><span class="ls44">,a<span class="_ _5"></span><span class="ls0">nd<span class="_"> </span><span class="ff1b">ptr<span class="_"> </span></span>is returned as the value of the function.</span></span></div><div class="t m0 x3f h26 y1741 ff19 fsf fc0 sc0 ls0 ws0">The<span class="_ _60"> </span><span class="ff1a">tmpfile<span class="_ _60"> </span></span>function <span class="_ _46"> </span>creates <span class="_ _59"> </span>a <span class="_ _46"> </span>temporary <span class="_ _46"> </span>binary <span class="_ _46"> </span>ﬁle <span class="_ _46"> </span>(type<span class="_ _60"> </span><span class="ff1a">wb+</span><span class="ls726">)t<span class="_ _49"></span><span class="ls0">hat <span class="_ _46"> </span>is</span></span></div><div class="t m0 x32 h2a y1742 ff19 fsf fc0 sc0 ls0 ws0">automatically <span class="_ _3"></span>removed <span class="_ _9"></span>when <span class="_ _3"></span>it <span class="_ _9"></span>is <span class="_ _9"></span>closed <span class="_ _9"></span>or <span class="_ _9"></span>on <span class="_ _3"></span>program <span class="_ _9"></span>termination.<span class="_ _16"> </span>Under <span class="_ _9"></span>the <span class="_ _9"></span>UNIX</div><div class="t m0 x32 h2a y1743 ff19 fsf fc0 sc0 ls0 ws0">System, it makes no differ<span class="_ _0"></span>ence that this ﬁle is a binary ﬁle.</div><div class="t m0 x35 h27 y1744 ff16 fsf fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h2a y1745 ff19 fsf fc0 sc0 ls0 ws0">The program in Figur<span class="_ _0"></span><span class="ls44">e5<span class="_ _d"></span><span class="ls0">.12 demonstrates these two functions.</span></span></div><div class="t m0 x32 h4e y1746 ff1a fs28 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h4e y1747 ff1a fs28 fc0 sc0 ls0 ws0">int</div><div class="t m0 x32 h4e y1748 ff1a fs28 fc0 sc0 ls0 ws0">main(void)</div><div class="t m0 x32 h4e y1749 ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y174a ff1a fs28 fc0 sc0 ls0 ws0">char <span class="_ _68"> </span>name[L_tmpnam],<span class="_"> </span>line[MAXLINE];</div><div class="t m0 x8a h4e y174b ff1a fs28 fc0 sc0 ls0 ws0">FILE <span class="_ _68"> </span>*fp;</div><div class="t m0 x8a h4e y174c ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;%s\n&quot;, tmpnam(NULL));<span class="_ _b7"> </span>/* first temp name */</div><div class="t m0 x8a h4e y174d ff1a fs28 fc0 sc0 ls0 ws0">tmpnam(name); <span class="_ _1e5"> </span>/*<span class="_"> </span>second temp name */</div><div class="t m0 x8a h4e y174e ff1a fs28 fc0 sc0 ls0 ws0">printf(&quot;%s\n&quot;, name);</div><div class="t m0 x8a h4e y174f ff1a fs28 fc0 sc0 ls0 ws0">if ((fp = tmpfile()) == NULL)<span class="_ _b7"> </span>/* create temp file */</div><div class="t m0 x9d h4e y1750 ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;tmpfile error&quot;);</div><div class="t m0 x8a h4e y1751 ff1a fs28 fc0 sc0 ls0 ws0">fputs(&quot;one line of output\n&quot;, fp);<span class="_ _d9"> </span>/* write to temp file */</div><div class="t m0 x8a h4e y1752 ff1a fs28 fc0 sc0 ls0 ws0">rewind(fp); <span class="_ _1e6"> </span>/*<span class="_"> </span>then read it back */</div><div class="t m0 x8a h4e y1753 ff1a fs28 fc0 sc0 ls0 ws0">if (fgets(line, sizeof(line), fp) == NULL)</div><div class="t m0 x9d h4e y1754 ff1a fs28 fc0 sc0 ls0 ws0">err_sys(&quot;fgets error&quot;);</div><div class="t m0 x8a h4e y1755 ff1a fs28 fc0 sc0 ls0 ws0">fputs(line, stdout);<span class="_ _1e7"> </span>/* print the line we wrote */</div><div class="t m0 x8a h4e y1756 ff1a fs28 fc0 sc0 ls0 ws0">exit(0);</div><div class="t m0 x32 h4e y1757 ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 xe9 h4f y1758 ff18 fs11 fc0 sc0 ls0 ws0">Figure 5.12<span class="_ _5a"> </span><span class="ff19">Demonstrate<span class="_"> </span><span class="ff1a">tmpnam<span class="_ _e"> </span></span>and<span class="_"> </span><span class="ff1a">tmpfile<span class="_ _e"> </span></span>functions</span></div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
