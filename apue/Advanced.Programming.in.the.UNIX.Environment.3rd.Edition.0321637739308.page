<div id="pf134" class="pf w4 h1f" data-page-no="134"><div class="pc pc134 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg134.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">274<span class="_ _1b"> </span><span class="ff19">Process <span class="_"> </span>Contr<span class="_ _0"></span>ol <span class="_ _222"> </span>Chapter<span class="_ _4b"> </span>8</span></div><div class="t m0 x3f h26 y12f ff19 fsf fc0 sc0 ls0 ws0">BSD-derived <span class="_ _47"> </span>platforms <span class="_ _47"> </span>don’t <span class="_ _47"> </span>support <span class="_ _47"> </span>the<span class="_ _16"> </span><span class="ff1a">ac_stat<span class="_ _16"> </span></span>member<span class="_ _1"></span>,<span class="_ _61"> </span>so<span class="_ _16"> </span>we<span class="_ _16"> </span>deﬁne <span class="_ _47"> </span>the</div><div class="t m0 x32 h26 y130 ff1a fsf fc0 sc0 ls0 ws0">HAS_AC_STAT<span class="_ _59"> </span><span class="ff19">constant <span class="_"> </span>on <span class="_"> </span>the <span class="_"> </span>platforms <span class="_"> </span>that <span class="_ _e"> </span>do <span class="_"> </span>support <span class="_"> </span>this <span class="_"> </span>member<span class="_ _6"></span><span class="lsa6e">.B<span class="_ _5d"></span><span class="ls0">asing <span class="_"> </span>the</span></span></span></div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">deﬁned symbol on the featur<span class="lsa6f">ei<span class="_ _4f"></span><span class="ls0">nstead of on the platform makes <span class="_ _2"></span>the code read better and</span></span></div><div class="t m0 x32 h2a y132 ff19 fsf fc0 sc0 ls0 ws0">allows <span class="_ _35"> </span>us <span class="_ _44"> </span>to <span class="_ _35"> </span>modify <span class="_ _44"> </span>the <span class="_ _35"> </span>program <span class="_ _35"> </span>simply <span class="_ _44"> </span>by <span class="_ _44"> </span>adding <span class="_ _35"> </span>the <span class="_ _44"> </span>new <span class="_ _35"> </span>deﬁnition <span class="_ _44"> </span>to <span class="_ _35"> </span>our</div><div class="t m0 x32 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">compilation command.<span class="_ _59"> </span>The alternative would be to use</div><div class="t m0 x3f h57 y2280 ff1a fs2d fc0 sc0 ls0 ws0">#if !defined(BSD) &amp;&amp; !defined(MACOS)</div><div class="t m0 x32 h2a y1210 ff19 fsf fc0 sc0 ls0 ws0">which becomes unwieldy as we port our application to additional platforms.</div><div class="t m0 x3f h26 y23f9 ff19 fsf fc0 sc0 ls5f ws0">We <span class="_ _e"> </span>d<span class="_ _23"></span><span class="ls0">eﬁne <span class="_ _2"></span>similar <span class="_ _2"></span>constants <span class="_ _3"></span>to <span class="_ _2"></span>determine <span class="_ _3"></span>whether <span class="_ _2"></span>the <span class="_ _3"></span>platform <span class="_ _2"></span>supports <span class="_ _2"></span>the<span class="_ _47"> </span><span class="ff1a">ACORE</span></span></div><div class="t m0 x32 h26 y23fa ff19 fsf fc0 sc0 ls0 ws0">and<span class="_ _4b"> </span><span class="ff1a">AXSIG<span class="_ _44"> </span></span>accounting <span class="_ _e"> </span>ﬂags.<span class="_ _65"> </span><span class="ls5f">We <span class="_ _35"> </span>c<span class="_ _9"></span></span>an’t <span class="_ _e"> </span>use <span class="_ _53"> </span>the <span class="_ _e"> </span>ﬂag <span class="_ _53"> </span>symbols <span class="_ _53"> </span>themselves, <span class="_ _e"> </span>because <span class="_ _53"> </span>on</div><div class="t m0 x32 h26 y23fb ff19 fsf fc0 sc0 ls0 ws0">Linux, they ar<span class="ls44">ed<span class="_ _4f"></span><span class="ls0">eﬁned as<span class="_"> </span><span class="ff1a">enum<span class="_ _66"> </span></span>values, which we can’t use in a<span class="_"> </span><span class="ff1a">#ifdef<span class="_ _80"> </span></span>expression.</span></span></div><div class="t m0 x3f h2a y23fc ff19 fsf fc0 sc0 ls5f ws0">To <span class="_ _53"> </span>p<span class="_ _9"></span><span class="ls0">erform our test, we do the following:</span></div><div class="t m0 x3f h26 y23fd ff19 fsf fc0 sc0 ls0 ws0">1. <span class="_ _51"> </span>Become<span class="_ _44"> </span>superuser <span class="_ _53"> </span>and <span class="_ _53"> </span>enable <span class="_ _53"> </span>accounting, <span class="_ _53"> </span>with <span class="_ _53"> </span>the<span class="_ _4b"> </span><span class="ff1a">accton<span class="_ _44"> </span></span>command. <span class="_ _4b"> </span>Note</div><div class="t m0 x41 h2a y23fe ff19 fsf fc0 sc0 ls0 ws0">that <span class="_ _53"> </span>when <span class="_ _53"> </span>this <span class="_ _e"> </span>command <span class="_ _53"> </span>terminates, <span class="_ _53"> </span>accounting <span class="_ _e"> </span>should <span class="_ _53"> </span>be <span class="_ _53"> </span>on; <span class="_ _e"> </span>therefor<span class="_ _0"></span>e, <span class="_ _53"> </span>the</div><div class="t m0 x41 h2a y23ff ff19 fsf fc0 sc0 ls0 ws0">ﬁrst recor<span class="_ _0"></span>d<span class="_"> </span>in<span class="_"> </span>the accounting ﬁle should be fr<span class="_ _0"></span>om this command.</div><div class="t m0 x3f h2a y2400 ff19 fsf fc0 sc0 ls0 ws0">2. <span class="_ _51"> </span>Exit<span class="_ _61"> </span>the <span class="_ _47"> </span>superuser <span class="_ _47"> </span>shell <span class="_ _47"> </span>and <span class="_ _66"> </span>run <span class="_ _47"> </span>the <span class="_ _47"> </span>program <span class="_"> </span>in <span class="_ _47"> </span>Figur<span class="lsa70">e8<span class="_ _1d"></span><span class="ls0">.28. <span class="_ _61"> </span>This<span class="_ _16"> </span>should</span></span></div><div class="t m0 x41 h2a y2401 ff19 fsf fc0 sc0 ls0 ws0">append six <span class="_ _2"></span>recor<span class="_ _0"></span>ds to the <span class="_ _2"></span>accounting ﬁle: <span class="_ _2"></span>one <span class="_ _2"></span>for the <span class="_ _2"></span>superuser shell, one <span class="_ _2"></span>for the</div><div class="t m0 x41 h2a y2402 ff19 fsf fc0 sc0 ls0 ws0">test parent, and one for each of the four test childr<span class="_ _0"></span>en.</div><div class="t m0 x41 h26 y2403 ff19 fsf fc0 sc0 ls4f5 ws0">An<span class="_ _8"></span><span class="ls0">ew <span class="_ _3"></span>process <span class="_ _2"></span>is <span class="_ _9"></span>not <span class="_ _3"></span>created <span class="_ _2"></span>by <span class="_ _3"></span>the<span class="_ _45"> </span><span class="ff1a">execl<span class="_ _47"> </span></span>in <span class="_ _3"></span>the <span class="_ _3"></span>second <span class="_ _3"></span>child.<span class="_ _16"> </span>Ther<span class="ls4f5">ei<span class="_ _8"></span><span class="ls930">so<span class="_ _8"></span><span class="ls0">nly <span class="_ _3"></span>a</span></span></span></span></div><div class="t m0 x41 h2a y2404 ff19 fsf fc0 sc0 ls0 ws0">single accounting recor<span class="_ _0"></span><span class="ls44">df<span class="_ _d"></span><span class="ls0">or the second child.</span></span></div><div class="t m0 x3f h2a y2405 ff19 fsf fc0 sc0 ls0 ws0">3. <span class="_ _51"> </span>Become<span class="_ _35"> </span>superuser <span class="_ _42"> </span>and <span class="_ _42"> </span>turn <span class="_ _42"> </span>accounting <span class="_ _23"> </span>off. <span class="_ _35"> </span>Since<span class="_ _44"> </span>accounting <span class="_ _23"> </span>is <span class="_ _42"> </span>of<span class="lsa71">fw<span class="_ _43"></span><span class="ls0">hen <span class="_ _23"> </span>this</span></span></div><div class="t m0 x41 h26 y2406 ff1a fsf fc0 sc0 ls0 ws0">accton<span class="_ _80"> </span><span class="ff19">command terminates, it should not appear in the accounting ﬁle.</span></div><div class="t m0 x3f h2a y2407 ff19 fsf fc0 sc0 ls0 ws0">4. <span class="_ _51"> </span>Run<span class="_ _45"> </span>the <span class="_ _3"></span>program <span class="_ _3"></span>in <span class="_ _9"></span>Figur<span class="ls17c">e8<span class="_ _b"></span><span class="ls0">.29 <span class="_ _3"></span>to <span class="_ _9"></span>print <span class="_ _3"></span>the <span class="_ _9"></span>selected <span class="_ _9"></span>ﬁelds <span class="_ _3"></span>from <span class="_ _3"></span>the <span class="_ _9"></span>accounting</span></span></div><div class="t m0 x41 h2a y2408 ff19 fsf fc0 sc0 ls0 ws0">ﬁle.</div><div class="t m0 x32 h2a y2409 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _23"> </span>output <span class="_ _23"> </span>from <span class="_ _23"> </span>step <span class="_ _23"> </span>4 <span class="_ _23"> </span>follows.<span class="_ _54"> </span><span class="ls5f">We <span class="_ _47"> </span>h<span class="_ _9"></span></span>ave <span class="_ _23"> </span>appended <span class="_ _42"> </span>the <span class="_ _23"></span>description <span class="_ _23"> </span>of <span class="_ _23"> </span>the <span class="_ _42"> </span>process <span class="_ _9"></span>in</div><div class="t m0 x32 h2a y240a ff19 fsf fc0 sc0 ls0 ws0">italics to selected lines, for the discussion later<span class="_ _6"></span>.</div><div class="t m0 xb8 h57 y240b ff1a fs2d fc0 sc0 ls0 ws0">accton <span class="_ _68"> </span>e<span class="_"> </span><span class="lsa72">=1<span class="_ _243"></span><span class="ls15c">,c<span class="_ _1d"></span><span class="ls0">hars =<span class="_ _8a"> </span>336, stat =<span class="_ _87"> </span>0: <span class="_ _189"> </span>S</span></span></span></div><div class="t m0 xb8 h57 y240c ff1a fs2d fc0 sc0 ls0 ws0">sh <span class="_ _b7"> </span>e<span class="_"> </span><span class="lsa73">=1<span class="_ _244"></span><span class="ls0">550, chars =<span class="_ _68"> </span>20168, stat =<span class="_ _87"> </span>0: <span class="_ _189"> </span>S</span></span></div><div class="t m0 xb8 h57 y240d ff1a fs2d fc0 sc0 ls0 ws0">dd <span class="_ _b7"> </span>e<span class="_"> </span><span class="lsa72">=2<span class="_ _243"></span><span class="ls15c">,c<span class="_ _1d"></span><span class="ls0">hars =<span class="_ _15"> </span>1585, stat =<span class="_ _87"> </span>0:<span class="_ _74"> </span><span class="ff1b">second child</span></span></span></span></div><div class="t m0 xb8 h57 y240e ff1a fs2d fc0 sc0 ls0 ws0">a.out <span class="_ _15"> </span>e<span class="_"> </span><span class="lsa74">=2<span class="_ _19"></span><span class="ls0">02, chars =<span class="_ _b7"> </span>0, stat =<span class="_ _87"> </span>0:<span class="_ _74"> </span><span class="ff1b">parent</span></span></span></div><div class="t m0 xb8 h57 y240f ff1a fs2d fc0 sc0 ls0 ws0">a.out <span class="_ _15"> </span>e<span class="_"> </span><span class="lsa74">=4<span class="_ _19"></span><span class="ls0">20, chars =<span class="_ _b7"> </span>0, stat = 134:<span class="_ _8a"> </span>F<span class="_ _15"> </span><span class="ff1b">ﬁrst child</span></span></span></div><div class="t m0 xb8 h57 y2410 ff1a fs2d fc0 sc0 ls0 ws0">a.out <span class="_ _15"> </span>e<span class="_"> </span><span class="lsa74">=6<span class="_ _19"></span><span class="ls0">00, chars =<span class="_ _b7"> </span>0, stat =<span class="_ _87"> </span>9: <span class="_ _15"> </span>F<span class="_ _15"> </span><span class="ff1b">fourth child</span></span></span></div><div class="t m0 xb8 h57 y2411 ff1a fs2d fc0 sc0 ls0 ws0">a.out <span class="_ _15"> </span>e<span class="_"> </span><span class="lsa74">=8<span class="_ _19"></span><span class="ls0">01, chars =<span class="_ _b7"> </span>0, stat =<span class="_ _87"> </span>0: <span class="_ _15"> </span>F<span class="_ _15"> </span><span class="ff1b">third child</span></span></span></div><div class="t m0 x3f h2a y2412 ff19 fsf fc0 sc0 ls0 ws0">For <span class="_ _66"> </span>this <span class="_ _47"> </span>system, <span class="_"> </span>the <span class="_ _47"> </span>elapsed <span class="_ _66"> </span>time <span class="_ _66"> </span>values <span class="_ _47"> </span>ar<span class="lsa75">em<span class="_ _1d"></span><span class="ls0">easured <span class="_"> </span>in <span class="_ _47"> </span>units <span class="_ _66"> </span>of <span class="_ _47"> </span>clock <span class="_"> </span>ticks.</span></span></div><div class="t m0 x32 h2a y2413 ff19 fsf fc0 sc0 ls0 ws0">Figur<span class="lsa76">e2<span class="_ _43"></span><span class="ls0">.15 <span class="_ _23"></span>shows <span class="_ _9"></span>that <span class="_ _23"></span>this <span class="_ _9"></span>system <span class="_ _9"></span>generates <span class="_ _23"></span>100 <span class="_ _9"></span>clock <span class="_ _23"></span>ticks <span class="_ _9"></span>per <span class="_ _9"></span>second.<span class="_ _51"> </span>For <span class="_ _9"></span>example,</span></span></div><div class="t m0 x32 h26 y2414 ff19 fsf fc0 sc0 ls0 ws0">the<span class="_ _47"> </span><span class="ff1a">sleep(2)<span class="_ _47"> </span></span>in <span class="_ _3"></span>the <span class="_ _3"></span>parent <span class="_ _2"></span>corresponds <span class="_ _3"></span>to <span class="_ _3"></span>the <span class="_ _3"></span>elapsed <span class="_ _3"></span>time <span class="_ _3"></span>of <span class="_ _3"></span>202 <span class="_ _3"></span>clock <span class="_ _3"></span>ticks.<span class="_ _61"> </span>For <span class="_ _3"></span>the</div><div class="t m0 x32 h26 y2415 ff19 fsf fc0 sc0 ls0 ws0">ﬁrst <span class="_ _53"> </span>child, <span class="_"> </span>the<span class="_ _44"> </span><span class="ff1a">sleep(4)<span class="_ _4b"> </span></span>becomes <span class="_"> </span>420 <span class="_ _53"> </span>clock <span class="_ _e"> </span>ticks.<span class="_ _65"> </span>Note <span class="_ _e"> </span>that <span class="_ _e"> </span>the <span class="_ _e"> </span>amount <span class="_ _e"> </span>of <span class="_ _e"> </span>time <span class="_ _e"> </span>a</div><div class="t m0 x32 h26 y2416 ff19 fsf fc0 sc0 ls0 ws0">process sleeps is not exact.<span class="_ _59"> </span>(W<span class="_ _6"></span>e’ll return to the<span class="_"> </span><span class="ff1a">sleep<span class="_ _66"> </span></span>function in Chapter 10.)<span class="_ _46"> </span>Also, the</div><div class="t m0 x32 h26 y2417 ff19 fsf fc0 sc0 ls0 ws0">calls to<span class="_"> </span><span class="ff1a">fork<span class="_ _80"> </span></span>and<span class="_"> </span><span class="ff1a">exit<span class="_ _66"> </span></span>take some amount of time.</div><div class="t m0 x3f h26 y2418 ff19 fsf fc0 sc0 ls0 ws0">Note that the<span class="_"> </span><span class="ff1a">ac_stat<span class="_ _66"> </span></span>member is not the <span class="_ _2"></span>true termination status of the process, but</div><div class="t m0 x32 h2a y2419 ff19 fsf fc0 sc0 ls0 ws0">rather <span class="_ _44"> </span>corresponds <span class="_ _35"> </span>to <span class="_ _44"> </span>a <span class="_ _44"> </span>portion <span class="_ _44"> </span>of <span class="_ _35"> </span>the <span class="_ _44"> </span>termination <span class="_ _44"> </span>status <span class="_ _44"> </span>that <span class="_ _44"> </span>we <span class="_ _44"> </span>discussed <span class="_ _44"> </span>in</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
