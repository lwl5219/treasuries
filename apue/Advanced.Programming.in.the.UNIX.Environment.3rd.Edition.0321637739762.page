<div id="pf2fa" class="pf w4 h1f" data-page-no="2fa"><div class="pc pc2fa w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bg2fa.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">728<span class="_ _1b"> </span><span class="ff19">Pseudo <span class="_"> </span>T<span class="_ _6"></span>erminals <span class="_ _23a"> </span>Chapter<span class="_ _4b"> </span>19</span></div><div class="t m0 x8a h57 y425 ff1a fs2d fc0 sc0 ls0 ws0">pid_t <span class="_ _d9"> </span>pid;</div><div class="t m0 x8a h57 y426 ff1a fs2d fc0 sc0 ls0 ws0">char <span class="_ _68"> </span>pts_name[20];</div><div class="t m0 x8a h57 y3810 ff1a fs2d fc0 sc0 ls0 ws0">if ((fdm = ptym_open(pts_name, sizeof(pts_name))) &lt; 0)</div><div class="t m0 x9d h57 y31b5 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;can’t open master pty: %s, error %d&quot;, pts_name, fdm);</div><div class="t m0 x8a h57 y3509 ff1a fs2d fc0 sc0 ls0 ws0">if (slave_name != NULL) {</div><div class="t m0 x9d h57 y350a ff1a fs2d fc0 sc0 ls0 ws0">/*</div><div class="t m0 x175 h57 y350b ff1a fs2d fc0 sc0 ls15c ws0">*R<span class="_ _1d"></span><span class="ls0">eturn name of slave.<span class="_ _3a"> </span>Null terminate to handle case</span></div><div class="t m0 x175 h57 y350c ff1a fs2d fc0 sc0 ls15c ws0">*w<span class="_ _1d"></span><span class="ls0">here strlen(pts_name) &gt; slave_namesz.</span></div><div class="t m0 x175 h57 y350d ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 x9d h57 y31b6 ff1a fs2d fc0 sc0 ls0 ws0">strncpy(slave_name, pts_name, slave_namesz);</div><div class="t m0 x9d h57 y31b7 ff1a fs2d fc0 sc0 ls0 ws0">slave_name[slave_namesz - 1] = ’\0’;</div><div class="t m0 x8a h57 y31b8 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x8a h57 y3411 ff1a fs2d fc0 sc0 ls0 ws0">if ((pid = fork()) &lt; 0) {</div><div class="t m0 x9d h57 y3412 ff1a fs2d fc0 sc0 ls0 ws0">return(-1);</div><div class="t m0 x8a h57 y3811 ff1a fs2d fc0 sc0 ls15c ws0">}e<span class="_ _1d"></span><span class="ls0">lse if (pid == 0) {<span class="_ _88"> </span>/* child */</span></div><div class="t m0 x9d h57 y3812 ff1a fs2d fc0 sc0 ls0 ws0">if (setsid() &lt; 0)</div><div class="t m0 x1f h57 y3813 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;setsid error&quot;);</div><div class="t m0 x9d h57 y351e ff1a fs2d fc0 sc0 ls0 ws0">/*</div><div class="t m0 x175 h57 y351f ff1a fs2d fc0 sc0 ls15c ws0">*S<span class="_ _1d"></span><span class="ls0">ystem V acquires controlling terminal on open().</span></div><div class="t m0 x175 h57 y3520 ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 x9d h57 y42b2 ff1a fs2d fc0 sc0 ls0 ws0">if ((fds = ptys_open(pts_name)) &lt; 0)</div><div class="t m0 x1f h57 y42b3 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;can’t open slave pty&quot;);</div><div class="t m0 x9d h57 y42b4 ff1a fs2d fc0 sc0 ls0 ws0">close(fdm); <span class="_ _15"> </span>/*<span class="_"> </span>all done with master in child */</div><div class="t m0 x32 h57 y880 ff1a fs2d fc0 sc0 ls0 ws0">#if defined(BSD)</div><div class="t m0 x9d h57 y4d00 ff1a fs2d fc0 sc0 ls0 ws0">/*</div><div class="t m0 x175 h57 y4d01 ff1a fs2d fc0 sc0 ls15c ws0">*T<span class="_ _1d"></span><span class="ls0">IOCSCTTY is the BSD way to acquire a controlling terminal.</span></div><div class="t m0 x175 h57 y38c2 ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 x9d h57 y38c3 ff1a fs2d fc0 sc0 ls0 ws0">if (ioctl(fds, TIOCSCTTY, (char *)0) &lt; 0)</div><div class="t m0 x1f h57 y38c4 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;TIOCSCTTY error&quot;);</div><div class="t m0 x32 h57 y38c5 ff1a fs2d fc0 sc0 ls0 ws0">#endif</div><div class="t m0 x9d h57 y42b6 ff1a fs2d fc0 sc0 ls0 ws0">/*</div><div class="t m0 x175 h57 y42b7 ff1a fs2d fc0 sc0 ls15c ws0">*S<span class="_ _1d"></span><span class="ls0">et slave’s termios and window size.</span></div><div class="t m0 x175 h57 y42b8 ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 x9d h57 y42b9 ff1a fs2d fc0 sc0 ls0 ws0">if (slave_termios != NULL) {</div><div class="t m0 x1f h57 y42ba ff1a fs2d fc0 sc0 ls0 ws0">if (tcsetattr(fds, TCSANOW, slave_termios) &lt; 0)</div><div class="t m0 x1ca h57 y42bb ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;tcsetattr error on slave pty&quot;);</div><div class="t m0 x9d h57 y42bc ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x9d h57 y42bd ff1a fs2d fc0 sc0 ls0 ws0">if (slave_winsize != NULL) {</div><div class="t m0 x1f h57 y42be ff1a fs2d fc0 sc0 ls0 ws0">if (ioctl(fds, TIOCSWINSZ, slave_winsize) &lt; 0)</div><div class="t m0 x1ca h57 y4d02 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;TIOCSWINSZ error on slave pty&quot;);</div><div class="t m0 x9d h57 y4d03 ff1a fs2d fc0 sc0 ls0 ws0">}</div><div class="t m0 x9d h57 y42c0 ff1a fs2d fc0 sc0 ls0 ws0">/*</div><div class="t m0 x175 h57 y42c1 ff1a fs2d fc0 sc0 ls15c ws0">*S<span class="_ _1d"></span><span class="ls0">lave becomes stdin/stdout/stderr of child.</span></div><div class="t m0 x175 h57 y42c2 ff1a fs2d fc0 sc0 ls0 ws0">*/</div><div class="t m0 x9d h57 y42c3 ff1a fs2d fc0 sc0 ls0 ws0">if (dup2(fds, STDIN_FILENO) != STDIN_FILENO)</div><div class="t m0 x1f h57 y42c4 ff1a fs2d fc0 sc0 ls0 ws0">err_sys(&quot;dup2 error to stdin&quot;);</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
