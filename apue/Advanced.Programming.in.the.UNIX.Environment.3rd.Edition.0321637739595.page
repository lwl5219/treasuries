<div id="pf253" class="pf w4 h1f" data-page-no="253"><div class="pc pc253 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg253.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>15.7<span class="_ _2bc"> </span>Message <span class="_"> </span>Queues<span class="_ _1b"> </span><span class="ff18">561</span></div><div class="t m0 x35 h53 y12f ff16 fs2b fc0 sc0 ls0 ws0">15.7 <span class="_ _93"> </span>Messa<span class="ls1215">ge <span class="_ _47"> </span>Q</span>ueues</div><div class="t m0 x32 h2a yffe ff19 fsf fc0 sc0 lsd22 ws0">Am<span class="_ _8"></span><span class="ls0">essage <span class="_ _3"></span>queue <span class="_ _3"></span>is <span class="_ _2"></span>a <span class="_ _3"></span>linked <span class="_ _3"></span>list <span class="_ _2"></span>of <span class="_ _3"></span>messages <span class="_ _3"></span>stored <span class="_ _2"></span>within <span class="_ _3"></span>the <span class="_ _3"></span>kernel <span class="_ _2"></span>and <span class="_ _3"></span>identiﬁed <span class="_ _3"></span>by</span></div><div class="t m0 x32 h2b yfff ff19 fsf fc0 sc0 ls1216 ws0">am<span class="_ _4f"></span><span class="ls0">essage <span class="_ _2"></span>queue <span class="_ _2"></span>identiﬁer<span class="_ _1"></span><span class="ls1167">.W<span class="_ _7"></span><span class="ls0">e’ll <span class="_ _2"></span>call <span class="_ _2"></span>the <span class="_ _3"></span>message <span class="_ _2"></span>queue <span class="_ _2"></span>just <span class="_ _2"></span>a<span class="_ _66"> </span><span class="ff1b">queue<span class="_ _47"> </span></span>and <span class="_ _2"></span>its <span class="_ _2"></span>identiﬁer <span class="_ _2"></span>a</span></span></span></div><div class="t m0 x32 h2b y43d3 ff1b fsf fc0 sc0 ls0 ws0">queue ID<span class="ff19">.</span></div><div class="t m0 x76 h51 y43d4 ff19 fs2a fc0 sc0 ls0 ws0">The <span class="_ _23"> </span>Single <span class="_ _23"> </span>UNIX <span class="_ _23"> </span>Speciﬁcation <span class="_ _23"> </span>message-passing <span class="_ _42"> </span>option <span class="_ _23"> </span>includes <span class="_ _23"> </span>an <span class="_ _23"> </span>alternative <span class="_ _23"> </span>IPC <span class="_ _23"> </span>message</div><div class="t m0 x76 h51 y43d5 ff19 fs2a fc0 sc0 ls0 ws0">queue <span class="_ _2"></span>interface derived <span class="_ _2"></span>from <span class="_ _2"></span>the <span class="_ _2"></span>POSIX <span class="_ _2"></span>real-time extensions.<span class="_ _4b"> </span><span class="lsed">We <span class="_ _42"> </span>d<span class="_ _9"></span><span class="ls1217">on<span class="_ _5"></span><span class="ls0">ot <span class="_ _2"></span>discuss <span class="_ _2"></span>it <span class="_ _2"></span>in <span class="_ _2"></span>this <span class="_ _2"></span>text.</span></span></span></div><div class="t m0 x3f h26 y50c ff19 fsf fc0 sc0 ls1218 ws0">An<span class="_ _43"></span><span class="ls0">ew <span class="_ _23"> </span>queue <span class="_ _23"> </span>is <span class="_ _23"> </span>created <span class="_ _23"> </span>or <span class="_ _23"> </span>an <span class="_ _23"> </span>existing <span class="_ _23"> </span>queue <span class="_ _23"> </span>opened <span class="_ _23"> </span>by<span class="_ _35"> </span><span class="ff1a">msgget</span><span class="ls8e8">.N<span class="_ _26"></span><span class="ls0">ew <span class="_ _23"></span>messages</span></span></span></div><div class="t m0 x32 h26 y50d ff19 fsf fc0 sc0 ls0 ws0">ar<span class="ls6e0">ea<span class="_ _8"></span><span class="ls0">dded <span class="_ _2"></span>to <span class="_ _3"></span>the <span class="_ _2"></span>end <span class="_ _3"></span>of <span class="_ _2"></span>a <span class="_ _3"></span>queue <span class="_ _2"></span>by<span class="_ _47"> </span><span class="ff1a">msgsnd</span><span class="lscef">.E<span class="_ _1d"></span><span class="ls0">very <span class="_ _3"></span>message <span class="_ _2"></span>has <span class="_ _3"></span>a <span class="_ _2"></span>positive <span class="_ _3"></span>long <span class="_ _2"></span>integer</span></span></span></span></div><div class="t m0 x32 h2a y50e ff19 fsf fc0 sc0 ls0 ws0">type <span class="_ _66"> </span>ﬁeld, <span class="_ _47"> </span>a <span class="_ _66"> </span>non-negative <span class="_ _47"> </span>length, <span class="_ _66"> </span>and <span class="_ _47"> </span>the <span class="_"> </span>actual <span class="_ _47"> </span>data <span class="_ _66"> </span>bytes <span class="_ _47"> </span>(corresponding <span class="_"> </span>to <span class="_ _47"> </span>the</div><div class="t m0 x32 h26 y50f ff19 fsf fc0 sc0 ls0 ws0">length), <span class="_ _23"> </span>all <span class="_ _23"> </span>of <span class="_ _23"> </span>which <span class="_ _42"> </span>ar<span class="ls86a">es<span class="_ _43"></span><span class="ls0">peciﬁed <span class="_ _23"></span>to<span class="_ _35"> </span><span class="ff1a">msgsnd<span class="_ _35"> </span></span>when <span class="_ _23"></span>the <span class="_ _23"> </span>message <span class="_ _23"> </span>is <span class="_ _23"> </span>added <span class="_ _42"> </span>to <span class="_ _23"></span>a <span class="_ _23"> </span>queue.</span></span></div><div class="t m0 x32 h26 y510 ff19 fsf fc0 sc0 ls0 ws0">Messages <span class="_ _2"></span>ar<span class="ls1219">ef<span class="_ _8"></span><span class="ls0">etched <span class="_ _3"></span>from a <span class="_ _2"></span>queue <span class="_ _3"></span>by<span class="_ _47"> </span><span class="ff1a">msgrcv</span><span class="ls121a">.W<span class="_ _7"></span><span class="ls1219">ed<span class="_ _4f"></span><span class="ls0">on’t <span class="_ _2"></span>have <span class="_ _2"></span>to <span class="_ _3"></span>fetch <span class="_ _2"></span>the <span class="_ _2"></span>messages <span class="_ _3"></span>in</span></span></span></span></span></div><div class="t m0 x32 h2a y511 ff19 fsf fc0 sc0 ls44 ws0">aﬁ<span class="_ _d"></span><span class="ls0">rst-in, ﬁrst-out order<span class="_ _6"></span><span class="ls86">.I<span class="_ _4a"></span><span class="ls0">nstead, we can fetch messages based on their type ﬁeld.</span></span></span></div><div class="t m0 x3f h26 y512 ff19 fsf fc0 sc0 ls0 ws0">Each queue has the following<span class="_"> </span><span class="ff1a">msqid_ds<span class="_ _80"> </span></span>structur<span class="ls44">ea<span class="_ _4f"></span><span class="ls0">ssociated with it:</span></span></div><div class="t m0 x3f h57 y43d6 ff1a fs2d fc0 sc0 ls0 ws0">struct msqid_ds {</div><div class="t m0 xf4 h57 y43d7 ff1a fs2d fc0 sc0 ls0 ws0">struct ipc_perm<span class="_ _d9"> </span>msg_perm; <span class="_ _15"> </span>/*<span class="_"> </span>see Section 15.6.2 */</div><div class="t m0 xf4 h57 y43d8 ff1a fs2d fc0 sc0 ls0 ws0">msgqnum_t <span class="_ _b7"> </span>msg_qnum;<span class="_ _8a"> </span>/* # of messages on queue */</div><div class="t m0 xf4 h57 y43d9 ff1a fs2d fc0 sc0 ls0 ws0">msglen_t <span class="_ _186"> </span>msg_qbytes;<span class="_ _68"> </span>/* max # of bytes on queue */</div><div class="t m0 xf4 h57 y43da ff1a fs2d fc0 sc0 ls0 ws0">pid_t <span class="_ _bd"> </span>msg_lspid;<span class="_ _15"> </span>/* pid of last msgsnd() */</div><div class="t m0 xf4 h57 y43db ff1a fs2d fc0 sc0 ls0 ws0">pid_t <span class="_ _bd"> </span>msg_lrpid;<span class="_ _15"> </span>/* pid of last msgrcv() */</div><div class="t m0 xf4 h57 y43dc ff1a fs2d fc0 sc0 ls0 ws0">time_t <span class="_ _74"> </span>msg_stime;<span class="_ _15"> </span>/* last-msgsnd() time */</div><div class="t m0 xf4 h57 y43dd ff1a fs2d fc0 sc0 ls0 ws0">time_t <span class="_ _74"> </span>msg_rtime;<span class="_ _15"> </span>/* last-msgrcv() time */</div><div class="t m0 xf4 h57 y43de ff1a fs2d fc0 sc0 ls0 ws0">time_t <span class="_ _74"> </span>msg_ctime;<span class="_ _15"> </span>/* last-change time */</div><div class="t m0 xf4 h57 y43df ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 xf4 h57 y43e0 ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 xf4 h57 y43e1 ff1a fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 x3f h57 y43e2 ff1a fs2d fc0 sc0 ls0 ws0">};</div><div class="t m0 x32 h2a y43e3 ff19 fsf fc0 sc0 ls0 ws0">This structur<span class="ls5cc">ed<span class="_ _4f"></span><span class="ls0">eﬁnes <span class="_ _2"></span>the current status <span class="_ _2"></span>of the <span class="_ _2"></span>queue.<span class="_ _61"> </span>The members <span class="_ _2"></span>shown <span class="_ _2"></span>ar<span class="ls121b">et<span class="_ _4f"></span><span class="ls0">he ones</span></span></span></span></div><div class="t m0 x32 h2a y43e4 ff19 fsf fc0 sc0 ls0 ws0">deﬁned <span class="_ _53"> </span>by <span class="_ _53"> </span>the <span class="_ _53"> </span>Single <span class="_ _53"> </span>UNIX <span class="_ _53"> </span>Speciﬁcation.<span class="_ _54"> </span>Implementations <span class="_ _53"> </span>include <span class="_ _53"> </span>additional <span class="_ _53"> </span>ﬁelds</div><div class="t m0 x32 h2a y43e5 ff19 fsf fc0 sc0 ls0 ws0">not covered by the standar<span class="_ _0"></span>d.</div><div class="t m0 x1e9 h2d y43e6 ff19 fs10 fc0 sc0 ls277 ws0">Ty<span class="_ _3"></span><span class="ls0">pical values</span></div><div class="t m0 x1f9 h2e y43e7 ff19 fs11 fc0 sc0 ls0 ws0">FreeBSD <span class="_ _210"> </span>Linux <span class="_ _9b"> </span>Mac<span class="_"> </span>OS X<span class="_ _9b"> </span>Solaris</div><div class="t m0 x5d h2e y43e8 ff19 fs11 fc0 sc0 ls0 ws0">8.0 <span class="_ _dc"> </span>3.2.0<span class="_ _1a8"> </span>10.6.8 <span class="_ _8a"> </span>10</div><div class="t m0 x38 h2e y43e9 ff19 fs11 fc0 sc0 ls0 ws0">Description</div><div class="t m0 x173 h2f y43ea ff19 fs12 fc0 sc0 ls0 ws0">16,384 <span class="_ _76"> </span>8,192<span class="_ _76"> </span>16,384 <span class="_ _87"> </span>derived<span class="_ _2bd"></span>size in bytes of largest message we can send</div><div class="t m0 x225 h2f y43eb ff19 fs12 fc0 sc0 ls0 ws0">2,048 <span class="_ _75"> </span>16,384<span class="_ _1a8"> </span>2,048 <span class="_ _72"> </span>65,536<span class="_ _2be"></span>maximum size in bytes of a particular queue (i.e.,</div><div class="t m0 xf4 h2f y43ec ff19 fs12 fc0 sc0 ls0 ws0">the sum of all the sizes of messages on the queue)</div><div class="t m0 x1d9 h2f y43ed ff19 fs12 fc0 sc0 ls0 ws0">40 <span class="_ _1bb"> </span>derived<span class="_ _88"> </span>40 <span class="_ _db"> </span>128<span class="_ _2be"></span>maximum number of messages queues, systemwide</div><div class="t m0 x1d9 h2f y43ee ff19 fs12 fc0 sc0 ls0 ws0">40 <span class="_ _1bb"> </span>derived<span class="_ _88"> </span>40 <span class="_ _bf"> </span>8,192<span class="_ _2be"></span>maximum number of messages, systemwide</div><div class="t m0 x89 h30 y43ef ff18 fs13 fc0 sc0 ls0 ws0">Figure 15.26<span class="_ _5a"> </span><span class="ff19">System limits that affect message queues</span></div><div class="t m0 x3f h6e y43f0 ff19 fs31 fc0 sc0 ls0 ws0">Figur<span class="ls121c">e1<span class="_ _b"></span><span class="ls0">5.26 <span class="_ _3"></span>lists <span class="_ _3"></span>the <span class="_ _3"></span>system <span class="_ _3"></span>limits <span class="_ _3"></span>that <span class="_ _2"></span>affect <span class="_ _3"></span>message <span class="_ _2"></span>queues.<span class="_ _16"> </span><span class="ls43f">We <span class="_ _80"> </span>s<span class="_ _9"></span></span>how <span class="_ _3"></span>‘‘derived’<span class="_ _1"></span>’</span></span></div><div class="t m0 x32 h6e y43f1 ff19 fs31 fc0 sc0 ls0 ws0">wher<span class="ls121d">eal<span class="_ _5b"></span><span class="ls0">imit <span class="_"> </span>is <span class="_"> </span>derived <span class="_ _66"> </span>from <span class="_"> </span>other <span class="_"> </span>limits.<span class="_ _60"> </span>On <span class="_ _66"> </span>Linux, <span class="_"> </span>for <span class="_ _66"> </span>example, <span class="_"> </span>the <span class="_ _66"> </span>maximum</span></span></div><div class="t m0 x32 h6e y43f2 ff19 fs31 fc0 sc0 ls0 ws0">number <span class="_ _23"> </span>of <span class="_ _23"> </span>messages <span class="_ _42"> </span>is <span class="_ _23"> </span>based <span class="_ _23"> </span>on <span class="_ _42"> </span>the <span class="_ _23"></span>maximum <span class="_ _23"> </span>number <span class="_ _23"> </span>of <span class="_ _42"> </span>queues <span class="_ _23"> </span>and <span class="_ _23"> </span>the <span class="_ _42"> </span>maximum</div><div class="t m0 x32 h6e y43f3 ff19 fs31 fc0 sc0 ls0 ws0">amount <span class="_ _23"> </span>of <span class="_ _23"> </span>data <span class="_ _23"> </span>allowed <span class="_ _42"> </span>on <span class="_ _23"></span>the <span class="_ _23"> </span>queues.<span class="_ _51"> </span>The <span class="_ _23"> </span>maximum <span class="_ _42"> </span>number <span class="_ _23"></span>of <span class="_ _23"></span>queues, <span class="_ _23"> </span>in <span class="_ _23"> </span>turn, <span class="_ _42"> </span>is</div><div class="t m0 x32 h6e y43f4 ff19 fs31 fc0 sc0 ls0 ws0">based <span class="_ _9"></span>on <span class="_ _23"></span>the <span class="_ _23"></span>amount <span class="_ _9"></span>of <span class="_ _23"></span>RAM <span class="_ _9"></span>installed <span class="_ _23"></span>in <span class="_ _23"></span>the <span class="_ _9"></span>system.<span class="_ _51"> </span>Note <span class="_ _9"></span>that <span class="_ _23"></span>the <span class="_ _9"></span>queue <span class="_ _23"></span>maximum</div><div class="t m0 x32 h6e y43f5 ff19 fs31 fc0 sc0 ls0 ws0">byte size limit further limits the maximum size of a message to be placed on a queue.</div><a class="l" href="#pf12" data-dest-detail='[18,"XYZ",50,757,1]'><div class="d m1" style="border-style:none;position:absolute;left:80.892409px;bottom:1236.288916px;width:137.375801px;height:19.679993px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
