<div id="pfe0" class="pf w4 h1f" data-page-no="e0"><div class="pc pce0 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bge0.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">190<span class="_ _1b"> </span><span class="ff19">System <span class="_"> </span>Data <span class="_"> </span>Files <span class="_"> </span>and <span class="_"> </span>Information<span class="_ _114"> </span>Chapter <span class="_"> </span>6</span></div><div class="t m0 x3f h26 y12f ff19 fsf fc0 sc0 ls0 ws0">When <span class="_ _47"> </span>the <span class="_ _66"> </span>clock <span class="_ _47"> </span>ID <span class="_ _47"> </span>is <span class="_ _47"> </span>set <span class="_ _47"> </span>to<span class="_ _61"> </span><span class="ff1a">CLOCK_REALTIME</span><span class="ls7f3">,t<span class="_ _1d"></span><span class="ls0">he<span class="_ _16"> </span><span class="ff1a">clock_gettime<span class="_ _61"> </span></span>function</span></span></div><div class="t m0 x32 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">provides <span class="_ _9"></span>similar <span class="_ _9"></span>functionality <span class="_ _23"></span>to <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">time<span class="_ _35"> </span></span>function, <span class="_ _9"></span>except <span class="_ _23"></span>with<span class="_ _45"> </span><span class="ff1a">clock_gettime</span><span class="ls7f4">,w<span class="_ _b"></span><span class="ls0">e</span></span></div><div class="t m0 x32 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">might be able to get a higher-r<span class="_ _0"></span>esolution time value if the system supports it.</div><div class="t m0 x3f h26 y132 ff19 fsf fc0 sc0 ls5f ws0">We <span class="_ _35"> </span>c<span class="_ _9"></span><span class="ls0">an <span class="_ _e"> </span>use <span class="_ _53"> </span>the<span class="_ _59"> </span><span class="ff1a">clock_getres<span class="_ _4b"> </span></span>function <span class="_ _53"> </span>to <span class="_ _e"> </span>determine <span class="_ _e"> </span>the <span class="_ _53"> </span>resolution <span class="_ _53"> </span>of <span class="_ _e"> </span>a <span class="_ _e"> </span>given</span></div><div class="t m0 x32 h2a y133 ff19 fsf fc0 sc0 ls0 ws0">system clock.</div><div class="t m0 x3f h57 y19a8 ff1a fs2d fc0 sc0 ls0 ws0">#include &lt;sys/time.h&gt;</div><div class="t m0 x3f h57 y19a9 ff1a fs2d fc0 sc0 ls0 ws0">int clock_getres(clockid_t<span class="_"> </span><span class="ff1b">clock_id</span><span class="ls15c">,s<span class="_ _1d"></span><span class="ls0">truct timespec *<span class="ff1b">tsp</span>);</span></span></div><div class="t m0 x153 h5f y19aa ff19 fs2d fc0 sc0 ls0 ws0">Returns: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x3f h4d y19ab ff19 fs26 fc0 sc0 ls0 ws0">The<span class="_ _45"> </span><span class="ff1a">clock_getres<span class="_ _45"> </span></span>function <span class="_ _9"></span>initializes <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">timespec<span class="_ _45"> </span></span>structur<span class="ls7f5">ep<span class="_ _b"></span><span class="ls0">ointed <span class="_ _3"></span>to <span class="_ _9"></span>by <span class="_ _23"></span>the</span></span></div><div class="t m0 x32 h4a y19ac ff1b fs26 fc0 sc0 ls0 ws0">tsp<span class="_ _47"> </span><span class="ff19">argument <span class="_ _2"></span>to <span class="_ _3"></span>the <span class="_ _3"></span>resolution <span class="_ _3"></span>of <span class="_ _3"></span>the <span class="_ _3"></span>clock <span class="_ _3"></span>corresponding <span class="_ _2"></span>to <span class="_ _3"></span>the<span class="_ _47"> </span></span>clock_id<span class="_ _47"> </span><span class="ff19">argument. <span class="_ _47"> </span>For</span></div><div class="t m0 x32 h4d y19ad ff19 fs26 fc0 sc0 ls0 ws0">example, <span class="_ _2"></span>if <span class="_ _3"></span>the <span class="_ _3"></span>resolution <span class="_ _2"></span>is <span class="_ _2"></span>1 <span class="_ _3"></span>millisecond, <span class="_ _3"></span>then <span class="_ _3"></span>the<span class="_ _47"> </span><span class="ff1a">tv_sec<span class="_ _47"> </span></span>ﬁeld <span class="_ _2"></span>will <span class="_ _3"></span>contain <span class="_ _2"></span>0 <span class="_ _3"></span>and <span class="_ _3"></span>the</div><div class="t m0 x32 h4d y19ae ff1a fs26 fc0 sc0 ls0 ws0">tv_nsec<span class="_ _80"> </span><span class="ff19">ﬁeld will contain the value 1000000.</span></div><div class="t m0 x3f h4d y19af ff19 fs26 fc0 sc0 ls164 ws0">To <span class="_ _53"> </span>s<span class="_ _9"></span><span class="ls0">et the time for a particular clock, we can call the<span class="_"> </span><span class="ff1a">clock_settime<span class="_ _66"> </span></span>function.</span></div><div class="t m0 x3f h4e y19b0 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;sys/time.h&gt;</div><div class="t m0 x3f h4e y19b1 ff1a fs28 fc0 sc0 ls0 ws0">int clock_settime(clockid_t<span class="_"> </span><span class="ff1b">clock_id</span><span class="ls1b6">,c<span class="_ _1d"></span><span class="ls0">onst struct timespec *<span class="ff1b">tsp</span>);</span></span></div><div class="t m0 x153 h7c y19b2 ff19 fs28 fc0 sc0 ls0 ws0">Returns: 0 if OK,<span class="_"> </span><span class="ff20">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m0 x32 h55 y19b3 ff19 fs2c fc0 sc0 ls155 ws0">We <span class="_ _45"> </span>n<span class="_ _9"></span><span class="ls0">eed <span class="_ _53"> </span>the <span class="_ _53"> </span>appropriate <span class="_ _42"> </span>privileges <span class="_ _53"> </span>to <span class="_ _42"> </span>change <span class="_ _53"> </span>a <span class="_ _53"> </span>clock’s <span class="_ _42"> </span>time.<span class="_ _65"> </span>Some <span class="_ _42"> </span>clocks, <span class="_ _53"> </span>however<span class="_ _1"></span>,</span></div><div class="t m0 x32 h55 y19b4 ff19 fs2c fc0 sc0 ls0 ws0">can’t be modiﬁed.</div><div class="t m0 x76 h4f y19b5 ff19 fs11 fc0 sc0 ls0 ws0">Historically<span class="_ _6"></span>,<span class="_ _66"> </span>on<span class="_ _66"> </span>implementations <span class="_ _3"></span>derived <span class="_ _3"></span>from <span class="_ _3"></span>System <span class="_ _9"></span>V<span class="_ _4"></span><span class="ls7f6">,t<span class="_ _d"></span><span class="ls0">he<span class="_ _66"> </span><span class="ff1a">stime</span></span></span></div><div class="t m0 x168 h2e y19b6 ff19 fs11 fc0 sc0 ls0 ws0">(</div><div class="t m0 xd3 h2e y19b5 ff19 fs11 fc0 sc0 ls0 ws0">2</div><div class="t m0 x1b1 h2e y19b6 ff19 fs11 fc0 sc0 ls0 ws0">)</div><div class="t m0 xbd h2e y19b5 ff19 fs11 fc0 sc0 ls0 ws0">function <span class="_ _3"></span>was <span class="_ _3"></span>called <span class="_ _9"></span>to</div><div class="t m0 x76 h4f y19b7 ff19 fs11 fc0 sc0 ls0 ws0">set the system time, whereas BSD-derived systems used<span class="_"> </span><span class="ff1a">settimeofday</span></div><div class="t m0 x152 h2e y19b8 ff19 fs11 fc0 sc0 ls0 ws0">(</div><div class="t m0 x169 h2e y19b7 ff19 fs11 fc0 sc0 ls0 ws0">2</div><div class="t m0 x11e h2e y19b8 ff19 fs11 fc0 sc0 ls0 ws0">)</div><div class="t m0 x1d7 h2e y19b7 ff19 fs11 fc0 sc0 ls0 ws0">.</div><div class="t m0 x3f h54 y19b9 ff19 fs2c fc0 sc0 ls7f7 ws0">Ve<span class="_ _23"></span><span class="ls0">rsion <span class="_ _45"> </span>4 <span class="_ _35"> </span>of <span class="_ _45"> </span>the <span class="_ _45"> </span>Single <span class="_ _35"> </span>UNIX <span class="_ _45"> </span>Speciﬁcation <span class="_ _35"> </span>speciﬁes <span class="_ _45"> </span>that <span class="_ _45"> </span>the<span class="_ _51"> </span><span class="ff1a">gettimeofday</span></span></div><div class="t m0 x32 h55 y19ba ff19 fs2c fc0 sc0 ls0 ws0">function <span class="_ _2"></span>is <span class="_ _2"></span>now <span class="_ _2"></span>obsolescent.<span class="_ _61"> </span>However<span class="_ _6"></span><span class="ls7f8">,al<span class="_ _d"></span><span class="ls0">ot <span class="_ _2"></span>of <span class="_ _2"></span>programs still <span class="_ _2"></span>use <span class="_ _3"></span>it, <span class="_ _2"></span>because <span class="_ _2"></span>it <span class="_ _2"></span>provides</span></span></div><div class="t m0 x32 h54 y19bb ff19 fs2c fc0 sc0 ls0 ws0">greater r<span class="_ _0"></span>esolution (up to a micr<span class="_ _0"></span>osecond) than the<span class="_"> </span><span class="ff1a">time<span class="_ _80"> </span></span>function.</div><div class="t m0 x3f h5d y19bc ff1a fs2f fc0 sc0 ls0 ws0">#include &lt;sys/time.h&gt;</div><div class="t m0 x3f h5d y19bd ff1a fs2f fc0 sc0 ls0 ws0">int gettimeofday(struct timeval *restrict<span class="_"> </span><span class="ff1b">tp</span><span class="ls395">,v<span class="_ _1d"></span><span class="ls0">oid *restrict<span class="_"> </span><span class="ff1b">tzp</span>);</span></span></div><div class="t m0 xd3 hc2 y19be ff19 fs2f fc0 sc0 ls0 ws0">Returns: 0 always</div><div class="t m0 x32 h5c y19bf ff19 fs29 fc0 sc0 ls0 ws0">The <span class="_ _3"></span>only <span class="_ _9"></span>legal <span class="_ _3"></span>value <span class="_ _3"></span>for<span class="_ _45"> </span><span class="ff1b">tzp<span class="_ _47"> </span></span>is<span class="_ _45"> </span><span class="ff1a">NULL</span><span class="ls7f9">;o<span class="_ _b"></span><span class="ls0">ther <span class="_ _9"></span>values <span class="_ _3"></span>result <span class="_ _3"></span>in <span class="_ _3"></span>unspeciﬁed <span class="_ _9"></span>behavior<span class="_ _6"></span><span class="ls7fa">.S<span class="_ _1d"></span><span class="ls0">ome</span></span></span></span></div><div class="t m0 x32 h5b y19c0 ff19 fs29 fc0 sc0 ls0 ws0">platforms <span class="_ _42"> </span>support <span class="_ _42"> </span>the <span class="_ _42"> </span>speciﬁcation <span class="_ _42"> </span>of <span class="_ _53"> </span>a <span class="_ _42"> </span>time <span class="_ _42"> </span>zone <span class="_ _42"> </span>through <span class="_ _42"> </span>the <span class="_ _42"> </span>use <span class="_ _42"> </span>of<span class="_ _44"> </span><span class="ff1b">tzp</span><span class="ls7fb">,b<span class="_ _43"></span><span class="ls0">ut <span class="_ _23"> </span>this <span class="_ _53"> </span>is</span></span></div><div class="t m0 x32 h50 y19c1 ff19 fs29 fc0 sc0 ls0 ws0">implementation speciﬁc and not deﬁned by the Single UNIX Speciﬁcation.</div><div class="t m0 x3f h5c y19c2 ff19 fs29 fc0 sc0 ls0 ws0">The<span class="_"> </span><span class="ff1a">gettimeofday<span class="_ _80"> </span></span>function stores the current time as measur<span class="_ _0"></span>ed from the Epoch in</div><div class="t m0 x32 h5c y19c3 ff19 fs29 fc0 sc0 ls0 ws0">the <span class="_ _9"></span>memory <span class="_ _9"></span>pointed <span class="_ _9"></span>to <span class="_ _9"></span>by<span class="_ _45"> </span><span class="ff1b">tp</span><span class="ls7fc">.T<span class="_ _62"></span><span class="ls0">his <span class="_ _9"></span>time <span class="_ _9"></span>is <span class="_ _9"></span>represented <span class="_ _3"></span>as <span class="_ _9"></span>a<span class="_ _45"> </span><span class="ff1a">timeval<span class="_ _45"> </span></span>structure, <span class="_ _9"></span>which</span></span></div><div class="t m0 x32 h50 y19c4 ff19 fs29 fc0 sc0 ls0 ws0">stores seconds and micr<span class="_ _0"></span>oseconds.</div><div class="t m0 x3f h50 y19c5 ff19 fs29 fc0 sc0 ls0 ws0">Once <span class="_ _2"></span>we <span class="_ _2"></span>have <span class="_ _2"></span>the <span class="_ _3"></span>integer <span class="_ _2"></span>value <span class="_ _2"></span>that <span class="_ _2"></span>counts <span class="_ _3"></span>the <span class="_ _2"></span>number <span class="_ _2"></span>of <span class="_ _2"></span>seconds <span class="_ _3"></span>since <span class="_ _2"></span>the <span class="_ _2"></span>Epoch,</div><div class="t m0 x32 h50 y19c6 ff19 fs29 fc0 sc0 ls0 ws0">we <span class="_ _2"></span>normally <span class="_ _2"></span>call <span class="_ _3"></span>a <span class="_ _2"></span>function <span class="_ _3"></span>to <span class="_ _2"></span>convert <span class="_ _3"></span>it <span class="_ _2"></span>to <span class="_ _3"></span>a <span class="_ _2"></span>broken-down <span class="_ _2"></span>time <span class="_ _2"></span>structure, <span class="_ _2"></span>and <span class="_ _2"></span>then <span class="_ _3"></span>call</div><div class="t m0 x32 h50 y19c7 ff19 fs29 fc0 sc0 ls0 ws0">another <span class="_ _42"> </span>function <span class="_ _53"> </span>to <span class="_ _42"> </span>generate <span class="_ _53"> </span>a <span class="_ _53"> </span>human-readable <span class="_ _42"> </span>time <span class="_ _42"> </span>and <span class="_ _53"> </span>date.<span class="_ _54"> </span>Figur<span class="ls7fd">e6<span class="_ _c"></span><span class="ls0">.9 <span class="_ _53"> </span>shows <span class="_ _42"> </span>the</span></span></div><div class="t m0 x32 h50 y19c8 ff19 fs29 fc0 sc0 lsdf ws0">re<span class="ls0">lationships between the various time functions.<span class="_ _46"> </span>(The three functions in this ﬁgur<span class="ls7fe">et<span class="_ _4f"></span><span class="ls0">hat</span></span></span></div><div class="t m0 x32 h5c y19c9 ff19 fs29 fc0 sc0 ls0 ws0">ar<span class="ls7ff">es<span class="_ _b"></span><span class="ls0">hown <span class="_ _3"></span>with <span class="_ _23"></span>dashed <span class="_ _9"></span>lines<span class="_ _9"></span>—<span class="_ _9"></span><span class="ff1a">localtime</span>,<span class="_ _45"> </span><span class="ff1a">mktime</span><span class="ls800">,a<span class="_ _b"></span><span class="ls0">nd<span class="_ _45"> </span><span class="ff1a">strftime<span class="_ _9"></span></span><span class="ls2d6">—a<span class="_ _6"></span><span class="lsdf">re <span class="_ _42"> </span>a<span class="ls0">ll <span class="_ _23"></span>af<span class="_ _0"></span>fected</span></span></span></span></span></span></span></div><div class="t m0 x32 h5c y19ca ff19 fs29 fc0 sc0 ls0 ws0">by <span class="_ _42"> </span>the<span class="_ _44"> </span><span class="ff1a">TZ<span class="_ _44"> </span></span>environment <span class="_ _42"> </span>variable, <span class="_ _42"> </span>which <span class="_ _53"> </span>we <span class="_ _42"> </span>describe <span class="_ _53"> </span>later <span class="_ _42"> </span>in <span class="_ _53"> </span>this <span class="_ _42"> </span>section.<span class="_ _54"> </span>The <span class="_ _53"> </span>dotted</div><div class="t m0 x32 h50 y19cb ff19 fs29 fc0 sc0 ls0 ws0">lines show how the calendar time is obtained from time-r<span class="_ _0"></span>elated structur<span class="_ _0"></span>es.)</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
