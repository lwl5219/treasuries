<div id="pf94" class="pf w4 h1f" data-page-no="94"><div class="pc pc94 w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg94.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls153 ws0">11<span class="_ _2"></span><span class="ls0">4<span class="_ _1b"> </span><span class="ff19">Files <span class="_"> </span>and <span class="_"> </span>Directories <span class="_ _199"> </span>Chapter<span class="_ _4b"> </span>4</span></span></div><div class="t m0 x3f h2a y12f ff19 fsf fc0 sc0 ls0 ws0">If <span class="_ _2"></span>we <span class="_ _3"></span>examine <span class="_ _2"></span>the <span class="_ _2"></span>i-node <span class="_ _3"></span>and <span class="_ _2"></span>data <span class="_ _3"></span>block <span class="_ _2"></span>portion <span class="_ _3"></span>of <span class="_ _2"></span>a <span class="_ _3"></span>cylinder <span class="_ _2"></span>group <span class="_ _2"></span>in <span class="_ _3"></span>mor<span class="ls511">ed<span class="_ _8"></span><span class="ls0">etail,</span></span></div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">we could have the arrangement shown in Figur<span class="ls44">e4<span class="_ _4f"></span><span class="ls0">.14.</span></span></div><div class="t m0 x139 h9f y1079 ff19 fs39 fc0 sc0 ls0 ws0">i-node array</div><div class="t m0 x63 h81 y107a ff19 fs3f fc0 sc0 ls0 ws0">data</div><div class="t m0 xb7 h81 y107b ff19 fs3f fc0 sc0 ls0 ws0">block</div><div class="t m0 x86 h82 y107c ff19 fs40 fc0 sc0 ls0 ws0">data</div><div class="t m0 x9b h82 y107d ff19 fs40 fc0 sc0 ls0 ws0">block</div><div class="t m0 x19c ha0 y107e ff19 fs4c fc0 sc0 ls0 ws0">directory</div><div class="t m0 x19d ha0 y107f ff19 fs4c fc0 sc0 ls0 ws0">block</div><div class="t m0 x16a h8b y1080 ff19 fs46 fc0 sc0 ls0 ws0">data</div><div class="t m0 xfc h8b y1081 ff19 fs46 fc0 sc0 ls0 ws0">block</div><div class="t m0 x19e h7f y1082 ff19 fs3d fc0 sc0 ls0 ws0">directory</div><div class="t m0 x19f h7f y1083 ff19 fs3d fc0 sc0 ls0 ws0">block</div><div class="t m0 x92 h84 y1084 ff19 fs41 fc0 sc0 ls0 ws0">directory blocks and data blocks</div><div class="t m0 x1a0 ha1 y1085 ff19 fs4d fc0 sc0 ls0 ws0">i-node</div><div class="t m0 x79 ha2 y1086 ff19 fs4e fc0 sc0 ls0 ws0">i-node</div><div class="t m0 xe8 h86 y1087 ff19 fs42 fc0 sc0 ls0 ws0">i-node</div><div class="t m0 x17f ha3 y1088 ff19 fs4f fc0 sc0 ls0 ws0">i-node</div><div class="t m2 x30 ha4 y1089 ff19 fs50 fc0 sc0 ls0 ws0">ﬁrst data block</div><div class="t m3 x8c ha5 y108a ff19 fs51 fc0 sc0 ls0 ws0">second data block</div><div class="t m4 x24 ha6 y108b ff19 fs52 fc0 sc0 ls0 ws0">thir<span class="ls512">dd<span class="_ _84"></span><span class="ls0">ata block</span></span></div><div class="t m0 x107 ha7 y108c ff19 fs53 fc0 sc0 ls0 ws0">i-node</div><div class="t m0 x77 ha7 y108d ff19 fs53 fc0 sc0 ls0 ws0">number</div><div class="t m0 x6d ha8 y108e ff19 fs54 fc0 sc0 ls0 ws0">ﬁlename</div><div class="t m0 x111 ha9 y108f ff19 fs55 fc0 sc0 ls0 ws0">i-node</div><div class="t m0 x1a1 ha9 y1090 ff19 fs55 fc0 sc0 ls0 ws0">number</div><div class="t m0 x11c haa y1091 ff19 fs56 fc0 sc0 ls0 ws0">ﬁlename</div><div class="t m0 x8 hab y1092 ff18 fs57 fc0 sc0 ls0 ws0">Figure 4.14<span class="_ _5a"> </span><span class="ff19">Cylinder group’s i-nodes and data blocks in mor<span class="ls513">ed<span class="_ _5"></span><span class="ls0">etail</span></span></span></div><div class="t m0 x32 hac y1093 ff19 fs58 fc0 sc0 ls0 ws0">Note the following points from Figur<span class="_ _0"></span><span class="ls514">e4<span class="_ _d"></span><span class="ls0">.14.</span></span></div><div class="t m0 x32 hac y1094 ff19 fs58 fc0 sc0 ls515 ws0">•T<span class="_ _4e"></span><span class="ls0">wo <span class="_ _9"></span>directory <span class="_ _3"></span>entries <span class="_ _3"></span>point <span class="_ _9"></span>to <span class="_ _3"></span>the <span class="_ _9"></span>same <span class="_ _3"></span>i-node <span class="_ _9"></span>entry<span class="_ _6"></span><span class="ls516">.E<span class="_ _62"></span><span class="ls0">very <span class="_ _3"></span>i-node <span class="_ _9"></span>has <span class="_ _9"></span>a <span class="_ _3"></span>link <span class="_ _9"></span>count</span></span></span></div><div class="t m0 x14a hac y1095 ff19 fs58 fc0 sc0 ls0 ws0">that <span class="_ _23"> </span>contains <span class="_ _42"> </span>the <span class="_ _23"> </span>number <span class="_ _42"> </span>of <span class="_ _42"> </span>directory <span class="_ _23"></span>entries <span class="_ _23"> </span>that <span class="_ _42"> </span>point <span class="_ _23"> </span>to <span class="_ _42"> </span>it.<span class="_ _51"> </span>Only <span class="_ _42"> </span>when <span class="_ _23"> </span>the <span class="_ _42"> </span>link</div><div class="t m0 x14a hac y1096 ff19 fs58 fc0 sc0 ls0 ws0">count <span class="_ _9"></span>goes <span class="_ _9"></span>to <span class="_ _9"></span>0 <span class="_ _9"></span>can <span class="_ _9"></span>the <span class="_ _9"></span>ﬁle <span class="_ _9"></span>be <span class="_ _9"></span>deleted <span class="_ _9"></span>(thereby <span class="_ _3"></span>releasing <span class="_ _9"></span>the <span class="_ _9"></span>data <span class="_ _9"></span>blocks <span class="_ _9"></span>associated</div><div class="t m0 x14a hac y1097 ff19 fs58 fc0 sc0 ls0 ws0">with <span class="_ _2"></span>the <span class="_ _3"></span>ﬁle).<span class="_ _16"> </span>This <span class="_ _2"></span>is <span class="_ _3"></span>why <span class="_ _3"></span>the <span class="_ _3"></span>operation <span class="_ _2"></span>of <span class="_ _3"></span>‘‘unlinking a <span class="_ _3"></span>ﬁle’<span class="ls517">’d<span class="_ _8"></span><span class="ls0">oes <span class="_ _2"></span>not <span class="_ _3"></span>always <span class="_ _3"></span>mean</span></span></div><div class="t m0 x14a hac y1098 ff19 fs58 fc0 sc0 ls518 ws0">‘‘<span class="_ _2"></span><span class="ls0">deleting <span class="_ _2"></span>the <span class="_ _2"></span>blocks <span class="_ _2"></span>associated <span class="_ _2"></span>with <span class="_ _3"></span>the <span class="_ _2"></span>ﬁle.’<span class="_ _0"></span><span class="ls519">’T<span class="_ _1d"></span><span class="ls0">his <span class="_ _3"></span>is <span class="_ _2"></span>why <span class="_ _2"></span>the <span class="_ _2"></span>function <span class="_ _2"></span>that <span class="_ _2"></span>removes</span></span></span></div><div class="t m0 x14a had y1099 ff19 fs58 fc0 sc0 ls51a ws0">ad<span class="_ _8"></span><span class="ls0">irectory <span class="_ _2"></span>entry <span class="_ _3"></span>is <span class="_ _9"></span>called<span class="_ _47"> </span><span class="ff1a">unlink</span><span class="ls51b">,n<span class="_ _8"></span><span class="ls0">ot <span class="_ _3"></span>delete.<span class="_ _16"> </span>In <span class="_ _3"></span>the<span class="_ _45"> </span><span class="ff1a">stat<span class="_ _47"> </span></span>structur<span class="_ _0"></span>e, <span class="_ _3"></span>the <span class="_ _3"></span>link <span class="_ _3"></span>count</span></span></span></div><div class="t m0 x14a had y109a ff19 fs58 fc0 sc0 ls0 ws0">is <span class="_ _3"></span>contained <span class="_ _9"></span>in <span class="_ _9"></span>the<span class="_ _45"> </span><span class="ff1a">st_nlink<span class="_ _47"> </span></span>member<span class="_ _1"></span><span class="ls51c">.I<span class="_ _62"></span><span class="ls0">ts <span class="_ _9"></span>primitive <span class="_ _9"></span>system <span class="_ _3"></span>data <span class="_ _9"></span>type <span class="_ _9"></span>is<span class="_ _45"> </span><span class="ff1a">nlink_t</span>.</span></span></div><div class="t m0 x14a hac y109b ff19 fs58 fc0 sc0 ls0 ws0">These <span class="_ _2"></span>types <span class="_ _3"></span>of <span class="_ _2"></span>links <span class="_ _2"></span>ar<span class="ls51d">ec<span class="_ _4f"></span><span class="ls0">alled <span class="_ _2"></span>har<span class="ls51d">dl<span class="_ _8"></span><span class="ls0">inks. <span class="_ _47"> </span>Recall<span class="_ _47"> </span>from Section <span class="_ _3"></span>2.5.2 <span class="_ _2"></span>that <span class="_ _3"></span>the <span class="_ _2"></span>POSIX.1</span></span></span></span></div><div class="t m0 x14a had y109c ff19 fs58 fc0 sc0 ls0 ws0">constant<span class="_"> </span><span class="ff1a">LINK_MAX<span class="_ _80"> </span></span>speciﬁes the maximum value for a ﬁle’s link count.</div><div class="t m0 x32 hae y109d ff19 fs58 fc0 sc0 ls515 ws0">•T<span class="_ _4d"></span><span class="ls0">he <span class="_ _e"> </span>other <span class="_ _e"> </span>type <span class="_ _e"> </span>of <span class="_ _e"> </span>link <span class="_ _e"> </span>is <span class="_ _e"> </span>called <span class="_ _e"> </span>a<span class="_ _59"> </span><span class="ff1b">symbolic <span class="_ _53"> </span>link</span><span class="ls51e">.W<span class="_ _5d"></span><span class="ls0">ith <span class="_ _e"> </span>a <span class="_ _e"> </span>symbolic <span class="_ _e"> </span>link, <span class="_ _e"> </span>the <span class="_ _e"> </span>actual</span></span></span></div><div class="t m0 x14a hac y109e ff19 fs58 fc0 sc0 ls0 ws0">contents <span class="_ _23"> </span>of <span class="_ _23"> </span>the <span class="_ _42"> </span>ﬁle<span class="_ _9"></span><span class="ls51f">—t<span class="_ _6"></span><span class="ls0">he <span class="_ _23"> </span>data <span class="_ _42"> </span>blocks<span class="_ _9"></span><span class="ls51f">—s<span class="_ _6"></span><span class="ls0">tor<span class="ls520">et<span class="_ _43"></span><span class="ls0">he <span class="_ _23"> </span>name <span class="_ _23"> </span>of <span class="_ _42"> </span>the <span class="_ _23"></span>ﬁle <span class="_ _23"> </span>that <span class="_ _42"> </span>the <span class="_ _23"></span>symbolic</span></span></span></span></span></span></div><div class="t m0 x14a hac y109f ff19 fs58 fc0 sc0 ls0 ws0">link <span class="_ _23"></span>points <span class="_ _23"></span>to.<span class="_ _5a"> </span>In <span class="_ _23"> </span>the <span class="_ _23"> </span>following <span class="_ _23"> </span>example, <span class="_ _23"> </span>the <span class="_ _23"> </span>ﬁlename <span class="_ _23"></span>in <span class="_ _23"></span>the <span class="_ _23"></span>directory <span class="_ _9"></span>entry <span class="_ _23"> </span>is <span class="_ _23"> </span>the</div><div class="t m0 x14a had y10a0 ff19 fs58 fc0 sc0 ls0 ws0">three-character string<span class="_"> </span><span class="ff1a">lib<span class="_ _80"> </span></span>and the 7 bytes of data in the ﬁle are<span class="_"> </span><span class="ff1a">usr/lib</span>:</div><div class="t m0 x15 haf y10a1 ff1a fs59 fc0 sc0 ls0 ws0">lrwxrwxrwx <span class="_"> </span>1<span class="_"> </span>root <span class="_ _8a"> </span>7<span class="_"> </span>Sep 25 07:14 lib -&gt; usr/lib</div><div class="t m0 x14a had y10a2 ff19 fs58 fc0 sc0 ls0 ws0">The ﬁle <span class="_ _2"></span>type <span class="_ _2"></span>in <span class="_ _2"></span>the i-node <span class="_ _2"></span>would <span class="_ _2"></span>be<span class="_ _66"> </span><span class="ff1a">S_IFLNK<span class="_ _66"> </span></span>so <span class="_ _2"></span>that <span class="_ _2"></span>the system <span class="_ _2"></span>knows <span class="_ _2"></span>that <span class="_ _2"></span>this is <span class="_ _2"></span>a</div><div class="t m0 x14a hac y10a3 ff19 fs58 fc0 sc0 ls0 ws0">symbolic link.</div><div class="t m0 x32 hac y10a4 ff19 fs58 fc0 sc0 ls515 ws0">•T<span class="_ _4d"></span><span class="ls0">he <span class="_ _9"></span>i-node <span class="_ _23"></span>contains <span class="_ _9"></span>all <span class="_ _9"></span>the <span class="_ _23"></span>information <span class="_ _9"></span>about <span class="_ _9"></span>the <span class="_ _23"></span>ﬁle: <span class="_ _9"></span>the <span class="_ _9"></span>ﬁle <span class="_ _23"></span>type, <span class="_ _9"></span>the <span class="_ _23"></span>ﬁle’s <span class="_ _9"></span>access</span></div><div class="t m0 x14a hac y10a5 ff19 fs58 fc0 sc0 ls0 ws0">permission bits, <span class="_ _2"></span>the size <span class="_ _2"></span>of <span class="_ _2"></span>the ﬁle, <span class="_ _2"></span>pointers <span class="_ _2"></span>to the <span class="_ _2"></span>ﬁle’s <span class="_ _2"></span>data blocks, <span class="_ _2"></span>and <span class="_ _2"></span>so on.<span class="_ _46"> </span>Most</div><div class="t m0 x14a had y10a6 ff19 fs58 fc0 sc0 ls0 ws0">of the information in the<span class="_"> </span><span class="ff1a">stat<span class="_ _66"> </span></span>structure<span class="_"> </span>is<span class="_"> </span>obtained fr<span class="_ _0"></span>om the i-node.<span class="_ _46"> </span>Only two items</div><div class="t m0 x14a hac y10a7 ff19 fs58 fc0 sc0 ls0 ws0">of interest ar<span class="ls521">es<span class="_ _4f"></span><span class="ls0">tored in the directory entry: the <span class="_ _2"></span>ﬁlename and the <span class="_ _2"></span>i-node number<span class="_ _1"></span><span class="ls522">.T<span class="_ _4a"></span><span class="ls0">he</span></span></span></span></div><div class="t m0 x14a hac y10a8 ff19 fs58 fc0 sc0 ls0 ws0">other <span class="_ _3"></span>items<span class="_ _9"></span><span class="ls51f">—t<span class="_ _6"></span><span class="ls0">he <span class="_ _9"></span>length <span class="_ _3"></span>of <span class="_ _9"></span>the <span class="_ _3"></span>ﬁlename <span class="_ _3"></span>and <span class="_ _9"></span>the <span class="_ _3"></span>length <span class="_ _3"></span>of <span class="_ _9"></span>the <span class="_ _3"></span>directory <span class="_ _3"></span>recor<span class="ls51f">d—a<span class="_ _4"></span><span class="ls523">re</span></span></span></span></div><div class="t m0 x14a had y10a9 ff19 fs58 fc0 sc0 ls0 ws0">not of interest to this discussion.<span class="_ _59"> </span>The data type for the i-node number is<span class="_"> </span><span class="ff1a">ino_t</span>.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
