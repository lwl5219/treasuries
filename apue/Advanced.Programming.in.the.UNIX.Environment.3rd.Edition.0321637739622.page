<div id="pf26e" class="pf w4 h1f" data-page-no="26e"><div class="pc pc26e w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg26e.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff18 fs0 fc0 sc0 ls0 ws0">588<span class="_ _1b"> </span><span class="ff19">Interprocess <span class="_"> </span>Communication<span class="_ _2c"> </span>Chapter <span class="_"> </span>15</span></div><div class="t m0 x32 h57 yddc ff18 fs2d fc0 sc0 ls0 ws0">15.6<span class="_ _288"> </span><span class="ff19">The <span class="_ _23"> </span>Rationale <span class="_ _23"> </span>for <span class="_ _23"> </span>POSIX.1 <span class="_ _23"> </span>gives <span class="_ _23"> </span>as <span class="_ _23"> </span>one <span class="_ _23"> </span>of <span class="_ _23"></span>the <span class="_ _9"></span>reasons <span class="_ _23"> </span>for <span class="_ _23"> </span>adding <span class="_ _23"> </span>the<span class="_ _45"> </span><span class="ff1a">waitpid<span class="_ _45"> </span></span>function</span></div><div class="t m0 xe1 h5f yddd ff19 fs2d fc0 sc0 ls0 ws0">that most pre-POSIX.1 systems can’t handle the following:</div><div class="t m0 x1c h57 y469a ff1a fs2d fc0 sc0 ls0 ws0">if ((fp = popen(&quot;/bin/true&quot;, &quot;r&quot;)) == NULL)</div><div class="t m0 x13a h57 y469b ff1a fs2d fc0 sc0 ls0 ws0">...</div><div class="t m0 x1c h57 y469c ff1a fs2d fc0 sc0 ls0 ws0">if ((rc = system(&quot;sleep 100&quot;)) == -1)</div><div class="t m0 x13a h57 y469d ff1a fs2d fc0 sc0 ls0 ws0">...</div><div class="t m0 x1c h57 y469e ff1a fs2d fc0 sc0 ls0 ws0">if (pclose(fp) == -1)</div><div class="t m0 x13a h57 y469f ff1a fs2d fc0 sc0 ls0 ws0">...</div><div class="t m0 xe1 h57 y46a0 ff19 fs2d fc0 sc0 ls0 ws0">What happens in this code if<span class="_"> </span><span class="ff1a">waitpid<span class="_ _e"> </span></span>isn’t available and<span class="_"> </span><span class="ff1a">wait<span class="_ _80"> </span></span>is used instead?</div><div class="t m0 x32 h57 y46a1 ff18 fs2d fc0 sc0 ls0 ws0">15.7<span class="_ _288"> </span><span class="ff19">Explain <span class="_ _2"></span>how<span class="_ _66"> </span><span class="ff1a">select<span class="_ _80"> </span></span>and<span class="_ _66"> </span><span class="ff1a">poll<span class="_ _80"> </span></span>handle <span class="_ _2"></span>an <span class="_ _2"></span>input <span class="_ _2"></span>descriptor <span class="_ _2"></span>that <span class="_ _2"></span>is <span class="_ _2"></span>a <span class="_ _2"></span>pipe, <span class="_ _2"></span>when <span class="_ _2"></span>the <span class="_ _2"></span>pipe <span class="_ _2"></span>is</span></div><div class="t m0 xe1 h5f y46a2 ff19 fs2d fc0 sc0 ls0 ws0">closed <span class="_ _9"></span>by <span class="_ _9"></span>the <span class="_ _9"></span>writer<span class="_ _1"></span><span class="ls12dc">.T<span class="_ _26"></span><span class="ls12dd">od<span class="_ _8"></span><span class="ls0">etermine <span class="_ _9"></span>the <span class="_ _9"></span>answer<span class="_ _1"></span><span class="ls12dd">,w<span class="_ _8"></span><span class="ls0">rite <span class="_ _9"></span>two <span class="_ _9"></span>small <span class="_ _9"></span>test <span class="_ _23"></span>programs: <span class="_ _3"></span>one <span class="_ _9"></span>using</span></span></span></span></span></div><div class="t m0 xe1 h57 y46a3 ff1a fs2d fc0 sc0 ls0 ws0">select<span class="_ _e"> </span><span class="ff19">and one using<span class="_"> </span></span>poll<span class="ff19">.</span></div><div class="t m0 xe1 h5f y46a4 ff19 fs2d fc0 sc0 ls0 ws0">Redo <span class="_ _23"> </span>this <span class="_ _42"> </span>exercise, <span class="_ _23"> </span>looking <span class="_ _23"> </span>at <span class="_ _42"> </span>an <span class="_ _23"> </span>output <span class="_ _42"> </span>descriptor <span class="_ _23"> </span>that <span class="_ _42"> </span>is <span class="_ _23"> </span>a <span class="_ _42"> </span>pipe, <span class="_ _23"> </span>when <span class="_ _23"> </span>the <span class="_ _42"> </span>read <span class="_ _23"> </span>end <span class="_ _23"> </span>is</div><div class="t m0 xe1 h5f y46a5 ff19 fs2d fc0 sc0 ls0 ws0">closed.</div><div class="t m0 x32 h57 y46a6 ff18 fs2d fc0 sc0 ls0 ws0">15.8<span class="_ _288"> </span><span class="ff19">What <span class="_ _2"></span>happens <span class="_ _2"></span>if <span class="_ _2"></span>the<span class="_ _80"> </span><span class="ff1b">cmdstring<span class="_ _66"> </span></span>executed by<span class="_ _66"> </span><span class="ff1a">popen<span class="_ _80"> </span></span>with <span class="_ _2"></span>a<span class="_ _80"> </span><span class="ff1b">type<span class="_ _66"> </span></span>of<span class="_"> </span><span class="ff1a">&quot;r&quot;<span class="_ _66"> </span></span>writes to <span class="_ _2"></span>its <span class="_ _2"></span>standard</span></div><div class="t m0 xe1 h5f y46a7 ff19 fs2d fc0 sc0 ls0 ws0">error?</div><div class="t m0 x32 h57 y46a8 ff18 fs2d fc0 sc0 ls0 ws0">15.9<span class="_ _288"> </span><span class="ff19">Since<span class="_ _46"> </span><span class="ff1a">popen<span class="_ _59"> </span></span>invokes <span class="_ _66"> </span>a <span class="_ _66"> </span>shell <span class="_ _66"> </span>to <span class="_ _66"> </span>execute <span class="_ _66"> </span>its<span class="_ _59"> </span><span class="ff1b">cmdstring<span class="_ _46"> </span></span>argument, <span class="_ _80"> </span>what <span class="_ _66"> </span>happens <span class="_ _66"> </span>when</span></div><div class="t m0 xe1 h57 y46a9 ff1a fs2d fc0 sc0 ls0 ws0">cmdstring<span class="_ _e"> </span><span class="ff19">terminates? <span class="_"> </span>(Hint:<span class="_"> </span>Draw all the processes involved.)</span></div><div class="t m0 x32 h57 y46aa ff18 fs2d fc0 sc0 ls0 ws0">15.10<span class="_ _48"> </span><span class="ff19">POSIX.1 <span class="_ _53"> </span>speciﬁcally <span class="_ _42"> </span>states <span class="_ _53"> </span>that<span class="_ _35"> </span><span class="ff1a">open</span>ing <span class="_ _53"> </span>a <span class="_ _42"> </span>FIFO <span class="_ _53"> </span>for <span class="_ _42"> </span>read–write <span class="_ _42"> </span>is <span class="_ _53"> </span>undeﬁned.<span class="_ _51"> </span>Although</span></div><div class="t m0 xe1 h5f y46ab ff19 fs2d fc0 sc0 ls0 ws0">most <span class="_ _2"></span>UNIX <span class="_ _2"></span>systems <span class="_ _3"></span>allow <span class="_ _2"></span>this, <span class="_ _3"></span>show <span class="_ _2"></span>another <span class="_ _2"></span>method <span class="_ _3"></span>for <span class="_ _2"></span>opening <span class="_ _3"></span>a <span class="_ _2"></span>FIFO <span class="_ _2"></span>for <span class="_ _3"></span>both <span class="_ _2"></span>reading</div><div class="t m0 xe1 h5f y46ac ff19 fs2d fc0 sc0 ls0 ws0">and writing, without blocking.</div><div class="t m0 x32 h5f y46ad ff18 fs2d fc0 sc0 ls0 ws0">15.1<span class="_ _0"></span>1<span class="_ _60"> </span><span class="ff19">Unless <span class="_ _23"> </span>a <span class="_ _23"> </span>ﬁle <span class="_ _23"> </span>contains <span class="_ _23"> </span>sensitive <span class="_ _23"> </span>or <span class="_ _23"> </span>conﬁdential <span class="_ _23"> </span>data, <span class="_ _23"> </span>allowing <span class="_ _23"> </span>other <span class="_ _23"></span>users <span class="_ _23"></span>to <span class="_ _23"></span>r<span class="_ _0"></span>ead <span class="_ _23"> </span>the <span class="_ _23"> </span>ﬁle</span></div><div class="t m0 xe1 h5f y46ae ff19 fs2d fc0 sc0 ls0 ws0">causes <span class="_ _23"></span>no <span class="_ _9"></span>harm.<span class="_ _5a"> </span>(It <span class="_ _23"></span>is <span class="_ _9"></span>usually <span class="_ _23"> </span>considered <span class="_ _23"></span>antisocial, <span class="_ _9"></span>however<span class="_ _1"></span>,<span class="_ _45"> </span>to<span class="_ _45"> </span>go<span class="_ _45"> </span>snooping <span class="_ _23"> </span>around <span class="_ _9"></span>in</div><div class="t m0 xe1 h5f y46af ff19 fs2d fc0 sc0 ls0 ws0">other <span class="_ _42"> </span>people’s <span class="_ _53"> </span>ﬁles.)<span class="_ _51"> </span>But <span class="_ _42"> </span>what <span class="_ _42"> </span>happens <span class="_ _53"> </span>if <span class="_ _42"> </span>a <span class="_ _53"> </span>malicious <span class="_ _42"> </span>process <span class="_ _42"> </span>reads <span class="_ _42"> </span>a <span class="_ _42"> </span>message <span class="_ _53"> </span>from <span class="_ _42"> </span>a</div><div class="t m0 xe1 h5f y46b0 ff19 fs2d fc0 sc0 ls0 ws0">message <span class="_ _3"></span>queue <span class="_ _3"></span>that <span class="_ _3"></span>is <span class="_ _3"></span>being <span class="_ _3"></span>used <span class="_ _3"></span>by <span class="_ _3"></span>a <span class="_ _3"></span>server <span class="_ _3"></span>and <span class="_ _3"></span>several <span class="_ _3"></span>clients?<span class="_ _46"> </span>What <span class="_ _3"></span>information <span class="_ _3"></span>does</div><div class="t m0 xe1 h5f y46b1 ff19 fs2d fc0 sc0 ls0 ws0">the malicious process need to know to r<span class="_ _0"></span>ead the message queue?</div><div class="t m0 x32 h5f y46b2 ff18 fs2d fc0 sc0 ls0 ws0">15.12<span class="_ _48"> </span><span class="ff19 ls467">Wr<span class="_ _9"></span><span class="ls0">ite <span class="_ _53"> </span>a <span class="_"> </span>pr<span class="_ _1"></span>ogram <span class="_"> </span>that <span class="_ _42"> </span>does <span class="_"> </span>the <span class="_ _53"> </span>following.<span class="_ _51"> </span>Execute <span class="_"> </span>a <span class="_ _42"> </span>loop <span class="_"> </span>ﬁve <span class="_ _42"> </span>times: <span class="_"> </span>cr<span class="_ _1"></span>eate <span class="_"> </span>a <span class="_ _42"> </span>message</span></span></div><div class="t m0 xe1 h5f y46b3 ff19 fs2d fc0 sc0 ls0 ws0">queue, <span class="_ _23"></span>print <span class="_ _9"></span>the <span class="_ _23"> </span>queue <span class="_ _23"> </span>identiﬁer<span class="_ _1"></span><span class="ls12de">,d<span class="_ _b"></span><span class="ls0">elete <span class="_ _23"> </span>the <span class="_ _23"></span>message <span class="_ _9"></span>queue.<span class="_ _5a"> </span>Then <span class="_ _9"></span>execute <span class="_ _23"> </span>the <span class="_ _23"> </span>next <span class="_ _23"> </span>loop</span></span></div><div class="t m0 xe1 h57 y46b4 ff19 fs2d fc0 sc0 ls0 ws0">ﬁve <span class="_ _9"></span>times: <span class="_ _9"></span>create <span class="_ _3"></span>a <span class="_ _9"></span>message <span class="_ _9"></span>queue <span class="_ _9"></span>with <span class="_ _9"></span>a <span class="_ _9"></span>key <span class="_ _9"></span>of<span class="_ _45"> </span><span class="ff1a">IPC_PRIVATE</span><span class="ls12df">,a<span class="_ _b"></span><span class="ls0">nd <span class="_ _9"></span>place <span class="_ _9"></span>a <span class="_ _23"></span>message <span class="_ _3"></span>on</span></span></div><div class="t m0 xe1 h57 y46b5 ff19 fs2d fc0 sc0 ls0 ws0">the <span class="_"> </span>queue.<span class="_ _54"> </span>After <span class="_"> </span>the <span class="_ _53"> </span>program <span class="_"> </span>terminates, <span class="_ _53"> </span>look <span class="_"> </span>at <span class="_"> </span>the <span class="_"> </span>message <span class="_ _53"> </span>queues <span class="_"> </span>using<span class="_ _4b"> </span><span class="ff1a">ipcs</span></div><div class="t m0 x192 h5f y46b6 ff19 fs2d fc0 sc0 ls0 ws0">(</div><div class="t m0 x229 h5f y46b5 ff19 fs2d fc0 sc0 ls0 ws0">1</div><div class="t m0 x22a h5f y46b6 ff19 fs2d fc0 sc0 ls0 ws0">)</div><div class="t m0 x163 h5f y46b5 ff19 fs2d fc0 sc0 ls0 ws0">.</div><div class="t m0 xe1 h5f y46b7 ff19 fs2d fc0 sc0 ls0 ws0">Explain what is happening with the queue identiﬁers.</div><div class="t m0 x32 h5f y46b8 ff18 fs2d fc0 sc0 ls0 ws0">15.13<span class="_ _48"> </span><span class="ff19">Describe <span class="_ _42"> </span>how <span class="_ _23"> </span>to <span class="_ _42"> </span>build <span class="_ _42"> </span>a <span class="_ _23"> </span>linked <span class="_ _42"> </span>list <span class="_ _23"> </span>of <span class="_ _42"> </span>data <span class="_ _23"> </span>objects <span class="_ _42"> </span>in <span class="_ _23"> </span>a <span class="_ _42"> </span>shared <span class="_ _23"> </span>memory <span class="_ _42"> </span>segment.<span class="_ _5a"> </span>What</span></div><div class="t m0 xe1 h5f y46b9 ff19 fs2d fc0 sc0 ls0 ws0">would you store<span class="_"> </span>as<span class="_"> </span>the list pointers?</div><div class="t m0 x32 h57 y46ba ff18 fs2d fc0 sc0 ls0 ws0">15.14<span class="_ _48"> </span><span class="ff19">Draw <span class="_ _2"></span>a <span class="_ _2"></span>timeline of <span class="_ _2"></span>the <span class="_ _2"></span>program in Figur<span class="ls12e0">e1<span class="_ _d"></span><span class="ls0">5.33 <span class="_ _2"></span>showing <span class="_ _2"></span>the value <span class="_ _2"></span>of <span class="_ _2"></span>the variable<span class="_ _66"> </span><span class="ff1a">i<span class="_ _80"> </span></span>in both</span></span></span></div><div class="t m0 xe1 h5f y46bb ff19 fs2d fc0 sc0 ls0 ws0">the <span class="_ _9"></span>parent <span class="_ _3"></span>and <span class="_ _9"></span>child, <span class="_ _23"></span>the <span class="_ _9"></span>value <span class="_ _9"></span>of <span class="_ _9"></span>the <span class="_ _9"></span>long <span class="_ _9"></span>integer <span class="_ _9"></span>in <span class="_ _9"></span>the <span class="_ _9"></span>shared <span class="_ _9"></span>memory <span class="_ _9"></span>region, <span class="_ _9"></span>and <span class="_ _9"></span>the</div><div class="t m0 xe1 h57 y46bc ff19 fs2d fc0 sc0 ls0 ws0">value returned by the<span class="_"> </span><span class="ff1a">update<span class="_ _e"> </span></span>function. <span class="_"> </span>Assume<span class="_"> </span>that the child runs ﬁrst after the<span class="_"> </span><span class="ff1a">fork</span>.</div><div class="t m0 x32 h5f y46bd ff18 fs2d fc0 sc0 ls0 ws0">15.15<span class="_ _48"> </span><span class="ff19">Redo <span class="_ _44"> </span>the <span class="_ _44"> </span>program <span class="_ _35"> </span>in <span class="_ _35"> </span>Figur<span class="ls12e1">e1<span class="_ _7"></span><span class="ls0">5.33 <span class="_ _44"> </span>using <span class="_ _44"> </span>the <span class="_ _35"> </span>XSI <span class="_ _44"> </span>shared <span class="_ _35"> </span>memory <span class="_ _44"> </span>functions <span class="_ _35"> </span>from</span></span></span></div><div class="t m0 xe1 h5f y46be ff19 fs2d fc0 sc0 ls0 ws0">Section 15.9 instead of the shared memory-mapped r<span class="_ _0"></span>egion.</div><div class="t m0 x32 h5f y46bf ff18 fs2d fc0 sc0 ls0 ws0">15.16<span class="_ _48"> </span><span class="ff19">Redo <span class="_ _9"></span>the <span class="_ _3"></span>program <span class="_ _2"></span>in <span class="_ _3"></span>Figur<span class="ls12e2">e1<span class="_ _4f"></span><span class="ls0">5.33 <span class="_ _3"></span>using <span class="_ _3"></span>the <span class="_ _9"></span>XSI <span class="_ _3"></span>semaphor<span class="ls12e3">ef<span class="_ _8"></span><span class="ls0">unctions <span class="_ _3"></span>from <span class="_ _3"></span>Section <span class="_ _3"></span>15.8 <span class="_ _3"></span>to</span></span></span></span></span></div><div class="t m0 xe1 h5f y46c0 ff19 fs2d fc0 sc0 ls0 ws0">alternate between the parent and the child.</div><div class="t m0 x32 h5f y46c1 ff18 fs2d fc0 sc0 ls0 ws0">15.17<span class="_ _48"> </span><span class="ff19">Redo <span class="_ _9"></span>the <span class="_ _9"></span>program <span class="_ _9"></span>in <span class="_ _3"></span>Figur<span class="ls12e4">e1<span class="_ _8"></span><span class="ls0">5.33 <span class="_ _9"></span>using <span class="_ _9"></span>advisory <span class="_ _9"></span>recor<span class="_ _0"></span><span class="ls12e4">dl<span class="_ _8"></span><span class="ls0">ocking <span class="_ _9"></span>to <span class="_ _9"></span>alternate <span class="_ _9"></span>between <span class="_ _9"></span>the</span></span></span></span></span></div><div class="t m0 xe1 h5f y46c2 ff19 fs2d fc0 sc0 ls0 ws0">parent and the child.</div><div class="t m0 x32 h5f y46c3 ff18 fs2d fc0 sc0 ls0 ws0">15.18<span class="_ _48"> </span><span class="ff19">Redo <span class="_ _2"></span>the program in Figur<span class="ls12e5">e1<span class="_ _5"></span><span class="ls0">5.33 using the POSIX <span class="_ _2"></span>semaphor<span class="ls12e5">ef<span class="_ _d"></span><span class="ls0">unctions <span class="_ _2"></span>from Section 15.10</span></span></span></span></span></div><div class="t m0 xe1 h5f y46c4 ff19 fs2d fc0 sc0 ls0 ws0">to alternate between the parent and the child.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
