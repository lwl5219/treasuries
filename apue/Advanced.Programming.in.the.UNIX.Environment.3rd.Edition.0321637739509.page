<div id="pf1fd" class="pf w4 h1f" data-page-no="1fd"><div class="pc pc1fd w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="apue/bg1fd.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h24 ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>13.6<span class="_ _29c"> </span>Daemon <span class="_"> </span>Conventions<span class="_ _1b"> </span><span class="ff18">475</span></div><div class="t m0 x3f h26 y12f ff19 fsf fc0 sc0 ls49 ws0">•I<span class="_ _4d"></span><span class="lsf99">ft<span class="_ _b"></span><span class="ls0">he <span class="_ _9"></span>daemon <span class="_ _9"></span>supports <span class="_ _9"></span>conﬁguration <span class="_ _23"></span>options, <span class="_ _9"></span>they <span class="_ _9"></span>ar<span class="lsf99">eu<span class="_ _b"></span><span class="ls0">sually <span class="_ _3"></span>stored <span class="_ _9"></span>in<span class="_ _45"> </span><span class="ff1a">/etc</span>.</span></span></span></span></div><div class="t m0 x15 h26 y130 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_"> </span>conﬁguration <span class="_ _e"> </span>ﬁle <span class="_"> </span>is <span class="_ _e"> </span>named<span class="_ _59"> </span><span class="ff1b">name<span class="ff1a">.conf</span></span><span class="lsf9a">,w<span class="_ _55"></span><span class="ls0">here<span class="_ _4b"> </span><span class="ff1b">name<span class="_ _59"> </span></span>is <span class="_"> </span>the <span class="_"> </span>name <span class="_ _e"> </span>of <span class="_"> </span>the</span></span></div><div class="t m0 x15 h2a y131 ff19 fsf fc0 sc0 ls0 ws0">daemon <span class="_"> </span>or <span class="_"> </span>the <span class="_"> </span>name <span class="_"> </span>of <span class="_"> </span>the <span class="_"> </span>service.<span class="_ _48"> </span>For <span class="_"> </span>example, <span class="_"> </span>the <span class="_"> </span>conﬁguration <span class="_"> </span>for <span class="_"> </span>the</div><div class="t m0 x15 h26 y132 ff1a fsf fc0 sc0 ls0 ws0">syslogd<span class="_ _80"> </span><span class="ff19">daemon is usually<span class="_"> </span></span>/etc/syslog.conf<span class="ff19">.</span></div><div class="t m0 x3f h2a y1ad ff19 fsf fc0 sc0 ls49 ws0">•D<span class="_ _4d"></span><span class="ls0">aemons <span class="_ _42"> </span>can <span class="_ _42"> </span>be <span class="_ _42"> </span>started <span class="_ _42"> </span>from <span class="_ _42"> </span>the <span class="_ _42"> </span>command <span class="_ _53"> </span>line, <span class="_ _42"> </span>but <span class="_ _42"> </span>they <span class="_ _42"> </span>ar<span class="lsb5b">eu<span class="_ _43"></span><span class="ls0">sually <span class="_ _23"> </span>started</span></span></span></div><div class="t m0 x15 h26 y1ae ff19 fsf fc0 sc0 ls0 ws0">from one <span class="_ _2"></span>of the <span class="_ _2"></span>system <span class="_ _2"></span>initialization <span class="_ _2"></span>scripts <span class="_ _2"></span>(<span class="ff1a">/etc/rc*<span class="_ _66"> </span></span>or<span class="_ _66"> </span><span class="ff1a">/etc/init.d/*</span>). <span class="_ _66"> </span>If</div><div class="t m0 x15 h2a y1af ff19 fsf fc0 sc0 ls0 ws0">the <span class="_ _3"></span>daemon <span class="_ _3"></span>should <span class="_ _9"></span>be <span class="_ _3"></span>restarted <span class="_ _3"></span>automatically <span class="_ _3"></span>when <span class="_ _3"></span>it <span class="_ _9"></span>exits, <span class="_ _3"></span>we <span class="_ _3"></span>can <span class="_ _9"></span>arrange <span class="_ _3"></span>for</div><div class="t m0 x15 h26 y1b0 ff1a fsf fc0 sc0 ls0 ws0">init<span class="_ _46"> </span><span class="ff19">to <span class="_ _66"> </span>restart <span class="_"> </span>it <span class="_ _47"> </span>if <span class="_"> </span>we <span class="_ _66"> </span>include <span class="_ _66"> </span>a<span class="_ _61"> </span></span>respawn<span class="_ _46"> </span><span class="ff19">entry <span class="_ _47"> </span>for <span class="_"> </span>it <span class="_ _66"> </span>in<span class="_ _61"> </span></span>/etc/inittab</div><div class="t m0 x15 h26 y153 ff19 fsf fc0 sc0 ls0 ws0">(assuming the system uses a System V style<span class="_"> </span><span class="ff1a">init<span class="_ _80"> </span></span>command).</div><div class="t m0 x3f h2a y1b1 ff19 fsf fc0 sc0 ls49 ws0">•I<span class="_ _4d"></span><span class="ls24b">fad<span class="_ _4f"></span><span class="ls0">aemon <span class="_ _2"></span>has <span class="_ _2"></span>a conﬁguration <span class="_ _2"></span>ﬁle, the <span class="_ _2"></span>daemon reads the <span class="_ _2"></span>ﬁle when <span class="_ _2"></span>it <span class="_ _2"></span>starts, but</span></span></div><div class="t m0 x15 h2a y157 ff19 fsf fc0 sc0 ls0 ws0">usually won’t <span class="_ _2"></span>look at <span class="_ _2"></span>it again.<span class="_ _61"> </span>If an <span class="_ _2"></span>administrator changes <span class="_ _2"></span>the <span class="_ _2"></span>conﬁguration, the</div><div class="t m0 x15 h2a y15a ff19 fsf fc0 sc0 ls0 ws0">daemon would need to be stopped and restarted to account for the conﬁguration</div><div class="t m0 x15 h26 y15b ff19 fsf fc0 sc0 ls0 ws0">changes. <span class="_ _46"> </span>T<span class="_ _6"></span><span class="lsf9b">oa<span class="_ _5b"></span><span class="ls0">void <span class="_ _66"> </span>this, <span class="_ _66"> </span>some <span class="_ _66"> </span>daemons <span class="_ _66"> </span>will <span class="_ _66"> </span>catch<span class="_ _46"> </span><span class="ff1a">SIGHUP<span class="_ _61"> </span></span>and <span class="_"> </span>reread <span class="_"> </span>their</span></span></div><div class="t m0 x15 h2a y15c ff19 fsf fc0 sc0 ls0 ws0">conﬁguration <span class="_ _53"> </span>ﬁles <span class="_ _e"> </span>when <span class="_ _e"> </span>they <span class="_ _e"> </span>receive <span class="_ _53"> </span>the <span class="_ _e"> </span>signal.<span class="_ _48"> </span>Since <span class="_ _53"> </span>they <span class="_ _e"> </span>aren’t <span class="_ _53"> </span>associated</div><div class="t m0 x15 h2a y15d ff19 fsf fc0 sc0 ls0 ws0">with <span class="_ _42"> </span>terminals <span class="_ _42"> </span>and <span class="_ _42"> </span>ar<span class="lsb5b">ee<span class="_ _43"></span><span class="ls0">ither <span class="_ _23"> </span>session <span class="_ _53"> </span>leaders <span class="_ _42"> </span>without <span class="_ _42"> </span>controlling <span class="_ _42"> </span>terminals <span class="_ _42"> </span>or</span></span></div><div class="t m0 x15 h2a y15e ff19 fsf fc0 sc0 ls0 ws0">members <span class="_ _e"> </span>of <span class="_ _e"> </span>orphaned <span class="_ _e"> </span>process <span class="_ _53"> </span>groups, <span class="_ _53"> </span>daemons <span class="_ _e"> </span>have <span class="_ _e"> </span>no <span class="_ _e"> </span>reason <span class="_ _53"> </span>to <span class="_"> </span>expect <span class="_ _53"> </span>to</div><div class="t m0 x15 h26 y15f ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">ceive<span class="_"> </span><span class="ff1a">SIGHUP</span><span class="ls86">.T<span class="_ _4a"></span><span class="ls0">hus they can safely reuse it.</span></span></span></div><div class="t m0 x35 h27 y209 ff16 fsf fc0 sc0 ls0 ws0">Example</div><div class="t m0 x32 h2a y1b9 ff19 fsf fc0 sc0 ls0 ws0">The <span class="_ _4b"> </span>program <span class="_ _4b"> </span>shown <span class="_ _4b"> </span>in <span class="_ _59"> </span>Figur<span class="lsf9c">e1<span class="_ _5d"></span><span class="ls0">3.7 <span class="_ _59"> </span>shows <span class="_ _4b"> </span>one <span class="_ _4b"> </span>way <span class="_ _59"> </span>a <span class="_ _4b"> </span>daemon <span class="_ _59"> </span>can <span class="_ _4b"> </span>reread <span class="_ _44"> </span>its</span></span></div><div class="t m0 x32 h26 y1ba ff19 fsf fc0 sc0 ls0 ws0">conﬁguration <span class="_ _42"> </span>ﬁle.<span class="_ _51"> </span>The <span class="_ _42"> </span>program <span class="_ _23"> </span>uses<span class="_ _44"> </span><span class="ff1a">sigwait<span class="_ _35"> </span></span>and <span class="_ _42"> </span>multiple <span class="_ _42"> </span>threads, <span class="_ _23"> </span>as <span class="_ _42"> </span>discussed <span class="_ _42"> </span>in</div><div class="t m0 x32 h2a y1bb ff19 fsf fc0 sc0 ls0 ws0">Section 12.8.</div><div class="t m0 x32 h4e y3ab1 ff1a fs28 fc0 sc0 ls0 ws0">#include &quot;apue.h&quot;</div><div class="t m0 x32 h4e y3ab2 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;pthread.h&gt;</div><div class="t m0 x32 h4e y3ab3 ff1a fs28 fc0 sc0 ls0 ws0">#include &lt;syslog.h&gt;</div><div class="t m0 x32 h4e y3ab4 ff1a fs28 fc0 sc0 ls0 ws0">sigset_t <span class="_ _68"> </span>mask;</div><div class="t m0 x32 h4e y3ab5 ff1a fs28 fc0 sc0 ls0 ws0">extern int already_running(void);</div><div class="t m0 x32 h4e y3ab6 ff1a fs28 fc0 sc0 ls0 ws0">void</div><div class="t m0 x32 h4e y3ab7 ff1a fs28 fc0 sc0 ls0 ws0">reread(void)</div><div class="t m0 x32 h4e y3ab8 ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y3ab9 ff1a fs28 fc0 sc0 ls0 ws0">/* ... */</div><div class="t m0 x32 h4e y3aba ff1a fs28 fc0 sc0 ls0 ws0">}</div><div class="t m0 x32 h4e y3abb ff1a fs28 fc0 sc0 ls0 ws0">void *</div><div class="t m0 x32 h4e y3abc ff1a fs28 fc0 sc0 ls0 ws0">thr_fn(void *arg)</div><div class="t m0 x32 h4e y3abd ff1a fs28 fc0 sc0 ls0 ws0">{</div><div class="t m0 x8a h4e y3abe ff1a fs28 fc0 sc0 ls0 ws0">int err, signo;</div><div class="t m0 x8a h4e y3abf ff1a fs28 fc0 sc0 ls0 ws0">for (;;) {</div><div class="t m0 x9d h4e y3ac0 ff1a fs28 fc0 sc0 ls0 ws0">err = sigwait(&amp;mask, &amp;signo);</div><div class="t m0 x9d h4e y3ac1 ff1a fs28 fc0 sc0 ls0 ws0">if (err != 0) {</div><div class="t m0 x1f h4e y3ac2 ff1a fs28 fc0 sc0 ls0 ws0">syslog(LOG_ERR, &quot;sigwait failed&quot;);</div><div class="t m0 x1f h4e y3ac3 ff1a fs28 fc0 sc0 ls0 ws0">exit(1);</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
