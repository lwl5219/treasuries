<div id="pffd" class="pf w4 h1f" data-page-no="fd"><div class="pc pcfd w4 h1f"><img class="bi x0 y0 w3 h4" alt="" src="bgfd.png"/><div class="t m0 x31 h2 y8e ff1 fs0 fc0 sc0 ls0 ws0"><span class="fc1 sc0">ptg10805159</span></div><div class="t m0 x35 h7a ya4 ff19 fs0 fc0 sc0 ls0 ws0">Section <span class="_"> </span>7.10<span class="_ _15b"> </span><span class="ff1a">setjmp<span class="_ _4b"> </span></span>and<span class="_ _59"> </span><span class="ff1a">longjmp<span class="_ _4b"> </span></span>Functions<span class="_ _1b"> </span><span class="ff18">219</span></div><div class="t m0 x32 h2a y12f ff19 fsf fc0 sc0 ls0 ws0">If <span class="_ _35"> </span>we <span class="_ _45"> </span>compile <span class="_ _35"> </span>and <span class="_ _35"> </span>test <span class="_ _35"> </span>the <span class="_ _35"> </span>pr<span class="_ _0"></span>ogram <span class="_ _35"> </span>in <span class="_ _35"> </span>Figur<span class="_ _0"></span><span class="ls8e8">e7<span class="_ _7"></span><span class="ls0">.13, <span class="_ _35"> </span>with <span class="_ _35"> </span>and <span class="_ _35"> </span>without <span class="_ _45"> </span>compiler</span></span></div><div class="t m0 x32 h2a y130 ff19 fsf fc0 sc0 ls0 ws0">optimizations, the results ar<span class="_ _0"></span><span class="ls44">ed<span class="_ _d"></span><span class="ls0">iffer<span class="_ _0"></span>ent:</span></span></div><div class="t m0 x3f h57 y1c09 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">gcc testjmp.c<span class="_ _19f"> </span><span class="ff1b">compile without any optimization</span></span></div><div class="t m0 x3f h57 y1c0a ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">./a.out</span></div><div class="t m0 x3f h57 y1c0b ff1a fs2d fc0 sc0 ls0 ws0">in f1():</div><div class="t m0 x3f h57 y1c0c ff1a fs2d fc0 sc0 ls0 ws0">globval = 95, autoval = 96, regival = 97, volaval = 98, statval = 99</div><div class="t m0 x3f h57 y1c0d ff1a fs2d fc0 sc0 ls0 ws0">after longjmp:</div><div class="t m0 x3f h57 y1c0e ff1a fs2d fc0 sc0 ls0 ws0">globval = 95, autoval = 96, regival = 97, volaval = 98, statval = 99</div><div class="t m0 x3f h57 y1d56 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">gcc -O testjmp.c<span class="_ _1d7"> </span><span class="ff1b">compile with full optimization</span></span></div><div class="t m0 x3f h57 y1d57 ff1a fs2d fc0 sc0 ls0 ws0">$<span class="_"> </span><span class="ff1f">./a.out</span></div><div class="t m0 x3f h57 y1d58 ff1a fs2d fc0 sc0 ls0 ws0">in f1():</div><div class="t m0 x3f h57 y1d59 ff1a fs2d fc0 sc0 ls0 ws0">globval = 95, autoval = 96, regival = 97, volaval = 98, statval = 99</div><div class="t m0 x3f h57 y1d5a ff1a fs2d fc0 sc0 ls0 ws0">after longjmp:</div><div class="t m0 x3f h57 y1d5b ff1a fs2d fc0 sc0 ls0 ws0">globval = 95, autoval = 2, regival = 3, volaval = 98, statval = 99</div><div class="t m0 x32 h2a y1d5c ff19 fsf fc0 sc0 ls0 ws0">Note <span class="_ _23"> </span>that <span class="_ _42"> </span>the <span class="_ _23"> </span>optimizations <span class="_ _23"> </span>don’t <span class="_ _42"> </span>affect <span class="_ _23"></span>the <span class="_ _23"> </span>global, <span class="_ _42"> </span>static, <span class="_ _23"> </span>and <span class="_ _23"> </span>volatile <span class="_ _42"> </span>variables; <span class="_ _23"> </span>their</div><div class="t m0 x32 h26 y1d5d ff19 fsf fc0 sc0 ls0 ws0">values after <span class="_ _2"></span>the<span class="_"> </span><span class="ff1a">longjmp<span class="_ _47"> </span></span>ar<span class="_ _0"></span><span class="ls8e9">et<span class="_ _4f"></span><span class="ls0">he <span class="_ _2"></span>last <span class="_ _2"></span>values that <span class="_ _2"></span>they <span class="_ _2"></span>assumed.<span class="_ _46"> </span>The<span class="_ _66"> </span><span class="ff1a">setjmp</span></span></span></div><div class="t m0 x70 h2a y1d5e ff19 fsf fc0 sc0 ls0 ws0">(</div><div class="t m0 x1a2 h2a y1d5d ff19 fsf fc0 sc0 ls0 ws0">3</div><div class="t m0 x6f h2a y1d5e ff19 fsf fc0 sc0 ls0 ws0">)</div><div class="t m0 x1ee h2a y1d5d ff19 fsf fc0 sc0 ls0 ws0">manual</div><div class="t m0 x32 h2a y1d5f ff19 fsf fc0 sc0 ls0 ws0">page <span class="_ _23"></span>on <span class="_ _23"></span>one <span class="_ _23"></span>system <span class="_ _23"></span>states <span class="_ _23"></span>that <span class="_ _23"> </span>variables <span class="_ _23"> </span>stored <span class="_ _23"></span>in <span class="_ _23"></span>memory <span class="_ _23"></span>will <span class="_ _23"></span>have <span class="_ _23"></span>values <span class="_ _23"></span>as <span class="_ _23"></span>of <span class="_ _23"></span>the</div><div class="t m0 x32 h26 y1d60 ff19 fsf fc0 sc0 ls0 ws0">time <span class="_ _53"> </span>of <span class="_ _e"> </span>the<span class="_ _4b"> </span><span class="ff1a">longjmp</span><span class="ls8ea">,w<span class="_ _c"></span><span class="ls0">hereas <span class="_ _53"> </span>variables <span class="_ _53"> </span>in <span class="_ _e"> </span>the <span class="_ _e"> </span>CPU <span class="_ _e"> </span>and <span class="_ _53"> </span>ﬂoating-point <span class="_ _e"> </span>registers <span class="_ _53"> </span>are</span></span></div><div class="t m0 x32 h26 y1d61 ff19 fsf fc0 sc0 ls45 ws0">re<span class="ls0">stored <span class="_ _2"></span>to <span class="_ _2"></span>their <span class="_ _2"></span>values <span class="_ _2"></span>when<span class="_ _47"> </span><span class="ff1a">setjmp<span class="_ _66"> </span></span>was <span class="_ _2"></span>called.<span class="_ _61"> </span>This <span class="_ _3"></span>is <span class="_ _2"></span>indeed <span class="_ _2"></span>what <span class="_ _2"></span>we <span class="_ _2"></span>see <span class="_ _2"></span>when <span class="_ _3"></span>we</span></div><div class="t m0 x32 h2a y1d62 ff19 fsf fc0 sc0 ls4e ws0">ru<span class="ls8eb">nt<span class="_ _43"></span><span class="ls0">he <span class="_ _42"> </span>program <span class="_ _9"></span>in <span class="_ _42"> </span>Figur<span class="ls8eb">e7<span class="_ _43"></span><span class="ls0">.13. <span class="_ _35"> </span>W<span class="_ _1"></span>ithout <span class="_ _23"></span>optimization, <span class="_ _23"> </span>all <span class="_ _23"> </span>ﬁve <span class="_ _42"> </span>variables <span class="_ _23"> </span>ar<span class="ls49f">es<span class="_ _43"></span><span class="ls0">tored <span class="_ _23"></span>in</span></span></span></span></span></span></div><div class="t m0 x32 h26 y1d63 ff19 fsf fc0 sc0 ls0 ws0">memory <span class="_ _9"></span>(the<span class="_ _45"> </span><span class="ff1a">register<span class="_ _45"> </span></span>hint <span class="_ _9"></span>is <span class="_ _9"></span>ignored <span class="_ _9"></span>for<span class="_ _45"> </span><span class="ff1a">regival</span>). <span class="_ _45"> </span>When<span class="_ _45"> </span>we <span class="_ _9"></span>enable <span class="_ _9"></span>optimization,</div><div class="t m0 x32 h26 y1d64 ff19 fsf fc0 sc0 ls0 ws0">both<span class="_ _47"> </span><span class="ff1a">autoval<span class="_ _47"> </span></span>and<span class="_ _47"> </span><span class="ff1a">regival<span class="_ _47"> </span></span>go <span class="_ _3"></span>into <span class="_ _2"></span>registers, <span class="_ _3"></span>even <span class="_ _3"></span>though <span class="_ _2"></span>the <span class="_ _3"></span>former <span class="_ _3"></span>wasn’t <span class="_ _3"></span>declared</div><div class="t m0 x32 h26 y1d65 ff1a fsf fc0 sc0 ls0 ws0">register<span class="ff19 ls8ec">,a<span class="_ _d"></span><span class="ls0">nd the<span class="_"> </span><span class="ff1a">volatile<span class="_ _66"> </span></span>variable stays in memory<span class="_ _4"></span><span class="ls8ed">.T<span class="_ _4a"></span><span class="ls0">he important thing to realize</span></span></span></span></div><div class="t m0 x32 h26 y1d66 ff19 fsf fc0 sc0 ls0 ws0">with <span class="_ _66"> </span>this <span class="_ _47"> </span>example <span class="_ _47"> </span>is <span class="_ _66"> </span>that <span class="_ _47"> </span>you <span class="_ _47"> </span>must <span class="_ _66"> </span>use <span class="_ _47"> </span>the<span class="_ _61"> </span><span class="ff1a">volatile<span class="_ _61"> </span></span>attribute <span class="_ _47"> </span>if <span class="_ _66"> </span>you’r<span class="ls8ee">ew<span class="_ _1d"></span><span class="ls0">riting</span></span></div><div class="t m0 x32 h2a y1d67 ff19 fsf fc0 sc0 ls0 ws0">portable <span class="_ _3"></span>code <span class="_ _9"></span>that <span class="_ _9"></span>uses <span class="_ _9"></span>nonlocal <span class="_ _3"></span>jumps.<span class="_ _5a"> </span>Anything <span class="_ _9"></span>else <span class="_ _9"></span>can <span class="_ _3"></span>change <span class="_ _9"></span>from <span class="_ _3"></span>one <span class="_ _9"></span>system <span class="_ _9"></span>to</div><div class="t m0 x32 h2a y1d68 ff19 fsf fc0 sc0 ls0 ws0">the next.</div><div class="t m0 x3f h26 y1d69 ff19 fsf fc0 sc0 ls0 ws0">Some<span class="_ _45"> </span><span class="ff1a">printf<span class="_ _47"> </span></span>format <span class="_ _9"></span>strings <span class="_ _3"></span>in <span class="_ _9"></span>Figur<span class="ls5a">e7<span class="_ _b"></span><span class="ls0">.13 <span class="_ _9"></span>ar<span class="ls5a">el<span class="_ _b"></span><span class="ls0">onger <span class="_ _3"></span>than <span class="_ _9"></span>will <span class="_ _9"></span>ﬁt <span class="_ _9"></span>comfortably <span class="_ _3"></span>for</span></span></span></span></div><div class="t m0 x32 h26 y1d6a ff19 fsf fc0 sc0 ls0 ws0">display <span class="_ _2"></span>in <span class="_ _2"></span>a <span class="_ _2"></span>programming <span class="_ _2"></span>text.<span class="_ _61"> </span>Instead <span class="_ _2"></span>of <span class="_ _2"></span>making <span class="_ _2"></span>multiple <span class="_ _3"></span>calls <span class="_ _2"></span>to<span class="_ _47"> </span><span class="ff1a">printf</span>,<span class="_"> </span>we<span class="_ _47"> </span>rely on</div><div class="t m0 x32 h2a y1d6b ff19 fsf fc0 sc0 ls0 ws0">ISO C’s string concatenation feature, wher<span class="_ _0"></span><span class="ls44">et<span class="_ _d"></span><span class="ls0">he sequence</span></span></div><div class="t m0 x3f h57 y1d6c ff1a fs2d fc0 sc0 ls0 ws0">&quot;string1&quot; &quot;string2&quot;</div><div class="t m0 x32 h2a y1d6d ff19 fsf fc0 sc0 ls0 ws0">is equivalent to</div><div class="t m0 x3f h57 y1d6e ff1a fs2d fc0 sc0 ls0 ws0">&quot;string1string2&quot;</div><div class="t m0 x3f h4d y1d6f ff19 fs26 fc0 sc0 ls164 ws0">We<span class="_ _9"></span><span class="ls0">’ll <span class="_ _3"></span>return <span class="_ _2"></span>to <span class="_ _3"></span>these <span class="_ _3"></span>two <span class="_ _3"></span>functions,<span class="_ _47"> </span><span class="ff1a">setjmp<span class="_ _45"> </span></span>and<span class="_ _66"> </span><span class="ff1a">longjmp</span>,<span class="_ _45"> </span>in<span class="_ _47"> </span>Chapter <span class="_ _2"></span>10 <span class="_ _3"></span>when <span class="_ _3"></span>we</span></div><div class="t m0 x32 h4d y1d70 ff19 fs26 fc0 sc0 ls0 ws0">discuss signal handlers and their signal versions:<span class="_"> </span><span class="ff1a">sigsetjmp<span class="_ _80"> </span></span>and<span class="_"> </span><span class="ff1a">siglongjmp</span>.</div><div class="t m0 x35 h4c y1d71 ff16 fs26 fc0 sc0 ls8ef ws0">Po<span class="_ _2"></span><span class="ls0">tential Problem with A<span class="_ _1"></span>utomatic V<span class="_ _1"></span>ariables</span></div><div class="t m0 x32 h49 y1d72 ff19 fs26 fc0 sc0 ls0 ws0">Having <span class="_ _42"> </span>looked <span class="_ _42"> </span>at <span class="_ _42"> </span>the <span class="_ _42"> </span>way <span class="_ _42"> </span>stack <span class="_ _42"> </span>frames <span class="_ _42"> </span>ar<span class="_ _0"></span><span class="ls8f0">eu<span class="_ _43"></span><span class="ls0">sually <span class="_ _23"> </span>handled, <span class="_ _42"> </span>it <span class="_ _42"> </span>is <span class="_ _42"> </span>worth <span class="_ _42"> </span>looking <span class="_ _42"> </span>at <span class="_ _42"> </span>a</span></span></div><div class="t m0 x32 h49 y1d73 ff19 fs26 fc0 sc0 ls0 ws0">potential <span class="_ _3"></span>error <span class="_ _3"></span>in <span class="_ _9"></span>dealing <span class="_ _3"></span>with <span class="_ _9"></span>automatic <span class="_ _3"></span>variables.<span class="_ _16"> </span>The <span class="_ _9"></span>basic <span class="_ _3"></span>rule <span class="_ _9"></span>is <span class="_ _3"></span>that <span class="_ _9"></span>an <span class="_ _3"></span>automatic</div><div class="t m0 x32 h49 y1d74 ff19 fs26 fc0 sc0 ls0 ws0">variable <span class="_ _9"></span>can <span class="_ _9"></span>never <span class="_ _9"></span>be <span class="_ _9"></span>refer<span class="_ _0"></span>enced <span class="_ _9"></span>after <span class="_ _9"></span>the <span class="_ _9"></span>function <span class="_ _9"></span>that <span class="_ _9"></span>declared <span class="_ _3"></span>it <span class="_ _9"></span>returns. <span class="_ _45"> </span>Numerous</div><div class="t m0 x32 h49 y1d75 ff19 fs26 fc0 sc0 ls0 ws0">warnings about this can be found throughout the UNIX System manuals.</div><div class="t m0 x3f h4d y1d76 ff19 fs26 fc0 sc0 ls0 ws0">Figur<span class="ls8f1">e7<span class="_ _b"></span><span class="ls0">.14 <span class="_ _3"></span>shows <span class="_ _9"></span>a <span class="_ _23"></span>function <span class="_ _3"></span>called<span class="_ _45"> </span><span class="ff1a">open_data<span class="_ _45"> </span></span>that <span class="_ _9"></span>opens <span class="_ _9"></span>a <span class="_ _23"></span>standar<span class="_ _0"></span><span class="ls8f2">dI<span class="_ _b"></span><span class="ls0">/O <span class="_ _9"></span>stream</span></span></span></span></div><div class="t m0 x32 h49 y1d77 ff19 fs26 fc0 sc0 ls0 ws0">and sets the buffering for the str<span class="_ _0"></span>eam.</div></div><div class="pi" data-data='{"ctm":[2.100000,0.000000,0.000000,2.100000,-115.668004,-156.491993]}'></div></div>
