<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>31-æ¡ˆä¾‹ï¼šå½“ç£ç›˜å‚æ•°å¯¼è‡´IOé«˜çš„æ—¶å€™ï¼Œåº”è¯¥æ€ä¹ˆåŠï¼Ÿ</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <style>
        html {
            color: #333;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            text-rendering: optimizelegibility;
            font-family: Helvetica Neue, PingFang SC, Verdana, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, sans-serif
        }

        html.borderbox *,
        html.borderbox :after,
        html.borderbox :before {
            box-sizing: border-box
        }

        article,
        aside,
        blockquote,
        body,
        button,
        code,
        dd,
        details,
        dl,
        dt,
        fieldset,
        figcaption,
        figure,
        footer,
        form,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        header,
        hr,
        input,
        legend,
        li,
        menu,
        nav,
        ol,
        p,
        pre,
        section,
        td,
        textarea,
        th,
        ul {
            margin: 0;
            padding: 0
        }

        article,
        aside,
        details,
        figcaption,
        figure,
        footer,
        header,
        menu,
        nav,
        section {
            display: block
        }

        audio,
        canvas,
        video {
            display: inline-block
        }

        body,
        button,
        input,
        select,
        textarea {
            font: 300 1em/1.8 PingFang SC, Lantinghei SC, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, Helvetica, sans-serif
        }

        button::-moz-focus-inner,
        input::-moz-focus-inner {
            padding: 0;
            border: 0
        }

        table {
            border-collapse: collapse;
            border-spacing: 0
        }

        fieldset,
        img {
            border: 0
        }

        blockquote {
            position: relative;
            color: #999;
            font-weight: 400;
            border-left: 1px solid #1abc9c;
            padding-left: 1em;
            margin: 1em 3em 1em 2em
        }

        @media only screen and (max-width: 640px) {
            blockquote {
                margin: 1em 0
            }
        }

        abbr,
        acronym {
            border-bottom: 1px dotted;
            font-variant: normal
        }

        abbr {
            cursor: help
        }

        del {
            text-decoration: line-through
        }

        address,
        caption,
        cite,
        code,
        dfn,
        em,
        th,
        var {
            font-style: normal;
            font-weight: 400
        }

        ol,
        ul {
            list-style: none
        }

        caption,
        th {
            text-align: left
        }

        q:after,
        q:before {
            content: ""
        }

        sub,
        sup {
            font-size: 75%;
            line-height: 0;
            position: relative
        }

        :root sub,
        :root sup {
            vertical-align: baseline
        }

        sup {
            top: -.5em
        }

        sub {
            bottom: -.25em
        }

        a {
            color: #1abc9c
        }

        a:hover {
            text-decoration: underline
        }

        .typo a {
            border-bottom: 1px solid #1abc9c
        }

        .typo a:hover {
            border-bottom-color: #555;
            color: #555
        }

        .typo a:hover,
        a,
        ins {
            text-decoration: none
        }

        .typo-u,
        u {
            text-decoration: underline
        }

        mark {
            background: #fffdd1;
            border-bottom: 1px solid #ffedce;
            padding: 2px;
            margin: 0 5px
        }

        code,
        pre,
        pre tt {
            font-family: Courier, Courier New, monospace
        }

        pre {
            background: hsla(0, 0%, 97%, .7);
            border: 1px solid #ddd;
            padding: 1em 1.5em;
            display: block;
            -webkit-overflow-scrolling: touch
        }

        hr {
            border: none;
            border-bottom: 1px solid #cfcfcf;
            margin-bottom: .8em;
            height: 10px
        }

        .typo-small,
        figcaption,
        small {
            font-size: .9em;
            color: #888
        }

        b,
        strong {
            font-weight: 700;
            color: #000
        }

        [draggable] {
            cursor: move
        }

        .clearfix:after,
        .clearfix:before {
            content: "";
            display: table
        }

        .clearfix:after {
            clear: both
        }

        .clearfix {
            zoom: 1
        }

        .textwrap,
        .textwrap td,
        .textwrap th {
            word-wrap: break-word;
            word-break: break-all
        }

        .textwrap-table {
            table-layout: fixed
        }

        .serif {
            font-family: Palatino, Optima, Georgia, serif
        }

        .typo-dl,
        .typo-form,
        .typo-hr,
        .typo-ol,
        .typo-p,
        .typo-pre,
        .typo-table,
        .typo-ul,
        .typo dl,
        .typo form,
        .typo hr,
        .typo ol,
        .typo p,
        .typo pre,
        .typo table,
        .typo ul,
        blockquote {
            margin-bottom: 1rem
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: PingFang SC, Helvetica Neue, Verdana, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, sans-serif;
            color: #000;
            line-height: 1.35
        }

        .typo-h1,
        .typo-h2,
        .typo-h3,
        .typo-h4,
        .typo-h5,
        .typo-h6,
        .typo h1,
        .typo h2,
        .typo h3,
        .typo h4,
        .typo h5,
        .typo h6 {
            margin-top: 1.2em;
            margin-bottom: .6em;
            line-height: 1.35
        }

        .typo-h1,
        .typo h1 {
            font-size: 2em
        }

        .typo-h2,
        .typo h2 {
            font-size: 1.8em
        }

        .typo-h3,
        .typo h3 {
            font-size: 1.6em
        }

        .typo-h4,
        .typo h4 {
            font-size: 1.4em
        }

        .typo-h5,
        .typo-h6,
        .typo h5,
        .typo h6 {
            font-size: 1.2em
        }

        .typo-ul,
        .typo ul {
            margin-left: 1.3em;
            list-style: disc
        }

        .typo-ol,
        .typo ol {
            list-style: decimal;
            margin-left: 1.9em
        }

        .typo-ol ol,
        .typo-ol ul,
        .typo-ul ol,
        .typo-ul ul,
        .typo li ol,
        .typo li ul {
            margin-bottom: .8em;
            margin-left: 2em
        }

        .typo-ol ul,
        .typo-ul ul,
        .typo li ul {
            list-style: circle
        }

        .typo-table td,
        .typo-table th,
        .typo table caption,
        .typo table td,
        .typo table th {
            border: 1px solid #ddd;
            padding: .5em 1em;
            color: #666
        }

        .typo-table th,
        .typo table th {
            background: #fbfbfb
        }

        .typo-table thead th,
        .typo table thead th {
            background: hsla(0, 0%, 95%, .7)
        }

        .typo table caption {
            border-bottom: none
        }

        .typo-input,
        .typo-textarea {
            -webkit-appearance: none;
            border-radius: 0
        }

        .typo-em,
        .typo em,
        caption,
        legend {
            color: #000;
            font-weight: inherit
        }

        .typo-em {
            position: relative
        }

        .typo-em:after {
            position: absolute;
            top: .65em;
            left: 0;
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
            content: "\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB"
        }

        .typo img {
            max-width: 100%
        }

        .common-content {
            font-weight: 400;
            color: #353535;
            line-height: 1.75rem;
            white-space: normal;
            word-break: normal;
            font-size: 1rem
        }

        .common-content img {
            display: block;
            max-width: 100%;
            background-color: #eee
        }

        .common-content audio,
        .common-content video {
            width: 100%;
            background-color: #eee
        }

        .common-content center,
        .common-content font {
            margin-top: 1rem;
            display: inline-block
        }

        .common-content center {
            width: 100%
        }

        .common-content pre {
            margin-top: 1rem;
            padding-left: 0;
            padding-right: 0;
            position: relative;
            overflow: hidden
        }

        .common-content pre code {
            font-size: .8rem;
            font-family: Consolas, Liberation Mono, Menlo, monospace, Courier;
            display: block;
            width: 100%;
            box-sizing: border-box;
            padding-left: 1rem;
            padding-right: 1rem;
            overflow-x: auto
        }

        .common-content hr {
            border: none;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            border-top: 1px solid #f5f5f5;
            height: 1px;
            background: none
        }

        .common-content b,
        .common-content h1,
        .common-content h2,
        .common-content h3,
        .common-content h4,
        .common-content h5,
        .common-content strong {
            font-weight: 700
        }

        .common-content h1,
        .common-content h2 {
            font-size: 1.125rem;
            margin-bottom: .45rem
        }

        .common-content h3,
        .common-content h4,
        .common-content h5 {
            font-size: 1rem;
            margin-bottom: .45rem
        }

        .common-content p {
            font-weight: 400;
            color: #353535;
            margin-top: .15rem
        }

        .common-content .orange {
            color: #ff5a05
        }

        .common-content .reference {
            font-size: 1rem;
            color: #888
        }

        .custom-rich-content h1 {
            margin-top: 0;
            font-weight: 400;
            font-size: 15.25px;
            border-bottom: 1px solid #eee;
            line-height: 2.8
        }

        .custom-rich-content li,
        .custom-rich-content p {
            font-size: 14px;
            color: #888;
            line-height: 1.6
        }

        table.hljs-ln {
            margin-bottom: 0;
            border-spacing: 0;
            border-collapse: collapse
        }

        table.hljs-ln,
        table.hljs-ln tbody,
        table.hljs-ln td,
        table.hljs-ln tr {
            box-sizing: border-box
        }

        table.hljs-ln td {
            padding: 0;
            border: 0
        }

        table.hljs-ln td.hljs-ln-numbers {
            min-width: 15px;
            color: rgba(27, 31, 35, .3);
            text-align: right;
            white-space: nowrap;
            cursor: pointer;
            user-select: none
        }

        table.hljs-ln td.hljs-ln-code,
        table.hljs-ln td.hljs-ln-numbers {
            font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;
            font-size: 12px;
            line-height: 20px;
            vertical-align: top
        }

        table.hljs-ln td.hljs-ln-code {
            position: relative;
            padding-right: 10px;
            padding-left: 10px;
            overflow: visible;
            color: #24292e;
            word-wrap: normal;
            white-space: pre
        }

        video::-webkit-media-controls {
            overflow: hidden !important
        }

        video::-webkit-media-controls-enclosure {
            width: calc(100% + 32px);
            margin-left: auto
        }

        ._29HP61GA_0 {
            max-width:800px;
            margin:0 auto;
            margin-bottom: 20px;
            font-weight: 400;
            color: #353535;
            line-height: 1.76;
            white-space: normal;
            word-break: normal;
            font-size: 17px;
            -webkit-transition: background-color .3s ease;
            transition: background-color .3s ease
        }

        ._29HP61GA_0 .MathJax_Display {
            overflow: auto
        }

        ._29HP61GA_0 .poster {
            position: fixed;
            left: -10000px;
            top: -10000px;
            overflow: hidden;
            padding: 1rem;
            background: #ececec
        }

        ._29HP61GA_0 .richcontent-pre-copy {
            font-size: 13px;
            color: #888;
            position: absolute;
            right: 1em;
            top: .5em;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none
        }

        ._29HP61GA_0 .richcontent-pre-copy .iconfont {
            font-size: 12px;
            margin-right: .2em
        }

        ._29HP61GA_0 a {
            color: #fa8919;
            border-bottom: 1px solid #fa8919
        }

        ._29HP61GA_0 img {
            display: block;
            max-width: 100%;
            position: relative;
            left: 50%;
            -webkit-transform: translateX(-50%);
            transform: translateX(-50%);
            background-color: #eee;
            vertical-align: top;
            border-radius: 0
        }

        ._29HP61GA_0 audio,
        ._29HP61GA_0 video {
            width: 100%;
            background-color: #eee
        }

        ._29HP61GA_0 pre {
            margin-top: 16px;
            padding: 34px 0 0;
            margin-bottom: 30px;
            position: relative;
            border-radius: 6px;
            background: rgba(246, 247, 251, .749);
            border: 0
        }

        ._29HP61GA_0 pre code {
            font-size: 12px;
            font-family: Consolas, Liberation Mono, Menlo, monospace, Courier;
            display: block;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            margin-left: 16px;
            margin-right: 16px;
            overflow-x: scroll
        }

        ._29HP61GA_0 pre code:after {
            content: "";
            height: 30px;
            width: 100%;
            display: block
        }

        ._29HP61GA_0 hr {
            border: none;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            border-top: 1px solid #f5f5f5;
            height: 1px;
            background: none
        }

        ._29HP61GA_0 h1,
        ._29HP61GA_0 h2,
        ._29HP61GA_0 h3,
        ._29HP61GA_0 h4,
        ._29HP61GA_0 h5 {
            margin-bottom: 20px;
            margin-top: 0;
            font-weight: 700
        }

        ._29HP61GA_0 b,
        ._29HP61GA_0 strong {
            font-weight: 700
        }

        ._29HP61GA_0 h1 {
            font-size: 21px
        }

        ._29HP61GA_0 h2 {
            font-size: 20px
        }

        ._29HP61GA_0 h3 {
            font-size: 19px
        }

        ._29HP61GA_0 h4 {
            font-size: 18px
        }

        ._29HP61GA_0 h5 {
            font-size: 17px
        }

        ._29HP61GA_0 center,
        ._29HP61GA_0 p {
            font-weight: 400;
            color: #353535;
            margin-top: 0;
            margin-bottom: 30px;
            word-break: break-word
        }

        ._29HP61GA_0 center {
            text-align: center
        }

        ._29HP61GA_0 blockquote {
            margin-top: 0;
            margin-bottom: 34px;
            border-left: 3px solid #e8e8e8;
            padding-left: 17px;
            color: #353535
        }

        ._29HP61GA_0 blockquote p {
            margin-top: 0;
            margin-bottom: 0
        }

        ._29HP61GA_0 ol,
        ._29HP61GA_0 ul {
            margin-bottom: 30px
        }

        ._29HP61GA_0 ol p,
        ._29HP61GA_0 ul p {
            margin-top: 0;
            margin-bottom: 0
        }

        ._29HP61GA_0 ol {
            list-style: decimal;
            margin-left: 20px
        }

        ._29HP61GA_0 ul li {
            padding-left: 17px;
            position: relative;
            margin-bottom: 10px
        }

        ._29HP61GA_0 ul li:after {
            content: "";
            height: 6px;
            width: 6px;
            border-radius: 50%;
            background: #353535;
            position: absolute;
            top: 10px;
            left: 0
        }

        ._29HP61GA_0 .orange {
            color: #fa8919
        }

        ._29HP61GA_0 .reference {
            color: #888
        }

        ._29HP61GA_0 .m-right {
            text-align: right
        }

        ._29HP61GA_0 .m-center {
            text-align: center;
            display: block
        }

        ._29HP61GA_0 .m-gray {
            color: #888
        }

        ._29HP61GA_0 .m-small {
            font-size: 15px
        }

        ._29HP61GA_0 table.hljs-ln {
            margin-bottom: 0;
            border-spacing: 0;
            border-collapse: collapse
        }

        ._29HP61GA_0 table.hljs-ln,
        ._29HP61GA_0 table.hljs-ln tbody,
        ._29HP61GA_0 table.hljs-ln td,
        ._29HP61GA_0 table.hljs-ln tr {
            -webkit-box-sizing: border-box;
            box-sizing: border-box
        }

        ._29HP61GA_0 table.hljs-ln td {
            padding: 0;
            border: 0
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-numbers {
            min-width: 15px;
            font-size: 12px;
            color: rgba(27, 31, 35, .3);
            text-align: right;
            white-space: nowrap;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-code,
        ._29HP61GA_0 table.hljs-ln td.hljs-ln-numbers {
            font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;
            line-height: 20px;
            vertical-align: top
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-code {
            position: relative;
            padding-right: 10px;
            padding-left: 10px;
            overflow: visible;
            font-size: 13px;
            color: #666;
            word-wrap: normal;
            white-space: pre
        }

    </style>
</head>
<body>
<div class="_29HP61GA_0">
<h1>31-æ¡ˆä¾‹ï¼šå½“ç£ç›˜å‚æ•°å¯¼è‡´IOé«˜çš„æ—¶å€™ï¼Œåº”è¯¥æ€ä¹ˆåŠï¼Ÿ</h1>
<p>åœ¨å¤§éƒ¨åˆ†çš„æ€§èƒ½é¡¹ç›®ä¸­ï¼Œå½“ç³»ç»Ÿè°ƒä¼˜åˆ°ä¸€å®šç¨‹åº¦çš„æ—¶å€™ï¼Œæ€§èƒ½çš„ç“¶é¢ˆå¾€å¾€ä¼šä½“ç°åœ¨ä¸¤ç±»è®¡æ•°å™¨ä¸Šï¼šä¸€ä¸ªæ˜¯CPUï¼Œå¦ä¸€ä¸ªå°±æ˜¯ç£ç›˜I/Oäº†ã€‚æ‰€ä»¥æˆ‘ä»¬ä¹Ÿç»å¸¸ä¼šåœ¨ä¸€äº›æ€§èƒ½ä¼˜åŒ–çš„æ–‡ç« ä¸­çœ‹åˆ°ä¸¤ä¸ªåˆ†ç±»ï¼Œåˆ†åˆ«æ˜¯CPUå¯†é›†å‹å’Œç£ç›˜I/Oå¯†é›†å‹ã€‚</p><p>æœ‰äººè¯´ä¸ºä»€ä¹ˆä¸è¯´å†…å­˜å‘¢ï¼Ÿå†…å­˜æ˜¯é‚£ä¹ˆé‡è¦ã€‚ä¸æ˜¯è¯´å†…å­˜ä¸ä¼šæˆä¸ºç“¶é¢ˆï¼Œåªä¸è¿‡å†…å­˜çš„ç“¶é¢ˆåŸºæœ¬ä¸Šéƒ½å¯ä»¥è½¬å«ç»™CPUå’Œç£ç›˜I/Oã€‚å½“å†…å­˜ä¸å¤Ÿçš„æ—¶å€™ï¼Œå¤§ä¸äº†å°±æ˜¯æ¸…ç†å¾—å¿«ä¸€ç‚¹ã€‚å†…å­˜èƒ½è¡¨ç°å‡ºæ¥çš„ï¼Œå°±æ˜¯æ»¡ä¸æ»¡ï¼Œè€Œè°å»æ¸…ç†å‘¢ï¼Ÿé‚£å°±æ˜¯CPUäº†ã€‚æ¸…ç†å¾—å¿«å°±å¾—CPUè½¬å¾—å¿«ã€‚</p><p>æˆ‘ä»¬ç»å¸¸ä¼šå¬åˆ°æœ‰äººè¯´ä»€ä¹ˆæ€§èƒ½ä¼˜åŒ–åˆ°æœ€åå°±æ˜¯â€œç©ºé—´è½¬æ—¶é—´ã€æ—¶é—´è½¬ç©ºé—´çš„ä¼˜åŒ–â€ã€‚å¦‚æ­¤å¸¦æœ‰ç¦…æ„çš„ä¸€å¥è¯ï¼Œå…¶å®æ„æ€å°±æ˜¯ï¼ŒCPUä¸å¤Ÿç”¨ï¼Œå°±æ‰©å¤§å†…å­˜ï¼›å†…å­˜ä¸å¤Ÿï¼Œå°±è®©CPUè®¡ç®—å¾—æ›´å¿«ä¸€äº›ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå½“æˆ‘ä»¬éœ€è¦åœ¨å†…å­˜ä¸­ä½¿ç”¨å¾ˆå¤šå˜é‡æ—¶ï¼Œå¦‚æœå†…å­˜ä¸å¤Ÿï¼Œå°±ä¼šå¯¼è‡´CPUä¸æ–­æ¸…ç†å†…å­˜ä¸­æ²¡è¢«å¼•ç”¨çš„å˜é‡æ¥é‡Šæ”¾å†…å­˜ï¼Œè¿™å°±å¯¼è‡´äº†é‡Šæ”¾å†…å­˜çš„åŠ¨ä½œä¼šæ¶ˆè€—æ›´å¤šçš„CPUã€‚è€Œè¿™æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨å¢åŠ å†…å­˜çš„æ–¹å¼ï¼Œè®©CPUä¸é‚£ä¹ˆç¹å¿™ã€‚</p><p>ä½†è¿™ä¸ªâ€œç©ºé—´ã€æ—¶é—´è½¬åŒ–â€çš„è®ºç‚¹å¹¶ä¸ä¼šåœ¨æ‰€æœ‰çš„åœºæ™¯ä¸‹æˆç«‹ã€‚æ¯”å¦‚è¯´ä¸€ä¸ªåº”ç”¨å¹¶ä¸éœ€è¦å¤šå¤§å†…å­˜ï¼Œå°±æ˜¯çº¯è®¡ç®—å‹çš„ï¼Œé‚£ä½ åŠ å†…å­˜ä¹Ÿæ²¡å•¥ç”¨ã€‚å¦å¤–è¿™é‡Œæåˆ°çš„â€œç©ºé—´â€ä¹Ÿä¸æ˜¯ç¡¬ç›˜ï¼Œå› ä¸ºå¦‚æœCPUä¸å¤Ÿç”¨ï¼Œæ‹¿å†å¤šç£ç›˜è¡¥ä¹Ÿæ— æµäºäº‹ã€‚</p><!-- [[[read_end]]] --><p>æ‰€ä»¥è¿™å¥è¯åªèƒ½æ˜¯åšä¸ºé«˜æ·±è°’è¯­è®©åˆå…¥æ€§èƒ½çš„å°ç™½ä»¬ä»°æœ›ï¼Œå®é™…ä¸Šé€‚ç”¨çš„åœºæ™¯éå¸¸å°‘ã€‚</p><p>è€Œç£ç›˜I/Oå’Œå†…å­˜æœ‰å¾ˆå¤§çš„åŒºåˆ«ã€‚åªè¦ç³»ç»Ÿéœ€è¦ä¿å­˜è¿è¡Œè¿‡ç¨‹ä¸­ç•™ä¸‹çš„æ•°æ®ï¼Œé‚£å°±å¿…ç„¶ä¼šç”¨åˆ°ç£ç›˜I/Oã€‚åˆ†æç£ç›˜I/Oçš„æ—¶å€™ï¼Œç›¸å¯¹äºå…¶ä»–çš„åˆ†æç¯èŠ‚è¿˜æ˜¯è¦å¤æ‚ä¸€äº›ï¼Œå› ä¸ºç£ç›˜I/Oæ ˆæ˜¯æ¯”è¾ƒé•¿çš„ã€‚æœ‰äº†Direct I/OæŠ€æœ¯ä¹‹åï¼Œç£ç›˜I/Oæ ˆçŸ­äº†ä¸€æ®µï¼Œé€Ÿåº¦å¿«äº†ï¼Œä½†æ˜¯åŒæ ·ä¹Ÿæ²¡æœ‰ç»™æ€§èƒ½æµ‹è¯•åˆ†æäººå‘˜å¸¦æ¥ä»€ä¹ˆç¦éŸ³ï¼Œå› ä¸ºä»åˆ†æçš„è§’åº¦æ¥è¯´ï¼Œæˆ‘ä»¬çœ‹è®¡æ•°å™¨å¹¶æ²¡æœ‰å‡å°‘ä»€ä¹ˆã€‚</p><p>åœ¨æ€§èƒ½åˆ†æè¿‡ç¨‹ä¸­ï¼Œæ“ä½œç³»ç»Ÿæ˜¯ç»•ä¸è¿‡å»çš„ä¸€ä¸ªç¯èŠ‚ã€‚åœ¨å½“å‰çš„æŠ€æœ¯æ ˆä¸­ï¼Œæˆ‘ä»¬ä»ç„¶è¦æŠŠæ“ä½œç³»ç»Ÿå½“æˆä¸€ä¸ªéå¸¸é‡è¦çš„ç¯èŠ‚ã€‚</p><p>ç°åœ¨å¯¹äºI/Oçš„åˆ†æå’Œåˆ¤æ–­ï¼Œå¤§éƒ¨åˆ†è¿˜åœç•™åœ¨ç£ç›˜ç™¾åˆ†æ¯”ã€é˜Ÿåˆ—ã€ç£ç›˜å»¶æ—¶ä¹‹ç±»ä¸Šã€‚å¯æ˜¯è¿™æ ·çš„è®¡æ•°å™¨çš„å€¼å¤šäº†ï¼Œå°‘äº†ï¼Œä½ è¦å¹²ä»€ä¹ˆå‘¢ï¼Ÿæ€ä¹ˆè§£å†³å®ƒå‘¢ï¼Ÿæ˜¯ç£ç›˜å‚æ•°æœ‰é—®é¢˜ï¼Œè¿˜æ˜¯åº”ç”¨æœ‰é—®é¢˜ï¼Ÿè¿˜æ˜¯ç£ç›˜ç¡¬ä»¶èƒ½åŠ›å°±é‚£æ ·äº†ï¼Ÿ</p><p>è¿™æ˜¯æ€§èƒ½åˆ†æäººå‘˜åº”è¯¥ç»™å‡ºçš„ç­”æ¡ˆ,å¯æ˜¯æœ‰å¾ˆå¤šæ€§èƒ½æµ‹è¯•å·¥ç¨‹å¸ˆè¿˜çœŸçš„ç»™ä¸å‡ºæ¥è¿™æ ·çš„ç­”æ¡ˆï¼Œç”šè‡³æœ‰äº›äººè¿å“ªä¸ªçº¿ç¨‹å¯¼è‡´çš„I/Oé«˜éƒ½åˆ¤æ–­ä¸å‡ºæ¥ã€‚è‡³å°‘ç°åœ¨çš„çŠ¶æ€è¯´æ˜äº†ï¼Œæ€§èƒ½æµ‹è¯•è¡Œä¸šè¿˜è¿œè¿œä¸å¤Ÿæˆç†Ÿï¼Œæˆ‘ä»¬è¿˜æœ‰å¾ˆå¤šçš„æœºä¼šã€‚</p><p>ç°åœ¨æˆ‘ä»¬æ‰€è¯´çš„I/Oï¼ŒåŸºæœ¬ä¸ŠæŠŠFile I/Oå’ŒDisk I/Oéƒ½è¯´è¿›å»äº†ï¼Œæ‰€ä»¥åœ¨åˆ†æä¸Šï¼Œå±‚çº§æ›´æ˜¯éå¸¸æ¨¡ç³Šã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºçš„ä¸€ä¸ªI/Oæ ˆï¼š</p><p><img src="https://static001.geekbang.org/resource/image/6f/ee/6fee04695be068f0622fbf67e55f01ee.png" alt=""></p><p>(æ­¤å›¾æ¥è‡ªäºï¼š<a href="https://www.thomas-krenn.com/de/wikiDE/images/b/ba/Linux-storage-stack-diagram_v4.0.png">https://www.thomas-krenn.com/de/wikiDE/images/b/ba/Linux-storage-stack-diagram_v4.0.png</a>)</p><p>åœ¨è¿™ä¸ªå›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ˜ç¡®çœ‹åˆ°ç£ç›˜I/Oæ ˆæœ‰å¤šé•¿ã€‚ä»åº”ç”¨å±‚å¼€å§‹ï¼Œäº§ç”Ÿç³»ç»Ÿè°ƒç”¨ï¼Œå†é€šè¿‡visual FS Layer â†’ FS Layer â†’ Block Layerè¿™æ ·ä¸€å±‚ä¸€å±‚åœ°è°ƒç”¨ä¸‹å»ï¼Œæœ€åæ‰å†™åˆ°äº†ç¡¬ä»¶å­˜å‚¨é‡Œã€‚</p><p>å½“ç„¶è¿˜æœ‰ä¸€å±‚ï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨çš„å°±æ˜¯ä»ç³»ç»Ÿçš„å…¨å±€çŠ¶æ€åˆ°å…·ä½“çš„çº¿ç¨‹ï¼Œè¿™ä¸ªæˆ‘åœ¨æ“ä½œç³»ç»Ÿé‚£ä¸€ç¯‡çš„I/Oéƒ¨åˆ†å·²ç»æè¿°è¿‡ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªI/Oé«˜çš„åˆ†ææ¡ˆä¾‹ã€‚</p><h2>æ¡ˆä¾‹ç°è±¡</h2><p>åœ¨è¿™ä¸ªé¡¹ç›®çš„å‹åŠ›æµ‹è¯•è¿‡ç¨‹å½“ä¸­ï¼Œå‘ç°äº†ç»å…¸çš„ç°è±¡ï¼š</p><ol>
<li><strong>TPSä¸Šä¸å»</strong>ï¼›</li>
<li><strong>ç¡¬ä»¶èµ„æºç”¨ä¸ä¸Š</strong>ã€‚</li>
</ol><p>åº”è¯¥è¯´ï¼Œæ€§èƒ½åˆ†æè¦æ˜¯åˆ†ç±»æ¯”è¾ƒå®½æ³›ï¼ŒåŸºæœ¬ä¸Šæ˜¯ä¸¤ç§ã€‚</p><p><strong>ç¬¬ä¸€ç§æ˜¯èµ„æºç”¨ä¸ä¸Šï¼ŒTPSä¸Šä¸å»ï¼Œå“åº”æ—¶é—´éšå‹åŠ›è€Œå¢åŠ </strong>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://static001.geekbang.org/resource/image/11/ce/1199fc4d93022aee612a2aca437278ce.png" alt=""></p><p><strong>ç¬¬äºŒç§æ˜¯èµ„æºç”¨å¾—ä¸Šï¼ŒTPSä¸Šä¸å»ï¼Œå“åº”æ—¶é—´éšå‹åŠ›è€Œå¢åŠ </strong>ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://static001.geekbang.org/resource/image/72/6d/729cfa4bad0f164ea88e55ae71e8e06d.png" alt=""></p><p>è¿™æ ·çš„åˆ’åˆ†æ–¹å¼çœ‹ä¼¼æœ‰è°ƒä¾ƒå‘³é“ï¼Œå´æ˜¯å¾ˆå¤šäººç–‘æƒ‘çš„èµ·ç‚¹ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬åœ¨å¼€å§‹åšæ€§èƒ½åˆ†æçš„æ—¶å€™ï¼Œç»å¸¸ä¼šé¢å¯¹è¿™ç§æƒ…å†µï¼Œé‚£å°±æ˜¯èµ„æºç”¨ä¸ä¸Šå»ã€‚ä¹Ÿå°±æ˜¯è·¯ä¸å¤Ÿå®½ï¼Œç¡¬ä»¶èµ„æºæ‰ç”¨ä¸ä¸Šçš„ã€‚æˆ‘ä»¬è¦è§£å†³çš„ï¼Œå°±æ˜¯æŠŠè·¯æ‰©å®½ä¸€äº›ã€‚</p><p>ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬é¢å¯¹ä¸€äº›å®¢æˆ·æˆ–é¢†å¯¼çš„æ—¶å€™ï¼Œå¦‚æœå»æ±‡æŠ¥æŸèµ„æºä½¿ç”¨ç‡è¾¾åˆ°100%è¿™æ ·é«˜çš„å€¼çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½å¾—åˆ°çš„ä¸€ä¸ªåé¦ˆæ˜¯ï¼Œèƒ½ä¸èƒ½æŠŠèµ„æºä½¿ç”¨ç‡é™ä¸‹æ¥ï¼Œå› ä¸ºèµ„æºä½¿ç”¨ç‡é«˜ä¼šè®©äººæœ‰ç§ä¸å®‰å…¨æ„Ÿï¼Œè€ŒTPSåè€Œä¸æ˜¯å…³æ³¨çš„é‡ç‚¹ã€‚è¿™å°±è®©æˆ‘ä»¬å¾ˆç–‘æƒ‘ï¼šTPSä¸Šå»äº†ï¼Œèµ„æºå¿…ç„¶ç”¨å¾—å¤šå‘€ï¼Œéš¾é“è®©èµ„æºä½¿ç”¨ç‡ç¨³å®šä¿æŒåœ¨50%ï¼Œè€ŒTPSè¹­è¹­å¾€ä¸Šæ¶¨å—ï¼Ÿè¿™ä¸ç°å®å‘€ã€‚</p><p>æˆ‘çš„å»ºè®®æ˜¯ï¼Œä¸ç”¨æ€•èµ„æºä½¿ç”¨ç‡é«˜ï¼Œåšä¸ºä¸“ä¸šæ€§èƒ½åˆ†æäººå‘˜ï¼Œæ›´åº”è¯¥æ€•çš„æ˜¯èµ„æºä½¿ç”¨ç‡ä¸é«˜ï¼</p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¸€å¼€å§‹åŒäº‹è·Ÿæˆ‘æè¿°çš„æ—¶å€™ï¼Œè¯´<strong>èµ„æºæ€ä¹ˆä¹Ÿç”¨ä¸ä¸Šå»ï¼ŒTPSä¹Ÿä¸Šä¸å»</strong>ã€‚è¿™æ ·çš„æè¿°å¾ˆå¸¸è§ã€‚</p><p>è¿˜æ˜¯çœ‹çœ‹å‹åŠ›ç»“æœï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://static001.geekbang.org/resource/image/b1/33/b1486cc6adfe2d0a3ecbe3f2685f1133.png" alt=""></p><p>ï¼ˆåœºæ™¯å¼€å§‹æ—¶æŠ¥äº†å°‘é‡çš„é”™ï¼Œä¸è¿‡è¿™ä¸æ˜¯æˆ‘ä»¬è¿™ä¸ªæ¡ˆä¾‹è¦åˆ†æçš„éƒ¨åˆ†ï¼Œè¯·çœ‹å®˜å¿½ç•¥ã€‚ï¼‰</p><p>åƒè¿™ç§æè¿°ï¼ŒåŸºæœ¬ä¸Šæ²¡åŠæ³•è®©äººåˆ†æï¼Œå› ä¸ºä¿¡æ¯å¤ªå°‘äº†ã€‚ç‰¹åˆ«æ˜¯æœ‰äº›äººç›´æ¥ç»™ä¸€ä¸ªå›ºå®šçº¿ç¨‹æ•°çš„å‹åŠ›ç»“æœï¼Œç”¨æ¥æè¿°èµ„æºä¸Šä¸å»çš„æƒ…å†µï¼Œè¿™å°±æ›´å¾—ä¸åˆ°æœ‰ç”¨çš„ä¿¡æ¯äº†ï¼Œæ‰€ä»¥é—®æ€§èƒ½é—®é¢˜çš„äººä¸€å®šè¦æ³¨æ„æ”¶é›†è¶³å¤Ÿçš„ä¿¡æ¯ï¼Œä¸ç„¶åªèƒ½è®©äººä»å¤´æŸ¥ä¸€éã€‚</p><h2>åˆ†æè¿‡ç¨‹</h2><p>å› ä¸ºæ²¡æœ‰ä»€ä¹ˆå…·ä½“çš„ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘åªèƒ½è®©åŒäº‹æŠŠå‹åŠ›å†å‹èµ·æ¥ã€‚</p><p>æˆ‘ç™»å½•åˆ°æœåŠ¡å™¨ä¸Šä¹‹åï¼Œé¡ºæ‰‹æ‰§è¡Œäº†ä¸€ä¸ªtopå‘½ä»¤ï¼š</p><p><img src="https://static001.geekbang.org/resource/image/b1/7d/b1c1e4b1cd41d7481086388994f4997d.png" alt=""></p><p>è¿™é‡Œç»™ä¸ªå°æé†’ï¼Œæ‰§è¡Œtopçš„æ—¶å€™ä¸€å®šè¦ä¹ æƒ¯æ€§åœ°ç‚¹ä¸€ä¸‹æ•°å­—1ï¼Œè¿™æ ·å¯ä»¥æŠŠæ‰€æœ‰çš„CPUéƒ½åˆ—å‡ºæ¥ï¼Œå› ä¸ºæˆ‘è¦çœ‹åˆ°æ¯ä¸ªCPUçš„å„ä¸ªè®¡æ•°å™¨çš„ä½¿ç”¨ç‡ã€‚åˆ«çœ‹è¿™ä¸ªåŠ¨ä½œä¸èµ·çœ¼ï¼Œå°±ç®—æ˜¯è¿™ä¸€ä¸ªå°å°çš„æ“ä½œï¼Œä¹Ÿæ˜¯å·¥ä½œç»éªŒçš„ç§¯ç´¯ã€‚</p><p>æœä¸å…¶ç„¶ï¼Œçœ‹åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯ä¸Šå›¾ä¸­CPU0çš„waè¾¾åˆ°äº†72%ã€‚åƒè¿™æ ·çš„é—®é¢˜ï¼Œå¦‚æœä¸çœ‹æ¯ä¸ªCPUçš„æ¯ä¸ªè®¡æ•°å™¨ï¼Œæ˜¯å‘ç°ä¸äº†çš„ã€‚</p><p>çœ‹åˆ°è¿™æ ·çš„ä¸œè¥¿ï¼Œæˆ‘ä»¬è¦æœ‰ä¸ªåŸºæœ¬çš„åˆ¤æ–­ï¼Œå¯¹äºä¸€èˆ¬çš„Javaåº”ç”¨æ¥è¯´ï¼ŒI/Oçº¿ç¨‹æ•°åŸºæœ¬ä¸Šä¸ä¼šæ˜¯1ä¸ªï¼Œé™¤éæ˜¯ç‰¹åˆ«çš„ç†ç”±ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µè¿˜æ˜¯å¾ˆå°‘çš„ã€‚</p><p>ä¸è¿‡æ—¢ç„¶æ˜¯I/Oçš„é—®é¢˜å¯¼è‡´äº†wa CPUä½¿ç”¨ç‡é«˜ï¼Œé‚£ä¹ˆæˆ‘æ¥çœ‹ä¸€ä¸‹CPUçš„çƒ­ç‚¹åœ¨å“ªä¸ªå±‚é¢ã€‚è¿™æ˜¯æˆ‘åœ¨å·¥ä½œä¸­ç»å¸¸æ‰§è¡Œçš„ä¸€ä¸ªåŠ¨ä½œï¼Œå› ä¸ºæˆ‘ä¸æƒ³åœ¨åé¢çš„åˆ†æè¿‡ç¨‹ä¸­åç¦»æ–¹å‘ï¼Œè€Œçœ‹CPUçƒ­ç‚¹å¯ä»¥è®©æˆ‘è®°å¾—è¿™ä¸ªæ–¹å‘ã€‚</p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://static001.geekbang.org/resource/image/e1/2e/e1080375920d5fd944d2df9dadaf8e2e.png" alt=""></p><p>æœ‰äººè¯´ï¼Œå³ç„¶wa CPUä½¿ç”¨ç‡å·²ç»é«˜äº†ï¼Œæ¥ä¸‹å»ç›´æ¥çœ‹ç£ç›˜I/Oä¸å°±è¡Œäº†ï¼Œçœ‹ä¸çœ‹CPUçƒ­ç‚¹è¿˜é‡è¦å—ï¼Ÿæˆ‘è¦è¯´ï¼Œå½“ç„¶é‡è¦ï¼çœ‹åˆ°å‰é¢çš„ç£ç›˜I/Oæ ˆäº†å—ï¼Ÿé‚£ä¹ˆé•¿ï¼Œæ€ä¹ˆçŸ¥é“æ˜¯åœ¨å“ªä¸€å±‚å‘¢ï¼Ÿ</p><p>è¿™æ˜¯å®šå‘ç»†åŒ–åˆ†æè¿‡ç¨‹ä¸­çš„ç»éªŒä¹‹ä¸€ã€‚</p><p>åœ¨CPUçƒ­ç‚¹ä¸­æˆ‘ä»¬çœ‹åˆ°äº†ï¼Œæ˜¯å†…æ ¸æ¨¡å—ä¸­çš„blk_queue_bioæ¶ˆè€—çš„CPUå¤§ã€‚blk_queue_bioæ˜¯ç”¨æ¥åšI/Oè°ƒåº¦åˆå¹¶çš„ï¼Œå¯ä»¥å¯¹I/Oè¯·æ±‚è¿›å…¥åå‘ã€å‰å‘åˆå¹¶æ“ä½œï¼Œäº’æ–¥æ–¹å¼å°±æ˜¯åŠ é”ã€‚</p><p>æ ¹æ®å®ƒæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“ï¼Œè¿™æ˜¯ä¸€ä¸ªæœ‰queueçš„è°ƒåº¦è¿‡ç¨‹ï¼Œå†æ¥ç€çœ‹å®ƒä¸‹é¢çš„å‡ ä¸ªå‡½æ•°ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œéƒ½æ˜¯kernelçº§çš„è°ƒç”¨ï¼Œå¹¶æ²¡æœ‰userçº§çš„è°ƒç”¨ï¼Œè¿™å‡ ä¸ªå‡½æ•°åŸºæœ¬ä¸Šä¹Ÿè¯´æ˜äº†å½“å‰ç³»ç»Ÿå¿™äºjournalå†™ã€‚</p><p>æ¥ç€æ‰§è¡Œiotopï¼Œçœ‹æ˜¯å“ªä¸ªè¿›ç¨‹åœ¨åšè¿™ä¸ªåŠ¨ä½œã€‚è¿™é‡Œå¯ä»¥çœ‹åˆ°jbd2ï¼Œå’Œä¸Šé¢CPUçƒ­ç‚¹çš„å‡½æ•°ä¹Ÿæ˜¯å¯¹åº”å¾—ä¸Šçš„ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/6a/fc/6a7690bbf843e84e1eeb806093a390fc.png" alt=""></p><p>é‚£ä¹ˆjbd2æ˜¯ä¸ªå•¥ç©æ„å‘¢ï¼Ÿjbd2è‹±æ–‡åæ˜¯è¿™æ ·çš„ï¼šJournaling Block Device 2ã€‚</p><p>å®ƒæ˜¯è·Ÿç€ext4æ ¼å¼æ¥çš„ï¼Œå½“ç„¶å®ƒä¹Ÿå¯ä»¥åœ¨å…¶ä»–ç£ç›˜æ ¼å¼ä¸‹å·¥ä½œã€‚è¿™ä¸ªè¿›ç¨‹çš„å·¥ä½œåŸç†æ˜¯è¿™æ ·çš„ï¼šæ–‡ä»¶ç³»ç»Ÿå†™å…¥æ•°æ®ï¼Œè¦æäº¤ç»™é©±åŠ¨ç¨‹åºï¼Œè€Œjbd2å°±æ˜¯åœ¨æ–‡ä»¶ç³»ç»Ÿè°ƒç”¨é©±åŠ¨ä¹‹å‰å·¥ä½œçš„ã€‚æ–‡ä»¶ç³»ç»Ÿè¦å…ˆè°ƒç”¨jbd2ï¼Œç„¶åjbd2ä¼šæ ¹æ®ç³»ç»Ÿçš„è®¾ç½®ï¼ˆè®¾ç½®æœ‰writebackã€orderedã€journalï¼‰ï¼Œè¿›è¡Œæ•°æ®çš„å¤‡ä»½ï¼Œç„¶åå†è®©æ–‡ä»¶ç³»ç»Ÿæäº¤æ•°æ®ã€‚å½“æ–‡ä»¶ç³»ç»Ÿå°†æ•°æ®å†™å…¥äº†å—è®¾å¤‡ä¹‹åï¼Œjbd2å°±ä¼šæŠŠå¤‡ä»½çš„æ•°æ®åˆ é™¤ã€‚å¦‚æœæ–‡ä»¶ç³»ç»Ÿå†™å—è®¾å¤‡æ—¶å‡ºäº†é—®é¢˜ï¼ˆæ¯”å¦‚è¯´å¯æ‚²çš„æ–­ç”µï¼‰ï¼Œé‚£jbd2è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå¤‡ä»½ï¼Œåœ¨è¿›è¡Œå®Œæ•´æ€§æ£€æŸ¥æ—¶å°±ä¼šæŠŠæ•°æ®è¡¥å…¨ï¼Œæ‰€ä»¥æ•°æ®ä¸ä¼šä¸¢ã€‚</p><p>jbd2å°±æ˜¯è¿™æ ·ä¿è¯æ•°æ®çš„å®Œæ•´æ€§çš„ã€‚</p><p>ä½†æ˜¯ï¼å¯¹å˜›ï¼Œæˆ‘å°±å–œæ¬¢è¯´ä½†æ˜¯ã€‚jbd2ä¿è¯çš„æ•°æ®å®Œæ•´æ€§ä¹Ÿåªæ˜¯ä¸€ä¸ªåŸå­æ“ä½œçš„å®Œæ•´æ€§ï¼Œå³ä¸€ä¸ªåŸå­æ“ä½œå¦‚æœæ“ä½œäº†2Mçš„æ•°æ®ï¼Œå®ƒå°±åªèƒ½ä¿è¯è¿™2Mçš„æ•°æ®ä¸ä¼šä¸¢å¤±ã€‚å¦‚æœä½ ä¸€ä¸‹å­æ“ä½œäº†1Tçš„æ•°æ®ï¼Œjbd2ä¹Ÿä¸èƒ½ä¿è¯å®Œæ•´æ€§ã€‚</p><p>jbd2æœ‰ä¸€ä¸ªå‚æ•°barrierï¼Œå®ƒç”¨æ¥å¼€å¯ç£ç›˜å±éšœã€‚å°±æ˜¯è®¾ç½®ä¸€ä¸ªæ …æ ï¼Œè¦å…ˆæŠŠbarrierä¹‹å‰çš„æ•°æ®å…¨éƒ½å†™åˆ°ç£ç›˜è®¾å¤‡ä¹‹åï¼Œæ‰ä¼šå†™barrierä¹‹åçš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯ç”¨æ¥ä¿è¯åŸå­æ“ä½œä¸­æ•°æ®çš„å®Œæ•´æ€§çš„ã€‚å½“ç„¶äº†ï¼Œå¼€å¯barrierçš„ä¸€ä¸ªåæœå°±æ˜¯æ€§èƒ½ä¸‹é™ã€‚</p><p>äº†è§£äº†è¿™äº›å†…å®¹ä¹‹åï¼Œæˆ‘ä»¬å°±è¦åˆ¤æ–­ä¸€ä¸‹äº†ã€‚è¿™ä¸ªåº”ç”¨æœ‰æ²¡æœ‰å¿…è¦ç”¨è¿™ä¸ªåŠŸèƒ½æ¥ä¿è¯åŸå­æ“ä½œçš„å®Œæ•´æ€§ï¼Ÿæˆ‘è€ƒè™‘äº†ä¸€ä¸‹ä¹‹åï¼Œè§‰å¾—è¿™ä¸ªåº”ç”¨å°±æ˜¯å†™æ—¥å¿—è€Œå·²ï¼Œä¹Ÿæ²¡æœ‰å…¶ä»–ä»€ä¹ˆé‡è¦çš„ä¸œè¥¿æ˜¯è¦å†™æ—¥å¿—çš„ï¼Œé‡è¦çš„ä¸šåŠ¡æ•°æ®éƒ½å†™åˆ°æ•°æ®åº“å»äº†ã€‚</p><p>æ‰€ä»¥ï¼Œæ²¡å¿…è¦ä¿è¯æ•°æ®å†™å…¥çš„å®Œæ•´æ€§ï¼Œå°±ç®—ä¸¢äº†ä¸€äº›æ—¥å¿—æ•°æ®åˆæ€ä¹ˆæ ·å‘¢ï¼Ÿå¦‚æœçœŸçš„å°±é‚£ä¹ˆå¯¸ï¼Œåº”ç”¨å‡ºç°å¤§bugï¼Œæ°å¥½å—è®¾å¤‡ä¹Ÿå‡ºé—®é¢˜ï¼Œæˆ–è€…æ–­ç”µï¼Œé‚£çœŸçš„åªæœ‰çƒ§é¦™æ‹œä½›äº†ã€‚</p><p>äºæ˜¯æˆ‘è§‰å¾—è¿™ä¸ªåŠŸèƒ½ä¸ç”¨ä¹Ÿç½¢ï¼ŒæŠŠåŸç†è¯´æ˜ç™½ä¹‹åï¼Œå’Œæ¶æ„ç»„ã€å¼€å‘ç»„ã€è¿ç»´ç»„ä»¥åŠé¢†å¯¼å±‚ä»¬æ²Ÿé€šäº†ä¸€åœˆï¼Œå‘Šè¯‰äº†ä»–ä»¬åŸç†ï¼Œå®åœ¨æ˜¯æ²¡æœ‰æ‰“å¼€çš„å¿…è¦ã€‚</p><p>æœ€åå¤§å®¶ä¸€è‡´åŒæ„ï¼šå…³æ‰ï¼</p><p>æˆ‘ä»¬å†å›è¿‡å¤´æ¥çœ‹ä¸‹è¿™ä¸ªå‚æ•°ï¼š</p><pre><code>[root@ä¸»æœºA]# cat /proc/mounts 
/dev/mapper/data_lvm-data_lv /data ext4 rw,relatime,barrier=1,data=ordered 0 0 
</code></pre><p>ä¸Šé¢çš„è¿™ä¸ªbarrier=1ï¼Œå°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ç›®æ ‡ã€‚æƒ³å…³äº†å®ƒï¼Œå°±æ˜¯æŒ‚è½½ç£ç›˜çš„æ—¶å€™ä½¿ç”¨æŒ‚è½½é€‰é¡¹-o barrier=0æˆ–è€…nobarrierã€‚æˆ‘è¿™é‡Œæ˜¯ç›´æ¥è®¾ç½®ä¸º0çš„ã€‚</p><p>ä½ ä¹Ÿå¯ä»¥ç›´æ¥å…³æ‰journalåŠŸèƒ½ï¼š</p><pre><code>tune2fs -o journal_data_writeback /dev/mapper/data_lvm-data_lv tune2fs -O &quot;^has_journal&quot; /dev/mapper/data_lvm-data_lv e2fsck -f /dev/mapper/data_lvm-data_lv
</code></pre><h2>é—®é¢˜è§£å†³ä¹‹å</h2><p>æˆ‘ä»¬å†æ¥çœ‹ä¸‹é—®é¢˜è§£å†³åçš„å‹åŠ›å·¥å…·ç»“æœï¼š</p><p><img src="https://static001.geekbang.org/resource/image/74/3d/74a3e5ceb53b45db668e768d8b7f843d.png" alt=""></p><p>ä»å‹åŠ›ç»“æœæ¥çœ‹ï¼ŒåŒæ ·çš„å‹åŠ›ä¹‹ä¸‹ï¼ŒTPSå¢åŠ äº†ä¸€å€ï¼Œå“åº”æ—¶é—´å¿«äº†ä¸€å€ã€‚</p><p>topå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://static001.geekbang.org/resource/image/ab/7d/ab9a6ef19d55c87f0b380f9a6dcf937d.png" alt=""></p><p>é›†ä¸­çš„wa CPUä¹Ÿæ¶ˆå¤±ä¸è§äº†ï¼Œç°åœ¨ä½¿ç”¨çš„ä¹ŸæŒºå‡è¡¡çš„äº†ã€‚</p><p>iotopï¼š</p><p><img src="https://static001.geekbang.org/resource/image/85/ac/8534cc3d96242eb3f017fbd84735b6ac.png" alt=""></p><p>åœ¨I/O topçš„ç»“æœä¸­ï¼Œä¹Ÿçœ‹ä¸åˆ°I/Oéå¸¸é«˜çš„jbd2äº†ã€‚</p><p>é—®é¢˜å¾—åˆ°äº†å®Œç¾åœ°è§£å†³ã€‚</p><h2>æ€»ç»“</h2><p>ä¸ç®¡æ˜¯ä»€ä¹ˆæ ·çš„æ€§èƒ½é—®é¢˜ï¼Œå…¶å®ä»åˆ†ææ€è·¯ä¸Šä»ç„¶é€ƒä¸å¼€æˆ‘ä¸€ç›´æåˆ°çš„æ€è·¯â€”â€”é‚£å°±æ˜¯ä¸€ä¸ªåˆ†æçš„å®Œæ•´é“¾è·¯ã€‚å½“ä½ ä¸€å±‚ä¸€å±‚å¾€ä¸‹æ‰¾é—®é¢˜æ—¶ï¼Œåªè¦æŠ“ä½äº†é‡ç‚¹ï¼Œæ€è·¯ä¸æ–­ï¼Œæ‰¾åˆ°æ ¹æœ¬åŸå› å°±å¯ä»¥è§£å†³é—®é¢˜ã€‚</p><p>åœ¨è¿™ä¸ªI/Oçš„é—®é¢˜ä¸­ï¼Œéš¾ç‚¹åœ¨äºæ€ä¹ˆèƒ½çŸ¥é“jbd2çš„åŸç†å’Œå‚æ•°ã€‚åº”è¯¥è¯´ï¼Œä¸ç®¡æ˜¯è°ï¼Œéƒ½ä¸èƒ½ä¿è¯è‡ªå·±çš„çŸ¥è¯†ä½“ç³»æ˜¯å®Œæ•´çš„ï¼Œé‚£æ€ä¹ˆåŠå‘¢ï¼ŸæŸ¥èµ„æ–™ï¼Œå„ç§å­¦ä¹ ï¼Œçœ‹æºç ï¼Œçœ‹é€»è¾‘ã€‚å®åœ¨çœ‹ä¸æ‡‚ï¼Œé‚£ä¹Ÿæ²¡åŠæ³•ï¼Œæ¥ç€ä¿®ç‚¼åŸºç¡€å†…åŠŸå‘—ã€‚</p><p>æ‰€ä»¥è¯´æ€§èƒ½æµ‹è¯•è¡Œä¸šä¸­ï¼Œç»å¸¸åªæµ‹ä¸åˆ†æï¼Œä¹Ÿæ˜¯å› ä¸ºåšæ€§èƒ½åˆ†æéœ€è¦çš„èƒŒæ™¯çŸ¥è¯†é‡æœ‰ç‚¹å¤§ï¼Œè¿˜è¦ä¸æ–­åˆ†æå„ç§æ–°çš„çŸ¥è¯†ç‚¹ã€‚ä¸è¿‡ä¹Ÿå°±æ˜¯å› ä¸ºå¦‚æ­¤ï¼Œæ€§èƒ½æµ‹è¯•å’Œæ€§èƒ½åˆ†ææ‰çœŸçš„æœ‰ä»·å€¼ã€‚åªæµ‹ä¸è°ƒåªæ˜¯åšäº†ä¸€åŠå·¥ä½œï¼Œä»·å€¼å®Œå…¨ä½“ç°ä¸å‡ºæ¥ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æœ€åé—®ä½ ä¸¤ä¸ªé—®é¢˜å§ï¼šä¸ºä»€ä¹ˆTPSä¸Šä¸å»æ—¶ï¼Œèµ„æºç”¨ä¸ä¸Šæ‰æ˜¯æ›´è®©äººç€æ€¥çš„é—®é¢˜ï¼Ÿä»¥åŠä¸ºä»€ä¹ˆè¦åœ¨CPUé«˜æ—¶æŸ¥çœ‹CPUçƒ­ç‚¹å‡½æ•°å‘¢ï¼Ÿ</p><p>æ¬¢è¿ä½ åœ¨è¯„è®ºåŒºå†™ä¸‹ä½ çš„æ€è€ƒï¼Œæˆ‘ä¼šå’Œä½ ä¸€èµ·äº¤æµã€‚ä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–è€…åŒäº‹ï¼Œä¸€èµ·äº¤æµä¸€ä¸‹ã€‚</p><h2>ç²¾é€‰ç•™è¨€ï¼š</h2>
        <ul>
        
<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            Geek_65c0a2  2020-03-02 09:12:39
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            è¿™æ®µæ—¶é—´æ¯å¤©éƒ½å‘†åœ¨å®¶é‡Œï¼Œè¶Šå‘æ„Ÿè§‰ç”Ÿæ´»æ— æ¯”çš„æ¯ç‡¥ã€äººç”Ÿå¤šä¹ˆçš„æ— è¶£ã€‚æ˜¯ä»€ä¹ˆè®©æˆ‘æ„Ÿè§‰äººç”Ÿè¿˜æœ‰æ‰€æœŸå¾…çš„ï¼Ÿæ˜¯ä»€ä¹ˆåœ¨æ”¯æ’‘æˆ‘ä¸€å¤©å¤©çš„å°±è¿™ä¹ˆçš„è¿‡æ—¥å­ï¼Ÿæ˜¯æ¯å‘¨çš„ä¸€ä¸‰äº”å°±æœ‰é«˜è€å¸ˆçš„æ–‡ç« çœ‹ã€‚ [2èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;        line-height:1.2">ä½œè€…å›å¤2020-03-02 15:41:03</div>
    <div style="color:#353535;font-weight:400;white-space:normal;        word-break:break-all;line-height:1.6">è¿™æ‰æ˜¯çœŸçˆ±ï¼ğŸ˜€ğŸ˜€ğŸ˜€</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            æœˆäº®å’Œå…­ä¾¿å£«  2020-03-02 11:03:32
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            çœ‹åˆ°ä½ æ—¶ä¸æ—¶çš„å°±ä¼šç¥­å‡ºperf ï¼Œä½†æ˜¯perfå‡ºæ¥çš„ç»“æœçœ‹ä¸æ‡‚ï¼Œæ€ä¹ˆåŠï¼Ÿ  
        </div>
        
    </div>
</li>
            </ul>
</div>
</body>
</html>