<div id="pf16e" class="pf w2 h11" data-page-no="16e"><div class="pc pc16e w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg16e.png"/><div class="t m5 x107 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Solutions<span class="_ _10"> </span>to<span class="_ _10"> </span>Practice<span class="_ _10"> </span>Problems<span class="_ _1b"> </span><span class="ffe fs1e">365</span></div><div class="t m5 xee h61 ye7 ff13 fs35 fc6 sc0 ls0 ws0">long<span class="_ _f"> </span>shift_left4_rightn(long<span class="_ _f"> </span>x,<span class="_ _f"> </span>long<span class="_ _e"> </span>n)</div><div class="t m5 xee h61 y26dc ff13 fs35 fc6 sc0 ls0 ws0">x<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi,<span class="_ _f"> </span>n<span class="_ _e"> </span>in<span class="_ _21"> </span>%rsi</div><div class="t m5 x17 h2d yecb ffd fs1e fc2 sc0 ls0 ws0">shift_left4_rightn:</div><div class="t m5 x72 h2d y2145 ffd fs1e fc2 sc0 ls0 ws0">movq<span class="_ _46"> </span>%rdi,<span class="_ _e"> </span>%rax</div><div class="t m5 x218 h61 yecc ff13 fs35 fc6 sc0 ls0 ws0">Get<span class="_ _f"> </span>x</div><div class="t m5 x72 h2d yecd ffd fs1e fc2 sc0 ls0 ws0">salq<span class="_ _46"> </span>$4,<span class="_ _e"> </span>%rax<span class="_ _59"> </span><span class="ff13 fs35 fc6">x<span class="_ _f"> </span>&lt;&lt;=<span class="_ _e"> </span>4</span></div><div class="t m5 x72 h2d yece ffd fs1e fc2 sc0 ls0 ws0">movl<span class="_ _46"> </span>%esi,<span class="_ _e"> </span>%ecx<span class="_ _f1"> </span><span class="ff13 fs35 fc6">Get<span class="_ _f"> </span>n<span class="_ _f"> </span>(4<span class="_ _f"> </span>bytes)</span></div><div class="t m5 x72 h2d yecf ffd fs1e fc2 sc0 ls0 ws0">sarq<span class="_ _46"> </span>%cl,<span class="_ _e"> </span>%rax<span class="_ _93"> </span><span class="ff13 fs35 fc6">x<span class="_ _e"> </span>&gt;&gt;=<span class="_ _21"> </span>n</span></div><div class="t m5 x17 h28 y3368 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>3.10<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>232)</span></div><div class="t m5 x17 h26 y3369 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _11"> </span>problem<span class="_"> </span>is<span class="_"> </span>fairly<span class="_ _11"> </span>straightforward,<span class="_"> </span>since<span class="_ _11"> </span>the<span class="_"> </span>assembly<span class="_"> </span>code<span class="_ _11"> </span>follows<span class="_"> </span>the<span class="_"> </span>struc-</div><div class="t m5 x17 h26 y336a ff7 fs19 fc1 sc0 ls0 ws0">ture<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>C<span class="_"> </span>code<span class="_"> </span>closely<span class="_ _3"></span>.</div><div class="t m5 x1b6 h2d y336b ffd fs1e fc2 sc0 ls0 ws0">short<span class="_ _e"> </span>p<span class="ls33">1=y|z<span class="_ _41"></span>;</span></div><div class="t m5 x1b6 h2d y336c ffd fs1e fc2 sc0 ls0 ws0">short<span class="_ _e"> </span>p2<span class="_ _1f"> </span>=<span class="_ _1f"> </span>p1<span class="_ _e"> </span>&gt;&gt;<span class="_ _1f"> </span>9;</div><div class="t m5 x1b6 h2d y336d ffd fs1e fc2 sc0 ls0 ws0">short<span class="_ _e"> </span>p3<span class="_ _1f"> </span>=<span class="_ _1f"> </span>~p2;</div><div class="t m5 x1b6 h2d y336e ffd fs1e fc2 sc0 ls0 ws0">short<span class="_ _e"> </span>p<span class="ls33">4=y-p<span class="_ _41"></span>3<span class="_ _41"></span>;</span></div><div class="t m5 x17 h28 y336f ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>3.11</div><div class="t m5 x112 h2f y3370 ffe fs16 fc6 sc0 ls0 ws0">(page<span class="_"> </span>233)</div><div class="t m5 x34 h26 y3371 ff7 fs19 fc1 sc0 ls0 ws0">A.<span class="_ _1f"> </span>T<span class="_ _1"></span>his<span class="_ _11"> </span>instruction<span class="_ _11"> </span>is<span class="_"> </span>used<span class="_ _11"> </span>to<span class="_ _11"> </span>set<span class="_"> </span>register<span class="_ _11"> </span><span class="ffd">%rcx<span class="_ _11"> </span></span>to<span class="_ _11"> </span>zero<span class="_ _1"></span>,<span class="_ _11"> </span>exploiting<span class="_ _11"> </span>the<span class="_ _11"> </span>property</div><div class="t m5 x2d h46 y3372 ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_"> </span><span class="ff11">x<span class="_ _11"> </span><span class="ffd">^<span class="_ _10"> </span></span>x<span class="_ _10"> </span><span class="ff12">=<span class="_ _10"> </span></span></span>0<span class="_"> </span>for<span class="_"> </span>any<span class="_"> </span><span class="ff11">x<span class="_ _2"></span></span>.<span class="_"> </span>It<span class="_"> </span>corresponds<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>C<span class="_"> </span>statement<span class="_"> </span><span class="ffd ls4b">x=0<span class="_ _49"></span><span class="ff7 ls0">.</span></span></div><div class="t m5 x34 h26 y3373 ff7 fs19 fc1 sc0 ls0 ws0">B<span class="_ _3"></span>.<span class="_ _1d"> </span>A<span class="_ _14"> </span>more<span class="_ _14"> </span>direct<span class="_ _14"> </span>way<span class="_ _14"> </span>of<span class="_ _14"> </span>setting<span class="_ _15"> </span>register<span class="_ _14"> </span><span class="ffd">%rcx<span class="_ _14"> </span></span>to<span class="_ _14"> </span>zero<span class="_ _14"> </span>is<span class="_ _14"> </span>with<span class="_ _14"> </span>the<span class="_ _14"> </span>instruction</div><div class="t m5 x2d h26 y3374 ffd fs19 fc1 sc0 ls0 ws0">movq<span class="_ _11"> </span>$0,%rcx<span class="ff7">.</span></div><div class="t m5 x34 h26 y3375 ff7 fs19 fc1 sc0 ls0 ws0">C.<span class="_ _25"> </span>Assembling<span class="_"> </span>and<span class="_ _11"> </span>disassembling<span class="_ _11"> </span>this<span class="_ _11"> </span>code<span class="_ _1"></span>,<span class="_ _11"> </span>however,<span class="_ _11"> </span>we<span class="_"> </span>Ô¨Ånd<span class="_ _11"> </span>that<span class="_ _11"> </span>the<span class="_ _11"> </span>version</div><div class="t m5 x2d h26 y3376 ff7 fs19 fc1 sc0 ls0 ws0">with<span class="_ _6"> </span><span class="ffd">xorq<span class="_ _13"> </span></span>requires<span class="_ _6"> </span>only<span class="_ _6"> </span>3<span class="_ _13"> </span>bytes<span class="_ _3"></span>,<span class="_ _13"> </span>while<span class="_ _6"> </span>the<span class="_ _13"> </span>version<span class="_ _6"> </span>with<span class="_ _6"> </span><span class="ffd">movq<span class="_ _13"> </span></span>requires<span class="_ _6"> </span>7.<span class="_ _6"> </span>Other</div><div class="t m5 x2d h26 y3377 ff7 fs19 fc1 sc0 ls0 ws0">ways<span class="_ _6"> </span>to<span class="_ _13"> </span>set<span class="_ _a"> </span><span class="ffd">%rcx<span class="_ _13"> </span></span>to<span class="_ _a"> </span>zero<span class="_ _13"> </span>rely<span class="_ _6"> </span>on<span class="_ _6"> </span>the<span class="_ _13"> </span>property<span class="_ _a"> </span>that<span class="_ _13"> </span>any<span class="_ _a"> </span>instruction<span class="_ _13"> </span>that<span class="_ _6"> </span>updates</div><div class="t m5 x2d h26 y3378 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>lower<span class="_"> </span>4<span class="_"> </span>bytes<span class="_ _11"> </span>will<span class="_"> </span>cause<span class="_"> </span>the<span class="_"> </span>high-order<span class="_ _11"> </span>bytes<span class="_"> </span>to<span class="_"> </span>be<span class="_"> </span>set<span class="_ _11"> </span>to<span class="_"> </span>zero<span class="_ _0"></span>.<span class="_"> </span>T<span class="_ _0"></span>hus<span class="_ _1"></span>,<span class="_"> </span>we</div><div class="t m5 x2d h26 y3379 ff7 fs19 fc1 sc0 ls0 ws0">could<span class="_"> </span>use<span class="_"> </span>either<span class="_"> </span><span class="ffd">xorl<span class="_ _11"> </span>%ecx,%ecx<span class="_ _11"> </span></span>(2<span class="_"> </span>bytes)<span class="_"> </span>or<span class="_"> </span><span class="ffd">movl<span class="_ _11"> </span>$0,%ecx<span class="_ _11"> </span></span>(5<span class="_"> </span>bytes).</div><div class="t m5 x17 h28 y337a ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>3.12<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>236)</span></div><div class="t m5 x17 h26 y337b ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _14"> </span>can<span class="_ _15"> </span>simply<span class="_ _14"> </span>replace<span class="_ _14"> </span>the<span class="_ _15"> </span><span class="ffd">cqto<span class="_ _14"> </span></span>instruction<span class="_ _14"> </span>with<span class="_ _15"> </span>one<span class="_ _14"> </span>that<span class="_ _14"> </span>sets<span class="_ _15"> </span>register<span class="_ _14"> </span><span class="ffd">%rdx<span class="_ _15"> </span></span>to</div><div class="t m5 x17 h26 y337c ff7 fs19 fc1 sc0 ls0 ws0">zero<span class="_ _1"></span>,<span class="_ _f"> </span>and<span class="_ _21"> </span>use<span class="_ _21"> </span><span class="ffd">divq<span class="_ _15"> </span></span>rather<span class="_ _21"> </span>than<span class="_ _21"> </span><span class="ffd">idivq<span class="_ _15"> </span></span>as<span class="_ _21"> </span>our<span class="_ _21"> </span>division<span class="_ _21"> </span>instruction,<span class="_ _f"> </span>yielding<span class="_ _15"> </span>the</div><div class="t m5 x17 h26 y337d ff7 fs19 fc1 sc0 ls0 ws0">following<span class="_"> </span>code:</div><div class="t m5 x2e h61 y8fa ff13 fs35 fc6 sc0 ls0 ws0">void<span class="_ _f"> </span>uremdiv(unsigned<span class="_ _f"> </span>long<span class="_ _f"> </span>x,<span class="_ _e"> </span>unsigned<span class="_ _21"> </span>long<span class="_ _f"> </span>y,</div><div class="t m5 x1ff h61 y322e ff13 fs35 fc6 sc0 ls0 ws0">unsigned<span class="_ _f"> </span>long<span class="_ _f"> </span>*qp,<span class="_ _f"> </span>unsigned<span class="_ _e"> </span>long<span class="_ _21"> </span>*rp)</div><div class="t m5 x2e h61 y337e ff13 fs35 fc6 sc0 ls0 ws0">x<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi,<span class="_ _f"> </span>y<span class="_ _e"> </span>in<span class="_ _21"> </span>%rsi,<span class="_ _f"> </span>qp<span class="_ _e"> </span>in<span class="_ _21"> </span>%rdx,<span class="_ _f"> </span>rp<span class="_ _e"> </span>in<span class="_ _21"> </span>%rcx</div><div class="t m5 x2c h2d y74e ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">uremdiv:</span></div><div class="t m5 x2c h2d yc21 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rdx,<span class="_ _e"> </span>%r8<span class="_ _18c"> </span></span><span class="ff13 fs35">Copy<span class="_ _f"> </span>qp</span></div><div class="t m5 x2c h2d y107b ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rdi,<span class="_ _e"> </span>%rax<span class="_ _59"> </span></span><span class="ff13 fs35">Move<span class="_ _f"> </span>x<span class="_ _e"> </span>to<span class="_ _21"> </span>lower<span class="_ _f"> </span>8<span class="_ _e"> </span>bytes<span class="_ _21"> </span>of<span class="_ _f"> </span>dividend</span></div><div class="t m5 x2c h2d y13c0 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">movl<span class="_ _46"> </span>$0,<span class="_ _e"> </span>%edx<span class="_ _2a"> </span></span><span class="ff13 fs35">Set<span class="_ _f"> </span>upper<span class="_ _f"> </span>8<span class="_ _e"> </span>bytes<span class="_ _21"> </span>of<span class="_ _f"> </span>dividend<span class="_ _e"> </span>to<span class="_ _21"> </span>0</span></div><div class="t m5 x2c h2e y587 ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 xd1 h2d y832 ffd fs1e fc2 sc0 ls0 ws0">divq<span class="_ _46"> </span>%rsi<span class="_ _12b"> </span><span class="ff13 fs35 fc6">Divide<span class="_ _f"> </span>by<span class="_ _f"> </span>y</span></div><div class="t m5 x2c h2d y8d6 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rax,<span class="_ _e"> </span>(%r8)<span class="_ _93"> </span></span><span class="ff13 fs35">Store<span class="_ _e"> </span>quotient<span class="_ _21"> </span>at<span class="_ _f"> </span>qp</span></div><div class="t m5 x2c h2d y77e ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rdx,<span class="_ _e"> </span>(%rcx)<span class="_ _f1"> </span></span><span class="ff13 fs35">Store<span class="_ _f"> </span>remainder<span class="_ _f"> </span>at<span class="_ _f"> </span>rp</span></div><div class="t m5 x2c h2d ye95 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _45"> </span><span class="ffd fs1e fc2">ret</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
