<div id="pfe9" class="pf w2 h11" data-page-no="e9"><div class="pc pce9 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bge9.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">232<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x1d h34 ye7 ff6 fs16 fc2 sc0 ls0 ws0">(a)<span class="_ _10"> </span>C<span class="_ _11"> </span>code</div><div class="t m5 x1d h2d y2283 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>arith(long<span class="_ _1f"> </span>x,<span class="_ _1f"> </span>long<span class="_ _e"> </span>y,<span class="_ _1f"> </span>long<span class="_ _e"> </span>z)</div><div class="t m5 x1d h2d y2284 ffd fs1e fc2 sc0 ls0 ws0">{</div><div class="t m5 x10c h2d y2285 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>t<span class="ls33">1=x^y<span class="_ _41"></span>;</span></div><div class="t m5 x10c h2d y2286 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>t<span class="ls33">2=z*4<span class="_ _41"></span>8<span class="_ _41"></span>;</span></div><div class="t m5 x10c h2d y2287 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>t3<span class="_ _1f"> </span>=<span class="_ _1f"> </span>t1<span class="_ _e"> </span>&amp;<span class="_ _1f"> </span>0x0F0F0F0F;</div><div class="t m5 x10c h2d y2288 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>t4<span class="_ _1f"> </span>=<span class="_ _1f"> </span>t2<span class="_ _e"> </span>-<span class="_ _1f"> </span>t3;</div><div class="t m5 x10c h2d y23a1 ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>t4;</div><div class="t m5 x1d h2d y23a2 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x1d h34 y23a3 ff6 fs16 fc2 sc0 ls0 ws0">(b)<span class="_ _10"> </span>Assembly<span class="_ _11"> </span>code</div><div class="t m5 xad h61 y1819 ff13 fs35 fc6 sc0 ls0 ws0">long<span class="_ _f"> </span>arith(long<span class="_ _f"> </span>x,<span class="_ _f"> </span>long<span class="_ _e"> </span>y,<span class="_ _21"> </span>long<span class="_ _f"> </span>z)</div><div class="t m5 xad h61 y23a4 ff13 fs35 fc6 sc0 ls0 ws0">x<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi,<span class="_ _f"> </span>y<span class="_ _e"> </span>in<span class="_ _21"> </span>%rsi,<span class="_ _f"> </span>z<span class="_ _e"> </span>in<span class="_ _21"> </span>%rdx</div><div class="t m5 x1f h2d y228c ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">arith:</span></div><div class="t m5 x1f h2d y228d ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">xorq<span class="_ _46"> </span>%rsi,<span class="_ _e"> </span>%rdi<span class="_ _107"> </span></span><span class="ff13 fs35 ls156">t<span class="_ _8a"></span>1=x^y</span></div><div class="t m5 x1f h2e y23a5 ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x10d h2d y13a3 ffd fs1e fc2 sc0 ls0 ws0">leaq<span class="_ _46"> </span>(%rdx,%rdx,2),<span class="_ _e"> </span>%rax<span class="_ _f1"> </span><span class="ff13 fs35 fc6">3*z</span></div><div class="t m5 x1f h2d y23a6 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">salq<span class="_ _46"> </span>$4,<span class="_ _e"> </span>%rax<span class="_ _c1"> </span></span><span class="ff13 fs35">t2<span class="_ _f"> </span>=<span class="_ _f"> </span>16<span class="_ _e"> </span>*<span class="_ _21"> </span>(3*z)<span class="_ _f"> </span>=<span class="_ _e"> </span>48*z</span></div><div class="t m5 x1f h2d y23a7 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">andl<span class="_ _46"> </span>$252645135,<span class="_ _e"> </span>%edi<span class="_ _88"> </span></span><span class="ff13 fs35">t3<span class="_ _21"> </span>=<span class="_ _e"> </span>t1<span class="_ _21"> </span>&amp;<span class="_ _f"> </span>0x0F0F0F0F</span></div><div class="t m5 x1f h2d y23a8 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">subq<span class="_ _46"> </span>%rdi,<span class="_ _e"> </span>%rax<span class="_ _107"> </span></span><span class="ff13 fs35">Return<span class="_ _f"> </span>t2<span class="_ _f"> </span>-<span class="_ _e"> </span>t3</span></div><div class="t m5 x1f h2d y23a9 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">ret</span></div><div class="t m5 x1d h2f y23aa ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>3.11<span class="_ _66"> </span><span class="fc1">C<span class="_"> </span>and<span class="_"> </span>assembly<span class="_"> </span>code<span class="_"> </span>for<span class="_"> </span>arithmetic<span class="_"> </span>function.</span></div><div class="t m5 x1d h41 y23ab ffe fs29 fc1 sc0 ls0 ws0">3.5.4<span class="_ _48"> </span><span class="fs19">Discussion</span></div><div class="t m5 x1d h26 y23ac ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _11"> </span>see<span class="_ _16"> </span>that<span class="_"> </span>most<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>instructions<span class="_ _11"> </span>shown<span class="_ _11"> </span>in<span class="_ _16"> </span>F<span class="_ _1"></span>igure<span class="_ _11"> </span>3.10<span class="_ _16"> </span>can<span class="_"> </span>be<span class="_ _16"> </span>used<span class="_ _11"> </span>for<span class="_ _11"> </span>either</div><div class="t m5 x1d h26 y23ad ff7 fs19 fc1 sc0 ls0 ws0">unsigned<span class="_ _6"> </span>or<span class="_ _6"> </span>two’s-complement<span class="_ _6"> </span>arithmetic.<span class="_ _a"> </span>Only<span class="_ _6"> </span>right<span class="_ _6"> </span>shifting<span class="_ _13"> </span>requires<span class="_ _a"> </span>instructions</div><div class="t m5 x1d h26 y23ae ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_ _13"> </span>differentiate<span class="_"> </span>between<span class="_ _13"> </span>signed<span class="_ _13"> </span>versus<span class="_"> </span>unsigned<span class="_ _13"> </span>data.<span class="_ _13"> </span>T<span class="_ _1"></span>his<span class="_"> </span>is<span class="_ _13"> </span>one<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>features</div><div class="t m5 x1d h26 y23af ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_"> </span>makes<span class="_"> </span>two’s-complement<span class="_"> </span>arithmetic<span class="_"> </span>the<span class="_"> </span>preferred<span class="_"> </span>way<span class="_ _11"> </span>to<span class="_"> </span>implement<span class="_"> </span>signed</div><div class="t m5 x1d h26 y23b0 ff7 fs19 fc1 sc0 ls0 ws0">integer<span class="_"> </span>arithmetic.</div><div class="t m5 x29 h26 y23b1 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _16"> </span>3.11<span class="_ _11"> </span>shows<span class="_ _11"> </span>an<span class="_ _16"> </span>example<span class="_ _11"> </span>of<span class="_ _11"> </span>a<span class="_ _16"> </span>function<span class="_"> </span>that<span class="_ _16"> </span>performs<span class="_ _11"> </span>arithmetic<span class="_ _11"> </span>opera-</div><div class="t m5 x1d h26 y23b2 ff7 fs19 fc1 sc0 ls0 ws0">tions<span class="_ _16"> </span>and<span class="_ _16"> </span>its<span class="_ _16"> </span>translation<span class="_ _14"> </span>into<span class="_ _16"> </span>assembly<span class="_ _16"> </span>code.<span class="_ _11"> </span>Arguments<span class="_ _14"> </span><span class="ffd">x</span>,<span class="_ _16"> </span><span class="ffd">y</span>,<span class="_ _14"> </span>and<span class="_ _16"> </span><span class="ffd">z<span class="_ _14"> </span></span>are<span class="_ _16"> </span>initially</div><div class="t m5 x1d h26 y23b3 ff7 fs19 fc1 sc0 ls0 ws0">stored<span class="_"> </span>in<span class="_ _13"> </span>registers<span class="_"> </span><span class="ffd">%rdi</span>,<span class="_ _13"> </span><span class="ffd">%rsi</span>,<span class="_"> </span>and<span class="_"> </span><span class="ffd">%rdx</span>,<span class="_ _13"> </span>respectively<span class="_ _3"></span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>assembly-code<span class="_ _13"> </span>instruc-</div><div class="t m5 x1d h26 y23b4 ff7 fs19 fc1 sc0 ls0 ws0">tions<span class="_ _13"> </span>correspond<span class="_ _6"> </span>closely<span class="_ _13"> </span>with<span class="_ _6"> </span>the<span class="_ _13"> </span>lines<span class="_ _6"> </span>of<span class="_ _13"> </span>C<span class="_ _6"> </span>source<span class="_ _13"> </span>code<span class="_ _1"></span>.<span class="_ _13"> </span>Line<span class="_ _6"> </span>2<span class="_ _13"> </span>computes<span class="_ _6"> </span>the<span class="_ _13"> </span>value</div><div class="t m5 x1d h26 y23b5 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span><span class="ffd">x^y</span>.<span class="_"> </span>Lines<span class="_ _13"> </span>3<span class="_"> </span>and<span class="_"> </span>4<span class="_"> </span>compute<span class="_"> </span>the<span class="_ _13"> </span>expression<span class="_"> </span><span class="ffd">z*48<span class="_ _10"> </span></span>by<span class="_"> </span>a<span class="_"> </span>combination<span class="_"> </span>of<span class="_ _13"> </span><span class="ffd">leaq<span class="_ _10"> </span></span>and</div><div class="t m5 x1d h26 y23b6 ff7 fs19 fc1 sc0 ls0 ws0">shift<span class="_"> </span>instructions<span class="_ _1"></span>.<span class="_"> </span>Line<span class="_ _11"> </span>5<span class="_"> </span>computes<span class="_"> </span>the<span class="_ _11"> </span><span class="ff9">and<span class="_ _10"> </span></span>of<span class="_ _11"> </span><span class="ffd">t1<span class="_ _10"> </span></span>and<span class="_"> </span><span class="ffd">0x0F0F0F0F</span>.<span class="_ _11"> </span>T<span class="_ _1"></span>he<span class="_ _11"> </span>ﬁnal<span class="_"> </span>sub-</div><div class="t m5 x1d h26 y23b7 ff7 fs19 fc1 sc0 ls0 ws0">traction<span class="_"> </span>is<span class="_"> </span>computed<span class="_"> </span>by<span class="_"> </span>line<span class="_"> </span>6.<span class="_ _11"> </span>Since<span class="_"> </span>the<span class="_"> </span>destination<span class="_"> </span>of<span class="_"> </span>the<span class="_ _11"> </span>subtraction<span class="_"> </span>is<span class="_"> </span>register</div><div class="t m5 x1d h26 y23b8 ffd fs19 fc1 sc0 ls0 ws0">%rax<span class="ff7">,<span class="_"> </span>this<span class="_"> </span>will<span class="_"> </span>be<span class="_"> </span>the<span class="_"> </span>value<span class="_"> </span>returned<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span>function.</span></div><div class="t m5 x29 h26 y23b9 ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _11"> </span>the<span class="_ _16"> </span>assembly<span class="_ _11"> </span>code<span class="_ _11"> </span>of<span class="_ _11"> </span>Figure<span class="_ _11"> </span>3.11,<span class="_ _11"> </span>the<span class="_ _16"> </span>sequence<span class="_ _11"> </span>of<span class="_ _11"> </span>values<span class="_ _16"> </span>in<span class="_ _11"> </span>register<span class="_ _11"> </span><span class="ffd">%rax</span></div><div class="t m5 x1d h26 y23ba ff7 fs19 fc1 sc0 ls0 ws0">corresponds<span class="_ _13"> </span>to<span class="_ _13"> </span>program<span class="_ _13"> </span>values<span class="_ _13"> </span><span class="ffd">3*z</span>,<span class="_ _13"> </span><span class="ffd">z*48</span>,<span class="_ _13"> </span>and<span class="_ _13"> </span><span class="ffd">t4<span class="_ _13"> </span></span>(as<span class="_ _13"> </span>the<span class="_ _13"> </span>return<span class="_ _13"> </span>value).<span class="_ _6"> </span>In<span class="_ _13"> </span>general,</div><div class="t m5 x1d h26 y23bb ff7 fs19 fc1 sc0 ls0 ws0">compilers<span class="_ _13"> </span>generate<span class="_ _6"> </span>code<span class="_ _13"> </span>that<span class="_ _13"> </span>uses<span class="_ _6"> </span>individual<span class="_ _13"> </span>registers<span class="_ _13"> </span>for<span class="_ _13"> </span>multiple<span class="_ _6"> </span>program<span class="_ _13"> </span>values</div><div class="t m5 x1d h26 y23bc ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_"> </span>moves<span class="_"> </span>program<span class="_"> </span>values<span class="_"> </span>among<span class="_"> </span>the<span class="_"> </span>registers<span class="_ _1"></span>.</div><div class="t m5 x1d h47 y23bd ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>3.10<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>365)</span></div><div class="t m5 x1d h26 y1152 ff7 fs19 fc1 sc0 ls0 ws0">Consider<span class="_ _21"> </span>the<span class="_ _f"> </span>following<span class="_ _f"> </span>code,<span class="_ _f"> </span>in<span class="_ _f"> </span>which<span class="_ _f"> </span>we<span class="_ _f"> </span>have<span class="_ _f"> </span>omitted<span class="_ _f"> </span>the<span class="_ _f"> </span>expression<span class="_ _21"> </span>being</div><div class="t m5 x1d h26 y1153 ff7 fs19 fc1 sc0 ls0 ws0">computed:</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
