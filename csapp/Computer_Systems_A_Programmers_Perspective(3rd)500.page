<div id="pf1f4" class="pf w2 h11" data-page-no="1f4"><div class="pc pc1f4 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1f4.png"/><div class="t m5 x13d h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>4.5<span class="_ _60"> </span>Pipelined<span class="_ _10"> </span>Y86-64<span class="_ _10"> </span>Implementations<span class="_ _3e"> </span><span class="ffe fs1e">499</span></div><div class="t m5 x4c h3f y45b3 ff53 fs27 fc0 sc0 ls0 ws0">F</div><div class="t m5 x116 h3f y45b4 ff53 fs27 fc1 sc0 ls0 ws0">CC</div><div class="t m5 x140 h3f y45b5 ff53 fs27 fc0 sc0 ls0 ws0">W<span class="_ _68"> </span><span class="fc1">icode<span class="_ _108"> </span>valE<span class="_ _45"> </span>valM<span class="_ _7f"> </span>dstE<span class="_ _1d6"></span>stat</span></div><div class="t m5 x10d h3f y45b6 ff53 fs27 fc1 sc0 ls0 ws0">stat</div><div class="t m5 x10d h3f y45b7 ff53 fs27 fc1 sc0 ls0 ws0">stat</div><div class="t m5 x10d h3f y45b8 ff53 fs27 fc1 sc0 ls0 ws0">stat</div><div class="t m5 x44 h3f y45b9 ff53 fs27 fc1 sc0 ls0 ws0">dstM</div><div class="t m5 x1cb h3f y45ba ff53 fs27 fc0 sc0 ls0 ws0">M<span class="_ _105"> </span><span class="fc1">icode<span class="_ _d3"> </span>Cnd<span class="_ _1b3"> </span>valE<span class="_ _119"> </span>valA<span class="_ _7e"> </span>dstE<span class="_ _1f"> </span>dstM</span></div><div class="t m5 x4c h3f y45bb ff53 fs27 fc0 sc0 ls0 ws0">E<span class="_ _18c"> </span><span class="fc1">icode<span class="_ _1e"> </span>ifun<span class="_ _2a"> </span>valC<span class="_ _d3"> </span>valA<span class="_ _d3"> </span>valB<span class="_ _20"> </span>dstM<span class="_ _1f"> </span>srcA<span class="_ _1f"> </span>srcB<span class="_ _1a7"></span>dstE</span></div><div class="t m5 x4c h3f y45bc ff53 fs27 fc0 sc0 ls0 ws0">D<span class="_ _63"> </span><span class="fc1">icode<span class="_ _1e"> </span>ifun<span class="_ _1d7"> </span>valC<span class="_ _d3"> </span>valP<span class="_ _1d8"></span>rB<span class="_ _ef"></span>rA</span></div><div class="t m5 x4c h3f y45bd ff53 fs27 fc0 sc0 ls0 ws0">F<span class="_ _143"> </span><span class="fc1">predPC</span></div><div class="t m5 x25f h3f y45be ff53 fs27 fc1 sc0 ls0 ws0">srcA</div><div class="t m5 x6f h3f y45bf ff53 fs27 fc1 sc0 ls0 ws0">srcB</div><div class="t m5 x10d h3f y45c0 ff53 fs27 fc1 sc0 ls0 ws0">Stat</div><div class="t m5 x243 h3f y45c1 ff53 fs27 fc1 sc0 ls0 ws0">Pipeline</div><div class="t m5 x52 h3f y45c2 ff53 fs27 fc1 sc0 ls0 ws0">control</div><div class="t m5 x34 h3f y45c3 ff53 fs27 fc1 sc0 ls0 ws0">logic</div><div class="t m5 xa2 h65 y45c4 ff53 fs38 fc1 sc0 ls0 ws0">M_icode</div><div class="t m5 xa2 h65 y45c5 ff53 fs38 fc1 sc0 ls0 ws0">W_stat</div><div class="t m5 xa2 h65 y45c6 ff53 fs38 fc1 sc0 ls0 ws0">e_Cnd</div><div class="t m5 xa2 h65 y45c7 ff53 fs38 fc1 sc0 ls0 ws0">m_stat</div><div class="t m5 xa2 h65 y45c8 ff53 fs38 fc1 sc0 ls0 ws0">E_dstM</div><div class="t m5 xa2 h65 y45c9 ff53 fs38 fc1 sc0 ls0 ws0">d_srcB</div><div class="t m5 xa2 h65 y45ca ff53 fs38 fc1 sc0 ls0 ws0">d_srcA</div><div class="t m5 xa2 h65 y45cb ff53 fs38 fc1 sc0 ls0 ws0">D_icode</div><div class="t m5 xa2 h65 y45cc ff53 fs38 fc1 sc0 ls0 ws0">E_icode</div><div class="t m5 x1a9 h65 y45cd ff53 fs38 fc1 sc0 ls0 ws0">E_bubble</div><div class="t m5 x1a9 h65 y45ce ff53 fs38 fc1 sc0 ls0 ws0">set_cc</div><div class="t m5 x1a9 h65 y45cf ff53 fs38 fc1 sc0 ls0 ws0">W_stall</div><div class="t m5 x1a9 h65 y45d0 ff53 fs38 fc1 sc0 ls0 ws0">M_bubble</div><div class="t m5 x1a9 h65 y45d1 ff53 fs38 fc1 sc0 ls0 ws0">D_bubble</div><div class="t m5 x1a9 h65 y45d2 ff53 fs38 fc1 sc0 ls0 ws0">D_stall</div><div class="t m5 x1a9 h65 y45d3 ff53 fs38 fc1 sc0 ls0 ws0">F_stall</div><div class="t m5 x17 h34 y45d4 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _11"> </span>4.68<span class="_ _c"> </span><span class="fc1">PIPE<span class="_ _16"> </span>pipeline<span class="_ _16"> </span>control<span class="_ _11"> </span>logic.<span class="_ _16"> </span><span class="ff6">This<span class="_ _16"> </span>logic<span class="_ _11"> </span>overrides<span class="_ _16"> </span>the<span class="_ _11"> </span>normal<span class="_ _16"> </span>ï¬‚ow<span class="_ _16"> </span>of<span class="_ _11"> </span>instructions<span class="_ _16"> </span>through<span class="_ _16"> </span>the</span></span></div><div class="t m5 x17 h34 y45d5 ff6 fs16 fc1 sc0 ls0 ws0">pipeline<span class="_ _16"> </span>to<span class="_ _16"> </span>handle<span class="_ _16"> </span>special<span class="_ _16"> </span>conditions<span class="_ _16"> </span>such<span class="_ _16"> </span>as<span class="_ _16"> </span>procedure<span class="_ _11"> </span>returns,<span class="_ _14"> </span>mispredicted<span class="_ _16"> </span>branches,<span class="_ _16"> </span>load/use<span class="_ _16"> </span>hazards,</div><div class="t m5 x17 h34 y45d6 ff6 fs16 fc1 sc0 ls0 ws0">and<span class="_ _10"> </span>program<span class="_ _11"> </span>exceptions.</div><div class="t m5 x17 h26 y45d7 ff7 fs19 fc1 sc0 ls0 ws0">stall<span class="_ _21"> </span>and<span class="_ _21"> </span>bubble<span class="_ _21"> </span>control<span class="_ _21"> </span>signals<span class="_ _21"> </span>for<span class="_ _21"> </span>the<span class="_ _21"> </span>pipeline<span class="_ _21"> </span>registers<span class="_ _21"> </span>and<span class="_ _21"> </span>also<span class="_ _21"> </span>determines</div><div class="t m5 x17 h26 y45d8 ff7 fs19 fc1 sc0 ls0 ws0">whether<span class="_ _15"> </span>the<span class="_ _15"> </span>condition<span class="_ _21"> </span>code<span class="_ _15"> </span>registers<span class="_ _15"> </span>should<span class="_ _21"> </span>be<span class="_ _15"> </span>updated.<span class="_ _21"> </span>W<span class="_ _3"></span>e<span class="_ _15"> </span>can<span class="_ _21"> </span>combine<span class="_ _15"> </span>the</div><div class="t m5 x17 h26 y45d9 ff7 fs19 fc1 sc0 ls0 ws0">detection<span class="_"> </span>conditions<span class="_"> </span>of<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>4.64<span class="_ _11"> </span>with<span class="_"> </span>the<span class="_"> </span>actions<span class="_"> </span>of<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_ _11"> </span>4.66<span class="_"> </span>to<span class="_"> </span>create<span class="_"> </span>HCL</div><div class="t m5 x17 h26 y45da ff7 fs19 fc1 sc0 ls0 ws0">descriptions<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>different<span class="_"> </span>pipeline<span class="_"> </span>control<span class="_"> </span>signals<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y45db ff7 fs19 fc1 sc0 ls0 ws0">Pipeline<span class="_ _f"> </span>register<span class="_ _f"> </span>F<span class="_ _e"> </span>must<span class="_ _21"> </span>be<span class="_ _f"> </span>stalled<span class="_ _e"> </span>for<span class="_ _21"> </span>either<span class="_ _f"> </span>a<span class="_ _e"> </span>load/use<span class="_ _21"> </span>hazard<span class="_ _f"> </span>or<span class="_ _e"> </span>a<span class="_ _21"> </span><span class="ffd">ret</span></div><div class="t m5 x17 h26 y45dc ff7 fs19 fc1 sc0 ls0 ws0">instruction:</div><div class="t m5 x17 h2d y45dd ffd fs1e fc2 sc0 ls0 ws0">bool<span class="_ _e"> </span>F_stall<span class="_ _1f"> </span>=</div><div class="t m5 x21e h2d y45de ffd fs1e fc2 sc0 ls0 ws0">#<span class="_ _e"> </span>Conditions<span class="_ _1f"> </span>for<span class="_ _1f"> </span>a<span class="_ _e"> </span>load/use<span class="_ _1f"> </span>hazard</div><div class="t m5 x21e h2d y45df ffd fs1e fc2 sc0 ls0 ws0">E_icode<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _1f"> </span>IMRMOVQ,<span class="_ _e"> </span>IPOPQ<span class="_ _1f"> </span>}<span class="_ _e"> </span>&amp;&amp;</div><div class="t m5 x12 h2d y45e0 ffd fs1e fc2 sc0 ls0 ws0">E_dstM<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _1f"> </span>d_srcA,<span class="_ _e"> </span>d_srcB<span class="_ _1f"> </span>}<span class="_ _e"> </span>||</div><div class="t m5 x21e h2d y45e1 ffd fs1e fc2 sc0 ls0 ws0">#<span class="_ _e"> </span>Stalling<span class="_ _1f"> </span>at<span class="_ _1f"> </span>fetch<span class="_ _e"> </span>while<span class="_ _1f"> </span>ret<span class="_ _e"> </span>passes<span class="_ _1f"> </span>through<span class="_ _1f"> </span>pipeline</div><div class="t m5 x21e h2d y45e2 ffd fs1e fc2 sc0 ls0 ws0">IRET<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _1f"> </span>D_icode,<span class="_ _e"> </span>E_icode,<span class="_ _1f"> </span>M_icode<span class="_ _e"> </span>};</div><div class="t m5 x17 h47 y45e3 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>4.39<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>529)</span></div><div class="t m5 x17 h26 y45e4 ff7 fs19 fc1 sc0 ls0 ws0">Write<span class="_"> </span>HCL<span class="_"> </span>code<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>signal<span class="_"> </span><span class="ff6">D_stall<span class="_ _10"> </span></span>in<span class="_"> </span>the<span class="_"> </span>PIPE<span class="_"> </span>implementation.</div><div class="t m5 x26 h26 y6e1 ff7 fs19 fc1 sc0 ls0 ws0">Pipeline<span class="_"> </span>register<span class="_"> </span>D<span class="_ _11"> </span>must<span class="_"> </span>be<span class="_"> </span>set<span class="_ _11"> </span>to<span class="_"> </span>bubble<span class="_ _11"> </span>for<span class="_"> </span>a<span class="_"> </span>mispredicted<span class="_ _11"> </span>branch<span class="_"> </span>or<span class="_"> </span>a<span class="_ _11"> </span><span class="ffd">ret</span></div><div class="t m5 x17 h26 y6e2 ff7 fs19 fc1 sc0 ls0 ws0">instruction.<span class="_ _14"> </span>As<span class="_ _15"> </span>the<span class="_ _14"> </span>analysis<span class="_ _15"> </span>in<span class="_ _15"> </span>the<span class="_ _14"> </span>preceding<span class="_ _15"> </span>section<span class="_ _15"> </span>shows<span class="_ _1"></span>,<span class="_ _15"> </span>however,<span class="_ _15"> </span>it<span class="_ _15"> </span>should</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
