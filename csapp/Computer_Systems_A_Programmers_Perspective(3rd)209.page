<div id="pfd1" class="pf w2 h11" data-page-no="d1"><div class="pc pcd1 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bgd1.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">208<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x28 h2a y548 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">The<span class="_ _11"> </span>ever-changing<span class="_ _11"> </span>forms<span class="_ _11"> </span>of<span class="_ _16"> </span>generated<span class="_ _11"> </span>code</span></div><div class="t m5 x28 h2b y2d0 ff7 fs1e fc2 sc0 ls0 ws0">In<span class="_ _16"> </span>our<span class="_ _16"> </span>presentation,<span class="_ _14"> </span>we<span class="_ _16"> </span>will<span class="_ _16"> </span>show<span class="_ _16"> </span>the<span class="_ _16"> </span>code<span class="_ _16"> </span>generated<span class="_ _16"> </span>by<span class="_ _16"> </span>a<span class="_ _16"> </span>particular<span class="_ _16"> </span>version<span class="_ _16"> </span>of<span class="_ _16"> </span><span class="ff9">gcc<span class="_ _16"> </span></span>with<span class="_ _14"> </span>particular</div><div class="t m5 x28 h2b y2d1 ff7 fs1e fc2 sc0 ls0 ws0">settings<span class="_ _6"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>command-line<span class="_ _a"> </span>options<span class="_ _0"></span>.<span class="_ _6"> </span>If<span class="_ _13"> </span>you<span class="_ _a"> </span>compile<span class="_ _13"> </span>code<span class="_ _a"> </span>on<span class="_ _13"> </span>your<span class="_ _a"> </span>own<span class="_ _13"> </span>machine<span class="_ _1"></span>,<span class="_ _13"> </span>chances<span class="_ _a"> </span>are<span class="_ _13"> </span>you<span class="_ _a"> </span>will<span class="_ _13"> </span>be</div><div class="t m5 x28 h2b y2d2 ff7 fs1e fc2 sc0 ls0 ws0">using<span class="_ _6"> </span>a<span class="_ _6"> </span>different<span class="_ _6"> </span>compiler<span class="_ _13"> </span>or<span class="_ _a"> </span>a<span class="_ _6"> </span>different<span class="_ _13"> </span>version<span class="_ _a"> </span>of<span class="_ _6"> </span><span class="ff9">gcc<span class="_ _13"> </span></span>and<span class="_ _a"> </span>hence<span class="_ _6"> </span>will<span class="_ _13"> </span>generate<span class="_ _a"> </span>different<span class="_ _6"> </span>code.<span class="_ _a"> </span>The<span class="_ _a"> </span>open-</div><div class="t m5 x28 h2b y2d3 ff7 fs1e fc2 sc0 ls0 ws0">source<span class="_ _16"> </span>community<span class="_ _11"> </span>supporting<span class="_ _16"> </span><span class="ff9">gcc<span class="_ _16"> </span></span>keeps<span class="_ _16"> </span>changing<span class="_ _11"> </span>the<span class="_ _16"> </span>code<span class="_ _16"> </span>generator,<span class="_ _16"> </span>attempting<span class="_ _16"> </span>to<span class="_ _11"> </span>generate<span class="_ _16"> </span>more</div><div class="t m5 x28 h2b y2d4 ff7 fs1e fc2 sc0 ls0 ws0">efﬁcient<span class="_"> </span>code<span class="_"> </span>according<span class="_"> </span>to<span class="_"> </span>changing<span class="_"> </span>code<span class="_"> </span>guidelines<span class="_"> </span>provided<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span>microprocessor<span class="_"> </span>manufacturers<span class="_ _1"></span>.</div><div class="t m5 x57 h2b y2d5 ff7 fs1e fc2 sc0 ls0 ws0">Our<span class="_ _11"> </span>goal<span class="_ _11"> </span>in<span class="_ _11"> </span>studying<span class="_ _11"> </span>the<span class="_ _11"> </span>examples<span class="_ _11"> </span>shown<span class="_ _11"> </span>in<span class="_ _11"> </span>our<span class="_ _11"> </span>presentation<span class="_ _11"> </span>is<span class="_ _11"> </span>to<span class="_ _11"> </span>demonstrate<span class="_ _11"> </span>how<span class="_ _11"> </span>to<span class="_ _11"> </span>examine</div><div class="t m5 x28 h2b y2d6 ff7 fs1e fc2 sc0 ls0 ws0">assembly<span class="_"> </span>code<span class="_"> </span>and<span class="_ _13"> </span>map<span class="_"> </span>it<span class="_"> </span>back<span class="_ _13"> </span>to<span class="_"> </span>the<span class="_"> </span>constructs<span class="_ _13"> </span>found<span class="_"> </span>in<span class="_"> </span>high-level<span class="_"> </span>programming<span class="_ _13"> </span>languages<span class="_ _1"></span>.<span class="_"> </span>Y<span class="_ _3"></span>ou<span class="_"> </span>will</div><div class="t m5 x28 h2b y549 ff7 fs1e fc2 sc0 ls0 ws0">need<span class="_"> </span>to<span class="_"> </span>adapt<span class="_"> </span>these<span class="_"> </span>techniques<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>style<span class="_"> </span>of<span class="_"> </span>code<span class="_"> </span>generated<span class="_"> </span>by<span class="_"> </span>your<span class="_"> </span>particular<span class="_"> </span>compiler.</div><div class="t m5 x1d h26 y20cb ff7 fs19 fc2 sc0 ls0 ws0">this<span class="_ _13"> </span>virtual<span class="_"> </span>address<span class="_ _13"> </span>space<span class="_ _1"></span>,<span class="_"> </span>translating<span class="_ _13"> </span>virtual<span class="_ _13"> </span>addresses<span class="_ _13"> </span>into<span class="_"> </span>the<span class="_ _13"> </span>physical<span class="_ _13"> </span>addresses</div><div class="t m5 x1d h26 y20cc ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_"> </span>values<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>actual<span class="_"> </span>processor<span class="_"> </span>memory<span class="_ _3"></span>.</div><div class="t m5 x29 h26 y20cd ff7 fs19 fc2 sc0 ls0 ws0">A<span class="_ _13"> </span>single<span class="_"> </span>machine<span class="_ _13"> </span>instruction<span class="_"> </span>performs<span class="_ _13"> </span>only<span class="_"> </span>a<span class="_ _13"> </span>very<span class="_"> </span>elementary<span class="_ _13"> </span>operation.<span class="_"> </span>F<span class="_ _3"></span>or</div><div class="t m5 x1d h26 y20ce ff7 fs19 fc2 sc0 ls0 ws0">example<span class="_ _1"></span>,<span class="_ _e"> </span>it<span class="_ _15"> </span>might<span class="_ _21"> </span>add<span class="_ _15"> </span>two<span class="_ _21"> </span>numbers<span class="_ _21"> </span>stored<span class="_ _21"> </span>in<span class="_ _21"> </span>registers<span class="_ _1"></span>,<span class="_ _f"> </span>transfer<span class="_ _21"> </span>data<span class="_ _21"> </span>between</div><div class="t m5 x1d h26 y20cf ff7 fs19 fc2 sc0 ls0 ws0">memory<span class="_"> </span>and<span class="_"> </span>a<span class="_"> </span>register<span class="_ _0"></span>,<span class="_"> </span>or<span class="_"> </span>conditionally<span class="_"> </span>branch<span class="_"> </span>to<span class="_"> </span>a<span class="_"> </span>new<span class="_"> </span>instruction<span class="_"> </span>address<span class="_ _3"></span>.<span class="_"> </span>T<span class="_ _1"></span>he</div><div class="t m5 x1d h26 y20d0 ff7 fs19 fc2 sc0 ls0 ws0">compiler<span class="_ _15"> </span>must<span class="_ _21"> </span>generate<span class="_ _15"> </span>sequences<span class="_ _21"> </span>of<span class="_ _21"> </span>such<span class="_ _15"> </span>instructions<span class="_ _21"> </span>to<span class="_ _21"> </span>implement<span class="_ _15"> </span>program</div><div class="t m5 x1d h26 y20d1 ff7 fs19 fc2 sc0 ls0 ws0">constructs<span class="_"> </span>such<span class="_ _13"> </span>as<span class="_"> </span>arithmetic<span class="_ _13"> </span>expression<span class="_"> </span>evaluation,<span class="_ _13"> </span>loops<span class="_ _0"></span>,<span class="_"> </span>or<span class="_ _13"> </span>procedure<span class="_"> </span>calls<span class="_ _13"> </span>and</div><div class="t m5 x1d h26 y20d2 ff7 fs19 fc2 sc0 ls0 ws0">returns<span class="_ _1"></span>.</div><div class="t m5 x1d h41 y20d3 ffe fs29 fc2 sc0 ls0 ws0">3.2.2<span class="_ _48"> </span><span class="fs19">Code<span class="_"> </span>Examples</span></div><div class="t m5 x1d h26 y20d4 ff7 fs19 fc2 sc0 ls0 ws0">Suppose<span class="_ _11"> </span>we<span class="_ _11"> </span>write<span class="_ _11"> </span>a<span class="_"> </span>C<span class="_ _11"> </span>code<span class="_ _11"> </span>ﬁle<span class="_ _16"> </span><span class="ffd">mstore.c<span class="_ _10"> </span></span>containing<span class="_ _11"> </span>the<span class="_ _11"> </span>following<span class="_ _11"> </span>function<span class="_ _11"> </span>deﬁ-</div><div class="t m5 x1d h26 y20d5 ff7 fs19 fc2 sc0 ls0 ws0">nition:</div><div class="t m5 x1d h2d y20d6 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>mult2(long,<span class="_ _1f"> </span>long);</div><div class="t m5 x1d h2d y20d7 ffd fs1e fc2 sc0 ls0 ws0">void<span class="_ _e"> </span>multstore(long<span class="_ _1f"> </span>x,<span class="_ _1f"> </span>long<span class="_ _e"> </span>y,<span class="_ _1f"> </span>long<span class="_ _e"> </span>*dest)<span class="_ _1f"> </span>{</div><div class="t m5 x10c h2d y20d8 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>t<span class="_ _1f"> </span>=<span class="_ _1f"> </span>mult2(x,<span class="_ _e"> </span>y);</div><div class="t m5 x10c h2d y20d9 ffd fs1e fc2 sc0 ls0 ws0">*dest<span class="_ _e"> </span>=<span class="_ _1f"> </span>t;</div><div class="t m5 x1d h2d y20da ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x29 h26 y20db ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_ _15"> </span>see<span class="_ _14"> </span>the<span class="_ _14"> </span>assembly<span class="_ _14"> </span>code<span class="_ _14"> </span>generated<span class="_ _14"> </span>by<span class="_ _15"> </span>the<span class="_ _14"> </span>C<span class="_ _14"> </span>compiler,<span class="_ _14"> </span>we<span class="_ _14"> </span>can<span class="_ _15"> </span>use<span class="_ _14"> </span>the<span class="_ _14"> </span><span class="ffd">-S</span></div><div class="t m5 x1d h26 y20dc ff7 fs19 fc2 sc0 ls0 ws0">option<span class="_"> </span>on<span class="_"> </span>the<span class="_"> </span>command<span class="_"> </span>line:</div><div class="t m5 x1d h2d y20dd ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">gcc<span class="_ _1f"> </span>-Og<span class="_ _1f"> </span>-S<span class="_ _e"> </span>mstore.c</span></div><div class="t m5 x1d h26 y20de ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _14"> </span>will<span class="_ _14"> </span>cause<span class="_ _15"> </span><span class="ff9">gcc<span class="_ _14"> </span></span>to<span class="_ _14"> </span>run<span class="_ _14"> </span>the<span class="_ _14"> </span>compiler,<span class="_ _14"> </span>generating<span class="_ _15"> </span>an<span class="_ _14"> </span>assembly<span class="_ _14"> </span>ﬁle<span class="_ _14"> </span><span class="ffd">mstore.s</span>,</div><div class="t m5 x1d h26 y20df ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_ _11"> </span>go<span class="_ _11"> </span>no<span class="_ _11"> </span>further.<span class="_"> </span>(Normally<span class="_ _11"> </span>it<span class="_ _11"> </span>would<span class="_ _11"> </span>then<span class="_ _11"> </span>invoke<span class="_ _11"> </span>the<span class="_ _11"> </span>assembler<span class="_ _16"> </span>to<span class="_"> </span>generate<span class="_ _11"> </span>an</div><div class="t m5 x1d h26 y20e0 ff7 fs19 fc2 sc0 ls0 ws0">object-code<span class="_"> </span>ﬁle<span class="_ _1"></span>.)</div><div class="t m5 x29 h26 y20e1 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>assembly-code<span class="_"> </span>ﬁle<span class="_"> </span>contains<span class="_"> </span>various<span class="_"> </span>declarations<span class="_ _3"></span>,<span class="_"> </span>including<span class="_"> </span>the<span class="_"> </span>following</div><div class="t m5 x1d h26 y20e2 ff7 fs19 fc2 sc0 ls0 ws0">set<span class="_"> </span>of<span class="_"> </span>lines:</div><div class="t m5 x1d h2d y8d6 ffd fs1e fc2 sc0 ls0 ws0">multstore:</div><div class="t m5 x75 h2d y140a ffd fs1e fc2 sc0 ls0 ws0">pushq<span class="_ _3f"> </span>%rbx</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
