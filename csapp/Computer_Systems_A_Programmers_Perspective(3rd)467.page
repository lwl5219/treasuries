<div id="pf1d3" class="pf w2 h11" data-page-no="1d3"><div class="pc pc1d3 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1d3.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">466<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>4<span class="_ _3d"> </span>Processor<span class="_ _10"> </span>Architecture</span></div><div class="t m5 x15 h9e y407e ff49 fs62 fc1 sc0 ls0 ws0">F<span class="_ _1c3"></span><span class="ff4a fs63">0x000: irmovq $10,%rdx</span></div><div class="t m5 x1d h9e y407f ff4a fs63 fc1 sc0 ls0 ws0"># progl</div><div class="c x1d y4080 w5 h9f"><div class="t m5 x0 h9e y4081 ff4a fs63 fc3 sc1 ls0 ws0"># progl</div></div><div class="t m5 x1d h9e y4082 ff4a fs63 fc1 sc0 ls0 ws0">0x00a: irmovq  $3,%rax</div><div class="t m5 x1d h9e y4083 ff4a fs63 fc1 sc0 ls0 ws0">0x014: nop</div><div class="t m5 x1d h9e y4084 ff4a fs63 fc1 sc0 ls0 ws0">0x015: nop</div><div class="t m5 x1d h9e y4085 ff4a fs63 fc1 sc0 ls0 ws0">0x016: nop</div><div class="t m5 x1d h9e y4086 ff4a fs63 fc1 sc0 ls0 ws0">0x017: addq %rdx,%rax</div><div class="t m5 x1d h9e y4087 ff4a fs63 fc1 sc0 ls0 ws0">0x019: halt</div><div class="t m5 x138 ha0 y407e ff49 fs62 fc1 sc0 ls1cc ws0">DE<span class="_ _1"></span>M<span class="_ _7"></span>W</div><div class="t m5 x138 ha0 y4088 ff49 fs62 fc1 sc0 ls1cd ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x40 ha0 y4089 ff49 fs62 fc1 sc0 ls1ce ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x205 ha0 y408a ff49 fs62 fc1 sc0 ls1ce ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x3a ha0 y408b ff49 fs62 fc1 sc0 ls1ce ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x18a ha0 y408c ff49 fs62 fc1 sc0 ls1cd ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x169 ha0 y408d ff49 fs62 fc1 sc0 ls1cd ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x51 ha0 y408e ff49 fs62 fc1 sc0 ls0 ws0">Cycle 6</div><div class="t m5 x3d ha0 y408f ff49 fs62 fc1 sc0 ls0 ws0">Cycle 7</div><div class="t m5 x200 ha1 y4090 ff49 fs64 fc6 sc0 ls1cf ws0">12345</div><div class="t m5 x54 ha1 y4091 ff49 fs64 fc6 sc0 ls0 ws0">6</div><div class="t m5 x1bd ha1 y4092 ff49 fs64 fc6 sc0 ls0 ws0">7</div><div class="t m5 x103 ha1 y4093 ff49 fs64 fc6 sc0 ls0 ws0">8</div><div class="t m5 x104 ha1 y4094 ff49 fs64 fc6 sc0 ls1d0 ws0">91<span class="_ _184"></span>0<span class="_ _2"></span>1<span class="_ _1c4"></span>1</div><div class="t m5 x1ad ha0 y4095 ff49 fs62 fc1 sc0 ls0 ws0">W</div><div class="t m5 x16b ha0 y4096 ff49 fs62 fc1 sc0 ls0 ws0">D</div><div class="t m5 x254 ha0 y4097 ff49 fs62 fc1 sc0 ls0 ws0">R[</div><div class="t m5 x120 h9e y4098 ff4a fs63 fc1 sc0 ls0 ws0">%rax<span class="ff49 fs62">]      3</span></div><div class="t m5 xb5 ha0 y4099 ff49 fs62 fc1 sc0 ls0 ws0">valA<span class="_ _1"></span>      R[</div><div class="t m5 x16b h9e y409a ff4a fs63 fc1 sc0 ls0 ws0">%rdx<span class="ff49 fs62">] = 10</span></div><div class="t m5 xb5 ha0 y409b ff49 fs62 fc1 sc0 ls0 ws0">valB      R[</div><div class="t m5 x16b h9e y409c ff4a fs63 fc1 sc0 ls0 ws0">%rax<span class="ff49 fs62">] = 3</span></div><div class="t m5 x1d h3a y409d ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>4.43<span class="_ _66"> </span><span class="fc1">Pipelined<span class="_"> </span>execution<span class="_"> </span>of<span class="_ _10"> </span><span class="ffd fs19">prog1<span class="_ _10"> </span></span>without<span class="_ _10"> </span>special<span class="_ _10"> </span>pipeline<span class="_ _10"> </span>control.<span class="_ _10"> </span><span class="ff6">In<span class="_ _10"> </span>cycle</span></span></div><div class="t m5 x1d h34 y409e ff6 fs16 fc1 sc0 ls0 ws0">6,<span class="_ _11"> </span>the<span class="_ _16"> </span>second</div><div class="t m5 x112 h3a y409f ffd fs19 fc1 sc0 ls0 ws0">irmovq<span class="_ _11"> </span><span class="ff6 fs16">writes<span class="_ _11"> </span>its<span class="_ _16"> </span>result<span class="_ _11"> </span>to<span class="_ _11"> </span>program<span class="_ _16"> </span>register<span class="_ _11"> </span></span>%rax<span class="ff6 fs16">.<span class="_ _11"> </span>The<span class="_ _11"> </span></span>addq<span class="_ _16"> </span><span class="ff6 fs16">instruction</span></div><div class="t m5 x1d h34 y40a0 ff6 fs16 fc1 sc0 ls0 ws0">reads<span class="_ _10"> </span>its<span class="_ _11"> </span>source<span class="_ _10"> </span>operands<span class="_ _10"> </span>in<span class="_ _10"> </span>cycle<span class="_ _11"> </span>7,<span class="_ _10"> </span>so<span class="_ _11"> </span>it<span class="_ _10"> </span>gets<span class="_ _10"> </span>correct<span class="_ _11"> </span>values<span class="_ _10"> </span>for<span class="_ _11"> </span>both</div><div class="t m5 x3d h3a y40a1 ffd fs19 fc1 sc0 ls0 ws0">%rdx<span class="_ _10"> </span><span class="ff6 fs16">and<span class="_ _11"> </span></span>%rax<span class="ff6 fs16">.</span></div><div class="t m5 x29 h26 y2154 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_"> </span>4.43<span class="_"> </span>illustrates<span class="_ _13"> </span>the<span class="_"> </span>processing<span class="_ _13"> </span>of<span class="_"> </span>a<span class="_ _13"> </span>sequence<span class="_"> </span>of<span class="_ _13"> </span>instructions<span class="_"> </span>we<span class="_ _13"> </span>refer<span class="_"> </span>to</div><div class="t m5 x1d h46 y40a2 ff7 fs19 fc1 sc0 ls0 ws0">as<span class="_ _11"> </span><span class="ffd">prog1<span class="_ _11"> </span></span>by<span class="_ _11"> </span>the<span class="_ _11"> </span>PIPE<span class="ff12">−<span class="_ _11"> </span></span>processor.<span class="_ _11"> </span>Let<span class="_ _11"> </span>us<span class="_ _11"> </span>assume<span class="_ _11"> </span>in<span class="_ _16"> </span>this<span class="_"> </span>example<span class="_ _16"> </span>and<span class="_"> </span>successive</div><div class="t m5 x1d h26 y40a3 ff7 fs19 fc1 sc0 ls0 ws0">ones<span class="_ _16"> </span>that<span class="_ _16"> </span>the<span class="_ _16"> </span>program<span class="_ _16"> </span>registers<span class="_ _16"> </span>initially<span class="_ _16"> </span>all<span class="_ _16"> </span>have<span class="_ _16"> </span>value<span class="_ _16"> </span>0.<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span>code<span class="_ _16"> </span>loads<span class="_ _16"> </span>values</div><div class="t m5 x1d h26 y40a4 ff7 fs19 fc1 sc0 ls0 ws0">10<span class="_ _16"> </span>and<span class="_ _11"> </span>3<span class="_ _16"> </span>into<span class="_ _16"> </span>program<span class="_ _16"> </span>registers<span class="_ _11"> </span><span class="ffd">%rdx<span class="_ _16"> </span></span>and<span class="_ _16"> </span><span class="ffd">%rax</span>,<span class="_ _16"> </span>executes<span class="_ _16"> </span>three<span class="_ _16"> </span><span class="ffd">nop<span class="_ _11"> </span></span>instructions<span class="_ _1"></span>,</div><div class="t m5 x1d h26 y40a5 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_"> </span>then<span class="_ _13"> </span>adds<span class="_"> </span>register<span class="_ _13"> </span><span class="ffd">%rdx<span class="_ _10"> </span></span>to<span class="_ _13"> </span><span class="ffd">%rax</span>.<span class="_"> </span>W<span class="_ _3"></span>e<span class="_"> </span>focus<span class="_ _13"> </span>our<span class="_"> </span>attention<span class="_"> </span>on<span class="_ _13"> </span>the<span class="_"> </span>potential<span class="_ _13"> </span>data</div><div class="t m5 x1d h26 y40a6 ff7 fs19 fc1 sc0 ls0 ws0">hazards<span class="_ _6"> </span>resulting<span class="_ _6"> </span>from<span class="_ _6"> </span>the<span class="_ _6"> </span>data<span class="_ _6"> </span>dependencies<span class="_ _6"> </span>between<span class="_ _6"> </span>the<span class="_ _6"> </span>two<span class="_ _6"> </span><span class="ffd">irmovq<span class="_ _13"> </span></span>instructions</div><div class="t m5 x1d h26 y40a7 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_"> </span>the<span class="_ _13"> </span><span class="ffd">addq<span class="_ _10"> </span></span>instruction.<span class="_"> </span>On<span class="_"> </span>the<span class="_ _13"> </span>right-hand<span class="_"> </span>side<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>ﬁgure<span class="_ _1"></span>,<span class="_"> </span>we<span class="_"> </span>show<span class="_ _13"> </span>a<span class="_"> </span>pipeline</div><div class="t m5 x1d h26 y40a8 ff7 fs19 fc1 sc0 ls0 ws0">diagram<span class="_ _16"> </span>for<span class="_ _16"> </span>the<span class="_ _16"> </span>instruction<span class="_ _16"> </span>sequence<span class="_ _1"></span>.<span class="_ _16"> </span>The<span class="_ _11"> </span>pipeline<span class="_ _16"> </span>stages<span class="_ _16"> </span>for<span class="_ _16"> </span>cycles<span class="_ _16"> </span>6<span class="_ _16"> </span>and<span class="_ _16"> </span>7<span class="_ _16"> </span>are</div><div class="t m5 x1d h26 y40a9 ff7 fs19 fc1 sc0 ls0 ws0">shown<span class="_ _13"> </span>highlighted<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_ _13"> </span>pipeline<span class="_ _6"> </span>diagram.<span class="_ _13"> </span>Below<span class="_ _13"> </span>this<span class="_ _1"></span>,<span class="_ _13"> </span>we<span class="_ _13"> </span>show<span class="_ _13"> </span>an<span class="_ _13"> </span>expanded<span class="_ _13"> </span>view</div><div class="t m5 x1d h26 y40aa ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_ _11"> </span>the<span class="_ _11"> </span>write-back<span class="_ _11"> </span>activity<span class="_"> </span>in<span class="_ _11"> </span>cycle<span class="_ _11"> </span>6<span class="_ _11"> </span>and<span class="_ _11"> </span>the<span class="_ _11"> </span>decode<span class="_ _11"> </span>activity<span class="_ _11"> </span>during<span class="_ _11"> </span>cycle<span class="_"> </span>7.<span class="_ _11"> </span>After</div><div class="t m5 x1d h26 y40ab ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _13"> </span>start<span class="_ _13"> </span>of<span class="_ _13"> </span>cycle<span class="_ _13"> </span>7,<span class="_ _13"> </span>both<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ffd">irmovq<span class="_ _13"> </span></span>instructions<span class="_"> </span>have<span class="_ _13"> </span>passed<span class="_ _13"> </span>through<span class="_ _13"> </span>the<span class="_ _13"> </span>write-</div><div class="t m5 x1d h26 y40ac ff7 fs19 fc1 sc0 ls0 ws0">back<span class="_ _14"> </span>stage<span class="_ _1"></span>,<span class="_ _15"> </span>and<span class="_ _14"> </span>so<span class="_ _14"> </span>the<span class="_ _16"> </span>register<span class="_ _14"> </span>ﬁle<span class="_ _14"> </span>holds<span class="_ _14"> </span>the<span class="_ _14"> </span>updated<span class="_ _14"> </span>values<span class="_ _14"> </span>of<span class="_ _14"> </span><span class="ffd">%rdx<span class="_ _16"> </span></span>and<span class="_ _14"> </span><span class="ffd">%rax</span>.</div><div class="t m5 x1d h26 y40ad ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_ _14"> </span>the<span class="_ _14"> </span><span class="ffd">addq<span class="_ _15"> </span></span>instruction<span class="_ _14"> </span>passes<span class="_ _14"> </span>through<span class="_ _14"> </span>the<span class="_ _15"> </span>decode<span class="_ _14"> </span>stage<span class="_ _14"> </span>during<span class="_ _15"> </span>cycle<span class="_ _16"> </span>7,<span class="_ _21"> </span>it<span class="_ _14"> </span>will</div><div class="t m5 x1d h26 y40ae ff7 fs19 fc1 sc0 ls0 ws0">therefore<span class="_"> </span>read<span class="_"> </span>the<span class="_ _11"> </span>correct<span class="_"> </span>values<span class="_"> </span>for<span class="_ _11"> </span>its<span class="_"> </span>source<span class="_ _11"> </span>operands<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _0"></span>he<span class="_"> </span>data<span class="_"> </span>dependencies</div><div class="t m5 x1d h26 y40af ff7 fs19 fc1 sc0 ls0 ws0">between<span class="_ _16"> </span>the<span class="_ _16"> </span>two<span class="_ _16"> </span><span class="ffd">irmovq<span class="_ _16"> </span></span>instructions<span class="_ _11"> </span>and<span class="_ _16"> </span>the<span class="_ _16"> </span><span class="ffd">addq<span class="_ _16"> </span></span>instruction<span class="_ _16"> </span>have<span class="_ _16"> </span>not<span class="_ _16"> </span>created</div><div class="t m5 x1d h26 y40b0 ff7 fs19 fc1 sc0 ls0 ws0">data<span class="_"> </span>hazards<span class="_"> </span>in<span class="_"> </span>this<span class="_"> </span>example<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y40b1 ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_"> </span>saw<span class="_ _11"> </span>that<span class="_"> </span><span class="ffd">prog1<span class="_ _10"> </span></span>will<span class="_ _11"> </span>ﬂow<span class="_"> </span>through<span class="_"> </span>our<span class="_ _11"> </span>pipeline<span class="_"> </span>and<span class="_"> </span>get<span class="_ _11"> </span>the<span class="_"> </span>correct<span class="_"> </span>results<span class="_ _1"></span>,</div><div class="t m5 x1d h26 y40b2 ff7 fs19 fc1 sc0 ls0 ws0">because<span class="_ _11"> </span>the<span class="_ _11"> </span>three<span class="_ _11"> </span><span class="ffd">nop<span class="_ _11"> </span></span>instructions<span class="_ _11"> </span>create<span class="_ _11"> </span>a<span class="_ _11"> </span>delay<span class="_ _11"> </span>between<span class="_ _11"> </span>instructions<span class="_ _11"> </span>with<span class="_ _11"> </span>data</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
