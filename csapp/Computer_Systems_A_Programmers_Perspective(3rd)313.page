<div id="pf139" class="pf w2 h11" data-page-no="139"><div class="pc pc139 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg139.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">312<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x28 h2a y257 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">A<span class="_ _11"> </span>case<span class="_ _11"> </span>of<span class="_ _11"> </span>mandator<span class="_ _2"></span>y<span class="_ _11"> </span>alignment</span></div><div class="t m5 x28 h2b y258 ff7 fs1e fc2 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_"> </span>most<span class="_ _10"> </span>x86-64<span class="_ _10"> </span>instructions<span class="_ _0"></span>,<span class="_"> </span>keeping<span class="_ _10"> </span>data<span class="_ _10"> </span>aligned<span class="_ _11"> </span>improves<span class="_"> </span>efﬁciency<span class="_ _7"></span>,<span class="_ _11"> </span>but<span class="_"> </span>it<span class="_"> </span>does<span class="_ _11"> </span>not<span class="_"> </span>affect<span class="_"> </span>program</div><div class="t m5 x28 h2b y259 ff7 fs1e fc2 sc0 ls0 ws0">behavior.<span class="_ _14"> </span>On<span class="_ _15"> </span>the<span class="_ _21"> </span>other<span class="_ _15"> </span>hand,<span class="_ _21"> </span>some<span class="_ _15"> </span>models<span class="_ _21"> </span>of<span class="_ _15"> </span>Intel<span class="_ _15"> </span>and<span class="_ _15"> </span>AMD<span class="_ _15"> </span>processors<span class="_ _21"> </span>will<span class="_ _15"> </span>not<span class="_ _15"> </span>work<span class="_ _15"> </span>correctly</div><div class="t m5 x28 h2b y25a ff7 fs1e fc2 sc0 ls0 ws0">with<span class="_ _15"> </span>unaligned<span class="_ _14"> </span>data<span class="_ _15"> </span>for<span class="_ _15"> </span>some<span class="_ _15"> </span>of<span class="_ _15"> </span>the<span class="_ _15"> </span>SSE<span class="_ _15"> </span>instructions<span class="_ _14"> </span>implementing<span class="_ _15"> </span>multimedia<span class="_ _15"> </span>operations<span class="_ _1"></span>.<span class="_ _15"> </span>These</div><div class="t m5 x28 h2b y4e2 ff7 fs1e fc2 sc0 ls0 ws0">instructions<span class="_ _13"> </span>operate<span class="_"> </span>on<span class="_ _13"> </span>16-byte<span class="_ _13"> </span>blocks<span class="_ _13"> </span>of<span class="_"> </span>data,<span class="_ _13"> </span>and<span class="_ _13"> </span>the<span class="_ _13"> </span>instructions<span class="_"> </span>that<span class="_ _13"> </span>transfer<span class="_ _13"> </span>data<span class="_ _13"> </span>between<span class="_"> </span>the<span class="_ _13"> </span>SSE</div><div class="t m5 x28 h2b y4e3 ff7 fs1e fc2 sc0 ls0 ws0">unit<span class="_"> </span>and<span class="_"> </span>memory<span class="_"> </span>require<span class="_"> </span>the<span class="_"> </span>memory<span class="_"> </span>addresses<span class="_"> </span>to<span class="_"> </span>be<span class="_"> </span>multiples<span class="_"> </span>of<span class="_"> </span>16.<span class="_"> </span>Any<span class="_"> </span>attempt<span class="_ _13"> </span>to<span class="_"> </span>access<span class="_"> </span>memory</div><div class="t m5 x28 h2b y4e4 ff7 fs1e fc2 sc0 ls0 ws0">with<span class="_"> </span>an<span class="_ _13"> </span>address<span class="_"> </span>that<span class="_"> </span>does<span class="_ _13"> </span>not<span class="_"> </span>satisfy<span class="_"> </span>this<span class="_ _13"> </span>alignment<span class="_"> </span>will<span class="_ _13"> </span>lead<span class="_"> </span>to<span class="_"> </span>an<span class="_ _13"> </span><span class="ffa">exception<span class="_"> </span></span>(see<span class="_ _13"> </span>Section<span class="_"> </span>8.1),<span class="_"> </span>with<span class="_ _13"> </span>the</div><div class="t m5 x28 h2b y945 ff7 fs1e fc2 sc0 ls0 ws0">default<span class="_"> </span>behavior<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>program<span class="_"> </span>to<span class="_"> </span>terminate<span class="_ _1"></span>.</div><div class="t m5 x57 h2b y946 ff7 fs1e fc2 sc0 ls0 ws0">As<span class="_ _6"> </span>a<span class="_ _a"> </span>result,<span class="_ _13"> </span>any<span class="_ _a"> </span>compiler<span class="_ _6"> </span>and<span class="_ _6"> </span>run-time<span class="_ _6"> </span>system<span class="_ _6"> </span>for<span class="_ _6"> </span>an<span class="_ _6"> </span>x86-64<span class="_ _6"> </span>processor<span class="_ _6"> </span>must<span class="_ _6"> </span>ensure<span class="_ _6"> </span>that<span class="_ _6"> </span>any<span class="_ _a"> </span>memory</div><div class="t m5 x28 h2b y947 ff7 fs1e fc2 sc0 ls0 ws0">allocated<span class="_"> </span>to<span class="_ _11"> </span>hold<span class="_"> </span>a<span class="_ _11"> </span>data<span class="_ _10"> </span>structure<span class="_ _11"> </span>that<span class="_"> </span>may<span class="_ _11"> </span>be<span class="_"> </span>read<span class="_ _11"> </span>from<span class="_ _10"> </span>or<span class="_ _11"> </span>stored<span class="_"> </span>into<span class="_ _11"> </span>an<span class="_ _10"> </span>SSE<span class="_ _11"> </span>register<span class="_"> </span>must<span class="_ _11"> </span>satisfy<span class="_"> </span>a</div><div class="t m5 x28 h2b y948 ff7 fs1e fc2 sc0 ls0 ws0">16-byte<span class="_"> </span>alignment.<span class="_"> </span>T<span class="_ _1"></span>his<span class="_"> </span>requirement<span class="_"> </span>has<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>two<span class="_"> </span>consequences:</div><div class="t m5 x56 h3d y2ced ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x57 h2b y2cee ff7 fs1e fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _11"> </span>starting<span class="_ _16"> </span>address<span class="_ _10"> </span>for<span class="_ _16"> </span>any<span class="_ _10"> </span>block<span class="_ _16"> </span>generated<span class="_ _11"> </span>by<span class="_ _11"> </span>a<span class="_ _11"> </span>memory<span class="_ _11"> </span>allocation<span class="_ _11"> </span>function<span class="_ _11"> </span>(<span class="ffd">alloca</span>,<span class="_ _16"> </span><span class="ffd">malloc</span>,</div><div class="t m5 x57 h2b y2cef ffd fs1e fc2 sc0 ls0 ws0">calloc<span class="ff7 ls181">,o<span class="_ _4a"></span>r<span class="ffd ls0">realloc<span class="ff7">)<span class="_"> </span>must<span class="_"> </span>be<span class="_"> </span>a<span class="_"> </span>multiple<span class="_"> </span>of<span class="_"> </span>16.</span></span></span></div><div class="t m5 x56 h3d y4ec ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x57 h2b y4ed ff7 fs1e fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>stack<span class="_"> </span>frame<span class="_ _13"> </span>for<span class="_"> </span>most<span class="_ _13"> </span>functions<span class="_"> </span>must<span class="_"> </span>be<span class="_ _13"> </span>aligned<span class="_"> </span>on<span class="_ _13"> </span>a<span class="_"> </span>16-byte<span class="_ _13"> </span>boundary<span class="_ _3"></span>.<span class="_"> </span>(T<span class="_ _1"></span>his<span class="_"> </span>requirement<span class="_ _13"> </span>has</div><div class="t m5 x57 h2b y4ee ff7 fs1e fc2 sc0 ls0 ws0">a<span class="_"> </span>number<span class="_"> </span>of<span class="_"> </span>exceptions<span class="_ _1"></span>.)</div><div class="t m5 x57 h2b y2cf0 ff7 fs1e fc2 sc0 ls0 ws0">More<span class="_"> </span>recent<span class="_ _11"> </span>versions<span class="_"> </span>of<span class="_ _11"> </span>x86-64<span class="_ _10"> </span>processors<span class="_ _11"> </span>implement<span class="_"> </span>the<span class="_ _11"> </span>A<span class="_ _7"></span>VX<span class="_"> </span>multimedia<span class="_ _11"> </span>instructions<span class="_ _1"></span>.<span class="_ _10"> </span>In<span class="_ _11"> </span>addi-</div><div class="t m5 x28 h2b y2cf1 ff7 fs1e fc2 sc0 ls0 ws0">tion<span class="_ _16"> </span>to<span class="_ _11"> </span>providing<span class="_ _16"> </span>a<span class="_ _16"> </span>superset<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>SSE<span class="_ _11"> </span>instructions<span class="_ _0"></span>,<span class="_ _16"> </span>processors<span class="_ _16"> </span>supporting<span class="_ _16"> </span>A<span class="_ _7"></span>VX<span class="_ _11"> </span>also<span class="_ _16"> </span>do<span class="_ _16"> </span>not<span class="_ _16"> </span>have<span class="_ _16"> </span>a</div><div class="t m5 x28 h2b y2cf2 ff7 fs1e fc2 sc0 ls0 ws0">mandatory<span class="_"> </span>alignment<span class="_"> </span>requirement.</div><div class="t m5 x75 h2d y2cf3 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _46"> </span>g;</div><div class="t m5 x75 h2d y2cf4 ffd fs1e fc2 sc0 ls0 ws0">char<span class="_ _3f"> </span>*h;</div><div class="t m5 x1d h2d y2cf5 ffd fs1e fc2 sc0 ls0 ws0">}<span class="_ _e"> </span>rec;</div><div class="t m5 x124 h26 y2cf6 ff7 fs19 fc2 sc0 ls0 ws0">A.<span class="_ _1f"> </span>What<span class="_"> </span>are<span class="_"> </span>the<span class="_"> </span>byte<span class="_"> </span>offsets<span class="_"> </span>of<span class="_"> </span>all<span class="_"> </span>the<span class="_"> </span>ﬁelds<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>structure?</div><div class="t m5 x124 h26 y2cf7 ff7 fs19 fc2 sc0 ls0 ws0">B<span class="_ _3"></span>.<span class="_ _1d"> </span>What<span class="_"> </span>is<span class="_"> </span>the<span class="_"> </span>total<span class="_"> </span>size<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>structure?</div><div class="t m5 x124 h26 y2cf8 ff7 fs19 fc2 sc0 ls0 ws0">C.<span class="_ _25"> </span>Rearrange<span class="_ _14"> </span>the<span class="_ _14"> </span>ﬁelds<span class="_ _14"> </span>of<span class="_ _15"> </span>the<span class="_ _14"> </span>structure<span class="_ _14"> </span>to<span class="_ _14"> </span>minimize<span class="_ _15"> </span>wasted<span class="_ _14"> </span>space<span class="_ _0"></span>,<span class="_ _15"> </span>and<span class="_ _14"> </span>then</div><div class="t m5 x4f h26 y2cf9 ff7 fs19 fc2 sc0 ls0 ws0">show<span class="_"> </span>the<span class="_"> </span>byte<span class="_"> </span>offsets<span class="_"> </span>and<span class="_"> </span>total<span class="_"> </span>size<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>rearranged<span class="_"> </span>structure<span class="_ _1"></span>.</div><div class="t m5 x1d h3b y2cfa fff fs24 fc6 sc0 ls0 ws0">3.10</div><div class="t m5 x1c4 h3e y2c5f ffe fs18 fc6 sc0 ls0 ws0">Combining<span class="_"> </span>Control<span class="_"> </span>and<span class="_"> </span>Data<span class="_"> </span>in</div><div class="t m5 x1c4 h3e y2cfb ffe fs18 fc6 sc0 ls0 ws0">Machine-Level<span class="_"> </span>Programs</div><div class="t m5 x1d h26 yec2 ff7 fs19 fc1 sc0 ls0 ws0">So<span class="_ _15"> </span>far,<span class="_ _21"> </span>we<span class="_ _21"> </span>have<span class="_ _15"> </span>looked<span class="_ _15"> </span>separately<span class="_ _21"> </span>at<span class="_ _15"> </span>how<span class="_ _21"> </span>machine-level<span class="_ _15"> </span>code<span class="_ _21"> </span>implements<span class="_ _15"> </span>the</div><div class="t m5 x1d h26 yec3 ff7 fs19 fc1 sc0 ls0 ws0">control<span class="_"> </span>aspects<span class="_ _11"> </span>of<span class="_ _11"> </span>a<span class="_ _11"> </span>program<span class="_ _11"> </span>and<span class="_ _11"> </span>how<span class="_"> </span>it<span class="_ _11"> </span>implements<span class="_ _11"> </span>different<span class="_ _11"> </span>data<span class="_ _11"> </span>structures<span class="_ _1"></span>.<span class="_ _11"> </span>In</div><div class="t m5 x1d h26 yec4 ff7 fs19 fc1 sc0 ls0 ws0">this<span class="_ _11"> </span>section,<span class="_ _16"> </span>we<span class="_ _11"> </span>look<span class="_ _11"> </span>at<span class="_ _16"> </span>ways<span class="_ _11"> </span>in<span class="_ _11"> </span>which<span class="_ _11"> </span>data<span class="_ _16"> </span>and<span class="_ _11"> </span>control<span class="_ _11"> </span>interact<span class="_ _16"> </span>with<span class="_ _11"> </span>each<span class="_ _11"> </span>other.</div><div class="t m5 x1d h26 yec5 ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_"> </span>start<span class="_"> </span>by<span class="_"> </span>taking<span class="_"> </span>a<span class="_"> </span>deep<span class="_"> </span>look<span class="_"> </span>into<span class="_"> </span>pointers<span class="_ _1"></span>,<span class="_"> </span>one<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>most<span class="_"> </span>important<span class="_"> </span>concepts</div><div class="t m5 x1d h26 yec6 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_"> </span>the<span class="_ _13"> </span>C<span class="_"> </span>programming<span class="_"> </span>language<span class="_ _1"></span>,<span class="_"> </span>but<span class="_ _13"> </span>one<span class="_"> </span>for<span class="_"> </span>which<span class="_ _13"> </span>many<span class="_"> </span>programmers<span class="_"> </span>only<span class="_ _13"> </span>have</div><div class="t m5 x1d h26 yec7 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_ _14"> </span>shallow<span class="_ _15"> </span>understanding.<span class="_ _16"> </span>W<span class="_ _1"></span>e<span class="_ _14"> </span>review<span class="_ _15"> </span>the<span class="_ _14"> </span>use<span class="_ _15"> </span>of<span class="_ _14"> </span>the<span class="_ _14"> </span>symbolic<span class="_ _15"> </span>debugger<span class="_ _15"> </span><span class="ff9">gdb<span class="_ _14"> </span></span>for</div><div class="t m5 x1d h26 yec8 ff7 fs19 fc1 sc0 ls0 ws0">examining<span class="_ _16"> </span>the<span class="_ _16"> </span>detailed<span class="_ _16"> </span>operation<span class="_ _11"> </span>of<span class="_ _16"> </span>machine-level<span class="_ _16"> </span>programs<span class="_ _1"></span>.<span class="_ _16"> </span>Next,<span class="_ _16"> </span>we<span class="_ _16"> </span>see<span class="_ _16"> </span>how</div><div class="t m5 x1d h26 yec9 ff7 fs19 fc1 sc0 ls0 ws0">understanding<span class="_ _14"> </span>machine-level<span class="_ _15"> </span>programs<span class="_ _14"> </span>enables<span class="_ _15"> </span>us<span class="_ _15"> </span>to<span class="_ _14"> </span>study<span class="_ _15"> </span>buffer<span class="_ _15"> </span>overﬂow<span class="_ _3"></span>,<span class="_ _15"> </span>an</div><div class="t m5 x1d h26 yeca ff7 fs19 fc1 sc0 ls0 ws0">important<span class="_"> </span>security<span class="_"> </span>vulnerability<span class="_"> </span>in<span class="_ _11"> </span>many<span class="_"> </span>real-world<span class="_"> </span>systems<span class="_ _1"></span>.<span class="_ _11"> </span>F<span class="_ _1"></span>inally<span class="_ _3"></span>,<span class="_"> </span>we<span class="_ _11"> </span>examine</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
