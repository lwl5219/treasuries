<div id="pf251" class="pf w2 h11" data-page-no="251"><div class="pc pc251 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg251.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">592<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>5<span class="_ _3d"> </span>Optimizing<span class="_ _10"> </span>Program<span class="_ _10"> </span>Performance</span></div><div class="t m5 x1f h2d y3829 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">/*<span class="_ _1f"> </span>Write<span class="_ _e"> </span>to<span class="_ _1f"> </span>dest,<span class="_ _1f"> </span>read<span class="_ _e"> </span>from<span class="_ _1f"> </span>src<span class="_ _e"> </span>*/</span></div><div class="t m5 x1f h2d y3aa2 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">void<span class="_ _1f"> </span>write_read(long<span class="_ _e"> </span>*src,<span class="_ _1f"> </span>long<span class="_ _1f"> </span>*dst,<span class="_ _e"> </span>long<span class="_ _1f"> </span>n)</span></div><div class="t m5 x1f h2d y3aa3 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x1f h2d y3aa4 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>cnt<span class="_ _1f"> </span>=<span class="_ _1f"> </span>n;</span></div><div class="t m5 x1f h2d y3aa5 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _20"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>val<span class="_ _1f"> </span>=<span class="_ _1f"> </span>0;</span></div><div class="t m5 x1f h2e y3aa6 ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 x1f h2e y4fd0 ff6 fs20 fc6 sc0 ls0 ws0">7</div><div class="t m5 x33 h2d y3aa7 ffd fs1e fc2 sc0 ls0 ws0">while<span class="_ _e"> </span>(cnt)<span class="_ _1f"> </span>{</div><div class="t m5 x1f h2d y3aa8 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _70"> </span><span class="ffd fs1e fc2">*dst<span class="_ _e"> </span>=<span class="_ _1f"> </span>val;</span></div><div class="t m5 x1f h2d y3aa9 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _70"> </span><span class="ffd fs1e fc2">val<span class="_ _e"> </span>=<span class="_ _1f"> </span>(*src)+1;</span></div><div class="t m5 x1b0 h2d y3aaa ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _70"> </span><span class="ffd fs1e fc2">cnt--;</span></div><div class="t m5 x1b0 h2d y3aab ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1b0 h2d y3aac ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 xcc h3f y4fd1 ff6e fs27 fc1 sc0 ls0 ws0">Initial</div><div class="t m5 x1d h3f y4fd2 ff6e fs27 fc1 sc0 ls0 ws0">Example A:</div><div class="t m5 x33 h40 y4fd3 ff6f fs8a fc1 sc0 ls0 ws0"> <span class="ff70 fs28">write_read(&amp;a[0],&amp;a[1],3)</span></div><div class="t m5 x1a6 h3f y4fd4 ff6f fs27 fc1 sc0 ls0 ws0">3</div><div class="t m5 x29 h40 y4fd5 ff70 fs28 fc1 sc0 ls0 ws0">cnt</div><div class="t m5 x127 h40 y4fd6 ff70 fs28 fc1 sc0 ls0 ws0">a</div><div class="t m5 x29 h40 y4fd7 ff70 fs28 fc1 sc0 ls0 ws0">val</div><div class="t m5 x1a6 h3f y4fd8 ff6f fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 x1b7 h3f y4fd9 ff24 fs27 fc1 sc0 ls0 ws0"><span class="ff6f">10<span class="_ _b0"> </span>17</span></div><div class="t m5 xe5 h3f y4fda ff6e fs27 fc1 sc0 ls0 ws0">Iter<span class="_ _1"></span>. 1</div><div class="t m5 x186 h3f y4fdb ff6f fs27 fc1 sc0 ls0 ws0">2</div><div class="t m5 xe4 h3f y4fdc ff24 fs27 fc1 sc0 ls0 ws0"><span class="ff6f">9</span></div><div class="t m5 x115 h3f y4fdd ff24 fs27 fc1 sc0 ls0 ws0"><span class="ff6f">10<span class="_ _3e"> </span>0</span></div><div class="t m5 x13d h3f y4fde ff6e fs27 fc1 sc0 ls0 ws0">Iter<span class="_ _1"></span>. 2</div><div class="t m5 x1e7 h3f y4fdf ff6f fs27 fc1 sc0 ls0 ws0">1</div><div class="t m5 x1e2 h3f y4fe0 ff24 fs27 fc1 sc0 ls0 ws0"><span class="ff6f">9</span></div><div class="t m5 x130 h3f y4fe1 ff24 fs27 fc1 sc0 ls0 ws0"><span class="ff6f">10<span class="_ _3b"> </span></span><span class="ff6f">9</span></div><div class="t m5 x1e8 h3f y4fe2 ff6e fs27 fc1 sc0 ls0 ws0">Iter<span class="_ _1"></span>. 3</div><div class="t m5 x9 h3f y4fe3 ff6f fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 x108 h3f y4fe4 ff24 fs27 fc1 sc0 ls0 ws0"><span class="ff6f">9</span></div><div class="t m5 x6a h3f y4fe5 ff24 fs27 fc1 sc0 ls0 ws0"><span class="ff6f">10<span class="_ _3b"> </span></span><span class="ff6f">9</span></div><div class="t m5 xcc h3f y4fe6 ff6e fs27 fc1 sc0 ls0 ws0">Initial</div><div class="t m5 x1d h3f y4fe7 ff6e fs27 fc1 sc0 ls0 ws0">Example B:</div><div class="t m5 x33 h40 y4fe8 ff6f fs8a fc1 sc0 ls0 ws0"> <span class="ff70 fs28">write_read(&amp;a[0],&amp;a[0],3)</span></div><div class="t m5 x1a6 h3f y4fe9 ff6f fs27 fc1 sc0 ls0 ws0">3</div><div class="t m5 x29 h40 y4fea ff70 fs28 fc1 sc0 ls0 ws0">cnt</div><div class="t m5 x127 h40 y4feb ff70 fs28 fc1 sc0 ls0 ws0">a</div><div class="t m5 x29 h40 y4fec ff70 fs28 fc1 sc0 ls0 ws0">val</div><div class="t m5 x1a6 h3f y4fed ff6f fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 x1b7 h3f y4fee ff24 fs27 fc1 sc0 ls0 ws0"><span class="ff6f">10<span class="_ _b0"> </span>17</span></div><div class="t m5 xe5 h3f y4fef ff6e fs27 fc1 sc0 ls0 ws0">Iter<span class="_ _1"></span>. 1</div><div class="t m5 x186 h3f y4ff0 ff6f fs27 fc1 sc0 ls0 ws0">2</div><div class="t m5 x186 h3f y4ff1 ff6f fs27 fc1 sc0 ls0 ws0">1</div><div class="t m5 xe2 h3f y4ff2 ff6f fs27 fc1 sc0 ls223 ws0">01<span class="_ _af"></span>7</div><div class="t m5 x13d h3f y4ff3 ff6e fs27 fc1 sc0 ls0 ws0">Iter<span class="_ _1"></span>. 2</div><div class="t m5 xf4 h3f y4ff4 ff6f fs27 fc1 sc0 ls0 ws0">1</div><div class="t m5 x1e7 h3f y4ff5 ff6f fs27 fc1 sc0 ls0 ws0">2</div><div class="t m5 x215 h3f y4ff6 ff6f fs27 fc1 sc0 ls224 ws0">11<span class="_ _af"></span>7</div><div class="t m5 x1e8 h3f y4ff7 ff6e fs27 fc1 sc0 ls0 ws0">Iter<span class="_ _1"></span>. 3</div><div class="t m5 x11b h3f y4ff8 ff6f fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 x9 h3f y4ff9 ff6f fs27 fc1 sc0 ls0 ws0">3</div><div class="t m5 x1f8 h3f y4ffa ff6f fs27 fc1 sc0 ls225 ws0">21<span class="_ _af"></span>7</div><div class="t m5 x1d h2f y4ffb ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _14"> </span>5.33<span class="_ _c"> </span><span class="fc1">Code<span class="_ _15"> </span>to<span class="_ _15"> </span>write<span class="_ _15"> </span>and<span class="_ _14"> </span>read<span class="_ _15"> </span>memory<span class="_ _15"> </span>locations,<span class="_ _21"> </span>along<span class="_ _15"> </span>with<span class="_ _15"> </span>illustrative</span></div><div class="t m5 x1d h34 y4ffc ffe fs16 fc1 sc0 ls0 ws0">executions.<span class="_ _16"> </span><span class="ff6">This<span class="_ _16"> </span>function<span class="_ _14"> </span>highlights<span class="_ _16"> </span>the<span class="_ _16"> </span>interactions<span class="_ _16"> </span>between<span class="_ _14"> </span>stores<span class="_ _16"> </span>and<span class="_ _16"> </span>loads<span class="_ _14"> </span>when</span></div><div class="t m5 x1d h34 y4ffd ff6 fs16 fc1 sc0 ls0 ws0">arguments</div><div class="t m5 x145 h3a y4ffe ffd fs19 fc1 sc0 ls0 ws0">src<span class="_ _10"> </span><span class="ff6 fs16">and<span class="_ _11"> </span></span>dest<span class="_ _10"> </span><span class="ff6 fs16">are<span class="_ _10"> </span>equal.</span></div><div class="t m5 x1d h26 y450f ff7 fs19 fc1 sc0 ls0 ws0">illustrates<span class="_ _15"> </span>the<span class="_ _15"> </span>potential<span class="_ _15"> </span>interactions<span class="_ _15"> </span>between<span class="_ _21"> </span>loads<span class="_ _15"> </span>and<span class="_ _15"> </span>stores<span class="_ _1"></span>.<span class="_ _15"> </span>This<span class="_ _14"> </span>ﬁgure<span class="_ _15"> </span>also</div><div class="t m5 x1d h26 y4510 ff7 fs19 fc1 sc0 ls0 ws0">shows<span class="_ _13"> </span>two<span class="_ _13"> </span>example<span class="_ _13"> </span>executions<span class="_ _13"> </span>of<span class="_ _13"> </span>this<span class="_ _13"> </span>function,<span class="_ _13"> </span>when<span class="_ _13"> </span>it<span class="_ _13"> </span>is<span class="_ _13"> </span>called<span class="_ _13"> </span>for<span class="_ _13"> </span>a<span class="_ _13"> </span>two-element</div><div class="t m5 x1d h46 y4511 ff7 fs19 fc1 sc0 ls0 ws0">array<span class="_ _13"> </span><span class="ffd">a</span>,<span class="_"> </span>with<span class="_ _13"> </span>initial<span class="_ _13"> </span>contents<span class="_ _13"> </span><span class="ff12">−</span><span class="ls77">10<span class="_"> </span>and<span class="_ _13"> </span>17,<span class="_ _13"> </span>and<span class="_"> </span>with<span class="_ _13"> </span>argument<span class="_ _13"> </span></span><span class="ffd">cnt<span class="_ _13"> </span></span>equal<span class="_"> </span>to<span class="_ _13"> </span>3.<span class="_ _13"> </span>T<span class="_ _0"></span>hese</div><div class="t m5 x1d h26 y4512 ff7 fs19 fc1 sc0 ls0 ws0">executions<span class="_"> </span>illustrate<span class="_"> </span>some<span class="_"> </span>subtleties<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>load<span class="_"> </span>and<span class="_"> </span>store<span class="_"> </span>operations<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y4513 ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _15"> </span>Example<span class="_ _15"> </span>A<span class="_ _15"> </span>of<span class="_ _15"> </span>F<span class="_ _1"></span>igure<span class="_ _15"> </span>5.33,<span class="_ _21"> </span>argument<span class="_ _21"> </span><span class="ffd">src<span class="_ _15"> </span></span>is<span class="_ _15"> </span>a<span class="_ _15"> </span>pointer<span class="_ _15"> </span>to<span class="_ _15"> </span>array<span class="_ _15"> </span>element</div><div class="t m5 x1d h26 y4514 ffd fs19 fc1 sc0 ls0 ws0">a[0]<span class="ff7">,<span class="_"> </span>while<span class="_"> </span></span>dest<span class="_ _13"> </span><span class="ff7">is<span class="_"> </span>a<span class="_"> </span>pointer<span class="_ _13"> </span>to<span class="_"> </span>array<span class="_"> </span>element<span class="_"> </span></span>a[1]<span class="ff7">.<span class="_ _13"> </span>In<span class="_"> </span>this<span class="_"> </span>case<span class="_ _1"></span>,<span class="_"> </span>each<span class="_"> </span>load<span class="_ _13"> </span>by<span class="_"> </span>the</span></div><div class="t m5 x1d h46 y4515 ff7 fs19 fc1 sc0 ls0 ws0">pointer<span class="_ _f"> </span>reference<span class="_ _e"> </span><span class="ffd">*src<span class="_ _f"> </span></span>will<span class="_ _e"> </span>yield<span class="_ _f"> </span>the<span class="_ _e"> </span>value<span class="_ _f"> </span><span class="ff12">−</span><span class="ls3b">10.<span class="_ _e"> </span>Hence<span class="_ _1"></span>,<span class="_ _1f"> </span>after<span class="_ _f"> </span>two<span class="_ _e"> </span>iterations<span class="_ _3"></span>,</span></div><div class="t m5 x1d h46 y4516 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _f"> </span>array<span class="_ _e"> </span>elements<span class="_ _21"> </span>will<span class="_ _e"> </span>remain<span class="_ _21"> </span>ﬁxed<span class="_ _e"> </span>at<span class="_ _21"> </span><span class="ff12">−</span>10<span class="_ _e"> </span>and<span class="_ _f"> </span><span class="ff12">−</span><span class="ls17">9,<span class="_ _e"> </span>respectively<span class="_ _3"></span>.<span class="_ _f"> </span>The<span class="_ _21"> </span>result</span></div><div class="t m5 x1d h26 y4517 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span>the<span class="_ _13"> </span>read<span class="_"> </span>from<span class="_"> </span><span class="ffd">src<span class="_ _10"> </span></span>is<span class="_ _13"> </span>not<span class="_"> </span>affected<span class="_"> </span>by<span class="_"> </span>the<span class="_ _13"> </span>write<span class="_"> </span>to<span class="_"> </span><span class="ffd">dest</span>.<span class="_ _13"> </span>Measuring<span class="_"> </span>this<span class="_"> </span>example</div><div class="t m5 x1d h26 y4518 ff7 fs19 fc1 sc0 ls0 ws0">over<span class="_"> </span>a<span class="_"> </span>larger<span class="_"> </span>number<span class="_"> </span>of<span class="_"> </span>iterations<span class="_"> </span>gives<span class="_"> </span>a<span class="_"> </span>CPE<span class="_"> </span>of<span class="_"> </span>1.3.</div><div class="t m5 x29 h26 y4519 ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _16"> </span>Example<span class="_ _16"> </span>B<span class="_ _16"> </span>of<span class="_ _16"> </span>F<span class="_ _1"></span>igure<span class="_ _16"> </span>5.33,<span class="_ _16"> </span>both<span class="_ _16"> </span>arguments<span class="_ _16"> </span><span class="ffd">src<span class="_ _16"> </span></span>and<span class="_ _16"> </span><span class="ffd">dest<span class="_ _16"> </span></span>are<span class="_ _16"> </span>pointers<span class="_ _16"> </span>to</div><div class="t m5 x1d h26 y451a ff7 fs19 fc1 sc0 ls0 ws0">array<span class="_ _15"> </span>element<span class="_ _14"> </span><span class="ffd">a[0]</span>.<span class="_ _15"> </span>In<span class="_ _15"> </span>this<span class="_ _15"> </span>case,<span class="_ _15"> </span>each<span class="_ _15"> </span>load<span class="_ _14"> </span>by<span class="_ _15"> </span>the<span class="_ _15"> </span>pointer<span class="_ _15"> </span>reference<span class="_ _15"> </span><span class="ffd">*src<span class="_ _15"> </span></span>will</div><div class="t m5 x1d h26 y451b ff7 fs19 fc1 sc0 ls0 ws0">yield<span class="_ _11"> </span>the<span class="_ _11"> </span>value<span class="_ _16"> </span>stored<span class="_"> </span>by<span class="_ _16"> </span>the<span class="_ _11"> </span>previous<span class="_ _11"> </span>execution<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_"> </span>pointer<span class="_ _16"> </span>reference<span class="_ _11"> </span><span class="ffd">*dest</span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
