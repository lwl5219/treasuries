<div id="pf40e" class="pf w2 h11" data-page-no="40e"><div class="pc pc40e w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg40e.png"/><div class="t m5 x69 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>12.5<span class="_ _60"> </span>Synchronizing<span class="_ _10"> </span>Threads<span class="_ _10"> </span>with<span class="_ _10"> </span>Semaphores<span class="_ _3e"> </span><span class="ffe fs1e">1037</span></div><div class="t m5 x17 h2f ye7 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>12.21</div><div class="t m5 x17 h2f y58a ffe fs16 fc1 sc0 ls0 ws0">Safe<span class="_ _f"> </span>and<span class="_ _f"> </span>unsafe</div><div class="t m5 x17 h34 y58b ffe fs16 fc1 sc0 ls0 ws0">trajectories.<span class="_ _f"> </span><span class="ff6">The</span></div><div class="t m5 x17 h34 y58c ff6 fs16 fc1 sc0 ls0 ws0">intersection<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>critical</div><div class="t m5 x17 h34 y58d ff6 fs16 fc1 sc0 ls0 ws0">regions<span class="_ _16"> </span>forms<span class="_ _16"> </span>an<span class="_ _16"> </span>unsafe</div><div class="t m5 x17 h34 y58e ff6 fs16 fc1 sc0 ls0 ws0">region.<span class="_ _16"> </span>T<span class="_ _3"></span>rajectories<span class="_ _16"> </span>that</div><div class="t m5 x17 h34 y58f ff6 fs16 fc1 sc0 ls0 ws0">skirt<span class="_ _16"> </span>the<span class="_ _14"> </span>unsafe<span class="_ _14"> </span>region</div><div class="t m5 x17 h34 y8d9 ff6 fs16 fc1 sc0 ls0 ws0">correctly<span class="_ _15"> </span>update<span class="_ _15"> </span>the</div><div class="t m5 x17 h34 y8da ff6 fs16 fc1 sc0 ls0 ws0">counter<span class="_ _10"> </span>variable.</div><div class="t m5 x1e6 h3f y81c1 ffed fs27 fc1 sc0 ls0 ws0">Thread 2</div><div class="t m5 x8f h3f y81c2 ffed fs27 fc1 sc0 ls0 ws0">Critical</div><div class="t m5 x8f h3f y81c3 ffed fs27 fc1 sc0 ls0 ws0">section</div><div class="t m5 xb3 h3f y81c4 ffed fs27 fc1 sc0 ls0 ws0">wrt </div><div class="t m5 x10e h40 y81c5 ffef fs28 fc1 sc0 ls0 ws0">cnt</div><div class="t m5 x92 h40 y81c6 ffed fs27 fc1 sc0 ls0 ws0">Critical section wrt <span class="ffef fs28">cnt</span></div><div class="t m5 x96 h3f y81c7 ffed fs27 fc1 sc0 ls0 ws0">Thread 1</div><div class="t m5 xe1 h3f y81c8 ffee fs27 fc1 sc0 ls0 ws0">T</div><div class="t m5 x9f h65 y81c9 ffed fs38 fc1 sc0 ls0 ws0">2</div><div class="t m5 x143 h3f y81ca ffee fs27 fc1 sc0 ls0 ws0">S</div><div class="t m5 x9f h65 y81cb ffed fs38 fc1 sc0 ls0 ws0">2</div><div class="t m5 x143 h3f y81cc ffee fs27 fc1 sc0 ls0 ws0">U</div><div class="t m5 x9e h65 y81cd ffed fs38 fc1 sc0 ls0 ws0">2</div><div class="t m5 xe1 h3f y81ce ffee fs27 fc1 sc0 ls0 ws0">L</div><div class="t m5 x9f h65 y81cf ffed fs38 fc1 sc0 ls0 ws0">2</div><div class="t m5 x143 h3f y81d0 ffee fs27 fc1 sc0 ls0 ws0">H</div><div class="t m5 x9e h65 y81d1 ffed fs38 fc1 sc0 ls0 ws0">2</div><div class="t m5 xa7 h3f y81d2 ffee fs27 fc1 sc0 ls0 ws0">H</div><div class="t m5 x119 h65 y81d3 ffed fs38 fc1 sc0 ls0 ws0">1</div><div class="t m5 xb1 h3f y81d2 ffee fs27 fc1 sc0 ls0 ws0">L</div><div class="t m5 x1db h65 y81d3 ffed fs38 fc1 sc0 ls0 ws0">1</div><div class="t m5 x42 h3f y81d2 ffee fs27 fc1 sc0 ls0 ws0">U</div><div class="t m5 x19a h65 y81d3 ffed fs38 fc1 sc0 ls0 ws0">1</div><div class="t m5 x84 h3f y81d2 ffee fs27 fc1 sc0 ls0 ws0">S</div><div class="t m5 xf2 h65 y81d3 ffed fs38 fc1 sc0 ls0 ws0">1</div><div class="t m5 x147 h3f y81d2 ffee fs27 fc1 sc0 ls0 ws0">T</div><div class="t m5 x1e1 h65 y81d3 ffed fs38 fc1 sc0 ls0 ws0">1</div><div class="t m5 x199 h3f y81d4 ffed fs27 fc1 sc0 ls0 ws0">Unsafe region</div><div class="t m5 x1cf h3f y81d5 ffed fs27 fc1 sc0 ls0 ws0">Unsafe</div><div class="t m5 x1cf h3f y81d6 ffed fs27 fc1 sc0 ls0 ws0">trajectory</div><div class="t m5 xb8 h3f y81d7 ffed fs27 fc1 sc0 ls0 ws0">Safe trajectory</div><div class="t m5 x17 h47 y81d8 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>12.8<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>1074)</span></div><div class="t m5 x17 h26 y81d9 ff7 fs19 fc1 sc0 ls0 ws0">Using<span class="_ _15"> </span>the<span class="_ _15"> </span>progress<span class="_ _15"> </span>graph<span class="_ _21"> </span>in<span class="_ _15"> </span>F<span class="_ _0"></span>igure<span class="_ _15"> </span>12.21,<span class="_ _21"> </span>classify<span class="_ _21"> </span>the<span class="_ _15"> </span>following<span class="_ _15"> </span>trajectories<span class="_ _15"> </span>as</div><div class="t m5 x17 h26 y81da ff7 fs19 fc1 sc0 ls0 ws0">either<span class="_"> </span><span class="ffa">safe<span class="_"> </span></span>or<span class="_"> </span><span class="ffa">unsafe</span>.</div><div class="t m5 x34 h26 y81db ff7 fs19 fc1 sc0 ls0 ws0">A.<span class="_ _1f"> </span><span class="ff11">H</span></div><div class="t m5 x77 h3c y81dc ff7 fs25 fc1 sc0 ls0 ws0">1</div><div class="t m5 x188 h45 y81dd ff11 fs19 fc1 sc0 ls42 ws0">,L</div><div class="t m5 x1c5 h3c y81dc ff7 fs25 fc1 sc0 ls0 ws0">1</div><div class="t m5 x1ef h45 y81dd ff11 fs19 fc1 sc0 ls42 ws0">,U</div><div class="t m5 xcf h3c y81dc ff7 fs25 fc1 sc0 ls0 ws0">1</div><div class="t m5 x17e h45 y81dd ff11 fs19 fc1 sc0 ls42 ws0">,S</div><div class="t m5 x10c h3c y81dc ff7 fs25 fc1 sc0 ls0 ws0">1</div><div class="t m5 xad h45 y81dd ff11 fs19 fc1 sc0 ls42 ws0">,H</div><div class="t m5 x64 h3c y81dc ff7 fs25 fc1 sc0 ls0 ws0">2</div><div class="t m5 x17f h45 y81dd ff11 fs19 fc1 sc0 ls42 ws0">,L</div><div class="t m5 x18e h3c y81dc ff7 fs25 fc1 sc0 ls0 ws0">2</div><div class="t m5 x112 h45 y81dd ff11 fs19 fc1 sc0 ls42 ws0">,U</div><div class="t m5 x137 h3c y81dc ff7 fs25 fc1 sc0 ls0 ws0">2</div><div class="t m5 x8f h45 y81dd ff11 fs19 fc1 sc0 ls42 ws0">,S</div><div class="t m5 x47 h3c y81dc ff7 fs25 fc1 sc0 ls0 ws0">2</div><div class="t m5 x91 h45 y81dd ff11 fs19 fc1 sc0 ls42 ws0">,T</div><div class="t m5 x116 h3c y81dc ff7 fs25 fc1 sc0 ls0 ws0">2</div><div class="t m5 x90 h45 y81dd ff11 fs19 fc1 sc0 ls42 ws0">,T</div><div class="t m5 x143 h3c y81dc ff7 fs25 fc1 sc0 ls0 ws0">1</div><div class="t m5 x34 h26 y81de ff7 fs19 fc1 sc0 ls2a ws0">B.<span class="_ _66"> </span><span class="ff11 ls0">H</span></div><div class="t m5 x77 h3c y81df ff7 fs25 fc1 sc0 ls0 ws0">2</div><div class="t m5 x30 h45 y81de ff11 fs19 fc1 sc0 ls42 ws0">,L</div><div class="t m5 xd0 h3c y81df ff7 fs25 fc1 sc0 ls0 ws0">2</div><div class="t m5 x74 h45 y81de ff11 fs19 fc1 sc0 ls42 ws0">,H</div><div class="t m5 x126 h3c y81df ff7 fs25 fc1 sc0 ls0 ws0">1</div><div class="t m5 x1d5 h45 y81de ff11 fs19 fc1 sc0 ls42 ws0">,L</div><div class="t m5 x23 h3c y81df ff7 fs25 fc1 sc0 ls0 ws0">1</div><div class="t m5 x127 h45 y81de ff11 fs19 fc1 sc0 ls42 ws0">,U</div><div class="t m5 x22b h3c y81df ff7 fs25 fc1 sc0 ls0 ws0">1</div><div class="t m5 x66 h45 y81de ff11 fs19 fc1 sc0 ls42 ws0">,S</div><div class="t m5 x1c6 h3c y81df ff7 fs25 fc1 sc0 ls0 ws0">1</div><div class="t m5 x112 h45 y81de ff11 fs19 fc1 sc0 ls42 ws0">,T</div><div class="t m5 x50 h3c y81df ff7 fs25 fc1 sc0 ls0 ws0">1</div><div class="t m5 x1af h45 y81de ff11 fs19 fc1 sc0 ls42 ws0">,U</div><div class="t m5 x47 h3c y81df ff7 fs25 fc1 sc0 ls0 ws0">2</div><div class="t m5 x91 h45 y81de ff11 fs19 fc1 sc0 ls42 ws0">,S</div><div class="t m5 x117 h3c y81df ff7 fs25 fc1 sc0 ls0 ws0">2</div><div class="t m5 xe2 h45 y81de ff11 fs19 fc1 sc0 ls42 ws0">,T</div><div class="t m5 x192 h3c y81df ff7 fs25 fc1 sc0 ls0 ws0">2</div><div class="t m5 x34 h26 y81e0 ff7 fs19 fc1 sc0 ls22 ws0">C.<span class="_ _24"> </span><span class="ff11 ls0">H</span></div><div class="t m5 x77 h3c y81e1 ff7 fs25 fc1 sc0 ls0 ws0">1</div><div class="t m5 x188 h45 y81e0 ff11 fs19 fc1 sc0 ls42 ws0">,H</div><div class="t m5 x1d6 h3c y81e1 ff7 fs25 fc1 sc0 ls0 ws0">2</div><div class="t m5 x1a7 h45 y81e0 ff11 fs19 fc1 sc0 ls42 ws0">,L</div><div class="t m5 x10b h3c y81e1 ff7 fs25 fc1 sc0 ls0 ws0">2</div><div class="t m5 x1d5 h45 y81e0 ff11 fs19 fc1 sc0 ls42 ws0">,U</div><div class="t m5 xad h3c y81e1 ff7 fs25 fc1 sc0 ls0 ws0">2</div><div class="t m5 x207 h45 y81e0 ff11 fs19 fc1 sc0 ls42 ws0">,S</div><div class="t m5 x214 h3c y81e1 ff7 fs25 fc1 sc0 ls0 ws0">2</div><div class="t m5 x1b7 h45 y81e0 ff11 fs19 fc1 sc0 ls42 ws0">,L</div><div class="t m5 x129 h3c y81e1 ff7 fs25 fc1 sc0 ls0 ws0">1</div><div class="t m5 x1f7 h45 y81e0 ff11 fs19 fc1 sc0 ls42 ws0">,U</div><div class="t m5 x1a6 h3c y81e1 ff7 fs25 fc1 sc0 ls0 ws0">1</div><div class="t m5 xf8 h45 y81e0 ff11 fs19 fc1 sc0 ls42 ws0">,S</div><div class="t m5 x5d h3c y81e1 ff7 fs25 fc1 sc0 ls0 ws0">1</div><div class="t m5 x91 h45 y81e0 ff11 fs19 fc1 sc0 ls42 ws0">,T</div><div class="t m5 x116 h3c y81e1 ff7 fs25 fc1 sc0 ls0 ws0">1</div><div class="t m5 xe2 h45 y81e0 ff11 fs19 fc1 sc0 ls42 ws0">,T</div><div class="t m5 x192 h3c y81e1 ff7 fs25 fc1 sc0 ls0 ws0">2</div><div class="t m5 x17 h41 y81e2 ffe fs29 fc1 sc0 ls0 ws0">12.5.2<span class="_ _48"> </span><span class="fs19">Semaphores</span></div><div class="t m5 x17 h26 y81e3 ff7 fs19 fc1 sc0 ls0 ws0">Edsger<span class="_ _6"> </span>Dijkstra,<span class="_ _13"> </span>a<span class="_ _a"> </span>pioneer<span class="_ _6"> </span>of<span class="_ _6"> </span>concurrent<span class="_ _6"> </span>programming,<span class="_ _13"> </span>proposed<span class="_ _a"> </span>a<span class="_ _6"> </span>classic<span class="_ _6"> </span>solution</div><div class="t m5 x17 h26 y81e4 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _16"> </span>the<span class="_ _14"> </span>problem<span class="_ _14"> </span>of<span class="_ _16"> </span>synchronizing<span class="_ _14"> </span>different<span class="_ _14"> </span>execution<span class="_ _16"> </span>threads<span class="_ _14"> </span>based<span class="_ _14"> </span>on<span class="_ _16"> </span>a<span class="_ _14"> </span>special</div><div class="t m5 x17 h26 y81e5 ff7 fs19 fc1 sc0 ls0 ws0">type<span class="_ _16"> </span>of<span class="_ _11"> </span>variable<span class="_ _16"> </span>called<span class="_ _16"> </span>a<span class="_ _11"> </span><span class="ffa">semaphore<span class="_ _2"></span></span>.<span class="_ _11"> </span>A<span class="_ _16"> </span>semaphore<span class="_ _0"></span>,<span class="_ _16"> </span><span class="ff11">s<span class="_ _2"></span></span>,<span class="_ _14"> </span>is<span class="_ _16"> </span>a<span class="_ _11"> </span>global<span class="_ _16"> </span>variable<span class="_ _16"> </span>with<span class="_ _11"> </span>a</div><div class="t m5 x17 h26 y81e6 ff7 fs19 fc1 sc0 ls0 ws0">nonnegative<span class="_ _13"> </span>integer<span class="_ _6"> </span>value<span class="_ _13"> </span>that<span class="_ _13"> </span>can<span class="_ _13"> </span>only<span class="_ _6"> </span>be<span class="_ _13"> </span>manipulated<span class="_ _13"> </span>by<span class="_ _6"> </span>two<span class="_ _13"> </span>special<span class="_ _13"> </span>operations<span class="_ _3"></span>,</div><div class="t m5 x17 h26 y81e7 ff7 fs19 fc1 sc0 ls0 ws0">called<span class="_"> </span><span class="ff11">P<span class="_ _21"> </span></span>and<span class="_"> </span><span class="ff11">V<span class="_ _13"> </span></span>:</div><div class="t m5 x72 h26 y81e8 ff11 fs19 fc1 sc0 ls2f3 ws0">P(<span class="_ _4"></span>s<span class="_ _3"></span>)<span class="_ _4"></span><span class="ff7 ls2c6">:I<span class="_ _41"></span>f<span class="_ _3"></span><span class="ff11 ls0">s<span class="_ _e"> </span><span class="ff7">is<span class="_ _15"> </span>nonzero<span class="_ _1"></span>,<span class="_ _f"> </span>then<span class="_ _21"> </span><span class="ff11">P<span class="_ _22"> </span></span>decrements<span class="_ _21"> </span><span class="ff11">s<span class="_ _e"> </span></span>and<span class="_ _15"> </span>returns<span class="_ _21"> </span>immediately<span class="_ _3"></span>.<span class="_ _15"> </span>If<span class="_ _21"> </span><span class="ff11">s<span class="_ _e"> </span></span>is</span></span></span></div><div class="t m5 x30 h26 y81e9 ff7 fs19 fc1 sc0 ls0 ws0">zero<span class="_ _1"></span>,<span class="_ _11"> </span>then<span class="_"> </span>suspend<span class="_ _11"> </span>the<span class="_"> </span>thread<span class="_ _11"> </span>until<span class="_"> </span><span class="ff11">s<span class="_"> </span></span>becomes<span class="_"> </span>nonzero<span class="_ _11"> </span>and<span class="_"> </span>the<span class="_"> </span>thread<span class="_ _11"> </span>is</div><div class="t m5 x30 h26 y81ea ff7 fs19 fc1 sc0 ls0 ws0">restarted<span class="_"> </span>by<span class="_ _13"> </span>a<span class="_"> </span><span class="ff11">V<span class="_ _21"> </span></span>operation.<span class="_"> </span>After<span class="_ _13"> </span>restarting,<span class="_"> </span>the<span class="_ _13"> </span><span class="ff11">P<span class="_ _15"> </span></span>operation<span class="_"> </span>decrements</div><div class="t m5 x30 h26 y81eb ff11 fs19 fc1 sc0 ls0 ws0">s<span class="_"> </span><span class="ff7">and<span class="_"> </span>returns<span class="_"> </span>control<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>caller<span class="_ _1"></span>.</span></div><div class="t m5 x62 h26 y81ec ff11 fs19 fc1 sc0 ls2f4 ws0">V(<span class="_ _8"></span>s<span class="_ _7"></span>)<span class="_ _8"></span><span class="ff7 ls2c6">:T<span class="_ _c4"></span>h<span class="_ _41"></span>e<span class="_ _42"></span><span class="ff11 ls0">V<span class="_ _14"> </span><span class="ff7">operation<span class="_ _13"> </span>increments<span class="_ _6"> </span></span>s<span class="_ _10"> </span><span class="ff7">by<span class="_ _13"> </span>1.<span class="_ _6"> </span>If<span class="_ _6"> </span>there<span class="_ _13"> </span>are<span class="_ _6"> </span>any<span class="_ _13"> </span>threads<span class="_ _6"> </span>blocked<span class="_ _13"> </span>at<span class="_ _6"> </span>a<span class="_ _13"> </span></span>P</span></span></div><div class="t m5 x30 h26 y81ed ff7 fs19 fc1 sc0 ls0 ws0">operation<span class="_ _13"> </span>waiting<span class="_"> </span>for<span class="_ _13"> </span><span class="ff11">s<span class="_ _16"> </span></span>to<span class="_ _13"> </span>become<span class="_"> </span>nonzero<span class="_ _1"></span>,<span class="_"> </span>then<span class="_ _13"> </span>the<span class="_"> </span><span class="ff11">V<span class="_ _15"> </span></span>operation<span class="_"> </span>restarts</div><div class="t m5 x30 h26 y81ee ff7 fs19 fc1 sc0 ls0 ws0">exactly<span class="_ _14"> </span>one<span class="_ _15"> </span>of<span class="_ _14"> </span>these<span class="_ _15"> </span>threads<span class="_ _1"></span>,<span class="_ _15"> </span>which<span class="_ _15"> </span>then<span class="_ _15"> </span>completes<span class="_ _14"> </span>its<span class="_ _15"> </span><span class="ff11">P<span class="_ _1f"> </span></span>operation<span class="_ _14"> </span>by</div><div class="t m5 x30 h26 y81ef ff7 fs19 fc1 sc0 ls0 ws0">decrementing<span class="_"> </span><span class="ff11">s<span class="_ _2"></span></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
