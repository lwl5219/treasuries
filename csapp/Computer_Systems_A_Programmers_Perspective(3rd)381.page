<div id="pf17d" class="pf w2 h11" data-page-no="17d"><div class="pc pc17d w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg17d.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">380<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x1f h2d ye7 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L3:<span class="_ _166"> </span></span><span class="ff2d fs35">loop:</span></div><div class="t m5 x1f h2d yc4d ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">imulq<span class="_ _3f"> </span>(%rdi),<span class="_ _e"> </span>%rax<span class="_ _d0"> </span></span><span class="ff13 fs35">result<span class="_ _21"> </span>*=<span class="_ _e"> </span>ptr-&gt;v</span></div><div class="t m5 x1f h2d yecb ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>2(%rdi),<span class="_ _e"> </span>%rdi<span class="_ _6c"> </span></span><span class="ff13 fs35">ptr<span class="_ _f"> </span>=<span class="_ _f"> </span>ptr-&gt;p</span></div><div class="t m5 x1f h2d yecc ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L2:<span class="_ _166"> </span></span><span class="ff2d fs35">middle:</span></div><div class="t m5 x1f h2d yecd ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _45"> </span><span class="ffd fs1e fc2">testq<span class="_ _3f"> </span>%rdi,<span class="_ _e"> </span>%rdi<span class="_ _7d"> </span></span><span class="ff13 fs35">Test<span class="_ _e"> </span>ptr</span></div><div class="t m5 x1f h2d yece ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _45"> </span><span class="ffd fs1e fc2">jne<span class="_ _8c"> </span>.L3<span class="_ _e5"> </span></span><span class="ff13 fs35">If<span class="_ _e"> </span>!=<span class="_ _21"> </span>NULL,<span class="_ _f"> </span>goto<span class="_ _e"> </span><span class="ff2d">loop</span></span></div><div class="t m5 x1b0 h2d yecf ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _45"> </span><span class="ffd fs1e fc2">rep;<span class="_ _e"> </span>ret</span></div><div class="t m5 x124 h26 y356d ff7 fs19 fc2 sc0 ls0 ws0">A.<span class="_ _1f"> </span>Based<span class="_"> </span>on<span class="_"> </span>the<span class="_"> </span>annotated<span class="_"> </span>code<span class="_ _1"></span>,<span class="_"> </span>we<span class="_"> </span>can<span class="_"> </span>generate<span class="_"> </span>a<span class="_"> </span>C<span class="_"> </span>version:</div><div class="t m5 x4f h2d y356e ffd fs1e fc2 sc0 ls0 ws0">short<span class="_ _e"> </span>test(struct<span class="_ _1f"> </span>ACE<span class="_ _1f"> </span>*ptr)<span class="_ _e"> </span>{</div><div class="t m5 x33 h2d y356f ffd fs1e fc2 sc0 ls0 ws0">short<span class="_ _e"> </span>val<span class="_ _1f"> </span>=<span class="_ _1f"> </span>1;</div><div class="t m5 x33 h2d y3570 ffd fs1e fc2 sc0 ls0 ws0">while<span class="_ _e"> </span>(ptr)<span class="_ _1f"> </span>{</div><div class="t m5 xf7 h2d y3571 ffd fs1e fc2 sc0 ls0 ws0">val<span class="_ _e"> </span>*=<span class="_ _1f"> </span>ptr-&gt;v;</div><div class="t m5 xf7 h2d y3572 ffd fs1e fc2 sc0 ls0 ws0">ptr<span class="_ _1a"> </span>=<span class="_ _e"> </span>ptr-&gt;p;</div><div class="t m5 x33 h2d y3573 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x33 h2d y3574 ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>val;</div><div class="t m5 x4f h2d y3575 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x124 h26 y3576 ff7 fs19 fc2 sc0 ls0 ws0">B<span class="_ _3"></span>.<span class="_ _1d"> </span>W<span class="_ _1"></span>e<span class="_ _13"> </span>can<span class="_"> </span>see<span class="_ _13"> </span>that<span class="_"> </span>each<span class="_ _13"> </span>structure<span class="_"> </span>is<span class="_ _13"> </span>an<span class="_"> </span>element<span class="_ _13"> </span>in<span class="_"> </span>a<span class="_ _13"> </span>singly<span class="_"> </span>linked<span class="_ _13"> </span>list,<span class="_"> </span>with<span class="_"> </span>Ô¨Åeld</div><div class="t m5 x4f h26 y3577 ffd fs19 fc2 sc0 ls0 ws0">v<span class="_ _10"> </span><span class="ff7">being<span class="_"> </span>the<span class="_ _11"> </span>value<span class="_"> </span>of<span class="_"> </span>the<span class="_ _11"> </span>element<span class="_"> </span>and<span class="_"> </span></span>p<span class="_ _11"> </span><span class="ff7">being<span class="_"> </span>a<span class="_"> </span>pointer<span class="_"> </span>to<span class="_ _11"> </span>the<span class="_"> </span>next<span class="_"> </span>element.</span></div><div class="t m5 x4f h26 y3578 ff7 fs19 fc2 sc0 ls0 ws0">Function<span class="_"> </span><span class="ffd">fun<span class="_ _10"> </span></span>computes<span class="_"> </span>the<span class="_"> </span>sum<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>element<span class="_"> </span>values<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>list.</div><div class="t m5 x1d h28 y3579 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>3.43<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>308)</span></div><div class="t m5 x1d h26 y357a ff7 fs19 fc1 sc0 ls0 ws0">Structures<span class="_"> </span>and<span class="_"> </span>unions<span class="_"> </span>involve<span class="_"> </span>a<span class="_"> </span>simple<span class="_"> </span>set<span class="_"> </span>of<span class="_"> </span>concepts<span class="_ _0"></span>,<span class="_"> </span>but<span class="_"> </span>it<span class="_"> </span>takes<span class="_"> </span>practice<span class="_"> </span>to<span class="_"> </span>be</div><div class="t m5 x1d h26 y357b ff7 fs19 fc1 sc0 ls0 ws0">comfortable<span class="_"> </span>with<span class="_"> </span>the<span class="_"> </span>different<span class="_"> </span>referencing<span class="_"> </span>patterns<span class="_"> </span>and<span class="_"> </span>their<span class="_"> </span>implementations<span class="_ _1"></span>.</div><div class="t m5 x1d h31 y357c ffd fs1e fc2 sc0 ls0 ws0">EXPR<span class="_ _18d"> </span>TYPE<span class="_ _94"> </span><span class="ff7 fs21">Code</span></div><div class="t m5 x1d h2d y357d ffd fs1e fc2 sc0 ls0 ws0">up-&gt;t1.u<span class="_ _158"> </span>long<span class="_ _45"> </span>movq<span class="_ _11"> </span>(%rdi),<span class="_ _11"> </span>%rax</div><div class="t m5 x101 h2d y357e ffd fs1e fc2 sc0 ls0 ws0">movq<span class="_ _11"> </span>%rax,<span class="_ _11"> </span>(%rsi)</div><div class="t m5 x1d h2d y357f ffd fs1e fc2 sc0 ls0 ws0">up-&gt;t1.v<span class="_ _158"> </span>short<span class="_ _73"> </span>movw<span class="_ _11"> </span>8(%rdi),<span class="_ _11"> </span>%ax</div><div class="t m5 x101 h2d y3580 ffd fs1e fc2 sc0 ls0 ws0">movw<span class="_ _11"> </span>%ax,<span class="_ _11"> </span>(%rsi)</div><div class="t m5 x1d h2d y3581 ffd fs1e fc2 sc0 ls0 ws0">&amp;up-&gt;t1.w<span class="_ _7a"> </span>char<span class="_ _11"> </span>*<span class="_ _5e"> </span>addq<span class="_ _11"> </span>$10,<span class="_ _11"> </span>%rdi</div><div class="t m5 x101 h2d y3582 ffd fs1e fc2 sc0 ls0 ws0">movq<span class="_ _11"> </span>%rdi,<span class="_ _11"> </span>(%rsi)</div><div class="t m5 x1d h2d y3583 ffd fs1e fc2 sc0 ls0 ws0">up-&gt;t2.a<span class="_ _158"> </span>int<span class="_ _11"> </span>*<span class="_ _75"> </span>movq<span class="_ _11"> </span>%rdi,<span class="_ _11"> </span>(%rsi)</div><div class="t m5 x1d h2d y3584 ffd fs1e fc2 sc0 ls0 ws0">up-&gt;t2.a[up-&gt;t1.u]<span class="_ _26"> </span>int<span class="_ _131"> </span>movq<span class="_ _11"> </span>(%rdi),<span class="_ _11"> </span>%rax</div><div class="t m5 x101 h2d y3585 ffd fs1e fc2 sc0 ls0 ws0">movl<span class="_ _11"> </span>(%rdi,%rax,4),<span class="_ _11"> </span>%eax</div><div class="t m5 x101 h2d y3586 ffd fs1e fc2 sc0 ls0 ws0">movl<span class="_ _11"> </span>%eax,<span class="_ _11"> </span>(%rsi)</div><div class="t m5 x1d h2d y3587 ffd fs1e fc2 sc0 ls0 ws0">*up-&gt;t2.p<span class="_ _7a"> </span>char<span class="_ _45"> </span>movq<span class="_ _11"> </span>8(%rdi),<span class="_ _11"> </span>%rax</div><div class="t m5 x101 h2d y3588 ffd fs1e fc2 sc0 ls0 ws0">movb<span class="_ _11"> </span>(%rax),<span class="_ _11"> </span>%al</div><div class="t m5 x101 h2d y3589 ffd fs1e fc2 sc0 ls0 ws0">movb<span class="_ _11"> </span>%al,<span class="_ _11"> </span>(%rsi)</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
