<div id="pf2de" class="pf w2 h11" data-page-no="2de"><div class="pc pc2de w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg2de.png"/><div class="t m5 x199 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>7.9<span class="_ _60"> </span>Loading<span class="_ _10"> </span>Executable<span class="_ _10"> </span>Object<span class="_ _10"> </span>Files<span class="_ _3e"> </span><span class="ffe fs1e">733</span></div><div class="t m5 x5c h46 ye7 ffd fs19 fc2 sc0 ls0 ws0">vaddr<span class="_ _13"> </span><span class="ff7">mod<span class="_"> </span></span>align<span class="_ _10"> </span><span class="ff12">=<span class="_ _13"></span></span>0x600df8<span class="_ _13"> </span><span class="ff7">mod<span class="_"> </span></span>0x200000<span class="_ _13"> </span><span class="ff12">=<span class="_ _13"></span></span>0xdf8</div><div class="t m5 x17 h26 y60fb ff7 fs19 fc2 sc0 ls0 ws0">and</div><div class="t m5 x161 h46 y60fc ffd fs19 fc2 sc0 ls0 ws0">off<span class="_ _6"> </span><span class="ff7">mod<span class="_"> </span></span>align<span class="_ _10"> </span><span class="ff12">=<span class="_ _13"></span></span>0xdf8<span class="_ _13"> </span><span class="ff7">mod<span class="_"> </span></span>0x200000<span class="_ _13"> </span><span class="ff12">=<span class="_ _13"></span></span>0xdf8</div><div class="t m5 x17 h26 y60fd ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _13"> </span>alignment<span class="_ _13"> </span>requirement<span class="_ _13"> </span>is<span class="_ _13"> </span>an<span class="_ _13"> </span>optimization<span class="_ _6"> </span>that<span class="_ _13"> </span>enables<span class="_ _13"> </span>segments<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_ _13"> </span>object</div><div class="t m5 x17 h26 y60fe ff7 fs19 fc2 sc0 ls0 ws0">ﬁle<span class="_ _6"> </span>to<span class="_ _13"> </span>be<span class="_ _a"> </span>transferred<span class="_ _13"> </span>efﬁciently<span class="_ _a"> </span>to<span class="_ _13"> </span>memory<span class="_ _6"> </span>when<span class="_ _6"> </span>the<span class="_ _13"> </span>program<span class="_ _a"> </span>executes<span class="_ _1"></span>.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_ _6"> </span>reason</div><div class="t m5 x17 h26 y60ff ff7 fs19 fc2 sc0 ls0 ws0">is<span class="_ _13"> </span>somewhat<span class="_ _13"> </span>subtle<span class="_ _13"> </span>and<span class="_ _13"> </span>is<span class="_"> </span>due<span class="_ _13"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>way<span class="_ _13"> </span>that<span class="_ _13"> </span>virtual<span class="_ _13"> </span>memory<span class="_ _13"> </span>is<span class="_ _13"> </span>organized<span class="_ _13"> </span>as<span class="_"> </span>large</div><div class="t m5 x17 h26 y6100 ff7 fs19 fc2 sc0 ls0 ws0">contiguous<span class="_ _13"> </span>power<span class="_ _1"></span>-of-2<span class="_ _13"> </span>chunks<span class="_"> </span>of<span class="_ _13"> </span>bytes<span class="_ _3"></span>.<span class="_"> </span>Y<span class="_ _7"></span>ou<span class="_ _13"> </span>will<span class="_"> </span>learn<span class="_ _13"> </span>all<span class="_ _13"> </span>about<span class="_ _13"> </span>virtual<span class="_ _13"> </span>memory<span class="_"> </span>in</div><div class="t m5 x17 h26 y6101 ff7 fs19 fc2 sc0 ls0 ws0">Chapter<span class="_"> </span>9.</div><div class="t m5 x17 h3b y6102 fff fs24 fc6 sc0 ls0 ws0">7.9<span class="_ _17"> </span><span class="ffe fs18">Loading<span class="_"> </span>Executable<span class="_"> </span>Object<span class="_"> </span>Files</span></div><div class="t m5 x17 h26 y6103 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_ _16"> </span>run<span class="_ _16"> </span>an<span class="_ _16"> </span>executable<span class="_ _16"> </span>object<span class="_ _11"> </span>ﬁle<span class="_ _16"> </span><span class="ffd">prog</span>,<span class="_ _16"> </span>we<span class="_ _16"> </span>can<span class="_ _16"> </span>type<span class="_ _16"> </span>its<span class="_ _11"> </span>name<span class="_ _16"> </span>to<span class="_ _16"> </span>the<span class="_ _16"> </span>Linux<span class="_ _16"> </span>shell’<span class="_ _0"></span>s</div><div class="t m5 x17 h26 y6104 ff7 fs19 fc1 sc0 ls0 ws0">command<span class="_"> </span>line:</div><div class="t m5 x17 h2d y6105 ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">./prog</span></div><div class="t m5 x17 h26 y6106 ff7 fs19 fc2 sc0 ls0 ws0">Since<span class="_ _6"> </span><span class="ffd">prog<span class="_ _13"> </span></span>does<span class="_ _6"> </span>not<span class="_ _13"> </span>correspond<span class="_ _6"> </span>to<span class="_ _13"> </span>a<span class="_ _6"> </span>built-in<span class="_ _13"> </span>shell<span class="_ _6"> </span>command,<span class="_ _13"> </span>the<span class="_ _6"> </span>shell<span class="_ _13"> </span>assumes<span class="_ _6"> </span>that</div><div class="t m5 x17 h26 y6107 ffd fs19 fc2 sc0 ls0 ws0">prog<span class="_ _10"> </span><span class="ff7">is<span class="_ _11"> </span>an<span class="_ _11"> </span>executable<span class="_"> </span>object<span class="_ _11"> </span>ﬁle,<span class="_"> </span>which<span class="_"> </span>it<span class="_ _11"> </span>runs<span class="_ _11"> </span>for<span class="_"> </span>us<span class="_ _11"> </span>by<span class="_ _11"> </span>invoking<span class="_"> </span>some<span class="_ _11"> </span>memory-</span></div><div class="t m5 x17 h26 y6108 ff7 fs19 fc2 sc0 ls0 ws0">resident<span class="_ _14"> </span>operating<span class="_ _14"> </span>system<span class="_ _14"> </span>code<span class="_ _14"> </span>known<span class="_ _14"> </span>as<span class="_ _14"> </span>the<span class="_ _14"> </span><span class="ffd">loader</span>.<span class="_ _15"> </span>Any<span class="_ _14"> </span>Linux<span class="_ _14"> </span>program<span class="_ _14"> </span>can</div><div class="t m5 x17 h26 y6109 ff7 fs19 fc2 sc0 ls0 ws0">invoke<span class="_ _6"> </span>the<span class="_ _13"> </span>loader<span class="_ _a"> </span>by<span class="_ _13"> </span>calling<span class="_ _6"> </span>the<span class="_ _6"> </span><span class="ffd">execve<span class="_ _13"> </span></span>function,<span class="_ _6"> </span>which<span class="_ _13"> </span>we<span class="_ _a"> </span>will<span class="_ _13"> </span>describe<span class="_ _6"> </span>in<span class="_ _6"> </span>detail<span class="_ _13"> </span>in</div><div class="t m5 x17 h26 y610a ff7 fs19 fc2 sc0 ls0 ws0">Section<span class="_ _6"> </span>8.4.6.<span class="_ _6"> </span>T<span class="_ _0"></span>he<span class="_ _6"> </span>loader<span class="_ _6"> </span>copies<span class="_ _6"> </span>the<span class="_ _13"> </span>code<span class="_ _a"> </span>and<span class="_ _6"> </span>data<span class="_ _6"> </span>in<span class="_ _13"> </span>the<span class="_ _a"> </span>executable<span class="_ _6"> </span>object<span class="_ _13"> </span>ﬁle<span class="_ _a"> </span>from</div><div class="t m5 x17 h26 y610b ff7 fs19 fc2 sc0 ls0 ws0">disk<span class="_ _13"> </span>into<span class="_"> </span>memory<span class="_ _13"> </span>and<span class="_"> </span>then<span class="_ _13"> </span>runs<span class="_"> </span>the<span class="_ _13"> </span>program<span class="_ _13"> </span>by<span class="_"> </span>jumping<span class="_ _13"> </span>to<span class="_"> </span>its<span class="_ _13"> </span>ﬁrst<span class="_ _13"> </span>instruction,<span class="_"> </span>or</div><div class="t m5 x17 h26 y610c ffa fs19 fc2 sc0 ls0 ws0">entry<span class="_ _11"> </span>point<span class="_ _2"></span><span class="ff7">.<span class="_ _11"> </span>This<span class="_"> </span>process<span class="_ _11"> </span>of<span class="_ _11"> </span>copying<span class="_ _11"> </span>the<span class="_ _11"> </span>program<span class="_ _16"> </span>into<span class="_"> </span>memory<span class="_ _11"> </span>and<span class="_ _16"> </span>then<span class="_"> </span>running</span></div><div class="t m5 x17 h26 y610d ff7 fs19 fc2 sc0 ls0 ws0">it<span class="_"> </span>is<span class="_"> </span>known<span class="_"> </span>as<span class="_"> </span><span class="ffa">loading<span class="_ _2"></span></span>.</div><div class="t m5 x26 h26 y610e ff7 fs19 fc2 sc0 ls0 ws0">Every<span class="_ _16"> </span>running<span class="_ _16"> </span>Linux<span class="_ _16"> </span>program<span class="_ _14"> </span>has<span class="_ _16"> </span>a<span class="_ _16"> </span>run-time<span class="_ _14"> </span>memory<span class="_ _16"> </span>image<span class="_ _16"> </span>similar<span class="_ _16"> </span>to<span class="_ _14"> </span>the</div><div class="t m5 x17 h26 y610f ff7 fs19 fc2 sc0 ls0 ws0">one<span class="_ _11"> </span>in<span class="_ _11"> </span>Figure<span class="_"> </span>7.15.<span class="_ _16"> </span>On<span class="_ _11"> </span>Linux<span class="_ _11"> </span>x86-64<span class="_ _16"> </span>systems<span class="_ _1"></span>,<span class="_ _11"> </span>the<span class="_ _16"> </span>code<span class="_ _11"> </span>segment<span class="_ _11"> </span>starts<span class="_ _11"> </span>at<span class="_ _16"> </span>address</div><div class="t m5 x17 h26 y6110 ffd fs19 fc2 sc0 ls0 ws0">0x400000<span class="ff7">,<span class="_ _f"> </span>followed<span class="_ _21"> </span>by<span class="_ _f"> </span>the<span class="_ _21"> </span>data<span class="_ _21"> </span>segment.<span class="_ _21"> </span>The<span class="_ _15"> </span>run-time<span class="_ _21"> </span><span class="ffa">heap<span class="_ _15"> </span></span>follows<span class="_ _f"> </span>the<span class="_ _21"> </span>data</span></div><div class="t m5 x17 h26 y6111 ff7 fs19 fc2 sc0 ls0 ws0">segment<span class="_ _6"> </span>and<span class="_ _6"> </span>grows<span class="_ _6"> </span>upward<span class="_ _6"> </span>via<span class="_ _6"> </span>calls<span class="_ _6"> </span>to<span class="_ _6"> </span>the<span class="_ _6"> </span><span class="ffd">malloc<span class="_ _6"> </span></span>library<span class="_ _3"></span>.<span class="_ _6"> </span>(W<span class="_ _3"></span>e<span class="_ _6"> </span>will<span class="_ _6"> </span>describe<span class="_ _6"> </span><span class="ffd">malloc</span></div><div class="t m5 x17 h26 y6112 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_"> </span>the<span class="_ _13"> </span>heap<span class="_"> </span>in<span class="_"> </span>detail<span class="_ _13"> </span>in<span class="_"> </span>Section<span class="_ _13"> </span>9.9.)<span class="_"> </span>T<span class="_ _1"></span>his<span class="_"> </span>is<span class="_"> </span>followed<span class="_ _13"> </span>by<span class="_"> </span>a<span class="_"> </span>region<span class="_ _13"> </span>that<span class="_"> </span>is<span class="_"> </span>reserved</div><div class="t m5 x17 h26 y6113 ff7 fs19 fc2 sc0 ls0 ws0">for<span class="_ _15"> </span>shared<span class="_ _15"> </span>modules<span class="_ _0"></span>.<span class="_ _15"> </span>T<span class="_ _0"></span>he<span class="_ _15"> </span>user<span class="_ _15"> </span>stack<span class="_ _21"> </span>starts<span class="_ _15"> </span>below<span class="_ _21"> </span>the<span class="_ _15"> </span>largest<span class="_ _21"> </span>legal<span class="_ _15"> </span>user<span class="_ _21"> </span>address</div><div class="t m5 x17 h26 y6114 ff7 fs19 fc2 sc0 ls0 ws0">(2</div><div class="t m5 xee h3c y6115 ff7 fs25 fc2 sc0 ls0 ws0">48</div><div class="t m5 x1a4 h46 y6116 ff12 fs19 fc2 sc0 ls0 ws0">−<span class="_ _10"> </span><span class="ff7">1<span class="_ _3"></span>)<span class="_ _16"> </span>and<span class="_ _11"> </span>grows<span class="_ _16"> </span>down,<span class="_ _16"> </span>toward<span class="_ _11"> </span>smaller<span class="_ _16"> </span>memory<span class="_ _11"> </span>addresses<span class="_ _1"></span>.<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span>region<span class="_ _16"> </span>above</span></div><div class="t m5 x17 h26 y6117 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _11"> </span>stack,<span class="_ _11"> </span>starting<span class="_ _11"> </span>at<span class="_ _11"> </span>address<span class="_ _16"> </span>2</div><div class="t m5 xb3 h3c y6118 ff7 fs25 fc2 sc0 ls0 ws0">48</div><div class="t m5 xd h26 y3eb4 ff7 fs19 fc2 sc0 ls0 ws0">,<span class="_ _11"> </span>is<span class="_ _11"> </span>reserved<span class="_ _11"> </span>for<span class="_ _11"> </span>the<span class="_ _16"> </span>code<span class="_"> </span>and<span class="_ _11"> </span>data<span class="_ _11"> </span>in<span class="_ _16"> </span>the<span class="_"> </span><span class="ffa">kernel<span class="_ _5"></span></span>,</div><div class="t m5 x17 h26 y4c56 ff7 fs19 fc2 sc0 ls0 ws0">which<span class="_"> </span>is<span class="_"> </span>the<span class="_"> </span>memory-resident<span class="_"> </span>part<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>operating<span class="_"> </span>system.</div><div class="t m5 x26 h26 y4c57 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _14"> </span>simplicity<span class="_ _3"></span>,<span class="_ _15"> </span>we’ve<span class="_ _14"> </span>drawn<span class="_ _14"> </span>the<span class="_ _14"> </span>heap<span class="_ _0"></span>,<span class="_ _15"> </span>data,<span class="_ _15"> </span>and<span class="_ _14"> </span>code<span class="_ _14"> </span>segments<span class="_ _15"> </span>as<span class="_ _14"> </span>abutting</div><div class="t m5 x17 h26 y4c58 ff7 fs19 fc2 sc0 ls0 ws0">each<span class="_ _14"> </span>other,<span class="_ _21"> </span>and<span class="_ _15"> </span>we’ve<span class="_ _14"> </span>placed<span class="_ _15"> </span>the<span class="_ _15"> </span>top<span class="_ _15"> </span>of<span class="_ _14"> </span>the<span class="_ _15"> </span>stack<span class="_ _15"> </span>at<span class="_ _15"> </span>the<span class="_ _15"> </span>largest<span class="_ _15"> </span>legal<span class="_ _14"> </span>user<span class="_ _15"> </span>ad-</div><div class="t m5 x17 h26 y4c59 ff7 fs19 fc2 sc0 ls0 ws0">dress<span class="_ _1"></span>.<span class="_ _11"> </span>In<span class="_ _11"> </span>practice,<span class="_"> </span>there<span class="_ _16"> </span>is<span class="_ _11"> </span>a<span class="_ _11"> </span>gap<span class="_ _11"> </span>between<span class="_ _11"> </span>the<span class="_ _16"> </span>code<span class="_ _11"> </span>and<span class="_ _11"> </span>data<span class="_ _11"> </span>segments<span class="_ _11"> </span>due<span class="_ _16"> </span>to<span class="_ _11"> </span>the</div><div class="t m5 x17 h26 y3e6c ff7 fs19 fc2 sc0 ls0 ws0">alignment<span class="_"> </span>requirement<span class="_"> </span>on<span class="_"> </span>the<span class="_"> </span><span class="ffd">.data<span class="_ _10"> </span></span>segment<span class="_"> </span>(Section<span class="_ _11"> </span>7.8).<span class="_"> </span>Also<span class="_ _1"></span>,<span class="_ _11"> </span>the<span class="_"> </span>linker<span class="_"> </span>uses</div><div class="t m5 x17 h26 y3e6d ff7 fs19 fc2 sc0 ls0 ws0">address-space<span class="_"> </span>layout<span class="_ _11"> </span>randomization<span class="_"> </span>(ASLR,<span class="_ _11"> </span>Section<span class="_"> </span>3.10.4)<span class="_ _11"> </span>when<span class="_"> </span>it<span class="_ _11"> </span>assigns<span class="_"> </span>run-</div><div class="t m5 x17 h26 y3e6e ff7 fs19 fc2 sc0 ls0 ws0">time<span class="_ _11"> </span>addresses<span class="_ _11"> </span>to<span class="_ _11"> </span>the<span class="_ _11"> </span>stack,<span class="_ _11"> </span>shared<span class="_ _11"> </span>library<span class="_ _3"></span>,<span class="_ _16"> </span>and<span class="_"> </span>heap<span class="_ _11"> </span>segments<span class="_ _1"></span>.<span class="_ _16"> </span>Even<span class="_"> </span>though<span class="_ _11"> </span>the</div><div class="t m5 x17 h26 y3e6f ff7 fs19 fc2 sc0 ls0 ws0">locations<span class="_"> </span>of<span class="_"> </span>these<span class="_"> </span>regions<span class="_"> </span>change<span class="_"> </span>each<span class="_"> </span>time<span class="_"> </span>the<span class="_"> </span>program<span class="_"> </span>is<span class="_"> </span>run,<span class="_"> </span>their<span class="_"> </span>relative<span class="_"> </span>po-</div><div class="t m5 x17 h26 y3e70 ff7 fs19 fc2 sc0 ls0 ws0">sitions<span class="_"> </span>are<span class="_"> </span>the<span class="_"> </span>same<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y3e71 ff7 fs19 fc2 sc0 ls0 ws0">When<span class="_ _11"> </span>the<span class="_ _14"> </span>loader<span class="_ _16"> </span>runs<span class="_ _1"></span>,<span class="_ _16"> </span>it<span class="_ _14"> </span>creates<span class="_ _16"> </span>a<span class="_ _16"> </span>memory<span class="_ _16"> </span>image<span class="_ _16"> </span>similar<span class="_ _16"> </span>to<span class="_ _16"> </span>the<span class="_ _16"> </span>one<span class="_ _16"> </span>shown</div><div class="t m5 x17 h26 y3e72 ff7 fs19 fc2 sc0 ls0 ws0">in<span class="_ _f"> </span>F<span class="_ _0"></span>igure<span class="_ _f"> </span>7.15.<span class="_ _f"> </span>Guided<span class="_ _f"> </span>by<span class="_ _e"> </span>the<span class="_ _21"> </span>program<span class="_ _f"> </span>header<span class="_ _e"> </span>table<span class="_ _1"></span>,<span class="_ _e"> </span>it<span class="_ _f"> </span>copies<span class="_ _f"> </span>chunks<span class="_ _e"> </span>of<span class="_ _21"> </span>the</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
