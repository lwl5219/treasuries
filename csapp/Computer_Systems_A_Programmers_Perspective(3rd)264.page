<div id="pf108" class="pf w2 h11" data-page-no="108"><div class="pc pc108 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg108.png"/><div class="t m5 x1dc h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>3.6<span class="_ _60"> </span>Control<span class="_ _3e"> </span><span class="ffe fs1e">263</span></div><div class="t m5 x17 h34 y9c ff6 fs16 fc2 sc0 ls0 ws0">(a)<span class="_ _10"> </span>C<span class="_ _11"> </span>code</div><div class="t m5 x17 h2d y1bbd ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>fact_while(long<span class="_ _1f"> </span>n)</div><div class="t m5 x17 h2d y2769 ffd fs1e fc2 sc0 ls0 ws0">{</div><div class="t m5 x1b6 h2d y276a ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>result<span class="_ _1f"> </span>=<span class="_ _1f"> </span>1;</div><div class="t m5 x1b6 h2d y276b ffd fs1e fc2 sc0 ls0 ws0">while<span class="_ _e"> </span>(n<span class="_ _1f"> </span>&gt;<span class="_ _1f"> </span>1)<span class="_ _e"> </span>{</div><div class="t m5 x21e h2d y276c ffd fs1e fc2 sc0 ls0 ws0">result<span class="_ _e"> </span>*=<span class="_ _1f"> </span>n;</div><div class="t m5 x21e h2d y276d ffd fs1e fc2 sc0 ls0 ws0">n<span class="_ _e"> </span>=<span class="_ _1f"> </span>n-1;</div><div class="t m5 x1b6 h2d y276e ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x1b6 h2d y276f ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>result;</div><div class="t m5 x17 h2d y2770 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x9e h34 y2771 ff6 fs16 fc2 sc0 ls0 ws0">(b)<span class="_ _10"> </span>Equivalent<span class="_ _11"> </span>goto<span class="_ _10"> </span>version</div><div class="t m5 x9e h2d y2772 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>fact_while_gd_goto(long<span class="_ _1f"> </span>n)</div><div class="t m5 x9e h2d y2773 ffd fs1e fc2 sc0 ls0 ws0">{</div><div class="t m5 x1b1 h2d y2774 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>result<span class="_ _1f"> </span>=<span class="_ _1f"> </span>1;</div><div class="t m5 x1b1 h2d y2775 ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>(n<span class="_ _1f"> </span>&lt;=<span class="_ _1f"> </span>1)</div><div class="t m5 x7f h2d y2776 ffd fs1e fc2 sc0 ls0 ws0">goto<span class="_ _e"> </span>done;</div><div class="t m5 x197 h2d y2777 ffd fs1e fc2 sc0 ls0 ws0">loop:</div><div class="t m5 x1b1 h2d y2778 ffd fs1e fc2 sc0 ls0 ws0">result<span class="_ _e"> </span>*=<span class="_ _1f"> </span>n;</div><div class="t m5 x1b1 h2d y2779 ffd fs1e fc2 sc0 ls0 ws0">n<span class="_ _e"> </span>=<span class="_ _1f"> </span>n-1;</div><div class="t m5 x1b1 h2d y277a ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>(n<span class="_ _1f"> </span>!=<span class="_ _1f"> </span>1)</div><div class="t m5 x7f h2d y277b ffd fs1e fc2 sc0 ls0 ws0">goto<span class="_ _e"> </span>loop;</div><div class="t m5 x197 h2d y277c ffd fs1e fc2 sc0 ls0 ws0">done:</div><div class="t m5 x1b1 h2d y277d ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>result;</div><div class="t m5 x9e h2d y277e ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x17 h34 y277f ff6 fs16 fc2 sc0 ls0 ws0">(c)<span class="_ _10"> </span>Corresponding<span class="_ _11"> </span>assembly-language<span class="_ _10"> </span>code</div><div class="t m5 x2e h61 y2780 ff13 fs35 fc6 sc0 ls0 ws0">long<span class="_ _f"> </span>fact_while(long<span class="_ _f"> </span>n)</div><div class="t m5 x2e h61 y2781 ff13 fs35 fc6 sc0 ls0 ws0">n<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi</div><div class="t m5 x2c h2d y2782 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">fact_while:</span></div><div class="t m5 x2c h2d y2783 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">cmpq<span class="_ _46"> </span>$1,<span class="_ _e"> </span>%rdi<span class="_ _88"> </span></span><span class="ff13 fs35">Compare<span class="_ _21"> </span>n:1</span></div><div class="t m5 x2c h2d y2784 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">jle<span class="_ _8c"> </span>.L7<span class="_ _12b"> </span></span><span class="ff13 fs35">If<span class="_ _f"> </span>&lt;=,<span class="_ _f"> </span>goto<span class="_ _e"> </span><span class="ff2d">done</span></span></div><div class="t m5 x2c h2e y2785 ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 xd1 h2d y2786 ffd fs1e fc2 sc0 ls0 ws0">movl<span class="_ _46"> </span>$1,<span class="_ _e"> </span>%eax<span class="_ _88"> </span><span class="ff13 fs35 fc6">Set<span class="_ _21"> </span>result<span class="_ _e"> </span>=<span class="_ _21"> </span>1</span></div><div class="t m5 x2c h2e y2787 ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x2d h2d y2788 ffd fs1e fc2 sc0 ls0 ws0">.L6:<span class="_ _151"> </span><span class="ff2d fs35 fc6">loop:</span></div><div class="t m5 x2c h2d y2789 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">imulq<span class="_ _3f"> </span>%rdi,<span class="_ _e"> </span>%rax<span class="_ _93"> </span></span><span class="ff13 fs35">Compute<span class="_ _e"> </span>result<span class="_ _21"> </span>*=<span class="_ _f"> </span>n</span></div><div class="t m5 x2c h2d y278a ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">subq<span class="_ _46"> </span>$1,<span class="_ _e"> </span>%rdi<span class="_ _88"> </span></span><span class="ff13 fs35">Decrement<span class="_ _21"> </span>n</span></div><div class="t m5 x2c h2d y278b ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _45"> </span><span class="ffd fs1e fc2">cmpq<span class="_ _46"> </span>$1,<span class="_ _e"> </span>%rdi<span class="_ _88"> </span></span><span class="ff13 fs35">Compare<span class="_ _21"> </span>n:1</span></div><div class="t m5 x2c h2e y278c ff6 fs20 fc6 sc0 ls0 ws0">9</div><div class="t m5 xd1 h2d y278d ffd fs1e fc2 sc0 ls0 ws0">jne<span class="_ _8c"> </span>.L6<span class="_ _12b"> </span><span class="ff13 fs35 fc6">If<span class="_ _f"> </span>!=,<span class="_ _f"> </span>goto<span class="_ _e"> </span><span class="ff2d">loop</span></span></div><div class="t m5 x17 h2d y278e ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _45"> </span><span class="ffd fs1e fc2">rep;<span class="_ _e"> </span>ret<span class="_ _c1"> </span></span><span class="ff13 fs35">Return</span></div><div class="t m5 x17 h2d y278f ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L7:<span class="_ _15d"> </span></span><span class="ff2d fs35">done:</span></div><div class="t m5 x17 h2d y2790 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _45"> </span><span class="ffd fs1e fc2">movl<span class="_ _46"> </span>$1,<span class="_ _e"> </span>%eax<span class="_ _88"> </span></span><span class="ff13 fs35">Compute<span class="_ _21"> </span>result<span class="_ _e"> </span>=<span class="_ _21"> </span>1</span></div><div class="t m5 x17 h2e y2791 ff6 fs20 fc6 sc0 ls0 ws0">13</div><div class="t m5 xd1 h2d y2792 ffd fs1e fc2 sc0 ls0 ws0">ret<span class="_ _14f"> </span><span class="ff13 fs35 fc6">Return</span></div><div class="t m5 x17 h3a y2793 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _16"> </span>3.21<span class="_ _c"> </span><span class="fc2">C<span class="_ _16"> </span>and<span class="_ _14"> </span>assembly<span class="_ _16"> </span>code<span class="_ _14"> </span>for<span class="_ _16"> </span><span class="ffd fs19">while<span class="_ _16"> </span></span>version<span class="_ _14"> </span>of<span class="_ _16"> </span>factorial<span class="_ _14"> </span>using<span class="_ _16"> </span>guarded-</span></div><div class="t m5 x17 h34 y2794 ffe fs16 fc2 sc0 ls0 ws0">do<span class="_ _14"> </span>translation.<span class="_ _16"> </span><span class="ff6">The</span></div><div class="t m5 x162 h3a y2795 ffd fs19 fc2 sc0 ls0 ws0">fact_while_gd_goto<span class="_ _14"> </span><span class="ff6 fs16">function<span class="_ _14"> </span>illustrates<span class="_ _16"> </span>the<span class="_ _14"> </span>operation<span class="_ _14"> </span>of<span class="_ _14"> </span>the</span></div><div class="t m5 x17 h34 y2796 ff6 fs16 fc2 sc0 ls0 ws0">assembly-code<span class="_ _10"> </span>version.</div><div class="t m5 x2c h2d y2797 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _45"> </span><span class="ffd fs1e fc2">jg<span class="_ _5a"> </span>.L7</span></div><div class="t m5 x17 h2d y2798 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _45"> </span><span class="ffd fs1e fc2">rep;<span class="_ _e"> </span>ret</span></div><div class="t m5 x17 h2d y2799 ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L8:</span></div><div class="t m5 x17 h2d y279a ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rsi,<span class="_ _e"> </span>%rax</span></div><div class="t m5 x17 h2d y279b ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _45"> </span><span class="ffd fs1e fc2">ret</span></div><div class="t m5 x26 h26 yd16 ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _14"> </span>can<span class="_ _14"> </span>see<span class="_ _16"> </span>that<span class="_ _14"> </span>the<span class="_ _14"> </span>compiler<span class="_ _14"> </span>used<span class="_ _16"> </span>a<span class="_ _14"> </span>guarded-do<span class="_ _14"> </span>translation,<span class="_ _15"> </span>using<span class="_ _16"> </span>the<span class="_ _14"> </span><span class="ffd">jle</span></div><div class="t m5 x17 h26 yd17 ff7 fs19 fc2 sc0 ls0 ws0">instruction<span class="_ _16"> </span>on<span class="_ _11"> </span>line<span class="_ _16"> </span>3<span class="_ _16"> </span>to<span class="_ _16"> </span>skip<span class="_ _16"> </span>over<span class="_ _11"> </span>the<span class="_ _16"> </span>loop<span class="_ _16"> </span>code<span class="_ _16"> </span>when<span class="_ _16"> </span>the<span class="_ _11"> </span>initial<span class="_ _16"> </span>test<span class="_ _16"> </span>fails<span class="_ _1"></span>.<span class="_ _16"> </span>F<span class="_ _1"></span>ill<span class="_ _16"> </span>in</div><div class="t m5 x17 h26 y223b ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _16"> </span>missing<span class="_ _11"> </span>parts<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>C<span class="_ _16"> </span>code<span class="_ _1"></span>.<span class="_ _16"> </span>Note<span class="_ _16"> </span>that<span class="_ _16"> </span>the<span class="_ _11"> </span>control<span class="_ _16"> </span>structure<span class="_ _16"> </span>in<span class="_ _16"> </span>the<span class="_ _11"> </span>assembly</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
