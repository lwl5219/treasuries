<div id="pf34b" class="pf w2 h11" data-page-no="34b"><div class="pc pc34b w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg34b.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">842<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>9<span class="_ _3d"> </span>Virtual<span class="_ _10"> </span>Memory</span></div><div class="t m5 x14 h2f y9c ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>9.3</div><div class="t m5 x14 h2f y676 ffe fs16 fc1 sc0 ls0 ws0">How<span class="_ _16"> </span>a<span class="_ _11"> </span>VM<span class="_ _16"> </span>system<span class="_ _16"> </span>uses</div><div class="t m5 x14 h2f y7cb ffe fs16 fc1 sc0 ls0 ws0">main<span class="_"> </span>memory<span class="_"> </span>as<span class="_"> </span>a<span class="_"> </span>cache.</div><div class="t m5 x1a6 h3f y6c5b ffa9 fs27 fc1 sc0 ls0 ws0">VP 0</div><div class="t m5 x1a6 h3f y6c5c ffa9 fs27 fc1 sc0 ls0 ws0">VP 1<span class="_ _213"> </span>PP 0</div><div class="t m5 x1fd h3f y6c5d ffa9 fs27 fc1 sc0 ls0 ws0">PP 1</div><div class="t m5 x1fd h3f y6c5e ffa9 fs27 fc1 sc0 ls0 ws0">PP 2</div><div class="t m5 x1dc h65 y6c5f ffaa fs38 fc1 sc0 ls0 ws0">m<span class="ffa9">–</span>p<span class="ffa9"> </span></div><div class="t m5 x1f1 h3f y6c60 ffa9 fs27 fc1 sc0 ls0 ws0">– 1</div><div class="t m5 xe0 h3f y6c61 ffa9 fs27 fc1 sc0 ls0 ws0">VP 2</div><div class="t m5 x7c h65 y6c62 ffaa fs38 fc1 sc0 ls0 ws0">n<span class="ffa9">–</span>p<span class="ffa9"> </span></div><div class="t m5 xf1 h3f y6c63 ffa9 fs27 fc1 sc0 ls0 ws0">– 1</div><div class="t m5 x18d h3f y6c64 ffa9 fs27 fc1 sc0 ls0 ws0">Unallocated</div><div class="t m5 x5d h3f y6c65 ffa9 fs27 fc1 sc0 ls0 ws0">Virtual memory<span class="_ _c2"> </span>Physical memory</div><div class="t m5 x1f2 h3f y6c66 ffa9 fs27 fc1 sc0 ls0 ws0">Virtual pages (VPs)</div><div class="t m5 xab h3f y6c67 ffa9 fs27 fc1 sc0 ls0 ws0">stored on disk</div><div class="t m5 x1c9 h3f y6c66 ffa9 fs27 fc1 sc0 ls0 ws0">Physical pages (PPs)</div><div class="t m5 x1bb h3f y6c67 ffa9 fs27 fc1 sc0 ls0 ws0">cached in DRAM</div><div class="t m5 x157 h3f y6c68 ffa9 fs27 fc1 sc0 ls0 ws0">Cached</div><div class="t m5 x1b2 h3f y6c69 ffa9 fs27 fc1 sc0 ls0 ws0">Uncached</div><div class="t m5 x18d h3f y6c6a ffa9 fs27 fc1 sc0 ls0 ws0">Unallocated</div><div class="t m5 x157 h3f y6c6b ffa9 fs27 fc1 sc0 ls0 ws0">Cached</div><div class="t m5 x1b2 h3f y6c6c ffa9 fs27 fc1 sc0 ls0 ws0">Uncached</div><div class="t m5 x3a h3f y6c6d ffa9 fs27 fc1 sc0 ls0 ws0">Empty</div><div class="t m5 x3a h3f y6c6e ffa9 fs27 fc1 sc0 ls0 ws0">Empty</div><div class="t m5 x3a h3f y6c6f ffa9 fs27 fc1 sc0 ls0 ws0">Empty</div><div class="t m5 x113 h65 y6c70 ffaa fs38 fc1 sc0 ls0 ws0">N<span class="ffa9"> – 1</span></div><div class="t m5 x1b4 h65 y6c71 ffaa fs38 fc1 sc0 ls0 ws0">M<span class="ffa9"> – 1</span></div><div class="t m5 x113 h65 y6c72 ffa9 fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 x1fc h65 y6c73 ffa9 fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 x157 h3f y6c74 ffa9 fs27 fc1 sc0 ls0 ws0">Cached</div><div class="t m5 x1b2 h3f y6c75 ffa9 fs27 fc1 sc0 ls0 ws0">Uncached</div><div class="t m5 x1d h26 y6c76 ff7 fs19 fc1 sc0 ls0 ws0">on<span class="_"> </span>disk.<span class="_ _13"> </span>V<span class="_ _0"></span>irtual<span class="_"> </span>pages<span class="_ _13"> </span>1,<span class="_"> </span>4,<span class="_"> </span>and<span class="_ _13"> </span>6<span class="_"> </span>are<span class="_ _13"> </span>cached<span class="_"> </span>in<span class="_"> </span>physical<span class="_ _13"> </span>memory<span class="_ _3"></span>.<span class="_"> </span>Pages<span class="_ _13"> </span>2,<span class="_"> </span>5,<span class="_"> </span>and<span class="_ _13"> </span>7</div><div class="t m5 x1d h26 y6c77 ff7 fs19 fc1 sc0 ls0 ws0">are<span class="_"> </span>allocated<span class="_"> </span>but<span class="_"> </span>are<span class="_"> </span>not<span class="_"> </span>currently<span class="_"> </span>cached<span class="_"> </span>in<span class="_"> </span>physical<span class="_"> </span>memory<span class="_ _3"></span>.</div><div class="t m5 x1d h41 y6c78 ffe fs29 fc1 sc0 ls0 ws0">9.3.1<span class="_ _48"> </span><span class="fs19">DRAM<span class="_"> </span>Cache<span class="_"> </span>Organization</span></div><div class="t m5 x1d h26 y6c79 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_"> </span>help<span class="_ _13"> </span>us<span class="_ _13"> </span>keep<span class="_"> </span>the<span class="_ _13"> </span>different<span class="_ _13"> </span>caches<span class="_"> </span>in<span class="_ _13"> </span>the<span class="_ _13"> </span>memory<span class="_"> </span>hierarchy<span class="_ _13"> </span>straight,<span class="_ _13"> </span>we<span class="_"> </span>will<span class="_ _13"> </span>use</div><div class="t m5 x1d h26 y6c7a ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>term<span class="_ _13"> </span><span class="ffa">SRAM<span class="_"> </span>cache<span class="_"> </span></span>to<span class="_ _13"> </span>denote<span class="_"> </span>the<span class="_"> </span>L1,<span class="_"> </span>L2,<span class="_ _13"> </span>and<span class="_"> </span>L3<span class="_"> </span>cache<span class="_"> </span>memories<span class="_ _13"> </span>between<span class="_"> </span>the</div><div class="t m5 x1d h26 y6c7b ff7 fs19 fc1 sc0 ls0 ws0">CPU<span class="_ _11"> </span>and<span class="_ _16"> </span>main<span class="_ _11"> </span>memory<span class="_ _3"></span>,<span class="_ _11"> </span>and<span class="_ _16"> </span>the<span class="_ _11"> </span>term<span class="_ _11"> </span><span class="ffa">DRAM<span class="_ _16"> </span>cache<span class="_ _11"> </span></span>to<span class="_ _11"> </span>denote<span class="_ _16"> </span>the<span class="_ _11"> </span>VM<span class="_ _11"> </span>system’s</div><div class="t m5 x1d h26 y6c7c ff7 fs19 fc1 sc0 ls0 ws0">cache<span class="_"> </span>that<span class="_"> </span>caches<span class="_"> </span>virtual<span class="_"> </span>pages<span class="_"> </span>in<span class="_"> </span>main<span class="_"> </span>memory<span class="_ _3"></span>.</div><div class="t m5 x29 h26 y6c7d ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _11"> </span>position<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>DRAM<span class="_"> </span>cache<span class="_ _11"> </span>in<span class="_ _11"> </span>the<span class="_ _11"> </span>memory<span class="_ _11"> </span>hierarchy<span class="_ _11"> </span>has<span class="_"> </span>a<span class="_ _11"> </span>big<span class="_ _11"> </span>impact</div><div class="t m5 x1d h26 y6c7e ff7 fs19 fc1 sc0 ls0 ws0">on<span class="_ _16"> </span>the<span class="_ _16"> </span>way<span class="_ _16"> </span>that<span class="_ _16"> </span>it<span class="_ _11"> </span>is<span class="_ _16"> </span>organized.<span class="_ _16"> </span>Recall<span class="_ _16"> </span>that<span class="_ _16"> </span>a<span class="_ _16"> </span>DRAM<span class="_ _16"> </span>is<span class="_ _16"> </span>at<span class="_ _16"> </span>least<span class="_ _16"> </span>10<span class="_ _16"> </span>times<span class="_ _16"> </span>slower</div><div class="t m5 x1d h26 y6c7f ff7 fs19 fc1 sc0 ls0 ws0">than<span class="_"> </span>an<span class="_"> </span>SRAM<span class="_"> </span>and<span class="_"> </span>that<span class="_"> </span>disk<span class="_ _11"> </span>is<span class="_"> </span>about<span class="_"> </span>100,000<span class="_"> </span>times<span class="_"> </span>slower<span class="_ _11"> </span>than<span class="_"> </span>a<span class="_"> </span>DRAM.<span class="_"> </span>Thus<span class="_ _3"></span>,</div><div class="t m5 x1d h26 y6c80 ff7 fs19 fc1 sc0 ls0 ws0">misses<span class="_ _13"> </span>in<span class="_"> </span>DRAM<span class="_ _13"> </span>caches<span class="_ _13"> </span>are<span class="_"> </span>very<span class="_ _13"> </span>expensive<span class="_"> </span>compared<span class="_ _13"> </span>to<span class="_ _13"> </span>misses<span class="_"> </span>in<span class="_ _13"> </span>SRAM<span class="_ _13"> </span>caches</div><div class="t m5 x1d h26 y6c81 ff7 fs19 fc1 sc0 ls0 ws0">because<span class="_ _13"> </span>DRAM<span class="_ _13"> </span>cache<span class="_ _13"> </span>misses<span class="_ _6"> </span>are<span class="_ _13"> </span>served<span class="_ _13"> </span>from<span class="_ _13"> </span>disk,<span class="_ _13"> </span>while<span class="_ _13"> </span>SRAM<span class="_ _13"> </span>cache<span class="_ _6"> </span>misses<span class="_ _13"> </span>are</div><div class="t m5 x1d h26 y6c82 ff7 fs19 fc1 sc0 ls0 ws0">usually<span class="_ _13"> </span>served<span class="_"> </span>from<span class="_ _13"> </span>DRAM-based<span class="_ _13"> </span>main<span class="_"> </span>memory<span class="_ _7"></span>.<span class="_"> </span>Further<span class="_ _0"></span>,<span class="_ _13"> </span>the<span class="_"> </span>cost<span class="_ _13"> </span>of<span class="_"> </span>reading<span class="_ _13"> </span>the</div><div class="t m5 x1d h26 y6c83 ff7 fs19 fc1 sc0 ls0 ws0">ﬁrst<span class="_"> </span>byte<span class="_ _13"> </span>from<span class="_"> </span>a<span class="_"> </span>disk<span class="_ _13"> </span>sector<span class="_"> </span>is<span class="_"> </span>about<span class="_ _13"> </span>100,000<span class="_"> </span>times<span class="_"> </span>slower<span class="_ _13"> </span>than<span class="_"> </span>reading<span class="_"> </span>successive</div><div class="t m5 x1d h26 y6c84 ff7 fs19 fc1 sc0 ls0 ws0">bytes<span class="_"> </span>in<span class="_"> </span>the<span class="_ _11"> </span>sector.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_ _11"> </span>bottom<span class="_"> </span>line<span class="_"> </span>is<span class="_ _11"> </span>that<span class="_"> </span>the<span class="_ _11"> </span>organization<span class="_"> </span>of<span class="_ _11"> </span>the<span class="_"> </span>DRAM<span class="_"> </span>cache</div><div class="t m5 x1d h26 y6c85 ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_"> </span>driven<span class="_"> </span>entirely<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span>enormous<span class="_"> </span>cost<span class="_"> </span>of<span class="_"> </span>misses<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y6c86 ff7 fs19 fc1 sc0 ls0 ws0">Because<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>large<span class="_"> </span>miss<span class="_"> </span>penalty<span class="_"> </span>and<span class="_"> </span>the<span class="_"> </span>expense<span class="_"> </span>of<span class="_"> </span>accessing<span class="_"> </span>the<span class="_"> </span>ﬁrst<span class="_ _11"> </span>byte<span class="_ _1"></span>,</div><div class="t m5 x1d h26 y6c87 ff7 fs19 fc1 sc0 ls0 ws0">virtual<span class="_ _15"> </span>pages<span class="_ _15"> </span>tend<span class="_ _15"> </span>to<span class="_ _15"> </span>be<span class="_ _21"> </span>large—typically<span class="_ _15"> </span>4<span class="_ _13"> </span>KB<span class="_ _15"> </span>to<span class="_ _15"> </span>2<span class="_ _13"> </span>MB<span class="_ _1"></span>.<span class="_ _15"> </span>Due<span class="_ _15"> </span>to<span class="_ _15"> </span>the<span class="_ _21"> </span>large<span class="_ _15"> </span>miss</div><div class="t m5 x1d h26 y6c88 ff7 fs19 fc1 sc0 ls0 ws0">penalty<span class="_ _3"></span>,<span class="_ _13"> </span>DRAM<span class="_ _13"> </span>caches<span class="_ _13"> </span>are<span class="_ _6"> </span>fully<span class="_ _13"> </span>associative;<span class="_ _13"> </span>that<span class="_ _13"> </span>is<span class="_ _1"></span>,<span class="_ _13"> </span>any<span class="_ _13"> </span>virtual<span class="_ _13"> </span>page<span class="_ _13"> </span>can<span class="_ _13"> </span>be<span class="_ _6"> </span>placed</div><div class="t m5 x1d h26 y6c89 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_ _f"> </span>any<span class="_ _f"> </span>physical<span class="_ _f"> </span>page<span class="_ _0"></span>.<span class="_ _f"> </span>T<span class="_ _1"></span>he<span class="_ _f"> </span>replacement<span class="_ _f"> </span>policy<span class="_ _f"> </span>on<span class="_ _f"> </span>misses<span class="_ _f"> </span>also<span class="_ _f"> </span>assumes<span class="_ _f"> </span>greater</div><div class="t m5 x1d h26 y6c8a ff7 fs19 fc1 sc0 ls0 ws0">importance<span class="_ _1"></span>,<span class="_"> </span>because<span class="_ _13"> </span>the<span class="_"> </span>penalty<span class="_ _13"> </span>associated<span class="_"> </span>with<span class="_ _13"> </span>replacing<span class="_"> </span>the<span class="_ _13"> </span>wrong<span class="_"> </span>virtual<span class="_ _13"> </span>page</div><div class="t m5 x1d h26 y6c8b ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_ _21"> </span>so<span class="_ _21"> </span>high.<span class="_ _21"> </span>T<span class="_ _1"></span>hus<span class="_ _0"></span>,<span class="_ _f"> </span>operating<span class="_ _21"> </span>systems<span class="_ _21"> </span>use<span class="_ _21"> </span>much<span class="_ _21"> </span>more<span class="_ _21"> </span>sophisticated<span class="_ _f"> </span>replacement</div><div class="t m5 x1d h26 y6c8c ff7 fs19 fc1 sc0 ls0 ws0">algorithms<span class="_"> </span>for<span class="_"> </span>DRAM<span class="_ _11"> </span>caches<span class="_"> </span>than<span class="_"> </span>the<span class="_ _11"> </span>hardware<span class="_"> </span>does<span class="_"> </span>for<span class="_ _11"> </span>SRAM<span class="_"> </span>caches<span class="_ _1"></span>.<span class="_"> </span>(These</div><div class="t m5 x1d h26 y6c8d ff7 fs19 fc1 sc0 ls0 ws0">replacement<span class="_"> </span>algorithms<span class="_"> </span>are<span class="_"> </span>beyond<span class="_"> </span>our<span class="_ _13"> </span>scope<span class="_"> </span>here.)<span class="_ _13"> </span>Finally<span class="_ _7"></span>,<span class="_"> </span>because<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>large</div><div class="t m5 x1d h26 y6c8e ff7 fs19 fc1 sc0 ls0 ws0">access<span class="_ _6"> </span>time<span class="_ _13"> </span>of<span class="_ _6"> </span>disk,<span class="_ _13"> </span>DRAM<span class="_ _6"> </span>caches<span class="_ _6"> </span>always<span class="_ _13"> </span>use<span class="_ _6"> </span>write-back<span class="_ _6"> </span>instead<span class="_ _13"> </span>of<span class="_ _6"> </span>write-through.</div><div class="t m5 x1d h41 y226d ffe fs29 fc1 sc0 ls0 ws0">9.3.2<span class="_ _48"> </span><span class="fs19">Page<span class="_"> </span>T<span class="_ _3"></span>ables</span></div><div class="t m5 x1d h26 y587 ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_"> </span>with<span class="_ _11"> </span>any<span class="_"> </span>cache,<span class="_"> </span>the<span class="_"> </span>VM<span class="_"> </span>system<span class="_ _11"> </span>must<span class="_ _11"> </span>have<span class="_"> </span>some<span class="_ _11"> </span>way<span class="_"> </span>to<span class="_ _11"> </span>determine<span class="_"> </span>if<span class="_ _11"> </span>a<span class="_"> </span>virtual</div><div class="t m5 x1d h26 y588 ff7 fs19 fc1 sc0 ls0 ws0">page<span class="_ _14"> </span>is<span class="_ _15"> </span>cached<span class="_ _14"> </span>somewhere<span class="_ _15"> </span>in<span class="_ _14"> </span>DRAM.<span class="_ _15"> </span>If<span class="_ _14"> </span>so<span class="_ _0"></span>,<span class="_ _15"> </span>the<span class="_ _14"> </span>system<span class="_ _15"> </span>must<span class="_ _14"> </span>determine<span class="_ _15"> </span>which</div><div class="t m5 x1d h26 y589 ff7 fs19 fc1 sc0 ls0 ws0">physical<span class="_ _e"> </span>page<span class="_ _e"> </span>it<span class="_ _e"> </span>is<span class="_ _e"> </span>cached<span class="_ _e"> </span>in.<span class="_ _e"> </span>If<span class="_ _e"> </span>there<span class="_ _e"> </span>is<span class="_ _e"> </span>a<span class="_ _e"> </span>miss<span class="_ _1"></span>,<span class="_ _22"> </span>the<span class="_ _e"> </span>system<span class="_ _e"> </span>must<span class="_ _e"> </span>determine</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
