<div id="pf40d" class="pf w2 h11" data-page-no="40d"><div class="pc pc40d w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg40d.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">1036<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>12<span class="_ _3d"> </span>Concurrent<span class="_ _10"> </span>Programming</span></div><div class="t m5 x14 h2f ye7 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>12.20</div><div class="t m5 x14 h2f y58a ffe fs16 fc1 sc0 ls0 ws0">An<span class="_"> </span>example<span class="_"> </span>trajectory<span class="_ _1"></span>.</div><div class="t m5 xe0 h3f y81a9 ffed fs27 fc1 sc0 ls0 ws0">Thread 2</div><div class="t m5 xb9 h3f y81aa ffed fs27 fc1 sc0 ls0 ws0">Thread 1</div><div class="t m5 xc3 h3f y81ab ffee fs27 fc1 sc0 ls0 ws0">T</div><div class="t m5 x135 h65 y81ac ffed fs38 fc1 sc0 ls0 ws0">2</div><div class="t m5 xc3 h3f y81ad ffee fs27 fc1 sc0 ls0 ws0">S</div><div class="t m5 x112 h65 y81ae ffed fs38 fc1 sc0 ls0 ws0">2</div><div class="t m5 xc3 h3f y81af ffee fs27 fc1 sc0 ls0 ws0">U</div><div class="t m5 x112 h65 y81b0 ffed fs38 fc1 sc0 ls0 ws0">2</div><div class="t m5 x141 h3f y81b1 ffee fs27 fc1 sc0 ls0 ws0">L</div><div class="t m5 x135 h65 y81b2 ffed fs38 fc1 sc0 ls0 ws0">2</div><div class="t m5 xc3 h3f y81b3 ffee fs27 fc1 sc0 ls0 ws0">H</div><div class="t m5 x112 h65 y81b4 ffed fs38 fc1 sc0 ls0 ws0">2</div><div class="t m5 xf8 h3f y81b5 ffee fs27 fc1 sc0 ls0 ws0">H</div><div class="t m5 xd h65 y81b6 ffed fs38 fc1 sc0 ls0 ws0">1</div><div class="t m5 xe2 h3f y81b5 ffee fs27 fc1 sc0 ls0 ws0">L</div><div class="t m5 xba h65 y81b6 ffed fs38 fc1 sc0 ls0 ws0">1</div><div class="t m5 xaa h3f y81b5 ffee fs27 fc1 sc0 ls0 ws0">U</div><div class="t m5 x24e h65 y81b6 ffed fs38 fc1 sc0 ls0 ws0">1</div><div class="t m5 x215 h3f y81b5 ffee fs27 fc1 sc0 ls0 ws0">S</div><div class="t m5 x39 h65 y81b6 ffed fs38 fc1 sc0 ls0 ws0">1</div><div class="t m5 xfb h3f y81b5 ffee fs27 fc1 sc0 ls0 ws0">T</div><div class="t m5 x1bb h65 y81b6 ffed fs38 fc1 sc0 ls0 ws0">1</div><div class="t m5 x29 h26 y81b7 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _15"> </span>execution<span class="_ _14"> </span>history<span class="_ _14"> </span>of<span class="_ _15"> </span>a<span class="_ _14"> </span>program<span class="_ _14"> </span>is<span class="_ _15"> </span>modeled<span class="_ _14"> </span>as<span class="_ _14"> </span>a<span class="_ _15"> </span><span class="ffa">trajectory<span class="_ _14"> </span></span>through<span class="_ _14"> </span>the</div><div class="t m5 x1d h26 y81b8 ff7 fs19 fc1 sc0 ls0 ws0">state<span class="_ _16"> </span>space<span class="_ _0"></span>.<span class="_ _16"> </span>F<span class="_ _1"></span>igure<span class="_ _14"> </span>12.20<span class="_ _16"> </span>shows<span class="_ _16"> </span>the<span class="_ _16"> </span>trajectory<span class="_ _16"> </span>that<span class="_ _14"> </span>corresponds<span class="_ _16"> </span>to<span class="_ _16"> </span>the<span class="_ _16"> </span>following</div><div class="t m5 x1d h26 y81b9 ff7 fs19 fc1 sc0 ls0 ws0">instruction<span class="_"> </span>ordering:</div><div class="t m5 xed h45 y81ba ff11 fs19 fc1 sc0 ls0 ws0">H</div><div class="t m5 xec h3c y81bb ff7 fs25 fc1 sc0 ls0 ws0">1</div><div class="t m5 xfa h45 y81bc ff11 fs19 fc1 sc0 ls42 ws0">,L</div><div class="t m5 x9e h3c y81bb ff7 fs25 fc1 sc0 ls0 ws0">1</div><div class="t m5 x68 h45 y81bd ff11 fs19 fc1 sc0 ls42 ws0">,U</div><div class="t m5 x24e h3c y81bb ff7 fs25 fc1 sc0 ls0 ws0">1</div><div class="t m5 x198 h45 y81bd ff11 fs19 fc1 sc0 ls42 ws0">,H</div><div class="t m5 x130 h3c y81be ff7 fs25 fc1 sc0 ls0 ws0">2</div><div class="t m5 x179 h45 y81bd ff11 fs19 fc1 sc0 ls42 ws0">,L</div><div class="t m5 xd8 h3c y81be ff7 fs25 fc1 sc0 ls0 ws0">2</div><div class="t m5 x250 h45 y81bf ff11 fs19 fc1 sc0 ls42 ws0">,S</div><div class="t m5 x1c9 h3c y81be ff7 fs25 fc1 sc0 ls0 ws0">1</div><div class="t m5 x1c2 h45 y81bf ff11 fs19 fc1 sc0 ls42 ws0">,T</div><div class="t m5 x1ad h3c y81be ff7 fs25 fc1 sc0 ls0 ws0">1</div><div class="t m5 xb0 h45 y81bf ff11 fs19 fc1 sc0 ls42 ws0">,U</div><div class="t m5 x163 h3c y81be ff7 fs25 fc1 sc0 ls0 ws0">2</div><div class="t m5 xda h45 y81bf ff11 fs19 fc1 sc0 ls42 ws0">,S</div><div class="t m5 xa h3c y81be ff7 fs25 fc1 sc0 ls0 ws0">2</div><div class="t m5 x108 h45 y81bf ff11 fs19 fc1 sc0 ls42 ws0">,T</div><div class="t m5 xb6 h3c y81be ff7 fs25 fc1 sc0 ls0 ws0">2</div><div class="t m5 x29 h26 ya89 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_"> </span>thread<span class="_ _11"> </span><span class="ff11">i<span class="_ _5"></span></span>,<span class="_ _11"> </span>the<span class="_"> </span>instructions<span class="_ _11"> </span><span class="ff11">(L</span></div><div class="t m5 xfd h50 y81c0 ff11 fs25 fc1 sc0 ls0 ws0">i</div><div class="t m5 x99 h45 ya89 ff11 fs19 fc1 sc0 ls83 ws0">,U</div><div class="t m5 x1db h50 y81c0 ff11 fs25 fc1 sc0 ls0 ws0">i</div><div class="t m5 x199 h45 ya89 ff11 fs19 fc1 sc0 ls83 ws0">,S</div><div class="t m5 x1c9 h50 y81c0 ff11 fs25 fc1 sc0 ls0 ws0">i</div><div class="t m5 xfb h26 ya89 ff11 fs19 fc1 sc0 ls0 ws0">)<span class="_ _10"> </span><span class="ff7">that<span class="_ _11"> </span>manipulate<span class="_ _11"> </span>the<span class="_ _11"> </span>contents<span class="_"> </span>of<span class="_ _11"> </span>the</span></div><div class="t m5 x1d h26 ya8a ff7 fs19 fc1 sc0 ls0 ws0">shared<span class="_ _16"> </span>variable<span class="_ _16"> </span><span class="ffd">cnt<span class="_ _14"> </span></span>constitute<span class="_ _16"> </span>a<span class="_ _16"> </span><span class="ffa">critical<span class="_ _16"> </span>section<span class="_ _16"> </span></span>(with<span class="_ _14"> </span>respect<span class="_ _16"> </span>to<span class="_ _16"> </span>shared<span class="_ _14"> </span>variable</div><div class="t m5 x1d h26 ya8b ffd fs19 fc1 sc0 ls0 ws0">cnt<span class="ff7">)<span class="_ _13"> </span>that<span class="_ _13"> </span>should<span class="_ _13"> </span>not<span class="_"> </span>be<span class="_ _13"> </span>interleaved<span class="_ _13"> </span>with<span class="_ _13"> </span>the<span class="_ _13"> </span>critical<span class="_ _13"> </span>section<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>other<span class="_ _13"> </span>thread.<span class="_ _13"> </span>In</span></div><div class="t m5 x1d h26 ya8c ff7 fs19 fc1 sc0 ls0 ws0">other<span class="_"> </span>words<span class="_ _1"></span>,<span class="_ _11"> </span>we<span class="_"> </span>want<span class="_ _11"> </span>to<span class="_"> </span>ensure<span class="_ _11"> </span>that<span class="_"> </span>each<span class="_ _11"> </span>thread<span class="_ _11"> </span>has<span class="_"> </span><span class="ffa">mutually<span class="_ _11"> </span>exclusive<span class="_"> </span>access<span class="_ _11"> </span></span>to</div><div class="t m5 x1d h26 ya8d ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>shared<span class="_ _13"> </span>variable<span class="_"> </span>while<span class="_"> </span>it<span class="_ _13"> </span>is<span class="_"> </span>executing<span class="_"> </span>the<span class="_ _13"> </span>instructions<span class="_"> </span>in<span class="_"> </span>its<span class="_ _13"> </span>critical<span class="_"> </span>section.<span class="_"> </span>T<span class="_ _1"></span>he</div><div class="t m5 x1d h26 ya8e ff7 fs19 fc1 sc0 ls0 ws0">phenomenon<span class="_"> </span>in<span class="_"> </span>general<span class="_"> </span>is<span class="_"> </span>known<span class="_"> </span>as<span class="_"> </span><span class="ffa">mutual<span class="_"> </span>exclusion</span>.</div><div class="t m5 x29 h26 ya8f ff7 fs19 fc1 sc0 ls0 ws0">On<span class="_ _14"> </span>the<span class="_ _15"> </span>progress<span class="_ _14"> </span>graph,<span class="_ _15"> </span>the<span class="_ _15"> </span>intersection<span class="_ _14"> </span>of<span class="_ _15"> </span>the<span class="_ _14"> </span>two<span class="_ _15"> </span>critical<span class="_ _14"> </span>sections<span class="_ _14"> </span>deﬁnes</div><div class="t m5 x1d h26 ya90 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_ _14"> </span>region<span class="_ _15"> </span>of<span class="_ _15"> </span>the<span class="_ _15"> </span>state<span class="_ _14"> </span>space<span class="_ _15"> </span>known<span class="_ _15"> </span>as<span class="_ _14"> </span>an<span class="_ _15"> </span><span class="ffa">unsafe<span class="_ _15"> </span>region</span>.<span class="_ _14"> </span>Figure<span class="_ _14"> </span>12.21<span class="_ _14"> </span>shows<span class="_ _15"> </span>the</div><div class="t m5 x1d h26 ya91 ff7 fs19 fc1 sc0 ls0 ws0">unsafe<span class="_ _11"> </span>region<span class="_ _11"> </span>for<span class="_ _11"> </span>the<span class="_ _11"> </span>variable<span class="_ _11"> </span><span class="ffd">cnt</span>.<span class="_ _11"> </span>Notice<span class="_ _11"> </span>that<span class="_ _11"> </span>the<span class="_ _11"> </span>unsafe<span class="_ _11"> </span>region<span class="_ _11"> </span>abuts<span class="_ _1"></span>,<span class="_ _11"> </span>but<span class="_ _11"> </span>does</div><div class="t m5 x1d h26 ya92 ff7 fs19 fc1 sc0 ls0 ws0">not<span class="_ _6"> </span>include<span class="_ _0"></span>,<span class="_ _6"> </span>the<span class="_ _13"> </span>states<span class="_ _a"> </span>along<span class="_ _6"> </span>its<span class="_ _13"> </span>perimeter<span class="_ _1"></span>.<span class="_ _6"> </span>F<span class="_ _0"></span>or<span class="_ _6"> </span>example<span class="_ _1"></span>,<span class="_ _13"> </span>states<span class="_ _6"> </span><span class="ff11">(H</span></div><div class="t m5 x172 h3c yb95 ff7 fs25 fc1 sc0 ls0 ws0">1</div><div class="t m5 x11d h45 y631 ff11 fs19 fc1 sc0 ls2f2 ws0">,H</div><div class="t m5 x97 h3c yb95 ff7 fs25 fc1 sc0 ls0 ws0">2</div><div class="t m5 x224 h26 y631 ff11 fs19 fc1 sc0 ls0 ws0">)<span class="_ _6"> </span><span class="ff7">and<span class="_ _6"> </span></span>(S</div><div class="t m5 x14f h3c yb95 ff7 fs25 fc1 sc0 ls0 ws0">1</div><div class="t m5 x102 h45 y631 ff11 fs19 fc1 sc0 ls2f2 ws0">,U</div><div class="t m5 x211 h3c yb95 ff7 fs25 fc1 sc0 ls0 ws0">2</div><div class="t m5 x128 h45 y631 ff11 fs19 fc1 sc0 ls0 ws0">)</div><div class="t m5 x1d h26 y632 ff7 fs19 fc1 sc0 ls0 ws0">abut<span class="_ _6"> </span>the<span class="_ _6"> </span>unsafe<span class="_ _6"> </span>region,<span class="_ _13"> </span>but<span class="_ _6"> </span>they<span class="_ _6"> </span>are<span class="_ _13"> </span>not<span class="_ _a"> </span>part<span class="_ _6"> </span>of<span class="_ _13"> </span>it.<span class="_ _a"> </span>A<span class="_ _6"> </span>trajectory<span class="_ _13"> </span>that<span class="_ _a"> </span>skirts<span class="_ _13"> </span>the<span class="_ _a"> </span>unsafe</div><div class="t m5 x1d h26 y633 ff7 fs19 fc1 sc0 ls0 ws0">region<span class="_ _13"> </span>is<span class="_"> </span>known<span class="_ _13"> </span>as<span class="_"> </span>a<span class="_ _13"> </span><span class="ffa">safe<span class="_"> </span>trajectory<span class="_ _0"></span><span class="ff7">.<span class="_"> </span>Conversely<span class="_ _7"></span>,<span class="_"> </span>a<span class="_ _13"> </span>trajectory<span class="_"> </span>that<span class="_ _13"> </span>touches<span class="_ _13"> </span>any<span class="_"> </span>part</span></span></div><div class="t m5 x1d h26 y634 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_ _11"> </span>the<span class="_ _16"> </span>unsafe<span class="_ _11"> </span>region<span class="_ _11"> </span>is<span class="_ _16"> </span>an<span class="_ _11"> </span><span class="ffa">unsafe<span class="_ _16"> </span>trajectory</span>.<span class="_"> </span>Figure<span class="_"> </span>12.21<span class="_ _16"> </span>shows<span class="_ _11"> </span>examples<span class="_ _16"> </span>of<span class="_ _11"> </span>safe</div><div class="t m5 x1d h26 y635 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _13"> </span>unsafe<span class="_ _6"> </span>trajectories<span class="_ _13"> </span>through<span class="_ _6"> </span>the<span class="_ _13"> </span>state<span class="_ _6"> </span>space<span class="_ _13"> </span>of<span class="_ _6"> </span>our<span class="_ _13"> </span>example<span class="_ _6"> </span><span class="ffd">badcnt.c<span class="_ _13"> </span></span>program.</div><div class="t m5 x1d h26 y636 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>upper<span class="_"> </span>trajectory<span class="_"> </span>skirts<span class="_"> </span>the<span class="_ _13"> </span>unsafe<span class="_"> </span>region<span class="_"> </span>along<span class="_"> </span>its<span class="_"> </span>left<span class="_ _13"> </span>and<span class="_"> </span>top<span class="_"> </span>sides<span class="_ _1"></span>,<span class="_"> </span>and<span class="_"> </span>thus</div><div class="t m5 x1d h26 y637 ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_"> </span>safe<span class="_ _1"></span>.<span class="_"> </span>The<span class="_"> </span>lower<span class="_"> </span>trajectory<span class="_"> </span>crosses<span class="_"> </span>the<span class="_"> </span>unsafe<span class="_"> </span>region,<span class="_"> </span>and<span class="_"> </span>thus<span class="_"> </span>is<span class="_"> </span>unsafe<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y638 ff7 fs19 fc1 sc0 ls0 ws0">Any<span class="_ _f"> </span>safe<span class="_ _f"> </span>trajectory<span class="_ _f"> </span>will<span class="_ _f"> </span>correctly<span class="_ _f"> </span>update<span class="_ _f"> </span>the<span class="_ _f"> </span>shared<span class="_ _f"> </span>counter.<span class="_ _f"> </span>In<span class="_ _f"> </span>order<span class="_ _f"> </span>to</div><div class="t m5 x1d h26 y639 ff7 fs19 fc1 sc0 ls0 ws0">guarantee<span class="_"> </span>correct<span class="_ _11"> </span>execution<span class="_"> </span>of<span class="_ _11"> </span>our<span class="_ _11"> </span>example<span class="_"> </span>threaded<span class="_ _11"> </span>program—and<span class="_ _11"> </span>indeed<span class="_"> </span>any</div><div class="t m5 x1d h26 y63a ff7 fs19 fc1 sc0 ls0 ws0">concurrent<span class="_ _16"> </span>program<span class="_ _16"> </span>that<span class="_ _16"> </span>shares<span class="_ _16"> </span>global<span class="_ _16"> </span>data<span class="_ _16"> </span>structures—we<span class="_ _16"> </span>must<span class="_ _16"> </span>somehow<span class="_ _16"> </span><span class="ffa">syn-</span></div><div class="t m5 x1d h26 y63b ffa fs19 fc1 sc0 ls0 ws0">chroniz<span class="_ _0"></span>e<span class="_ _13"> </span><span class="ff7">the<span class="_"> </span>threads<span class="_ _13"> </span>so<span class="_ _13"> </span>that<span class="_ _13"> </span>they<span class="_"> </span>always<span class="_ _13"> </span>have<span class="_ _13"> </span>a<span class="_ _13"> </span>safe<span class="_"> </span>trajectory<span class="_ _7"></span>.<span class="_"> </span>A<span class="_ _13"> </span>classic<span class="_ _13"> </span>approach</span></div><div class="t m5 x1d h26 y63c ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_"> </span>based<span class="_"> </span>on<span class="_"> </span>the<span class="_"> </span>idea<span class="_"> </span>of<span class="_"> </span>a<span class="_"> </span>semaphore<span class="_ _1"></span>,<span class="_"> </span>which<span class="_"> </span>we<span class="_"> </span>introduce<span class="_"> </span>next.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
