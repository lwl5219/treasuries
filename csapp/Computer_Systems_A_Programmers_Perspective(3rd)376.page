<div id="pf178" class="pf w2 h11" data-page-no="178"><div class="pc pc178 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg178.png"/><div class="t m5 x107 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Solutions<span class="_ _10"> </span>to<span class="_ _10"> </span>Practice<span class="_ _10"> </span>Problems<span class="_ _1b"> </span><span class="ffe fs1e">375</span></div><div class="t m5 x1b6 h2d y140c ffd fs1e fc2 sc0 ls0 ws0">case<span class="_ _e"> </span>2:</div><div class="t m5 x1b6 h2d y140d ffd fs1e fc2 sc0 ls0 ws0">case<span class="_ _e"> </span>7:</div><div class="t m5 x21e h2d y1b95 ffd fs1e fc2 sc0 ls33 ws0">v<span class="_ _41"></span>a<span class="_ _41"></span>l=(<span class="_ _41"></span>c+b<span class="_ _41"></span>)&lt;<span class="_ _41"></span>&lt;2<span class="_ _41"></span>;</div><div class="t m5 x21e h2d y2122 ffd fs1e fc2 sc0 ls0 ws0">break;</div><div class="t m5 x1b6 h2d y1b96 ffd fs1e fc2 sc0 ls0 ws0">case<span class="_ _e"> </span>4:</div><div class="t m5 x21e h2d y1b97 ffd fs1e fc2 sc0 ls33 ws0">v<span class="_ _41"></span>a<span class="_ _41"></span>l=a<span class="_ _41"></span>;</div><div class="t m5 x21e h2d y1b98 ffd fs1e fc2 sc0 ls0 ws0">break;</div><div class="t m5 x1b6 h2d y34a6 ffd fs1e fc2 sc0 ls0 ws0">default:</div><div class="t m5 x21e h2d y34a7 ffd fs1e fc2 sc0 ls33 ws0">v<span class="_ _41"></span>a<span class="_ _41"></span>l=b<span class="_ _41"></span>;</div><div class="t m5 x1b6 h2d y34a8 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x1b6 h2d y34a9 ffd fs1e fc2 sc0 ls0 ws0">*dest<span class="_ _e"> </span>=<span class="_ _1f"> </span>val;</div><div class="t m5 x17 h2d y34aa ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x17 h28 y34ab ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>3.32</div><div class="t m5 x112 h2f y34ac ffe fs16 fc6 sc0 ls0 ws0">(page<span class="_"> </span>280)</div><div class="t m5 x17 h26 y34ad ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _7"></span>racing<span class="_ _21"> </span>through<span class="_ _15"> </span>the<span class="_ _21"> </span>program<span class="_ _15"> </span>execution<span class="_ _21"> </span>at<span class="_ _21"> </span>this<span class="_ _15"> </span>level<span class="_ _21"> </span>of<span class="_ _15"> </span>detail<span class="_ _21"> </span>reinforces<span class="_ _21"> </span>many</div><div class="t m5 x17 h26 y34ae ff7 fs19 fc1 sc0 ls0 ws0">aspects<span class="_"> </span>of<span class="_"> </span>procedure<span class="_ _11"> </span>call<span class="_"> </span>and<span class="_ _11"> </span>return.<span class="_"> </span>W<span class="_ _1"></span>e<span class="_"> </span>can<span class="_ _11"> </span>see<span class="_"> </span>clearly<span class="_"> </span>how<span class="_ _11"> </span>control<span class="_"> </span>is<span class="_ _11"> </span>passed<span class="_"> </span>to</div><div class="t m5 x17 h26 y34af ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>function<span class="_"> </span>when<span class="_"> </span>it<span class="_ _11"> </span>is<span class="_"> </span>called,<span class="_"> </span>and<span class="_"> </span>how<span class="_ _11"> </span>the<span class="_"> </span>calling<span class="_"> </span>function<span class="_ _11"> </span>resumes<span class="_"> </span>upon<span class="_"> </span>return.</div><div class="t m5 x17 h26 y34b0 ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_"> </span>can<span class="_ _11"> </span>also<span class="_"> </span>see<span class="_"> </span>how<span class="_ _11"> </span>arguments<span class="_"> </span>get<span class="_"> </span>passed<span class="_"> </span>through<span class="_ _11"> </span>registers<span class="_"> </span><span class="ffd">%rdi<span class="_ _11"> </span></span>and<span class="_"> </span><span class="ffd">%rsi</span>,<span class="_"> </span>and</div><div class="t m5 x17 h26 y34b1 ff7 fs19 fc1 sc0 ls0 ws0">how<span class="_"> </span>results<span class="_"> </span>are<span class="_"> </span>returned<span class="_"> </span>via<span class="_"> </span>register<span class="_"> </span><span class="ffd">%rax</span>.</div><div class="t m5 x1da h31 y34b2 ff7 fs21 fc2 sc0 ls0 ws0">Instruction<span class="_ _27"> </span>State<span class="_"> </span>values<span class="_"> </span>(at<span class="_"> </span>beginning)</div><div class="t m5 x17 h31 y34b3 ff7 fs21 fc2 sc0 ls0 ws0">Label<span class="_ _ea"> </span>PC<span class="_ _7f"> </span>Instruction<span class="_ _3d"> </span><span class="ffd fs1e">%rdi<span class="_ _ea"> </span>%rsi<span class="_ _ea"> </span>%rax<span class="_ _88"> </span>%rsp<span class="_ _6d"> </span>*%rsp<span class="_ _103"> </span></span>Description</div><div class="t m5 x17 h31 y34b4 ff7 fs21 fc2 sc0 ls0 ws0">M1<span class="_ _95"> </span><span class="ffd fs1e">0x400560<span class="_ _ea"> </span>callq<span class="_ _18c"> </span></span><span class="ls19d">1<span class="_ _c8"></span>0——<span class="_ _c4"></span><span class="ffd fs1e ls0">0x7fffffffe820<span class="_ _14a"> </span><span class="ff7 fs21">—<span class="_ _4f"> </span>Call<span class="_"> </span></span>first(10)</span></span></div><div class="t m5 x17 h31 y34b5 ff7 fs21 fc2 sc0 ls0 ws0">F1<span class="_ _76"> </span><span class="ffd fs1e">0x400548<span class="_ _ea"> </span>lea<span class="_ _5d"> </span></span><span class="ls19d">1<span class="_ _c8"></span>0——<span class="_ _c4"></span><span class="ffd fs1e ls0">0x7fffffffe818<span class="_ _3d"> </span>0x400565<span class="_ _ea"> </span><span class="ff7 fs21">Entry<span class="_"> </span>of<span class="_"> </span></span>first</span></span></div><div class="t m5 x17 h31 y34b6 ff7 fs21 fc2 sc0 ls0 ws0">F2</div><div class="t m5 x19f h31 y34b7 ffd fs1e fc2 sc0 ls0 ws0">0x40054c<span class="_ _ea"> </span>sub<span class="_ _5d"> </span><span class="ff7 fs21">10<span class="_ _7b"> </span>11<span class="_ _7b"> </span>—<span class="_ _18"> </span></span>0x7fffffffe818<span class="_ _ea"> </span>0x400565</div><div class="t m5 x17 h31 y34b8 ff7 fs21 fc2 sc0 ls0 ws0">F3<span class="_ _76"> </span><span class="ffd fs1e">0x400550<span class="_ _ea"> </span>callq<span class="_ _20"> </span></span><span class="ls19e">91<span class="_ _b8"></span>1<span class="_ _4a"></span>—<span class="_ _193"></span><span class="ffd fs1e ls0">0x7fffffffe818<span class="_ _ea"> </span>0x400565<span class="_ _ea"> </span><span class="ff7 fs21">Call<span class="_"> </span></span>last(9,<span class="_ _11"> </span>11)</span></span></div><div class="t m5 x17 h31 y34b9 ff7 fs21 fc2 sc0 ls0 ws0">L1<span class="_ _8b"> </span><span class="ffd fs1e">0x400540<span class="_ _ea"> </span>mov</span></div><div class="t m5 x48 h31 y34ba ff7 fs21 fc2 sc0 ls19e ws0">91<span class="_ _b8"></span>1<span class="_ _4a"></span>—<span class="_ _c3"></span><span class="ffd fs1e ls0">0x7fffffffe810<span class="_ _ea"> </span>0x400555<span class="_ _ea"> </span><span class="ff7 fs21">Entry<span class="_"> </span>of<span class="_"> </span></span>last</span></div><div class="t m5 x17 h31 y34bb ff7 fs21 fc2 sc0 ls0 ws0">L2<span class="_ _8b"> </span><span class="ffd fs1e">0x400543<span class="_ _ea"> </span>imul<span class="_ _ed"> </span></span><span class="ls19e">91<span class="_ _b8"></span>19<span class="_ _c4"></span><span class="ffd fs1e ls0">0x7fffffffe810<span class="_ _3d"> </span>0x400555</span></span></div><div class="t m5 x17 h31 y34bc ff7 fs21 fc2 sc0 ls0 ws0">L3<span class="_ _8b"> </span><span class="ffd fs1e">0x400547<span class="_ _ea"> </span>retq</span></div><div class="t m5 x48 h31 y34bd ff7 fs21 fc2 sc0 ls19e ws0">91<span class="_ _b8"></span>1<span class="_ _4a"></span>9<span class="_ _b8"></span>9<span class="_ _c3"></span><span class="ffd fs1e ls0">0x7fffffffe810<span class="_ _ea"> </span>0x400555<span class="_ _ea"> </span><span class="ff7 fs21">Return<span class="_"> </span>99<span class="_"> </span>from<span class="_"> </span></span>last</span></div><div class="t m5 x17 h31 y34be ff7 fs21 fc2 sc0 ls0 ws0">F4<span class="_ _76"> </span><span class="ffd fs1e">0x400555<span class="_ _ea"> </span>repz<span class="_ _11"> </span>repq<span class="_ _5e"> </span></span><span class="ls19e">91<span class="_ _b8"></span>1<span class="_ _4a"></span>9<span class="_ _b8"></span>9<span class="_ _c3"></span><span class="ffd fs1e ls0">0x7fffffffe818<span class="_ _ea"> </span>0x400565<span class="_ _ea"> </span><span class="ff7 fs21">Return<span class="_"> </span>99<span class="_"> </span>from<span class="_"> </span></span>first</span></span></div><div class="t m5 x17 h31 y34bf ff7 fs21 fc2 sc0 ls0 ws0">M2<span class="_ _95"> </span><span class="ffd fs1e">0x400565<span class="_ _ea"> </span>mov<span class="_ _55"> </span></span><span class="ls19e">91<span class="_ _194"></span>1<span class="_ _4a"></span>9<span class="_ _b8"></span>9<span class="_ _c3"></span><span class="ffd fs1e ls0">0x7fffffffe820<span class="_ _14a"> </span><span class="ff7 fs21">—<span class="_ _14a"> </span>Resume<span class="_"> </span></span>main</span></span></div><div class="t m5 x17 h28 y34c0 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>3.33</div><div class="t m5 x112 h2f y34c1 ffe fs16 fc6 sc0 ls0 ws0">(page<span class="_"> </span>282)</div><div class="t m5 x17 h26 yec2 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>problem<span class="_"> </span>is<span class="_"> </span>a<span class="_"> </span>bit<span class="_"> </span>tricky<span class="_"> </span>due<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>mixing<span class="_"> </span>of<span class="_"> </span>different<span class="_"> </span>data<span class="_"> </span>sizes<span class="_ _1"></span>.</div><div class="t m5 x26 h26 yec3 ff7 fs19 fc1 sc0 ls0 ws0">Let<span class="_ _14"> </span>us<span class="_ _14"> </span>ﬁrst<span class="_ _14"> </span>describe<span class="_ _15"> </span>one<span class="_ _14"> </span>answer<span class="_ _14"> </span>and<span class="_ _14"> </span>then<span class="_ _15"> </span>explain<span class="_ _14"> </span>the<span class="_ _14"> </span>second<span class="_ _14"> </span>possibility<span class="_ _3"></span>.<span class="_ _14"> </span>If</div><div class="t m5 x17 h26 yec4 ff7 fs19 fc1 sc0 ls0 ws0">we<span class="_ _13"> </span>assume<span class="_ _13"> </span>the<span class="_ _13"> </span>ﬁrst<span class="_"> </span>addition<span class="_ _13"> </span>(line<span class="_ _13"> </span>3)<span class="_ _13"> </span>implements<span class="_ _13"> </span><span class="ffd">*u<span class="_ _16"> </span>+=<span class="_ _11"> </span>a</span>,<span class="_"> </span>while<span class="_ _13"> </span>the<span class="_ _13"> </span>second<span class="_ _13"> </span>(line<span class="_ _13"> </span>4)</div><div class="t m5 x17 h26 yec5 ff7 fs19 fc1 sc0 ls0 ws0">implements<span class="_ _13"> </span><span class="ffd ls4b">v+<span class="_ _49"></span>=b<span class="_ _42"></span><span class="ff7 ls0">,<span class="_"> </span>then<span class="_ _6"> </span>we<span class="_ _13"> </span>can<span class="_ _13"> </span>see<span class="_ _13"> </span>that<span class="_ _13"> </span><span class="ffd">a<span class="_ _13"> </span></span>was<span class="_ _13"> </span>passed<span class="_ _13"> </span>as<span class="_ _13"> </span>the<span class="_ _13"> </span>ﬁrst<span class="_ _6"> </span>argument<span class="_ _13"> </span>in<span class="_ _13"> </span><span class="ffd">%edi</span></span></span></div><div class="t m5 x17 h26 yec6 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _13"> </span>converted<span class="_ _13"> </span>from<span class="_ _13"> </span>4<span class="_ _13"> </span>bytes<span class="_"> </span>to<span class="_ _13"> </span>8<span class="_ _13"> </span>before<span class="_ _13"> </span>adding<span class="_ _13"> </span>it<span class="_ _13"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>8<span class="_"> </span>bytes<span class="_ _13"> </span>pointed<span class="_ _13"> </span>to<span class="_ _13"> </span>by<span class="_ _13"> </span><span class="ffd">%rdx</span>.</div><div class="t m5 x17 h26 yec7 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>implies<span class="_"> </span>that<span class="_ _13"> </span><span class="ffd">a<span class="_ _10"> </span></span>must<span class="_"> </span>be<span class="_ _13"> </span>of<span class="_"> </span>type<span class="_ _13"> </span><span class="ffd">int<span class="_ _10"> </span></span>and<span class="_"> </span><span class="ffd">u<span class="_ _13"> </span></span>must<span class="_"> </span>be<span class="_"> </span>of<span class="_ _13"> </span>type<span class="_"> </span><span class="ffd">long<span class="_ _11"> </span>*</span>.<span class="_"> </span>W<span class="_ _3"></span>e<span class="_"> </span>can<span class="_"> </span>also</div><div class="t m5 x17 h26 yec8 ff7 fs19 fc1 sc0 ls0 ws0">see<span class="_ _13"> </span>that<span class="_"> </span>the<span class="_ _13"> </span>low-order<span class="_ _13"> </span>byte<span class="_ _13"> </span>of<span class="_"> </span>argument<span class="_ _13"> </span><span class="ffd">b<span class="_ _13"> </span></span>is<span class="_ _13"> </span>added<span class="_"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>byte<span class="_"> </span>pointed<span class="_ _13"> </span>to<span class="_ _13"> </span>by<span class="_ _13"> </span><span class="ffd">%rcx</span>.</div><div class="t m5 x17 h26 yec9 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _13"> </span>implies<span class="_ _13"> </span>that<span class="_ _6"> </span><span class="ffd">v<span class="_ _13"> </span></span>must<span class="_ _13"> </span>be<span class="_ _6"> </span>of<span class="_ _13"> </span>type<span class="_ _13"> </span><span class="ffd">char<span class="_ _11"> </span>*</span>,<span class="_ _13"> </span>but<span class="_ _13"> </span>the<span class="_ _6"> </span>type<span class="_ _13"> </span>of<span class="_ _13"> </span><span class="ffd">b<span class="_ _6"> </span></span>is<span class="_ _13"> </span>ambiguous—it<span class="_ _13"> </span>could</div><div class="t m5 x17 h26 yeca ff7 fs19 fc1 sc0 ls0 ws0">be<span class="_"> </span>1,<span class="_ _13"> </span>2,<span class="_"> </span>4,<span class="_"> </span>or<span class="_ _13"> </span>8<span class="_"> </span>bytes<span class="_"> </span>long<span class="_ _0"></span>.<span class="_"> </span>T<span class="_ _1"></span>his<span class="_"> </span>ambiguity<span class="_ _13"> </span>is<span class="_"> </span>resolved<span class="_"> </span>by<span class="_ _13"> </span>noting<span class="_"> </span>the<span class="_ _13"> </span>return<span class="_"> </span>value<span class="_"> </span>of</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
