<div id="pf1b6" class="pf w2 h11" data-page-no="1b6"><div class="pc pc1b6 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1b6.png"/><div class="t m5 x99 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>4.3<span class="_ _60"> </span>Sequential<span class="_ _10"> </span>Y86-64<span class="_ _10"> </span>Implementations<span class="_ _3e"> </span><span class="ffe fs1e">437</span></div><div class="t m5 x17 h26 y9c ff7 fs19 fc2 sc0 ls0 ws0">memories<span class="_ _13"> </span>(such<span class="_ _13"> </span>as<span class="_ _13"> </span>the<span class="_ _6"> </span>register<span class="_ _13"> </span>ﬁle),<span class="_ _13"> </span>and<span class="_ _13"> </span>we<span class="_ _13"> </span>can<span class="_ _13"> </span>mimic<span class="_ _13"> </span>this<span class="_ _13"> </span>effect<span class="_ _13"> </span>for<span class="_ _6"> </span>larger<span class="_ _13"> </span>circuits</div><div class="t m5 x17 h26 y409 ff7 fs19 fc2 sc0 ls0 ws0">using<span class="_ _15"> </span>special<span class="_ _15"> </span>clock<span class="_ _15"> </span>circuits<span class="_ _1"></span>.<span class="_ _15"> </span>Since<span class="_ _15"> </span>our<span class="_ _15"> </span>instruction<span class="_ _15"> </span>memory<span class="_ _15"> </span>is<span class="_ _15"> </span>only<span class="_ _15"> </span>used<span class="_ _15"> </span>to<span class="_ _15"> </span>read</div><div class="t m5 x17 h26 y40a ff7 fs19 fc2 sc0 ls0 ws0">instructions<span class="_ _1"></span>,<span class="_"> </span>we<span class="_"> </span>can<span class="_"> </span>therefore<span class="_"> </span>treat<span class="_"> </span>this<span class="_"> </span>unit<span class="_"> </span>as<span class="_"> </span>if<span class="_"> </span>it<span class="_"> </span>were<span class="_"> </span>combinational<span class="_"> </span>logic.</div><div class="t m5 x26 h26 y40b ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _f"> </span>are<span class="_ _21"> </span>left<span class="_ _f"> </span>with<span class="_ _f"> </span>just<span class="_ _f"> </span>four<span class="_ _21"> </span>hardware<span class="_ _f"> </span>units<span class="_ _f"> </span>that<span class="_ _f"> </span>require<span class="_ _21"> </span>an<span class="_ _f"> </span>explicit<span class="_ _f"> </span>control</div><div class="t m5 x17 h26 y40c ff7 fs19 fc2 sc0 ls0 ws0">over<span class="_ _13"> </span>their<span class="_ _13"> </span>sequencing—the<span class="_ _13"> </span>program<span class="_ _6"> </span>counter,<span class="_ _13"> </span>the<span class="_ _13"> </span>condition<span class="_ _13"> </span>code<span class="_ _13"> </span>register<span class="_ _1"></span>,<span class="_ _13"> </span>the<span class="_ _13"> </span>data</div><div class="t m5 x17 h26 y40d ff7 fs19 fc2 sc0 ls0 ws0">memory<span class="_ _3"></span>,<span class="_ _16"> </span>and<span class="_ _16"> </span>the<span class="_ _16"> </span>register<span class="_ _11"> </span>ﬁle.<span class="_ _11"> </span>T<span class="_ _0"></span>hese<span class="_ _16"> </span>are<span class="_ _16"> </span>controlled<span class="_ _11"> </span>via<span class="_ _16"> </span>a<span class="_ _16"> </span>single<span class="_ _16"> </span>clock<span class="_ _16"> </span>signal<span class="_ _11"> </span>that</div><div class="t m5 x17 h26 y40e ff7 fs19 fc2 sc0 ls0 ws0">triggers<span class="_ _13"> </span>the<span class="_ _6"> </span>loading<span class="_ _13"> </span>of<span class="_ _13"> </span>new<span class="_ _13"> </span>values<span class="_ _6"> </span>into<span class="_ _13"> </span>the<span class="_ _13"> </span>registers<span class="_ _6"> </span>and<span class="_ _13"> </span>the<span class="_ _13"> </span>writing<span class="_ _13"> </span>of<span class="_ _6"> </span>values<span class="_ _13"> </span>to<span class="_ _13"> </span>the</div><div class="t m5 x17 h26 y40f ff7 fs19 fc2 sc0 ls0 ws0">random<span class="_ _11"> </span>access<span class="_ _11"> </span>memories<span class="_ _1"></span>.<span class="_ _11"> </span>T<span class="_ _0"></span>he<span class="_ _11"> </span>program<span class="_ _11"> </span>counter<span class="_ _11"> </span>is<span class="_ _11"> </span>loaded<span class="_ _11"> </span>with<span class="_ _11"> </span>a<span class="_ _16"> </span>new<span class="_"> </span>instruction</div><div class="t m5 x17 h26 y410 ff7 fs19 fc2 sc0 ls0 ws0">address<span class="_ _15"> </span>every<span class="_ _14"> </span>clock<span class="_ _15"> </span>cycle<span class="_ _0"></span>.<span class="_ _14"> </span>The<span class="_ _14"> </span>condition<span class="_ _15"> </span>code<span class="_ _15"> </span>register<span class="_ _15"> </span>is<span class="_ _15"> </span>loaded<span class="_ _15"> </span>only<span class="_ _15"> </span>when<span class="_ _14"> </span>an</div><div class="t m5 x17 h26 y411 ff7 fs19 fc2 sc0 ls0 ws0">integer<span class="_"> </span>operation<span class="_"> </span>instruction<span class="_ _11"> </span>is<span class="_"> </span>executed.<span class="_"> </span>The<span class="_"> </span>data<span class="_"> </span>memory<span class="_"> </span>is<span class="_"> </span>written<span class="_ _11"> </span>only<span class="_"> </span>when</div><div class="t m5 x17 h26 y412 ff7 fs19 fc2 sc0 ls0 ws0">an<span class="_ _15"> </span><span class="ffd">rmmovq</span>,<span class="_ _21"> </span><span class="ffd">pushq</span><span class="ls1bc">,o<span class="_ _12"></span>r<span class="_ _0"></span><span class="ffd ls0">call<span class="_ _15"> </span><span class="ff7">instruction<span class="_ _15"> </span>is<span class="_ _15"> </span>executed.<span class="_ _15"> </span>T<span class="_ _1"></span>he<span class="_ _15"> </span>two<span class="_ _15"> </span>write<span class="_ _15"> </span>ports<span class="_ _15"> </span>of<span class="_ _15"> </span>the</span></span></span></div><div class="t m5 x17 h26 y413 ff7 fs19 fc2 sc0 ls0 ws0">register<span class="_"> </span>ﬁle<span class="_ _13"> </span>allow<span class="_"> </span>two<span class="_"> </span>program<span class="_"> </span>registers<span class="_ _13"> </span>to<span class="_"> </span>be<span class="_"> </span>updated<span class="_"> </span>on<span class="_ _13"> </span>every<span class="_"> </span>cycle<span class="_ _1"></span>,<span class="_"> </span>but<span class="_"> </span>we<span class="_ _13"> </span>can</div><div class="t m5 x17 h26 y414 ff7 fs19 fc2 sc0 ls0 ws0">use<span class="_ _11"> </span>the<span class="_ _11"> </span>special<span class="_ _11"> </span>register<span class="_ _11"> </span>ID<span class="_ _11"> </span><span class="ffd">0xF<span class="_ _11"> </span></span>as<span class="_ _11"> </span>a<span class="_ _11"> </span>port<span class="_ _11"> </span>address<span class="_ _11"> </span>to<span class="_ _11"> </span>indicate<span class="_ _11"> </span>that<span class="_ _11"> </span>no<span class="_ _11"> </span>write<span class="_ _11"> </span>should</div><div class="t m5 x17 h26 y415 ff7 fs19 fc2 sc0 ls0 ws0">be<span class="_"> </span>performed<span class="_"> </span>for<span class="_"> </span>this<span class="_"> </span>port.</div><div class="t m5 x26 h26 y416 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _13"> </span>clocking<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _6"> </span>registers<span class="_ _13"> </span>and<span class="_ _13"> </span>memories<span class="_ _6"> </span>is<span class="_ _13"> </span>all<span class="_ _6"> </span>that<span class="_ _13"> </span>is<span class="_ _6"> </span>required<span class="_ _13"> </span>to<span class="_ _6"> </span>control<span class="_ _13"> </span>the</div><div class="t m5 x17 h26 y434 ff7 fs19 fc2 sc0 ls0 ws0">sequencing<span class="_ _6"> </span>of<span class="_ _13"> </span>activities<span class="_ _6"> </span>in<span class="_ _6"> </span>our<span class="_ _13"> </span>processor<span class="_ _1"></span>.<span class="_ _13"> </span>Our<span class="_ _6"> </span>hardware<span class="_ _6"> </span>achieves<span class="_ _13"> </span>the<span class="_ _6"> </span>same<span class="_ _6"> </span>effect<span class="_ _13"> </span>as</div><div class="t m5 x17 h26 y435 ff7 fs19 fc2 sc0 ls0 ws0">would<span class="_ _6"> </span>a<span class="_ _6"> </span>sequential<span class="_ _13"> </span>execution<span class="_ _a"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>assignments<span class="_ _a"> </span>shown<span class="_ _13"> </span>in<span class="_ _a"> </span>the<span class="_ _13"> </span>tables<span class="_ _a"> </span>of<span class="_ _6"> </span>Figures<span class="_ _a"> </span>4.18</div><div class="t m5 x17 h26 y436 ff7 fs19 fc2 sc0 ls0 ws0">through<span class="_ _11"> </span>4.21,<span class="_ _16"> </span>even<span class="_ _11"> </span>though<span class="_ _11"> </span>all<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>state<span class="_ _16"> </span>updates<span class="_ _11"> </span>actually<span class="_ _11"> </span>occur<span class="_ _11"> </span>simultaneously</div><div class="t m5 x17 h26 y437 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_"> </span>only<span class="_"> </span>as<span class="_"> </span>the<span class="_"> </span>clock<span class="_"> </span>rises<span class="_"> </span>to<span class="_"> </span>start<span class="_"> </span>the<span class="_"> </span>next<span class="_"> </span>cycle<span class="_ _1"></span>.<span class="_"> </span>This<span class="_"> </span>equivalence<span class="_"> </span>holds<span class="_"> </span>because</div><div class="t m5 x17 h26 y438 ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_ _16"> </span>the<span class="_ _16"> </span>nature<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>Y86-64<span class="_ _16"> </span>instruction<span class="_ _16"> </span>set,<span class="_ _14"> </span>and<span class="_ _16"> </span>because<span class="_ _16"> </span>we<span class="_ _16"> </span>have<span class="_ _16"> </span>organized<span class="_ _14"> </span>the</div><div class="t m5 x17 h26 y439 ff7 fs19 fc2 sc0 ls0 ws0">computations<span class="_"> </span>in<span class="_"> </span>such<span class="_"> </span>a<span class="_"> </span>way<span class="_"> </span>that<span class="_"> </span>our<span class="_"> </span>design<span class="_"> </span>obeys<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>principle:</div><div class="t m5 x17 h5b y3c59 ff1b fs14 fc6 sc0 ls0 ws0">principle:<span class="_ _e"> </span><span class="ff7 fs19 fc1">No<span class="_"> </span>reading<span class="_"> </span>back</span></div><div class="t m5 x17 h26 y3c5a ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _14"> </span>processor<span class="_ _14"> </span>never<span class="_ _14"> </span>needs<span class="_ _14"> </span>to<span class="_ _14"> </span>read<span class="_ _14"> </span>back<span class="_ _15"> </span>the<span class="_ _14"> </span>state<span class="_ _14"> </span>updated<span class="_ _14"> </span>by<span class="_ _14"> </span>an<span class="_ _14"> </span>instruction<span class="_ _14"> </span>in</div><div class="t m5 x17 h26 y3c5b ff7 fs19 fc1 sc0 ls0 ws0">order<span class="_"> </span>to<span class="_"> </span>complete<span class="_"> </span>the<span class="_"> </span>processing<span class="_"> </span>of<span class="_"> </span>this<span class="_"> </span>instruction.</div><div class="t m5 x26 h26 y35e ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _11"> </span>principle<span class="_ _11"> </span>is<span class="_"> </span>crucial<span class="_ _11"> </span>to<span class="_ _11"> </span>the<span class="_ _11"> </span>success<span class="_"> </span>of<span class="_ _11"> </span>our<span class="_ _11"> </span>implementation.<span class="_"> </span>As<span class="_ _11"> </span>an<span class="_ _11"> </span>illustra-</div><div class="t m5 x17 h26 y35f ff7 fs19 fc1 sc0 ls0 ws0">tion,<span class="_ _16"> </span>suppose<span class="_ _11"> </span>we<span class="_ _11"> </span>implemented<span class="_ _16"> </span>the<span class="_ _11"> </span><span class="ffd">pushq<span class="_ _16"> </span></span>instruction<span class="_ _11"> </span>by<span class="_ _11"> </span>ﬁrst<span class="_ _16"> </span>decrementing<span class="_ _11"> </span><span class="ffd">%rsp</span></div><div class="t m5 x17 h26 y360 ff7 fs19 fc1 sc0 ls0 ws0">by<span class="_ _13"> </span>8<span class="_"> </span>and<span class="_ _13"> </span>then<span class="_"> </span>using<span class="_ _13"> </span>the<span class="_ _13"> </span>updated<span class="_"> </span>value<span class="_ _13"> </span>of<span class="_ _13"> </span><span class="ffd">%rsp<span class="_ _10"> </span></span>as<span class="_ _13"> </span>the<span class="_"> </span>address<span class="_ _13"> </span>of<span class="_ _13"> </span>a<span class="_"> </span>write<span class="_ _13"> </span>operation.</div><div class="t m5 x17 h26 y361 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>approach<span class="_"> </span>would<span class="_ _11"> </span>violate<span class="_"> </span>the<span class="_"> </span>principle<span class="_"> </span>stated<span class="_"> </span>above.<span class="_"> </span>It<span class="_"> </span>would<span class="_"> </span>require<span class="_"> </span>reading</div><div class="t m5 x17 h26 y362 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _11"> </span>updated<span class="_ _11"> </span>stack<span class="_ _11"> </span>pointer<span class="_ _16"> </span>from<span class="_"> </span>the<span class="_ _16"> </span>register<span class="_"> </span>ﬁle<span class="_ _16"> </span>in<span class="_"> </span>order<span class="_ _16"> </span>to<span class="_"> </span>perform<span class="_ _16"> </span>the<span class="_"> </span>memory</div><div class="t m5 x17 h26 y363 ff7 fs19 fc1 sc0 ls0 ws0">operation.<span class="_"> </span>Instead,<span class="_"> </span>our<span class="_ _13"> </span>implementation<span class="_"> </span>(F<span class="_ _0"></span>igure<span class="_"> </span>4.20)<span class="_"> </span>generates<span class="_ _13"> </span>the<span class="_"> </span>decremented</div><div class="t m5 x17 h26 y364 ff7 fs19 fc1 sc0 ls0 ws0">value<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>stack<span class="_"> </span>pointer<span class="_ _16"> </span>as<span class="_ _11"> </span>the<span class="_ _11"> </span>signal<span class="_ _11"> </span><span class="ff6">valE<span class="_ _16"> </span></span>and<span class="_ _11"> </span>then<span class="_ _11"> </span>uses<span class="_ _11"> </span>this<span class="_ _16"> </span>signal<span class="_"> </span>both<span class="_ _16"> </span>as<span class="_ _11"> </span>the</div><div class="t m5 x17 h26 y365 ff7 fs19 fc1 sc0 ls0 ws0">data<span class="_ _16"> </span>for<span class="_ _16"> </span>the<span class="_ _16"> </span>register<span class="_ _16"> </span>write<span class="_ _16"> </span>and<span class="_ _16"> </span>the<span class="_ _11"> </span>address<span class="_ _16"> </span>for<span class="_ _16"> </span>the<span class="_ _16"> </span>memory<span class="_ _16"> </span>write.<span class="_ _11"> </span>As<span class="_ _16"> </span>a<span class="_ _16"> </span>result,<span class="_ _14"> </span>it</div><div class="t m5 x17 h26 y366 ff7 fs19 fc1 sc0 ls0 ws0">can<span class="_ _11"> </span>perform<span class="_ _11"> </span>the<span class="_ _11"> </span>register<span class="_ _11"> </span>and<span class="_ _11"> </span>memory<span class="_ _11"> </span>writes<span class="_ _11"> </span>simultaneously<span class="_ _11"> </span>as<span class="_ _11"> </span>the<span class="_ _16"> </span>clock<span class="_"> </span>rises<span class="_ _11"> </span>to</div><div class="t m5 x17 h26 y367 ff7 fs19 fc1 sc0 ls0 ws0">begin<span class="_"> </span>the<span class="_"> </span>next<span class="_"> </span>clock<span class="_"> </span>cycle<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y368 ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_ _13"> </span>another<span class="_ _6"> </span>illustration<span class="_ _13"> </span>of<span class="_ _13"> </span>this<span class="_ _6"> </span>principle,<span class="_ _13"> </span>we<span class="_ _6"> </span>can<span class="_ _13"> </span>see<span class="_ _13"> </span>that<span class="_ _6"> </span>some<span class="_ _13"> </span>instructions<span class="_ _13"> </span>(the</div><div class="t m5 x17 h26 y369 ff7 fs19 fc1 sc0 ls0 ws0">integer<span class="_ _6"> </span>operations)<span class="_ _13"> </span>set<span class="_ _6"> </span>the<span class="_ _13"> </span>condition<span class="_ _6"> </span>codes<span class="_ _0"></span>,<span class="_ _13"> </span>and<span class="_ _6"> </span>some<span class="_ _13"> </span>instructions<span class="_ _6"> </span>(the<span class="_ _13"> </span>conditional</div><div class="t m5 x17 h26 y36a ff7 fs19 fc1 sc0 ls0 ws0">move<span class="_"> </span>and<span class="_"> </span>jump<span class="_"> </span>instructions)<span class="_"> </span>read<span class="_ _11"> </span>these<span class="_"> </span>condition<span class="_"> </span>codes<span class="_ _1"></span>,<span class="_ _11"> </span>but<span class="_"> </span>no<span class="_"> </span>instruction<span class="_"> </span>must</div><div class="t m5 x17 h26 y36b ff7 fs19 fc1 sc0 ls0 ws0">both<span class="_"> </span>set<span class="_"> </span>and<span class="_"> </span>then<span class="_"> </span>read<span class="_"> </span>the<span class="_"> </span>condition<span class="_"> </span>codes<span class="_ _1"></span>.<span class="_"> </span>Even<span class="_"> </span>though<span class="_"> </span>the<span class="_"> </span>condition<span class="_"> </span>codes<span class="_"> </span>are</div><div class="t m5 x17 h26 y36c ff7 fs19 fc1 sc0 ls0 ws0">not<span class="_ _14"> </span>set<span class="_ _14"> </span>until<span class="_ _14"> </span>the<span class="_ _14"> </span>clock<span class="_ _14"> </span>rises<span class="_ _14"> </span>to<span class="_ _15"> </span>begin<span class="_ _14"> </span>the<span class="_ _14"> </span>next<span class="_ _14"> </span>clock<span class="_ _14"> </span>cycle<span class="_ _1"></span>,<span class="_ _15"> </span>they<span class="_ _14"> </span>will<span class="_ _15"> </span>be<span class="_ _14"> </span>updated</div><div class="t m5 x17 h26 y36d ff7 fs19 fc1 sc0 ls0 ws0">before<span class="_"> </span>any<span class="_"> </span>instruction<span class="_"> </span>attempts<span class="_"> </span>to<span class="_"> </span>read<span class="_"> </span>them.</div><div class="t m5 x26 h26 y36e ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _16"> </span>4.25<span class="_ _11"> </span>shows<span class="_ _16"> </span>how<span class="_ _11"> </span>the<span class="_ _16"> </span>SEQ<span class="_ _11"> </span>hardware<span class="_ _11"> </span>would<span class="_ _16"> </span>process<span class="_ _11"> </span>the<span class="_ _16"> </span>instructions<span class="_ _11"> </span>at</div><div class="t m5 x17 h26 y36f ff7 fs19 fc1 sc0 ls0 ws0">lines<span class="_ _16"> </span>3<span class="_ _14"> </span>and<span class="_ _14"> </span>4<span class="_ _14"> </span>in<span class="_ _16"> </span>the<span class="_ _14"> </span>following<span class="_ _14"> </span>code<span class="_ _14"> </span>sequence<span class="_ _1"></span>,<span class="_ _15"> </span>shown<span class="_ _16"> </span>in<span class="_ _14"> </span>assembly<span class="_ _14"> </span>code<span class="_ _14"> </span>with<span class="_ _16"> </span>the</div><div class="t m5 x17 h26 y370 ff7 fs19 fc1 sc0 ls0 ws0">instruction<span class="_"> </span>addresses<span class="_"> </span>listed<span class="_"> </span>on<span class="_"> </span>the<span class="_"> </span>left:</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
