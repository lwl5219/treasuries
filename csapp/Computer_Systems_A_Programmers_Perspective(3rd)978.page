<div id="pf3d2" class="pf w2 h11" data-page-no="3d2"><div class="pc pc3d2 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg3d2.png"/><div class="t m5 x1df h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>11.4<span class="_ _60"> </span>The<span class="_ _10"> </span>Sockets<span class="_ _10"> </span>Interface<span class="_ _3e"> </span><span class="ffe fs1e">977</span></div><div class="t m5 x212 h2c y27f ffa fs16 fc2 sc0 ls0 ws0">code/netp/hostinfo<span class="_ _1"></span>.c</div><div class="t m5 x2c h2d y280 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">#include<span class="_ _1f"> </span>&quot;csapp.h&quot;</span></div><div class="t m5 x2c h2e y281 ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x2c h2e y282 ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x2d h2d y283 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>main(int<span class="_ _1f"> </span>argc,<span class="_ _1f"> </span>char<span class="_ _e"> </span>**argv)</div><div class="t m5 x2c h2d y284 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x2c h2d y285 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _20"> </span><span class="ffd fs1e fc2">struct<span class="_ _e"> </span>addrinfo<span class="_ _1f"> </span>*p,<span class="_ _1f"> </span>*listp,<span class="_ _e"> </span>hints;</span></div><div class="t m5 x2c h2d y286 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _20"> </span><span class="ffd fs1e fc2">char<span class="_ _e"> </span>buf[MAXLINE];</span></div><div class="t m5 x2c h2d y287 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _20"> </span><span class="ffd fs1e fc2">int<span class="_ _e"> </span>rc,<span class="_ _1f"> </span>flags;</span></div><div class="t m5 x2c h2e y4493 ff6 fs20 fc6 sc0 ls0 ws0">8</div><div class="t m5 x2c h2e y66b4 ff6 fs20 fc6 sc0 ls0 ws0">9</div><div class="t m5 x142 h2d y4a9a ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>(argc<span class="_ _1f"> </span>!=<span class="_ _1f"> </span>2)<span class="_ _e"> </span>{</div><div class="t m5 x17 h2d y4a9b ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _70"> </span><span class="ffd fs1e fc2">fprintf(stderr,<span class="_ _e"> </span>&quot;usage:<span class="_ _1f"> </span>%s<span class="_ _1f"> </span>&lt;domain<span class="_ _e"> </span>name&gt;\n&quot;,<span class="_ _1f"> </span>argv[0]);</span></div><div class="t m5 x17 h2d y4a9c ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _70"> </span><span class="ffd fs1e fc2">exit(0);</span></div><div class="t m5 x17 h2d y906 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x17 h2e y4a9d ff6 fs20 fc6 sc0 ls0 ws0">13</div><div class="t m5 x17 h2e y66b5 ff6 fs20 fc6 sc0 ls0 ws0">14</div><div class="t m5 x142 h2d y4a9e ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Get<span class="_ _1f"> </span>a<span class="_ _1f"> </span>list<span class="_ _e"> </span>of<span class="_ _1f"> </span>addrinfo<span class="_ _e"> </span>records<span class="_ _1f"> </span>*/</div><div class="t m5 x17 h2d y4a9f ff6 fs20 fc6 sc0 ls0 ws0">15<span class="_ _20"> </span><span class="ffd fs1e fc2">memset(&amp;hints,<span class="_ _e"> </span>0,<span class="_ _1f"> </span>sizeof(struct<span class="_ _1f"> </span>addrinfo));</span></div><div class="t m5 x17 h2d y417 ff6 fs20 fc6 sc0 ls0 ws0">16<span class="_ _20"> </span><span class="ffd fs1e fc2">hints.ai_family<span class="_ _e"> </span>=<span class="_ _1f"> </span>AF_INET;<span class="_ _6f"> </span>/*<span class="_ _1f"> </span>IPv4<span class="_ _e"> </span>only<span class="_ _1f"> </span>*/</span></div><div class="t m5 x17 h2d y4aa0 ff6 fs20 fc6 sc0 ls0 ws0">17<span class="_ _20"> </span><span class="ffd fs1e fc2">hints.ai_socktype<span class="_ _e"> </span>=<span class="_ _1f"> </span>SOCK_STREAM;<span class="_ _1f"> </span>/*<span class="_ _e"> </span>Connections<span class="_ _1f"> </span>only<span class="_ _e"> </span>*/</span></div><div class="t m5 x17 h2d yeb4 ff6 fs20 fc6 sc0 ls0 ws0">18<span class="_ _20"> </span><span class="ffd fs1e fc2">if<span class="_ _e"> </span>((rc<span class="_ _1f"> </span>=<span class="_ _1f"> </span>getaddrinfo(argv[1],<span class="_ _e"> </span>NULL,<span class="_ _1f"> </span>&amp;hints,<span class="_ _e"> </span>&amp;listp))<span class="_ _1f"> </span>!=<span class="_ _1f"> </span>0)<span class="_ _e"> </span>{</span></div><div class="t m5 x17 h2d y2a2b ff6 fs20 fc6 sc0 ls0 ws0">19<span class="_ _70"> </span><span class="ffd fs1e fc2">fprintf(stderr,<span class="_ _e"> </span>&quot;getaddrinfo<span class="_ _1f"> </span>error:<span class="_ _1f"> </span>%s\n&quot;,<span class="_ _e"> </span>gai_strerror(rc));</span></div><div class="t m5 x17 h2d y1ab8 ff6 fs20 fc6 sc0 ls0 ws0">20<span class="_ _70"> </span><span class="ffd fs1e fc2">exit(1);</span></div><div class="t m5 x17 h2e y94f ff6 fs20 fc6 sc0 ls0 ws0">21</div><div class="t m5 x142 h2d y1ada ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x17 h2e y4aa1 ff6 fs20 fc6 sc0 ls0 ws0">22</div><div class="t m5 x17 h2e y4aa2 ff6 fs20 fc6 sc0 ls0 ws0">23</div><div class="t m5 x142 h2d y3228 ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Walk<span class="_ _1f"> </span>the<span class="_ _1f"> </span>list<span class="_ _e"> </span>and<span class="_ _1f"> </span>display<span class="_ _e"> </span>each<span class="_ _1f"> </span>IP<span class="_ _1f"> </span>address<span class="_ _e"> </span>*/</div><div class="t m5 x17 h2d y35d ff6 fs20 fc6 sc0 ls0 ws0">24<span class="_ _20"> </span><span class="ffd fs1e fc2">flags<span class="_ _e"> </span>=<span class="_ _1f"> </span>NI_NUMERICHOST;<span class="_ _1f"> </span>/*<span class="_ _e"> </span>Display<span class="_ _1f"> </span>address<span class="_ _e"> </span>string<span class="_ _1f"> </span>instead<span class="_ _1f"> </span>of<span class="_ _e"> </span>domain<span class="_ _1f"> </span>name<span class="_ _e"> </span>*/</span></div><div class="t m5 x17 h2e y4aa3 ff6 fs20 fc6 sc0 ls0 ws0">25</div><div class="t m5 x142 h2d y3229 ffd fs1e fc2 sc0 ls0 ws0">for<span class="_ _e"> </span>(p<span class="_ _1f"> </span>=<span class="_ _1f"> </span>listp;<span class="_ _e"> </span>p;<span class="_ _1f"> </span>p<span class="_ _e"> </span>=<span class="_ _1f"> </span>p-&gt;ai_next)<span class="_ _1f"> </span>{</div><div class="t m5 x17 h2d y2467 ff6 fs20 fc6 sc0 ls0 ws0">26<span class="_ _70"> </span><span class="ffd fs1e fc2">Getnameinfo(p-&gt;ai_addr,<span class="_ _e"> </span>p-&gt;ai_addrlen,<span class="_ _1f"> </span>buf,<span class="_ _1f"> </span>MAXLINE,<span class="_ _e"> </span>NULL,<span class="_ _1f"> </span>0,<span class="_ _e"> </span>flags);</span></div><div class="t m5 x17 h2d y322b ff6 fs20 fc6 sc0 ls0 ws0">27<span class="_ _70"> </span><span class="ffd fs1e fc2">printf(&quot;%s\n&quot;,<span class="_ _e"> </span>buf);</span></div><div class="t m5 x17 h2d y322c ff6 fs20 fc6 sc0 ls0 ws0">28<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x17 h2e y441 ff6 fs20 fc6 sc0 ls0 ws0">29</div><div class="t m5 x17 h2e y6999 ff6 fs20 fc6 sc0 ls0 ws0">30</div><div class="t m5 x142 h2d y2c5c ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Clean<span class="_ _1f"> </span>up<span class="_ _1f"> </span>*/</div><div class="t m5 x17 h2d y322d ff6 fs20 fc6 sc0 ls0 ws0">31<span class="_ _20"> </span><span class="ffd fs1e fc2">Freeaddrinfo(listp);</span></div><div class="t m5 x17 h2e y24a ff6 fs20 fc6 sc0 ls0 ws0">32</div><div class="t m5 x17 h2e y61bb ff6 fs20 fc6 sc0 ls0 ws0">33</div><div class="t m5 x142 h2d y8f9 ffd fs1e fc2 sc0 ls0 ws0">exit(0);</div><div class="t m5 x17 h2d y5fd ff6 fs20 fc6 sc0 ls0 ws0">34<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x212 h2c y7c7d ffa fs16 fc2 sc0 ls0 ws0">code/netp/hostinfo<span class="_ _1"></span>.c</div><div class="t m5 x17 h2f y7c7e ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>11.17<span class="_ _66"> </span><span class="ff1b fc1">Hos<span class="_ _2"></span>tinfo<span class="_ _11"> </span><span class="ffe">displays<span class="_"> </span>the<span class="_"> </span>mapping<span class="_"> </span>of<span class="_"> </span>a<span class="_"> </span>domain<span class="_"> </span>name<span class="_"> </span>to<span class="_"> </span>its<span class="_"> </span>associated<span class="_"> </span>IP<span class="_"> </span>addresses.</span></span></div><div class="t m5 x26 h26 y2878 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _13"> </span>11.17<span class="_ _13"> </span>shows<span class="_ _13"> </span>a<span class="_ _13"> </span>simple<span class="_ _13"> </span>program,<span class="_ _13"> </span>called<span class="_ _13"> </span><span class="ff9">hostinfo</span>,<span class="_ _13"> </span>that<span class="_ _13"> </span>uses<span class="_ _6"> </span><span class="ffd">getaddrinfo</span></div><div class="t m5 x17 h26 y2879 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _11"> </span><span class="ffd">getnameinfo<span class="_ _16"> </span></span>to<span class="_ _16"> </span>display<span class="_ _11"> </span>the<span class="_ _16"> </span>mapping<span class="_ _16"> </span>of<span class="_ _11"> </span>a<span class="_ _16"> </span>domain<span class="_ _16"> </span>name<span class="_ _11"> </span>to<span class="_ _16"> </span>its<span class="_ _16"> </span>associated<span class="_ _11"> </span>IP</div><div class="t m5 x17 h26 y287a ff7 fs19 fc1 sc0 ls0 ws0">addresses<span class="_ _1"></span>.<span class="_"> </span>It<span class="_"> </span>is<span class="_"> </span>similar<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span><span class="ff9">nslookup<span class="_ _10"> </span></span>program<span class="_"> </span>from<span class="_"> </span>Section<span class="_"> </span>11.3.2.</div><div class="t m5 x26 h26 y287b ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>irst,<span class="_ _14"> </span>we<span class="_ _14"> </span>initialize<span class="_ _16"> </span>the<span class="_ _16"> </span><span class="ffd">hints<span class="_ _14"> </span></span>structure<span class="_ _16"> </span>so<span class="_ _14"> </span>that<span class="_ _16"> </span><span class="ffd">getaddrinfo<span class="_ _16"> </span></span>returns<span class="_ _14"> </span>the<span class="_ _16"> </span>ad-</div><div class="t m5 x17 h26 y287c ff7 fs19 fc1 sc0 ls0 ws0">dresses<span class="_ _15"> </span>we<span class="_ _15"> </span>want.<span class="_ _15"> </span>In<span class="_ _15"> </span>this<span class="_ _15"> </span>case,<span class="_ _15"> </span>we<span class="_ _15"> </span>are<span class="_ _15"> </span>looking<span class="_ _21"> </span>for<span class="_ _15"> </span>32-bit<span class="_ _15"> </span>IP<span class="_ _15"> </span>addresses<span class="_ _15"> </span>(line<span class="_ _15"> </span>16)</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
