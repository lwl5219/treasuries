<div id="pf12b" class="pf w2 h11" data-page-no="12b"><div class="pc pc12b w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg12b.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">298<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x1b0 h2d ye7 ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _45"> </span><span class="ffd fs1e fc2">addq<span class="_ _46"> </span>$4,<span class="_ _e"> </span>%rdi<span class="_ _16f"> </span></span><span class="ff13 fs35">Increment<span class="_ _f"> </span>Aptr<span class="_ _f"> </span>++</span></div><div class="t m5 x1b0 h2d yc4d ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _45"> </span><span class="ffd fs1e fc2">addq<span class="_ _46"> </span>$64,<span class="_ _e"> </span>%rcx<span class="_ _da"> </span></span><span class="ff13 fs35">Increment<span class="_ _21"> </span>Bptr<span class="_ _e"> </span>+=<span class="_ _21"> </span>N</span></div><div class="t m5 x1b0 h2d yecb ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _45"> </span><span class="ffd fs1e fc2">cmpq<span class="_ _46"> </span>%rsi,<span class="_ _e"> </span>%rcx<span class="_ _44"> </span></span><span class="ff13 fs35">Compare<span class="_ _e"> </span>Bptr:Bend</span></div><div class="t m5 x1b0 h2d yecc ff6 fs20 fc6 sc0 ls0 ws0">14<span class="_ _45"> </span><span class="ffd fs1e fc2">jne<span class="_ _8c"> </span>.L7<span class="_ _159"> </span></span><span class="ff13 fs35">If<span class="_ _f"> </span>!=,<span class="_ _e"> </span>goto<span class="_ _21"> </span><span class="ff2d">loop</span></span></div><div class="t m5 x1b0 h2d yecd ff6 fs20 fc6 sc0 ls0 ws0">15<span class="_ _45"> </span><span class="ffd fs1e fc2">rep;<span class="_ _e"> </span>ret<span class="_ _129"> </span></span><span class="ff13 fs35">Return</span></div><div class="t m5 x1d h47 y2b35 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>3.39<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>378)</span></div><div class="t m5 x1d h26 y2b36 ff7 fs19 fc1 sc0 ls0 ws0">Use<span class="_"> </span>Equation<span class="_ _11"> </span>3.1<span class="_"> </span>to<span class="_ _11"> </span>explain<span class="_ _11"> </span>how<span class="_"> </span>the<span class="_ _11"> </span>computations<span class="_ _11"> </span>of<span class="_"> </span>the<span class="_ _11"> </span>initial<span class="_ _11"> </span>values<span class="_"> </span>for<span class="_ _11"> </span><span class="ffd">Aptr</span>,</div><div class="t m5 x1d h26 y2b37 ffd fs19 fc1 sc0 ls0 ws0">Bptr<span class="ff7">,<span class="_"> </span>and<span class="_ _13"> </span></span>Bend<span class="_ _10"> </span><span class="ff7">in<span class="_ _13"> </span>the<span class="_"> </span>C<span class="_ _13"> </span>code<span class="_"> </span>of<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_ _13"> </span>3.37(b)<span class="_"> </span>(lines<span class="_"> </span>3–5)<span class="_ _13"> </span>correctly<span class="_"> </span>describe<span class="_ _13"> </span>their</span></div><div class="t m5 x1d h26 y2b38 ff7 fs19 fc1 sc0 ls0 ws0">computations<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>assembly<span class="_"> </span>code<span class="_"> </span>generated<span class="_"> </span>for<span class="_"> </span><span class="ffd">fix_prod_ele<span class="_ _10"> </span></span>(lines<span class="_"> </span>3–5).</div><div class="t m5 x1d h47 y2b39 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>3.40<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>378)</span></div><div class="t m5 x1d h26 y2b3a ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>following<span class="_ _13"> </span>C<span class="_"> </span>code<span class="_ _13"> </span>sets<span class="_"> </span>the<span class="_ _13"> </span>diagonal<span class="_"> </span>elements<span class="_"> </span>of<span class="_ _13"> </span>one<span class="_"> </span>of<span class="_ _13"> </span>our<span class="_"> </span>ﬁxed-size<span class="_ _13"> </span>arrays<span class="_"> </span>to</div><div class="t m5 x1d h26 y2b3b ffd fs19 fc1 sc0 ls0 ws0">val<span class="ff7">:</span></div><div class="t m5 x1d h2d y2b3c ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Set<span class="_ _1f"> </span>all<span class="_ _1f"> </span>diagonal<span class="_ _e"> </span>elements<span class="_ _1f"> </span>to<span class="_ _e"> </span>val<span class="_ _1f"> </span>*/</div><div class="t m5 x1d h2d y2b3d ffd fs1e fc2 sc0 ls0 ws0">void<span class="_ _e"> </span>fix_set_diag(fix_matrix<span class="_ _1f"> </span>A,<span class="_ _1f"> </span>int<span class="_ _e"> </span>val)<span class="_ _1f"> </span>{</div><div class="t m5 x10c h2d y2b3e ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>i;</div><div class="t m5 x10c h2d y2b3f ffd fs1e fc2 sc0 ls33 ws0">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>i=0<span class="_ _41"></span>;i&lt;N<span class="_ _41"></span>;<span class="ls0">i++)</span></div><div class="t m5 x22b h2d y2b40 ffd fs1e fc2 sc0 ls0 ws0">A[i][i]<span class="_ _e"> </span>=<span class="_ _1f"> </span>val;</div><div class="t m5 x1d h2d y2b41 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x29 h26 y2b42 ff7 fs19 fc2 sc0 ls0 ws0">When<span class="_ _21"> </span>compiled<span class="_ _e"> </span>with<span class="_ _21"> </span>optimization<span class="_ _f"> </span>level<span class="_ _e"> </span><span class="ffd">-O1</span>,<span class="_ _e"> </span><span class="ff9">gcc<span class="_ _f"> </span></span>generates<span class="_ _f"> </span>the<span class="_ _f"> </span>following</div><div class="t m5 x1d h26 y2b43 ff7 fs19 fc2 sc0 ls0 ws0">assembly<span class="_"> </span>code:</div><div class="t m5 x1f h2d y2b44 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">fix_set_diag:</span></div><div class="t m5 xad h61 y2b45 ff13 fs35 fc6 sc0 ls0 ws0">void<span class="_ _f"> </span>fix_set_diag(fix_matrix<span class="_ _f"> </span>A,<span class="_ _f"> </span>int<span class="_ _e"> </span>val)</div><div class="t m5 xad h61 y2b46 ff13 fs35 fc6 sc0 ls0 ws0">A<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi,<span class="_ _f"> </span>val<span class="_ _e"> </span>in<span class="_ _21"> </span>%rsi</div><div class="t m5 x1f h2d y2b47 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">movl<span class="_ _46"> </span>$0,<span class="_ _e"> </span>%eax</span></div><div class="t m5 x1f h2d y2b48 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L13:</span></div><div class="t m5 x1f h2d y2b49 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">movl<span class="_ _46"> </span>%esi,<span class="_ _e"> </span>(%rdi,%rax)</span></div><div class="t m5 x1f h2d y2b4a ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">addq<span class="_ _46"> </span>$68,<span class="_ _e"> </span>%rax</span></div><div class="t m5 x1f h2d y2b4b ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">cmpq<span class="_ _46"> </span>$1088,<span class="_ _e"> </span>%rax</span></div><div class="t m5 x1f h2d y2b4c ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">jne<span class="_ _8c"> </span>.L13</span></div><div class="t m5 x1f h2d y2b4d ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _45"> </span><span class="ffd fs1e fc2">rep;<span class="_ _e"> </span>ret</span></div><div class="t m5 x29 h26 y2b4e ff7 fs19 fc2 sc0 ls0 ws0">Create<span class="_"> </span>a<span class="_"> </span>C<span class="_"> </span>code<span class="_"> </span>program<span class="_"> </span><span class="ffd">fix_set_diag_opt<span class="_ _10"> </span></span>that<span class="_"> </span>uses<span class="_"> </span>optimizations<span class="_"> </span>similar</div><div class="t m5 x1d h26 y2b4f ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_"> </span>those<span class="_ _13"> </span>in<span class="_"> </span>the<span class="_ _13"> </span>assembly<span class="_"> </span>code<span class="_ _1"></span>,<span class="_"> </span>in<span class="_"> </span>the<span class="_ _13"> </span>same<span class="_"> </span>style<span class="_ _13"> </span>as<span class="_"> </span>the<span class="_ _13"> </span>code<span class="_"> </span>in<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>3.37(b).<span class="_ _13"> </span>Use</div><div class="t m5 x1d h26 y2b50 ff7 fs19 fc2 sc0 ls0 ws0">expressions<span class="_ _13"> </span>involving<span class="_"> </span>the<span class="_ _13"> </span>parameter<span class="_"> </span><span class="ff11">N<span class="_"> </span></span>rather<span class="_ _13"> </span>than<span class="_"> </span>integer<span class="_ _13"> </span>constants<span class="_ _1"></span>,<span class="_"> </span>so<span class="_ _13"> </span>that<span class="_"> </span>your</div><div class="t m5 x1d h26 y2b51 ff7 fs19 fc2 sc0 ls0 ws0">code<span class="_"> </span>will<span class="_"> </span>work<span class="_"> </span>correctly<span class="_"> </span>if<span class="_"> </span><span class="ff11">N<span class="_"> </span></span>is<span class="_"> </span>redeﬁned.</div><div class="t m5 x1d h41 y2270 ffe fs29 fc1 sc0 ls0 ws0">3.8.5<span class="_ _48"> </span><span class="fs19">V<span class="_ _1"></span>ariable-Size<span class="_"> </span>Arrays</span></div><div class="t m5 x1d h26 y77e ff7 fs19 fc1 sc0 ls0 ws0">Historically<span class="_ _3"></span>,<span class="_"> </span>C<span class="_"> </span>only<span class="_ _11"> </span>supported<span class="_"> </span>multidimensional<span class="_ _11"> </span>arrays<span class="_"> </span>where<span class="_ _11"> </span>the<span class="_"> </span>sizes<span class="_ _11"> </span>(with<span class="_"> </span>the</div><div class="t m5 x1d h26 y77f ff7 fs19 fc1 sc0 ls0 ws0">possible<span class="_ _16"> </span>exception<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>ﬁrst<span class="_ _16"> </span>dimension)<span class="_ _11"> </span>could<span class="_ _16"> </span>be<span class="_ _16"> </span>determined<span class="_ _16"> </span>at<span class="_ _11"> </span>compile<span class="_ _16"> </span>time<span class="_ _0"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
