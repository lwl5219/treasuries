<div id="pf375" class="pf w2 h11" data-page-no="375"><div class="pc pc375 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg375.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">884<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>9<span class="_ _3d"> </span>Virtual<span class="_ _10"> </span>Memory</span></div><div class="t m5 x56 h110 y72c4 ffc6 fsa0 fc1 sc0 ls0 ws0">Unused</div><div class="t m5 x14 h110 y72c5 ffc6 fsa0 fc1 sc0 ls0 ws0">Start</div><div class="t m5 x25d h110 y72c6 ffc6 fsa0 fc1 sc0 ls0 ws0">of</div><div class="t m5 x14 h110 y72c7 ffc6 fsa0 fc1 sc0 ls0 ws0">heap</div><div class="t m5 x73 h110 y72c8 ffc6 fsa0 fc1 sc0 ls0 ws0">8/0<span class="_ _74"> </span>16/1<span class="_ _1b1"> </span>32/0<span class="_ _224"> </span>16/1<span class="_ _e9"> </span>0/1</div><div class="t m5 x223 h110 y72c9 ffc6 fsa0 fc1 sc0 ls0 ws0">Double-</div><div class="t m5 x165 h110 y72ca ffc6 fsa0 fc1 sc0 ls0 ws0">word</div><div class="t m5 x233 h110 y72cb ffc6 fsa0 fc1 sc0 ls0 ws0">aligned</div><div class="t m5 x14 h34 y72cc ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _11"> </span>9.36<span class="_ _c"> </span><span class="fc1">Organizing<span class="_ _16"> </span>the<span class="_"> </span>heap<span class="_ _16"> </span>with<span class="_ _11"> </span>an<span class="_ _16"> </span>implicit<span class="_"> </span>free<span class="_ _16"> </span>list.<span class="_ _11"> </span><span class="ff6">Allocated<span class="_ _16"> </span>blocks<span class="_ _11"> </span>are<span class="_ _11"> </span>shaded.<span class="_ _16"> </span>Free<span class="_ _11"> </span>blocks<span class="_ _16"> </span>are</span></span></div><div class="t m5 x14 h34 y72cd ff6 fs16 fc1 sc0 ls0 ws0">unshaded.<span class="_ _10"> </span>Headers<span class="_ _11"> </span>are<span class="_ _10"> </span>labeled<span class="_ _10"> </span>with<span class="_ _11"> </span>(size<span class="_ _10"> </span>(bytes)/allocated<span class="_ _11"> </span>bit).</div><div class="t m5 x1d h26 y72ce ff7 fs19 fc1 sc0 ls0 ws0">(the<span class="_"> </span><span class="ffa">allocated<span class="_"> </span>bit<span class="_ _2"></span></span>)<span class="_"> </span>to<span class="_ _13"> </span>indicate<span class="_"> </span>whether<span class="_"> </span>the<span class="_"> </span>block<span class="_ _13"> </span>is<span class="_"> </span>allocated<span class="_"> </span>or<span class="_"> </span>free<span class="_ _1"></span>.<span class="_"> </span>F<span class="_ _3"></span>or<span class="_"> </span>example<span class="_ _0"></span>,</div><div class="t m5 x1d h26 y72cf ff7 fs19 fc1 sc0 ls0 ws0">suppose<span class="_"> </span>we<span class="_"> </span>have<span class="_"> </span>an<span class="_"> </span>allocated<span class="_"> </span>block<span class="_"> </span>with<span class="_"> </span>a<span class="_"> </span>block<span class="_"> </span>size<span class="_"> </span>of<span class="_"> </span>24<span class="_"> </span>(<span class="ffd">0x18</span>)<span class="_"> </span>bytes<span class="_ _1"></span>.<span class="_"> </span>Then<span class="_"> </span>its</div><div class="t m5 x1d h26 y72d0 ff7 fs19 fc1 sc0 ls0 ws0">header<span class="_"> </span>would<span class="_"> </span>be</div><div class="t m5 x1d h2d y72d1 ffd fs1e fc2 sc0 ls0 ws0">0x00000018<span class="_ _e"> </span>|<span class="_ _1f"> </span>0x1<span class="_ _1f"> </span>=<span class="_ _e"> </span>0x00000019</div><div class="t m5 x1d h26 y72d2 ff7 fs19 fc2 sc0 ls0 ws0">Similarly<span class="_ _3"></span>,<span class="_ _13"> </span>a<span class="_"> </span>free<span class="_ _13"> </span>block<span class="_"> </span>with<span class="_ _13"> </span>a<span class="_"> </span>block<span class="_ _13"> </span>size<span class="_"> </span>of<span class="_ _13"> </span>40<span class="_"> </span>(<span class="ffd">0x28</span>)<span class="_ _13"> </span>bytes<span class="_"> </span>would<span class="_ _13"> </span>have<span class="_"> </span>a<span class="_ _13"> </span>header<span class="_"> </span>of</div><div class="t m5 x1d h2d y72d3 ffd fs1e fc2 sc0 ls0 ws0">0x00000028<span class="_ _e"> </span>|<span class="_ _1f"> </span>0x0<span class="_ _1f"> </span>=<span class="_ _e"> </span>0x00000028</div><div class="t m5 x29 h26 y72d4 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>header<span class="_"> </span>is<span class="_ _13"> </span>followed<span class="_"> </span>by<span class="_"> </span>the<span class="_ _13"> </span>payload<span class="_"> </span>that<span class="_"> </span>the<span class="_ _13"> </span>application<span class="_"> </span>requested<span class="_"> </span>when<span class="_"> </span>it</div><div class="t m5 x1d h26 y72d5 ff7 fs19 fc2 sc0 ls0 ws0">called<span class="_"> </span><span class="ffd">malloc</span>.<span class="_ _13"> </span>The<span class="_ _13"> </span>payload<span class="_"> </span>is<span class="_"> </span>followed<span class="_ _13"> </span>by<span class="_"> </span>a<span class="_ _13"> </span>chunk<span class="_"> </span>of<span class="_"> </span>unused<span class="_ _13"> </span>padding<span class="_"> </span>that<span class="_"> </span>can<span class="_ _13"> </span>be</div><div class="t m5 x1d h26 y72d6 ff7 fs19 fc2 sc0 ls0 ws0">any<span class="_ _13"> </span>size<span class="_ _1"></span>.<span class="_ _13"> </span>T<span class="_ _0"></span>here<span class="_ _13"> </span>are<span class="_ _13"> </span>a<span class="_ _13"> </span>number<span class="_ _6"> </span>of<span class="_ _13"> </span>reasons<span class="_ _13"> </span>for<span class="_ _13"> </span>the<span class="_ _13"> </span>padding.<span class="_ _6"> </span>F<span class="_ _0"></span>or<span class="_ _13"> </span>example<span class="_ _1"></span>,<span class="_ _13"> </span>the<span class="_ _13"> </span>padding</div><div class="t m5 x1d h26 y72d7 ff7 fs19 fc2 sc0 ls0 ws0">might<span class="_"> </span>be<span class="_ _13"> </span>part<span class="_"> </span>of<span class="_"> </span>an<span class="_ _13"> </span>allocator’s<span class="_"> </span>strategy<span class="_ _13"> </span>for<span class="_"> </span>combating<span class="_"> </span>external<span class="_ _13"> </span>fragmentation.<span class="_"> </span>Or</div><div class="t m5 x1d h26 y72d8 ff7 fs19 fc2 sc0 ls0 ws0">it<span class="_"> </span>might<span class="_"> </span>be<span class="_"> </span>needed<span class="_"> </span>to<span class="_"> </span>satisfy<span class="_"> </span>the<span class="_"> </span>alignment<span class="_"> </span>requirement.</div><div class="t m5 x29 h26 y72d9 ff7 fs19 fc2 sc0 ls0 ws0">Given<span class="_ _13"> </span>the<span class="_ _13"> </span>block<span class="_ _6"> </span>format<span class="_ _13"> </span>in<span class="_ _13"> </span>F<span class="_ _1"></span>igure<span class="_ _13"> </span>9.35,<span class="_ _13"> </span>we<span class="_ _13"> </span>can<span class="_ _6"> </span>organize<span class="_ _13"> </span>the<span class="_ _13"> </span>heap<span class="_ _13"> </span>as<span class="_ _6"> </span>a<span class="_ _13"> </span>sequence</div><div class="t m5 x1d h26 y72da ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_"> </span>contiguous<span class="_"> </span>allocated<span class="_"> </span>and<span class="_"> </span>free<span class="_"> </span>blocks<span class="_ _1"></span>,<span class="_"> </span>as<span class="_"> </span>shown<span class="_"> </span>in<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>9.36.</div><div class="t m5 x29 h26 y72db ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _13"> </span>call<span class="_ _13"> </span>this<span class="_ _13"> </span>organization<span class="_ _6"> </span>an<span class="_ _13"> </span><span class="ffa">implicit<span class="_ _13"> </span>free<span class="_ _13"> </span>list<span class="_"> </span></span>because<span class="_ _6"> </span>the<span class="_ _13"> </span>free<span class="_ _13"> </span>blocks<span class="_ _13"> </span>are<span class="_ _6"> </span>linked</div><div class="t m5 x1d h26 y72dc ff7 fs19 fc2 sc0 ls0 ws0">implicitly<span class="_ _16"> </span>by<span class="_ _14"> </span>the<span class="_ _16"> </span>size<span class="_ _14"> </span>ﬁelds<span class="_ _16"> </span>in<span class="_ _14"> </span>the<span class="_ _16"> </span>headers<span class="_ _1"></span>.<span class="_ _14"> </span>T<span class="_ _0"></span>he<span class="_ _16"> </span>allocator<span class="_ _14"> </span>can<span class="_ _16"> </span>indirectly<span class="_ _14"> </span>traverse</div><div class="t m5 x1d h26 y72dd ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _13"> </span>entire<span class="_"> </span>set<span class="_ _13"> </span>of<span class="_"> </span>free<span class="_ _13"> </span>blocks<span class="_"> </span>by<span class="_ _13"> </span>traversing<span class="_ _13"> </span><span class="ffa">all<span class="_ _11"> </span></span>of<span class="_"> </span>the<span class="_ _13"> </span>blocks<span class="_ _13"> </span>in<span class="_"> </span>the<span class="_ _13"> </span>heap<span class="_ _0"></span>.<span class="_ _13"> </span>Notice<span class="_"> </span>that</div><div class="t m5 x1d h26 y72de ff7 fs19 fc2 sc0 ls0 ws0">we<span class="_ _13"> </span>need<span class="_ _13"> </span>some<span class="_ _13"> </span>kind<span class="_ _13"> </span>of<span class="_"> </span>specially<span class="_ _13"> </span>marked<span class="_ _13"> </span>end<span class="_ _13"> </span>block—in<span class="_ _13"> </span>this<span class="_ _13"> </span>example<span class="_ _1"></span>,<span class="_"> </span>a<span class="_ _13"> </span>terminating</div><div class="t m5 x1d h26 y72df ff7 fs19 fc2 sc0 ls0 ws0">header<span class="_ _6"> </span>with<span class="_ _13"> </span>the<span class="_ _6"> </span>allocated<span class="_ _13"> </span>bit<span class="_ _6"> </span>set<span class="_ _6"> </span>and<span class="_ _13"> </span>a<span class="_ _6"> </span>size<span class="_ _13"> </span>of<span class="_ _a"> </span>zero.<span class="_ _6"> </span>(As<span class="_ _6"> </span>we<span class="_ _13"> </span>will<span class="_ _6"> </span>see<span class="_ _13"> </span>in<span class="_ _6"> </span>Section<span class="_ _6"> </span>9.9.12,</div><div class="t m5 x1d h26 y72e0 ff7 fs19 fc2 sc0 ls0 ws0">setting<span class="_"> </span>the<span class="_"> </span>allocated<span class="_"> </span>bit<span class="_"> </span>simpliﬁes<span class="_"> </span>the<span class="_"> </span>coalescing<span class="_"> </span>of<span class="_"> </span>free<span class="_"> </span>blocks<span class="_ _1"></span>.)</div><div class="t m5 x29 h26 y72e1 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _13"> </span>advantage<span class="_ _6"> </span>of<span class="_ _13"> </span>an<span class="_ _6"> </span>implicit<span class="_ _13"> </span>free<span class="_ _6"> </span>list<span class="_ _13"> </span>is<span class="_ _6"> </span>simplicity<span class="_ _3"></span>.<span class="_ _13"> </span>A<span class="_ _6"> </span>signiﬁcant<span class="_ _6"> </span>disadvantage<span class="_ _13"> </span>is</div><div class="t m5 x1d h26 y72e2 ff7 fs19 fc2 sc0 ls0 ws0">that<span class="_ _13"> </span>the<span class="_ _13"> </span>cost<span class="_ _13"> </span>of<span class="_ _13"> </span>any<span class="_ _13"> </span>operation<span class="_ _13"> </span>that<span class="_"> </span>requires<span class="_ _13"> </span>a<span class="_ _13"> </span>search<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>free<span class="_ _13"> </span>list,<span class="_ _13"> </span>such<span class="_ _13"> </span>as<span class="_ _13"> </span>placing</div><div class="t m5 x1d h26 y72e3 ff7 fs19 fc2 sc0 ls0 ws0">allocated<span class="_"> </span>blocks<span class="_ _1"></span>,<span class="_"> </span>will<span class="_"> </span>be<span class="_"> </span>linear<span class="_"> </span>in<span class="_"> </span>the<span class="_ _13"> </span><span class="ffa">total<span class="_ _16"> </span></span>number<span class="_"> </span>of<span class="_"> </span>allocated<span class="_"> </span>and<span class="_"> </span>free<span class="_"> </span>blocks<span class="_ _13"> </span>in</div><div class="t m5 x1d h26 y72e4 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>heap<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y72e5 ff7 fs19 fc2 sc0 ls0 ws0">It<span class="_ _14"> </span>is<span class="_ _15"> </span>important<span class="_ _15"> </span>to<span class="_ _15"> </span>realize<span class="_ _15"> </span>that<span class="_ _15"> </span>the<span class="_ _15"> </span>system’s<span class="_ _14"> </span>alignment<span class="_ _15"> </span>requirement<span class="_ _15"> </span>and<span class="_ _14"> </span>the</div><div class="t m5 x1d h26 y72e6 ff7 fs19 fc2 sc0 ls0 ws0">allocator’s<span class="_"> </span>choice<span class="_"> </span>of<span class="_"> </span>block<span class="_"> </span>format<span class="_"> </span>impose<span class="_"> </span>a<span class="_"> </span><span class="ffa">minimum<span class="_"> </span>bloc<span class="_ _1"></span>k<span class="_"> </span>size<span class="_"> </span><span class="ff7">on<span class="_"> </span>the<span class="_"> </span>allocator.</span></span></div><div class="t m5 x1d h26 y72e7 ff7 fs19 fc2 sc0 ls0 ws0">No<span class="_ _14"> </span>allocated<span class="_ _14"> </span>or<span class="_ _14"> </span>free<span class="_ _14"> </span>block<span class="_ _16"> </span>may<span class="_ _14"> </span>be<span class="_ _14"> </span>smaller<span class="_ _14"> </span>than<span class="_ _14"> </span>this<span class="_ _14"> </span>minimum.<span class="_ _14"> </span>F<span class="_ _1"></span>or<span class="_ _14"> </span>example,<span class="_ _14"> </span>if</div><div class="t m5 x1d h26 y72e8 ff7 fs19 fc2 sc0 ls0 ws0">we<span class="_ _15"> </span>assume<span class="_ _15"> </span>a<span class="_ _15"> </span>double-word<span class="_ _15"> </span>alignment<span class="_ _15"> </span>requirement,<span class="_ _21"> </span>then<span class="_ _15"> </span>the<span class="_ _15"> </span>size<span class="_ _15"> </span>of<span class="_ _15"> </span>each<span class="_ _15"> </span>block</div><div class="t m5 x1d h26 y72e9 ff7 fs19 fc2 sc0 ls0 ws0">must<span class="_ _11"> </span>be<span class="_ _11"> </span>a<span class="_ _11"> </span>multiple<span class="_ _11"> </span>of<span class="_ _11"> </span>two<span class="_ _11"> </span>words<span class="_ _11"> </span>(8<span class="_ _11"> </span>bytes).<span class="_ _11"> </span>T<span class="_ _0"></span>hus<span class="_ _1"></span>,<span class="_ _11"> </span>the<span class="_ _11"> </span>block<span class="_ _11"> </span>format<span class="_ _11"> </span>in<span class="_ _11"> </span>Figure<span class="_"> </span>9.35</div><div class="t m5 x1d h26 y72ea ff7 fs19 fc2 sc0 ls0 ws0">induces<span class="_ _13"> </span>a<span class="_"> </span>minimum<span class="_ _13"> </span>block<span class="_ _13"> </span>size<span class="_ _13"> </span>of<span class="_"> </span>two<span class="_ _13"> </span>words:<span class="_ _13"> </span>one<span class="_ _13"> </span>word<span class="_"> </span>for<span class="_ _13"> </span>the<span class="_ _13"> </span>header<span class="_ _13"> </span>and<span class="_"> </span>another</div><div class="t m5 x1d h26 y72eb ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_"> </span>maintain<span class="_"> </span>the<span class="_ _13"> </span>alignment<span class="_"> </span>requirement.<span class="_"> </span>Even<span class="_"> </span>if<span class="_"> </span>the<span class="_ _13"> </span>application<span class="_"> </span>were<span class="_"> </span>to<span class="_"> </span>request<span class="_"> </span>a</div><div class="t m5 x1d h26 y72ec ff7 fs19 fc2 sc0 ls0 ws0">single<span class="_"> </span>byte<span class="_ _1"></span>,<span class="_"> </span>the<span class="_"> </span>allocator<span class="_"> </span>would<span class="_"> </span>still<span class="_"> </span>create<span class="_"> </span>a<span class="_"> </span>two-word<span class="_"> </span>block.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
