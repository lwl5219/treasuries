<div id="pf163" class="pf w2 h11" data-page-no="163"><div class="pc pc163 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg163.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">354<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x1f h2d ye7 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">long<span class="_ _1f"> </span>sum_col(long<span class="_ _e"> </span>n,<span class="_ _1f"> </span>long<span class="_ _1f"> </span>A[NR(n)][NC(n)],<span class="_ _e"> </span>long<span class="_ _1f"> </span>j)<span class="_ _e"> </span>{</span></div><div class="t m5 x1f h2d yc4d ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _20"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>i;</span></div><div class="t m5 x1f h2d yecb ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>result<span class="_ _1f"> </span>=<span class="_ _1f"> </span>0;</span></div><div class="t m5 x1f h2d yecc ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2">for<span class="_ _e"> </span>(i<span class="_ _1f"> </span>=<span class="_ _1f"> </span>0;<span class="_ _e"> </span>i<span class="_ _1f"> </span>&lt;<span class="_ _e"> </span>NR(n);<span class="_ _1f"> </span>i++)</span></div><div class="t m5 x1f h2d yecd ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _70"> </span><span class="ffd fs1e fc2">result<span class="_ _e"> </span>+=<span class="_ _1f"> </span>A[i][j];</span></div><div class="t m5 x1f h2d yece ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _20"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>result;</span></div><div class="t m5 x1f h2d yecf ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x29 h26 y3207 ff7 fs19 fc2 sc0 ls0 ws0">In<span class="_"> </span>compiling<span class="_"> </span>this<span class="_"> </span>program,<span class="_"> </span><span class="ff9">gcc<span class="_ _10"> </span></span>generates<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>assembly<span class="_"> </span>code:</div><div class="t m5 xad h61 y3208 ff13 fs35 fc6 sc0 ls0 ws0">long<span class="_ _f"> </span>sum_col(long<span class="_ _f"> </span>n,<span class="_ _f"> </span>long<span class="_ _e"> </span>A[NR(n)][NC(n)],<span class="_ _21"> </span>long<span class="_ _f"> </span>j)</div><div class="t m5 xad h61 y3209 ff13 fs35 fc6 sc0 ls0 ws0">n<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi,<span class="_ _f"> </span>A<span class="_ _e"> </span>in<span class="_ _21"> </span>%rsi,<span class="_ _f"> </span>j<span class="_ _e"> </span>in<span class="_ _21"> </span>%rdx</div><div class="t m5 x1f h2d y320a ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">sum_col:</span></div><div class="t m5 x1f h2d y320b ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">leaq<span class="_ _46"> </span>1(,%rdi,4),<span class="_ _e"> </span>%r8</span></div><div class="t m5 x1f h2d y320c ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">leaq<span class="_ _46"> </span>(%rdi,%rdi,2),<span class="_ _e"> </span>%rax</span></div><div class="t m5 x1f h2d y320d ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rax,<span class="_ _e"> </span>%rdi</span></div><div class="t m5 x1f h2d y320e ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">testq<span class="_ _3f"> </span>%rax,<span class="_ _e"> </span>%rax</span></div><div class="t m5 x1f h2d y320f ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">jle<span class="_ _8c"> </span>.L4</span></div><div class="t m5 x1f h2d y3210 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">salq<span class="_ _46"> </span>$3,<span class="_ _e"> </span>%r8</span></div><div class="t m5 x1f h2d y3211 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _45"> </span><span class="ffd fs1e fc2">leaq<span class="_ _46"> </span>(%rsi,%rdx,8),<span class="_ _e"> </span>%rcx</span></div><div class="t m5 x1f h2d y3212 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _45"> </span><span class="ffd fs1e fc2">movl<span class="_ _46"> </span>$0,<span class="_ _e"> </span>%eax</span></div><div class="t m5 x1b0 h2e y3213 ff6 fs20 fc6 sc0 ls0 ws0">10</div><div class="t m5 x10d h2d y3214 ffd fs1e fc2 sc0 ls0 ws0">movl<span class="_ _46"> </span>$0,<span class="_ _e"> </span>%edx</div><div class="t m5 x1b0 h2e y3215 ff6 fs20 fc6 sc0 ls0 ws0">11</div><div class="t m5 x4f h2d y3216 ffd fs1e fc2 sc0 ls0 ws0">.L3:</div><div class="t m5 x1b0 h2d y3217 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _45"> </span><span class="ffd fs1e fc2">addq<span class="_ _46"> </span>(%rcx),<span class="_ _e"> </span>%rax</span></div><div class="t m5 x1b0 h2d y3218 ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _45"> </span><span class="ffd fs1e fc2">addq<span class="_ _46"> </span>$1,<span class="_ _e"> </span>%rdx</span></div><div class="t m5 x1b0 h2d y3219 ff6 fs20 fc6 sc0 ls0 ws0">14<span class="_ _45"> </span><span class="ffd fs1e fc2">addq<span class="_ _46"> </span>%r8,<span class="_ _e"> </span>%rcx</span></div><div class="t m5 x1b0 h2d y321a ff6 fs20 fc6 sc0 ls0 ws0">15<span class="_ _45"> </span><span class="ffd fs1e fc2">cmpq<span class="_ _46"> </span>%rdi,<span class="_ _e"> </span>%rdx</span></div><div class="t m5 x1b0 h2d y321b ff6 fs20 fc6 sc0 ls0 ws0">16<span class="_ _45"> </span><span class="ffd fs1e fc2">jne<span class="_ _8c"> </span>.L3</span></div><div class="t m5 x1b0 h2d y321c ff6 fs20 fc6 sc0 ls0 ws0">17<span class="_ _45"> </span><span class="ffd fs1e fc2">rep;<span class="_ _e"> </span>ret</span></div><div class="t m5 x1b0 h2d y321d ff6 fs20 fc6 sc0 ls0 ws0">18<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L4:</span></div><div class="t m5 x1b0 h2d y321e ff6 fs20 fc6 sc0 ls0 ws0">19<span class="_ _45"> </span><span class="ffd fs1e fc2">movl<span class="_ _46"> </span>$0,<span class="_ _e"> </span>%eax</span></div><div class="t m5 x1b0 h2d y321f ff6 fs20 fc6 sc0 ls0 ws0">20<span class="_ _45"> </span><span class="ffd fs1e fc2">ret</span></div><div class="t m5 x29 h26 y3220 ff7 fs19 fc2 sc0 ls0 ws0">Use<span class="_"> </span>your<span class="_ _13"> </span>reverse<span class="_"> </span>engineering<span class="_ _13"> </span>skills<span class="_"> </span>to<span class="_ _13"> </span>determine<span class="_"> </span>the<span class="_ _13"> </span>deﬁnitions<span class="_"> </span>of<span class="_ _13"> </span><span class="ffd">NR<span class="_ _13"> </span></span>and<span class="_"> </span><span class="ffd">NC</span>.</div><div class="t m5 x1d h73 y3221 ffe fs1e fc6 sc0 ls0 ws0">3.67<span class="_ _23"> </span><span class="ff10 fs19">◆◆</span></div><div class="t m5 x1d h26 y3222 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _6"> </span>this<span class="_ _6"> </span>exercise<span class="_ _1"></span>,<span class="_ _13"> </span>we<span class="_ _a"> </span>will<span class="_ _6"> </span>examine<span class="_ _6"> </span>the<span class="_ _6"> </span>code<span class="_ _6"> </span>generated<span class="_ _6"> </span>by<span class="_ _13"> </span><span class="ff9">gcc<span class="_ _a"> </span></span>for<span class="_ _6"> </span>functions<span class="_ _6"> </span>that<span class="_ _6"> </span>have</div><div class="t m5 x1d h26 y3223 ff7 fs19 fc1 sc0 ls0 ws0">structures<span class="_"> </span>as<span class="_ _11"> </span>arguments<span class="_"> </span>and<span class="_ _11"> </span>return<span class="_"> </span>values<span class="_ _1"></span>,<span class="_ _11"> </span>and<span class="_"> </span>from<span class="_ _11"> </span>this<span class="_"> </span>see<span class="_ _11"> </span>how<span class="_"> </span>these<span class="_ _11"> </span>language</div><div class="t m5 x1d h26 y3224 ff7 fs19 fc1 sc0 ls0 ws0">features<span class="_"> </span>are<span class="_"> </span>typically<span class="_"> </span>implemented.</div><div class="t m5 x29 h26 y3225 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _11"> </span>following<span class="_ _11"> </span>C<span class="_ _11"> </span>code<span class="_ _11"> </span>has<span class="_ _11"> </span>a<span class="_ _11"> </span>function<span class="_ _11"> </span><span class="ffd">process<span class="_ _11"> </span></span>having<span class="_ _11"> </span>structures<span class="_ _11"> </span>as<span class="_ _11"> </span>argument</div><div class="t m5 x1d h26 y3226 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_"> </span>return<span class="_"> </span>values<span class="_ _1"></span>,<span class="_"> </span>and<span class="_"> </span>a<span class="_"> </span>function<span class="_"> </span><span class="ffd">eval<span class="_ _10"> </span></span>that<span class="_"> </span>calls<span class="_"> </span><span class="ffd">process</span>:</div><div class="t m5 x1f h2e y13c0 ff6 fs20 fc6 sc0 ls0 ws0">1</div><div class="t m5 x4f h2d y543 ffd fs1e fc2 sc0 ls0 ws0">typedef<span class="_ _e"> </span>struct<span class="_ _1f"> </span>{</div><div class="t m5 x1f h2e y587 ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x33 h2d ye14 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>a[2];</div><div class="t m5 x1f h2d yeef ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>*p;</span></div><div class="t m5 x1f h2d yd7a ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _1c"> </span><span class="ffd fs1e fc2">}<span class="_ _1f"> </span>strA;</span></div><div class="t m5 x1f h2e y1db4 ff6 fs20 fc6 sc0 ls0 ws0">5</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
