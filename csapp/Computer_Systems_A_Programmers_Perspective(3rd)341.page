<div id="pf155" class="pf w2 h11" data-page-no="155"><div class="pc pc155 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg155.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">340<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x1f h2d ye7 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">vunpcklps<span class="_ _6f"> </span>%xmm1,<span class="_ _1f"> </span>%xmm1,<span class="_ _e"> </span>%xmm1</span></div><div class="t m5 x1f h2d yc4d ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">vcvtps2pd<span class="_ _6f"> </span>%xmm1,<span class="_ _1f"> </span>%xmm2</span></div><div class="t m5 x1f h2d yecb ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">vcvtsi2sdq<span class="_ _5a"> </span>%rsi,<span class="_ _1f"> </span>%xmm1,<span class="_ _e"> </span>%xmm1</span></div><div class="t m5 x1f h2d yecc ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">vdivsd<span class="_ _1a"> </span>%xmm1,<span class="_ _e"> </span>%xmm0,<span class="_ _1f"> </span>%xmm0</span></div><div class="t m5 x1f h2d yecd ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _45"> </span><span class="ffd fs1e fc2">vsubsd<span class="_ _1a"> </span>%xmm0,<span class="_ _e"> </span>%xmm2,<span class="_ _1f"> </span>%xmm0</span></div><div class="t m5 x1f h2d yece ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _45"> </span><span class="ffd fs1e fc2">ret</span></div><div class="t m5 x29 h26 y30c2 ff7 fs19 fc2 sc0 ls0 ws0">Write<span class="_"> </span>a<span class="_"> </span>C<span class="_"> </span>version<span class="_"> </span>of<span class="_"> </span><span class="ffd">funct2</span>.</div><div class="t m5 x1d h41 y30c3 ffe fs29 fc1 sc0 ls0 ws0">3.11.4<span class="_ _48"> </span><span class="fs19">Deﬁning<span class="_"> </span>and<span class="_"> </span>Using<span class="_"> </span>Floating-Point<span class="_"> </span>Constants</span></div><div class="t m5 x1d h26 y30c4 ff7 fs19 fc1 sc0 ls0 ws0">Unlike<span class="_ _13"> </span>integer<span class="_"> </span>arithmetic<span class="_ _13"> </span>operations<span class="_ _3"></span>,<span class="_"> </span>A<span class="_ _4"></span>VX<span class="_"> </span>ﬂoating-point<span class="_ _13"> </span>operations<span class="_ _13"> </span>cannot<span class="_"> </span>have</div><div class="t m5 x1d h26 y30c5 ff7 fs19 fc1 sc0 ls0 ws0">immediate<span class="_ _11"> </span>values<span class="_ _11"> </span>as<span class="_ _11"> </span>operands<span class="_ _0"></span>.<span class="_ _11"> </span>Instead,<span class="_ _11"> </span>the<span class="_ _16"> </span>compiler<span class="_"> </span>must<span class="_ _16"> </span>allocate<span class="_ _11"> </span>and<span class="_ _11"> </span>initialize</div><div class="t m5 x1d h26 y30c6 ff7 fs19 fc1 sc0 ls0 ws0">storage<span class="_ _13"> </span>for<span class="_ _6"> </span>any<span class="_ _13"> </span>constant<span class="_ _6"> </span>values<span class="_ _0"></span>.<span class="_ _13"> </span>T<span class="_ _3"></span>he<span class="_ _13"> </span>code<span class="_ _13"> </span>then<span class="_ _6"> </span>reads<span class="_ _13"> </span>the<span class="_ _13"> </span>values<span class="_ _6"> </span>from<span class="_ _13"> </span>memory<span class="_ _7"></span>.<span class="_ _13"> </span>T<span class="_ _1"></span>his</div><div class="t m5 x1d h26 y30c7 ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_"> </span>illustrated<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>Celsius<span class="_"> </span>to<span class="_"> </span>F<span class="_ _3"></span>ahrenheit<span class="_"> </span>conversion<span class="_"> </span>function:</div><div class="t m5 x1d h2d y30c8 ffd fs1e fc2 sc0 ls0 ws0">double<span class="_ _e"> </span>cel2fahr(double<span class="_ _1f"> </span>temp)</div><div class="t m5 x1d h2d y30c9 ffd fs1e fc2 sc0 ls0 ws0">{</div><div class="t m5 x10c h2d y30ca ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>1.8<span class="_ _1f"> </span>*<span class="_ _1f"> </span>temp<span class="_ _e"> </span>+<span class="_ _1f"> </span>32.0;</div><div class="t m5 x1d h2d y30cb ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x29 h26 y30cc ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>relevant<span class="_"> </span>parts<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>x86-64<span class="_"> </span>assembly<span class="_"> </span>code<span class="_"> </span>are<span class="_"> </span>as<span class="_"> </span>follows:</div><div class="t m5 xad h61 y30cd ff13 fs35 fc6 sc0 ls0 ws0">double<span class="_ _f"> </span>cel2fahr(double<span class="_ _f"> </span>temp)</div><div class="t m5 xad h61 y30ce ff13 fs35 fc6 sc0 ls0 ws0">temp<span class="_ _f"> </span>in<span class="_ _f"> </span>%xmm0</div><div class="t m5 x1f h2d y30cf ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">cel2fahr:</span></div><div class="t m5 x1f h2d y30d0 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">vmulsd<span class="_ _1a"> </span>.LC2(%rip),<span class="_ _e"> </span>%xmm0,<span class="_ _1f"> </span>%xmm0<span class="_ _95"> </span></span><span class="ff13 fs35">Multiply<span class="_ _f"> </span>by<span class="_ _e"> </span>1.8</span></div><div class="t m5 x1f h2d y30d1 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">vaddsd<span class="_ _1a"> </span>.LC3(%rip),<span class="_ _e"> </span>%xmm0,<span class="_ _1f"> </span>%xmm0<span class="_ _95"> </span></span><span class="ff13 fs35">Add<span class="_ _f"> </span>32.0</span></div><div class="t m5 x1f h2d y30d2 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">ret</span></div><div class="t m5 x1f h2d y30d3 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _1c"> </span><span class="ffd fs1e fc2">.LC2:</span></div><div class="t m5 x1f h2d y30d4 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">.long<span class="_ _3f"> </span>3435973837<span class="_ _9c"> </span></span><span class="ff13 fs35">Low-order<span class="_ _e"> </span>4<span class="_ _21"> </span>bytes<span class="_ _f"> </span>of<span class="_ _e"> </span>1.8</span></div><div class="t m5 x1f h2d y30d5 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">.long<span class="_ _3f"> </span>1073532108<span class="_ _9c"> </span></span><span class="ff13 fs35">High-order<span class="_ _e"> </span>4<span class="_ _21"> </span>bytes<span class="_ _f"> </span>of<span class="_ _e"> </span>1.8</span></div><div class="t m5 x1f h2d y30d6 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _1c"> </span><span class="ffd fs1e fc2">.LC3:</span></div><div class="t m5 x1f h2e y30d7 ff6 fs20 fc6 sc0 ls0 ws0">9</div><div class="t m5 x10d h2d y30d8 ffd fs1e fc2 sc0 ls0 ws0">.long<span class="_ _3f"> </span>0<span class="_ _187"> </span><span class="ff13 fs35 fc6">Low-order<span class="_ _f"> </span>4<span class="_ _f"> </span>bytes<span class="_ _f"> </span>of<span class="_ _e"> </span>32.0</span></div><div class="t m5 x1b0 h2d y30d9 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _45"> </span><span class="ffd fs1e fc2">.long<span class="_ _3f"> </span>1077936128<span class="_ _9c"> </span></span><span class="ff13 fs35">High-order<span class="_ _e"> </span>4<span class="_ _21"> </span>bytes<span class="_ _f"> </span>of<span class="_ _e"> </span>32.0</span></div><div class="t m5 x1d h26 yb97 ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _16"> </span>see<span class="_ _16"> </span>that<span class="_ _14"> </span>the<span class="_ _16"> </span>function<span class="_ _16"> </span>reads<span class="_ _16"> </span>the<span class="_ _16"> </span>value<span class="_ _14"> </span>1.8<span class="_ _16"> </span>from<span class="_ _16"> </span>the<span class="_ _16"> </span>memory<span class="_ _16"> </span>location<span class="_ _14"> </span>labeled</div><div class="t m5 x1d h26 yb98 ffd fs19 fc2 sc0 ls0 ws0">.LC2<span class="_ _11"> </span><span class="ff7">and<span class="_ _11"> </span>the<span class="_ _11"> </span>value<span class="_ _11"> </span>32.0<span class="_ _11"> </span>from<span class="_ _11"> </span>the<span class="_"> </span>memory<span class="_ _11"> </span>location<span class="_ _11"> </span>labeled<span class="_ _16"> </span></span>.LC3<span class="ff7">.<span class="_"> </span>Looking<span class="_ _11"> </span>at<span class="_ _11"> </span>the</span></div><div class="t m5 x1d h26 yb99 ff7 fs19 fc2 sc0 ls0 ws0">values<span class="_ _13"> </span>associated<span class="_"> </span>with<span class="_ _13"> </span>these<span class="_ _13"> </span>labels<span class="_ _1"></span>,<span class="_"> </span>we<span class="_ _13"> </span>see<span class="_ _13"> </span>that<span class="_ _13"> </span>each<span class="_"> </span>is<span class="_ _13"> </span>speciﬁed<span class="_ _13"> </span>by<span class="_ _13"> </span>a<span class="_"> </span>pair<span class="_ _13"> </span>of<span class="_ _13"> </span><span class="ffd">.long</span></div><div class="t m5 x1d h26 yb9a ff7 fs19 fc2 sc0 ls0 ws0">declarations<span class="_ _16"> </span>with<span class="_ _16"> </span>the<span class="_ _16"> </span>values<span class="_ _16"> </span>given<span class="_ _16"> </span>in<span class="_ _16"> </span>decimal.<span class="_ _16"> </span>How<span class="_ _16"> </span>should<span class="_ _16"> </span>these<span class="_ _16"> </span>be<span class="_ _16"> </span>interpreted</div><div class="t m5 x1d h26 yb9b ff7 fs19 fc2 sc0 ls0 ws0">as<span class="_"> </span>ﬂoating-point<span class="_ _13"> </span>values?<span class="_"> </span>Looking<span class="_ _13"> </span>at<span class="_"> </span>the<span class="_"> </span>declaration<span class="_ _13"> </span>labeled<span class="_"> </span><span class="ffd">.LC2</span>,<span class="_"> </span>we<span class="_ _13"> </span>see<span class="_"> </span>that<span class="_"> </span>the</div><div class="t m5 x1d h26 yb9c ff7 fs19 fc2 sc0 ls0 ws0">two<span class="_ _14"> </span>values<span class="_ _14"> </span>are<span class="_ _15"> </span>3435973837<span class="_ _14"> </span>(<span class="ffd">0xcccccccd</span>)<span class="_ _14"> </span>and<span class="_ _14"> </span>1073532108<span class="_ _14"> </span>(<span class="ffd">0x3ffccccc</span>.)<span class="_ _15"> </span>Since</div><div class="t m5 x1d h26 yb9d ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>machine<span class="_"> </span>uses<span class="_"> </span>little-endian<span class="_"> </span>byte<span class="_"> </span>ordering,<span class="_"> </span>the<span class="_"> </span>ﬁrst<span class="_"> </span>value<span class="_ _11"> </span>gives<span class="_"> </span>the<span class="_"> </span>low-order<span class="_"> </span>4</div><div class="t m5 x1d h26 yb9e ff7 fs19 fc2 sc0 ls0 ws0">bytes<span class="_ _1"></span>,<span class="_ _16"> </span>while<span class="_ _16"> </span>the<span class="_ _11"> </span>second<span class="_ _16"> </span>gives<span class="_ _16"> </span>the<span class="_ _11"> </span>high-order<span class="_ _16"> </span>4<span class="_ _16"> </span>bytes<span class="_ _3"></span>.<span class="_ _16"> </span>F<span class="_ _0"></span>rom<span class="_ _16"> </span>the<span class="_ _11"> </span>high-order<span class="_ _16"> </span>bytes<span class="_ _1"></span>,</div><div class="t m5 x1d h26 yb9f ff7 fs19 fc2 sc0 ls0 ws0">we<span class="_ _13"> </span>can<span class="_ _13"> </span>extract<span class="_ _13"> </span>an<span class="_ _13"> </span>exponent<span class="_ _13"> </span>ﬁeld<span class="_ _13"> </span>of<span class="_ _13"> </span><span class="ffd">0x3ff<span class="_ _13"> </span></span>(1023),<span class="_ _13"> </span>from<span class="_"> </span>which<span class="_ _13"> </span>we<span class="_ _13"> </span>subtract<span class="_ _13"> </span>a<span class="_ _13"> </span>bias<span class="_ _13"> </span>of</div><div class="t m5 x1d h26 yba0 ff7 fs19 fc2 sc0 ls0 ws0">1023<span class="_ _13"> </span>to<span class="_ _13"> </span>get<span class="_ _13"> </span>an<span class="_"> </span>exponent<span class="_ _13"> </span>of<span class="_ _13"> </span>0.<span class="_ _13"> </span>Concatenating<span class="_ _13"> </span>the<span class="_ _13"> </span>fraction<span class="_"> </span>bits<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>two<span class="_ _13"> </span>values<span class="_ _1"></span>,<span class="_"> </span>we</div><div class="t m5 x1d h26 yba1 ff7 fs19 fc2 sc0 ls0 ws0">get<span class="_"> </span>a<span class="_"> </span>fraction<span class="_"> </span>ﬁeld<span class="_"> </span>of<span class="_"> </span><span class="ffd">0xccccccccccccd</span>,<span class="_"> </span>which<span class="_"> </span>can<span class="_"> </span>be<span class="_"> </span>shown<span class="_"> </span>to<span class="_"> </span>be<span class="_ _11"> </span>the<span class="_"> </span>fractional</div><div class="t m5 x1d h26 yba2 ff7 fs19 fc2 sc0 ls0 ws0">binary<span class="_"> </span>representation<span class="_"> </span>of<span class="_"> </span>0.8,<span class="_"> </span>to<span class="_"> </span>which<span class="_"> </span>we<span class="_"> </span>add<span class="_"> </span>the<span class="_"> </span>implied<span class="_"> </span>leading<span class="_"> </span>one<span class="_"> </span>to<span class="_"> </span>get<span class="_"> </span>1.8.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
