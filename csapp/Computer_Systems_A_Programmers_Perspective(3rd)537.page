<div id="pf219" class="pf w2 h11" data-page-no="219"><div class="pc pc219 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg219.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">536<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>5<span class="_ _3d"> </span>Optimizing<span class="_ _10"> </span>Program<span class="_ _10"> </span>Performance</span></div><div class="t m5 x29 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _16"> </span>value<span class="_ _11"> </span>computed<span class="_ _11"> </span>for<span class="_ _16"> </span><span class="ffd">t1<span class="_ _11"> </span></span>depends<span class="_ _11"> </span>on<span class="_ _16"> </span>whether<span class="_ _11"> </span>or<span class="_ _11"> </span>not<span class="_ _16"> </span>pointers<span class="_ _11"> </span><span class="ffd">p<span class="_ _11"> </span></span>and<span class="_ _16"> </span><span class="ffd">q<span class="_ _11"> </span></span>are</div><div class="t m5 x1d h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">aliased—if<span class="_ _11"> </span>not,<span class="_ _16"> </span>it<span class="_ _16"> </span>will<span class="_ _16"> </span>equal<span class="_ _11"> </span>3,000,<span class="_ _16"> </span>but<span class="_ _16"> </span>if<span class="_ _11"> </span>so<span class="_ _16"> </span>it<span class="_ _11"> </span>will<span class="_ _16"> </span>equal<span class="_ _16"> </span>1,000.<span class="_ _11"> </span>T<span class="_ _0"></span>his<span class="_ _11"> </span>leads<span class="_ _16"> </span>to<span class="_ _16"> </span>one</div><div class="t m5 x1d h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_ _14"> </span>the<span class="_ _16"> </span>major<span class="_ _14"> </span><span class="ffa">optimization<span class="_ _14"> </span>blockers</span>,<span class="_ _14"> </span>aspects<span class="_ _14"> </span>of<span class="_ _14"> </span>programs<span class="_ _14"> </span>that<span class="_ _14"> </span>can<span class="_ _14"> </span>severely<span class="_ _14"> </span>limit</div><div class="t m5 x1d h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _13"> </span>opportunities<span class="_"> </span>for<span class="_ _13"> </span>a<span class="_"> </span>compiler<span class="_ _13"> </span>to<span class="_"> </span>generate<span class="_ _13"> </span>optimized<span class="_"> </span>code<span class="_ _1"></span>.<span class="_"> </span>If<span class="_ _13"> </span>a<span class="_"> </span>compiler<span class="_ _13"> </span>cannot</div><div class="t m5 x1d h26 y2f8 ff7 fs19 fc2 sc0 ls0 ws0">determine<span class="_"> </span>whether<span class="_ _13"> </span>or<span class="_"> </span>not<span class="_ _13"> </span>two<span class="_"> </span>pointers<span class="_ _13"> </span>may<span class="_"> </span>be<span class="_ _13"> </span>aliased,<span class="_"> </span>it<span class="_ _13"> </span>must<span class="_"> </span>assume<span class="_ _13"> </span>that<span class="_"> </span>either</div><div class="t m5 x1d h26 y2f9 ff7 fs19 fc2 sc0 ls0 ws0">case<span class="_"> </span>is<span class="_"> </span>possible<span class="_ _1"></span>,<span class="_"> </span>limiting<span class="_"> </span>the<span class="_"> </span>set<span class="_"> </span>of<span class="_"> </span>possible<span class="_"> </span>optimizations<span class="_ _1"></span>.</div><div class="t m5 x1d h47 y49bd ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>5.1<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>609)</span></div><div class="t m5 x1d h26 y49be ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>following<span class="_ _13"> </span>problem<span class="_"> </span>illustrates<span class="_"> </span>the<span class="_ _13"> </span>way<span class="_"> </span>memory<span class="_ _13"> </span>aliasing<span class="_"> </span>can<span class="_ _13"> </span>cause<span class="_"> </span>unexpected</div><div class="t m5 x1d h26 y49bf ff7 fs19 fc1 sc0 ls0 ws0">program<span class="_"> </span>behavior.<span class="_"> </span>Consider<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>procedure<span class="_"> </span>to<span class="_"> </span>swap<span class="_"> </span>two<span class="_"> </span>values:</div><div class="t m5 x1f h2d y49c0 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">/*<span class="_ _1f"> </span>Swap<span class="_ _e"> </span>value<span class="_ _1f"> </span>x<span class="_ _1f"> </span>at<span class="_ _e"> </span>xp<span class="_ _1f"> </span>with<span class="_ _e"> </span>value<span class="_ _1f"> </span>y<span class="_ _1f"> </span>at<span class="_ _e"> </span>yp<span class="_ _1f"> </span>*/</span></div><div class="t m5 x1f h2e y49c1 ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x4f h2d y49c2 ffd fs1e fc2 sc0 ls0 ws0">void<span class="_ _e"> </span>swap(long<span class="_ _1f"> </span>*xp,<span class="_ _1f"> </span>long<span class="_ _e"> </span>*yp)</div><div class="t m5 x1f h2d y49c3 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x1f h2d y49c4 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2">*xp<span class="_ _e"> </span>=<span class="_ _1f"> </span>*xp<span class="_ _1f"> </span>+<span class="_ _e"> </span>*yp;<span class="_ _1f"> </span>/*<span class="_ _e"> </span>x+y<span class="_ _2b"> </span>*/</span></div><div class="t m5 x1f h2d y49c5 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _20"> </span><span class="ffd fs1e fc2">*yp<span class="_ _e"> </span>=<span class="_ _1f"> </span>*xp<span class="_ _1f"> </span>-<span class="_ _e"> </span>*yp;<span class="_ _1f"> </span>/*<span class="_ _e"> </span>x+y-<span class="ls33">y=x*<span class="_ _41"></span>/</span></span></div><div class="t m5 x1f h2d y49c6 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _20"> </span><span class="ffd fs1e fc2">*xp<span class="_ _e"> </span>=<span class="_ _1f"> </span>*xp<span class="_ _1f"> </span>-<span class="_ _e"> </span>*yp;<span class="_ _1f"> </span>/*<span class="_ _e"> </span>x+y-<span class="ls33">x=y*<span class="_ _41"></span>/</span></span></div><div class="t m5 x1f h2d y49c7 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x29 h26 y49c8 ff7 fs19 fc2 sc0 ls0 ws0">If<span class="_"> </span>this<span class="_"> </span>procedure<span class="_"> </span>is<span class="_"> </span>called<span class="_"> </span>with<span class="_"> </span><span class="ffd">xp<span class="_ _10"> </span></span>equal<span class="_"> </span>to<span class="_"> </span><span class="ffd">yp</span>,<span class="_"> </span>what<span class="_"> </span>effect<span class="_"> </span>will<span class="_"> </span>it<span class="_"> </span>have?</div><div class="t m5 x29 h26 y49c9 ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_ _11"> </span>second<span class="_ _11"> </span>optimization<span class="_ _16"> </span>blocker<span class="_ _11"> </span>is<span class="_ _11"> </span>due<span class="_ _16"> </span>to<span class="_ _11"> </span>function<span class="_ _11"> </span>calls<span class="_ _1"></span>.<span class="_ _16"> </span>As<span class="_ _11"> </span>an<span class="_ _11"> </span>example,<span class="_"> </span>con-</div><div class="t m5 x1d h26 y49ca ff7 fs19 fc1 sc0 ls0 ws0">sider<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>two<span class="_"> </span>procedures:</div><div class="t m5 x1f h2d y49cb ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">long<span class="_ _1f"> </span>f();</span></div><div class="t m5 x1f h2e y49cc ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x1f h2e y49cd ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x4f h2d y49ce ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>func1()<span class="_ _1f"> </span>{</div><div class="t m5 x1f h2d y49cf ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>f()<span class="_ _1f"> </span>+<span class="_ _1f"> </span>f()<span class="_ _e"> </span>+<span class="_ _1f"> </span>f()<span class="_ _e"> </span>+<span class="_ _1f"> </span>f();</span></div><div class="t m5 x1f h2e y49d0 ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x4f h2d y49d1 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x1f h2e y49d2 ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 x1f h2e y49d3 ff6 fs20 fc6 sc0 ls0 ws0">7</div><div class="t m5 x4f h2d y49d4 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>func2()<span class="_ _1f"> </span>{</div><div class="t m5 x1f h2d y49d5 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _20"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>4*f();</span></div><div class="t m5 x1f h2d y49d6 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x29 h26 y49d7 ff7 fs19 fc2 sc0 ls0 ws0">It<span class="_ _6"> </span>might<span class="_ _13"> </span>seem<span class="_ _6"> </span>at<span class="_ _13"> </span>ﬁrst<span class="_ _6"> </span>that<span class="_ _13"> </span>both<span class="_ _6"> </span>compute<span class="_ _13"> </span>the<span class="_ _6"> </span>same<span class="_ _13"> </span>result,<span class="_ _6"> </span>but<span class="_ _13"> </span>with<span class="_ _13"> </span><span class="ffd">func2<span class="_ _6"> </span></span>calling</div><div class="t m5 x1d h26 y49d8 ffd fs19 fc2 sc0 ls0 ws0">f<span class="_ _11"> </span><span class="ff7">only<span class="_ _11"> </span>once<span class="_ _0"></span>,<span class="_ _11"> </span>whereas<span class="_ _11"> </span><span class="ffd">func1<span class="_ _16"> </span></span>calls<span class="_"> </span>it<span class="_ _16"> </span>four<span class="_"> </span>times<span class="_ _1"></span>.<span class="_ _16"> </span>It<span class="_"> </span>is<span class="_ _16"> </span>tempting<span class="_"> </span>to<span class="_ _16"> </span>generate<span class="_"> </span>code<span class="_ _16"> </span>in</span></div><div class="t m5 x1d h26 y49d9 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>style<span class="_"> </span>of<span class="_"> </span><span class="ffd">func2<span class="_ _10"> </span></span>when<span class="_"> </span>given<span class="_"> </span><span class="ffd">func1<span class="_ _10"> </span></span>as<span class="_"> </span>the<span class="_"> </span>source<span class="_ _0"></span>.</div><div class="t m5 x29 h26 y49da ff7 fs19 fc2 sc0 ls0 ws0">Consider,<span class="_"> </span>however<span class="_ _1"></span>,<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>code<span class="_"> </span>for<span class="_"> </span><span class="ffd">f</span>:</div><div class="t m5 x1f h2d y49db ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">long<span class="_ _1f"> </span>counter<span class="_ _e"> </span>=<span class="_ _1f"> </span>0;</span></div><div class="t m5 x1f h2e y49dc ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x1f h2e y49dd ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x4f h2d y49de ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>f()<span class="_ _1f"> </span>{</div><div class="t m5 x1f h2d y49df ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>counter++;</span></div><div class="t m5 x1f h2d y49e0 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1d h26 y15bf ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>function<span class="_"> </span>has<span class="_"> </span>a<span class="_"> </span><span class="ffa">side<span class="_ _13"> </span>effect<span class="_ _5"></span></span>—it<span class="_"> </span>modiﬁes<span class="_"> </span>some<span class="_"> </span>part<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_"> </span>global<span class="_"> </span>program<span class="_"> </span>state<span class="_ _1"></span>.</div><div class="t m5 x1d h26 y15c0 ff7 fs19 fc2 sc0 ls0 ws0">Changing<span class="_ _14"> </span>the<span class="_ _14"> </span>number<span class="_ _14"> </span>of<span class="_ _14"> </span>times<span class="_ _14"> </span>it<span class="_ _14"> </span>gets<span class="_ _14"> </span>called<span class="_ _14"> </span>changes<span class="_ _15"> </span>the<span class="_ _14"> </span>program<span class="_ _14"> </span>behavior.<span class="_ _16"> </span>In</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
