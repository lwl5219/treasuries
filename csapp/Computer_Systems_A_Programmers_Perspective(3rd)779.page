<div id="pf30b" class="pf w2 h11" data-page-no="30b"><div class="pc pc30b w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg30b.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">778<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>8<span class="_ _3d"> </span>Exceptional<span class="_ _10"> </span>Control<span class="_ _10"> </span>Flow</span></div><div class="t m5 x14 h2f ye7 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>8.16</div><div class="t m5 x14 h2f y58a ffe fs16 fc1 sc0 ls0 ws0">Process<span class="_ _16"> </span>graph<span class="_ _14"> </span>for<span class="_ _16"> </span>the</div><div class="t m5 x14 h2f y58b ffe fs16 fc1 sc0 ls0 ws0">example<span class="_ _14"> </span>program<span class="_ _14"> </span>in</div><div class="t m5 x14 h2f y58c ffe fs16 fc1 sc0 ls0 ws0">Figure<span class="_"> </span>8.15.</div><div class="t m5 xb2 h70 y6607 ff9a fs27 fc1 sc0 ls0 ws0">fork</div><div class="c xe0 y6608 w2a h100"><div class="t m5 x27c h70 y6609 ff9a fs27 fc3 sc1 ls0 ws0">fork</div></div><div class="t m5 xe0 h70 y6607 ff9a fs27 fc1 sc0 ls0 ws0">main</div><div class="c xe0 y6608 w2a h100"><div class="t m5 x0 h70 y6609 ff9a fs27 fc3 sc1 ls0 ws0">main</div></div><div class="t m5 xe1 h70 y6607 ff9a fs27 fc1 sc0 ls0 ws0">printf</div><div class="c xe0 y6608 w2a h100"><div class="t m5 x26b h70 y6609 ff9a fs27 fc3 sc1 ls0 ws0">printf</div></div><div class="t m5 x15f h70 y6607 ff9a fs27 fc1 sc0 ls0 ws0">exit</div><div class="c xe0 y6608 w2a h100"><div class="t m5 x1da h70 y6609 ff9a fs27 fc3 sc1 ls0 ws0">exit</div></div><div class="t m5 xba h70 y660a ff9a fs27 fc1 sc0 ls0 ws0">child: x=2</div><div class="t m10 xda hde y660b ff97 fs8f fc1 sc0 ls0 ws0">Child</div><div class="t m10 xda hde y660c ff97 fs8f fc1 sc0 ls0 ws0">P<span class="_ _0"></span>aren</div><div class="c xe0 y6608 w2a h100"><div class="t m10 x58 hde y660d ff97 fs8f fc1 sc0 ls0 ws0">t</div></div><div class="t m5 x7c h70 y660e ff9a fs27 fc1 sc0 ls0 ws0">x==1<span class="_ _74"> </span>parent: x=0</div><div class="t m5 xe1 h70 y660f ff9a fs27 fc1 sc0 ls0 ws0">printf</div><div class="c xe0 y6608 w2a h100"><div class="t m5 x26b h70 y6610 ff9a fs27 fc3 sc1 ls0 ws0">printf</div></div><div class="t m5 x15f h70 y660f ff9a fs27 fc1 sc0 ls0 ws0">exit</div><div class="c xe0 y6608 w2a h100"><div class="t m5 x1da h70 y6610 ff9a fs27 fc3 sc1 ls0 ws0">exit</div></div><div class="t m5 x1f h2d y6611 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">int<span class="_ _1f"> </span>main()</span></div><div class="t m5 x1f h2d y6612 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x1f h2d y6613 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2">Fork();</span></div><div class="t m5 x1f h2d y6614 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2">Fork();</span></div><div class="t m5 x1f h2d y6615 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _20"> </span><span class="ffd fs1e fc2">printf(&quot;hello\n&quot;);</span></div><div class="t m5 x1f h2d y6616 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _20"> </span><span class="ffd fs1e fc2">exit(0);</span></div><div class="t m5 x1f h2d y6617 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x3b h70 y6618 ff9a fs27 fc1 sc0 ls0 ws0">fork</div><div class="c x208 y6619 w2b h101"><div class="t m5 x27d h70 y661a ff9a fs27 fc3 sc1 ls0 ws0">fork</div></div><div class="t m5 x18b h70 y6618 ff9a fs27 fc1 sc0 ls0 ws0">fork</div><div class="c x208 y6619 w2b h101"><div class="t m5 x27c h70 y661a ff9a fs27 fc3 sc1 ls0 ws0">fork</div></div><div class="t m5 x81 h70 y6618 ff9a fs27 fc1 sc0 ls0 ws0">printf</div><div class="c x208 y6619 w2b h101"><div class="t m5 x17 h70 y661a ff9a fs27 fc3 sc1 ls0 ws0">printf</div></div><div class="t m5 x174 h70 y6618 ff9a fs27 fc1 sc0 ls0 ws0">exit</div><div class="c x208 y6619 w2b h101"><div class="t m5 x1da h70 y661a ff9a fs27 fc3 sc1 ls0 ws0">exit</div></div><div class="t m5 x103 h70 y661b ff9a fs27 fc1 sc0 ls0 ws0">hello</div><div class="t m5 x103 h70 y661c ff9a fs27 fc1 sc0 ls0 ws0">hello</div><div class="t m5 x208 h70 y6618 ff9a fs27 fc1 sc0 ls0 ws0">main</div><div class="c x208 y6619 w2b h101"><div class="t m5 x0 h70 y661a ff9a fs27 fc3 sc1 ls0 ws0">main</div></div><div class="t m5 x81 h70 y661d ff9a fs27 fc1 sc0 ls0 ws0">printf</div><div class="c x208 y6619 w2b h101"><div class="t m5 x17 h70 y661e ff9a fs27 fc3 sc1 ls0 ws0">printf</div></div><div class="t m5 x174 h70 y661d ff9a fs27 fc1 sc0 ls0 ws0">exit</div><div class="c x208 y6619 w2b h101"><div class="t m5 x1da h70 y661e ff9a fs27 fc3 sc1 ls0 ws0">exit</div></div><div class="t m5 x3b h70 y661f ff9a fs27 fc1 sc0 ls0 ws0">fork</div><div class="c x208 y6619 w2b h101"><div class="t m5 x27d h70 y6620 ff9a fs27 fc3 sc1 ls0 ws0">fork</div></div><div class="t m5 x81 h70 y661f ff9a fs27 fc1 sc0 ls0 ws0">printf</div><div class="c x208 y6619 w2b h101"><div class="t m5 x17 h70 y6620 ff9a fs27 fc3 sc1 ls0 ws0">printf</div></div><div class="t m5 x174 h70 y661f ff9a fs27 fc1 sc0 ls0 ws0">exit</div><div class="c x208 y6619 w2b h101"><div class="t m5 x1da h70 y6620 ff9a fs27 fc3 sc1 ls0 ws0">exit</div></div><div class="t m5 x103 h70 y6621 ff9a fs27 fc1 sc0 ls0 ws0">hello</div><div class="t m5 x103 h70 y6622 ff9a fs27 fc1 sc0 ls0 ws0">hello</div><div class="t m5 x81 h70 y6623 ff9a fs27 fc1 sc0 ls0 ws0">printf</div><div class="c x208 y6619 w2b h101"><div class="t m5 x17 h70 y6624 ff9a fs27 fc3 sc1 ls0 ws0">printf</div></div><div class="t m5 x174 h70 y6623 ff9a fs27 fc1 sc0 ls0 ws0">exit</div><div class="c x208 y6619 w2b h101"><div class="t m5 x1da h70 y6624 ff9a fs27 fc3 sc1 ls0 ws0">exit</div></div><div class="t m5 x1d h3a y6625 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>8.17<span class="_ _66"> </span><span class="fc1">Process<span class="_"> </span>graph<span class="_"> </span>for<span class="_"> </span>a<span class="_"> </span>nested<span class="_"> </span><span class="ffd fs19">fork</span>.</span></div><div class="t m5 x1d h26 y6626 ff7 fs19 fc1 sc0 ls0 ws0">corresponds<span class="_ _16"> </span>to<span class="_ _14"> </span>the<span class="_ _16"> </span>parent<span class="_ _14"> </span>process<span class="_ _16"> </span>calling<span class="_ _14"> </span><span class="ffd">main</span>.<span class="_ _14"> </span>T<span class="_ _1"></span>his<span class="_ _14"> </span>vertex<span class="_ _16"> </span>has<span class="_ _14"> </span>no<span class="_ _16"> </span>inedges<span class="_ _14"> </span>and</div><div class="t m5 x1d h26 y6627 ff7 fs19 fc1 sc0 ls0 ws0">exactly<span class="_ _13"> </span>one<span class="_"> </span>outedge<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>sequence<span class="_ _13"> </span>of<span class="_"> </span>vertices<span class="_ _13"> </span>for<span class="_ _13"> </span>each<span class="_"> </span>process<span class="_ _13"> </span>ends<span class="_"> </span>with<span class="_ _13"> </span>a<span class="_"> </span>vertex</div><div class="t m5 x1d h26 y6628 ff7 fs19 fc1 sc0 ls0 ws0">corresponding<span class="_"> </span>to<span class="_"> </span>a<span class="_"> </span>call<span class="_"> </span>to<span class="_"> </span><span class="ffd">exit</span>.<span class="_"> </span>T<span class="_ _1"></span>his<span class="_"> </span>vertex<span class="_"> </span>has<span class="_"> </span>one<span class="_"> </span>inedge<span class="_"> </span>and<span class="_"> </span>no<span class="_"> </span>outedges<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y6629 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _13"> </span>example<span class="_ _0"></span>,<span class="_ _13"> </span>Figure<span class="_ _13"> </span>8.16<span class="_ _13"> </span>shows<span class="_ _13"> </span>the<span class="_ _13"> </span>process<span class="_ _13"> </span>graph<span class="_ _13"> </span>for<span class="_ _13"> </span>the<span class="_ _13"> </span>example<span class="_ _13"> </span>program<span class="_ _13"> </span>in</div><div class="t m5 x1d h26 y662a ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _11"> </span>8.15.<span class="_"> </span>Initially<span class="_ _3"></span>,<span class="_"> </span>the<span class="_ _11"> </span>parent<span class="_"> </span>sets<span class="_ _11"> </span>variable<span class="_"> </span><span class="ffd">x<span class="_ _10"> </span></span>to<span class="_ _11"> </span>1.<span class="_"> </span>The<span class="_"> </span>parent<span class="_"> </span>calls<span class="_"> </span><span class="ffd">fork</span>,<span class="_"> </span>which</div><div class="t m5 x1d h26 y662b ff7 fs19 fc1 sc0 ls0 ws0">creates<span class="_ _16"> </span>a<span class="_ _11"> </span>child<span class="_ _16"> </span>process<span class="_ _16"> </span>that<span class="_ _16"> </span>runs<span class="_ _11"> </span>concurrently<span class="_ _16"> </span>with<span class="_ _16"> </span>the<span class="_ _16"> </span>parent<span class="_ _11"> </span>in<span class="_ _16"> </span>its<span class="_ _16"> </span>own<span class="_ _11"> </span>private</div><div class="t m5 x1d h26 y662c ff7 fs19 fc1 sc0 ls0 ws0">address<span class="_"> </span>space<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y662d ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _21"> </span>a<span class="_ _f"> </span>program<span class="_ _f"> </span>running<span class="_ _f"> </span>on<span class="_ _f"> </span>a<span class="_ _f"> </span>single<span class="_ _f"> </span>processor,<span class="_ _f"> </span>any<span class="_ _f"> </span><span class="ffa">topological<span class="_ _f"> </span>sort<span class="_ _e"> </span></span>of<span class="_ _f"> </span>the</div><div class="t m5 x1d h26 y662e ff7 fs19 fc1 sc0 ls0 ws0">vertices<span class="_ _16"> </span>in<span class="_ _16"> </span>the<span class="_ _14"> </span>corresponding<span class="_ _16"> </span>process<span class="_ _16"> </span>graph<span class="_ _16"> </span>represents<span class="_ _14"> </span>a<span class="_ _16"> </span>feasible<span class="_ _16"> </span>total<span class="_ _14"> </span>ordering</div><div class="t m5 x1d h26 y662f ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span>the<span class="_ _11"> </span>statements<span class="_ _11"> </span>in<span class="_ _11"> </span>the<span class="_ _11"> </span>program.<span class="_ _11"> </span>Here’s<span class="_"> </span>a<span class="_ _11"> </span>simple<span class="_ _11"> </span>way<span class="_ _11"> </span>to<span class="_ _11"> </span>understand<span class="_ _11"> </span>the<span class="_ _11"> </span>idea<span class="_ _11"> </span>of</div><div class="t m5 x1d h26 y6630 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_ _11"> </span>topological<span class="_ _11"> </span>sort:<span class="_ _11"> </span>Given<span class="_ _16"> </span>some<span class="_ _11"> </span>permutation<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>vertices<span class="_ _16"> </span>in<span class="_ _11"> </span>the<span class="_ _11"> </span>process<span class="_ _11"> </span>graph,</div><div class="t m5 x1d h26 y6631 ff7 fs19 fc1 sc0 ls0 ws0">draw<span class="_ _13"> </span>the<span class="_ _13"> </span>sequence<span class="_ _13"> </span>of<span class="_ _13"> </span>vertices<span class="_ _6"> </span>in<span class="_ _13"> </span>a<span class="_ _13"> </span>line<span class="_ _13"> </span>from<span class="_ _13"> </span>left<span class="_ _13"> </span>to<span class="_ _13"> </span>right,<span class="_ _13"> </span>and<span class="_ _13"> </span>then<span class="_ _13"> </span>draw<span class="_ _13"> </span>each<span class="_ _13"> </span>of<span class="_ _6"> </span>the</div><div class="t m5 x1d h26 y6632 ff7 fs19 fc1 sc0 ls0 ws0">directed<span class="_ _16"> </span>edges<span class="_ _3"></span>.<span class="_ _16"> </span>T<span class="_ _0"></span>he<span class="_ _11"> </span>permutation<span class="_ _16"> </span>is<span class="_ _16"> </span>a<span class="_ _16"> </span>topological<span class="_ _11"> </span>sort<span class="_ _16"> </span>if<span class="_ _16"> </span>and<span class="_ _11"> </span>only<span class="_ _16"> </span>if<span class="_ _16"> </span>each<span class="_ _11"> </span>edge<span class="_ _16"> </span>in</div><div class="t m5 x1d h26 y6633 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>drawing<span class="_"> </span>goes<span class="_"> </span>from<span class="_"> </span>left<span class="_"> </span>to<span class="_"> </span>right.<span class="_"> </span>T<span class="_ _0"></span>hus<span class="_ _1"></span>,<span class="_"> </span>in<span class="_"> </span>our<span class="_"> </span>example<span class="_"> </span>program<span class="_"> </span>in<span class="_"> </span>Figure<span class="_"> </span>8.15,</div><div class="t m5 x1d h26 y6634 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _11"> </span><span class="ffd">printf<span class="_ _11"> </span></span>statements<span class="_ _16"> </span>in<span class="_"> </span>the<span class="_ _16"> </span>parent<span class="_ _11"> </span>and<span class="_ _11"> </span>child<span class="_ _11"> </span>can<span class="_ _16"> </span>occur<span class="_"> </span>in<span class="_ _16"> </span>either<span class="_ _11"> </span>order<span class="_ _11"> </span>because</div><div class="t m5 x1d h26 y6635 ff7 fs19 fc1 sc0 ls0 ws0">each<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>orderings<span class="_"> </span>corresponds<span class="_"> </span>to<span class="_"> </span>some<span class="_"> </span>topological<span class="_"> </span>sort<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>graph<span class="_"> </span>vertices<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y6636 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _11"> </span>process<span class="_ _11"> </span>graph<span class="_ _11"> </span>can<span class="_"> </span>be<span class="_ _11"> </span>especially<span class="_ _11"> </span>helpful<span class="_ _11"> </span>in<span class="_"> </span>understanding<span class="_ _11"> </span>programs<span class="_ _11"> </span>with</div><div class="t m5 x1d h26 y6637 ff7 fs19 fc1 sc0 ls0 ws0">nested<span class="_ _13"> </span><span class="ffd">fork<span class="_ _13"> </span></span>calls<span class="_ _3"></span>.<span class="_ _13"> </span>F<span class="_ _1"></span>or<span class="_ _13"> </span>example<span class="_ _1"></span>,<span class="_ _13"> </span>F<span class="_ _0"></span>igure<span class="_ _13"> </span>8.17<span class="_ _13"> </span>shows<span class="_ _6"> </span>a<span class="_ _13"> </span>program<span class="_ _13"> </span>with<span class="_ _13"> </span>two<span class="_ _6"> </span>calls<span class="_ _13"> </span>to<span class="_ _13"> </span><span class="ffd">fork</span></div><div class="t m5 x1d h26 y6638 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_ _6"> </span>the<span class="_ _13"> </span>source<span class="_ _6"> </span>code<span class="_ _0"></span>.<span class="_ _6"> </span>The<span class="_ _6"> </span>corresponding<span class="_ _6"> </span>process<span class="_ _13"> </span>graph<span class="_ _6"> </span>helps<span class="_ _13"> </span>us<span class="_ _6"> </span>see<span class="_ _13"> </span>that<span class="_ _6"> </span>this<span class="_ _6"> </span>program</div><div class="t m5 x1d h26 y6639 ff7 fs19 fc1 sc0 ls0 ws0">runs<span class="_"> </span>four<span class="_"> </span>processes<span class="_ _1"></span>,<span class="_"> </span>each<span class="_"> </span>of<span class="_"> </span>which<span class="_"> </span>makes<span class="_"> </span>a<span class="_"> </span>call<span class="_"> </span>to<span class="_"> </span><span class="ffd">printf<span class="_ _10"> </span></span>and<span class="_"> </span>which<span class="_"> </span>can<span class="_"> </span>execute</div><div class="t m5 x1d h26 y663a ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_"> </span>any<span class="_"> </span>order.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
