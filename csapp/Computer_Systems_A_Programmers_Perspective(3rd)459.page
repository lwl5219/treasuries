<div id="pf1cb" class="pf w2 h11" data-page-no="1cb"><div class="pc pc1cb w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1cb.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">458<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>4<span class="_ _3d"> </span>Processor<span class="_ _10"> </span>Architecture</span></div><div class="t m5 x28 h2a y257 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">Where<span class="_ _11"> </span>is<span class="_ _11"> </span>the<span class="_ _11"> </span>PC<span class="_ _16"> </span>in<span class="_ _11"> </span>SEQ+?</span></div><div class="t m5 x28 h2b y2d0 ff7 fs1e fc2 sc0 ls0 ws0">One<span class="_ _13"> </span>curious<span class="_ _6"> </span>feature<span class="_ _13"> </span>of<span class="_ _6"> </span>SEQ+<span class="_ _13"> </span>is<span class="_ _13"> </span>that<span class="_ _6"> </span>there<span class="_ _13"> </span>is<span class="_ _6"> </span>no<span class="_ _13"> </span>hardware<span class="_ _13"> </span>register<span class="_ _6"> </span>storing<span class="_ _13"> </span>the<span class="_ _6"> </span>program<span class="_ _13"> </span>counter.<span class="_ _6"> </span>Instead,</div><div class="t m5 x28 h2b y2d1 ff7 fs1e fc2 sc0 ls0 ws0">the<span class="_ _13"> </span>PC<span class="_ _13"> </span>is<span class="_ _13"> </span>computed<span class="_ _13"> </span>dynamically<span class="_ _6"> </span>based<span class="_"> </span>on<span class="_ _6"> </span>some<span class="_"> </span>state<span class="_ _13"> </span>information<span class="_ _6"> </span>stored<span class="_"> </span>from<span class="_ _6"> </span>the<span class="_"> </span>previous<span class="_ _6"> </span>instruction.</div><div class="t m5 x28 h2b y2d2 ff7 fs1e fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>is<span class="_"> </span>a<span class="_ _10"> </span>small<span class="_"> </span>illustration<span class="_"> </span>of<span class="_"> </span>the<span class="_ _10"> </span>fact<span class="_"> </span>that<span class="_"> </span>we<span class="_"> </span>can<span class="_ _10"> </span>implement<span class="_"> </span>a<span class="_"> </span>processor<span class="_"> </span>in<span class="_ _10"> </span>a<span class="_"> </span>way<span class="_"> </span>that<span class="_"> </span>differs<span class="_ _10"> </span>from<span class="_"> </span>the</div><div class="t m5 x28 h2b y2d3 ff7 fs1e fc2 sc0 ls0 ws0">conceptual<span class="_ _10"> </span>model<span class="_ _11"> </span>implied<span class="_ _11"> </span>by<span class="_ _11"> </span>the<span class="_ _10"> </span>ISA,<span class="_ _16"> </span>as<span class="_"> </span>long<span class="_ _11"> </span>as<span class="_ _11"> </span>the<span class="_ _11"> </span>processor<span class="_ _10"> </span>correctly<span class="_ _11"> </span>executes<span class="_ _11"> </span>arbitrary<span class="_ _11"> </span>machine-</div><div class="t m5 x28 h2b y2d4 ff7 fs1e fc2 sc0 ls0 ws0">language<span class="_ _6"> </span>programs<span class="_ _1"></span>.<span class="_ _6"> </span>W<span class="_ _1"></span>e<span class="_ _6"> </span>need<span class="_ _6"> </span>not<span class="_ _13"> </span>encode<span class="_ _a"> </span>the<span class="_ _13"> </span>state<span class="_ _a"> </span>in<span class="_ _6"> </span>the<span class="_ _13"> </span>form<span class="_ _a"> </span>indicated<span class="_ _6"> </span>by<span class="_ _13"> </span>the<span class="_ _a"> </span>programmer<span class="_ _1"></span>-visible<span class="_ _13"> </span>state<span class="_ _1"></span>,</div><div class="t m5 x28 h2b y2d5 ff7 fs1e fc2 sc0 ls0 ws0">as<span class="_"> </span>long<span class="_ _13"> </span>as<span class="_"> </span>the<span class="_ _13"> </span>processor<span class="_"> </span>can<span class="_"> </span>generate<span class="_ _13"> </span>correct<span class="_"> </span>values<span class="_ _13"> </span>for<span class="_"> </span>any<span class="_ _13"> </span>part<span class="_"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>programmer<span class="_ _1"></span>-visible<span class="_"> </span>state<span class="_ _13"> </span>(such</div><div class="t m5 x28 h2b y2d6 ff7 fs1e fc2 sc0 ls0 ws0">as<span class="_"> </span>the<span class="_"> </span>program<span class="_"> </span>counter).<span class="_ _10"> </span>W<span class="_ _1"></span>e<span class="_"> </span>will<span class="_ _10"> </span>exploit<span class="_ _10"> </span>this<span class="_ _10"> </span>principle<span class="_ _10"> </span>even<span class="_ _10"> </span>more<span class="_ _10"> </span>in<span class="_ _10"> </span>creating<span class="_ _10"> </span>a<span class="_ _10"> </span>pipelined<span class="_ _10"> </span>design.<span class="_ _10"> </span>Out-</div><div class="t m5 x28 h2b y549 ff7 fs1e fc2 sc0 ls0 ws0">of-order<span class="_"> </span>processing<span class="_ _11"> </span>techniques<span class="_ _1"></span>,<span class="_ _11"> </span>as<span class="_ _10"> </span>described<span class="_ _11"> </span>in<span class="_ _10"> </span>Section<span class="_ _11"> </span>5.7,<span class="_ _11"> </span>take<span class="_"> </span>this<span class="_ _11"> </span>idea<span class="_ _10"> </span>to<span class="_ _11"> </span>an<span class="_ _11"> </span>extreme<span class="_"> </span>by<span class="_ _11"> </span>executing</div><div class="t m5 x28 h2b y54a ff7 fs1e fc2 sc0 ls0 ws0">instructions<span class="_"> </span>in<span class="_"> </span>a<span class="_"> </span>completely<span class="_"> </span>different<span class="_"> </span>order<span class="_"> </span>than<span class="_"> </span>they<span class="_"> </span>occur<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>machine-level<span class="_"> </span>program.</div><div class="t m5 x1d h26 y3f73 ff7 fs19 fc2 sc0 ls0 ws0">“pCnd,<span class="_ _1"></span>”<span class="_ _13"> </span>and<span class="_ _6"> </span>so<span class="_ _13"> </span>on,<span class="_ _13"> </span>to<span class="_ _6"> </span>indicate<span class="_ _6"> </span>that<span class="_ _13"> </span>on<span class="_ _6"> </span>any<span class="_ _13"> </span>given<span class="_ _6"> </span>cycle<span class="_ _1"></span>,<span class="_ _13"> </span>they<span class="_ _13"> </span>hold<span class="_ _6"> </span>the<span class="_ _13"> </span>control<span class="_ _6"> </span>signals</div><div class="t m5 x1d h26 y3f74 ff7 fs19 fc2 sc0 ls0 ws0">generated<span class="_"> </span>during<span class="_"> </span>the<span class="_"> </span>previous<span class="_"> </span>cycle<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y3f75 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _16"> </span>4.40<span class="_ _16"> </span>shows<span class="_ _11"> </span>a<span class="_ _16"> </span>more<span class="_ _16"> </span>detailed<span class="_ _11"> </span>view<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span>SEQ+<span class="_ _16"> </span>hardware<span class="_ _0"></span>.<span class="_ _16"> </span>W<span class="_ _3"></span>e<span class="_ _16"> </span>can<span class="_ _11"> </span>see</div><div class="t m5 x1d h26 y3f76 ff7 fs19 fc2 sc0 ls0 ws0">that<span class="_"> </span>it<span class="_ _11"> </span>contains<span class="_ _11"> </span>the<span class="_ _11"> </span>exact<span class="_ _11"> </span>same<span class="_ _11"> </span>hardware<span class="_ _11"> </span>units<span class="_ _11"> </span>and<span class="_ _11"> </span>control<span class="_ _11"> </span>blocks<span class="_ _11"> </span>that<span class="_ _11"> </span>we<span class="_ _11"> </span>had<span class="_ _11"> </span>in</div><div class="t m5 x1d h26 y3f77 ff7 fs19 fc2 sc0 ls0 ws0">SEQ<span class="_"> </span>(F<span class="_ _1"></span>igure<span class="_"> </span>4.23),<span class="_ _13"> </span>but<span class="_"> </span>with<span class="_"> </span>the<span class="_ _13"> </span>PC<span class="_"> </span>logic<span class="_ _13"> </span>shifted<span class="_"> </span>from<span class="_"> </span>the<span class="_ _13"> </span>top<span class="_ _1"></span>,<span class="_"> </span>where<span class="_"> </span>it<span class="_ _13"> </span>was<span class="_"> </span>active</div><div class="t m5 x1d h26 y3f78 ff7 fs19 fc2 sc0 ls0 ws0">at<span class="_"> </span>the<span class="_"> </span>end<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>clock<span class="_"> </span>cycle<span class="_ _1"></span>,<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>bottom,<span class="_"> </span>where<span class="_"> </span>it<span class="_"> </span>is<span class="_"> </span>active<span class="_"> </span>at<span class="_"> </span>the<span class="_"> </span>beginning.</div><div class="t m5 x29 h26 y3f79 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _14"> </span>shift<span class="_ _14"> </span>of<span class="_ _14"> </span>state<span class="_ _14"> </span>elements<span class="_ _14"> </span>from<span class="_ _16"> </span>SEQ<span class="_ _14"> </span>to<span class="_ _14"> </span>SEQ+<span class="_ _14"> </span>is<span class="_ _14"> </span>an<span class="_ _14"> </span>example<span class="_ _14"> </span>of<span class="_ _14"> </span>a<span class="_ _16"> </span>general</div><div class="t m5 x1d h26 y3f7a ff7 fs19 fc2 sc0 ls0 ws0">transformation<span class="_"> </span>known<span class="_ _11"> </span>as<span class="_ _11"> </span><span class="ffa">circuit<span class="_"> </span>retiming<span class="_ _16"> </span></span>[68].<span class="_"> </span>Retiming<span class="_ _11"> </span>changes<span class="_ _11"> </span>the<span class="_"> </span>state<span class="_ _11"> </span>repre-</div><div class="t m5 x1d h26 y3f7b ff7 fs19 fc2 sc0 ls0 ws0">sentation<span class="_ _16"> </span>for<span class="_ _14"> </span>a<span class="_ _14"> </span>system<span class="_ _14"> </span>without<span class="_ _16"> </span>changing<span class="_ _14"> </span>its<span class="_ _14"> </span>logical<span class="_ _14"> </span>behavior.<span class="_ _16"> </span>It<span class="_ _14"> </span>is<span class="_ _14"> </span>often<span class="_ _16"> </span>used<span class="_ _14"> </span>to</div><div class="t m5 x1d h26 y3f7c ff7 fs19 fc2 sc0 ls0 ws0">balance<span class="_"> </span>the<span class="_"> </span>delays<span class="_"> </span>between<span class="_"> </span>the<span class="_"> </span>different<span class="_"> </span>stages<span class="_"> </span>of<span class="_"> </span>a<span class="_"> </span>pipelined<span class="_"> </span>system.</div><div class="t m5 x1d h41 y3f7d ffe fs29 fc2 sc0 ls0 ws0">4.5.2<span class="_ _48"> </span><span class="fs19">Inserting<span class="_"> </span>Pipeline<span class="_"> </span>Registers</span></div><div class="t m5 x1d h26 y3f7e ff7 fs19 fc2 sc0 ls0 ws0">In<span class="_ _16"> </span>our<span class="_ _16"> </span>ﬁrst<span class="_ _11"> </span>attempt<span class="_ _16"> </span>at<span class="_ _16"> </span>creating<span class="_ _16"> </span>a<span class="_ _16"> </span>pipelined<span class="_ _16"> </span>Y86-64<span class="_ _11"> </span>processor,<span class="_ _16"> </span>we<span class="_ _16"> </span>insert<span class="_ _16"> </span>pipeline</div><div class="t m5 x1d h26 y3f7f ff7 fs19 fc2 sc0 ls0 ws0">registers<span class="_ _16"> </span>between<span class="_ _11"> </span>the<span class="_ _16"> </span>stages<span class="_ _16"> </span>of<span class="_ _11"> </span>SEQ+<span class="_ _16"> </span>and<span class="_ _16"> </span>rearrange<span class="_ _16"> </span>signals<span class="_ _11"> </span>somewhat,<span class="_ _16"> </span>yielding</div><div class="t m5 x1d h46 y3f80 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>PIPE<span class="ff12">−<span class="_ _10"> </span></span>processor<span class="_ _1"></span>,<span class="_"> </span>where<span class="_"> </span>the<span class="_"> </span>“<span class="ff12">−</span>”<span class="_"> </span>in<span class="_ _13"> </span>the<span class="_"> </span>name<span class="_"> </span>signiﬁes<span class="_"> </span>that<span class="_"> </span>this<span class="_ _13"> </span>processor<span class="_"> </span>has</div><div class="t m5 x1d h26 y3f81 ff7 fs19 fc2 sc0 ls0 ws0">somewhat<span class="_"> </span>less<span class="_"> </span>performance<span class="_"> </span>than<span class="_ _11"> </span>our<span class="_"> </span>ultimate<span class="_"> </span>processor<span class="_ _11"> </span>design.<span class="_"> </span>T<span class="_ _0"></span>he<span class="_"> </span>structure<span class="_"> </span>of</div><div class="t m5 x1d h46 y3f82 ff7 fs19 fc2 sc0 ls0 ws0">PIPE<span class="ff12">−<span class="_ _10"> </span></span>is<span class="_"> </span>illustrated<span class="_ _13"> </span>in<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>4.41.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>pipeline<span class="_"> </span>registers<span class="_"> </span>are<span class="_ _13"> </span>shown<span class="_"> </span>in<span class="_"> </span>this<span class="_"> </span>ﬁgure</div><div class="t m5 x1d h26 y3f83 ff7 fs19 fc2 sc0 ls0 ws0">as<span class="_ _11"> </span>blue<span class="_ _11"> </span>boxes<span class="_ _1"></span>,<span class="_ _11"> </span>each<span class="_ _11"> </span>containing<span class="_ _11"> </span>different<span class="_ _11"> </span>ﬁelds<span class="_ _11"> </span>that<span class="_ _11"> </span>are<span class="_ _11"> </span>shown<span class="_ _16"> </span>as<span class="_"> </span>white<span class="_ _11"> </span>boxes<span class="_ _1"></span>.<span class="_ _11"> </span>As</div><div class="t m5 x1d h26 y3f84 ff7 fs19 fc2 sc0 ls0 ws0">indicated<span class="_ _16"> </span>by<span class="_ _14"> </span>the<span class="_ _16"> </span>multiple<span class="_ _14"> </span>ﬁelds<span class="_ _1"></span>,<span class="_ _14"> </span>each<span class="_ _16"> </span>pipeline<span class="_ _14"> </span>register<span class="_ _16"> </span>holds<span class="_ _14"> </span>multiple<span class="_ _16"> </span>bytes<span class="_ _14"> </span>and</div><div class="t m5 x1d h26 y3f85 ff7 fs19 fc2 sc0 ls0 ws0">words<span class="_ _1"></span>.<span class="_ _13"> </span>Unlike<span class="_"> </span>the<span class="_ _13"> </span>labels<span class="_ _13"> </span>shown<span class="_"> </span>in<span class="_ _13"> </span>rounded<span class="_ _13"> </span>boxes<span class="_"> </span>in<span class="_ _13"> </span>the<span class="_ _13"> </span>hardware<span class="_"> </span>structure<span class="_ _13"> </span>of<span class="_ _13"> </span>the</div><div class="t m5 x1d h26 y3f86 ff7 fs19 fc2 sc0 ls0 ws0">two<span class="_ _14"> </span>sequential<span class="_ _14"> </span>processors<span class="_ _15"> </span>(F<span class="_ _1"></span>igures<span class="_ _15"> </span>4.23<span class="_ _14"> </span>and<span class="_ _14"> </span>4.40),<span class="_ _21"> </span>these<span class="_ _14"> </span>white<span class="_ _14"> </span>boxes<span class="_ _15"> </span>represent</div><div class="t m5 x1d h26 y3f87 ff7 fs19 fc2 sc0 ls0 ws0">actual<span class="_"> </span>hardware<span class="_"> </span>components<span class="_ _1"></span>.</div><div class="t m5 x29 h46 y3f88 ff7 fs19 fc2 sc0 ls0 ws0">Observe<span class="_ _6"> </span>that<span class="_ _13"> </span>PIPE<span class="ff12">−<span class="_ _6"></span></span>uses<span class="_ _13"> </span>nearly<span class="_ _6"> </span>the<span class="_ _6"> </span>same<span class="_ _13"> </span>set<span class="_ _6"> </span>of<span class="_ _13"> </span>hardware<span class="_ _a"> </span>units<span class="_ _13"> </span>as<span class="_ _6"> </span>our<span class="_ _13"> </span>sequen-</div><div class="t m5 x1d h26 y3f89 ff7 fs19 fc2 sc0 ls0 ws0">tial<span class="_ _13"> </span>design<span class="_ _13"> </span>SEQ<span class="_ _13"> </span>(F<span class="_ _1"></span>igure<span class="_ _13"> </span>4.40),<span class="_ _13"> </span>but<span class="_ _13"> </span>with<span class="_ _13"> </span>the<span class="_ _13"> </span>pipeline<span class="_ _13"> </span>registers<span class="_ _13"> </span>separating<span class="_ _13"> </span>the<span class="_ _13"> </span>stages<span class="_ _3"></span>.</div><div class="t m5 x1d h26 y3f8a ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _13"> </span>differences<span class="_ _6"> </span>between<span class="_ _6"> </span>the<span class="_ _13"> </span>signals<span class="_ _6"> </span>in<span class="_ _13"> </span>the<span class="_ _6"> </span>two<span class="_ _6"> </span>systems<span class="_ _13"> </span>is<span class="_ _6"> </span>discussed<span class="_ _6"> </span>in<span class="_ _13"> </span>Section<span class="_ _6"> </span>4.5.3.</div><div class="t m5 x29 h26 y3f8b ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>pipeline<span class="_"> </span>registers<span class="_"> </span>are<span class="_"> </span>labeled<span class="_"> </span>as<span class="_"> </span>follows:</div><div class="t m5 x75 h26 y3f8c ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _e"> </span>holds<span class="_"> </span>a<span class="_"> </span><span class="ffa">predicted<span class="_ _11"> </span></span>value<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>program<span class="_"> </span>counter,<span class="_"> </span>as<span class="_"> </span>will<span class="_"> </span>be<span class="_"> </span>discussed<span class="_"> </span>shortly<span class="_ _3"></span>.</div><div class="t m5 x75 h26 y3f8d ff7 fs19 fc2 sc0 ls0 ws0">D<span class="_ _e"> </span>sits<span class="_ _13"> </span>between<span class="_ _6"> </span>the<span class="_ _13"> </span>fetch<span class="_ _6"> </span>and<span class="_ _13"> </span>decode<span class="_ _6"> </span>stages<span class="_ _0"></span>.<span class="_ _6"> </span>It<span class="_ _13"> </span>holds<span class="_ _6"> </span>information<span class="_ _13"> </span>about<span class="_ _6"> </span>the<span class="_ _13"> </span>most</div><div class="t m5 xcd h26 y3f8e ff7 fs19 fc2 sc0 ls0 ws0">recently<span class="_"> </span>fetched<span class="_"> </span>instruction<span class="_"> </span>for<span class="_"> </span>processing<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span>decode<span class="_"> </span>stage<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
