<div id="pf16b" class="pf w2 h11" data-page-no="16b"><div class="pc pc16b w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg16b.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">362<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x1d h26 y9c ff7 fs19 fc2 sc0 ls0 ws0">two<span class="_ _16"> </span>forms<span class="_ _16"> </span>is<span class="_ _16"> </span>an<span class="_ _16"> </span>important<span class="_ _16"> </span>skill<span class="_ _14"> </span>to<span class="_ _16"> </span>learn.<span class="_ _16"> </span>One<span class="_ _16"> </span>important<span class="_ _16"> </span>feature<span class="_ _16"> </span>is<span class="_ _14"> </span>that<span class="_ _16"> </span>memory</div><div class="t m5 x1d h26 y409 ff7 fs19 fc2 sc0 ls0 ws0">references<span class="_ _13"> </span>in<span class="_ _13"> </span>x86-64<span class="_ _13"> </span>are<span class="_ _13"> </span>always<span class="_ _13"> </span>given<span class="_ _13"> </span>with<span class="_ _13"> </span>quad<span class="_ _13"> </span>word<span class="_ _13"> </span>registers<span class="_ _1"></span>,<span class="_ _13"> </span>such<span class="_ _13"> </span>as<span class="_"> </span><span class="ffd">%rax</span>,<span class="_ _13"> </span>even</div><div class="t m5 x1d h26 y40a ff7 fs19 fc2 sc0 ls0 ws0">if<span class="_"> </span>the<span class="_"> </span>operand<span class="_"> </span>is<span class="_"> </span>a<span class="_"> </span>byte<span class="_ _1"></span>,<span class="_"> </span>single<span class="_"> </span>word,<span class="_"> </span>or<span class="_"> </span>double<span class="_"> </span>word.</div><div class="t m5 x29 h26 y40b ff7 fs19 fc2 sc0 ls0 ws0">Here<span class="_"> </span>is<span class="_"> </span>the<span class="_"> </span>code<span class="_"> </span>written<span class="_"> </span>with<span class="_"> </span>sufÔ¨Åxes:</div><div class="t m5 x75 h2d y3305 ffd fs1e fc2 sc0 ls0 ws0">movl<span class="_ _3f"> </span>%eax,<span class="_ _e"> </span>(%rsp)</div><div class="t m5 x75 h2d y3306 ffd fs1e fc2 sc0 ls0 ws0">movw<span class="_ _3f"> </span>(%rax),<span class="_ _e"> </span>%dx</div><div class="t m5 x75 h2d y3307 ffd fs1e fc2 sc0 ls0 ws0">movb<span class="_ _3f"> </span>$0xFF,<span class="_ _e"> </span>%bl</div><div class="t m5 x75 h2d y3308 ffd fs1e fc2 sc0 ls0 ws0">movb<span class="_ _3f"> </span>(%rsp,%rdx,4),<span class="_ _e"> </span>%dl</div><div class="t m5 x75 h2d y3309 ffd fs1e fc2 sc0 ls0 ws0">movq<span class="_ _1a"> </span>(%rdx),<span class="_ _e"> </span>%rax</div><div class="t m5 x75 h2d y330a ffd fs1e fc2 sc0 ls0 ws0">movw<span class="_ _3f"> </span>%dx,<span class="_ _e"> </span>(%rax)</div><div class="t m5 x1d h28 y330b ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>3.3</div><div class="t m5 x1ed h2f y330c ffe fs16 fc6 sc0 ls0 ws0">(page<span class="_"> </span>222)</div><div class="t m5 x1d h26 y330d ff7 fs19 fc1 sc0 ls0 ws0">Since<span class="_ _16"> </span>we<span class="_ _16"> </span>will<span class="_ _16"> </span>rely<span class="_ _14"> </span>on<span class="_ _16"> </span><span class="ff9">gcc<span class="_ _16"> </span></span>to<span class="_ _16"> </span>generate<span class="_ _14"> </span>most<span class="_ _16"> </span>of<span class="_ _16"> </span>our<span class="_ _14"> </span>assembly<span class="_ _16"> </span>code<span class="_ _1"></span>,<span class="_ _14"> </span>being<span class="_ _14"> </span>able<span class="_ _16"> </span>to</div><div class="t m5 x1d h26 y330e ff7 fs19 fc1 sc0 ls0 ws0">write<span class="_ _16"> </span>correct<span class="_ _16"> </span>assembly<span class="_ _16"> </span>code<span class="_ _16"> </span>is<span class="_ _16"> </span>not<span class="_ _16"> </span>a<span class="_ _16"> </span>critical<span class="_ _16"> </span>skill.<span class="_ _16"> </span>Nonetheless<span class="_ _1"></span>,<span class="_ _16"> </span>this<span class="_ _16"> </span>exercise<span class="_ _16"> </span>will</div><div class="t m5 x1d h26 y330f ff7 fs19 fc1 sc0 ls0 ws0">help<span class="_"> </span>you<span class="_"> </span>become<span class="_"> </span>more<span class="_"> </span>familiar<span class="_"> </span>with<span class="_"> </span>the<span class="_"> </span>different<span class="_"> </span>instruction<span class="_"> </span>and<span class="_"> </span>operand<span class="_"> </span>types<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y3310 ff7 fs19 fc1 sc0 ls0 ws0">Here<span class="_"> </span>is<span class="_"> </span>the<span class="_"> </span>code<span class="_"> </span>with<span class="_"> </span>explanations<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>errors:</div><div class="t m5 x239 h2d y3311 ffd fs1e fc2 sc0 ls0 ws0">movb<span class="_ _e"> </span>$0xF,<span class="_ _1f"> </span>(%ebx)<span class="_ _18c"> </span><span class="ff13 fs35 fc6">Cannot<span class="_ _f"> </span>use<span class="_ _f"> </span>%ebx<span class="_ _f"> </span>as<span class="_ _e"> </span>address<span class="_ _21"> </span>register</span></div><div class="t m5 x239 h2d y3312 ffd fs1e fc2 sc0 ls0 ws0">movl<span class="_ _e"> </span>%rax,<span class="_ _1f"> </span>(%rsp)<span class="_ _18c"> </span><span class="ff13 fs35 fc6">Mismatch<span class="_ _f"> </span>between<span class="_ _f"> </span>instruction<span class="_ _f"> </span>suffix<span class="_ _e"> </span>and<span class="_ _21"> </span>register<span class="_ _f"> </span>ID</span></div><div class="t m5 x239 h2d y3313 ffd fs1e fc2 sc0 ls0 ws0">movw<span class="_ _e"> </span>(%rax),4(%rsp)<span class="_ _93"> </span><span class="ff13 fs35 fc6">Cannot<span class="_ _e"> </span>have<span class="_ _21"> </span>both<span class="_ _f"> </span>source<span class="_ _f"> </span>and<span class="_ _e"> </span>destination<span class="_ _21"> </span>be<span class="_ _f"> </span>memory<span class="_ _e"> </span>references</span></div><div class="t m5 x239 h2d y3314 ffd fs1e fc2 sc0 ls0 ws0">movb<span class="_ _e"> </span>%al,%sl<span class="_ _12b"> </span><span class="ff13 fs35 fc6">No<span class="_ _e"> </span>register<span class="_ _21"> </span>named<span class="_ _f"> </span>%sl</span></div><div class="t m5 x239 h2d y3315 ffd fs1e fc2 sc0 ls0 ws0">movl<span class="_ _e"> </span>%eax,$0x123<span class="_ _2a"> </span><span class="ff13 fs35 fc6">Cannot<span class="_ _f"> </span>have<span class="_ _f"> </span>immediate<span class="_ _e"> </span>as<span class="_ _21"> </span>destination</span></div><div class="t m5 x239 h2d y3316 ffd fs1e fc2 sc0 ls0 ws0">movl<span class="_ _e"> </span>%eax,%dx<span class="_ _c2"> </span><span class="ff13 fs35 fc6">Destination<span class="_ _e"> </span>operand<span class="_ _21"> </span>incorrect<span class="_ _f"> </span>size</span></div><div class="t m5 x239 h2d y3317 ffd fs1e fc2 sc0 ls0 ws0">movb<span class="_ _e"> </span>%si,<span class="_ _1f"> </span>8(%rbp)<span class="_ _18c"> </span><span class="ff13 fs35 fc6">Mismatch<span class="_ _f"> </span>between<span class="_ _f"> </span>instruction<span class="_ _f"> </span>suffix<span class="_ _e"> </span>and<span class="_ _21"> </span>register<span class="_ _f"> </span>ID</span></div><div class="t m5 x1d h28 y3318 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>3.4<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>223)</span></div><div class="t m5 x1d h26 y3319 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _15"> </span>exercise<span class="_ _14"> </span>gives<span class="_ _15"> </span>you<span class="_ _14"> </span>more<span class="_ _15"> </span>experience<span class="_ _14"> </span>with<span class="_ _15"> </span>the<span class="_ _14"> </span>different<span class="_ _15"> </span>data<span class="_ _14"> </span>movement<span class="_ _14"> </span>in-</div><div class="t m5 x1d h26 y331a ff7 fs19 fc1 sc0 ls0 ws0">structions<span class="_ _16"> </span>and<span class="_ _16"> </span>how<span class="_ _11"> </span>they<span class="_ _16"> </span>relate<span class="_ _16"> </span>to<span class="_ _16"> </span>the<span class="_ _16"> </span>data<span class="_ _16"> </span>types<span class="_ _11"> </span>and<span class="_ _16"> </span>conversion<span class="_ _16"> </span>rules<span class="_ _16"> </span>of<span class="_ _16"> </span>C<span class="_ _0"></span>.<span class="_ _16"> </span>T<span class="_ _1"></span>he</div><div class="t m5 x1d h26 y331b ff7 fs19 fc1 sc0 ls0 ws0">nuances<span class="_ _13"> </span>of<span class="_"> </span>conversions<span class="_ _13"> </span>of<span class="_ _13"> </span>both<span class="_"> </span>signedness<span class="_ _13"> </span>and<span class="_ _13"> </span>size,<span class="_ _13"> </span>as<span class="_ _13"> </span>well<span class="_"> </span>as<span class="_ _13"> </span>integral<span class="_ _13"> </span>promotion,</div><div class="t m5 x1d h26 y331c ff7 fs19 fc1 sc0 ls0 ws0">add<span class="_"> </span>challenge<span class="_"> </span>to<span class="_"> </span>this<span class="_"> </span>problem.</div><div class="t m5 x1d h2d y331d ffd fs1e fc2 sc0 ls0 ws0">src_t<span class="_ _18b"> </span>dest_t</div><div class="t m5 x200 h31 y331e ff7 fs21 fc2 sc0 ls0 ws0">Instruction<span class="_ _89"> </span>Comments</div><div class="t m5 x1d h2d y331f ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _16d"> </span>long<span class="_ _6f"> </span>movq<span class="_ _11"> </span>(%rdi),<span class="_ _11"> </span>%rax</div><div class="t m5 x11c h31 y3320 ff7 fs21 fc2 sc0 ls0 ws0">Read<span class="_"> </span>8<span class="_"> </span>bytes</div><div class="t m5 x200 h31 y3321 ffd fs1e fc2 sc0 ls0 ws0">movq<span class="_ _11"> </span>%rax,<span class="_ _11"> </span>(%rsi)<span class="_ _8c"> </span><span class="ff7 fs21">Store<span class="_"> </span>8<span class="_"> </span>bytes</span></div><div class="t m5 x1d h2d y3322 ffd fs1e fc2 sc0 ls0 ws0">char<span class="_ _16d"> </span>int<span class="_ _71"> </span>movsbl<span class="_ _11"> </span>(%rdi),<span class="_ _11"> </span>%eax</div><div class="t m5 x11c h31 y1ef0 ff7 fs21 fc2 sc0 ls0 ws0">Convert<span class="_"> </span>char<span class="_"> </span>to<span class="_"> </span>int</div><div class="t m5 x200 h31 y3323 ffd fs1e fc2 sc0 ls0 ws0">movl<span class="_ _11"> </span>%eax,<span class="_ _11"> </span>(%rsi)<span class="_ _8c"> </span><span class="ff7 fs21">Store<span class="_"> </span>4<span class="_"> </span>bytes</span></div><div class="t m5 x1d h2d y1ef6 ffd fs1e fc2 sc0 ls0 ws0">char<span class="_ _16d"> </span>unsigned<span class="_ _3f"> </span>movsbl<span class="_ _11"> </span>(%rdi),<span class="_ _11"> </span>%eax</div><div class="t m5 x11c h31 y3324 ff7 fs21 fc2 sc0 ls0 ws0">Convert<span class="_"> </span>char<span class="_"> </span>to<span class="_"> </span>int</div><div class="t m5 x200 h2d y3325 ffd fs1e fc2 sc0 ls0 ws0">movl<span class="_ _11"> </span>%eax,<span class="_ _11"> </span>(%rsi)</div><div class="t m5 x11c h31 y3326 ff7 fs21 fc2 sc0 ls0 ws0">Store<span class="_"> </span>4<span class="_"> </span>bytes</div><div class="t m5 x1d h31 y3327 ffd fs1e fc2 sc0 ls0 ws0">unsigned<span class="_ _11"> </span>char<span class="_ _3f"> </span>long<span class="_ _6f"> </span>movzbl<span class="_ _11"> </span>(%rdi),<span class="_ _11"> </span>%eax<span class="_ _3f"> </span><span class="ff7 fs21">Read<span class="_"> </span>byte<span class="_"> </span>and<span class="_"> </span>zero-extend</span></div><div class="t m5 x200 h31 y3328 ffd fs1e fc2 sc0 ls0 ws0">movq<span class="_ _11"> </span>%rax,<span class="_ _11"> </span>(%rsi)<span class="_ _8c"> </span><span class="ff7 fs21">Store<span class="_"> </span>8<span class="_"> </span>bytes</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
