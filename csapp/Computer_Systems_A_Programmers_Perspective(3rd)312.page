<div id="pf138" class="pf w2 h11" data-page-no="138"><div class="pc pc138 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg138.png"/><div class="t m5 xa1 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>3.9<span class="_ _60"> </span>Heterogeneous<span class="_ _10"> </span>Data<span class="_ _10"> </span>Structures<span class="_ _3e"> </span><span class="ffe fs1e">311</span></div><div class="t m5 x17 h2d y140c ffd fs1e fc2 sc0 ls0 ws0">struct<span class="_ _e"> </span>S2<span class="_ _1f"> </span>{</div><div class="t m5 x1b6 h2d y140d ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _1a"> </span>i;</div><div class="t m5 x1b6 h2d y1b95 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _1a"> </span>j;</div><div class="t m5 x1b6 h2d y2122 ffd fs1e fc2 sc0 ls0 ws0">char<span class="_ _e"> </span>c;</div><div class="t m5 x17 h2d y1b96 ffd fs1e fc2 sc0 ls0 ws0">};</div><div class="t m5 x17 h26 y2cc6 ff7 fs19 fc2 sc0 ls0 ws0">If<span class="_ _6"> </span>we<span class="_ _6"> </span>pack<span class="_ _6"> </span>this<span class="_ _6"> </span>structure<span class="_ _6"> </span>into<span class="_ _6"> </span>9<span class="_ _6"> </span>bytes<span class="_ _1"></span>,<span class="_ _13"> </span>we<span class="_ _a"> </span>can<span class="_ _6"> </span>still<span class="_ _6"> </span>satisfy<span class="_ _13"> </span>the<span class="_ _a"> </span>alignment<span class="_ _6"> </span>requirements</div><div class="t m5 x17 h26 y2cc7 ff7 fs19 fc2 sc0 ls0 ws0">for<span class="_ _13"> </span>ﬁelds<span class="_"> </span><span class="ffd">i<span class="_ _13"> </span></span>and<span class="_"> </span><span class="ffd">j<span class="_ _13"> </span></span>by<span class="_ _13"> </span>making<span class="_"> </span>sure<span class="_ _13"> </span>that<span class="_"> </span>the<span class="_ _13"> </span>starting<span class="_ _13"> </span>address<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>structure<span class="_ _13"> </span>satisﬁes</div><div class="t m5 x17 h26 y2cc8 ff7 fs19 fc2 sc0 ls0 ws0">a<span class="_"> </span>4-byte<span class="_"> </span>alignment<span class="_"> </span>requirement.<span class="_"> </span>Consider,<span class="_"> </span>however<span class="_ _1"></span>,<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>declaration:</div><div class="t m5 x17 h2d y2cc9 ffd fs1e fc2 sc0 ls0 ws0">struct<span class="_ _e"> </span>S2<span class="_ _1f"> </span>d[4];</div><div class="t m5 x17 h26 y2cca ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _1"></span>ith<span class="_ _11"> </span>the<span class="_"> </span>9-byte<span class="_"> </span>allocation,<span class="_"> </span>it<span class="_ _11"> </span>is<span class="_"> </span>not<span class="_"> </span>possible<span class="_ _11"> </span>to<span class="_"> </span>satisfy<span class="_"> </span>the<span class="_"> </span>alignment<span class="_ _11"> </span>requirement</div><div class="t m5 x17 h26 y2ccb ff7 fs19 fc2 sc0 ls0 ws0">for<span class="_ _15"> </span>each<span class="_ _21"> </span>element<span class="_ _21"> </span>of<span class="_ _21"> </span><span class="ffd">d</span>,<span class="_ _e"> </span>because<span class="_ _15"> </span>these<span class="_ _21"> </span>elements<span class="_ _15"> </span>will<span class="_ _21"> </span>have<span class="_ _21"> </span>addresses<span class="_ _21"> </span><span class="ff11">x</span></div><div class="t m5 x1fd h6e y2ccc ffd fs25 fc2 sc0 ls0 ws0">d</div><div class="t m5 x147 h26 y2ccd ff7 fs19 fc2 sc0 ls0 ws0">,<span class="_ _f"> </span><span class="ff11">x</span></div><div class="t m5 x1dc h6e y2cce ffd fs25 fc2 sc0 ls0 ws0">d</div><div class="t m5 x172 h46 y2ccd ff12 fs19 fc2 sc0 ls0 ws0">+<span class="_ _10"> </span><span class="ff7 ls63">9,</span></div><div class="t m5 x17 h45 y2ccf ff11 fs19 fc2 sc0 ls0 ws0">x</div><div class="t m5 x52 h6e y2cd0 ffd fs25 fc2 sc0 ls0 ws0">d</div><div class="t m5 x1f5 h46 y2cd1 ff12 fs19 fc2 sc0 ls0 ws0">+<span class="_ _10"> </span><span class="ff7 ls18">18,<span class="_ _15"> </span>and<span class="_ _15"> </span></span><span class="ff11">x</span></div><div class="t m5 x1f6 h6e y2cd0 ffd fs25 fc2 sc0 ls0 ws0">d</div><div class="t m5 x161 h46 y2cd1 ff12 fs19 fc2 sc0 ls0 ws0">+<span class="_ _10"> </span><span class="ff7 ls9d">27.<span class="_ _14"> </span>Instead,<span class="_ _21"> </span>the<span class="_ _15"> </span>compiler<span class="_ _15"> </span>allocates<span class="_ _15"> </span>12<span class="_ _14"> </span>bytes<span class="_ _15"> </span>for<span class="_ _15"> </span>structure<span class="_ _15"> </span></span><span class="ffd">S2<span class="ff7">,</span></span></div><div class="t m5 x17 h26 y2cd2 ff7 fs19 fc2 sc0 ls0 ws0">with<span class="_"> </span>the<span class="_"> </span>ﬁnal<span class="_"> </span>3<span class="_"> </span>bytes<span class="_"> </span>being<span class="_"> </span>wasted<span class="_"> </span>space:</div><div class="t m5 x62 h3f y2cd3 ff2e fs27 fc1 sc0 ls0 ws0">Offset </div><div class="t m5 x17 h3f y2cd4 ff2e fs27 fc1 sc0 ls0 ws0">Contents </div><div class="t m5 x155 h40 y2cd5 ff2f fs28 fc1 sc0 ls0 ws0">i</div><div class="t m5 x1da h3f y2cd6 ff2e fs27 fc1 sc0 ls17e ws0">04<span class="_ _1b"> </span>9<span class="_ _123"></span>81<span class="_ _173"></span>2</div><div class="t m5 x89 h40 y2cd5 ff2f fs28 fc1 sc0 ls0 ws0">c<span class="_ _120"></span>j</div><div class="t m5 x17 h26 y2cd7 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>hat<span class="_ _11"> </span>way<span class="_ _3"></span>,<span class="_"> </span>the<span class="_"> </span>elements<span class="_ _11"> </span>of<span class="_"> </span><span class="ffd">d<span class="_ _11"> </span></span>will<span class="_"> </span>have<span class="_ _11"> </span>addresses<span class="_"> </span><span class="ff11">x</span></div><div class="t m5 x101 h6e y2cd8 ffd fs25 fc2 sc0 ls0 ws0">d</div><div class="t m5 x179 h26 y2cd7 ff7 fs19 fc2 sc0 ls0 ws0">,<span class="_"> </span><span class="ff11">x</span></div><div class="t m5 x208 h6e y2cd8 ffd fs25 fc2 sc0 ls0 ws0">d</div><div class="t m5 x199 h46 y2cd9 ff12 fs19 fc2 sc0 ls0 ws0">+<span class="_ _13"> </span><span class="ff7">12<span class="_ _2"></span>,<span class="_"> </span><span class="ff11">x</span></span></div><div class="t m5 x94 h6e y2cd8 ffd fs25 fc2 sc0 ls0 ws0">d</div><div class="t m5 x60 h46 y2cd9 ff12 fs19 fc2 sc0 ls0 ws0">+<span class="_ _13"> </span><span class="ff7 lsa5">24,<span class="_ _11"> </span>and<span class="_"> </span></span><span class="ff11">x</span></div><div class="t m5 x23c h6e y2cd8 ffd fs25 fc2 sc0 ls0 ws0">d</div><div class="t m5 x19e h46 y2cd9 ff12 fs19 fc2 sc0 ls0 ws0">+<span class="_ _13"> </span><span class="ff7 ls9e">36.</span></div><div class="t m5 x17 h26 y2cda ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_"> </span>long<span class="_"> </span>as<span class="_"> </span><span class="ff11">x</span></div><div class="t m5 x1a7 h6e y2cdb ffd fs25 fc2 sc0 ls0 ws0">d</div><div class="t m5 xa2 h26 y2cdc ff7 fs19 fc2 sc0 ls0 ws0">is<span class="_"> </span>a<span class="_"> </span>multiple<span class="_"> </span>of<span class="_"> </span>4,<span class="_"> </span>all<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>alignment<span class="_"> </span>restrictions<span class="_"> </span>will<span class="_"> </span>be<span class="_"> </span>satisﬁed.</div><div class="t m5 x17 h47 y2cdd ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>3.44<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>381)</span></div><div class="t m5 x17 h26 y2cde ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _13"> </span>each<span class="_ _13"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>following<span class="_ _13"> </span>structure<span class="_ _13"> </span>declarations<span class="_ _3"></span>,<span class="_"> </span>determine<span class="_ _6"> </span>the<span class="_ _13"> </span>offset<span class="_ _13"> </span>of<span class="_ _13"> </span>each<span class="_ _6"> </span>ﬁeld,</div><div class="t m5 x17 h26 y2cdf ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>total<span class="_"> </span>size<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>structure<span class="_ _1"></span>,<span class="_"> </span>and<span class="_"> </span>its<span class="_"> </span>alignment<span class="_"> </span>requirement<span class="_"> </span>for<span class="_"> </span>x86-64:</div><div class="t m5 x34 h26 y2ce0 ff7 fs19 fc1 sc0 ls0 ws0">A.<span class="_ _1f"> </span><span class="ffd">struct<span class="_ _11"> </span>P1<span class="_ _16"> </span>{<span class="_ _16"> </span>short<span class="_ _11"> </span>i;<span class="_ _16"> </span>int<span class="_ _11"> </span>c;<span class="_ _16"> </span>int<span class="_ _16"> </span>*j;<span class="_ _11"> </span>short<span class="_ _16"> </span>*d;<span class="_ _16"> </span>};</span></div><div class="t m5 x34 h26 y2ce1 ff7 fs19 fc1 sc0 ls2a ws0">B.<span class="_ _66"> </span><span class="ffd ls0">struct<span class="_ _11"> </span>P2<span class="_ _16"> </span>{<span class="_ _16"> </span>int<span class="_ _11"> </span>i[2];<span class="_ _16"> </span>char<span class="_ _16"> </span>c[8];<span class="_ _11"> </span>short<span class="_ _16"> </span>s[4];<span class="_ _11"> </span>long<span class="_ _16"> </span>*j;<span class="_ _16"> </span>};</span></div><div class="t m5 x34 h26 y2ce2 ff7 fs19 fc1 sc0 ls22 ws0">C.<span class="_ _24"> </span><span class="ffd ls0">struct<span class="_ _16"> </span>P3<span class="_ _11"> </span>{<span class="_ _16"> </span>long<span class="_ _11"> </span>w[2];<span class="_ _16"> </span>int<span class="_ _16"> </span>*c[2]<span class="_ _11"> </span>};</span></div><div class="t m5 x34 h26 y2ce3 ff7 fs19 fc1 sc0 ls2a ws0">D.<span class="_ _24"> </span><span class="ffd ls0">struct<span class="_ _11"> </span>P4<span class="_ _16"> </span>{<span class="_ _16"> </span>char<span class="_ _11"> </span>w[16];<span class="_ _16"> </span>char<span class="_ _11"> </span>*c[2]<span class="_ _16"> </span>};</span></div><div class="t m5 x34 h26 y2ce4 ff7 fs19 fc1 sc0 ls0 ws0">E.<span class="_ _25"> </span><span class="ffd">struct<span class="_ _11"> </span>P5<span class="_ _16"> </span>{<span class="_ _16"> </span>struct<span class="_ _11"> </span>P4<span class="_ _16"> </span>a[2];<span class="_ _11"> </span>struct<span class="_ _16"> </span>P1<span class="_ _16"> </span>t<span class="_ _11"> </span>};</span></div><div class="t m5 x17 h47 y2ce5 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>3.45<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>381)</span></div><div class="t m5 x17 h26 y2ce6 ff7 fs19 fc1 sc0 ls0 ws0">Answer<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>structure<span class="_"> </span>declaration</div><div class="t m5 x17 h2d y74e ffd fs1e fc2 sc0 ls0 ws0">struct<span class="_ _e"> </span>{</div><div class="t m5 x72 h2d y2ce7 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _46"> </span>*a;</div><div class="t m5 x72 h2d y2ce8 ffd fs1e fc2 sc0 ls0 ws0">float<span class="_ _1a"> </span>b;</div><div class="t m5 x72 h2d y2ce9 ffd fs1e fc2 sc0 ls0 ws0">char<span class="_ _3f"> </span>c;</div><div class="t m5 x72 h2d y2cea ffd fs1e fc2 sc0 ls0 ws0">short<span class="_ _1a"> </span>d;</div><div class="t m5 x72 h2d y2ceb ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _3f"> </span>e;</div><div class="t m5 x72 h2d y2cec ffd fs1e fc2 sc0 ls0 ws0">double<span class="_ _e"> </span>f;</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
