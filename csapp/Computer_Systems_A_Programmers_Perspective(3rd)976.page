<div id="pf3d0" class="pf w2 h11" data-page-no="3d0"><div class="pc pc3d0 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg3d0.png"/><div class="t m5 x1df h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>11.4<span class="_ _60"> </span>The<span class="_ _10"> </span>Sockets<span class="_ _10"> </span>Interface<span class="_ _3e"> </span><span class="ffe fs1e">975</span></div><div class="t m5 x1e9 h2c y27f ffa fs16 fc2 sc0 ls0 ws0">code/netp/netpfragments<span class="_ _1"></span>.c</div><div class="t m5 x1b6 h2d y280 ffd fs1e fc2 sc0 ls0 ws0">struct<span class="_ _e"> </span>addrinfo<span class="_ _1f"> </span>{</div><div class="t m5 x21e h2d y7c3a ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _16f"> </span>ai_flags;<span class="_ _58"> </span>/*<span class="_ _1f"> </span>Hints<span class="_ _e"> </span>argument<span class="_ _1f"> </span>flags<span class="_ _e"> </span>*/</div><div class="t m5 x21e h2d y7c3b ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _16f"> </span>ai_family;<span class="_ _7b"> </span>/*<span class="_ _1f"> </span>First<span class="_ _e"> </span>arg<span class="_ _1f"> </span>to<span class="_ _e"> </span>socket<span class="_ _1f"> </span>function<span class="_ _1f"> </span>*/</div><div class="t m5 x21e h2d y7c3c ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _16f"> </span>ai_socktype;<span class="_ _3b"> </span>/*<span class="_ _1f"> </span>Second<span class="_ _e"> </span>arg<span class="_ _1f"> </span>to<span class="_ _e"> </span>socket<span class="_ _1f"> </span>function<span class="_ _1f"> </span>*/</div><div class="t m5 x21e h2d y7c3d ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _16f"> </span>ai_protocol;<span class="_ _3b"> </span>/*<span class="_ _1f"> </span>Third<span class="_ _e"> </span>arg<span class="_ _1f"> </span>to<span class="_ _e"> </span>socket<span class="_ _1f"> </span>function<span class="_ _1a"> </span>*/</div><div class="t m5 x21e h2d y7c3e ffd fs1e fc2 sc0 ls0 ws0">char<span class="_ _44"> </span>*ai_canonname;<span class="_ _e"> </span>/*<span class="_ _1f"> </span>Canonical<span class="_ _1f"> </span>hostname<span class="_ _e"> </span>*/</div><div class="t m5 x21e h2d y7c3f ffd fs1e fc2 sc0 ls0 ws0">size_t<span class="_ _192"> </span>ai_addrlen;<span class="_ _3f"> </span>/*<span class="_ _1f"> </span>Size<span class="_ _1f"> </span>of<span class="_ _e"> </span>ai_addr<span class="_ _1f"> </span>struct<span class="_ _e"> </span>*/</div><div class="t m5 x21e h2d y7c40 ffd fs1e fc2 sc0 ls0 ws0">struct<span class="_ _e"> </span>sockaddr<span class="_ _1f"> </span>*ai_addr;<span class="_ _5a"> </span>/*<span class="_ _1f"> </span>Ptr<span class="_ _1f"> </span>to<span class="_ _e"> </span>socket<span class="_ _1f"> </span>address<span class="_ _e"> </span>structure<span class="_ _1f"> </span>*/</div><div class="t m5 x21e h2d y7c41 ffd fs1e fc2 sc0 ls0 ws0">struct<span class="_ _e"> </span>addrinfo<span class="_ _1f"> </span>*ai_next;<span class="_ _5a"> </span>/*<span class="_ _1f"> </span>Ptr<span class="_ _1f"> </span>to<span class="_ _e"> </span>next<span class="_ _1f"> </span>item<span class="_ _e"> </span>in<span class="_ _1f"> </span>linked<span class="_ _1f"> </span>list<span class="_ _e"> </span>*/</div><div class="t m5 x1b6 h2d y7c42 ffd fs1e fc2 sc0 ls0 ws0">};</div><div class="t m5 x1e9 h2c y6067 ffa fs16 fc2 sc0 ls0 ws0">code/netp/netpfragments<span class="_ _1"></span>.c</div><div class="t m5 x17 h2f y6068 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>11.16<span class="_ _66"> </span><span class="fc1">The</span></div><div class="t m5 x10c h3a y6069 ffd fs19 fc1 sc0 ls0 ws0">addrinfo<span class="_ _10"> </span><span class="ffe fs16">structure<span class="_"> </span>used<span class="_"> </span>by<span class="_"> </span></span>getaddrinfo<span class="ffe fs16">.</span></div><div class="t m5 x72 h3d y7c43 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y7c44 ff7 fs19 fc1 sc0 ls0 ws0">By<span class="_ _16"> </span>default,<span class="_ _16"> </span>for<span class="_ _11"> </span>each<span class="_ _16"> </span>unique<span class="_ _16"> </span>address<span class="_ _11"> </span>associated<span class="_ _16"> </span>with<span class="_ _16"> </span><span class="ffd">host</span>,<span class="_ _16"> </span>the<span class="_ _16"> </span><span class="ffd">getaddrinfo</span></div><div class="t m5 x26 h26 y7c45 ff7 fs19 fc1 sc0 ls0 ws0">function<span class="_ _13"> </span>can<span class="_ _13"> </span>return<span class="_ _13"> </span>up<span class="_ _13"> </span>to<span class="_"> </span>three<span class="_ _13"> </span><span class="ffd">addrinfo<span class="_ _13"> </span></span>structures<span class="_ _3"></span>,<span class="_"> </span>each<span class="_ _13"> </span>with<span class="_ _13"> </span>a<span class="_ _13"> </span>different<span class="_ _13"> </span><span class="ffd">ai_</span></div><div class="t m5 x26 h26 y7c46 ffd fs19 fc1 sc0 ls0 ws0">socktype<span class="_ _14"> </span><span class="ff7">ﬁeld:<span class="_ _14"> </span>one<span class="_ _14"> </span>for<span class="_ _14"> </span>connections<span class="_ _1"></span>,<span class="_ _14"> </span>one<span class="_ _14"> </span>for<span class="_ _14"> </span>datagrams<span class="_ _14"> </span>(not<span class="_ _14"> </span>covered),<span class="_ _15"> </span>and</span></div><div class="t m5 x26 h26 y7c47 ff7 fs19 fc1 sc0 ls0 ws0">one<span class="_ _13"> </span>for<span class="_ _13"> </span>raw<span class="_ _13"> </span>sockets<span class="_ _13"> </span>(not<span class="_ _13"> </span>covered).<span class="_ _13"> </span>Setting<span class="_ _13"> </span><span class="ffd">ai_socktype<span class="_ _13"> </span></span>to<span class="_ _13"> </span>SOCK_STREAM</div><div class="t m5 x26 h26 y7c48 ff7 fs19 fc1 sc0 ls0 ws0">restricts<span class="_ _11"> </span>the<span class="_ _16"> </span>list<span class="_ _16"> </span>to<span class="_ _11"> </span>at<span class="_ _16"> </span>most<span class="_ _16"> </span>one<span class="_ _11"> </span><span class="ffd">addrinfo<span class="_ _16"> </span></span>structure<span class="_ _11"> </span>for<span class="_ _16"> </span>each<span class="_ _16"> </span>unique<span class="_ _11"> </span>address<span class="_ _1"></span>,</div><div class="t m5 x26 h26 y7c49 ff7 fs19 fc1 sc0 ls0 ws0">one<span class="_"> </span>whose<span class="_"> </span>socket<span class="_"> </span>address<span class="_ _11"> </span>can<span class="_"> </span>be<span class="_"> </span>used<span class="_ _11"> </span>as<span class="_"> </span>the<span class="_"> </span>end<span class="_ _11"> </span>point<span class="_"> </span>of<span class="_"> </span>a<span class="_"> </span>connection.<span class="_ _11"> </span>T<span class="_ _1"></span>his</div><div class="t m5 x26 h26 y7c4a ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_"> </span>the<span class="_"> </span>desired<span class="_"> </span>behavior<span class="_"> </span>for<span class="_"> </span>all<span class="_"> </span>of<span class="_"> </span>our<span class="_"> </span>example<span class="_"> </span>programs<span class="_ _1"></span>.</div><div class="t m5 x72 h3d y7c4b ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y7c4c ff7 fs19 fc1 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _14"> </span><span class="ffd ls0">ai_flags<span class="_ _16"> </span><span class="ff7">ﬁeld<span class="_ _11"> </span>is<span class="_ _16"> </span>a<span class="_ _16"> </span>bit<span class="_ _16"> </span>mask<span class="_ _11"> </span>that<span class="_ _16"> </span>further<span class="_ _16"> </span>modiﬁes<span class="_ _16"> </span>the<span class="_ _11"> </span>default<span class="_ _16"> </span>behavior.</span></span></div><div class="t m5 x26 h26 y7c4d ff7 fs19 fc1 sc0 ls0 ws0">Y<span class="_ _3"></span>ou<span class="_ _13"> </span>create<span class="_"> </span>it<span class="_ _13"> </span>by<span class="_ _13"> </span><span class="ff9">or</span>ing<span class="_"> </span>combinations<span class="_ _13"> </span>of<span class="_ _13"> </span>various<span class="_"> </span>values<span class="_ _3"></span>.<span class="_"> </span>Here<span class="_ _13"> </span>are<span class="_"> </span>some<span class="_ _13"> </span>that<span class="_ _13"> </span>we</div><div class="t m5 x26 h26 y7c4e ff7 fs19 fc1 sc0 ls0 ws0">ﬁnd<span class="_"> </span>useful:</div><div class="t m5 x146 h26 y7c4f ff7 fs19 fc1 sc0 ls0 ws0">AI_ADDRCONFIG<span class="_ _3"></span>.<span class="_ _1f"> </span>T<span class="_ _1"></span>his<span class="_ _16"> </span>ﬂag<span class="_ _14"> </span>is<span class="_ _16"> </span>recommended<span class="_ _16"> </span>if<span class="_ _16"> </span>you<span class="_ _14"> </span>are<span class="_ _16"> </span>using<span class="_ _16"> </span>connec-</div><div class="t m5 x20a h26 y7c50 ff7 fs19 fc1 sc0 ls0 ws0">tions<span class="_ _16"> </span>[34].<span class="_ _11"> </span>It<span class="_ _16"> </span>asks<span class="_ _16"> </span><span class="ffd">getaddrinfo<span class="_ _16"> </span></span>to<span class="_ _16"> </span>return<span class="_ _11"> </span>IPv4<span class="_ _16"> </span>addresses<span class="_ _16"> </span>only<span class="_ _16"> </span>if<span class="_ _11"> </span>the</div><div class="t m5 x20a h26 y7c51 ff7 fs19 fc1 sc0 ls0 ws0">local<span class="_"> </span>host<span class="_"> </span>is<span class="_"> </span>conﬁgured<span class="_"> </span>for<span class="_"> </span>IPv4.<span class="_"> </span>Similarly<span class="_"> </span>for<span class="_"> </span>IPv6.</div><div class="t m5 x146 h26 y7c52 ff7 fs19 fc1 sc0 ls0 ws0">AI_CANONN<span class="_ _1"></span>AME.<span class="_ _1f"> </span>By<span class="_"> </span>default,<span class="_"> </span>the<span class="_ _11"> </span><span class="ffd">ai_canonname<span class="_ _10"> </span></span>ﬁeld<span class="_ _11"> </span>is<span class="_"> </span>NULL.<span class="_ _11"> </span>If<span class="_"> </span>this</div><div class="t m5 x20a h26 y7c53 ff7 fs19 fc1 sc0 ls0 ws0">ﬂag<span class="_ _13"> </span>is<span class="_ _6"> </span>set,<span class="_ _13"> </span>it<span class="_ _13"> </span>instructs<span class="_ _13"> </span><span class="ffd">getaddrinfo<span class="_ _13"> </span></span>to<span class="_ _6"> </span>point<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ffd">ai_canonname<span class="_ _13"> </span></span>ﬁeld<span class="_ _6"> </span>in</div><div class="t m5 x20a h26 y7c54 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _13"> </span>ﬁrst<span class="_ _13"> </span><span class="ffd">addrinfo<span class="_ _13"> </span></span>structure<span class="_ _13"> </span>in<span class="_"> </span>the<span class="_ _13"> </span>list<span class="_ _13"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>canonical<span class="_ _13"> </span>(ofﬁcial)<span class="_ _13"> </span>name</div><div class="t m5 x20a h26 y7c55 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span><span class="ffd">host<span class="_ _10"> </span></span>(see<span class="_"> </span>F<span class="_ _0"></span>igure<span class="_"> </span>11.15).</div><div class="t m5 x146 h26 y7c56 ff7 fs19 fc1 sc0 ls0 ws0">AI_NUMERICSER<span class="_ _3"></span>V<span class="_ _7"></span>.<span class="_ _1f"> </span>By<span class="_"> </span>default,<span class="_ _13"> </span>the<span class="_"> </span><span class="ffd">service<span class="_ _10"> </span></span>argument<span class="_"> </span>can<span class="_"> </span>be<span class="_ _13"> </span>a<span class="_"> </span>service</div><div class="t m5 x20a h26 y7c57 ff7 fs19 fc1 sc0 ls0 ws0">name<span class="_"> </span>or<span class="_"> </span>a<span class="_"> </span>port<span class="_ _13"> </span>number.<span class="_"> </span>T<span class="_ _1"></span>his<span class="_"> </span>ﬂag<span class="_"> </span>forces<span class="_"> </span>the<span class="_"> </span><span class="ffd">service<span class="_ _10"> </span></span>argument<span class="_"> </span>to<span class="_ _13"> </span>be</div><div class="t m5 x20a h26 y7c58 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_"> </span>port<span class="_"> </span>number.</div><div class="t m5 x146 h26 y7c59 ff7 fs19 fc1 sc0 ls0 ws0">AI_P<span class="_ _7"></span>ASSIVE.<span class="_ _1f"> </span>By<span class="_"> </span>default,<span class="_ _13"> </span><span class="ffd">getaddrinfo<span class="_ _10"> </span></span>returns<span class="_ _13"> </span>socket<span class="_"> </span>addresses<span class="_ _13"> </span>that<span class="_"> </span>can</div><div class="t m5 x20a h26 y7c5a ff7 fs19 fc1 sc0 ls0 ws0">be<span class="_ _21"> </span>used<span class="_ _f"> </span>by<span class="_ _21"> </span>clients<span class="_ _f"> </span>as<span class="_ _21"> </span>active<span class="_ _f"> </span>sockets<span class="_ _21"> </span>in<span class="_ _f"> </span>calls<span class="_ _21"> </span>to<span class="_ _f"> </span><span class="ffd">connect</span>.<span class="_ _21"> </span>This<span class="_ _15"> </span>ﬂag</div><div class="t m5 x20a h26 y7c5b ff7 fs19 fc1 sc0 ls0 ws0">instructs<span class="_"> </span>it<span class="_ _11"> </span>to<span class="_ _11"> </span>return<span class="_ _11"> </span>socket<span class="_ _11"> </span>addresses<span class="_ _11"> </span>that<span class="_ _11"> </span>can<span class="_ _11"> </span>be<span class="_ _11"> </span>used<span class="_ _11"> </span>by<span class="_ _11"> </span>servers<span class="_"> </span>as</div><div class="t m5 x20a h26 y7c5c ff7 fs19 fc1 sc0 ls0 ws0">listening<span class="_ _11"> </span>sockets<span class="_ _0"></span>.<span class="_ _11"> </span>In<span class="_ _16"> </span>this<span class="_ _16"> </span>case<span class="_ _1"></span>,<span class="_ _16"> </span>the<span class="_ _16"> </span><span class="ffd">host<span class="_ _16"> </span></span>argument<span class="_ _11"> </span>should<span class="_ _16"> </span>be<span class="_ _11"> </span>NULL.</div><div class="t m5 x20a h26 y7c5d ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _11"> </span>address<span class="_ _16"> </span>ﬁeld<span class="_"> </span>in<span class="_ _16"> </span>the<span class="_"> </span>resulting<span class="_ _16"> </span>socket<span class="_"> </span>address<span class="_ _16"> </span>structure(s)<span class="_"> </span>will<span class="_ _16"> </span>be</div><div class="t m5 x20a h26 y7c5e ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _13"> </span><span class="ffa">wildcar<span class="_ _1"></span>d<span class="_ _13"> </span>address<span class="ff7">,<span class="_ _13"> </span>which<span class="_ _13"> </span>tells<span class="_ _13"> </span>the<span class="_ _6"> </span>kernel<span class="_ _13"> </span>that<span class="_ _13"> </span>this<span class="_ _6"> </span>server<span class="_ _13"> </span>will<span class="_ _13"> </span>accept</span></span></div><div class="t m5 x20a h26 y7c5f ff7 fs19 fc1 sc0 ls0 ws0">requests<span class="_ _11"> </span>to<span class="_ _16"> </span>any<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>IP<span class="_ _16"> </span>addresses<span class="_ _11"> </span>for<span class="_ _16"> </span>this<span class="_ _11"> </span>host.<span class="_ _16"> </span>T<span class="_ _1"></span>his<span class="_ _16"> </span>is<span class="_ _16"> </span>the<span class="_ _11"> </span>desired</div><div class="t m5 x20a h26 y7c60 ff7 fs19 fc1 sc0 ls0 ws0">behavior<span class="_"> </span>for<span class="_"> </span>all<span class="_"> </span>of<span class="_"> </span>our<span class="_"> </span>example<span class="_"> </span>servers<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
