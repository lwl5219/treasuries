<div id="pf158" class="pf w2 h11" data-page-no="158"><div class="pc pc158 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg158.png"/><div class="t m5 x195 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>3.11<span class="_ _60"> </span>Floating-Point<span class="_ _10"> </span>Code<span class="_ _3e"> </span><span class="ffe fs1e">343</span></div><div class="t m5 x17 h34 ye7 ff6 fs16 fc2 sc0 ls0 ws0">(a)<span class="_ _10"> </span>C<span class="_ _11"> </span>code</div><div class="t m5 x17 h2d y2283 ffd fs1e fc2 sc0 ls0 ws0">typedef<span class="_ _e"> </span>enum<span class="_ _1f"> </span>{NEG,<span class="_ _1f"> </span>ZERO,<span class="_ _e"> </span>POS,<span class="_ _1f"> </span>OTHER}<span class="_ _e"> </span>range_t;</div><div class="t m5 x17 h2d y2285 ffd fs1e fc2 sc0 ls0 ws0">range_t<span class="_ _e"> </span>find_range(float<span class="_ _1f"> </span>x)</div><div class="t m5 x17 h2d y2286 ffd fs1e fc2 sc0 ls0 ws0">{</div><div class="t m5 x1b6 h2d y2287 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>result;</div><div class="t m5 x1b6 h2d y2288 ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>(x<span class="_ _1f"> </span>&lt;<span class="_ _1f"> </span>0)</div><div class="t m5 x21e h2d y23a1 ffd fs1e fc2 sc0 ls0 ws0">result<span class="_ _e"> </span>=<span class="_ _1f"> </span>NEG;</div><div class="t m5 x1b6 h2d y23a2 ffd fs1e fc2 sc0 ls0 ws0">else<span class="_ _e"> </span>if<span class="_ _1f"> </span>(x<span class="_ _1f"> </span>==<span class="_ _e"> </span>0)</div><div class="t m5 x21e h2d y2554 ffd fs1e fc2 sc0 ls0 ws0">result<span class="_ _e"> </span>=<span class="_ _1f"> </span>ZERO;</div><div class="t m5 x1b6 h2d y2555 ffd fs1e fc2 sc0 ls0 ws0">else<span class="_ _e"> </span>if<span class="_ _1f"> </span>(x<span class="_ _1f"> </span>&gt;<span class="_ _e"> </span>0)</div><div class="t m5 x21e h2d y2556 ffd fs1e fc2 sc0 ls0 ws0">result<span class="_ _e"> </span>=<span class="_ _1f"> </span>POS;</div><div class="t m5 x1b6 h2d y2557 ffd fs1e fc2 sc0 ls0 ws0">else</div><div class="t m5 x21e h2d y2558 ffd fs1e fc2 sc0 ls0 ws0">result<span class="_ _e"> </span>=<span class="_ _1f"> </span>OTHER;</div><div class="t m5 x1b6 h2d y2559 ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>result;</div><div class="t m5 x17 h2d y255a ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x17 h34 y3125 ff6 fs16 fc2 sc0 ls0 ws0">(b)<span class="_ _10"> </span>Generated<span class="_ _11"> </span>assembly<span class="_ _10"> </span>code</div><div class="t m5 x2e h61 y23a8 ff13 fs35 fc6 sc0 ls0 ws0">range_t<span class="_ _f"> </span>find_range(float<span class="_ _f"> </span>x)</div><div class="t m5 x2e h61 y3126 ff13 fs35 fc6 sc0 ls0 ws0">x<span class="_ _f"> </span>in<span class="_ _f"> </span>%xmm0</div><div class="t m5 x2c h2d y29fd ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">find_range:</span></div><div class="t m5 x2c h2d y29fe ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">vxorps<span class="_ _1a"> </span>%xmm1,<span class="_ _e"> </span>%xmm1,<span class="_ _1f"> </span>%xmm1<span class="_ _12e"> </span></span><span class="ff13 fs35">Set<span class="_ _f"> </span>%xmm1<span class="_ _f"> </span>=<span class="_ _e"> </span>0</span></div><div class="t m5 x2c h2d y2a05 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">vucomiss<span class="_ _71"> </span>%xmm0,<span class="_ _1f"> </span>%xmm1<span class="_ _110"> </span></span><span class="ff13 fs35">Compare<span class="_ _f"> </span>0:x</span></div><div class="t m5 x2c h2d y2a00 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">ja<span class="_ _5a"> </span>.L5<span class="_ _a4"> </span></span><span class="ff13 fs35">If<span class="_ _f"> </span>&gt;,<span class="_ _e"> </span>goto<span class="_ _21"> </span><span class="ff2d">neg</span></span></div><div class="t m5 x2c h2d y2a01 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">vucomiss<span class="_ _71"> </span>%xmm1,<span class="_ _1f"> </span>%xmm0<span class="_ _110"> </span></span><span class="ff13 fs35">Compare<span class="_ _f"> </span>x:0</span></div><div class="t m5 x2c h2d y28f5 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">jp<span class="_ _5a"> </span>.L8<span class="_ _a4"> </span></span><span class="ff13 fs35">If<span class="_ _f"> </span>NaN,<span class="_ _e"> </span>goto<span class="_ _21"> </span><span class="ff2d">posornan</span></span></div><div class="t m5 x2c h2d y28f7 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">movl<span class="_ _46"> </span>$1,<span class="_ _e"> </span>%eax<span class="_ _17f"> </span></span><span class="ff13 fs35">result<span class="_ _e"> </span>=<span class="_ _21"> </span>ZERO</span></div><div class="t m5 x2c h2d y3127 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _45"> </span><span class="ffd fs1e fc2">je<span class="_ _5a"> </span>.L3<span class="_ _a4"> </span></span><span class="ff13 fs35">If<span class="_ _f"> </span>=,<span class="_ _e"> </span>goto<span class="_ _21"> </span><span class="ff2d">done</span></span></div><div class="t m5 x2c h2d y2a07 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L8:<span class="_ _186"> </span></span><span class="ff2d fs35">posornan:</span></div><div class="t m5 x17 h2d y28fa ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _45"> </span><span class="ffd fs1e fc2">vucomiss<span class="_ _71"> </span>.LC0(%rip),<span class="_ _1f"> </span>%xmm0<span class="_ _5c"> </span></span><span class="ff13 fs35">Compare<span class="_ _f"> </span>x:0</span></div><div class="t m5 x17 h2d y28fc ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _45"> </span><span class="ffd fs1e fc2">setbe<span class="_ _3f"> </span>%al<span class="_ _a4"> </span></span><span class="ff13 fs35">Set<span class="_ _f"> </span>result<span class="_ _f"> </span>=<span class="_ _e"> </span>Na<span class="ls156">N?1:0</span></span></div><div class="t m5 x17 h2e y2a08 ff6 fs20 fc6 sc0 ls0 ws0">12</div><div class="t m5 xd1 h2d y28fd ffd fs1e fc2 sc0 ls0 ws0">movzbl<span class="_ _1a"> </span>%al,<span class="_ _e"> </span>%eax<span class="_ _189"> </span><span class="ff13 fs35 fc6">Zero-extend</span></div><div class="t m5 x17 h2d y2a09 ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _45"> </span><span class="ffd fs1e fc2">addl<span class="_ _46"> </span>$2,<span class="_ _e"> </span>%eax<span class="_ _17f"> </span></span><span class="ff13 fs35">result<span class="_ _e"> </span>+=<span class="_ _21"> </span>2<span class="_ _f"> </span>(POS<span class="_ _e"> </span>for<span class="_ _21"> </span>&gt;<span class="_ _f"> </span>0,<span class="_ _e"> </span>OTHER<span class="_ _21"> </span>for<span class="_ _f"> </span>NaN)</span></div><div class="t m5 x17 h2d y28ff ff6 fs20 fc6 sc0 ls0 ws0">14<span class="_ _45"> </span><span class="ffd fs1e fc2">ret<span class="_ _18a"> </span></span><span class="ff13 fs35">Return</span></div><div class="t m5 x17 h2d y2a0a ff6 fs20 fc6 sc0 ls0 ws0">15<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L5:<span class="_ _186"> </span></span><span class="ff2d fs35">neg:</span></div><div class="t m5 x17 h2d y2a0b ff6 fs20 fc6 sc0 ls0 ws0">16<span class="_ _45"> </span><span class="ffd fs1e fc2">movl<span class="_ _46"> </span>$0,<span class="_ _e"> </span>%eax<span class="_ _17f"> </span></span><span class="ff13 fs35">result<span class="_ _e"> </span>=<span class="_ _21"> </span>NEG</span></div><div class="t m5 x17 h2d y2a0c ff6 fs20 fc6 sc0 ls0 ws0">17<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L3:<span class="_ _186"> </span></span><span class="ff2d fs35">done:</span></div><div class="t m5 x17 h2d y2a0d ff6 fs20 fc6 sc0 ls0 ws0">18<span class="_ _45"> </span><span class="ffd fs1e fc2">rep;<span class="_ _e"> </span>ret<span class="_ _180"> </span></span><span class="ff13 fs35">Return</span></div><div class="t m5 x17 h2f y2d77 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>3.51<span class="_ _66"> </span><span class="fc1">Illustration<span class="_"> </span>of<span class="_"> </span>conditional<span class="_"> </span>branching<span class="_"> </span>in<span class="_"> </span>ï¬‚oating-point<span class="_"> </span>code.</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
