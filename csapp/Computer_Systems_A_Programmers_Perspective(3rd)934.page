<div id="pf3a6" class="pf w2 h11" data-page-no="3a6"><div class="pc pc3a6 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg3a6.png"/><div class="t m5 x16c h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>10.5<span class="_ _60"> </span>Robust<span class="_ _10"> </span>Reading<span class="_ _10"> </span>and<span class="_ _10"> </span>Writing<span class="_ _10"> </span>with<span class="_ _10"> </span>the<span class="_ _10"> </span><span class="ff1b">Rio<span class="_ _10"> </span></span>Package<span class="_ _1b"> </span><span class="ffe fs1e">933</span></div><div class="t m5 x17 h26 y9c ff7 fs19 fc2 sc0 ls0 ws0">such<span class="_ _11"> </span>as<span class="_ _16"> </span>W<span class="_ _3"></span>eb<span class="_ _11"> </span>servers<span class="_ _1"></span>,<span class="_ _16"> </span>then<span class="_ _11"> </span>you<span class="_ _16"> </span>must<span class="_ _11"> </span>deal<span class="_ _11"> </span>with<span class="_ _16"> </span>short<span class="_ _11"> </span>counts<span class="_ _11"> </span>by<span class="_ _16"> </span>repeatedly<span class="_ _11"> </span>calling</div><div class="t m5 x17 h26 y409 ffd fs19 fc2 sc0 ls0 ws0">read<span class="_ _10"> </span><span class="ff7">and<span class="_"> </span></span>write<span class="_ _10"> </span><span class="ff7">until<span class="_"> </span>all<span class="_"> </span>requested<span class="_"> </span>bytes<span class="_"> </span>have<span class="_"> </span>been<span class="_"> </span>transferred.</span></div><div class="t m5 x17 h3b y77ad fff fs24 fc6 sc0 ls0 ws0">10.5<span class="_ _17"> </span><span class="ffe fs18">Robust<span class="_"> </span>Reading<span class="_"> </span>and<span class="_"> </span>Writing<span class="_"> </span>with<span class="_"> </span>the<span class="_"> </span><span class="ff1b">Rio<span class="_ _16"> </span></span>Package</span></div><div class="t m5 x17 h26 y77ae ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _21"> </span>this<span class="_ _21"> </span>section,<span class="_ _e"> </span>we<span class="_ _21"> </span>will<span class="_ _f"> </span>develop<span class="_ _21"> </span>an<span class="_ _f"> </span>I/O<span class="_ _21"> </span>package,<span class="_ _f"> </span>called<span class="_ _21"> </span>the<span class="_ _f"> </span><span class="ff9">Rio<span class="_ _21"> </span></span>(Robust<span class="_ _f"> </span>I/O)</div><div class="t m5 x17 h26 y77af ff7 fs19 fc1 sc0 ls0 ws0">package<span class="_ _1"></span>,<span class="_ _11"> </span>that<span class="_"> </span>handles<span class="_"> </span>these<span class="_ _11"> </span>short<span class="_"> </span>counts<span class="_"> </span>for<span class="_ _11"> </span>you<span class="_"> </span>automatically<span class="_ _3"></span>.<span class="_"> </span>The<span class="_"> </span><span class="ff9">Rio<span class="_ _10"> </span></span>package</div><div class="t m5 x17 h26 y77b0 ff7 fs19 fc1 sc0 ls0 ws0">provides<span class="_ _15"> </span>convenient,<span class="_ _f"> </span>robust,<span class="_ _21"> </span>and<span class="_ _21"> </span>efﬁcient<span class="_ _15"> </span>I/O<span class="_ _15"> </span>in<span class="_ _21"> </span>applications<span class="_ _15"> </span>such<span class="_ _15"> </span>as<span class="_ _21"> </span>network</div><div class="t m5 x17 h26 y77b1 ff7 fs19 fc1 sc0 ls0 ws0">programs<span class="_ _14"> </span>that<span class="_ _15"> </span>are<span class="_ _15"> </span>subject<span class="_ _15"> </span>to<span class="_ _15"> </span>short<span class="_ _15"> </span>counts<span class="_ _1"></span>.<span class="_ _15"> </span><span class="ff9">Rio<span class="_ _14"> </span></span>provides<span class="_ _15"> </span>two<span class="_ _15"> </span>different<span class="_ _15"> </span>kinds<span class="_ _15"> </span>of</div><div class="t m5 x17 h26 y77b2 ff7 fs19 fc1 sc0 ls0 ws0">functions:</div><div class="t m5 x72 h26 y77b3 ffa fs19 fc1 sc0 ls0 ws0">Unbuffered<span class="_ _16"> </span>input<span class="_ _16"> </span>and<span class="_ _16"> </span>output<span class="_ _16"> </span>functions<span class="_ _1"></span>.<span class="_ _f"> </span><span class="ff7">T<span class="_ _1"></span>hese<span class="_ _14"> </span>functions<span class="_ _16"> </span>transfer<span class="_ _16"> </span>data<span class="_ _16"> </span>directly</span></div><div class="t m5 x30 h26 y77b4 ff7 fs19 fc1 sc0 ls0 ws0">between<span class="_ _13"> </span>memory<span class="_"> </span>and<span class="_ _13"> </span>a<span class="_"> </span>ﬁle<span class="_ _1"></span>,<span class="_"> </span>with<span class="_ _13"> </span>no<span class="_"> </span>application-level<span class="_ _13"> </span>buffering.<span class="_ _13"> </span>They<span class="_ _13"> </span>are</div><div class="t m5 x30 h26 y77b5 ff7 fs19 fc1 sc0 ls0 ws0">especially<span class="_ _6"> </span>useful<span class="_ _6"> </span>for<span class="_ _6"> </span>reading<span class="_ _6"> </span>and<span class="_ _6"> </span>writing<span class="_ _6"> </span>binary<span class="_ _6"> </span>data<span class="_ _6"> </span>to<span class="_ _6"> </span>and<span class="_ _6"> </span>from<span class="_ _6"> </span>networks<span class="_ _1"></span>.</div><div class="t m5 x72 h26 y77b6 ffa fs19 fc1 sc0 ls0 ws0">Buffered<span class="_ _13"> </span>input<span class="_ _13"> </span>functions<span class="_ _3"></span>.<span class="_ _f"> </span><span class="ff7">T<span class="_ _1"></span>hese<span class="_ _13"> </span>functions<span class="_ _13"> </span>allow<span class="_ _13"> </span>you<span class="_ _13"> </span>to<span class="_ _13"> </span>efﬁciently<span class="_ _13"> </span>read<span class="_ _13"> </span>text<span class="_ _13"> </span>lines</span></div><div class="t m5 x30 h26 y77b7 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_"> </span>binary<span class="_"> </span>data<span class="_ _11"> </span>from<span class="_"> </span>a<span class="_ _11"> </span>ﬁle<span class="_"> </span>whose<span class="_"> </span>contents<span class="_ _11"> </span>are<span class="_"> </span>cached<span class="_ _11"> </span>in<span class="_"> </span>an<span class="_ _11"> </span>application-</div><div class="t m5 x30 h26 y77b8 ff7 fs19 fc1 sc0 ls0 ws0">level<span class="_ _13"> </span>buffer<span class="_ _1"></span>,<span class="_ _13"> </span>similar<span class="_ _13"> </span>to<span class="_ _6"> </span>the<span class="_ _13"> </span>one<span class="_ _6"> </span>provided<span class="_ _13"> </span>for<span class="_ _6"> </span>standard<span class="_ _13"> </span>I/O<span class="_ _6"> </span>functions<span class="_ _13"> </span>such<span class="_ _6"> </span>as</div><div class="t m5 x30 h26 y77b9 ffd fs19 fc1 sc0 ls0 ws0">printf<span class="ff7">.<span class="_ _13"> </span>Unlike<span class="_ _13"> </span>the<span class="_ _13"> </span>buffered<span class="_ _13"> </span>I/O<span class="_ _13"> </span>routines<span class="_ _13"> </span>presented<span class="_ _13"> </span>in<span class="_ _13"> </span>[110],<span class="_ _13"> </span>the<span class="_ _13"> </span>buffered</span></div><div class="t m5 x30 h26 y77ba ff9 fs19 fc1 sc0 ls0 ws0">Rio<span class="_ _21"> </span><span class="ff7">input<span class="_ _21"> </span>functions<span class="_ _21"> </span>are<span class="_ _21"> </span>thread-safe<span class="_ _21"> </span>(Section<span class="_ _21"> </span>12.7.1)<span class="_ _21"> </span>and<span class="_ _f"> </span>can<span class="_ _21"> </span>be<span class="_ _21"> </span>inter<span class="_ _1"></span>-</span></div><div class="t m5 x30 h26 y77bb ff7 fs19 fc1 sc0 ls0 ws0">leaved<span class="_ _6"> </span>arbitrarily<span class="_ _13"> </span>on<span class="_ _6"> </span>the<span class="_ _13"> </span>same<span class="_ _6"> </span>descriptor.<span class="_ _6"> </span>F<span class="_ _1"></span>or<span class="_ _13"> </span>example<span class="_ _1"></span>,<span class="_ _13"> </span>you<span class="_ _6"> </span>can<span class="_ _13"> </span>read<span class="_ _6"> </span>some</div><div class="t m5 x30 h26 y77bc ff7 fs19 fc1 sc0 ls0 ws0">text<span class="_"> </span>lines<span class="_"> </span>from<span class="_"> </span>a<span class="_"> </span>descriptor,<span class="_"> </span>then<span class="_"> </span>some<span class="_"> </span>binary<span class="_"> </span>data,<span class="_"> </span>and<span class="_"> </span>then<span class="_ _11"> </span>some<span class="_"> </span>more</div><div class="t m5 x30 h26 y77bd ff7 fs19 fc1 sc0 ls0 ws0">text<span class="_"> </span>lines<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y77be ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _14"> </span>are<span class="_ _16"> </span>presenting<span class="_ _14"> </span>the<span class="_ _14"> </span><span class="ff9">Rio<span class="_ _16"> </span></span>routines<span class="_ _14"> </span>for<span class="_ _14"> </span>two<span class="_ _16"> </span>reasons<span class="_ _0"></span>.<span class="_ _16"> </span>First,<span class="_ _16"> </span>we<span class="_ _14"> </span>will<span class="_ _14"> </span>be<span class="_ _16"> </span>using</div><div class="t m5 x17 h26 y77bf ff7 fs19 fc1 sc0 ls0 ws0">them<span class="_ _13"> </span>in<span class="_"> </span>the<span class="_ _13"> </span>network<span class="_ _13"> </span>applications<span class="_ _13"> </span>we<span class="_"> </span>develop<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_"> </span>next<span class="_ _13"> </span>two<span class="_ _13"> </span>chapters<span class="_ _1"></span>.<span class="_ _13"> </span>Second,<span class="_"> </span>by</div><div class="t m5 x17 h26 y77c0 ff7 fs19 fc1 sc0 ls0 ws0">studying<span class="_ _13"> </span>the<span class="_ _13"> </span>code<span class="_ _13"> </span>for<span class="_ _13"> </span>these<span class="_ _13"> </span>routines<span class="_ _1"></span>,<span class="_ _13"> </span>you<span class="_ _13"> </span>will<span class="_ _13"> </span>gain<span class="_ _13"> </span>a<span class="_ _13"> </span>deeper<span class="_ _13"> </span>understanding<span class="_ _13"> </span>of<span class="_ _13"> </span>Unix</div><div class="t m5 x17 h26 y77c1 ff7 fs19 fc1 sc0 ls0 ws0">I/O<span class="_"> </span>in<span class="_"> </span>general.</div><div class="t m5 x17 h41 y77c2 ffe fs29 fc1 sc0 ls0 ws0">10.5.1<span class="_ _48"> </span><span class="ff1b fs19">Rio<span class="_ _11"> </span><span class="ffe">Unbuffered<span class="_"> </span>Input<span class="_"> </span>and<span class="_"> </span>Output<span class="_"> </span>Functions</span></span></div><div class="t m5 x17 h26 y77c3 ff7 fs19 fc1 sc0 ls0 ws0">Applications<span class="_"> </span>can<span class="_ _11"> </span>transfer<span class="_"> </span>data<span class="_ _11"> </span>directly<span class="_"> </span>between<span class="_ _11"> </span>memory<span class="_ _11"> </span>and<span class="_"> </span>a<span class="_ _11"> </span>ﬁle<span class="_"> </span>by<span class="_ _11"> </span>calling<span class="_"> </span>the</div><div class="t m5 x17 h26 y77c4 ffd fs19 fc1 sc0 ls0 ws0">rio_readn<span class="_ _10"> </span><span class="ff7">and<span class="_"> </span></span>rio_writen<span class="_ _10"> </span><span class="ff7">functions<span class="_ _1"></span>.</span></div><div class="t m5 x31 h2d y77c5 ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&quot;csapp.h&quot;</div><div class="t m5 x31 h2d y77c6 ffd fs1e fc2 sc0 ls0 ws0">ssize_t<span class="_ _e"> </span>rio_readn(int<span class="_ _1f"> </span>fd,<span class="_ _1f"> </span>void<span class="_ _e"> </span>*usrbuf,<span class="_ _1f"> </span>size_t<span class="_ _e"> </span>n);</div><div class="t m5 x31 h2d y77c7 ffd fs1e fc2 sc0 ls0 ws0">ssize_t<span class="_ _e"> </span>rio_writen(int<span class="_ _1f"> </span>fd,<span class="_ _1f"> </span>void<span class="_ _e"> </span>*usrbuf,<span class="_ _1f"> </span>size_t<span class="_ _e"> </span>n);</div><div class="t m5 x1a2 hf2 y77c8 ff7 fs1f fc2 sc0 ls0 ws0">Returns:<span class="_"> </span>number<span class="_"> </span>of<span class="_"> </span>bytes<span class="_"> </span>transferred<span class="_"> </span>if<span class="_"> </span>OK,<span class="_"> </span>0<span class="_"> </span>on<span class="_"> </span>EOF<span class="_"> </span>(<span class="ffd fs4e">rio_readn<span class="_ _13"> </span></span>only),<span class="_"> </span><span class="ff12">−</span>1<span class="_ _13"> </span>on<span class="_"> </span>error</div><div class="t m5 x17 h26 y278 ff7 fs19 fc2 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _f"> </span><span class="ffd ls0">rio_readn<span class="_ _15"> </span><span class="ff7">function<span class="_ _21"> </span>transfers<span class="_ _21"> </span>up<span class="_ _15"> </span>to<span class="_ _21"> </span></span>n<span class="_ _21"> </span><span class="ff7">bytes<span class="_ _15"> </span>from<span class="_ _21"> </span>the<span class="_ _21"> </span>current<span class="_ _15"> </span>ﬁle<span class="_ _21"> </span>position</span></span></div><div class="t m5 x17 h26 y279 ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_ _11"> </span>descriptor<span class="_ _11"> </span><span class="ffd">fd<span class="_ _11"> </span></span>to<span class="_ _11"> </span>memory<span class="_ _11"> </span>location<span class="_ _11"> </span><span class="ffd">usrbuf</span>.<span class="_ _11"> </span>Similarly<span class="_ _3"></span>,<span class="_ _11"> </span>the<span class="_ _11"> </span><span class="ffd">rio_writen<span class="_ _11"> </span></span>function</div><div class="t m5 x17 h26 y27a ff7 fs19 fc2 sc0 ls0 ws0">transfers<span class="_"> </span><span class="ffd">n<span class="_ _10"> </span></span>bytes<span class="_ _11"> </span>from<span class="_"> </span>location<span class="_ _11"> </span><span class="ffd">usrbuf<span class="_ _10"> </span></span>to<span class="_ _11"> </span>descriptor<span class="_"> </span><span class="ffd">fd</span><span class="ls2d4">.T<span class="_ _49"></span>h<span class="_ _4a"></span>e<span class="ffd ls0">rio_readn<span class="_ _10"> </span><span class="ff7">function</span></span></span></div><div class="t m5 x17 h26 y27b ff7 fs19 fc2 sc0 ls0 ws0">can<span class="_ _6"> </span>only<span class="_ _13"> </span>return<span class="_ _6"> </span>a<span class="_ _13"> </span>short<span class="_ _6"> </span>count<span class="_ _6"> </span>if<span class="_ _13"> </span>it<span class="_ _6"> </span>encounters<span class="_ _13"> </span>EOF<span class="_ _7"></span>.<span class="_ _6"> </span>The<span class="_ _a"> </span><span class="ffd">rio_writen<span class="_ _13"> </span></span>function<span class="_ _6"> </span>never</div><div class="t m5 x17 h26 y27c ff7 fs19 fc2 sc0 ls0 ws0">returns<span class="_ _15"> </span>a<span class="_ _15"> </span>short<span class="_ _15"> </span>count.<span class="_ _15"> </span>Calls<span class="_ _21"> </span>to<span class="_ _15"> </span><span class="ffd">rio_readn<span class="_ _15"> </span></span>and<span class="_ _15"> </span><span class="ffd">rio_writen<span class="_ _21"> </span></span>can<span class="_ _15"> </span>be<span class="_ _15"> </span>interleaved</div><div class="t m5 x17 h26 y27d ff7 fs19 fc2 sc0 ls0 ws0">arbitrarily<span class="_"> </span>on<span class="_"> </span>the<span class="_"> </span>same<span class="_"> </span>descriptor.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
