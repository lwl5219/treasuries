<div id="pf157" class="pf w2 h11" data-page-no="157"><div class="pc pc157 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg157.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">342<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x124 h26 ye7 ff7 fs19 fc2 sc0 ls22 ws0">C.<span class="_ _b0"> </span><span class="ff6 fs20 fc6 ls0">1<span class="_ _45"> </span><span class="ffd fs1e fc2">vmovsd<span class="_ _1a"> </span>.LC2(%rip),<span class="_ _e"> </span>%xmm1</span></span></div><div class="t m5 x207 h2d yc4d ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">vxorpd<span class="_ _1a"> </span>%xmm1,<span class="_ _e"> </span>%xmm0,<span class="_ _1f"> </span>%xmm0</span></div><div class="t m5 x207 h2d yecb ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _1c"> </span><span class="ffd fs1e fc2">.LC2:</span></div><div class="t m5 x207 h2d yecc ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">.long<span class="_ _3f"> </span>0</span></div><div class="t m5 x207 h2d yecd ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">.long<span class="_ _3f"> </span>-2147483648</span></div><div class="t m5 x207 h2d yece ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">.long<span class="_ _3f"> </span>0</span></div><div class="t m5 x207 h2d yecf ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">.long<span class="_ _3f"> </span>0</span></div><div class="t m5 x1d h41 y30fc ffe fs29 fc1 sc0 ls0 ws0">3.11.6<span class="_ _48"> </span><span class="fs19">Floating-Point<span class="_"> </span>Comparison<span class="_"> </span>Operations</span></div><div class="t m5 x1d h26 y30fd ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_ _7"></span>VX2<span class="_"> </span>provides<span class="_"> </span>two<span class="_"> </span>instructions<span class="_"> </span>for<span class="_"> </span>comparing<span class="_"> </span>ﬂoating-point<span class="_"> </span>values:</div><div class="t m5 x1d5 h31 y30fe ff7 fs21 fc2 sc0 ls0 ws0">Instruction<span class="_ _59"> </span>Based<span class="_"> </span>on<span class="_ _26"> </span>Description</div><div class="t m5 x1d h2d y30ff ffd fs1e fc2 sc0 ls0 ws0">ucomiss<span class="_ _ea"> </span><span class="ff11 fs21">S</span></div><div class="t m5 x4d h33 y3100 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x141 h31 y30ff ff7 fs21 fc2 sc0 ls0 ws0">,<span class="_"> </span><span class="ff11">S</span></div><div class="t m5 x20 h33 y3100 ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 xb2 h55 y30ff ff11 fs21 fc2 sc0 ls0 ws0">S</div><div class="t m5 x91 h33 y3100 ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 x189 h32 y30ff ff12 fs21 fc2 sc0 ls0 ws0">−<span class="ff11">S</span></div><div class="t m5 x90 h33 y3100 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 xb8 h31 y30ff ff7 fs21 fc2 sc0 ls0 ws0">Compare<span class="_"> </span>single<span class="_"> </span>precision</div><div class="t m5 x1d h2d y3101 ffd fs1e fc2 sc0 ls0 ws0">ucomisd<span class="_ _ea"> </span><span class="ff11 fs21">S</span></div><div class="t m5 x4d h33 y3102 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x141 h31 y3101 ff7 fs21 fc2 sc0 ls0 ws0">,<span class="_"> </span><span class="ff11">S</span></div><div class="t m5 x20 h33 y3102 ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 xb2 h55 y3101 ff11 fs21 fc2 sc0 ls0 ws0">S</div><div class="t m5 x91 h33 y3102 ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 x189 h32 y3101 ff12 fs21 fc2 sc0 ls0 ws0">−<span class="ff11">S</span></div><div class="t m5 x90 h33 y3102 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 xb8 h31 y3101 ff7 fs21 fc2 sc0 ls0 ws0">Compare<span class="_"> </span>double<span class="_"> </span>precision</div><div class="t m5 x29 h26 y3103 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>hese<span class="_"> </span>instructions<span class="_ _13"> </span>are<span class="_"> </span>similar<span class="_ _13"> </span>to<span class="_ _13"> </span>the<span class="_"> </span><span class="ff9">cmp<span class="_ _13"> </span></span>instructions<span class="_"> </span>(see<span class="_ _13"> </span>Section<span class="_ _13"> </span>3.6),<span class="_"> </span>in<span class="_ _13"> </span>that</div><div class="t m5 x1d h26 y3104 ff7 fs19 fc2 sc0 ls0 ws0">they<span class="_ _13"> </span>compare<span class="_ _6"> </span>operands<span class="_ _13"> </span><span class="ff11">S</span></div><div class="t m5 xe5 h3c y3105 ff7 fs25 fc2 sc0 ls0 ws0">1</div><div class="t m5 xa8 h26 y3106 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_ _13"> </span><span class="ff11">S</span></div><div class="t m5 xd3 h3c y3105 ff7 fs25 fc2 sc0 ls0 ws0">2</div><div class="t m5 x180 h26 y3106 ff7 fs19 fc2 sc0 ls0 ws0">(but<span class="_ _13"> </span>in<span class="_ _6"> </span>the<span class="_ _13"> </span>opposite<span class="_ _13"> </span>order<span class="_ _6"> </span>one<span class="_ _13"> </span>might<span class="_ _13"> </span>expect)<span class="_ _6"> </span>and</div><div class="t m5 x1d h26 y3107 ff7 fs19 fc2 sc0 ls0 ws0">set<span class="_"> </span>the<span class="_ _13"> </span>condition<span class="_"> </span>codes<span class="_ _13"> </span>to<span class="_"> </span>indicate<span class="_ _13"> </span>their<span class="_"> </span>relative<span class="_ _13"> </span>values<span class="_ _0"></span>.<span class="_"> </span>As<span class="_ _13"> </span>with<span class="_"> </span><span class="ffd">cmpq</span>,<span class="_ _13"> </span>they<span class="_"> </span>follow</div><div class="t m5 x1d h26 y3108 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _16"> </span>A<span class="_ _3"></span>TT<span class="_ _3"></span>-format<span class="_ _14"> </span>convention<span class="_ _16"> </span>of<span class="_ _14"> </span>listing<span class="_ _16"> </span>the<span class="_ _16"> </span>operands<span class="_ _14"> </span>in<span class="_ _16"> </span>reverse<span class="_ _14"> </span>order.<span class="_ _16"> </span>Argument</div><div class="t m5 x1d h45 y3109 ff11 fs19 fc2 sc0 ls0 ws0">S</div><div class="t m5 xc5 h3c y310a ff7 fs25 fc2 sc0 ls0 ws0">2</div><div class="t m5 x140 h26 y310b ff7 fs19 fc2 sc0 ls0 ws0">must<span class="_"> </span>be<span class="_ _11"> </span>in<span class="_ _11"> </span>an<span class="_ _11"> </span>XMM<span class="_ _11"> </span>register,<span class="_ _11"> </span>while<span class="_ _11"> </span><span class="ff11">S</span></div><div class="t m5 x40 h3c y310a ff7 fs25 fc2 sc0 ls0 ws0">1</div><div class="t m5 x82 h26 y310c ff7 fs19 fc2 sc0 ls0 ws0">can<span class="_"> </span>be<span class="_ _11"> </span>either<span class="_ _11"> </span>in<span class="_ _11"> </span>an<span class="_ _11"> </span>XMM<span class="_ _11"> </span>register<span class="_ _11"> </span>or<span class="_ _11"> </span>in</div><div class="t m5 x1d h26 y310d ff7 fs19 fc2 sc0 ls0 ws0">memory<span class="_ _3"></span>.</div><div class="t m5 x29 h26 y310e ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _13"> </span>ﬂoating-point<span class="_ _13"> </span>comparison<span class="_ _13"> </span>instructions<span class="_ _13"> </span>set<span class="_ _13"> </span>three<span class="_ _6"> </span>condition<span class="_ _13"> </span>codes:<span class="_ _13"> </span>the<span class="_ _13"> </span>zero</div><div class="t m5 x1d h26 y310f ff7 fs19 fc2 sc0 ls0 ws0">ﬂag<span class="_"> </span><span class="ffd">ZF</span>,<span class="_ _11"> </span>the<span class="_ _11"> </span>carry<span class="_"> </span>ﬂag<span class="_ _11"> </span><span class="ffd">CF</span>,<span class="_"> </span>and<span class="_ _11"> </span>the<span class="_ _11"> </span>parity<span class="_"> </span>ﬂag<span class="_ _11"> </span><span class="ffd">PF</span>.<span class="_ _1f"> </span>W<span class="_ _1"></span>e<span class="_"> </span>did<span class="_ _11"> </span>not<span class="_ _11"> </span>document<span class="_"> </span>the<span class="_ _11"> </span>parity</div><div class="t m5 x1d h26 y3110 ff7 fs19 fc2 sc0 ls0 ws0">ﬂag<span class="_ _13"> </span>in<span class="_"> </span>Section<span class="_ _13"> </span>3.6.1,<span class="_"> </span>because<span class="_ _13"> </span>it<span class="_ _13"> </span>is<span class="_"> </span>not<span class="_ _13"> </span>commonly<span class="_ _13"> </span>found<span class="_"> </span>in<span class="_ _13"> </span><span class="ff9">gcc</span>-generated<span class="_ _13"> </span>x86<span class="_"> </span>code<span class="_ _1"></span>.</div><div class="t m5 x1d h26 y3111 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _11"> </span>integer<span class="_ _11"> </span>operations<span class="_ _1"></span>,<span class="_ _16"> </span>this<span class="_"> </span>ﬂag<span class="_ _11"> </span>is<span class="_ _16"> </span>set<span class="_"> </span>when<span class="_ _16"> </span>the<span class="_"> </span>most<span class="_ _11"> </span>recent<span class="_ _16"> </span>arithmetic<span class="_"> </span>or<span class="_ _11"> </span>logical</div><div class="t m5 x1d h26 y3112 ff7 fs19 fc2 sc0 ls0 ws0">operation<span class="_ _14"> </span>yielded<span class="_ _15"> </span>a<span class="_ _14"> </span>value<span class="_ _14"> </span>where<span class="_ _15"> </span>the<span class="_ _14"> </span>least<span class="_ _15"> </span>signiﬁcant<span class="_ _14"> </span>byte<span class="_ _15"> </span>has<span class="_ _14"> </span>even<span class="_ _15"> </span>parity<span class="_ _14"> </span>(i.e<span class="_ _0"></span>.,</div><div class="t m5 x1d h26 y3113 ff7 fs19 fc2 sc0 ls0 ws0">an<span class="_ _16"> </span>even<span class="_ _14"> </span>number<span class="_ _16"> </span>of<span class="_ _14"> </span>ones<span class="_ _16"> </span>in<span class="_ _14"> </span>the<span class="_ _14"> </span>byte).<span class="_ _16"> </span>F<span class="_ _1"></span>or<span class="_ _14"> </span>ﬂoating-point<span class="_ _16"> </span>comparisons<span class="_ _0"></span>,<span class="_ _14"> </span>however,</div><div class="t m5 x1d h26 y3114 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _11"> </span>ﬂag<span class="_ _11"> </span>is<span class="_ _11"> </span>set<span class="_ _11"> </span>when<span class="_ _11"> </span>either<span class="_ _11"> </span>operand<span class="_ _16"> </span>is<span class="_"> </span><span class="ffa">NaN<span class="_ _be"></span></span>.<span class="_ _11"> </span>By<span class="_ _11"> </span>convention,<span class="_ _11"> </span>any<span class="_ _16"> </span>comparison<span class="_"> </span>in<span class="_ _11"> </span>C</div><div class="t m5 x1d h26 y3115 ff7 fs19 fc2 sc0 ls0 ws0">is<span class="_ _16"> </span>considered<span class="_ _16"> </span>to<span class="_ _16"> </span>fail<span class="_ _16"> </span>when<span class="_ _16"> </span>one<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>arguments<span class="_ _16"> </span>is<span class="_ _16"> </span><span class="ffa">NaN<span class="_ _be"></span></span>,<span class="_ _16"> </span>and<span class="_ _16"> </span>this<span class="_ _16"> </span>ﬂag<span class="_ _16"> </span>is<span class="_ _16"> </span>used<span class="_ _16"> </span>to</div><div class="t m5 x1d h26 y3116 ff7 fs19 fc2 sc0 ls0 ws0">detect<span class="_ _13"> </span>such<span class="_"> </span>a<span class="_ _13"> </span>condition.<span class="_"> </span>F<span class="_ _3"></span>or<span class="_"> </span>example<span class="_ _1"></span>,<span class="_"> </span>even<span class="_ _13"> </span>the<span class="_"> </span>comparison<span class="_ _13"> </span><span class="ffd ls4b">x=<span class="_ _49"></span>=x<span class="_ _3"></span><span class="ff7 ls0">yields<span class="_ _13"> </span>0<span class="_"> </span>when<span class="_ _13"> </span><span class="ffd">x</span></span></span></div><div class="t m5 x1d h26 y3117 ff7 fs19 fc2 sc0 ls0 ws0">is<span class="_"> </span><span class="ffa">NaN<span class="_ _5"></span></span>.</div><div class="t m5 x29 h26 y3118 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>condition<span class="_"> </span>codes<span class="_"> </span>are<span class="_"> </span>set<span class="_"> </span>as<span class="_"> </span>follows:</div><div class="t m5 x1d h31 y3119 ff7 fs21 fc2 sc0 ls0 ws0">Ordering<span class="_"> </span><span class="ff11">S</span></div><div class="t m5 x33 h33 y311a ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 xe0 h31 y3119 ff7 fs21 fc2 sc0 ls0 ws0">:<span class="ff11">S</span></div><div class="t m5 x15e h33 y311a ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 xf1 h2d y3119 ffd fs1e fc2 sc0 ls0 ws0">CF<span class="_ _26"> </span>ZF<span class="_ _26"> </span>PF</div><div class="t m5 x1d h31 y311b ff7 fs21 fc2 sc0 ls0 ws0">Unordered<span class="_ _118"> </span>1<span class="_ _74"> </span>1<span class="_ _74"> </span>1</div><div class="t m5 x1d h55 y311c ff11 fs21 fc2 sc0 ls0 ws0">S</div><div class="t m5 xc5 h33 y311d ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 x1d5 h55 y311e ff11 fs21 fc2 sc0 ls69 ws0">&lt;S</div><div class="t m5 xc4 h33 y311d ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x79 h31 y311e ff7 fs21 fc2 sc0 ls194 ws0">100</div><div class="t m5 x1d h55 y311f ff11 fs21 fc2 sc0 ls0 ws0">S</div><div class="t m5 xc5 h33 y3120 ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 x1d5 h32 y3121 ff12 fs21 fc2 sc0 ls0 ws0">=<span class="_ _13"> </span><span class="ff11">S</span></div><div class="t m5 xc4 h33 y3120 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x79 h31 y3121 ff7 fs21 fc2 sc0 ls194 ws0">010</div><div class="t m5 x1d h55 y3122 ff11 fs21 fc2 sc0 ls0 ws0">S</div><div class="t m5 xc5 h33 y3123 ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 x1d5 h55 y3124 ff11 fs21 fc2 sc0 ls69 ws0">&gt;S</div><div class="t m5 xc4 h33 y3123 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x79 h31 y3124 ff7 fs21 fc2 sc0 ls194 ws0">000</div><div class="t m5 x29 h26 ye93 ff7 fs19 fc2 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _10"> </span><span class="ffa ls0">unordered<span class="_"> </span><span class="ff7">case<span class="_ _13"> </span>occurs<span class="_ _13"> </span>when<span class="_ _13"> </span>either<span class="_"> </span>operand<span class="_ _13"> </span>is<span class="_ _13"> </span></span>NaN<span class="_ _be"></span><span class="ff7">.<span class="_ _13"> </span>T<span class="_ _0"></span>his<span class="_ _13"> </span>can<span class="_"> </span>be<span class="_ _13"> </span>detected</span></span></div><div class="t m5 x1d h26 y2532 ff7 fs19 fc2 sc0 ls0 ws0">with<span class="_ _13"> </span>the<span class="_ _6"> </span>parity<span class="_ _13"> </span>ﬂag.<span class="_ _6"> </span>Commonly<span class="_ _3"></span>,<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ffd">jp<span class="_ _6"> </span></span>(for<span class="_ _13"> </span>“jump<span class="_ _13"> </span>on<span class="_ _6"> </span>parity”)<span class="_ _13"> </span>instruction<span class="_ _13"> </span>is<span class="_ _6"> </span>used<span class="_ _13"> </span>to</div><div class="t m5 x1d h26 y2533 ff7 fs19 fc2 sc0 ls0 ws0">conditionally<span class="_"> </span>jump<span class="_"> </span>when<span class="_"> </span>a<span class="_ _11"> </span>ﬂoating-point<span class="_"> </span>comparison<span class="_"> </span>yields<span class="_"> </span>an<span class="_ _11"> </span>unordered<span class="_"> </span>result.</div><div class="t m5 x1d h26 y2534 ff7 fs19 fc2 sc0 ls0 ws0">Except<span class="_ _11"> </span>for<span class="_ _11"> </span>this<span class="_ _16"> </span>case<span class="_ _1"></span>,<span class="_ _16"> </span>the<span class="_ _11"> </span>values<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>carry<span class="_ _11"> </span>and<span class="_ _11"> </span>zero<span class="_ _11"> </span>ﬂags<span class="_ _16"> </span>are<span class="_ _11"> </span>the<span class="_ _11"> </span>same<span class="_ _11"> </span>as<span class="_ _16"> </span>those</div><div class="t m5 x1d h26 y2535 ff7 fs19 fc2 sc0 ls0 ws0">for<span class="_"> </span>an<span class="_"> </span>unsigned<span class="_"> </span>comparison:<span class="_ _13"> </span><span class="ffd">ZF<span class="_ _10"> </span></span>is<span class="_"> </span>set<span class="_"> </span>when<span class="_"> </span>the<span class="_"> </span>two<span class="_"> </span>operands<span class="_ _13"> </span>are<span class="_"> </span>equal,<span class="_"> </span>and<span class="_"> </span><span class="ffd">CF<span class="_ _10"> </span></span>is</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
