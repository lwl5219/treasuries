<div id="pfe1" class="pf w2 h11" data-page-no="e1"><div class="pc pce1 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bge1.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">224<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x28 h2a y257 fff fs1c fc2 sc0 ls0 ws0">New<span class="_ _16"> </span>to<span class="_ _16"> </span>C?<span class="_ _1b"> </span><span class="ff6 fs19">Some<span class="_ _11"> </span>examples<span class="_ _11"> </span>of<span class="_ _16"> </span>pointers</span></div><div class="t m5 x28 h2b y2d0 ff7 fs1e fc2 sc0 ls0 ws0">Function<span class="_"> </span><span class="ffd">exchange<span class="_ _11"> </span></span>(F<span class="_ _1"></span>igure<span class="_ _11"> </span>3.7(a))<span class="_"> </span>provides<span class="_ _10"> </span>a<span class="_ _11"> </span>good<span class="_"> </span>illustration<span class="_ _11"> </span>of<span class="_"> </span>the<span class="_ _10"> </span>use<span class="_ _11"> </span>of<span class="_"> </span>pointers<span class="_ _11"> </span>in<span class="_"> </span>C.<span class="_"> </span>Argument</div><div class="t m5 x28 h2b y2d1 ffd fs1e fc2 sc0 ls0 ws0">xp<span class="_ _10"> </span><span class="ff7">is<span class="_"> </span>a<span class="_"> </span>pointer<span class="_"> </span>to<span class="_"> </span>a<span class="_"> </span>long<span class="_"> </span>integer,<span class="_"> </span>while<span class="_"> </span></span>y<span class="_ _13"> </span><span class="ff7">is<span class="_"> </span>a<span class="_"> </span>long<span class="_"> </span>integer<span class="_"> </span>itself<span class="_ _1"></span>.<span class="_"> </span>The<span class="_"> </span>statement</span></div><div class="t m5 x243 h2d y7a9 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>x<span class="_ _1f"> </span>=<span class="_ _1f"> </span>*xp;</div><div class="t m5 x28 h2b y22a3 ff7 fs1e fc2 sc0 ls0 ws0">indicates<span class="_ _10"> </span>that<span class="_ _11"> </span>we<span class="_ _11"> </span>should<span class="_ _11"> </span>read<span class="_ _11"> </span>the<span class="_ _10"> </span>value<span class="_ _11"> </span>stored<span class="_ _11"> </span>in<span class="_ _11"> </span>the<span class="_ _11"> </span>location<span class="_ _10"> </span>designated<span class="_ _11"> </span>by<span class="_ _11"> </span><span class="ffd">xp<span class="_ _11"> </span></span>and<span class="_ _11"> </span>store<span class="_ _10"> </span>it<span class="_ _11"> </span>as<span class="_ _11"> </span>a<span class="_ _11"> </span>local</div><div class="t m5 x28 h2b y9e8 ff7 fs1e fc2 sc0 ls0 ws0">variable<span class="_"> </span>named<span class="_"> </span><span class="ffd">x</span>.<span class="_ _13"> </span>T<span class="_ _0"></span>his<span class="_"> </span>read<span class="_"> </span>operation<span class="_"> </span>is<span class="_ _13"> </span>known<span class="_"> </span>as<span class="_"> </span>pointer<span class="_"> </span><span class="ffa">dereferencing</span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>C<span class="_"> </span>operator<span class="_"> </span>‘<span class="ffd">*</span>’<span class="_"> </span>performs</div><div class="t m5 x28 h2b y20e3 ff7 fs1e fc2 sc0 ls0 ws0">pointer<span class="_"> </span>dereferencing.</div><div class="t m5 x57 h2b yc77 ff7 fs1e fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>statement</div><div class="t m5 x243 h2d y2157 ffd fs1e fc2 sc0 ls33 ws0">*<span class="_ _41"></span>x<span class="_ _41"></span>p=y<span class="_ _41"></span>;</div><div class="t m5 x28 h2b y22a4 ff7 fs1e fc2 sc0 ls0 ws0">does<span class="_ _13"> </span>the<span class="_ _13"> </span>reverse—it<span class="_ _6"> </span>writes<span class="_ _13"> </span>the<span class="_ _13"> </span>value<span class="_ _13"> </span>of<span class="_ _6"> </span>parameter<span class="_ _13"> </span><span class="ffd">y<span class="_ _13"> </span></span>at<span class="_ _13"> </span>the<span class="_ _13"> </span>location<span class="_ _6"> </span>designated<span class="_ _13"> </span>by<span class="_ _13"> </span><span class="ffd">xp</span>.<span class="_ _13"> </span>T<span class="_ _1"></span>his<span class="_ _13"> </span>is<span class="_ _13"> </span>also<span class="_ _6"> </span>a<span class="_ _13"> </span>form</div><div class="t m5 x28 h2b y22a5 ff7 fs1e fc2 sc0 ls0 ws0">of<span class="_"> </span>pointer<span class="_ _13"> </span>dereferencing<span class="_ _13"> </span>(and<span class="_"> </span>hence<span class="_ _13"> </span>the<span class="_ _13"> </span>operator<span class="_"> </span><span class="ffd">*</span>),<span class="_ _13"> </span>but<span class="_"> </span>it<span class="_ _13"> </span>indicates<span class="_ _13"> </span>a<span class="_"> </span>write<span class="_ _13"> </span>operation<span class="_"> </span>since<span class="_ _13"> </span>it<span class="_ _13"> </span>is<span class="_"> </span>on<span class="_ _13"> </span>the</div><div class="t m5 x28 h2b y22a6 ff7 fs1e fc2 sc0 ls0 ws0">left-hand<span class="_"> </span>side<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>assignment.</div><div class="t m5 x57 h2b y22a7 ff7 fs1e fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>following<span class="_"> </span>is<span class="_"> </span>an<span class="_"> </span>example<span class="_"> </span>of<span class="_"> </span><span class="ffd">exchange<span class="_ _10"> </span></span>in<span class="_"> </span>action:</div><div class="t m5 x243 h2d y22a8 ffd fs1e fc2 sc0 ls33 ws0">l<span class="_ _41"></span>o<span class="_ _41"></span>n<span class="_ _41"></span>ga=4<span class="_ _41"></span>;</div><div class="t m5 x243 h2d y22a9 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>b<span class="_ _1f"> </span>=<span class="_ _1f"> </span>exchange(&amp;a,<span class="_ _e"> </span>3);</div><div class="t m5 x243 h2d y22aa ffd fs1e fc2 sc0 ls0 ws0">printf(&quot;a<span class="_ _e"> </span>=<span class="_ _1f"> </span>%ld,<span class="_ _1f"> </span>b<span class="_ _e"> </span>=<span class="_ _1f"> </span>%ld\verb@\@n&quot;,<span class="_ _e"> </span>a,<span class="_ _1f"> </span>b);</div><div class="t m5 x57 h2b y22ab ff7 fs1e fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>code<span class="_"> </span>will<span class="_"> </span>print</div><div class="t m5 x28 h2d y22ac ffd fs1e fc2 sc0 ls33 ws0">a=3<span class="_ _41"></span>,b=4</div><div class="t m5 x57 h2b y22ad ff7 fs1e fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>C<span class="_"> </span>operator<span class="_"> </span>‘<span class="ffd">&amp;</span>’<span class="_"> </span>(called<span class="_"> </span>the<span class="_"> </span>“address<span class="_"> </span>of”<span class="_"> </span>operator)<span class="_ _13"> </span><span class="ffa">creates<span class="_"> </span></span>a<span class="_"> </span>pointer,<span class="_"> </span>in<span class="_"> </span>this<span class="_"> </span>case<span class="_ _13"> </span>to<span class="_"> </span>the<span class="_"> </span>location</div><div class="t m5 x28 h2b y22ae ff7 fs1e fc2 sc0 ls0 ws0">holding<span class="_ _16"> </span>local<span class="_ _16"> </span>variable<span class="_ _16"> </span><span class="ffd">a</span>.<span class="_ _16"> </span>Function<span class="_ _14"> </span><span class="ffd">exchange<span class="_ _16"> </span></span>overwrites<span class="_ _16"> </span>the<span class="_ _16"> </span>value<span class="_ _16"> </span>stored<span class="_ _16"> </span>in<span class="_ _14"> </span><span class="ffd">a<span class="_ _16"> </span></span>with<span class="_ _16"> </span>3<span class="_ _16"> </span>but<span class="_ _16"> </span>returns<span class="_ _16"> </span>the</div><div class="t m5 x28 h2b y22af ff7 fs1e fc2 sc0 ls0 ws0">previous<span class="_ _13"> </span>value<span class="_ _1"></span>,<span class="_"> </span>4,<span class="_ _13"> </span>as<span class="_ _13"> </span>the<span class="_ _13"> </span>function<span class="_ _13"> </span>value<span class="_ _1"></span>.<span class="_ _13"> </span>Observe<span class="_ _13"> </span>how<span class="_ _13"> </span>by<span class="_ _13"> </span>passing<span class="_ _13"> </span>a<span class="_ _13"> </span>pointer<span class="_ _13"> </span>to<span class="_ _13"> </span><span class="ffd">exchange</span>,<span class="_ _13"> </span>it<span class="_ _13"> </span>could<span class="_ _6"> </span>modify</div><div class="t m5 x28 h2b y22b0 ff7 fs1e fc2 sc0 ls0 ws0">data<span class="_"> </span>held<span class="_"> </span>at<span class="_"> </span>some<span class="_"> </span>remote<span class="_"> </span>location.</div><div class="t m5 x29 h26 y22b1 ff7 fs19 fc2 sc0 ls0 ws0">Assume<span class="_ _16"> </span>that<span class="_ _16"> </span>the<span class="_ _16"> </span>values<span class="_ _16"> </span>of<span class="_ _16"> </span><span class="ffd">sp<span class="_ _16"> </span></span>and<span class="_ _16"> </span><span class="ffd">dp<span class="_ _11"> </span></span>are<span class="_ _16"> </span>stored<span class="_ _16"> </span>in<span class="_ _16"> </span>registers<span class="_ _16"> </span><span class="ffd">%rdi<span class="_ _16"> </span></span>and<span class="_ _16"> </span><span class="ffd">%rsi</span>,</div><div class="t m5 x1d h26 y22b2 ff7 fs19 fc2 sc0 ls0 ws0">respectively<span class="_ _3"></span>.<span class="_ _13"> </span>F<span class="_ _1"></span>or<span class="_ _13"> </span>each<span class="_ _13"> </span>entry<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_ _13"> </span>table<span class="_ _1"></span>,<span class="_"> </span>show<span class="_ _13"> </span>the<span class="_ _13"> </span>two<span class="_ _13"> </span>instructions<span class="_ _13"> </span>that<span class="_ _13"> </span>implement</div><div class="t m5 x1d h26 y22b3 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _14"> </span>speciﬁed<span class="_ _14"> </span>data<span class="_ _14"> </span>movement.<span class="_ _14"> </span>T<span class="_ _1"></span>he<span class="_ _14"> </span>ﬁrst<span class="_ _14"> </span>instruction<span class="_ _15"> </span>in<span class="_ _14"> </span>the<span class="_ _14"> </span>sequence<span class="_ _14"> </span>should<span class="_ _14"> </span>read</div><div class="t m5 x1d h26 y22b4 ff7 fs19 fc2 sc0 ls0 ws0">from<span class="_"> </span>memory<span class="_ _3"></span>,<span class="_"> </span>do<span class="_ _11"> </span>the<span class="_"> </span>appropriate<span class="_ _11"> </span>conversion,<span class="_"> </span>and<span class="_ _11"> </span>set<span class="_"> </span>the<span class="_ _11"> </span>appropriate<span class="_"> </span>portion<span class="_ _11"> </span>of</div><div class="t m5 x1d h26 y22b5 ff7 fs19 fc2 sc0 ls0 ws0">register<span class="_ _16"> </span><span class="ffd">%rax</span>.<span class="_ _11"> </span>The<span class="_ _11"> </span>second<span class="_ _16"> </span>instruction<span class="_ _11"> </span>should<span class="_ _16"> </span>then<span class="_ _16"> </span>write<span class="_ _16"> </span>the<span class="_ _11"> </span>appropriate<span class="_ _16"> </span>portion</div><div class="t m5 x1d h26 y22b6 ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_ _16"> </span><span class="ffd">%rax<span class="_ _11"> </span></span>to<span class="_ _16"> </span>memory<span class="_ _3"></span>.<span class="_ _11"> </span>In<span class="_ _16"> </span>both<span class="_ _16"> </span>cases<span class="_ _1"></span>,<span class="_ _16"> </span>the<span class="_ _16"> </span>portions<span class="_ _11"> </span>may<span class="_ _16"> </span>be<span class="_ _16"> </span><span class="ffd">%rax</span>,<span class="_ _16"> </span><span class="ffd">%eax</span>,<span class="_ _16"> </span><span class="ffd">%ax</span><span class="ls14d">,o<span class="_ _42"></span>r<span class="ffd ls0">%al<span class="ff7">,</span></span></span></div><div class="t m5 x1d h26 y22b7 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_"> </span>they<span class="_"> </span>may<span class="_"> </span>differ<span class="_"> </span>from<span class="_"> </span>one<span class="_"> </span>another.</div><div class="t m5 x29 h26 y22b8 ff7 fs19 fc2 sc0 ls0 ws0">Recall<span class="_ _14"> </span>that<span class="_ _14"> </span>when<span class="_ _14"> </span>performing<span class="_ _14"> </span>a<span class="_ _15"> </span>cast<span class="_ _14"> </span>that<span class="_ _14"> </span>involves<span class="_ _14"> </span>both<span class="_ _14"> </span>a<span class="_ _14"> </span>size<span class="_ _15"> </span>change<span class="_ _14"> </span>and<span class="_ _14"> </span>a</div><div class="t m5 x1d h26 y22b9 ff7 fs19 fc2 sc0 ls0 ws0">change<span class="_ _11"> </span>of<span class="_ _16"> </span>“signedness”<span class="_ _16"> </span>in<span class="_ _11"> </span>C,<span class="_ _16"> </span>the<span class="_ _11"> </span>operation<span class="_ _16"> </span>should<span class="_ _16"> </span>change<span class="_ _11"> </span>the<span class="_ _16"> </span>size<span class="_ _16"> </span>ﬁrst<span class="_ _11"> </span>(Section</div><div class="t m5 x1d h26 y22ba ff7 fs19 fc2 sc0 ls0 ws0">2.2.6).</div><div class="t m5 x1d h31 y22bb ffd fs1e fc2 sc0 ls0 ws0">src_t<span class="_ _70"> </span>dest_t<span class="_ _84"> </span><span class="ff7 fs21">Instruction</span></div><div class="t m5 x1d h2d y22bc ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _89"> </span>long<span class="_ _115"> </span>movq<span class="_ _11"> </span>(%rdi),<span class="_ _11"> </span>%rax</div><div class="t m5 x7f h2d y22bd ffd fs1e fc2 sc0 ls0 ws0">movq<span class="_ _11"> </span>%rax,<span class="_ _11"> </span>(%rsi)</div><div class="t m5 x1d h2d y22be ffd fs1e fc2 sc0 ls0 ws0">char<span class="_ _89"> </span>int</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
