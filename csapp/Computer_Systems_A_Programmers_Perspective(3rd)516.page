<div id="pf204" class="pf w2 h11" data-page-no="204"><div class="pc pc204 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg204.png"/><div class="t m5 x5f h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Homework<span class="_ _10"> </span>Problems<span class="_ _1b"> </span><span class="ffe fs1e">515</span></div><div class="t m5 x17 h28 y140c ffe fs1e fc6 sc0 ls0 ws0">4.58</div><div class="t m5 x153 h73 ye7 ff10 fs19 fc6 sc0 ls0 ws0">◆◆◆</div><div class="t m5 x17 h26 y2a7 ff7 fs19 fc1 sc0 ls0 ws0">Our<span class="_ _16"> </span>pipelined<span class="_ _16"> </span>design<span class="_ _16"> </span>is<span class="_ _16"> </span>a<span class="_ _16"> </span>bit<span class="_ _16"> </span>unrealistic<span class="_ _14"> </span>in<span class="_ _16"> </span>that<span class="_ _16"> </span>we<span class="_ _16"> </span>have<span class="_ _16"> </span>two<span class="_ _16"> </span>write<span class="_ _16"> </span>ports<span class="_ _14"> </span>for<span class="_ _16"> </span>the</div><div class="t m5 x17 h26 y2a8 ff7 fs19 fc1 sc0 ls0 ws0">register<span class="_"> </span>ﬁle<span class="_ _3"></span>,<span class="_"> </span>but<span class="_"> </span>only<span class="_ _13"> </span>the<span class="_"> </span><span class="ffd">popq<span class="_ _13"> </span></span>instruction<span class="_"> </span>requires<span class="_ _13"> </span>two<span class="_"> </span>simultaneous<span class="_ _13"> </span>writes<span class="_"> </span>to<span class="_ _13"> </span>the</div><div class="t m5 x17 h26 y2f7 ff7 fs19 fc1 sc0 ls0 ws0">register<span class="_ _13"> </span>ﬁle<span class="_ _0"></span>.<span class="_ _13"> </span>T<span class="_ _0"></span>he<span class="_ _13"> </span>other<span class="_"> </span>instructions<span class="_ _13"> </span>could<span class="_ _13"> </span>therefore<span class="_ _13"> </span>use<span class="_ _13"> </span>a<span class="_"> </span>single<span class="_ _13"> </span>write<span class="_ _13"> </span>port,<span class="_ _13"> </span>sharing</div><div class="t m5 x17 h26 y2f8 ff7 fs19 fc1 sc0 ls0 ws0">this<span class="_ _21"> </span>for<span class="_ _21"> </span>writing<span class="_ _21"> </span><span class="ff6">valE<span class="_ _21"> </span></span>and<span class="_ _21"> </span><span class="ff6">valM</span>.<span class="_ _21"> </span>T<span class="_ _1"></span>he<span class="_ _f"> </span>following<span class="_ _21"> </span>ﬁgure<span class="_ _21"> </span>shows<span class="_ _21"> </span>a<span class="_ _21"> </span>modiﬁed<span class="_ _21"> </span>version</div><div class="t m5 x17 h26 y2f9 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_ _16"> </span>the<span class="_ _16"> </span>write-back<span class="_ _16"> </span>logic<span class="_ _0"></span>,<span class="_ _16"> </span>in<span class="_ _16"> </span>which<span class="_ _16"> </span>we<span class="_ _16"> </span>merge<span class="_ _16"> </span>the<span class="_ _16"> </span>write-back<span class="_ _16"> </span>register<span class="_ _16"> </span>IDs<span class="_ _16"> </span>(<span class="ff6">W_dstE</span></div><div class="t m5 x17 h26 y2fa ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_"> </span><span class="ff6">W_dstM</span>)<span class="_ _11"> </span>into<span class="_ _11"> </span>a<span class="_ _11"> </span>single<span class="_ _11"> </span>signal<span class="_ _11"> </span><span class="ff6">w_dstE<span class="_ _11"> </span></span>and<span class="_ _11"> </span>the<span class="_ _11"> </span>write-back<span class="_ _11"> </span>values<span class="_ _11"> </span>(<span class="ff6">W_valE<span class="_ _11"> </span></span>and</div><div class="t m5 x17 h26 y2fb ff6 fs19 fc1 sc0 ls0 ws0">W_valM<span class="ff7">)<span class="_"> </span>into<span class="_"> </span>a<span class="_"> </span>single<span class="_"> </span>signal<span class="_"> </span></span>w_valE<span class="ff7">:</span></div><div class="t m5 xd1 hcc y4764 ff53 fs80 fc1 sc0 ls0 ws0">Stat</div><div class="t m5 x182 hcd y4765 ff53 fs81 fc1 sc0 ls0 ws0">Stat</div><div class="t m5 x1f5 hcc y4766 ff53 fs80 fc0 sc0 ls0 ws0">W<span class="_ _105"> </span><span class="fc1">icode<span class="_ _154"> </span>valE<span class="_ _72"> </span>valM<span class="_ _7e"> </span>dstE<span class="_ _1f"> </span>dstM</span></div><div class="t m5 xbe hcc y4767 ff53 fs80 fc1 sc0 ls0 ws0">valE</div><div class="t m5 x1fc hcc y4768 ff53 fs80 fc1 sc0 ls0 ws0">dstE</div><div class="t m5 x111 hce y4769 ff53 fs82 fc1 sc0 ls0 ws0">w_valE</div><div class="t m5 x111 hce y476a ff53 fs82 fc1 sc0 ls0 ws0">w_dstE</div><div class="t m5 x17 hce y476b ff53 fs82 fc1 sc0 ls0 ws0">W_icode</div><div class="t m5 xd1 hcc y4766 ff53 fs80 fc1 sc0 ls0 ws0">stat</div><div class="t m5 x26 h26 y476c ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>logic<span class="_"> </span>for<span class="_"> </span>performing<span class="_"> </span>the<span class="_"> </span>merges<span class="_"> </span>is<span class="_"> </span>written<span class="_"> </span>in<span class="_"> </span>HCL<span class="_"> </span>as<span class="_"> </span>follows:</div><div class="t m5 x17 h2d y476d ffd fs1e fc2 sc0 ls0 ws0">##<span class="_ _e"> </span>Set<span class="_ _1f"> </span>E<span class="_ _1f"> </span>port<span class="_ _e"> </span>register<span class="_ _1f"> </span>ID</div><div class="t m5 x17 h2d y476e ffd fs1e fc2 sc0 ls0 ws0">word<span class="_ _e"> </span>w_dstE<span class="_ _1f"> </span>=<span class="_ _1f"> </span>[</div><div class="t m5 x21e h2d y476f ffd fs1e fc2 sc0 ls0 ws0">##<span class="_ _e"> </span>writing<span class="_ _1f"> </span>from<span class="_ _1f"> </span>valM</div><div class="t m5 x21e h2d y4770 ffd fs1e fc2 sc0 ls0 ws0">W_dstM<span class="_ _e"> </span>!=<span class="_ _1f"> </span>RNONE<span class="_ _1f"> </span>:<span class="_ _e"> </span>W_dstM;</div><div class="t m5 x21e h2d y4771 ffd fs1e fc2 sc0 ls0 ws0">1:<span class="_ _e"> </span>W_dstE;</div><div class="t m5 x17 h2d y4772 ffd fs1e fc2 sc0 ls0 ws0">];</div><div class="t m5 x17 h2d y4773 ffd fs1e fc2 sc0 ls0 ws0">##<span class="_ _e"> </span>Set<span class="_ _1f"> </span>E<span class="_ _1f"> </span>port<span class="_ _e"> </span>value</div><div class="t m5 x17 h2d y4774 ffd fs1e fc2 sc0 ls0 ws0">word<span class="_ _e"> </span>w_valE<span class="_ _1f"> </span>=<span class="_ _1f"> </span>[</div><div class="t m5 x21e h2d y4775 ffd fs1e fc2 sc0 ls0 ws0">W_dstM<span class="_ _e"> </span>!=<span class="_ _1f"> </span>RNONE<span class="_ _1f"> </span>:<span class="_ _e"> </span>W_valM;</div><div class="t m5 x21e h2d y4776 ffd fs1e fc2 sc0 ls0 ws0">1:<span class="_ _e"> </span>W_valE;</div><div class="t m5 x17 h2d y4777 ffd fs1e fc2 sc0 ls0 ws0">];</div><div class="t m5 x26 h26 y4778 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _16"> </span>control<span class="_ _11"> </span>for<span class="_ _11"> </span>these<span class="_ _11"> </span>multiplexors<span class="_ _16"> </span>is<span class="_ _11"> </span>determined<span class="_ _11"> </span>by<span class="_ _16"> </span><span class="ff6">dstE</span>—when<span class="_ _11"> </span>it<span class="_ _11"> </span>indicates</div><div class="t m5 x17 h26 y4779 ff7 fs19 fc2 sc0 ls0 ws0">there<span class="_"> </span>is<span class="_"> </span>some<span class="_ _13"> </span>register,<span class="_"> </span>then<span class="_"> </span>it<span class="_ _13"> </span>selects<span class="_"> </span>the<span class="_"> </span>value<span class="_"> </span>for<span class="_ _13"> </span>port<span class="_"> </span>E,<span class="_"> </span>and<span class="_"> </span>otherwise<span class="_"> </span>it<span class="_ _13"> </span>selects</div><div class="t m5 x17 h26 y477a ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>value<span class="_"> </span>for<span class="_"> </span>port<span class="_"> </span>M.</div><div class="t m5 x26 h26 y477b ff7 fs19 fc2 sc0 ls0 ws0">In<span class="_ _13"> </span>the<span class="_"> </span>simulation<span class="_ _13"> </span>model,<span class="_ _13"> </span>we<span class="_ _13"> </span>can<span class="_"> </span>then<span class="_ _13"> </span>disable<span class="_ _13"> </span>register<span class="_ _13"> </span>port<span class="_"> </span>M,<span class="_ _13"> </span>as<span class="_ _13"> </span>shown<span class="_"> </span>by<span class="_ _13"> </span>the</div><div class="t m5 x17 h26 y477c ff7 fs19 fc2 sc0 ls0 ws0">following<span class="_"> </span>HCL<span class="_"> </span>code:</div><div class="t m5 x17 h2d y477d ffd fs1e fc2 sc0 ls0 ws0">##<span class="_ _e"> </span>Disable<span class="_ _1f"> </span>register<span class="_ _1f"> </span>port<span class="_ _e"> </span>M</div><div class="t m5 x17 h2d y477e ffd fs1e fc2 sc0 ls0 ws0">##<span class="_ _e"> </span>Set<span class="_ _1f"> </span>M<span class="_ _1f"> </span>port<span class="_ _e"> </span>register<span class="_ _1f"> </span>ID</div><div class="t m5 x17 h2d y477f ffd fs1e fc2 sc0 ls0 ws0">word<span class="_ _e"> </span>w_dstM<span class="_ _1f"> </span>=<span class="_ _1f"> </span>RNONE;</div><div class="t m5 x17 h2d y4780 ffd fs1e fc2 sc0 ls0 ws0">##<span class="_ _e"> </span>Set<span class="_ _1f"> </span>M<span class="_ _1f"> </span>port<span class="_ _e"> </span>value</div><div class="t m5 x17 h2d y4781 ffd fs1e fc2 sc0 ls0 ws0">word<span class="_ _e"> </span>w_valM<span class="_ _1f"> </span>=<span class="_ _1f"> </span>0;</div><div class="t m5 x26 h26 y8d6 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _11"> </span>challenge<span class="_ _11"> </span>then<span class="_ _11"> </span>becomes<span class="_ _11"> </span>to<span class="_ _11"> </span>devise<span class="_ _11"> </span>a<span class="_ _11"> </span>way<span class="_ _11"> </span>to<span class="_ _11"> </span>handle<span class="_ _11"> </span><span class="ffd">popq</span>.<span class="_ _11"> </span>One<span class="_ _11"> </span>method<span class="_ _11"> </span>is</div><div class="t m5 x17 h26 y8d7 ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_ _11"> </span>use<span class="_ _16"> </span>the<span class="_ _16"> </span>control<span class="_ _11"> </span>logic<span class="_ _16"> </span>to<span class="_ _11"> </span>dynamically<span class="_ _16"> </span>process<span class="_ _11"> </span>the<span class="_ _16"> </span>instruction<span class="_ _16"> </span><span class="ffd">popq<span class="_ _11"> </span><span class="ff6">rA<span class="_ _16"> </span></span></span>so<span class="_ _11"> </span>that<span class="_ _16"> </span>it</div><div class="t m5 x17 h26 y8d8 ff7 fs19 fc2 sc0 ls0 ws0">has<span class="_"> </span>the<span class="_"> </span>same<span class="_"> </span>effect<span class="_"> </span>as<span class="_"> </span>the<span class="_"> </span>two-instruction<span class="_"> </span>sequence</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
