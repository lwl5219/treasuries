<div id="pf376" class="pf w2 h11" data-page-no="376"><div class="pc pc376 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg376.png"/><div class="t m5 x1c9 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>9.9<span class="_ _60"> </span>Dynamic<span class="_ _10"> </span>Memor<span class="_"> </span>y<span class="_ _10"> </span>Allocation<span class="_ _3e"> </span><span class="ffe fs1e">885</span></div><div class="t m5 x17 h47 yb1f ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>9.6<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>919)</span></div><div class="t m5 x17 h26 y9ba ff7 fs19 fc1 sc0 ls0 ws0">Determine<span class="_ _f"> </span>the<span class="_ _f"> </span>block<span class="_ _f"> </span>sizes<span class="_ _f"> </span>and<span class="_ _f"> </span>header<span class="_ _f"> </span>values<span class="_ _f"> </span>that<span class="_ _f"> </span>would<span class="_ _f"> </span>result<span class="_ _f"> </span>from<span class="_ _f"> </span>the<span class="_ _f"> </span>fol-</div><div class="t m5 x17 h26 y302f ff7 fs19 fc1 sc0 ls0 ws0">lowing<span class="_ _14"> </span>sequence<span class="_ _14"> </span>of<span class="_ _14"> </span><span class="ffd">malloc<span class="_ _14"> </span></span>requests<span class="_ _1"></span>.<span class="_ _14"> </span>Assumptions:<span class="_ _14"> </span>(1)<span class="_ _14"> </span>The<span class="_ _16"> </span>allocator<span class="_ _14"> </span>maintains</div><div class="t m5 x17 h26 y4491 ff7 fs19 fc1 sc0 ls0 ws0">double-word<span class="_ _11"> </span>alignment<span class="_ _11"> </span>and<span class="_ _11"> </span>uses<span class="_ _16"> </span>an<span class="_ _11"> </span>implicit<span class="_ _11"> </span>free<span class="_ _11"> </span>list<span class="_ _11"> </span>with<span class="_ _16"> </span>the<span class="_ _11"> </span>block<span class="_ _11"> </span>format<span class="_ _11"> </span>from</div><div class="t m5 x17 h26 y72ed ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_"> </span>9.35.<span class="_"> </span>(2)<span class="_"> </span>Block<span class="_"> </span>sizes<span class="_"> </span>are<span class="_"> </span>rounded<span class="_"> </span>up<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>nearest<span class="_"> </span>multiple<span class="_"> </span>of<span class="_"> </span>8<span class="_"> </span>bytes<span class="_ _1"></span>.</div><div class="t m5 x17 h31 y72ee ff7 fs21 fc2 sc0 ls0 ws0">Request<span class="_ _e2"> </span>Block<span class="_"> </span>size<span class="_"> </span>(decimal<span class="_"> </span>bytes)<span class="_ _26"> </span>Block<span class="_"> </span>header<span class="_"> </span>(hex)</div><div class="t m5 x17 h2d y72ef ffd fs1e fc2 sc0 ls0 ws0">malloc(2)</div><div class="t m5 x17 h2d y72f0 ffd fs1e fc1 sc0 ls0 ws0">malloc(9)</div><div class="t m5 x17 h2d y72f1 ffd fs1e fc1 sc0 ls0 ws0">malloc(15)</div><div class="t m5 x17 h2d y72f2 ffd fs1e fc1 sc0 ls0 ws0">malloc(20)</div><div class="t m5 x17 h41 y72f3 ffe fs29 fc1 sc0 ls0 ws0">9.9.7<span class="_ _48"> </span><span class="fs19">Placing<span class="_"> </span>Allocated<span class="_"> </span>Blocks</span></div><div class="t m5 x17 h26 y72f4 ff7 fs19 fc1 sc0 ls0 ws0">When<span class="_ _11"> </span>an<span class="_ _16"> </span>application<span class="_ _11"> </span>requests<span class="_ _16"> </span>a<span class="_ _16"> </span>block<span class="_ _11"> </span>of<span class="_ _16"> </span><span class="ff11">k<span class="_"> </span></span>bytes<span class="_ _1"></span>,<span class="_ _16"> </span>the<span class="_ _16"> </span>allocator<span class="_ _16"> </span>searches<span class="_ _11"> </span>the<span class="_ _16"> </span>free</div><div class="t m5 x17 h26 y72f5 ff7 fs19 fc1 sc0 ls0 ws0">list<span class="_"> </span>for<span class="_"> </span>a<span class="_"> </span>free<span class="_"> </span>block<span class="_"> </span>that<span class="_"> </span>is<span class="_ _13"> </span>large<span class="_"> </span>enough<span class="_"> </span>to<span class="_"> </span>hold<span class="_"> </span>the<span class="_"> </span>requested<span class="_"> </span>block.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>manner</div><div class="t m5 x17 h26 y72f6 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_ _13"> </span>which<span class="_"> </span>the<span class="_ _13"> </span>allocator<span class="_ _13"> </span>performs<span class="_"> </span>this<span class="_ _13"> </span>search<span class="_ _13"> </span>is<span class="_"> </span>determined<span class="_ _13"> </span>by<span class="_ _13"> </span>the<span class="_"> </span><span class="ffa">placement<span class="_ _13"> </span>policy</span>.</div><div class="t m5 x17 h26 y72f7 ff7 fs19 fc1 sc0 ls0 ws0">Some<span class="_"> </span>common<span class="_"> </span>policies<span class="_"> </span>are<span class="_"> </span>ﬁrst<span class="_"> </span>ﬁt,<span class="_"> </span>next<span class="_"> </span>ﬁt,<span class="_"> </span>and<span class="_"> </span>best<span class="_"> </span>ﬁt.</div><div class="t m5 x26 h26 y72f8 ffa fs19 fc1 sc0 ls0 ws0">First<span class="_ _14"> </span>ﬁt<span class="_ _21"> </span><span class="ff7">searches<span class="_ _14"> </span>the<span class="_ _14"> </span>free<span class="_ _14"> </span>list<span class="_ _15"> </span>from<span class="_ _14"> </span>the<span class="_ _14"> </span>beginning<span class="_ _14"> </span>and<span class="_ _14"> </span>chooses<span class="_ _14"> </span>the<span class="_ _15"> </span>ﬁrst<span class="_ _14"> </span>free</span></div><div class="t m5 x17 h26 y72f9 ff7 fs19 fc1 sc0 ls0 ws0">block<span class="_ _11"> </span>that<span class="_ _16"> </span>ﬁts<span class="_ _3"></span>.<span class="_ _16"> </span><span class="ffa">Next<span class="_ _11"> </span>ﬁt<span class="_ _14"> </span></span>is<span class="_ _16"> </span>similar<span class="_ _11"> </span>to<span class="_ _11"> </span>ﬁrst<span class="_ _16"> </span>ﬁt,<span class="_ _16"> </span>but<span class="_ _11"> </span>instead<span class="_ _11"> </span>of<span class="_ _16"> </span>starting<span class="_ _11"> </span>each<span class="_ _16"> </span>search<span class="_ _11"> </span>at</div><div class="t m5 x17 h26 y72fa ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _11"> </span>beginning<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span>list,<span class="_ _16"> </span>it<span class="_ _16"> </span>starts<span class="_ _11"> </span>each<span class="_ _16"> </span>search<span class="_ _11"> </span>where<span class="_ _16"> </span>the<span class="_ _11"> </span>previous<span class="_ _16"> </span>search<span class="_ _11"> </span>left<span class="_ _16"> </span>off<span class="_ _1"></span>.</div><div class="t m5 x17 h26 y72fb ffa fs19 fc1 sc0 ls0 ws0">Best<span class="_ _13"> </span>ﬁt<span class="_"> </span><span class="ff7">examines<span class="_ _6"> </span>every<span class="_ _13"> </span>free<span class="_ _13"> </span>block<span class="_ _13"> </span>and<span class="_ _6"> </span>chooses<span class="_ _13"> </span>the<span class="_ _13"> </span>free<span class="_ _13"> </span>block<span class="_ _6"> </span>with<span class="_ _13"> </span>the<span class="_ _13"> </span>smallest<span class="_ _13"> </span>size</span></div><div class="t m5 x17 h26 y72fc ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_"> </span>ﬁts<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y72fd ff7 fs19 fc1 sc0 ls0 ws0">An<span class="_ _11"> </span>advantage<span class="_ _11"> </span>of<span class="_ _11"> </span>ﬁrst<span class="_ _11"> </span>ﬁt<span class="_ _11"> </span>is<span class="_ _11"> </span>that<span class="_ _11"> </span>it<span class="_ _11"> </span>tends<span class="_ _11"> </span>to<span class="_ _11"> </span>retain<span class="_ _11"> </span>large<span class="_ _11"> </span>free<span class="_ _11"> </span>blocks<span class="_ _11"> </span>at<span class="_ _11"> </span>the<span class="_ _11"> </span>end</div><div class="t m5 x17 h26 y72fe ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span>the<span class="_"> </span>list.<span class="_"> </span>A<span class="_ _13"> </span>disadvantage<span class="_"> </span>is<span class="_"> </span>that<span class="_"> </span>it<span class="_"> </span>tends<span class="_"> </span>to<span class="_"> </span>leave<span class="_ _13"> </span>“splinters”<span class="_"> </span>of<span class="_"> </span>small<span class="_"> </span>free<span class="_"> </span>blocks</div><div class="t m5 x17 h26 y72ff ff7 fs19 fc1 sc0 ls0 ws0">toward<span class="_ _14"> </span>the<span class="_ _14"> </span>beginning<span class="_ _15"> </span>of<span class="_ _14"> </span>the<span class="_ _15"> </span>list,<span class="_ _15"> </span>which<span class="_ _14"> </span>will<span class="_ _15"> </span>increase<span class="_ _14"> </span>the<span class="_ _14"> </span>search<span class="_ _15"> </span>time<span class="_ _14"> </span>for<span class="_ _14"> </span>larger</div><div class="t m5 x17 h26 y7300 ff7 fs19 fc1 sc0 ls0 ws0">blocks<span class="_ _1"></span>.<span class="_ _11"> </span>Next<span class="_ _16"> </span>ﬁt<span class="_ _11"> </span>was<span class="_ _11"> </span>ﬁrst<span class="_ _16"> </span>proposed<span class="_ _11"> </span>by<span class="_ _16"> </span>Donald<span class="_ _11"> </span>Knuth<span class="_ _11"> </span>as<span class="_ _16"> </span>an<span class="_ _11"> </span>alternative<span class="_ _11"> </span>to<span class="_ _16"> </span>ﬁrst<span class="_ _11"> </span>ﬁt,</div><div class="t m5 x17 h26 y7301 ff7 fs19 fc1 sc0 ls0 ws0">motivated<span class="_"> </span>by<span class="_"> </span>the<span class="_ _13"> </span>idea<span class="_"> </span>that<span class="_"> </span>if<span class="_"> </span>we<span class="_"> </span>found<span class="_ _13"> </span>a<span class="_"> </span>ﬁt<span class="_"> </span>in<span class="_"> </span>some<span class="_"> </span>free<span class="_ _13"> </span>block<span class="_"> </span>the<span class="_"> </span>last<span class="_"> </span>time<span class="_ _1"></span>,<span class="_"> </span>there</div><div class="t m5 x17 h26 y7302 ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_"> </span>a<span class="_ _13"> </span>good<span class="_"> </span>chance<span class="_ _13"> </span>that<span class="_"> </span>we<span class="_ _13"> </span>will<span class="_"> </span>ﬁnd<span class="_ _13"> </span>a<span class="_"> </span>ﬁt<span class="_ _13"> </span>the<span class="_"> </span>next<span class="_ _13"> </span>time<span class="_"> </span>in<span class="_ _13"> </span>the<span class="_"> </span>remainder<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>block.</div><div class="t m5 x17 h26 y7303 ff7 fs19 fc1 sc0 ls0 ws0">Next<span class="_ _11"> </span>ﬁt<span class="_ _16"> </span>can<span class="_ _16"> </span>run<span class="_ _11"> </span>signiﬁcantly<span class="_ _16"> </span>faster<span class="_ _11"> </span>than<span class="_ _16"> </span>ﬁrst<span class="_ _11"> </span>ﬁt,<span class="_ _16"> </span>especially<span class="_ _16"> </span>if<span class="_ _11"> </span>the<span class="_ _16"> </span>front<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>list</div><div class="t m5 x17 h26 y7304 ff7 fs19 fc1 sc0 ls0 ws0">becomes<span class="_ _16"> </span>littered<span class="_ _11"> </span>with<span class="_ _16"> </span>many<span class="_ _16"> </span>small<span class="_ _11"> </span>splinters<span class="_ _1"></span>.<span class="_ _16"> </span>However,<span class="_ _11"> </span>some<span class="_ _16"> </span>studies<span class="_ _16"> </span>suggest<span class="_ _11"> </span>that</div><div class="t m5 x17 h26 y7305 ff7 fs19 fc1 sc0 ls0 ws0">next<span class="_ _16"> </span>ﬁt<span class="_ _14"> </span>suffers<span class="_ _16"> </span>from<span class="_ _16"> </span>worse<span class="_ _14"> </span>memory<span class="_ _16"> </span>utilization<span class="_ _14"> </span>than<span class="_ _16"> </span>ﬁrst<span class="_ _14"> </span>ﬁt.<span class="_ _16"> </span>Studies<span class="_ _16"> </span>have<span class="_ _14"> </span>found</div><div class="t m5 x17 h26 y7306 ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_"> </span>best<span class="_"> </span>ﬁt<span class="_ _13"> </span>generally<span class="_"> </span>enjoys<span class="_"> </span>better<span class="_"> </span>memory<span class="_"> </span>utilization<span class="_"> </span>than<span class="_ _13"> </span>either<span class="_"> </span>ﬁrst<span class="_"> </span>ﬁt<span class="_"> </span>or<span class="_"> </span>next</div><div class="t m5 x17 h26 y7307 ff7 fs19 fc1 sc0 ls0 ws0">ﬁt.<span class="_"> </span>However,<span class="_"> </span>the<span class="_"> </span>disadvantage<span class="_"> </span>of<span class="_ _13"> </span>using<span class="_"> </span>best<span class="_"> </span>ﬁt<span class="_"> </span>with<span class="_"> </span>simple<span class="_"> </span>free<span class="_"> </span>list<span class="_"> </span>organizations</div><div class="t m5 x17 h26 y7308 ff7 fs19 fc1 sc0 ls0 ws0">such<span class="_ _16"> </span>as<span class="_ _16"> </span>the<span class="_ _16"> </span>implicit<span class="_ _16"> </span>free<span class="_ _16"> </span>list<span class="_ _16"> </span>is<span class="_ _11"> </span>that<span class="_ _16"> </span>it<span class="_ _16"> </span>requires<span class="_ _16"> </span>an<span class="_ _16"> </span>exhaustive<span class="_ _16"> </span>search<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>heap<span class="_ _0"></span>.</div><div class="t m5 x17 h26 y7309 ff7 fs19 fc1 sc0 ls0 ws0">Later,<span class="_ _16"> </span>we<span class="_ _16"> </span>will<span class="_ _16"> </span>look<span class="_ _11"> </span>at<span class="_ _16"> </span>more<span class="_ _16"> </span>sophisticated<span class="_ _16"> </span>segregated<span class="_ _16"> </span>free<span class="_ _16"> </span>list<span class="_ _16"> </span>organizations<span class="_ _16"> </span>that</div><div class="t m5 x17 h26 y730a ff7 fs19 fc1 sc0 ls0 ws0">approximate<span class="_"> </span>a<span class="_"> </span>best-ﬁt<span class="_"> </span>policy<span class="_"> </span>without<span class="_"> </span>an<span class="_"> </span>exhaustive<span class="_"> </span>search<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>heap<span class="_ _1"></span>.</div><div class="t m5 x17 h41 y226d ffe fs29 fc1 sc0 ls0 ws0">9.9.8<span class="_ _48"> </span><span class="fs19">Splitting<span class="_"> </span>Free<span class="_"> </span>Blocks</span></div><div class="t m5 x17 h26 y587 ff7 fs19 fc1 sc0 ls0 ws0">Once<span class="_"> </span>the<span class="_ _11"> </span>allocator<span class="_"> </span>has<span class="_ _11"> </span>located<span class="_ _11"> </span>a<span class="_"> </span>free<span class="_ _11"> </span>block<span class="_"> </span>that<span class="_ _11"> </span>ﬁts<span class="_ _1"></span>,<span class="_ _11"> </span>it<span class="_"> </span>must<span class="_ _11"> </span>make<span class="_ _11"> </span>another<span class="_"> </span>policy</div><div class="t m5 x17 h26 y588 ff7 fs19 fc1 sc0 ls0 ws0">decision<span class="_ _21"> </span>about<span class="_ _f"> </span>how<span class="_ _f"> </span>much<span class="_ _f"> </span>of<span class="_ _f"> </span>the<span class="_ _f"> </span>free<span class="_ _f"> </span>block<span class="_ _f"> </span>to<span class="_ _21"> </span>allocate.<span class="_ _21"> </span>One<span class="_ _f"> </span>option<span class="_ _f"> </span>is<span class="_ _21"> </span>to<span class="_ _f"> </span>use</div><div class="t m5 x17 h26 y589 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _11"> </span>entire<span class="_ _16"> </span>free<span class="_ _11"> </span>block.<span class="_ _16"> </span>Although<span class="_ _11"> </span>simple<span class="_ _16"> </span>and<span class="_ _11"> </span>fast,<span class="_ _16"> </span>the<span class="_ _11"> </span>main<span class="_ _16"> </span>disadvantage<span class="_ _11"> </span>is<span class="_ _16"> </span>that<span class="_ _11"> </span>it</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
