<div id="pf213" class="pf w2 h11" data-page-no="213"><div class="pc pc213 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg213.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">530<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>4<span class="_ _3d"> </span>Processor<span class="_ _10"> </span>Architecture</span></div><div class="t m5 x243 h2d ye7 ffd fs1e fc2 sc0 ls0 ws0">#<span class="_ _e"> </span>Start<span class="_ _1f"> </span>injecting<span class="_ _1f"> </span>bubbles<span class="_ _e"> </span>as<span class="_ _1f"> </span>soon<span class="_ _e"> </span>as<span class="_ _1f"> </span>exception<span class="_ _1f"> </span>passes<span class="_ _e"> </span>through<span class="_ _1f"> </span>memory<span class="_ _e"> </span>stage</div><div class="t m5 x243 h2d y2682 ffd fs1e fc2 sc0 ls0 ws0">bool<span class="_ _e"> </span>M_bubble<span class="_ _1f"> </span>=<span class="_ _1f"> </span>m_stat<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _e"> </span>SADR,<span class="_ _1f"> </span>SINS,<span class="_ _1f"> </span>SHLT<span class="_ _e"> </span>}<span class="_ _1f"> </span>||<span class="_ _e"> </span>W_stat<span class="_ _1f"> </span>in<span class="_ _1f"> </span>{<span class="_ _e"> </span>SADR,<span class="_ _1f"> </span>SINS,<span class="_ _e"> </span>SHLT<span class="_ _1f"> </span>};</div><div class="t m5 x29 h26 y4966 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _11"> </span>stalling<span class="_ _16"> </span>the<span class="_ _11"> </span>write-back<span class="_ _11"> </span>stage,<span class="_ _11"> </span>we<span class="_ _16"> </span>check<span class="_ _11"> </span>only<span class="_ _11"> </span>the<span class="_ _16"> </span>status<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>instruction</div><div class="t m5 x1d h26 y4967 ff7 fs19 fc2 sc0 ls0 ws0">in<span class="_"> </span>this<span class="_ _11"> </span>stage.<span class="_"> </span>If<span class="_"> </span>we<span class="_ _11"> </span>also<span class="_ _11"> </span>stalled<span class="_ _11"> </span>when<span class="_ _11"> </span>an<span class="_ _11"> </span>excepting<span class="_"> </span>instruction<span class="_ _11"> </span>was<span class="_ _11"> </span>in<span class="_ _11"> </span>the<span class="_ _11"> </span>memory</div><div class="t m5 x1d h26 y4968 ff7 fs19 fc2 sc0 ls0 ws0">stage<span class="_ _1"></span>,<span class="_"> </span>then<span class="_"> </span>this<span class="_"> </span>instruction<span class="_"> </span>would<span class="_"> </span>not<span class="_"> </span>be<span class="_"> </span>able<span class="_"> </span>to<span class="_"> </span>enter<span class="_"> </span>the<span class="_"> </span>write-back<span class="_"> </span>stage.</div><div class="t m5 x1d h2d y4969 ffd fs1e fc2 sc0 ls0 ws0">bool<span class="_ _e"> </span>W_stall<span class="_ _1f"> </span>=<span class="_ _1f"> </span>W_stat<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _e"> </span>SADR,<span class="_ _1f"> </span>SINS,<span class="_ _1f"> </span>SHLT<span class="_ _e"> </span>};</div><div class="t m5 x1d h28 y496a ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>4.43</div><div class="t m5 xe1 h2f y569 ffe fs16 fc6 sc0 ls0 ws0">(page<span class="_"> </span>504)</div><div class="t m5 x1d h46 y496b ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_"> </span>would<span class="_ _13"> </span>then<span class="_ _13"> </span>have<span class="_ _13"> </span>a<span class="_ _13"> </span>misprediction<span class="_"> </span>frequenc<span class="_ _1"></span>y<span class="_"> </span>of<span class="_ _13"> </span>0<span class="ff11">.</span>35,<span class="_ _13"> </span>giving<span class="_ _13"> </span><span class="ffa">mp<span class="_ _13"> </span><span class="ff12">=<span class="_ _13"></span></span></span>0<span class="ff11">.</span>20<span class="_"> </span><span class="ff12">×<span class="_ _13"></span></span>0<span class="ff11">.</span>35<span class="_ _13"> </span><span class="ff12">×</span></div><div class="t m5 x1d h46 y496c ff7 fs19 fc1 sc0 ls0 ws0">2<span class="_"> </span><span class="ff12">=<span class="_ _13"></span></span>0<span class="ff11">.</span><span class="ls20">14,<span class="_"> </span>giving<span class="_"> </span>an<span class="_ _11"> </span>overall<span class="_"> </span>CPI<span class="_"> </span>of<span class="_"> </span>1<span class="_ _0"></span><span class="ff11 ls0">.<span class="ff7">25.<span class="_"> </span>T<span class="_ _1"></span>his<span class="_"> </span>seems<span class="_"> </span>like<span class="_"> </span>a<span class="_"> </span>fairly<span class="_ _11"> </span>marginal<span class="_"> </span>gain,<span class="_"> </span>but</span></span></span></div><div class="t m5 x1d h26 y496d ff7 fs19 fc1 sc0 ls0 ws0">it<span class="_ _14"> </span>would<span class="_ _15"> </span>be<span class="_ _14"> </span>worthwhile<span class="_ _15"> </span>if<span class="_ _15"> </span>the<span class="_ _14"> </span>cost<span class="_ _15"> </span>of<span class="_ _14"> </span>implementing<span class="_ _15"> </span>the<span class="_ _14"> </span>new<span class="_ _15"> </span>branch<span class="_ _15"> </span>prediction</div><div class="t m5 x1d h26 y496e ff7 fs19 fc1 sc0 ls0 ws0">strategy<span class="_"> </span>were<span class="_"> </span>not<span class="_"> </span>too<span class="_"> </span>high.</div><div class="t m5 x1d h28 y496f ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>4.44<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>504)</span></div><div class="t m5 x1d h26 y4970 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _21"> </span>simpliﬁed<span class="_ _21"> </span>analysis<span class="_ _1"></span>,<span class="_ _e"> </span>where<span class="_ _15"> </span>we<span class="_ _15"> </span>focus<span class="_ _21"> </span>on<span class="_ _21"> </span>the<span class="_ _21"> </span>inner<span class="_ _21"> </span>loop,<span class="_ _21"> </span>is<span class="_ _21"> </span>a<span class="_ _21"> </span>useful<span class="_ _21"> </span>way<span class="_ _21"> </span>to</div><div class="t m5 x1d h26 y4971 ff7 fs19 fc1 sc0 ls0 ws0">estimate<span class="_"> </span>program<span class="_"> </span>performance<span class="_ _1"></span>.<span class="_"> </span>As<span class="_"> </span>long<span class="_ _13"> </span>as<span class="_"> </span>the<span class="_"> </span>array<span class="_"> </span>is<span class="_ _13"> </span>sufﬁciently<span class="_"> </span>large<span class="_ _0"></span>,<span class="_"> </span>the<span class="_"> </span>time</div><div class="t m5 x1d h26 y4972 ff7 fs19 fc1 sc0 ls0 ws0">spent<span class="_"> </span>in<span class="_"> </span>other<span class="_"> </span>parts<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>code<span class="_"> </span>will<span class="_"> </span>be<span class="_"> </span>negligible<span class="_ _1"></span>.</div><div class="t m5 x124 h26 y4973 ff7 fs19 fc1 sc0 ls0 ws0">A.<span class="_ _1f"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span>inner<span class="_ _13"> </span>loop<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>code<span class="_ _13"> </span>using<span class="_ _13"> </span>the<span class="_ _13"> </span>conditional<span class="_ _13"> </span>jump<span class="_"> </span>has<span class="_ _13"> </span>11<span class="_ _13"> </span>instructions<span class="_ _3"></span>,<span class="_ _13"> </span>all</div><div class="t m5 x4f h26 y4974 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span>which<span class="_ _13"> </span>are<span class="_"> </span>executed<span class="_"> </span>when<span class="_"> </span>the<span class="_ _13"> </span>array<span class="_"> </span>element<span class="_"> </span>is<span class="_ _13"> </span>zero<span class="_"> </span>or<span class="_"> </span>negative<span class="_ _1"></span>,<span class="_"> </span>and<span class="_"> </span>10<span class="_ _13"> </span>of</div><div class="t m5 x4f h26 y4975 ff7 fs19 fc1 sc0 ls0 ws0">which<span class="_"> </span>are<span class="_"> </span>executed<span class="_"> </span>when<span class="_"> </span>the<span class="_"> </span>array<span class="_ _11"> </span>element<span class="_"> </span>is<span class="_"> </span>positive.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>average<span class="_"> </span>is<span class="_"> </span>10.5.</div><div class="t m5 x4f h26 y4976 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _16"> </span>inner<span class="_ _11"> </span>loop<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>code<span class="_ _16"> </span>using<span class="_ _11"> </span>the<span class="_ _16"> </span>conditional<span class="_ _11"> </span>move<span class="_ _16"> </span>has<span class="_ _11"> </span>10<span class="_ _11"> </span>instructions<span class="_ _0"></span>,</div><div class="t m5 x4f h26 y4977 ff7 fs19 fc1 sc0 ls0 ws0">all<span class="_"> </span>of<span class="_"> </span>which<span class="_"> </span>are<span class="_"> </span>executed<span class="_"> </span>every<span class="_"> </span>time<span class="_ _1"></span>.</div><div class="t m5 x124 h26 y68a ff7 fs19 fc1 sc0 ls0 ws0">B<span class="_ _3"></span>.<span class="_ _1d"> </span>The<span class="_ _15"> </span>loop-closing<span class="_ _15"> </span>jump<span class="_ _21"> </span>will<span class="_ _21"> </span>be<span class="_ _21"> </span>predicted<span class="_ _21"> </span>correctly<span class="_ _3"></span>,<span class="_ _f"> </span>except<span class="_ _21"> </span>when<span class="_ _15"> </span>the<span class="_ _21"> </span>loop</div><div class="t m5 x4f h26 y68b ff7 fs19 fc1 sc0 ls0 ws0">terminates<span class="_ _1"></span>.<span class="_ _6"> </span>F<span class="_ _1"></span>or<span class="_ _6"> </span>a<span class="_ _13"> </span>very<span class="_ _a"> </span>long<span class="_ _13"> </span>array<span class="_ _7"></span>,<span class="_ _13"> </span>this<span class="_ _a"> </span>one<span class="_ _13"> </span>misprediction<span class="_ _a"> </span>will<span class="_ _6"> </span>have<span class="_ _13"> </span>a<span class="_ _a"> </span>negligible</div><div class="t m5 x4f h26 y68c ff7 fs19 fc1 sc0 ls0 ws0">effect<span class="_ _11"> </span>on<span class="_ _11"> </span>the<span class="_ _16"> </span>performance<span class="_ _1"></span>.<span class="_ _11"> </span>The<span class="_"> </span>only<span class="_ _16"> </span>other<span class="_ _11"> </span>source<span class="_ _11"> </span>of<span class="_ _16"> </span>bubbles<span class="_"> </span>for<span class="_ _16"> </span>the<span class="_ _11"> </span>jump-</div><div class="t m5 x4f h26 y68d ff7 fs19 fc1 sc0 ls0 ws0">based<span class="_"> </span>code<span class="_ _11"> </span>is<span class="_"> </span>the<span class="_ _11"> </span>conditional<span class="_"> </span>jump,<span class="_"> </span>depending<span class="_"> </span>on<span class="_ _11"> </span>whether<span class="_"> </span>or<span class="_ _11"> </span>not<span class="_"> </span>the<span class="_ _11"> </span>array</div><div class="t m5 x4f h26 y68e ff7 fs19 fc1 sc0 ls0 ws0">element<span class="_ _16"> </span>is<span class="_ _11"> </span>positive.<span class="_ _11"> </span>This<span class="_ _11"> </span>will<span class="_ _16"> </span>cause<span class="_ _16"> </span>two<span class="_ _16"> </span>bubbles<span class="_ _3"></span>,<span class="_ _14"> </span>but<span class="_ _16"> </span>it<span class="_ _11"> </span>only<span class="_ _16"> </span>occurs<span class="_ _16"> </span>50%<span class="_ _16"> </span>of</div><div class="t m5 x4f h26 y68f ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _13"> </span>time,<span class="_ _13"> </span>so<span class="_ _13"> </span>the<span class="_"> </span>average<span class="_ _13"> </span>is<span class="_ _13"> </span>1.0.<span class="_ _13"> </span>There<span class="_ _13"> </span>are<span class="_ _13"> </span>no<span class="_ _13"> </span>bubbles<span class="_"> </span>in<span class="_ _13"> </span>the<span class="_ _13"> </span>conditional<span class="_"> </span>move</div><div class="t m5 x4f h26 y690 ff7 fs19 fc1 sc0 ls0 ws0">code<span class="_ _1"></span>.</div><div class="t m5 x124 h46 y4978 ff7 fs19 fc1 sc0 ls0 ws0">C.<span class="_ _25"> </span>Our<span class="_ _16"> </span>conditional<span class="_ _16"> </span>jump<span class="_ _16"> </span>code<span class="_ _16"> </span>requires<span class="_ _16"> </span>an<span class="_ _16"> </span>average<span class="_ _16"> </span>of<span class="_ _16"> </span>10<span class="ff11">.</span>5<span class="_ _13"> </span><span class="ff12">+<span class="_ _10"> </span></span>1<span class="_ _1"></span><span class="ff11">.<span class="ff7">0<span class="_"> </span><span class="ff12">=<span class="_ _10"> </span></span>11<span class="_ _1"></span><span class="ff11">.<span class="ff7">5<span class="_ _11"> </span>cycles</span></span></span></span></div><div class="t m5 x4f h26 y4979 ff7 fs19 fc1 sc0 ls0 ws0">per<span class="_ _14"> </span>array<span class="_ _15"> </span>element<span class="_ _14"> </span>(11<span class="_ _14"> </span>cycles<span class="_ _14"> </span>in<span class="_ _15"> </span>the<span class="_ _14"> </span>best<span class="_ _15"> </span>case<span class="_ _14"> </span>and<span class="_ _14"> </span>12<span class="_ _15"> </span>cycles<span class="_ _14"> </span>in<span class="_ _14"> </span>the<span class="_ _15"> </span>worst),</div><div class="t m5 x4f h26 y497a ff7 fs19 fc1 sc0 ls0 ws0">while<span class="_"> </span>our<span class="_"> </span>conditional<span class="_"> </span>move<span class="_"> </span>code<span class="_"> </span>requires<span class="_"> </span>10<span class="ff11">.</span>0<span class="_"> </span>cycles<span class="_"> </span>in<span class="_"> </span>all<span class="_"> </span>cases<span class="_ _3"></span>.</div><div class="t m5 x29 h26 y497b ff7 fs19 fc1 sc0 ls0 ws0">Our<span class="_ _6"> </span>pipeline<span class="_ _13"> </span>has<span class="_ _6"> </span>a<span class="_ _6"> </span>branch<span class="_ _13"> </span>misprediction<span class="_ _6"> </span>penalty<span class="_ _6"> </span>of<span class="_ _13"> </span>only<span class="_ _6"> </span>two<span class="_ _6"> </span>cycles—far<span class="_ _6"> </span>better</div><div class="t m5 x1d h26 y497c ff7 fs19 fc1 sc0 ls0 ws0">than<span class="_ _11"> </span>those<span class="_ _16"> </span>for<span class="_ _11"> </span>the<span class="_ _11"> </span>deep<span class="_ _11"> </span>pipelines<span class="_ _16"> </span>of<span class="_ _11"> </span>higher<span class="_ _1"></span>-performance<span class="_ _16"> </span>processors<span class="_ _3"></span>.<span class="_ _16"> </span>As<span class="_ _11"> </span>a<span class="_ _11"> </span>result,</div><div class="t m5 x1d h26 y497d ff7 fs19 fc1 sc0 ls0 ws0">using<span class="_"> </span>conditional<span class="_"> </span>moves<span class="_"> </span>does<span class="_"> </span>not<span class="_"> </span>affect<span class="_"> </span>program<span class="_"> </span>performance<span class="_"> </span>very<span class="_"> </span>much.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
