<div id="pf23f" class="pf w2 h11" data-page-no="23f"><div class="pc pc23f w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg23f.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">574<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>5<span class="_ _3d"> </span>Optimizing<span class="_ _10"> </span>Program<span class="_ _10"> </span>Performance</span></div><div class="t m5 x25d h40 y4dd3 ff5f fs28 fc1 sc0 ls0 ws0">%rax<span class="_ _ea"> </span>%rbp<span class="_ _13d"> </span>%rdx<span class="_ _1e2"> </span>%xmm0</div><div class="t m5 x87 h40 y4dd4 ff5f fs28 fc1 sc0 ls0 ws0">vmulsd (%rax,%rdx,8), %xmm0, %xmm0</div><div class="t m5 x87 h40 y4dd5 ff5f fs28 fc1 sc0 ls0 ws0">vmulsd 8(%rax,%rdx,8), %xmm1, %xmm1</div><div class="t m5 x87 h40 y4dd6 ff5f fs28 fc1 sc0 ls0 ws0">addq $2,%rdx</div><div class="t m5 x87 h40 y4dd7 ff5f fs28 fc1 sc0 ls0 ws0">cmpq %rdx,%rbp</div><div class="t m5 x87 h40 y4dd8 ff5f fs28 fc1 sc0 ls0 ws0">jg loop </div><div class="t m5 x25d h40 y4dd9 ff5f fs28 fc1 sc0 ls0 ws0">%rax<span class="_ _ea"> </span>%rbp<span class="_ _13d"> </span>%rdx<span class="_ _1e2"> </span>%xmm0</div><div class="t m5 x22b h40 y4dd3 ff5f fs28 fc1 sc0 ls0 ws0">%xmm1</div><div class="t m5 x22b h40 y4dd9 ff5f fs28 fc1 sc0 ls0 ws0">%xmm1</div><div class="t m5 xd h3f y4dda ff60 fs27 fc1 sc0 ls214 ws0">load</div><div class="t m5 x238 h3f y4ddb ff60 fs27 fc1 sc0 ls214 ws0">mul</div><div class="t m5 xd h3f y4ddc ff60 fs27 fc1 sc0 ls214 ws0">load</div><div class="t m5 x238 h3f y4ddd ff60 fs27 fc1 sc0 ls214 ws0">mul</div><div class="t m5 xb7 h3f y4dde ff60 fs27 fc1 sc0 ls214 ws0">add</div><div class="t m5 xd h3f y4ddf ff60 fs27 fc1 sc0 ls214 ws0">cmp</div><div class="t m5 x5d h3f y4de0 ff60 fs27 fc1 sc0 ls21c ws0">jg</div><div class="t m5 x14 h3a y4de1 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>5.22<span class="_ _c"> </span><span class="fc1">Graphical<span class="_ _11"> </span>representation<span class="_ _11"> </span>of<span class="_ _11"> </span>inner-loop<span class="_ _11"> </span>code<span class="_ _11"> </span>for<span class="_ _16"> </span><span class="ffd fs19">combine6</span>.<span class="_"> </span><span class="ff6">Each<span class="_ _11"> </span>iteration<span class="_ _11"> </span>has<span class="_ _11"> </span>two<span class="_ _11"> </span><span class="ffd fs19">vmulsd</span></span></span></div><div class="t m5 x14 h34 y4de2 ff6 fs16 fc1 sc0 ls0 ws0">instructions,<span class="_ _10"> </span>each<span class="_ _11"> </span>of<span class="_ _10"> </span>which<span class="_ _10"> </span>is<span class="_ _11"> </span>translated<span class="_ _10"> </span>into<span class="_ _11"> </span>a<span class="_ _10"> </span>load<span class="_ _11"> </span>and<span class="_ _10"> </span>a<span class="_ _10"> </span>mul<span class="_ _11"> </span>operation.</div><div class="t m5 x245 h40 y4de3 ff62 fs28 fc1 sc0 ls0 ws0">%rax<span class="_ _1d5"> </span>%rbp<span class="_ _ff"> </span>%rdx<span class="_ _1e3"></span>%xmm0<span class="_ _54"> </span>%xmm1</div><div class="t m5 x1d6 h40 y4de4 ff62 fs28 fc1 sc0 ls0 ws0">%xmm1<span class="_ _2d"> </span>%rdx<span class="_ _1e4"></span>%xmm0</div><div class="t m5 x18 h40 y4de5 ff62 fs28 fc1 sc0 ls0 ws0">data[</div><div class="t m5 x138 h40 y4de6 ff63 fs27 fc1 sc0 ls0 ws0">i<span class="_ _a"> </span><span class="ff62 fs28">]</span></div><div class="t m5 x18 h40 y4de7 ff62 fs28 fc1 sc0 ls0 ws0">data[</div><div class="t m5 x138 h40 y4de8 ff63 fs27 fc1 sc0 ls0 ws0">i<span class="_ _a"> </span><span class="ff62 fs28">+1]</span></div><div class="t m5 x17 h3f y4de9 ff64 fs27 fc1 sc0 ls214 ws0">load</div><div class="t m5 x17e h3f y4dea ff64 fs27 fc1 sc0 ls214 ws0">load</div><div class="t m5 x156 h3f y4deb ff64 fs27 fc1 sc0 ls214 ws0">(a)<span class="_ _1e5"> </span>(b)</div><div class="t m5 x7a h3f y4dec ff64 fs27 fc1 sc0 ls214 ws0">add</div><div class="t m5 x58 h3f y4ded ff64 fs27 fc1 sc0 ls214 ws0">cmp</div><div class="t m5 x209 h3f y4dee ff64 fs27 fc1 sc0 ls21c ws0">jg</div><div class="t m5 x44 h40 y4de3 ff62 fs28 fc1 sc0 ls0 ws0">%rdx<span class="_ _1e6"></span>%xmm0</div><div class="t m5 x44 h40 y4de4 ff62 fs28 fc1 sc0 ls0 ws0">%rdx<span class="_ _1e6"></span>%xmm0</div><div class="t m5 x12d h3f y4def ff64 fs27 fc1 sc0 ls214 ws0">load</div><div class="t m5 x199 h3f y4df0 ff64 fs27 fc1 sc0 ls214 ws0">mul</div><div class="t m5 x93 h40 y4de3 ff62 fs28 fc1 sc0 ls0 ws0">%xmm1</div><div class="t m5 x93 h40 y4de4 ff62 fs28 fc1 sc0 ls0 ws0">%xmm1</div><div class="t m5 x11a h3f y4df1 ff64 fs27 fc1 sc0 ls214 ws0">load</div><div class="t m5 x247 h3f y4df2 ff64 fs27 fc1 sc0 ls214 ws0">mul</div><div class="t m5 x43 h3f y4df3 ff64 fs27 fc1 sc0 ls214 ws0">add</div><div class="t m5 xc6 h3f y4dec ff64 fs27 fc1 sc0 ls214 ws0">mul</div><div class="t m5 x5b h3f y4df4 ff64 fs27 fc1 sc0 ls214 ws0">mul</div><div class="t m5 x14 h3a y4df5 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>5.23<span class="_ _66"> </span><span class="fc1">Abstracting<span class="_"> </span><span class="ffd fs19">combine6<span class="_ _10"> </span></span>operations<span class="_"> </span>as<span class="_"> </span>a<span class="_ _13"> </span>data-ï¬‚ow<span class="_"> </span>graph.<span class="_"> </span><span class="ff6">W<span class="_ _1"></span>e<span class="_ _10"> </span>rearrange,<span class="_ _11"> </span>simplify<span class="_ _3"></span>,<span class="_ _10"> </span>and<span class="_ _10"> </span>abstract</span></span></div><div class="t m5 x14 h34 y4df6 ff6 fs16 fc1 sc0 ls0 ws0">the<span class="_ _11"> </span>representation<span class="_ _16"> </span>of<span class="_ _11"> </span>Figure<span class="_ _16"> </span>5.22<span class="_ _11"> </span>to<span class="_ _11"> </span>show<span class="_ _16"> </span>the<span class="_ _11"> </span>data<span class="_ _16"> </span>dependencies<span class="_ _11"> </span>between<span class="_ _11"> </span>successive<span class="_ _16"> </span>iterations<span class="_ _11"> </span>(a).<span class="_ _16"> </span>W<span class="_ _1"></span>e<span class="_ _16"> </span>see</div><div class="t m5 x14 h34 y4df7 ff6 fs16 fc1 sc0 ls0 ws0">that<span class="_ _10"> </span>there<span class="_ _11"> </span>is<span class="_ _10"> </span>no<span class="_ _10"> </span>dependency<span class="_ _11"> </span>between<span class="_ _10"> </span>the<span class="_ _11"> </span>two<span class="_ _10"> </span>mul<span class="_ _11"> </span>operations<span class="_ _10"> </span>(b).</div><div class="t m5 x1d h26 y250 ff7 fs19 fc1 sc0 ls0 ws0">data<span class="_ _11"> </span>dependencies<span class="_ _11"> </span>between<span class="_ _11"> </span>iterations<span class="_ _11"> </span>through<span class="_ _11"> </span>the<span class="_ _11"> </span>process<span class="_ _11"> </span>shown<span class="_ _11"> </span>in<span class="_ _11"> </span>F<span class="_ _0"></span>igure<span class="_"> </span>5.23.</div><div class="t m5 x1d h26 y251 ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_ _21"> </span>with<span class="_ _f"> </span><span class="ffd">combine5</span>,<span class="_ _e"> </span>the<span class="_ _f"> </span>inner<span class="_ _21"> </span>loop<span class="_ _f"> </span>contains<span class="_ _f"> </span>two<span class="_ _f"> </span><span class="ffd">vmulsd<span class="_ _f"> </span></span>operations<span class="_ _1"></span>,<span class="_ _e"> </span>but<span class="_ _21"> </span>these</div><div class="t m5 x1d h26 y252 ff7 fs19 fc1 sc0 ls0 ws0">instructions<span class="_ _11"> </span>translate<span class="_ _16"> </span>into<span class="_ _11"> </span><span class="ff6">mul<span class="_ _11"> </span></span>operations<span class="_ _16"> </span>that<span class="_ _11"> </span>read<span class="_ _11"> </span>and<span class="_ _16"> </span>write<span class="_ _11"> </span>separate<span class="_ _11"> </span>registers<span class="_ _1"></span>,</div><div class="t m5 x1d h26 y253 ff7 fs19 fc1 sc0 ls0 ws0">with<span class="_ _11"> </span>no<span class="_ _16"> </span>data<span class="_ _11"> </span>dependency<span class="_ _11"> </span>between<span class="_ _11"> </span>them<span class="_ _16"> </span>(F<span class="_ _1"></span>igure<span class="_ _16"> </span>5.23(b)).<span class="_ _11"> </span>W<span class="_ _3"></span>e<span class="_ _16"> </span>then<span class="_ _11"> </span>replicate<span class="_ _11"> </span>this</div><div class="t m5 x1d h26 y254 ff7 fs19 fc1 sc0 ls0 ws0">template<span class="_ _14"> </span><span class="ff11">n/</span>2<span class="_ _15"> </span>times<span class="_ _15"> </span>(F<span class="_ _1"></span>igure<span class="_ _15"> </span>5.24),<span class="_ _15"> </span>modeling<span class="_ _15"> </span>the<span class="_ _14"> </span>execution<span class="_ _15"> </span>of<span class="_ _14"> </span>the<span class="_ _15"> </span>function<span class="_ _15"> </span>on<span class="_ _14"> </span>a</div><div class="t m5 x1d h26 y255 ff7 fs19 fc1 sc0 ls0 ws0">vector<span class="_ _13"> </span>of<span class="_"> </span>length<span class="_ _13"> </span><span class="ff11">n</span>.<span class="_"> </span>W<span class="_ _3"></span>e<span class="_ _13"> </span>see<span class="_"> </span>that<span class="_ _13"> </span>we<span class="_"> </span>now<span class="_ _13"> </span>have<span class="_ _13"> </span>two<span class="_"> </span>critical<span class="_ _13"> </span>paths<span class="_ _1"></span>,<span class="_"> </span>one<span class="_ _13"> </span>corresponding</div><div class="t m5 x1d h26 y256 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_"> </span>computing<span class="_ _13"> </span>the<span class="_"> </span>product<span class="_"> </span>of<span class="_"> </span>even-numbered<span class="_ _13"> </span>elements<span class="_"> </span>(program<span class="_"> </span>value<span class="_ _13"> </span><span class="ffd">acc0</span>)<span class="_"> </span>and</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
