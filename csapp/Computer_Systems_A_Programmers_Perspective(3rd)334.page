<div id="pf14e" class="pf w2 h11" data-page-no="14e"><div class="pc pc14e w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg14e.png"/><div class="t m5 x195 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>3.11<span class="_ _60"> </span>Floating-Point<span class="_ _10"> </span>Code<span class="_ _3e"> </span><span class="ffe fs1e">333</span></div><div class="t m5 x17 h31 y390 ff7 fs21 fc2 sc0 ls0 ws0">Instruction<span class="_ _59"> </span>Source<span class="_ _26"> </span>Destination<span class="_ _26"> </span>Description</div><div class="t m5 x17 h31 yc94 ffd fs1e fc2 sc0 ls0 ws0">vcvttss2si<span class="_ _4f"> </span><span class="ff11 fs21">X<span class="_ _2"></span><span class="ff7">/</span>M</span></div><div class="t m5 x10d h33 yc95 ff7 fs20 fc2 sc0 ls0 ws0">32</div><div class="t m5 xf1 h55 yc94 ff11 fs21 fc2 sc0 ls0 ws0">R</div><div class="t m5 x48 h33 yc95 ff7 fs20 fc2 sc0 ls0 ws0">32</div><div class="t m5 xe3 h31 yc94 ff7 fs21 fc2 sc0 ls0 ws0">Convert<span class="_"> </span>with<span class="_"> </span>truncation<span class="_"> </span>single<span class="_"> </span>precision<span class="_"> </span>to<span class="_"> </span>integer</div><div class="t m5 x17 h31 yc98 ffd fs1e fc2 sc0 ls0 ws0">vcvttsd2si<span class="_ _4f"> </span><span class="ff11 fs21">X<span class="_ _2"></span><span class="ff7">/</span>M</span></div><div class="t m5 x10d h33 yc97 ff7 fs20 fc2 sc0 ls0 ws0">64</div><div class="t m5 xf1 h55 yc98 ff11 fs21 fc2 sc0 ls0 ws0">R</div><div class="t m5 x48 h33 yc97 ff7 fs20 fc2 sc0 ls0 ws0">32</div><div class="t m5 xe3 h31 yc98 ff7 fs21 fc2 sc0 ls0 ws0">Convert<span class="_"> </span>with<span class="_"> </span>truncation<span class="_"> </span>double<span class="_"> </span>precision<span class="_"> </span>to<span class="_"> </span>integer</div><div class="t m5 x17 h31 yc9b ffd fs1e fc2 sc0 ls0 ws0">vcvttss2siq<span class="_ _f1"> </span><span class="ff11 fs21">X<span class="_ _2"></span><span class="ff7">/</span>M</span></div><div class="t m5 x10d h33 yc9a ff7 fs20 fc2 sc0 ls0 ws0">32</div><div class="t m5 xf1 h55 yc9b ff11 fs21 fc2 sc0 ls0 ws0">R</div><div class="t m5 x48 h33 yc9a ff7 fs20 fc2 sc0 ls0 ws0">64</div><div class="t m5 xe3 h31 yc9b ff7 fs21 fc2 sc0 ls0 ws0">Convert<span class="_"> </span>with<span class="_"> </span>truncation<span class="_"> </span>single<span class="_"> </span>precision<span class="_"> </span>to<span class="_"> </span>quad<span class="_"> </span>word<span class="_"> </span>integer</div><div class="t m5 x17 h31 yc9e ffd fs1e fc2 sc0 ls0 ws0">vcvttsd2siq<span class="_ _f1"> </span><span class="ff11 fs21">X<span class="_ _2"></span><span class="ff7">/</span>M</span></div><div class="t m5 x10d h33 yc9d ff7 fs20 fc2 sc0 ls0 ws0">64</div><div class="t m5 xf1 h55 yc9e ff11 fs21 fc2 sc0 ls0 ws0">R</div><div class="t m5 x48 h33 yc9d ff7 fs20 fc2 sc0 ls0 ws0">64</div><div class="t m5 xe3 h31 yc9e ff7 fs21 fc2 sc0 ls0 ws0">Convert<span class="_"> </span>with<span class="_"> </span>truncation<span class="_"> </span>double<span class="_"> </span>precision<span class="_"> </span>to<span class="_"> </span>quad<span class="_"> </span>word<span class="_"> </span>integer</div><div class="t m5 x17 h34 y1328 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _16"> </span>3.47<span class="_ _c"> </span><span class="fc1">Two-operand<span class="_ _16"> </span>ﬂoating-point<span class="_ _14"> </span>conversion<span class="_ _14"> </span>operations.<span class="_ _16"> </span><span class="ff6">These<span class="_ _14"> </span>convert<span class="_ _14"> </span>ﬂoating-point<span class="_ _14"> </span>data<span class="_ _14"> </span>to</span></span></div><div class="t m5 x17 h34 y1329 ff6 fs16 fc1 sc0 ls0 ws0">integers.<span class="_ _14"> </span>(<span class="ff11">X<span class="_ _2"></span></span>:<span class="_ _15"> </span>XMM<span class="_ _14"> </span>register<span class="_ _15"> </span>(e.g.,</div><div class="t m5 x89 h3a y15c2 ffd fs19 fc1 sc0 ls0 ws0">%xmm3<span class="ff6 fs16">);<span class="_ _21"> </span><span class="ff11">R</span></span></div><div class="t m5 x67 h5d y2fba ff7 fs32 fc1 sc0 ls0 ws0">32</div><div class="t m5 x1c8 h3a y15c2 ff6 fs16 fc1 sc0 ls0 ws0">:<span class="_ _14"> </span>32-bit<span class="_ _15"> </span>general-purpose<span class="_ _15"> </span>register<span class="_ _14"> </span>(e.g.,<span class="_ _21"> </span><span class="ffd fs19">%eax</span>);<span class="_ _21"> </span><span class="ff11">R</span></div><div class="t m5 xdb h5d y2fba ff7 fs32 fc1 sc0 ls0 ws0">64</div><div class="t m5 x210 h34 y15c2 ff6 fs16 fc1 sc0 ls0 ws0">:<span class="_ _14"> </span>64-bit</div><div class="t m5 x17 h34 y15c4 ff6 fs16 fc1 sc0 ls0 ws0">general-purpose<span class="_ _10"> </span>register<span class="_ _11"> </span>(e.g.,</div><div class="t m5 xf7 h3a y2fbb ffd fs19 fc1 sc0 ls0 ws0">%rax<span class="ff6 fs16">);<span class="_ _10"> </span><span class="ff11">M</span></span></div><div class="t m5 x110 h5d y2fbc ff7 fs32 fc1 sc0 ls0 ws0">32</div><div class="t m5 xfa h34 y2fbb ff6 fs16 fc1 sc0 ls0 ws0">:<span class="_ _10"> </span>32-bit<span class="_ _11"> </span>memory<span class="_ _10"> </span>range;<span class="_ _11"> </span><span class="ff11">M</span></div><div class="t m5 x3a h5d y2fbc ff7 fs32 fc1 sc0 ls0 ws0">64</div><div class="t m5 x17b h34 y2fbb ff6 fs16 fc1 sc0 ls0 ws0">:<span class="_ _10"> </span>64-bit<span class="_ _11"> </span>memory<span class="_ _10"> </span>range)</div><div class="t m5 x17 h31 y2fbd ff7 fs21 fc2 sc0 ls0 ws0">Instruction<span class="_ _74"> </span>Source<span class="_"> </span>1<span class="_ _26"> </span>Source<span class="_"> </span>2<span class="_ _26"> </span>Destination<span class="_ _26"> </span>Description</div><div class="t m5 x17 h2d y2fbe ffd fs1e fc2 sc0 ls0 ws0">vcvtsi2ss<span class="_ _14a"> </span><span class="ff11 fs21">M</span></div><div class="t m5 x178 h33 y2fbf ff7 fs20 fc2 sc0 ls0 ws0">32</div><div class="t m5 x32 h31 y2fbe ff7 fs21 fc2 sc0 ls0 ws0">/<span class="ff11">R</span></div><div class="t m5 xcd h33 y2fbf ff7 fs20 fc2 sc0 ls0 ws0">32</div><div class="t m5 xe6 h31 y2fbe ff11 fs21 fc2 sc0 ls18b ws0">XX<span class="_ _184"></span><span class="ff7 ls0">Convert<span class="_"> </span>integer<span class="_"> </span>to<span class="_"> </span>single<span class="_"> </span>precision</span></div><div class="t m5 x17 h2d y2fc0 ffd fs1e fc2 sc0 ls0 ws0">vcvtsi2sd<span class="_ _14a"> </span><span class="ff11 fs21">M</span></div><div class="t m5 x178 h33 y2fc1 ff7 fs20 fc2 sc0 ls0 ws0">32</div><div class="t m5 x32 h31 y2fc0 ff7 fs21 fc2 sc0 ls0 ws0">/<span class="ff11">R</span></div><div class="t m5 xcd h33 y2fc1 ff7 fs20 fc2 sc0 ls0 ws0">32</div><div class="t m5 xe6 h31 y2fc0 ff11 fs21 fc2 sc0 ls18b ws0">XX<span class="_ _184"></span><span class="ff7 ls0">Convert<span class="_"> </span>integer<span class="_"> </span>to<span class="_"> </span>double<span class="_"> </span>precision</span></div><div class="t m5 x17 h2d y2fc2 ffd fs1e fc2 sc0 ls0 ws0">vcvtsi2ssq<span class="_ _79"> </span><span class="ff11 fs21">M</span></div><div class="t m5 x178 h33 y2fc3 ff7 fs20 fc2 sc0 ls0 ws0">64</div><div class="t m5 x32 h31 y2fc2 ff7 fs21 fc2 sc0 ls0 ws0">/<span class="ff11">R</span></div><div class="t m5 xcd h33 y2fc3 ff7 fs20 fc2 sc0 ls0 ws0">64</div><div class="t m5 xe6 h31 y2fc2 ff11 fs21 fc2 sc0 ls18b ws0">XX<span class="_ _184"></span><span class="ff7 ls0">Convert<span class="_"> </span>quad<span class="_"> </span>word<span class="_"> </span>integer<span class="_"> </span>to<span class="_"> </span>single<span class="_"> </span>precision</span></div><div class="t m5 x17 h2d y2fc4 ffd fs1e fc2 sc0 ls0 ws0">vcvtsi2sdq<span class="_ _79"> </span><span class="ff11 fs21">M</span></div><div class="t m5 x178 h33 y2fc5 ff7 fs20 fc2 sc0 ls0 ws0">64</div><div class="t m5 x32 h31 y2fc4 ff7 fs21 fc2 sc0 ls0 ws0">/<span class="ff11">R</span></div><div class="t m5 xcd h33 y2fc5 ff7 fs20 fc2 sc0 ls0 ws0">64</div><div class="t m5 xe6 h31 y2fc4 ff11 fs21 fc2 sc0 ls18b ws0">XX<span class="_ _184"></span><span class="ff7 ls0">Convert<span class="_"> </span>quad<span class="_"> </span>word<span class="_"> </span>integer<span class="_"> </span>to<span class="_"> </span>double<span class="_"> </span>precision</span></div><div class="t m5 x17 h34 y2fc6 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _16"> </span>3.48<span class="_ _66"> </span><span class="fc1">Three-operand<span class="_ _14"> </span>ﬂoating-point<span class="_ _16"> </span>conversion<span class="_ _16"> </span>operations.<span class="_ _16"> </span><span class="ff6">These<span class="_ _16"> </span>instructions<span class="_ _16"> </span>convert<span class="_ _16"> </span>from<span class="_ _16"> </span>the</span></span></div><div class="t m5 x17 h34 y2fc7 ff6 fs16 fc1 sc0 ls0 ws0">data<span class="_ _10"> </span>type<span class="_ _10"> </span>of<span class="_ _11"> </span>the<span class="_ _10"> </span>ﬁrst<span class="_ _11"> </span>source<span class="_ _10"> </span>to<span class="_ _10"> </span>the<span class="_ _10"> </span>data<span class="_ _11"> </span>type<span class="_ _10"> </span>of<span class="_ _11"> </span>the<span class="_ _10"> </span>destination.<span class="_ _10"> </span>The<span class="_ _11"> </span>second<span class="_ _10"> </span>source<span class="_ _10"> </span>value<span class="_ _10"> </span>has<span class="_ _11"> </span>no<span class="_ _10"> </span>effect<span class="_ _11"> </span>on<span class="_ _10"> </span>the</div><div class="t m5 x17 h34 y2fc8 ff6 fs16 fc1 sc0 ls0 ws0">low-order<span class="_ _13"> </span>bytes<span class="_ _13"> </span>of<span class="_ _10"> </span>the<span class="_ _13"> </span>result.<span class="_ _13"> </span>(<span class="ff11">X<span class="_ _2"></span></span>:<span class="_ _13"> </span>XMM<span class="_ _13"> </span>register<span class="_ _13"> </span>(e.g.,</div><div class="t m5 x20c h3a y2fc9 ffd fs19 fc1 sc0 ls0 ws0">%xmm3<span class="ff6 fs16">);<span class="_ _10"> </span><span class="ff11">M</span></span></div><div class="t m5 x205 h5d y2fca ff7 fs32 fc1 sc0 ls0 ws0">32</div><div class="t m5 x1bc h34 y2fc9 ff6 fs16 fc1 sc0 ls0 ws0">:<span class="_ _13"> </span>32-bit<span class="_ _13"> </span>memor<span class="_ _2"></span>y<span class="_ _13"> </span>range;<span class="_ _10"> </span><span class="ff11">M</span></div><div class="t m5 x12a h5d y2fca ff7 fs32 fc1 sc0 ls0 ws0">64</div><div class="t m5 x71 h34 y2fc9 ff6 fs16 fc1 sc0 ls0 ws0">:<span class="_ _13"> </span>64-bit<span class="_ _13"> </span>memor<span class="_ _2"></span>y</div><div class="t m5 x17 h34 y2fcb ff6 fs16 fc1 sc0 ls0 ws0">range)</div><div class="t m5 x17 h26 y2fcc ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_"> </span>its<span class="_"> </span>associated<span class="_"> </span>x86-64<span class="_"> </span>assembly<span class="_"> </span>code</div><div class="t m5 x2e h61 y2fcd ff13 fs35 fc6 sc0 ls0 ws0">float<span class="_ _f"> </span>float_mov(float<span class="_ _f"> </span>v1,<span class="_ _f"> </span>float<span class="_ _e"> </span>*src,<span class="_ _21"> </span>float<span class="_ _f"> </span>*dst)</div><div class="t m5 x2e h61 y2fce ff13 fs35 fc6 sc0 ls0 ws0">v1<span class="_ _f"> </span>in<span class="_ _f"> </span>%xmm0,<span class="_ _f"> </span>src<span class="_ _e"> </span>in<span class="_ _21"> </span>%rdi,<span class="_ _f"> </span>dst<span class="_ _e"> </span>in<span class="_ _21"> </span>%rsi</div><div class="t m5 x2c h2d y2fcf ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">float_mov:</span></div><div class="t m5 x2c h2d y2fd0 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">vmovaps<span class="_ _e"> </span>%xmm0,<span class="_ _1f"> </span>%xmm1<span class="_ _59"> </span></span><span class="ff13 fs35">Copy<span class="_ _f"> </span>v1</span></div><div class="t m5 x2c h2d y2fd1 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">vmovss<span class="_ _1a"> </span>(%rdi),<span class="_ _e"> </span>%xmm0<span class="_ _93"> </span></span><span class="ff13 fs35">Read<span class="_ _f"> </span>v2<span class="_ _e"> </span>from<span class="_ _21"> </span>src</span></div><div class="t m5 x2c h2d y2fd2 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">vmovss<span class="_ _1a"> </span>%xmm1,<span class="_ _e"> </span>(%rsi)<span class="_ _93"> </span></span><span class="ff13 fs35">Write<span class="_ _f"> </span>v1<span class="_ _e"> </span>to<span class="_ _21"> </span>dst</span></div><div class="t m5 x2c h2d y2fd3 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">ret<span class="_ _139"> </span></span><span class="ff13 fs35">Return<span class="_ _f"> </span>v2<span class="_ _f"> </span>in<span class="_ _f"> </span>%xmm0</span></div><div class="t m5 x17 h26 y17d3 ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _11"> </span>can<span class="_"> </span>see<span class="_ _11"> </span>in<span class="_ _11"> </span>this<span class="_"> </span>example<span class="_ _11"> </span>the<span class="_ _11"> </span>use<span class="_"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span><span class="ffd">vmovaps<span class="_ _11"> </span></span>instruction<span class="_"> </span>to<span class="_ _11"> </span>copy<span class="_ _11"> </span>data<span class="_ _11"> </span>from</div><div class="t m5 x17 h26 y2fd4 ff7 fs19 fc2 sc0 ls0 ws0">one<span class="_ _e"> </span>register<span class="_ _e"> </span>to<span class="_ _e"> </span>another<span class="_ _e"> </span>and<span class="_ _1f"> </span>the<span class="_ _e"> </span>use<span class="_ _e"> </span>of<span class="_ _e"> </span>the<span class="_ _e"> </span><span class="ffd">vmovss<span class="_ _e"> </span></span>instruction<span class="_ _1f"> </span>to<span class="_ _e"> </span>copy<span class="_ _e"> </span>data</div><div class="t m5 x17 h26 y2fd5 ff7 fs19 fc2 sc0 ls0 ws0">from<span class="_"> </span>memory<span class="_"> </span>to<span class="_"> </span>an<span class="_"> </span>XMM<span class="_"> </span>register<span class="_"> </span>and<span class="_"> </span>from<span class="_"> </span>an<span class="_"> </span>XMM<span class="_"> </span>register<span class="_"> </span>to<span class="_"> </span>memory<span class="_ _3"></span>.</div><div class="t m5 x26 h26 y2fd6 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>igures<span class="_ _13"> </span>3.47<span class="_ _a"> </span>and<span class="_ _6"> </span>3.48<span class="_ _13"> </span>show<span class="_ _a"> </span>sets<span class="_ _13"> </span>of<span class="_ _a"> </span>instructions<span class="_ _6"> </span>for<span class="_ _13"> </span>converting<span class="_ _a"> </span>between<span class="_ _6"> </span>ﬂoating-</div><div class="t m5 x17 h26 y2fd7 ff7 fs19 fc2 sc0 ls0 ws0">point<span class="_ _11"> </span>and<span class="_ _11"> </span>integer<span class="_ _11"> </span>data<span class="_ _11"> </span>types<span class="_ _1"></span>,<span class="_ _11"> </span>as<span class="_ _11"> </span>well<span class="_ _11"> </span>as<span class="_ _11"> </span>between<span class="_ _16"> </span>different<span class="_"> </span>ﬂoating-point<span class="_ _11"> </span>formats<span class="_ _1"></span>.</div><div class="t m5 x17 h26 y2fd8 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>hese<span class="_ _21"> </span>are<span class="_ _21"> </span>all<span class="_ _21"> </span>scalar<span class="_ _15"> </span>instructions<span class="_ _21"> </span>operating<span class="_ _21"> </span>on<span class="_ _21"> </span>individual<span class="_ _21"> </span>data<span class="_ _21"> </span>values<span class="_ _1"></span>.<span class="_ _15"> </span>Those<span class="_ _15"> </span>in</div><div class="t m5 x17 h26 y2fd9 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_"> </span>3.47<span class="_ _13"> </span>convert<span class="_ _13"> </span>from<span class="_ _13"> </span>a<span class="_"> </span>ﬂoating-point<span class="_ _13"> </span>value<span class="_ _13"> </span>read<span class="_ _13"> </span>from<span class="_ _13"> </span>either<span class="_"> </span>an<span class="_ _13"> </span>XMM<span class="_ _13"> </span>register</div><div class="t m5 x17 h26 y2fda ff7 fs19 fc2 sc0 ls0 ws0">or<span class="_ _16"> </span>memory<span class="_ _14"> </span>and<span class="_ _14"> </span>write<span class="_ _16"> </span>the<span class="_ _14"> </span>result<span class="_ _14"> </span>to<span class="_ _16"> </span>a<span class="_ _14"> </span>general-purpose<span class="_ _14"> </span>register<span class="_ _16"> </span>(e.g<span class="_ _1"></span>.,<span class="_ _15"> </span><span class="ffd">%rax</span>,<span class="_ _14"> </span><span class="ffd">%ebx</span>,</div><div class="t m5 x17 h26 y2fdb ff7 fs19 fc2 sc0 ls0 ws0">etc.).<span class="_"> </span>W<span class="_ _1"></span>hen<span class="_"> </span>converting<span class="_"> </span>ﬂoating-point<span class="_"> </span>values<span class="_"> </span>to<span class="_"> </span>integers<span class="_ _1"></span>,<span class="_"> </span>they<span class="_"> </span>perform<span class="_"> </span><span class="ffa">truncation</span>,</div><div class="t m5 x17 h26 y2fdc ff7 fs19 fc2 sc0 ls0 ws0">rounding<span class="_ _16"> </span>values<span class="_ _14"> </span>toward<span class="_ _16"> </span>zero<span class="_ _0"></span>,<span class="_ _14"> </span>as<span class="_ _16"> </span>is<span class="_ _14"> </span>required<span class="_ _16"> </span>by<span class="_ _14"> </span>C<span class="_ _16"> </span>and<span class="_ _14"> </span>most<span class="_ _16"> </span>other<span class="_ _14"> </span>programming</div><div class="t m5 x17 h26 y2fdd ff7 fs19 fc2 sc0 ls0 ws0">languages<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y2fde ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _14"> </span>instructions<span class="_ _16"> </span>in<span class="_ _16"> </span>Figure<span class="_ _11"> </span>3.48<span class="_ _14"> </span>convert<span class="_ _16"> </span>from<span class="_ _16"> </span>integer<span class="_ _16"> </span>to<span class="_ _14"> </span>ﬂoating<span class="_ _16"> </span>point.<span class="_ _16"> </span>They</div><div class="t m5 x17 h26 y2fdf ff7 fs19 fc2 sc0 ls0 ws0">use<span class="_ _14"> </span>an<span class="_ _14"> </span>unusual<span class="_ _14"> </span>three-operand<span class="_ _14"> </span>format,<span class="_ _21"> </span>with<span class="_ _14"> </span>two<span class="_ _14"> </span>sources<span class="_ _14"> </span>and<span class="_ _14"> </span>a<span class="_ _15"> </span>destination.<span class="_ _14"> </span>T<span class="_ _1"></span>he</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
