<div id="pf34d" class="pf w2 h11" data-page-no="34d"><div class="pc pc34d w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg34d.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">844<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>9<span class="_ _3d"> </span>Virtual<span class="_ _10"> </span>Memory</span></div><div class="t m5 x5a h32 ye7 ff11 fs21 fc2 sc0 ls293 ws0">nP<span class="_ _dc"></span><span class="ff12 ls0">=<span class="_ _13"> </span><span class="ff7">2</span></span></div><div class="t m5 x1ac h51 y9b9 ff11 fs20 fc2 sc0 ls0 ws0">p</div><div class="t m5 xb3 h31 ye7 ff7 fs21 fc2 sc0 ls0 ws0">Number<span class="_"> </span>of<span class="_"> </span>PTEs</div><div class="t m5 x1d h31 yb20 ff7 fs21 fc2 sc0 ls0 ws0">12<span class="_ _8c"> </span>1<span class="_"> </span>K</div><div class="t m5 x1d h31 y9bb ff7 fs21 fc1 sc0 ls0 ws0">16<span class="_ _ab"> </span>16<span class="_"> </span>K</div><div class="t m5 x1d h31 y9bc ff7 fs21 fc1 sc0 ls0 ws0">24<span class="_ _14a"> </span>2<span class="_ _13"> </span>M</div><div class="t m5 x1d h31 y9bd ff7 fs21 fc1 sc0 ls0 ws0">36<span class="_ _58"> </span>1<span class="_"> </span>G</div><div class="t m5 x1d h41 y6cc8 ffe fs29 fc1 sc0 ls0 ws0">9.3.3<span class="_ _48"> </span><span class="fs19">Page<span class="_"> </span>Hits</span></div><div class="t m5 x1d h26 y6cc9 ff7 fs19 fc1 sc0 ls0 ws0">Consider<span class="_ _13"> </span>what<span class="_"> </span>happens<span class="_ _13"> </span>when<span class="_ _13"> </span>the<span class="_ _13"> </span>CPU<span class="_"> </span>reads<span class="_ _13"> </span>a<span class="_ _13"> </span>word<span class="_"> </span>of<span class="_ _13"> </span>virtual<span class="_ _13"> </span>memory<span class="_ _13"> </span>contained</div><div class="t m5 x1d h26 y6cca ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_ _6"> </span>VP<span class="_ _13"> </span>2,<span class="_ _13"> </span>which<span class="_ _6"> </span>is<span class="_ _6"> </span>cached<span class="_ _13"> </span>in<span class="_ _6"> </span>DRAM<span class="_ _13"> </span>(F<span class="_ _1"></span>igure<span class="_ _6"> </span>9.5).<span class="_ _13"> </span>Using<span class="_ _6"> </span>a<span class="_ _13"> </span>technique<span class="_ _6"> </span>we<span class="_ _6"> </span>will<span class="_ _13"> </span>describe</div><div class="t m5 x1d h26 y6ccb ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_"> </span>detail<span class="_ _11"> </span>in<span class="_"> </span>Section<span class="_ _11"> </span>9.6,<span class="_ _11"> </span>the<span class="_"> </span>address<span class="_ _11"> </span>translation<span class="_"> </span>hardware<span class="_ _11"> </span>uses<span class="_"> </span>the<span class="_ _11"> </span>virtual<span class="_"> </span>address</div><div class="t m5 x1d h26 y6ccc ff7 fs19 fc1 sc0 ls0 ws0">as<span class="_ _13"> </span>an<span class="_"> </span>index<span class="_ _13"> </span>to<span class="_ _13"> </span>locate<span class="_"> </span>PTE<span class="_ _13"> </span>2<span class="_ _13"> </span>and<span class="_"> </span>read<span class="_ _13"> </span>it<span class="_ _13"> </span>from<span class="_"> </span>memory<span class="_ _7"></span>.<span class="_ _13"> </span>Since<span class="_"> </span>the<span class="_ _13"> </span>valid<span class="_ _13"> </span>bit<span class="_"> </span>is<span class="_ _13"> </span>set,<span class="_ _13"> </span>the</div><div class="t m5 x1d h26 y6ccd ff7 fs19 fc1 sc0 ls0 ws0">address<span class="_ _13"> </span>translation<span class="_"> </span>hardware<span class="_ _13"> </span>knows<span class="_"> </span>that<span class="_ _13"> </span>VP<span class="_"> </span>2<span class="_ _13"> </span>is<span class="_"> </span>cached<span class="_ _13"> </span>in<span class="_"> </span>memory<span class="_ _7"></span>.<span class="_"> </span>So<span class="_ _13"> </span>it<span class="_"> </span>uses<span class="_ _13"> </span>the</div><div class="t m5 x1d h26 y6cce ff7 fs19 fc1 sc0 ls0 ws0">physical<span class="_ _13"> </span>memory<span class="_"> </span>address<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_"> </span>PTE<span class="_ _13"> </span>(which<span class="_ _13"> </span>points<span class="_ _13"> </span>to<span class="_"> </span>the<span class="_ _13"> </span>start<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>cached<span class="_ _13"> </span>page</div><div class="t m5 x1d h26 y6ccf ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_"> </span>PP<span class="_"> </span>1)<span class="_"> </span>to<span class="_"> </span>construct<span class="_"> </span>the<span class="_"> </span>physical<span class="_"> </span>address<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>word.</div><div class="t m5 x1d h41 y6cd0 ffe fs29 fc1 sc0 ls0 ws0">9.3.4</div><div class="t m5 x8c h43 y6cd1 ffe fs19 fc1 sc0 ls0 ws0">Page<span class="_"> </span>Faults</div><div class="t m5 x1d h26 y6cd2 ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _16"> </span>virtual<span class="_ _11"> </span>memory<span class="_ _16"> </span>parlance,<span class="_ _11"> </span>a<span class="_ _16"> </span>DRAM<span class="_ _16"> </span>cache<span class="_ _16"> </span>miss<span class="_ _16"> </span>is<span class="_ _11"> </span>known<span class="_ _16"> </span>as<span class="_ _16"> </span>a<span class="_ _16"> </span><span class="ffa">page<span class="_ _16"> </span>fault<span class="_ _2"></span></span>.<span class="_ _16"> </span>F<span class="_ _1"></span>ig-</div><div class="t m5 x1d h26 y6cd3 ff7 fs19 fc1 sc0 ls0 ws0">ure<span class="_"> </span>9.6<span class="_ _11"> </span>shows<span class="_"> </span>the<span class="_ _11"> </span>state<span class="_ _11"> </span>of<span class="_"> </span>our<span class="_ _11"> </span>example<span class="_ _11"> </span>page<span class="_"> </span>table<span class="_ _11"> </span>before<span class="_ _11"> </span>the<span class="_"> </span>fault.<span class="_ _11"> </span>T<span class="_ _0"></span>he<span class="_"> </span>CPU<span class="_ _11"> </span>has</div><div class="t m5 x1d h26 y6cd4 ff7 fs19 fc1 sc0 ls0 ws0">referenced<span class="_ _11"> </span>a<span class="_ _16"> </span>word<span class="_ _11"> </span>in<span class="_ _11"> </span>VP<span class="_ _11"> </span>3,<span class="_ _16"> </span>which<span class="_ _11"> </span>is<span class="_ _16"> </span>not<span class="_ _11"> </span>cached<span class="_ _11"> </span>in<span class="_ _16"> </span>DRAM.<span class="_ _11"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span>address<span class="_ _11"> </span>transla-</div><div class="t m5 x1d h26 y6cd5 ff7 fs19 fc1 sc0 ls0 ws0">tion<span class="_ _16"> </span>hardware<span class="_ _16"> </span>reads<span class="_ _16"> </span>PTE<span class="_ _16"> </span>3<span class="_ _16"> </span>from<span class="_ _16"> </span>memory<span class="_ _3"></span>,<span class="_ _16"> </span>infers<span class="_ _16"> </span>from<span class="_ _16"> </span>the<span class="_ _16"> </span>valid<span class="_ _16"> </span>bit<span class="_ _16"> </span>that<span class="_ _16"> </span>VP<span class="_ _16"> </span>3<span class="_ _16"> </span>is</div><div class="t m5 x1d h26 y6cd6 ff7 fs19 fc1 sc0 ls0 ws0">not<span class="_"> </span>cached,<span class="_"> </span>and<span class="_ _13"> </span>triggers<span class="_"> </span>a<span class="_"> </span>page<span class="_"> </span>fault<span class="_"> </span>exception.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>page<span class="_"> </span>fault<span class="_ _13"> </span>exception<span class="_"> </span>invokes</div><div class="t m5 x1d h26 y6cd7 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_"> </span>page<span class="_ _11"> </span>fault<span class="_"> </span>exception<span class="_ _11"> </span>handler<span class="_"> </span>in<span class="_ _11"> </span>the<span class="_"> </span>kernel,<span class="_ _11"> </span>which<span class="_"> </span>selects<span class="_ _11"> </span>a<span class="_ _11"> </span>victim<span class="_"> </span>page—in<span class="_ _11"> </span>this</div><div class="t m5 x1d h26 y6cd8 ff7 fs19 fc1 sc0 ls0 ws0">case<span class="_ _1"></span>,<span class="_"> </span>VP<span class="_ _13"> </span>4<span class="_ _6"> </span>stored<span class="_ _13"> </span>in<span class="_ _13"> </span>PP<span class="_ _13"> </span>3.<span class="_ _13"> </span>If<span class="_ _13"> </span>VP<span class="_ _13"> </span>4<span class="_ _13"> </span>has<span class="_ _13"> </span>been<span class="_ _13"> </span>modiﬁed,<span class="_ _13"> </span>then<span class="_ _13"> </span>the<span class="_ _13"> </span>kernel<span class="_ _13"> </span>copies<span class="_ _13"> </span>it<span class="_ _13"> </span>back</div><div class="t m5 x1d h26 y6cd9 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_"> </span>disk.<span class="_"> </span>In<span class="_ _13"> </span>either<span class="_"> </span>case<span class="_ _0"></span>,<span class="_"> </span>the<span class="_"> </span>kernel<span class="_ _13"> </span>modiﬁes<span class="_"> </span>the<span class="_"> </span>page<span class="_"> </span>table<span class="_ _13"> </span>entry<span class="_"> </span>for<span class="_"> </span>VP<span class="_"> </span>4<span class="_"> </span>to<span class="_ _13"> </span>reﬂect</div><div class="t m5 x1d h26 y6cda ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>fact<span class="_"> </span>that<span class="_"> </span>VP<span class="_"> </span>4<span class="_"> </span>is<span class="_"> </span>no<span class="_"> </span>longer<span class="_"> </span>cached<span class="_"> </span>in<span class="_"> </span>main<span class="_"> </span>memory<span class="_ _3"></span>.</div><div class="t m5 x14 h2f y6cdb ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>9.5</div><div class="t m5 x14 h34 y6cdc ffe fs16 fc1 sc0 ls0 ws0">VM<span class="_ _6"> </span>page<span class="_ _13"> </span>hit.<span class="_ _6"> </span><span class="ff6">The<span class="_ _13"> </span>reference</span></div><div class="t m5 x14 h34 y6cdd ff6 fs16 fc1 sc0 ls0 ws0">to<span class="_ _10"> </span>a<span class="_ _11"> </span>word<span class="_ _10"> </span>in<span class="_ _10"> </span>VP<span class="_ _11"> </span>2<span class="_ _10"> </span>is<span class="_ _11"> </span>a<span class="_ _10"> </span>hit.</div><div class="t m5 xe7 h3f y6cde ffa9 fs27 fc1 sc0 ls0 ws0">PTE 0</div><div class="t m5 x61 h3f y6cdf ffa9 fs27 fc1 sc0 ls0 ws0">PP 0</div><div class="t m5 x61 h3f y6ce0 ffa9 fs27 fc1 sc0 ls0 ws0">PP 3</div><div class="t m5 xa0 h3f y6ce1 ffa9 fs27 fc1 sc0 ls0 ws0">1</div><div class="t m5 xa0 h3f y6ce2 ffa9 fs27 fc1 sc0 ls0 ws0">1</div><div class="t m5 xa0 h3f y6ce3 ffa9 fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 xa0 h3f y6ce4 ffa9 fs27 fc1 sc0 ls0 ws0">1</div><div class="t m5 xa0 h3f y6ce5 ffa9 fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 xa0 h3f y6ce6 ffa9 fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 xa0 h3f y6ce7 ffa9 fs27 fc1 sc0 ls0 ws0">1</div><div class="t m5 xa0 h3f y6ce8 ffa9 fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 xe7 h3f y6ce9 ffa9 fs27 fc1 sc0 ls0 ws0">PTE 7</div><div class="t m5 xd5 h3f y6cea ffa9 fs27 fc1 sc0 ls0 ws0">Null</div><div class="t m5 x111 h3f y6ce7 ffa9 fs27 fc1 sc0 ls0 ws0">VP 1</div><div class="t m5 x111 h3f y6ceb ffa9 fs27 fc1 sc0 ls0 ws0">VP 4</div><div class="t m5 x111 h3f y6cec ffa9 fs27 fc1 sc0 ls0 ws0">VP 7</div><div class="t m5 x111 h3f y6ced ffa9 fs27 fc1 sc0 ls0 ws0">VP 2</div><div class="t m5 x111 h3f y6cee ffa9 fs27 fc1 sc0 ls0 ws0">VP 1</div><div class="t m5 x111 h3f y6cef ffa9 fs27 fc1 sc0 ls0 ws0">VP 2</div><div class="t m5 x111 h3f y6cf0 ffa9 fs27 fc1 sc0 ls0 ws0">VP 3</div><div class="t m5 x111 h3f y6cf1 ffa9 fs27 fc1 sc0 ls0 ws0">VP 4</div><div class="t m5 x111 h3f y6cf2 ffa9 fs27 fc1 sc0 ls0 ws0">VP 6</div><div class="t m5 x111 h3f y6cf3 ffa9 fs27 fc1 sc0 ls0 ws0">VP 7</div><div class="t m5 xd5 h3f y6cf4 ffa9 fs27 fc1 sc0 ls0 ws0">Null</div><div class="t m5 x15 h3f y6cf5 ffaa fs27 fc1 sc0 ls0 ws0">Physical page</div><div class="t m5 xa7 h3f y6cf6 ffaa fs27 fc1 sc0 ls0 ws0">number or</div><div class="t m5 x7b h3f y6cf7 ffaa fs27 fc1 sc0 ls0 ws0">disk address</div><div class="t m5 xe3 h3f y6cf8 ffa9 fs27 fc1 sc0 ls0 ws0">Memory-resident</div><div class="t m5 xd3 h3f y6cf9 ffa9 fs27 fc1 sc0 ls0 ws0">page table</div><div class="t m5 x1b1 h3f y6cfa ffa9 fs27 fc1 sc0 ls0 ws0">(DRAM)</div><div class="t m5 x16a h3f y6cfb ffa9 fs27 fc1 sc0 ls0 ws0">Virtual memory</div><div class="t m5 x1e0 h3f y6cfc ffa9 fs27 fc1 sc0 ls0 ws0">(disk)</div><div class="t m5 x166 h3f y6cfd ffa9 fs27 fc1 sc0 ls0 ws0">Physical memory</div><div class="t m5 x132 h3f y6cfe ffa9 fs27 fc1 sc0 ls0 ws0">(DRAM)</div><div class="t m5 xe0 h3f y6cff ffa9 fs27 fc1 sc0 ls0 ws0">Virtual address</div><div class="t m5 x16d h3f y6d00 ffaa fs27 fc1 sc0 ls0 ws0">V<span class="_ _1"></span>alid</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
