<div id="pf398" class="pf w2 h11" data-page-no="398"><div class="pc pc398 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg398.png"/><div class="t m5 x107 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Solutions<span class="_ _10"> </span>to<span class="_ _10"> </span>Practice<span class="_ _10"> </span>Problems<span class="_ _1b"> </span><span class="ffe fs1e">919</span></div><div class="t m5 x17 h2d ye7 ff6 fs20 fc6 sc0 ls0 ws0">21<span class="_ _20"> </span><span class="ffd fs1e fc2">/*<span class="_ _e"> </span>Check<span class="_ _1f"> </span>for<span class="_ _1f"> </span>required<span class="_ _e"> </span>command-line<span class="_ _1f"> </span>argument<span class="_ _e"> </span>*/</span></div><div class="t m5 x17 h2d yc4d ff6 fs20 fc6 sc0 ls0 ws0">22<span class="_ _20"> </span><span class="ffd fs1e fc2">if<span class="_ _e"> </span>(argc<span class="_ _1f"> </span>!=<span class="_ _1f"> </span>2)<span class="_ _e"> </span>{</span></div><div class="t m5 x17 h2d yecb ff6 fs20 fc6 sc0 ls0 ws0">23<span class="_ _70"> </span><span class="ffd fs1e fc2">printf(&quot;usage:<span class="_ _e"> </span>%s<span class="_ _1f"> </span>&lt;filename&gt;\n&quot;,<span class="_ _1f"> </span>argv[0]);</span></div><div class="t m5 x17 h2d yecc ff6 fs20 fc6 sc0 ls0 ws0">24<span class="_ _70"> </span><span class="ffd fs1e fc2">exit(0);</span></div><div class="t m5 x17 h2d yecd ff6 fs20 fc6 sc0 ls0 ws0">25<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x17 h2e yece ff6 fs20 fc6 sc0 ls0 ws0">26</div><div class="t m5 x17 h2e y69d9 ff6 fs20 fc6 sc0 ls0 ws0">27</div><div class="t m5 x142 h2d yecf ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Copy<span class="_ _1f"> </span>the<span class="_ _1f"> </span>input<span class="_ _e"> </span>argument<span class="_ _1f"> </span>to<span class="_ _e"> </span>stdout<span class="_ _1f"> </span>*/</div><div class="t m5 x17 h2d yed0 ff6 fs20 fc6 sc0 ls0 ws0">28<span class="_ _20"> </span><span class="ffd fs1e fc2">fd<span class="_ _e"> </span>=<span class="_ _1f"> </span>Open(argv[1],<span class="_ _1f"> </span>O_RDONLY,<span class="_ _e"> </span>0);</span></div><div class="t m5 x17 h2e y20fe ff6 fs20 fc6 sc0 ls0 ws0">29</div><div class="t m5 x142 h2d y1a10 ffd fs1e fc2 sc0 ls0 ws0">fstat(fd,<span class="_ _e"> </span>&amp;stat);</div><div class="t m5 x17 h2d yed3 ff6 fs20 fc6 sc0 ls0 ws0">30<span class="_ _20"> </span><span class="ffd fs1e fc2">mmapcopy(fd,<span class="_ _e"> </span>stat.st_size);</span></div><div class="t m5 x17 h2d yed4 ff6 fs20 fc6 sc0 ls0 ws0">31<span class="_ _20"> </span><span class="ffd fs1e fc2">exit(0);</span></div><div class="t m5 x17 h2d y462 ff6 fs20 fc6 sc0 ls0 ws0">32<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1a3 h2c y6ad7 ffa fs16 fc2 sc0 ls0 ws0">code/vm/mmapcopy<span class="_ _3"></span>.c</div><div class="t m5 x17 h28 y769a ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>9.6<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>885)</span></div><div class="t m5 x17 h26 y769b ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _16"> </span>problem<span class="_ _11"> </span>touches<span class="_ _16"> </span>on<span class="_ _16"> </span>some<span class="_ _11"> </span>core<span class="_ _16"> </span>ideas<span class="_ _11"> </span>such<span class="_ _16"> </span>as<span class="_ _16"> </span>alignment<span class="_ _11"> </span>requirements<span class="_ _1"></span>,<span class="_ _16"> </span>min-</div><div class="t m5 x17 h26 y769c ff7 fs19 fc1 sc0 ls0 ws0">imum<span class="_ _16"> </span>block<span class="_ _11"> </span>sizes<span class="_ _1"></span>,<span class="_ _16"> </span>and<span class="_ _16"> </span>header<span class="_ _16"> </span>encodings<span class="_ _1"></span>.<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span>general<span class="_ _16"> </span>approach<span class="_ _11"> </span>for<span class="_ _16"> </span>determining</div><div class="t m5 x17 h26 y769d ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _11"> </span>block<span class="_ _16"> </span>size<span class="_ _11"> </span>is<span class="_ _16"> </span>to<span class="_ _16"> </span>round<span class="_ _11"> </span>the<span class="_ _16"> </span>sum<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span>requested<span class="_ _16"> </span>payload<span class="_ _11"> </span>and<span class="_ _16"> </span>the<span class="_ _11"> </span>header<span class="_ _16"> </span>size</div><div class="t m5 x17 h26 y769e ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _16"> </span>the<span class="_ _11"> </span>nearest<span class="_ _16"> </span>multiple<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span>alignment<span class="_ _16"> </span>requirement<span class="_ _16"> </span>(in<span class="_ _16"> </span>this<span class="_ _16"> </span>case<span class="_ _1"></span>,<span class="_ _16"> </span>8<span class="_ _16"> </span>bytes).<span class="_ _16"> </span>F<span class="_ _1"></span>or</div><div class="t m5 x17 h46 y769f ff7 fs19 fc1 sc0 ls0 ws0">example<span class="_ _1"></span>,<span class="_ _16"> </span>the<span class="_ _16"> </span>block<span class="_ _11"> </span>size<span class="_ _16"> </span>for<span class="_ _11"> </span>the<span class="_ _16"> </span><span class="ffd">malloc(2)<span class="_ _11"> </span></span>request<span class="_ _16"> </span>is<span class="_ _11"> </span>4<span class="_"> </span><span class="ff12">+<span class="_ _13"></span></span>2<span class="_"> </span><span class="ff12">=<span class="_ _10"> </span></span>6<span class="_ _11"> </span>rounded<span class="_ _11"> </span>up<span class="_ _16"> </span>to<span class="_ _11"> </span>8.</div><div class="t m5 x17 h46 y76a0 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _16"> </span>block<span class="_ _16"> </span>size<span class="_ _16"> </span>for<span class="_ _16"> </span>the<span class="_ _16"> </span><span class="ffd">malloc(20)<span class="_ _16"> </span></span>request<span class="_ _16"> </span>is<span class="_ _16"> </span>20<span class="_"> </span><span class="ff12">+<span class="_ _13"></span></span>4<span class="_"> </span><span class="ff12">=<span class="_ _13"> </span></span>24<span class="_ _16"> </span>rounded<span class="_ _16"> </span>up<span class="_ _16"> </span>to<span class="_ _16"> </span>24.<span class="_ _16"> </span>No</div><div class="t m5 x17 h26 y76a1 ff7 fs19 fc1 sc0 ls0 ws0">need<span class="_"> </span>to<span class="_"> </span>round<span class="_"> </span>up<span class="_"> </span>since<span class="_"> </span>it<span class="_"> </span>is<span class="_"> </span>already<span class="_"> </span>aligned.</div><div class="t m5 x17 h31 y76a2 ff7 fs21 fc2 sc0 ls0 ws0">Request<span class="_ _e2"> </span>Block<span class="_"> </span>size<span class="_"> </span>(decimal<span class="_"> </span>bytes)<span class="_ _26"> </span>Block<span class="_"> </span>header<span class="_"> </span>(hex)</div><div class="t m5 x17 h31 y76a3 ffd fs1e fc2 sc0 ls0 ws0">malloc(2)<span class="_ _d1"> </span><span class="ff7 fs21">8<span class="_ _227"> </span></span>0x9</div><div class="t m5 x17 h2d y76a4 ffd fs1e fc2 sc0 ls0 ws0">malloc(9)</div><div class="t m5 x112 h31 y76a5 ff7 fs21 fc2 sc0 ls0 ws0">16<span class="_ _228"> </span><span class="ffd fs1e">0x11</span></div><div class="t m5 x17 h2d y76a6 ffd fs1e fc2 sc0 ls0 ws0">malloc(15)</div><div class="t m5 x112 h31 y76a7 ff7 fs21 fc2 sc0 ls0 ws0">24<span class="_ _228"> </span><span class="ffd fs1e">0x19</span></div><div class="t m5 x17 h2d y76a8 ffd fs1e fc2 sc0 ls0 ws0">malloc(20)</div><div class="t m5 x112 h31 y76a9 ff7 fs21 fc2 sc0 ls0 ws0">24<span class="_ _228"> </span><span class="ffd fs1e">0x19</span></div><div class="t m5 x17 h28 y76aa ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>9.7</div><div class="t m5 xc3 h2f y76ab ffe fs16 fc6 sc0 ls0 ws0">(page<span class="_"> </span>888)</div><div class="t m5 x17 h26 y76ac ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _16"> </span>minimum<span class="_"> </span>block<span class="_ _16"> </span>size<span class="_ _11"> </span>can<span class="_ _11"> </span>have<span class="_ _11"> </span>a<span class="_ _16"> </span>signiﬁcant<span class="_ _11"> </span>effect<span class="_ _11"> </span>on<span class="_ _11"> </span>internal<span class="_ _16"> </span>fragmentation.</div><div class="t m5 x17 h26 y76ad ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>hus<span class="_ _1"></span>,<span class="_ _11"> </span>it<span class="_ _11"> </span>is<span class="_"> </span>good<span class="_ _11"> </span>to<span class="_ _11"> </span>understand<span class="_"> </span>the<span class="_ _11"> </span>minimum<span class="_"> </span>block<span class="_ _11"> </span>sizes<span class="_ _11"> </span>associated<span class="_"> </span>with<span class="_ _11"> </span>different</div><div class="t m5 x17 h26 y76ae ff7 fs19 fc1 sc0 ls0 ws0">allocator<span class="_ _13"> </span>designs<span class="_ _13"> </span>and<span class="_ _13"> </span>alignment<span class="_ _13"> </span>requirements<span class="_ _3"></span>.<span class="_ _13"> </span>The<span class="_ _6"> </span>tricky<span class="_ _13"> </span>part<span class="_ _13"> </span>is<span class="_ _13"> </span>to<span class="_ _13"> </span>realize<span class="_ _13"> </span>that<span class="_ _13"> </span>the</div><div class="t m5 x17 h26 y76af ff7 fs19 fc1 sc0 ls0 ws0">same<span class="_ _13"> </span>block<span class="_ _13"> </span>can<span class="_ _13"> </span>be<span class="_ _13"> </span>allocated<span class="_ _13"> </span>or<span class="_ _13"> </span>free<span class="_"> </span>at<span class="_ _13"> </span>different<span class="_ _13"> </span>points<span class="_ _13"> </span>in<span class="_ _13"> </span>time<span class="_ _1"></span>.<span class="_ _13"> </span>Thus<span class="_ _3"></span>,<span class="_ _13"> </span>the<span class="_"> </span>minimum</div><div class="t m5 x17 h26 y76b0 ff7 fs19 fc1 sc0 ls0 ws0">block<span class="_ _13"> </span>size<span class="_"> </span>is<span class="_ _13"> </span>the<span class="_"> </span>maximum<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>minimum<span class="_ _13"> </span>allocated<span class="_ _13"> </span>block<span class="_"> </span>size<span class="_ _13"> </span>and<span class="_"> </span>the<span class="_ _13"> </span>minimum</div><div class="t m5 x17 h26 y76b1 ff7 fs19 fc1 sc0 ls0 ws0">free<span class="_ _13"> </span>block<span class="_ _13"> </span>size<span class="_ _0"></span>.<span class="_ _13"> </span>F<span class="_ _1"></span>or<span class="_ _13"> </span>example<span class="_ _0"></span>,<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_ _13"> </span>last<span class="_ _13"> </span>subproblem,<span class="_"> </span>the<span class="_ _13"> </span>minimum<span class="_ _13"> </span>allocated<span class="_ _13"> </span>block</div><div class="t m5 x17 h26 y76b2 ff7 fs19 fc1 sc0 ls0 ws0">size<span class="_"> </span>is<span class="_ _13"> </span>a<span class="_"> </span>4-byte<span class="_"> </span>header<span class="_"> </span>and<span class="_ _13"> </span>a<span class="_"> </span>1-byte<span class="_"> </span>payload<span class="_ _13"> </span>rounded<span class="_"> </span>up<span class="_"> </span>to<span class="_ _13"> </span>8<span class="_"> </span>bytes<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>minimum</div><div class="t m5 x17 h26 y76b3 ff7 fs19 fc1 sc0 ls0 ws0">free<span class="_"> </span>block<span class="_ _13"> </span>size<span class="_"> </span>is<span class="_"> </span>a<span class="_ _13"> </span>4-byte<span class="_"> </span>header<span class="_"> </span>and<span class="_ _13"> </span>4-byte<span class="_"> </span>footer,<span class="_"> </span>which<span class="_ _13"> </span>is<span class="_"> </span>already<span class="_"> </span>a<span class="_ _13"> </span>multiple<span class="_"> </span>of</div><div class="t m5 x17 h26 y76b4 ff7 fs19 fc1 sc0 ls0 ws0">8<span class="_"> </span>and<span class="_ _13"> </span>doesn’t<span class="_"> </span>need<span class="_"> </span>to<span class="_ _13"> </span>be<span class="_"> </span>rounded.<span class="_"> </span>So<span class="_"> </span>the<span class="_ _13"> </span>minimum<span class="_"> </span>block<span class="_"> </span>size<span class="_"> </span>for<span class="_ _13"> </span>this<span class="_"> </span>allocator<span class="_"> </span>is</div><div class="t m5 x17 h26 y76b5 ff7 fs19 fc1 sc0 ls0 ws0">8<span class="_"> </span>bytes<span class="_ _1"></span>.</div><div class="t m5 x6a h31 y76b6 ff7 fs21 fc2 sc0 ls0 ws0">Minimum<span class="_"> </span>block</div><div class="t m5 x17 h31 y76b7 ff7 fs21 fc2 sc0 ls0 ws0">Alignment<span class="_ _2e"> </span>Allocated<span class="_"> </span>block<span class="_ _147"> </span>Free<span class="_"> </span>block<span class="_ _8f"> </span>size<span class="_"> </span>(bytes)</div><div class="t m5 x17 h31 y76b8 ff7 fs21 fc2 sc0 ls0 ws0">Single<span class="_"> </span>word<span class="_ _74"> </span>Header<span class="_"> </span>and<span class="_"> </span>footer<span class="_ _128"> </span>Header<span class="_"> </span>and<span class="_"> </span>footer<span class="_ _c0"> </span>12</div><div class="t m5 x17 h31 y76b9 ff7 fs21 fc2 sc0 ls0 ws0">Single<span class="_"> </span>word<span class="_ _74"> </span>Header,<span class="_"> </span>but<span class="_"> </span>no<span class="_"> </span>footer<span class="_ _26"> </span>Header<span class="_"> </span>and<span class="_"> </span>footer<span class="_ _84"> </span>8</div><div class="t m5 x17 h31 y76ba ff7 fs21 fc2 sc0 ls0 ws0">Double<span class="_"> </span>word<span class="_ _26"> </span>Header<span class="_"> </span>and<span class="_"> </span>footer<span class="_ _128"> </span>Header<span class="_"> </span>and<span class="_"> </span>footer<span class="_ _156"> </span>16</div><div class="t m5 x17 h31 y76bb ff7 fs21 fc2 sc0 ls0 ws0">Double<span class="_"> </span>word<span class="_ _26"> </span>Header,<span class="_"> </span>but<span class="_"> </span>no<span class="_"> </span>footer<span class="_ _26"> </span>Header<span class="_"> </span>and<span class="_"> </span>footer<span class="_ _229"> </span>8</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
