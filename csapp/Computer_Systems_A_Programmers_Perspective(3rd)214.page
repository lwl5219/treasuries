<div id="pfd6" class="pf w2 h11" data-page-no="d6"><div class="pc pcd6 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bgd6.png"/><div class="t m5 x11f h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>3.3<span class="_ _60"> </span>Data<span class="_ _10"> </span>Formats<span class="_ _3e"> </span><span class="ffe fs1e">213</span></div><div class="t m5 x34 h2a y257 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">A<span class="_ _3"></span>TT<span class="_ _16"> </span>versus<span class="_ _11"> </span>Intel<span class="_ _11"> </span>assembly-code<span class="_ _11"> </span>formats</span></div><div class="t m5 x34 h2b y2d0 ff7 fs1e fc2 sc0 ls0 ws0">In<span class="_ _11"> </span>our<span class="_ _16"> </span>presentation,<span class="_ _16"> </span>we<span class="_ _16"> </span>show<span class="_ _11"> </span>assembly<span class="_ _16"> </span>code<span class="_ _16"> </span>in<span class="_ _11"> </span>A<span class="_ _1"></span>TT<span class="_ _16"> </span>format<span class="_ _11"> </span>(named<span class="_ _16"> </span>after<span class="_ _16"> </span>A<span class="_ _3"></span>T&amp;T<span class="_ _3"></span>,<span class="_ _16"> </span>the<span class="_ _16"> </span>company<span class="_ _11"> </span>that</div><div class="t m5 x34 h2b y2d1 ff7 fs1e fc2 sc0 ls0 ws0">operated<span class="_ _6"> </span>Bell<span class="_ _13"> </span>Laboratories<span class="_ _a"> </span>for<span class="_ _13"> </span>many<span class="_ _6"> </span>years),<span class="_ _13"> </span>the<span class="_ _6"> </span>default<span class="_ _6"> </span>format<span class="_ _13"> </span>for<span class="_ _6"> </span><span class="ff9">gcc</span>,<span class="_ _13"> </span><span class="ff9">objd<span class="_ _1"></span>ump<span class="ff7">,<span class="_ _13"> </span>and<span class="_ _6"> </span>the<span class="_ _6"> </span>other<span class="_ _13"> </span>tools<span class="_ _6"> </span>we</span></span></div><div class="t m5 x34 h2b y2d2 ff7 fs1e fc2 sc0 ls0 ws0">will<span class="_"> </span>consider.<span class="_"> </span>Other<span class="_"> </span>programming<span class="_"> </span>tools<span class="_ _1"></span>,<span class="_ _10"> </span>including<span class="_ _10"> </span>those<span class="_ _10"> </span>from<span class="_ _10"> </span>Microsoft<span class="_ _10"> </span>as<span class="_ _10"> </span>well<span class="_ _10"> </span>as<span class="_ _10"> </span>the<span class="_ _10"> </span>documentation</div><div class="t m5 x34 h2b y2d3 ff7 fs1e fc2 sc0 ls0 ws0">from<span class="_ _16"> </span>Intel,<span class="_ _16"> </span>show<span class="_ _16"> </span>assembly<span class="_ _16"> </span>code<span class="_ _16"> </span>in<span class="_ _16"> </span><span class="ffa">Intel<span class="_ _14"> </span></span>format.<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span>two<span class="_ _16"> </span>formats<span class="_ _16"> </span>differ<span class="_ _16"> </span>in<span class="_ _16"> </span>a<span class="_ _16"> </span>number<span class="_ _16"> </span>of<span class="_ _11"> </span>ways<span class="_ _0"></span>.<span class="_ _16"> </span>As<span class="_ _16"> </span>an</div><div class="t m5 x34 h2b y2d4 ff7 fs1e fc2 sc0 ls0 ws0">example<span class="_ _1"></span>,<span class="_"> </span><span class="ff9">gcc<span class="_ _13"> </span></span>can<span class="_ _13"> </span>generate<span class="_"> </span>code<span class="_ _13"> </span>in<span class="_ _13"> </span>Intel<span class="_ _13"> </span>format<span class="_ _13"> </span>for<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ffd">sum<span class="_ _13"> </span></span>function<span class="_"> </span>using<span class="_ _13"> </span>the<span class="_ _13"> </span>following<span class="_ _13"> </span>command<span class="_ _13"> </span>line:</div><div class="t m5 x34 h2d y7ac ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">gcc<span class="_ _1f"> </span>-Og<span class="_ _1f"> </span>-S<span class="_ _e"> </span>-masm=intel<span class="_ _1f"> </span>mstore.c</span></div><div class="t m5 x34 h2b yc77 ff7 fs1e fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>gives<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>assembly<span class="_"> </span>code:</div><div class="t m5 x34 h2d y2157 ffd fs1e fc2 sc0 ls0 ws0">multstore:</div><div class="t m5 x26 h2d y2158 ffd fs1e fc2 sc0 ls0 ws0">push<span class="_ _46"> </span>rbx</div><div class="t m5 x26 h2d y2159 ffd fs1e fc2 sc0 ls0 ws0">mov<span class="_ _8c"> </span>rbx,<span class="_ _e"> </span>rdx</div><div class="t m5 x26 h2d yaef ffd fs1e fc2 sc0 ls0 ws0">call<span class="_ _46"> </span>mult2</div><div class="t m5 x26 h2d y215a ffd fs1e fc2 sc0 ls0 ws0">mov<span class="_ _8c"> </span>QWORD<span class="_ _e"> </span>PTR<span class="_ _1f"> </span>[rbx],<span class="_ _1f"> </span>rax</div><div class="t m5 x26 h2d y215b ffd fs1e fc2 sc0 ls0 ws0">pop<span class="_ _8c"> </span>rbx</div><div class="t m5 x26 h2d y215c ffd fs1e fc2 sc0 ls0 ws0">ret</div><div class="t m5 x35 h2b y215d ff7 fs1e fc2 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_"> </span>see<span class="_"> </span>that<span class="_"> </span>the<span class="_"> </span>Intel<span class="_"> </span>and<span class="_"> </span>A<span class="_ _1"></span>TT<span class="_"> </span>formats<span class="_"> </span>differ<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>ways:</div><div class="t m5 x26 h3d y215e ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x35 h2b y121a ff7 fs1e fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _13"> </span>Intel<span class="_ _6"> </span>code<span class="_ _13"> </span>omits<span class="_ _6"> </span>the<span class="_ _13"> </span>size<span class="_ _6"> </span>designation<span class="_ _6"> </span>sufﬁxes<span class="_ _0"></span>.<span class="_ _6"> </span>W<span class="_ _1"></span>e<span class="_ _13"> </span>see<span class="_ _6"> </span>instruction<span class="_ _6"> </span><span class="ffd">push<span class="_ _13"> </span></span>and<span class="_ _6"> </span><span class="ffd">mov<span class="_ _13"> </span></span>instead<span class="_ _6"> </span>of<span class="_ _13"> </span><span class="ffd">pushq</span></div><div class="t m5 x35 h2b y215f ff7 fs1e fc2 sc0 ls0 ws0">and<span class="_"> </span><span class="ffd">movq</span>.</div><div class="t m5 x26 h3d y2160 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x35 h2b y2161 ff7 fs1e fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>Intel<span class="_"> </span>code<span class="_"> </span>omits<span class="_"> </span>the<span class="_"> </span>‘<span class="ffd">%</span>’<span class="_"> </span>character<span class="_"> </span>in<span class="_"> </span>front<span class="_"> </span>of<span class="_"> </span>register<span class="_"> </span>names<span class="_ _0"></span>,<span class="_"> </span>using<span class="_"> </span><span class="ffd">rbx<span class="_ _10"> </span></span>instead<span class="_"> </span>of<span class="_"> </span><span class="ffd">%rbx</span>.</div><div class="t m5 x26 h3d y2162 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x35 h2b y2163 ff7 fs1e fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _16"> </span>Intel<span class="_ _16"> </span>code<span class="_ _16"> </span>has<span class="_ _16"> </span>a<span class="_ _16"> </span>different<span class="_ _16"> </span>way<span class="_ _16"> </span>of<span class="_ _16"> </span>describing<span class="_ _16"> </span>locations<span class="_ _16"> </span>in<span class="_ _16"> </span>memory—for<span class="_ _16"> </span>example,<span class="_ _16"> </span><span class="ffd">QWORD<span class="_ _11"> </span>PTR</span></div><div class="t m5 x35 h2b y2164 ffd fs1e fc2 sc0 ls0 ws0">[rbx]<span class="_ _10"> </span><span class="ff7">rather<span class="_"> </span>than<span class="_"> </span></span>(%rbx)<span class="ff7">.</span></div><div class="t m5 x26 h3d y2165 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x35 h2b y2166 ff7 fs1e fc2 sc0 ls0 ws0">Instructions<span class="_ _13"> </span>with<span class="_ _6"> </span>multiple<span class="_ _13"> </span>operands<span class="_ _13"> </span>list<span class="_ _6"> </span>them<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_ _6"> </span>reverse<span class="_ _13"> </span>order.<span class="_ _6"> </span>This<span class="_ _6"> </span>can<span class="_ _13"> </span>be<span class="_ _13"> </span>very<span class="_ _6"> </span>confusing<span class="_ _13"> </span>when</div><div class="t m5 x35 h2b y2167 ff7 fs1e fc2 sc0 ls0 ws0">switching<span class="_"> </span>between<span class="_"> </span>the<span class="_"> </span>two<span class="_"> </span>formats<span class="_ _1"></span>.</div><div class="t m5 x34 h2b y2168 ff7 fs1e fc2 sc0 ls0 ws0">Although<span class="_ _13"> </span>we<span class="_ _13"> </span>will<span class="_"> </span>not<span class="_ _13"> </span>be<span class="_ _13"> </span>using<span class="_ _13"> </span>Intel<span class="_ _13"> </span>format<span class="_ _13"> </span>in<span class="_ _13"> </span>our<span class="_"> </span>presentation,<span class="_ _13"> </span>you<span class="_ _13"> </span>will<span class="_ _13"> </span>encounter<span class="_ _13"> </span>it<span class="_ _13"> </span>in<span class="_"> </span>documentation</div><div class="t m5 x34 h2b y2169 ff7 fs1e fc2 sc0 ls0 ws0">from<span class="_"> </span>Intel<span class="_"> </span>and<span class="_"> </span>Microsoft.</div><div class="t m5 x17 h26 y216a ff7 fs19 fc2 sc0 ls0 ws0">second<span class="_ _14"> </span>is<span class="_ _15"> </span>to<span class="_ _15"> </span>use<span class="_ _15"> </span><span class="ff9">gcc</span>’s<span class="_ _14"> </span>support<span class="_ _15"> </span>for<span class="_ _15"> </span>embedding<span class="_ _14"> </span>assembly<span class="_ _15"> </span>code<span class="_ _15"> </span>directly<span class="_ _15"> </span>within<span class="_ _14"> </span>C</div><div class="t m5 x17 h26 y216b ff7 fs19 fc2 sc0 ls0 ws0">programs<span class="_ _1"></span>.</div><div class="t m5 x17 h3b y216c fff fs24 fc6 sc0 ls0 ws0">3.3<span class="_ _17"> </span><span class="ffe fs18">Data<span class="_"> </span>Formats</span></div><div class="t m5 x17 h26 y561 ff7 fs19 fc1 sc0 ls0 ws0">Due<span class="_ _16"> </span>to<span class="_ _16"> </span>its<span class="_ _16"> </span>origins<span class="_ _16"> </span>as<span class="_ _16"> </span>a<span class="_ _16"> </span>16-bit<span class="_ _16"> </span>architecture<span class="_ _16"> </span>that<span class="_ _16"> </span>expanded<span class="_ _16"> </span>into<span class="_ _16"> </span>a<span class="_ _16"> </span>32-bit<span class="_ _16"> </span>one<span class="_ _1"></span>,<span class="_ _16"> </span>Intel</div><div class="t m5 x17 h26 y562 ff7 fs19 fc1 sc0 ls0 ws0">uses<span class="_ _13"> </span>the<span class="_"> </span>term<span class="_ _13"> </span>“word”<span class="_ _13"> </span>to<span class="_"> </span>refer<span class="_ _13"> </span>to<span class="_ _13"> </span>a<span class="_ _13"> </span>16-bit<span class="_"> </span>data<span class="_ _13"> </span>type<span class="_ _1"></span>.<span class="_"> </span>Based<span class="_ _13"> </span>on<span class="_ _13"> </span>this<span class="_ _1"></span>,<span class="_"> </span>they<span class="_ _13"> </span>refer<span class="_ _13"> </span>to<span class="_"> </span>32-</div><div class="t m5 x17 h26 y563 ff7 fs19 fc1 sc0 ls0 ws0">bit<span class="_ _13"> </span>quantities<span class="_ _13"> </span>as<span class="_ _13"> </span>“double<span class="_ _13"> </span>words<span class="_ _1"></span>,<span class="_ _0"></span>”<span class="_ _13"> </span>and<span class="_ _13"> </span>64-bit<span class="_ _13"> </span>quantities<span class="_"> </span>as<span class="_ _13"> </span>“quad<span class="_ _13"> </span>words<span class="_ _3"></span>.<span class="_ _1"></span>”<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_ _13"> </span>3.1</div><div class="t m5 x17 h26 y564 ff7 fs19 fc1 sc0 ls0 ws0">shows<span class="_ _13"> </span>the<span class="_"> </span>x86-64<span class="_ _13"> </span>representations<span class="_"> </span>used<span class="_ _13"> </span>for<span class="_"> </span>the<span class="_ _13"> </span>primitive<span class="_"> </span>data<span class="_ _13"> </span>types<span class="_"> </span>of<span class="_ _13"> </span>C.<span class="_ _13"> </span>Standard</div><div class="t m5 x17 h26 y565 ffd fs19 fc1 sc0 ls0 ws0">int<span class="_ _10"> </span><span class="ff7">values<span class="_ _11"> </span>are<span class="_"> </span>stored<span class="_ _11"> </span>as<span class="_"> </span>double<span class="_ _11"> </span>words<span class="_"> </span>(32<span class="_ _11"> </span>bits).<span class="_"> </span>P<span class="_ _0"></span>ointers<span class="_"> </span>(shown<span class="_"> </span>here<span class="_ _11"> </span>as<span class="_ _11"> </span><span class="ffd">char<span class="_ _11"> </span>*</span>)</span></div><div class="t m5 x17 h26 y566 ff7 fs19 fc1 sc0 ls0 ws0">are<span class="_"> </span>stored<span class="_ _11"> </span>as<span class="_ _11"> </span>8-byte<span class="_"> </span>quad<span class="_ _11"> </span>words<span class="_ _1"></span>,<span class="_ _11"> </span>as<span class="_ _11"> </span>would<span class="_"> </span>be<span class="_ _11"> </span>expected<span class="_ _11"> </span>in<span class="_"> </span>a<span class="_ _11"> </span>64-bit<span class="_ _11"> </span>machine<span class="_ _1"></span>.<span class="_ _11"> </span>With</div><div class="t m5 x17 h26 y567 ff7 fs19 fc1 sc0 ls0 ws0">x86-64,<span class="_ _14"> </span>data<span class="_ _16"> </span>type<span class="_ _16"> </span><span class="ffd">long<span class="_ _16"> </span></span>is<span class="_ _14"> </span>implemented<span class="_ _16"> </span>with<span class="_ _16"> </span>64<span class="_ _14"> </span>bits<span class="_ _1"></span>,<span class="_ _14"> </span>allowing<span class="_ _16"> </span>a<span class="_ _16"> </span>very<span class="_ _14"> </span>wide<span class="_ _16"> </span>range</div><div class="t m5 x17 h26 y216d ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_ _11"> </span>values<span class="_ _1"></span>.<span class="_ _11"> </span>Most<span class="_ _16"> </span>of<span class="_ _11"> </span>our<span class="_ _11"> </span>code<span class="_ _11"> </span>examples<span class="_ _16"> </span>in<span class="_ _11"> </span>this<span class="_ _11"> </span>chapter<span class="_ _11"> </span>use<span class="_ _16"> </span>pointers<span class="_ _11"> </span>and<span class="_ _11"> </span><span class="ffd">long<span class="_ _11"> </span></span>data</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
