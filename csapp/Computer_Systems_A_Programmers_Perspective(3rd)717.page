<div id="pf2cd" class="pf w2 h11" data-page-no="2cd"><div class="pc pc2cd w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg2cd.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">716<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>7<span class="_ _3d"> </span>Linking</span></div><div class="t m5 x28 h2a y257 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">Mangling<span class="_ _11"> </span>of<span class="_ _11"> </span>linker<span class="_ _11"> </span>symbols<span class="_ _16"> </span>in<span class="_ _11"> </span>C++<span class="_ _11"> </span>and<span class="_ _11"> </span>Java</span></div><div class="t m5 x28 h2b y2d0 ff7 fs1e fc2 sc0 ls0 ws0">Both<span class="_ _13"> </span>C++<span class="_ _6"> </span>and<span class="_ _13"> </span>J<span class="_ _3"></span>ava<span class="_ _6"> </span>allow<span class="_ _13"> </span>overloaded<span class="_ _6"> </span>methods<span class="_ _13"> </span>that<span class="_ _13"> </span>have<span class="_ _6"> </span>the<span class="_ _13"> </span>same<span class="_ _6"> </span>name<span class="_ _13"> </span>in<span class="_ _6"> </span>the<span class="_ _13"> </span>source<span class="_ _6"> </span>code<span class="_ _13"> </span>but<span class="_ _6"> </span>different</div><div class="t m5 x28 h2b y2d1 ff7 fs1e fc2 sc0 ls0 ws0">parameter<span class="_ _6"> </span>lists<span class="_ _1"></span>.<span class="_ _6"> </span>So<span class="_ _6"> </span>how<span class="_ _6"> </span>does<span class="_ _6"> </span>the<span class="_ _6"> </span>linker<span class="_ _6"> </span>tell<span class="_ _6"> </span>the<span class="_ _13"> </span>difference<span class="_ _a"> </span>between<span class="_ _6"> </span>these<span class="_ _6"> </span>different<span class="_ _6"> </span>overloaded<span class="_ _6"> </span>functions?</div><div class="t m5 x28 h2b y2d2 ff7 fs1e fc2 sc0 ls0 ws0">Overloaded<span class="_ _11"> </span>functions<span class="_ _11"> </span>in<span class="_ _11"> </span>C++<span class="_ _10"> </span>and<span class="_ _11"> </span>J<span class="_ _1"></span>ava<span class="_ _11"> </span>work<span class="_ _11"> </span>because<span class="_ _11"> </span>the<span class="_ _11"> </span>compiler<span class="_ _11"> </span>encodes<span class="_ _11"> </span>each<span class="_ _11"> </span>unique<span class="_ _11"> </span>method<span class="_ _10"> </span>and</div><div class="t m5 x28 h2b y2d3 ff7 fs1e fc2 sc0 ls0 ws0">parameter<span class="_ _13"> </span>list<span class="_ _13"> </span>combination<span class="_ _6"> </span>into<span class="_ _13"> </span>a<span class="_ _13"> </span>unique<span class="_ _13"> </span>name<span class="_ _6"> </span>for<span class="_ _13"> </span>the<span class="_ _13"> </span>linker<span class="_ _0"></span>.<span class="_ _13"> </span>T<span class="_ _1"></span>his<span class="_ _13"> </span>encoding<span class="_ _13"> </span>process<span class="_ _6"> </span>is<span class="_"> </span>called<span class="_ _6"> </span><span class="ffa">mangling<span class="_ _2"></span></span>,</div><div class="t m5 x28 h2b y2d4 ff7 fs1e fc2 sc0 ls0 ws0">and<span class="_"> </span>the<span class="_"> </span>inverse<span class="_"> </span>process<span class="_"> </span>is<span class="_"> </span>known<span class="_"> </span>as<span class="_"> </span><span class="ffa">demangling<span class="_ _2"></span></span>.</div><div class="t m5 x57 h2b y2d5 ff7 fs1e fc2 sc0 ls0 ws0">Happily<span class="_ _3"></span>,<span class="_ _11"> </span>C++<span class="_ _11"> </span>and<span class="_ _16"> </span>J<span class="_ _3"></span>ava<span class="_ _11"> </span>use<span class="_ _11"> </span>compatible<span class="_ _16"> </span>mangling<span class="_ _11"> </span>schemes<span class="_ _1"></span>.<span class="_ _11"> </span>A<span class="_ _11"> </span>mangled<span class="_ _11"> </span>class<span class="_ _16"> </span>name<span class="_ _11"> </span>consists<span class="_ _11"> </span>of<span class="_ _11"> </span>the</div><div class="t m5 x28 h2b y2d6 ff7 fs1e fc2 sc0 ls0 ws0">integer<span class="_ _11"> </span>number<span class="_ _16"> </span>of<span class="_ _11"> </span>characters<span class="_ _11"> </span>in<span class="_ _16"> </span>the<span class="_ _11"> </span>name<span class="_ _11"> </span>followed<span class="_ _16"> </span>by<span class="_ _11"> </span>the<span class="_ _11"> </span>original<span class="_ _16"> </span>name<span class="_ _1"></span>.<span class="_ _16"> </span>F<span class="_ _3"></span>or<span class="_ _16"> </span>example<span class="_ _1"></span>,<span class="_ _16"> </span>the<span class="_ _11"> </span>class<span class="_ _16"> </span><span class="ffd">Foo</span></div><div class="t m5 x28 h2b y549 ff7 fs1e fc2 sc0 ls0 ws0">is<span class="_ _14"> </span>encoded<span class="_ _15"> </span>as<span class="_ _15"> </span><span class="ffd">3Foo</span>.<span class="_ _15"> </span>A<span class="_ _14"> </span>method<span class="_ _15"> </span>is<span class="_ _15"> </span>encoded<span class="_ _15"> </span>as<span class="_ _14"> </span>the<span class="_ _15"> </span>original<span class="_ _15"> </span>method<span class="_ _15"> </span>name<span class="_ _1"></span>,<span class="_ _21"> </span>followed<span class="_ _15"> </span>by<span class="_ _15"> </span><span class="ffd">__</span>,<span class="_ _21"> </span>followed</div><div class="t m5 x28 h2b y54a ff7 fs1e fc2 sc0 ls0 ws0">by<span class="_ _f"> </span>the<span class="_ _f"> </span>mangled<span class="_ _f"> </span>class<span class="_ _f"> </span>name<span class="_ _0"></span>,<span class="_ _e"> </span>followed<span class="_ _21"> </span>by<span class="_ _f"> </span>single<span class="_ _f"> </span>letter<span class="_ _f"> </span>encodings<span class="_ _f"> </span>of<span class="_ _f"> </span>each<span class="_ _f"> </span>argument.<span class="_ _f"> </span>F<span class="_ _0"></span>or<span class="_ _f"> </span>example<span class="_ _1"></span>,</div><div class="t m5 x28 h2b y54b ffd fs1e fc2 sc0 ls0 ws0">Foo::bar(int,<span class="_ _11"> </span>long)<span class="_ _13"> </span><span class="ff7">is<span class="_ _13"> </span>encoded<span class="_ _13"> </span>as<span class="_ _13"> </span></span>bar__3Fooil<span class="ff7">.<span class="_ _13"> </span>Similar<span class="_ _6"> </span>schemes<span class="_"> </span>are<span class="_ _6"> </span>used<span class="_"> </span>to<span class="_ _6"> </span>mangle<span class="_"> </span>global<span class="_ _6"> </span>variable</span></div><div class="t m5 x28 h2b y54c ff7 fs1e fc2 sc0 ls0 ws0">and<span class="_"> </span>template<span class="_"> </span>names<span class="_ _1"></span>.</div><div class="t m5 x1d h41 y5f1f ffe fs29 fc2 sc0 ls0 ws0">7.6.1<span class="_ _48"> </span><span class="fs19">How<span class="_"> </span>Linkers<span class="_"> </span>Resolve<span class="_"> </span>Duplicate<span class="_"> </span>Symbol<span class="_"> </span>Names</span></div><div class="t m5 x1d h26 y5f20 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>input<span class="_ _13"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>linker<span class="_"> </span>is<span class="_ _13"> </span>a<span class="_ _13"> </span>collection<span class="_ _13"> </span>of<span class="_"> </span>relocatable<span class="_ _13"> </span>object<span class="_ _13"> </span>modules<span class="_ _1"></span>.<span class="_ _13"> </span>Each<span class="_"> </span>of<span class="_ _13"> </span>these</div><div class="t m5 x1d h26 y5f21 ff7 fs19 fc2 sc0 ls0 ws0">modules<span class="_ _15"> </span>deﬁnes<span class="_ _15"> </span>a<span class="_ _15"> </span>set<span class="_ _15"> </span>of<span class="_ _15"> </span>symbols<span class="_ _1"></span>,<span class="_ _21"> </span>some<span class="_ _15"> </span>of<span class="_ _15"> </span>which<span class="_ _15"> </span>are<span class="_ _15"> </span>local<span class="_ _15"> </span>(visible<span class="_ _15"> </span>only<span class="_ _15"> </span>to<span class="_ _15"> </span>the</div><div class="t m5 x1d h26 y5f22 ff7 fs19 fc2 sc0 ls0 ws0">module<span class="_"> </span>that<span class="_"> </span>deﬁnes<span class="_ _11"> </span>it),<span class="_"> </span>and<span class="_ _11"> </span>some<span class="_"> </span>of<span class="_ _11"> </span>which<span class="_"> </span>are<span class="_"> </span>global<span class="_ _11"> </span>(visible<span class="_"> </span>to<span class="_ _11"> </span>other<span class="_"> </span>modules).</div><div class="t m5 x1d h26 y5f23 ff7 fs19 fc2 sc0 ls0 ws0">What<span class="_ _16"> </span>happens<span class="_ _16"> </span>if<span class="_ _14"> </span>multiple<span class="_ _14"> </span>modules<span class="_ _14"> </span>deﬁne<span class="_ _16"> </span>global<span class="_ _14"> </span>symbols<span class="_ _14"> </span>with<span class="_ _16"> </span>the<span class="_ _14"> </span>same<span class="_ _14"> </span>name?</div><div class="t m5 x1d h26 y5f24 ff7 fs19 fc2 sc0 ls0 ws0">Here<span class="_"> </span>is<span class="_"> </span>the<span class="_"> </span>approach<span class="_"> </span>that<span class="_"> </span>Linux<span class="_"> </span>compilation<span class="_"> </span>systems<span class="_"> </span>use<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y5f25 ff7 fs19 fc2 sc0 ls0 ws0">At<span class="_ _16"> </span>compile<span class="_ _11"> </span>time,<span class="_ _16"> </span>the<span class="_ _11"> </span>compiler<span class="_ _16"> </span>exports<span class="_ _16"> </span>each<span class="_ _16"> </span>global<span class="_ _16"> </span>symbol<span class="_ _11"> </span>to<span class="_ _16"> </span>the<span class="_ _16"> </span>assembler</div><div class="t m5 x1d h26 y5f26 ff7 fs19 fc2 sc0 ls0 ws0">as<span class="_ _16"> </span>either<span class="_ _16"> </span><span class="ffa">strong<span class="_ _15"> </span></span>or<span class="_ _16"> </span><span class="ffa">weak<span class="_ _2"></span></span>,<span class="_ _14"> </span>and<span class="_ _16"> </span>the<span class="_ _16"> </span>assembler<span class="_ _14"> </span>encodes<span class="_ _16"> </span>this<span class="_ _16"> </span>information<span class="_ _14"> </span>implicitly</div><div class="t m5 x1d h26 y5f27 ff7 fs19 fc2 sc0 ls0 ws0">in<span class="_"> </span>the<span class="_"> </span>symbol<span class="_ _11"> </span>table<span class="_"> </span>of<span class="_ _11"> </span>the<span class="_"> </span>relocatable<span class="_"> </span>object<span class="_ _11"> </span>ﬁle<span class="_ _0"></span>.<span class="_"> </span>Functions<span class="_"> </span>and<span class="_ _11"> </span>initialized<span class="_"> </span>global</div><div class="t m5 x1d h26 y5f28 ff7 fs19 fc2 sc0 ls0 ws0">variables<span class="_"> </span>get<span class="_"> </span>strong<span class="_"> </span>symbols<span class="_ _1"></span>.<span class="_"> </span>Uninitialized<span class="_"> </span>global<span class="_"> </span>variables<span class="_"> </span>get<span class="_"> </span>weak<span class="_"> </span>symbols<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y5f29 ff7 fs19 fc2 sc0 ls0 ws0">Given<span class="_ _13"> </span>this<span class="_ _13"> </span>notion<span class="_ _13"> </span>of<span class="_ _13"> </span>strong<span class="_ _6"> </span>and<span class="_ _13"> </span>weak<span class="_ _13"> </span>symbols<span class="_ _1"></span>,<span class="_ _13"> </span>Linux<span class="_ _13"> </span>linkers<span class="_ _13"> </span>use<span class="_ _13"> </span>the<span class="_ _13"> </span>following</div><div class="t m5 x1d h26 y5f2a ff7 fs19 fc2 sc0 ls0 ws0">rules<span class="_"> </span>for<span class="_"> </span>dealing<span class="_"> </span>with<span class="_"> </span>duplicate<span class="_"> </span>symbol<span class="_"> </span>names:</div><div class="t m5 x75 h26 y5f2b ff7 fs19 fc2 sc0 ls0 ws0">Rule<span class="_"> </span>1.<span class="_ _e"> </span>Multiple<span class="_"> </span>strong<span class="_"> </span>symbols<span class="_"> </span>with<span class="_"> </span>the<span class="_"> </span>same<span class="_"> </span>name<span class="_"> </span>are<span class="_"> </span>not<span class="_"> </span>allowed.</div><div class="t m5 x75 h26 y5f2c ff7 fs19 fc2 sc0 ls0 ws0">Rule<span class="_ _13"> </span>2.<span class="_ _e"> </span>Given<span class="_ _13"> </span>a<span class="_ _13"> </span>strong<span class="_ _13"> </span>symbol<span class="_ _13"> </span>and<span class="_ _13"> </span>multiple<span class="_ _13"> </span>weak<span class="_ _13"> </span>symbols<span class="_ _6"> </span>with<span class="_ _13"> </span>the<span class="_ _13"> </span>same<span class="_ _13"> </span>name<span class="_ _1"></span>,</div><div class="t m5 xcd h26 y5f2d ff7 fs19 fc2 sc0 ls0 ws0">choose<span class="_"> </span>the<span class="_"> </span>strong<span class="_"> </span>symbol.</div><div class="t m5 x75 h26 y5f2e ff7 fs19 fc2 sc0 ls0 ws0">Rule<span class="_ _11"> </span>3.<span class="_ _1f"> </span>Given<span class="_ _11"> </span>multiple<span class="_ _11"> </span>weak<span class="_ _11"> </span>symbols<span class="_ _16"> </span>with<span class="_ _11"> </span>the<span class="_ _11"> </span>same<span class="_ _11"> </span>name,<span class="_ _11"> </span>choose<span class="_ _11"> </span>any<span class="_ _11"> </span>of<span class="_ _16"> </span>the</div><div class="t m5 xcd h26 y5f2f ff7 fs19 fc2 sc0 ls0 ws0">weak<span class="_"> </span>symbols<span class="_ _1"></span>.</div><div class="t m5 x1d h26 y5f30 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _6"> </span>example<span class="_ _0"></span>,<span class="_ _6"> </span>suppose<span class="_ _6"> </span>we<span class="_ _6"> </span>attempt<span class="_ _6"> </span>to<span class="_ _6"> </span>compile<span class="_ _6"> </span>and<span class="_ _6"> </span>link<span class="_ _13"> </span>the<span class="_ _a"> </span>following<span class="_ _6"> </span>two<span class="_ _6"> </span>C<span class="_ _6"> </span>modules:</div><div class="t m5 x1f h2d y5f31 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">/*<span class="_ _1f"> </span>foo1.c<span class="_ _e"> </span>*/</span></div><div class="t m5 x1f h2d y5f32 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">int<span class="_ _1f"> </span>main()</span></div><div class="t m5 x1f h2d y5f33 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x1f h2e y5f34 ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 x33 h2d y5f35 ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>0;</div><div class="t m5 x1f h2d y5f36 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1f h2d y832 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">/*<span class="_ _1f"> </span>bar1.c<span class="_ _e"> </span>*/</span></div><div class="t m5 x1f h2d y8d6 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">int<span class="_ _1f"> </span>main()</span></div><div class="t m5 x1f h2d y77e ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x1f h2d ye95 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>0;</span></div><div class="t m5 x1f h2d y177d ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
