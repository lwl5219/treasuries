<div id="pf106" class="pf w2 h11" data-page-no="106"><div class="pc pc106 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg106.png"/><div class="t m5 x1dc h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>3.6<span class="_ _60"> </span>Control<span class="_ _3e"> </span><span class="ffe fs1e">261</span></div><div class="t m5 x1b6 h2d y140c ffd fs1e fc2 sc0 ls0 ws0">short<span class="_ _e"> </span>result<span class="_ _1f"> </span>=</div><div class="t m5 xd h2d ye7 ffd fs1e fc2 sc0 ls0 ws0">;</div><div class="t m5 x1b6 h2d y2682 ffd fs1e fc2 sc0 ls0 ws0">while<span class="_ _e"> </span>(</div><div class="t m5 x21f h2d yc4d ffd fs1e fc2 sc0 ls33 ws0">){</div><div class="t m5 x21e h2d y2720 ffd fs1e fc2 sc0 ls0 ws0">result<span class="_ _e"> </span>=</div><div class="t m5 x76 h2d yecb ffd fs1e fc2 sc0 ls0 ws0">;</div><div class="t m5 x21e h2d y2145 ffd fs1e fc2 sc0 ls33 ws0">a=</div><div class="t m5 x154 h2d yecc ffd fs1e fc2 sc0 ls0 ws0">;</div><div class="t m5 x1b6 h2d y23be ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x1b6 h2d y2721 ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>result;</div><div class="t m5 x17 h2d y2722 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x17 h26 y2723 ff9 fs19 fc2 sc0 ls0 ws0">gcc<span class="ff7">,<span class="_"> </span>run<span class="_"> </span>with<span class="_"> </span>command-line<span class="_"> </span>option<span class="_"> </span><span class="ffd">-Og</span>,<span class="_"> </span>produces<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>code:</span></div><div class="t m5 x2e h61 y2724 ff13 fs35 fc6 sc0 ls0 ws0">short<span class="_ _f"> </span>loop_while(short<span class="_ _f"> </span>a,<span class="_ _f"> </span>short<span class="_ _e"> </span>b)</div><div class="t m5 x2e h61 y2725 ff13 fs35 fc6 sc0 ls0 ws0">a<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi,<span class="_ _f"> </span>b<span class="_ _e"> </span>in<span class="_ _21"> </span>%rsi</div><div class="t m5 x2c h2d y2726 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">loop_while:</span></div><div class="t m5 x2c h2d y2727 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">movl<span class="_ _46"> </span>$0,<span class="_ _e"> </span>%eax</span></div><div class="t m5 x2c h2d y2728 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">jmp<span class="_ _8c"> </span>.L2</span></div><div class="t m5 x2c h2e y2729 ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 x2d h2d y272a ffd fs1e fc2 sc0 ls0 ws0">.L3:</div><div class="t m5 x2c h2d y272b ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">leaq<span class="_ _46"> </span>(,%rsi,%rdi),<span class="_ _e"> </span>%rdx</span></div><div class="t m5 x2c h2d y272c ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">addq<span class="_ _46"> </span>%rdx,<span class="_ _e"> </span>%rax</span></div><div class="t m5 x2c h2d y272d ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">subq<span class="_ _46"> </span>$1,<span class="_ _e"> </span>%rdi</span></div><div class="t m5 x2c h2d y272e ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L2:</span></div><div class="t m5 x2c h2d y272f ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _45"> </span><span class="ffd fs1e fc2">cmpq<span class="_ _46"> </span>%rsi,<span class="_ _e"> </span>%rdi</span></div><div class="t m5 x17 h2d y2730 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _45"> </span><span class="ffd fs1e fc2">jg<span class="_ _5a"> </span>.L3</span></div><div class="t m5 x17 h2d y2731 ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _45"> </span><span class="ffd fs1e fc2">rep;<span class="_ _e"> </span>ret</span></div><div class="t m5 x17 h26 y2732 ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _14"> </span>can<span class="_ _14"> </span>see<span class="_ _14"> </span>that<span class="_ _16"> </span>the<span class="_ _14"> </span>compiler<span class="_ _14"> </span>used<span class="_ _14"> </span>a<span class="_ _14"> </span>jump-to-middle<span class="_ _14"> </span>translation,<span class="_ _14"> </span>using<span class="_ _14"> </span>the<span class="_ _14"> </span><span class="ffd">jmp</span></div><div class="t m5 x17 h26 y2733 ff7 fs19 fc2 sc0 ls0 ws0">instruction<span class="_"> </span>on<span class="_"> </span>line<span class="_"> </span>3<span class="_"> </span>to<span class="_"> </span>jump<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>test<span class="_"> </span>starting<span class="_"> </span>with<span class="_"> </span>label<span class="_"> </span><span class="ffd">.L2</span>.<span class="_"> </span>F<span class="_ _1"></span>ill<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>missing</div><div class="t m5 x17 h26 y2734 ff7 fs19 fc2 sc0 ls0 ws0">parts<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>C<span class="_"> </span>code<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y2735 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _11"> </span>second<span class="_ _16"> </span>translation<span class="_"> </span>method,<span class="_ _16"> </span>which<span class="_ _11"> </span>we<span class="_ _11"> </span>refer<span class="_ _11"> </span>to<span class="_ _11"> </span>as<span class="_ _16"> </span><span class="ffa">guar<span class="_ _0"></span>ded<span class="_ _11"> </span>do<span class="ff7">,<span class="_ _11"> </span>Ô¨Årst<span class="_ _11"> </span>trans-</span></span></div><div class="t m5 x17 h26 y2736 ff7 fs19 fc1 sc0 ls0 ws0">forms<span class="_ _13"> </span>the<span class="_ _13"> </span>code<span class="_ _13"> </span>into<span class="_ _13"> </span>a<span class="_ _13"> </span><span class="ffd">do</span>-<span class="ffd">while<span class="_ _13"> </span></span>loop<span class="_ _13"> </span>by<span class="_ _6"> </span>using<span class="_ _13"> </span>a<span class="_ _13"> </span>conditional<span class="_ _13"> </span>branch<span class="_ _13"> </span>to<span class="_ _13"> </span>skip<span class="_ _13"> </span>over<span class="_ _13"> </span>the</div><div class="t m5 x17 h26 y2737 ff7 fs19 fc1 sc0 ls0 ws0">loop<span class="_ _11"> </span>if<span class="_ _11"> </span>the<span class="_ _11"> </span>initial<span class="_ _11"> </span>test<span class="_ _11"> </span>fails<span class="_ _1"></span>.<span class="_ _11"> </span><span class="ff9">Gcc<span class="_ _11"> </span></span>follows<span class="_ _11"> </span>this<span class="_ _11"> </span>strategy<span class="_ _11"> </span>when<span class="_ _11"> </span>compiling<span class="_ _11"> </span>with<span class="_ _11"> </span>higher</div><div class="t m5 x17 h26 y2738 ff7 fs19 fc1 sc0 ls0 ws0">levels<span class="_"> </span>of<span class="_"> </span>optimization,<span class="_ _11"> </span>for<span class="_"> </span>example,<span class="_"> </span>with<span class="_"> </span>command-line<span class="_"> </span>option<span class="_"> </span><span class="ffd">-O1</span>.<span class="_ _11"> </span>T<span class="_ _1"></span>his<span class="_ _11"> </span>method</div><div class="t m5 x17 h26 y2739 ff7 fs19 fc1 sc0 ls0 ws0">can<span class="_ _13"> </span>be<span class="_ _13"> </span>expressed<span class="_ _13"> </span>by<span class="_ _13"> </span>the<span class="_ _13"> </span>following<span class="_ _13"> </span>template<span class="_ _13"> </span>for<span class="_ _13"> </span>translating<span class="_ _13"> </span>from<span class="_ _13"> </span>the<span class="_ _13"> </span>general<span class="_ _13"> </span><span class="ffd">while</span></div><div class="t m5 x17 h26 y273a ff7 fs19 fc1 sc0 ls0 ws0">loop<span class="_"> </span>form<span class="_"> </span>to<span class="_"> </span>a<span class="_"> </span><span class="ffd">do</span>-<span class="ffd">while<span class="_ _10"> </span></span>loop:</div><div class="t m5 x17 h53 y273b ffd fs1e fc2 sc0 ls33 ws0">t=<span class="ffa ls0">test-expr<span class="_ _2"></span><span class="ffd">;</span></span></div><div class="t m5 x17 h2d y273c ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>(!t)</div><div class="t m5 x1b6 h2d y273d ffd fs1e fc2 sc0 ls0 ws0">goto<span class="_ _e"> </span>done;</div><div class="t m5 x17 h2d y273e ffd fs1e fc2 sc0 ls0 ws0">do</div><div class="t m5 x1b6 h53 y273f ffa fs1e fc2 sc0 ls0 ws0">body-statement</div><div class="t m5 x1b6 h53 y2740 ffd fs1e fc2 sc0 ls0 ws0">while<span class="_ _e"> </span>(<span class="ffa">test-expr<span class="_ _2"></span></span>);</div><div class="t m5 x17 h2d y2741 ffd fs1e fc2 sc0 ls0 ws0">done:</div><div class="t m5 x17 h26 y2742 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _1"></span>,<span class="_"> </span>in<span class="_"> </span>turn,<span class="_"> </span>can<span class="_"> </span>be<span class="_"> </span>transformed<span class="_"> </span>into<span class="_"> </span>goto<span class="_"> </span>code<span class="_"> </span>as</div><div class="t m5 x1b6 h53 y15bf ffd fs1e fc2 sc0 ls33 ws0">t=<span class="ffa ls0">test-expr<span class="_ _2"></span><span class="ffd">;</span></span></div><div class="t m5 x1b6 h2d y2743 ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>(!t)</div><div class="t m5 x21e h2d y2744 ffd fs1e fc2 sc0 ls0 ws0">goto<span class="_ _e"> </span>done;</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
