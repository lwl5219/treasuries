<div id="pf24c" class="pf w2 h11" data-page-no="24c"><div class="pc pc24c w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg24c.png"/><div class="t m5 x94 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>5.11<span class="_ _60"> </span>Some<span class="_ _10"> </span>Limiting<span class="_ _10"> </span>Factors<span class="_ _3e"> </span><span class="ffe fs1e">587</span></div><div class="t m5 x17 h26 ye7 ffd fs19 fc2 sc0 ls0 ws0">combine4b<span class="ff7">.<span class="_ _16"> </span>T<span class="_ _1"></span>his<span class="_ _16"> </span>code<span class="_ _11"> </span>performs<span class="_ _16"> </span>bounds<span class="_ _16"> </span>checking<span class="_ _11"> </span>and<span class="_ _16"> </span>also<span class="_ _16"> </span>references<span class="_ _11"> </span>the<span class="_ _16"> </span>vector</span></div><div class="t m5 x17 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">elements<span class="_"> </span>through<span class="_"> </span>the<span class="_"> </span>vector<span class="_"> </span>data<span class="_"> </span>structure<span class="_ _1"></span>.</div><div class="t m5 x2c h2d y4f2d ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">/*<span class="_ _1f"> </span>Include<span class="_ _e"> </span>bounds<span class="_ _1f"> </span>check<span class="_ _1f"> </span>in<span class="_ _e"> </span>loop<span class="_ _1f"> </span>*/</span></div><div class="t m5 x2c h2d y4f2e ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">void<span class="_ _1f"> </span>combine4b(vec_ptr<span class="_ _e"> </span>v,<span class="_ _1f"> </span>data_t<span class="_ _1f"> </span>*dest)</span></div><div class="t m5 x2c h2d y4f2f ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x2c h2d y4f30 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>i;</span></div><div class="t m5 x2c h2d y4f31 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _20"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>length<span class="_ _1f"> </span>=<span class="_ _1f"> </span>vec_length(v);</span></div><div class="t m5 x2c h2d y4f32 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _20"> </span><span class="ffd fs1e fc2">data_t<span class="_ _e"> </span>acc<span class="_ _1f"> </span>=<span class="_ _1f"> </span>IDENT;</span></div><div class="t m5 x2c h2e y4f33 ff6 fs20 fc6 sc0 ls0 ws0">7</div><div class="t m5 x2c h2e y4f34 ff6 fs20 fc6 sc0 ls0 ws0">8</div><div class="t m5 x142 h2d y4f35 ffd fs1e fc2 sc0 ls0 ws0">for<span class="_ _e"> </span>(i<span class="_ _1f"> </span>=<span class="_ _1f"> </span>0;<span class="_ _e"> </span>i<span class="_ _1f"> </span>&lt;<span class="_ _e"> </span>length;<span class="_ _1f"> </span>i++)<span class="_ _1f"> </span>{</div><div class="t m5 x2c h2d y4f36 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _70"> </span><span class="ffd fs1e fc2">if<span class="_ _e"> </span>(i<span class="_ _1f"> </span>&gt;=<span class="_ _1f"> </span>0<span class="_ _e"> </span>&amp;&amp;<span class="_ _1f"> </span>i<span class="_ _e"> </span>&lt;<span class="_ _1f"> </span>v-&gt;len)<span class="_ _1f"> </span>{</span></div><div class="t m5 x17 h2d y4f37 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _d1"> </span><span class="ffd fs1e fc2">acc<span class="_ _1f"> </span>=<span class="_ _e"> </span>acc<span class="_ _1f"> </span>OP<span class="_ _e"> </span>v-&gt;data[i];</span></div><div class="t m5 x17 h2d y4f38 ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _70"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x17 h2d y4f39 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x17 h2d y4f3a ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _20"> </span><span class="ffd fs1e fc2">*dest<span class="_ _e"> </span>=<span class="_ _1f"> </span>acc;</span></div><div class="t m5 x17 h2d y4f3b ff6 fs20 fc6 sc0 ls0 ws0">14<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x17 h26 y4f3c ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_"> </span>can<span class="_ _13"> </span>then<span class="_ _13"> </span>directly<span class="_ _13"> </span>compare<span class="_ _13"> </span>the<span class="_"> </span>CPE<span class="_ _13"> </span>for<span class="_ _13"> </span>the<span class="_ _13"> </span>functions<span class="_"> </span>with<span class="_ _13"> </span>and<span class="_ _13"> </span>without<span class="_ _13"> </span>bounds</div><div class="t m5 x17 h26 y4f3d ff7 fs19 fc2 sc0 ls0 ws0">checking:</div><div class="t m5 x179 h31 y4f3e ff7 fs21 fc2 sc0 ls0 ws0">Integer<span class="_ _ba"> </span>Floating<span class="_"> </span>point</div><div class="t m5 x17 h31 y4f3f ff7 fs21 fc2 sc0 ls0 ws0">Function<span class="_ _d3"> </span>Page<span class="_ _26"> </span>Method<span class="_ _175"> </span><span class="ffd fs1e ls20c">+*+*</span></div><div class="t m5 x17 h31 y4f40 ffd fs1e fc2 sc0 ls0 ws0">combine4<span class="_ _94"> </span><span class="ff7 fs21">551<span class="_ _73"> </span>No<span class="_"> </span>bounds<span class="_"> </span>checking<span class="_ _74"> </span>1.27<span class="_ _14a"> </span>3.01<span class="_ _14a"> </span>3.01<span class="_ _4f"> </span>5.01</span></div><div class="t m5 x17 h31 y4f41 ffd fs1e fc2 sc0 ls0 ws0">combine4b<span class="_ _73"> </span><span class="ff7 fs21">551<span class="_ _61"> </span>Bounds<span class="_"> </span>checking<span class="_ _7f"> </span>2.02<span class="_ _14a"> </span>3.01<span class="_ _4f"> </span>3.01<span class="_ _14a"> </span>5.01</span></div><div class="t m5 x17 h26 y4f42 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _13"> </span>version<span class="_ _a"> </span>with<span class="_ _13"> </span>bounds<span class="_ _6"> </span>checking<span class="_ _6"> </span>is<span class="_ _13"> </span>slightly<span class="_ _a"> </span>slower<span class="_ _13"> </span>for<span class="_ _a"> </span>the<span class="_ _13"> </span>case<span class="_ _6"> </span>of<span class="_ _6"> </span>integer<span class="_ _13"> </span>addition,</div><div class="t m5 x17 h26 y4f43 ff7 fs19 fc2 sc0 ls0 ws0">but<span class="_"> </span>it<span class="_"> </span>achieves<span class="_"> </span>the<span class="_"> </span>same<span class="_"> </span>performance<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>other<span class="_"> </span>three<span class="_"> </span>cases<span class="_ _3"></span>.<span class="_"> </span>T<span class="_ _0"></span>he<span class="_"> </span>performance</div><div class="t m5 x17 h26 y4f44 ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_"> </span>these<span class="_ _13"> </span>cases<span class="_"> </span>is<span class="_ _13"> </span>limited<span class="_"> </span>by<span class="_"> </span>the<span class="_ _13"> </span>latencies<span class="_"> </span>of<span class="_ _13"> </span>their<span class="_"> </span>respective<span class="_"> </span>combining<span class="_ _13"> </span>operations<span class="_ _1"></span>.</div><div class="t m5 x17 h26 y4f45 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>additional<span class="_"> </span>computation<span class="_"> </span>required<span class="_ _13"> </span>to<span class="_"> </span>perform<span class="_"> </span>bounds<span class="_"> </span>checking<span class="_"> </span>can<span class="_ _13"> </span>take<span class="_"> </span>place</div><div class="t m5 x17 h26 y4f46 ff7 fs19 fc2 sc0 ls0 ws0">in<span class="_ _14"> </span>parallel<span class="_ _15"> </span>with<span class="_ _14"> </span>the<span class="_ _15"> </span>combining<span class="_ _15"> </span>operations<span class="_ _1"></span>.<span class="_ _14"> </span>The<span class="_ _14"> </span>processor<span class="_ _14"> </span>is<span class="_ _15"> </span>able<span class="_ _15"> </span>to<span class="_ _14"> </span>predict<span class="_ _15"> </span>the</div><div class="t m5 x17 h26 y4f47 ff7 fs19 fc2 sc0 ls0 ws0">outcomes<span class="_ _16"> </span>of<span class="_ _16"> </span>these<span class="_ _14"> </span>branches<span class="_ _1"></span>,<span class="_ _14"> </span>and<span class="_ _16"> </span>so<span class="_ _14"> </span>none<span class="_ _16"> </span>of<span class="_ _14"> </span>this<span class="_ _16"> </span>evaluation<span class="_ _16"> </span>has<span class="_ _14"> </span>much<span class="_ _16"> </span>effect<span class="_ _14"> </span>on</div><div class="t m5 x17 h26 y4f48 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _16"> </span>fetching<span class="_ _16"> </span>and<span class="_ _16"> </span>processing<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>instructions<span class="_ _11"> </span>that<span class="_ _16"> </span>form<span class="_ _16"> </span>the<span class="_ _16"> </span>critical<span class="_ _16"> </span>path<span class="_ _16"> </span>in<span class="_ _16"> </span>the</div><div class="t m5 x17 h26 y4f49 ff7 fs19 fc2 sc0 ls0 ws0">program<span class="_"> </span>execution.</div><div class="t m5 x17 h42 y4f4a ff6 fs29 fc6 sc0 ls0 ws0">W<span class="_ _0"></span>rite<span class="_ _11"> </span>Code<span class="_ _16"> </span>Suitable<span class="_ _16"> </span>for<span class="_ _11"> </span>Implementation<span class="_ _16"> </span>with<span class="_ _16"> </span>Conditional<span class="_ _11"> </span>Moves</div><div class="t m5 x17 h26 yc40 ff7 fs19 fc1 sc0 ls0 ws0">Branch<span class="_ _16"> </span>prediction<span class="_ _16"> </span>is<span class="_ _11"> </span>only<span class="_ _16"> </span>reliable<span class="_ _16"> </span>for<span class="_ _16"> </span>regular<span class="_ _16"> </span>patterns<span class="_ _1"></span>.<span class="_ _16"> </span>Many<span class="_ _16"> </span>tests<span class="_ _11"> </span>in<span class="_ _16"> </span>a<span class="_ _16"> </span>program</div><div class="t m5 x17 h26 yc41 ff7 fs19 fc1 sc0 ls0 ws0">are<span class="_ _11"> </span>completely<span class="_ _16"> </span>unpredictable<span class="_ _1"></span>,<span class="_ _16"> </span>dependent<span class="_ _16"> </span>on<span class="_ _11"> </span>arbitrary<span class="_ _16"> </span>features<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>data,<span class="_ _11"> </span>such</div><div class="t m5 x17 h26 y4f4b ff7 fs19 fc1 sc0 ls0 ws0">as<span class="_ _13"> </span>whether<span class="_ _13"> </span>a<span class="_ _13"> </span>number<span class="_"> </span>is<span class="_ _13"> </span>negative<span class="_ _13"> </span>or<span class="_ _13"> </span>positive<span class="_ _1"></span>.<span class="_"> </span>F<span class="_ _3"></span>or<span class="_ _13"> </span>these,<span class="_ _13"> </span>the<span class="_ _13"> </span>branch<span class="_ _13"> </span>prediction<span class="_ _13"> </span>logic</div><div class="t m5 x17 h26 y4f4c ff7 fs19 fc1 sc0 ls0 ws0">will<span class="_ _13"> </span>do<span class="_ _13"> </span>very<span class="_"> </span>poorly<span class="_ _7"></span>.<span class="_ _13"> </span>F<span class="_ _1"></span>or<span class="_"> </span>inherently<span class="_ _13"> </span>unpredictable<span class="_ _13"> </span>cases<span class="_ _1"></span>,<span class="_ _13"> </span>program<span class="_"> </span>performance<span class="_ _13"> </span>can</div><div class="t m5 x17 h26 y4f4d ff7 fs19 fc1 sc0 ls0 ws0">be<span class="_ _14"> </span>greatly<span class="_ _15"> </span>enhanced<span class="_ _14"> </span>if<span class="_ _15"> </span>the<span class="_ _15"> </span>compiler<span class="_ _14"> </span>is<span class="_ _15"> </span>able<span class="_ _14"> </span>to<span class="_ _15"> </span>generate<span class="_ _14"> </span>code<span class="_ _15"> </span>using<span class="_ _15"> </span>conditional</div><div class="t m5 x17 h26 ye93 ff7 fs19 fc1 sc0 ls0 ws0">data<span class="_"> </span>transfers<span class="_ _13"> </span>rather<span class="_"> </span>than<span class="_ _13"> </span>conditional<span class="_"> </span>control<span class="_ _13"> </span>transfers<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _3"></span>his<span class="_"> </span>cannot<span class="_"> </span>be<span class="_ _13"> </span>controlled</div><div class="t m5 x17 h26 y2532 ff7 fs19 fc1 sc0 ls0 ws0">directly<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span>C<span class="_ _13"> </span>programmer,<span class="_"> </span>but<span class="_"> </span>some<span class="_"> </span>ways<span class="_"> </span>of<span class="_ _13"> </span>expressing<span class="_"> </span>conditional<span class="_"> </span>behavior</div><div class="t m5 x17 h26 y2533 ff7 fs19 fc1 sc0 ls0 ws0">can<span class="_"> </span>be<span class="_"> </span>more<span class="_"> </span>directly<span class="_"> </span>translated<span class="_"> </span>into<span class="_"> </span>conditional<span class="_"> </span>moves<span class="_"> </span>than<span class="_"> </span>others<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y2534 ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _13"> </span>have<span class="_ _13"> </span>found<span class="_ _6"> </span>that<span class="_ _13"> </span><span class="ff9">gcc<span class="_ _13"> </span></span>is<span class="_ _6"> </span>able<span class="_ _13"> </span>to<span class="_ _13"> </span>generate<span class="_ _6"> </span>conditional<span class="_ _13"> </span>moves<span class="_ _13"> </span>for<span class="_ _13"> </span>code<span class="_ _6"> </span>written</div><div class="t m5 x17 h26 y2535 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_ _14"> </span>a<span class="_ _15"> </span>more<span class="_ _15"> </span>“functional”<span class="_ _15"> </span>style<span class="_ _1"></span>,<span class="_ _21"> </span>where<span class="_ _15"> </span>we<span class="_ _15"> </span>use<span class="_ _15"> </span>conditional<span class="_ _15"> </span>operations<span class="_ _14"> </span>to<span class="_ _15"> </span>compute</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
