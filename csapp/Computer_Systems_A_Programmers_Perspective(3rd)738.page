<div id="pf2e2" class="pf w2 h11" data-page-no="2e2"><div class="pc pc2e2 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg2e2.png"/><div class="t m5 xb7 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>7.11<span class="_ _60"> </span>Loading<span class="_ _10"> </span>and<span class="_ _10"> </span>Linking<span class="_ _10"> </span>Shared<span class="_ _10"> </span>Libraries<span class="_ _10"> </span>from<span class="_ _10"> </span>Applications<span class="_ _3e"> </span><span class="ffe fs1e">737</span></div><div class="t m5 x17 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>inally<span class="_ _3"></span>,<span class="_ _11"> </span>the<span class="_ _11"> </span>dynamic<span class="_ _11"> </span>linker<span class="_ _11"> </span>passes<span class="_ _11"> </span>control<span class="_ _11"> </span>to<span class="_ _11"> </span>the<span class="_ _11"> </span>application.<span class="_ _11"> </span>From<span class="_"> </span>this<span class="_ _11"> </span>point<span class="_ _11"> </span>on,</div><div class="t m5 x17 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>locations<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_"> </span>shared<span class="_ _13"> </span>libraries<span class="_"> </span>are<span class="_ _13"> </span>ﬁxed<span class="_"> </span>and<span class="_"> </span>do<span class="_ _13"> </span>not<span class="_"> </span>change<span class="_"> </span>during<span class="_ _13"> </span>execution</div><div class="t m5 x17 h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_"> </span>the<span class="_"> </span>program.</div><div class="t m5 x17 h3b y617b fff fs24 fc6 sc0 ls0 ws0">7.11<span class="_ _17"> </span><span class="ffe fs18">Loading<span class="_ _16"> </span>and<span class="_ _10"> </span>Linking<span class="_ _16"> </span>Shared<span class="_ _10"> </span>Libraries<span class="_ _16"> </span>from<span class="_ _10"> </span>Applications</span></div><div class="t m5 x17 h26 y617c ff7 fs19 fc1 sc0 ls0 ws0">Up<span class="_ _13"> </span>to<span class="_ _13"> </span>this<span class="_ _13"> </span>point,<span class="_ _13"> </span>we<span class="_ _13"> </span>have<span class="_ _13"> </span>discussed<span class="_ _13"> </span>the<span class="_ _13"> </span>scenario<span class="_ _13"> </span>in<span class="_ _13"> </span>which<span class="_ _13"> </span>the<span class="_ _13"> </span>dynamic<span class="_ _13"> </span>linker<span class="_ _13"> </span>loads</div><div class="t m5 x17 h26 y617d ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _16"> </span>links<span class="_ _11"> </span>shared<span class="_ _16"> </span>libraries<span class="_ _16"> </span>when<span class="_ _16"> </span>an<span class="_ _11"> </span>application<span class="_ _16"> </span>is<span class="_ _16"> </span>loaded,<span class="_ _16"> </span>just<span class="_ _16"> </span>before<span class="_ _11"> </span>it<span class="_ _16"> </span>executes<span class="_ _1"></span>.</div><div class="t m5 x17 h26 y617e ff7 fs19 fc1 sc0 ls0 ws0">However,<span class="_ _16"> </span>it<span class="_ _14"> </span>is<span class="_ _16"> </span>also<span class="_ _16"> </span>possible<span class="_ _14"> </span>for<span class="_ _16"> </span>an<span class="_ _14"> </span>application<span class="_ _16"> </span>to<span class="_ _14"> </span>request<span class="_ _16"> </span>the<span class="_ _16"> </span>dynamic<span class="_ _14"> </span>linker<span class="_ _16"> </span>to</div><div class="t m5 x17 h26 y617f ff7 fs19 fc1 sc0 ls0 ws0">load<span class="_ _11"> </span>and<span class="_ _11"> </span>link<span class="_ _16"> </span>arbitrary<span class="_ _11"> </span>shared<span class="_ _11"> </span>libraries<span class="_ _16"> </span>while<span class="_"> </span>the<span class="_ _16"> </span>application<span class="_ _11"> </span>is<span class="_ _11"> </span>running,<span class="_ _11"> </span>without</div><div class="t m5 x17 h26 y6180 ff7 fs19 fc1 sc0 ls0 ws0">having<span class="_"> </span>to<span class="_"> </span>link<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>applications<span class="_"> </span>against<span class="_"> </span>those<span class="_"> </span>libraries<span class="_"> </span>at<span class="_"> </span>compile<span class="_"> </span>time<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y6181 ff7 fs19 fc1 sc0 ls0 ws0">Dynamic<span class="_ _13"> </span>linking<span class="_ _13"> </span>is<span class="_"> </span>a<span class="_ _13"> </span>powerful<span class="_ _13"> </span>and<span class="_ _13"> </span>useful<span class="_"> </span>technique<span class="_ _1"></span>.<span class="_ _13"> </span>Here<span class="_"> </span>are<span class="_ _13"> </span>some<span class="_ _13"> </span>examples</div><div class="t m5 x17 h26 y6182 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_"> </span>the<span class="_"> </span>real<span class="_"> </span>world:</div><div class="t m5 x72 h3d y6183 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y6184 ffa fs19 fc1 sc0 ls0 ws0">Distributing<span class="_ _e"> </span>software<span class="_ _1"></span>.<span class="_ _15"> </span><span class="ff7">Developers<span class="_ _e"> </span>of<span class="_ _f"> </span>Microsoft<span class="_ _e"> </span>W<span class="_ _1"></span>indows<span class="_ _e"> </span>applications<span class="_ _f"> </span>fre-</span></div><div class="t m5 x26 h26 y6185 ff7 fs19 fc1 sc0 ls0 ws0">quently<span class="_ _15"> </span>use<span class="_ _21"> </span>shared<span class="_ _15"> </span>libraries<span class="_ _21"> </span>to<span class="_ _15"> </span>distribute<span class="_ _21"> </span>software<span class="_ _21"> </span>updates<span class="_ _1"></span>.<span class="_ _15"> </span>They<span class="_ _14"> </span>generate</div><div class="t m5 x26 h26 y6186 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_ _11"> </span>new<span class="_ _16"> </span>copy<span class="_ _11"> </span>of<span class="_ _11"> </span>a<span class="_ _16"> </span>shared<span class="_ _11"> </span>library<span class="_ _3"></span>,<span class="_ _16"> </span>which<span class="_ _11"> </span>users<span class="_ _16"> </span>can<span class="_ _11"> </span>then<span class="_ _11"> </span>download<span class="_ _16"> </span>and<span class="_ _11"> </span>use<span class="_ _16"> </span>as<span class="_ _11"> </span>a</div><div class="t m5 x26 h26 y6187 ff7 fs19 fc1 sc0 ls0 ws0">replacement<span class="_ _13"> </span>for<span class="_ _13"> </span>the<span class="_"> </span>current<span class="_ _13"> </span>version.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_"> </span>next<span class="_ _13"> </span>time<span class="_ _13"> </span>they<span class="_ _13"> </span>run<span class="_ _13"> </span>their<span class="_"> </span>application,</div><div class="t m5 x26 h26 y6188 ff7 fs19 fc1 sc0 ls0 ws0">it<span class="_"> </span>will<span class="_"> </span>automatically<span class="_"> </span>link<span class="_"> </span>and<span class="_"> </span>load<span class="_"> </span>the<span class="_"> </span>new<span class="_"> </span>shared<span class="_"> </span>library<span class="_ _3"></span>.</div><div class="t m5 x72 h3d y6189 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y618a ffa fs19 fc1 sc0 ls0 ws0">Building<span class="_ _13"> </span>high-performance<span class="_ _13"> </span>W<span class="_ _1"></span>eb<span class="_"> </span>servers<span class="_ _3"></span>.<span class="_ _a"> </span><span class="ff7">Many<span class="_"> </span>W<span class="_ _7"></span>eb<span class="_"> </span>servers<span class="_ _13"> </span>generate<span class="_ _13"> </span><span class="ffa">dynamic</span></span></div><div class="t m5 x26 h26 y618b ffa fs19 fc1 sc0 ls0 ws0">content<span class="_ _2"></span><span class="ff7">,<span class="_ _16"> </span>such<span class="_ _16"> </span>as<span class="_ _11"> </span>personalized<span class="_ _16"> </span>W<span class="_ _3"></span>eb<span class="_ _16"> </span>pages<span class="_ _3"></span>,<span class="_ _16"> </span>account<span class="_ _16"> </span>balances<span class="_ _1"></span>,<span class="_ _16"> </span>and<span class="_ _11"> </span>banner<span class="_ _16"> </span>ads<span class="_ _1"></span>.</span></div><div class="t m5 x26 h26 y618c ff7 fs19 fc1 sc0 ls0 ws0">Early<span class="_ _21"> </span>W<span class="_ _3"></span>eb<span class="_ _f"> </span>servers<span class="_ _21"> </span>generated<span class="_ _f"> </span>dynamic<span class="_ _21"> </span>content<span class="_ _21"> </span>by<span class="_ _f"> </span>using<span class="_ _21"> </span><span class="ffd">fork<span class="_ _f"> </span></span>and<span class="_ _21"> </span><span class="ffd">execve</span></div><div class="t m5 x26 h26 y618d ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _21"> </span>create<span class="_ _21"> </span>a<span class="_ _21"> </span>child<span class="_ _21"> </span>process<span class="_ _21"> </span>and<span class="_ _21"> </span>run<span class="_ _21"> </span>a<span class="_ _21"> </span>“CGI<span class="_ _21"> </span>program”<span class="_ _21"> </span>in<span class="_ _21"> </span>the<span class="_ _21"> </span>context<span class="_ _21"> </span>of<span class="_ _21"> </span>the</div><div class="t m5 x26 h26 y618e ff7 fs19 fc1 sc0 ls0 ws0">child.<span class="_ _6"> </span>However,<span class="_ _6"> </span>modern<span class="_ _6"> </span>high-performance<span class="_ _6"> </span>W<span class="_ _1"></span>eb<span class="_ _6"> </span>servers<span class="_ _6"> </span>can<span class="_ _6"> </span>generate<span class="_ _6"> </span>dynamic</div><div class="t m5 x26 h26 y618f ff7 fs19 fc1 sc0 ls0 ws0">content<span class="_"> </span>using<span class="_"> </span>a<span class="_"> </span>more<span class="_"> </span>efﬁcient<span class="_"> </span>and<span class="_ _11"> </span>sophisticated<span class="_"> </span>approach<span class="_"> </span>based<span class="_"> </span>on<span class="_"> </span>dynamic</div><div class="t m5 x26 h26 y6190 ff7 fs19 fc1 sc0 ls0 ws0">linking.</div><div class="t m5 x30 h26 y6191 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _16"> </span>idea<span class="_ _11"> </span>is<span class="_ _16"> </span>to<span class="_ _16"> </span>package<span class="_ _11"> </span>each<span class="_ _16"> </span>function<span class="_ _11"> </span>that<span class="_ _16"> </span>generates<span class="_ _16"> </span>dynamic<span class="_ _11"> </span>content<span class="_ _16"> </span>in</div><div class="t m5 x26 h26 y6192 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_ _21"> </span>shared<span class="_ _21"> </span>library<span class="_ _3"></span>.<span class="_ _21"> </span>When<span class="_ _21"> </span>a<span class="_ _21"> </span>request<span class="_ _21"> </span>arrives<span class="_ _f"> </span>from<span class="_ _21"> </span>a<span class="_ _21"> </span>W<span class="_ _1"></span>eb<span class="_ _21"> </span>browser,<span class="_ _f"> </span>the<span class="_ _21"> </span>server</div><div class="t m5 x26 h26 y6193 ff7 fs19 fc1 sc0 ls0 ws0">dynamically<span class="_ _13"> </span>loads<span class="_ _13"> </span>and<span class="_ _13"> </span>links<span class="_ _13"> </span>the<span class="_ _13"> </span>appropriate<span class="_ _13"> </span>function<span class="_ _13"> </span>and<span class="_ _13"> </span>then<span class="_ _13"> </span>calls<span class="_ _13"> </span>it<span class="_ _13"> </span>directly<span class="_ _3"></span>,</div><div class="t m5 x26 h26 y6194 ff7 fs19 fc1 sc0 ls0 ws0">as<span class="_ _11"> </span>opposed<span class="_ _11"> </span>to<span class="_ _11"> </span>using<span class="_ _11"> </span><span class="ffd">fork<span class="_ _11"> </span></span>and<span class="_ _11"> </span><span class="ffd">execve<span class="_ _11"> </span></span>to<span class="_ _11"> </span>run<span class="_ _11"> </span>the<span class="_ _16"> </span>function<span class="_"> </span>in<span class="_ _11"> </span>the<span class="_ _11"> </span>context<span class="_ _16"> </span>of<span class="_"> </span>a</div><div class="t m5 x26 h26 y6195 ff7 fs19 fc1 sc0 ls0 ws0">child<span class="_ _16"> </span>process<span class="_ _3"></span>.<span class="_ _16"> </span>T<span class="_ _0"></span>he<span class="_ _16"> </span>function<span class="_ _11"> </span>remains<span class="_ _16"> </span>cached<span class="_ _16"> </span>in<span class="_ _16"> </span>the<span class="_ _11"> </span>server’s<span class="_ _16"> </span>address<span class="_ _11"> </span>space,<span class="_ _11"> </span>so</div><div class="t m5 x26 h26 y6196 ff7 fs19 fc1 sc0 ls0 ws0">subsequent<span class="_"> </span>requests<span class="_ _13"> </span>can<span class="_"> </span>be<span class="_"> </span>handled<span class="_"> </span>at<span class="_ _13"> </span>the<span class="_"> </span>cost<span class="_"> </span>of<span class="_ _13"> </span>a<span class="_"> </span>simple<span class="_"> </span>function<span class="_ _13"> </span>call.<span class="_"> </span>T<span class="_ _1"></span>his</div><div class="t m5 x26 h26 y6197 ff7 fs19 fc1 sc0 ls0 ws0">can<span class="_ _6"> </span>have<span class="_ _13"> </span>a<span class="_ _6"> </span>signiﬁcant<span class="_ _6"> </span>impact<span class="_ _13"> </span>on<span class="_ _6"> </span>the<span class="_ _13"> </span>throughput<span class="_ _6"> </span>of<span class="_ _6"> </span>a<span class="_ _13"> </span>busy<span class="_ _6"> </span>site<span class="_ _1"></span>.<span class="_ _13"> </span>Further,<span class="_ _6"> </span>existing</div><div class="t m5 x26 h26 y6198 ff7 fs19 fc1 sc0 ls0 ws0">functions<span class="_ _13"> </span>can<span class="_ _6"> </span>be<span class="_ _13"> </span>updated<span class="_ _13"> </span>and<span class="_ _13"> </span>new<span class="_ _6"> </span>functions<span class="_ _13"> </span>can<span class="_ _13"> </span>be<span class="_ _13"> </span>added<span class="_ _6"> </span>at<span class="_ _13"> </span>run<span class="_ _13"> </span>time<span class="_ _1"></span>,<span class="_ _13"> </span>without</div><div class="t m5 x26 h26 y6199 ff7 fs19 fc1 sc0 ls0 ws0">stopping<span class="_"> </span>the<span class="_"> </span>server.</div><div class="t m5 x26 h26 y619a ff7 fs19 fc1 sc0 ls0 ws0">Linux<span class="_ _16"> </span>systems<span class="_ _14"> </span>provide<span class="_ _16"> </span>a<span class="_ _14"> </span>simple<span class="_ _14"> </span>interface<span class="_ _16"> </span>to<span class="_ _14"> </span>the<span class="_ _16"> </span>dynamic<span class="_ _14"> </span>linker<span class="_ _14"> </span>that<span class="_ _16"> </span>allows</div><div class="t m5 x17 h26 y619b ff7 fs19 fc1 sc0 ls0 ws0">application<span class="_"> </span>programs<span class="_"> </span>to<span class="_"> </span>load<span class="_"> </span>and<span class="_"> </span>link<span class="_"> </span>shared<span class="_"> </span>libraries<span class="_"> </span>at<span class="_"> </span>run<span class="_"> </span>time<span class="_ _1"></span>.</div><div class="t m5 x31 h2d y619c ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;dlfcn.h&gt;</div><div class="t m5 x31 h2d y619d ffd fs1e fc2 sc0 ls0 ws0">void<span class="_ _e"> </span>*dlopen(const<span class="_ _1f"> </span>char<span class="_ _1f"> </span>*filename,<span class="_ _e"> </span>int<span class="_ _1f"> </span>flag);</div><div class="t m5 x1eb hf1 y619e ff7 fs1f fc2 sc0 ls0 ws0">Returns:<span class="_"> </span>pointer<span class="_"> </span>to<span class="_"> </span>handle<span class="_"> </span>if<span class="_"> </span>OK,<span class="_"> </span>NULL<span class="_"> </span>on<span class="_"> </span>error</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
