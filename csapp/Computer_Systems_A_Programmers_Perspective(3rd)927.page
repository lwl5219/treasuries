<div id="pf39f" class="pf w2 h11" data-page-no="39f"><div class="pc pc39f w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg39f.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">926<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>10<span class="_ _3d"> </span>System-Level<span class="_ _10"> </span>I/O</span></div><div class="t m5 x1d h38 y93a ff7 fs1b fc6 sc0 ls0 ws0">I</div><div class="t m5 x23a h26 ye7 ffa fs19 fc1 sc0 ls0 ws0">nput/output<span class="_"> </span>(I/O)<span class="_ _a"> </span><span class="ff7">is<span class="_"> </span>the<span class="_ _13"> </span>process<span class="_"> </span>of<span class="_"> </span>copying<span class="_ _13"> </span>data<span class="_"> </span>between<span class="_ _13"> </span>main<span class="_"> </span>memory<span class="_ _13"> </span>and<span class="_"> </span>ex-</span></div><div class="t m5 x23a h26 y2a7 ff7 fs19 fc1 sc0 ls0 ws0">ternal<span class="_"> </span>devices<span class="_"> </span>such<span class="_"> </span>as<span class="_"> </span>disk<span class="_ _13"> </span>drives<span class="_ _1"></span>,<span class="_"> </span>terminals<span class="_ _1"></span>,<span class="_"> </span>and<span class="_"> </span>networks<span class="_ _1"></span>.<span class="_"> </span>An<span class="_"> </span>input<span class="_"> </span>operation</div><div class="t m5 x1d h26 y2a8 ff7 fs19 fc1 sc0 ls0 ws0">copies<span class="_"> </span>data<span class="_"> </span>from<span class="_ _11"> </span>an<span class="_"> </span>I/O<span class="_ _11"> </span>device<span class="_"> </span>to<span class="_ _11"> </span>main<span class="_"> </span>memory<span class="_ _3"></span>,<span class="_ _11"> </span>and<span class="_"> </span>an<span class="_"> </span>output<span class="_ _11"> </span>operation<span class="_"> </span>copies</div><div class="t m5 x1d h26 y2f7 ff7 fs19 fc1 sc0 ls0 ws0">data<span class="_"> </span>from<span class="_"> </span>memory<span class="_"> </span>to<span class="_"> </span>a<span class="_"> </span>device<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y2f8 ff7 fs19 fc1 sc0 ls0 ws0">All<span class="_ _11"> </span>language<span class="_ _16"> </span>run-time<span class="_ _11"> </span>systems<span class="_ _16"> </span>provide<span class="_ _16"> </span>higher<span class="_ _3"></span>-level<span class="_ _16"> </span>facilities<span class="_ _11"> </span>for<span class="_ _16"> </span>performing</div><div class="t m5 x1d h26 y2f9 ff7 fs19 fc1 sc0 ls0 ws0">I/O<span class="_ _3"></span>.<span class="_ _13"> </span>F<span class="_ _1"></span>or<span class="_ _13"> </span>example<span class="_ _1"></span>,<span class="_ _13"> </span>ANSI<span class="_ _6"> </span>C<span class="_ _13"> </span>provides<span class="_ _13"> </span>the<span class="_ _6"> </span><span class="ffa">standard<span class="_ _13"> </span>I/O<span class="_ _a"> </span></span>library<span class="_ _3"></span>,<span class="_ _13"> </span>with<span class="_ _13"> </span>functions<span class="_ _13"> </span>such<span class="_ _6"> </span>as</div><div class="t m5 x1d h26 y2fa ffd fs19 fc1 sc0 ls0 ws0">printf<span class="_ _10"> </span><span class="ff7">and<span class="_ _13"> </span></span>scanf<span class="_ _10"> </span><span class="ff7">that<span class="_"> </span>perform<span class="_"> </span>buffered<span class="_ _13"> </span>I/O<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>C++<span class="_ _13"> </span>language<span class="_"> </span>provides<span class="_"> </span>similar</span></div><div class="t m5 x1d h26 y2fb ff7 fs19 fc1 sc0 ls0 ws0">functionality<span class="_"> </span>with<span class="_ _13"> </span>its<span class="_"> </span>overloaded<span class="_ _13"> </span><span class="ffd">&lt;&lt;<span class="_ _10"> </span></span>(“put<span class="_ _13"> </span>to”)<span class="_"> </span>and<span class="_ _13"> </span><span class="ffd">&gt;&gt;<span class="_ _10"> </span></span>(“get<span class="_"> </span>from”)<span class="_ _13"> </span>operators<span class="_ _1"></span>.<span class="_"> </span>On</div><div class="t m5 x1d h26 y2fc ff7 fs19 fc1 sc0 ls0 ws0">Linux<span class="_ _14"> </span>systems<span class="_ _1"></span>,<span class="_ _15"> </span>these<span class="_ _14"> </span>higher<span class="_ _1"></span>-level<span class="_ _14"> </span>I/O<span class="_ _14"> </span>functions<span class="_ _14"> </span>are<span class="_ _14"> </span>implemented<span class="_ _14"> </span>using<span class="_ _15"> </span>system-</div><div class="t m5 x1d h26 y2fd ff7 fs19 fc1 sc0 ls0 ws0">level<span class="_ _13"> </span><span class="ffa">Unix<span class="_ _13"> </span>I/O<span class="_ _13"> </span></span>functions<span class="_ _13"> </span>provided<span class="_ _13"> </span>by<span class="_ _13"> </span>the<span class="_ _13"> </span>kernel.<span class="_ _13"> </span>Most<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>time<span class="_ _1"></span>,<span class="_"> </span>the<span class="_ _13"> </span>higher<span class="_ _3"></span>-level</div><div class="t m5 x1d h26 y2fe ff7 fs19 fc1 sc0 ls0 ws0">I/O<span class="_ _16"> </span>functions<span class="_ _16"> </span>work<span class="_ _16"> </span>quite<span class="_ _16"> </span>well<span class="_ _16"> </span>and<span class="_ _16"> </span>there<span class="_ _16"> </span>is<span class="_ _16"> </span>no<span class="_ _16"> </span>need<span class="_ _16"> </span>to<span class="_ _16"> </span>use<span class="_ _16"> </span>Unix<span class="_ _16"> </span>I/O<span class="_ _16"> </span>directly<span class="_ _3"></span>.<span class="_ _16"> </span>So</div><div class="t m5 x1d h26 y2ff ff7 fs19 fc1 sc0 ls0 ws0">why<span class="_"> </span>bother<span class="_"> </span>learning<span class="_"> </span>about<span class="_"> </span>Unix<span class="_"> </span>I/O?</div><div class="t m5 x75 h3d y76f3 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y76f4 ffa fs19 fc1 sc0 ls0 ws0">Understanding<span class="_ _6"> </span>Unix<span class="_ _13"> </span>I/O<span class="_ _6"> </span>will<span class="_ _13"> </span>help<span class="_ _6"> </span>you<span class="_ _13"> </span>understand<span class="_ _6"> </span>other<span class="_ _6"> </span>systems<span class="_ _13"> </span>concepts<span class="_ _1"></span>.<span class="_ _5"></span><span class="ff7">I/O<span class="_ _13"> </span>is</span></div><div class="t m5 x29 h26 y76f5 ff7 fs19 fc1 sc0 ls0 ws0">integral<span class="_"> </span>to<span class="_ _13"> </span>the<span class="_"> </span>operation<span class="_ _13"> </span>of<span class="_"> </span>a<span class="_"> </span>system,<span class="_ _13"> </span>and<span class="_"> </span>because<span class="_ _13"> </span>of<span class="_"> </span>this<span class="_ _1"></span>,<span class="_"> </span>we<span class="_ _13"> </span>often<span class="_"> </span>encounter</div><div class="t m5 x29 h26 y76f6 ff7 fs19 fc1 sc0 ls0 ws0">circular<span class="_ _15"> </span>dependencies<span class="_ _21"> </span>between<span class="_ _21"> </span>I/O<span class="_ _21"> </span>and<span class="_ _21"> </span>other<span class="_ _21"> </span>systems<span class="_ _21"> </span>ideas<span class="_ _1"></span>.<span class="_ _21"> </span>F<span class="_ _1"></span>or<span class="_ _21"> </span>example,</div><div class="t m5 x29 h26 y76f7 ff7 fs19 fc1 sc0 ls0 ws0">I/O<span class="_ _16"> </span>plays<span class="_ _16"> </span>a<span class="_ _16"> </span>key<span class="_ _16"> </span>role<span class="_ _16"> </span>in<span class="_ _16"> </span>process<span class="_ _14"> </span>creation<span class="_ _16"> </span>and<span class="_ _16"> </span>execution.<span class="_ _16"> </span>Conversely<span class="_ _3"></span>,<span class="_ _14"> </span>process</div><div class="t m5 x29 h26 y76f8 ff7 fs19 fc1 sc0 ls0 ws0">creation<span class="_"> </span>plays<span class="_"> </span>a<span class="_"> </span>key<span class="_"> </span>role<span class="_"> </span>in<span class="_"> </span>how<span class="_ _11"> </span>ﬁles<span class="_"> </span>are<span class="_"> </span>shared<span class="_"> </span>by<span class="_"> </span>different<span class="_"> </span>processes<span class="_ _1"></span>.<span class="_ _11"> </span>T<span class="_ _1"></span>hus<span class="_ _1"></span>,</div><div class="t m5 x29 h26 y76f9 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _16"> </span>really<span class="_ _16"> </span>understand<span class="_ _11"> </span>I/O<span class="_ _1"></span>,<span class="_ _16"> </span>you<span class="_ _16"> </span>need<span class="_ _16"> </span>to<span class="_ _16"> </span>understand<span class="_ _16"> </span>processes<span class="_ _3"></span>,<span class="_ _14"> </span>and<span class="_ _16"> </span>vice<span class="_ _16"> </span>versa.</div><div class="t m5 x29 h26 y76fa ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_"> </span>have<span class="_"> </span>already<span class="_"> </span>touched<span class="_"> </span>on<span class="_"> </span>aspects<span class="_"> </span>of<span class="_ _13"> </span>I/O<span class="_"> </span>in<span class="_"> </span>our<span class="_"> </span>discussions<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>memory</div><div class="t m5 x29 h26 y76fb ff7 fs19 fc1 sc0 ls0 ws0">hierarchy<span class="_ _3"></span>,<span class="_"> </span>linking<span class="_ _11"> </span>and<span class="_ _11"> </span>loading,<span class="_ _11"> </span>processes<span class="_ _1"></span>,<span class="_ _11"> </span>and<span class="_ _11"> </span>virtual<span class="_ _11"> </span>memory<span class="_ _3"></span>.<span class="_"> </span>Now<span class="_ _11"> </span>that<span class="_ _11"> </span>you</div><div class="t m5 x29 h26 y76fc ff7 fs19 fc1 sc0 ls0 ws0">have<span class="_"> </span>a<span class="_ _11"> </span>better<span class="_"> </span>understanding<span class="_ _11"> </span>of<span class="_ _11"> </span>these<span class="_"> </span>ideas<span class="_ _1"></span>,<span class="_ _11"> </span>we<span class="_ _11"> </span>can<span class="_"> </span>close<span class="_ _11"> </span>the<span class="_"> </span>circle<span class="_ _11"> </span>and<span class="_ _11"> </span>delve</div><div class="t m5 x29 h26 y76fd ff7 fs19 fc1 sc0 ls0 ws0">into<span class="_"> </span>I/O<span class="_"> </span>in<span class="_"> </span>more<span class="_"> </span>detail.</div><div class="t m5 x75 h3d y76fe ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y76ff ffa fs19 fc1 sc0 ls0 ws0">Sometimes<span class="_"> </span>you<span class="_ _13"> </span>have<span class="_"> </span>no<span class="_"> </span>choice<span class="_ _13"> </span>but<span class="_"> </span>to<span class="_"> </span>use<span class="_ _13"> </span>Unix<span class="_"> </span>I/O<span class="_ _1"></span>.<span class="_ _a"> </span><span class="ff7">There<span class="_ _13"> </span>are<span class="_"> </span>some<span class="_"> </span>important</span></div><div class="t m5 x29 h26 y7700 ff7 fs19 fc1 sc0 ls0 ws0">cases<span class="_"> </span>where<span class="_ _11"> </span>using<span class="_ _11"> </span>higher<span class="_ _1"></span>-level<span class="_ _11"> </span>I/O<span class="_ _11"> </span>functions<span class="_"> </span>is<span class="_ _11"> </span>either<span class="_ _11"> </span>impossible<span class="_ _11"> </span>or<span class="_ _11"> </span>inappro-</div><div class="t m5 x29 h26 y7701 ff7 fs19 fc1 sc0 ls0 ws0">priate<span class="_ _1"></span>.<span class="_ _16"> </span>F<span class="_ _0"></span>or<span class="_ _16"> </span>example<span class="_ _1"></span>,<span class="_ _14"> </span>the<span class="_ _16"> </span>standard<span class="_ _16"> </span>I/O<span class="_ _14"> </span>library<span class="_ _16"> </span>provides<span class="_ _16"> </span>no<span class="_ _16"> </span>way<span class="_ _16"> </span>to<span class="_ _16"> </span>access<span class="_ _16"> </span>ﬁle</div><div class="t m5 x29 h26 y7702 ff7 fs19 fc1 sc0 ls0 ws0">metadata<span class="_ _16"> </span>such<span class="_ _16"> </span>as<span class="_ _16"> </span>ﬁle<span class="_ _14"> </span>size<span class="_ _16"> </span>or<span class="_ _16"> </span>ﬁle<span class="_ _16"> </span>creation<span class="_ _14"> </span>time<span class="_ _1"></span>.<span class="_ _16"> </span>Further,<span class="_ _14"> </span>there<span class="_ _16"> </span>are<span class="_ _16"> </span>problems</div><div class="t m5 x29 h26 y7703 ff7 fs19 fc1 sc0 ls0 ws0">with<span class="_"> </span>the<span class="_ _11"> </span>standard<span class="_"> </span>I/O<span class="_ _11"> </span>library<span class="_"> </span>that<span class="_ _11"> </span>make<span class="_"> </span>it<span class="_ _11"> </span>risky<span class="_"> </span>to<span class="_ _11"> </span>use<span class="_"> </span>for<span class="_ _11"> </span>network<span class="_"> </span>program-</div><div class="t m5 x29 h26 y7704 ff7 fs19 fc1 sc0 ls0 ws0">ming.</div><div class="t m5 x29 h26 y7705 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _13"> </span>chapter<span class="_"> </span>introduces<span class="_ _13"> </span>you<span class="_ _13"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>general<span class="_ _13"> </span>concepts<span class="_ _13"> </span>of<span class="_ _13"> </span>Unix<span class="_"> </span>I/O<span class="_ _13"> </span>and<span class="_ _13"> </span>standard</div><div class="t m5 x1d h26 y7706 ff7 fs19 fc1 sc0 ls0 ws0">I/O<span class="_ _6"> </span>and<span class="_ _6"> </span>shows<span class="_ _6"> </span>you<span class="_ _13"> </span>how<span class="_ _a"> </span>to<span class="_ _6"> </span>use<span class="_ _13"> </span>them<span class="_ _a"> </span>reliably<span class="_ _6"> </span>from<span class="_ _13"> </span>your<span class="_ _a"> </span>C<span class="_ _6"> </span>programs<span class="_ _1"></span>.<span class="_ _13"> </span>Besides<span class="_ _a"> </span>serving</div><div class="t m5 x1d h26 y7707 ff7 fs19 fc1 sc0 ls0 ws0">as<span class="_ _11"> </span>a<span class="_ _11"> </span>general<span class="_ _11"> </span>introduction,<span class="_ _11"> </span>this<span class="_ _11"> </span>chapter<span class="_ _11"> </span>lays<span class="_ _11"> </span>a<span class="_ _11"> </span>ﬁrm<span class="_ _11"> </span>foundation<span class="_ _11"> </span>for<span class="_ _11"> </span>our<span class="_ _11"> </span>subsequent</div><div class="t m5 x1d h26 y7708 ff7 fs19 fc1 sc0 ls0 ws0">study<span class="_"> </span>of<span class="_"> </span>network<span class="_"> </span>programming<span class="_"> </span>and<span class="_"> </span>concurrency<span class="_ _7"></span>.</div><div class="t m5 x1d h3b y7709 fff fs24 fc6 sc0 ls0 ws0">10.1<span class="_ _17"> </span><span class="ffe fs18">Unix<span class="_"> </span>I/O</span></div><div class="t m5 x1d h26 y770a ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_"> </span>Linux<span class="_"> </span><span class="ffa">ﬁle<span class="_"> </span></span>is<span class="_"> </span>a<span class="_"> </span>sequence<span class="_"> </span>of<span class="_"> </span><span class="ff11">m<span class="_ _10"> </span></span>bytes:</div><div class="t m5 x136 h45 y770b ff11 fs19 fc1 sc0 ls0 ws0">B</div><div class="t m5 x68 h3c y770c ff7 fs25 fc1 sc0 ls0 ws0">0</div><div class="t m5 x1c8 h45 y770d ff11 fs19 fc1 sc0 ls42 ws0">,B</div><div class="t m5 x198 h3c y770c ff7 fs25 fc1 sc0 ls0 ws0">1</div><div class="t m5 x17c h45 y770d ff11 fs19 fc1 sc0 ls42 ws0">,...,B</div><div class="t m5 x120 h50 y770c ff11 fs25 fc1 sc0 ls0 ws0">k</div><div class="t m5 x13c h45 y770d ff11 fs19 fc1 sc0 ls42 ws0">,...,B</div><div class="t m5 x80 h4b y770c ff11 fs25 fc1 sc0 ls0 ws0">m<span class="ff12">−<span class="ff7">1</span></span></div><div class="t m5 x1d h26 ye93 ff7 fs19 fc1 sc0 ls0 ws0">All<span class="_ _11"> </span>I/O<span class="_ _11"> </span>devices<span class="_ _1"></span>,<span class="_ _16"> </span>such<span class="_"> </span>as<span class="_ _16"> </span>networks<span class="_ _3"></span>,<span class="_ _16"> </span>disks<span class="_ _1"></span>,<span class="_ _11"> </span>and<span class="_ _11"> </span>terminals<span class="_ _1"></span>,<span class="_ _16"> </span>are<span class="_ _11"> </span>modeled<span class="_ _11"> </span>as<span class="_ _11"> </span>ﬁles<span class="_ _1"></span>,<span class="_ _16"> </span>and</div><div class="t m5 x1d h26 y2532 ff7 fs19 fc1 sc0 ls0 ws0">all<span class="_ _13"> </span>input<span class="_ _6"> </span>and<span class="_ _13"> </span>output<span class="_ _13"> </span>is<span class="_ _6"> </span>performed<span class="_ _13"> </span>by<span class="_ _13"> </span>reading<span class="_ _13"> </span>and<span class="_ _6"> </span>writing<span class="_ _13"> </span>the<span class="_ _13"> </span>appropriate<span class="_ _6"> </span>ﬁles<span class="_ _1"></span>.<span class="_ _13"> </span>T<span class="_ _1"></span>his</div><div class="t m5 x1d h26 y2533 ff7 fs19 fc1 sc0 ls0 ws0">elegant<span class="_ _13"> </span>mapping<span class="_ _6"> </span>of<span class="_ _13"> </span>devices<span class="_ _13"> </span>to<span class="_ _6"> </span>ﬁles<span class="_ _13"> </span>allows<span class="_ _13"> </span>the<span class="_ _6"> </span>Linux<span class="_ _13"> </span>kernel<span class="_ _13"> </span>to<span class="_ _6"> </span>export<span class="_ _13"> </span>a<span class="_ _13"> </span>simple<span class="_ _1"></span>,<span class="_ _13"> </span>low-</div><div class="t m5 x1d h26 y2534 ff7 fs19 fc1 sc0 ls0 ws0">level<span class="_ _11"> </span>application<span class="_ _11"> </span>interface<span class="_ _1"></span>,<span class="_ _16"> </span>known<span class="_"> </span>as<span class="_ _11"> </span><span class="ffa">Unix<span class="_ _11"> </span>I/O</span>,<span class="_ _11"> </span>that<span class="_ _11"> </span>enables<span class="_ _11"> </span>all<span class="_ _11"> </span>input<span class="_ _11"> </span>and<span class="_ _11"> </span>output</div><div class="t m5 x1d h26 y2535 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_"> </span>be<span class="_"> </span>performed<span class="_"> </span>in<span class="_"> </span>a<span class="_"> </span>uniform<span class="_"> </span>and<span class="_"> </span>consistent<span class="_"> </span>way:</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
