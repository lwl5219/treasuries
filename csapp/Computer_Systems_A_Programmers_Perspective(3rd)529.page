<div id="pf211" class="pf w2 h11" data-page-no="211"><div class="pc pc211 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg211.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">528<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>4<span class="_ _3d"> </span>Processor<span class="_ _10"> </span>Architecture</span></div><div class="t m5 x29 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _13"> </span>code<span class="_ _13"> </span>initializes<span class="_ _6"> </span>register<span class="_ _13"> </span><span class="ffd">%rdx<span class="_ _6"> </span></span>to<span class="_ _13"> </span><span class="ffd">0x321</span>.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span>conditional<span class="_ _6"> </span>data<span class="_ _13"> </span>transfer<span class="_ _6"> </span>does</div><div class="t m5 x1d h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">not<span class="_ _13"> </span>take<span class="_ _13"> </span>place<span class="_ _1"></span>,<span class="_ _13"> </span>and<span class="_ _13"> </span>so<span class="_ _13"> </span>the<span class="_ _13"> </span>Ô¨Ånal<span class="_ _13"> </span><span class="ffd">addq<span class="_ _13"> </span></span>instruction<span class="_ _13"> </span>should<span class="_ _13"> </span>double<span class="_ _6"> </span>the<span class="_ _13"> </span>value<span class="_ _13"> </span>in<span class="_ _13"> </span><span class="ffd">%rdx<span class="_ _13"> </span></span>to</div><div class="t m5 x1d h26 y2a8 ffd fs19 fc2 sc0 ls0 ws0">0x642<span class="ff7">.<span class="_ _6"> </span>With<span class="_ _6"> </span>the<span class="_ _6"> </span>altered<span class="_ _13"> </span>design,<span class="_ _13"> </span>however<span class="_ _1"></span>,<span class="_ _13"> </span>the<span class="_ _6"> </span>conditional<span class="_ _13"> </span>move<span class="_ _6"> </span>source<span class="_ _13"> </span>value<span class="_ _6"> </span><span class="ffd">0x321</span></span></div><div class="t m5 x1d h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">gets<span class="_ _13"> </span>forwarded<span class="_ _6"> </span>into<span class="_ _13"> </span>ALU<span class="_ _13"> </span>input<span class="_ _6"> </span><span class="ff6">valA</span>,<span class="_ _13"> </span>while<span class="_ _13"> </span>input<span class="_ _13"> </span><span class="ff6">valB<span class="_ _6"> </span></span>correctly<span class="_ _13"> </span>gets<span class="_ _13"> </span>operand<span class="_ _13"> </span>value</div><div class="t m5 x1d h26 y2f8 ffd fs19 fc2 sc0 ls0 ws0">0x123<span class="ff7">.<span class="_"> </span>T<span class="_ _1"></span>hese<span class="_"> </span>inputs<span class="_"> </span>get<span class="_"> </span>added<span class="_"> </span>to<span class="_"> </span>produce<span class="_"> </span>result<span class="_"> </span><span class="ffd">0x444</span>.</span></div><div class="t m5 x1d h28 y493e ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>4.36<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>491)</span></div><div class="t m5 x1d h26 y1328 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>code<span class="_"> </span>completes<span class="_"> </span>the<span class="_"> </span>computation<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>status<span class="_"> </span>code<span class="_"> </span>for<span class="_"> </span>this<span class="_"> </span>instruction.</div><div class="t m5 x1d h2d y4493 ffd fs1e fc2 sc0 ls0 ws0">##<span class="_ _e"> </span>Update<span class="_ _1f"> </span>the<span class="_ _1f"> </span>status</div><div class="t m5 x1d h2d y493f ffd fs1e fc2 sc0 ls0 ws0">word<span class="_ _e"> </span>m_stat<span class="_ _1f"> </span>=<span class="_ _1f"> </span>[</div><div class="t m5 x22b h2d y4940 ffd fs1e fc2 sc0 ls0 ws0">dmem_error<span class="_ _e"> </span>:<span class="_ _1f"> </span>SADR;</div><div class="t m5 x22b h2d y4941 ffd fs1e fc2 sc0 ls0 ws0">1<span class="_ _e"> </span>:<span class="_ _1f"> </span>M_stat;</div><div class="t m5 x1d h2d y4942 ffd fs1e fc2 sc0 ls0 ws0">];</div><div class="t m5 x1d h28 y4943 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>4.37</div><div class="t m5 xe1 h2f y4944 ffe fs16 fc6 sc0 ls0 ws0">(page<span class="_"> </span>497)</div><div class="t m5 x1d h26 y4945 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _16"> </span>following<span class="_ _11"> </span>test<span class="_ _11"> </span>program<span class="_ _16"> </span>is<span class="_ _11"> </span>designed<span class="_ _11"> </span>to<span class="_ _16"> </span>set<span class="_ _11"> </span>up<span class="_ _11"> </span>control<span class="_ _16"> </span>combination<span class="_ _11"> </span>A<span class="_ _16"> </span>(F<span class="_ _1"></span>igure</div><div class="t m5 x1d h26 y4946 ff7 fs19 fc1 sc0 ls0 ws0">4.67)<span class="_"> </span>and<span class="_"> </span>detect<span class="_"> </span>whether<span class="_"> </span>something<span class="_"> </span>goes<span class="_"> </span>wrong:</div><div class="t m5 x1f h2d y182d ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">#<span class="_ _1f"> </span>Code<span class="_ _e"> </span>to<span class="_ _1f"> </span>generate<span class="_ _1f"> </span>a<span class="_ _e"> </span>combination<span class="_ _1f"> </span>of<span class="_ _e"> </span>not-taken<span class="_ _1f"> </span>branch<span class="_ _1f"> </span>and<span class="_ _e"> </span>ret</span></div><div class="t m5 x1f h2d y4947 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _70"> </span><span class="ffd fs1e fc2">irmovq<span class="_ _e"> </span>Stack,<span class="_ _1f"> </span>%rsp</span></div><div class="t m5 x1f h2d y4948 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _70"> </span><span class="ffd fs1e fc2">irmovq<span class="_ _e"> </span>rtnp,%rax</span></div><div class="t m5 x1f h2e y30b3 ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 xf7 h2d y3239 ffd fs1e fc2 sc0 ls0 ws0">pushq<span class="_ _e"> </span>%rax<span class="_ _2b"> </span>#<span class="_ _e"> </span>Set<span class="_ _1f"> </span>up<span class="_ _1f"> </span>return<span class="_ _e"> </span>pointer</div><div class="t m5 x1f h2d y30b4 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _70"> </span><span class="ffd fs1e fc2">xorq<span class="_ _e"> </span>%rax,%rax<span class="_ _3f"> </span>#<span class="_ _1f"> </span>Set<span class="_ _1f"> </span>Z<span class="_ _e"> </span>condition<span class="_ _1f"> </span>code</span></div><div class="t m5 x1f h2d y30b5 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _70"> </span><span class="ffd fs1e fc2">jne<span class="_ _e"> </span>target<span class="_ _2b"> </span>#<span class="_ _e"> </span>Not<span class="_ _1f"> </span>taken<span class="_ _1f"> </span>(First<span class="_ _e"> </span>part<span class="_ _1f"> </span>of<span class="_ _e"> </span>combination)</span></div><div class="t m5 x1f h2d y323c ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _70"> </span><span class="ffd fs1e fc2">irmovq<span class="_ _e"> </span>$1,%rax<span class="_ _3f"> </span>#<span class="_ _1f"> </span>Should<span class="_ _1f"> </span>execute<span class="_ _e"> </span>this</span></div><div class="t m5 x1f h2d y2968 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _70"> </span><span class="ffd fs1e fc2">halt</span></div><div class="t m5 x1f h2e y30b8 ff6 fs20 fc6 sc0 ls0 ws0">9</div><div class="t m5 x4f h2d y323e ffd fs1e fc2 sc0 ls0 ws0">target:<span class="_ _e"> </span>ret<span class="_ _16f"> </span>#<span class="_ _e"> </span>Second<span class="_ _1f"> </span>part<span class="_ _1f"> </span>of<span class="_ _e"> </span>combination</div><div class="t m5 x1b0 h2d y30b9 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _70"> </span><span class="ffd fs1e fc2">irmovq<span class="_ _e"> </span>$2,%rbx<span class="_ _3f"> </span>#<span class="_ _1f"> </span>Should<span class="_ _1f"> </span>not<span class="_ _e"> </span>execute<span class="_ _1f"> </span>this</span></div><div class="t m5 x1b0 h2d y1849 ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _70"> </span><span class="ffd fs1e fc2">halt</span></div><div class="t m5 x1b0 h2d y30bb ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _1c"> </span><span class="ffd fs1e fc2">rtnp:<span class="_ _3f"> </span>irmovq<span class="_ _1f"> </span>$3,%rdx<span class="_ _3f"> </span>#<span class="_ _e"> </span>Should<span class="_ _1f"> </span>not<span class="_ _1f"> </span>execute<span class="_ _e"> </span>this</span></div><div class="t m5 x1b0 h2e y4949 ff6 fs20 fc6 sc0 ls0 ws0">13</div><div class="t m5 xf7 h2d y3241 ffd fs1e fc2 sc0 ls0 ws0">halt</div><div class="t m5 x1b0 h2d y1abe ff6 fs20 fc6 sc0 ls0 ws0">14<span class="_ _1c"> </span><span class="ffd fs1e fc2">.pos<span class="_ _1f"> </span>0x40</span></div><div class="t m5 x1b0 h2d y1ac0 ff6 fs20 fc6 sc0 ls0 ws0">15<span class="_ _1c"> </span><span class="ffd fs1e fc2">Stack:</span></div><div class="t m5 x29 h26 y494a ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _15"> </span>program<span class="_ _14"> </span>is<span class="_ _15"> </span>designed<span class="_ _14"> </span>so<span class="_ _14"> </span>that<span class="_ _15"> </span>if<span class="_ _14"> </span>something<span class="_ _15"> </span>goes<span class="_ _14"> </span>wrong<span class="_ _15"> </span>(for<span class="_ _14"> </span>example,<span class="_ _14"> </span>if</div><div class="t m5 x1d h26 y494b ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _13"> </span><span class="ffd">ret<span class="_ _13"> </span></span>instruction<span class="_"> </span>is<span class="_ _13"> </span>actually<span class="_ _13"> </span>executed),<span class="_ _13"> </span>then<span class="_"> </span>the<span class="_ _13"> </span>program<span class="_ _13"> </span>will<span class="_ _13"> </span>execute<span class="_"> </span>one<span class="_ _13"> </span>of<span class="_ _13"> </span>the</div><div class="t m5 x1d h26 y494c ff7 fs19 fc2 sc0 ls0 ws0">extra<span class="_ _13"> </span><span class="ffd">irmovq<span class="_ _13"> </span></span>instructions<span class="_ _13"> </span>and<span class="_ _6"> </span>then<span class="_ _13"> </span>halt.<span class="_ _13"> </span>T<span class="_ _1"></span>hus<span class="_ _1"></span>,<span class="_"> </span>an<span class="_ _6"> </span>error<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_ _13"> </span>pipeline<span class="_ _13"> </span>would<span class="_ _13"> </span>cause</div><div class="t m5 x1d h26 y494d ff7 fs19 fc2 sc0 ls0 ws0">some<span class="_"> </span>register<span class="_"> </span>to<span class="_"> </span>be<span class="_"> </span>updated<span class="_"> </span>incorrectly<span class="_ _7"></span>.<span class="_"> </span>T<span class="_ _1"></span>his<span class="_"> </span>code<span class="_"> </span>illustrates<span class="_"> </span>the<span class="_"> </span>care<span class="_"> </span>required<span class="_"> </span>to</div><div class="t m5 x1d h26 y494e ff7 fs19 fc2 sc0 ls0 ws0">implement<span class="_ _14"> </span>a<span class="_ _15"> </span>test<span class="_ _14"> </span>program.<span class="_ _14"> </span>It<span class="_ _15"> </span>must<span class="_ _14"> </span>set<span class="_ _15"> </span>up<span class="_ _14"> </span>a<span class="_ _15"> </span>potential<span class="_ _14"> </span>error<span class="_ _15"> </span>condition<span class="_ _14"> </span>and<span class="_ _14"> </span>then</div><div class="t m5 x1d h26 y494f ff7 fs19 fc2 sc0 ls0 ws0">detect<span class="_"> </span>whether<span class="_"> </span>or<span class="_"> </span>not<span class="_"> </span>an<span class="_"> </span>error<span class="_"> </span>occurs<span class="_ _1"></span>.</div><div class="t m5 x1d h28 y4950 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>4.38<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>498)</span></div><div class="t m5 x1d h26 y13c0 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _16"> </span>following<span class="_ _11"> </span>test<span class="_ _16"> </span>program<span class="_ _16"> </span>is<span class="_ _11"> </span>designed<span class="_ _16"> </span>to<span class="_ _11"> </span>set<span class="_ _16"> </span>up<span class="_ _16"> </span>control<span class="_ _11"> </span>combination<span class="_ _16"> </span>B<span class="_ _11"> </span>(Figure</div><div class="t m5 x1d h26 y13c1 ff7 fs19 fc1 sc0 ls0 ws0">4.67).<span class="_ _11"> </span>T<span class="_ _1"></span>he<span class="_ _11"> </span>simulator<span class="_ _11"> </span>will<span class="_ _11"> </span>detect<span class="_ _16"> </span>a<span class="_"> </span>case<span class="_ _11"> </span>where<span class="_ _11"> </span>the<span class="_ _11"> </span>bubble<span class="_ _11"> </span>and<span class="_ _11"> </span>stall<span class="_ _16"> </span>control<span class="_"> </span>signals</div><div class="t m5 x1d h26 y13c2 ff7 fs19 fc1 sc0 ls0 ws0">for<span class="_"> </span>a<span class="_"> </span>pipeline<span class="_"> </span>register<span class="_"> </span>are<span class="_"> </span>both<span class="_ _11"> </span>set<span class="_"> </span>to<span class="_"> </span>zero<span class="_ _0"></span>,<span class="_"> </span>and<span class="_"> </span>so<span class="_"> </span>our<span class="_"> </span>test<span class="_ _11"> </span>program<span class="_"> </span>need<span class="_"> </span>only<span class="_"> </span>set</div><div class="t m5 x1d h26 y13c3 ff7 fs19 fc1 sc0 ls0 ws0">up<span class="_ _14"> </span>the<span class="_ _14"> </span>combination<span class="_ _14"> </span>for<span class="_ _14"> </span>it<span class="_ _14"> </span>to<span class="_ _14"> </span>be<span class="_ _14"> </span>detected.<span class="_ _14"> </span>The<span class="_ _16"> </span>biggest<span class="_ _14"> </span>challenge<span class="_ _14"> </span>is<span class="_ _14"> </span>to<span class="_ _14"> </span>make<span class="_ _14"> </span>the</div><div class="t m5 x1d h26 y1a80 ff7 fs19 fc1 sc0 ls0 ws0">program<span class="_"> </span>do<span class="_"> </span>something<span class="_"> </span>sensible<span class="_"> </span>when<span class="_"> </span>handled<span class="_"> </span>correctly<span class="_ _3"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
