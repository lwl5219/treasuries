<div id="pf284" class="pf w2 h11" data-page-no="284"><div class="pc pc284 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg284.png"/><div class="t m5 x261 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>6.2<span class="_ _60"> </span>Locality<span class="_ _3e"> </span><span class="ffe fs1e">643</span></div><div class="t m5 x2c h2d y3829 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">int<span class="_ _1f"> </span>sumarrayrows(int<span class="_ _e"> </span>a[M][N])</span></div><div class="t m5 x2c h2d y3aa2 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x2c h2d y3aa3 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2">int<span class="_ _e"> </span>i,<span class="_ _1f"> </span>j,<span class="_ _1f"> </span>sum<span class="_ _e"> </span>=<span class="_ _1f"> </span>0;</span></div><div class="t m5 x2c h2e y3aa4 ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 x2c h2e y5584 ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x142 h2d y3aa5 ffd fs1e fc2 sc0 ls33 ws0">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>i=0<span class="_ _41"></span>;i&lt;M<span class="_ _41"></span>;<span class="ls0">i++)</span></div><div class="t m5 x2c h2d y3aa6 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _70"> </span><span class="ffd fs1e fc2 ls33">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>j=0<span class="_ _41"></span>;j&lt;N<span class="_ _41"></span>;<span class="ls0">j++)</span></span></div><div class="t m5 x2c h2d y3aa7 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _d1"> </span><span class="ffd fs1e fc2">sum<span class="_ _1f"> </span>+=<span class="_ _e"> </span>a[i][j];</span></div><div class="t m5 x2c h2d y3aa8 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _20"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>sum;</span></div><div class="t m5 x2c h2d y3aa9 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x17 h26 y558e ff7 fs19 fc2 sc0 ls0 ws0">(a)</div><div class="t m5 xfc h31 y558f ff7 fs21 fc2 sc0 ls0 ws0">Address<span class="_ _bd"> </span>0<span class="_ _4c"> </span>4<span class="_ _4c"> </span>8<span class="_ _1f9"> </span>12<span class="_ _19"> </span>16<span class="_ _19"> </span>20</div><div class="t m5 xfc h31 y5590 ff7 fs21 fc2 sc0 ls0 ws0">Contents<span class="_ _131"> </span><span class="ff11">a</span></div><div class="t m5 xdf h33 y5591 ff7 fs20 fc2 sc0 ls0 ws0">00</div><div class="t m5 x9 h55 y5592 ff11 fs21 fc2 sc0 ls0 ws0">a</div><div class="t m5 x8d h33 y5591 ff7 fs20 fc2 sc0 ls0 ws0">01</div><div class="t m5 x5f h55 y5592 ff11 fs21 fc2 sc0 ls0 ws0">a</div><div class="t m5 x133 h33 y5591 ff7 fs20 fc2 sc0 ls0 ws0">02</div><div class="t m5 x202 h55 y5592 ff11 fs21 fc2 sc0 ls0 ws0">a</div><div class="t m5 xe9 h33 y5591 ff7 fs20 fc2 sc0 ls0 ws0">10</div><div class="t m5 x14e h55 y5592 ff11 fs21 fc2 sc0 ls0 ws0">a</div><div class="t m5 x149 h33 y5591 ff7 fs20 fc2 sc0 ls0 ws0">11</div><div class="t m5 x105 h55 y5592 ff11 fs21 fc2 sc0 ls0 ws0">a</div><div class="t m5 x271 h33 y5591 ff7 fs20 fc2 sc0 ls0 ws0">12</div><div class="t m5 xfc h31 y5593 ff7 fs21 fc2 sc0 ls0 ws0">Access<span class="_"> </span>order<span class="_ _95"> </span>1<span class="_ _4c"> </span>2<span class="_ _4c"> </span>3<span class="_ _3a"> </span>4<span class="_ _4c"> </span>5<span class="_ _4c"> </span>6</div><div class="t m5 xfc h31 y5594 ff7 fs21 fc2 sc0 ls0 ws0">(b)</div><div class="t m5 x17 h35 y5595 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>6.18<span class="_ _c"> </span><span class="fc1">(a)<span class="_"> </span>Another<span class="_ _11"> </span>function<span class="_ _11"> </span>with<span class="_"> </span>good<span class="_ _11"> </span>locality<span class="_ _1"></span>.<span class="_"> </span>(b)<span class="_ _11"> </span>Reference<span class="_ _11"> </span>pattern<span class="_"> </span>for<span class="_ _11"> </span>array<span class="_ _11"> </span><span class="ffd fs19">a<span class="_ _11"> </span></span>(<span class="ff11">M<span class="_"> </span><span class="ff12">=<span class="_ _13"></span><span class="ff7">2</span></span></span>,<span class="_"> </span><span class="ff11">N<span class="_"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ff7">3</span></span></span>).</span></div><div class="t m5 x17 h34 y5596 ff6 fs16 fc1 sc0 ls0 ws0">There<span class="_ _11"> </span>is<span class="_ _11"> </span>good<span class="_ _11"> </span>spatial<span class="_ _11"> </span>locality<span class="_ _11"> </span>because<span class="_ _11"> </span>the<span class="_ _10"> </span>array<span class="_ _11"> </span>is<span class="_ _11"> </span>accessed<span class="_ _11"> </span>in<span class="_ _11"> </span>the<span class="_ _11"> </span>same<span class="_ _11"> </span>row-major<span class="_ _11"> </span>order<span class="_ _11"> </span>in<span class="_ _11"> </span>which<span class="_ _11"> </span>it<span class="_ _11"> </span>is<span class="_ _11"> </span>stored</div><div class="t m5 x17 h34 y5597 ff6 fs16 fc1 sc0 ls0 ws0">in<span class="_ _10"> </span>memory<span class="_ _1"></span>.</div><div class="t m5 x2c h2e y5598 ff6 fs20 fc6 sc0 ls0 ws0">1</div><div class="t m5 x2d h2d y5599 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>sumarraycols(int<span class="_ _1f"> </span>a[M][N])</div><div class="t m5 x2c h2d y559a ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x2c h2d y559b ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2">int<span class="_ _e"> </span>i,<span class="_ _1f"> </span>j,<span class="_ _1f"> </span>sum<span class="_ _e"> </span>=<span class="_ _1f"> </span>0;</span></div><div class="t m5 x2c h2e y559c ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 x2c h2e y559d ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x142 h2d y559e ffd fs1e fc2 sc0 ls33 ws0">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>j=0<span class="_ _41"></span>;j&lt;N<span class="_ _41"></span>;<span class="ls0">j++)</span></div><div class="t m5 x2c h2d y559f ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _70"> </span><span class="ffd fs1e fc2 ls33">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>i=0<span class="_ _41"></span>;i&lt;M<span class="_ _41"></span>;<span class="ls0">i++)</span></span></div><div class="t m5 x2c h2d y55a0 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _d1"> </span><span class="ffd fs1e fc2">sum<span class="_ _1f"> </span>+=<span class="_ _e"> </span>a[i][j];</span></div><div class="t m5 x2c h2d y55a1 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _20"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>sum;</span></div><div class="t m5 x2c h2d y55a2 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x17 h26 y55a3 ff7 fs19 fc2 sc0 ls0 ws0">(a)</div><div class="t m5 xfc h31 y55a4 ff7 fs21 fc2 sc0 ls0 ws0">Address<span class="_ _bd"> </span>0<span class="_ _4c"> </span>4<span class="_ _4c"> </span>8<span class="_ _1f9"> </span>12<span class="_ _19"> </span>16<span class="_ _19"> </span>20</div><div class="t m5 xfc h31 y55a5 ff7 fs21 fc2 sc0 ls0 ws0">Contents<span class="_ _131"> </span><span class="ff11">a</span></div><div class="t m5 xdf h33 y55a6 ff7 fs20 fc2 sc0 ls0 ws0">00</div><div class="t m5 x9 h55 y55a7 ff11 fs21 fc2 sc0 ls0 ws0">a</div><div class="t m5 x8d h33 y55a6 ff7 fs20 fc2 sc0 ls0 ws0">01</div><div class="t m5 x5f h55 y55a7 ff11 fs21 fc2 sc0 ls0 ws0">a</div><div class="t m5 x133 h33 y55a6 ff7 fs20 fc2 sc0 ls0 ws0">02</div><div class="t m5 x202 h55 y55a7 ff11 fs21 fc2 sc0 ls0 ws0">a</div><div class="t m5 xe9 h33 y55a6 ff7 fs20 fc2 sc0 ls0 ws0">10</div><div class="t m5 x14e h55 y55a7 ff11 fs21 fc2 sc0 ls0 ws0">a</div><div class="t m5 x149 h33 y55a6 ff7 fs20 fc2 sc0 ls0 ws0">11</div><div class="t m5 x105 h55 y55a7 ff11 fs21 fc2 sc0 ls0 ws0">a</div><div class="t m5 x271 h33 y55a6 ff7 fs20 fc2 sc0 ls0 ws0">12</div><div class="t m5 xfc h31 y55a8 ff7 fs21 fc2 sc0 ls0 ws0">Access<span class="_"> </span>order<span class="_ _95"> </span>1<span class="_ _4c"> </span>3<span class="_ _4c"> </span>5<span class="_ _3a"> </span>2<span class="_ _4c"> </span>4<span class="_ _4c"> </span>6</div><div class="t m5 xfc h31 y55a9 ff7 fs21 fc2 sc0 ls0 ws0">(b)</div><div class="t m5 x17 h35 y55aa ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>6.19<span class="_ _c"> </span><span class="fc1">(a)<span class="_ _11"> </span>A<span class="_"> </span>function<span class="_ _11"> </span>with<span class="_ _11"> </span>poor<span class="_ _11"> </span>spatial<span class="_"> </span>locality<span class="_ _1"></span>.<span class="_ _11"> </span>(b)<span class="_ _11"> </span>Reference<span class="_"> </span>pattern<span class="_ _11"> </span>for<span class="_ _11"> </span>array<span class="_ _11"> </span><span class="ffd fs19">a<span class="_ _11"> </span></span>(<span class="ff11">M<span class="_"> </span><span class="ff12">=<span class="_ _13"></span><span class="ff7">2</span></span></span>,<span class="_"> </span><span class="ff11">N<span class="_"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ff7">3</span></span></span>).</span></div><div class="t m5 x17 h34 y55ab ff6 fs16 fc1 sc0 ls0 ws0">The<span class="_ _10"> </span>function<span class="_ _11"> </span>has<span class="_ _10"> </span>poor<span class="_ _10"> </span>spatial<span class="_ _11"> </span>locality<span class="_ _10"> </span>because<span class="_ _11"> </span>it<span class="_ _10"> </span>scans<span class="_ _11"> </span>memory<span class="_ _10"> </span>with<span class="_ _11"> </span>a<span class="_ _10"> </span>stride-<span class="ff11">N<span class="_ _14"> </span></span>reference<span class="_ _11"> </span>pattern.</div><div class="t m5 x26 h26 y55ac ff7 fs19 fc1 sc0 ls0 ws0">Seemingly<span class="_ _11"> </span>trivial<span class="_ _11"> </span>changes<span class="_ _11"> </span>to<span class="_ _11"> </span>a<span class="_ _11"> </span>program<span class="_ _11"> </span>can<span class="_ _11"> </span>have<span class="_ _11"> </span>a<span class="_ _11"> </span>big<span class="_ _11"> </span>impact<span class="_ _11"> </span>on<span class="_ _11"> </span>its<span class="_ _11"> </span>locality<span class="_ _3"></span>.</div><div class="t m5 x17 h26 y55ad ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _14"> </span>example,<span class="_ _15"> </span>the<span class="_ _15"> </span><span class="ffd">sumarraycols<span class="_ _14"> </span></span>function<span class="_ _15"> </span>in<span class="_ _15"> </span>F<span class="_ _1"></span>igure<span class="_ _15"> </span>6.19(a)<span class="_ _15"> </span>computes<span class="_ _14"> </span>the<span class="_ _15"> </span>same</div><div class="t m5 x17 h26 y55ae ff7 fs19 fc1 sc0 ls0 ws0">result<span class="_"> </span>as<span class="_"> </span>the<span class="_"> </span><span class="ffd">sumarrayrows<span class="_ _13"> </span></span>function<span class="_"> </span>in<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>6.18(a).<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>only<span class="_"> </span>difference<span class="_"> </span>is<span class="_"> </span>that</div><div class="t m5 x17 h26 y55af ff7 fs19 fc1 sc0 ls0 ws0">we<span class="_ _13"> </span>have<span class="_ _6"> </span>interchanged<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ff11">i<span class="_ _10"> </span></span>and<span class="_ _13"> </span><span class="ff11">j<span class="_ _11"> </span></span>loops<span class="_ _1"></span>.<span class="_ _13"> </span>What<span class="_ _6"> </span>impact<span class="_ _13"> </span>does<span class="_ _13"> </span>interchanging<span class="_ _13"> </span>the<span class="_ _6"> </span>loops</div><div class="t m5 x17 h26 y55b0 ff7 fs19 fc1 sc0 ls0 ws0">have<span class="_"> </span>on<span class="_"> </span>its<span class="_"> </span>locality?</div><div class="t m5 x26 h26 y55b1 ff7 fs19 fc1 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _10"> </span><span class="ffd ls0">sumarraycols<span class="_ _13"> </span><span class="ff7">function<span class="_ _13"> </span>suffers<span class="_ _13"> </span>from<span class="_ _13"> </span>poor<span class="_ _13"> </span>spatial<span class="_ _13"> </span>locality<span class="_ _13"> </span>because<span class="_ _13"> </span>it<span class="_ _13"> </span>scans</span></span></div><div class="t m5 x17 h26 y55b2 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>array<span class="_ _13"> </span>column-wise<span class="_"> </span>instead<span class="_ _13"> </span>of<span class="_"> </span>row-wise<span class="_ _1"></span>.<span class="_"> </span>Since<span class="_ _13"> </span>C<span class="_"> </span>arrays<span class="_ _13"> </span>are<span class="_"> </span>laid<span class="_"> </span>out<span class="_ _13"> </span>in<span class="_"> </span>memory</div><div class="t m5 x17 h26 y55b3 ff7 fs19 fc1 sc0 ls0 ws0">row-wise<span class="_ _1"></span>,<span class="_"> </span>the<span class="_"> </span>result<span class="_"> </span>is<span class="_"> </span>a<span class="_"> </span>stride-<span class="ff11">N<span class="_ _15"> </span></span>reference<span class="_"> </span>pattern,<span class="_"> </span>as<span class="_"> </span>shown<span class="_"> </span>in<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>6.19(b).</div><div class="t m5 x17 h41 y940 ffe fs29 fc1 sc0 ls0 ws0">6.2.2<span class="_ _48"> </span><span class="fs19">Locality<span class="_"> </span>of<span class="_"> </span>Instruction<span class="_"> </span>Fetches</span></div><div class="t m5 x17 h26 y753 ff7 fs19 fc1 sc0 ls0 ws0">Since<span class="_ _21"> </span>program<span class="_ _21"> </span>instructions<span class="_ _21"> </span>are<span class="_ _21"> </span>stored<span class="_ _21"> </span>in<span class="_ _21"> </span>memory<span class="_ _21"> </span>and<span class="_ _21"> </span>must<span class="_ _21"> </span>be<span class="_ _21"> </span>fetched<span class="_ _21"> </span>(read)</div><div class="t m5 x17 h26 y754 ff7 fs19 fc1 sc0 ls0 ws0">by<span class="_ _14"> </span>the<span class="_ _14"> </span>CPU<span class="_ _3"></span>,<span class="_ _15"> </span>we<span class="_ _15"> </span>can<span class="_ _14"> </span>also<span class="_ _15"> </span>evaluate<span class="_ _14"> </span>the<span class="_ _14"> </span>locality<span class="_ _15"> </span>of<span class="_ _14"> </span>a<span class="_ _14"> </span>program<span class="_ _15"> </span>with<span class="_ _14"> </span>respect<span class="_ _15"> </span>to<span class="_ _14"> </span>its</div><div class="t m5 x17 h26 y755 ff7 fs19 fc1 sc0 ls0 ws0">instruction<span class="_"> </span>fetches<span class="_ _3"></span>.<span class="_"> </span>F<span class="_ _1"></span>or<span class="_"> </span>example<span class="_ _1"></span>,<span class="_"> </span>in<span class="_ _13"> </span>Figure<span class="_ _13"> </span>6.17<span class="_"> </span>the<span class="_ _13"> </span>instructions<span class="_"> </span>in<span class="_"> </span>the<span class="_ _13"> </span>body<span class="_"> </span>of<span class="_"> </span>the</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
