<div id="pf30d" class="pf w2 h11" data-page-no="30d"><div class="pc pc30d w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg30d.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">780<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>8<span class="_ _3d"> </span>Exceptional<span class="_ _10"> </span>Control<span class="_ _10"> </span>Flow</span></div><div class="t m5 x28 h2a y257 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">Why<span class="_ _11"> </span>are<span class="_ _11"> </span>terminated<span class="_ _11"> </span>children<span class="_ _16"> </span>called<span class="_ _11"> </span>zombies?</span></div><div class="t m5 x28 h2b y258 ff7 fs1e fc2 sc0 ls0 ws0">In<span class="_ _11"> </span>folklore<span class="_ _1"></span>,<span class="_ _11"> </span>a<span class="_ _11"> </span>zombie<span class="_ _11"> </span>is<span class="_ _11"> </span>a<span class="_ _11"> </span>living<span class="_ _10"> </span>corpse,<span class="_ _10"> </span>an<span class="_ _11"> </span>entity<span class="_ _11"> </span>that<span class="_ _11"> </span>is<span class="_ _11"> </span>half<span class="_ _10"> </span>alive<span class="_ _11"> </span>and<span class="_ _11"> </span>half<span class="_ _11"> </span>dead.<span class="_ _11"> </span>A<span class="_ _11"> </span>zombie<span class="_ _10"> </span>process<span class="_ _11"> </span>is</div><div class="t m5 x28 h2b y259 ff7 fs1e fc2 sc0 ls0 ws0">similar<span class="_"> </span>in<span class="_ _13"> </span>the<span class="_ _13"> </span>sense<span class="_"> </span>that<span class="_ _13"> </span>although<span class="_ _13"> </span>it<span class="_"> </span>has<span class="_ _13"> </span>already<span class="_ _13"> </span>terminated,<span class="_"> </span>the<span class="_ _13"> </span>kernel<span class="_ _13"> </span>maintains<span class="_"> </span>some<span class="_ _13"> </span>of<span class="_ _13"> </span>its<span class="_"> </span>state<span class="_ _13"> </span>until</div><div class="t m5 x28 h2b y25a ff7 fs1e fc2 sc0 ls0 ws0">it<span class="_"> </span>can<span class="_"> </span>be<span class="_"> </span>reaped<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span>parent.</div><div class="t m5 x29 h26 y665e ff7 fs19 fc2 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _25"> </span><span class="ffd ls0">waitpid<span class="_ _25"> </span><span class="ff7">function<span class="_ _23"> </span>is<span class="_ _25"> </span>complicated.<span class="_ _23"> </span>By<span class="_ _25"> </span>default<span class="_ _23"> </span>(when<span class="_ _25"> </span></span>options<span class="_ _11"> </span>=<span class="_ _16"> </span>0<span class="ff7">),</span></span></div><div class="t m5 x1d h26 y665f ffd fs19 fc2 sc0 ls0 ws0">waitpid<span class="_ _10"> </span><span class="ff7">suspends<span class="_"> </span>execution<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>calling<span class="_"> </span>process<span class="_"> </span>until<span class="_"> </span>a<span class="_"> </span>child<span class="_"> </span>process<span class="_"> </span>in<span class="_"> </span>its<span class="_"> </span><span class="ffa">wait</span></span></div><div class="t m5 x1d h26 y6660 ffa fs19 fc2 sc0 ls0 ws0">set<span class="_"> </span><span class="ff7">terminates<span class="_ _1"></span>.<span class="_ _13"> </span>If<span class="_ _13"> </span>a<span class="_ _13"> </span>process<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_ _13"> </span>wait<span class="_ _13"> </span>set<span class="_ _13"> </span>has<span class="_ _13"> </span>already<span class="_ _13"> </span>terminated<span class="_ _13"> </span>at<span class="_ _13"> </span>the<span class="_ _13"> </span>time<span class="_ _13"> </span>of<span class="_ _13"> </span>the</span></div><div class="t m5 x1d h26 y6661 ff7 fs19 fc2 sc0 ls0 ws0">call,<span class="_ _13"> </span>then<span class="_ _13"> </span><span class="ffd">waitpid<span class="_ _13"> </span></span>returns<span class="_ _13"> </span>immediately<span class="_ _7"></span>.<span class="_ _13"> </span>In<span class="_ _13"> </span>either<span class="_ _13"> </span>case<span class="_ _1"></span>,<span class="_ _13"> </span><span class="ffd">waitpid<span class="_ _13"> </span></span>returns<span class="_ _13"> </span>the<span class="_ _13"> </span>PID<span class="_ _13"> </span>of</div><div class="t m5 x1d h26 y6662 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>terminated<span class="_"> </span>child<span class="_ _13"> </span>that<span class="_"> </span>caused<span class="_"> </span><span class="ffd">waitpid<span class="_ _10"> </span></span>to<span class="_"> </span>return.<span class="_"> </span>At<span class="_ _13"> </span>this<span class="_"> </span>point,<span class="_"> </span>the<span class="_"> </span>terminated</div><div class="t m5 x1d h26 y6663 ff7 fs19 fc2 sc0 ls0 ws0">child<span class="_"> </span>has<span class="_"> </span>been<span class="_"> </span>reaped<span class="_"> </span>and<span class="_"> </span>the<span class="_"> </span>kernel<span class="_"> </span>removes<span class="_"> </span>all<span class="_"> </span>traces<span class="_"> </span>of<span class="_"> </span>it<span class="_"> </span>from<span class="_"> </span>the<span class="_"> </span>system.</div><div class="t m5 x1d h42 y6664 ff6 fs29 fc6 sc0 ls0 ws0">Determining<span class="_ _11"> </span>the<span class="_ _16"> </span>Members<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>W<span class="_ _1"></span>ait<span class="_ _16"> </span>Set</div><div class="t m5 x1d h26 y6665 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>members<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>wait<span class="_"> </span>set<span class="_"> </span>are<span class="_"> </span>determined<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span><span class="ffd">pid<span class="_ _10"> </span></span>argument:</div><div class="t m5 x75 h3d y6666 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y6667 ff7 fs19 fc1 sc0 ls0 ws0">If<span class="_"> </span><span class="ffd ls4b">p<span class="_ _42"></span>i<span class="_ _49"></span>d&gt;0<span class="_ _49"></span><span class="ff7 ls0">,<span class="_"> </span>then<span class="_ _13"> </span>the<span class="_"> </span>wait<span class="_ _13"> </span>set<span class="_"> </span>is<span class="_"> </span>the<span class="_ _13"> </span>singleton<span class="_"> </span>child<span class="_"> </span>process<span class="_ _13"> </span>whose<span class="_"> </span>process<span class="_ _13"> </span>ID<span class="_"> </span>is</span></span></div><div class="t m5 x29 h26 y6668 ff7 fs19 fc1 sc0 ls0 ws0">equal<span class="_"> </span>to<span class="_"> </span><span class="ffd">pid</span>.</div><div class="t m5 x75 h3d y6669 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y666a ff7 fs19 fc1 sc0 ls0 ws0">If<span class="_"> </span><span class="ffd ls4b">p<span class="_ _49"></span>i<span class="_ _42"></span>d=-<span class="_ _49"></span>1<span class="_ _49"></span><span class="ff7 ls0">,<span class="_"> </span>then<span class="_"> </span>the<span class="_"> </span>wait<span class="_"> </span>set<span class="_"> </span>consists<span class="_"> </span>of<span class="_"> </span>all<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>parent’s<span class="_"> </span>child<span class="_"> </span>processes<span class="_ _3"></span>.</span></span></div><div class="t m5 x1d h26 y666b ff7 fs19 fc1 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _16"> </span><span class="ffd ls0">waitpid<span class="_ _10"> </span><span class="ff7">function<span class="_ _11"> </span>also<span class="_"> </span>supports<span class="_ _11"> </span>other<span class="_"> </span>kinds<span class="_ _11"> </span>of<span class="_"> </span>wait<span class="_ _11"> </span>sets<span class="_ _1"></span>,<span class="_ _11"> </span>involving<span class="_"> </span>Unix<span class="_ _11"> </span>pro-</span></span></div><div class="t m5 x1d h26 y666c ff7 fs19 fc1 sc0 ls0 ws0">cess<span class="_"> </span>groups<span class="_ _1"></span>,<span class="_"> </span>which<span class="_"> </span>we<span class="_"> </span>will<span class="_"> </span>not<span class="_"> </span>discuss<span class="_ _1"></span>.</div><div class="t m5 x1d h42 y666d ff6 fs29 fc6 sc0 ls0 ws0">Modifying<span class="_ _11"> </span>the<span class="_ _16"> </span>Default<span class="_ _16"> </span>Behavior</div><div class="t m5 x1d h26 y666e ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>default<span class="_ _13"> </span>behavior<span class="_ _13"> </span>can<span class="_ _13"> </span>be<span class="_ _13"> </span>modiﬁed<span class="_"> </span>by<span class="_ _13"> </span>setting<span class="_ _13"> </span><span class="ffd">options<span class="_ _13"> </span></span>to<span class="_"> </span>various<span class="_ _13"> </span>combinations</div><div class="t m5 x1d h26 y666f ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span>the<span class="_"> </span>WNOHANG<span class="_ _3"></span>,<span class="_"> </span>WUNTRA<span class="_ _1"></span>CED<span class="_ _1"></span>,<span class="_"> </span>and<span class="_"> </span>WCONTINUED<span class="_"> </span>constants:</div><div class="t m5 x75 h26 y6670 ff7 fs19 fc1 sc0 ls0 ws0">WNOHANG<span class="_ _3"></span>.<span class="_ _1f"> </span>Return<span class="_ _14"> </span>immediately<span class="_ _15"> </span>(with<span class="_ _15"> </span>a<span class="_ _15"> </span>return<span class="_ _15"> </span>value<span class="_ _14"> </span>of<span class="_ _15"> </span>0)<span class="_ _15"> </span>if<span class="_ _15"> </span>none<span class="_ _15"> </span>of<span class="_ _15"> </span>the</div><div class="t m5 xcd h26 y6671 ff7 fs19 fc1 sc0 ls0 ws0">child<span class="_ _16"> </span>processes<span class="_ _11"> </span>in<span class="_ _16"> </span>the<span class="_ _16"> </span>wait<span class="_ _11"> </span>set<span class="_ _16"> </span>has<span class="_ _11"> </span>terminated<span class="_ _16"> </span>yet.<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span>default<span class="_ _16"> </span>behavior</div><div class="t m5 xcd h26 y6672 ff7 fs19 fc1 sc0 ls0 ws0">suspends<span class="_"> </span>the<span class="_"> </span>calling<span class="_"> </span>process<span class="_"> </span>until<span class="_"> </span>a<span class="_"> </span>child<span class="_"> </span>terminates;<span class="_"> </span>this<span class="_ _13"> </span>option<span class="_"> </span>is<span class="_"> </span>useful</div><div class="t m5 xcd h26 y6673 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_ _6"> </span>those<span class="_ _13"> </span>cases<span class="_ _a"> </span>where<span class="_ _13"> </span>you<span class="_ _a"> </span>want<span class="_ _13"> </span>to<span class="_ _6"> </span>continue<span class="_ _6"> </span>doing<span class="_ _13"> </span>useful<span class="_ _a"> </span>work<span class="_ _13"> </span>while<span class="_ _a"> </span>waiting</div><div class="t m5 xcd h26 y6674 ff7 fs19 fc1 sc0 ls0 ws0">for<span class="_"> </span>a<span class="_"> </span>child<span class="_"> </span>to<span class="_"> </span>terminate<span class="_ _1"></span>.</div><div class="t m5 x75 h26 y6675 ff7 fs19 fc1 sc0 ls0 ws0">WUNTRA<span class="_ _1"></span>CED<span class="_ _3"></span>.<span class="_ _1f"> </span>Suspend<span class="_ _13"> </span>execution<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>calling<span class="_ _6"> </span>process<span class="_ _13"> </span>until<span class="_ _13"> </span>a<span class="_ _6"> </span>process<span class="_ _13"> </span>in<span class="_ _13"> </span>the</div><div class="t m5 xcd h26 y6676 ff7 fs19 fc1 sc0 ls0 ws0">wait<span class="_ _14"> </span>set<span class="_ _14"> </span>becomes<span class="_ _14"> </span>either<span class="_ _14"> </span>terminated<span class="_ _16"> </span>or<span class="_ _14"> </span>stopped.<span class="_ _14"> </span>Return<span class="_ _14"> </span>the<span class="_ _14"> </span>PID<span class="_ _14"> </span>of<span class="_ _14"> </span>the</div><div class="t m5 xcd h26 y6677 ff7 fs19 fc1 sc0 ls0 ws0">terminated<span class="_"> </span>or<span class="_ _13"> </span>stopped<span class="_"> </span>child<span class="_"> </span>that<span class="_ _13"> </span>caused<span class="_"> </span>the<span class="_ _13"> </span>return.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>default<span class="_"> </span>behavior</div><div class="t m5 xcd h26 y6678 ff7 fs19 fc1 sc0 ls0 ws0">returns<span class="_"> </span>only<span class="_ _13"> </span>for<span class="_"> </span>terminated<span class="_"> </span>children;<span class="_"> </span>this<span class="_"> </span>option<span class="_ _13"> </span>is<span class="_"> </span>useful<span class="_"> </span>when<span class="_ _13"> </span>you<span class="_"> </span>want</div><div class="t m5 xcd h26 y6679 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_"> </span>check<span class="_"> </span>for<span class="_"> </span>both<span class="_"> </span>terminated<span class="_"> </span><span class="ffa">and<span class="_"> </span></span>stopped<span class="_"> </span>children.</div><div class="t m5 x75 h26 y667a ff7 fs19 fc1 sc0 ls0 ws0">WCONTINUED<span class="_ _3"></span>.<span class="_ _1f"> </span>Suspend<span class="_ _f"> </span>execution<span class="_ _f"> </span>of<span class="_ _f"> </span>the<span class="_ _f"> </span>calling<span class="_ _e"> </span>process<span class="_ _21"> </span>until<span class="_ _f"> </span>a<span class="_ _f"> </span>running</div><div class="t m5 xcd h26 y667b ff7 fs19 fc1 sc0 ls0 ws0">process<span class="_ _13"> </span>in<span class="_"> </span>the<span class="_ _13"> </span>wait<span class="_"> </span>set<span class="_ _13"> </span>is<span class="_ _13"> </span>terminated<span class="_"> </span>or<span class="_ _13"> </span>until<span class="_"> </span>a<span class="_ _13"> </span>stopped<span class="_ _13"> </span>process<span class="_"> </span>in<span class="_ _13"> </span>the<span class="_"> </span>wait</div><div class="t m5 xcd h26 y667c ff7 fs19 fc1 sc0 ls0 ws0">set<span class="_ _11"> </span>has<span class="_ _16"> </span>been<span class="_ _11"> </span>resumed<span class="_ _11"> </span>by<span class="_ _16"> </span>the<span class="_ _11"> </span>receipt<span class="_ _16"> </span>of<span class="_ _11"> </span>a<span class="_ _11"> </span>SIGCONT<span class="_ _16"> </span>signal.<span class="_ _11"> </span>(Signals<span class="_ _16"> </span>are</div><div class="t m5 xcd h26 y667d ff7 fs19 fc1 sc0 ls0 ws0">explained<span class="_"> </span>in<span class="_"> </span>Section<span class="_"> </span>8.5.)</div><div class="t m5 x29 h26 y667e ff7 fs19 fc1 sc0 ls0 ws0">Y<span class="_ _3"></span>ou<span class="_"> </span>can<span class="_"> </span>combine<span class="_"> </span>options<span class="_"> </span>by<span class="_"> </span><span class="ff9">or</span>ing<span class="_"> </span>them<span class="_"> </span>together.<span class="_"> </span>F<span class="_ _3"></span>or<span class="_"> </span>example:</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
