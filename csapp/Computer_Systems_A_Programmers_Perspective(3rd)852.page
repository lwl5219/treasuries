<div id="pf354" class="pf w2 h11" data-page-no="354"><div class="pc pc354 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg354.png"/><div class="t m5 x6b h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>9.6<span class="_ _60"> </span>Address<span class="_ _10"> </span>T<span class="_ _1"></span>ranslation<span class="_ _3e"> </span><span class="ffe fs1e">851</span></div><div class="t m5 x72 h3f y6dfe ffad fs27 fc1 sc0 ls0 ws0">Page table</div><div class="t m5 x1cd h3f y6dff ffad fs27 fc1 sc0 ls0 ws0">base register</div><div class="t m5 x2f h3f y6e00 ffad fs27 fc1 sc0 ls0 ws0">(PTBR)</div><div class="t m5 x16e h3f y6e01 ff7d fs27 fc1 sc0 ls0 ws0">Physical address</div><div class="t m5 x69 h3f y6e02 ff7d fs27 fc1 sc0 ls0 ws0">Virtual address</div><div class="t m5 x1a h3f y6e03 ffad fs27 fc1 sc0 ls0 ws0">Virtual page number (VPN)<span class="_ _61"> </span>Virtual page offset (VPO)</div><div class="t m5 xf4 h3f y6e04 ffad fs27 fc1 sc0 ls0 ws0">Page</div><div class="t m5 xf4 h3f y6e05 ffad fs27 fc1 sc0 ls0 ws0">table</div><div class="t m5 x66 h3f y6e06 ffad fs27 fc1 sc0 ls0 ws0">V<span class="_ _1"></span>alid</div><div class="t m5 x76 h3f y6e07 ffad fs27 fc1 sc0 ls0 ws0">Physical page number (PPN)</div><div class="t m5 x21e h3f y6e08 ffad fs27 fc1 sc0 ls0 ws0">The VPN acts</div><div class="t m5 x21e h3f y6e09 ffad fs27 fc1 sc0 ls0 ws0">as an index into</div><div class="t m5 x21e h3f y6e0a ffad fs27 fc1 sc0 ls0 ws0">the page table</div><div class="t m5 xd1 h3f y6e0b ffad fs27 fc1 sc0 ls0 ws0">If valid = 0,</div><div class="t m5 xd1 h3f y6e0c ffad fs27 fc1 sc0 ls0 ws0">then page</div><div class="t m5 xd1 h3f y6e0d ffad fs27 fc1 sc0 ls0 ws0">not in memory</div><div class="t m5 xd1 h3f y6e0e ffad fs27 fc1 sc0 ls0 ws0">(page fault)</div><div class="t m5 x59 h3f y6e0f ffad fs27 fc1 sc0 ls0 ws0">Physical page number (PPN)<span class="_ _3f"> </span>Physical page of<span class="_ _0"></span>fset (PPO)</div><div class="t m5 x145 h65 y6e10 ffae fs38 fc1 sc0 ls0 ws0">n<span class="_ _2"></span><span class="ffad">–1</span></div><div class="t m5 x39 h65 y6e11 ffae fs38 fc1 sc0 ls0 ws0">p<span class="ffad">   </span>p<span class="_ _2"></span><span class="ffad">–1</span></div><div class="t m5 x39 h65 y6e12 ffae fs38 fc1 sc0 ls0 ws0">p<span class="ffad">   </span>p<span class="_ _2"></span><span class="ffad">–1</span></div><div class="t m5 x133 h65 y6e13 ffad fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 x1cc h65 y6e14 ffae fs38 fc1 sc0 ls0 ws0">m<span class="_ _2"></span><span class="ffad">–1</span></div><div class="t m5 x111 h65 y6e15 ffad fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 x17 h2f y6e16 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>9.12<span class="_ _66"> </span><span class="fc1">Address<span class="_"> </span>translation<span class="_"> </span>with<span class="_"> </span>a<span class="_"> </span>page<span class="_"> </span>table.</span></div><div class="t m5 x26 h26 y6e17 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _11"> </span>9.13(a)<span class="_ _11"> </span>shows<span class="_ _16"> </span>the<span class="_"> </span>steps<span class="_ _11"> </span>that<span class="_ _11"> </span>the<span class="_ _11"> </span>CPU<span class="_ _11"> </span>hardware<span class="_ _11"> </span>performs<span class="_ _11"> </span>when<span class="_ _16"> </span>there</div><div class="t m5 x17 h26 y6e18 ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_"> </span>a<span class="_"> </span>page<span class="_"> </span>hit.</div><div class="t m5 x72 h26 y6e19 ffa fs19 fc1 sc0 ls0 ws0">Step<span class="_"> </span>1.<span class="_ _21"> </span><span class="ff7">T<span class="_ _0"></span>he<span class="_"> </span>processor<span class="_"> </span>generates<span class="_"> </span>a<span class="_"> </span>virtual<span class="_"> </span>address<span class="_"> </span>and<span class="_"> </span>sends<span class="_"> </span>it<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>MMU<span class="_ _3"></span>.</span></div><div class="t m5 x72 h26 y6e1a ffa fs19 fc1 sc0 ls0 ws0">Step<span class="_ _11"> </span>2.<span class="_ _21"> </span><span class="ff7">The<span class="_ _11"> </span>MMU<span class="_ _11"> </span>generates<span class="_ _16"> </span>the<span class="_ _11"> </span>PTE<span class="_ _16"> </span>address<span class="_ _11"> </span>and<span class="_ _11"> </span>requests<span class="_ _16"> </span>it<span class="_ _11"> </span>from<span class="_ _16"> </span>the<span class="_ _11"> </span>cache/</span></div><div class="t m5 x30 h26 y6e1b ff7 fs19 fc1 sc0 ls0 ws0">main<span class="_"> </span>memory<span class="_ _3"></span>.</div><div class="t m5 x72 h26 y6e1c ffa fs19 fc1 sc0 ls0 ws0">Step<span class="_"> </span>3.<span class="_ _21"> </span><span class="ff7">T<span class="_ _0"></span>he<span class="_"> </span>cache/main<span class="_"> </span>memory<span class="_"> </span>returns<span class="_"> </span>the<span class="_"> </span>PTE<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>MMU<span class="_ _3"></span>.</span></div><div class="t m5 x72 h26 y6e1d ffa fs19 fc1 sc0 ls0 ws0">Step<span class="_ _6"> </span>4.<span class="_ _f"> </span><span class="ff7">T<span class="_ _1"></span>he<span class="_ _13"> </span>MMU<span class="_ _6"> </span>constructs<span class="_ _13"> </span>the<span class="_ _6"> </span>physical<span class="_ _13"> </span>address<span class="_ _6"> </span>and<span class="_ _6"> </span>sends<span class="_ _13"> </span>it<span class="_ _6"> </span>to<span class="_ _13"> </span>the<span class="_ _6"> </span>cache/main</span></div><div class="t m5 x30 h26 y6e1e ff7 fs19 fc1 sc0 ls0 ws0">memory<span class="_ _3"></span>.</div><div class="t m5 x72 h26 y6e1f ffa fs19 fc1 sc0 ls0 ws0">Step<span class="_ _16"> </span>5.<span class="_ _21"> </span><span class="ff7">The<span class="_ _16"> </span>cache/main<span class="_ _16"> </span>memory<span class="_ _16"> </span>returns<span class="_ _14"> </span>the<span class="_ _16"> </span>requested<span class="_ _14"> </span>data<span class="_ _16"> </span>word<span class="_ _14"> </span>to<span class="_ _16"> </span>the<span class="_ _14"> </span>pro-</span></div><div class="t m5 x30 h26 y6e20 ff7 fs19 fc1 sc0 ls0 ws0">cessor.</div><div class="t m5 x26 h26 y6e21 ff7 fs19 fc1 sc0 ls0 ws0">Unlike<span class="_ _14"> </span>a<span class="_ _14"> </span>page<span class="_ _14"> </span>hit,<span class="_ _15"> </span>which<span class="_ _14"> </span>is<span class="_ _15"> </span>handled<span class="_ _14"> </span>entirely<span class="_ _14"> </span>by<span class="_ _14"> </span>hardware<span class="_ _0"></span>,<span class="_ _15"> </span>handling<span class="_ _14"> </span>a<span class="_ _14"> </span>page</div><div class="t m5 x17 h26 y6e22 ff7 fs19 fc1 sc0 ls0 ws0">fault<span class="_ _15"> </span>requires<span class="_ _14"> </span>cooperation<span class="_ _15"> </span>between<span class="_ _15"> </span>hardware<span class="_ _15"> </span>and<span class="_ _15"> </span>the<span class="_ _15"> </span>operating<span class="_ _15"> </span>system<span class="_ _15"> </span>kernel</div><div class="t m5 x17 h26 y6e23 ff7 fs19 fc1 sc0 ls0 ws0">(F<span class="_ _1"></span>igure<span class="_"> </span>9.13(b)).</div><div class="t m5 x72 h26 y6e24 ffa fs19 fc1 sc0 ls0 ws0">Steps<span class="_"> </span>1<span class="_"> </span>to<span class="_"> </span>3.<span class="_ _21"> </span><span class="ff7">T<span class="_ _0"></span>he<span class="_"> </span>same<span class="_"> </span>as<span class="_"> </span>steps<span class="_"> </span>1<span class="_"> </span>to<span class="_"> </span>3<span class="_"> </span>in<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>9.13(a).</span></div><div class="t m5 x72 h26 y6e25 ffa fs19 fc1 sc0 ls0 ws0">Step<span class="_ _14"> </span>4.<span class="_ _21"> </span><span class="ff7">The<span class="_ _16"> </span>valid<span class="_ _15"> </span>bit<span class="_ _14"> </span>in<span class="_ _14"> </span>the<span class="_ _15"> </span>PTE<span class="_ _14"> </span>is<span class="_ _14"> </span>zero,<span class="_ _14"> </span>so<span class="_ _15"> </span>the<span class="_ _14"> </span>MMU<span class="_ _14"> </span>triggers<span class="_ _15"> </span>an<span class="_ _14"> </span>exception,</span></div><div class="t m5 x30 h26 y6e26 ff7 fs19 fc1 sc0 ls0 ws0">which<span class="_ _11"> </span>transfers<span class="_ _16"> </span>control<span class="_ _11"> </span>in<span class="_ _16"> </span>the<span class="_ _11"> </span>CPU<span class="_ _16"> </span>to<span class="_ _11"> </span>a<span class="_ _16"> </span>page<span class="_ _11"> </span>fault<span class="_ _11"> </span>exception<span class="_ _16"> </span>handler<span class="_ _11"> </span>in</div><div class="t m5 x30 h26 y6e27 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>operating<span class="_"> </span>system<span class="_"> </span>kernel.</div><div class="t m5 x72 h26 y6e28 ffa fs19 fc1 sc0 ls0 ws0">Step<span class="_ _13"> </span>5.<span class="_ _21"> </span><span class="ff7">T<span class="_ _1"></span>he<span class="_ _13"> </span>fault<span class="_ _13"> </span>handler<span class="_ _13"> </span>identiﬁes<span class="_ _13"> </span>a<span class="_ _13"> </span>victim<span class="_ _13"> </span>page<span class="_ _13"> </span>in<span class="_ _13"> </span>physical<span class="_ _13"> </span>memory<span class="_ _7"></span>,<span class="_"> </span>and<span class="_ _13"> </span>if<span class="_ _13"> </span>that</span></div><div class="t m5 x30 h26 y6e29 ff7 fs19 fc1 sc0 ls0 ws0">page<span class="_"> </span>has<span class="_"> </span>been<span class="_"> </span>modiﬁed,<span class="_"> </span>pages<span class="_"> </span>it<span class="_"> </span>out<span class="_"> </span>to<span class="_"> </span>disk.</div><div class="t m5 x72 h26 y6e2a ffa fs19 fc1 sc0 ls0 ws0">Step<span class="_ _6"> </span>6.<span class="_ _21"> </span><span class="ff7">T<span class="_ _0"></span>he<span class="_ _6"> </span>fault<span class="_ _6"> </span>handler<span class="_ _6"> </span>pages<span class="_ _6"> </span>in<span class="_ _6"> </span>the<span class="_ _6"> </span>new<span class="_ _6"> </span>page<span class="_ _6"> </span>and<span class="_ _6"> </span>updates<span class="_ _6"> </span>the<span class="_ _6"> </span>PTE<span class="_ _13"> </span>in<span class="_ _a"> </span>memory<span class="_ _3"></span>.</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
