<div id="pf25d" class="pf w2 h11" data-page-no="25d"><div class="pc pc25d w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg25d.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">604<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>5<span class="_ _3d"> </span>Optimizing<span class="_ _10"> </span>Program<span class="_ _10"> </span>Performance</span></div><div class="t m5 x29 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>inally<span class="_ _3"></span>,<span class="_ _11"> </span>we<span class="_ _11"> </span>have<span class="_ _11"> </span>reduced<span class="_"> </span>the<span class="_ _11"> </span>run<span class="_ _11"> </span>time<span class="_"> </span>to<span class="_ _11"> </span>the<span class="_ _11"> </span>point<span class="_ _11"> </span>where<span class="_"> </span>most<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_"> </span>time<span class="_ _11"> </span>is</div><div class="t m5 x1d h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">spent<span class="_ _6"> </span>in<span class="_ _13"> </span><span class="ffd">strlen</span>,<span class="_ _13"> </span>and<span class="_ _6"> </span>most<span class="_ _13"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>calls<span class="_ _6"> </span>to<span class="_ _13"> </span><span class="ffd">strlen<span class="_ _6"> </span></span>occur<span class="_ _13"> </span>as<span class="_ _6"> </span>part<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _6"> </span>lowercase<span class="_ _13"> </span>con-</div><div class="t m5 x1d h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">version.<span class="_ _11"> </span>W<span class="_ _1"></span>e<span class="_ _11"> </span>have<span class="_ _16"> </span>already<span class="_ _11"> </span>seen<span class="_ _11"> </span>that<span class="_ _16"> </span>function<span class="_ _11"> </span><span class="ffd">lower1<span class="_ _16"> </span></span>has<span class="_ _11"> </span>quadratic<span class="_ _16"> </span>performance<span class="_ _1"></span>,</div><div class="t m5 x1d h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">especially<span class="_"> </span>for<span class="_"> </span>long<span class="_"> </span>strings<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>words<span class="_"> </span>in<span class="_"> </span>this<span class="_"> </span>document<span class="_"> </span>are<span class="_"> </span>short<span class="_"> </span>enough<span class="_"> </span>to<span class="_"> </span>avoid</div><div class="t m5 x1d h26 y2f8 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>disastrous<span class="_"> </span>consequences<span class="_"> </span>of<span class="_"> </span>quadratic<span class="_"> </span>performance;<span class="_ _11"> </span>the<span class="_"> </span>longest<span class="_"> </span>bigram<span class="_"> </span>is<span class="_"> </span>just</div><div class="t m5 x1d h26 y2f9 ff7 fs19 fc2 sc0 ls0 ws0">32<span class="_"> </span>characters<span class="_ _1"></span>.<span class="_"> </span>Still,<span class="_"> </span>switching<span class="_"> </span>to<span class="_"> </span><span class="ffd">lower2</span>,<span class="_"> </span>shown<span class="_"> </span>as<span class="_"> </span>“Linear<span class="_"> </span>lower,<span class="_ _3"></span>”<span class="_"> </span>yields<span class="_"> </span>a<span class="_"> </span>signif-</div><div class="t m5 x1d h26 y2fa ff7 fs19 fc2 sc0 ls0 ws0">icant<span class="_"> </span>improvement,<span class="_"> </span>with<span class="_"> </span>the<span class="_"> </span>overall<span class="_"> </span>time<span class="_"> </span>dropping<span class="_"> </span>to<span class="_"> </span>around<span class="_"> </span>0.2<span class="_"> </span>seconds<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y2fb ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _1"></span>ith<span class="_ _e"> </span>this<span class="_ _21"> </span>exercise,<span class="_ _e"> </span>we<span class="_ _21"> </span>have<span class="_ _e"> </span>shown<span class="_ _21"> </span>that<span class="_ _e"> </span>code<span class="_ _21"> </span>proﬁling<span class="_ _f"> </span>can<span class="_ _e"> </span>help<span class="_ _21"> </span>drop<span class="_ _e"> </span>the</div><div class="t m5 x1d h26 y2fc ff7 fs19 fc2 sc0 ls0 ws0">time<span class="_ _15"> </span>required<span class="_ _21"> </span>for<span class="_ _21"> </span>a<span class="_ _21"> </span>simple<span class="_ _21"> </span>application<span class="_ _21"> </span>from<span class="_ _21"> </span>3.5<span class="_ _21"> </span>minutes<span class="_ _21"> </span>down<span class="_ _15"> </span>to<span class="_ _21"> </span>0.2<span class="_ _21"> </span>seconds<span class="_ _1"></span>,</div><div class="t m5 x1d h46 y2fd ff7 fs19 fc2 sc0 ls0 ws0">yielding<span class="_ _14"> </span>a<span class="_ _14"> </span>performance<span class="_ _15"> </span>gain<span class="_ _14"> </span>of<span class="_ _15"> </span>around<span class="_ _14"> </span>1,000<span class="ff12">×</span>.<span class="_ _14"> </span>The<span class="_ _16"> </span>proﬁler<span class="_ _15"> </span>helps<span class="_ _14"> </span>us<span class="_ _14"> </span>focus<span class="_ _15"> </span>our</div><div class="t m5 x1d h26 y2fe ff7 fs19 fc2 sc0 ls0 ws0">attention<span class="_ _14"> </span>on<span class="_ _15"> </span>the<span class="_ _15"> </span>most<span class="_ _15"> </span>time-consuming<span class="_ _15"> </span>parts<span class="_ _15"> </span>of<span class="_ _15"> </span>the<span class="_ _14"> </span>program<span class="_ _15"> </span>and<span class="_ _15"> </span>also<span class="_ _15"> </span>provides</div><div class="t m5 x1d h26 y2ff ff7 fs19 fc2 sc0 ls0 ws0">useful<span class="_ _16"> </span>information<span class="_ _14"> </span>about<span class="_ _14"> </span>the<span class="_ _16"> </span>procedure<span class="_ _14"> </span>call<span class="_ _14"> </span>structure<span class="_ _0"></span>.<span class="_ _16"> </span>Some<span class="_ _14"> </span>of<span class="_ _14"> </span>the<span class="_ _16"> </span>bottlenecks</div><div class="t m5 x1d h26 y300 ff7 fs19 fc2 sc0 ls0 ws0">in<span class="_ _16"> </span>our<span class="_ _16"> </span>code<span class="_ _1"></span>,<span class="_ _14"> </span>such<span class="_ _16"> </span>as<span class="_ _16"> </span>using<span class="_ _16"> </span>a<span class="_ _16"> </span>quadratic<span class="_ _16"> </span>sort<span class="_ _16"> </span>routine<span class="_ _1"></span>,<span class="_ _16"> </span>are<span class="_ _16"> </span>easy<span class="_ _16"> </span>to<span class="_ _16"> </span>anticipate,<span class="_ _16"> </span>while</div><div class="t m5 x1d h26 y21a ff7 fs19 fc2 sc0 ls0 ws0">others<span class="_ _1"></span>,<span class="_ _11"> </span>such<span class="_ _11"> </span>as<span class="_ _11"> </span>whether<span class="_ _16"> </span>to<span class="_"> </span>append<span class="_ _16"> </span>to<span class="_"> </span>the<span class="_ _11"> </span>beginning<span class="_ _16"> </span>or<span class="_"> </span>end<span class="_ _16"> </span>of<span class="_"> </span>a<span class="_ _11"> </span>list,<span class="_ _16"> </span>emerge<span class="_ _11"> </span>only</div><div class="t m5 x1d h26 y450 ff7 fs19 fc2 sc0 ls0 ws0">through<span class="_"> </span>a<span class="_"> </span>careful<span class="_"> </span>analysis<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y451 ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_"> </span>can<span class="_"> </span>see<span class="_ _11"> </span>that<span class="_"> </span>proﬁling<span class="_"> </span>is<span class="_"> </span>a<span class="_ _11"> </span>useful<span class="_"> </span>tool<span class="_"> </span>to<span class="_"> </span>have<span class="_ _11"> </span>in<span class="_"> </span>the<span class="_"> </span>toolbox,<span class="_"> </span>but<span class="_"> </span>it<span class="_ _11"> </span>should</div><div class="t m5 x1d h26 y452 ff7 fs19 fc2 sc0 ls0 ws0">not<span class="_ _6"> </span>be<span class="_ _13"> </span>the<span class="_ _6"> </span>only<span class="_ _6"> </span>one.<span class="_ _6"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span>timing<span class="_ _6"> </span>measurements<span class="_ _6"> </span>are<span class="_ _13"> </span>imperfect,<span class="_ _6"> </span>especially<span class="_ _13"> </span>for<span class="_ _6"> </span>shorter</div><div class="t m5 x1d h26 y453 ff7 fs19 fc2 sc0 ls0 ws0">(less<span class="_ _14"> </span>than<span class="_ _14"> </span>1<span class="_ _14"> </span>second)<span class="_ _14"> </span>run<span class="_ _16"> </span>times<span class="_ _0"></span>.<span class="_ _14"> </span>More<span class="_ _14"> </span>signiﬁcantly<span class="_ _3"></span>,<span class="_ _14"> </span>the<span class="_ _14"> </span>results<span class="_ _14"> </span>apply<span class="_ _14"> </span>only<span class="_ _14"> </span>to<span class="_ _14"> </span>the</div><div class="t m5 x1d h26 y454 ff7 fs19 fc2 sc0 ls0 ws0">particular<span class="_ _16"> </span>data<span class="_ _16"> </span>tested.<span class="_ _16"> </span>F<span class="_ _1"></span>or<span class="_ _16"> </span>example,<span class="_ _16"> </span>if<span class="_ _16"> </span>we<span class="_ _16"> </span>had<span class="_ _16"> </span>run<span class="_ _16"> </span>the<span class="_ _16"> </span>original<span class="_ _14"> </span>function<span class="_ _16"> </span>on<span class="_ _16"> </span>data</div><div class="t m5 x1d h26 y455 ff7 fs19 fc2 sc0 ls0 ws0">consisting<span class="_ _16"> </span>of<span class="_ _16"> </span>a<span class="_ _14"> </span>smaller<span class="_ _16"> </span>number<span class="_ _16"> </span>of<span class="_ _14"> </span>longer<span class="_ _16"> </span>strings<span class="_ _1"></span>,<span class="_ _14"> </span>we<span class="_ _14"> </span>would<span class="_ _16"> </span>have<span class="_ _16"> </span>found<span class="_ _14"> </span>that<span class="_ _16"> </span>the</div><div class="t m5 x1d h26 y456 ff7 fs19 fc2 sc0 ls0 ws0">lowercase<span class="_ _13"> </span>conversion<span class="_ _6"> </span>routine<span class="_ _13"> </span>was<span class="_ _6"> </span>the<span class="_ _13"> </span>major<span class="_ _6"> </span>performance<span class="_ _13"> </span>bottleneck.<span class="_ _13"> </span>Even<span class="_ _6"> </span>worse<span class="_ _0"></span>,</div><div class="t m5 x1d h26 y457 ff7 fs19 fc2 sc0 ls0 ws0">if<span class="_ _15"> </span>it<span class="_ _21"> </span>only<span class="_ _21"> </span>proﬁled<span class="_ _21"> </span>documents<span class="_ _21"> </span>with<span class="_ _21"> </span>short<span class="_ _21"> </span>words<span class="_ _1"></span>,<span class="_ _e"> </span>we<span class="_ _15"> </span>might<span class="_ _21"> </span>never<span class="_ _21"> </span>detect<span class="_ _21"> </span>hidden</div><div class="t m5 x1d h26 y458 ff7 fs19 fc2 sc0 ls0 ws0">bottlenecks<span class="_ _13"> </span>such<span class="_ _6"> </span>as<span class="_ _13"> </span>the<span class="_ _13"> </span>quadratic<span class="_ _6"> </span>performance<span class="_ _13"> </span>of<span class="_ _13"> </span><span class="ffd">lower1</span>.<span class="_ _6"> </span>In<span class="_ _13"> </span>general,<span class="_ _13"> </span>proﬁling<span class="_ _13"> </span>can</div><div class="t m5 x1d h26 y459 ff7 fs19 fc2 sc0 ls0 ws0">help<span class="_ _13"> </span>us<span class="_ _13"> </span>optimize<span class="_ _13"> </span>for<span class="_ _13"> </span><span class="ffa">typical<span class="_"> </span></span>cases<span class="_ _1"></span>,<span class="_ _13"> </span>assuming<span class="_"> </span>we<span class="_ _13"> </span>run<span class="_ _13"> </span>the<span class="_ _13"> </span>program<span class="_ _13"> </span>on<span class="_ _13"> </span>representative</div><div class="t m5 x1d h26 y45a ff7 fs19 fc2 sc0 ls0 ws0">data,<span class="_ _13"> </span>but<span class="_ _a"> </span>we<span class="_ _6"> </span>should<span class="_ _13"> </span>also<span class="_ _a"> </span>make<span class="_ _6"> </span>sure<span class="_ _13"> </span>the<span class="_ _a"> </span>program<span class="_ _13"> </span>will<span class="_ _a"> </span>have<span class="_ _6"> </span>respectable<span class="_ _13"> </span>performance</div><div class="t m5 x1d h26 y45b ff7 fs19 fc2 sc0 ls0 ws0">for<span class="_"> </span>all<span class="_"> </span>possible<span class="_"> </span>cases<span class="_ _1"></span>.<span class="_"> </span>This<span class="_"> </span>mainly<span class="_"> </span>involves<span class="_"> </span>avoiding<span class="_"> </span>algorithms<span class="_"> </span>(such<span class="_"> </span>as<span class="_"> </span>insertion</div><div class="t m5 x1d h26 y45c ff7 fs19 fc2 sc0 ls0 ws0">sort)<span class="_ _13"> </span>and<span class="_"> </span>bad<span class="_ _13"> </span>programming<span class="_"> </span>practices<span class="_ _13"> </span>(such<span class="_ _13"> </span>as<span class="_"> </span><span class="ffd">lower1</span>)<span class="_ _13"> </span>that<span class="_"> </span>yield<span class="_ _13"> </span>poor<span class="_ _13"> </span>asymptotic</div><div class="t m5 x1d h26 y227 ff7 fs19 fc2 sc0 ls0 ws0">performance<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y45d ff7 fs19 fc2 sc0 ls0 ws0">Amdahl’s<span class="_ _16"> </span>law<span class="_ _7"></span>,<span class="_ _14"> </span>described<span class="_ _14"> </span>in<span class="_ _16"> </span>Section<span class="_ _14"> </span>1.9.1,<span class="_ _14"> </span>provides<span class="_ _16"> </span>some<span class="_ _14"> </span>additional<span class="_ _16"> </span>insights</div><div class="t m5 x1d h26 y45e ff7 fs19 fc2 sc0 ls0 ws0">into<span class="_ _6"> </span>the<span class="_ _13"> </span>performance<span class="_ _6"> </span>gains<span class="_ _13"> </span>that<span class="_ _6"> </span>can<span class="_ _6"> </span>be<span class="_ _13"> </span>obtained<span class="_ _6"> </span>by<span class="_ _13"> </span>targeted<span class="_ _a"> </span>optimizations<span class="_ _0"></span>.<span class="_ _6"> </span>F<span class="_ _1"></span>or<span class="_ _13"> </span>our</div><div class="t m5 x1d h26 y4ad ff11 fs19 fc2 sc0 ls0 ws0">n<span class="ff7">-gram<span class="_ _13"> </span>code<span class="_ _1"></span>,<span class="_ _13"> </span>we<span class="_ _13"> </span>saw<span class="_ _13"> </span>the<span class="_ _13"> </span>total<span class="_ _13"> </span>execution<span class="_ _13"> </span>time<span class="_ _13"> </span>drop<span class="_ _13"> </span>from<span class="_ _13"> </span>209.0<span class="_ _13"> </span>to<span class="_ _13"> </span>5.4<span class="_ _13"> </span>seconds<span class="_ _13"> </span>when</span></div><div class="t m5 x1d h26 y45f ff7 fs19 fc2 sc0 ls0 ws0">we<span class="_ _13"> </span>replaced<span class="_"> </span>insertion<span class="_ _13"> </span>sort<span class="_"> </span>by<span class="_ _13"> </span>quicksort.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>initial<span class="_ _13"> </span>version<span class="_"> </span>spent<span class="_ _13"> </span>203.7<span class="_"> </span>of<span class="_ _13"> </span>its<span class="_"> </span>209.0</div><div class="t m5 x1d h46 y460 ff7 fs19 fc2 sc0 ls0 ws0">seconds<span class="_ _16"> </span>performing<span class="_ _11"> </span>insertion<span class="_ _16"> </span>sort,<span class="_ _16"> </span>giving<span class="_ _16"> </span><span class="ff11">α<span class="_ _11"> </span><span class="ff12">=<span class="_ _10"> </span></span></span>0<span class="ff11">.</span><span class="ls20">974,<span class="_ _16"> </span>the<span class="_ _16"> </span>fraction<span class="_ _16"> </span>of<span class="_ _11"> </span>time<span class="_ _16"> </span>subject</span></div><div class="t m5 x1d h26 y461 ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_ _16"> </span>speedup<span class="_ _0"></span>.<span class="_ _16"> </span>With<span class="_ _16"> </span>quicksort,<span class="_ _14"> </span>the<span class="_ _16"> </span>time<span class="_ _16"> </span>spent<span class="_ _14"> </span>sorting<span class="_ _16"> </span>becomes<span class="_ _14"> </span>negligible<span class="_ _0"></span>,<span class="_ _14"> </span>giving<span class="_ _16"> </span>a</div><div class="t m5 x1d h46 y322 ff7 fs19 fc2 sc0 ls0 ws0">predicted<span class="_ _16"> </span>speedup<span class="_ _14"> </span>of<span class="_ _14"> </span>209<span class="ff11">/α<span class="_ _11"> </span><span class="ff12">=<span class="_ _10"> </span></span></span>39<span class="ff11">.</span><span class="ls58">0,<span class="_ _14"> </span>close<span class="_ _16"> </span>to<span class="_ _14"> </span>the<span class="_ _14"> </span>measured<span class="_ _14"> </span>speedup<span class="_ _16"> </span>of<span class="_ _14"> </span>38</span><span class="ff11">.</span><span class="ls97">5.<span class="_ _15"> </span>W<span class="_ _1"></span>e</span></div><div class="t m5 x1d h26 y323 ff7 fs19 fc2 sc0 ls0 ws0">were<span class="_ _13"> </span>able<span class="_ _13"> </span>to<span class="_ _13"> </span>gain<span class="_ _13"> </span>a<span class="_ _13"> </span>large<span class="_ _13"> </span>speedup<span class="_ _13"> </span>because<span class="_ _13"> </span>sorting<span class="_ _13"> </span>constituted<span class="_ _13"> </span>a<span class="_ _13"> </span>very<span class="_ _13"> </span>large<span class="_"> </span>fraction</div><div class="t m5 x1d h26 y324 ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_ _13"> </span>the<span class="_ _13"> </span>overall<span class="_"> </span>execution<span class="_ _13"> </span>time<span class="_ _1"></span>.<span class="_"> </span>However<span class="_ _1"></span>,<span class="_"> </span>when<span class="_ _13"> </span>one<span class="_ _13"> </span>bottleneck<span class="_ _13"> </span>is<span class="_"> </span>eliminated,<span class="_ _13"> </span>a<span class="_ _13"> </span>new</div><div class="t m5 x1d h26 y325 ff7 fs19 fc2 sc0 ls0 ws0">one<span class="_"> </span>arises<span class="_ _1"></span>,<span class="_"> </span>and<span class="_"> </span>so<span class="_"> </span>gaining<span class="_"> </span>additional<span class="_"> </span>speedup<span class="_"> </span>required<span class="_"> </span>focusing<span class="_"> </span>on<span class="_"> </span>other<span class="_"> </span>parts<span class="_"> </span>of</div><div class="t m5 x1d h26 y326 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>program.</div><div class="t m5 x1d h3b y8d5 fff fs24 fc6 sc0 ls0 ws0">5.15<span class="_ _17"> </span><span class="ffe fs18">Summar<span class="_ _2"></span>y</span></div><div class="t m5 x1d h26 y7a6 ff7 fs19 fc1 sc0 ls0 ws0">Although<span class="_ _16"> </span>most<span class="_ _16"> </span>presentations<span class="_ _16"> </span>on<span class="_ _16"> </span>code<span class="_ _16"> </span>optimization<span class="_ _16"> </span>describe<span class="_ _16"> </span>how<span class="_ _16"> </span>compilers<span class="_ _16"> </span>can</div><div class="t m5 x1d h26 y7a7 ff7 fs19 fc1 sc0 ls0 ws0">generate<span class="_ _13"> </span>efﬁcient<span class="_"> </span>code<span class="_ _1"></span>,<span class="_ _13"> </span>much<span class="_"> </span>can<span class="_ _13"> </span>be<span class="_ _13"> </span>done<span class="_"> </span>by<span class="_ _13"> </span>an<span class="_ _13"> </span>application<span class="_ _13"> </span>programmer<span class="_"> </span>to<span class="_ _13"> </span>assist</div><div class="t m5 x1d h26 y7a8 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _13"> </span>compiler<span class="_"> </span>in<span class="_ _13"> </span>this<span class="_"> </span>task.<span class="_ _13"> </span>No<span class="_"> </span>compiler<span class="_ _13"> </span>can<span class="_ _13"> </span>replace<span class="_"> </span>an<span class="_ _13"> </span>inefﬁcient<span class="_"> </span>algorithm<span class="_ _13"> </span>or<span class="_ _13"> </span>data</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
