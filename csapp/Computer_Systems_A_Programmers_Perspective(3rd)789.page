<div id="pf315" class="pf w2 h11" data-page-no="315"><div class="pc pc315 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg315.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">788<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>8<span class="_ _3d"> </span>Exceptional<span class="_ _10"> </span>Control<span class="_ _10"> </span>Flow</span></div><div class="t m5 x14 h2f ye7 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>8.22</div><div class="t m5 x14 h2f y58a ffe fs16 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>ypical<span class="_ _16"> </span>organization<span class="_ _16"> </span>of</div><div class="t m5 x14 h2f y58b ffe fs16 fc1 sc0 ls0 ws0">the<span class="_ _16"> </span>user<span class="_ _16"> </span>stack<span class="_ _16"> </span>when<span class="_ _14"> </span>a</div><div class="t m5 x14 h2f y58c ffe fs16 fc1 sc0 ls0 ws0">new<span class="_"> </span>program<span class="_"> </span>starts.</div><div class="t m5 x108 h3f y6726 ff9c fs27 fc1 sc0 ls0 ws0">Bottom of stack</div><div class="t m5 x108 h3f y6727 ff9c fs27 fc1 sc0 ls0 ws0">T<span class="_ _3"></span>op of stack</div><div class="t m5 x187 h3f y6728 ff9c fs27 fc1 sc0 ls0 ws0">Null-terminated</div><div class="t m5 xe3 h3f y6729 ff9c fs27 fc1 sc0 ls0 ws0">environment variable strings</div><div class="t m5 x187 h3f y672a ff9c fs27 fc1 sc0 ls0 ws0">Null-terminated</div><div class="t m5 x69 h3f y672b ff9c fs27 fc1 sc0 ls0 ws0">command-line arg strings</div><div class="t m5 x187 h3f y672c ff9c fs27 fc1 sc0 ls0 ws0">Stack frame for</div><div class="t m5 x119 h70 y672d ff9d fs27 fc1 sc0 ls0 ws0">libc_start_main</div><div class="t m5 xd3 h3f y672e ff9c fs27 fc1 sc0 ls0 ws0">Future stack frame for</div><div class="t m5 xb1 h70 y672f ff9d fs27 fc1 sc0 ls0 ws0">main</div><div class="t m5 x119 h70 y6730 ff9d fs27 fc1 sc0 ls0 ws0">envp[n] == NULL</div><div class="t m5 x139 h70 y6731 ff9d fs27 fc1 sc0 ls0 ws0">envp[n-1]</div><div class="t m5 x1db h103 y6732 ff90 fs27 fc1 sc0 ls0 ws0">…</div><div class="t m5 x1db h103 y6733 ff90 fs27 fc1 sc0 ls0 ws0">…</div><div class="t m5 x7f h70 y6734 ff9d fs27 fc1 sc0 ls0 ws0">envp[0]</div><div class="t m5 x16 h70 y6735 ff9d fs27 fc1 sc0 ls0 ws0">argv[argc] = NULL</div><div class="t m5 x187 h70 y6736 ff9d fs27 fc1 sc0 ls0 ws0">argv[argc-1] </div><div class="t m5 x7f h70 y6737 ff9d fs27 fc1 sc0 ls0 ws0">argv[0]</div><div class="t m5 x172 h70 y6738 ff9d fs27 fc1 sc0 ls0 ws0">environ</div><div class="t m5 x5f h3f y6739 ff9c fs27 fc1 sc0 ls0 ws0">(global var)</div><div class="t m5 x1c0 h70 y673a ff9d fs27 fc1 sc0 ls0 ws0">envp</div><div class="t m5 x133 h3f y673b ff9c fs27 fc1 sc0 ls0 ws0">(in <span class="ff9d">%rdx</span>)</div><div class="t m5 x25 h70 y673c ff9d fs27 fc1 sc0 ls0 ws0">argv</div><div class="t m5 x129 h3f y673d ff9c fs27 fc1 sc0 ls0 ws0">(in <span class="ff9d">%rsi</span>)</div><div class="t m5 x25 h70 y673e ff9d fs27 fc1 sc0 ls0 ws0">argc</div><div class="t m5 x129 h3f y673f ff9c fs27 fc1 sc0 ls0 ws0">(in <span class="ff9d">%rdi</span>)</div><div class="t m5 x1d h26 y6740 ff7 fs19 fc1 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _14"> </span><span class="ffd ls0">getenv<span class="_ _16"> </span><span class="ff7">function<span class="_ _11"> </span>searches<span class="_ _16"> </span>the<span class="_ _16"> </span>environment<span class="_ _16"> </span>array<span class="_ _16"> </span>for<span class="_ _11"> </span>a<span class="_ _16"> </span>string<span class="_ _16"> </span></span>name=<span class="ffa">value</span></span><span class="ls281">.I<span class="_ _49"></span>f</span></div><div class="t m5 x1d h26 y6741 ff7 fs19 fc1 sc0 ls0 ws0">found,<span class="_"> </span>it<span class="_"> </span>returns<span class="_"> </span>a<span class="_"> </span>pointer<span class="_"> </span>to<span class="_"> </span><span class="ffa">value</span>;<span class="_"> </span>otherwise<span class="_ _0"></span>,<span class="_"> </span>it<span class="_"> </span>returns<span class="_"> </span><span class="ffd">NULL</span>.</div><div class="t m5 x126 h2d y6742 ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;stdlib.h&gt;</div><div class="t m5 x126 h2d y6743 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>setenv(const<span class="_ _1f"> </span>char<span class="_ _1f"> </span>*name,<span class="_ _e"> </span>const<span class="_ _1f"> </span>char<span class="_ _e"> </span>*newvalue,<span class="_ _1f"> </span>int<span class="_ _1f"> </span>overwrite);</div><div class="t m5 x195 hf2 y6744 ff7 fs1f fc2 sc0 ls0 ws0">Returns:<span class="_"> </span>0<span class="_"> </span>on<span class="_"> </span>success<span class="_ _1"></span>,<span class="_"> </span><span class="ff12">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m5 x126 h2d y6745 ffd fs1e fc2 sc0 ls0 ws0">void<span class="_ _e"> </span>unsetenv(const<span class="_ _1f"> </span>char<span class="_ _1f"> </span>*name);</div><div class="t m5 x46 hf1 y6746 ff7 fs1f fc2 sc0 ls0 ws0">Returns:<span class="_"> </span>nothing</div><div class="t m5 x1d h26 y6747 ff7 fs19 fc2 sc0 ls0 ws0">If<span class="_ _e"> </span>the<span class="_ _e"> </span>environment<span class="_ _1f"> </span>array<span class="_ _e"> </span>contains<span class="_ _e"> </span>a<span class="_ _1f"> </span>string<span class="_ _e"> </span>of<span class="_ _e"> </span>the<span class="_ _1f"> </span>form<span class="_ _e"> </span><span class="ffd">name=<span class="ffa">oldvalue</span></span>,<span class="_ _22"> </span>then</div><div class="t m5 x1d h26 y6748 ffd fs19 fc2 sc0 ls0 ws0">unsetenv<span class="_ _21"> </span><span class="ff7">deletes<span class="_ _f"> </span>it<span class="_ _f"> </span>and<span class="_ _f"> </span></span>setenv<span class="_ _21"> </span><span class="ff7">replaces<span class="_ _f"> </span><span class="ffa">oldvalue<span class="_ _f"> </span></span>with<span class="_ _f"> </span></span>newvalue<span class="ff7">,<span class="_ _e"> </span>but<span class="_ _21"> </span>only<span class="_ _f"> </span>if</span></div><div class="t m5 x1d h26 y6749 ffd fs19 fc2 sc0 ls0 ws0">overwrite<span class="_ _11"> </span><span class="ff7">is<span class="_ _16"> </span>nonzero<span class="_ _1"></span>.<span class="_ _11"> </span>If<span class="_ _16"> </span><span class="ffd">name<span class="_ _11"> </span></span>does<span class="_ _11"> </span>not<span class="_ _16"> </span>exist,<span class="_ _11"> </span>then<span class="_ _16"> </span><span class="ffd">setenv<span class="_ _11"> </span></span>adds<span class="_ _16"> </span><span class="ffd">name=newvalue</span></span></div><div class="t m5 x1d h26 y674a ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_"> </span>the<span class="_"> </span>array<span class="_ _3"></span>.</div><div class="t m5 x1d h47 y674b ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>8.6<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>833)</span></div><div class="t m5 x1d h26 y674c ff7 fs19 fc1 sc0 ls0 ws0">Write<span class="_"> </span>a<span class="_ _13"> </span>program<span class="_"> </span>called<span class="_"> </span><span class="ffd">myecho<span class="_ _10"> </span></span>that<span class="_ _13"> </span>prints<span class="_"> </span>its<span class="_"> </span>command-line<span class="_ _13"> </span>arguments<span class="_"> </span>and<span class="_"> </span>envi-</div><div class="t m5 x1d h26 y674d ff7 fs19 fc1 sc0 ls0 ws0">ronment<span class="_"> </span>variables<span class="_ _1"></span>.<span class="_"> </span>F<span class="_ _1"></span>or<span class="_"> </span>example:</div><div class="t m5 x1d h2d y2878 ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">./myecho<span class="_ _1f"> </span>arg1<span class="_ _1f"> </span>arg2</span></div><div class="t m5 x1d h2d y674e ffd fs1e fc2 sc0 ls0 ws0">Command-ine<span class="_ _e"> </span>arguments:</div><div class="t m5 x10c h2d y674f ffd fs1e fc2 sc0 ls0 ws0">argv[<span class="_ _e"> </span>0]:<span class="_ _1f"> </span>myecho</div><div class="t m5 x10c h2d y6750 ffd fs1e fc2 sc0 ls0 ws0">argv[<span class="_ _e"> </span>1]:<span class="_ _1f"> </span>arg1</div><div class="t m5 x10c h2d y6751 ffd fs1e fc2 sc0 ls0 ws0">argv[<span class="_ _e"> </span>2]:<span class="_ _1f"> </span>arg2</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
