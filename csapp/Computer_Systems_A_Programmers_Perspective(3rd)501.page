<div id="pf1f5" class="pf w2 h11" data-page-no="1f5"><div class="pc pc1f5 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1f5.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">500<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>4<span class="_ _3d"> </span>Processor<span class="_ _10"> </span>Architecture</span></div><div class="t m5 x1d h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">not<span class="_ _14"> </span>inject<span class="_ _14"> </span>a<span class="_ _14"> </span>bubble<span class="_ _14"> </span>when<span class="_ _14"> </span>there<span class="_ _14"> </span>is<span class="_ _15"> </span>a<span class="_ _14"> </span>load/use<span class="_ _14"> </span>hazard<span class="_ _14"> </span>in<span class="_ _14"> </span>combination<span class="_ _14"> </span>with<span class="_ _14"> </span>a<span class="_ _14"> </span><span class="ffd">ret</span></div><div class="t m5 x1d h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">instruction:</div><div class="t m5 x1fe h2d y45e5 ffd fs1e fc2 sc0 ls0 ws0">bool<span class="_ _e"> </span>D_bubble<span class="_ _1f"> </span>=</div><div class="t m5 x126 h2d y45e6 ffd fs1e fc2 sc0 ls0 ws0">#<span class="_ _e"> </span>Mispredicted<span class="_ _1f"> </span>branch</div><div class="t m5 x126 h2d y45e7 ffd fs1e fc2 sc0 ls0 ws0">(E_icode<span class="_ _e"> </span>==<span class="_ _1f"> </span>IJXX<span class="_ _1f"> </span>&amp;&amp;<span class="_ _e"> </span>!e_Cnd)<span class="_ _1f"> </span>||</div><div class="t m5 x126 h2d y45e8 ffd fs1e fc2 sc0 ls0 ws0">#<span class="_ _e"> </span>Stalling<span class="_ _1f"> </span>at<span class="_ _1f"> </span>fetch<span class="_ _e"> </span>while<span class="_ _1f"> </span>ret<span class="_ _e"> </span>passes<span class="_ _1f"> </span>through<span class="_ _1f"> </span>pipeline</div><div class="t m5 x126 h2d y45e9 ffd fs1e fc2 sc0 ls0 ws0">#<span class="_ _e"> </span>but<span class="_ _1f"> </span>not<span class="_ _1f"> </span>condition<span class="_ _e"> </span>for<span class="_ _1f"> </span>a<span class="_ _e"> </span>load/use<span class="_ _1f"> </span>hazard</div><div class="t m5 x126 h2d y45ea ffd fs1e fc2 sc0 ls0 ws0">!(E_icode<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _1f"> </span>IMRMOVQ,<span class="_ _e"> </span>IPOPQ<span class="_ _1f"> </span>}<span class="_ _e"> </span>&amp;&amp;<span class="_ _1f"> </span>E_dstM<span class="_ _1f"> </span>in<span class="_ _e"> </span>{<span class="_ _1f"> </span>d_srcA,<span class="_ _e"> </span>d_srcB<span class="_ _1f"> </span>})<span class="_ _1f"> </span>&amp;&amp;</div><div class="t m5 x29 h2d y45eb ffd fs1e fc2 sc0 ls0 ws0">IRET<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _1f"> </span>D_icode,<span class="_ _e"> </span>E_icode,<span class="_ _1f"> </span>M_icode<span class="_ _e"> </span>};</div><div class="t m5 x1d h47 y45ec ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>4.40<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>529)</span></div><div class="t m5 x1d h26 y45ed ff7 fs19 fc1 sc0 ls0 ws0">Write<span class="_"> </span>HCL<span class="_"> </span>code<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>signal<span class="_"> </span><span class="ff6">E_bubble<span class="_ _10"> </span></span>in<span class="_"> </span>the<span class="_"> </span>PIPE<span class="_"> </span>implementation.</div><div class="t m5 x1d h47 y45ee ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>4.41<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>529)</span></div><div class="t m5 x1d h26 y45ef ff7 fs19 fc1 sc0 ls0 ws0">Write<span class="_ _16"> </span>HCL<span class="_ _16"> </span>code<span class="_ _11"> </span>for<span class="_ _16"> </span>the<span class="_ _16"> </span>signal<span class="_ _16"> </span><span class="ff6">set_cc<span class="_ _16"> </span></span>in<span class="_ _16"> </span>the<span class="_ _16"> </span>PIPE<span class="_ _11"> </span>implementation.<span class="_ _16"> </span>This<span class="_ _11"> </span>should</div><div class="t m5 x1d h26 y45f0 ff7 fs19 fc1 sc0 ls0 ws0">only<span class="_ _13"> </span>occur<span class="_"> </span>for<span class="_ _13"> </span><span class="ffd">OPq<span class="_ _13"> </span></span>instructions<span class="_ _1"></span>,<span class="_"> </span>and<span class="_ _13"> </span>should<span class="_ _13"> </span>consider<span class="_ _13"> </span>the<span class="_"> </span>effects<span class="_ _13"> </span>of<span class="_ _13"> </span>program<span class="_"> </span>excep-</div><div class="t m5 x1d h26 y45f1 ff7 fs19 fc1 sc0 ls0 ws0">tions<span class="_ _1"></span>.</div><div class="t m5 x1d h47 y45f2 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>4.42<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>529)</span></div><div class="t m5 x1d h26 y45f3 ff7 fs19 fc1 sc0 ls0 ws0">Write<span class="_ _16"> </span>HCL<span class="_ _14"> </span>code<span class="_ _16"> </span>for<span class="_ _14"> </span>the<span class="_ _16"> </span>signals<span class="_ _14"> </span><span class="ff6">M_bubble<span class="_ _16"> </span></span>and<span class="_ _14"> </span><span class="ff6">W_stall<span class="_ _16"> </span></span>in<span class="_ _14"> </span>the<span class="_ _16"> </span>PIPE<span class="_ _14"> </span>implemen-</div><div class="t m5 x1d h26 y45f4 ff7 fs19 fc1 sc0 ls0 ws0">tation.<span class="_"> </span>The<span class="_"> </span>latter<span class="_"> </span>signal<span class="_ _11"> </span>requires<span class="_"> </span>modifying<span class="_ _11"> </span>the<span class="_ _11"> </span>exception<span class="_"> </span>condition<span class="_ _11"> </span>listed<span class="_ _11"> </span>in<span class="_ _11"> </span>F<span class="_ _1"></span>ig-</div><div class="t m5 x1d h26 y45f5 ff7 fs19 fc1 sc0 ls0 ws0">ure<span class="_"> </span>4.64.</div><div class="t m5 x29 h26 y45f6 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _16"> </span>covers<span class="_ _16"> </span>all<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>special<span class="_ _16"> </span>pipeline<span class="_ _11"> </span>control<span class="_ _16"> </span>signal<span class="_ _16"> </span>values<span class="_ _1"></span>.<span class="_ _16"> </span>In<span class="_ _16"> </span>the<span class="_ _16"> </span>complete</div><div class="t m5 x1d h26 y45f7 ff7 fs19 fc1 sc0 ls0 ws0">HCL<span class="_"> </span>code<span class="_"> </span>for<span class="_"> </span>PIPE,<span class="_"> </span>all<span class="_"> </span>other<span class="_"> </span>pipeline<span class="_"> </span>control<span class="_"> </span>signals<span class="_"> </span>are<span class="_"> </span>set<span class="_"> </span>to<span class="_"> </span>zero<span class="_ _1"></span>.</div><div class="t m5 x1d h41 y6fd ffe fs29 fc1 sc0 ls0 ws0">4.5.9<span class="_ _48"> </span><span class="fs19">Performance<span class="_"> </span>Analysis</span></div><div class="t m5 x1d h26 y6fe ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _14"> </span>can<span class="_ _14"> </span>see<span class="_ _15"> </span>that<span class="_ _14"> </span>the<span class="_ _14"> </span>conditions<span class="_ _14"> </span>requiring<span class="_ _14"> </span>special<span class="_ _14"> </span>action<span class="_ _15"> </span>by<span class="_ _14"> </span>the<span class="_ _14"> </span>pipeline<span class="_ _14"> </span>control</div><div class="t m5 x1d h26 y6ff ff7 fs19 fc1 sc0 ls0 ws0">logic<span class="_"> </span>all<span class="_ _13"> </span>cause<span class="_"> </span>our<span class="_"> </span>pipeline<span class="_"> </span>to<span class="_ _13"> </span>fall<span class="_"> </span>short<span class="_"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>goal<span class="_"> </span>of<span class="_"> </span>issuing<span class="_"> </span>a<span class="_ _13"> </span>new<span class="_"> </span>instruction<span class="_"> </span>on</div><div class="t m5 x1d h26 y700 ff7 fs19 fc1 sc0 ls0 ws0">every<span class="_ _16"> </span>clock<span class="_ _16"> </span>cycle<span class="_ _1"></span>.<span class="_ _16"> </span>W<span class="_ _3"></span>e<span class="_ _16"> </span>can<span class="_ _16"> </span>measure<span class="_ _16"> </span>this<span class="_ _16"> </span>inefﬁciency<span class="_ _11"> </span>by<span class="_ _16"> </span>determining<span class="_ _16"> </span>how<span class="_ _16"> </span>often<span class="_ _16"> </span>a</div><div class="t m5 x1d h26 y701 ff7 fs19 fc1 sc0 ls0 ws0">bubble<span class="_"> </span>gets<span class="_ _13"> </span>injected<span class="_"> </span>into<span class="_"> </span>the<span class="_ _13"> </span>pipeline<span class="_ _0"></span>,<span class="_"> </span>since<span class="_ _13"> </span>these<span class="_"> </span>cause<span class="_"> </span>unused<span class="_ _13"> </span>pipeline<span class="_"> </span>cycles<span class="_ _3"></span>.<span class="_"> </span>A</div><div class="t m5 x1d h26 y702 ff7 fs19 fc1 sc0 ls0 ws0">return<span class="_"> </span>instruction<span class="_ _11"> </span>generates<span class="_ _11"> </span>three<span class="_ _11"> </span>bubbles<span class="_ _1"></span>,<span class="_ _11"> </span>a<span class="_ _11"> </span>load/use<span class="_"> </span>hazard<span class="_ _11"> </span>generates<span class="_ _11"> </span>one,<span class="_"> </span>and</div><div class="t m5 x1d h26 y703 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_ _11"> </span>mispredicted<span class="_ _11"> </span>branch<span class="_ _16"> </span>generates<span class="_ _11"> </span>two<span class="_ _1"></span>.<span class="_ _16"> </span>W<span class="_ _3"></span>e<span class="_ _11"> </span>can<span class="_ _16"> </span>quantify<span class="_ _11"> </span>the<span class="_ _11"> </span>effect<span class="_ _11"> </span>these<span class="_ _16"> </span>penalties</div><div class="t m5 x1d h26 y704 ff7 fs19 fc1 sc0 ls0 ws0">have<span class="_ _13"> </span>on<span class="_ _6"> </span>the<span class="_ _13"> </span>overall<span class="_ _13"> </span>performance<span class="_ _13"> </span>by<span class="_ _6"> </span>computing<span class="_ _13"> </span>an<span class="_ _13"> </span>estimate<span class="_ _13"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>average<span class="_ _13"> </span>number</div><div class="t m5 x1d h26 y705 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span>clock<span class="_ _11"> </span>cycles<span class="_"> </span>PIPE<span class="_"> </span>would<span class="_ _11"> </span>require<span class="_"> </span>per<span class="_ _11"> </span>instruction<span class="_"> </span>it<span class="_ _11"> </span>executes<span class="_ _1"></span>,<span class="_"> </span>a<span class="_ _11"> </span>measure<span class="_ _11"> </span>known</div><div class="t m5 x1d h26 y706 ff7 fs19 fc1 sc0 ls0 ws0">as<span class="_ _14"> </span>the<span class="_ _15"> </span>CPI<span class="_ _14"> </span>(for<span class="_ _14"> </span>“cycles<span class="_ _14"> </span>per<span class="_ _15"> </span>instruction”).<span class="_ _14"> </span>T<span class="_ _0"></span>his<span class="_ _14"> </span>measure<span class="_ _15"> </span>is<span class="_ _14"> </span>the<span class="_ _15"> </span>reciprocal<span class="_ _14"> </span>of<span class="_ _14"> </span>the</div><div class="t m5 x1d h26 y707 ff7 fs19 fc1 sc0 ls0 ws0">average<span class="_"> </span>throughput<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>pipeline<span class="_ _1"></span>,<span class="_"> </span>but<span class="_"> </span>with<span class="_ _13"> </span>time<span class="_"> </span>measured<span class="_ _13"> </span>in<span class="_"> </span>clock<span class="_ _13"> </span>cycles<span class="_ _13"> </span>rather</div><div class="t m5 x1d h26 y708 ff7 fs19 fc1 sc0 ls0 ws0">than<span class="_"> </span>picoseconds<span class="_ _3"></span>.<span class="_"> </span>It<span class="_ _13"> </span>is<span class="_"> </span>a<span class="_"> </span>useful<span class="_ _13"> </span>measure<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>architectural<span class="_ _13"> </span>efﬁciency<span class="_"> </span>of<span class="_ _13"> </span>a<span class="_"> </span>design.</div><div class="t m5 x29 h26 y709 ff7 fs19 fc1 sc0 ls0 ws0">If<span class="_ _13"> </span>we<span class="_ _6"> </span>ignore<span class="_ _13"> </span>the<span class="_ _13"> </span>performance<span class="_ _13"> </span>implications<span class="_ _6"> </span>of<span class="_ _13"> </span>exceptions<span class="_ _13"> </span>(which,<span class="_ _13"> </span>by<span class="_ _13"> </span>deﬁnition,</div><div class="t m5 x1d h26 y70a ff7 fs19 fc1 sc0 ls0 ws0">will<span class="_ _11"> </span>only<span class="_ _11"> </span>occur<span class="_ _11"> </span>rarely),<span class="_ _11"> </span>another<span class="_ _11"> </span>way<span class="_ _11"> </span>to<span class="_ _11"> </span>think<span class="_ _11"> </span>about<span class="_ _11"> </span>CPI<span class="_ _11"> </span>is<span class="_ _11"> </span>to<span class="_ _11"> </span>imagine<span class="_ _11"> </span>we<span class="_ _11"> </span>run<span class="_ _11"> </span>the</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
