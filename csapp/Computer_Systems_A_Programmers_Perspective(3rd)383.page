<div id="pf17f" class="pf w2 h11" data-page-no="17f"><div class="pc pc17f w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg17f.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">382<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x4f h2d ye7 ffd fs1e fc2 sc0 ls0 ws0">struct<span class="_ _e"> </span>{</div><div class="t m5 x33 h2d y2682 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _46"> </span>*a;</div><div class="t m5 x33 h2d y2683 ffd fs1e fc2 sc0 ls0 ws0">char<span class="_ _3f"> </span>*h;</div><div class="t m5 x33 h2d y2684 ffd fs1e fc2 sc0 ls0 ws0">double<span class="_ _e"> </span>f;</div><div class="t m5 x33 h2d y2685 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _3f"> </span>e;</div><div class="t m5 x33 h2d y2686 ffd fs1e fc2 sc0 ls0 ws0">float<span class="_ _1a"> </span>b;</div><div class="t m5 x33 h2d y2687 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _46"> </span>g;</div><div class="t m5 x33 h2d y2688 ffd fs1e fc2 sc0 ls0 ws0">short<span class="_ _1a"> </span>d;</div><div class="t m5 x33 h2d y2689 ffd fs1e fc2 sc0 ls0 ws0">char<span class="_ _3f"> </span>c;</div><div class="t m5 x4f h2d y268a ffd fs1e fc2 sc0 ls0 ws0">}<span class="_ _e"> </span>rec;</div><div class="t m5 x4f h26 y35a2 ff7 fs19 fc2 sc0 ls0 ws0">with<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>offsets:</div><div class="t m5 xd2 h31 y35a3 ff7 fs21 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>ield</div><div class="t m5 x150 h2d y35a4 ffd fs1e fc2 sc0 ls1a5 ws0">a<span class="_ _41"></span>h<span class="_ _4a"></span>febgdc</div><div class="t m5 x4f h31 y35a5 ff7 fs21 fc2 sc0 ls0 ws0">Size<span class="_ _d3"> </span>8<span class="_ _5e"> </span>8<span class="_ _74"> </span><span class="ls1a6">884421</span></div><div class="t m5 x4f h31 y35a6 ff7 fs21 fc2 sc0 ls0 ws0">Offset<span class="_ _26"> </span>0<span class="_ _95"> </span>8<span class="_ _f1"> </span>16<span class="_ _95"> </span>24<span class="_ _f1"> </span>32<span class="_ _f1"> </span>36<span class="_ _95"> </span>40<span class="_ _f1"> </span>42</div><div class="t m5 x4f h26 y35a7 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _15"> </span>structure<span class="_ _21"> </span>must<span class="_ _15"> </span>be<span class="_ _15"> </span>padded<span class="_ _15"> </span>by<span class="_ _15"> </span>5<span class="_ _15"> </span>bytes<span class="_ _21"> </span>to<span class="_ _15"> </span>satisfy<span class="_ _15"> </span>the<span class="_ _15"> </span>8-byte<span class="_ _15"> </span>alignment</div><div class="t m5 x4f h26 y35a8 ff7 fs19 fc2 sc0 ls0 ws0">requirement,<span class="_"> </span>giving<span class="_"> </span>a<span class="_"> </span>total<span class="_"> </span>of<span class="_"> </span>48<span class="_"> </span>bytes<span class="_ _1"></span>.</div><div class="t m5 x1d h28 y35a9 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>3.46<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>318)</span></div><div class="t m5 x1d h26 y35aa ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>problem<span class="_"> </span>covers<span class="_"> </span>a<span class="_ _13"> </span>wide<span class="_"> </span>range<span class="_"> </span>of<span class="_"> </span>topics<span class="_ _3"></span>,<span class="_"> </span>such<span class="_"> </span>as<span class="_"> </span>stack<span class="_"> </span>frames<span class="_ _3"></span>,<span class="_"> </span>string<span class="_"> </span>represen-</div><div class="t m5 x1d h26 y35ab ff7 fs19 fc1 sc0 ls0 ws0">tations<span class="_ _1"></span>,<span class="_ _14"> </span>ASCII<span class="_ _14"> </span>code,<span class="_ _14"> </span>and<span class="_ _14"> </span>byte<span class="_ _14"> </span>ordering.<span class="_ _16"> </span>It<span class="_ _14"> </span>demonstrates<span class="_ _14"> </span>the<span class="_ _14"> </span>dangers<span class="_ _14"> </span>of<span class="_ _14"> </span>out-of-</div><div class="t m5 x1d h26 y35ac ff7 fs19 fc1 sc0 ls0 ws0">bounds<span class="_"> </span>memory<span class="_"> </span>references<span class="_"> </span>and<span class="_"> </span>the<span class="_"> </span>basic<span class="_"> </span>ideas<span class="_"> </span>behind<span class="_"> </span>buffer<span class="_"> </span>overﬂow<span class="_ _3"></span>.</div><div class="t m5 x124 h26 y35ad ff7 fs19 fc1 sc0 ls0 ws0">A.<span class="_ _1f"> </span>Stack<span class="_"> </span>after<span class="_"> </span>line<span class="_"> </span>3:</div><div class="t m5 x207 h40 y35ae ff31 fs28 fc1 sc0 ls0 ws0">00 00 00 00 00 40 00 76</div><div class="t m5 x207 h40 y35af ff31 fs28 fc1 sc0 ls0 ws0">01 23 45 67 89 AB CD EF</div><div class="t m5 x7f h40 y35b0 ff31 fs28 fc1 sc0 ls0 ws0">buf = %rsp</div><div class="t m5 xd3 h3f y35b1 ff30 fs27 fc1 sc0 ls0 ws0">Return address</div><div class="t m5 xd3 h40 y35b2 ff30 fs27 fc1 sc0 ls0 ws0">Saved <span class="ff31 fs28">%rbx</span></div><div class="t m5 x124 h26 y35b3 ff7 fs19 fc1 sc0 ls0 ws0">B<span class="_ _3"></span>.<span class="_ _1d"> </span>Stack<span class="_"> </span>after<span class="_"> </span>line<span class="_"> </span>5:</div><div class="t m5 x207 h40 y35b4 ff31 fs28 fc1 sc0 ls0 ws0">00 00 00 00 00 40 00 34</div><div class="t m5 x207 h40 y35b5 ff31 fs28 fc1 sc0 ls0 ws0">33 32 31 30 39 38 37 36</div><div class="t m5 x207 h40 y35b6 ff31 fs28 fc1 sc0 ls0 ws0">35 34 33 32 31 30 39 38</div><div class="t m5 x207 h40 y35b7 ff31 fs28 fc1 sc0 ls0 ws0">37 36 35 34 33 32 31 30</div><div class="t m5 x7f h40 y35b8 ff31 fs28 fc1 sc0 ls0 ws0">buf = %rsp</div><div class="t m5 xd3 h3f y35b9 ff30 fs27 fc1 sc0 ls0 ws0">Return address</div><div class="t m5 xd3 h40 y35ba ff30 fs27 fc1 sc0 ls0 ws0">Saved <span class="ff31 fs28">%rbx</span></div><div class="t m5 x124 h26 y35bb ff7 fs19 fc1 sc0 ls0 ws0">C.<span class="_ _25"> </span>T<span class="_ _1"></span>he<span class="_ _11"> </span>program<span class="_"> </span>is<span class="_ _11"> </span>attempting<span class="_"> </span>to<span class="_ _11"> </span>return<span class="_ _11"> </span>to<span class="_"> </span>address<span class="_ _11"> </span><span class="ffd">0x040034</span>.<span class="_"> </span>The<span class="_"> </span>low-order<span class="_"> </span>2</div><div class="t m5 x4f h26 yc02 ff7 fs19 fc1 sc0 ls0 ws0">bytes<span class="_ _13"> </span>were<span class="_ _13"> </span>overwritten<span class="_ _13"> </span>by<span class="_ _6"> </span>the<span class="_ _13"> </span>code<span class="_ _13"> </span>for<span class="_ _13"> </span>character<span class="_ _13"> </span>‘<span class="ffd">4</span>’<span class="_ _13"> </span>and<span class="_ _13"> </span>the<span class="_ _6"> </span>terminating<span class="_ _13"> </span>null</div><div class="t m5 x4f h26 y35bc ff7 fs19 fc1 sc0 ls0 ws0">character.</div><div class="t m5 x124 h26 yc04 ff7 fs19 fc1 sc0 ls0 ws0">D<span class="_ _3"></span>.<span class="_ _23"> </span>The<span class="_ _6"> </span>saved<span class="_ _13"> </span>value<span class="_ _13"> </span>of<span class="_ _13"> </span>register<span class="_ _6"> </span><span class="ffd">%rbx<span class="_ _13"> </span></span>was<span class="_ _13"> </span>set<span class="_ _13"> </span>to<span class="_ _6"> </span><span class="ffd">0x3332313039383736</span>.<span class="_ _13"> </span>T<span class="_ _1"></span>his<span class="_ _13"> </span>value</div><div class="t m5 x4f h26 y35bd ff7 fs19 fc1 sc0 ls0 ws0">will<span class="_"> </span>be<span class="_"> </span>loaded<span class="_"> </span>into<span class="_"> </span>the<span class="_"> </span>register<span class="_"> </span>before<span class="_"> </span><span class="ffd">get_line<span class="_ _10"> </span></span>returns<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
