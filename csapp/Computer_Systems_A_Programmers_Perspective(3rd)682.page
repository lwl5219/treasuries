<div id="pf2aa" class="pf w2 h11" data-page-no="2aa"><div class="pc pc2aa w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg2aa.png"/><div class="t m5 x1c4 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>6.6<span class="_ _60"> </span>Putting<span class="_ _10"> </span>It<span class="_ _10"> </span>T<span class="_ _1"></span>ogether:<span class="_ _10"> </span>The<span class="_ _10"> </span>Impact<span class="_ _10"> </span>of<span class="_ _10"> </span>Caches<span class="_ _10"> </span>on<span class="_ _10"> </span>Program<span class="_ _10"> </span>Performance<span class="_ _3e"> </span><span class="ffe fs1e">681</span></div><div class="t m5 x17 h34 ye7 ff6 fs16 fc2 sc0 ls0 ws0">(a)<span class="_ _10"> </span>V<span class="_ _1"></span>ersion<span class="_ _11"> </span><span class="ff11 ls25a">ij<span class="_ _a"> </span>k</span></div><div class="t m5 xe0 h2c y5ae0 ffa fs16 fc2 sc0 ls0 ws0">code/mem/matmult/mm.c</div><div class="t m5 x2c h2d y609 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2 ls33">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>i=0<span class="_ _41"></span>;i&lt;n<span class="_ _41"></span>;<span class="ls0">i++)</span></span></div><div class="t m5 x2c h2d y5ae1 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _20"> </span><span class="ffd fs1e fc2 ls33">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>j=0<span class="_ _41"></span>;j&lt;n<span class="_ _41"></span>;<span class="ls0">j++)<span class="_ _e"> </span>{</span></span></div><div class="t m5 x2c h2d y5ae2 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _70"> </span><span class="ffd fs1e fc2">sum<span class="_ _e"> </span>=<span class="_ _1f"> </span>0.0;</span></div><div class="t m5 x2c h2d y5ae3 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _70"> </span><span class="ffd fs1e fc2 ls33">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>k=0<span class="_ _41"></span>;k&lt;n<span class="_ _41"></span>;<span class="ls0">k++)</span></span></div><div class="t m5 x2c h2d y5ae4 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _d1"> </span><span class="ffd fs1e fc2">sum<span class="_ _1f"> </span>+=<span class="_ _e"> </span>A[i][k]*B[k][j];</span></div><div class="t m5 x2c h2d y5ae5 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _70"> </span><span class="ffd fs1e fc2">C[i][j]<span class="_ _e"> </span>+=<span class="_ _1f"> </span>sum;</span></div><div class="t m5 x2c h2d y5ae6 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 xe0 h2c y5ae7 ffa fs16 fc2 sc0 ls0 ws0">code/mem/matmult/mm.c</div><div class="t m5 x17 h34 y5ae8 ff6 fs16 fc2 sc0 ls0 ws0">(c)<span class="_ _10"> </span>V<span class="_ _1"></span>ersion<span class="_ _11"> </span><span class="ff11 ls25b">jk<span class="_ _1"></span>i</span></div><div class="t m5 xe0 h2c y5ae9 ffa fs16 fc2 sc0 ls0 ws0">code/mem/matmult/mm.c</div><div class="t m5 x2c h2d y5aea ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2 ls33">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>j=0<span class="_ _41"></span>;j&lt;n<span class="_ _41"></span>;<span class="ls0">j++)</span></span></div><div class="t m5 x2c h2d y5aeb ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _20"> </span><span class="ffd fs1e fc2 ls33">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>k=0<span class="_ _41"></span>;k&lt;n<span class="_ _41"></span>;<span class="ls0">k++)<span class="_ _e"> </span>{</span></span></div><div class="t m5 x2c h2d y5aec ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _70"> </span><span class="ffd fs1e fc2">r<span class="_ _e"> </span>=<span class="_ _1f"> </span>B[k][j];</span></div><div class="t m5 x2c h2d y5aed ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _70"> </span><span class="ffd fs1e fc2 ls33">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>i=0<span class="_ _41"></span>;i&lt;n<span class="_ _41"></span>;<span class="ls0">i++)</span></span></div><div class="t m5 x2c h2d y5aee ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _d1"> </span><span class="ffd fs1e fc2">C[i][j]<span class="_ _1f"> </span>+=<span class="_ _e"> </span>A[i][k]*r;</span></div><div class="t m5 x2c h2d y5aef ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 xe0 h2c y5af0 ffa fs16 fc2 sc0 ls0 ws0">code/mem/matmult/mm.c</div><div class="t m5 x17 h34 y5af1 ff6 fs16 fc2 sc0 ls0 ws0">(e)<span class="_ _10"> </span>V<span class="_ _1"></span>ersion<span class="_ _11"> </span><span class="ff11 ls25c">ki<span class="_ _3"></span>j</span></div><div class="t m5 xe0 h2c y5af2 ffa fs16 fc2 sc0 ls0 ws0">code/mem/matmult/mm.c</div><div class="t m5 x2c h2d y323c ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2 ls33">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>k=0<span class="_ _41"></span>;k&lt;n<span class="_ _41"></span>;<span class="ls0">k++)</span></span></div><div class="t m5 x2c h2d y30b7 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _20"> </span><span class="ffd fs1e fc2 ls33">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>i=0<span class="_ _41"></span>;i&lt;n<span class="_ _41"></span>;<span class="ls0">i++)<span class="_ _e"> </span>{</span></span></div><div class="t m5 x2c h2d y30b8 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _70"> </span><span class="ffd fs1e fc2">r<span class="_ _e"> </span>=<span class="_ _1f"> </span>A[i][k];</span></div><div class="t m5 x2c h2d y30b9 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _70"> </span><span class="ffd fs1e fc2 ls33">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>j=0<span class="_ _41"></span>;j&lt;n<span class="_ _41"></span>;<span class="ls0">j++)</span></span></div><div class="t m5 x2c h2d y1849 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _d1"> </span><span class="ffd fs1e fc2">C[i][j]<span class="_ _1f"> </span>+=<span class="_ _e"> </span>r*B[k][j];</span></div><div class="t m5 x2c h2e y30ba ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 x142 h2d y30bb ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 xe0 h2c y5af3 ffa fs16 fc2 sc0 ls0 ws0">code/mem/matmult/mm.c</div><div class="t m5 x13d h34 y5af4 ff6 fs16 fc2 sc0 ls0 ws0">(b)<span class="_ _10"> </span>V<span class="_ _1"></span>ersion<span class="_ _11"> </span><span class="ff11 ls25b">ji<span class="_ _1"></span>k</span></div><div class="t m5 x43 h2c y5af5 ffa fs16 fc2 sc0 ls0 ws0">code/mem/matmult/mm.c</div><div class="t m5 xb1 h2d y5af6 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2 ls33">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>j=0<span class="_ _41"></span>;j&lt;n<span class="_ _41"></span>;<span class="ls0">j++)</span></span></div><div class="t m5 xb1 h2d y5af7 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _20"> </span><span class="ffd fs1e fc2 ls33">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>i=0<span class="_ _41"></span>;i&lt;n<span class="_ _41"></span>;<span class="ls0">i++)<span class="_ _e"> </span>{</span></span></div><div class="t m5 xb1 h2d y5af8 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _70"> </span><span class="ffd fs1e fc2">sum<span class="_ _e"> </span>=<span class="_ _1f"> </span>0.0;</span></div><div class="t m5 xb1 h2d y5af9 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _70"> </span><span class="ffd fs1e fc2 ls33">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>k=0<span class="_ _41"></span>;k&lt;n<span class="_ _41"></span>;<span class="ls0">k++)</span></span></div><div class="t m5 xb1 h2d y5afa ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _d1"> </span><span class="ffd fs1e fc2">sum<span class="_ _1f"> </span>+=<span class="_ _e"> </span>A[i][k]*B[k][j];</span></div><div class="t m5 xb1 h2e y5afb ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 x1e3 h2d y5afc ffd fs1e fc2 sc0 ls0 ws0">C[i][j]<span class="_ _e"> </span>+=<span class="_ _1f"> </span>sum;</div><div class="t m5 xb1 h2d y5afd ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x43 h2c y5afe ffa fs16 fc2 sc0 ls0 ws0">code/mem/matmult/mm.c</div><div class="t m5 x13d h34 y5aff ff6 fs16 fc2 sc0 ls0 ws0">(d)<span class="_ _10"> </span>V<span class="_ _1"></span>ersion<span class="_ _11"> </span><span class="ff11 ls25d">kj<span class="_ _6"> </span>i</span></div><div class="t m5 x43 h2c y5b00 ffa fs16 fc2 sc0 ls0 ws0">code/mem/matmult/mm.c</div><div class="t m5 xb1 h2d y5b01 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2 ls33">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>k=0<span class="_ _41"></span>;k&lt;n<span class="_ _41"></span>;<span class="ls0">k++)</span></span></div><div class="t m5 xb1 h2d y5b02 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _20"> </span><span class="ffd fs1e fc2 ls33">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>j=0<span class="_ _41"></span>;j&lt;n<span class="_ _41"></span>;<span class="ls0">j++)<span class="_ _e"> </span>{</span></span></div><div class="t m5 xb1 h2e y5b03 ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x1e3 h2d y5b04 ffd fs1e fc2 sc0 ls0 ws0">r<span class="_ _e"> </span>=<span class="_ _1f"> </span>B[k][j];</div><div class="t m5 xb1 h2d y5b05 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _70"> </span><span class="ffd fs1e fc2 ls33">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>i=0<span class="_ _41"></span>;i&lt;n<span class="_ _41"></span>;<span class="ls0">i++)</span></span></div><div class="t m5 xb1 h2d y5b06 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _d1"> </span><span class="ffd fs1e fc2">C[i][j]<span class="_ _1f"> </span>+=<span class="_ _e"> </span>A[i][k]*r;</span></div><div class="t m5 xb1 h2d y5b07 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x43 h2c y5b08 ffa fs16 fc2 sc0 ls0 ws0">code/mem/matmult/mm.c</div><div class="t m5 x13d h34 y5b09 ff6 fs16 fc2 sc0 ls0 ws0">(f)<span class="_ _10"> </span>V<span class="_ _1"></span>ersion<span class="_ _11"> </span><span class="ff11 ls25e">ik<span class="_ _7"></span>j</span></div><div class="t m5 x43 h2c y5b0a ffa fs16 fc2 sc0 ls0 ws0">code/mem/matmult/mm.c</div><div class="t m5 xb1 h2d y5b0b ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2 ls33">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>i=0<span class="_ _41"></span>;i&lt;n<span class="_ _41"></span>;<span class="ls0">i++)</span></span></div><div class="t m5 xb1 h2d y5b0c ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _20"> </span><span class="ffd fs1e fc2 ls33">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>k=0<span class="_ _41"></span>;k&lt;n<span class="_ _41"></span>;<span class="ls0">k++)<span class="_ _e"> </span>{</span></span></div><div class="t m5 xb1 h2d y5b0d ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _70"> </span><span class="ffd fs1e fc2">r<span class="_ _e"> </span>=<span class="_ _1f"> </span>A[i][k];</span></div><div class="t m5 xb1 h2d y5b0e ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _70"> </span><span class="ffd fs1e fc2 ls33">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>j=0<span class="_ _41"></span>;j&lt;n<span class="_ _41"></span>;<span class="ls0">j++)</span></span></div><div class="t m5 xb1 h2d y5b0f ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _d1"> </span><span class="ffd fs1e fc2">C[i][j]<span class="_ _1f"> </span>+=<span class="_ _e"> </span>r*B[k][j];</span></div><div class="t m5 xb1 h2d y5b10 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x43 h2c y5b11 ffa fs16 fc2 sc0 ls0 ws0">code/mem/matmult/mm.c</div><div class="t m5 x17 h34 y5b12 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>6.44<span class="_ _66"> </span><span class="fc1">Six<span class="_"> </span>versions<span class="_"> </span>of<span class="_ _10"> </span>matrix<span class="_ _10"> </span>multiply<span class="_ _3"></span>.<span class="_"> </span><span class="ff6">Each<span class="_ _10"> </span>version<span class="_ _10"> </span>is<span class="_ _10"> </span>uniquely<span class="_ _10"> </span>identiÔ¨Åed<span class="_ _10"> </span>by<span class="_ _10"> </span>the<span class="_ _10"> </span>ordering<span class="_ _10"> </span>of<span class="_ _10"> </span>its<span class="_ _10"> </span>loops.</span></span></div><div class="t m5 xe3 h31 y5b13 ff7 fs21 fc2 sc0 ls0 ws0">Per<span class="_"> </span>iteration</div><div class="t m5 x17 h31 y5b14 ff7 fs21 fc2 sc0 ls0 ws0">Matrix<span class="_"> </span>multiply</div><div class="t m5 x17 h31 y5b15 ff7 fs21 fc2 sc0 ls0 ws0">version<span class="_"> </span>(class)<span class="_ _95"> </span>Loads<span class="_ _3e"> </span>Stores<span class="_ _b3"> </span><span class="ff11">A<span class="_ _13"> </span></span>misses<span class="_ _3e"> </span><span class="ff11">B<span class="_"> </span></span>misses<span class="_ _3e"> </span><span class="ff11">C<span class="_"> </span></span>misses<span class="_ _3e"> </span>T<span class="_ _3"></span>otal<span class="_"> </span>misses</div><div class="t m5 x17 h31 y5b16 ff11 fs21 fc2 sc0 ls25f ws0">ij<span class="_ _a"> </span>k<span class="_ _16"> </span><span class="ff7 ls0">&amp;<span class="_"> </span></span><span class="ls260">ji<span class="_ _1"></span>k<span class="_ _13"> </span><span class="ff7 ls0">(<span class="ff11">AB<span class="_ _2"></span></span>)<span class="_ _72"> </span>2<span class="_ _63"> </span>0<span class="_ _6c"> </span>0.25<span class="_ _2c"> </span>1.00<span class="_ _57"> </span>0.00<span class="_ _2a"> </span>1.25</span></span></div><div class="t m5 x17 h31 y5b17 ff11 fs21 fc2 sc0 ls260 ws0">jk<span class="_ _3"></span>i<span class="_ _13"> </span><span class="ff7 ls0">&amp;<span class="_"> </span></span><span class="ls261">kj<span class="_ _6"> </span>i<span class="_ _14"> </span><span class="ff7 ls0">(<span class="ff11">AC<span class="_ _5"></span></span>)<span class="_ _72"> </span>2<span class="_ _63"> </span>1<span class="_ _68"> </span>1.00<span class="_ _57"> </span>0.00<span class="_ _2c"> </span>1.00<span class="_ _2a"> </span>2.00</span></span></div><div class="t m5 x17 h31 y5b18 ff11 fs21 fc2 sc0 ls262 ws0">ki<span class="_ _3"></span>j<span class="_ _16"> </span><span class="ff7 ls0">&amp;<span class="_"> </span></span><span class="ls68">ik<span class="_ _7"></span>j<span class="_ _11"> </span><span class="ff7 ls0">(</span><span class="ls263">BC<span class="ff7 ls0">)<span class="_ _45"> </span>2<span class="_ _63"> </span>1<span class="_ _6c"> </span>0.00<span class="_ _2c"> </span>0.25<span class="_ _57"> </span>0.25<span class="_ _2a"> </span>0.50</span></span></span></div><div class="t m5 x17 h34 y5b19 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _16"> </span>6.45<span class="_ _66"> </span><span class="fc1">Analysis<span class="_ _16"> </span>of<span class="_ _16"> </span>matrix<span class="_ _16"> </span>multiply<span class="_ _11"> </span>inner<span class="_ _16"> </span>loops.<span class="_ _16"> </span><span class="ff6">The<span class="_ _16"> </span>six<span class="_ _11"> </span>versions<span class="_ _16"> </span>partition<span class="_ _16"> </span>into</span></span></div><div class="t m5 x17 h34 y5b1a ff6 fs16 fc1 sc0 ls0 ws0">three<span class="_ _16"> </span>equivalence<span class="_ _11"> </span>classes,<span class="_ _16"> </span>denoted<span class="_ _16"> </span>by<span class="_ _16"> </span>the<span class="_ _11"> </span>pair<span class="_ _16"> </span>of<span class="_ _16"> </span>arrays<span class="_ _11"> </span>that<span class="_ _16"> </span>are<span class="_ _16"> </span>accessed<span class="_ _11"> </span>in<span class="_ _16"> </span>the<span class="_ _16"> </span>inner</div><div class="t m5 x17 h34 y5b1b ff6 fs16 fc1 sc0 ls0 ws0">loop.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
