<div id="pf34e" class="pf w2 h11" data-page-no="34e"><div class="pc pc34e w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg34e.png"/><div class="t m5 x170 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>9.3<span class="_ _60"> </span>VM<span class="_ _10"> </span>as<span class="_ _10"> </span>a<span class="_ _10"> </span>T<span class="_ _1"></span>ool<span class="_ _10"> </span>for<span class="_ _10"> </span>Caching<span class="_ _3e"> </span><span class="ffe fs1e">845</span></div><div class="t m5 x17 h2f ye7 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>9.6</div><div class="t m5 x17 h2f y58a ffe fs16 fc1 sc0 ls0 ws0">VM<span class="_ _11"> </span>page<span class="_ _16"> </span>fault<span class="_"> </span>(before).</div><div class="t m5 x17 h34 y58b ff6 fs16 fc1 sc0 ls0 ws0">The<span class="_ _10"> </span>reference<span class="_ _11"> </span>to<span class="_ _11"> </span>a<span class="_ _11"> </span>word<span class="_ _10"> </span>in</div><div class="t m5 x17 h34 y58c ff6 fs16 fc1 sc0 ls0 ws0">VP<span class="_ _11"> </span>3<span class="_ _11"> </span>is<span class="_ _11"> </span>a<span class="_ _10"> </span>miss<span class="_ _11"> </span>and<span class="_ _11"> </span>triggers</div><div class="t m5 x17 h34 y58d ff6 fs16 fc1 sc0 ls0 ws0">a<span class="_ _10"> </span>page<span class="_ _11"> </span>fault.</div><div class="t m5 xe1 h3f y6c8f ffa9 fs27 fc1 sc0 ls0 ws0">PTE 0</div><div class="t m5 x12b h3f y6c90 ffa9 fs27 fc1 sc0 ls0 ws0">PP 0</div><div class="t m5 x12b h3f y6c91 ffa9 fs27 fc1 sc0 ls0 ws0">PP 3</div><div class="t m5 x17c h3f y6c92 ffa9 fs27 fc1 sc0 ls0 ws0">1</div><div class="t m5 x17c h3f y6c93 ffa9 fs27 fc1 sc0 ls0 ws0">1</div><div class="t m5 x17c h3f y6c94 ffa9 fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 x17c h3f y6c95 ffa9 fs27 fc1 sc0 ls0 ws0">1</div><div class="t m5 x17c h3f y6c96 ffa9 fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 x17c h3f y6c97 ffa9 fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 x17c h3f y6c98 ffa9 fs27 fc1 sc0 ls0 ws0">1</div><div class="t m5 x17c h3f y6c99 ffa9 fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 xe1 h3f y6c9a ffa9 fs27 fc1 sc0 ls0 ws0">PTE 7</div><div class="t m5 x5e h3f y6c9b ffa9 fs27 fc1 sc0 ls0 ws0">Null</div><div class="t m5 x104 h3f y6c98 ffa9 fs27 fc1 sc0 ls0 ws0">VP 1</div><div class="t m5 x104 h3f y6c9c ffa9 fs27 fc1 sc0 ls0 ws0">VP 4</div><div class="t m5 x104 h3f y6c9d ffa9 fs27 fc1 sc0 ls0 ws0">VP 7</div><div class="t m5 x104 h3f y6c9e ffa9 fs27 fc1 sc0 ls0 ws0">VP 2</div><div class="t m5 x104 h3f y6c9f ffa9 fs27 fc1 sc0 ls0 ws0">VP 1</div><div class="t m5 x104 h3f y6ca0 ffa9 fs27 fc1 sc0 ls0 ws0">VP 2</div><div class="t m5 x104 h3f y6ca1 ffa9 fs27 fc1 sc0 ls0 ws0">VP 3</div><div class="t m5 x104 h3f y6ca2 ffa9 fs27 fc1 sc0 ls0 ws0">VP 4</div><div class="t m5 x104 h3f y6ca3 ffa9 fs27 fc1 sc0 ls0 ws0">VP 6</div><div class="t m5 x104 h3f y6ca4 ffa9 fs27 fc1 sc0 ls0 ws0">VP 7</div><div class="t m5 x5e h3f y6ca5 ffa9 fs27 fc1 sc0 ls0 ws0">Null</div><div class="t m5 x139 h3f y6ca6 ffaa fs27 fc1 sc0 ls0 ws0">Physical page</div><div class="t m5 x13d h3f y6ca7 ffaa fs27 fc1 sc0 ls0 ws0">number or</div><div class="t m5 x92 h3f y6ca8 ffaa fs27 fc1 sc0 ls0 ws0">disk address</div><div class="t m5 x20c h3f y6ca9 ffa9 fs27 fc1 sc0 ls0 ws0">Memory-resident</div><div class="t m5 x118 h3f y6caa ffa9 fs27 fc1 sc0 ls0 ws0">page table</div><div class="t m5 x1ae h3f y6cab ffa9 fs27 fc1 sc0 ls0 ws0">(DRAM)</div><div class="t m5 x164 h3f y6cac ffa9 fs27 fc1 sc0 ls0 ws0">Virtual memory</div><div class="t m5 x221 h3f y6cad ffa9 fs27 fc1 sc0 ls0 ws0">(disk)</div><div class="t m5 x1d8 h3f y6cae ffa9 fs27 fc1 sc0 ls0 ws0">Physical memory</div><div class="t m5 x14d h3f y6caf ffa9 fs27 fc1 sc0 ls0 ws0">(DRAM)</div><div class="t m5 xb3 h3f y6d01 ffa9 fs27 fc1 sc0 ls0 ws0">Virtual address</div><div class="t m5 xd3 h3f y6d02 ffaa fs27 fc1 sc0 ls0 ws0">V<span class="_ _1"></span>alid</div><div class="t m5 x17 h2f y4e22 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>9.7</div><div class="t m5 x17 h2f y6d03 ffe fs16 fc1 sc0 ls0 ws0">VM<span class="_ _16"> </span>page<span class="_ _16"> </span>fault<span class="_ _16"> </span>(after).</div><div class="t m5 x17 h34 y6d04 ff6 fs16 fc1 sc0 ls0 ws0">The<span class="_ _16"> </span>page<span class="_ _14"> </span>fault<span class="_ _16"> </span>handler</div><div class="t m5 x17 h34 y6d05 ff6 fs16 fc1 sc0 ls0 ws0">selects<span class="_ _11"> </span>VP<span class="_ _16"> </span>4<span class="_ _11"> </span>as<span class="_ _11"> </span>the<span class="_ _16"> </span>victim</div><div class="t m5 x17 h34 y6d06 ff6 fs16 fc1 sc0 ls0 ws0">and<span class="_ _10"> </span>replaces<span class="_ _11"> </span>it<span class="_ _10"> </span>with<span class="_ _11"> </span>a<span class="_ _11"> </span>copy</div><div class="t m5 x17 h34 y6d07 ff6 fs16 fc1 sc0 ls0 ws0">of<span class="_ _10"> </span>VP<span class="_ _11"> </span>3<span class="_ _10"> </span>from<span class="_ _11"> </span>disk.<span class="_ _10"> </span>After<span class="_ _11"> </span>the</div><div class="t m5 x17 h34 y6d08 ff6 fs16 fc1 sc0 ls0 ws0">page<span class="_ _11"> </span>fault<span class="_ _11"> </span>handler<span class="_ _11"> </span>restarts</div><div class="t m5 x17 h34 y6d09 ff6 fs16 fc1 sc0 ls0 ws0">the<span class="_ _11"> </span>faulting<span class="_ _11"> </span>instruction,<span class="_ _16"> </span>it</div><div class="t m5 x17 h34 y6d0a ff6 fs16 fc1 sc0 ls0 ws0">will<span class="_ _16"> </span>read<span class="_ _16"> </span>the<span class="_ _16"> </span>word<span class="_ _16"> </span>from</div><div class="t m5 x17 h34 y6d0b ff6 fs16 fc1 sc0 ls0 ws0">memory<span class="_ _11"> </span>normally<span class="_ _3"></span>,<span class="_ _11"> </span>without</div><div class="t m5 x17 h34 y6d0c ff6 fs16 fc1 sc0 ls0 ws0">generating<span class="_ _10"> </span>an<span class="_ _11"> </span>exception.</div><div class="t m5 xe1 h3f y6d0d ffa9 fs27 fc1 sc0 ls0 ws0">PTE 0</div><div class="t m5 x226 h3f y6d0e ffa9 fs27 fc1 sc0 ls0 ws0">PP 0</div><div class="t m5 x226 h3f y6d0f ffa9 fs27 fc1 sc0 ls0 ws0">PP 3</div><div class="t m5 x119 h3f y6d10 ffa9 fs27 fc1 sc0 ls0 ws0">1</div><div class="t m5 x119 h3f y6d11 ffa9 fs27 fc1 sc0 ls0 ws0">1</div><div class="t m5 x119 h3f y6d12 ffa9 fs27 fc1 sc0 ls0 ws0">1</div><div class="t m5 x119 h3f y6d13 ffa9 fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 x119 h3f y6d14 ffa9 fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 x119 h3f y6d15 ffa9 fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 x119 h3f y6d16 ffa9 fs27 fc1 sc0 ls0 ws0">1</div><div class="t m5 x119 h3f y6d17 ffa9 fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 xe1 h3f y6d18 ffa9 fs27 fc1 sc0 ls0 ws0">PTE 7</div><div class="t m5 x250 h3f y6d19 ffa9 fs27 fc1 sc0 ls0 ws0">Null</div><div class="t m5 x148 h3f y6d16 ffa9 fs27 fc1 sc0 ls0 ws0">VP 1</div><div class="t m5 x148 h3f y6d1a ffa9 fs27 fc1 sc0 ls0 ws0">VP 3</div><div class="t m5 x148 h3f y6d1b ffa9 fs27 fc1 sc0 ls0 ws0">VP 7</div><div class="t m5 x148 h3f y6d1c ffa9 fs27 fc1 sc0 ls0 ws0">VP 2</div><div class="t m5 x148 h3f y6d1d ffa9 fs27 fc1 sc0 ls0 ws0">VP 1</div><div class="t m5 x148 h3f y6d1e ffa9 fs27 fc1 sc0 ls0 ws0">VP 2</div><div class="t m5 x148 h3f y6d1f ffa9 fs27 fc1 sc0 ls0 ws0">VP 3</div><div class="t m5 x148 h3f y6d20 ffa9 fs27 fc1 sc0 ls0 ws0">VP 4</div><div class="t m5 x148 h3f y6d21 ffa9 fs27 fc1 sc0 ls0 ws0">VP 6</div><div class="t m5 x148 h3f y6d22 ffa9 fs27 fc1 sc0 ls0 ws0">VP 7</div><div class="t m5 x250 h3f y6d23 ffa9 fs27 fc1 sc0 ls0 ws0">Null</div><div class="t m5 x139 h3f y6d24 ffaa fs27 fc1 sc0 ls0 ws0">Physical page</div><div class="t m5 x13d h3f y6d25 ffaa fs27 fc1 sc0 ls0 ws0">number or</div><div class="t m5 x92 h3f y6d26 ffaa fs27 fc1 sc0 ls0 ws0">disk address</div><div class="t m5 x20c h3f y6d27 ffa9 fs27 fc1 sc0 ls0 ws0">Memory-resident</div><div class="t m5 x118 h3f y6d28 ffa9 fs27 fc1 sc0 ls0 ws0">page table</div><div class="t m5 x1ae h3f y6d29 ffa9 fs27 fc1 sc0 ls0 ws0">(DRAM)</div><div class="t m5 x164 h3f y6d2a ffa9 fs27 fc1 sc0 ls0 ws0">Virtual memory</div><div class="t m5 x221 h3f y6d2b ffa9 fs27 fc1 sc0 ls0 ws0">(disk)</div><div class="t m5 x1d8 h3f y6d2c ffa9 fs27 fc1 sc0 ls0 ws0">Physical memory</div><div class="t m5 x14d h3f y6d2d ffa9 fs27 fc1 sc0 ls0 ws0">(DRAM)</div><div class="t m5 xd3 h3f y6d2e ffaa fs27 fc1 sc0 ls0 ws0">V<span class="_ _1"></span>alid</div><div class="t m5 xb3 h3f y6d2f ffa9 fs27 fc1 sc0 ls0 ws0">Virtual address</div><div class="t m5 x26 h26 y450f ff7 fs19 fc1 sc0 ls0 ws0">Next,<span class="_ _16"> </span>the<span class="_ _16"> </span>kernel<span class="_ _16"> </span>copies<span class="_ _11"> </span>VP<span class="_ _16"> </span>3<span class="_ _16"> </span>from<span class="_ _16"> </span>disk<span class="_ _11"> </span>to<span class="_ _16"> </span>PP<span class="_ _16"> </span>3<span class="_ _16"> </span>in<span class="_ _11"> </span>memory<span class="_ _3"></span>,<span class="_ _16"> </span>updates<span class="_ _16"> </span>PTE<span class="_ _16"> </span>3,</div><div class="t m5 x17 h26 y4510 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _14"> </span>then<span class="_ _14"> </span>returns<span class="_ _1"></span>.<span class="_ _14"> </span>When<span class="_ _16"> </span>the<span class="_ _15"> </span>handler<span class="_ _14"> </span>returns<span class="_ _1"></span>,<span class="_ _15"> </span>it<span class="_ _14"> </span>restarts<span class="_ _14"> </span>the<span class="_ _14"> </span>faulting<span class="_ _14"> </span>instruction,</div><div class="t m5 x17 h26 y4511 ff7 fs19 fc1 sc0 ls0 ws0">which<span class="_ _14"> </span>resends<span class="_ _15"> </span>the<span class="_ _14"> </span>faulting<span class="_ _14"> </span>virtual<span class="_ _15"> </span>address<span class="_ _14"> </span>to<span class="_ _15"> </span>the<span class="_ _14"> </span>address<span class="_ _15"> </span>translation<span class="_ _14"> </span>hardware.</div><div class="t m5 x17 h26 y4512 ff7 fs19 fc1 sc0 ls0 ws0">But<span class="_ _13"> </span>now<span class="_ _3"></span>,<span class="_"> </span>VP<span class="_ _13"> </span>3<span class="_"> </span>is<span class="_ _13"> </span>cached<span class="_ _13"> </span>in<span class="_"> </span>main<span class="_ _13"> </span>memory<span class="_ _3"></span>,<span class="_"> </span>and<span class="_ _13"> </span>the<span class="_ _13"> </span>page<span class="_"> </span>hit<span class="_ _13"> </span>is<span class="_"> </span>handled<span class="_ _13"> </span>normally<span class="_ _13"> </span>by</div><div class="t m5 x17 h26 y4513 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>address<span class="_"> </span>translation<span class="_"> </span>hardware<span class="_ _1"></span>.<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>9.7<span class="_"> </span>shows<span class="_"> </span>the<span class="_"> </span>state<span class="_"> </span>of<span class="_"> </span>our<span class="_"> </span>example<span class="_ _13"> </span>page</div><div class="t m5 x17 h26 y4514 ff7 fs19 fc1 sc0 ls0 ws0">table<span class="_"> </span>after<span class="_"> </span>the<span class="_"> </span>page<span class="_"> </span>fault.</div><div class="t m5 x26 h26 y4515 ff7 fs19 fc1 sc0 ls0 ws0">V<span class="_ _1"></span>irtual<span class="_ _15"> </span>memory<span class="_ _14"> </span>was<span class="_ _14"> </span>invented<span class="_ _14"> </span>in<span class="_ _14"> </span>the<span class="_ _15"> </span>early<span class="_ _14"> </span>1960s<span class="_ _1"></span>,<span class="_ _15"> </span>long<span class="_ _14"> </span>before<span class="_ _14"> </span>the<span class="_ _15"> </span>widening</div><div class="t m5 x17 h26 y4516 ff7 fs19 fc1 sc0 ls0 ws0">CPU-memory<span class="_ _11"> </span>gap<span class="_ _16"> </span>spawned<span class="_ _16"> </span>SRAM<span class="_ _11"> </span>caches<span class="_ _1"></span>.<span class="_ _16"> </span>As<span class="_ _16"> </span>a<span class="_ _11"> </span>result,<span class="_ _16"> </span>virtual<span class="_ _16"> </span>memory<span class="_ _11"> </span>systems</div><div class="t m5 x17 h26 y4517 ff7 fs19 fc1 sc0 ls0 ws0">use<span class="_ _11"> </span>a<span class="_ _16"> </span>different<span class="_ _11"> </span>terminology<span class="_ _16"> </span>from<span class="_ _11"> </span>SRAM<span class="_ _16"> </span>caches<span class="_ _3"></span>,<span class="_ _16"> </span>even<span class="_ _16"> </span>though<span class="_ _11"> </span>many<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>ideas</div><div class="t m5 x17 h26 y4518 ff7 fs19 fc1 sc0 ls0 ws0">are<span class="_ _11"> </span>similar.<span class="_"> </span>In<span class="_ _16"> </span>virtual<span class="_ _11"> </span>memory<span class="_ _11"> </span>parlance<span class="_ _0"></span>,<span class="_ _11"> </span>blocks<span class="_ _11"> </span>are<span class="_ _16"> </span>known<span class="_ _11"> </span>as<span class="_ _11"> </span>pages<span class="_ _1"></span>.<span class="_ _11"> </span>The<span class="_"> </span>activity</div><div class="t m5 x17 h26 y4519 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_ _13"> </span>transferring<span class="_"> </span>a<span class="_ _13"> </span>page<span class="_"> </span>between<span class="_ _13"> </span>disk<span class="_"> </span>and<span class="_ _13"> </span>memory<span class="_ _13"> </span>is<span class="_"> </span>known<span class="_ _13"> </span>as<span class="_"> </span><span class="ffa">s<span class="_ _0"></span>wapping<span class="_"> </span><span class="ff7">or<span class="_"> </span></span>paging<span class="ff7">.</span></span></div><div class="t m5 x17 h26 y451a ff7 fs19 fc1 sc0 ls0 ws0">Pages<span class="_ _16"> </span>are<span class="_ _16"> </span><span class="ffa">swapped<span class="_ _11"> </span>in<span class="_ _16"> </span></span>(<span class="ffa">paged<span class="_ _16"> </span>in</span>)<span class="_ _16"> </span>from<span class="_ _16"> </span>disk<span class="_ _16"> </span>to<span class="_ _16"> </span>DRAM,<span class="_ _16"> </span>and<span class="_ _16"> </span><span class="ffa">swapped<span class="_ _16"> </span>out<span class="_ _14"> </span></span>(<span class="ffa">paged</span></div><div class="t m5 x17 h26 y451b ffa fs19 fc1 sc0 ls0 ws0">out<span class="_ _2"></span><span class="ff7">)<span class="_ _11"> </span>from<span class="_ _11"> </span>DRAM<span class="_"> </span>to<span class="_ _11"> </span>disk.<span class="_ _11"> </span>The<span class="_"> </span>strategy<span class="_"> </span>of<span class="_ _11"> </span>waiting<span class="_ _11"> </span>until<span class="_ _11"> </span>the<span class="_ _11"> </span>last<span class="_"> </span>moment<span class="_ _11"> </span>to<span class="_ _11"> </span>swap</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
