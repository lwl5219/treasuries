<div id="pf1e4" class="pf w2 h11" data-page-no="1e4"><div class="pc pc1e4 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1e4.png"/><div class="t m5 x13d h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>4.5<span class="_ _60"> </span>Pipelined<span class="_ _10"> </span>Y86-64<span class="_ _10"> </span>Implementations<span class="_ _3e"> </span><span class="ffe fs1e">483</span></div><div class="t m5 x17 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">instruction<span class="_"> </span>gets<span class="_ _11"> </span>canceled<span class="_"> </span>as<span class="_ _11"> </span>well.<span class="_"> </span>No<span class="_ _11"> </span>instruction<span class="_"> </span>following<span class="_"> </span>one<span class="_ _11"> </span>that<span class="_"> </span>causes<span class="_ _11"> </span>an<span class="_"> </span>ex-</div><div class="t m5 x17 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">ception<span class="_ _14"> </span>can<span class="_ _14"> </span>alter<span class="_ _14"> </span>the<span class="_ _14"> </span>programmer<span class="_ _1"></span>-visible<span class="_ _14"> </span>state.<span class="_ _16"> </span>The<span class="_ _16"> </span>simple<span class="_ _14"> </span>rule<span class="_ _14"> </span>of<span class="_ _15"> </span>carrying<span class="_ _14"> </span>the</div><div class="t m5 x17 h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">exception<span class="_"> </span>status<span class="_ _13"> </span>together<span class="_"> </span>with<span class="_ _13"> </span>all<span class="_"> </span>other<span class="_ _13"> </span>information<span class="_"> </span>about<span class="_"> </span>an<span class="_ _13"> </span>instruction<span class="_"> </span>through</div><div class="t m5 x17 h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>pipeline<span class="_"> </span>provides<span class="_"> </span>a<span class="_"> </span>simple<span class="_"> </span>and<span class="_"> </span>reliable<span class="_"> </span>mechanism<span class="_"> </span>for<span class="_"> </span>handling<span class="_"> </span>exceptions<span class="_ _1"></span>.</div><div class="t m5 x17 h41 y4366 ffe fs29 fc2 sc0 ls0 ws0">4.5.7<span class="_ _48"> </span><span class="fs19">PIPE<span class="_"> </span>Stage<span class="_"> </span>Implementations</span></div><div class="t m5 x17 h26 y4367 ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_"> </span>have<span class="_ _13"> </span>now<span class="_ _13"> </span>created<span class="_"> </span>an<span class="_ _13"> </span>overall<span class="_ _13"> </span>structure<span class="_"> </span>for<span class="_ _13"> </span>PIPE,<span class="_"> </span>our<span class="_ _13"> </span>pipelined<span class="_ _13"> </span>Y86-64<span class="_"> </span>proces-</div><div class="t m5 x17 h26 y4368 ff7 fs19 fc2 sc0 ls0 ws0">sor<span class="_ _13"> </span>with<span class="_ _6"> </span>forwarding.<span class="_ _6"> </span>It<span class="_ _13"> </span>uses<span class="_ _6"> </span>the<span class="_ _13"> </span>same<span class="_ _13"> </span>set<span class="_ _6"> </span>of<span class="_ _13"> </span>hardware<span class="_ _6"> </span>units<span class="_ _13"> </span>as<span class="_ _13"> </span>the<span class="_ _6"> </span>earlier<span class="_ _13"> </span>sequential</div><div class="t m5 x17 h26 y4369 ff7 fs19 fc2 sc0 ls0 ws0">designs<span class="_ _1"></span>,<span class="_ _13"> </span>with<span class="_ _6"> </span>the<span class="_ _6"> </span>addition<span class="_ _13"> </span>of<span class="_ _a"> </span>pipeline<span class="_ _13"> </span>registers<span class="_ _3"></span>,<span class="_ _13"> </span>some<span class="_ _6"> </span>reconﬁgured<span class="_ _13"> </span>logic<span class="_ _a"> </span>blocks<span class="_ _1"></span>,<span class="_ _13"> </span>and</div><div class="t m5 x17 h26 y436a ff7 fs19 fc2 sc0 ls0 ws0">additional<span class="_"> </span>pipeline<span class="_ _11"> </span>control<span class="_ _11"> </span>logic.<span class="_"> </span>In<span class="_ _11"> </span>this<span class="_ _11"> </span>section,<span class="_ _11"> </span>we<span class="_"> </span>go<span class="_ _11"> </span>through<span class="_ _11"> </span>the<span class="_ _11"> </span>design<span class="_ _11"> </span>of<span class="_"> </span>the</div><div class="t m5 x17 h26 y436b ff7 fs19 fc2 sc0 ls0 ws0">different<span class="_ _13"> </span>logic<span class="_ _13"> </span>blocks<span class="_ _1"></span>,<span class="_"> </span>deferring<span class="_ _13"> </span>the<span class="_ _13"> </span>design<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>pipeline<span class="_ _13"> </span>control<span class="_ _13"> </span>logic<span class="_ _13"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>next</div><div class="t m5 x17 h26 y436c ff7 fs19 fc2 sc0 ls0 ws0">section.<span class="_ _11"> </span>Many<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>logic<span class="_ _16"> </span>blocks<span class="_ _11"> </span>are<span class="_ _11"> </span>identical<span class="_ _16"> </span>to<span class="_ _11"> </span>their<span class="_ _11"> </span>counterparts<span class="_ _16"> </span>in<span class="_ _11"> </span>SEQ<span class="_ _11"> </span>and</div><div class="t m5 x17 h26 y436d ff7 fs19 fc2 sc0 ls0 ws0">SEQ+,<span class="_ _11"> </span>except<span class="_ _11"> </span>that<span class="_ _11"> </span>we<span class="_ _16"> </span>must<span class="_"> </span>choose<span class="_ _16"> </span>proper<span class="_"> </span>versions<span class="_ _16"> </span>of<span class="_"> </span>the<span class="_ _16"> </span>different<span class="_"> </span>signals<span class="_ _16"> </span>from</div><div class="t m5 x17 h26 y436e ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _11"> </span>pipeline<span class="_ _16"> </span>registers<span class="_ _16"> </span>(written<span class="_ _11"> </span>with<span class="_ _16"> </span>the<span class="_ _11"> </span>pipeline<span class="_ _16"> </span>register<span class="_ _16"> </span>name<span class="_ _1"></span>,<span class="_ _16"> </span>written<span class="_ _16"> </span>in<span class="_ _11"> </span>upper<span class="_ _1"></span>-</div><div class="t m5 x17 h26 y436f ff7 fs19 fc2 sc0 ls0 ws0">case<span class="_ _1"></span>,<span class="_ _11"> </span>as<span class="_"> </span>a<span class="_ _11"> </span>preﬁx)<span class="_"> </span>or<span class="_ _11"> </span>from<span class="_"> </span>the<span class="_ _11"> </span>stage<span class="_"> </span>computations<span class="_ _11"> </span>(written<span class="_"> </span>with<span class="_ _11"> </span>the<span class="_"> </span>ﬁrst<span class="_ _11"> </span>character</div><div class="t m5 x17 h26 y4370 ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_"> </span>the<span class="_"> </span>stage<span class="_"> </span>name<span class="_ _1"></span>,<span class="_"> </span>written<span class="_"> </span>in<span class="_"> </span>lowercase,<span class="_"> </span>as<span class="_"> </span>a<span class="_"> </span>preﬁx).</div><div class="t m5 x26 h26 y4371 ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_"> </span>an<span class="_ _11"> </span>example,<span class="_"> </span>compare<span class="_ _11"> </span>the<span class="_ _11"> </span>HCL<span class="_ _11"> </span>code<span class="_ _11"> </span>for<span class="_ _11"> </span>the<span class="_ _11"> </span>logic<span class="_ _11"> </span>that<span class="_ _11"> </span>generates<span class="_ _11"> </span>the<span class="_ _11"> </span><span class="ff6">srcA</span></div><div class="t m5 x17 h26 y4372 ff7 fs19 fc2 sc0 ls0 ws0">signal<span class="_"> </span>in<span class="_"> </span>SEQ<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>corresponding<span class="_"> </span>code<span class="_"> </span>in<span class="_"> </span>PIPE:</div><div class="t m5 x26 h3a y4373 ffd fs19 fc2 sc0 ls0 ws0">#<span class="_ _11"> </span>Code<span class="_ _16"> </span>from<span class="_ _16"> </span>SEQ</div><div class="t m5 x17 h2d y4374 ffd fs1e fc2 sc0 ls0 ws0">word<span class="_ _e"> </span>srcA<span class="_ _1f"> </span>=<span class="_ _1f"> </span>[</div><div class="t m5 x21e h2d y4375 ffd fs1e fc2 sc0 ls0 ws0">icode<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _1f"> </span>IRRMOVQ,<span class="_ _e"> </span>IRMMOVQ,<span class="_ _1f"> </span>IOPQ,<span class="_ _e"> </span>IPUSHQ<span class="_ _1a"> </span>}<span class="_ _1f"> </span>:<span class="_ _1f"> </span>rA;</div><div class="t m5 x21e h2d y4376 ffd fs1e fc2 sc0 ls0 ws0">icode<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _1f"> </span>IPOPQ,<span class="_ _e"> </span>IRET<span class="_ _1f"> </span>}<span class="_ _e"> </span>:<span class="_ _1f"> </span>RRSP;</div><div class="t m5 x21e h2d y4377 ffd fs1e fc2 sc0 ls0 ws0">1<span class="_ _e"> </span>:<span class="_ _1f"> </span>RNONE;<span class="_ _1f"> </span>#<span class="_ _e"> </span>Don’t<span class="_ _1f"> </span>need<span class="_ _e"> </span>register</div><div class="t m5 x17 h2d y4378 ffd fs1e fc2 sc0 ls0 ws0">];</div><div class="t m5 x26 h3a y4379 ffd fs19 fc2 sc0 ls0 ws0">#<span class="_ _11"> </span>Code<span class="_ _16"> </span>from<span class="_ _16"> </span>PIPE</div><div class="t m5 x17 h2d y437a ffd fs1e fc2 sc0 ls0 ws0">word<span class="_ _e"> </span>d_srcA<span class="_ _1f"> </span>=<span class="_ _1f"> </span>[</div><div class="t m5 x21e h2d y437b ffd fs1e fc2 sc0 ls0 ws0">D_icode<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _1f"> </span>IRRMOVQ,<span class="_ _e"> </span>IRMMOVQ,<span class="_ _1f"> </span>IOPQ,<span class="_ _e"> </span>IPUSHQ<span class="_ _1a"> </span>}<span class="_ _1f"> </span>:<span class="_ _1f"> </span>D_rA;</div><div class="t m5 x21e h2d y437c ffd fs1e fc2 sc0 ls0 ws0">D_icode<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _1f"> </span>IPOPQ,<span class="_ _e"> </span>IRET<span class="_ _1f"> </span>}<span class="_ _e"> </span>:<span class="_ _1f"> </span>RRSP;</div><div class="t m5 x21e h2d y437d ffd fs1e fc2 sc0 ls0 ws0">1<span class="_ _e"> </span>:<span class="_ _1f"> </span>RNONE;<span class="_ _1f"> </span>#<span class="_ _e"> </span>Don’t<span class="_ _1f"> </span>need<span class="_ _e"> </span>register</div><div class="t m5 x17 h2d y437e ffd fs1e fc2 sc0 ls0 ws0">];</div><div class="t m5 x26 h26 y437f ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>hey<span class="_ _11"> </span>differ<span class="_ _16"> </span>only<span class="_"> </span>in<span class="_ _16"> </span>the<span class="_"> </span>preﬁxes<span class="_ _16"> </span>added<span class="_"> </span>to<span class="_ _16"> </span>the<span class="_"> </span>PIPE<span class="_ _16"> </span>signals:<span class="_"> </span><span class="ffd">D_<span class="_ _16"> </span></span>for<span class="_"> </span>the<span class="_ _16"> </span>source</div><div class="t m5 x17 h26 y4380 ff7 fs19 fc2 sc0 ls0 ws0">values<span class="_ _1"></span>,<span class="_ _11"> </span>to<span class="_ _16"> </span>indicate<span class="_"> </span>that<span class="_ _16"> </span>the<span class="_"> </span>signals<span class="_ _16"> </span>come<span class="_"> </span>from<span class="_ _16"> </span>pipeline<span class="_"> </span>register<span class="_ _16"> </span>D<span class="_ _3"></span>,<span class="_ _11"> </span>and<span class="_ _16"> </span><span class="ffd">d_<span class="_ _11"> </span></span>for<span class="_ _11"> </span>the</div><div class="t m5 x17 h26 y4381 ff7 fs19 fc2 sc0 ls0 ws0">result<span class="_ _6"> </span>value,<span class="_ _6"> </span>to<span class="_ _6"> </span>indicate<span class="_ _13"> </span>that<span class="_ _6"> </span>it<span class="_ _6"> </span>is<span class="_ _13"> </span>generated<span class="_ _a"> </span>in<span class="_ _13"> </span>the<span class="_ _6"> </span>decode<span class="_ _6"> </span>stage.<span class="_ _a"> </span>T<span class="_ _3"></span>o<span class="_ _6"> </span>avoid<span class="_ _13"> </span>repetition,</div><div class="t m5 x17 h26 y4382 ff7 fs19 fc2 sc0 ls0 ws0">we<span class="_ _13"> </span>will<span class="_ _13"> </span>not<span class="_ _13"> </span>show<span class="_ _13"> </span>the<span class="_"> </span>HCL<span class="_ _13"> </span>code<span class="_ _13"> </span>here<span class="_ _13"> </span>for<span class="_ _13"> </span>blocks<span class="_ _13"> </span>that<span class="_ _13"> </span>only<span class="_ _13"> </span>differ<span class="_"> </span>from<span class="_ _13"> </span>those<span class="_ _13"> </span>in<span class="_ _13"> </span>SEQ</div><div class="t m5 x17 h26 y4383 ff7 fs19 fc2 sc0 ls0 ws0">because<span class="_ _14"> </span>of<span class="_ _14"> </span>the<span class="_ _14"> </span>preﬁxes<span class="_ _15"> </span>on<span class="_ _14"> </span>names<span class="_ _1"></span>.<span class="_ _14"> </span>As<span class="_ _14"> </span>a<span class="_ _15"> </span>reference<span class="_ _1"></span>,<span class="_ _15"> </span>the<span class="_ _15"> </span>complete<span class="_ _14"> </span>HCL<span class="_ _14"> </span>code<span class="_ _14"> </span>for</div><div class="t m5 x17 h26 y4384 ff7 fs19 fc2 sc0 ls0 ws0">PIPE<span class="_"> </span>is<span class="_"> </span>given<span class="_"> </span>in<span class="_"> </span>W<span class="_ _3"></span>eb<span class="_"> </span>Aside<span class="_"> </span><span class="ff9">arch:hcl<span class="_ _10"> </span></span>on<span class="_"> </span>page<span class="_"> </span>508.</div><div class="t m5 x17 h42 y2fb5 ff6 fs29 fc6 sc0 ls0 ws0">PC<span class="_ _11"> </span>Selection<span class="_ _16"> </span>and<span class="_ _16"> </span>Fetch<span class="_ _11"> </span>Stage</div><div class="t m5 x17 h26 y7a6 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _16"> </span>4.57<span class="_ _16"> </span>provides<span class="_ _16"> </span>a<span class="_ _11"> </span>detailed<span class="_ _16"> </span>view<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>PIPE<span class="_ _16"> </span>fetch<span class="_ _16"> </span>stage<span class="_ _11"> </span>logic.<span class="_ _16"> </span>As<span class="_ _11"> </span>discussed</div><div class="t m5 x17 h26 y7a7 ff7 fs19 fc1 sc0 ls0 ws0">earlier,<span class="_ _16"> </span>this<span class="_ _14"> </span>stage<span class="_ _16"> </span>must<span class="_ _14"> </span>also<span class="_ _14"> </span>select<span class="_ _16"> </span>a<span class="_ _14"> </span>current<span class="_ _16"> </span>value<span class="_ _14"> </span>for<span class="_ _16"> </span>the<span class="_ _14"> </span>program<span class="_ _14"> </span>counter<span class="_ _16"> </span>and</div><div class="t m5 x17 h26 y7a8 ff7 fs19 fc1 sc0 ls0 ws0">predict<span class="_ _16"> </span>the<span class="_ _14"> </span>next<span class="_ _16"> </span>PC<span class="_ _14"> </span>value<span class="_ _1"></span>.<span class="_ _14"> </span>T<span class="_ _1"></span>he<span class="_ _14"> </span>hardware<span class="_ _16"> </span>units<span class="_ _14"> </span>for<span class="_ _16"> </span>reading<span class="_ _14"> </span>the<span class="_ _16"> </span>instruction<span class="_ _14"> </span>from</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
