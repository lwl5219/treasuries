<div id="pf100" class="pf w2 h11" data-page-no="100"><div class="pc pc100 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg100.png"/><div class="t m5 x1dc h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>3.6<span class="_ _60"> </span>Control<span class="_ _3e"> </span><span class="ffe fs1e">255</span></div><div class="t m5 x17 h47 yb1f ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>3.20<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>369)</span></div><div class="t m5 x17 h26 yb20 ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _13"> </span>the<span class="_ _6"> </span>following<span class="_ _13"> </span>C<span class="_ _6"> </span>function,<span class="_ _13"> </span>we<span class="_ _6"> </span>have<span class="_ _13"> </span>left<span class="_ _6"> </span>the<span class="_ _13"> </span>deÔ¨Ånition<span class="_ _6"> </span>of<span class="_ _13"> </span>operation<span class="_ _6"> </span><span class="ffd">OP<span class="_ _13"> </span></span>incomplete:</div><div class="t m5 x17 h2d y265a ffd fs1e fc2 sc0 ls0 ws0">#define<span class="_ _e"> </span>OP<span class="_ _6b"> </span>/*<span class="_ _1f"> </span>Unknown<span class="_ _e"> </span>operator<span class="_ _1f"> </span>*/</div><div class="t m5 x17 h2d y265b ffd fs1e fc2 sc0 ls0 ws0">short<span class="_ _e"> </span>arith(short<span class="_ _1f"> </span>x)<span class="_ _1f"> </span>{</div><div class="t m5 x1b6 h2d y265c ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>x<span class="_ _1f"> </span>OP<span class="_ _1f"> </span>16;</div><div class="t m5 x17 h2d y265d ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x17 h26 y265e ff7 fs19 fc2 sc0 ls0 ws0">When<span class="_"> </span>compiled,<span class="_"> </span><span class="ff9">gcc<span class="_ _10"> </span></span>generates<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>assembly<span class="_"> </span>code:</div><div class="t m5 xee h61 y265f ff13 fs35 fc6 sc0 ls0 ws0">short<span class="_ _f"> </span>arith(short<span class="_ _f"> </span>x)</div><div class="t m5 xee h61 y2660 ff13 fs35 fc6 sc0 ls0 ws0">x<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi</div><div class="t m5 x17 h2d y2661 ffd fs1e fc2 sc0 ls0 ws0">arith:</div><div class="t m5 x72 h2d y2662 ffd fs1e fc2 sc0 ls0 ws0">leaq<span class="_ _46"> </span>15(%rdi),<span class="_ _e"> </span>%rbx</div><div class="t m5 x72 h2d y2663 ffd fs1e fc2 sc0 ls0 ws0">testq<span class="_ _3f"> </span>%rdi,<span class="_ _e"> </span>%rdi</div><div class="t m5 x72 h2d y2664 ffd fs1e fc2 sc0 ls0 ws0">cmovns<span class="_ _1a"> </span>%rdi,<span class="_ _e"> </span>%rbx</div><div class="t m5 x72 h2d y2665 ffd fs1e fc2 sc0 ls0 ws0">sarq<span class="_ _46"> </span>$4,<span class="_ _e"> </span>%rbx</div><div class="t m5 x72 h2d y2666 ffd fs1e fc2 sc0 ls0 ws0">ret</div><div class="t m5 x34 h26 y2667 ff7 fs19 fc2 sc0 ls0 ws0">A.<span class="_ _1f"> </span>What<span class="_"> </span>operation<span class="_"> </span>is<span class="_"> </span><span class="ffd">OP</span>?</div><div class="t m5 x34 h26 y2668 ff7 fs19 fc2 sc0 ls0 ws0">B<span class="_ _3"></span>.<span class="_ _1d"> </span>Annotate<span class="_"> </span>the<span class="_"> </span>code<span class="_"> </span>to<span class="_"> </span>explain<span class="_"> </span>how<span class="_"> </span>it<span class="_"> </span>works<span class="_ _1"></span>.</div><div class="t m5 x17 h47 y2669 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>3.21<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>369)</span></div><div class="t m5 x17 h26 y266a ff7 fs19 fc1 sc0 ls0 ws0">Starting<span class="_"> </span>with<span class="_"> </span>C<span class="_"> </span>code<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>form</div><div class="t m5 x17 h2d y266b ffd fs1e fc2 sc0 ls0 ws0">short<span class="_ _e"> </span>test(short<span class="_ _1f"> </span>x,<span class="_ _1f"> </span>short<span class="_ _e"> </span>y)<span class="_ _1f"> </span>{</div><div class="t m5 x1b6 h2d y266c ffd fs1e fc2 sc0 ls0 ws0">short<span class="_ _e"> </span>val<span class="_ _1f"> </span>=</div><div class="t m5 x15c h2d y266d ffd fs1e fc2 sc0 ls0 ws0">;</div><div class="t m5 x1b6 h2d y266e ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>(</div><div class="t m5 x32 h2d y266f ffd fs1e fc2 sc0 ls33 ws0">){</div><div class="t m5 x21e h2d y2670 ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>(</div><div class="t m5 x154 h2d y2671 ffd fs1e fc2 sc0 ls0 ws0">)</div><div class="t m5 x155 h2d y2672 ffd fs1e fc2 sc0 ls0 ws0">val<span class="_ _e"> </span>=</div><div class="t m5 x21d h2d y2673 ffd fs1e fc2 sc0 ls0 ws0">;</div><div class="t m5 x21e h2d y2674 ffd fs1e fc2 sc0 ls0 ws0">else</div><div class="t m5 x155 h2d y2675 ffd fs1e fc2 sc0 ls0 ws0">val<span class="_ _e"> </span>=</div><div class="t m5 x21d h2d y2676 ffd fs1e fc2 sc0 ls0 ws0">;</div><div class="t m5 x1b6 h2d y2677 ffd fs1e fc2 sc0 ls0 ws0">}<span class="_ _e"> </span>else<span class="_ _1f"> </span>if<span class="_ _1f"> </span>(</div><div class="t m5 x25 h2d y2678 ffd fs1e fc2 sc0 ls0 ws0">)</div><div class="t m5 x21e h2d y2679 ffd fs1e fc2 sc0 ls0 ws0">val<span class="_ _e"> </span>=</div><div class="t m5 x59 h2d y267a ffd fs1e fc2 sc0 ls0 ws0">;</div><div class="t m5 x1b6 h2d y267b ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>val;</div><div class="t m5 x17 h2d y267c ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x17 h26 y267d ff9 fs19 fc2 sc0 ls0 ws0">gcc<span class="_ _10"> </span><span class="ff7">generates<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>assembly<span class="_"> </span>code:</span></div><div class="t m5 xee h61 y107b ff13 fs35 fc6 sc0 ls0 ws0">short<span class="_ _f"> </span>test(short<span class="_ _f"> </span>x,<span class="_ _f"> </span>short<span class="_ _e"> </span>y)</div><div class="t m5 xee h61 y267e ff13 fs35 fc6 sc0 ls0 ws0">x<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi,<span class="_ _f"> </span>y<span class="_ _e"> </span>in<span class="_ _21"> </span>%rsi</div><div class="t m5 x17 h2d y587 ffd fs1e fc2 sc0 ls0 ws0">test:</div><div class="t m5 x72 h2d y267f ffd fs1e fc2 sc0 ls0 ws0">leaq<span class="_ _46"> </span>12(%rsi),<span class="_ _e"> </span>%rbx</div><div class="t m5 x72 h2d y2680 ffd fs1e fc2 sc0 ls0 ws0">testq<span class="_ _3f"> </span>%rdi,<span class="_ _e"> </span>%rdi</div><div class="t m5 x72 h2d y2681 ffd fs1e fc2 sc0 ls0 ws0">jge<span class="_ _8c"> </span>.L2</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
