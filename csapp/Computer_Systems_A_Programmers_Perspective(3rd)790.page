<div id="pf316" class="pf w2 h11" data-page-no="316"><div class="pc pc316 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg316.png"/><div class="t m5 x100 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>8.4<span class="_ _60"> </span>Process<span class="_ _10"> </span>Control<span class="_ _3e"> </span><span class="ffe fs1e">789</span></div><div class="t m5 x17 h2d y140c ffd fs1e fc2 sc0 ls0 ws0">Environment<span class="_ _e"> </span>variables:</div><div class="t m5 x1b6 h2d y140d ffd fs1e fc2 sc0 ls0 ws0">envp[<span class="_ _e"> </span>0]:<span class="_ _1f"> </span>PWD=/usr0/droh/ics/code/ecf</div><div class="t m5 x1b6 h2d y1b95 ffd fs1e fc2 sc0 ls0 ws0">envp[<span class="_ _e"> </span>1]:<span class="_ _1f"> </span>TERM=emacs</div><div class="t m5 x1b6 h2d y6752 ffd fs1e fc2 sc0 ls0 ws0">.</div><div class="t m5 x1b6 h2d y6753 ffd fs1e fc2 sc0 ls0 ws0">.</div><div class="t m5 x1b6 h2d y6754 ffd fs1e fc2 sc0 ls0 ws0">.</div><div class="t m5 x1b6 h2d y6755 ffd fs1e fc2 sc0 ls0 ws0">envp[25]:<span class="_ _e"> </span>USER=droh</div><div class="t m5 x1b6 h2d y6756 ffd fs1e fc2 sc0 ls0 ws0">envp[26]:<span class="_ _e"> </span>SHELL=/usr/local/bin/tcsh</div><div class="t m5 x1b6 h2d y6757 ffd fs1e fc2 sc0 ls0 ws0">envp[27]:<span class="_ _e"> </span>HOME=/usr0/droh</div><div class="t m5 x17 h41 y6758 ffe fs29 fc1 sc0 ls0 ws0">8.4.6<span class="_ _48"> </span><span class="fs19">Using<span class="_"> </span><span class="ffd fs1c">fork<span class="_ _11"> </span></span>and<span class="_"> </span><span class="ffd fs1c">execve<span class="_ _11"> </span></span>to<span class="_"> </span>Run<span class="_"> </span>Programs</span></div><div class="t m5 x17 h26 y6759 ff7 fs19 fc1 sc0 ls0 ws0">Programs<span class="_ _11"> </span>such<span class="_ _16"> </span>as<span class="_ _16"> </span>Unix<span class="_ _11"> </span>shells<span class="_ _16"> </span>and<span class="_ _16"> </span>W<span class="_ _3"></span>eb<span class="_ _16"> </span>servers<span class="_ _11"> </span>make<span class="_ _16"> </span>heavy<span class="_ _16"> </span>use<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span><span class="ffd">fork<span class="_ _16"> </span></span>and</div><div class="t m5 x17 h26 y675a ffd fs19 fc1 sc0 ls0 ws0">execve<span class="_ _15"> </span><span class="ff7">functions<span class="_ _1"></span>.<span class="_ _15"> </span>A<span class="_ _15"> </span><span class="ffa">shell<span class="_ _21"> </span></span>is<span class="_ _15"> </span>an<span class="_ _15"> </span>interactive<span class="_ _15"> </span>application-level<span class="_ _15"> </span>program<span class="_ _15"> </span>that<span class="_ _15"> </span>runs</span></div><div class="t m5 x17 h26 y675b ff7 fs19 fc1 sc0 ls0 ws0">other<span class="_ _15"> </span>programs<span class="_ _21"> </span>on<span class="_ _21"> </span>behalf<span class="_ _21"> </span>of<span class="_ _21"> </span>the<span class="_ _15"> </span>user.<span class="_ _15"> </span>The<span class="_ _15"> </span>original<span class="_ _21"> </span>shell<span class="_ _15"> </span>was<span class="_ _21"> </span>the<span class="_ _21"> </span><span class="ffd">sh<span class="_ _21"> </span></span>program,</div><div class="t m5 x17 h26 y675c ff7 fs19 fc1 sc0 ls0 ws0">which<span class="_ _13"> </span>was<span class="_ _13"> </span>followed<span class="_ _13"> </span>by<span class="_ _13"> </span>variants<span class="_ _13"> </span>such<span class="_ _13"> </span>as<span class="_ _6"> </span><span class="ffd">csh</span>,<span class="_"> </span><span class="ffd">tcsh</span>,<span class="_ _13"> </span><span class="ffd">ksh</span>,<span class="_ _13"> </span>and<span class="_ _13"> </span><span class="ffd">bash</span>.<span class="_ _13"> </span>A<span class="_ _13"> </span>shell<span class="_ _6"> </span>performs</div><div class="t m5 x17 h26 y675d ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_ _21"> </span>sequence<span class="_ _f"> </span>of<span class="_ _21"> </span><span class="ffa">read/evaluate<span class="_ _f"> </span></span>steps<span class="_ _f"> </span>and<span class="_ _21"> </span>then<span class="_ _f"> </span>terminates<span class="_ _1"></span>.<span class="_ _21"> </span>The<span class="_ _15"> </span>read<span class="_ _f"> </span>step<span class="_ _21"> </span>reads<span class="_ _f"> </span>a</div><div class="t m5 x17 h26 y675e ff7 fs19 fc1 sc0 ls0 ws0">command<span class="_ _13"> </span>line<span class="_ _13"> </span>from<span class="_"> </span>the<span class="_ _13"> </span>user<span class="_ _0"></span>.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_"> </span>evaluate<span class="_ _13"> </span>step<span class="_ _13"> </span>parses<span class="_ _13"> </span>the<span class="_ _13"> </span>command<span class="_"> </span>line<span class="_ _13"> </span>and<span class="_ _13"> </span>runs</div><div class="t m5 x17 h26 y675f ff7 fs19 fc1 sc0 ls0 ws0">programs<span class="_"> </span>on<span class="_"> </span>behalf<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>user.</div><div class="t m5 x26 h26 y6760 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _e"> </span>8.23<span class="_ _e"> </span>shows<span class="_ _f"> </span>the<span class="_ _e"> </span>main<span class="_ _e"> </span>routine<span class="_ _f"> </span>of<span class="_ _e"> </span>a<span class="_ _e"> </span>simple<span class="_ _f"> </span>shell.<span class="_ _e"> </span>T<span class="_ _1"></span>he<span class="_ _e"> </span>shell<span class="_ _e"> </span>prints<span class="_ _f"> </span>a</div><div class="t m5 x17 h26 y6761 ff7 fs19 fc1 sc0 ls0 ws0">command-line<span class="_ _11"> </span>prompt,<span class="_ _11"> </span>waits<span class="_ _11"> </span>for<span class="_ _11"> </span>the<span class="_ _11"> </span>user<span class="_ _11"> </span>to<span class="_ _11"> </span>type<span class="_ _11"> </span>a<span class="_ _11"> </span>command<span class="_ _11"> </span>line<span class="_ _11"> </span>on<span class="_ _11"> </span><span class="ffd">stdin</span>,<span class="_ _11"> </span>and</div><div class="t m5 x17 h26 y6762 ff7 fs19 fc1 sc0 ls0 ws0">then<span class="_"> </span>evaluates<span class="_"> </span>the<span class="_"> </span>command<span class="_"> </span>line<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y6763 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _16"> </span>8.24<span class="_ _16"> </span>shows<span class="_ _11"> </span>the<span class="_ _16"> </span>code<span class="_ _11"> </span>that<span class="_ _16"> </span>evaluates<span class="_ _16"> </span>the<span class="_ _11"> </span>command<span class="_ _16"> </span>line<span class="_ _1"></span>.<span class="_ _16"> </span>Its<span class="_ _16"> </span>ﬁrst<span class="_ _11"> </span>task<span class="_ _16"> </span>is</div><div class="t m5 x17 h26 y6764 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _14"> </span>call<span class="_ _14"> </span>the<span class="_ _14"> </span><span class="ffd">parseline<span class="_ _14"> </span></span>function<span class="_ _14"> </span>(F<span class="_ _0"></span>igure<span class="_ _14"> </span>8.25),<span class="_ _15"> </span>which<span class="_ _14"> </span>parses<span class="_ _14"> </span>the<span class="_ _14"> </span>space-separated</div><div class="t m5 x17 h26 y6765 ff7 fs19 fc1 sc0 ls0 ws0">command-line<span class="_ _6"> </span>arguments<span class="_ _13"> </span>and<span class="_ _6"> </span>builds<span class="_ _6"> </span>the<span class="_ _13"> </span><span class="ffd">argv<span class="_ _6"> </span></span>vector<span class="_ _13"> </span>that<span class="_ _6"> </span>will<span class="_ _6"> </span>eventually<span class="_ _13"> </span>be<span class="_ _6"> </span>passed</div><div class="t m5 x17 h26 y6766 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_"> </span><span class="ffd">execve</span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>ﬁrst<span class="_"> </span>argument<span class="_"> </span>is<span class="_"> </span>assumed<span class="_"> </span>to<span class="_ _11"> </span>be<span class="_"> </span>either<span class="_"> </span>the<span class="_"> </span>name<span class="_"> </span>of<span class="_"> </span>a<span class="_"> </span>built-in<span class="_"> </span>shell</div><div class="t m5 x17 h26 y6767 ff7 fs19 fc1 sc0 ls0 ws0">command<span class="_ _13"> </span>that<span class="_"> </span>is<span class="_ _13"> </span>interpreted<span class="_"> </span>immediately<span class="_ _7"></span>,<span class="_"> </span>or<span class="_"> </span>an<span class="_ _13"> </span>executable<span class="_"> </span>object<span class="_ _13"> </span>ﬁle<span class="_ _13"> </span>that<span class="_"> </span>will<span class="_ _13"> </span>be</div><div class="t m5 x17 h26 y6768 ff7 fs19 fc1 sc0 ls0 ws0">loaded<span class="_"> </span>and<span class="_"> </span>run<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>context<span class="_"> </span>of<span class="_"> </span>a<span class="_"> </span>new<span class="_"> </span>child<span class="_"> </span>process<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y6769 ff7 fs19 fc1 sc0 ls0 ws0">If<span class="_"> </span>the<span class="_"> </span>last<span class="_"> </span>argument<span class="_"> </span>is<span class="_"> </span>an<span class="_"> </span>‘&amp;’<span class="_"> </span>character,<span class="_"> </span>then<span class="_"> </span><span class="ffd">parseline<span class="_ _10"> </span></span>returns<span class="_"> </span>1,<span class="_"> </span>indicating</div><div class="t m5 x17 h26 y676a ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_ _11"> </span>the<span class="_ _11"> </span>program<span class="_ _11"> </span>should<span class="_ _11"> </span>be<span class="_ _16"> </span>executed<span class="_"> </span>in<span class="_ _16"> </span>the<span class="_"> </span><span class="ffa">background<span class="_ _16"> </span></span>(the<span class="_ _11"> </span>shell<span class="_ _11"> </span>does<span class="_ _11"> </span>not<span class="_ _11"> </span>wait</div><div class="t m5 x17 h26 y676b ff7 fs19 fc1 sc0 ls0 ws0">for<span class="_"> </span>it<span class="_"> </span>to<span class="_ _13"> </span>complete).<span class="_"> </span>Otherwise,<span class="_ _13"> </span>it<span class="_"> </span>returns<span class="_"> </span>0,<span class="_"> </span>indicating<span class="_"> </span>that<span class="_"> </span>the<span class="_ _13"> </span>program<span class="_"> </span>should<span class="_"> </span>be</div><div class="t m5 x17 h26 y676c ff7 fs19 fc1 sc0 ls0 ws0">run<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span><span class="ffa">foreground<span class="_"> </span></span>(the<span class="_"> </span>shell<span class="_"> </span>waits<span class="_"> </span>for<span class="_"> </span>it<span class="_"> </span>to<span class="_"> </span>complete).</div><div class="t m5 x34 h2a y676d fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">Programs<span class="_ _11"> </span>versus<span class="_ _11"> </span>processes</span></div><div class="t m5 x34 h2b y676e ff7 fs1e fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _16"> </span>is<span class="_ _11"> </span>a<span class="_ _11"> </span>good<span class="_ _16"> </span>place<span class="_ _11"> </span>to<span class="_ _11"> </span>pause<span class="_ _11"> </span>and<span class="_ _16"> </span>make<span class="_ _11"> </span>sure<span class="_ _11"> </span>you<span class="_ _16"> </span>understand<span class="_ _11"> </span>the<span class="_ _11"> </span>distinction<span class="_ _16"> </span>between<span class="_ _11"> </span>a<span class="_ _11"> </span>program<span class="_ _11"> </span>and</div><div class="t m5 x34 h2b y676f ff7 fs1e fc2 sc0 ls0 ws0">a<span class="_ _10"> </span>process<span class="_ _0"></span>.<span class="_ _10"> </span>A<span class="_ _11"> </span>program<span class="_ _11"> </span>is<span class="_ _10"> </span>a<span class="_ _11"> </span>collection<span class="_ _11"> </span>of<span class="_ _10"> </span>code<span class="_ _11"> </span>and<span class="_ _11"> </span>data;<span class="_ _11"> </span>programs<span class="_ _10"> </span>can<span class="_ _11"> </span>exist<span class="_ _11"> </span>as<span class="_ _10"> </span>object<span class="_ _11"> </span>ﬁles<span class="_ _11"> </span>on<span class="_ _10"> </span>disk<span class="_ _11"> </span>or<span class="_ _11"> </span>as</div><div class="t m5 x34 h2b y6770 ff7 fs1e fc2 sc0 ls0 ws0">segments<span class="_ _11"> </span>in<span class="_ _16"> </span>an<span class="_ _16"> </span>address<span class="_ _11"> </span>space.<span class="_ _11"> </span>A<span class="_ _16"> </span>process<span class="_ _11"> </span>is<span class="_ _16"> </span>a<span class="_ _16"> </span>speciﬁc<span class="_ _11"> </span>instance<span class="_ _16"> </span>of<span class="_ _16"> </span>a<span class="_ _11"> </span>program<span class="_ _16"> </span>in<span class="_ _16"> </span>execution;<span class="_ _16"> </span>a<span class="_ _16"> </span>program</div><div class="t m5 x34 h2b y6771 ff7 fs1e fc2 sc0 ls0 ws0">always<span class="_"> </span>runs<span class="_"> </span>in<span class="_ _10"> </span>the<span class="_ _10"> </span>context<span class="_ _10"> </span>of<span class="_ _10"> </span>some<span class="_ _10"> </span>process<span class="_ _0"></span>.<span class="_"> </span>Understanding<span class="_"> </span>this<span class="_"> </span>distinction<span class="_ _11"> </span>is<span class="_"> </span>important<span class="_"> </span>if<span class="_"> </span>you<span class="_ _10"> </span>want<span class="_ _10"> </span>to</div><div class="t m5 x34 h2b y6772 ff7 fs1e fc2 sc0 ls0 ws0">understand<span class="_ _11"> </span>the<span class="_ _11"> </span><span class="ffd">fork<span class="_ _10"> </span></span>and<span class="_ _11"> </span><span class="ffd">execve<span class="_ _11"> </span></span>functions<span class="_ _1"></span>.<span class="_ _11"> </span>The<span class="_"> </span><span class="ffd">fork<span class="_ _11"> </span></span>function<span class="_ _11"> </span>runs<span class="_ _11"> </span>the<span class="_ _11"> </span>same<span class="_ _11"> </span>program<span class="_ _11"> </span>in<span class="_ _11"> </span>a<span class="_ _11"> </span>new<span class="_ _10"> </span>child</div><div class="t m5 x34 h2b y6773 ff7 fs1e fc2 sc0 ls0 ws0">process<span class="_ _16"> </span>that<span class="_ _16"> </span>is<span class="_ _11"> </span>a<span class="_ _16"> </span>duplicate<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>parent.<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span><span class="ffd">execve<span class="_ _16"> </span></span>function<span class="_ _16"> </span>loads<span class="_ _16"> </span>and<span class="_ _16"> </span>runs<span class="_ _11"> </span>a<span class="_ _16"> </span>new<span class="_ _16"> </span>program<span class="_ _16"> </span>in<span class="_ _16"> </span>the</div><div class="t m5 x34 h2b y6774 ff7 fs1e fc2 sc0 ls0 ws0">context<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>current<span class="_"> </span>process<span class="_ _3"></span>.<span class="_"> </span>While<span class="_"> </span>it<span class="_ _13"> </span>overwrites<span class="_"> </span>the<span class="_ _13"> </span>address<span class="_"> </span>space<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>current<span class="_"> </span>process<span class="_ _3"></span>,<span class="_"> </span>it<span class="_"> </span>does<span class="_"> </span><span class="ffa">not</span></div><div class="t m5 x34 h2b y6775 ff7 fs1e fc2 sc0 ls0 ws0">create<span class="_"> </span>a<span class="_"> </span>new<span class="_"> </span>process<span class="_ _3"></span>.<span class="_"> </span>The<span class="_"> </span>new<span class="_ _13"> </span>program<span class="_"> </span>still<span class="_"> </span>has<span class="_"> </span>the<span class="_"> </span>same<span class="_"> </span>PID<span class="_ _3"></span>,<span class="_"> </span>and<span class="_"> </span>it<span class="_"> </span>inherits<span class="_"> </span>all<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>ﬁle<span class="_"> </span>descriptors</div><div class="t m5 x34 h2b y6776 ff7 fs1e fc2 sc0 ls0 ws0">that<span class="_"> </span>were<span class="_"> </span>open<span class="_"> </span>at<span class="_"> </span>the<span class="_"> </span>time<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>call<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span><span class="ffd">execve<span class="_ _10"> </span></span>function.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
