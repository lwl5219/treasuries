<div id="pf10f" class="pf w2 h11" data-page-no="10f"><div class="pc pc10f w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg10f.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">270<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x14 h34 ye7 ff6 fs16 fc2 sc0 ls0 ws0">(a)<span class="_ _10"> </span>Switch<span class="_ _11"> </span>statement</div><div class="t m5 x14 h2d y2283 ffd fs1e fc2 sc0 ls0 ws0">void<span class="_ _e"> </span>switch_eg(long<span class="_ _1f"> </span>x,<span class="_ _1f"> </span>long<span class="_ _e"> </span>n,</div><div class="t m5 x160 h2d y2284 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>*dest)</div><div class="t m5 x14 h2d y2285 ffd fs1e fc2 sc0 ls0 ws0">{</div><div class="t m5 xc8 h2d y2286 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>val<span class="_ _1f"> </span>=<span class="_ _1f"> </span>x;</div><div class="t m5 xc8 h2d y2288 ffd fs1e fc2 sc0 ls0 ws0">switch<span class="_ _e"> </span>(n)<span class="_ _1f"> </span>{</div><div class="t m5 xc8 h2d y23a2 ffd fs1e fc2 sc0 ls0 ws0">case<span class="_ _e"> </span>100:</div><div class="t m5 x63 h2d y2554 ffd fs1e fc2 sc0 ls0 ws0">val<span class="_ _e"> </span>*=<span class="_ _1f"> </span>13;</div><div class="t m5 x63 h2d y2555 ffd fs1e fc2 sc0 ls0 ws0">break;</div><div class="t m5 xc8 h2d y2557 ffd fs1e fc2 sc0 ls0 ws0">case<span class="_ _e"> </span>102:</div><div class="t m5 x63 h2d y2558 ffd fs1e fc2 sc0 ls0 ws0">val<span class="_ _e"> </span>+=<span class="_ _1f"> </span>10;</div><div class="t m5 x63 h2d y2559 ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Fall<span class="_ _1f"> </span>through<span class="_ _1f"> </span>*/</div><div class="t m5 xc8 h2d y255b ffd fs1e fc2 sc0 ls0 ws0">case<span class="_ _e"> </span>103:</div><div class="t m5 x63 h2d y2840 ffd fs1e fc2 sc0 ls0 ws0">val<span class="_ _e"> </span>+=<span class="_ _1f"> </span>11;</div><div class="t m5 x63 h2d y2841 ffd fs1e fc2 sc0 ls0 ws0">break;</div><div class="t m5 xc8 h2d y2842 ffd fs1e fc2 sc0 ls0 ws0">case<span class="_ _e"> </span>104:</div><div class="t m5 xc8 h2d y2843 ffd fs1e fc2 sc0 ls0 ws0">case<span class="_ _e"> </span>106:</div><div class="t m5 x63 h2d y2844 ffd fs1e fc2 sc0 ls0 ws0">val<span class="_ _e"> </span>*=<span class="_ _1f"> </span>val;</div><div class="t m5 x63 h2d y2845 ffd fs1e fc2 sc0 ls0 ws0">break;</div><div class="t m5 xc8 h2d y2846 ffd fs1e fc2 sc0 ls0 ws0">default:</div><div class="t m5 x63 h2d y2847 ffd fs1e fc2 sc0 ls33 ws0">v<span class="_ _41"></span>a<span class="_ _41"></span>l=0<span class="_ _41"></span>;</div><div class="t m5 xc8 h2d y2848 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 xc8 h2d y2849 ffd fs1e fc2 sc0 ls0 ws0">*dest<span class="_ _e"> </span>=<span class="_ _1f"> </span>val;</div><div class="t m5 x14 h2d y284a ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x9c h34 y284b ff6 fs16 fc2 sc0 ls0 ws0">(b)<span class="_ _10"> </span>T<span class="_ _1"></span>ranslation<span class="_ _10"> </span>into<span class="_ _11"> </span>extended<span class="_ _10"> </span>C</div><div class="t m5 x116 h2d y284c ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">void<span class="_ _1f"> </span>switch_eg_impl(long<span class="_ _e"> </span>x,<span class="_ _1f"> </span>long<span class="_ _1f"> </span>n,</span></div><div class="t m5 x116 h2d y284d ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _15e"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>*dest)</span></div><div class="t m5 x116 h2d y284e ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x116 h2e y284f ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 x16 h2d y2850 ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Table<span class="_ _1f"> </span>of<span class="_ _1f"> </span>code<span class="_ _e"> </span>pointers<span class="_ _1f"> </span>*/</div><div class="t m5 x116 h2d y2851 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _20"> </span><span class="ffd fs1e fc2">static<span class="_ _e"> </span>void<span class="_ _1f"> </span>*jt[7]<span class="_ _1f"> </span>=<span class="_ _e"> </span>{</span></div><div class="t m5 x116 h2d y2852 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _70"> </span><span class="ffd fs1e fc2">&amp;&amp;loc_A,<span class="_ _e"> </span>&amp;&amp;loc_def,<span class="_ _1f"> </span>&amp;&amp;loc_B,</span></div><div class="t m5 x116 h2d y2853 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _70"> </span><span class="ffd fs1e fc2">&amp;&amp;loc_C,<span class="_ _e"> </span>&amp;&amp;loc_D,<span class="_ _1f"> </span>&amp;&amp;loc_def,</span></div><div class="t m5 x116 h2d y2854 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _70"> </span><span class="ffd fs1e fc2">&amp;&amp;loc_D</span></div><div class="t m5 x116 h2d y2855 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _20"> </span><span class="ffd fs1e fc2">};</span></div><div class="t m5 x167 h2d y2856 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _20"> </span><span class="ffd fs1e fc2">unsigned<span class="_ _e"> </span>long<span class="_ _1f"> </span>inde<span class="ls33">x=n-</span>100;</span></div><div class="t m5 x167 h2d y2857 ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _20"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>val;</span></div><div class="t m5 x167 h2e y2858 ff6 fs20 fc6 sc0 ls0 ws0">12</div><div class="t m5 x167 h2e y2859 ff6 fs20 fc6 sc0 ls0 ws0">13</div><div class="t m5 x16 h2d y285a ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>(index<span class="_ _1f"> </span>&gt;<span class="_ _1f"> </span>6)</div><div class="t m5 x167 h2d y285b ff6 fs20 fc6 sc0 ls0 ws0">14<span class="_ _70"> </span><span class="ffd fs1e fc2">goto<span class="_ _e"> </span>loc_def;</span></div><div class="t m5 x167 h2d y285c ff6 fs20 fc6 sc0 ls0 ws0">15<span class="_ _20"> </span><span class="ffd fs1e fc2">/*<span class="_ _e"> </span>Multiway<span class="_ _1f"> </span>branch<span class="_ _1f"> </span>*/</span></div><div class="t m5 x167 h2d y285d ff6 fs20 fc6 sc0 ls0 ws0">16<span class="_ _20"> </span><span class="ffd fs1e fc2">goto<span class="_ _e"> </span>*jt[index];</span></div><div class="t m5 x167 h2e y285e ff6 fs20 fc6 sc0 ls0 ws0">17</div><div class="t m5 x167 h2e y285f ff6 fs20 fc6 sc0 ls0 ws0">18</div><div class="t m5 x68 h2d y2860 ffd fs1e fc2 sc0 ls0 ws0">loc_A:<span class="_ _46"> </span>/*<span class="_ _e"> </span>Case<span class="_ _1f"> </span>100<span class="_ _1f"> </span>*/</div><div class="t m5 x167 h2d y2861 ff6 fs20 fc6 sc0 ls0 ws0">19<span class="_ _20"> </span><span class="ffd fs1e fc2 ls33">v<span class="_ _41"></span>a<span class="_ _41"></span>l=x*1<span class="_ _41"></span>3<span class="_ _41"></span>;</span></div><div class="t m5 x167 h2d y2862 ff6 fs20 fc6 sc0 ls0 ws0">20<span class="_ _20"> </span><span class="ffd fs1e fc2">goto<span class="_ _e"> </span>done;</span></div><div class="t m5 x167 h2e y2863 ff6 fs20 fc6 sc0 ls0 ws0">21</div><div class="t m5 x68 h2d y2864 ffd fs1e fc2 sc0 ls0 ws0">loc_B:<span class="_ _46"> </span>/*<span class="_ _e"> </span>Case<span class="_ _1f"> </span>102<span class="_ _1f"> </span>*/</div><div class="t m5 x167 h2e y2865 ff6 fs20 fc6 sc0 ls0 ws0">22</div><div class="t m5 x16 h2d y2866 ffd fs1e fc2 sc0 ls33 ws0">x=x+1<span class="_ _41"></span>0<span class="_ _41"></span>;</div><div class="t m5 x167 h2d y2867 ff6 fs20 fc6 sc0 ls0 ws0">23<span class="_ _20"> </span><span class="ffd fs1e fc2">/*<span class="_ _e"> </span>Fall<span class="_ _1f"> </span>through<span class="_ _1f"> </span>*/</span></div><div class="t m5 x167 h2d y2868 ff6 fs20 fc6 sc0 ls0 ws0">24<span class="_ _73"> </span><span class="ffd fs1e fc2">loc_C:<span class="_ _8c"> </span>/*<span class="_ _1f"> </span>Case<span class="_ _e"> </span>103<span class="_ _1f"> </span>*/</span></div><div class="t m5 x167 h2d y2869 ff6 fs20 fc6 sc0 ls0 ws0">25<span class="_ _20"> </span><span class="ffd fs1e fc2 ls33">v<span class="_ _41"></span>a<span class="_ _41"></span>l=x+1<span class="_ _41"></span>1<span class="_ _41"></span>;</span></div><div class="t m5 x167 h2d y286a ff6 fs20 fc6 sc0 ls0 ws0">26<span class="_ _20"> </span><span class="ffd fs1e fc2">goto<span class="_ _e"> </span>done;</span></div><div class="t m5 x167 h2d y286b ff6 fs20 fc6 sc0 ls0 ws0">27<span class="_ _73"> </span><span class="ffd fs1e fc2">loc_D:<span class="_ _46"> </span>/*<span class="_ _1f"> </span>Cases<span class="_ _e"> </span>104,<span class="_ _1f"> </span>106<span class="_ _1f"> </span>*/</span></div><div class="t m5 x167 h2d y286c ff6 fs20 fc6 sc0 ls0 ws0">28<span class="_ _20"> </span><span class="ffd fs1e fc2 ls33">v<span class="_ _41"></span>a<span class="_ _41"></span>l=x*x<span class="_ _41"></span>;</span></div><div class="t m5 x167 h2d y286d ff6 fs20 fc6 sc0 ls0 ws0">29<span class="_ _20"> </span><span class="ffd fs1e fc2">goto<span class="_ _e"> </span>done;</span></div><div class="t m5 x167 h2d y286e ff6 fs20 fc6 sc0 ls0 ws0">30<span class="_ _73"> </span><span class="ffd fs1e fc2">loc_def:<span class="_ _1a"> </span>/*<span class="_ _1f"> </span>Default<span class="_ _e"> </span>case<span class="_ _1f"> </span>*/</span></div><div class="t m5 x167 h2d y286f ff6 fs20 fc6 sc0 ls0 ws0">31<span class="_ _20"> </span><span class="ffd fs1e fc2 ls33">v<span class="_ _41"></span>a<span class="_ _41"></span>l=0<span class="_ _41"></span>;</span></div><div class="t m5 x167 h2d y2870 ff6 fs20 fc6 sc0 ls0 ws0">32<span class="_ _73"> </span><span class="ffd fs1e fc2">done:</span></div><div class="t m5 x167 h2d y2871 ff6 fs20 fc6 sc0 ls0 ws0">33<span class="_ _20"> </span><span class="ffd fs1e fc2">*dest<span class="_ _e"> </span>=<span class="_ _1f"> </span>val;</span></div><div class="t m5 x167 h2e y2872 ff6 fs20 fc6 sc0 ls0 ws0">34</div><div class="t m5 x1d1 h2d y2873 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x14 h3a y2874 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>3.22<span class="_ _c"> </span><span class="fc1">Example<span class="_ _11"> </span><span class="ffd fs19">switch<span class="_ _16"> </span></span>statement<span class="_"> </span>and<span class="_ _11"> </span>its<span class="_ _11"> </span>translation<span class="_ _16"> </span>into<span class="_"> </span>extended<span class="_ _11"> </span>C.<span class="_ _11"> </span><span class="ff6">The<span class="_ _16"> </span>translation<span class="_ _10"> </span>shows<span class="_ _16"> </span>the</span></span></div><div class="t m5 x14 h34 y2875 ff6 fs16 fc1 sc0 ls0 ws0">structure<span class="_ _10"> </span>of<span class="_ _10"> </span>jump<span class="_ _10"> </span>table</div><div class="t m5 x75 h3a y2876 ffd fs19 fc1 sc0 ls0 ws0">jt<span class="_ _10"> </span><span class="ff6 fs16">and<span class="_ _10"> </span>how<span class="_ _10"> </span>it<span class="_ _11"> </span>is<span class="_ _10"> </span>accessed.<span class="_ _10"> </span>Such<span class="_ _10"> </span>tables<span class="_ _11"> </span>are<span class="_ _10"> </span>supported<span class="_ _10"> </span>by<span class="_ _10"> </span><span class="ff1b">gcc<span class="_ _11"> </span></span>as<span class="_ _10"> </span>an<span class="_ _10"> </span>extension<span class="_ _10"> </span>to<span class="_ _11"> </span>the<span class="_ _10"> </span>C</span></div><div class="t m5 x14 h34 y2877 ff6 fs16 fc1 sc0 ls0 ws0">language.</div><div class="t m5 x1d h26 y2878 ff7 fs19 fc1 sc0 ls0 ws0">an<span class="_ _13"> </span>indirect<span class="_ _13"> </span>jump<span class="_ _1"></span>,<span class="_ _13"> </span>and<span class="_ _13"> </span>the<span class="_ _13"> </span>operand<span class="_ _13"> </span>speciﬁes<span class="_ _13"> </span>a<span class="_ _13"> </span>memory<span class="_ _13"> </span>location<span class="_ _13"> </span>indexed<span class="_ _13"> </span>by<span class="_ _13"> </span>register</div><div class="t m5 x1d h26 y2879 ffd fs19 fc1 sc0 ls0 ws0">%eax<span class="ff7">,<span class="_ _e"> </span>which<span class="_ _21"> </span>holds<span class="_ _21"> </span>the<span class="_ _f"> </span>value<span class="_ _f"> </span>of<span class="_ _f"> </span></span>index<span class="ff7">.<span class="_ _21"> </span>(W<span class="_ _1"></span>e<span class="_ _21"> </span>will<span class="_ _f"> </span>see<span class="_ _f"> </span>in<span class="_ _21"> </span>Section<span class="_ _f"> </span>3.8<span class="_ _f"> </span>how<span class="_ _f"> </span>array</span></div><div class="t m5 x1d h26 y287a ff7 fs19 fc1 sc0 ls0 ws0">references<span class="_"> </span>are<span class="_"> </span>translated<span class="_"> </span>into<span class="_"> </span>machine<span class="_"> </span>code<span class="_ _1"></span>.)</div><div class="t m5 x29 h26 y287b ff7 fs19 fc1 sc0 ls0 ws0">Our<span class="_ _21"> </span>C<span class="_ _f"> </span>code<span class="_ _f"> </span>declares<span class="_ _21"> </span>the<span class="_ _f"> </span>jump<span class="_ _f"> </span>table<span class="_ _21"> </span>as<span class="_ _f"> </span>an<span class="_ _f"> </span>array<span class="_ _21"> </span>of<span class="_ _f"> </span>seven<span class="_ _f"> </span>elements<span class="_ _1"></span>,<span class="_ _e"> </span>each</div><div class="t m5 x1d h26 y287c ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_ _f"> </span>which<span class="_ _e"> </span>is<span class="_ _f"> </span>a<span class="_ _e"> </span>pointer<span class="_ _f"> </span>to<span class="_ _e"> </span>a<span class="_ _21"> </span>code<span class="_ _e"> </span>location.<span class="_ _f"> </span>T<span class="_ _0"></span>hese<span class="_ _f"> </span>elements<span class="_ _e"> </span>span<span class="_ _f"> </span>values<span class="_ _e"> </span>0–6<span class="_ _f"> </span>of</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
