<div id="pf254" class="pf w2 h11" data-page-no="254"><div class="pc pc254 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg254.png"/><div class="t m5 x187 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>5.12<span class="_ _60"> </span>Understanding<span class="_ _10"> </span>Memor<span class="_"> </span>y<span class="_ _10"> </span>Per<span class="_ _2"></span>formance<span class="_ _1b"> </span><span class="ffe fs1e">595</span></div><div class="t m5 x17 h2f ye7 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>5.36</div><div class="t m5 x17 h2f y58a ffe fs16 fc1 sc0 ls0 ws0">Abstracting<span class="_ _f"> </span>the</div><div class="t m5 x17 h2f y58b ffe fs16 fc1 sc0 ls0 ws0">operations<span class="_ _16"> </span>for</div><div class="t m5 xc5 h3a y609 ffd fs19 fc1 sc0 ls0 ws0">write_</div><div class="t m5 x17 h3a y504d ffd fs19 fc1 sc0 ls0 ws0">read</div><div class="t m5 x15d h34 y2d53 ffe fs16 fc1 sc0 ls0 ws0">.<span class="_ _6"> </span><span class="ff6">W<span class="_ _0"></span>e<span class="_ _6"> </span>ﬁrst<span class="_ _6"> </span>rearrange<span class="_ _6"> </span>the</span></div><div class="t m5 x17 h34 y2d7c ff6 fs16 fc1 sc0 ls0 ws0">operators<span class="_ _10"> </span>of<span class="_ _11"> </span>Figure<span class="_ _10"> </span>5.35(a)</div><div class="t m5 x17 h34 y2d7d ff6 fs16 fc1 sc0 ls0 ws0">and<span class="_ _11"> </span>then<span class="_ _11"> </span>show<span class="_ _11"> </span>only<span class="_ _11"> </span>those</div><div class="t m5 x17 h34 y504e ff6 fs16 fc1 sc0 ls0 ws0">operations<span class="_ _11"> </span>that<span class="_ _11"> </span>use<span class="_ _11"> </span>values</div><div class="t m5 x17 h34 y504f ff6 fs16 fc1 sc0 ls0 ws0">from<span class="_ _14"> </span>one<span class="_ _15"> </span>iteration<span class="_ _14"> </span>to</div><div class="t m5 x17 h34 y5050 ff6 fs16 fc1 sc0 ls0 ws0">produce<span class="_ _10"> </span>new<span class="_ _10"> </span>values<span class="_ _10"> </span>for<span class="_ _10"> </span>the</div><div class="t m5 x17 h34 y5051 ff6 fs16 fc1 sc0 ls0 ws0">next<span class="_ _10"> </span>(b).</div><div class="t m5 x47 h40 y5052 ff71 fs28 fc1 sc0 ls0 ws0">%rax<span class="_ _ea"> </span>%rdi<span class="_ _13d"> </span>%rsi<span class="_ _13d"> </span>%rdx</div><div class="t m5 x47 h40 y5053 ff71 fs28 fc1 sc0 ls0 ws0">%rax<span class="_ _ec"> </span>%rdx</div><div class="t m5 x23d h3f y5054 ff72 fs27 fc1 sc0 ls214 ws0">s_addr</div><div class="t m5 xba h44 y5055 ff72 fs2a fc1 sc0 ls0 ws0">1</div><div class="t m5 xb8 h44 y5056 ff72 fs2a fc1 sc0 ls0 ws0">2</div><div class="t m5 x48 h44 y5057 ff72 fs2a fc1 sc0 ls0 ws0">3</div><div class="t m5 xb7 h3f y5058 ff72 fs27 fc1 sc0 ls214 ws0">s_data</div><div class="t m5 xa0 h3f y5059 ff72 fs27 fc1 sc0 ls214 ws0">load</div><div class="t m5 x151 h3f y505a ff72 fs27 fc1 sc0 ls214 ws0">(a)<span class="_ _1ed"> </span>(b)</div><div class="t m5 x255 h3f y505b ff72 fs27 fc1 sc0 ls214 ws0">add</div><div class="t m5 x208 h3f y505c ff72 fs27 fc1 sc0 ls214 ws0">sub</div><div class="t m5 xb0 h3f y505b ff72 fs27 fc1 sc0 ls214 ws0">jne</div><div class="t m5 x1c0 h40 y5052 ff71 fs28 fc1 sc0 ls0 ws0">%rax<span class="_ _5a"> </span>%rdx</div><div class="t m5 x1c0 h40 y5053 ff71 fs28 fc1 sc0 ls0 ws0">%rax<span class="_ _5a"> </span>%rdx</div><div class="t m5 x103 h3f y505d ff72 fs27 fc1 sc0 ls214 ws0">s_data</div><div class="t m5 x1f1 h3f y5059 ff72 fs27 fc1 sc0 ls214 ws0">load</div><div class="t m5 x158 h3f y505b ff72 fs27 fc1 sc0 ls214 ws0">add</div><div class="t m5 x102 h3f y505e ff72 fs27 fc1 sc0 ls214 ws0">sub</div><div class="t m5 x26 h26 y505f ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _11"> </span>can<span class="_ _16"> </span>now<span class="_ _11"> </span>understand<span class="_ _11"> </span>the<span class="_ _16"> </span>performance<span class="_ _11"> </span>characteristics<span class="_ _11"> </span>of<span class="_ _11"> </span>function<span class="_ _16"> </span><span class="ffd">write_</span></div><div class="t m5 x17 h26 y5060 ffd fs19 fc1 sc0 ls0 ws0">read<span class="ff7">.<span class="_ _6"> </span>F<span class="_ _1"></span>igure<span class="_ _6"> </span>5.37<span class="_ _6"> </span>illustrates<span class="_ _13"> </span>the<span class="_ _a"> </span>data<span class="_ _6"> </span>dependencies<span class="_ _6"> </span>formed<span class="_ _6"> </span>by<span class="_ _6"> </span>multiple<span class="_ _6"> </span>iterations<span class="_ _6"> </span>of</span></div><div class="t m5 x17 h26 y5061 ff7 fs19 fc1 sc0 ls0 ws0">its<span class="_ _13"> </span>inner<span class="_"> </span>loop<span class="_ _1"></span>.<span class="_"> </span>F<span class="_ _3"></span>or<span class="_"> </span>the<span class="_ _13"> </span>case<span class="_"> </span>of<span class="_ _13"> </span>Example<span class="_"> </span>A<span class="_ _13"> </span>in<span class="_ _13"> </span>Figure<span class="_ _13"> </span>5.33,<span class="_"> </span>with<span class="_ _13"> </span>differing<span class="_"> </span>source<span class="_ _13"> </span>and</div><div class="t m5 x17 h26 y5062 ff7 fs19 fc1 sc0 ls0 ws0">destination<span class="_ _11"> </span>addresses<span class="_ _1"></span>,<span class="_ _11"> </span>the<span class="_ _16"> </span>load<span class="_"> </span>and<span class="_ _16"> </span>store<span class="_"> </span>operations<span class="_ _16"> </span>can<span class="_"> </span>proceed<span class="_ _11"> </span>independently<span class="_ _3"></span>,</div><div class="t m5 x17 h26 y5063 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _16"> </span>hence<span class="_ _16"> </span>the<span class="_ _11"> </span>only<span class="_ _16"> </span>critical<span class="_ _16"> </span>path<span class="_ _16"> </span>is<span class="_ _16"> </span>formed<span class="_ _16"> </span>by<span class="_ _16"> </span>the<span class="_ _16"> </span>decrementing<span class="_ _11"> </span>of<span class="_ _16"> </span>variable<span class="_ _16"> </span><span class="ffd">cnt</span>,</div><div class="t m5 x17 h26 y5064 ff7 fs19 fc1 sc0 ls0 ws0">resulting<span class="_"> </span>in<span class="_ _13"> </span>a<span class="_"> </span>CPE<span class="_"> </span>bound<span class="_ _13"> </span>of<span class="_"> </span>1.0.<span class="_"> </span>F<span class="_ _3"></span>or<span class="_"> </span>the<span class="_"> </span>case<span class="_ _13"> </span>of<span class="_"> </span>Example<span class="_"> </span>B<span class="_ _13"> </span>with<span class="_"> </span>matching<span class="_"> </span>source</div><div class="t m5 x17 h26 y5065 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _21"> </span>destination<span class="_ _21"> </span>addresses<span class="_ _1"></span>,<span class="_ _e"> </span>the<span class="_ _15"> </span>data<span class="_ _21"> </span>dependency<span class="_ _21"> </span>between<span class="_ _21"> </span>the<span class="_ _f"> </span><span class="ff6">s_data<span class="_ _21"> </span></span>and<span class="_ _21"> </span><span class="ff6">load</span></div><div class="t m5 x17 h26 y5066 ff7 fs19 fc1 sc0 ls0 ws0">instructions<span class="_ _13"> </span>causes<span class="_ _13"> </span>a<span class="_ _13"> </span>critical<span class="_"> </span>path<span class="_ _13"> </span>to<span class="_ _13"> </span>form<span class="_ _13"> </span>involving<span class="_ _13"> </span>data<span class="_ _13"> </span>being<span class="_"> </span>stored,<span class="_ _13"> </span>loaded,<span class="_ _13"> </span>and</div><div class="t m5 x17 h26 y5067 ff7 fs19 fc1 sc0 ls0 ws0">incremented.<span class="_"> </span>W<span class="_ _3"></span>e<span class="_"> </span>found<span class="_ _13"> </span>that<span class="_"> </span>these<span class="_"> </span>three<span class="_"> </span>operations<span class="_ _13"> </span>in<span class="_"> </span>sequence<span class="_"> </span>require<span class="_"> </span>a<span class="_ _13"> </span>total<span class="_"> </span>of</div><div class="t m5 x17 h26 y5068 ff7 fs19 fc1 sc0 ls0 ws0">around<span class="_"> </span>7<span class="_"> </span>clock<span class="_"> </span>cycles<span class="_ _3"></span>.</div><div class="t m5 x26 h26 y5069 ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_ _11"> </span>these<span class="_ _11"> </span>two<span class="_ _16"> </span>examples<span class="_ _11"> </span>show<span class="_ _3"></span>,<span class="_ _11"> </span>the<span class="_ _16"> </span>implementation<span class="_ _11"> </span>of<span class="_ _11"> </span>memory<span class="_ _16"> </span>operations<span class="_ _11"> </span>in-</div><div class="t m5 x17 h26 y506a ff7 fs19 fc1 sc0 ls0 ws0">volves<span class="_ _13"> </span>many<span class="_"> </span>subtleties<span class="_ _3"></span>.<span class="_"> </span>W<span class="_ _1"></span>ith<span class="_ _13"> </span>operations<span class="_"> </span>on<span class="_ _13"> </span>registers<span class="_ _3"></span>,<span class="_"> </span>the<span class="_ _13"> </span>processor<span class="_"> </span>can<span class="_ _13"> </span>determine</div><div class="t m5 x17 h26 y506b ff7 fs19 fc1 sc0 ls0 ws0">which<span class="_"> </span>instructions<span class="_"> </span>will<span class="_ _11"> </span>affect<span class="_"> </span>which<span class="_ _11"> </span>others<span class="_"> </span>as<span class="_"> </span>they<span class="_ _11"> </span>are<span class="_"> </span>being<span class="_ _11"> </span>decoded<span class="_"> </span>into<span class="_ _11"> </span>opera-</div><div class="t m5 x17 h26 y506c ff7 fs19 fc1 sc0 ls0 ws0">tions<span class="_ _1"></span>.<span class="_ _11"> </span>W<span class="_ _0"></span>ith<span class="_ _11"> </span>memory<span class="_ _11"> </span>operations<span class="_ _1"></span>,<span class="_ _16"> </span>on<span class="_ _11"> </span>the<span class="_ _11"> </span>other<span class="_ _11"> </span>hand,<span class="_ _16"> </span>the<span class="_"> </span>processor<span class="_ _16"> </span>cannot<span class="_ _11"> </span>predict</div><div class="t m5 x17 h26 y506d ff7 fs19 fc1 sc0 ls0 ws0">which<span class="_"> </span>will<span class="_"> </span>affect<span class="_ _11"> </span>which<span class="_"> </span>others<span class="_ _11"> </span>until<span class="_"> </span>the<span class="_ _11"> </span>load<span class="_"> </span>and<span class="_ _11"> </span>store<span class="_"> </span>addresses<span class="_ _11"> </span>have<span class="_"> </span>been<span class="_"> </span>com-</div><div class="t m5 x17 h26 y506e ff7 fs19 fc1 sc0 ls0 ws0">puted.<span class="_ _11"> </span>Efﬁcient<span class="_ _11"> </span>handling<span class="_ _11"> </span>of<span class="_ _11"> </span>memory<span class="_ _16"> </span>operations<span class="_"> </span>is<span class="_ _16"> </span>critical<span class="_"> </span>to<span class="_ _16"> </span>the<span class="_"> </span>performance<span class="_ _16"> </span>of</div><div class="t m5 x17 h26 y506f ff7 fs19 fc1 sc0 ls0 ws0">many<span class="_ _11"> </span>programs<span class="_ _1"></span>.<span class="_ _11"> </span>The<span class="_"> </span>memory<span class="_ _11"> </span>subsystem<span class="_ _11"> </span>makes<span class="_ _16"> </span>use<span class="_"> </span>of<span class="_ _16"> </span>many<span class="_"> </span>optimizations<span class="_ _0"></span>,<span class="_ _11"> </span>such</div><div class="t m5 x17 h26 y5070 ff7 fs19 fc1 sc0 ls0 ws0">as<span class="_"> </span>the<span class="_"> </span>potential<span class="_"> </span>parallelism<span class="_"> </span>when<span class="_"> </span>operations<span class="_"> </span>can<span class="_"> </span>proceed<span class="_"> </span>independently<span class="_ _3"></span>.</div><div class="t m5 x17 h47 y5071 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>5.10<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>613)</span></div><div class="t m5 x17 h26 y5072 ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_ _16"> </span>another<span class="_ _11"> </span>example<span class="_ _16"> </span>of<span class="_ _16"> </span>code<span class="_ _11"> </span>with<span class="_ _16"> </span>potential<span class="_ _11"> </span>load-store<span class="_ _16"> </span>interactions<span class="_ _1"></span>,<span class="_ _16"> </span>consider<span class="_ _16"> </span>the</div><div class="t m5 x17 h26 y5073 ff7 fs19 fc1 sc0 ls0 ws0">following<span class="_"> </span>function<span class="_"> </span>to<span class="_"> </span>copy<span class="_"> </span>the<span class="_"> </span>contents<span class="_"> </span>of<span class="_"> </span>one<span class="_"> </span>array<span class="_"> </span>to<span class="_"> </span>another:</div><div class="t m5 x2c h2d y464c ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">void<span class="_ _1f"> </span>copy_array(long<span class="_ _e"> </span>*src,<span class="_ _1f"> </span>long<span class="_ _1f"> </span>*dest,<span class="_ _e"> </span>long<span class="_ _1f"> </span>n)</span></div><div class="t m5 x2c h2e y1864 ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x2d h2d y2fb5 ffd fs1e fc2 sc0 ls0 ws0">{</div><div class="t m5 x2c h2d y20a6 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>i;</span></div><div class="t m5 x2c h2d y131f ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2 ls33">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>i=0<span class="_ _41"></span>;i&lt;n<span class="_ _41"></span>;<span class="ls0">i++)</span></span></div><div class="t m5 x2c h2d y4af6 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _70"> </span><span class="ffd fs1e fc2">dest[i]<span class="_ _e"> </span>=<span class="_ _1f"> </span>src[i];</span></div><div class="t m5 x2c h2e y4c76 ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 x2d h2d y1397 ffd fs1e fc2 sc0 ls0 ws0">}</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
