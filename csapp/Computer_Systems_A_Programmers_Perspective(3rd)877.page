<div id="pf36d" class="pf w2 h11" data-page-no="36d"><div class="pc pc36d w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg36d.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">876<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>9<span class="_ _3d"> </span>Virtual<span class="_ _10"> </span>Memory</span></div><div class="t m5 x14 h2f ye7 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>9.33</div><div class="t m5 x14 h2f y58a ffe fs16 fc1 sc0 ls0 ws0">The<span class="_"> </span>heap.</div><div class="t m5 x25 h91 y71a5 ffc4 fs57 fc1 sc0 ls0 ws0">Memory-mapped region</div><div class="t m5 x137 h91 y71a6 ffc4 fs57 fc1 sc0 ls0 ws0">for shared libraries</div><div class="t m5 x5d h91 y71a7 ffc4 fs57 fc1 sc0 ls0 ws0">User stack</div><div class="t m5 xe0 he3 y71a8 ffc4 fs94 fc1 sc0 ls0 ws0">0</div><div class="t m5 xdc h91 y71a9 ffc1 fs57 fc1 sc0 ls0 ws0">Heap</div><div class="t m5 x9b h91 y71aa ffc1 fs57 fc1 sc0 ls0 ws0">Heap gro<span class="_ _0"></span>ws</div><div class="t m5 x49 h91 y71ab ffc1 fs57 fc1 sc0 ls0 ws0">upward</div><div class="t m5 x25 h91 y71ac ffc4 fs57 fc1 sc0 ls0 ws0">Uninitialized data (</div><div class="t m5 xe4 hfb y71ad ffc5 fs99 fc1 sc0 ls0 ws0">.bss<span class="ffc4 fs57">)</span></div><div class="t m5 x7c h91 y71ae ffc4 fs57 fc1 sc0 ls0 ws0">Initialized data (</div><div class="t m5 x241 hfb y71af ffc5 fs99 fc1 sc0 ls0 ws0">.data<span class="ffc4 fs57">)</span></div><div class="t m5 x89 h91 y71b0 ffc4 fs57 fc1 sc0 ls0 ws0">Code (</div><div class="t m5 x125 hfb y71b1 ffc5 fs99 fc1 sc0 ls0 ws0">.text<span class="ffc4 fs57">)</span></div><div class="t m5 x1ae h91 y71b2 ffc1 fs57 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>op of the heap</div><div class="t m5 x1ae h91 y71b3 ffc1 fs57 fc1 sc0 ls0 ws0">(</div><div class="t m5 x17a hfb y71b4 ffc5 fs99 fc1 sc0 ls0 ws0">brk ptr</div><div class="c xe0 y71b5 w33 h10e"><div class="t m5 x37 hfb y71b6 ffc5 fs99 fc3 sc1 ls0 ws0">brk ptr</div></div><div class="t m5 x170 h91 y71b4 ffc1 fs57 fc1 sc0 ls0 ws0">)</div><div class="t m5 x29 h26 y71b7 ff7 fs19 fc1 sc0 ls0 ws0">function,<span class="_ _11"> </span>and<span class="_ _11"> </span>free<span class="_ _11"> </span>a<span class="_ _11"> </span>block<span class="_ _16"> </span>by<span class="_"> </span>calling<span class="_ _11"> </span>the<span class="_ _16"> </span><span class="ffd">free<span class="_ _10"> </span></span>function.<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _11"> </span><span class="ffd">new<span class="_ _11"> </span></span>and<span class="_ _11"> </span><span class="ffd">delete</span></div><div class="t m5 x29 h26 y71b8 ff7 fs19 fc1 sc0 ls0 ws0">calls<span class="_"> </span>in<span class="_"> </span><span class="ffd">C++<span class="_ _10"> </span></span>are<span class="_"> </span>comparable<span class="_ _0"></span>.</div><div class="t m5 x75 h3d y71b9 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y71ba ffa fs19 fc1 sc0 ls0 ws0">Implicit<span class="_ _16"> </span>allocators<span class="ff7">,<span class="_ _15"> </span>on<span class="_ _16"> </span>the<span class="_ _14"> </span>other<span class="_ _14"> </span>hand,<span class="_ _14"> </span>require<span class="_ _14"> </span>the<span class="_ _16"> </span>allocator<span class="_ _14"> </span>to<span class="_ _16"> </span>detect<span class="_ _14"> </span>when</span></div><div class="t m5 x29 h26 y71bb ff7 fs19 fc1 sc0 ls0 ws0">an<span class="_ _21"> </span>allocated<span class="_ _21"> </span>block<span class="_ _21"> </span>is<span class="_ _21"> </span>no<span class="_ _21"> </span>longer<span class="_ _21"> </span>being<span class="_ _21"> </span>used<span class="_ _21"> </span>by<span class="_ _21"> </span>the<span class="_ _21"> </span>program<span class="_ _21"> </span>and<span class="_ _21"> </span>then<span class="_ _21"> </span>free</div><div class="t m5 x29 h26 y71bc ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _16"> </span>block.<span class="_ _14"> </span>Implicit<span class="_ _14"> </span>allocators<span class="_ _16"> </span>are<span class="_ _14"> </span>also<span class="_ _14"> </span>known<span class="_ _14"> </span>as<span class="_ _16"> </span><span class="ffa">garbage<span class="_ _14"> </span>collectors</span>,<span class="_ _14"> </span>and<span class="_ _14"> </span>the</div><div class="t m5 x29 h26 y71bd ff7 fs19 fc1 sc0 ls0 ws0">process<span class="_ _13"> </span>of<span class="_"> </span>automatically<span class="_ _13"> </span>freeing<span class="_"> </span>unused<span class="_ _13"> </span>allocated<span class="_"> </span>blocks<span class="_ _13"> </span>is<span class="_ _13"> </span>known<span class="_"> </span>as<span class="_ _13"> </span><span class="ffa">garbage</span></div><div class="t m5 x29 h26 y71be ffa fs19 fc1 sc0 ls0 ws0">collection<span class="ff7">.<span class="_ _6"> </span>F<span class="_ _1"></span>or<span class="_ _13"> </span>example<span class="_ _1"></span>,<span class="_ _13"> </span>higher<span class="_ _3"></span>-level<span class="_ _13"> </span>languages<span class="_ _6"> </span>such<span class="_ _13"> </span>as<span class="_ _6"> </span>Lisp<span class="_ _1"></span>,<span class="_ _13"> </span>ML,<span class="_ _13"> </span>and<span class="_ _6"> </span>J<span class="_ _1"></span>ava<span class="_ _6"> </span>rely</span></div><div class="t m5 x29 h26 y71bf ff7 fs19 fc1 sc0 ls0 ws0">on<span class="_"> </span>garbage<span class="_"> </span>collection<span class="_"> </span>to<span class="_"> </span>free<span class="_"> </span>allocated<span class="_"> </span>blocks<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y71c0 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _21"> </span>remainder<span class="_ _15"> </span>of<span class="_ _21"> </span>this<span class="_ _15"> </span>section<span class="_ _21"> </span>discusses<span class="_ _15"> </span>the<span class="_ _21"> </span>design<span class="_ _15"> </span>and<span class="_ _21"> </span>implementation<span class="_ _15"> </span>of</div><div class="t m5 x1d h26 y71c1 ff7 fs19 fc1 sc0 ls0 ws0">explicit<span class="_ _13"> </span>allocators<span class="_ _3"></span>.<span class="_ _13"> </span>W<span class="_ _1"></span>e<span class="_ _13"> </span>will<span class="_ _13"> </span>discuss<span class="_ _13"> </span>implicit<span class="_ _6"> </span>allocators<span class="_ _13"> </span>in<span class="_ _13"> </span>Section<span class="_ _13"> </span>9.10.<span class="_ _13"> </span>F<span class="_ _1"></span>or<span class="_ _13"> </span>concrete-</div><div class="t m5 x1d h26 y71c2 ff7 fs19 fc1 sc0 ls0 ws0">ness<span class="_ _1"></span>,<span class="_ _16"> </span>our<span class="_ _16"> </span>discussion<span class="_ _16"> </span>focuses<span class="_ _16"> </span>on<span class="_ _16"> </span>allocators<span class="_ _16"> </span>that<span class="_ _16"> </span>manage<span class="_ _16"> </span>heap<span class="_ _16"> </span>memory<span class="_ _3"></span>.<span class="_ _16"> </span>However,</div><div class="t m5 x1d h26 y71c3 ff7 fs19 fc1 sc0 ls0 ws0">you<span class="_ _13"> </span>should<span class="_"> </span>be<span class="_ _13"> </span>aware<span class="_"> </span>that<span class="_ _13"> </span>memory<span class="_ _13"> </span>allocation<span class="_"> </span>is<span class="_ _13"> </span>a<span class="_ _13"> </span>general<span class="_"> </span>idea<span class="_ _13"> </span>that<span class="_"> </span>arises<span class="_ _13"> </span>in<span class="_ _13"> </span>a<span class="_"> </span>vari-</div><div class="t m5 x1d h26 y71c4 ff7 fs19 fc1 sc0 ls0 ws0">ety<span class="_ _6"> </span>of<span class="_ _13"> </span>contexts<span class="_ _3"></span>.<span class="_ _13"> </span>F<span class="_ _3"></span>or<span class="_ _13"> </span>example<span class="_ _1"></span>,<span class="_ _13"> </span>applications<span class="_ _6"> </span>that<span class="_ _13"> </span>do<span class="_ _6"> </span>intensive<span class="_ _13"> </span>manipulation<span class="_ _6"> </span>of<span class="_ _6"> </span>graphs</div><div class="t m5 x1d h26 y71c5 ff7 fs19 fc1 sc0 ls0 ws0">will<span class="_ _16"> </span>often<span class="_ _16"> </span>use<span class="_ _11"> </span>the<span class="_ _16"> </span>standard<span class="_ _16"> </span>allocator<span class="_ _16"> </span>to<span class="_ _16"> </span>acquire<span class="_ _16"> </span>a<span class="_ _11"> </span>large<span class="_ _16"> </span>block<span class="_ _16"> </span>of<span class="_ _16"> </span>virtual<span class="_ _16"> </span>memory</div><div class="t m5 x1d h26 y71c6 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_"> </span>then<span class="_"> </span>use<span class="_ _11"> </span>an<span class="_"> </span>application-speciÔ¨Åc<span class="_"> </span>allocator<span class="_ _11"> </span>to<span class="_"> </span>manage<span class="_"> </span>the<span class="_ _11"> </span>memory<span class="_"> </span>within<span class="_"> </span>that</div><div class="t m5 x1d h26 y71c7 ff7 fs19 fc1 sc0 ls0 ws0">block<span class="_"> </span>as<span class="_"> </span>the<span class="_"> </span>nodes<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>graph<span class="_"> </span>are<span class="_"> </span>created<span class="_"> </span>and<span class="_"> </span>destroyed.</div><div class="t m5 x1d h41 y71c8 ffe fs29 fc1 sc0 ls0 ws0">9.9.1<span class="_ _48"> </span><span class="fs19">The<span class="_"> </span><span class="ffd fs1c">malloc<span class="_ _11"> </span></span>and<span class="_"> </span><span class="ffd fs1c">free<span class="_ _11"> </span></span>Functions</span></div><div class="t m5 x1d h26 y71c9 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _6"> </span>C<span class="_ _6"> </span>standard<span class="_ _6"> </span>library<span class="_ _6"> </span>provides<span class="_ _6"> </span>an<span class="_ _6"> </span>explicit<span class="_ _6"> </span>allocator<span class="_ _6"> </span>known<span class="_ _6"> </span>as<span class="_ _6"> </span>the<span class="_ _6"> </span><span class="ffd">malloc<span class="_ _6"> </span></span>package<span class="_ _0"></span>.</div><div class="t m5 x1d h26 y71ca ff7 fs19 fc1 sc0 ls0 ws0">Programs<span class="_"> </span>allocate<span class="_"> </span>blocks<span class="_"> </span>from<span class="_"> </span>the<span class="_"> </span>heap<span class="_"> </span>by<span class="_"> </span>calling<span class="_"> </span>the<span class="_"> </span><span class="ffd">malloc<span class="_ _10"> </span></span>function.</div><div class="t m5 x126 h2d y71cb ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;stdlib.h&gt;</div><div class="t m5 x126 h2d y71cc ffd fs1e fc2 sc0 ls0 ws0">void<span class="_ _e"> </span>*malloc(size_t<span class="_ _1f"> </span>size);</div><div class="t m5 xe3 hf1 y71cd ff7 fs1f fc2 sc0 ls0 ws0">Returns:<span class="_"> </span>pointer<span class="_"> </span>to<span class="_"> </span>allocated<span class="_"> </span>block<span class="_"> </span>if<span class="_"> </span>OK,<span class="_"> </span>NULL<span class="_"> </span>on<span class="_"> </span>error</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
