<div id="pf372" class="pf w2 h11" data-page-no="372"><div class="pc pc372 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg372.png"/><div class="t m5 x1c9 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>9.9<span class="_ _60"> </span>Dynamic<span class="_ _10"> </span>Memor<span class="_"> </span>y<span class="_ _10"> </span>Allocation<span class="_ _3e"> </span><span class="ffe fs1e">881</span></div><div class="t m5 x26 h26 y9c ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _3"></span>orking<span class="_"> </span>within<span class="_ _13"> </span>these<span class="_ _13"> </span>constraints<span class="_ _0"></span>,<span class="_ _13"> </span>the<span class="_"> </span>author<span class="_ _13"> </span>of<span class="_"> </span>an<span class="_ _13"> </span>allocator<span class="_ _13"> </span>attempts<span class="_"> </span>to<span class="_ _13"> </span>meet</div><div class="t m5 x17 h26 y409 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _16"> </span>often<span class="_ _16"> </span>conﬂicting<span class="_ _16"> </span>performance<span class="_ _16"> </span>goals<span class="_ _16"> </span>of<span class="_ _16"> </span>maximizing<span class="_ _16"> </span>throughput<span class="_ _16"> </span>and<span class="_ _16"> </span>memory</div><div class="t m5 x17 h26 y40a ff7 fs19 fc2 sc0 ls0 ws0">utilization.</div><div class="t m5 x17 h26 y5c86 ffa fs19 fc2 sc0 ls0 ws0">Goal<span class="_ _f"> </span>1:<span class="_ _f"> </span>Maximizing<span class="_ _f"> </span>throughput.<span class="_ _16"> </span><span class="ff7">Given<span class="_ _f"> </span>some<span class="_ _f"> </span>sequence<span class="_ _f"> </span>of<span class="_ _f"> </span><span class="ff11">n<span class="_ _f"> </span></span>allocate<span class="_ _f"> </span>and<span class="_ _f"> </span>free</span></div><div class="t m5 x17 h26 y724d ff7 fs19 fc2 sc0 ls0 ws0">requests</div><div class="t m5 x1a h45 y724e ff11 fs19 fc2 sc0 ls0 ws0">R</div><div class="t m5 x150 h3c y724f ff7 fs25 fc2 sc0 ls0 ws0">0</div><div class="t m5 x76 h45 y7250 ff11 fs19 fc2 sc0 ls42 ws0">,R</div><div class="t m5 x48 h3c y724f ff7 fs25 fc2 sc0 ls0 ws0">1</div><div class="t m5 xac h45 y7250 ff11 fs19 fc2 sc0 ls42 ws0">,...,R</div><div class="t m5 x1d1 h50 y724f ff11 fs25 fc2 sc0 ls0 ws0">k</div><div class="t m5 xe4 h45 y7250 ff11 fs19 fc2 sc0 ls42 ws0">,...,R</div><div class="t m5 x139 h4b y724f ff11 fs25 fc2 sc0 ls0 ws0">n<span class="ff12">−<span class="ff7">1</span></span></div><div class="t m5 x17 h26 y7251 ff7 fs19 fc2 sc0 ls0 ws0">we<span class="_ _21"> </span>would<span class="_ _21"> </span>like<span class="_ _21"> </span>to<span class="_ _21"> </span>maximize<span class="_ _f"> </span>an<span class="_ _21"> </span>allocator’s<span class="_ _15"> </span><span class="ffa">throughput<span class="_ _5"></span></span>,<span class="_ _f"> </span>which<span class="_ _f"> </span>is<span class="_ _21"> </span>deﬁned<span class="_ _21"> </span>as<span class="_ _21"> </span>the</div><div class="t m5 x17 h26 y7252 ff7 fs19 fc2 sc0 ls0 ws0">number<span class="_ _15"> </span>of<span class="_ _15"> </span>requests<span class="_ _15"> </span>that<span class="_ _15"> </span>it<span class="_ _15"> </span>completes<span class="_ _15"> </span>per<span class="_ _15"> </span>unit<span class="_ _15"> </span>time.<span class="_ _14"> </span>F<span class="_ _1"></span>or<span class="_ _15"> </span>example<span class="_ _0"></span>,<span class="_ _21"> </span>if<span class="_ _15"> </span>an<span class="_ _15"> </span>alloca-</div><div class="t m5 x17 h26 y7253 ff7 fs19 fc2 sc0 ls0 ws0">tor<span class="_ _14"> </span>completes<span class="_ _14"> </span>500<span class="_ _15"> </span>allocate<span class="_ _14"> </span>requests<span class="_ _15"> </span>and<span class="_ _14"> </span>500<span class="_ _14"> </span>free<span class="_ _15"> </span>requests<span class="_ _14"> </span>in<span class="_ _14"> </span>1<span class="_ _15"> </span>second,<span class="_ _15"> </span>then<span class="_ _14"> </span>its</div><div class="t m5 x17 h26 y7254 ff7 fs19 fc2 sc0 ls0 ws0">throughput<span class="_"> </span>is<span class="_ _13"> </span>1,000<span class="_"> </span>operations<span class="_"> </span>per<span class="_"> </span>second.<span class="_ _13"> </span>In<span class="_"> </span>general,<span class="_"> </span>we<span class="_"> </span>can<span class="_ _13"> </span>maximize<span class="_"> </span>through-</div><div class="t m5 x17 h26 y7255 ff7 fs19 fc2 sc0 ls0 ws0">put<span class="_"> </span>by<span class="_"> </span>minimizing<span class="_"> </span>the<span class="_ _11"> </span>average<span class="_"> </span>time<span class="_"> </span>to<span class="_"> </span>satisfy<span class="_ _11"> </span>allocate<span class="_"> </span>and<span class="_"> </span>free<span class="_"> </span>requests<span class="_ _0"></span>.<span class="_"> </span>As<span class="_"> </span>we’ll</div><div class="t m5 x17 h26 y7256 ff7 fs19 fc2 sc0 ls0 ws0">see<span class="_ _1"></span>,<span class="_"> </span>it<span class="_"> </span>is<span class="_ _13"> </span>not<span class="_"> </span>too<span class="_"> </span>difﬁcult<span class="_ _13"> </span>to<span class="_"> </span>develop<span class="_"> </span>allocators<span class="_ _13"> </span>with<span class="_"> </span>reasonably<span class="_"> </span>good<span class="_ _13"> </span>performance</div><div class="t m5 x17 h26 y7257 ff7 fs19 fc2 sc0 ls0 ws0">where<span class="_"> </span>the<span class="_ _11"> </span>worst-case<span class="_ _11"> </span>running<span class="_ _11"> </span>time<span class="_"> </span>of<span class="_ _11"> </span>an<span class="_ _11"> </span>allocate<span class="_ _11"> </span>request<span class="_"> </span>is<span class="_ _11"> </span>linear<span class="_ _11"> </span>in<span class="_ _11"> </span>the<span class="_"> </span>number</div><div class="t m5 x17 h26 y7258 ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_"> </span>free<span class="_"> </span>blocks<span class="_"> </span>and<span class="_"> </span>the<span class="_"> </span>running<span class="_"> </span>time<span class="_"> </span>of<span class="_"> </span>a<span class="_"> </span>free<span class="_"> </span>request<span class="_"> </span>is<span class="_"> </span>constant.</div><div class="t m5 x17 h26 y7259 ffa fs19 fc2 sc0 ls0 ws0">Goal<span class="_ _21"> </span>2:<span class="_ _f"> </span>Maximizing<span class="_ _21"> </span>memory<span class="_ _f"> </span>utilization.<span class="_ _14"> </span><span class="ff7">Naive<span class="_ _21"> </span>programmers<span class="_ _f"> </span>often<span class="_ _21"> </span>incorrectly</span></div><div class="t m5 x17 h26 y725a ff7 fs19 fc2 sc0 ls0 ws0">assume<span class="_ _14"> </span>that<span class="_ _16"> </span>virtual<span class="_ _14"> </span>memory<span class="_ _14"> </span>is<span class="_ _14"> </span>an<span class="_ _14"> </span>unlimited<span class="_ _14"> </span>resource<span class="_ _1"></span>.<span class="_ _14"> </span>In<span class="_ _14"> </span>fact,<span class="_ _15"> </span>the<span class="_ _14"> </span>total<span class="_ _14"> </span>amount</div><div class="t m5 x17 h26 y725b ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_ _16"> </span>virtual<span class="_ _11"> </span>memory<span class="_ _16"> </span>allocated<span class="_ _16"> </span>by<span class="_ _16"> </span>all<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>processes<span class="_ _16"> </span>in<span class="_ _11"> </span>a<span class="_ _16"> </span>system<span class="_ _16"> </span>is<span class="_ _11"> </span>limited<span class="_ _16"> </span>by<span class="_ _16"> </span>the</div><div class="t m5 x17 h26 y725c ff7 fs19 fc2 sc0 ls0 ws0">amount<span class="_ _11"> </span>of<span class="_ _11"> </span>swap<span class="_ _11"> </span>space<span class="_ _11"> </span>on<span class="_ _11"> </span>disk.<span class="_ _11"> </span>Good<span class="_ _11"> </span>programmers<span class="_ _11"> </span>know<span class="_ _11"> </span>that<span class="_ _11"> </span>virtual<span class="_ _11"> </span>memory<span class="_ _11"> </span>is</div><div class="t m5 x17 h26 y725d ff7 fs19 fc2 sc0 ls0 ws0">a<span class="_ _13"> </span>ﬁnite<span class="_"> </span>resource<span class="_ _13"> </span>that<span class="_"> </span>must<span class="_ _13"> </span>be<span class="_ _13"> </span>used<span class="_"> </span>efﬁciently<span class="_ _7"></span>.<span class="_"> </span>T<span class="_ _1"></span>his<span class="_ _13"> </span>is<span class="_"> </span>especially<span class="_ _13"> </span>true<span class="_ _13"> </span>for<span class="_"> </span>a<span class="_ _13"> </span>dynamic</div><div class="t m5 x17 h26 y725e ff7 fs19 fc2 sc0 ls0 ws0">memory<span class="_ _13"> </span>allocator<span class="_ _6"> </span>that<span class="_ _13"> </span>might<span class="_ _6"> </span>be<span class="_ _13"> </span>asked<span class="_ _13"> </span>to<span class="_ _6"> </span>allocate<span class="_ _13"> </span>and<span class="_ _13"> </span>free<span class="_ _6"> </span>large<span class="_ _13"> </span>blocks<span class="_ _6"> </span>of<span class="_ _13"> </span>memory<span class="_ _3"></span>.</div><div class="t m5 x26 h26 y725f ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>here<span class="_ _11"> </span>are<span class="_"> </span>a<span class="_ _11"> </span>number<span class="_"> </span>of<span class="_ _11"> </span>ways<span class="_"> </span>to<span class="_"> </span>characterize<span class="_ _11"> </span>how<span class="_"> </span>efﬁciently<span class="_ _11"> </span>an<span class="_"> </span>allocator<span class="_ _11"> </span>uses</div><div class="t m5 x17 h26 y7260 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>heap<span class="_ _1"></span>.<span class="_"> </span>In<span class="_"> </span>our<span class="_"> </span>experience,<span class="_"> </span>the<span class="_"> </span>most<span class="_"> </span>useful<span class="_"> </span>metric<span class="_"> </span>is<span class="_"> </span><span class="ffa">peak<span class="_"> </span>utilization<span class="_ _1"></span><span class="ff7">.<span class="_"> </span>As<span class="_"> </span>before,</span></span></div><div class="t m5 x17 h26 y7261 ff7 fs19 fc2 sc0 ls0 ws0">we<span class="_"> </span>are<span class="_"> </span>given<span class="_"> </span>some<span class="_"> </span>sequence<span class="_"> </span>of<span class="_"> </span><span class="ff11">n<span class="_ _10"> </span></span>allocate<span class="_"> </span>and<span class="_"> </span>free<span class="_"> </span>requests</div><div class="t m5 x1a h45 y7262 ff11 fs19 fc2 sc0 ls0 ws0">R</div><div class="t m5 x150 h3c y7263 ff7 fs25 fc2 sc0 ls0 ws0">0</div><div class="t m5 x76 h45 y7264 ff11 fs19 fc2 sc0 ls42 ws0">,R</div><div class="t m5 x48 h3c y7263 ff7 fs25 fc2 sc0 ls0 ws0">1</div><div class="t m5 xac h45 y7264 ff11 fs19 fc2 sc0 ls42 ws0">,...,R</div><div class="t m5 x1d1 h50 y7263 ff11 fs25 fc2 sc0 ls0 ws0">k</div><div class="t m5 xe4 h45 y7264 ff11 fs19 fc2 sc0 ls42 ws0">,...,R</div><div class="t m5 x139 h4b y7263 ff11 fs25 fc2 sc0 ls0 ws0">n<span class="ff12">−<span class="ff7">1</span></span></div><div class="t m5 x17 h26 y7265 ff7 fs19 fc2 sc0 ls0 ws0">If<span class="_ _13"> </span>an<span class="_ _13"> </span>application<span class="_ _13"> </span>requests<span class="_ _13"> </span>a<span class="_ _13"> </span>block<span class="_ _13"> </span>of<span class="_ _13"> </span><span class="ff11">p<span class="_ _13"> </span></span>bytes<span class="_ _1"></span>,<span class="_"> </span>then<span class="_ _6"> </span>the<span class="_ _13"> </span>resulting<span class="_ _13"> </span>allocated<span class="_ _13"> </span>block<span class="_ _13"> </span>has</div><div class="t m5 x17 h26 y7266 ff7 fs19 fc2 sc0 ls0 ws0">a<span class="_ _11"> </span><span class="ffa">payload<span class="_ _11"> </span></span>of<span class="_ _11"> </span><span class="ff11">p<span class="_"> </span></span>bytes<span class="_ _3"></span>.<span class="_ _11"> </span>After<span class="_ _11"> </span>request<span class="_ _11"> </span><span class="ff11">R</span></div><div class="t m5 xe2 h50 y7267 ff11 fs25 fc2 sc0 ls0 ws0">k</div><div class="t m5 x1ed h26 y7268 ff7 fs19 fc2 sc0 ls0 ws0">has<span class="_ _11"> </span>completed,<span class="_ _11"> </span>let<span class="_ _11"> </span>the<span class="_ _11"> </span><span class="ffa">aggregate<span class="_ _11"> </span>payload</span>,</div><div class="t m5 x17 h26 y7269 ff7 fs19 fc2 sc0 ls0 ws0">denoted<span class="_"> </span><span class="ff11">P</span></div><div class="t m5 x12 h50 y726a ff11 fs25 fc2 sc0 ls0 ws0">k</div><div class="t m5 xd0 h26 y726b ff7 fs19 fc2 sc0 ls0 ws0">,<span class="_"> </span>be<span class="_ _11"> </span>the<span class="_ _11"> </span>sum<span class="_"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>payloads<span class="_"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>currently<span class="_ _11"> </span>allocated<span class="_"> </span>blocks<span class="_ _1"></span>,<span class="_ _11"> </span>and<span class="_ _11"> </span>let</div><div class="t m5 x17 h45 y726c ff11 fs19 fc2 sc0 ls0 ws0">H</div><div class="t m5 x31 h50 y726d ff11 fs25 fc2 sc0 ls0 ws0">k</div><div class="t m5 x63 h26 y726e ff7 fs19 fc2 sc0 ls0 ws0">denote<span class="_"> </span>the<span class="_"> </span>current<span class="_"> </span>(monotonically<span class="_"> </span>nondecreasing)<span class="_"> </span>size<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>heap<span class="_ _1"></span>.</div><div class="t m5 x26 h46 y726f ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>hen<span class="_ _f"> </span>the<span class="_ _f"> </span>peak<span class="_ _f"> </span>utilization<span class="_ _f"> </span>over<span class="_ _f"> </span>the<span class="_ _f"> </span>ﬁrst<span class="_ _f"> </span><span class="ff11">k<span class="_ _16"> </span><span class="ff12">+<span class="_ _10"> </span></span></span>1<span class="_ _14"> </span>requests<span class="_ _1"></span>,<span class="_ _e"> </span>denoted<span class="_ _f"> </span>by<span class="_ _f"> </span><span class="ff11">U</span></div><div class="t m5 x172 h50 y7270 ff11 fs25 fc2 sc0 ls0 ws0">k</div><div class="t m5 x11d h26 y7271 ff7 fs19 fc2 sc0 ls2c1 ws0">,i<span class="_ _223"></span>s</div><div class="t m5 x17 h26 y7272 ff7 fs19 fc2 sc0 ls0 ws0">given<span class="_"> </span>by</div><div class="t m5 xb7 h45 y7273 ff11 fs19 fc2 sc0 ls0 ws0">U</div><div class="t m5 x27e h50 y7274 ff11 fs25 fc2 sc0 ls0 ws0">k</div><div class="t m5 x1b2 h46 y7275 ff12 fs19 fc2 sc0 ls0 ws0">=</div><div class="t m5 x9b h26 y7276 ff7 fs19 fc2 sc0 ls0 ws0">max</div><div class="t m5 xe4 h4b y7277 ff11 fs25 fc2 sc0 ls0 ws0">i<span class="_ _2"></span><span class="ff12">≤</span>k</div><div class="t m5 xb8 h45 y7278 ff11 fs19 fc2 sc0 ls0 ws0">P</div><div class="t m5 x17c h50 y7277 ff11 fs25 fc2 sc0 ls0 ws0">i</div><div class="t m5 x9e h45 y7279 ff11 fs19 fc2 sc0 ls0 ws0">H</div><div class="t m5 x1c8 h50 y727a ff11 fs25 fc2 sc0 ls0 ws0">k</div><div class="t m5 x17 h26 y278 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _21"> </span>objective<span class="_ _f"> </span>of<span class="_ _21"> </span>the<span class="_ _21"> </span>allocator,<span class="_ _f"> </span>then,<span class="_ _e"> </span>is<span class="_ _15"> </span>to<span class="_ _f"> </span>maximize<span class="_ _21"> </span>the<span class="_ _21"> </span>peak<span class="_ _21"> </span>utilization<span class="_ _f"> </span><span class="ff11">U</span></div><div class="t m5 x3d h4b y727b ff11 fs25 fc2 sc0 ls0 ws0">n<span class="ff12">−<span class="ff7">1</span></span></div><div class="t m5 x17 h26 y24e1 ff7 fs19 fc2 sc0 ls0 ws0">over<span class="_ _11"> </span>the<span class="_ _16"> </span>entire<span class="_ _11"> </span>sequence<span class="_ _0"></span>.<span class="_ _11"> </span>As<span class="_ _16"> </span>we<span class="_ _11"> </span>will<span class="_ _11"> </span>see,<span class="_ _11"> </span>there<span class="_ _16"> </span>is<span class="_ _11"> </span>a<span class="_ _11"> </span>tension<span class="_ _16"> </span>between<span class="_ _11"> </span>maximizing</div><div class="t m5 x17 h26 y4657 ff7 fs19 fc2 sc0 ls0 ws0">throughput<span class="_ _f"> </span>and<span class="_ _e"> </span>utilization.<span class="_ _f"> </span>In<span class="_ _f"> </span>particular,<span class="_ _e"> </span>it<span class="_ _e"> </span>is<span class="_ _f"> </span>easy<span class="_ _f"> </span>to<span class="_ _e"> </span>write<span class="_ _f"> </span>an<span class="_ _e"> </span>allocator<span class="_ _21"> </span>that</div><div class="t m5 x17 h26 y4658 ff7 fs19 fc2 sc0 ls0 ws0">maximizes<span class="_ _11"> </span>throughput<span class="_ _16"> </span>at<span class="_ _11"> </span>the<span class="_ _11"> </span>expense<span class="_ _16"> </span>of<span class="_ _11"> </span>heap<span class="_ _16"> </span>utilization.<span class="_ _11"> </span>One<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span>interesting</div><div class="t m5 x17 h26 y4659 ff7 fs19 fc2 sc0 ls0 ws0">challenges<span class="_ _11"> </span>in<span class="_ _11"> </span>any<span class="_ _11"> </span>allocator<span class="_ _11"> </span>design<span class="_ _11"> </span>is<span class="_ _11"> </span>ﬁnding<span class="_ _11"> </span>an<span class="_ _11"> </span>appropriate<span class="_ _11"> </span>balance<span class="_ _16"> </span>between<span class="_"> </span>the</div><div class="t m5 x17 h26 y465a ff7 fs19 fc2 sc0 ls0 ws0">two<span class="_"> </span>goals<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
