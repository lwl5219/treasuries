<div id="pf3b5" class="pf w2 h11" data-page-no="3b5"><div class="pc pc3b5 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg3b5.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">948<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>10<span class="_ _3d"> </span>System-Level<span class="_ _10"> </span>I/O</span></div><div class="t m5 x29 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _13"> </span>Unix<span class="_ _13"> </span>I/O<span class="_ _6"> </span>model<span class="_ _13"> </span>is<span class="_ _13"> </span>implemented<span class="_ _6"> </span>in<span class="_ _13"> </span>the<span class="_ _13"> </span>operating<span class="_ _6"> </span>system<span class="_ _13"> </span>kernel.<span class="_ _13"> </span>It<span class="_ _6"> </span>is<span class="_ _13"> </span>avail-</div><div class="t m5 x1d h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">able<span class="_ _11"> </span>to<span class="_ _16"> </span>applications<span class="_ _11"> </span>through<span class="_ _11"> </span>functions<span class="_ _16"> </span>such<span class="_ _11"> </span>as<span class="_ _16"> </span><span class="ffd">open</span>,<span class="_ _11"> </span><span class="ffd">close</span>,<span class="_ _16"> </span><span class="ffd">lseek</span>,<span class="_ _16"> </span><span class="ffd">read</span>,<span class="_ _11"> </span><span class="ffd">write</span>,</div><div class="t m5 x1d h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_"> </span><span class="ffd">stat</span>.<span class="_"> </span>T<span class="_ _0"></span>he<span class="_"> </span>higher<span class="_ _1"></span>-level<span class="_"> </span><span class="ff9">Rio<span class="_ _11"> </span></span>and<span class="_"> </span>standard<span class="_"> </span>I/O<span class="_"> </span>functions<span class="_"> </span>are<span class="_ _11"> </span>implemented<span class="_"> </span>“on</div><div class="t m5 x1d h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">top<span class="_"> </span>of<span class="_ _1"></span>”<span class="_"> </span>(using)<span class="_ _13"> </span>the<span class="_"> </span>Unix<span class="_ _13"> </span>I/O<span class="_"> </span>functions<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _3"></span>he<span class="_"> </span><span class="ff9">Rio<span class="_ _13"> </span></span>functions<span class="_"> </span>are<span class="_ _13"> </span>robust<span class="_"> </span>wrappers<span class="_ _13"> </span>for</div><div class="t m5 x1d h26 y2f8 ffd fs19 fc2 sc0 ls0 ws0">read<span class="_ _13"> </span><span class="ff7">and<span class="_ _6"> </span></span>write<span class="_ _13"> </span><span class="ff7">that<span class="_ _13"> </span>were<span class="_ _6"> </span>developed<span class="_ _13"> </span>speciﬁcally<span class="_ _13"> </span>for<span class="_ _6"> </span>this<span class="_ _13"> </span>textbook.<span class="_ _13"> </span>T<span class="_ _1"></span>hey<span class="_ _13"> </span>automati-</span></div><div class="t m5 x1d h26 y2f9 ff7 fs19 fc2 sc0 ls0 ws0">cally<span class="_ _13"> </span>deal<span class="_ _6"> </span>with<span class="_ _13"> </span>short<span class="_ _13"> </span>counts<span class="_ _6"> </span>and<span class="_ _13"> </span>provide<span class="_ _6"> </span>an<span class="_ _13"> </span>efﬁcient<span class="_ _13"> </span>buffered<span class="_ _6"> </span>approach<span class="_ _13"> </span>for<span class="_ _13"> </span>reading</div><div class="t m5 x1d h26 y2fa ff7 fs19 fc2 sc0 ls0 ws0">text<span class="_"> </span>lines<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>standard<span class="_"> </span>I/O<span class="_"> </span>functions<span class="_"> </span>provide<span class="_"> </span>a<span class="_"> </span>more<span class="_"> </span>complete<span class="_"> </span>buffered<span class="_"> </span>alterna-</div><div class="t m5 x1d h26 y2fb ff7 fs19 fc2 sc0 ls0 ws0">tive<span class="_ _16"> </span>to<span class="_ _11"> </span>the<span class="_ _16"> </span>Unix<span class="_ _16"> </span>I/O<span class="_ _16"> </span>functions<span class="_ _3"></span>,<span class="_ _16"> </span>including<span class="_ _16"> </span>formatted<span class="_ _16"> </span>I/O<span class="_ _16"> </span>routines<span class="_ _11"> </span>such<span class="_ _16"> </span>as<span class="_ _16"> </span><span class="ffd">printf</span></div><div class="t m5 x1d h26 y2fc ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_"> </span><span class="ffd">scanf</span>.</div><div class="t m5 x29 h26 y2fd ff7 fs19 fc2 sc0 ls0 ws0">So<span class="_ _13"> </span>which<span class="_"> </span>of<span class="_ _13"> </span>these<span class="_"> </span>functions<span class="_ _13"> </span>should<span class="_"> </span>you<span class="_ _13"> </span>use<span class="_ _13"> </span>in<span class="_"> </span>your<span class="_ _13"> </span>programs?<span class="_"> </span>Here<span class="_ _13"> </span>are<span class="_"> </span>some</div><div class="t m5 x1d h26 y2fe ff7 fs19 fc2 sc0 ls0 ws0">basic<span class="_"> </span>guidelines:</div><div class="t m5 x23a h26 y7957 ff7 fs19 fc2 sc0 ls0 ws0">G1:<span class="_ _e"> </span><span class="ffa">Use<span class="_ _16"> </span>the<span class="_ _11"> </span>standard<span class="_"> </span>I/O<span class="_ _16"> </span>functions<span class="_ _11"> </span>whenever<span class="_ _11"> </span>possible.<span class="_ _13"> </span></span>T<span class="_ _1"></span>he<span class="_ _11"> </span>standard<span class="_ _11"> </span>I/O<span class="_ _16"> </span>func-</div><div class="t m5 xcd h26 y52eb ff7 fs19 fc2 sc0 ls0 ws0">tions<span class="_ _13"> </span>are<span class="_"> </span>the<span class="_ _13"> </span>method<span class="_ _13"> </span>of<span class="_ _13"> </span>choice<span class="_"> </span>for<span class="_ _13"> </span>I/O<span class="_ _13"> </span>on<span class="_"> </span>disk<span class="_ _13"> </span>and<span class="_ _13"> </span>terminal<span class="_ _13"> </span>devices<span class="_ _1"></span>.<span class="_"> </span>Most</div><div class="t m5 xcd h26 y52ec ff7 fs19 fc2 sc0 ls0 ws0">C<span class="_ _14"> </span>programmers<span class="_ _15"> </span>use<span class="_ _15"> </span>standard<span class="_ _15"> </span>I/O<span class="_ _15"> </span>exclusively<span class="_ _14"> </span>throughout<span class="_ _15"> </span>their<span class="_ _15"> </span>careers<span class="_ _1"></span>,</div><div class="t m5 xcd h26 y3aa1 ff7 fs19 fc2 sc0 ls0 ws0">never<span class="_"> </span>bothering<span class="_ _13"> </span>with<span class="_"> </span>the<span class="_ _13"> </span>lower<span class="_ _0"></span>-level<span class="_"> </span>Unix<span class="_ _13"> </span>I/O<span class="_"> </span>functions<span class="_ _13"> </span>(except<span class="_"> </span>possibly</div><div class="t m5 xcd h26 y21d ffd fs19 fc2 sc0 ls0 ws0">stat<span class="ff7">,<span class="_ _16"> </span>which<span class="_ _16"> </span>has<span class="_ _16"> </span>no<span class="_ _16"> </span>counterpart<span class="_ _16"> </span>in<span class="_ _11"> </span>the<span class="_ _16"> </span>standard<span class="_ _16"> </span>I/O<span class="_ _16"> </span>library).<span class="_ _16"> </span>Whenever</span></div><div class="t m5 xcd h26 y52ed ff7 fs19 fc2 sc0 ls0 ws0">possible<span class="_ _1"></span>,<span class="_"> </span>we<span class="_"> </span>recommend<span class="_"> </span>that<span class="_"> </span>you<span class="_"> </span>do<span class="_"> </span>likewise.</div><div class="t m5 x23a h26 y306 ff7 fs19 fc2 sc0 ls0 ws0">G2:<span class="_ _e"> </span><span class="ffa">Don’t<span class="_ _a"> </span>use<span class="_ _6"> </span><span class="ffd">scanf<span class="_ _6"> </span></span>or<span class="_ _6"> </span><span class="ffd">rio_readlineb<span class="_ _13"> </span></span>to<span class="_ _a"> </span>read<span class="_ _6"> </span>binary<span class="_ _6"> </span>ﬁles<span class="_ _1"></span>.<span class="_ _5"></span><span class="ff7">Functions<span class="_ _6"> </span>like<span class="_ _6"> </span><span class="ffd">scanf</span></span></span></div><div class="t m5 xcd h26 y307 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_ _f"> </span><span class="ffd">rio_readlineb<span class="_ _f"> </span></span>are<span class="_ _f"> </span>designed<span class="_ _f"> </span>speciﬁcally<span class="_ _f"> </span>for<span class="_ _f"> </span>reading<span class="_ _f"> </span>text<span class="_ _f"> </span>ﬁles<span class="_ _1"></span>.<span class="_ _f"> </span>A</div><div class="t m5 xcd h26 y308 ff7 fs19 fc2 sc0 ls0 ws0">common<span class="_ _13"> </span>error<span class="_"> </span>that<span class="_ _13"> </span>students<span class="_ _13"> </span>make<span class="_"> </span>is<span class="_ _13"> </span>to<span class="_ _13"> </span>use<span class="_ _13"> </span>these<span class="_"> </span>functions<span class="_ _13"> </span>to<span class="_ _13"> </span>read<span class="_"> </span>binary</div><div class="t m5 xcd h26 y52ee ff7 fs19 fc2 sc0 ls0 ws0">data,<span class="_ _14"> </span>causing<span class="_ _14"> </span>their<span class="_ _14"> </span>programs<span class="_ _14"> </span>to<span class="_ _14"> </span>fail<span class="_ _14"> </span>in<span class="_ _14"> </span>strange<span class="_ _14"> </span>and<span class="_ _14"> </span>unpredictable<span class="_ _14"> </span>ways<span class="_ _0"></span>.</div><div class="t m5 xcd h26 y223 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_"> </span>example<span class="_ _1"></span>,<span class="_"> </span>binary<span class="_ _13"> </span>ﬁles<span class="_ _13"> </span>might<span class="_"> </span>be<span class="_ _13"> </span>littered<span class="_"> </span>with<span class="_ _13"> </span>many<span class="_"> </span><span class="ffd">0xa<span class="_ _13"> </span></span>bytes<span class="_"> </span>that<span class="_ _13"> </span>have</div><div class="t m5 xcd h26 y52ef ff7 fs19 fc2 sc0 ls0 ws0">nothing<span class="_"> </span>to<span class="_"> </span>do<span class="_"> </span>with<span class="_"> </span>terminating<span class="_"> </span>text<span class="_"> </span>lines<span class="_ _1"></span>.</div><div class="t m5 x75 h26 y7958 ff7 fs19 fc2 sc0 ls0 ws0">G3:<span class="_ _e"> </span><span class="ffa">Use<span class="_ _11"> </span>the<span class="_"> </span><span class="ff9">Rio<span class="_ _11"> </span></span>functions<span class="_"> </span>for<span class="_"> </span>I/O<span class="_"> </span>on<span class="_"> </span>network<span class="_ _11"> </span>sockets<span class="_ _3"></span>.<span class="_ _13"> </span><span class="ff7">Unfortunately<span class="_ _7"></span>,<span class="_"> </span>standard</span></span></div><div class="t m5 xcd h26 y7959 ff7 fs19 fc2 sc0 ls0 ws0">I/O<span class="_ _11"> </span>poses<span class="_ _11"> </span>some<span class="_ _11"> </span>nasty<span class="_ _11"> </span>problems<span class="_ _11"> </span>when<span class="_ _11"> </span>we<span class="_ _16"> </span>attempt<span class="_"> </span>to<span class="_ _11"> </span>use<span class="_ _11"> </span>it<span class="_ _16"> </span>for<span class="_"> </span>input<span class="_ _11"> </span>and</div><div class="t m5 xcd h26 y795a ff7 fs19 fc2 sc0 ls0 ws0">output<span class="_ _14"> </span>on<span class="_ _14"> </span>networks<span class="_ _1"></span>.<span class="_ _14"> </span>As<span class="_ _14"> </span>we<span class="_ _14"> </span>will<span class="_ _14"> </span>see<span class="_ _14"> </span>in<span class="_ _14"> </span>Section<span class="_ _14"> </span>11.4,<span class="_ _15"> </span>the<span class="_ _14"> </span>Linux<span class="_ _14"> </span>abstrac-</div><div class="t m5 xcd h26 y228 ff7 fs19 fc2 sc0 ls0 ws0">tion<span class="_ _14"> </span>for<span class="_ _16"> </span>a<span class="_ _14"> </span>network<span class="_ _14"> </span>is<span class="_ _14"> </span>a<span class="_ _14"> </span>type<span class="_ _14"> </span>of<span class="_ _14"> </span>ﬁle<span class="_ _14"> </span>called<span class="_ _14"> </span>a<span class="_ _14"> </span><span class="ffa">socket<span class="_ _2"></span></span>.<span class="_ _14"> </span>Like<span class="_ _14"> </span>any<span class="_ _16"> </span>Linux<span class="_ _14"> </span>ﬁle,</div><div class="t m5 xcd h26 y795b ff7 fs19 fc2 sc0 ls0 ws0">sockets<span class="_ _13"> </span>are<span class="_"> </span>referenced<span class="_ _13"> </span>by<span class="_ _13"> </span>ﬁle<span class="_ _13"> </span>descriptors<span class="_ _1"></span>,<span class="_"> </span>known<span class="_ _13"> </span>in<span class="_ _13"> </span>this<span class="_"> </span>case<span class="_ _13"> </span>as<span class="_ _13"> </span><span class="ffa">socket<span class="_ _13"> </span>de-</span></div><div class="t m5 xcd h26 y6a07 ffa fs19 fc2 sc0 ls0 ws0">scriptors<span class="ff7">.<span class="_"> </span>Application<span class="_"> </span>processes<span class="_ _13"> </span>communicate<span class="_"> </span>with<span class="_"> </span>processes<span class="_ _13"> </span>running<span class="_"> </span>on</span></div><div class="t m5 xcd h26 y6a08 ff7 fs19 fc2 sc0 ls0 ws0">other<span class="_"> </span>computers<span class="_"> </span>by<span class="_"> </span>reading<span class="_"> </span>and<span class="_"> </span>writing<span class="_"> </span>socket<span class="_"> </span>descriptors<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y314 ff7 fs19 fc2 sc0 ls0 ws0">Standard<span class="_"> </span>I/O<span class="_"> </span>streams<span class="_"> </span>are<span class="_"> </span><span class="ffa">full<span class="_"> </span>duplex<span class="_ _11"> </span></span>in<span class="_"> </span>the<span class="_"> </span>sense<span class="_"> </span>that<span class="_"> </span>programs<span class="_"> </span>can<span class="_ _11"> </span>perform</div><div class="t m5 x1d h26 y315 ff7 fs19 fc2 sc0 ls0 ws0">input<span class="_ _14"> </span>and<span class="_ _15"> </span>output<span class="_ _14"> </span>on<span class="_ _15"> </span>the<span class="_ _14"> </span>same<span class="_ _15"> </span>stream.<span class="_ _14"> </span>However,<span class="_ _15"> </span>there<span class="_ _14"> </span>are<span class="_ _15"> </span>poorly<span class="_ _14"> </span>documented</div><div class="t m5 x1d h26 y316 ff7 fs19 fc2 sc0 ls0 ws0">restrictions<span class="_"> </span>on<span class="_"> </span>streams<span class="_"> </span>that<span class="_"> </span>interact<span class="_"> </span>badly<span class="_"> </span>with<span class="_"> </span>restrictions<span class="_"> </span>on<span class="_"> </span>sockets:</div><div class="t m5 x75 h26 y795c ff7 fs19 fc2 sc0 ls0 ws0">Restriction<span class="_ _21"> </span>1:<span class="_ _1f"> </span><span class="ffa">Input<span class="_ _21"> </span>functions<span class="_ _21"> </span>following<span class="_ _21"> </span>output<span class="_ _21"> </span>functions<span class="_ _1"></span>.<span class="_ _14"> </span><span class="ff7">An<span class="_ _21"> </span>input<span class="_ _21"> </span>function</span></span></div><div class="t m5 xcd h26 y795d ff7 fs19 fc2 sc0 ls0 ws0">cannot<span class="_ _11"> </span>follow<span class="_ _11"> </span>an<span class="_ _16"> </span>output<span class="_"> </span>function<span class="_ _16"> </span>without<span class="_ _11"> </span>an<span class="_ _11"> </span>intervening<span class="_ _11"> </span>call<span class="_ _16"> </span>to<span class="_"> </span><span class="ffd">fflush</span>,</div><div class="t m5 xcd h26 y3bd4 ffd fs19 fc2 sc0 ls0 ws0">fseek<span class="ff7">,<span class="_ _16"> </span></span>fsetpos<span class="ff7 ls2d5">,o<span class="_ _42"></span>r<span class="ffd ls0">rewind</span><span class="ls2d6">.T<span class="_ _42"></span>h<span class="_ _49"></span>e<span class="ffd ls0">fflush<span class="_ _11"> </span><span class="ff7">function<span class="_ _16"> </span>empties<span class="_ _11"> </span>the<span class="_ _16"> </span>buffer<span class="_ _11"> </span>as-</span></span></span></span></div><div class="t m5 xcd h26 y3bd5 ff7 fs19 fc2 sc0 ls0 ws0">sociated<span class="_ _13"> </span>with<span class="_"> </span>a<span class="_ _13"> </span>stream.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span>latter<span class="_"> </span>three<span class="_ _13"> </span>functions<span class="_"> </span>use<span class="_ _13"> </span>the<span class="_ _13"> </span>Unix<span class="_"> </span>I/O<span class="_ _13"> </span><span class="ffd">lseek</span></div><div class="t m5 xcd h26 y3bd6 ff7 fs19 fc2 sc0 ls0 ws0">function<span class="_"> </span>to<span class="_"> </span>reset<span class="_"> </span>the<span class="_"> </span>current<span class="_"> </span>ﬁle<span class="_"> </span>position.</div><div class="t m5 x75 h26 y31d ff7 fs19 fc2 sc0 ls0 ws0">Restriction<span class="_ _16"> </span>2:<span class="_ _e"> </span><span class="ffa">Output<span class="_ _16"> </span>functions<span class="_ _16"> </span>following<span class="_ _16"> </span>input<span class="_ _16"> </span>functions<span class="_ _1"></span>.<span class="_ _13"> </span><span class="ff7">An<span class="_ _16"> </span>output<span class="_ _16"> </span>function</span></span></div><div class="t m5 xcd h26 y31e ff7 fs19 fc2 sc0 ls0 ws0">cannot<span class="_ _15"> </span>follow<span class="_ _21"> </span>an<span class="_ _21"> </span>input<span class="_ _21"> </span>function<span class="_ _21"> </span>without<span class="_ _21"> </span>an<span class="_ _21"> </span>intervening<span class="_ _21"> </span>call<span class="_ _21"> </span>to<span class="_ _21"> </span><span class="ffd">fseek</span>,</div><div class="t m5 xcd h26 y31f ffd fs19 fc2 sc0 ls0 ws0">fsetpos<span class="ff7 ls140">,o<span class="_ _4a"></span>r<span class="ffd ls0">rewind<span class="ff7">,<span class="_"> </span>unless<span class="_"> </span>the<span class="_"> </span>input<span class="_"> </span>function<span class="_"> </span>encounters<span class="_"> </span>an<span class="_"> </span>end-of-ﬁle<span class="_ _1"></span>.</span></span></span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
