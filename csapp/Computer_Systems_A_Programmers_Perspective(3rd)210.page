<div id="pfd2" class="pf w2 h11" data-page-no="d2"><div class="pc pcd2 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bgd2.png"/><div class="t m5 x1e8 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>3.2<span class="_ _60"> </span>Program<span class="_ _10"> </span>Encodings<span class="_ _3e"> </span><span class="ffe fs1e">209</span></div><div class="t m5 x34 h2a y548 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">How<span class="_ _11"> </span>do<span class="_ _11"> </span>I<span class="_ _11"> </span>display<span class="_ _16"> </span>the<span class="_ _11"> </span>byte<span class="_ _11"> </span>representation<span class="_ _11"> </span>of<span class="_ _16"> </span>a<span class="_ _11"> </span>program?</span></div><div class="t m5 x34 h2b y2d0 ff7 fs1e fc2 sc0 ls0 ws0">T<span class="_ _3"></span>o<span class="_ _13"> </span>display<span class="_ _13"> </span>the<span class="_ _6"> </span>binary<span class="_"> </span>object<span class="_ _6"> </span>code<span class="_"> </span>for<span class="_ _6"> </span>a<span class="_"> </span>program<span class="_ _6"> </span>(say<span class="_ _3"></span>,<span class="_"> </span><span class="ffd">mstore</span>),<span class="_ _13"> </span>we<span class="_ _13"> </span>use<span class="_ _13"> </span>a<span class="_ _6"> </span><span class="ffa">disassembler<span class="_"> </span></span>(described<span class="_ _13"> </span>below)</div><div class="t m5 x34 h2b y2d1 ff7 fs1e fc2 sc0 ls0 ws0">to<span class="_ _10"> </span>determine<span class="_ _11"> </span>that<span class="_ _11"> </span>the<span class="_ _11"> </span>code<span class="_ _10"> </span>for<span class="_ _11"> </span>the<span class="_ _11"> </span>procedure<span class="_ _11"> </span>is<span class="_ _11"> </span>14<span class="_ _10"> </span>bytes<span class="_ _11"> </span>long.<span class="_ _10"> </span>Then<span class="_"> </span>we<span class="_ _11"> </span>run<span class="_ _11"> </span>the<span class="_ _10"> </span>GNU<span class="_ _11"> </span>debugging<span class="_ _11"> </span>tool</div><div class="t m5 x34 h2b y2d2 ff9 fs1e fc2 sc0 ls0 ws0">gdb<span class="_ _10"> </span><span class="ff7">on<span class="_"> </span>ﬁle<span class="_"> </span><span class="ffd">mstore.o<span class="_ _10"> </span></span>and<span class="_"> </span>give<span class="_"> </span>it<span class="_"> </span>the<span class="_"> </span>command</span></div><div class="t m5 x34 h2d y7aa ffd fs1e fc2 sc0 ls0 ws0">(gdb)<span class="_ _e"> </span><span class="ff13">x/14xb<span class="_ _1f"> </span>multstore</span></div><div class="t m5 x34 h2b y9e8 ff7 fs1e fc2 sc0 ls0 ws0">telling<span class="_ _13"> </span>it<span class="_ _6"> </span>to<span class="_ _13"> </span>display<span class="_ _13"> </span>(abbreviated<span class="_ _6"> </span>‘<span class="ffd">x</span>’)<span class="_ _13"> </span>14<span class="_ _13"> </span>hex-formatted<span class="_ _6"> </span>(also<span class="_ _13"> </span>‘<span class="ffd">x</span>’)<span class="_ _13"> </span>bytes<span class="_ _6"> </span>(‘<span class="ffd">b</span>’)<span class="_ _13"> </span>starting<span class="_ _13"> </span>at<span class="_ _6"> </span>the<span class="_ _13"> </span>address<span class="_ _13"> </span>where</div><div class="t m5 x34 h2b y20e3 ff7 fs1e fc2 sc0 ls0 ws0">function<span class="_"> </span><span class="ffd">multstore<span class="_ _13"> </span></span>is<span class="_"> </span>located.<span class="_"> </span>Y<span class="_ _3"></span>ou<span class="_"> </span>will<span class="_"> </span>ﬁnd<span class="_"> </span>that<span class="_ _13"> </span><span class="ff9">gdb<span class="_ _10"> </span></span>has<span class="_"> </span>many<span class="_"> </span>useful<span class="_ _13"> </span>features<span class="_"> </span>for<span class="_"> </span>analyzing<span class="_"> </span>machine-</div><div class="t m5 x34 h2b yc77 ff7 fs1e fc2 sc0 ls0 ws0">level<span class="_"> </span>programs<span class="_ _1"></span>,<span class="_"> </span>as<span class="_"> </span>will<span class="_"> </span>be<span class="_"> </span>discussed<span class="_"> </span>in<span class="_"> </span>Section<span class="_"> </span>3.10.2.</div><div class="t m5 x72 h2d y20e4 ffd fs1e fc2 sc0 ls0 ws0">movq<span class="_ _46"> </span>%rdx,<span class="_ _e"> </span>%rbx</div><div class="t m5 x72 h2d y20e5 ffd fs1e fc2 sc0 ls0 ws0">call<span class="_ _46"> </span>mult2</div><div class="t m5 x72 h2d y20e6 ffd fs1e fc2 sc0 ls0 ws0">movq<span class="_ _46"> </span>%rax,<span class="_ _e"> </span>(%rbx)</div><div class="t m5 x72 h2d y20e7 ffd fs1e fc2 sc0 ls0 ws0">popq<span class="_ _46"> </span>%rbx</div><div class="t m5 x72 h2d y20e8 ffd fs1e fc2 sc0 ls0 ws0">ret</div><div class="t m5 x17 h26 y20e9 ff7 fs19 fc2 sc0 ls0 ws0">Each<span class="_ _11"> </span>indented<span class="_ _16"> </span>line<span class="_ _16"> </span>in<span class="_ _11"> </span>the<span class="_ _16"> </span>code<span class="_ _16"> </span>corresponds<span class="_ _11"> </span>to<span class="_ _16"> </span>a<span class="_ _11"> </span>single<span class="_ _16"> </span>machine<span class="_ _16"> </span>instruction.<span class="_ _11"> </span>F<span class="_ _1"></span>or</div><div class="t m5 x17 h26 y20ea ff7 fs19 fc2 sc0 ls0 ws0">example<span class="_ _1"></span>,<span class="_"> </span>the<span class="_ _13"> </span><span class="ffd">pushq<span class="_ _10"> </span></span>instruction<span class="_"> </span>indicates<span class="_ _13"> </span>that<span class="_"> </span>the<span class="_ _13"> </span>contents<span class="_ _13"> </span>of<span class="_"> </span>register<span class="_ _13"> </span><span class="ffd">%rbx<span class="_ _10"> </span></span>should</div><div class="t m5 x17 h26 y20eb ff7 fs19 fc2 sc0 ls0 ws0">be<span class="_"> </span>pushed<span class="_ _13"> </span>onto<span class="_"> </span>the<span class="_ _13"> </span>program<span class="_"> </span>stack.<span class="_ _13"> </span>All<span class="_"> </span>information<span class="_ _13"> </span>about<span class="_"> </span>local<span class="_ _13"> </span>variable<span class="_"> </span>names<span class="_ _13"> </span>or</div><div class="t m5 x17 h26 y20ec ff7 fs19 fc2 sc0 ls0 ws0">data<span class="_"> </span>types<span class="_"> </span>has<span class="_"> </span>been<span class="_"> </span>stripped<span class="_"> </span>away<span class="_ _3"></span>.</div><div class="t m5 x26 h26 y20ed ff7 fs19 fc2 sc0 ls0 ws0">If<span class="_ _16"> </span>we<span class="_ _16"> </span>use<span class="_ _16"> </span>the<span class="_ _11"> </span><span class="ffd">-c<span class="_ _16"> </span></span>command-line<span class="_ _16"> </span>option,<span class="_ _14"> </span><span class="ff9">gcc<span class="_ _16"> </span></span>will<span class="_ _16"> </span>both<span class="_ _11"> </span>compile<span class="_ _16"> </span>and<span class="_ _16"> </span>assemble</div><div class="t m5 x17 h26 y20ee ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>code</div><div class="t m5 x17 h2d y20ef ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">gcc<span class="_ _1f"> </span>-Og<span class="_ _1f"> </span>-c<span class="_ _e"> </span>mstore.c</span></div><div class="t m5 x17 h26 y20f0 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>will<span class="_ _13"> </span>generate<span class="_"> </span>an<span class="_ _13"> </span>object-code<span class="_ _13"> </span>ﬁle<span class="_"> </span><span class="ffd">mstore.o<span class="_ _13"> </span></span>that<span class="_"> </span>is<span class="_ _13"> </span>in<span class="_ _13"> </span>binary<span class="_"> </span>format<span class="_ _13"> </span>and<span class="_"> </span>hence</div><div class="t m5 x17 h26 y20f1 ff7 fs19 fc2 sc0 ls0 ws0">cannot<span class="_"> </span>be<span class="_"> </span>viewed<span class="_"> </span>directly<span class="_ _3"></span>.<span class="_"> </span>Embedded<span class="_"> </span>within<span class="_ _11"> </span>the<span class="_"> </span>1,368<span class="_"> </span>bytes<span class="_"> </span>of<span class="_ _11"> </span>the<span class="_"> </span>ﬁle<span class="_"> </span><span class="ffd">mstore.o</span></div><div class="t m5 x17 h26 y20f2 ff7 fs19 fc2 sc0 ls0 ws0">is<span class="_"> </span>a<span class="_"> </span>14-byte<span class="_"> </span>sequence<span class="_"> </span>with<span class="_"> </span>the<span class="_"> </span>hexadecimal<span class="_"> </span>representation</div><div class="t m5 x17 h2d y20f3 ffd fs1e fc2 sc0 ls0 ws0">53<span class="_ _e"> </span>48<span class="_ _1f"> </span>89<span class="_ _1f"> </span>d3<span class="_ _e"> </span>e8<span class="_ _1f"> </span>00<span class="_ _e"> </span>00<span class="_ _1f"> </span>00<span class="_ _1f"> </span>00<span class="_ _e"> </span>48<span class="_ _1f"> </span>89<span class="_ _e"> </span>03<span class="_ _1f"> </span>5b<span class="_ _1f"> </span>c3</div><div class="t m5 x17 h26 y20f4 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _6"> </span>is<span class="_ _6"> </span>the<span class="_ _6"> </span>object<span class="_ _6"> </span>code<span class="_ _6"> </span>corresponding<span class="_ _13"> </span>to<span class="_ _a"> </span>the<span class="_ _6"> </span>assembly<span class="_ _6"> </span>instructions<span class="_ _6"> </span>listed<span class="_ _6"> </span>previously<span class="_ _3"></span>.</div><div class="t m5 x17 h26 y20f5 ff7 fs19 fc2 sc0 ls0 ws0">A<span class="_ _16"> </span>key<span class="_ _16"> </span>lesson<span class="_ _16"> </span>to<span class="_ _16"> </span>learn<span class="_ _16"> </span>from<span class="_ _16"> </span>this<span class="_ _14"> </span>is<span class="_ _16"> </span>that<span class="_ _16"> </span>the<span class="_ _16"> </span>program<span class="_ _16"> </span>executed<span class="_ _16"> </span>by<span class="_ _16"> </span>the<span class="_ _14"> </span>machine<span class="_ _16"> </span>is</div><div class="t m5 x17 h26 y20f6 ff7 fs19 fc2 sc0 ls0 ws0">simply<span class="_ _15"> </span>a<span class="_ _15"> </span>sequence<span class="_ _15"> </span>of<span class="_ _14"> </span>bytes<span class="_ _15"> </span>encoding<span class="_ _15"> </span>a<span class="_ _15"> </span>series<span class="_ _15"> </span>of<span class="_ _15"> </span>instructions<span class="_ _1"></span>.<span class="_ _15"> </span>The<span class="_ _14"> </span>machine<span class="_ _15"> </span>has</div><div class="t m5 x17 h26 y20f7 ff7 fs19 fc2 sc0 ls0 ws0">very<span class="_"> </span>little<span class="_"> </span>information<span class="_ _11"> </span>about<span class="_"> </span>the<span class="_"> </span>source<span class="_ _11"> </span>code<span class="_"> </span>from<span class="_"> </span>which<span class="_ _11"> </span>these<span class="_"> </span>instructions<span class="_"> </span>were</div><div class="t m5 x17 h26 y20f8 ff7 fs19 fc2 sc0 ls0 ws0">generated.</div><div class="t m5 x26 h26 y20f9 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_ _16"> </span>inspect<span class="_ _11"> </span>the<span class="_ _16"> </span>contents<span class="_ _11"> </span>of<span class="_ _16"> </span>machine-code<span class="_ _11"> </span>ﬁles<span class="_ _0"></span>,<span class="_ _16"> </span>a<span class="_ _11"> </span>class<span class="_ _16"> </span>of<span class="_ _11"> </span>programs<span class="_ _16"> </span>known<span class="_ _11"> </span>as</div><div class="t m5 x17 h26 y20fa ffa fs19 fc2 sc0 ls0 ws0">disassemblers<span class="_ _15"> </span><span class="ff7">can<span class="_ _21"> </span>be<span class="_ _21"> </span>invaluable.<span class="_ _15"> </span>T<span class="_ _1"></span>hese<span class="_ _21"> </span>programs<span class="_ _21"> </span>generate<span class="_ _21"> </span>a<span class="_ _15"> </span>format<span class="_ _21"> </span>similar<span class="_ _21"> </span>to</span></div><div class="t m5 x17 h26 y20fb ff7 fs19 fc2 sc0 ls0 ws0">assembly<span class="_ _13"> </span>code<span class="_"> </span>from<span class="_ _13"> </span>the<span class="_ _13"> </span>machine<span class="_ _13"> </span>code.<span class="_ _13"> </span>W<span class="_ _1"></span>ith<span class="_"> </span>Linux<span class="_ _13"> </span>systems<span class="_ _3"></span>,<span class="_"> </span>the<span class="_ _13"> </span>program<span class="_ _13"> </span><span class="ff9">objdump</span></div><div class="t m5 x17 h26 y20fc ff7 fs19 fc2 sc0 ls0 ws0">(for<span class="_"> </span>“object<span class="_"> </span>dump”)<span class="_"> </span>can<span class="_"> </span>serve<span class="_"> </span>this<span class="_"> </span>role<span class="_"> </span>given<span class="_"> </span>the<span class="_"> </span><span class="ffd">-d<span class="_ _10"> </span></span>command-line<span class="_"> </span>ﬂag:</div><div class="t m5 x17 h2d y20fd ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">objdump<span class="_ _1f"> </span>-d<span class="_ _1f"> </span>mstore.o</span></div><div class="t m5 x17 h26 y8d6 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _15"> </span>result<span class="_ _15"> </span>(where<span class="_ _15"> </span>we<span class="_ _14"> </span>have<span class="_ _15"> </span>added<span class="_ _15"> </span>line<span class="_ _14"> </span>numbers<span class="_ _15"> </span>on<span class="_ _15"> </span>the<span class="_ _15"> </span>left<span class="_ _14"> </span>and<span class="_ _15"> </span>annotations<span class="_ _15"> </span>in</div><div class="t m5 x17 h26 y8d7 ff7 fs19 fc2 sc0 ls0 ws0">italicized<span class="_"> </span>text)<span class="_"> </span>is<span class="_"> </span>as<span class="_"> </span>follows:</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
