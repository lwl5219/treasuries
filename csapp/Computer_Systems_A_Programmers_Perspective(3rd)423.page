<div id="pf1a7" class="pf w2 h11" data-page-no="1a7"><div class="pc pc1a7 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1a7.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">422<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>4<span class="_ _3d"> </span>Processor<span class="_ _10"> </span>Architecture</span></div><div class="t m5 xb h2d y3829 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">0x000:<span class="_ _1f"> </span>30f20900000000000000<span class="_ _e"> </span>|<span class="_ _8c"> </span>irmovq<span class="_ _1f"> </span>$9,<span class="_ _1a"> </span>%rdx</span></div><div class="t m5 xb h2d y3aa2 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">0x00a:<span class="_ _1f"> </span>30f31500000000000000<span class="_ _e"> </span>|<span class="_ _8c"> </span>irmovq<span class="_ _1f"> </span>$21,<span class="_ _1f"> </span>%rbx</span></div><div class="t m5 xb h2d y3aa3 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _1c"> </span><span class="ffd fs1e fc2">0x014:<span class="_ _1f"> </span>6123<span class="_ _15a"> </span>|<span class="_ _58"> </span>subq<span class="_ _1f"> </span>%rdx,<span class="_ _1f"> </span>%rbx<span class="_ _86"> </span>#<span class="_ _e"> </span>subtract</span></div><div class="t m5 xb h2d y3aa4 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _1c"> </span><span class="ffd fs1e fc2">0x016:<span class="_ _1f"> </span>30f48000000000000000<span class="_ _e"> </span>|<span class="_ _8c"> </span>irmovq<span class="_ _1f"> </span>$128,%rsp<span class="_ _82"> </span>#<span class="_ _1f"> </span>Problem<span class="_ _1f"> </span>4.13</span></div><div class="t m5 xb h2d y3aa5 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _1c"> </span><span class="ffd fs1e fc2">0x020:<span class="_ _1f"> </span>40436400000000000000<span class="_ _e"> </span>|<span class="_ _8c"> </span>rmmovq<span class="_ _1f"> </span>%rsp,<span class="_ _1f"> </span>100(%rbx)<span class="_ _3f"> </span>#<span class="_ _e"> </span>store</span></div><div class="t m5 xb h2d y3aa6 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _1c"> </span><span class="ffd fs1e fc2">0x02a:<span class="_ _1f"> </span>a02f<span class="_ _15a"> </span>|<span class="_ _58"> </span>pushq<span class="_ _1f"> </span>%rdx<span class="_ _d4"> </span>#<span class="_ _e"> </span>push</span></div><div class="t m5 xb h2d y3aa7 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _1c"> </span><span class="ffd fs1e fc2">0x02c:<span class="_ _1f"> </span>b00f<span class="_ _15a"> </span>|<span class="_ _58"> </span>popq<span class="_ _1a"> </span>%rax<span class="_ _d4"> </span>#<span class="_ _1f"> </span>Problem<span class="_ _e"> </span>4.14</span></div><div class="t m5 xb h2d y3aa8 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _1c"> </span><span class="ffd fs1e fc2">0x02e:<span class="_ _1f"> </span>734000000000000000<span class="_ _3f"> </span>|<span class="_ _8c"> </span>je<span class="_ _e"> </span>done<span class="_ _d9"> </span>#<span class="_ _1f"> </span>Not<span class="_ _e"> </span>taken</span></div><div class="t m5 xb h2d y3aa9 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _1c"> </span><span class="ffd fs1e fc2">0x037:<span class="_ _1f"> </span>804100000000000000<span class="_ _3f"> </span>|<span class="_ _8c"> </span>call<span class="_ _e"> </span>proc<span class="_ _12a"> </span>#<span class="_ _1f"> </span>Problem<span class="_ _e"> </span>4.18</span></div><div class="t m5 x14 h2d y3aaa ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _1c"> </span><span class="ffd fs1e fc2">0x040:<span class="_ _129"> </span>|<span class="_ _1f"> </span>done:</span></div><div class="t m5 x14 h2d y3aab ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _1c"> </span><span class="ffd fs1e fc2">0x040:<span class="_ _1f"> </span>00<span class="_ _159"> </span>|<span class="_ _8c"> </span>halt</span></div><div class="t m5 x14 h2d y3aac ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _1c"> </span><span class="ffd fs1e fc2">0x041:<span class="_ _129"> </span>|<span class="_ _1f"> </span>proc:</span></div><div class="t m5 x14 h2d y3aad ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _1c"> </span><span class="ffd fs1e fc2">0x041:<span class="_ _1f"> </span>90<span class="_ _159"> </span>|<span class="_ _8c"> </span>ret<span class="_ _129"> </span>#<span class="_ _1f"> </span>Return</span></div><div class="t m5 x14 h2d y3aae ff6 fs20 fc6 sc0 ls0 ws0">14<span class="_ _1ab"> </span><span class="ffd fs1e fc2">|</span></div><div class="t m5 x14 h34 y3aaf ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _13"> </span>4.17<span class="_ _66"> </span><span class="fc1">Sample<span class="_ _13"> </span>Y86-64<span class="_ _6"> </span>instruction<span class="_ _13"> </span>sequence.<span class="_ _13"> </span><span class="ff6">W<span class="_ _1"></span>e<span class="_ _13"> </span>will<span class="_ _6"> </span>trace<span class="_ _13"> </span>the<span class="_ _13"> </span>processing<span class="_ _6"> </span>of<span class="_ _13"> </span>these<span class="_ _13"> </span>instructions<span class="_ _6"> </span>through</span></span></div><div class="t m5 x14 h34 y3ab0 ff6 fs16 fc1 sc0 ls0 ws0">the<span class="_ _10"> </span>different<span class="_ _11"> </span>stages.</div><div class="t m5 x1d h46 y3ed ff7 fs19 fc1 sc0 ls0 ws0">(indicated<span class="_ _13"> </span>by<span class="_ _13"> </span>the<span class="_ _13"> </span>assignment<span class="_ _13"> </span>operation<span class="_ _13"> </span>‘<span class="ff12">←</span>’).<span class="_ _13"> </span>These<span class="_ _13"> </span>should<span class="_ _13"> </span>be<span class="_ _13"> </span>read<span class="_ _13"> </span>as<span class="_ _13"> </span>if<span class="_ _13"> </span>they<span class="_ _13"> </span>were</div><div class="t m5 x1d h26 y3ee ff7 fs19 fc1 sc0 ls0 ws0">evaluated<span class="_"> </span>in<span class="_"> </span>sequence<span class="_ _13"> </span>from<span class="_"> </span>top<span class="_"> </span>to<span class="_"> </span>bottom.<span class="_"> </span>W<span class="_ _0"></span>hen<span class="_"> </span>we<span class="_"> </span>later<span class="_ _13"> </span>map<span class="_"> </span>the<span class="_"> </span>computations</div><div class="t m5 x1d h26 y3ef ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _13"> </span>hardware<span class="_ _1"></span>,<span class="_ _13"> </span>we<span class="_ _13"> </span>will<span class="_ _13"> </span>ﬁnd<span class="_ _13"> </span>that<span class="_ _6"> </span>we<span class="_ _13"> </span>do<span class="_ _13"> </span>not<span class="_ _13"> </span>need<span class="_ _13"> </span>to<span class="_ _6"> </span>perform<span class="_ _13"> </span>these<span class="_ _13"> </span>evaluations<span class="_ _13"> </span>in<span class="_ _13"> </span>strict</div><div class="t m5 x1d h26 y3f0 ff7 fs19 fc1 sc0 ls0 ws0">sequential<span class="_"> </span>order.</div><div class="t m5 x29 h26 y3f1 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _16"> </span>4.18<span class="_ _11"> </span>shows<span class="_ _16"> </span>the<span class="_ _11"> </span>processing<span class="_ _16"> </span>required<span class="_ _11"> </span>for<span class="_ _11"> </span>instruction<span class="_ _16"> </span>types<span class="_ _11"> </span><span class="ffd">OPq<span class="_ _16"> </span></span>(integer</div><div class="t m5 x1d h26 y3f2 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _13"> </span>logical<span class="_ _13"> </span>operations),<span class="_ _13"> </span><span class="ffd">rrmovq<span class="_ _13"> </span></span>(register<span class="_ _1"></span>-register<span class="_ _13"> </span>move),<span class="_ _13"> </span>and<span class="_ _13"> </span><span class="ffd">irmovq<span class="_ _13"> </span></span>(immediate-</div><div class="t m5 x1d h26 y3f3 ff7 fs19 fc1 sc0 ls0 ws0">register<span class="_ _13"> </span>move).<span class="_"> </span>Let<span class="_ _13"> </span>us<span class="_"> </span>ﬁrst<span class="_ _13"> </span>consider<span class="_"> </span>the<span class="_ _13"> </span>integer<span class="_"> </span>operations<span class="_ _3"></span>.<span class="_"> </span>Examining<span class="_ _13"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>4.2,</div><div class="t m5 x1d h26 y3f4 ff7 fs19 fc1 sc0 ls0 ws0">we<span class="_ _11"> </span>can<span class="_ _11"> </span>see<span class="_ _11"> </span>that<span class="_ _11"> </span>we<span class="_ _11"> </span>have<span class="_ _11"> </span>carefully<span class="_ _11"> </span>chosen<span class="_ _11"> </span>an<span class="_ _11"> </span>encoding<span class="_ _16"> </span>of<span class="_"> </span>instructions<span class="_ _11"> </span>so<span class="_ _11"> </span>that<span class="_ _11"> </span>the</div><div class="t m5 x1d h26 y3f5 ff7 fs19 fc1 sc0 ls0 ws0">four<span class="_ _11"> </span>integer<span class="_ _16"> </span>operations<span class="_ _11"> </span>(<span class="ffd">addq</span>,<span class="_ _16"> </span><span class="ffd">subq</span>,<span class="_ _11"> </span><span class="ffd">andq</span>,<span class="_ _16"> </span>and<span class="_ _11"> </span><span class="ffd">xorq</span>)<span class="_ _16"> </span>all<span class="_ _11"> </span>have<span class="_ _11"> </span>the<span class="_ _16"> </span>same<span class="_ _11"> </span>value<span class="_ _16"> </span>of</div><div class="t m5 x1d h26 y3f6 ff6 fs19 fc1 sc0 ls0 ws0">icode<span class="ff7">.<span class="_ _11"> </span>W<span class="_ _3"></span>e<span class="_ _16"> </span>can<span class="_"> </span>handle<span class="_ _16"> </span>them<span class="_"> </span>all<span class="_ _16"> </span>by<span class="_"> </span>an<span class="_ _16"> </span>identical<span class="_"> </span>sequence<span class="_ _16"> </span>of<span class="_"> </span>steps<span class="_ _0"></span>,<span class="_ _11"> </span>except<span class="_ _11"> </span>that<span class="_ _16"> </span>the</span></div><div class="t m5 x1d h26 y3f7 ff7 fs19 fc1 sc0 ls0 ws0">ALU<span class="_"> </span>computation<span class="_ _11"> </span>must<span class="_ _11"> </span>be<span class="_ _11"> </span>set<span class="_ _11"> </span>according<span class="_"> </span>to<span class="_ _11"> </span>the<span class="_ _11"> </span>particular<span class="_ _11"> </span>instruction<span class="_ _11"> </span>operation,</div><div class="t m5 x1d h26 y3f8 ff7 fs19 fc1 sc0 ls0 ws0">encoded<span class="_"> </span>in<span class="_"> </span><span class="ff6">ifun</span>.</div><div class="t m5 x29 h26 y3f9 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _13"> </span>processing<span class="_ _13"> </span>of<span class="_ _13"> </span>an<span class="_ _6"> </span>integer<span class="_ _0"></span>-operation<span class="_ _13"> </span>instruction<span class="_ _6"> </span>follows<span class="_ _13"> </span>the<span class="_ _13"> </span>general<span class="_ _13"> </span>pattern</div><div class="t m5 x1d h26 y3fa ff7 fs19 fc1 sc0 ls0 ws0">listed<span class="_ _16"> </span>above<span class="_ _1"></span>.<span class="_ _14"> </span>In<span class="_ _16"> </span>the<span class="_ _16"> </span>fetch<span class="_ _16"> </span>stage<span class="_ _0"></span>,<span class="_ _16"> </span>we<span class="_ _16"> </span>do<span class="_ _16"> </span>not<span class="_ _14"> </span>require<span class="_ _16"> </span>a<span class="_ _16"> </span>constant<span class="_ _16"> </span>word,<span class="_ _16"> </span>and<span class="_ _14"> </span>so<span class="_ _16"> </span><span class="ff6">valP</span></div><div class="t m5 x1d h46 y3fb ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_ _16"> </span>computed<span class="_ _11"> </span>as<span class="_ _16"> </span><span class="ff6">PC<span class="_ _10"> </span><span class="ff12">+<span class="_ _10"> </span></span></span>2.<span class="_ _11"> </span>During<span class="_ _16"> </span>the<span class="_ _16"> </span>decode<span class="_ _16"> </span>stage<span class="_ _1"></span>,<span class="_ _14"> </span>we<span class="_ _16"> </span>read<span class="_ _11"> </span>both<span class="_ _16"> </span>operands<span class="_ _1"></span>.<span class="_ _16"> </span>T<span class="_ _0"></span>hese</div><div class="t m5 x1d h26 y3fc ff7 fs19 fc1 sc0 ls0 ws0">are<span class="_ _16"> </span>supplied<span class="_ _16"> </span>to<span class="_ _14"> </span>the<span class="_ _16"> </span>ALU<span class="_ _16"> </span>in<span class="_ _14"> </span>the<span class="_ _16"> </span>execute<span class="_ _16"> </span>stage,<span class="_ _16"> </span>along<span class="_ _16"> </span>with<span class="_ _14"> </span>the<span class="_ _16"> </span>function<span class="_ _16"> </span>speciﬁer</div><div class="t m5 x1d h26 y3fd ff6 fs19 fc1 sc0 ls0 ws0">ifun<span class="ff7">,<span class="_"> </span>so<span class="_ _13"> </span>that<span class="_ _13"> </span></span>valE<span class="_ _10"> </span><span class="ff7">becomes<span class="_ _13"> </span>the<span class="_"> </span>instruction<span class="_ _13"> </span>result.<span class="_ _13"> </span>This<span class="_ _13"> </span>computation<span class="_ _13"> </span>is<span class="_"> </span>shown<span class="_ _13"> </span>as<span class="_"> </span>the</span></div><div class="t m5 x1d h26 y3ff ff7 fs19 fc1 sc0 ls0 ws0">expression<span class="_ _13"> </span><span class="ff6">valB<span class="_ _13"> </span>OP<span class="_ _13"> </span>valA<span class="_ _2"></span></span>,<span class="_"> </span>where<span class="_ _13"> </span><span class="ff6">OP<span class="_ _13"> </span></span>indicates<span class="_ _13"> </span>the<span class="_"> </span>operation<span class="_ _13"> </span>speciﬁed<span class="_ _13"> </span>by<span class="_ _13"> </span><span class="ff6">ifun</span>.<span class="_"> </span>Note</div><div class="t m5 x1d h26 y400 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>ordering<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>two<span class="_"> </span>arguments—this<span class="_"> </span>order<span class="_ _11"> </span>is<span class="_"> </span>consistent<span class="_"> </span>with<span class="_"> </span>the<span class="_"> </span>conventions</div><div class="t m5 x1d h26 y402 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_ _13"> </span>Y86-64<span class="_ _13"> </span>(and<span class="_ _13"> </span>x86-64).<span class="_ _13"> </span>F<span class="_ _1"></span>or<span class="_ _13"> </span>example,<span class="_ _13"> </span>the<span class="_ _13"> </span>instruction<span class="_ _13"> </span><span class="ffd">subq<span class="_ _11"> </span>%rax,%rdx<span class="_ _10"> </span></span>is<span class="_ _13"> </span>supposed</div><div class="t m5 x1d h46 y403 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _16"> </span>compute<span class="_ _16"> </span>the<span class="_ _16"> </span>value<span class="_ _16"> </span><span class="ff6">R</span>[<span class="ffd">%rdx</span>]<span class="_ _13"> </span><span class="ff12">−<span class="_ _13"></span><span class="ff6">R<span class="_ _2"></span></span></span>[<span class="ffd">%rax</span>]<span class="_ _3"></span>.<span class="_ _16"> </span>Nothing<span class="_ _16"> </span>happens<span class="_ _16"> </span>in<span class="_ _16"> </span>the<span class="_ _16"> </span>memory<span class="_ _16"> </span>stage</div><div class="t m5 x1d h26 y404 ff7 fs19 fc1 sc0 ls0 ws0">for<span class="_ _13"> </span>these<span class="_"> </span>instructions<span class="_ _3"></span>,<span class="_"> </span>but<span class="_ _13"> </span><span class="ff6">valE<span class="_ _10"> </span></span>is<span class="_ _13"> </span>written<span class="_"> </span>to<span class="_ _13"> </span>register<span class="_ _13"> </span><span class="ff6">rB<span class="_ _10"> </span></span>in<span class="_ _13"> </span>the<span class="_ _13"> </span>write-back<span class="_"> </span>stage<span class="_ _1"></span>,<span class="_"> </span>and</div><div class="t m5 x1d h26 y405 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>PC<span class="_"> </span>is<span class="_"> </span>set<span class="_"> </span>to<span class="_"> </span><span class="ff6">valP<span class="_ _10"> </span></span>to<span class="_"> </span>complete<span class="_"> </span>the<span class="_"> </span>instruction<span class="_"> </span>execution.</div><div class="t m5 x29 h26 y406 ff7 fs19 fc1 sc0 ls0 ws0">Executing<span class="_ _13"> </span>an<span class="_ _13"> </span><span class="ffd">rrmovq<span class="_ _13"> </span></span>instruction<span class="_"> </span>proceeds<span class="_ _13"> </span>much<span class="_ _13"> </span>like<span class="_ _13"> </span>an<span class="_ _13"> </span>arithmetic<span class="_ _13"> </span>operation.</div><div class="t m5 x1d h26 y407 ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _13"> </span>do<span class="_ _13"> </span>not<span class="_ _13"> </span>need<span class="_"> </span>to<span class="_ _13"> </span>fetch<span class="_ _13"> </span>the<span class="_ _13"> </span>second<span class="_ _13"> </span>register<span class="_ _13"> </span>operand,<span class="_ _13"> </span>however.<span class="_ _13"> </span>Instead,<span class="_ _13"> </span>we<span class="_ _13"> </span>set<span class="_ _13"> </span>the</div><div class="t m5 x1d h46 y408 ff7 fs19 fc1 sc0 ls0 ws0">second<span class="_ _16"> </span>ALU<span class="_ _16"> </span>input<span class="_ _16"> </span>to<span class="_ _16"> </span>zero<span class="_ _16"> </span>and<span class="_ _16"> </span>add<span class="_ _14"> </span>this<span class="_ _16"> </span>to<span class="_ _16"> </span>the<span class="_ _16"> </span>ﬁrst,<span class="_ _14"> </span>giving<span class="_ _16"> </span><span class="ff6">valE<span class="_ _10"> </span><span class="ff12">=<span class="_ _13"> </span></span>valA<span class="_ _2"></span></span>,<span class="_ _14"> </span>which<span class="_ _16"> </span>is</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
