<div id="pf352" class="pf w2 h11" data-page-no="352"><div class="pc pc352 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg352.png"/><div class="t m5 x6b h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>9.6<span class="_ _60"> </span>Address<span class="_ _10"> </span>T<span class="_ _1"></span>ranslation<span class="_ _3e"> </span><span class="ffe fs1e">849</span></div><div class="t m5 x17 h2f ye7 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>9.10</div><div class="t m5 x17 h2f y58a ffe fs16 fc1 sc0 ls0 ws0">Using<span class="_ _14"> </span>VM<span class="_ _16"> </span>to<span class="_ _14"> </span>provide</div><div class="t m5 x17 h2f y58b ffe fs16 fc1 sc0 ls0 ws0">page-level<span class="_ _15"> </span>memory</div><div class="t m5 x17 h2f y58c ffe fs16 fc1 sc0 ls0 ws0">protection.</div><div class="t m5 x217 h84 y6da7 ffab fs49 fc1 sc0 ls0 ws0">Physical memory</div><div class="t m5 x284 h84 y6da8 ffab fs49 fc1 sc0 ls0 ws0">PP 0</div><div class="t m5 x284 h84 y6da9 ffab fs49 fc1 sc0 ls0 ws0">PP 2</div><div class="t m5 x284 h84 y6daa ffab fs49 fc1 sc0 ls0 ws0">PP 4</div><div class="t m5 x284 h84 y6dab ffab fs49 fc1 sc0 ls0 ws0">PP 6</div><div class="t m5 x284 h84 y6dac ffab fs49 fc1 sc0 ls0 ws0">PP 9</div><div class="t m5 x284 h84 y6dad ffab fs49 fc1 sc0 ls0 ws0">PP 1<span class="_ _3"></span>1</div><div class="t m5 xb3 h84 y6dae ffab fs49 fc1 sc0 ls0 ws0">Process <span class="ffac">i<span class="_ _2"></span></span>:</div><div class="t m5 xb3 h84 y6daf ffab fs49 fc1 sc0 ls0 ws0">Process <span class="ffac">j<span class="_ _2"></span></span>:</div><div class="t m5 xd4 h84 y6db0 ffab fs49 fc1 sc0 ls0 ws0">Page tables with permission bits</div><div class="t m5 x16 h84 y6db1 ffab fs49 fc1 sc0 ls0 ws0">SUP<span class="_ _14"> </span>READ<span class="_ _13"> </span>WRITE<span class="_ _60"> </span>Address</div><div class="t m5 x143 h84 y6db2 ffab fs49 fc1 sc0 ls0 ws0">VP 0:</div><div class="t m5 x143 h84 y6db3 ffab fs49 fc1 sc0 ls0 ws0">VP 1:</div><div class="t m5 x143 h84 y6db4 ffab fs49 fc1 sc0 ls0 ws0">VP 2:</div><div class="t m5 x180 h84 y6db5 ffab fs49 fc1 sc0 ls0 ws0">No</div><div class="t m5 x180 h84 y6db6 ffab fs49 fc1 sc0 ls0 ws0">No</div><div class="t m5 x198 h84 y6db7 ffab fs49 fc1 sc0 ls295 ws0">Ye<span class="_ _5"></span>s</div><div class="t m5 x23b h84 y6db5 ffab fs49 fc1 sc0 ls295 ws0">Ye<span class="_ _5"></span>s</div><div class="t m5 x23b h84 y6db6 ffab fs49 fc1 sc0 ls295 ws0">Ye<span class="_ _5"></span>s</div><div class="t m5 x23b h84 y6db7 ffab fs49 fc1 sc0 ls295 ws0">Ye<span class="_ _5"></span>s</div><div class="t m5 x12d h84 y6db5 ffab fs49 fc1 sc0 ls0 ws0">No</div><div class="t m5 x13a h84 y6db6 ffab fs49 fc1 sc0 ls295 ws0">Ye<span class="_ _5"></span>s</div><div class="t m5 x13a h84 y6db7 ffab fs49 fc1 sc0 ls295 ws0">Ye<span class="_ _5"></span>s</div><div class="t m5 x12f h84 y6db5 ffab fs49 fc1 sc0 ls0 ws0">PP 6</div><div class="t m5 x12f h84 y6db6 ffab fs49 fc1 sc0 ls0 ws0">PP 4</div><div class="t m5 x12f h84 y6db7 ffab fs49 fc1 sc0 ls0 ws0">PP 2</div><div class="t m5 x16 h84 y6db8 ffab fs49 fc1 sc0 ls0 ws0">SUP<span class="_ _14"> </span>READ<span class="_ _13"> </span>WRITE<span class="_ _60"> </span>Address</div><div class="t m5 x143 h84 y6db9 ffab fs49 fc1 sc0 ls0 ws0">VP 0:</div><div class="t m5 x143 h84 y6dba ffab fs49 fc1 sc0 ls0 ws0">VP 1:</div><div class="t m5 x143 h84 y6dbb ffab fs49 fc1 sc0 ls0 ws0">VP 2:</div><div class="t m5 x180 h84 y6dbc ffab fs49 fc1 sc0 ls0 ws0">No</div><div class="t m5 x198 h84 y6dbd ffab fs49 fc1 sc0 ls295 ws0">Ye<span class="_ _5"></span>s</div><div class="t m5 x180 h84 y6dbe ffab fs49 fc1 sc0 ls0 ws0">No</div><div class="t m5 x23b h84 y6dbc ffab fs49 fc1 sc0 ls295 ws0">Ye<span class="_ _5"></span>s</div><div class="t m5 x23b h84 y6dbd ffab fs49 fc1 sc0 ls295 ws0">Ye<span class="_ _5"></span>s</div><div class="t m5 x23b h84 y6dbe ffab fs49 fc1 sc0 ls295 ws0">Ye<span class="_ _5"></span>s</div><div class="t m5 x12d h84 y6dbc ffab fs49 fc1 sc0 ls0 ws0">No</div><div class="t m5 x13a h84 y6dbd ffab fs49 fc1 sc0 ls295 ws0">Ye<span class="_ _5"></span>s</div><div class="t m5 x13a h84 y6dbe ffab fs49 fc1 sc0 ls295 ws0">Ye<span class="_ _5"></span>s</div><div class="t m5 x12f h84 y6dbc ffab fs49 fc1 sc0 ls0 ws0">PP 9</div><div class="t m5 x12f h84 y6dbd ffab fs49 fc1 sc0 ls0 ws0">PP 6</div><div class="t m5 xda h84 y6dbe ffab fs49 fc1 sc0 ls0 ws0">PP 1<span class="_ _3"></span>1</div><div class="t m8 x24f h84 y6dbf ffab fs49 fc1 sc0 ls0 ws0">. . .<span class="_ _a7"> </span>. . .</div><div class="t m8 x210 h84 y6dc0 ffab fs49 fc1 sc0 ls0 ws0">. . .</div><div class="t m5 x17 h26 y6dc1 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_"> </span>modify<span class="_ _11"> </span>its<span class="_ _11"> </span>read-only<span class="_ _11"> </span>code<span class="_ _11"> </span>section.<span class="_ _11"> </span>Nor<span class="_ _11"> </span>should<span class="_ _11"> </span>it<span class="_"> </span>be<span class="_ _11"> </span>allowed<span class="_ _11"> </span>to<span class="_ _11"> </span>read<span class="_ _11"> </span>or<span class="_ _11"> </span>modify</div><div class="t m5 x17 h26 y6dc2 ff7 fs19 fc1 sc0 ls0 ws0">any<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>code<span class="_"> </span>and<span class="_ _13"> </span>data<span class="_"> </span>structures<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_"> </span>kernel.<span class="_ _13"> </span>It<span class="_"> </span>should<span class="_ _13"> </span>not<span class="_ _13"> </span>be<span class="_"> </span>allowed<span class="_ _13"> </span>to<span class="_"> </span>read</div><div class="t m5 x17 h26 y6dc3 ff7 fs19 fc1 sc0 ls0 ws0">or<span class="_ _11"> </span>write<span class="_ _16"> </span>the<span class="_ _11"> </span>private<span class="_ _16"> </span>memory<span class="_ _11"> </span>of<span class="_ _16"> </span>other<span class="_ _11"> </span>processes<span class="_ _1"></span>,<span class="_ _16"> </span>and<span class="_ _16"> </span>it<span class="_ _11"> </span>should<span class="_ _16"> </span>not<span class="_ _11"> </span>be<span class="_ _16"> </span>allowed<span class="_ _11"> </span>to</div><div class="t m5 x17 h26 y6dc4 ff7 fs19 fc1 sc0 ls0 ws0">modify<span class="_ _16"> </span>any<span class="_ _11"> </span>virtual<span class="_ _16"> </span>pages<span class="_ _16"> </span>that<span class="_ _16"> </span>are<span class="_ _16"> </span>shared<span class="_ _16"> </span>with<span class="_ _11"> </span>other<span class="_ _16"> </span>processes<span class="_ _1"></span>,<span class="_ _16"> </span>unless<span class="_ _16"> </span>all<span class="_ _16"> </span>parties</div><div class="t m5 x17 h26 y6dc5 ff7 fs19 fc1 sc0 ls0 ws0">explicitly<span class="_"> </span>allow<span class="_"> </span>it<span class="_"> </span>(via<span class="_"> </span>calls<span class="_"> </span>to<span class="_"> </span>explicit<span class="_"> </span>interprocess<span class="_"> </span>communication<span class="_"> </span>system<span class="_"> </span>calls).</div><div class="t m5 x26 h26 y6dc6 ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_ _11"> </span>we<span class="_ _11"> </span>have<span class="_ _11"> </span>seen,<span class="_ _16"> </span>providing<span class="_ _11"> </span>separate<span class="_ _11"> </span>virtual<span class="_ _11"> </span>address<span class="_ _11"> </span>spaces<span class="_ _16"> </span>makes<span class="_"> </span>it<span class="_ _16"> </span>easy<span class="_"> </span>to</div><div class="t m5 x17 h26 y6dc7 ff7 fs19 fc1 sc0 ls0 ws0">isolate<span class="_ _16"> </span>the<span class="_ _14"> </span>private<span class="_ _16"> </span>memories<span class="_ _14"> </span>of<span class="_ _16"> </span>different<span class="_ _14"> </span>processes<span class="_ _1"></span>.<span class="_ _14"> </span>But<span class="_ _16"> </span>the<span class="_ _14"> </span>address<span class="_ _16"> </span>translation</div><div class="t m5 x17 h26 y6dc8 ff7 fs19 fc1 sc0 ls0 ws0">mechanism<span class="_ _13"> </span>can<span class="_"> </span>be<span class="_ _13"> </span>extended<span class="_"> </span>in<span class="_ _13"> </span>a<span class="_"> </span>natural<span class="_ _13"> </span>way<span class="_ _13"> </span>to<span class="_"> </span>provide<span class="_ _13"> </span>even<span class="_"> </span>ﬁner<span class="_ _13"> </span>access<span class="_ _13"> </span>control.</div><div class="t m5 x17 h26 y6dc9 ff7 fs19 fc1 sc0 ls0 ws0">Since<span class="_ _13"> </span>the<span class="_ _13"> </span>address<span class="_"> </span>translation<span class="_ _13"> </span>hardware<span class="_ _13"> </span>reads<span class="_ _13"> </span>a<span class="_ _13"> </span>PTE<span class="_"> </span>each<span class="_ _13"> </span>time<span class="_ _13"> </span>the<span class="_ _13"> </span>CPU<span class="_ _13"> </span>generates</div><div class="t m5 x17 h26 y6dca ff7 fs19 fc1 sc0 ls0 ws0">an<span class="_"> </span>address<span class="_ _3"></span>,<span class="_"> </span>it<span class="_"> </span>is<span class="_"> </span>straightforward<span class="_"> </span>to<span class="_"> </span>control<span class="_ _13"> </span>access<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>contents<span class="_"> </span>of<span class="_"> </span>a<span class="_ _13"> </span>virtual<span class="_"> </span>page</div><div class="t m5 x17 h26 y6dcb ff7 fs19 fc1 sc0 ls0 ws0">by<span class="_ _15"> </span>adding<span class="_ _21"> </span>some<span class="_ _21"> </span>additional<span class="_ _21"> </span>permission<span class="_ _21"> </span>bits<span class="_ _21"> </span>to<span class="_ _21"> </span>the<span class="_ _21"> </span>PTE.<span class="_ _21"> </span>F<span class="_ _0"></span>igure<span class="_ _15"> </span>9.10<span class="_ _21"> </span>shows<span class="_ _21"> </span>the</div><div class="t m5 x17 h26 y6dcc ff7 fs19 fc1 sc0 ls0 ws0">general<span class="_"> </span>idea.</div><div class="t m5 x26 h26 y6dcd ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _6"> </span>this<span class="_ _6"> </span>example<span class="_ _1"></span>,<span class="_ _13"> </span>we<span class="_ _a"> </span>have<span class="_ _6"> </span>added<span class="_ _6"> </span>three<span class="_ _6"> </span>permission<span class="_ _6"> </span>bits<span class="_ _6"> </span>to<span class="_ _6"> </span>each<span class="_ _6"> </span>PTE.<span class="_ _6"> </span>T<span class="_ _0"></span>he<span class="_ _6"> </span>SUP<span class="_ _a"> </span>bit</div><div class="t m5 x17 h26 y6dce ff7 fs19 fc1 sc0 ls0 ws0">indicates<span class="_ _6"> </span>whether<span class="_ _13"> </span>processes<span class="_ _6"> </span>must<span class="_ _6"> </span>be<span class="_ _13"> </span>running<span class="_ _6"> </span>in<span class="_ _6"> </span>kernel<span class="_ _13"> </span>(supervisor)<span class="_ _6"> </span>mode<span class="_ _6"> </span>to<span class="_ _13"> </span>access</div><div class="t m5 x17 h26 y6dcf ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _16"> </span>page.<span class="_ _16"> </span>Processes<span class="_ _16"> </span>running<span class="_ _16"> </span>in<span class="_ _14"> </span>kernel<span class="_ _16"> </span>mode<span class="_ _14"> </span>can<span class="_ _16"> </span>access<span class="_ _14"> </span>any<span class="_ _16"> </span>page,<span class="_ _16"> </span>but<span class="_ _14"> </span>processes</div><div class="t m5 x17 h26 y6dd0 ff7 fs19 fc1 sc0 ls0 ws0">running<span class="_ _16"> </span>in<span class="_ _16"> </span>user<span class="_ _16"> </span>mode<span class="_ _16"> </span>are<span class="_ _16"> </span>only<span class="_ _16"> </span>allowed<span class="_ _11"> </span>to<span class="_ _16"> </span>access<span class="_ _16"> </span>pages<span class="_ _16"> </span>for<span class="_ _16"> </span>which<span class="_ _16"> </span>SUP<span class="_ _16"> </span>is<span class="_ _16"> </span>0.<span class="_ _16"> </span>T<span class="_ _0"></span>he</div><div class="t m5 x17 h26 y6dd1 ff7 fs19 fc1 sc0 ls0 ws0">READ<span class="_"> </span>and<span class="_ _11"> </span>WRITE<span class="_"> </span>bits<span class="_ _11"> </span>control<span class="_"> </span>read<span class="_ _11"> </span>and<span class="_"> </span>write<span class="_"> </span>access<span class="_ _11"> </span>to<span class="_"> </span>the<span class="_ _11"> </span>page<span class="_ _0"></span>.<span class="_"> </span>F<span class="_ _1"></span>or<span class="_ _11"> </span>example<span class="_ _0"></span>,</div><div class="t m5 x17 h26 y6dd2 ff7 fs19 fc1 sc0 ls0 ws0">if<span class="_ _16"> </span>process<span class="_ _16"> </span><span class="ff11">i<span class="_"> </span></span>is<span class="_ _16"> </span>running<span class="_ _16"> </span>in<span class="_ _16"> </span>user<span class="_ _16"> </span>mode<span class="_ _1"></span>,<span class="_ _14"> </span>then<span class="_ _16"> </span>it<span class="_ _16"> </span>has<span class="_ _11"> </span>permission<span class="_ _16"> </span>to<span class="_ _16"> </span>read<span class="_ _16"> </span>VP<span class="_ _16"> </span>0<span class="_ _16"> </span>and<span class="_ _11"> </span>to</div><div class="t m5 x17 h26 y6dd3 ff7 fs19 fc1 sc0 ls0 ws0">read<span class="_"> </span>or<span class="_"> </span>write<span class="_"> </span>VP<span class="_"> </span>1.<span class="_"> </span>However,<span class="_"> </span>it<span class="_"> </span>is<span class="_"> </span>not<span class="_"> </span>allowed<span class="_"> </span>to<span class="_"> </span>access<span class="_"> </span>VP<span class="_"> </span>2.</div><div class="t m5 x26 h26 y6dd4 ff7 fs19 fc1 sc0 ls0 ws0">If<span class="_ _11"> </span>an<span class="_ _11"> </span>instruction<span class="_ _11"> </span>violates<span class="_ _16"> </span>these<span class="_ _11"> </span>permissions<span class="_ _1"></span>,<span class="_ _11"> </span>then<span class="_ _16"> </span>the<span class="_"> </span>CPU<span class="_ _16"> </span>triggers<span class="_ _11"> </span>a<span class="_ _11"> </span>general</div><div class="t m5 x17 h26 y6dd5 ff7 fs19 fc1 sc0 ls0 ws0">protection<span class="_ _13"> </span>fault<span class="_ _13"> </span>that<span class="_ _13"> </span>transfers<span class="_ _13"> </span>control<span class="_ _13"> </span>to<span class="_ _13"> </span>an<span class="_ _13"> </span>exception<span class="_ _13"> </span>handler<span class="_ _6"> </span>in<span class="_ _13"> </span>the<span class="_ _13"> </span>kernel,<span class="_ _13"> </span>which</div><div class="t m5 x17 h26 y6dd6 ff7 fs19 fc1 sc0 ls0 ws0">sends<span class="_ _6"> </span>a<span class="_ _13"> </span>SIGSEGV<span class="_ _a"> </span>signal<span class="_ _13"> </span>to<span class="_ _6"> </span>the<span class="_ _6"> </span>offending<span class="_ _13"> </span>process<span class="_ _3"></span>.<span class="_ _13"> </span>Linux<span class="_ _a"> </span>shells<span class="_ _13"> </span>typically<span class="_ _a"> </span>report<span class="_ _13"> </span>this</div><div class="t m5 x17 h26 y6dd7 ff7 fs19 fc1 sc0 ls0 ws0">exception<span class="_"> </span>as<span class="_"> </span>a<span class="_"> </span>“segmentation<span class="_"> </span>fault.<span class="_ _1"></span>”</div><div class="t m5 x17 h3b y23d9 fff fs24 fc6 sc0 ls0 ws0">9.6<span class="_ _17"> </span><span class="ffe fs18">Address<span class="_"> </span>T<span class="_ _1"></span>ranslation</span></div><div class="t m5 x17 h26 y832 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _14"> </span>section<span class="_ _14"> </span>covers<span class="_ _16"> </span>the<span class="_ _14"> </span>basics<span class="_ _14"> </span>of<span class="_ _16"> </span>address<span class="_ _14"> </span>translation.<span class="_ _14"> </span>Our<span class="_ _16"> </span>aim<span class="_ _14"> </span>is<span class="_ _14"> </span>to<span class="_ _16"> </span>give<span class="_ _14"> </span>you<span class="_ _14"> </span>an</div><div class="t m5 x17 h26 y833 ff7 fs19 fc1 sc0 ls0 ws0">appreciation<span class="_ _16"> </span>of<span class="_ _14"> </span>the<span class="_ _14"> </span>hardware’s<span class="_ _16"> </span>role<span class="_ _16"> </span>in<span class="_ _14"> </span>supporting<span class="_ _14"> </span>virtual<span class="_ _16"> </span>memory<span class="_ _3"></span>,<span class="_ _15"> </span>with<span class="_ _16"> </span>enough</div><div class="t m5 x17 h26 y834 ff7 fs19 fc1 sc0 ls0 ws0">detail<span class="_"> </span>so<span class="_"> </span>that<span class="_ _11"> </span>you<span class="_"> </span>can<span class="_ _11"> </span>work<span class="_"> </span>through<span class="_ _11"> </span>some<span class="_"> </span>concrete<span class="_ _11"> </span>examples<span class="_"> </span>by<span class="_ _11"> </span>hand.<span class="_"> </span>However,</div><div class="t m5 x17 h26 y835 ff7 fs19 fc1 sc0 ls0 ws0">keep<span class="_ _13"> </span>in<span class="_ _13"> </span>mind<span class="_ _6"> </span>that<span class="_ _13"> </span>we<span class="_ _13"> </span>are<span class="_ _13"> </span>omitting<span class="_ _6"> </span>a<span class="_ _13"> </span>number<span class="_ _13"> </span>of<span class="_ _13"> </span>details<span class="_ _3"></span>,<span class="_ _13"> </span>especially<span class="_ _13"> </span>related<span class="_ _13"> </span>to<span class="_ _6"> </span>timing,</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
