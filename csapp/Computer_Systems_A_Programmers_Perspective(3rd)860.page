<div id="pf35c" class="pf w2 h11" data-page-no="35c"><div class="pc pc35c w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg35c.png"/><div class="t m5 x6b h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>9.6<span class="_ _60"> </span>Address<span class="_ _10"> </span>T<span class="_ _1"></span>ranslation<span class="_ _3e"> </span><span class="ffe fs1e">859</span></div><div class="t m5 x72 h26 ye7 ffa fs19 fc2 sc0 ls0 ws0">TLB<span class="ff7">.<span class="_ _e"> </span>T<span class="_ _0"></span>he<span class="_"> </span>TLB<span class="_ _13"> </span>is<span class="_"> </span>virtually<span class="_ _13"> </span>addressed<span class="_"> </span>using<span class="_ _13"> </span>the<span class="_"> </span>bits<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>VPN<span class="_ _3"></span>.<span class="_"> </span>Since<span class="_ _13"> </span>the<span class="_"> </span>TLB</span></div><div class="t m5 x30 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">has<span class="_ _6"> </span>four<span class="_ _6"> </span>sets<span class="_ _1"></span>,<span class="_ _13"> </span>the<span class="_ _a"> </span>2<span class="_ _6"> </span>low-order<span class="_ _6"> </span>bits<span class="_ _6"> </span>of<span class="_ _6"> </span>the<span class="_ _6"> </span>VPN<span class="_ _6"> </span>serve<span class="_ _6"> </span>as<span class="_ _6"> </span>the<span class="_ _6"> </span>set<span class="_ _6"> </span>index<span class="_ _6"> </span>(TLBI).</div><div class="t m5 x30 h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _13"> </span>remaining<span class="_ _a"> </span>6<span class="_ _13"> </span>high-order<span class="_ _a"> </span>bits<span class="_ _13"> </span>serve<span class="_ _6"> </span>as<span class="_ _6"> </span>the<span class="_ _6"> </span>tag<span class="_ _13"> </span>(TLBT)<span class="_ _6"> </span>that<span class="_ _6"> </span>distinguishes</div><div class="t m5 x30 h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>different<span class="_"> </span>VPNs<span class="_"> </span>that<span class="_"> </span>might<span class="_"> </span>map<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>same<span class="_"> </span>TLB<span class="_"> </span>set.</div><div class="t m5 x72 h26 y6f8a ffa fs19 fc2 sc0 ls0 ws0">P<span class="_ _1"></span>age<span class="_"> </span>table<span class="ff7">.<span class="_ _1f"> </span>T<span class="_ _1"></span>he<span class="_"> </span>page<span class="_"> </span>table<span class="_"> </span>is<span class="_"> </span>a<span class="_"> </span>single-level<span class="_"> </span>design<span class="_"> </span>with<span class="_"> </span>a<span class="_"> </span>total<span class="_"> </span>of<span class="_"> </span>2</span></div><div class="t m5 x100 h3c y6f8b ff7 fs25 fc2 sc0 ls0 ws0">8</div><div class="t m5 x98 h46 y6f8c ff12 fs19 fc2 sc0 ls0 ws0">=<span class="_ _13"> </span><span class="ff7">256<span class="_"> </span>page</span></div><div class="t m5 x30 h26 y6f8d ff7 fs19 fc2 sc0 ls0 ws0">table<span class="_ _16"> </span>entries<span class="_ _16"> </span>(PTEs).<span class="_ _16"> </span>However,<span class="_ _16"> </span>we<span class="_ _16"> </span>are<span class="_ _16"> </span>only<span class="_ _16"> </span>interested<span class="_ _16"> </span>in<span class="_ _16"> </span>the<span class="_ _16"> </span>ﬁrst<span class="_ _16"> </span>16<span class="_ _16"> </span>of</div><div class="t m5 x30 h26 y6f8e ff7 fs19 fc2 sc0 ls0 ws0">these<span class="_ _1"></span>.<span class="_ _15"> </span>F<span class="_ _1"></span>or<span class="_ _14"> </span>convenience,<span class="_ _15"> </span>we<span class="_ _14"> </span>have<span class="_ _15"> </span>labeled<span class="_ _14"> </span>each<span class="_ _15"> </span>PTE<span class="_ _14"> </span>with<span class="_ _15"> </span>the<span class="_ _14"> </span>VPN<span class="_ _15"> </span>that</div><div class="t m5 x30 h26 y6f8f ff7 fs19 fc2 sc0 ls0 ws0">indexes<span class="_ _14"> </span>it;<span class="_ _21"> </span>but<span class="_ _14"> </span>keep<span class="_ _14"> </span>in<span class="_ _14"> </span>mind<span class="_ _14"> </span>that<span class="_ _15"> </span>these<span class="_ _14"> </span>VPNs<span class="_ _14"> </span>are<span class="_ _14"> </span>not<span class="_ _14"> </span>part<span class="_ _14"> </span>of<span class="_ _15"> </span>the<span class="_ _14"> </span>page</div><div class="t m5 x30 h26 y6f90 ff7 fs19 fc2 sc0 ls0 ws0">table<span class="_ _13"> </span>and<span class="_ _13"> </span>not<span class="_"> </span>stored<span class="_ _13"> </span>in<span class="_ _13"> </span>memory<span class="_ _3"></span>.<span class="_ _13"> </span>Also,<span class="_ _13"> </span>notice<span class="_ _13"> </span>that<span class="_ _13"> </span>the<span class="_"> </span>PPN<span class="_ _13"> </span>of<span class="_ _13"> </span>each<span class="_ _13"> </span>invalid</div><div class="t m5 x30 h26 y6f91 ff7 fs19 fc2 sc0 ls0 ws0">PTE<span class="_ _13"> </span>is<span class="_"> </span>denoted<span class="_ _13"> </span>with<span class="_"> </span>a<span class="_ _13"> </span>dash<span class="_"> </span>to<span class="_ _13"> </span>reinforce<span class="_"> </span>the<span class="_ _13"> </span>idea<span class="_"> </span>that<span class="_ _13"> </span>whatever<span class="_"> </span>bit<span class="_ _13"> </span>values</div><div class="t m5 x30 h26 y6f92 ff7 fs19 fc2 sc0 ls0 ws0">might<span class="_"> </span>happen<span class="_"> </span>to<span class="_"> </span>be<span class="_"> </span>stored<span class="_"> </span>there<span class="_"> </span>are<span class="_"> </span>not<span class="_"> </span>meaningful.</div><div class="t m5 x72 h26 y6f93 ffa fs19 fc2 sc0 ls0 ws0">Cache<span class="ff7">.<span class="_ _e"> </span>The<span class="_ _f"> </span>direct-mapped<span class="_ _f"> </span>cache<span class="_ _e"> </span>is<span class="_ _f"> </span>addressed<span class="_ _e"> </span>by<span class="_ _f"> </span>the<span class="_ _e"> </span>ﬁelds<span class="_ _f"> </span>in<span class="_ _e"> </span>the<span class="_ _f"> </span>physical</span></div><div class="t m5 x30 h26 y6f94 ff7 fs19 fc2 sc0 ls0 ws0">address<span class="_ _1"></span>.<span class="_ _11"> </span>Since<span class="_ _16"> </span>each<span class="_ _11"> </span>block<span class="_ _16"> </span>is<span class="_ _11"> </span>4<span class="_ _16"> </span>bytes<span class="_ _1"></span>,<span class="_ _16"> </span>the<span class="_ _11"> </span>low-order<span class="_ _16"> </span>2<span class="_ _11"> </span>bits<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>physical</div><div class="t m5 x30 h26 y6f95 ff7 fs19 fc2 sc0 ls0 ws0">address<span class="_"> </span>serve<span class="_"> </span>as<span class="_ _13"> </span>the<span class="_"> </span>block<span class="_"> </span>offset<span class="_"> </span>(CO).<span class="_"> </span>Since<span class="_ _13"> </span>there<span class="_"> </span>are<span class="_"> </span>16<span class="_"> </span>sets<span class="_ _3"></span>,<span class="_"> </span>the<span class="_"> </span>next<span class="_"> </span>4</div><div class="t m5 x30 h26 y6f96 ff7 fs19 fc2 sc0 ls0 ws0">bits<span class="_ _13"> </span>serve<span class="_ _13"> </span>as<span class="_ _13"> </span>the<span class="_ _6"> </span>set<span class="_ _13"> </span>index<span class="_ _13"> </span>(CI).<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span>remaining<span class="_ _13"> </span>6<span class="_ _13"> </span>bits<span class="_ _13"> </span>serve<span class="_ _13"> </span>as<span class="_ _13"> </span>the<span class="_ _6"> </span>tag<span class="_ _13"> </span>(CT).</div><div class="t m5 x26 h26 y6f97 ff7 fs19 fc2 sc0 ls0 ws0">Given<span class="_ _13"> </span>this<span class="_"> </span>initial<span class="_ _13"> </span>setup<span class="_ _1"></span>,<span class="_"> </span>let’s<span class="_ _13"> </span>see<span class="_ _13"> </span>what<span class="_"> </span>happens<span class="_ _13"> </span>when<span class="_"> </span>the<span class="_ _13"> </span>CPU<span class="_ _13"> </span>executes<span class="_"> </span>a<span class="_ _13"> </span>load</div><div class="t m5 x17 h26 y6f98 ff7 fs19 fc2 sc0 ls0 ws0">instruction<span class="_ _16"> </span>that<span class="_ _16"> </span>reads<span class="_ _16"> </span>the<span class="_ _16"> </span>byte<span class="_ _16"> </span>at<span class="_ _16"> </span>address<span class="_ _14"> </span><span class="ffd">0x03d4</span>.<span class="_ _16"> </span>(Recall<span class="_ _16"> </span>that<span class="_ _16"> </span>our<span class="_ _16"> </span>hypothetical</div><div class="t m5 x17 h26 y6f99 ff7 fs19 fc2 sc0 ls0 ws0">CPU<span class="_"> </span>reads<span class="_"> </span>1-byte<span class="_"> </span>words<span class="_"> </span>rather<span class="_"> </span>than<span class="_ _11"> </span>4-byte<span class="_"> </span>words<span class="_ _1"></span>.)<span class="_"> </span>T<span class="_ _3"></span>o<span class="_"> </span>begin<span class="_"> </span>this<span class="_"> </span>kind<span class="_"> </span>of<span class="_"> </span>manual</div><div class="t m5 x17 h26 y6f9a ff7 fs19 fc2 sc0 ls0 ws0">simulation,<span class="_"> </span>we<span class="_ _13"> </span>ﬁnd<span class="_ _13"> </span>it<span class="_"> </span>helpful<span class="_ _13"> </span>to<span class="_"> </span>write<span class="_ _13"> </span>down<span class="_"> </span>the<span class="_ _13"> </span>bits<span class="_"> </span>in<span class="_ _13"> </span>the<span class="_ _13"> </span>virtual<span class="_"> </span>address<span class="_ _3"></span>,<span class="_"> </span>identify</div><div class="t m5 x17 h26 y6f9b ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _14"> </span>various<span class="_ _15"> </span>ﬁelds<span class="_ _15"> </span>we<span class="_ _15"> </span>will<span class="_ _15"> </span>need,<span class="_ _15"> </span>and<span class="_ _15"> </span>determine<span class="_ _15"> </span>their<span class="_ _15"> </span>hex<span class="_ _14"> </span>values<span class="_ _0"></span>.<span class="_ _14"> </span>The<span class="_ _14"> </span>hardware</div><div class="t m5 x17 h26 y6f9c ff7 fs19 fc2 sc0 ls0 ws0">performs<span class="_"> </span>a<span class="_"> </span>similar<span class="_"> </span>task<span class="_"> </span>when<span class="_"> </span>it<span class="_"> </span>decodes<span class="_"> </span>the<span class="_"> </span>address<span class="_ _1"></span>.</div><div class="t m5 x64 h3f y6f9d ffb4 fs27 fc1 sc0 ls56 ws0">11<span class="_ _21a"></span><span class="ls0">Bit position</span></div><div class="t m5 x52 h3f y6f9e ffb4 fs27 fc1 sc0 ls0 ws0">V<span class="_ _1"></span>A<span class="_ _1"></span> = <span class="ffb5">0x03d4</span></div><div class="t m5 x129 h3f y6f9d ffb4 fs27 fc1 sc0 ls0 ws0">10<span class="_ _d"> </span>9<span class="_ _b3"> </span>8</div><div class="t m5 x21f h70 y6f9f ffb5 fs27 fc1 sc0 ls0 ws0">0x03<span class="_ _bb"> </span>0x03</div><div class="t m5 x13b h3f y6f9d ffb4 fs27 fc1 sc0 ls2a5 ws0">76543210</div><div class="t m5 x1fa h3f y6f9e ffb4 fs27 fc1 sc0 ls0 ws0">0<span class="_ _1cc"></span>0<span class="_ _1cc"></span>1<span class="_ _1cc"></span>0<span class="_ _167"></span>1<span class="_ _1cc"></span>0<span class="_ _1cc"></span>1<span class="_ _1cc"></span>1<span class="_ _1cc"></span>1<span class="_ _1cc"></span>1<span class="_ _1cc"></span>0<span class="_ _1cc"></span>0</div><div class="t m5 x178 h3f y6f9d ffb4 fs27 fc1 sc0 ls0 ws0">12</div><div class="t m5 xce h3f y6f9e ffb4 fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 xa2 h3f y6f9d ffb4 fs27 fc1 sc0 ls0 ws0">13</div><div class="t m5 x17d h3f y6f9e ffb4 fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 x218 h70 y6fa0 ffb5 fs27 fc1 sc0 ls0 ws0">0x0f<span class="_ _129"> </span>0x14</div><div class="t m5 x65 h3f y6fa1 ffb4 fs27 fc1 sc0 ls0 ws0">TLBT<span class="_ _31"> </span>TLBI</div><div class="t m5 x1a h3f y6fa2 ffb4 fs27 fc1 sc0 ls0 ws0">VPN<span class="_ _129"> </span>VPO</div><div class="t m5 x26 h26 y6fe ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_ _14"> </span>begin,<span class="_ _15"> </span>the<span class="_ _16"> </span>MMU<span class="_ _14"> </span>extracts<span class="_ _14"> </span>the<span class="_ _14"> </span>VPN<span class="_ _16"> </span>(<span class="ffd">0x0F</span>)<span class="_ _14"> </span>from<span class="_ _14"> </span>the<span class="_ _14"> </span>virtual<span class="_ _14"> </span>address<span class="_ _16"> </span>and</div><div class="t m5 x17 h26 y6ff ff7 fs19 fc2 sc0 ls0 ws0">checks<span class="_ _6"> </span>with<span class="_ _13"> </span>the<span class="_ _6"> </span>TLB<span class="_ _13"> </span>to<span class="_ _6"> </span>see<span class="_ _13"> </span>if<span class="_ _6"> </span>it<span class="_ _13"> </span>has<span class="_ _6"> </span>cached<span class="_ _13"> </span>a<span class="_ _6"> </span>copy<span class="_ _13"> </span>of<span class="_ _6"> </span>PTE<span class="_ _13"> </span><span class="ffd">0x0F<span class="_ _6"> </span></span>from<span class="_ _13"> </span>some<span class="_ _6"> </span>previous</div><div class="t m5 x17 h26 y700 ff7 fs19 fc2 sc0 ls0 ws0">memory<span class="_ _6"> </span>reference.<span class="_ _6"> </span>T<span class="_ _0"></span>he<span class="_ _6"> </span>TLB<span class="_ _13"> </span>extracts<span class="_ _6"> </span>the<span class="_ _13"> </span>TLB<span class="_ _13"> </span>index<span class="_ _6"> </span>(<span class="ffd">0x03</span>)<span class="_ _6"> </span>and<span class="_ _13"> </span>the<span class="_ _6"> </span>TLB<span class="_ _13"> </span>tag<span class="_ _6"> </span>(<span class="ffd">0x3</span>)</div><div class="t m5 x17 h26 y701 ff7 fs19 fc2 sc0 ls0 ws0">from<span class="_ _11"> </span>the<span class="_ _16"> </span>VPN<span class="_ _3"></span>,<span class="_ _16"> </span>hits<span class="_ _16"> </span>on<span class="_ _16"> </span>a<span class="_ _11"> </span>valid<span class="_ _16"> </span>match<span class="_ _16"> </span>in<span class="_ _11"> </span>the<span class="_ _16"> </span>second<span class="_ _16"> </span>entry<span class="_ _11"> </span>of<span class="_ _16"> </span>set<span class="_ _16"> </span><span class="ffd">0x3</span>,<span class="_ _16"> </span>and<span class="_ _11"> </span>returns</div><div class="t m5 x17 h26 y702 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>cached<span class="_"> </span>PPN<span class="_"> </span>(<span class="ffd">0x0D</span>)<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>MMU<span class="_ _3"></span>.</div><div class="t m5 x26 h26 y703 ff7 fs19 fc2 sc0 ls0 ws0">If<span class="_ _6"> </span>the<span class="_ _6"> </span>TLB<span class="_ _13"> </span>had<span class="_ _6"> </span>missed,<span class="_ _13"> </span>then<span class="_ _a"> </span>the<span class="_ _13"> </span>MMU<span class="_ _a"> </span>would<span class="_ _13"> </span>need<span class="_ _6"> </span>to<span class="_ _6"> </span>fetch<span class="_ _6"> </span>the<span class="_ _13"> </span>PTE<span class="_ _6"> </span>from<span class="_ _6"> </span>main</div><div class="t m5 x17 h26 y704 ff7 fs19 fc2 sc0 ls0 ws0">memory<span class="_ _3"></span>.<span class="_"> </span>However,<span class="_"> </span>in<span class="_ _11"> </span>this<span class="_"> </span>case,<span class="_"> </span>we<span class="_"> </span>got<span class="_ _11"> </span>lucky<span class="_"> </span>and<span class="_ _11"> </span>had<span class="_"> </span>a<span class="_ _11"> </span>TLB<span class="_"> </span>hit.<span class="_ _11"> </span>T<span class="_ _0"></span>he<span class="_"> </span>MMU<span class="_ _11"> </span>now</div><div class="t m5 x17 h26 y705 ff7 fs19 fc2 sc0 ls0 ws0">has<span class="_ _13"> </span>everything<span class="_"> </span>it<span class="_ _13"> </span>needs<span class="_"> </span>to<span class="_ _13"> </span>form<span class="_"> </span>the<span class="_ _13"> </span>physical<span class="_ _13"> </span>address<span class="_ _1"></span>.<span class="_"> </span>It<span class="_ _13"> </span>does<span class="_"> </span>this<span class="_ _13"> </span>by<span class="_"> </span>concatenating</div><div class="t m5 x17 h26 y706 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _6"> </span>PPN<span class="_ _6"> </span>(<span class="ffd">0x0D</span>)<span class="_ _13"> </span>from<span class="_ _a"> </span>the<span class="_ _13"> </span>PTE<span class="_ _a"> </span>with<span class="_ _13"> </span>the<span class="_ _a"> </span>VPO<span class="_ _13"> </span>(<span class="ffd">0x14</span>)<span class="_ _6"> </span>from<span class="_ _6"> </span>the<span class="_ _6"> </span>virtual<span class="_ _13"> </span>address<span class="_ _3"></span>,<span class="_ _13"> </span>which</div><div class="t m5 x17 h26 y707 ff7 fs19 fc2 sc0 ls0 ws0">forms<span class="_"> </span>the<span class="_"> </span>physical<span class="_"> </span>address<span class="_"> </span>(<span class="ffd">0x354</span>).</div><div class="t m5 x26 h26 y708 ff7 fs19 fc2 sc0 ls0 ws0">Next,<span class="_ _16"> </span>the<span class="_ _16"> </span>MMU<span class="_ _16"> </span>sends<span class="_ _11"> </span>the<span class="_ _16"> </span>physical<span class="_ _16"> </span>address<span class="_ _16"> </span>to<span class="_ _11"> </span>the<span class="_ _16"> </span>cache<span class="_ _0"></span>,<span class="_ _16"> </span>which<span class="_ _16"> </span>extracts<span class="_ _16"> </span>the</div><div class="t m5 x17 h26 y709 ff7 fs19 fc2 sc0 ls0 ws0">cache<span class="_"> </span>offset<span class="_ _13"> </span>CO<span class="_"> </span>(<span class="ffd">0x0</span>),<span class="_"> </span>the<span class="_"> </span>cache<span class="_ _13"> </span>set<span class="_"> </span>index<span class="_"> </span>CI<span class="_"> </span>(<span class="ffd">0x5</span>),<span class="_ _13"> </span>and<span class="_"> </span>the<span class="_"> </span>cache<span class="_ _13"> </span>tag<span class="_"> </span>CT<span class="_"> </span>(<span class="ffd">0x0D</span>)</div><div class="t m5 x17 h26 y70a ff7 fs19 fc2 sc0 ls0 ws0">from<span class="_"> </span>the<span class="_"> </span>physical<span class="_"> </span>address<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
