<div id="pf22f" class="pf w2 h11" data-page-no="22f"><div class="pc pc22f w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg22f.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">558<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>5<span class="_ _3d"> </span>Optimizing<span class="_ _10"> </span>Program<span class="_ _10"> </span>Performance</span></div><div class="t m5 x28 h2a y257 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">The<span class="_ _11"> </span>history<span class="_ _11"> </span>of<span class="_ _16"> </span>out-of-order<span class="_ _11"> </span>processing</span></div><div class="t m5 x28 h2b y2d0 ff7 fs1e fc2 sc0 ls0 ws0">Out-of-order<span class="_ _14"> </span>processing<span class="_ _14"> </span>was<span class="_ _14"> </span>ﬁrst<span class="_ _14"> </span>implemented<span class="_ _14"> </span>in<span class="_ _14"> </span>the<span class="_ _14"> </span>Control<span class="_ _14"> </span>Data<span class="_ _14"> </span>Corporation<span class="_ _15"> </span>6600<span class="_ _14"> </span>processor<span class="_ _14"> </span>in</div><div class="t m5 x28 h2b y2d1 ff7 fs1e fc2 sc0 ls0 ws0">1964.<span class="_ _16"> </span>Instructions<span class="_ _16"> </span>were<span class="_ _16"> </span>processed<span class="_ _16"> </span>by<span class="_ _16"> </span>10<span class="_ _16"> </span>different<span class="_ _16"> </span>functional<span class="_ _16"> </span>units<span class="_ _1"></span>,<span class="_ _14"> </span>each<span class="_ _16"> </span>of<span class="_ _16"> </span>which<span class="_ _16"> </span>could<span class="_ _16"> </span>be<span class="_ _16"> </span>operated</div><div class="t m5 x28 h2b y2d2 ff7 fs1e fc2 sc0 ls0 ws0">independently<span class="_ _3"></span>.<span class="_ _14"> </span>In<span class="_ _14"> </span>its<span class="_ _15"> </span>day<span class="_ _3"></span>,<span class="_ _15"> </span>this<span class="_ _14"> </span>machine,<span class="_ _14"> </span>with<span class="_ _15"> </span>a<span class="_ _14"> </span>clock<span class="_ _14"> </span>rate<span class="_ _15"> </span>of<span class="_ _14"> </span>10<span class="_ _13"> </span>MHz,<span class="_ _15"> </span>was<span class="_ _14"> </span>considered<span class="_ _15"> </span>the<span class="_ _14"> </span>premium</div><div class="t m5 x28 h2b y2d3 ff7 fs1e fc2 sc0 ls0 ws0">machine<span class="_"> </span>for<span class="_"> </span>scientiﬁc<span class="_"> </span>computing.</div><div class="t m5 x57 h2b y2d4 ff7 fs1e fc2 sc0 ls0 ws0">IBM<span class="_"> </span>ﬁrst<span class="_ _13"> </span>implemented<span class="_"> </span>out-of-order<span class="_ _13"> </span>processing<span class="_"> </span>with<span class="_ _13"> </span>the<span class="_"> </span>IBM<span class="_"> </span>360/91<span class="_ _13"> </span>processor<span class="_"> </span>in<span class="_ _13"> </span>1966,<span class="_"> </span>but<span class="_ _13"> </span>just<span class="_"> </span>to</div><div class="t m5 x28 h2b y2d5 ff7 fs1e fc2 sc0 ls0 ws0">execute<span class="_ _16"> </span>the<span class="_ _11"> </span>ﬂoating-point<span class="_ _16"> </span>instructions<span class="_ _1"></span>.<span class="_ _16"> </span>F<span class="_ _1"></span>or<span class="_ _16"> </span>around<span class="_ _16"> </span>25<span class="_ _11"> </span>years<span class="_ _0"></span>,<span class="_ _16"> </span>out-of-order<span class="_ _16"> </span>processing<span class="_ _16"> </span>was<span class="_ _11"> </span>considered</div><div class="t m5 x28 h2b y2d6 ff7 fs1e fc2 sc0 ls0 ws0">an<span class="_ _21"> </span>exotic<span class="_ _21"> </span>technology<span class="_ _3"></span>,<span class="_ _f"> </span>found<span class="_ _21"> </span>only<span class="_ _21"> </span>in<span class="_ _21"> </span>machines<span class="_ _21"> </span>striving<span class="_ _21"> </span>for<span class="_ _21"> </span>the<span class="_ _f"> </span>highest<span class="_ _21"> </span>possible<span class="_ _21"> </span>performance<span class="_ _0"></span>,<span class="_ _f"> </span>until</div><div class="t m5 x28 h2b y549 ff7 fs1e fc2 sc0 ls0 ws0">IBM<span class="_ _14"> </span>reintroduced<span class="_ _14"> </span>it<span class="_ _14"> </span>in<span class="_ _14"> </span>the<span class="_ _16"> </span>RS/6000<span class="_ _14"> </span>line<span class="_ _14"> </span>of<span class="_ _14"> </span>workstations<span class="_ _14"> </span>in<span class="_ _14"> </span>1990.<span class="_ _14"> </span>This<span class="_ _16"> </span>design<span class="_ _14"> </span>became<span class="_ _14"> </span>the<span class="_ _14"> </span>basis<span class="_ _14"> </span>for</div><div class="t m5 x28 h2b y54a ff7 fs1e fc2 sc0 ls0 ws0">the<span class="_ _11"> </span>IBM/Motorola<span class="_ _16"> </span>P<span class="_ _1"></span>owerPC<span class="_ _16"> </span>line<span class="_ _1"></span>,<span class="_ _16"> </span>with<span class="_ _16"> </span>the<span class="_ _11"> </span>model<span class="_ _16"> </span>601,<span class="_ _11"> </span>introduced<span class="_ _16"> </span>in<span class="_ _11"> </span>1993,<span class="_ _16"> </span>becoming<span class="_ _16"> </span>the<span class="_ _11"> </span>ﬁrst<span class="_ _16"> </span>single-</div><div class="t m5 x28 h2b y54b ff7 fs1e fc2 sc0 ls0 ws0">chip<span class="_ _11"> </span>microprocessor<span class="_ _10"> </span>to<span class="_ _11"> </span>use<span class="_ _11"> </span>out-of-order<span class="_ _11"> </span>processing.<span class="_ _10"> </span>Intel<span class="_ _11"> </span>introduced<span class="_ _11"> </span>out-of-order<span class="_ _11"> </span>processing<span class="_ _11"> </span>with<span class="_ _11"> </span>its</div><div class="t m5 x28 h2b y54c ff7 fs1e fc2 sc0 ls0 ws0">PentiumPro<span class="_ _15"> </span>model<span class="_ _21"> </span>in<span class="_ _15"> </span>1995,<span class="_ _f"> </span>with<span class="_ _21"> </span>an<span class="_ _21"> </span>underlying<span class="_ _15"> </span>microarchitecture<span class="_ _21"> </span>similar<span class="_ _15"> </span>to<span class="_ _21"> </span>that<span class="_ _21"> </span>of<span class="_ _15"> </span>our<span class="_ _21"> </span>reference</div><div class="t m5 x28 h2b y54d ff7 fs1e fc2 sc0 ls0 ws0">machine<span class="_ _1"></span>.</div><div class="t m5 x1d h26 y4c14 ffa fs19 fc2 sc0 ls0 ws0">ﬂushed<span class="ff7">,<span class="_ _e"> </span>discarding<span class="_ _21"> </span>any<span class="_ _f"> </span>results<span class="_ _21"> </span>that<span class="_ _f"> </span>may<span class="_ _21"> </span>have<span class="_ _21"> </span>been<span class="_ _f"> </span>computed.<span class="_ _21"> </span>By<span class="_ _f"> </span>this<span class="_ _21"> </span>means<span class="_ _0"></span>,</span></div><div class="t m5 x1d h26 y4c15 ff7 fs19 fc2 sc0 ls0 ws0">mispredictions<span class="_"> </span>will<span class="_"> </span>not<span class="_"> </span>alter<span class="_"> </span>the<span class="_"> </span>program<span class="_"> </span>state<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y4c16 ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_ _14"> </span>we<span class="_ _14"> </span>have<span class="_ _15"> </span>described,<span class="_ _15"> </span>any<span class="_ _14"> </span>updates<span class="_ _15"> </span>to<span class="_ _14"> </span>the<span class="_ _15"> </span>program<span class="_ _14"> </span>registers<span class="_ _14"> </span>occur<span class="_ _15"> </span>only<span class="_ _14"> </span>as</div><div class="t m5 x1d h26 y4c17 ff7 fs19 fc2 sc0 ls0 ws0">instructions<span class="_"> </span>are<span class="_ _13"> </span>being<span class="_"> </span>retired,<span class="_ _13"> </span>and<span class="_"> </span>this<span class="_"> </span>takes<span class="_ _13"> </span>place<span class="_"> </span>only<span class="_ _13"> </span>after<span class="_"> </span>the<span class="_ _13"> </span>processor<span class="_"> </span>can<span class="_"> </span>be</div><div class="t m5 x1d h26 y4c18 ff7 fs19 fc2 sc0 ls0 ws0">certain<span class="_ _13"> </span>that<span class="_ _6"> </span>any<span class="_ _13"> </span>branches<span class="_ _6"> </span>leading<span class="_ _13"> </span>to<span class="_ _13"> </span>this<span class="_ _6"> </span>instruction<span class="_ _13"> </span>have<span class="_ _13"> </span>been<span class="_ _6"> </span>correctly<span class="_ _13"> </span>predicted.</div><div class="t m5 x1d h26 y4c19 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_ _11"> </span>expedite<span class="_"> </span>the<span class="_"> </span>communication<span class="_"> </span>of<span class="_ _11"> </span>results<span class="_"> </span>from<span class="_"> </span>one<span class="_"> </span>instruction<span class="_ _11"> </span>to<span class="_"> </span>another,<span class="_"> </span>much</div><div class="t m5 x1d h26 y4c1a ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_ _13"> </span>this<span class="_ _13"> </span>information<span class="_ _13"> </span>is<span class="_ _13"> </span>exchanged<span class="_ _13"> </span>among<span class="_ _13"> </span>the<span class="_ _13"> </span>execution<span class="_ _13"> </span>units<span class="_ _0"></span>,<span class="_ _13"> </span>shown<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_ _13"> </span>ﬁgure<span class="_ _13"> </span>as</div><div class="t m5 x1d h26 y4c1b ff7 fs19 fc2 sc0 ls0 ws0">“Operation<span class="_ _13"> </span>results<span class="_ _3"></span>.<span class="_ _1"></span>”<span class="_ _13"> </span>As<span class="_ _13"> </span>the<span class="_ _13"> </span>arrows<span class="_ _6"> </span>in<span class="_ _13"> </span>the<span class="_ _13"> </span>ﬁgure<span class="_ _6"> </span>show<span class="_ _3"></span>,<span class="_ _13"> </span>the<span class="_ _13"> </span>execution<span class="_ _13"> </span>units<span class="_ _6"> </span>can<span class="_ _13"> </span>send</div><div class="t m5 x1d h26 y4c1c ff7 fs19 fc2 sc0 ls0 ws0">results<span class="_ _13"> </span>directly<span class="_ _6"> </span>to<span class="_ _13"> </span>each<span class="_ _13"> </span>other.<span class="_ _6"> </span>This<span class="_ _6"> </span>is<span class="_ _13"> </span>a<span class="_ _13"> </span>more<span class="_ _6"> </span>elaborate<span class="_ _13"> </span>form<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _6"> </span>data-forwarding</div><div class="t m5 x1d h26 y4c1d ff7 fs19 fc2 sc0 ls0 ws0">techniques<span class="_"> </span>we<span class="_"> </span>incorporated<span class="_"> </span>into<span class="_"> </span>our<span class="_"> </span>simple<span class="_"> </span>processor<span class="_"> </span>design<span class="_"> </span>in<span class="_"> </span>Section<span class="_"> </span>4.5.5.</div><div class="t m5 x29 h26 y4c1e ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _13"> </span>most<span class="_ _6"> </span>common<span class="_ _13"> </span>mechanism<span class="_ _a"> </span>for<span class="_ _13"> </span>controlling<span class="_ _6"> </span>the<span class="_ _13"> </span>communication<span class="_ _6"> </span>of<span class="_ _6"> </span>operands</div><div class="t m5 x1d h26 y4c1f ff7 fs19 fc2 sc0 ls0 ws0">among<span class="_ _16"> </span>the<span class="_ _16"> </span>execution<span class="_ _16"> </span>units<span class="_ _11"> </span>is<span class="_ _16"> </span>called<span class="_ _16"> </span><span class="ffa">register<span class="_ _16"> </span>renaming<span class="_ _2"></span></span>.<span class="_ _16"> </span>When<span class="_ _11"> </span>an<span class="_ _16"> </span>instruction<span class="_ _16"> </span>that</div><div class="t m5 x1d h26 y4c20 ff7 fs19 fc2 sc0 ls0 ws0">updates<span class="_ _14"> </span>register<span class="_ _14"> </span><span class="ff11">r<span class="_ _f"> </span></span>is<span class="_ _15"> </span>decoded,<span class="_ _15"> </span>a<span class="_ _14"> </span><span class="ffa">tag<span class="_ _15"> </span><span class="ff11">t<span class="_ _e"> </span></span></span>is<span class="_ _16"> </span>generated<span class="_ _15"> </span>giving<span class="_ _14"> </span>a<span class="_ _14"> </span>unique<span class="_ _14"> </span>identiﬁer<span class="_ _15"> </span>to</div><div class="t m5 x1d h26 y4c21 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _14"> </span>result<span class="_ _15"> </span>of<span class="_ _14"> </span>the<span class="_ _15"> </span>operation.<span class="_ _14"> </span>An<span class="_ _15"> </span>entry<span class="_ _14"> </span><span class="ff11">(r,<span class="_ _10"> </span>t<span class="_ _5"></span>)<span class="_ _15"> </span></span>is<span class="_ _14"> </span>added<span class="_ _15"> </span>to<span class="_ _14"> </span>a<span class="_ _15"> </span>table<span class="_ _14"> </span>maintaining<span class="_ _15"> </span>the</div><div class="t m5 x1d h26 y4c22 ff7 fs19 fc2 sc0 ls0 ws0">association<span class="_ _13"> </span>between<span class="_ _13"> </span>program<span class="_"> </span>register<span class="_ _13"> </span><span class="ff11">r<span class="_ _11"> </span></span>and<span class="_ _13"> </span>tag<span class="_"> </span><span class="ff11">t<span class="_ _11"> </span></span>for<span class="_ _13"> </span>an<span class="_ _13"> </span>operation<span class="_"> </span>that<span class="_ _13"> </span>will<span class="_ _13"> </span>update</div><div class="t m5 x1d h26 y4c23 ff7 fs19 fc2 sc0 ls0 ws0">this<span class="_ _21"> </span>register.<span class="_ _15"> </span>When<span class="_ _15"> </span>a<span class="_ _21"> </span>subsequent<span class="_ _f"> </span>instruction<span class="_ _21"> </span>using<span class="_ _21"> </span>register<span class="_ _21"> </span><span class="ff11">r<span class="_ _e"> </span></span>as<span class="_ _21"> </span>an<span class="_ _21"> </span>operand<span class="_ _f"> </span>is</div><div class="t m5 x1d h26 y4c24 ff7 fs19 fc2 sc0 ls0 ws0">decoded,<span class="_ _21"> </span>the<span class="_ _15"> </span>operation<span class="_ _21"> </span>sent<span class="_ _15"> </span>to<span class="_ _15"> </span>the<span class="_ _21"> </span>execution<span class="_ _15"> </span>unit<span class="_ _21"> </span>will<span class="_ _15"> </span>contain<span class="_ _15"> </span><span class="ff11">t<span class="_ _e"> </span></span>as<span class="_ _15"> </span>the<span class="_ _21"> </span>source</div><div class="t m5 x1d h26 y4c25 ff7 fs19 fc2 sc0 ls0 ws0">for<span class="_ _11"> </span>the<span class="_ _16"> </span>operand<span class="_ _11"> </span>value.<span class="_"> </span>When<span class="_ _11"> </span>some<span class="_ _16"> </span>execution<span class="_ _11"> </span>unit<span class="_ _16"> </span>completes<span class="_ _11"> </span>the<span class="_ _16"> </span>ﬁrst<span class="_ _11"> </span>operation,</div><div class="t m5 x1d h26 y4c26 ff7 fs19 fc2 sc0 ls0 ws0">it<span class="_ _f"> </span>generates<span class="_ _f"> </span>a<span class="_ _e"> </span>result<span class="_ _f"> </span><span class="ff11">(v<span class="_ _2"></span>,<span class="_ _10"> </span>t<span class="_ _5"></span>)</span>,<span class="_ _1f"> </span>indicating<span class="_ _f"> </span>that<span class="_ _f"> </span>the<span class="_ _e"> </span>operation<span class="_ _21"> </span>with<span class="_ _e"> </span>tag<span class="_ _21"> </span><span class="ff11">t<span class="_ _22"> </span></span>produced</div><div class="t m5 x1d h26 y4c27 ff7 fs19 fc2 sc0 ls0 ws0">value<span class="_ _15"> </span><span class="ff11">v<span class="_ _2"></span></span>.<span class="_ _15"> </span>Any<span class="_ _14"> </span>operation<span class="_ _15"> </span>waiting<span class="_ _15"> </span>for<span class="_ _15"> </span><span class="ff11">t<span class="_ _e"> </span></span>as<span class="_ _15"> </span>a<span class="_ _15"> </span>source<span class="_ _15"> </span>will<span class="_ _14"> </span>then<span class="_ _15"> </span>use<span class="_ _15"> </span><span class="ff11">v<span class="_ _f"> </span></span>as<span class="_ _15"> </span>the<span class="_ _15"> </span>source</div><div class="t m5 x1d h26 y4c28 ff7 fs19 fc2 sc0 ls0 ws0">value<span class="_ _1"></span>,<span class="_ _15"> </span>a<span class="_ _14"> </span>form<span class="_ _14"> </span>of<span class="_ _14"> </span>data<span class="_ _14"> </span>forwarding.<span class="_ _16"> </span>By<span class="_ _14"> </span>this<span class="_ _14"> </span>mechanism,<span class="_ _14"> </span>values<span class="_ _14"> </span>can<span class="_ _14"> </span>be<span class="_ _14"> </span>forwarded</div><div class="t m5 x1d h26 y4c29 ff7 fs19 fc2 sc0 ls0 ws0">directly<span class="_ _13"> </span>from<span class="_ _6"> </span>one<span class="_ _13"> </span>operation<span class="_ _13"> </span>to<span class="_ _6"> </span>another,<span class="_ _13"> </span>rather<span class="_ _6"> </span>than<span class="_ _13"> </span>being<span class="_ _13"> </span>written<span class="_ _6"> </span>to<span class="_ _13"> </span>and<span class="_ _13"> </span>read<span class="_ _6"> </span>from</div><div class="t m5 x1d h26 y4c2a ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _16"> </span>register<span class="_ _14"> </span>ﬁle<span class="_ _1"></span>,<span class="_ _14"> </span>enabling<span class="_ _14"> </span>the<span class="_ _16"> </span>second<span class="_ _14"> </span>operation<span class="_ _16"> </span>to<span class="_ _14"> </span>begin<span class="_ _16"> </span>as<span class="_ _14"> </span>soon<span class="_ _16"> </span>as<span class="_ _14"> </span>the<span class="_ _16"> </span>ﬁrst<span class="_ _14"> </span>has</div><div class="t m5 x1d h26 y4c2b ff7 fs19 fc2 sc0 ls0 ws0">completed.<span class="_"> </span>T<span class="_ _3"></span>he<span class="_"> </span>renaming<span class="_ _13"> </span>table<span class="_"> </span>only<span class="_ _13"> </span>contains<span class="_"> </span>entries<span class="_ _13"> </span>for<span class="_"> </span>registers<span class="_ _13"> </span>having<span class="_"> </span>pending</div><div class="t m5 x1d h26 y4c2c ff7 fs19 fc2 sc0 ls0 ws0">write<span class="_ _13"> </span>operations<span class="_ _1"></span>.<span class="_ _13"> </span>When<span class="_ _13"> </span>a<span class="_ _13"> </span>decoded<span class="_ _13"> </span>instruction<span class="_ _13"> </span>requires<span class="_ _13"> </span>a<span class="_ _13"> </span>register<span class="_ _13"> </span><span class="ff11">r<span class="_ _5"></span></span>,<span class="_ _13"> </span>and<span class="_ _13"> </span>there<span class="_ _13"> </span>is<span class="_ _13"> </span>no</div><div class="t m5 x1d h26 y4c2d ff7 fs19 fc2 sc0 ls0 ws0">tag<span class="_ _13"> </span>associated<span class="_ _13"> </span>with<span class="_ _13"> </span>this<span class="_ _13"> </span>register,<span class="_ _13"> </span>the<span class="_ _13"> </span>operand<span class="_ _13"> </span>is<span class="_ _13"> </span>retrieved<span class="_ _13"> </span>directly<span class="_ _13"> </span>from<span class="_ _13"> </span>the<span class="_ _13"> </span>register</div><div class="t m5 x1d h26 y4c2e ff7 fs19 fc2 sc0 ls0 ws0">ﬁle<span class="_ _1"></span>.<span class="_ _16"> </span>W<span class="_ _1"></span>ith<span class="_ _16"> </span>register<span class="_ _11"> </span>renaming,<span class="_ _11"> </span>an<span class="_ _16"> </span>entire<span class="_ _11"> </span>sequence<span class="_ _16"> </span>of<span class="_ _11"> </span>operations<span class="_ _11"> </span>can<span class="_ _16"> </span>be<span class="_ _11"> </span>performed</div><div class="t m5 x1d h26 y4c2f ff7 fs19 fc2 sc0 ls0 ws0">speculatively<span class="_ _3"></span>,<span class="_ _14"> </span>even<span class="_ _14"> </span>though<span class="_ _14"> </span>the<span class="_ _16"> </span>registers<span class="_ _14"> </span>are<span class="_ _14"> </span>updated<span class="_ _14"> </span>only<span class="_ _16"> </span>after<span class="_ _14"> </span>the<span class="_ _14"> </span>processor<span class="_ _14"> </span>is</div><div class="t m5 x1d h26 y4c30 ff7 fs19 fc2 sc0 ls0 ws0">certain<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>branch<span class="_"> </span>outcomes<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
