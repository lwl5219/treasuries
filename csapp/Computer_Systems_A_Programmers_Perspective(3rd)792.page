<div id="pf318" class="pf w2 h11" data-page-no="318"><div class="pc pc318 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg318.png"/><div class="t m5 x100 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>8.4<span class="_ _60"> </span>Process<span class="_ _10"> </span>Control<span class="_ _3e"> </span><span class="ffe fs1e">791</span></div><div class="t m5 x2b h2c y27f ffa fs16 fc2 sc0 ls0 ws0">code/ecf/shellex.c</div><div class="t m5 x2c h2e y280 ff6 fs20 fc6 sc0 ls0 ws0">1</div><div class="t m5 x2d h2d yad1 ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>eval<span class="_ _1f"> </span>-<span class="_ _1f"> </span>Evaluate<span class="_ _e"> </span>a<span class="_ _1f"> </span>command<span class="_ _e"> </span>line<span class="_ _1f"> </span>*/</div><div class="t m5 x2c h2d y281 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">void<span class="_ _1f"> </span>eval(char<span class="_ _e"> </span>*cmdline)</span></div><div class="t m5 x2c h2d yad2 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x2c h2d yad3 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2">char<span class="_ _e"> </span>*argv[MAXARGS];<span class="_ _1f"> </span>/*<span class="_ _1f"> </span>Argument<span class="_ _e"> </span>list<span class="_ _1f"> </span>execve()<span class="_ _e"> </span>*/</span></div><div class="t m5 x2c h2d y285 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _20"> </span><span class="ffd fs1e fc2">char<span class="_ _e"> </span>buf[MAXLINE];<span class="_ _3f"> </span>/*<span class="_ _1f"> </span>Holds<span class="_ _1f"> </span>modified<span class="_ _e"> </span>command<span class="_ _1f"> </span>line<span class="_ _e"> </span>*/</span></div><div class="t m5 x2c h2d yad4 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _20"> </span><span class="ffd fs1e fc2">int<span class="_ _e"> </span>bg;<span class="_ _16f"> </span>/*<span class="_ _e"> </span>Should<span class="_ _1f"> </span>the<span class="_ _1f"> </span>job<span class="_ _e"> </span>run<span class="_ _1f"> </span>in<span class="_ _e"> </span>bg<span class="_ _1f"> </span>or<span class="_ _1f"> </span>fg?<span class="_ _e"> </span>*/</span></div><div class="t m5 x2c h2d yad5 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _20"> </span><span class="ffd fs1e fc2">pid_t<span class="_ _e"> </span>pid;<span class="_ _6b"> </span>/*<span class="_ _1f"> </span>Process<span class="_ _e"> </span>id<span class="_ _1f"> </span>*/</span></div><div class="t m5 x2c h2e yad6 ff6 fs20 fc6 sc0 ls0 ws0">8</div><div class="t m5 x2c h2e y61b5 ff6 fs20 fc6 sc0 ls0 ws0">9</div><div class="t m5 x142 h2d y496b ffd fs1e fc2 sc0 ls0 ws0">strcpy(buf,<span class="_ _e"> </span>cmdline);</div><div class="t m5 x17 h2d y50d4 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _20"> </span><span class="ffd fs1e fc2">bg<span class="_ _e"> </span>=<span class="_ _1f"> </span>parseline(buf,<span class="_ _1f"> </span>argv);</span></div><div class="t m5 x17 h2d y4a9c ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _20"> </span><span class="ffd fs1e fc2">if<span class="_ _e"> </span>(argv[0]<span class="_ _1f"> </span>==<span class="_ _1f"> </span>NULL)</span></div><div class="t m5 x17 h2d y61b6 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _70"> </span><span class="ffd fs1e fc2">return;<span class="_ _3f"> </span>/*<span class="_ _e"> </span>Ignore<span class="_ _1f"> </span>empty<span class="_ _1f"> </span>lines<span class="_ _e"> </span>*/</span></div><div class="t m5 x17 h2e y2181 ff6 fs20 fc6 sc0 ls0 ws0">13</div><div class="t m5 x17 h2e y677c ff6 fs20 fc6 sc0 ls0 ws0">14</div><div class="t m5 x142 h2d y554b ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>(!builtin_command(argv))<span class="_ _1f"> </span>{</div><div class="t m5 x17 h2d y4a9f ff6 fs20 fc6 sc0 ls0 ws0">15<span class="_ _70"> </span><span class="ffd fs1e fc2">if<span class="_ _e"> </span>((pid<span class="_ _1f"> </span>=<span class="_ _1f"> </span>Fork())<span class="_ _e"> </span>==<span class="_ _1f"> </span>0)<span class="_ _e"> </span>{<span class="_ _3f"> </span>/*<span class="_ _1f"> </span>Child<span class="_ _1f"> </span>runs<span class="_ _e"> </span>user<span class="_ _1f"> </span>job<span class="_ _e"> </span>*/</span></div><div class="t m5 x17 h2d y417 ff6 fs20 fc6 sc0 ls0 ws0">16<span class="_ _d1"> </span><span class="ffd fs1e fc2">if<span class="_ _1f"> </span>(execve(argv[0],<span class="_ _e"> </span>argv,<span class="_ _1f"> </span>environ)<span class="_ _e"> </span>&lt;<span class="_ _1f"> </span>0)<span class="_ _1f"> </span>{</span></div><div class="t m5 x17 h2d y4aa0 ff6 fs20 fc6 sc0 ls0 ws0">17<span class="_ _143"> </span><span class="ffd fs1e fc2">printf(&quot;%s:<span class="_ _e"> </span>Command<span class="_ _1f"> </span>not<span class="_ _1f"> </span>found.\n&quot;,<span class="_ _e"> </span>argv[0]);</span></div><div class="t m5 x17 h2d y3ec ff6 fs20 fc6 sc0 ls0 ws0">18<span class="_ _143"> </span><span class="ffd fs1e fc2">exit(0);</span></div><div class="t m5 x17 h2d y2a2b ff6 fs20 fc6 sc0 ls0 ws0">19<span class="_ _d1"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x17 h2d y1ab8 ff6 fs20 fc6 sc0 ls0 ws0">20<span class="_ _70"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x17 h2e y1ada ff6 fs20 fc6 sc0 ls0 ws0">21</div><div class="t m5 x17 h2e y61b8 ff6 fs20 fc6 sc0 ls0 ws0">22</div><div class="t m5 xc5 h2d y61b9 ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Parent<span class="_ _1f"> </span>waits<span class="_ _1f"> </span>for<span class="_ _e"> </span>foreground<span class="_ _1f"> </span>job<span class="_ _e"> </span>to<span class="_ _1f"> </span>terminate<span class="_ _1f"> </span>*/</div><div class="t m5 x17 h2d y3228 ff6 fs20 fc6 sc0 ls0 ws0">23<span class="_ _70"> </span><span class="ffd fs1e fc2">if<span class="_ _e"> </span>(!bg)<span class="_ _1f"> </span>{</span></div><div class="t m5 x17 h2d y35d ff6 fs20 fc6 sc0 ls0 ws0">24<span class="_ _d1"> </span><span class="ffd fs1e fc2">int<span class="_ _1f"> </span>status;</span></div><div class="t m5 x17 h2d y3229 ff6 fs20 fc6 sc0 ls0 ws0">25<span class="_ _d1"> </span><span class="ffd fs1e fc2">if<span class="_ _1f"> </span>(waitpid(pid,<span class="_ _e"> </span>&amp;status,<span class="_ _1f"> </span>0)<span class="_ _e"> </span>&lt;<span class="_ _1f"> </span>0)</span></div><div class="t m5 x17 h2d y322a ff6 fs20 fc6 sc0 ls0 ws0">26<span class="_ _143"> </span><span class="ffd fs1e fc2">unix_error(&quot;waitfg:<span class="_ _e"> </span>waitpid<span class="_ _1f"> </span>error&quot;);</span></div><div class="t m5 x17 h2d y322b ff6 fs20 fc6 sc0 ls0 ws0">27<span class="_ _70"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x17 h2d y322c ff6 fs20 fc6 sc0 ls0 ws0">28<span class="_ _70"> </span><span class="ffd fs1e fc2">else</span></div><div class="t m5 x17 h2d y441 ff6 fs20 fc6 sc0 ls0 ws0">29<span class="_ _d1"> </span><span class="ffd fs1e fc2">printf(&quot;%d<span class="_ _1f"> </span>%s&quot;,<span class="_ _e"> </span>pid,<span class="_ _1f"> </span>cmdline);</span></div><div class="t m5 x17 h2d y2c5c ff6 fs20 fc6 sc0 ls0 ws0">30<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x17 h2d y322d ff6 fs20 fc6 sc0 ls0 ws0">31<span class="_ _20"> </span><span class="ffd fs1e fc2">return;</span></div><div class="t m5 x17 h2d y24a ff6 fs20 fc6 sc0 ls0 ws0">32<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x17 h2e y8f9 ff6 fs20 fc6 sc0 ls0 ws0">33</div><div class="t m5 x17 h2e y677d ff6 fs20 fc6 sc0 ls0 ws0">34</div><div class="t m5 x2d h2d y5fd ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>If<span class="_ _1f"> </span>first<span class="_ _1f"> </span>arg<span class="_ _e"> </span>is<span class="_ _1f"> </span>a<span class="_ _e"> </span>builtin<span class="_ _1f"> </span>command,<span class="_ _1f"> </span>run<span class="_ _e"> </span>it<span class="_ _1f"> </span>and<span class="_ _e"> </span>return<span class="_ _1f"> </span>true<span class="_ _1f"> </span>*/</div><div class="t m5 x17 h2d y4aa5 ff6 fs20 fc6 sc0 ls0 ws0">35<span class="_ _1c"> </span><span class="ffd fs1e fc2">int<span class="_ _1f"> </span>builtin_command(char<span class="_ _e"> </span>**argv)</span></div><div class="t m5 x17 h2e y22d4 ff6 fs20 fc6 sc0 ls0 ws0">36</div><div class="t m5 x2d h2d y74d ffd fs1e fc2 sc0 ls0 ws0">{</div><div class="t m5 x17 h2d y277 ff6 fs20 fc6 sc0 ls0 ws0">37<span class="_ _20"> </span><span class="ffd fs1e fc2">if<span class="_ _e"> </span>(!strcmp(argv[0],<span class="_ _1f"> </span>&quot;quit&quot;))<span class="_ _1f"> </span>/*<span class="_ _e"> </span>quit<span class="_ _1f"> </span>command<span class="_ _e"> </span>*/</span></div><div class="t m5 x17 h2d y2269 ff6 fs20 fc6 sc0 ls0 ws0">38<span class="_ _70"> </span><span class="ffd fs1e fc2">exit(0);</span></div><div class="t m5 x17 h2d y226b ff6 fs20 fc6 sc0 ls0 ws0">39<span class="_ _20"> </span><span class="ffd fs1e fc2">if<span class="_ _e"> </span>(!strcmp(argv[0],<span class="_ _1f"> </span>&quot;&amp;&quot;))<span class="_ _46"> </span>/*<span class="_ _1f"> </span>Ignore<span class="_ _e"> </span>singleton<span class="_ _1f"> </span>&amp;<span class="_ _e"> </span>*/</span></div><div class="t m5 x17 h2d y226d ff6 fs20 fc6 sc0 ls0 ws0">40<span class="_ _70"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>1;</span></div><div class="t m5 x17 h2d y8d5 ff6 fs20 fc6 sc0 ls0 ws0">41<span class="_ _20"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>0;<span class="_ _1fb"> </span>/*<span class="_ _1f"> </span>Not<span class="_ _e"> </span>a<span class="_ _1f"> </span>builtin<span class="_ _e"> </span>command<span class="_ _1f"> </span>*/</span></div><div class="t m5 x17 h2d y2270 ff6 fs20 fc6 sc0 ls0 ws0">42<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x2b h2c y677e ffa fs16 fc2 sc0 ls0 ws0">code/ecf/shellex.c</div><div class="t m5 x17 h2f y677f ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>8.24</div><div class="t m5 x156 h3a y6780 ffd fs19 fc1 sc0 ls0 ws0">eval<span class="_ _10"> </span><span class="ffe fs16">evaluates<span class="_"> </span>the<span class="_"> </span>shell<span class="_"> </span>command<span class="_"> </span>line.</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
