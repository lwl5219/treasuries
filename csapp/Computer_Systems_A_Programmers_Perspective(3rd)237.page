<div id="pfed" class="pf w2 h11" data-page-no="ed"><div class="pc pced w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bged.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">236<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x29 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>compiles<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>assembly<span class="_"> </span>code:</div><div class="t m5 xad h61 y2425 ff13 fs35 fc6 sc0 ls0 ws0">void<span class="_ _f"> </span>remdiv(long<span class="_ _f"> </span>x,<span class="_ _f"> </span>long<span class="_ _e"> </span>y,<span class="_ _21"> </span>long<span class="_ _f"> </span>*qp,<span class="_ _e"> </span>long<span class="_ _21"> </span>*rp)</div><div class="t m5 xad h61 y2426 ff13 fs35 fc6 sc0 ls0 ws0">x<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi,<span class="_ _f"> </span>y<span class="_ _e"> </span>in<span class="_ _21"> </span>%rsi,<span class="_ _f"> </span>qp<span class="_ _e"> </span>in<span class="_ _21"> </span>%rdx,<span class="_ _f"> </span>rp<span class="_ _e"> </span>in<span class="_ _21"> </span>%rcx</div><div class="t m5 x1f h2d y2427 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">remdiv:</span></div><div class="t m5 x1f h2d y2428 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rdx,<span class="_ _e"> </span>%r8<span class="_ _88"> </span></span><span class="ff13 fs35">Copy<span class="_ _21"> </span>qp</span></div><div class="t m5 x1f h2d y2429 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rdi,<span class="_ _e"> </span>%rax<span class="_ _59"> </span></span><span class="ff13 fs35">Move<span class="_ _f"> </span>x<span class="_ _e"> </span>to<span class="_ _21"> </span>lower<span class="_ _f"> </span>8<span class="_ _e"> </span>bytes<span class="_ _21"> </span>of<span class="_ _f"> </span>dividend</span></div><div class="t m5 x1f h2d y242a ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">cqto<span class="_ _14f"> </span></span><span class="ff13 fs35">Sign-extend<span class="_ _f"> </span>to<span class="_ _f"> </span>upper<span class="_ _f"> </span>8<span class="_ _e"> </span>bytes<span class="_ _21"> </span>of<span class="_ _f"> </span>dividend</span></div><div class="t m5 x1f h2d y242b ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">idivq<span class="_ _3f"> </span>%rsi<span class="_ _12b"> </span></span><span class="ff13 fs35">Divide<span class="_ _f"> </span>by<span class="_ _f"> </span>y</span></div><div class="t m5 x1f h2d y242c ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rax,<span class="_ _e"> </span>(%r8)<span class="_ _93"> </span></span><span class="ff13 fs35">Store<span class="_ _e"> </span>quotient<span class="_ _21"> </span>at<span class="_ _f"> </span>qp</span></div><div class="t m5 x1f h2d y242d ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rdx,<span class="_ _e"> </span>(%rcx)<span class="_ _f1"> </span></span><span class="ff13 fs35">Store<span class="_ _f"> </span>remainder<span class="_ _f"> </span>at<span class="_ _f"> </span>rp</span></div><div class="t m5 x1f h2d y242e ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _45"> </span><span class="ffd fs1e fc2">ret</span></div><div class="t m5 x29 h26 y242f ff7 fs19 fc2 sc0 ls0 ws0">In<span class="_ _11"> </span>this<span class="_ _16"> </span>code<span class="_ _0"></span>,<span class="_ _16"> </span>argument<span class="_ _11"> </span><span class="ffd">rp<span class="_ _16"> </span></span>must<span class="_ _16"> </span>ﬁrst<span class="_ _11"> </span>be<span class="_ _16"> </span>saved<span class="_ _11"> </span>in<span class="_ _16"> </span>a<span class="_ _11"> </span>different<span class="_ _16"> </span>register<span class="_ _16"> </span>(line<span class="_ _11"> </span>2),</div><div class="t m5 x1d h26 y2430 ff7 fs19 fc2 sc0 ls0 ws0">since<span class="_ _13"> </span>argument<span class="_ _13"> </span>register<span class="_ _13"> </span><span class="ffd">%rdx<span class="_ _13"> </span></span>is<span class="_ _6"> </span>required<span class="_ _13"> </span>for<span class="_ _13"> </span>the<span class="_ _13"> </span>division<span class="_ _13"> </span>operation.<span class="_ _13"> </span>Lines<span class="_ _13"> </span>3–4<span class="_ _13"> </span>then</div><div class="t m5 x1d h26 y2431 ff7 fs19 fc2 sc0 ls0 ws0">prepare<span class="_ _13"> </span>the<span class="_"> </span>dividend<span class="_ _13"> </span>by<span class="_ _13"> </span>copying<span class="_"> </span>and<span class="_ _13"> </span>sign-extending<span class="_ _13"> </span><span class="ffd">x</span>.<span class="_ _13"> </span>F<span class="_ _1"></span>ollowing<span class="_"> </span>the<span class="_ _13"> </span>division,<span class="_"> </span>the</div><div class="t m5 x1d h26 y2432 ff7 fs19 fc2 sc0 ls0 ws0">quotient<span class="_ _13"> </span>in<span class="_"> </span>register<span class="_ _13"> </span><span class="ffd">%rax<span class="_ _10"> </span></span>gets<span class="_ _13"> </span>stored<span class="_"> </span>at<span class="_ _13"> </span><span class="ffd">qp<span class="_ _10"> </span></span>(line<span class="_ _13"> </span>6),<span class="_"> </span>while<span class="_ _13"> </span>the<span class="_"> </span>remainder<span class="_ _13"> </span>in<span class="_"> </span>register</div><div class="t m5 x1d h26 y2433 ffd fs19 fc2 sc0 ls0 ws0">%rdx<span class="_ _10"> </span><span class="ff7">gets<span class="_"> </span>stored<span class="_"> </span>at<span class="_"> </span></span>rp<span class="_ _10"> </span><span class="ff7">(line<span class="_"> </span>7).</span></div><div class="t m5 x29 h26 y2434 ff7 fs19 fc2 sc0 ls0 ws0">Unsigned<span class="_"> </span>division<span class="_"> </span>makes<span class="_"> </span>use<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span><span class="ffd">divq<span class="_ _10"> </span></span>instruction.<span class="_"> </span>T<span class="_ _7"></span>ypically<span class="_ _3"></span>,<span class="_"> </span>register<span class="_"> </span><span class="ffd">%rdx</span></div><div class="t m5 x1d h26 y2435 ff7 fs19 fc2 sc0 ls0 ws0">is<span class="_"> </span>set<span class="_"> </span>to<span class="_"> </span>zero<span class="_"> </span>beforehand.</div><div class="t m5 x1d h47 y2436 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>3.12<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>365)</span></div><div class="t m5 x1d h26 y2437 ff7 fs19 fc1 sc0 ls0 ws0">Consider<span class="_ _13"> </span>the<span class="_ _13"> </span>following<span class="_ _13"> </span>function<span class="_ _13"> </span>for<span class="_ _13"> </span>computing<span class="_ _13"> </span>the<span class="_ _13"> </span>quotient<span class="_ _13"> </span>and<span class="_"> </span>remainder<span class="_ _13"> </span>of<span class="_ _13"> </span>two</div><div class="t m5 x1d h26 y2438 ff7 fs19 fc1 sc0 ls0 ws0">unsigned<span class="_"> </span>64-bit<span class="_"> </span>numbers:</div><div class="t m5 x1d h2d y2439 ffd fs1e fc2 sc0 ls0 ws0">void<span class="_ _e"> </span>uremdiv(unsigned<span class="_ _1f"> </span>long<span class="_ _1f"> </span>x,<span class="_ _e"> </span>unsigned<span class="_ _1f"> </span>long<span class="_ _e"> </span>y,</div><div class="t m5 x7c h2d y243a ffd fs1e fc2 sc0 ls0 ws0">unsigned<span class="_ _e"> </span>long<span class="_ _1f"> </span>*qp,<span class="_ _1f"> </span>unsigned<span class="_ _e"> </span>long<span class="_ _1f"> </span>*rp)<span class="_ _e"> </span>{</div><div class="t m5 x10c h2d y243b ffd fs1e fc2 sc0 ls0 ws0">unsigned<span class="_ _e"> </span>long<span class="_ _1f"> </span>q<span class="_ _1f"> </span>=<span class="_ _e"> </span>x/y;</div><div class="t m5 x10c h2d y243c ffd fs1e fc2 sc0 ls0 ws0">unsigned<span class="_ _e"> </span>long<span class="_ _1f"> </span>r<span class="_ _1f"> </span>=<span class="_ _e"> </span>x%y;</div><div class="t m5 x10c h2d y243d ffd fs1e fc2 sc0 ls33 ws0">*<span class="_ _41"></span>q<span class="_ _41"></span>p=q<span class="_ _41"></span>;</div><div class="t m5 x10c h2d y243e ffd fs1e fc2 sc0 ls33 ws0">*<span class="_ _41"></span>r<span class="_ _41"></span>p=r<span class="_ _41"></span>;</div><div class="t m5 x1d h2d y243f ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x1d h26 y2440 ff7 fs19 fc2 sc0 ls0 ws0">Modify<span class="_"> </span>the<span class="_"> </span>assembly<span class="_"> </span>code<span class="_"> </span>shown<span class="_"> </span>for<span class="_"> </span>signed<span class="_"> </span>division<span class="_"> </span>to<span class="_"> </span>implement<span class="_"> </span>this<span class="_"> </span>function.</div><div class="t m5 x1d h3b y2441 fff fs24 fc6 sc0 ls0 ws0">3.6<span class="_ _17"> </span><span class="ffe fs18">Control</span></div><div class="t m5 x1d h26 yec2 ff7 fs19 fc1 sc0 ls0 ws0">So<span class="_"> </span>far,<span class="_"> </span>we<span class="_ _13"> </span>have<span class="_"> </span>only<span class="_"> </span>considered<span class="_"> </span>the<span class="_"> </span>behavior<span class="_"> </span>of<span class="_"> </span><span class="ffa">straight-line<span class="_"> </span></span>code<span class="_ _1"></span>,<span class="_"> </span>where<span class="_"> </span>instruc-</div><div class="t m5 x1d h26 yec3 ff7 fs19 fc1 sc0 ls0 ws0">tions<span class="_"> </span>follow<span class="_"> </span>one<span class="_"> </span>another<span class="_"> </span>in<span class="_"> </span>sequence<span class="_ _1"></span>.<span class="_"> </span>Some<span class="_"> </span>constructs<span class="_"> </span>in<span class="_"> </span>C,<span class="_"> </span>such<span class="_"> </span>as<span class="_"> </span>conditionals<span class="_ _3"></span>,</div><div class="t m5 x1d h26 yec4 ff7 fs19 fc1 sc0 ls0 ws0">loops<span class="_ _1"></span>,<span class="_ _16"> </span>and<span class="_ _16"> </span>switches<span class="_ _1"></span>,<span class="_ _16"> </span>require<span class="_ _16"> </span>conditional<span class="_ _11"> </span>execution,<span class="_ _14"> </span>where<span class="_ _16"> </span>the<span class="_ _11"> </span>sequence<span class="_ _16"> </span>of<span class="_ _16"> </span>oper<span class="_ _1"></span>-</div><div class="t m5 x1d h26 yec5 ff7 fs19 fc1 sc0 ls0 ws0">ations<span class="_ _11"> </span>that<span class="_ _16"> </span>get<span class="_ _11"> </span>performed<span class="_ _11"> </span>depends<span class="_ _16"> </span>on<span class="_ _11"> </span>the<span class="_ _11"> </span>outcomes<span class="_ _16"> </span>of<span class="_ _11"> </span>tests<span class="_ _11"> </span>applied<span class="_ _16"> </span>to<span class="_ _11"> </span>the<span class="_ _11"> </span>data.</div><div class="t m5 x1d h26 yec6 ff7 fs19 fc1 sc0 ls0 ws0">Machine<span class="_"> </span>code<span class="_"> </span>provides<span class="_"> </span>two<span class="_"> </span>basic<span class="_"> </span>low-level<span class="_"> </span>mechanisms<span class="_"> </span>for<span class="_"> </span>implementing<span class="_"> </span>condi-</div><div class="t m5 x1d h26 yec7 ff7 fs19 fc1 sc0 ls0 ws0">tional<span class="_ _11"> </span>behavior:<span class="_ _11"> </span>it<span class="_ _11"> </span>tests<span class="_ _11"> </span>data<span class="_ _11"> </span>values<span class="_ _11"> </span>and<span class="_ _11"> </span>then<span class="_ _11"> </span>alters<span class="_ _11"> </span>either<span class="_ _11"> </span>the<span class="_ _11"> </span>control<span class="_ _11"> </span>ﬂow<span class="_ _11"> </span>or<span class="_ _11"> </span>the</div><div class="t m5 x1d h26 yec8 ff7 fs19 fc1 sc0 ls0 ws0">data<span class="_"> </span>ﬂow<span class="_"> </span>based<span class="_"> </span>on<span class="_"> </span>the<span class="_"> </span>results<span class="_"> </span>of<span class="_"> </span>these<span class="_"> </span>tests<span class="_ _1"></span>.</div><div class="t m5 x29 h26 yec9 ff7 fs19 fc1 sc0 ls0 ws0">Data-dependent<span class="_ _6"> </span>control<span class="_ _13"> </span>ﬂow<span class="_ _a"> </span>is<span class="_ _13"> </span>the<span class="_ _6"> </span>more<span class="_ _6"> </span>general<span class="_ _13"> </span>and<span class="_ _6"> </span>more<span class="_ _6"> </span>common<span class="_ _13"> </span>approach</div><div class="t m5 x1d h26 yeca ff7 fs19 fc1 sc0 ls0 ws0">for<span class="_ _6"> </span>implementing<span class="_ _13"> </span>conditional<span class="_ _a"> </span>behavior,<span class="_ _13"> </span>and<span class="_ _a"> </span>so<span class="_ _13"> </span>we<span class="_ _6"> </span>will<span class="_ _6"> </span>examine<span class="_ _13"> </span>this<span class="_ _a"> </span>ﬁrst.<span class="_ _13"> </span>Normally<span class="_ _7"></span>,</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
