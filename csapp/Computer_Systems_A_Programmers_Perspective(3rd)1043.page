<div id="pf413" class="pf w2 h11" data-page-no="413"><div class="pc pc413 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg413.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">1042<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>12<span class="_ _3d"> </span>Concurrent<span class="_ _10"> </span>Programming</span></div><div class="t m5 x1c1 h2c y6781 ffa fs16 fc2 sc0 ls0 ws0">code/conc/sbuf<span class="_ _1"></span>.h</div><div class="t m5 x1f h2d yb20 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">typedef<span class="_ _1f"> </span>struct<span class="_ _e"> </span>{</span></div><div class="t m5 x1f h2d y1980 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _20"> </span><span class="ffd fs1e fc2">int<span class="_ _e"> </span>*buf;<span class="_ _86"> </span>/*<span class="_ _1f"> </span>Buffer<span class="_ _1f"> </span>array<span class="_ _e"> </span>*/</span></div><div class="t m5 x1f h2d y1983 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2">int<span class="_ _e"> </span>n;<span class="_ _da"> </span>/*<span class="_ _e"> </span>Maximum<span class="_ _1f"> </span>number<span class="_ _e"> </span>of<span class="_ _1f"> </span>slots<span class="_ _1f"> </span>*/</span></div><div class="t m5 x1f h2d y6782 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2">int<span class="_ _e"> </span>front;<span class="_ _87"> </span>/*<span class="_ _e"> </span>buf[(front+1)%n]<span class="_ _1f"> </span>is<span class="_ _1f"> </span>first<span class="_ _e"> </span>item<span class="_ _1f"> </span>*/</span></div><div class="t m5 x1f h2d y6783 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _20"> </span><span class="ffd fs1e fc2">int<span class="_ _e"> </span>rear;<span class="_ _86"> </span>/*<span class="_ _1f"> </span>buf[rear%n]<span class="_ _1f"> </span>is<span class="_ _e"> </span>last<span class="_ _1f"> </span>item<span class="_ _e"> </span>*/</span></div><div class="t m5 x1f h2d y6784 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _20"> </span><span class="ffd fs1e fc2">sem_t<span class="_ _e"> </span>mutex;<span class="_ _2b"> </span>/*<span class="_ _e"> </span>Protects<span class="_ _1f"> </span>accesses<span class="_ _1f"> </span>to<span class="_ _e"> </span>buf<span class="_ _1f"> </span>*/</span></div><div class="t m5 x1f h2d y6785 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _20"> </span><span class="ffd fs1e fc2">sem_t<span class="_ _e"> </span>slots;<span class="_ _2b"> </span>/*<span class="_ _e"> </span>Counts<span class="_ _1f"> </span>available<span class="_ _1f"> </span>slots<span class="_ _e"> </span>*/</span></div><div class="t m5 x1f h2d y6787 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _20"> </span><span class="ffd fs1e fc2">sem_t<span class="_ _e"> </span>items;<span class="_ _2b"> </span>/*<span class="_ _e"> </span>Counts<span class="_ _1f"> </span>available<span class="_ _1f"> </span>items<span class="_ _e"> </span>*/</span></div><div class="t m5 x1f h2d y6788 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _1c"> </span><span class="ffd fs1e fc2">}<span class="_ _1f"> </span>sbuf_t;</span></div><div class="t m5 x1c1 h2c y8277 ffa fs16 fc2 sc0 ls0 ws0">code/conc/sbuf<span class="_ _1"></span>.h</div><div class="t m5 x1d h2f y8278 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>12.24</div><div class="t m5 x1a h3a y228b ffd fs19 fc1 sc0 ls0 ws0">sbuf_t<span class="ffe fs16">:<span class="_"> </span>Bounded<span class="_"> </span>buffer<span class="_"> </span>used<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span><span class="ff1b">Sbuf<span class="_ _10"> </span></span>package.</span></div><div class="t m5 x29 h26 y8279 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_"> </span>12.25<span class="_"> </span>shows<span class="_"> </span>the<span class="_"> </span>implementation<span class="_ _11"> </span>of<span class="_"> </span>the<span class="_"> </span><span class="ff9">Sbuf<span class="_ _10"> </span></span>package<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _0"></span>he<span class="_"> </span><span class="ffd">sbuf_init</span></div><div class="t m5 x1d h26 y827a ff7 fs19 fc1 sc0 ls0 ws0">function<span class="_ _16"> </span>allocates<span class="_ _16"> </span>heap<span class="_ _16"> </span>memory<span class="_ _16"> </span>for<span class="_ _16"> </span>the<span class="_ _16"> </span>buffer,<span class="_ _16"> </span>sets<span class="_ _14"> </span><span class="ffd">front<span class="_ _16"> </span></span>and<span class="_ _16"> </span><span class="ffd">rear<span class="_ _16"> </span></span>to<span class="_ _16"> </span>indicate</div><div class="t m5 x1d h26 y827b ff7 fs19 fc1 sc0 ls0 ws0">an<span class="_"> </span>empty<span class="_"> </span>buffer<span class="_ _1"></span>,<span class="_"> </span>and<span class="_"> </span>assigns<span class="_"> </span>initial<span class="_"> </span>values<span class="_"> </span>to<span class="_"> </span>the<span class="_ _13"> </span>three<span class="_"> </span>semaphores<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _1"></span>his<span class="_"> </span>function</div><div class="t m5 x1d h26 y827c ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_ _11"> </span>called<span class="_ _11"> </span>once<span class="_ _1"></span>,<span class="_ _16"> </span>before<span class="_"> </span>calls<span class="_ _11"> </span>to<span class="_ _11"> </span>any<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>other<span class="_ _11"> </span>three<span class="_ _11"> </span>functions<span class="_ _1"></span>.<span class="_ _11"> </span>T<span class="_ _0"></span>he<span class="_ _11"> </span><span class="ffd">sbuf_deinit</span></div><div class="t m5 x1d h26 y827d ff7 fs19 fc1 sc0 ls0 ws0">function<span class="_ _14"> </span>frees<span class="_ _15"> </span>the<span class="_ _14"> </span>buffer<span class="_ _15"> </span>storage<span class="_ _15"> </span>when<span class="_ _14"> </span>the<span class="_ _15"> </span>application<span class="_ _15"> </span>is<span class="_ _14"> </span>through<span class="_ _15"> </span>using<span class="_ _14"> </span>it.<span class="_ _15"> </span>T<span class="_ _0"></span>he</div><div class="t m5 x1d h26 y827e ffd fs19 fc1 sc0 ls0 ws0">sbuf_insert<span class="_ _10"> </span><span class="ff7">function<span class="_"> </span>waits<span class="_"> </span>for<span class="_"> </span>an<span class="_"> </span>available<span class="_"> </span>slot,<span class="_"> </span>locks<span class="_"> </span>the<span class="_"> </span>mutex,<span class="_"> </span>adds<span class="_"> </span>the<span class="_"> </span>item,</span></div><div class="t m5 x1d h26 y827f ff7 fs19 fc1 sc0 ls0 ws0">unlocks<span class="_"> </span>the<span class="_"> </span>mutex,<span class="_ _13"> </span>and<span class="_"> </span>then<span class="_"> </span>announces<span class="_"> </span>the<span class="_ _13"> </span>availability<span class="_"> </span>of<span class="_"> </span>a<span class="_"> </span>new<span class="_ _13"> </span>item.<span class="_"> </span>T<span class="_ _0"></span>he<span class="_"> </span><span class="ffd">sbuf_</span></div><div class="t m5 x1d h26 y8280 ffd fs19 fc1 sc0 ls0 ws0">remove<span class="_ _10"> </span><span class="ff7">function<span class="_ _11"> </span>is<span class="_"> </span>symmetric.<span class="_"> </span>After<span class="_ _11"> </span>waiting<span class="_"> </span>for<span class="_ _11"> </span>an<span class="_"> </span>available<span class="_"> </span>buffer<span class="_ _11"> </span>item,<span class="_ _11"> </span>it<span class="_"> </span>locks</span></div><div class="t m5 x1d h26 y8281 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>mutex,<span class="_ _13"> </span>removes<span class="_"> </span>the<span class="_"> </span>item<span class="_ _13"> </span>from<span class="_"> </span>the<span class="_"> </span>front<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>buffer,<span class="_ _13"> </span>unlocks<span class="_"> </span>the<span class="_"> </span>mutex,<span class="_ _13"> </span>and</div><div class="t m5 x1d h26 y8282 ff7 fs19 fc1 sc0 ls0 ws0">then<span class="_"> </span>signals<span class="_"> </span>the<span class="_"> </span>availability<span class="_"> </span>of<span class="_"> </span>a<span class="_"> </span>new<span class="_"> </span>slot.</div><div class="t m5 x1d h47 y8283 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>12.9<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>1074)</span></div><div class="t m5 x1d h26 y8284 ff7 fs19 fc1 sc0 ls0 ws0">Let<span class="_ _14"> </span><span class="ff11">p<span class="_ _15"> </span></span>denote<span class="_ _14"> </span>the<span class="_ _15"> </span>number<span class="_ _14"> </span>of<span class="_ _14"> </span>producers<span class="_ _1"></span>,<span class="_ _15"> </span><span class="ff11">c<span class="_ _15"> </span></span>the<span class="_ _14"> </span>number<span class="_ _14"> </span>of<span class="_ _15"> </span>consumers<span class="_ _1"></span>,<span class="_ _15"> </span>and<span class="_ _14"> </span><span class="ff11">n<span class="_ _14"> </span></span>the</div><div class="t m5 x1d h26 y8285 ff7 fs19 fc1 sc0 ls0 ws0">buffer<span class="_"> </span>size<span class="_"> </span>in<span class="_ _13"> </span>units<span class="_"> </span>of<span class="_"> </span>items<span class="_ _1"></span>.<span class="_"> </span>F<span class="_ _3"></span>or<span class="_"> </span>each<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>scenarios<span class="_ _3"></span>,<span class="_"> </span>indicate<span class="_"> </span>whether</div><div class="t m5 x1d h26 y8286 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>mutex<span class="_"> </span>semaphore<span class="_"> </span>in<span class="_"> </span><span class="ffd">sbuf_insert<span class="_ _10"> </span></span>and<span class="_"> </span><span class="ffd">sbuf_remove<span class="_ _10"> </span></span>is<span class="_"> </span>necessary<span class="_"> </span>or<span class="_"> </span>not.</div><div class="t m5 x124 h46 y8287 ff7 fs19 fc1 sc0 ls0 ws0">A.<span class="_ _1f"> </span><span class="ff11">p<span class="_ _10"> </span><span class="ff12">=<span class="_ _10"> </span></span></span><span class="ls25">1,<span class="_ _11"> </span></span><span class="ff11">c<span class="_ _10"> </span><span class="ff12">=<span class="_ _13"> </span></span></span><span class="ls25">1,<span class="_ _16"> </span><span class="ff11 ls42">n&gt;</span></span>1</div><div class="t m5 x124 h46 y8288 ff7 fs19 fc1 sc0 ls2a ws0">B.<span class="_ _66"> </span><span class="ff11 ls0">p<span class="_ _10"> </span><span class="ff12">=<span class="_ _10"> </span></span></span><span class="ls25">1,<span class="_ _11"> </span><span class="ff11 ls0">c<span class="_ _10"> </span><span class="ff12">=<span class="_ _10"> </span></span></span>1,<span class="_ _11"> </span><span class="ff11 ls0">n<span class="_ _13"> </span><span class="ff12">=<span class="_ _10"> </span><span class="ff7">1</span></span></span></span></div><div class="t m5 x126 h46 y8289 ff7 fs19 fc1 sc0 ls22 ws0">C.<span class="_ _24"> </span><span class="ff11 ls2f7">p&gt;</span><span class="ls25">1,<span class="_ _11"> </span><span class="ff11 ls2f8">c&gt;</span>1,<span class="_ _11"> </span><span class="ff11 ls0">n<span class="_ _13"> </span><span class="ff12">=<span class="_ _10"> </span><span class="ff7">1</span></span></span></span></div><div class="t m5 x1d h42 y3478 ff6 fs29 fc6 sc0 ls0 ws0">Readers-W<span class="_ _0"></span>riters<span class="_ _11"> </span>Problem</div><div class="t m5 x1d h26 y74e ff7 fs19 fc1 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _11"> </span><span class="ffa ls0">readers-writers<span class="_"> </span>problem<span class="_"> </span><span class="ff7">is<span class="_"> </span>a<span class="_"> </span>generalization<span class="_ _11"> </span>of<span class="_"> </span>the<span class="_"> </span>mutual<span class="_"> </span>exclusion<span class="_"> </span>problem.</span></span></div><div class="t m5 x1d h26 y74f ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_ _15"> </span>collection<span class="_ _15"> </span>of<span class="_ _15"> </span>concurrent<span class="_ _21"> </span>threads<span class="_ _15"> </span>is<span class="_ _15"> </span>accessing<span class="_ _15"> </span>a<span class="_ _21"> </span>shared<span class="_ _15"> </span>object<span class="_ _15"> </span>such<span class="_ _15"> </span>as<span class="_ _21"> </span>a<span class="_ _15"> </span>data</div><div class="t m5 x1d h26 y750 ff7 fs19 fc1 sc0 ls0 ws0">structure<span class="_ _15"> </span>in<span class="_ _15"> </span>main<span class="_ _21"> </span>memory<span class="_ _15"> </span>or<span class="_ _15"> </span>a<span class="_ _21"> </span>database<span class="_ _15"> </span>on<span class="_ _21"> </span>disk.<span class="_ _15"> </span>Some<span class="_ _15"> </span>threads<span class="_ _21"> </span>only<span class="_ _15"> </span>read<span class="_ _15"> </span>the</div><div class="t m5 x1d h26 y751 ff7 fs19 fc1 sc0 ls0 ws0">object,<span class="_ _11"> </span>while<span class="_ _16"> </span>others<span class="_ _11"> </span>modify<span class="_ _11"> </span>it.<span class="_ _16"> </span>T<span class="_ _1"></span>hreads<span class="_ _11"> </span>that<span class="_ _16"> </span>modify<span class="_ _11"> </span>the<span class="_ _11"> </span>object<span class="_ _16"> </span>are<span class="_ _11"> </span>called<span class="_ _11"> </span><span class="ffa">writers</span>.</div><div class="t m5 x1d h26 y752 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>hreads<span class="_"> </span>that<span class="_ _13"> </span>only<span class="_"> </span>read<span class="_ _13"> </span>it<span class="_ _13"> </span>are<span class="_"> </span>called<span class="_ _13"> </span><span class="ffa">readers</span>.<span class="_"> </span>Writers<span class="_ _13"> </span>must<span class="_ _13"> </span>have<span class="_"> </span>exclusive<span class="_ _13"> </span>access<span class="_"> </span>to</div><div class="t m5 x1d h26 y753 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _11"> </span>object,<span class="_ _16"> </span>but<span class="_ _16"> </span>readers<span class="_ _11"> </span>may<span class="_ _16"> </span>share<span class="_ _11"> </span>the<span class="_ _16"> </span>object<span class="_ _11"> </span>with<span class="_ _16"> </span>an<span class="_ _16"> </span>unlimited<span class="_ _11"> </span>number<span class="_ _16"> </span>of<span class="_ _11"> </span>other</div><div class="t m5 x1d h26 y754 ff7 fs19 fc1 sc0 ls0 ws0">readers<span class="_ _1"></span>.<span class="_ _16"> </span>In<span class="_ _16"> </span>general,<span class="_ _16"> </span>there<span class="_ _16"> </span>are<span class="_ _16"> </span>an<span class="_ _16"> </span>unbounded<span class="_ _16"> </span>number<span class="_ _16"> </span>of<span class="_ _16"> </span>concurrent<span class="_ _16"> </span>readers<span class="_ _16"> </span>and</div><div class="t m5 x1d h26 y755 ff7 fs19 fc1 sc0 ls0 ws0">writers<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
