<div id="pf3ca" class="pf w2 h11" data-page-no="3ca"><div class="pc pc3ca w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg3ca.png"/><div class="t m5 x1df h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>11.4<span class="_ _60"> </span>The<span class="_ _10"> </span>Sockets<span class="_ _10"> </span>Interface<span class="_ _3e"> </span><span class="ffe fs1e">969</span></div><div class="t m5 x34 h2a y548 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">What<span class="_ _11"> </span>does<span class="_ _11"> </span>the<span class="_ _11"> </span><span class="ffd fs2b">_in<span class="_ _16"> </span></span>sufﬁx<span class="_ _11"> </span>mean?</span></div><div class="t m5 x34 h2b y2d0 ff7 fs1e fc2 sc0 ls31 ws0">Th<span class="_ _2"></span>e<span class="_ _11"> </span><span class="ffd ls0">_in<span class="_ _10"> </span><span class="ff7">sufﬁx<span class="_"> </span>is<span class="_"> </span>short<span class="_"> </span>for<span class="_"> </span><span class="ffa">internet<span class="_ _2"></span></span>,<span class="_"> </span>not<span class="_"> </span><span class="ffa">input<span class="_ _2"></span></span>.</span></span></div><div class="t m5 x1e9 h2c y7b89 ffa fs16 fc2 sc0 ls0 ws0">code/netp/netpfragments<span class="_ _1"></span>.c</div><div class="t m5 x1b6 h2d y7b8a ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>IP<span class="_ _1f"> </span>socket<span class="_ _1f"> </span>address<span class="_ _e"> </span>structure<span class="_ _1f"> </span>*/</div><div class="t m5 x1b6 h2d y7b8b ffd fs1e fc2 sc0 ls0 ws0">struct<span class="_ _e"> </span>sockaddr_in<span class="_ _1a"> </span>{</div><div class="t m5 x21e h2d y7b8c ffd fs1e fc2 sc0 ls0 ws0">uint16_t<span class="_ _71"> </span>sin_family;<span class="_ _1a"> </span>/*<span class="_ _1f"> </span>Protocol<span class="_ _e"> </span>family<span class="_ _1f"> </span>(always<span class="_ _1f"> </span>AF_INET)<span class="_ _e"> </span>*/</div><div class="t m5 x21e h2d y7b8d ffd fs1e fc2 sc0 ls0 ws0">uint16_t<span class="_ _71"> </span>sin_port;<span class="_ _46"> </span>/*<span class="_ _1f"> </span>Port<span class="_ _e"> </span>number<span class="_ _1f"> </span>in<span class="_ _1f"> </span>network<span class="_ _e"> </span>byte<span class="_ _1f"> </span>order<span class="_ _e"> </span>*/</div><div class="t m5 x21e h2d y7b8e ffd fs1e fc2 sc0 ls0 ws0">struct<span class="_ _e"> </span>in_addr<span class="_ _1a"> </span>sin_addr;<span class="_ _46"> </span>/*<span class="_ _1f"> </span>IP<span class="_ _1f"> </span>address<span class="_ _e"> </span>in<span class="_ _1f"> </span>network<span class="_ _e"> </span>byte<span class="_ _1f"> </span>order<span class="_ _1f"> </span>*/</div><div class="t m5 x21e h2d y7b8f ffd fs1e fc2 sc0 ls0 ws0">unsigned<span class="_ _e"> </span>char<span class="_ _3f"> </span>sin_zero[8];<span class="_ _1f"> </span>/*<span class="_ _1f"> </span>Pad<span class="_ _e"> </span>to<span class="_ _1f"> </span>sizeof(struct<span class="_ _e"> </span>sockaddr)<span class="_ _1f"> </span>*/</div><div class="t m5 x1b6 h2d y7b90 ffd fs1e fc2 sc0 ls0 ws0">};</div><div class="t m5 x1b6 h2d y7b91 ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Generic<span class="_ _1f"> </span>socket<span class="_ _1f"> </span>address<span class="_ _e"> </span>structure<span class="_ _1f"> </span>(for<span class="_ _e"> </span>connect,<span class="_ _1f"> </span>bind,<span class="_ _1f"> </span>and<span class="_ _e"> </span>accept)<span class="_ _1f"> </span>*/</div><div class="t m5 x1b6 h2d y7b92 ffd fs1e fc2 sc0 ls0 ws0">struct<span class="_ _e"> </span>sockaddr<span class="_ _1f"> </span>{</div><div class="t m5 x21e h2d y7b93 ffd fs1e fc2 sc0 ls0 ws0">uint16_t<span class="_ _1a"> </span>sa_family;<span class="_ _7b"> </span>/*<span class="_ _1f"> </span>Protocol<span class="_ _1f"> </span>family<span class="_ _e"> </span>*/</div><div class="t m5 x21e h2d y7b94 ffd fs1e fc2 sc0 ls0 ws0">char<span class="_ _5a"> </span>sa_data[14];<span class="_ _1a"> </span>/*<span class="_ _1f"> </span>Address<span class="_ _e"> </span>data<span class="_ _1a"> </span>*/</div><div class="t m5 x1b6 h2d y7b95 ffd fs1e fc2 sc0 ls0 ws0">};</div><div class="t m5 x1e9 h2c y7b96 ffa fs16 fc2 sc0 ls0 ws0">code/netp/netpfragments<span class="_ _1"></span>.c</div><div class="t m5 x17 h2f y7b97 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>11.13<span class="_ _66"> </span><span class="fc1">Socket<span class="_"> </span>address<span class="_"> </span>structures.</span></div><div class="t m5 x17 h41 y7b98 ffe fs29 fc1 sc0 ls0 ws0">11.4.1</div><div class="t m5 x1da h43 y7b99 ffe fs19 fc1 sc0 ls0 ws0">Socket<span class="_"> </span>Address<span class="_"> </span>Structures</div><div class="t m5 x17 h26 y7b9a ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>rom<span class="_ _11"> </span>the<span class="_"> </span>perspective<span class="_ _11"> </span>of<span class="_"> </span>the<span class="_ _11"> </span>Linux<span class="_"> </span>kernel,<span class="_ _11"> </span>a<span class="_"> </span>socket<span class="_ _11"> </span>is<span class="_"> </span>an<span class="_ _11"> </span>end<span class="_"> </span>point<span class="_ _11"> </span>for<span class="_"> </span>communi-</div><div class="t m5 x17 h26 y7b9b ff7 fs19 fc1 sc0 ls0 ws0">cation.<span class="_ _11"> </span>From<span class="_"> </span>the<span class="_ _16"> </span>perspective<span class="_ _11"> </span>of<span class="_ _16"> </span>a<span class="_ _11"> </span>Linux<span class="_ _11"> </span>program,<span class="_ _16"> </span>a<span class="_ _11"> </span>socket<span class="_ _16"> </span>is<span class="_ _11"> </span>an<span class="_ _16"> </span>open<span class="_ _11"> </span>ﬁle<span class="_ _11"> </span>with<span class="_ _16"> </span>a</div><div class="t m5 x17 h26 y7b9c ff7 fs19 fc1 sc0 ls0 ws0">corresponding<span class="_"> </span>descriptor.</div><div class="t m5 x26 h26 y7b9d ff7 fs19 fc1 sc0 ls0 ws0">Internet<span class="_ _15"> </span>socket<span class="_ _21"> </span>addresses<span class="_ _15"> </span>are<span class="_ _21"> </span>stored<span class="_ _15"> </span>in<span class="_ _21"> </span>16-byte<span class="_ _15"> </span>structures<span class="_ _21"> </span>having<span class="_ _15"> </span>the<span class="_ _21"> </span>type</div><div class="t m5 x17 h26 y7b9e ffd fs19 fc1 sc0 ls0 ws0">sockaddr_in<span class="ff7">,<span class="_ _16"> </span>shown<span class="_ _16"> </span>in<span class="_ _11"> </span>Figure<span class="_ _11"> </span>11.13.<span class="_ _16"> </span>F<span class="_ _1"></span>or<span class="_ _11"> </span>Internet<span class="_ _16"> </span>applications<span class="_ _1"></span>,<span class="_ _16"> </span>the<span class="_ _16"> </span><span class="ffd">sin_family</span></span></div><div class="t m5 x17 h26 y7b9f ff7 fs19 fc1 sc0 ls0 ws0">ﬁeld<span class="_ _11"> </span>is<span class="_ _16"> </span>AF_INET<span class="_ _7"></span>,<span class="_ _16"> </span>the<span class="_ _11"> </span><span class="ffd">sin_port<span class="_ _11"> </span></span>ﬁeld<span class="_ _16"> </span>is<span class="_ _11"> </span>a<span class="_ _11"> </span>16-bit<span class="_ _16"> </span>port<span class="_ _11"> </span>number,<span class="_ _11"> </span>and<span class="_ _16"> </span>the<span class="_ _11"> </span><span class="ffd">sin_addr</span></div><div class="t m5 x17 h26 y7ba0 ff7 fs19 fc1 sc0 ls0 ws0">ﬁeld<span class="_ _14"> </span>contains<span class="_ _15"> </span>a<span class="_ _15"> </span>32-bit<span class="_ _14"> </span>IP<span class="_ _15"> </span>address<span class="_ _1"></span>.<span class="_ _15"> </span>T<span class="_ _1"></span>he<span class="_ _15"> </span>IP<span class="_ _15"> </span>address<span class="_ _14"> </span>and<span class="_ _15"> </span>port<span class="_ _15"> </span>number<span class="_ _15"> </span>are<span class="_ _14"> </span>always</div><div class="t m5 x17 h26 y7ba1 ff7 fs19 fc1 sc0 ls0 ws0">stored<span class="_"> </span>in<span class="_"> </span>network<span class="_"> </span>(big-endian)<span class="_"> </span>byte<span class="_"> </span>order.</div><div class="t m5 x26 h26 y7ba2 ff7 fs19 fc1 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _21"> </span><span class="ffd ls0">connect<span class="ff7">,<span class="_ _15"> </span></span>bind<span class="ff7">,<span class="_ _21"> </span>and<span class="_ _15"> </span></span>accept<span class="_ _14"> </span><span class="ff7">functions<span class="_ _15"> </span>require<span class="_ _15"> </span>a<span class="_ _14"> </span>pointer<span class="_ _15"> </span>to<span class="_ _14"> </span>a<span class="_ _15"> </span>protocol-</span></span></div><div class="t m5 x17 h26 y7ba3 ff7 fs19 fc1 sc0 ls0 ws0">speciﬁc<span class="_ _6"> </span>socket<span class="_ _6"> </span>address<span class="_ _6"> </span>structure<span class="_ _0"></span>.<span class="_ _6"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span>problem<span class="_ _a"> </span>faced<span class="_ _6"> </span>by<span class="_ _6"> </span>the<span class="_ _6"> </span>designers<span class="_ _6"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>sockets</div><div class="t m5 x17 h26 y7ba4 ff7 fs19 fc1 sc0 ls0 ws0">interface<span class="_"> </span>was<span class="_ _11"> </span>how<span class="_ _11"> </span>to<span class="_ _11"> </span>deﬁne<span class="_ _11"> </span>these<span class="_ _11"> </span>functions<span class="_ _11"> </span>to<span class="_ _11"> </span>accept<span class="_ _11"> </span>any<span class="_ _11"> </span>kind<span class="_ _11"> </span>of<span class="_ _11"> </span>socket<span class="_ _11"> </span>address</div><div class="t m5 x17 h26 y7ba5 ff7 fs19 fc1 sc0 ls0 ws0">structure<span class="_ _1"></span>.<span class="_ _11"> </span>T<span class="_ _3"></span>oday<span class="_ _7"></span>,<span class="_ _11"> </span>we<span class="_ _11"> </span>would<span class="_"> </span>use<span class="_ _11"> </span>the<span class="_"> </span>generic<span class="_"> </span><span class="ffd">void<span class="_ _16"> </span>*<span class="_ _11"> </span></span>pointer,<span class="_"> </span>which<span class="_"> </span>did<span class="_"> </span>not<span class="_ _11"> </span>exist<span class="_"> </span>in</div><div class="t m5 x17 h26 y7ba6 ff7 fs19 fc1 sc0 ls0 ws0">C<span class="_ _13"> </span>at<span class="_ _13"> </span>that<span class="_ _13"> </span>time<span class="_ _1"></span>.<span class="_ _13"> </span>T<span class="_ _1"></span>heir<span class="_ _13"> </span>solution<span class="_ _13"> </span>was<span class="_ _13"> </span>to<span class="_ _13"> </span>deﬁne<span class="_ _13"> </span>sockets<span class="_ _6"> </span>functions<span class="_ _13"> </span>to<span class="_ _13"> </span>expect<span class="_ _13"> </span>a<span class="_ _13"> </span>pointer<span class="_ _13"> </span>to</div><div class="t m5 x17 h26 y7ba7 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_"> </span>generic<span class="_"> </span><span class="ffd">sockaddr<span class="_ _10"> </span></span>structure<span class="_"> </span>(F<span class="_ _1"></span>igure<span class="_"> </span>11.13)<span class="_"> </span>and<span class="_"> </span>then<span class="_"> </span>require<span class="_"> </span>applications<span class="_"> </span>to<span class="_"> </span>cast</div><div class="t m5 x17 h26 y7ba8 ff7 fs19 fc1 sc0 ls0 ws0">any<span class="_ _16"> </span>pointers<span class="_ _11"> </span>to<span class="_ _16"> </span>protocol-speciﬁc<span class="_ _16"> </span>structures<span class="_ _16"> </span>to<span class="_ _16"> </span>this<span class="_ _11"> </span>generic<span class="_ _16"> </span>structure.<span class="_ _11"> </span>T<span class="_ _3"></span>o<span class="_ _11"> </span>simplify</div><div class="t m5 x17 h26 y7ba9 ff7 fs19 fc1 sc0 ls0 ws0">our<span class="_"> </span>code<span class="_"> </span>examples<span class="_ _1"></span>,<span class="_"> </span>we<span class="_"> </span>follow<span class="_"> </span>Stevens’s<span class="_"> </span>lead<span class="_"> </span>and<span class="_"> </span>deﬁne<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>type:</div><div class="t m5 x17 h2d y77e ffd fs1e fc2 sc0 ls0 ws0">typedef<span class="_ _e"> </span>struct<span class="_ _1f"> </span>sockaddr<span class="_ _1f"> </span>SA;</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
