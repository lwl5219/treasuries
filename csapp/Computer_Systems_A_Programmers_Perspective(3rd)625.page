<div id="pf271" class="pf w2 h11" data-page-no="271"><div class="pc pc271 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg271.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">624<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>6<span class="_ _3d"> </span>The<span class="_ _10"> </span>Memory<span class="_ _10"> </span>Hierarchy</span></div><div class="t m5 x28 h2a y257 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">A<span class="_ _11"> </span>note<span class="_ _11"> </span>on<span class="_ _11"> </span>bus<span class="_ _16"> </span>designs</span></div><div class="t m5 x28 h2b y2d0 ff7 fs1e fc2 sc0 ls0 ws0">Bus<span class="_"> </span>design<span class="_ _10"> </span>is<span class="_ _10"> </span>a<span class="_ _11"> </span>complex<span class="_"> </span>and<span class="_ _10"> </span>rapidly<span class="_ _10"> </span>changing<span class="_ _11"> </span>aspect<span class="_"> </span>of<span class="_ _10"> </span>computer<span class="_ _10"> </span>systems<span class="_ _0"></span>.<span class="_"> </span>Different<span class="_ _10"> </span>vendors<span class="_ _11"> </span>develop</div><div class="t m5 x28 h2b y2d1 ff7 fs1e fc2 sc0 ls0 ws0">different<span class="_ _13"> </span>bus<span class="_ _13"> </span>architectures<span class="_ _6"> </span>as<span class="_ _13"> </span>a<span class="_ _13"> </span>way<span class="_ _13"> </span>to<span class="_ _6"> </span>differentiate<span class="_ _13"> </span>their<span class="_ _13"> </span>products<span class="_ _1"></span>.<span class="_ _13"> </span>F<span class="_ _3"></span>or<span class="_ _13"> </span>example<span class="_ _0"></span>,<span class="_ _13"> </span>some<span class="_ _13"> </span>Intel<span class="_ _13"> </span>systems<span class="_ _6"> </span>use</div><div class="t m5 x28 h2b y2d2 ff7 fs1e fc2 sc0 ls0 ws0">chipsets<span class="_ _13"> </span>known<span class="_ _13"> </span>as<span class="_ _6"> </span>the<span class="_ _13"> </span><span class="ffa">northbridge<span class="_ _13"> </span></span>and<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ffa">southbridge<span class="_ _6"> </span></span>to<span class="_ _13"> </span>connect<span class="_ _13"> </span>the<span class="_ _13"> </span>CPU<span class="_ _13"> </span>to<span class="_ _6"> </span>memory<span class="_ _13"> </span>and<span class="_ _13"> </span>I/O<span class="_ _13"> </span>devices<span class="_ _3"></span>,</div><div class="t m5 x28 h2b y2d3 ff7 fs1e fc2 sc0 ls0 ws0">respectively<span class="_ _3"></span>.<span class="_ _16"> </span>In<span class="_ _16"> </span>older<span class="_ _16"> </span>Pentium<span class="_ _16"> </span>and<span class="_ _16"> </span>Core<span class="_ _16"> </span>2<span class="_ _16"> </span>systems<span class="_ _1"></span>,<span class="_ _14"> </span>a<span class="_ _16"> </span><span class="ffa">front<span class="_ _16"> </span>side<span class="_ _16"> </span>bus<span class="_ _14"> </span></span>(FSB)<span class="_ _16"> </span>connects<span class="_ _16"> </span>the<span class="_ _16"> </span>CPU<span class="_ _16"> </span>to<span class="_ _16"> </span>the</div><div class="t m5 x28 h2b y2d4 ff7 fs1e fc2 sc0 ls0 ws0">northbridge<span class="_ _1"></span>.<span class="_"> </span>Systems<span class="_"> </span>from<span class="_ _13"> </span>AMD<span class="_"> </span>replace<span class="_ _13"> </span>the<span class="_"> </span>FSB<span class="_"> </span>with<span class="_ _13"> </span>the<span class="_"> </span><span class="ffa">HyperT<span class="_ _3"></span>ransport<span class="_ _10"> </span><span class="ff7">interconnect,<span class="_"> </span>while<span class="_"> </span>newer</span></span></div><div class="t m5 x28 h2b y2d5 ff7 fs1e fc2 sc0 ls0 ws0">Intel<span class="_"> </span>Core<span class="_ _11"> </span>i7<span class="_"> </span>systems<span class="_ _11"> </span>use<span class="_"> </span>the<span class="_ _10"> </span><span class="ffa">QuickP<span class="_ _1"></span>ath<span class="_"> </span><span class="ff7">interconnect.<span class="_ _11"> </span>T<span class="_ _1"></span>he<span class="_ _11"> </span>details<span class="_"> </span>of<span class="_ _11"> </span>these<span class="_"> </span>different<span class="_ _11"> </span>bus<span class="_"> </span>architectures</span></span></div><div class="t m5 x28 h2b y2d6 ff7 fs1e fc2 sc0 ls0 ws0">are<span class="_ _10"> </span>beyond<span class="_ _11"> </span>the<span class="_ _11"> </span>scope<span class="_"> </span>of<span class="_ _11"> </span>this<span class="_ _11"> </span>text.<span class="_"> </span>Instead,<span class="_ _11"> </span>we<span class="_ _11"> </span>will<span class="_ _10"> </span>use<span class="_ _11"> </span>the<span class="_ _11"> </span>high-level<span class="_ _10"> </span>bus<span class="_ _11"> </span>architecture<span class="_ _11"> </span>from<span class="_"> </span>Figure<span class="_"> </span>6.6</div><div class="t m5 x28 h2b y549 ff7 fs1e fc2 sc0 ls0 ws0">as<span class="_"> </span>a<span class="_"> </span>running<span class="_"> </span>example<span class="_"> </span>throughout.<span class="_"> </span>It<span class="_ _10"> </span>is<span class="_ _10"> </span>a<span class="_"> </span>simple<span class="_ _10"> </span>but<span class="_"> </span>useful<span class="_ _10"> </span>abstraction<span class="_ _10"> </span>that<span class="_"> </span>allows<span class="_ _10"> </span>us<span class="_ _10"> </span>to<span class="_"> </span>be<span class="_ _10"> </span>concrete.<span class="_"> </span>It</div><div class="t m5 x28 h2b y54a ff7 fs1e fc2 sc0 ls0 ws0">captures<span class="_"> </span>the<span class="_"> </span>main<span class="_"> </span>ideas<span class="_"> </span>without<span class="_"> </span>being<span class="_"> </span>tied<span class="_"> </span>too<span class="_"> </span>closely<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>detail<span class="_"> </span>of<span class="_"> </span>any<span class="_"> </span>proprietary<span class="_"> </span>designs<span class="_ _1"></span>.</div><div class="t m5 x14 h2f y5320 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>6.6</div><div class="t m5 x14 h2f y5321 ffe fs16 fc1 sc0 ls0 ws0">Example<span class="_ _16"> </span>bus<span class="_ _16"> </span>structure</div><div class="t m5 x14 h2f y5322 ffe fs16 fc1 sc0 ls0 ws0">that<span class="_ _16"> </span>connects<span class="_ _16"> </span>the<span class="_ _16"> </span>CPU</div><div class="t m5 x14 h2f y5323 ffe fs16 fc1 sc0 ls0 ws0">and<span class="_"> </span>main<span class="_"> </span>memory<span class="_ _1"></span>.</div><div class="t m5 xe0 h3f y5324 ff74 fs27 fc1 sc0 ls0 ws0">CPU chip</div><div class="t m5 x183 h3f y5325 ff74 fs27 fc1 sc0 ls0 ws0">Register file</div><div class="t m5 x118 h3f y5326 ff74 fs27 fc1 sc0 ls0 ws0">System bus</div><div class="t m5 xdf h3f y5327 ff74 fs27 fc1 sc0 ls0 ws0">Memory bus</div><div class="t m5 x11d h3f y5328 ff74 fs27 fc1 sc0 ls0 ws0">Main</div><div class="t m5 x111 h3f y5329 ff74 fs27 fc1 sc0 ls0 ws0">memory</div><div class="t m5 x7c h3f y532a ff74 fs27 fc1 sc0 ls0 ws0">Bus interface</div><div class="t m5 xfb h3f y532b ff74 fs27 fc1 sc0 ls0 ws0">I/O</div><div class="t m5 x1b4 h3f y532c ff74 fs27 fc1 sc0 ls0 ws0">bridge</div><div class="t m5 x88 h3f y532d ff74 fs27 fc1 sc0 ls0 ws0">ALU</div><div class="t m5 x1d h26 y532e ff7 fs19 fc1 sc0 ls0 ws0">bridge<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>main<span class="_"> </span>memory<span class="_ _7"></span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>I/O<span class="_"> </span>bridge<span class="_"> </span>translates<span class="_"> </span>the<span class="_"> </span>electrical<span class="_"> </span>signals<span class="_ _13"> </span>of<span class="_"> </span>the</div><div class="t m5 x1d h26 y532f ff7 fs19 fc1 sc0 ls0 ws0">system<span class="_ _11"> </span>bus<span class="_ _11"> </span>into<span class="_ _16"> </span>the<span class="_ _11"> </span>electrical<span class="_ _11"> </span>signals<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>memory<span class="_ _16"> </span>bus<span class="_ _3"></span>.<span class="_ _16"> </span>As<span class="_ _11"> </span>we<span class="_ _11"> </span>will<span class="_ _16"> </span>see<span class="_ _1"></span>,<span class="_ _16"> </span>the<span class="_ _11"> </span>I/O</div><div class="t m5 x1d h26 y5330 ff7 fs19 fc1 sc0 ls0 ws0">bridge<span class="_"> </span>also<span class="_"> </span>connects<span class="_"> </span>the<span class="_"> </span>system<span class="_"> </span>bus<span class="_"> </span>and<span class="_"> </span>memory<span class="_"> </span>bus<span class="_"> </span>to<span class="_"> </span>an<span class="_"> </span><span class="ffa">I/O<span class="_"> </span>bus<span class="_"> </span></span>that<span class="_"> </span>is<span class="_"> </span>shared</div><div class="t m5 x1d h26 y5331 ff7 fs19 fc1 sc0 ls0 ws0">by<span class="_"> </span>I/O<span class="_ _13"> </span>devices<span class="_"> </span>such<span class="_ _13"> </span>as<span class="_"> </span>disks<span class="_ _13"> </span>and<span class="_"> </span>graphics<span class="_ _13"> </span>cards<span class="_ _1"></span>.<span class="_"> </span>F<span class="_ _1"></span>or<span class="_"> </span>now<span class="_ _7"></span>,<span class="_"> </span>though,<span class="_ _13"> </span>we<span class="_"> </span>will<span class="_ _13"> </span>focus<span class="_"> </span>on</div><div class="t m5 x1d h26 y5332 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>memory<span class="_"> </span>bus<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y5333 ff7 fs19 fc1 sc0 ls0 ws0">Consider<span class="_"> </span>what<span class="_"> </span>happens<span class="_"> </span>when<span class="_"> </span>the<span class="_"> </span>CPU<span class="_"> </span>performs<span class="_"> </span>a<span class="_"> </span>load<span class="_"> </span>operation<span class="_"> </span>such<span class="_"> </span>as</div><div class="t m5 x10c h2d y5334 ffd fs1e fc2 sc0 ls0 ws0">movq<span class="_ _e"> </span>A,%rax</div><div class="t m5 x1d h26 y5335 ff7 fs19 fc2 sc0 ls0 ws0">where<span class="_ _16"> </span>the<span class="_ _16"> </span>contents<span class="_ _16"> </span>of<span class="_ _16"> </span>address<span class="_ _16"> </span><span class="ff11">A<span class="_"> </span></span>are<span class="_ _16"> </span>loaded<span class="_ _16"> </span>into<span class="_ _16"> </span>register<span class="_ _16"> </span><span class="ffd">%rax</span>.<span class="_ _16"> </span>Circuitry<span class="_ _16"> </span>on<span class="_ _16"> </span>the</div><div class="t m5 x1d h26 y5336 ff7 fs19 fc2 sc0 ls0 ws0">CPU<span class="_ _15"> </span>chip<span class="_ _21"> </span>called<span class="_ _15"> </span>the<span class="_ _21"> </span><span class="ffa">bus<span class="_ _21"> </span>interface<span class="_ _21"> </span></span>initiates<span class="_ _15"> </span>a<span class="_ _21"> </span>read<span class="_ _21"> </span>transaction<span class="_ _15"> </span>on<span class="_ _21"> </span>the<span class="_ _15"> </span>bus<span class="_ _0"></span>.<span class="_ _15"> </span>T<span class="_ _0"></span>he</div><div class="t m5 x1d h26 y5337 ff7 fs19 fc2 sc0 ls0 ws0">read<span class="_ _f"> </span>transaction<span class="_ _e"> </span>consists<span class="_ _21"> </span>of<span class="_ _e"> </span>three<span class="_ _f"> </span>steps<span class="_ _1"></span>.<span class="_ _f"> </span>First,<span class="_ _e"> </span>the<span class="_ _f"> </span>CPU<span class="_ _f"> </span>places<span class="_ _e"> </span>the<span class="_ _f"> </span>address<span class="_ _f"> </span><span class="ff11">A</span></div><div class="t m5 x1d h26 y5338 ff7 fs19 fc2 sc0 ls0 ws0">on<span class="_ _15"> </span>the<span class="_ _15"> </span>system<span class="_ _15"> </span>bus<span class="_ _1"></span>.<span class="_ _15"> </span>The<span class="_ _14"> </span>I/O<span class="_ _15"> </span>bridge<span class="_ _15"> </span>passes<span class="_ _21"> </span>the<span class="_ _15"> </span>signal<span class="_ _15"> </span>along<span class="_ _15"> </span>to<span class="_ _15"> </span>the<span class="_ _21"> </span>memory<span class="_ _15"> </span>bus</div><div class="t m5 x1d h26 y5339 ff7 fs19 fc2 sc0 ls0 ws0">(F<span class="_ _1"></span>igure<span class="_"> </span>6.7(a)).<span class="_"> </span>Next,<span class="_"> </span>the<span class="_"> </span>main<span class="_"> </span>memory<span class="_"> </span>senses<span class="_ _13"> </span>the<span class="_"> </span>address<span class="_"> </span>signal<span class="_"> </span>on<span class="_"> </span>the<span class="_"> </span>memory</div><div class="t m5 x1d h26 y533a ff7 fs19 fc2 sc0 ls0 ws0">bus<span class="_ _1"></span>,<span class="_ _16"> </span>reads<span class="_ _11"> </span>the<span class="_ _11"> </span>address<span class="_ _16"> </span>from<span class="_ _11"> </span>the<span class="_ _16"> </span>memory<span class="_ _11"> </span>bus<span class="_ _1"></span>,<span class="_ _16"> </span>fetches<span class="_ _11"> </span>the<span class="_ _16"> </span>data<span class="_ _11"> </span>from<span class="_ _11"> </span>the<span class="_ _16"> </span>DRAM,</div><div class="t m5 x1d h26 y533b ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_ _13"> </span>writes<span class="_"> </span>the<span class="_ _13"> </span>data<span class="_"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>memory<span class="_"> </span>bus<span class="_ _3"></span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>I/O<span class="_ _13"> </span>bridge<span class="_ _13"> </span>translates<span class="_"> </span>the<span class="_ _13"> </span>memory<span class="_"> </span>bus</div><div class="t m5 x1d h26 y533c ff7 fs19 fc2 sc0 ls0 ws0">signal<span class="_ _13"> </span>into<span class="_ _6"> </span>a<span class="_ _13"> </span>system<span class="_ _6"> </span>bus<span class="_ _13"> </span>signal<span class="_ _6"> </span>and<span class="_ _13"> </span>passes<span class="_ _6"> </span>it<span class="_ _13"> </span>along<span class="_ _6"> </span>to<span class="_ _13"> </span>the<span class="_ _6"> </span>system<span class="_ _13"> </span>bus<span class="_ _6"> </span>(Figure<span class="_ _6"> </span>6.7(b)).</div><div class="t m5 x1d h26 y533d ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>inally<span class="_ _3"></span>,<span class="_ _11"> </span>the<span class="_ _11"> </span>CPU<span class="_ _11"> </span>senses<span class="_ _16"> </span>the<span class="_"> </span>data<span class="_ _11"> </span>on<span class="_ _11"> </span>the<span class="_ _11"> </span>system<span class="_ _11"> </span>bus<span class="_ _1"></span>,<span class="_ _16"> </span>reads<span class="_"> </span>the<span class="_ _11"> </span>data<span class="_ _11"> </span>from<span class="_ _11"> </span>the<span class="_ _11"> </span>bus<span class="_ _1"></span>,</div><div class="t m5 x1d h26 y533e ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_"> </span>copies<span class="_"> </span>the<span class="_"> </span>data<span class="_"> </span>to<span class="_"> </span>register<span class="_"> </span><span class="ffd">%rax<span class="_ _10"> </span></span>(F<span class="_ _0"></span>igure<span class="_"> </span>6.7(c)).</div><div class="t m5 x29 h26 y533f ff7 fs19 fc2 sc0 ls0 ws0">Conversely<span class="_ _3"></span>,<span class="_"> </span>when<span class="_"> </span>the<span class="_"> </span>CPU<span class="_"> </span>performs<span class="_"> </span>a<span class="_"> </span>store<span class="_"> </span>operation<span class="_"> </span>such<span class="_"> </span>as</div><div class="t m5 x10c h2d y271e ffd fs1e fc2 sc0 ls0 ws0">movq<span class="_ _e"> </span>%rax,A</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
