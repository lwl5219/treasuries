<div id="pf104" class="pf w2 h11" data-page-no="104"><div class="pc pc104 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg104.png"/><div class="t m5 x1dc h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>3.6<span class="_ _60"> </span>Control<span class="_ _3e"> </span><span class="ffe fs1e">259</span></div><div class="t m5 x2e h61 ye7 ff13 fs35 fc6 sc0 ls0 ws0">short<span class="_ _f"> </span>dw_loop(short<span class="_ _f"> </span>x)</div><div class="t m5 x2e h61 y26dc ff13 fs35 fc6 sc0 ls0 ws0">x<span class="_ _f"> </span>initially<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi</div><div class="t m5 x2c h2d yecb ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">dw_loop:</span></div><div class="t m5 x2c h2d yecc ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rdi,<span class="_ _e"> </span>%rbx</span></div><div class="t m5 x2c h2d yecd ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rdi,<span class="_ _e"> </span>%rcx</span></div><div class="t m5 x2c h2d yece ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">idivq<span class="_ _3f"> </span>$9,<span class="_ _e"> </span>%rcx</span></div><div class="t m5 x2c h2d yecf ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">leaq<span class="_ _46"> </span>(,%rdi,4),<span class="_ _e"> </span>%rdx</span></div><div class="t m5 x2c h2d yed0 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L2:</span></div><div class="t m5 x2c h2e y20fe ff6 fs20 fc6 sc0 ls0 ws0">7</div><div class="t m5 xd1 h2d y1a10 ffd fs1e fc2 sc0 ls0 ws0">leaq<span class="_ _46"> </span>5(%rbx,%rcx),<span class="_ _e"> </span>%rcx</div><div class="t m5 x2c h2d yed3 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _45"> </span><span class="ffd fs1e fc2">subq<span class="_ _46"> </span>$1,<span class="_ _e"> </span>%rdx</span></div><div class="t m5 x2c h2d yed4 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _45"> </span><span class="ffd fs1e fc2">testq<span class="_ _3f"> </span>%rdx,<span class="_ _e"> </span>%rdx</span></div><div class="t m5 x17 h2d y462 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _45"> </span><span class="ffd fs1e fc2">jg<span class="_ _5a"> </span>.L2</span></div><div class="t m5 x17 h2d y26dd ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _45"> </span><span class="ffd fs1e fc2">rep;<span class="_ _e"> </span>ret</span></div><div class="t m5 x34 h26 y26de ff7 fs19 fc2 sc0 ls0 ws0">A.<span class="_ _1f"> </span>Which<span class="_"> </span>registers<span class="_"> </span>are<span class="_"> </span>used<span class="_"> </span>to<span class="_"> </span>hold<span class="_"> </span>program<span class="_"> </span>values<span class="_"> </span><span class="ffd">x</span>,<span class="_"> </span><span class="ffd">y</span>,<span class="_"> </span>and<span class="_"> </span><span class="ffd">n</span>?</div><div class="t m5 x34 h26 y26df ff7 fs19 fc2 sc0 ls0 ws0">B<span class="_ _3"></span>.<span class="_ _1d"> </span>How<span class="_ _14"> </span>has<span class="_ _14"> </span>the<span class="_ _16"> </span>compiler<span class="_ _14"> </span>eliminated<span class="_ _14"> </span>the<span class="_ _16"> </span>need<span class="_ _14"> </span>for<span class="_ _14"> </span>pointer<span class="_ _16"> </span>variable<span class="_ _14"> </span><span class="ffd">p<span class="_ _14"> </span></span>and<span class="_ _14"> </span>the</div><div class="t m5 x2d h26 y26e0 ff7 fs19 fc2 sc0 ls0 ws0">pointer<span class="_"> </span>dereferencing<span class="_"> </span>implied<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span>expression<span class="_"> </span><span class="ffd">(*p)+=5</span>?</div><div class="t m5 x34 h26 y26e1 ff7 fs19 fc2 sc0 ls0 ws0">C.<span class="_ _25"> </span>Add<span class="_"> </span>annotations<span class="_"> </span>to<span class="_ _11"> </span>the<span class="_"> </span>assembly<span class="_ _11"> </span>code<span class="_"> </span>describing<span class="_ _11"> </span>the<span class="_"> </span>operation<span class="_ _11"> </span>of<span class="_"> </span>the<span class="_"> </span>pro-</div><div class="t m5 x2d h26 y26e2 ff7 fs19 fc2 sc0 ls0 ws0">gram,<span class="_"> </span>similar<span class="_"> </span>to<span class="_"> </span>those<span class="_"> </span>shown<span class="_"> </span>in<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>3.19(c).</div><div class="t m5 x17 h42 y26e3 ff6 fs29 fc6 sc0 ls0 ws0">While<span class="_ _11"> </span>Loops</div><div class="t m5 x17 h26 y26e4 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>general<span class="_"> </span>form<span class="_"> </span>of<span class="_"> </span>a<span class="_"> </span><span class="ffd">while<span class="_ _10"> </span></span>statement<span class="_"> </span>is<span class="_"> </span>as<span class="_"> </span>follows:</div><div class="t m5 x17 h53 y26e5 ffd fs1e fc2 sc0 ls0 ws0">while<span class="_ _e"> </span>(<span class="ffa">test-expr<span class="_ _2"></span></span>)</div><div class="t m5 x1b6 h53 y26e6 ffa fs1e fc2 sc0 ls0 ws0">body-statement</div><div class="t m5 x17 h26 y26e7 ff7 fs19 fc2 sc0 ls0 ws0">It<span class="_ _11"> </span>differs<span class="_ _16"> </span>from<span class="_ _11"> </span><span class="ffd">do</span>-<span class="ffd">while<span class="_ _16"> </span></span>in<span class="_ _11"> </span>that<span class="_ _11"> </span><span class="ffa">test-expr<span class="_ _14"> </span></span>is<span class="_ _11"> </span>evaluated<span class="_ _16"> </span>and<span class="_ _11"> </span>the<span class="_ _16"> </span>loop<span class="_ _11"> </span>is<span class="_ _16"> </span>potentially</div><div class="t m5 x17 h26 y26e8 ff7 fs19 fc2 sc0 ls0 ws0">terminated<span class="_ _16"> </span>before<span class="_ _16"> </span>the<span class="_ _16"> </span>ﬁrst<span class="_ _16"> </span>execution<span class="_ _16"> </span>of<span class="_ _16"> </span><span class="ffa">body-statement<span class="_ _2"></span></span>.<span class="_ _16"> </span>There<span class="_ _11"> </span>are<span class="_ _16"> </span>a<span class="_ _16"> </span>number<span class="_ _16"> </span>of</div><div class="t m5 x17 h26 y26e9 ff7 fs19 fc2 sc0 ls0 ws0">ways<span class="_"> </span>to<span class="_ _11"> </span>translate<span class="_"> </span>a<span class="_ _11"> </span><span class="ffd">while<span class="_ _10"> </span></span>loop<span class="_ _11"> </span>into<span class="_"> </span>machine<span class="_ _11"> </span>code<span class="_ _0"></span>,<span class="_"> </span>two<span class="_ _11"> </span>of<span class="_"> </span>which<span class="_ _11"> </span>are<span class="_"> </span>used<span class="_ _11"> </span>in<span class="_"> </span>code</div><div class="t m5 x17 h26 y26ea ff7 fs19 fc2 sc0 ls0 ws0">generated<span class="_"> </span>by<span class="_ _13"> </span><span class="ff9">gcc</span>.<span class="_"> </span>Both<span class="_ _13"> </span>use<span class="_"> </span>the<span class="_ _13"> </span>same<span class="_"> </span>loop<span class="_"> </span>structure<span class="_ _13"> </span>as<span class="_"> </span>we<span class="_ _13"> </span>saw<span class="_"> </span>for<span class="_"> </span><span class="ffd">do</span>-<span class="ffd">while<span class="_ _13"> </span></span>loops</div><div class="t m5 x17 h26 y26eb ff7 fs19 fc2 sc0 ls0 ws0">but<span class="_"> </span>differ<span class="_"> </span>in<span class="_"> </span>how<span class="_"> </span>to<span class="_"> </span>implement<span class="_"> </span>the<span class="_"> </span>initial<span class="_"> </span>test.</div><div class="t m5 x26 h26 y26ec ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _16"> </span>ﬁrst<span class="_ _11"> </span>translation<span class="_ _16"> </span>method,<span class="_ _11"> </span>which<span class="_ _16"> </span>we<span class="_ _11"> </span>refer<span class="_ _11"> </span>to<span class="_ _16"> </span>as<span class="_ _11"> </span><span class="ffa">jump<span class="_ _16"> </span>to<span class="_ _11"> </span>middle</span>,<span class="_ _16"> </span>performs</div><div class="t m5 x17 h26 y26ed ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _11"> </span>initial<span class="_ _11"> </span>test<span class="_ _11"> </span>by<span class="_ _11"> </span>performing<span class="_ _11"> </span>an<span class="_ _11"> </span>unconditional<span class="_ _11"> </span>jump<span class="_ _11"> </span>to<span class="_ _11"> </span>the<span class="_ _16"> </span>test<span class="_"> </span>at<span class="_ _11"> </span>the<span class="_ _11"> </span>end<span class="_ _11"> </span>of<span class="_ _16"> </span>the</div><div class="t m5 x17 h26 y26ee ff7 fs19 fc2 sc0 ls0 ws0">loop<span class="_ _1"></span>.<span class="_ _13"> </span>It<span class="_ _a"> </span>can<span class="_ _13"> </span>be<span class="_ _6"> </span>expressed<span class="_ _6"> </span>by<span class="_ _13"> </span>the<span class="_ _a"> </span>following<span class="_ _13"> </span>template<span class="_ _a"> </span>for<span class="_ _13"> </span>translating<span class="_ _6"> </span>from<span class="_ _6"> </span>the<span class="_ _13"> </span>general</div><div class="t m5 x17 h26 y26ef ffd fs19 fc2 sc0 ls0 ws0">while<span class="_ _10"> </span><span class="ff7">loop<span class="_"> </span>form<span class="_"> </span>to<span class="_"> </span>goto<span class="_"> </span>code:</span></div><div class="t m5 x1b6 h2d y26f0 ffd fs1e fc2 sc0 ls0 ws0">goto<span class="_ _e"> </span>test;</div><div class="t m5 x17 h2d y26f1 ffd fs1e fc2 sc0 ls0 ws0">loop:</div><div class="t m5 x1b6 h53 y26f2 ffa fs1e fc2 sc0 ls0 ws0">body-statement</div><div class="t m5 x17 h2d y26f3 ffd fs1e fc2 sc0 ls0 ws0">test:</div><div class="t m5 x1b6 h53 y26f4 ffd fs1e fc2 sc0 ls33 ws0">t=<span class="ffa ls0">test-expr<span class="_ _2"></span><span class="ffd">;</span></span></div><div class="t m5 x1b6 h2d y26f5 ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>(t)</div><div class="t m5 x21e h2d y26f6 ffd fs1e fc2 sc0 ls0 ws0">goto<span class="_ _e"> </span>loop;</div><div class="t m5 x26 h26 y77e ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_ _13"> </span>an<span class="_ _13"> </span>example,<span class="_ _13"> </span>F<span class="_ _0"></span>igure<span class="_ _13"> </span>3.20(a)<span class="_ _13"> </span>shows<span class="_"> </span>an<span class="_ _13"> </span>implementation<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>factorial<span class="_ _13"> </span>func-</div><div class="t m5 x17 h46 y77f ff7 fs19 fc2 sc0 ls0 ws0">tion<span class="_ _14"> </span>using<span class="_ _15"> </span>a<span class="_ _15"> </span><span class="ffd">while<span class="_ _14"> </span></span>loop<span class="_ _0"></span>.<span class="_ _14"> </span>This<span class="_ _14"> </span>function<span class="_ _14"> </span>correctly<span class="_ _15"> </span>computes<span class="_ _14"> </span>0!<span class="_ _13"> </span><span class="ff12">=<span class="_ _13"> </span></span>1<span class="_ _0"></span>.<span class="_ _14"> </span>The<span class="_ _14"> </span>adjacent</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
