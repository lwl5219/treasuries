<div id="pf312" class="pf w2 h11" data-page-no="312"><div class="pc pc312 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg312.png"/><div class="t m5 x100 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>8.4<span class="_ _60"> </span>Process<span class="_ _10"> </span>Control<span class="_ _3e"> </span><span class="ffe fs1e">785</span></div><div class="t m5 x220 h2c y27f ffa fs16 fc2 sc0 ls0 ws0">code/ecf/waitpid2.c</div><div class="t m5 x2c h2d y280 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">#include<span class="_ _1f"> </span>&quot;csapp.h&quot;</span></div><div class="t m5 x2c h2d y281 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">#define<span class="_ _1f"> </span>N<span class="_ _e"> </span>2</span></div><div class="t m5 x2c h2e y283 ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x2c h2e y5fd0 ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 x2d h2d y284 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>main()</div><div class="t m5 x2c h2d y285 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x2c h2d y286 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _20"> </span><span class="ffd fs1e fc2">int<span class="_ _e"> </span>status,<span class="_ _1f"> </span>i;</span></div><div class="t m5 x2c h2d y287 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _20"> </span><span class="ffd fs1e fc2">pid_t<span class="_ _e"> </span>pid[N],<span class="_ _1f"> </span>retpid;</span></div><div class="t m5 x2c h2e y4493 ff6 fs20 fc6 sc0 ls0 ws0">8</div><div class="t m5 x2c h2e y66b4 ff6 fs20 fc6 sc0 ls0 ws0">9</div><div class="t m5 x142 h2d y4a9a ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Parent<span class="_ _1f"> </span>creates<span class="_ _1f"> </span>N<span class="_ _e"> </span>children<span class="_ _1f"> </span>*/</div><div class="t m5 x17 h2d y4a9b ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _20"> </span><span class="ffd fs1e fc2 ls33">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>i=0<span class="_ _41"></span>;i&lt;N<span class="_ _41"></span>;<span class="ls0">i++)</span></span></div><div class="t m5 x17 h2d y4a9c ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _70"> </span><span class="ffd fs1e fc2">if<span class="_ _e"> </span>((pid[i]<span class="_ _1f"> </span>=<span class="_ _1f"> </span>Fork())<span class="_ _e"> </span>==<span class="_ _1f"> </span>0)<span class="_ _1a"> </span>/*<span class="_ _e"> </span>Child<span class="_ _1f"> </span>*/</span></div><div class="t m5 x17 h2d y906 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _d1"> </span><span class="ffd fs1e fc2">exit(100+i);</span></div><div class="t m5 x17 h2e y4a9d ff6 fs20 fc6 sc0 ls0 ws0">13</div><div class="t m5 x17 h2e y66b5 ff6 fs20 fc6 sc0 ls0 ws0">14</div><div class="t m5 x142 h2d y4a9e ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Parent<span class="_ _1f"> </span>reaps<span class="_ _1f"> </span>N<span class="_ _e"> </span>children<span class="_ _1f"> </span>in<span class="_ _e"> </span>order<span class="_ _1f"> </span>*/</div><div class="t m5 x17 h2d y4a9f ff6 fs20 fc6 sc0 ls0 ws0">15<span class="_ _20"> </span><span class="ffd fs1e fc2 ls33">i=0<span class="_ _41"></span>;</span></div><div class="t m5 x17 h2d y417 ff6 fs20 fc6 sc0 ls0 ws0">16<span class="_ _20"> </span><span class="ffd fs1e fc2">while<span class="_ _e"> </span>((retpid<span class="_ _1f"> </span>=<span class="_ _1f"> </span>waitpid(pid[i++],<span class="_ _e"> </span>&amp;status,<span class="_ _1f"> </span>0))<span class="_ _e"> </span>&gt;<span class="_ _1f"> </span>0)<span class="_ _1f"> </span>{</span></div><div class="t m5 x17 h2d y4aa0 ff6 fs20 fc6 sc0 ls0 ws0">17<span class="_ _70"> </span><span class="ffd fs1e fc2">if<span class="_ _e"> </span>(WIFEXITED(status))</span></div><div class="t m5 x17 h2d yeb4 ff6 fs20 fc6 sc0 ls0 ws0">18<span class="_ _d1"> </span><span class="ffd fs1e fc2">printf(&quot;child<span class="_ _1f"> </span>%d<span class="_ _e"> </span>terminated<span class="_ _1f"> </span>normally<span class="_ _e"> </span>with<span class="_ _1f"> </span>exit<span class="_ _1f"> </span>status=%d\n&quot;,</span></div><div class="t m5 x17 h2d y2a2b ff6 fs20 fc6 sc0 ls0 ws0">19<span class="_ _20e"> </span><span class="ffd fs1e fc2">retpid,<span class="_ _e"> </span>WEXITSTATUS(status));</span></div><div class="t m5 x17 h2d y1ab8 ff6 fs20 fc6 sc0 ls0 ws0">20<span class="_ _70"> </span><span class="ffd fs1e fc2">else</span></div><div class="t m5 x17 h2e y94f ff6 fs20 fc6 sc0 ls0 ws0">21</div><div class="t m5 x162 h2d y1ada ffd fs1e fc2 sc0 ls0 ws0">printf(&quot;child<span class="_ _e"> </span>%d<span class="_ _1f"> </span>terminated<span class="_ _1f"> </span>abnormally\n&quot;,<span class="_ _e"> </span>retpid);</div><div class="t m5 x17 h2d y4aa1 ff6 fs20 fc6 sc0 ls0 ws0">22<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x17 h2e y3228 ff6 fs20 fc6 sc0 ls0 ws0">23</div><div class="t m5 x17 h2e y66e1 ff6 fs20 fc6 sc0 ls0 ws0">24</div><div class="t m5 x142 h2d y35d ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>The<span class="_ _1f"> </span>only<span class="_ _1f"> </span>normal<span class="_ _e"> </span>termination<span class="_ _1f"> </span>is<span class="_ _e"> </span>if<span class="_ _1f"> </span>there<span class="_ _1f"> </span>are<span class="_ _e"> </span>no<span class="_ _1f"> </span>more<span class="_ _e"> </span>children<span class="_ _1f"> </span>*/</div><div class="t m5 x17 h2e y4aa3 ff6 fs20 fc6 sc0 ls0 ws0">25</div><div class="t m5 x142 h2d y3229 ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>(errno<span class="_ _1f"> </span>!=<span class="_ _1f"> </span>ECHILD)</div><div class="t m5 x17 h2d y2467 ff6 fs20 fc6 sc0 ls0 ws0">26<span class="_ _70"> </span><span class="ffd fs1e fc2">unix_error(&quot;waitpid<span class="_ _e"> </span>error&quot;);</span></div><div class="t m5 x17 h2e y322b ff6 fs20 fc6 sc0 ls0 ws0">27</div><div class="t m5 x17 h2e y66e2 ff6 fs20 fc6 sc0 ls0 ws0">28</div><div class="t m5 x142 h2d y322c ffd fs1e fc2 sc0 ls0 ws0">exit(0);</div><div class="t m5 x17 h2d y441 ff6 fs20 fc6 sc0 ls0 ws0">29<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x220 h2c y66e3 ffa fs16 fc2 sc0 ls0 ws0">code/ecf/waitpid2.c</div><div class="t m5 x17 h2f y66e4 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>8.19<span class="_ _66"> </span><span class="fc1">Using</span></div><div class="t m5 x23 h3a y5165 ffd fs19 fc1 sc0 ls0 ws0">waitpid<span class="_ _10"> </span><span class="ffe fs16">to<span class="_"> </span>reap<span class="_"> </span>zombie<span class="_"> </span>children<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>order<span class="_"> </span>they<span class="_"> </span>were<span class="_"> </span>created.</span></div><div class="t m5 x17 h41 y66e5 ffe fs29 fc1 sc0 ls0 ws0">8.4.4<span class="_ _48"> </span><span class="fs19">Putting<span class="_"> </span>Processes<span class="_"> </span>to<span class="_"> </span>Sleep</span></div><div class="t m5 x17 h26 y66e6 ff7 fs19 fc1 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _11"> </span><span class="ffd ls0">sleep<span class="_ _10"> </span><span class="ff7">function<span class="_"> </span>suspends<span class="_"> </span>a<span class="_"> </span>process<span class="_"> </span>for<span class="_"> </span>a<span class="_"> </span>speciÔ¨Åed<span class="_"> </span>period<span class="_"> </span>of<span class="_"> </span>time.</span></span></div><div class="t m5 x31 h2d y66e7 ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;unistd.h&gt;</div><div class="t m5 x31 h2d y66e8 ffd fs1e fc2 sc0 ls0 ws0">unsigned<span class="_ _e"> </span>int<span class="_ _1f"> </span>sleep(unsigned<span class="_ _1f"> </span>int<span class="_ _e"> </span>secs);</div><div class="t m5 x40 hf1 y66e9 ff7 fs1f fc2 sc0 ls0 ws0">Returns:<span class="_"> </span>seconds<span class="_"> </span>left<span class="_"> </span>to<span class="_"> </span>sleep</div><div class="t m5 x17 h26 y27d ffd fs19 fc2 sc0 ls0 ws0">Sleep<span class="_ _13"> </span><span class="ff7">returns<span class="_ _6"> </span>zero<span class="_ _13"> </span>if<span class="_ _6"> </span>the<span class="_ _13"> </span>requested<span class="_ _6"> </span>amount<span class="_ _13"> </span>of<span class="_ _6"> </span>time<span class="_ _13"> </span>has<span class="_ _6"> </span>elapsed,<span class="_ _13"> </span>and<span class="_ _6"> </span>the<span class="_ _13"> </span>number<span class="_ _6"> </span>of</span></div><div class="t m5 x17 h26 y27e ff7 fs19 fc2 sc0 ls0 ws0">seconds<span class="_ _13"> </span>still<span class="_ _6"> </span>left<span class="_ _13"> </span>to<span class="_ _13"> </span>sleep<span class="_ _13"> </span>otherwise<span class="_ _1"></span>.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span>latter<span class="_ _13"> </span>case<span class="_ _6"> </span>is<span class="_ _13"> </span>possible<span class="_ _13"> </span>if<span class="_ _6"> </span>the<span class="_ _13"> </span><span class="ffd">sleep<span class="_ _13"> </span></span>function</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
