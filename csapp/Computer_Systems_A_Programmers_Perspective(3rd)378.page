<div id="pf17a" class="pf w2 h11" data-page-no="17a"><div class="pc pc17a w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg17a.png"/><div class="t m5 x107 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Solutions<span class="_ _10"> </span>to<span class="_ _10"> </span>Practice<span class="_ _10"> </span>Problems<span class="_ _1b"> </span><span class="ffe fs1e">377</span></div><div class="t m5 x17 h28 y140c ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>3.36</div><div class="t m5 x112 h2f ye7 ffe fs16 fc6 sc0 ls0 ws0">(page<span class="_"> </span>292)</div><div class="t m5 x17 h26 y1d16 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _11"> </span>exercise<span class="_ _11"> </span>tests<span class="_ _11"> </span>your<span class="_ _11"> </span>understanding<span class="_"> </span>of<span class="_ _11"> </span>data<span class="_ _11"> </span>sizes<span class="_ _11"> </span>and<span class="_ _11"> </span>array<span class="_ _11"> </span>indexing.<span class="_"> </span>Observe</div><div class="t m5 x17 h26 y1d17 ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_"> </span>a<span class="_"> </span>pointer<span class="_"> </span>of<span class="_"> </span>any<span class="_ _13"> </span>kind<span class="_"> </span>is<span class="_"> </span>8<span class="_"> </span>bytes<span class="_"> </span>long.<span class="_ _13"> </span>Data<span class="_"> </span>type<span class="_"> </span><span class="ffd">short<span class="_ _10"> </span></span>requires<span class="_"> </span>2<span class="_"> </span>bytes<span class="_ _1"></span>,<span class="_"> </span>while</div><div class="t m5 x17 h26 y1d18 ffd fs19 fc1 sc0 ls0 ws0">int<span class="_ _10"> </span><span class="ff7">requires<span class="_"> </span>4.</span></div><div class="t m5 x17 h31 y34e6 ff7 fs21 fc2 sc0 ls0 ws0">Array<span class="_ _26"> </span>Element<span class="_"> </span>size<span class="_ _26"> </span>T<span class="_ _3"></span>otal<span class="_"> </span>size<span class="_ _26"> </span>Start<span class="_"> </span>address<span class="_ _26"> </span>Element<span class="_"> </span><span class="ff11">i</span></div><div class="t m5 x72 h31 y34e7 ffd fs1e fc2 sc0 ls0 ws0">P<span class="_ _65"> </span><span class="ff7 fs21 ls173">42<span class="_ _16b"></span>0<span class="_ _8"></span><span class="ff11 ls0">x</span></span></div><div class="t m5 x87 h6d y34e8 ffd fs2c fc2 sc0 ls0 ws0">P</div><div class="t m5 xf5 h55 y34e9 ff11 fs21 fc2 sc0 ls0 ws0">x</div><div class="t m5 xc0 h6d y34e8 ffd fs2c fc2 sc0 ls0 ws0">P</div><div class="t m5 x41 h32 y34e9 ff12 fs21 fc2 sc0 ls0 ws0">+<span class="_ _13"> </span><span class="ff7">4<span class="ff11">i</span></span></div><div class="t m5 x72 h31 y34ea ffd fs1e fc2 sc0 ls0 ws0">Q<span class="_ _65"> </span><span class="ff7 fs21 ls19f">24<span class="_ _4"></span><span class="ff11 ls0">x</span></span></div><div class="t m5 x87 h6d y34eb ffd fs2c fc2 sc0 ls0 ws0">Q</div><div class="t m5 xf5 h55 y34ea ff11 fs21 fc2 sc0 ls0 ws0">x</div><div class="t m5 xc0 h6d y34ec ffd fs2c fc2 sc0 ls0 ws0">Q</div><div class="t m5 x24f h32 y34ea ff12 fs21 fc2 sc0 ls0 ws0">+<span class="_ _13"> </span><span class="ff7">2<span class="ff11">i</span></span></div><div class="t m5 x72 h31 y34ed ffd fs1e fc2 sc0 ls0 ws0">R<span class="_ _65"> </span><span class="ff7 fs21 ls173">87<span class="_ _16b"></span>2<span class="_ _8"></span><span class="ff11 ls0">x</span></span></div><div class="t m5 x88 h6d y34ee ffd fs2c fc2 sc0 ls0 ws0">R</div><div class="t m5 xf5 h55 y34ed ff11 fs21 fc2 sc0 ls0 ws0">x</div><div class="t m5 x1c2 h6d y34ee ffd fs2c fc2 sc0 ls0 ws0">R</div><div class="t m5 x24f h32 y34ed ff12 fs21 fc2 sc0 ls0 ws0">+<span class="_ _13"> </span><span class="ff7">8<span class="ff11">i</span></span></div><div class="t m5 x72 h31 y34ef ffd fs1e fc2 sc0 ls0 ws0">S<span class="_ _65"> </span><span class="ff7 fs21 ls173">88<span class="_ _16b"></span>0<span class="_ _8"></span><span class="ff11 ls0">x</span></span></div><div class="t m5 x87 h6d y34f0 ffd fs2c fc2 sc0 ls0 ws0">S</div><div class="t m5 xf5 h55 y34ef ff11 fs21 fc2 sc0 ls0 ws0">x</div><div class="t m5 xc0 h6d y34f0 ffd fs2c fc2 sc0 ls0 ws0">S</div><div class="t m5 x24f h32 y34ef ff12 fs21 fc2 sc0 ls0 ws0">+<span class="_ _13"> </span><span class="ff7">8<span class="ff11">i</span></span></div><div class="t m5 x72 h31 y34f1 ffd fs1e fc2 sc0 ls0 ws0">T<span class="_ _65"> </span><span class="ff7 fs21 ls173">81<span class="_ _16b"></span>6<span class="_ _8"></span><span class="ff11 ls0">x</span></span></div><div class="t m5 x87 h6d y34f2 ffd fs2c fc2 sc0 ls0 ws0">T</div><div class="t m5 xf5 h55 y34f1 ff11 fs21 fc2 sc0 ls0 ws0">x</div><div class="t m5 xc0 h6d y34f2 ffd fs2c fc2 sc0 ls0 ws0">T</div><div class="t m5 x24f h32 y34f1 ff12 fs21 fc2 sc0 ls0 ws0">+<span class="_ _13"> </span><span class="ff7">8<span class="ff11">i</span></span></div><div class="t m5 x17 h28 y34f3 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>3.37<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>294)</span></div><div class="t m5 x17 h26 y34f4 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _11"> </span>problem<span class="_ _11"> </span>is<span class="_ _11"> </span>a<span class="_ _11"> </span>variant<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>one<span class="_ _11"> </span>shown<span class="_"> </span>for<span class="_ _11"> </span>integer<span class="_ _11"> </span>array<span class="_ _11"> </span><span class="ffd">E</span>.<span class="_ _11"> </span>It<span class="_ _11"> </span>is<span class="_ _11"> </span>important<span class="_ _11"> </span>to</div><div class="t m5 x17 h26 y34f5 ff7 fs19 fc1 sc0 ls0 ws0">understand<span class="_ _6"> </span>the<span class="_ _13"> </span>difference<span class="_ _a"> </span>between<span class="_ _13"> </span>a<span class="_ _a"> </span>pointer<span class="_ _13"> </span>and<span class="_ _6"> </span>the<span class="_ _6"> </span>object<span class="_ _13"> </span>being<span class="_ _a"> </span>pointed<span class="_ _13"> </span>to<span class="_ _1"></span>.<span class="_ _6"> </span>Since</div><div class="t m5 x17 h26 y34f6 ff7 fs19 fc1 sc0 ls0 ws0">data<span class="_"> </span>type<span class="_"> </span><span class="ffd">short<span class="_ _11"> </span></span>requires<span class="_"> </span>2<span class="_ _11"> </span>bytes<span class="_ _1"></span>,<span class="_ _11"> </span>all<span class="_"> </span>of<span class="_"> </span>the<span class="_ _11"> </span>array<span class="_"> </span>indices<span class="_ _11"> </span>are<span class="_"> </span>scaled<span class="_ _11"> </span>by<span class="_"> </span>a<span class="_ _11"> </span>factor<span class="_"> </span>of</div><div class="t m5 x17 h26 y34f7 ff7 fs19 fc1 sc0 ls0 ws0">2.<span class="_"> </span>Rather<span class="_"> </span>than<span class="_"> </span>using<span class="_"> </span><span class="ffd">movl</span>,<span class="_"> </span>as<span class="_"> </span>before<span class="_ _1"></span>,<span class="_"> </span>we<span class="_"> </span>now<span class="_"> </span>use<span class="_"> </span><span class="ffd">movw</span>.</div><div class="t m5 x17 h31 y34f8 ff7 fs21 fc2 sc0 ls0 ws0">Expression<span class="_ _26"> </span>T<span class="_ _7"></span>ype<span class="_ _128"> </span>V<span class="_ _3"></span>alue<span class="_ _e9"> </span>Assembly<span class="_"> </span>Code</div><div class="t m5 x17 h31 yeb7 ffd fs1e fc2 sc0 ls0 ws0">P[1]<span class="_ _53"> </span>short<span class="_ _94"> </span><span class="ff6 fs21">M<span class="_ _0"></span><span class="ff7">[<span class="ff11">x</span></span></span></div><div class="t m5 x1a6 h6d y34f9 ffd fs2c fc2 sc0 ls0 ws0">P</div><div class="t m5 xf1 h32 yeb7 ff12 fs21 fc2 sc0 ls0 ws0">+<span class="_ _13"> </span><span class="ff7">2]<span class="_ _55"> </span><span class="ffd fs1e">movw<span class="_ _10"> </span>2(%rdx),%ax</span></span></div><div class="t m5 x17 h2d y34fa ffd fs1e fc2 sc0 ls0 ws0">P+3+i<span class="_ _d0"> </span>short<span class="_ _11"> </span>*</div><div class="t m5 x129 h55 y34fb ff11 fs21 fc2 sc0 ls0 ws0">x</div><div class="t m5 x218 h6d y34fc ffd fs2c fc2 sc0 ls0 ws0">P</div><div class="t m5 x7c h32 y34fb ff12 fs21 fc2 sc0 ls0 ws0">+<span class="_ _13"> </span><span class="ff7">6<span class="_"> </span></span>+<span class="_ _13"></span><span class="ff7">2<span class="ff11">i<span class="_ _6d"> </span><span class="ffd fs1e">leaq<span class="_ _11"> </span>6(%rdx,%rcx,2),%rax</span></span></span></div><div class="t m5 x17 h2d y34fd ffd fs1e fc2 sc0 ls0 ws0">P[i*6-5]<span class="_ _ab"> </span>short</div><div class="t m5 x129 h31 y34fe ff6 fs21 fc2 sc0 ls0 ws0">M<span class="_ _1"></span><span class="ff7">[<span class="ff11">x</span></span></div><div class="t m5 x1a6 h6d y34ff ffd fs2c fc2 sc0 ls0 ws0">P</div><div class="t m5 xf1 h32 y34fe ff12 fs21 fc2 sc0 ls0 ws0">+<span class="_ _13"> </span><span class="ff7">12<span class="ff11">i<span class="_ _11"> </span></span></span>−<span class="_ _13"></span><span class="ff7">10]<span class="_ _19"> </span><span class="ffd fs1e">movw<span class="_ _11"> </span>-10(%rdx,%rcx,12),%ax</span></span></div><div class="t m5 x17 h2d y3500 ffd fs1e fc2 sc0 ls0 ws0">P[2]<span class="_ _53"> </span>short</div><div class="t m5 x129 h31 y323b ff6 fs21 fc2 sc0 ls0 ws0">M<span class="_ _1"></span><span class="ff7">[<span class="ff11">x</span></span></div><div class="t m5 x1a6 h6d y3501 ffd fs2c fc2 sc0 ls0 ws0">P</div><div class="t m5 xf1 h32 y323b ff12 fs21 fc2 sc0 ls0 ws0">+<span class="_ _13"> </span><span class="ff7">4]<span class="_ _55"> </span><span class="ffd fs1e">movw<span class="_ _10"> </span>4(%rdx),%ax</span></span></div><div class="t m5 x17 h2d y3502 ffd fs1e fc2 sc0 ls0 ws0">&amp;P[i+2]<span class="_ _2e"> </span>short<span class="_ _11"> </span>*</div><div class="t m5 x129 h55 y3503 ff11 fs21 fc2 sc0 ls0 ws0">x</div><div class="t m5 x218 h6d y3504 ffd fs2c fc2 sc0 ls0 ws0">P</div><div class="t m5 x7c h32 y3503 ff12 fs21 fc2 sc0 ls0 ws0">+<span class="_ _13"> </span><span class="ff7">2<span class="ff11">i<span class="_ _11"> </span></span></span>+<span class="_ _13"></span><span class="ff7">4<span class="_ _ed"> </span><span class="ffd fs1e">leaq<span class="_ _11"> </span>4(%rdx,%rcx,2),%rax</span></span></div><div class="t m5 x17 h28 y3505 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>3.38</div><div class="t m5 x112 h2f yc18 ffe fs16 fc6 sc0 ls0 ws0">(page<span class="_"> </span>295)</div><div class="t m5 x17 h26 y3506 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _16"> </span>problem<span class="_ _11"> </span>requires<span class="_ _16"> </span>you<span class="_ _16"> </span>to<span class="_ _11"> </span>work<span class="_ _16"> </span>through<span class="_ _11"> </span>the<span class="_ _16"> </span>scaling<span class="_ _11"> </span>operations<span class="_ _16"> </span>to<span class="_ _11"> </span>determine</div><div class="t m5 x17 h26 y3507 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _13"> </span>address<span class="_"> </span>computations<span class="_ _3"></span>,<span class="_"> </span>and<span class="_ _13"> </span>to<span class="_ _13"> </span>apply<span class="_"> </span>Equation<span class="_ _13"> </span>3.1<span class="_ _13"> </span>for<span class="_ _13"> </span>row-major<span class="_"> </span>indexing<span class="_ _0"></span>.<span class="_ _13"> </span>The</div><div class="t m5 x17 h26 y3508 ff7 fs19 fc1 sc0 ls0 ws0">ﬁrst<span class="_ _6"> </span>step<span class="_ _13"> </span>is<span class="_ _6"> </span>to<span class="_ _13"> </span>annotate<span class="_ _6"> </span>the<span class="_ _13"> </span>assembly<span class="_ _6"> </span>code<span class="_ _6"> </span>to<span class="_ _13"> </span>determine<span class="_ _6"> </span>how<span class="_ _13"> </span>the<span class="_ _6"> </span>address<span class="_ _13"> </span>references</div><div class="t m5 x17 h26 y3509 ff7 fs19 fc1 sc0 ls0 ws0">are<span class="_"> </span>computed:</div><div class="t m5 x2e h61 y350a ff13 fs35 fc6 sc0 ls0 ws0">long<span class="_ _f"> </span>sum_element(long<span class="_ _f"> </span>i,<span class="_ _f"> </span>long<span class="_ _e"> </span>j)</div><div class="t m5 x2e h61 y350b ff13 fs35 fc6 sc0 ls0 ws0">i<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi,<span class="_ _f"> </span>j<span class="_ _e"> </span>in<span class="_ _21"> </span>%rsi</div><div class="t m5 x2c h2d y350c ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">sum_element:</span></div><div class="t m5 x2c h2d y350d ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">leaq<span class="_ _46"> </span>0(,%rdi,8),<span class="_ _e"> </span>%rdx<span class="_ _9a"> </span></span><span class="ff13 fs35">Compute<span class="_ _f"> </span><span class="ff7">8<span class="ff11">i</span></span></span></div><div class="t m5 x2c h2d y350e ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">subq<span class="_ _46"> </span>%rdi,<span class="_ _e"> </span>%rdx<span class="_ _165"> </span></span><span class="ff13 fs35">Compute<span class="_ _f"> </span><span class="ff7">7<span class="ff11">i</span></span></span></div><div class="t m5 x2c h2e y350f ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 xd1 h2d y3510 ffd fs1e fc2 sc0 ls0 ws0">addq<span class="_ _46"> </span>%rsi,<span class="_ _e"> </span>%rdx<span class="_ _165"> </span><span class="ff13 fs35 fc6">Compute<span class="_ _f"> </span><span class="ff7">7<span class="ff11">i<span class="_ _10"> </span><span class="ff12">+<span class="_ _6"></span></span>j</span></span></span></div><div class="t m5 x2c h2d y3511 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">leaq<span class="_ _46"> </span>(%rsi,%rsi,4),<span class="_ _e"> </span>%rax<span class="_ _18c"> </span></span><span class="ff13 fs35">Compute<span class="_ _f"> </span><span class="ff7">5<span class="ff11">j</span></span></span></div><div class="t m5 x2c h2d y3512 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">addq<span class="_ _46"> </span>%rax,<span class="_ _e"> </span>%rdi<span class="_ _165"> </span></span><span class="ff13 fs35">Compute<span class="_ _f"> </span><span class="ff11">i<span class="_ _24"> </span><span class="ff12">+<span class="_ _25"> </span><span class="ff7">5<span class="_ _0"></span><span class="ff11">j</span></span></span></span></span></div><div class="t m5 x2c h2d y3513 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>Q(,%rdi,8),<span class="_ _e"> </span>%rax<span class="_ _9a"> </span></span><span class="ff13 fs35">Retrieve<span class="_ _f"> </span><span class="ff6">M<span class="_ _0"></span><span class="ff7">[<span class="ff11">x</span></span></span></span></div><div class="t m5 x41 h7d y3514 ffd fs45 fc6 sc0 ls0 ws0">Q</div><div class="t m5 x19c h7e y3513 ff12 fs35 fc6 sc0 ls0 ws0">+<span class="_ _25"> </span><span class="ff7">8<span class="_ _21"> </span><span class="ff11">(</span>5<span class="ff11">j<span class="_ _1d"> </span></span></span>+<span class="_ _25"> </span><span class="ff11 ls179">i)<span class="_ _1"></span><span class="ff7 ls0">]</span></span></div><div class="t m5 x2c h2d y3515 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _45"> </span><span class="ffd fs1e fc2">addq<span class="_ _46"> </span>P(,%rdx,8),<span class="_ _e"> </span>%rax<span class="_ _9a"> </span></span><span class="ff13 fs35">Add<span class="_ _f"> </span><span class="ff6">M<span class="_ _0"></span><span class="ff7">[<span class="ff11">x</span></span></span></span></div><div class="t m5 x250 h7d y3516 ffd fs45 fc6 sc0 ls0 ws0">P</div><div class="t m5 x19b h7e y3515 ff12 fs35 fc6 sc0 ls0 ws0">+<span class="_ _25"> </span><span class="ff7">8<span class="_ _21"> </span><span class="ff11">(</span>7<span class="ff11">i<span class="_ _24"> </span></span></span>+<span class="_ _25"> </span><span class="ff11 ls1a0">j)<span class="_ _7"></span><span class="ff7 ls0">]</span></span></div><div class="t m5 x2c h2d y3517 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _45"> </span><span class="ffd fs1e fc2">ret</span></div><div class="t m5 x26 h26 y7a6 ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _16"> </span>can<span class="_ _11"> </span>see<span class="_ _16"> </span>that<span class="_ _11"> </span>the<span class="_ _16"> </span>reference<span class="_ _16"> </span>to<span class="_ _11"> </span>matrix<span class="_ _16"> </span><span class="ffd">P<span class="_ _11"> </span></span>is<span class="_ _16"> </span>at<span class="_ _11"> </span>byte<span class="_ _16"> </span>offset<span class="_ _16"> </span>8</div><div class="t m5 x6b h45 y3518 ff11 fs19 fc2 sc0 ls0 ws0">.</div><div class="t m5 xb9 h46 y7a6 ff11 fs19 fc2 sc0 ls0 ws0">(<span class="ff7">7</span>i<span class="_ _11"> </span><span class="ff12">+<span class="_ _10"> </span></span><span class="ls174">j)<span class="_ _7"></span><span class="ff7 ls0">,<span class="_ _16"> </span>while</span></span></div><div class="t m5 x17 h26 y7a7 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>reference<span class="_ _13"> </span>to<span class="_"> </span>matrix<span class="_ _13"> </span><span class="ffd">Q<span class="_ _13"> </span></span>is<span class="_"> </span>at<span class="_"> </span>byte<span class="_ _13"> </span>offset<span class="_"> </span>8</div><div class="t m5 x68 h45 y3519 ff11 fs19 fc2 sc0 ls0 ws0">.</div><div class="t m5 x18 h46 y7a7 ff11 fs19 fc2 sc0 ls0 ws0">(<span class="ff7">5</span>j<span class="_ _16"> </span><span class="ff12">+<span class="_ _13"></span></span><span class="ls57">i)<span class="_ _1"></span><span class="ff7 ls0">.<span class="_"> </span>F<span class="_ _1"></span>rom<span class="_ _13"> </span>this<span class="_ _1"></span>,<span class="_"> </span>we<span class="_"> </span>can<span class="_ _13"> </span>determine</span></span></div><div class="t m5 x17 h46 y7a8 ff7 fs19 fc2 sc0 ls0 ws0">that<span class="_"> </span><span class="ffd">P<span class="_ _10"> </span></span>has<span class="_"> </span>7<span class="_"> </span>columns<span class="_ _1"></span>,<span class="_"> </span>while<span class="_"> </span><span class="ffd">Q<span class="_ _10"> </span></span>has<span class="_"> </span>5,<span class="_"> </span>giving<span class="_"> </span><span class="ff11">M<span class="_"> </span><span class="ff12">=<span class="_ _13"></span></span></span>5<span class="_"> </span>and<span class="_"> </span><span class="ff11">N<span class="_ _16"> </span><span class="ff12">=<span class="_ _13"></span></span></span><span class="ls64">7.</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
