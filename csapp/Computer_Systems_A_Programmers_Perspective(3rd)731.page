<div id="pf2db" class="pf w2 h11" data-page-no="2db"><div class="pc pc2db w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg2db.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">730<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>7<span class="_ _3d"> </span>Linking</span></div><div class="t m5 x14 h3a ye7 ff6 fs16 fc2 sc0 ls0 ws0">(a)<span class="_ _10"> </span>Relocated<span class="_ _11"> </span><span class="ffd fs19">.text<span class="_ _10"> </span></span>section</div><div class="t m5 xb h2d y2283 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">00000000004004d0<span class="_ _1f"> </span>&lt;main&gt;:</span></div><div class="t m5 xb h2d y2b70 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">4004d0:<span class="_ _1a"> </span>48<span class="_ _e"> </span>83<span class="_ _1f"> </span>ec<span class="_ _1f"> </span>08<span class="_ _35"> </span>sub<span class="_ _46"> </span>$0x8,%rsp</span></div><div class="t m5 xb h2d yc51 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">4004d4:<span class="_ _1a"> </span>be<span class="_ _e"> </span>02<span class="_ _1f"> </span>00<span class="_ _1f"> </span>00<span class="_ _e"> </span>00<span class="_ _86"> </span>mov<span class="_ _46"> </span>$0x2,%esi</span></div><div class="t m5 xb h2d y28e5 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">4004d9:<span class="_ _1a"> </span>bf<span class="_ _e"> </span>18<span class="_ _1f"> </span>10<span class="_ _1f"> </span>60<span class="_ _e"> </span>00<span class="_ _86"> </span>mov<span class="_ _46"> </span>$0x601018,%edi<span class="_ _95"> </span></span><span class="ff13 fs35">%edi<span class="_ _e"> </span>=<span class="_ _21"> </span>&amp;array</span></div><div class="t m5 xb h2e y28e6 ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x34 h2d y28e7 ffd fs1e fc2 sc0 ls0 ws0">4004de:<span class="_ _1a"> </span>e8<span class="_ _e"> </span>05<span class="_ _1f"> </span>00<span class="_ _1f"> </span>00<span class="_ _e"> </span>00<span class="_ _86"> </span>callq<span class="_ _1a"> </span>4004e8<span class="_ _1f"> </span>&lt;sum&gt;<span class="_ _62"> </span><span class="ff13 fs35 fc6">sum()</span></div><div class="t m5 xb h2d ye9d ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">4004e3:<span class="_ _1a"> </span>48<span class="_ _e"> </span>83<span class="_ _1f"> </span>c4<span class="_ _1f"> </span>08<span class="_ _35"> </span>add<span class="_ _46"> </span>$0x8,%rsp</span></div><div class="t m5 xb h2d y28e8 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">4004e7:<span class="_ _1a"> </span>c3<span class="_ _129"> </span>retq</span></div><div class="t m5 xb h2d y1814 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _1c"> </span><span class="ffd fs1e fc2">00000000004004e8<span class="_ _1f"> </span>&lt;sum&gt;:</span></div><div class="t m5 xb h2d y28ea ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _45"> </span><span class="ffd fs1e fc2">4004e8:<span class="_ _1a"> </span>b8<span class="_ _e"> </span>00<span class="_ _1f"> </span>00<span class="_ _1f"> </span>00<span class="_ _e"> </span>00<span class="_ _86"> </span>mov<span class="_ _46"> </span>$0x0,%eax</span></div><div class="t m5 x14 h2d y28eb ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _45"> </span><span class="ffd fs1e fc2">4004ed:<span class="_ _1a"> </span>ba<span class="_ _e"> </span>00<span class="_ _1f"> </span>00<span class="_ _1f"> </span>00<span class="_ _e"> </span>00<span class="_ _86"> </span>mov<span class="_ _46"> </span>$0x0,%edx</span></div><div class="t m5 x14 h2d y28ec ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _45"> </span><span class="ffd fs1e fc2">4004f2:<span class="_ _1a"> </span>eb<span class="_ _e"> </span>09<span class="_ _104"> </span>jmp<span class="_ _46"> </span>4004fd<span class="_ _e"> </span>&lt;sum+0x15&gt;</span></div><div class="t m5 x14 h2d y28ed ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _45"> </span><span class="ffd fs1e fc2">4004f4:<span class="_ _1a"> </span>48<span class="_ _e"> </span>63<span class="_ _1f"> </span>ca<span class="_ _12a"> </span>movslq<span class="_ _e"> </span>%edx,%rcx</span></div><div class="t m5 x14 h2d y28ee ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _45"> </span><span class="ffd fs1e fc2">4004f7:<span class="_ _1a"> </span>03<span class="_ _e"> </span>04<span class="_ _1f"> </span>8f<span class="_ _12a"> </span>add<span class="_ _7b"> </span>(%rdi,%rcx,4),%eax</span></div><div class="t m5 x14 h2d y28ef ff6 fs20 fc6 sc0 ls0 ws0">14<span class="_ _45"> </span><span class="ffd fs1e fc2">4004fa:<span class="_ _1a"> </span>83<span class="_ _e"> </span>c2<span class="_ _1f"> </span>01<span class="_ _12a"> </span>add<span class="_ _7b"> </span>$0x1,%edx</span></div><div class="t m5 x14 h2d y28f0 ff6 fs20 fc6 sc0 ls0 ws0">15<span class="_ _45"> </span><span class="ffd fs1e fc2">4004fd:<span class="_ _1a"> </span>39<span class="_ _e"> </span>f2<span class="_ _104"> </span>cmp<span class="_ _46"> </span>%esi,%edx</span></div><div class="t m5 x14 h2d y28f1 ff6 fs20 fc6 sc0 ls0 ws0">16<span class="_ _45"> </span><span class="ffd fs1e fc2">4004ff:<span class="_ _1a"> </span>7c<span class="_ _e"> </span>f3<span class="_ _104"> </span>jl<span class="_ _8c"> </span>4004f4<span class="_ _e"> </span>&lt;sum+0xc&gt;</span></div><div class="t m5 x14 h2d y28f2 ff6 fs20 fc6 sc0 ls0 ws0">17<span class="_ _45"> </span><span class="ffd fs1e fc2">400501:<span class="_ _1a"> </span>f3<span class="_ _e"> </span>c3<span class="_ _104"> </span>repz<span class="_ _e"> </span>retq</span></div><div class="t m5 x14 h3a y60a4 ff6 fs16 fc2 sc0 ls0 ws0">(b)<span class="_ _10"> </span>Relocated<span class="_ _11"> </span><span class="ffd fs19">.data<span class="_ _10"> </span></span>section</div><div class="t m5 xb h2d y29fe ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">0000000000601018<span class="_ _1f"> </span>&lt;array&gt;:</span></div><div class="t m5 xb h2d y29ff ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">601018:<span class="_ _1a"> </span>01<span class="_ _e"> </span>00<span class="_ _1f"> </span>00<span class="_ _1f"> </span>00<span class="_ _e"> </span>02<span class="_ _1f"> </span>00<span class="_ _e"> </span>00<span class="_ _1f"> </span>00</span></div><div class="t m5 x14 h3a y60a5 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>7.12<span class="_ _c"> </span><span class="fc1">Relocated<span class="_"> </span><span class="ffd fs19">.text<span class="_ _11"> </span></span>and<span class="_"> </span><span class="ffd fs19">.data<span class="_ _11"> </span></span>sections<span class="_"> </span>for<span class="_ _11"> </span>the<span class="_ _11"> </span>executable<span class="_"> </span>ﬁle<span class="_ _11"> </span><span class="ffd fs19">prog</span>.<span class="_"> </span><span class="ff6">The<span class="_ _11"> </span>original<span class="_ _11"> </span>C<span class="_ _11"> </span>code<span class="_ _11"> </span>is<span class="_ _10"> </span>in</span></span></div><div class="t m5 x14 h34 y60a6 ff6 fs16 fc1 sc0 ls0 ws0">Figure<span class="_ _10"> </span>7.1.</div><div class="t m5 x1d h2d y60a7 ffd fs1e fc2 sc0 ls0 ws0">ADDR(r.symbol)<span class="_ _e"> </span>=<span class="_ _1f"> </span>ADDR(array)<span class="_ _1f"> </span>=<span class="_ _e"> </span>0x601018</div><div class="t m5 x1d h26 y60a8 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>linker<span class="_"> </span>updates<span class="_"> </span>the<span class="_"> </span>reference<span class="_"> </span>using<span class="_"> </span>line<span class="_"> </span>13<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>algorithm<span class="_"> </span>in<span class="_"> </span>Figure<span class="_"> </span>7.10:</div><div class="t m5 x1d h2d y60a9 ffd fs1e fc2 sc0 ls0 ws0">*refptr<span class="_ _e"> </span>=<span class="_ _1f"> </span>(unsigned)<span class="_ _1f"> </span>(ADDR(r.symbol)<span class="_ _e"> </span>+<span class="_ _1f"> </span>r.addend)</div><div class="t m5 x22b h2d y60aa ffd fs1e fc2 sc0 ls0 ws0">=<span class="_ _e"> </span>(unsigned)<span class="_ _1f"> </span>(0x601018<span class="_ _6f"> </span>+<span class="_ _1f"> </span>0)</div><div class="t m5 x22b h2d y60ab ffd fs1e fc2 sc0 ls0 ws0">=<span class="_ _e"> </span>(unsigned)<span class="_ _1f"> </span>(0x601018)</div><div class="t m5 x1d h26 y60ac ff7 fs19 fc2 sc0 ls0 ws0">In<span class="_ _16"> </span>the<span class="_ _11"> </span>resulting<span class="_ _16"> </span>executable<span class="_ _16"> </span>object<span class="_ _11"> </span>ﬁle,<span class="_ _16"> </span>the<span class="_ _11"> </span>reference<span class="_ _16"> </span>has<span class="_ _16"> </span>the<span class="_ _11"> </span>following<span class="_ _16"> </span>relocated</div><div class="t m5 x1d h26 y60ad ff7 fs19 fc2 sc0 ls0 ws0">form:</div><div class="t m5 x75 h2d y60ae ffd fs1e fc2 sc0 ls0 ws0">4004d9:<span class="_ _1a"> </span>bf<span class="_ _e"> </span>18<span class="_ _1f"> </span>10<span class="_ _1f"> </span>60<span class="_ _e"> </span>00<span class="_ _87"> </span>mov<span class="_ _7b"> </span>$0x601018,%edi<span class="_ _b2"> </span><span class="ff13 fs35 fc6">%edi<span class="_ _21"> </span>=<span class="_ _e"> </span>&amp;array</span></div><div class="t m5 x1d h26 y60af ff7 fs19 fc2 sc0 ls0 ws0">Putting<span class="_"> </span>it<span class="_ _11"> </span>all<span class="_"> </span>together,<span class="_"> </span>F<span class="_ _0"></span>igure<span class="_"> </span>7.12<span class="_ _11"> </span>shows<span class="_"> </span>the<span class="_ _11"> </span>relocated<span class="_"> </span><span class="ffd">.text<span class="_ _11"> </span></span>and<span class="_"> </span><span class="ffd">.data<span class="_ _11"> </span></span>sections</div><div class="t m5 x1d h26 y60b0 ff7 fs19 fc2 sc0 ls0 ws0">in<span class="_ _14"> </span>the<span class="_ _15"> </span>ﬁnal<span class="_ _15"> </span>executable<span class="_ _15"> </span>object<span class="_ _15"> </span>ﬁle<span class="_ _1"></span>.<span class="_ _15"> </span>At<span class="_ _15"> </span>load<span class="_ _15"> </span>time<span class="_ _0"></span>,<span class="_ _15"> </span>the<span class="_ _15"> </span>loader<span class="_ _15"> </span>can<span class="_ _15"> </span>copy<span class="_ _15"> </span>the<span class="_ _15"> </span>bytes</div><div class="t m5 x1d h26 y60b1 ff7 fs19 fc2 sc0 ls0 ws0">from<span class="_ _14"> </span>these<span class="_ _15"> </span>sections<span class="_ _14"> </span>directly<span class="_ _15"> </span>into<span class="_ _15"> </span>memory<span class="_ _14"> </span>and<span class="_ _15"> </span>execute<span class="_ _15"> </span>the<span class="_ _14"> </span>instructions<span class="_ _15"> </span>without</div><div class="t m5 x1d h26 y60b2 ff7 fs19 fc2 sc0 ls0 ws0">any<span class="_"> </span>further<span class="_"> </span>modiﬁcations<span class="_ _1"></span>.</div><div class="t m5 x1d h47 y23bd ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>7.4<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>754)</span></div><div class="t m5 x1d h26 y271e ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>problem<span class="_"> </span>concerns<span class="_"> </span>the<span class="_"> </span>relocated<span class="_"> </span>program<span class="_"> </span>in<span class="_"> </span>Figure<span class="_"> </span>7.12(a).</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
