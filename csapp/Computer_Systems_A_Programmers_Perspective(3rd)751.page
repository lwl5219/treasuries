<div id="pf2ef" class="pf w2 h11" data-page-no="2ef"><div class="pc pc2ef w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg2ef.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">750<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>7<span class="_ _3d"> </span>Linking</span></div><div class="t m5 x29 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">Loaders<span class="_ _11"> </span>map<span class="_ _16"> </span>the<span class="_ _11"> </span>contents<span class="_ _16"> </span>of<span class="_ _11"> </span>executable<span class="_ _16"> </span>ﬁles<span class="_ _11"> </span>into<span class="_ _16"> </span>memory<span class="_ _11"> </span>and<span class="_ _16"> </span>run<span class="_ _11"> </span>the<span class="_ _16"> </span>pro-</div><div class="t m5 x1d h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">gram.<span class="_ _16"> </span>Linkers<span class="_ _16"> </span>can<span class="_ _16"> </span>also<span class="_ _16"> </span>produce<span class="_ _16"> </span>partially<span class="_ _16"> </span>linked<span class="_ _16"> </span>executable<span class="_ _16"> </span>object<span class="_ _16"> </span>ﬁles<span class="_ _16"> </span>with<span class="_ _16"> </span>un-</div><div class="t m5 x1d h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">resolved<span class="_ _11"> </span>references<span class="_ _11"> </span>to<span class="_ _16"> </span>the<span class="_ _11"> </span>routines<span class="_ _11"> </span>and<span class="_ _16"> </span>data<span class="_ _11"> </span>deﬁned<span class="_ _11"> </span>in<span class="_ _16"> </span>a<span class="_ _11"> </span>shared<span class="_ _11"> </span>library<span class="_ _3"></span>.<span class="_ _11"> </span>At<span class="_ _16"> </span>load</div><div class="t m5 x1d h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">time<span class="_ _1"></span>,<span class="_"> </span>the<span class="_ _11"> </span>loader<span class="_"> </span>maps<span class="_"> </span>the<span class="_"> </span>partially<span class="_"> </span>linked<span class="_"> </span>executable<span class="_"> </span>into<span class="_"> </span>memory<span class="_"> </span>and<span class="_"> </span>then<span class="_"> </span>calls</div><div class="t m5 x1d h26 y2f8 ff7 fs19 fc2 sc0 ls0 ws0">a<span class="_"> </span>dynamic<span class="_ _11"> </span>linker,<span class="_ _11"> </span>which<span class="_ _11"> </span>completes<span class="_"> </span>the<span class="_ _11"> </span>linking<span class="_ _11"> </span>task<span class="_ _11"> </span>by<span class="_ _11"> </span>loading<span class="_ _11"> </span>the<span class="_ _11"> </span>shared<span class="_ _11"> </span>library</div><div class="t m5 x1d h26 y2f9 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_"> </span>relocating<span class="_"> </span>the<span class="_"> </span>references<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>program.</div><div class="t m5 x29 h26 y2fa ff7 fs19 fc2 sc0 ls0 ws0">Shared<span class="_ _6"> </span>libraries<span class="_ _6"> </span>that<span class="_ _6"> </span>are<span class="_ _6"> </span>compiled<span class="_ _6"> </span>as<span class="_ _6"> </span>position-independent<span class="_ _6"> </span>code<span class="_ _13"> </span>can<span class="_ _a"> </span>be<span class="_ _6"> </span>loaded</div><div class="t m5 x1d h26 y2fb ff7 fs19 fc2 sc0 ls0 ws0">anywhere<span class="_ _13"> </span>and<span class="_"> </span>shared<span class="_ _13"> </span>at<span class="_ _13"> </span>run<span class="_"> </span>time<span class="_ _13"> </span>by<span class="_ _13"> </span>multiple<span class="_"> </span>processes<span class="_ _3"></span>.<span class="_"> </span>Applications<span class="_ _13"> </span>can<span class="_ _13"> </span>also<span class="_ _13"> </span>use</div><div class="t m5 x1d h26 y2fc ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>dynamic<span class="_ _13"> </span>linker<span class="_"> </span>at<span class="_ _13"> </span>run<span class="_"> </span>time<span class="_"> </span>in<span class="_ _13"> </span>order<span class="_"> </span>to<span class="_ _13"> </span>load,<span class="_"> </span>link,<span class="_"> </span>and<span class="_ _13"> </span>access<span class="_"> </span>the<span class="_"> </span>functions<span class="_ _13"> </span>and</div><div class="t m5 x1d h26 y2fd ff7 fs19 fc2 sc0 ls0 ws0">data<span class="_"> </span>in<span class="_"> </span>shared<span class="_"> </span>libraries<span class="_ _1"></span>.</div><div class="t m5 x1d h29 y62d3 ffe fs14 fc2 sc0 ls0 ws0">Bibliographic<span class="_"> </span>Notes</div><div class="t m5 x1d h26 y62d4 ff7 fs19 fc2 sc0 ls0 ws0">Linking<span class="_"> </span>is<span class="_ _11"> </span>poorly<span class="_ _11"> </span>documented<span class="_ _11"> </span>in<span class="_ _11"> </span>the<span class="_ _11"> </span>computer<span class="_ _11"> </span>systems<span class="_ _11"> </span>literature.<span class="_"> </span>Since<span class="_ _11"> </span>it<span class="_ _11"> </span>lies<span class="_ _11"> </span>at</div><div class="t m5 x1d h26 y62d5 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>intersection<span class="_ _13"> </span>of<span class="_"> </span>compilers<span class="_ _3"></span>,<span class="_"> </span>computer<span class="_"> </span>architecture<span class="_ _1"></span>,<span class="_"> </span>and<span class="_ _13"> </span>operating<span class="_"> </span>systems<span class="_ _1"></span>,<span class="_"> </span>link-</div><div class="t m5 x1d h26 y62d6 ff7 fs19 fc2 sc0 ls0 ws0">ing<span class="_ _14"> </span>requires<span class="_ _14"> </span>an<span class="_ _14"> </span>understanding<span class="_ _14"> </span>of<span class="_ _14"> </span>code<span class="_ _14"> </span>generation,<span class="_ _15"> </span>machine-language<span class="_ _15"> </span>program-</div><div class="t m5 x1d h26 y62d7 ff7 fs19 fc2 sc0 ls0 ws0">ming,<span class="_ _13"> </span>program<span class="_"> </span>instantiation,<span class="_ _13"> </span>and<span class="_ _13"> </span>virtual<span class="_"> </span>memory<span class="_ _7"></span>.<span class="_"> </span>It<span class="_ _13"> </span>does<span class="_"> </span>not<span class="_ _13"> </span>ﬁt<span class="_ _13"> </span>neatly<span class="_"> </span>into<span class="_ _13"> </span>any<span class="_"> </span>of</div><div class="t m5 x1d h26 y62d8 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>usual<span class="_"> </span>computer<span class="_"> </span>systems<span class="_"> </span>specialties<span class="_"> </span>and<span class="_"> </span>thus<span class="_"> </span>is<span class="_"> </span>not<span class="_"> </span>well<span class="_"> </span>covered<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span>classic</div><div class="t m5 x1d h26 y62d9 ff7 fs19 fc2 sc0 ls0 ws0">texts<span class="_ _11"> </span>in<span class="_ _11"> </span>these<span class="_ _11"> </span>areas<span class="_ _1"></span>.<span class="_ _16"> </span>However<span class="_ _0"></span>,<span class="_ _11"> </span>Levine’s<span class="_ _11"> </span>monograph<span class="_ _11"> </span>provides<span class="_ _11"> </span>a<span class="_ _11"> </span>good<span class="_ _11"> </span>general<span class="_ _16"> </span>ref-</div><div class="t m5 x1d h26 y62da ff7 fs19 fc2 sc0 ls0 ws0">erence<span class="_ _13"> </span>on<span class="_"> </span>the<span class="_ _13"> </span>subject<span class="_ _13"> </span>[69].<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>original<span class="_ _13"> </span>IA32<span class="_ _13"> </span>speciﬁcations<span class="_"> </span>for<span class="_ _13"> </span>ELF<span class="_ _13"> </span>and<span class="_"> </span>D<span class="_ _3"></span>W<span class="_ _3"></span>ARF</div><div class="t m5 x1d h26 y62db ff7 fs19 fc2 sc0 ls0 ws0">(a<span class="_"> </span>speciﬁcation<span class="_"> </span>for<span class="_ _11"> </span>the<span class="_"> </span>contents<span class="_ _11"> </span>of<span class="_"> </span>the<span class="_"> </span><span class="ffd">.debug<span class="_ _11"> </span></span>and<span class="_"> </span><span class="ffd">.line<span class="_ _11"> </span></span>sections)<span class="_"> </span>are<span class="_ _11"> </span>described</div><div class="t m5 x1d h26 y62dc ff7 fs19 fc2 sc0 ls0 ws0">in<span class="_ _16"> </span>[54].<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span>x86-64<span class="_ _16"> </span>extensions<span class="_ _16"> </span>to<span class="_ _16"> </span>the<span class="_ _16"> </span>ELF<span class="_ _14"> </span>ﬁle<span class="_ _16"> </span>format<span class="_ _16"> </span>are<span class="_ _16"> </span>described<span class="_ _16"> </span>in<span class="_ _16"> </span>[36].<span class="_ _16"> </span>T<span class="_ _1"></span>he</div><div class="t m5 x1d h26 y62dd ff7 fs19 fc2 sc0 ls0 ws0">x86-64<span class="_ _11"> </span>application<span class="_ _16"> </span>binary<span class="_ _11"> </span>interface<span class="_ _11"> </span>(ABI)<span class="_ _16"> </span>describes<span class="_ _11"> </span>the<span class="_ _16"> </span>conventions<span class="_ _11"> </span>for<span class="_ _11"> </span>compil-</div><div class="t m5 x1d h26 y62de ff7 fs19 fc2 sc0 ls0 ws0">ing,<span class="_"> </span>linking,<span class="_ _11"> </span>and<span class="_ _11"> </span>running<span class="_ _11"> </span>x86-64<span class="_ _11"> </span>programs<span class="_ _1"></span>,<span class="_ _11"> </span>including<span class="_ _11"> </span>the<span class="_ _11"> </span>rules<span class="_ _16"> </span>for<span class="_"> </span>relocation<span class="_ _11"> </span>and</div><div class="t m5 x1d h26 y62df ff7 fs19 fc2 sc0 ls0 ws0">position-independent<span class="_"> </span>code<span class="_"> </span>[77].</div><div class="t m5 x1d h29 y62e0 ffe fs14 fc2 sc0 ls0 ws0">Homework<span class="_"> </span>Problems</div><div class="t m5 x1d h73 y62e1 ffe fs1e fc6 sc0 ls0 ws0">7.6<span class="_ _23"> </span><span class="ff10 fs19">◆</span></div><div class="t m5 x1d h26 y62e2 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>problem<span class="_"> </span>concerns<span class="_ _13"> </span>the<span class="_"> </span><span class="ffd">m.o<span class="_ _10"> </span></span>module<span class="_"> </span>from<span class="_ _13"> </span>Figure<span class="_ _13"> </span>7.5<span class="_"> </span>and<span class="_"> </span>the<span class="_ _13"> </span>following<span class="_"> </span>version</div><div class="t m5 x1d h26 y62e3 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span>the<span class="_"> </span><span class="ffd">swap.c<span class="_ _10"> </span></span>function<span class="_"> </span>that<span class="_"> </span>counts<span class="_"> </span>the<span class="_"> </span>number<span class="_"> </span>of<span class="_"> </span>times<span class="_"> </span>it<span class="_"> </span>has<span class="_"> </span>been<span class="_"> </span>called:</div><div class="t m5 x1f h2d y464d ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">extern<span class="_ _1f"> </span>int<span class="_ _e"> </span>buf[];</span></div><div class="t m5 x1f h2e y2455 ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x1f h2e y62e4 ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x4f h2d y631 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>*bufp0<span class="_ _1f"> </span>=<span class="_ _1f"> </span>&amp;buf[0];</div><div class="t m5 x1f h2d yb97 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _1c"> </span><span class="ffd fs1e fc2">static<span class="_ _1f"> </span>int<span class="_ _e"> </span>*bufp1;</span></div><div class="t m5 x1f h2e y5fe ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x1f h2e y62e5 ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 x4f h2d yec2 ffd fs1e fc2 sc0 ls0 ws0">static<span class="_ _e"> </span>void<span class="_ _1f"> </span>incr()</div><div class="t m5 x1f h2d y5b5 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x1f h2d yc21 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _20"> </span><span class="ffd fs1e fc2">static<span class="_ _e"> </span>int<span class="_ _1f"> </span>count=0;</span></div><div class="t m5 x1f h2e y107b ff6 fs20 fc6 sc0 ls0 ws0">9</div><div class="t m5 x1b0 h2e y107c ff6 fs20 fc6 sc0 ls0 ws0">10</div><div class="t m5 x33 h2d ye93 ffd fs1e fc2 sc0 ls0 ws0">count++;</div><div class="t m5 x1b0 h2d y832 ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1b0 h2e y8d6 ff6 fs20 fc6 sc0 ls0 ws0">12</div><div class="t m5 x1b0 h2e ye94 ff6 fs20 fc6 sc0 ls0 ws0">13</div><div class="t m5 x4f h2d y77e ffd fs1e fc2 sc0 ls0 ws0">void<span class="_ _e"> </span>swap()</div><div class="t m5 x1b0 h2d ye95 ff6 fs20 fc6 sc0 ls0 ws0">14<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
