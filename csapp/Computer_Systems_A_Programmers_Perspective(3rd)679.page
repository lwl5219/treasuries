<div id="pf2a7" class="pf w2 h11" data-page-no="2a7"><div class="pc pc2a7 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg2a7.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">678<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>6<span class="_ _3d"> </span>The<span class="_ _10"> </span>Memory<span class="_ _10"> </span>Hierarchy</span></div><div class="t m5 x161 h91 y5a53 ff86 fs57 fc1 sc0 ls0 ws0">14,000</div><div class="t m5 x161 h91 y5a54 ff86 fs57 fc1 sc0 ls0 ws0">12,000</div><div class="t m5 x161 h91 y5a55 ff86 fs57 fc1 sc0 ls0 ws0">10,000</div><div class="t m5 xa4 h91 y5a56 ff86 fs57 fc1 sc0 ls0 ws0">8,000</div><div class="t m5 xa4 h91 y5a57 ff86 fs57 fc1 sc0 ls0 ws0">6,000</div><div class="t m5 xa4 h91 y5a58 ff86 fs57 fc1 sc0 ls0 ws0">4,000</div><div class="t m5 xa4 h91 y5a59 ff86 fs57 fc1 sc0 ls0 ws0">2,000</div><div class="t m5 x1c h91 y5a5a ff86 fs57 fc1 sc0 ls0 ws0">0</div><div class="t m7 x1a6 h91 y5a5b ff86 fs57 fc1 sc0 ls0 ws0">64 M</div><div class="t m7 x1ec h91 y5a5c ff86 fs57 fc1 sc0 ls0 ws0">128 M</div><div class="t m7 x22 h91 y5a5b ff86 fs57 fc1 sc0 ls0 ws0">32 M</div><div class="t m7 xfa h91 y5a5b ff86 fs57 fc1 sc0 ls0 ws0">16 M</div><div class="t m7 x176 h91 y5a5d ff86 fs57 fc1 sc0 ls0 ws0">8 M</div><div class="t m7 x121 h91 y5a5d ff86 fs57 fc1 sc0 ls0 ws0">4 M</div><div class="t m7 x1ae h91 y5a5d ff86 fs57 fc1 sc0 ls0 ws0">2 M</div><div class="t m7 x1c9 h91 y5a5e ff86 fs57 fc1 sc0 ls0 ws0">1,024 K</div><div class="t m7 x1a3 h91 y5a5f ff86 fs57 fc1 sc0 ls0 ws0">512 K</div><div class="t m7 xa9 h91 y5a5f ff86 fs57 fc1 sc0 ls0 ws0">256 K</div><div class="t m7 x196 h91 y5a5f ff86 fs57 fc1 sc0 ls0 ws0">128 K</div><div class="t m7 x132 h91 y5a60 ff86 fs57 fc1 sc0 ls0 ws0">64 K</div><div class="t m7 x24d h91 y5a60 ff86 fs57 fc1 sc0 ls0 ws0">32 K</div><div class="t m7 xeb h91 y5a60 ff86 fs57 fc1 sc0 ls0 ws0">16 K</div><div class="t m5 x16 h91 y5a61 ff7d fs57 fc1 sc0 ls0 ws0">W<span class="_ _1"></span>orking set size (bytes)</div><div class="t m7 x10b h91 y5a62 ff7d fs57 fc1 sc0 ls0 ws0">Read throughput (MB/s)</div><div class="t m5 x1e9 h91 y5a63 ff7d fs57 fc1 sc0 ls256 ws0">L1 cache</div><div class="t m5 x45 h91 y5a64 ff7d fs57 fc1 sc0 ls257 ws0">region</div><div class="t m5 xb9 h91 y5a63 ff7d fs57 fc1 sc0 ls256 ws0">L2 cache</div><div class="t m5 x107 h91 y5a64 ff7d fs57 fc1 sc0 ls257 ws0">region</div><div class="t m5 x184 h91 y5a63 ff7d fs57 fc1 sc0 ls256 ws0">L3 cache</div><div class="t m5 x101 h91 y5a64 ff7d fs57 fc1 sc0 ls257 ws0">region</div><div class="t m5 x18e h91 y5a63 ff7d fs57 fc1 sc0 ls258 ws0">Main memory</div><div class="t m5 x15c h91 y5a64 ff7d fs57 fc1 sc0 ls257 ws0">region</div><div class="t m5 x1d h34 y5a65 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>6.42<span class="_ _66"> </span><span class="fc1">Ridges<span class="_"> </span>of<span class="_"> </span>temporal<span class="_ _13"> </span>locality<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>memory<span class="_ _10"> </span>mountain.<span class="_ _10"> </span><span class="ff6">The<span class="_ _10"> </span>graph<span class="_ _13"> </span>shows</span></span></div><div class="t m5 x1d h34 y5a66 ff6 fs16 fc1 sc0 ls0 ws0">a<span class="_ _10"> </span>slice<span class="_ _11"> </span>through<span class="_ _10"> </span>Figure<span class="_ _10"> </span>6.41<span class="_ _11"> </span>with</div><div class="t m5 x1c8 h35 y5a67 ffd fs19 fc1 sc0 ls0 ws0">stride<span class="_ _6"> </span><span class="ff12 fs16">=<span class="_ _13"> </span><span class="ff7">8<span class="ff6">.</span></span></span></div><div class="t m5 x1d h26 y579 ff7 fs19 fc1 sc0 ls0 ws0">details<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>particular<span class="_ _6"> </span>prefetching<span class="_ _13"> </span>algorithm<span class="_ _13"> </span>are<span class="_ _13"> </span>not<span class="_ _13"> </span>documented,<span class="_ _13"> </span>it<span class="_ _13"> </span>is<span class="_ _13"> </span>clear<span class="_ _13"> </span>from</div><div class="t m5 x1d h26 y57a ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _6"> </span>memory<span class="_ _6"> </span>mountain<span class="_ _13"> </span>that<span class="_ _6"> </span>the<span class="_ _6"> </span>algorithm<span class="_ _6"> </span>works<span class="_ _13"> </span>best<span class="_ _6"> </span>for<span class="_ _6"> </span>small<span class="_ _6"> </span>strides—yet<span class="_ _13"> </span>another</div><div class="t m5 x1d h26 y57b ff7 fs19 fc1 sc0 ls0 ws0">reason<span class="_"> </span>to<span class="_"> </span>favor<span class="_"> </span>sequential<span class="_"> </span>stride-1<span class="_"> </span>accesses<span class="_"> </span>in<span class="_"> </span>your<span class="_"> </span>code<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y57c ff7 fs19 fc1 sc0 ls0 ws0">If<span class="_"> </span>we<span class="_"> </span>take<span class="_ _13"> </span>a<span class="_"> </span>slice<span class="_"> </span>through<span class="_"> </span>the<span class="_ _13"> </span>mountain,<span class="_"> </span>holding<span class="_"> </span>the<span class="_"> </span>stride<span class="_ _13"> </span>constant<span class="_"> </span>as<span class="_"> </span>in<span class="_"> </span>F<span class="_ _1"></span>ig-</div><div class="t m5 x1d h26 y57d ff7 fs19 fc1 sc0 ls0 ws0">ure<span class="_ _6"> </span>6.42,<span class="_ _13"> </span>we<span class="_ _6"> </span>can<span class="_ _13"> </span>see<span class="_ _6"> </span>the<span class="_ _6"> </span>impact<span class="_ _13"> </span>of<span class="_ _6"> </span>cache<span class="_ _6"> </span>size<span class="_ _13"> </span>and<span class="_ _6"> </span>temporal<span class="_ _6"> </span>locality<span class="_ _13"> </span>on<span class="_ _6"> </span>performance<span class="_ _1"></span>.</div><div class="t m5 x1d h26 y5a68 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _14"> </span>sizes<span class="_ _16"> </span>up<span class="_ _14"> </span>to<span class="_ _14"> </span>32<span class="_ _14"> </span>KB<span class="_ _3"></span>,<span class="_ _15"> </span>the<span class="_ _16"> </span>working<span class="_ _14"> </span>set<span class="_ _14"> </span>ﬁts<span class="_ _14"> </span>entirely<span class="_ _16"> </span>in<span class="_ _14"> </span>the<span class="_ _14"> </span>L1<span class="_ _14"> </span>d-cache<span class="_ _1"></span>,<span class="_ _15"> </span>and<span class="_ _14"> </span>thus</div><div class="t m5 x1d h26 y5a69 ff7 fs19 fc1 sc0 ls0 ws0">reads<span class="_"> </span>are<span class="_ _13"> </span>served<span class="_"> </span>from<span class="_"> </span>L1<span class="_"> </span>at<span class="_ _13"> </span>throughput<span class="_"> </span>of<span class="_"> </span>about<span class="_ _13"> </span>12<span class="_"> </span>GB/s<span class="_ _1"></span>.<span class="_"> </span>F<span class="_ _3"></span>or<span class="_"> </span>sizes<span class="_"> </span>up<span class="_"> </span>to<span class="_ _13"> </span>256<span class="_"> </span>KB<span class="_ _3"></span>,</div><div class="t m5 x1d h26 y5a6a ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>working<span class="_"> </span>set<span class="_"> </span>ﬁts<span class="_"> </span>entirely<span class="_ _11"> </span>in<span class="_"> </span>the<span class="_"> </span>uniﬁed<span class="_"> </span>L2<span class="_ _11"> </span>cache<span class="_ _1"></span>,<span class="_ _11"> </span>and<span class="_"> </span>for<span class="_"> </span>sizes<span class="_"> </span>up<span class="_ _11"> </span>to<span class="_"> </span>8<span class="_"> </span>MB<span class="_ _1"></span>,<span class="_"> </span>the</div><div class="t m5 x1d h26 y5a6b ff7 fs19 fc1 sc0 ls0 ws0">working<span class="_ _6"> </span>set<span class="_ _13"> </span>ﬁts<span class="_ _6"> </span>entirely<span class="_ _13"> </span>in<span class="_ _6"> </span>the<span class="_ _13"> </span>uniﬁed<span class="_ _6"> </span>L3<span class="_ _6"> </span>cache.<span class="_ _6"> </span>Larger<span class="_ _13"> </span>working<span class="_ _6"> </span>set<span class="_ _6"> </span>sizes<span class="_ _13"> </span>are<span class="_ _6"> </span>served</div><div class="t m5 x1d h26 y5a6c ff7 fs19 fc1 sc0 ls0 ws0">primarily<span class="_"> </span>from<span class="_"> </span>main<span class="_"> </span>memory<span class="_ _3"></span>.</div><div class="t m5 x29 h26 y5a6d ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _14"> </span>dips<span class="_ _16"> </span>in<span class="_ _14"> </span>read<span class="_ _16"> </span>throughputs<span class="_ _16"> </span>at<span class="_ _14"> </span>the<span class="_ _16"> </span>leftmost<span class="_ _14"> </span>edges<span class="_ _16"> </span>of<span class="_ _14"> </span>the<span class="_ _16"> </span>L2<span class="_ _16"> </span>and<span class="_ _14"> </span>L3<span class="_ _16"> </span>cache</div><div class="t m5 x1d h26 y5a6e ff7 fs19 fc1 sc0 ls0 ws0">regions—where<span class="_ _15"> </span>the<span class="_ _15"> </span>working<span class="_ _21"> </span>set<span class="_ _15"> </span>sizes<span class="_ _21"> </span>of<span class="_ _15"> </span>256<span class="_ _21"> </span>KB<span class="_ _15"> </span>and<span class="_ _21"> </span>8<span class="_ _15"> </span>MB<span class="_ _21"> </span>are<span class="_ _15"> </span>equal<span class="_ _15"> </span>to<span class="_ _21"> </span>their</div><div class="t m5 x1d h26 y5a6f ff7 fs19 fc1 sc0 ls0 ws0">respective<span class="_ _6"> </span>cache<span class="_ _13"> </span>sizes—are<span class="_ _6"> </span>interesting.<span class="_ _6"> </span>It<span class="_ _6"> </span>is<span class="_ _13"> </span>not<span class="_ _a"> </span>entirely<span class="_ _13"> </span>clear<span class="_ _6"> </span>why<span class="_ _6"> </span>these<span class="_ _13"> </span>dips<span class="_ _6"> </span>occur.</div><div class="t m5 x1d h26 y5a70 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _11"> </span>only<span class="_"> </span>way<span class="_ _11"> </span>to<span class="_ _11"> </span>be<span class="_"> </span>sure<span class="_ _11"> </span>is<span class="_"> </span>to<span class="_ _11"> </span>perform<span class="_"> </span>a<span class="_ _11"> </span>detailed<span class="_"> </span>cache<span class="_ _11"> </span>simulation,<span class="_ _11"> </span>but<span class="_"> </span>it<span class="_ _11"> </span>is<span class="_"> </span>likely</div><div class="t m5 x1d h26 y5a71 ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_"> </span>the<span class="_"> </span>drops<span class="_"> </span>are<span class="_"> </span>caused<span class="_"> </span>by<span class="_"> </span>conﬂicts<span class="_"> </span>with<span class="_"> </span>other<span class="_"> </span>code<span class="_"> </span>and<span class="_"> </span>data<span class="_"> </span>lines<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y5a72 ff7 fs19 fc1 sc0 ls0 ws0">Slicing<span class="_"> </span>through<span class="_ _11"> </span>the<span class="_ _11"> </span>memory<span class="_ _11"> </span>mountain<span class="_ _11"> </span>in<span class="_ _11"> </span>the<span class="_ _11"> </span>opposite<span class="_ _11"> </span>direction,<span class="_ _11"> </span>holding<span class="_"> </span>the</div><div class="t m5 x1d h26 y5a73 ff7 fs19 fc1 sc0 ls0 ws0">working<span class="_ _6"> </span>set<span class="_ _6"> </span>size<span class="_ _6"> </span>constant,<span class="_ _6"> </span>gives<span class="_ _13"> </span>us<span class="_ _a"> </span>some<span class="_ _6"> </span>insight<span class="_ _6"> </span>into<span class="_ _6"> </span>the<span class="_ _6"> </span>impact<span class="_ _6"> </span>of<span class="_ _6"> </span>spatial<span class="_ _6"> </span>locality<span class="_ _6"> </span>on</div><div class="t m5 x1d h26 y5a74 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>read<span class="_ _13"> </span>throughput.<span class="_"> </span>F<span class="_ _1"></span>or<span class="_"> </span>example<span class="_ _1"></span>,<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>6.43<span class="_"> </span>shows<span class="_"> </span>the<span class="_ _13"> </span>slice<span class="_"> </span>for<span class="_"> </span>a<span class="_ _13"> </span>ﬁxed<span class="_"> </span>working</div><div class="t m5 x1d h26 y5a75 ff7 fs19 fc1 sc0 ls0 ws0">set<span class="_ _6"> </span>size<span class="_ _13"> </span>of<span class="_ _6"> </span>4<span class="_ _6"> </span>MB<span class="_ _1"></span>.<span class="_ _6"> </span>This<span class="_ _a"> </span>slice<span class="_ _13"> </span>cuts<span class="_ _6"> </span>along<span class="_ _6"> </span>the<span class="_ _13"> </span>L3<span class="_ _6"> </span>ridge<span class="_ _6"> </span>in<span class="_ _13"> </span>F<span class="_ _1"></span>igure<span class="_ _6"> </span>6.41,<span class="_ _13"> </span>where<span class="_ _6"> </span>the<span class="_ _13"> </span>working</div><div class="t m5 x1d h26 y5a76 ff7 fs19 fc1 sc0 ls0 ws0">set<span class="_"> </span>ﬁts<span class="_"> </span>entirely<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>L3<span class="_"> </span>cache<span class="_"> </span>but<span class="_"> </span>is<span class="_"> </span>too<span class="_"> </span>large<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>L2<span class="_"> </span>cache<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y5a77 ff7 fs19 fc1 sc0 ls0 ws0">Notice<span class="_ _6"> </span>how<span class="_ _6"> </span>the<span class="_ _13"> </span>read<span class="_ _a"> </span>throughput<span class="_ _13"> </span>decreases<span class="_ _a"> </span>steadily<span class="_ _13"> </span>as<span class="_ _a"> </span>the<span class="_ _13"> </span>stride<span class="_ _a"> </span>increases<span class="_ _13"> </span>from</div><div class="t m5 x1d h26 y5a78 ff7 fs19 fc1 sc0 ls0 ws0">one<span class="_ _14"> </span>to<span class="_ _14"> </span>eight<span class="_ _15"> </span>words<span class="_ _1"></span>.<span class="_ _14"> </span>In<span class="_ _15"> </span>this<span class="_ _14"> </span>region<span class="_ _15"> </span>of<span class="_ _14"> </span>the<span class="_ _14"> </span>mountain,<span class="_ _21"> </span>a<span class="_ _14"> </span>read<span class="_ _15"> </span>miss<span class="_ _14"> </span>in<span class="_ _14"> </span>L2<span class="_ _15"> </span>causes<span class="_ _14"> </span>a</div><div class="t m5 x1d h26 y5a79 ff7 fs19 fc1 sc0 ls0 ws0">block<span class="_ _16"> </span>to<span class="_ _11"> </span>be<span class="_ _16"> </span>transferred<span class="_ _16"> </span>from<span class="_ _16"> </span>L3<span class="_ _11"> </span>to<span class="_ _16"> </span>L2.<span class="_ _16"> </span>T<span class="_ _1"></span>his<span class="_ _16"> </span>is<span class="_ _16"> </span>followed<span class="_ _11"> </span>by<span class="_ _16"> </span>some<span class="_ _16"> </span>number<span class="_ _16"> </span>of<span class="_ _11"> </span>hits</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
