<div id="pf386" class="pf w2 h11" data-page-no="386"><div class="pc pc386 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg386.png"/><div class="t m5 x1f8 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>9.10<span class="_ _60"> </span>Garbage<span class="_ _10"> </span>Collection<span class="_ _3e"> </span><span class="ffe fs1e">901</span></div><div class="t m5 x17 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">repeat<span class="_ _13"> </span>until<span class="_"> </span>we<span class="_ _13"> </span>ﬁnd<span class="_ _13"> </span>a<span class="_"> </span>block<span class="_ _13"> </span>that<span class="_ _13"> </span>ﬁts<span class="_ _1"></span>.<span class="_"> </span>If<span class="_ _13"> </span>none<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>free<span class="_ _13"> </span>lists<span class="_"> </span>yields<span class="_ _13"> </span>a<span class="_"> </span>block<span class="_ _13"> </span>that<span class="_ _13"> </span>ﬁts<span class="_ _1"></span>,</div><div class="t m5 x17 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">then<span class="_"> </span>we<span class="_"> </span>request<span class="_ _13"> </span>additional<span class="_"> </span>heap<span class="_"> </span>memory<span class="_"> </span>from<span class="_"> </span>the<span class="_"> </span>operating<span class="_ _13"> </span>system,<span class="_"> </span>allocate<span class="_"> </span>the</div><div class="t m5 x17 h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">block<span class="_ _11"> </span>out<span class="_ _11"> </span>of<span class="_ _16"> </span>this<span class="_ _11"> </span>new<span class="_ _11"> </span>heap<span class="_ _16"> </span>memory<span class="_ _7"></span>,<span class="_ _16"> </span>and<span class="_ _11"> </span>place<span class="_ _11"> </span>the<span class="_ _16"> </span>remainder<span class="_ _11"> </span>in<span class="_ _11"> </span>the<span class="_ _11"> </span>appropriate</div><div class="t m5 x17 h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">size<span class="_ _14"> </span>class<span class="_ _1"></span>.<span class="_ _14"> </span>T<span class="_ _7"></span>o<span class="_ _14"> </span>free<span class="_ _14"> </span>a<span class="_ _14"> </span>block,<span class="_ _15"> </span>we<span class="_ _14"> </span>coalesce<span class="_ _14"> </span>and<span class="_ _14"> </span>place<span class="_ _14"> </span>the<span class="_ _14"> </span>result<span class="_ _14"> </span>on<span class="_ _14"> </span>the<span class="_ _14"> </span>appropriate</div><div class="t m5 x17 h26 y2f8 ff7 fs19 fc2 sc0 ls0 ws0">free<span class="_"> </span>list.</div><div class="t m5 x26 h26 y2f9 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _e"> </span>segregated<span class="_ _f"> </span>ﬁts<span class="_ _f"> </span>approach<span class="_ _e"> </span>is<span class="_ _f"> </span>a<span class="_ _f"> </span>popular<span class="_ _e"> </span>choice<span class="_ _f"> </span>with<span class="_ _f"> </span>production-quality</div><div class="t m5 x17 h26 y2fa ff7 fs19 fc2 sc0 ls0 ws0">allocators<span class="_ _16"> </span>such<span class="_ _11"> </span>as<span class="_ _16"> </span>the<span class="_ _16"> </span>GNU<span class="_ _16"> </span><span class="ffd">malloc<span class="_ _16"> </span></span>package<span class="_ _16"> </span>provided<span class="_ _11"> </span>in<span class="_ _16"> </span>the<span class="_ _16"> </span>C<span class="_ _16"> </span>standard<span class="_ _16"> </span>library</div><div class="t m5 x17 h26 y2fb ff7 fs19 fc2 sc0 ls0 ws0">because<span class="_ _16"> </span>it<span class="_ _14"> </span>is<span class="_ _16"> </span>both<span class="_ _16"> </span>fast<span class="_ _14"> </span>and<span class="_ _16"> </span>memory<span class="_ _14"> </span>efﬁcient.<span class="_ _16"> </span>Search<span class="_ _14"> </span>times<span class="_ _16"> </span>are<span class="_ _16"> </span>reduced<span class="_ _14"> </span>because</div><div class="t m5 x17 h26 y2fc ff7 fs19 fc2 sc0 ls0 ws0">searches<span class="_ _14"> </span>are<span class="_ _15"> </span>limited<span class="_ _15"> </span>to<span class="_ _14"> </span>particular<span class="_ _15"> </span>parts<span class="_ _15"> </span>of<span class="_ _14"> </span>the<span class="_ _15"> </span>heap<span class="_ _15"> </span>instead<span class="_ _14"> </span>of<span class="_ _15"> </span>the<span class="_ _15"> </span>entire<span class="_ _14"> </span>heap.</div><div class="t m5 x17 h26 y2fd ff7 fs19 fc2 sc0 ls0 ws0">Memory<span class="_ _13"> </span>utilization<span class="_"> </span>can<span class="_ _13"> </span>improve<span class="_ _13"> </span>because<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>interesting<span class="_ _13"> </span>fact<span class="_"> </span>that<span class="_ _13"> </span>a<span class="_ _13"> </span>simple<span class="_"> </span>ﬁrst-</div><div class="t m5 x17 h26 y2fe ff7 fs19 fc2 sc0 ls0 ws0">ﬁt<span class="_ _13"> </span>search<span class="_ _13"> </span>of<span class="_ _13"> </span>a<span class="_ _13"> </span>segregated<span class="_ _13"> </span>free<span class="_ _13"> </span>list<span class="_ _13"> </span>approximates<span class="_ _13"> </span>a<span class="_ _6"> </span>best-ﬁt<span class="_ _13"> </span>search<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>entire<span class="_ _13"> </span>heap<span class="_ _0"></span>.</div><div class="t m5 x17 h42 y7484 ff6 fs29 fc6 sc0 ls0 ws0">Buddy<span class="_ _11"> </span>Systems</div><div class="t m5 x17 h26 y7485 ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_ _13"> </span><span class="ffa">buddy<span class="_"> </span>system<span class="_ _13"> </span></span>is<span class="_ _13"> </span>a<span class="_"> </span>special<span class="_ _13"> </span>case<span class="_ _13"> </span>of<span class="_"> </span>segregated<span class="_ _13"> </span>ﬁts<span class="_ _13"> </span>where<span class="_"> </span>each<span class="_ _13"> </span>size<span class="_ _13"> </span>class<span class="_"> </span>is<span class="_ _13"> </span>a<span class="_ _13"> </span>power</div><div class="t m5 x17 h26 y7486 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span>2.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>basic<span class="_"> </span>idea<span class="_"> </span>is<span class="_"> </span>that,<span class="_ _13"> </span>given<span class="_"> </span>a<span class="_"> </span>heap<span class="_"> </span>of<span class="_"> </span>2</div><div class="t m5 xaa h50 y7487 ff11 fs25 fc1 sc0 ls0 ws0">m</div><div class="t m5 x16 h26 y7488 ff7 fs19 fc1 sc0 ls0 ws0">words<span class="_ _1"></span>,<span class="_"> </span>we<span class="_"> </span>maintain<span class="_"> </span>a<span class="_"> </span>separate<span class="_ _13"> </span>free</div><div class="t m5 x17 h26 y7489 ff7 fs19 fc1 sc0 ls0 ws0">list<span class="_ _13"> </span>for<span class="_"> </span>each<span class="_ _13"> </span>block<span class="_ _13"> </span>size<span class="_ _13"> </span>2</div><div class="t m5 x66 h50 y748a ff11 fs25 fc1 sc0 ls0 ws0">k</div><div class="t m5 x1a8 h46 y748b ff7 fs19 fc1 sc0 ls0 ws0">,<span class="_ _13"> </span>where<span class="_"> </span>0<span class="_ _13"> </span><span class="ff12">≤<span class="_ _13"></span><span class="ff11">k<span class="_ _10"> </span></span>≤<span class="_ _10"> </span><span class="ff11">m</span></span>.<span class="_ _13"> </span>Requested<span class="_ _13"> </span>block<span class="_"> </span>sizes<span class="_ _13"> </span>are<span class="_ _13"> </span>rounded<span class="_ _13"> </span>up</div><div class="t m5 x17 h26 y748c ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_"> </span>the<span class="_"> </span>nearest<span class="_"> </span>power<span class="_"> </span>of<span class="_"> </span>2.<span class="_"> </span>Originally<span class="_ _3"></span>,<span class="_"> </span>there<span class="_"> </span>is<span class="_"> </span>one<span class="_"> </span>free<span class="_"> </span>block<span class="_"> </span>of<span class="_"> </span>size<span class="_"> </span>2</div><div class="t m5 x11a h50 y748d ff11 fs25 fc1 sc0 ls0 ws0">m</div><div class="t m5 x1dd h26 y748e ff7 fs19 fc1 sc0 ls0 ws0">words<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y748f ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_ _11"> </span>allocate<span class="_"> </span>a<span class="_"> </span>block<span class="_"> </span>of<span class="_"> </span>size<span class="_"> </span>2</div><div class="t m5 x79 h50 y7490 ff11 fs25 fc1 sc0 ls0 ws0">k</div><div class="t m5 x183 h26 y7491 ff7 fs19 fc1 sc0 ls0 ws0">,<span class="_"> </span>we<span class="_"> </span>ﬁnd<span class="_"> </span>the<span class="_"> </span>ﬁrst<span class="_ _11"> </span>available<span class="_"> </span>block<span class="_"> </span>of<span class="_"> </span>size<span class="_"> </span>2</div><div class="t m5 xb4 h50 y7490 ff11 fs25 fc1 sc0 ls0 ws0">j</div><div class="t m5 x261 h26 y7491 ff7 fs19 fc1 sc0 ls0 ws0">,<span class="_"> </span>such</div><div class="t m5 x17 h46 y7492 ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_ _6"> </span><span class="ff11">k<span class="_ _10"> </span><span class="ff12">≤<span class="_ _13"> </span></span>j<span class="_"> </span><span class="ff12">≤<span class="_ _13"></span></span>m</span><span class="ls2c5">.I<span class="_ _8"></span>f<span class="ff11 ls0">j<span class="_"> </span><span class="ff12">=<span class="_ _13"></span></span>k<span class="_ _2"></span><span class="ff7">,<span class="_ _13"> </span>then<span class="_ _6"> </span>we<span class="_ _6"> </span>are<span class="_ _13"> </span>done<span class="_ _1"></span>.<span class="_ _13"> </span>Otherwise<span class="_ _1"></span>,<span class="_ _13"> </span>we<span class="_ _6"> </span>recursively<span class="_ _13"> </span>split<span class="_ _6"> </span>the<span class="_ _13"> </span>block</span></span></span></div><div class="t m5 x17 h46 y7493 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_"> </span>half<span class="_ _11"> </span>until<span class="_"> </span><span class="ff11">j<span class="_"> </span><span class="ff12">=<span class="_ _10"> </span></span>k<span class="_ _2"></span></span>.<span class="_"> </span>As<span class="_"> </span>we<span class="_ _11"> </span>perform<span class="_ _11"> </span>this<span class="_"> </span>splitting,<span class="_"> </span>each<span class="_ _11"> </span>remaining<span class="_"> </span>half<span class="_ _11"> </span>(known<span class="_"> </span>as<span class="_ _11"> </span>a</div><div class="t m5 x17 h26 y7494 ffa fs19 fc1 sc0 ls0 ws0">buddy<span class="ff7">)<span class="_ _6"> </span>is<span class="_ _13"> </span>placed<span class="_ _13"> </span>on<span class="_ _6"> </span>the<span class="_ _13"> </span>appropriate<span class="_ _13"> </span>free<span class="_ _6"> </span>list.<span class="_ _13"> </span>T<span class="_ _7"></span>o<span class="_ _13"> </span>free<span class="_ _13"> </span>a<span class="_ _6"> </span>block<span class="_ _13"> </span>of<span class="_ _13"> </span>size<span class="_ _6"> </span>2</span></div><div class="t m5 x152 h50 y7495 ff11 fs25 fc1 sc0 ls0 ws0">k</div><div class="t m5 x22f h26 y7496 ff7 fs19 fc1 sc0 ls0 ws0">,<span class="_ _13"> </span>we<span class="_ _13"> </span>continue</div><div class="t m5 x17 h26 y7497 ff7 fs19 fc1 sc0 ls0 ws0">coalescing<span class="_ _13"> </span>with<span class="_"> </span>the<span class="_ _13"> </span>free<span class="_ _13"> </span>buddies<span class="_ _1"></span>.<span class="_"> </span>When<span class="_ _13"> </span>we<span class="_ _13"> </span>encounter<span class="_"> </span>an<span class="_ _13"> </span>allocated<span class="_ _13"> </span>buddy<span class="_ _3"></span>,<span class="_"> </span>we<span class="_ _13"> </span>stop</div><div class="t m5 x17 h26 y7498 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>coalescing.</div><div class="t m5 x26 h26 y7499 ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_"> </span>key<span class="_ _13"> </span>fact<span class="_"> </span>about<span class="_"> </span>buddy<span class="_"> </span>systems<span class="_ _13"> </span>is<span class="_"> </span>that,<span class="_"> </span>given<span class="_"> </span>the<span class="_ _13"> </span>address<span class="_"> </span>and<span class="_"> </span>size<span class="_ _13"> </span>of<span class="_"> </span>a<span class="_"> </span>block,</div><div class="t m5 x17 h26 y749a ff7 fs19 fc1 sc0 ls0 ws0">it<span class="_ _13"> </span>is<span class="_ _13"> </span>easy<span class="_ _13"> </span>to<span class="_ _13"> </span>compute<span class="_ _13"> </span>the<span class="_ _13"> </span>address<span class="_"> </span>of<span class="_ _13"> </span>its<span class="_ _13"> </span>buddy<span class="_ _7"></span>.<span class="_ _13"> </span>F<span class="_ _1"></span>or<span class="_"> </span>example<span class="_ _1"></span>,<span class="_ _13"> </span>a<span class="_ _13"> </span>block<span class="_ _13"> </span>of<span class="_ _13"> </span>size<span class="_"> </span>32<span class="_ _13"> </span>bytes</div><div class="t m5 x17 h26 y749b ff7 fs19 fc1 sc0 ls0 ws0">with<span class="_"> </span>address</div><div class="t m5 x183 h26 y749c ff11 fs19 fc1 sc0 ls42 ws0">x<span class="_ _8"></span>x<span class="_ _4"></span>x<span class="_ _5"></span>...x<span class="_ _4"></span><span class="ff7 ls0">00000</span></div><div class="t m5 x17 h26 y749d ff7 fs19 fc1 sc0 ls0 ws0">has<span class="_"> </span>its<span class="_"> </span>buddy<span class="_"> </span>at<span class="_"> </span>address</div><div class="t m5 x183 h26 y749e ff11 fs19 fc1 sc0 ls42 ws0">x<span class="_ _8"></span>x<span class="_ _4"></span>x<span class="_ _5"></span>...x<span class="_ _4"></span><span class="ff7 ls0">10000</span></div><div class="t m5 x17 h26 y749f ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _16"> </span>other<span class="_ _14"> </span>words<span class="_ _1"></span>,<span class="_ _14"> </span>the<span class="_ _14"> </span>addresses<span class="_ _16"> </span>of<span class="_ _14"> </span>a<span class="_ _16"> </span>block<span class="_ _14"> </span>and<span class="_ _16"> </span>its<span class="_ _14"> </span>buddy<span class="_ _16"> </span>differ<span class="_ _14"> </span>in<span class="_ _16"> </span>exactly<span class="_ _14"> </span>one<span class="_ _16"> </span>bit</div><div class="t m5 x17 h26 y74a0 ff7 fs19 fc1 sc0 ls0 ws0">position.</div><div class="t m5 x26 h26 y74a1 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _15"> </span>major<span class="_ _15"> </span>advantage<span class="_ _15"> </span>of<span class="_ _15"> </span>a<span class="_ _15"> </span>buddy<span class="_ _15"> </span>system<span class="_ _15"> </span>allocator<span class="_ _15"> </span>is<span class="_ _15"> </span>its<span class="_ _15"> </span>fast<span class="_ _15"> </span>searching<span class="_ _15"> </span>and</div><div class="t m5 x17 h26 y74a2 ff7 fs19 fc1 sc0 ls0 ws0">coalescing.<span class="_ _14"> </span>The<span class="_ _14"> </span>major<span class="_ _15"> </span>disadvantage<span class="_ _21"> </span>is<span class="_ _15"> </span>that<span class="_ _15"> </span>the<span class="_ _21"> </span>power<span class="_ _1"></span>-of-2<span class="_ _15"> </span>requirement<span class="_ _15"> </span>on<span class="_ _21"> </span>the</div><div class="t m5 x17 h26 y74a3 ff7 fs19 fc1 sc0 ls0 ws0">block<span class="_ _15"> </span>size<span class="_ _15"> </span>can<span class="_ _15"> </span>cause<span class="_ _15"> </span>signiﬁcant<span class="_ _15"> </span>internal<span class="_ _15"> </span>fragmentation.<span class="_ _15"> </span>F<span class="_ _1"></span>or<span class="_ _15"> </span>this<span class="_ _15"> </span>reason,<span class="_ _f"> </span>buddy</div><div class="t m5 x17 h26 y74a4 ff7 fs19 fc1 sc0 ls0 ws0">system<span class="_ _16"> </span>allocators<span class="_ _11"> </span>are<span class="_ _16"> </span>not<span class="_ _16"> </span>appropriate<span class="_ _11"> </span>for<span class="_ _16"> </span>general-purpose<span class="_ _16"> </span>workloads<span class="_ _1"></span>.<span class="_ _11"> </span>However,</div><div class="t m5 x17 h26 y74a5 ff7 fs19 fc1 sc0 ls0 ws0">for<span class="_ _15"> </span>certain<span class="_ _15"> </span>application-speciﬁc<span class="_ _21"> </span>workloads<span class="_ _1"></span>,<span class="_ _21"> </span>where<span class="_ _21"> </span>the<span class="_ _15"> </span>block<span class="_ _21"> </span>sizes<span class="_ _15"> </span>are<span class="_ _15"> </span>known<span class="_ _21"> </span>in</div><div class="t m5 x17 h26 y74a6 ff7 fs19 fc1 sc0 ls0 ws0">advance<span class="_"> </span>to<span class="_"> </span>be<span class="_"> </span>powers<span class="_"> </span>of<span class="_"> </span>2,<span class="_"> </span>buddy<span class="_"> </span>system<span class="_"> </span>allocators<span class="_"> </span>have<span class="_"> </span>a<span class="_"> </span>certain<span class="_"> </span>appeal.</div><div class="t m5 x17 h3b y5ea6 fff fs24 fc6 sc0 ls0 ws0">9.10</div><div class="t m5 x123 h3e y5a10 ffe fs18 fc6 sc0 ls0 ws0">Garbage<span class="_"> </span>Collection</div><div class="t m5 x17 h26 y345b ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _1"></span>ith<span class="_ _11"> </span>an<span class="_"> </span>explicit<span class="_"> </span>allocator<span class="_"> </span>such<span class="_"> </span>as<span class="_ _11"> </span>the<span class="_"> </span>C<span class="_"> </span><span class="ffd">malloc<span class="_ _11"> </span></span>package<span class="_ _1"></span>,<span class="_ _11"> </span>an<span class="_"> </span>application<span class="_"> </span>allocates</div><div class="t m5 x17 h26 y4ad6 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_"> </span>frees<span class="_ _11"> </span>heap<span class="_ _11"> </span>blocks<span class="_"> </span>by<span class="_ _11"> </span>making<span class="_ _11"> </span>calls<span class="_"> </span>to<span class="_ _11"> </span><span class="ffd">malloc<span class="_ _11"> </span></span>and<span class="_"> </span><span class="ffd">free</span>.<span class="_ _11"> </span>It<span class="_ _11"> </span>is<span class="_"> </span>the<span class="_ _11"> </span>application’s</div><div class="t m5 x17 h26 y5ea7 ff7 fs19 fc1 sc0 ls0 ws0">responsibility<span class="_"> </span>to<span class="_"> </span>free<span class="_"> </span>any<span class="_"> </span>allocated<span class="_"> </span>blocks<span class="_"> </span>that<span class="_"> </span>it<span class="_"> </span>no<span class="_"> </span>longer<span class="_"> </span>needs<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
