<div id="pf32c" class="pf w2 h11" data-page-no="32c"><div class="pc pc32c w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg32c.png"/><div class="t m5 x1e0 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>8.5<span class="_ _60"> </span>Signals<span class="_ _3e"> </span><span class="ffe fs1e">811</span></div><div class="t m5 x61 h2c y27f ffa fs16 fc2 sc0 ls0 ws0">code/src/csapp<span class="_ _1"></span>.c</div><div class="t m5 x2c h2d y280 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">handler_t<span class="_ _1f"> </span>*Signal(int<span class="_ _e"> </span>signum,<span class="_ _1f"> </span>handler_t<span class="_ _1f"> </span>*handler)</span></div><div class="t m5 x2c h2d y281 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x2c h2d y283 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2">struct<span class="_ _e"> </span>sigaction<span class="_ _1f"> </span>action,<span class="_ _1f"> </span>old_action;</span></div><div class="t m5 x2c h2e y284 ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 x2c h2e y69c3 ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x142 h2d y285 ffd fs1e fc2 sc0 ls0 ws0">action.sa_handler<span class="_ _e"> </span>=<span class="_ _1f"> </span>handler;</div><div class="t m5 x2c h2d y286 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _20"> </span><span class="ffd fs1e fc2">sigemptyset(&amp;action.sa_mask);<span class="_ _e"> </span>/*<span class="_ _1f"> </span>Block<span class="_ _1f"> </span>sigs<span class="_ _e"> </span>of<span class="_ _1f"> </span>type<span class="_ _e"> </span>being<span class="_ _1f"> </span>handled<span class="_ _1f"> </span>*/</span></div><div class="t m5 x2c h2d y287 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _20"> </span><span class="ffd fs1e fc2">action.sa_flags<span class="_ _e"> </span>=<span class="_ _1f"> </span>SA_RESTART;<span class="_ _1f"> </span>/*<span class="_ _e"> </span>Restart<span class="_ _1f"> </span>syscalls<span class="_ _e"> </span>if<span class="_ _1f"> </span>possible<span class="_ _1f"> </span>*/</span></div><div class="t m5 x2c h2e y4493 ff6 fs20 fc6 sc0 ls0 ws0">8</div><div class="t m5 x2c h2e y66b4 ff6 fs20 fc6 sc0 ls0 ws0">9</div><div class="t m5 x142 h2d y4a9a ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>(sigaction(signum,<span class="_ _1f"> </span>&amp;action,<span class="_ _1f"> </span>&amp;old_action)<span class="_ _e"> </span>&lt;<span class="_ _1f"> </span>0)</div><div class="t m5 x17 h2d y4a9b ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _70"> </span><span class="ffd fs1e fc2">unix_error(&quot;Signal<span class="_ _e"> </span>error&quot;);</span></div><div class="t m5 x17 h2d y4a9c ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _20"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>(old_action.sa_handler);</span></div><div class="t m5 x17 h2d y906 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x61 h2c y69c4 ffa fs16 fc2 sc0 ls0 ws0">code/src/csapp<span class="_ _1"></span>.c</div><div class="t m5 x17 h2f y69c5 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>8.38</div><div class="t m5 x156 h3a y69c6 ffd fs19 fc1 sc0 ls0 ws0">Signal<span class="ffe fs16">.<span class="_"> </span><span class="ff6">A<span class="_ _11"> </span>wrapper<span class="_ _11"> </span>for<span class="_ _11"> </span></span></span>sigaction<span class="_ _10"> </span><span class="ff6 fs16">that<span class="_ _11"> </span>provides<span class="_ _11"> </span>portable<span class="_ _11"> </span>signal<span class="_ _11"> </span>handling<span class="_ _11"> </span>on<span class="_ _10"> </span>Posix-compliant</span></div><div class="t m5 x17 h34 y69c7 ff6 fs16 fc1 sc0 ls0 ws0">systems.</div><div class="t m5 x17 h26 y69ea ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_ _13"> </span>deal<span class="_ _a"> </span>with<span class="_ _6"> </span>these<span class="_ _13"> </span>issues<span class="_ _3"></span>,<span class="_ _13"> </span>the<span class="_ _a"> </span>Posix<span class="_ _a"> </span>standard<span class="_ _6"> </span>deﬁnes<span class="_ _6"> </span>the<span class="_ _13"> </span><span class="ffd">sigaction<span class="_ _a"> </span></span>function,<span class="_ _13"> </span>which</div><div class="t m5 x17 h26 y69eb ff7 fs19 fc1 sc0 ls0 ws0">allows<span class="_"> </span>users<span class="_"> </span>to<span class="_ _13"> </span>clearly<span class="_"> </span>specify<span class="_"> </span>the<span class="_"> </span>signal-handling<span class="_ _13"> </span>semantics<span class="_"> </span>they<span class="_"> </span>want<span class="_"> </span>when<span class="_"> </span>they</div><div class="t m5 x17 h26 y69ec ff7 fs19 fc1 sc0 ls0 ws0">install<span class="_"> </span>a<span class="_"> </span>handler.</div><div class="t m5 x31 h2d y69ed ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;signal.h&gt;</div><div class="t m5 x31 h2d y69ee ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>sigaction(int<span class="_ _1f"> </span>signum,<span class="_ _1a"> </span>struct<span class="_ _1f"> </span>sigaction<span class="_ _e"> </span>*act,</div><div class="t m5 x178 h2d y69ef ffd fs1e fc2 sc0 ls0 ws0">struct<span class="_ _e"> </span>sigaction<span class="_ _1f"> </span>*oldact);</div><div class="t m5 x1db hf2 y69f0 ff7 fs1f fc2 sc0 ls0 ws0">Returns:<span class="_"> </span>0<span class="_"> </span>if<span class="_"> </span>OK,<span class="_"> </span><span class="ff12">−</span>1<span class="_ _13"> </span>on<span class="_"> </span>error</div><div class="t m5 x17 h26 y69f1 ff7 fs19 fc2 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _10"> </span><span class="ffd ls0">sigaction<span class="_ _10"> </span><span class="ff7">function<span class="_ _13"> </span>is<span class="_"> </span>unwieldy<span class="_ _13"> </span>because<span class="_"> </span>it<span class="_ _13"> </span>requires<span class="_"> </span>the<span class="_ _13"> </span>user<span class="_ _13"> </span>to<span class="_"> </span>set<span class="_ _13"> </span>the<span class="_"> </span>entries</span></span></div><div class="t m5 x17 h26 y69f2 ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_ _6"> </span>a<span class="_ _13"> </span>complicated<span class="_ _6"> </span>structure<span class="_ _1"></span>.<span class="_ _13"> </span>A<span class="_ _6"> </span>cleaner<span class="_ _6"> </span>approach,<span class="_ _13"> </span>originally<span class="_ _6"> </span>proposed<span class="_ _13"> </span>by<span class="_ _6"> </span>W<span class="_ _7"></span>.<span class="_ _13"> </span>Richard</div><div class="t m5 x17 h26 y69f3 ff7 fs19 fc2 sc0 ls0 ws0">Stevens<span class="_ _13"> </span>[110],<span class="_"> </span>is<span class="_ _13"> </span>to<span class="_ _13"> </span>deﬁne<span class="_ _13"> </span>a<span class="_ _13"> </span>wrapper<span class="_"> </span>function,<span class="_ _13"> </span>called<span class="_ _13"> </span><span class="ffd">Signal</span>,<span class="_"> </span>that<span class="_ _13"> </span>calls<span class="_ _13"> </span><span class="ffd">sigaction</span></div><div class="t m5 x17 h26 y69f4 ff7 fs19 fc2 sc0 ls0 ws0">for<span class="_ _11"> </span>us<span class="_ _0"></span>.<span class="_ _11"> </span>Figure<span class="_ _11"> </span>8.38<span class="_ _16"> </span>shows<span class="_ _11"> </span>the<span class="_ _16"> </span>deﬁnition<span class="_ _16"> </span>of<span class="_ _11"> </span><span class="ffd">Signal</span>,<span class="_ _16"> </span>which<span class="_ _16"> </span>is<span class="_ _11"> </span>invoked<span class="_ _16"> </span>in<span class="_ _11"> </span>the<span class="_ _16"> </span>same</div><div class="t m5 x17 h26 y69f5 ff7 fs19 fc2 sc0 ls0 ws0">way<span class="_"> </span>as<span class="_"> </span>the<span class="_"> </span><span class="ffd">signal<span class="_ _10"> </span></span>function.</div><div class="t m5 x26 h26 y69f6 ff7 fs19 fc2 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _22"> </span><span class="ffd ls0">Signal<span class="_ _e"> </span><span class="ff7">wrapper<span class="_ _1f"> </span>installs<span class="_ _1f"> </span>a<span class="_ _1f"> </span>signal<span class="_ _1f"> </span>handler<span class="_ _e"> </span>with<span class="_ _1f"> </span>the<span class="_ _1f"> </span>following<span class="_ _1f"> </span>signal-</span></span></div><div class="t m5 x17 h26 y69f7 ff7 fs19 fc2 sc0 ls0 ws0">handling<span class="_"> </span>semantics:</div><div class="t m5 x72 h3d y69f8 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y69f9 ff7 fs19 fc1 sc0 ls0 ws0">Only<span class="_ _13"> </span>signals<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _6"> </span>type<span class="_ _13"> </span>currently<span class="_ _6"> </span>being<span class="_ _13"> </span>processed<span class="_ _6"> </span>by<span class="_ _13"> </span>the<span class="_ _6"> </span>handler<span class="_ _13"> </span>are<span class="_ _6"> </span>blocked.</div><div class="t m5 x72 h3d y69fa ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y69fb ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_"> </span>with<span class="_"> </span>all<span class="_"> </span>signal<span class="_"> </span>implementations<span class="_ _1"></span>,<span class="_"> </span>signals<span class="_"> </span>are<span class="_"> </span>not<span class="_"> </span>queued.</div><div class="t m5 x72 h3d y69fc ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y69fd ff7 fs19 fc1 sc0 ls0 ws0">Interrupted<span class="_"> </span>system<span class="_"> </span>calls<span class="_"> </span>are<span class="_"> </span>automatically<span class="_"> </span>restarted<span class="_"> </span>whenever<span class="_"> </span>possible<span class="_ _1"></span>.</div><div class="t m5 x72 h3d y69fe ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y69ff ff7 fs19 fc1 sc0 ls0 ws0">Once<span class="_"> </span>the<span class="_ _13"> </span>signal<span class="_"> </span>handler<span class="_ _13"> </span>is<span class="_"> </span>installed,<span class="_"> </span>it<span class="_ _13"> </span>remains<span class="_"> </span>installed<span class="_ _13"> </span>until<span class="_"> </span><span class="ffd">Signal<span class="_ _10"> </span></span>is<span class="_ _13"> </span>called</div><div class="t m5 x26 h26 y6a00 ff7 fs19 fc1 sc0 ls0 ws0">with<span class="_"> </span>a<span class="_"> </span><span class="ffd">handler<span class="_ _10"> </span></span>argument<span class="_"> </span>of<span class="_"> </span>either<span class="_"> </span>SIG_IGN<span class="_"> </span>or<span class="_"> </span>SIG_DFL.</div><div class="t m5 x17 h26 y6a01 ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_"> </span>will<span class="_"> </span>use<span class="_"> </span>the<span class="_"> </span><span class="ffd">Signal<span class="_ _10"> </span></span>wrapper<span class="_"> </span>in<span class="_"> </span>all<span class="_"> </span>of<span class="_"> </span>our<span class="_"> </span>code.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
