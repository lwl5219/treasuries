<div id="pf24f" class="pf w2 h11" data-page-no="24f"><div class="pc pc24f w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg24f.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">590<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>5<span class="_ _3d"> </span>Optimizing<span class="_ _10"> </span>Program<span class="_ _10"> </span>Performance</span></div><div class="t m5 x29 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_ _11"> </span>F<span class="_ _1"></span>igure<span class="_ _16"> </span>5.11<span class="_"> </span>shows<span class="_ _1"></span>,<span class="_ _16"> </span>modern<span class="_"> </span>processors<span class="_ _11"> </span>have<span class="_ _16"> </span>dedicated<span class="_"> </span>functional<span class="_ _11"> </span>units<span class="_ _11"> </span>to</div><div class="t m5 x1d h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">perform<span class="_ _11"> </span>load<span class="_ _11"> </span>and<span class="_ _16"> </span>store<span class="_"> </span>operations<span class="_ _0"></span>,<span class="_ _11"> </span>and<span class="_ _11"> </span>these<span class="_ _16"> </span>units<span class="_ _11"> </span>have<span class="_ _11"> </span>internal<span class="_ _11"> </span>buffers<span class="_ _16"> </span>to<span class="_"> </span>hold</div><div class="t m5 x1d h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">sets<span class="_ _11"> </span>of<span class="_ _11"> </span>outstanding<span class="_ _16"> </span>requests<span class="_ _11"> </span>for<span class="_ _11"> </span>memory<span class="_ _16"> </span>operations<span class="_ _3"></span>.<span class="_ _16"> </span>F<span class="_ _1"></span>or<span class="_ _11"> </span>example,<span class="_"> </span>our<span class="_ _16"> </span>reference</div><div class="t m5 x1d h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">machine<span class="_ _13"> </span>has<span class="_ _6"> </span>two<span class="_ _13"> </span>load<span class="_ _6"> </span>units<span class="_ _0"></span>,<span class="_ _13"> </span>each<span class="_ _6"> </span>of<span class="_ _13"> </span>which<span class="_ _13"> </span>can<span class="_ _6"> </span>hold<span class="_ _13"> </span>up<span class="_ _13"> </span>to<span class="_ _6"> </span>72<span class="_ _13"> </span>pending<span class="_ _6"> </span>read<span class="_ _13"> </span>requests<span class="_ _1"></span>.</div><div class="t m5 x1d h26 y2f8 ff7 fs19 fc2 sc0 ls0 ws0">It<span class="_ _6"> </span>has<span class="_ _13"> </span>a<span class="_ _6"> </span>single<span class="_ _6"> </span>store<span class="_ _13"> </span>unit<span class="_ _6"> </span>with<span class="_ _13"> </span>a<span class="_ _6"> </span>store<span class="_ _6"> </span>buffer<span class="_ _13"> </span>containing<span class="_ _6"> </span>up<span class="_ _6"> </span>to<span class="_ _13"> </span>42<span class="_ _6"> </span>write<span class="_ _13"> </span>requests<span class="_ _3"></span>.<span class="_ _13"> </span>Each</div><div class="t m5 x1d h26 y2f9 ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_"> </span>these<span class="_"> </span>units<span class="_"> </span>can<span class="_"> </span>initiate<span class="_"> </span>1<span class="_"> </span>operation<span class="_"> </span>every<span class="_"> </span>clock<span class="_"> </span>cycle<span class="_ _1"></span>.</div><div class="t m5 x1d h41 y4f84 ffe fs29 fc2 sc0 ls0 ws0">5.12.1<span class="_ _48"> </span><span class="fs19">Load<span class="_"> </span>Performance</span></div><div class="t m5 x1d h26 y4f85 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _16"> </span>performance<span class="_ _11"> </span>of<span class="_ _16"> </span>a<span class="_ _16"> </span>program<span class="_ _11"> </span>containing<span class="_ _16"> </span>load<span class="_ _11"> </span>operations<span class="_ _16"> </span>depends<span class="_ _11"> </span>on<span class="_ _16"> </span>both<span class="_ _11"> </span>the</div><div class="t m5 x1d h26 y4f86 ff7 fs19 fc2 sc0 ls0 ws0">pipelining<span class="_ _14"> </span>capability<span class="_ _15"> </span>and<span class="_ _14"> </span>the<span class="_ _15"> </span>latency<span class="_ _14"> </span>of<span class="_ _14"> </span>the<span class="_ _15"> </span>load<span class="_ _14"> </span>unit.<span class="_ _15"> </span>In<span class="_ _14"> </span>our<span class="_ _15"> </span>experiments<span class="_ _15"> </span>with</div><div class="t m5 x1d h26 y4f87 ff7 fs19 fc2 sc0 ls0 ws0">combining<span class="_ _16"> </span>operations<span class="_ _16"> </span>using<span class="_ _11"> </span>our<span class="_ _16"> </span>reference<span class="_ _16"> </span>machine<span class="_ _0"></span>,<span class="_ _16"> </span>we<span class="_ _16"> </span>saw<span class="_ _16"> </span>that<span class="_ _16"> </span>the<span class="_ _11"> </span>CPE<span class="_ _16"> </span>never</div><div class="t m5 x1d h26 y4f88 ff7 fs19 fc2 sc0 ls0 ws0">got<span class="_ _13"> </span>below<span class="_"> </span>0.50<span class="_ _13"> </span>for<span class="_ _13"> </span>any<span class="_"> </span>combination<span class="_ _13"> </span>of<span class="_"> </span>data<span class="_ _13"> </span>type<span class="_ _13"> </span>and<span class="_"> </span>combining<span class="_ _13"> </span>operation,<span class="_ _13"> </span>except</div><div class="t m5 x1d h26 y4f89 ff7 fs19 fc2 sc0 ls0 ws0">when<span class="_ _16"> </span>using<span class="_ _14"> </span>SIMD<span class="_ _16"> </span>operations<span class="_ _1"></span>.<span class="_ _16"> </span>One<span class="_ _14"> </span>factor<span class="_ _16"> </span>limiting<span class="_ _14"> </span>the<span class="_ _16"> </span>CPE<span class="_ _14"> </span>for<span class="_ _16"> </span>our<span class="_ _14"> </span>examples<span class="_ _16"> </span>is</div><div class="t m5 x1d h26 y4f8a ff7 fs19 fc2 sc0 ls0 ws0">that<span class="_ _13"> </span>they<span class="_"> </span>all<span class="_ _13"> </span>require<span class="_"> </span>reading<span class="_ _13"> </span>one<span class="_"> </span>value<span class="_ _13"> </span>from<span class="_ _13"> </span>memory<span class="_"> </span>for<span class="_ _13"> </span>each<span class="_"> </span>element<span class="_ _13"> </span>computed.</div><div class="t m5 x1d h26 y4f8b ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _1"></span>ith<span class="_ _14"> </span>two<span class="_ _14"> </span>load<span class="_ _14"> </span>units<span class="_ _1"></span>,<span class="_ _15"> </span>each<span class="_ _14"> </span>able<span class="_ _14"> </span>to<span class="_ _14"> </span>initiate<span class="_ _14"> </span>at<span class="_ _14"> </span>most<span class="_ _14"> </span>1<span class="_ _14"> </span>load<span class="_ _14"> </span>operation<span class="_ _14"> </span>every<span class="_ _14"> </span>clock</div><div class="t m5 x1d h26 y4f8c ff7 fs19 fc2 sc0 ls0 ws0">cycle<span class="_ _1"></span>,<span class="_ _16"> </span>the<span class="_ _16"> </span>CPE<span class="_ _16"> </span>cannot<span class="_ _16"> </span>be<span class="_ _16"> </span>less<span class="_ _16"> </span>than<span class="_ _16"> </span>0.50.<span class="_ _16"> </span>F<span class="_ _3"></span>or<span class="_ _16"> </span>applications<span class="_ _16"> </span>where<span class="_ _16"> </span>we<span class="_ _16"> </span>must<span class="_ _16"> </span>load<span class="_ _16"> </span><span class="ff11">k</span></div><div class="t m5 x1d h26 y4f8d ff7 fs19 fc2 sc0 ls0 ws0">values<span class="_"> </span>for<span class="_ _11"> </span>every<span class="_"> </span>element<span class="_ _11"> </span>computed,<span class="_ _11"> </span>we<span class="_"> </span>can<span class="_ _11"> </span>never<span class="_"> </span>achieve<span class="_ _11"> </span>a<span class="_"> </span>CPE<span class="_ _11"> </span>lower<span class="_ _11"> </span>than<span class="_"> </span><span class="ff11 ls10">k/</span>2</div><div class="t m5 x1d h26 y4f8e ff7 fs19 fc2 sc0 ls0 ws0">(see<span class="_ _1"></span>,<span class="_"> </span>for<span class="_"> </span>example,<span class="_"> </span>Problem<span class="_"> </span>5.15).</div><div class="t m5 x29 h26 y4f8f ff7 fs19 fc2 sc0 ls0 ws0">In<span class="_"> </span>our<span class="_"> </span>examples<span class="_"> </span>so<span class="_ _11"> </span>far,<span class="_"> </span>we<span class="_"> </span>have<span class="_"> </span>not<span class="_"> </span>seen<span class="_"> </span>any<span class="_ _11"> </span>performance<span class="_"> </span>effects<span class="_"> </span>due<span class="_"> </span>to<span class="_ _11"> </span>the</div><div class="t m5 x1d h26 y4f90 ff7 fs19 fc2 sc0 ls0 ws0">latency<span class="_"> </span>of<span class="_"> </span>load<span class="_"> </span>operations<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _0"></span>he<span class="_"> </span>addresses<span class="_"> </span>for<span class="_"> </span>our<span class="_"> </span>load<span class="_ _11"> </span>operations<span class="_"> </span>depended<span class="_"> </span>only</div><div class="t m5 x1d h26 y4f91 ff7 fs19 fc2 sc0 ls0 ws0">on<span class="_ _13"> </span>the<span class="_ _6"> </span>loop<span class="_ _13"> </span>index<span class="_ _6"> </span><span class="ff11">i<span class="_ _5"></span></span>,<span class="_ _13"> </span>and<span class="_ _13"> </span>so<span class="_ _6"> </span>the<span class="_ _13"> </span>load<span class="_ _13"> </span>operations<span class="_ _6"> </span>did<span class="_ _13"> </span>not<span class="_ _6"> </span>form<span class="_ _13"> </span>part<span class="_ _6"> </span>of<span class="_ _13"> </span>a<span class="_ _13"> </span>performance-</div><div class="t m5 x1d h26 y4f92 ff7 fs19 fc2 sc0 ls0 ws0">limiting<span class="_"> </span>critical<span class="_"> </span>path.</div><div class="t m5 x29 h26 y4f93 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_ _16"> </span>determine<span class="_ _11"> </span>the<span class="_ _11"> </span>latency<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>load<span class="_ _16"> </span>operation<span class="_ _11"> </span>on<span class="_ _11"> </span>a<span class="_ _11"> </span>machine,<span class="_ _11"> </span>we<span class="_ _11"> </span>can<span class="_ _11"> </span>set<span class="_ _16"> </span>up</div><div class="t m5 x1d h26 y4f94 ff7 fs19 fc2 sc0 ls0 ws0">a<span class="_ _15"> </span>computation<span class="_ _14"> </span>with<span class="_ _15"> </span>a<span class="_ _15"> </span>sequence<span class="_ _15"> </span>of<span class="_ _15"> </span>load<span class="_ _15"> </span>operations<span class="_ _1"></span>,<span class="_ _21"> </span>where<span class="_ _15"> </span>the<span class="_ _15"> </span>outcome<span class="_ _15"> </span>of<span class="_ _15"> </span>one</div><div class="t m5 x1d h26 y4f95 ff7 fs19 fc2 sc0 ls0 ws0">determines<span class="_"> </span>the<span class="_"> </span>address<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>next.<span class="_"> </span>As<span class="_"> </span>an<span class="_"> </span>example,<span class="_"> </span>consider<span class="_"> </span>the<span class="_"> </span>function<span class="_"> </span><span class="ffd">list_</span></div><div class="t m5 x1d h26 y4f96 ffd fs19 fc2 sc0 ls0 ws0">len<span class="_ _11"> </span><span class="ff7">in<span class="_"> </span>Figure<span class="_"> </span>5.31,<span class="_ _11"> </span>which<span class="_ _11"> </span>computes<span class="_ _11"> </span>the<span class="_ _11"> </span>length<span class="_ _11"> </span>of<span class="_ _11"> </span>a<span class="_"> </span>linked<span class="_ _11"> </span>list.<span class="_ _11"> </span>In<span class="_ _11"> </span>the<span class="_ _11"> </span>loop<span class="_ _11"> </span>of<span class="_ _11"> </span>this</span></div><div class="t m5 x1d h26 y4f97 ff7 fs19 fc2 sc0 ls0 ws0">function,<span class="_ _16"> </span>each<span class="_ _16"> </span>successive<span class="_ _11"> </span>value<span class="_ _16"> </span>of<span class="_ _16"> </span>variable<span class="_ _11"> </span><span class="ffd">ls<span class="_ _16"> </span></span>depends<span class="_ _11"> </span>on<span class="_ _16"> </span>the<span class="_ _16"> </span>value<span class="_ _11"> </span>read<span class="_ _16"> </span>by<span class="_ _16"> </span>the</div><div class="t m5 x1d h26 y4f98 ff7 fs19 fc2 sc0 ls0 ws0">pointer<span class="_ _13"> </span>reference<span class="_ _13"> </span><span class="ffd">ls-&gt;next</span>.<span class="_ _13"> </span>Our<span class="_ _13"> </span>measurements<span class="_ _13"> </span>show<span class="_ _13"> </span>that<span class="_ _13"> </span>function<span class="_ _13"> </span><span class="ffd">list_len<span class="_ _13"> </span></span>has</div><div class="t m5 x1f h2e y4f99 ff6 fs20 fc6 sc0 ls0 ws0">1</div><div class="t m5 x4f h2d y4f9a ffd fs1e fc2 sc0 ls0 ws0">typedef<span class="_ _e"> </span>struct<span class="_ _1f"> </span>ELE<span class="_ _1f"> </span>{</div><div class="t m5 x1f h2e y4f9b ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x33 h2d y4f9c ffd fs1e fc2 sc0 ls0 ws0">struct<span class="_ _e"> </span>ELE<span class="_ _1f"> </span>*next;</div><div class="t m5 x1f h2d y4f9d ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>data;</span></div><div class="t m5 x1f h2e y4f9e ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 x4f h2d y4f9f ffd fs1e fc2 sc0 ls0 ws0">}<span class="_ _e"> </span>list_ele,<span class="_ _1f"> </span>*list_ptr;</div><div class="t m5 x1f h2e y4fa0 ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x1f h2e y4fa1 ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 x4f h2d y4fa2 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>list_len(list_ptr<span class="_ _1f"> </span>ls)<span class="_ _1f"> </span>{</div><div class="t m5 x1f h2d y4fa3 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _20"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>len<span class="_ _1f"> </span>=<span class="_ _1f"> </span>0;</span></div><div class="t m5 x1f h2d y4fa4 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _20"> </span><span class="ffd fs1e fc2">while<span class="_ _e"> </span>(ls)<span class="_ _1f"> </span>{</span></div><div class="t m5 x1f h2d y4fa5 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _c0"> </span><span class="ffd fs1e fc2">len++;</span></div><div class="t m5 x1b0 h2d y4fa6 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _c0"> </span><span class="ffd fs1e fc2">ls<span class="_ _1f"> </span>=<span class="_ _e"> </span>ls-&gt;next;</span></div><div class="t m5 x1b0 h2d y4fa7 ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1b0 h2d y4fa8 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _20"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>len;</span></div><div class="t m5 x1b0 h2e y4fa9 ff6 fs20 fc6 sc0 ls0 ws0">13</div><div class="t m5 x4f h2d y4faa ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x1d h34 y126b ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>5.31<span class="_ _c"> </span><span class="fc1">Linked<span class="_"> </span>list<span class="_ _11"> </span>function.<span class="_"> </span><span class="ff6">Its<span class="_ _11"> </span>performance<span class="_ _11"> </span>is<span class="_ _11"> </span>limited<span class="_ _11"> </span>by<span class="_ _10"> </span>the<span class="_ _11"> </span>latency<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _10"> </span>load</span></span></div><div class="t m5 x1d h34 y126c ff6 fs16 fc1 sc0 ls0 ws0">operation.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
