<div id="pf400" class="pf w2 h11" data-page-no="400"><div class="pc pc400 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg400.png"/><div class="t m5 x88 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>12.3<span class="_ _60"> </span>Concurrent<span class="_ _10"> </span>Programming<span class="_ _10"> </span>with<span class="_ _10"> </span>Threads<span class="_ _3e"> </span><span class="ffe fs1e">1023</span></div><div class="t m5 x17 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">with<span class="_ _11"> </span>a<span class="_ _11"> </span>process<span class="_ _16"> </span>form<span class="_ _11"> </span>a<span class="_ _11"> </span><span class="ffa">pool<span class="_ _16"> </span></span>of<span class="_ _16"> </span>peers<span class="_ _3"></span>,<span class="_ _16"> </span>independent<span class="_ _11"> </span>of<span class="_ _11"> </span>which<span class="_ _16"> </span>threads<span class="_ _11"> </span>were<span class="_ _11"> </span>created</div><div class="t m5 x17 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">by<span class="_"> </span>which<span class="_ _13"> </span>other<span class="_"> </span>threads<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>main<span class="_ _13"> </span>thread<span class="_"> </span>is<span class="_"> </span>distinguished<span class="_ _13"> </span>from<span class="_"> </span>other<span class="_"> </span>threads<span class="_ _13"> </span>only</div><div class="t m5 x17 h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">in<span class="_ _13"> </span>the<span class="_"> </span>sense<span class="_ _13"> </span>that<span class="_ _13"> </span>it<span class="_ _13"> </span>is<span class="_"> </span>always<span class="_ _13"> </span>the<span class="_ _13"> </span>ﬁrst<span class="_"> </span>thread<span class="_ _13"> </span>to<span class="_ _13"> </span>run<span class="_ _13"> </span>in<span class="_"> </span>the<span class="_ _13"> </span>process<span class="_ _1"></span>.<span class="_ _13"> </span>T<span class="_ _0"></span>he<span class="_ _13"> </span>main<span class="_"> </span>impact</div><div class="t m5 x17 h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_ _16"> </span>this<span class="_ _11"> </span>notion<span class="_ _16"> </span>of<span class="_ _16"> </span>a<span class="_ _16"> </span>pool<span class="_ _11"> </span>of<span class="_ _16"> </span>peers<span class="_ _16"> </span>is<span class="_ _16"> </span>that<span class="_ _11"> </span>a<span class="_ _16"> </span>thread<span class="_ _16"> </span>can<span class="_ _11"> </span>kill<span class="_ _16"> </span>any<span class="_ _16"> </span>of<span class="_ _16"> </span>its<span class="_ _11"> </span>peers<span class="_ _16"> </span>or<span class="_ _16"> </span>wait</div><div class="t m5 x17 h26 y2f8 ff7 fs19 fc2 sc0 ls0 ws0">for<span class="_"> </span>any<span class="_ _11"> </span>of<span class="_ _11"> </span>its<span class="_"> </span>peers<span class="_ _11"> </span>to<span class="_ _11"> </span>terminate<span class="_ _1"></span>.<span class="_ _11"> </span>Further,<span class="_"> </span>each<span class="_ _11"> </span>peer<span class="_ _11"> </span>can<span class="_"> </span>read<span class="_ _11"> </span>and<span class="_ _11"> </span>write<span class="_"> </span>the<span class="_ _11"> </span>same</div><div class="t m5 x17 h26 y2f9 ff7 fs19 fc2 sc0 ls0 ws0">shared<span class="_"> </span>data.</div><div class="t m5 x17 h41 y8019 ffe fs29 fc2 sc0 ls0 ws0">12.3.2<span class="_ _48"> </span><span class="fs19">Posix<span class="_"> </span>Threads</span></div><div class="t m5 x17 h26 y801a ff7 fs19 fc2 sc0 ls0 ws0">P<span class="_ _1"></span>osix<span class="_"> </span>threads<span class="_ _11"> </span>(Pthreads)<span class="_"> </span>is<span class="_"> </span>a<span class="_"> </span>standard<span class="_ _11"> </span>interface<span class="_"> </span>for<span class="_"> </span>manipulating<span class="_ _11"> </span>threads<span class="_"> </span>from<span class="_"> </span>C</div><div class="t m5 x17 h26 y801b ff7 fs19 fc2 sc0 ls0 ws0">programs<span class="_ _1"></span>.<span class="_"> </span>It<span class="_ _11"> </span>was<span class="_ _11"> </span>adopted<span class="_ _11"> </span>in<span class="_"> </span>1995<span class="_ _11"> </span>and<span class="_ _11"> </span>is<span class="_ _11"> </span>available<span class="_"> </span>on<span class="_ _11"> </span>all<span class="_ _11"> </span>Linux<span class="_ _11"> </span>systems<span class="_ _1"></span>.<span class="_ _11"> </span>Pthreads</div><div class="t m5 x17 h26 y801c ff7 fs19 fc2 sc0 ls0 ws0">deﬁnes<span class="_ _16"> </span>about<span class="_ _11"> </span>60<span class="_ _16"> </span>functions<span class="_ _16"> </span>that<span class="_ _16"> </span>allow<span class="_ _11"> </span>programs<span class="_ _16"> </span>to<span class="_ _16"> </span>create<span class="_ _1"></span>,<span class="_ _16"> </span>kill,<span class="_ _14"> </span>and<span class="_ _11"> </span>reap<span class="_ _16"> </span>threads<span class="_ _1"></span>,</div><div class="t m5 x17 h26 y801d ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_ _16"> </span>share<span class="_ _16"> </span>data<span class="_ _16"> </span>safely<span class="_ _11"> </span>with<span class="_ _16"> </span>peer<span class="_ _16"> </span>threads<span class="_ _1"></span>,<span class="_ _14"> </span>and<span class="_ _16"> </span>to<span class="_ _16"> </span>notify<span class="_ _16"> </span>peers<span class="_ _11"> </span>about<span class="_ _16"> </span>changes<span class="_ _16"> </span>in<span class="_ _16"> </span>the</div><div class="t m5 x17 h26 y801e ff7 fs19 fc2 sc0 ls0 ws0">system<span class="_"> </span>state<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y801f ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _13"> </span>12.13<span class="_ _6"> </span>shows<span class="_ _6"> </span>a<span class="_ _13"> </span>simple<span class="_ _6"> </span>Pthreads<span class="_ _13"> </span>program.<span class="_ _a"> </span>The<span class="_ _6"> </span>main<span class="_ _6"> </span>thread<span class="_ _13"> </span>creates<span class="_ _6"> </span>a<span class="_ _6"> </span>peer</div><div class="t m5 x17 h26 y8020 ff7 fs19 fc2 sc0 ls0 ws0">thread<span class="_ _13"> </span>and<span class="_ _13"> </span>then<span class="_ _13"> </span>waits<span class="_ _13"> </span>for<span class="_ _13"> </span>it<span class="_ _13"> </span>to<span class="_ _13"> </span>terminate<span class="_ _1"></span>.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span>peer<span class="_ _13"> </span>thread<span class="_ _13"> </span>prints<span class="_ _13"> </span><span class="ffd">Hello,<span class="_ _11"> </span>world!\n</span></div><div class="t m5 x17 h26 y8021 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_ _6"> </span>terminates<span class="_ _1"></span>.<span class="_ _13"> </span>W<span class="_ _1"></span>hen<span class="_ _13"> </span>the<span class="_ _6"> </span>main<span class="_ _6"> </span>thread<span class="_ _13"> </span>detects<span class="_ _a"> </span>that<span class="_ _13"> </span>the<span class="_ _6"> </span>peer<span class="_ _6"> </span>thread<span class="_ _13"> </span>has<span class="_ _a"> </span>terminated,</div><div class="t m5 x17 h26 y8022 ff7 fs19 fc2 sc0 ls0 ws0">it<span class="_ _16"> </span>terminates<span class="_ _14"> </span>the<span class="_ _16"> </span>process<span class="_ _14"> </span>by<span class="_ _16"> </span>calling<span class="_ _14"> </span><span class="ffd">exit</span>.<span class="_ _14"> </span>T<span class="_ _1"></span>his<span class="_ _14"> </span>is<span class="_ _16"> </span>the<span class="_ _14"> </span>ﬁrst<span class="_ _14"> </span>threaded<span class="_ _16"> </span>program<span class="_ _14"> </span>we</div><div class="t m5 x17 h26 y8023 ff7 fs19 fc2 sc0 ls0 ws0">have<span class="_ _11"> </span>seen,<span class="_ _16"> </span>so<span class="_ _16"> </span>let<span class="_ _16"> </span>us<span class="_ _11"> </span>dissect<span class="_ _16"> </span>it<span class="_ _11"> </span>carefully<span class="_ _3"></span>.<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span>code<span class="_ _16"> </span>and<span class="_ _11"> </span>local<span class="_ _16"> </span>data<span class="_ _11"> </span>for<span class="_ _16"> </span>a<span class="_ _16"> </span>thread<span class="_ _11"> </span>are</div><div class="t m5 x17 h26 y8024 ff7 fs19 fc2 sc0 ls0 ws0">encapsulated<span class="_ _13"> </span>in<span class="_"> </span>a<span class="_ _13"> </span><span class="ffa">thread<span class="_ _13"> </span>routine</span>.<span class="_"> </span>As<span class="_ _13"> </span>shown<span class="_ _13"> </span>by<span class="_ _13"> </span>the<span class="_"> </span>prototype<span class="_ _13"> </span>in<span class="_ _13"> </span>line<span class="_ _13"> </span>2,<span class="_"> </span>each<span class="_ _13"> </span>thread</div><div class="t m5 x17 h26 y8025 ff7 fs19 fc2 sc0 ls0 ws0">routine<span class="_ _16"> </span>takes<span class="_ _14"> </span>as<span class="_ _14"> </span>input<span class="_ _16"> </span>a<span class="_ _14"> </span>single<span class="_ _16"> </span>generic<span class="_ _14"> </span>pointer<span class="_ _14"> </span>and<span class="_ _16"> </span>returns<span class="_ _14"> </span>a<span class="_ _14"> </span>generic<span class="_ _16"> </span>pointer.<span class="_ _16"> </span>If</div><div class="t m5 x17 h26 y8026 ff7 fs19 fc2 sc0 ls0 ws0">you<span class="_"> </span>want<span class="_ _13"> </span>to<span class="_"> </span>pass<span class="_"> </span>multiple<span class="_"> </span>arguments<span class="_ _13"> </span>to<span class="_"> </span>a<span class="_"> </span>thread<span class="_ _13"> </span>routine,<span class="_ _13"> </span>then<span class="_"> </span>you<span class="_"> </span>should<span class="_ _13"> </span>put<span class="_"> </span>the</div><div class="t m5 x17 h26 y8027 ff7 fs19 fc2 sc0 ls0 ws0">arguments<span class="_ _16"> </span>into<span class="_ _14"> </span>a<span class="_ _14"> </span>structure<span class="_ _16"> </span>and<span class="_ _14"> </span>pass<span class="_ _16"> </span>a<span class="_ _14"> </span>pointer<span class="_ _14"> </span>to<span class="_ _16"> </span>the<span class="_ _14"> </span>structure<span class="_ _0"></span>.<span class="_ _16"> </span>Similarly<span class="_ _3"></span>,<span class="_ _15"> </span>if<span class="_ _16"> </span>you</div><div class="t m5 x84 h2c y8028 ffa fs16 fc2 sc0 ls0 ws0">code/conc/hello<span class="_ _1"></span>.c</div><div class="t m5 x2c h2d y6893 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">#include<span class="_ _1f"> </span>&quot;csapp.h&quot;</span></div><div class="t m5 x2c h2d y6894 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">void<span class="_ _1f"> </span>*thread(void<span class="_ _e"> </span>*vargp);</span></div><div class="t m5 x2c h2e y6895 ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x2c h2e y8029 ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 x2d h2d y6896 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>main()</div><div class="t m5 x2c h2d y6845 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x2c h2d y6847 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _20"> </span><span class="ffd fs1e fc2">pthread_t<span class="_ _e"> </span>tid;</span></div><div class="t m5 x2c h2d y689a ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _20"> </span><span class="ffd fs1e fc2">Pthread_create(&amp;tid,<span class="_ _e"> </span>NULL,<span class="_ _1f"> </span>thread,<span class="_ _1f"> </span>NULL);</span></div><div class="t m5 x2c h2d y6849 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _20"> </span><span class="ffd fs1e fc2">Pthread_join(tid,<span class="_ _e"> </span>NULL);</span></div><div class="t m5 x2c h2d y684a ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _20"> </span><span class="ffd fs1e fc2">exit(0);</span></div><div class="t m5 x17 h2d y689d ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x17 h2e y689f ff6 fs20 fc6 sc0 ls0 ws0">11</div><div class="t m5 x17 h2e y802a ff6 fs20 fc6 sc0 ls0 ws0">12</div><div class="t m5 x2d h2d y684d ffd fs1e fc2 sc0 ls0 ws0">void<span class="_ _e"> </span>*thread(void<span class="_ _1f"> </span>*vargp)<span class="_ _1f"> </span>/*<span class="_ _e"> </span>Thread<span class="_ _1f"> </span>routine<span class="_ _e"> </span>*/</div><div class="t m5 x17 h2e ya25 ff6 fs20 fc6 sc0 ls0 ws0">13</div><div class="t m5 x2d h2d ya26 ffd fs1e fc2 sc0 ls0 ws0">{</div><div class="t m5 x17 h2d y684f ff6 fs20 fc6 sc0 ls0 ws0">14<span class="_ _20"> </span><span class="ffd fs1e fc2">printf(&quot;Hello,<span class="_ _e"> </span>world!\n&quot;);</span></div><div class="t m5 x17 h2d y1862 ff6 fs20 fc6 sc0 ls0 ws0">15<span class="_ _20"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>NULL;</span></div><div class="t m5 x17 h2d y18db ff6 fs20 fc6 sc0 ls0 ws0">16<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x84 h2c y6850 ffa fs16 fc2 sc0 ls0 ws0">code/conc/hello<span class="_ _1"></span>.c</div><div class="t m5 x17 h2f y6851 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>12.13</div><div class="t m5 x155 h3a y126e ffd fs19 fc1 sc0 ls0 ws0">hello.c<span class="ffe fs16">:<span class="_"> </span>The<span class="_"> </span>Pthreads<span class="_"> </span>“Hello,<span class="_"> </span>world!”<span class="_"> </span>program.</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
