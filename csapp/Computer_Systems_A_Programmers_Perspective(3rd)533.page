<div id="pf215" class="pf w2 h11" data-page-no="215"><div class="pc pc215 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg215.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">532<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>5<span class="_ _3d"> </span>Optimizing<span class="_ _10"> </span>Program<span class="_ _10"> </span>Performance</span></div><div class="t m5 x1d h38 y93a ff7 fs1b fc6 sc0 ls0 ws0">T</div><div class="t m5 xa6 h26 ye7 ff7 fs19 fc1 sc0 ls0 ws0">he<span class="_"> </span>primary<span class="_"> </span>objective<span class="_ _11"> </span>in<span class="_"> </span>writing<span class="_ _11"> </span>a<span class="_"> </span>program<span class="_"> </span>must<span class="_ _11"> </span>be<span class="_"> </span>to<span class="_ _11"> </span>make<span class="_"> </span>it<span class="_ _11"> </span>work<span class="_"> </span>correctly</div><div class="t m5 xa6 h26 y2a7 ff7 fs19 fc1 sc0 ls0 ws0">under<span class="_ _14"> </span>all<span class="_ _15"> </span>possible<span class="_ _15"> </span>conditions<span class="_ _1"></span>.<span class="_ _15"> </span>A<span class="_ _14"> </span>program<span class="_ _15"> </span>that<span class="_ _15"> </span>runs<span class="_ _14"> </span>fast<span class="_ _15"> </span>but<span class="_ _15"> </span>gives<span class="_ _15"> </span>incorrect</div><div class="t m5 x1d h26 y2a8 ff7 fs19 fc1 sc0 ls0 ws0">results<span class="_"> </span>serves<span class="_ _13"> </span>no<span class="_"> </span>useful<span class="_ _13"> </span>purpose<span class="_ _1"></span>.<span class="_"> </span>Programmers<span class="_ _13"> </span>must<span class="_"> </span>write<span class="_ _13"> </span>clear<span class="_"> </span>and<span class="_ _13"> </span>concise<span class="_"> </span>code<span class="_ _1"></span>,</div><div class="t m5 x1d h26 y2f7 ff7 fs19 fc1 sc0 ls0 ws0">not<span class="_ _16"> </span>only<span class="_ _16"> </span>so<span class="_ _16"> </span>that<span class="_ _16"> </span>they<span class="_ _11"> </span>can<span class="_ _16"> </span>make<span class="_ _16"> </span>sense<span class="_ _16"> </span>of<span class="_ _16"> </span>it,<span class="_ _16"> </span>but<span class="_ _16"> </span>also<span class="_ _16"> </span>so<span class="_ _16"> </span>that<span class="_ _16"> </span>others<span class="_ _16"> </span>can<span class="_ _16"> </span>read<span class="_ _16"> </span>and</div><div class="t m5 x1d h26 y2f8 ff7 fs19 fc1 sc0 ls0 ws0">understand<span class="_ _16"> </span>the<span class="_ _14"> </span>code<span class="_ _14"> </span>during<span class="_ _14"> </span>code<span class="_ _14"> </span>reviews<span class="_ _14"> </span>and<span class="_ _14"> </span>when<span class="_ _16"> </span>modiﬁcations<span class="_ _14"> </span>are<span class="_ _14"> </span>required</div><div class="t m5 x1d h26 y2f9 ff7 fs19 fc1 sc0 ls0 ws0">later.</div><div class="t m5 x29 h26 y2fa ff7 fs19 fc1 sc0 ls0 ws0">On<span class="_ _16"> </span>the<span class="_ _14"> </span>other<span class="_ _16"> </span>hand,<span class="_ _15"> </span>there<span class="_ _16"> </span>are<span class="_ _14"> </span>many<span class="_ _14"> </span>occasions<span class="_ _16"> </span>when<span class="_ _14"> </span>making<span class="_ _16"> </span>a<span class="_ _14"> </span>program<span class="_ _14"> </span>run</div><div class="t m5 x1d h26 y2fb ff7 fs19 fc1 sc0 ls0 ws0">fast<span class="_ _13"> </span>is<span class="_"> </span>also<span class="_ _13"> </span>an<span class="_ _13"> </span>important<span class="_ _13"> </span>consideration.<span class="_"> </span>If<span class="_ _13"> </span>a<span class="_ _13"> </span>program<span class="_ _13"> </span>must<span class="_"> </span>process<span class="_ _13"> </span>video<span class="_ _13"> </span>frames<span class="_ _13"> </span>or</div><div class="t m5 x1d h26 y2fc ff7 fs19 fc1 sc0 ls0 ws0">network<span class="_ _16"> </span>packets<span class="_ _11"> </span>in<span class="_ _16"> </span>real<span class="_ _16"> </span>time<span class="_ _1"></span>,<span class="_ _14"> </span>then<span class="_ _16"> </span>a<span class="_ _11"> </span>slow-running<span class="_ _16"> </span>program<span class="_ _16"> </span>will<span class="_ _16"> </span>not<span class="_ _11"> </span>provide<span class="_ _16"> </span>the</div><div class="t m5 x1d h26 y2fd ff7 fs19 fc1 sc0 ls0 ws0">needed<span class="_"> </span>functionality<span class="_ _7"></span>.<span class="_"> </span>W<span class="_ _1"></span>hen<span class="_"> </span>a<span class="_ _13"> </span>computational<span class="_"> </span>task<span class="_ _13"> </span>is<span class="_"> </span>so<span class="_"> </span>demanding<span class="_ _13"> </span>that<span class="_"> </span>it<span class="_ _13"> </span>requires</div><div class="t m5 x1d h26 y2fe ff7 fs19 fc1 sc0 ls0 ws0">days<span class="_"> </span>or<span class="_"> </span>weeks<span class="_"> </span>to<span class="_"> </span>execute,<span class="_"> </span>then<span class="_"> </span>making<span class="_"> </span>it<span class="_"> </span>run<span class="_"> </span>just<span class="_"> </span>20%<span class="_ _11"> </span>faster<span class="_"> </span>can<span class="_"> </span>have<span class="_"> </span>signiﬁcant</div><div class="t m5 x1d h26 y2ff ff7 fs19 fc1 sc0 ls0 ws0">impact.<span class="_ _15"> </span>In<span class="_ _21"> </span>this<span class="_ _15"> </span>chapter,<span class="_ _21"> </span>we<span class="_ _21"> </span>will<span class="_ _21"> </span>explore<span class="_ _15"> </span>how<span class="_ _21"> </span>to<span class="_ _15"> </span>make<span class="_ _21"> </span>programs<span class="_ _15"> </span>run<span class="_ _21"> </span>faster<span class="_ _21"> </span>via</div><div class="t m5 x1d h26 y300 ff7 fs19 fc1 sc0 ls0 ws0">several<span class="_"> </span>different<span class="_"> </span>types<span class="_"> </span>of<span class="_"> </span>program<span class="_"> </span>optimization.</div><div class="t m5 x29 h26 y21a ff7 fs19 fc1 sc0 ls0 ws0">Writing<span class="_ _21"> </span>an<span class="_ _21"> </span>efﬁcient<span class="_ _f"> </span>program<span class="_ _21"> </span>requires<span class="_ _f"> </span>several<span class="_ _21"> </span>types<span class="_ _21"> </span>of<span class="_ _f"> </span>activities<span class="_ _1"></span>.<span class="_ _21"> </span>First,<span class="_ _f"> </span>we</div><div class="t m5 x1d h26 y450 ff7 fs19 fc1 sc0 ls0 ws0">must<span class="_ _f"> </span>select<span class="_ _f"> </span>an<span class="_ _f"> </span>appropriate<span class="_ _f"> </span>set<span class="_ _f"> </span>of<span class="_ _f"> </span>algorithms<span class="_ _f"> </span>and<span class="_ _f"> </span>data<span class="_ _f"> </span>structures<span class="_ _1"></span>.<span class="_ _f"> </span>Second,<span class="_ _e"> </span>we</div><div class="t m5 x1d h26 y451 ff7 fs19 fc1 sc0 ls0 ws0">must<span class="_ _14"> </span>write<span class="_ _15"> </span>source<span class="_ _15"> </span>code<span class="_ _15"> </span>that<span class="_ _14"> </span>the<span class="_ _15"> </span>compiler<span class="_ _15"> </span>can<span class="_ _15"> </span>effectively<span class="_ _14"> </span>optimize<span class="_ _15"> </span>to<span class="_ _15"> </span>turn<span class="_ _15"> </span>into</div><div class="t m5 x1d h26 y452 ff7 fs19 fc1 sc0 ls0 ws0">efﬁcient<span class="_ _11"> </span>executable<span class="_ _16"> </span>code<span class="_ _1"></span>.<span class="_ _16"> </span>F<span class="_ _3"></span>or<span class="_ _16"> </span>this<span class="_ _11"> </span>second<span class="_ _11"> </span>part,<span class="_ _16"> </span>it<span class="_ _16"> </span>is<span class="_ _11"> </span>important<span class="_ _11"> </span>to<span class="_ _16"> </span>understand<span class="_ _11"> </span>the</div><div class="t m5 x1d h26 y453 ff7 fs19 fc1 sc0 ls0 ws0">capabilities<span class="_"> </span>and<span class="_ _11"> </span>limitations<span class="_"> </span>of<span class="_ _11"> </span>optimizing<span class="_"> </span>compilers<span class="_ _1"></span>.<span class="_ _11"> </span>Seemingly<span class="_"> </span>minor<span class="_ _11"> </span>changes<span class="_"> </span>in</div><div class="t m5 x1d h26 y454 ff7 fs19 fc1 sc0 ls0 ws0">how<span class="_"> </span>a<span class="_ _11"> </span>program<span class="_ _11"> </span>is<span class="_ _11"> </span>written<span class="_ _11"> </span>can<span class="_ _11"> </span>make<span class="_ _11"> </span>large<span class="_ _11"> </span>differences<span class="_ _11"> </span>in<span class="_ _11"> </span>how<span class="_ _11"> </span>well<span class="_ _11"> </span>a<span class="_ _11"> </span>compiler<span class="_ _11"> </span>can</div><div class="t m5 x1d h26 y455 ff7 fs19 fc1 sc0 ls0 ws0">optimize<span class="_ _13"> </span>it.<span class="_"> </span>Some<span class="_ _13"> </span>programming<span class="_"> </span>languages<span class="_ _13"> </span>are<span class="_"> </span>more<span class="_ _13"> </span>easily<span class="_"> </span>optimized<span class="_ _13"> </span>than<span class="_"> </span>others<span class="_ _3"></span>.</div><div class="t m5 x1d h26 y456 ff7 fs19 fc1 sc0 ls0 ws0">Some<span class="_"> </span>features<span class="_"> </span>of<span class="_"> </span>C<span class="_ _1"></span>,<span class="_"> </span>such<span class="_"> </span>as<span class="_"> </span>the<span class="_"> </span>ability<span class="_"> </span>to<span class="_"> </span>perform<span class="_ _13"> </span>pointer<span class="_"> </span>arithmetic<span class="_"> </span>and<span class="_"> </span>casting,</div><div class="t m5 x1d h26 y457 ff7 fs19 fc1 sc0 ls0 ws0">make<span class="_ _13"> </span>it<span class="_ _13"> </span>challenging<span class="_ _13"> </span>for<span class="_ _13"> </span>a<span class="_ _13"> </span>compiler<span class="_ _13"> </span>to<span class="_ _13"> </span>optimize<span class="_ _0"></span>.<span class="_ _13"> </span>Programmers<span class="_ _13"> </span>can<span class="_ _13"> </span>often<span class="_ _13"> </span>write<span class="_ _13"> </span>their</div><div class="t m5 x1d h26 y458 ff7 fs19 fc1 sc0 ls0 ws0">programs<span class="_ _11"> </span>in<span class="_ _11"> </span>ways<span class="_ _11"> </span>that<span class="_ _16"> </span>make<span class="_ _11"> </span>it<span class="_ _11"> </span>easier<span class="_ _11"> </span>for<span class="_ _11"> </span>compilers<span class="_ _16"> </span>to<span class="_ _11"> </span>generate<span class="_ _11"> </span>efﬁcient<span class="_ _11"> </span>code.<span class="_"> </span>A</div><div class="t m5 x1d h26 y459 ff7 fs19 fc1 sc0 ls0 ws0">third<span class="_ _11"> </span>technique<span class="_ _16"> </span>for<span class="_ _11"> </span>dealing<span class="_ _11"> </span>with<span class="_ _16"> </span>especially<span class="_ _11"> </span>demanding<span class="_ _11"> </span>computations<span class="_ _16"> </span>is<span class="_ _11"> </span>to<span class="_ _11"> </span>divide</div><div class="t m5 x1d h26 y45a ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_ _14"> </span>task<span class="_ _14"> </span>into<span class="_ _16"> </span>portions<span class="_ _14"> </span>that<span class="_ _14"> </span>can<span class="_ _14"> </span>be<span class="_ _14"> </span>computed<span class="_ _14"> </span>in<span class="_ _14"> </span>parallel,<span class="_ _15"> </span>on<span class="_ _14"> </span>some<span class="_ _14"> </span>combination<span class="_ _14"> </span>of</div><div class="t m5 x1d h26 y45b ff7 fs19 fc1 sc0 ls0 ws0">multiple<span class="_"> </span>cores<span class="_ _11"> </span>and<span class="_ _11"> </span>multiple<span class="_"> </span>processors<span class="_ _1"></span>.<span class="_ _11"> </span>W<span class="_ _1"></span>e<span class="_"> </span>will<span class="_ _11"> </span>defer<span class="_ _11"> </span>this<span class="_"> </span>aspect<span class="_ _11"> </span>of<span class="_ _11"> </span>performance</div><div class="t m5 x1d h26 y45c ff7 fs19 fc1 sc0 ls0 ws0">enhancement<span class="_ _13"> </span>to<span class="_ _6"> </span>Chapter<span class="_ _13"> </span>12.<span class="_ _6"> </span>Even<span class="_ _13"> </span>when<span class="_ _6"> </span>exploiting<span class="_ _13"> </span>parallelism,<span class="_ _13"> </span>it<span class="_ _6"> </span>is<span class="_ _13"> </span>important<span class="_ _6"> </span>that</div><div class="t m5 x1d h26 y227 ff7 fs19 fc1 sc0 ls0 ws0">each<span class="_"> </span>parallel<span class="_ _11"> </span>thread<span class="_"> </span>execute<span class="_ _11"> </span>with<span class="_"> </span>maximum<span class="_ _11"> </span>performance<span class="_ _0"></span>,<span class="_"> </span>and<span class="_ _11"> </span>so<span class="_ _11"> </span>the<span class="_"> </span>material<span class="_ _11"> </span>of</div><div class="t m5 x1d h26 y45d ff7 fs19 fc1 sc0 ls0 ws0">this<span class="_"> </span>chapter<span class="_"> </span>remains<span class="_"> </span>relevant<span class="_"> </span>in<span class="_"> </span>any<span class="_"> </span>case<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y45e ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _14"> </span>approaching<span class="_ _15"> </span>program<span class="_ _14"> </span>development<span class="_ _15"> </span>and<span class="_ _14"> </span>optimization,<span class="_ _21"> </span>we<span class="_ _14"> </span>must<span class="_ _15"> </span>consider</div><div class="t m5 x1d h26 y4ad ff7 fs19 fc1 sc0 ls0 ws0">how<span class="_"> </span>the<span class="_"> </span>code<span class="_"> </span>will<span class="_"> </span>be<span class="_"> </span>used<span class="_"> </span>and<span class="_"> </span>what<span class="_"> </span>critical<span class="_"> </span>factors<span class="_"> </span>affect<span class="_"> </span>it.<span class="_"> </span>In<span class="_"> </span>general,<span class="_"> </span>program-</div><div class="t m5 x1d h26 y45f ff7 fs19 fc1 sc0 ls0 ws0">mers<span class="_ _16"> </span>must<span class="_ _14"> </span>make<span class="_ _14"> </span>a<span class="_ _14"> </span>trade-off<span class="_ _14"> </span>between<span class="_ _16"> </span>how<span class="_ _14"> </span>easy<span class="_ _14"> </span>a<span class="_ _14"> </span>program<span class="_ _14"> </span>is<span class="_ _16"> </span>to<span class="_ _14"> </span>implement<span class="_ _14"> </span>and</div><div class="t m5 x1d h26 y460 ff7 fs19 fc1 sc0 ls0 ws0">maintain,<span class="_"> </span>and<span class="_ _13"> </span>how<span class="_"> </span>fast<span class="_ _13"> </span>it<span class="_"> </span>runs<span class="_ _1"></span>.<span class="_"> </span>At<span class="_ _13"> </span>an<span class="_"> </span>algorithmic<span class="_ _13"> </span>level,<span class="_"> </span>a<span class="_ _13"> </span>simple<span class="_"> </span>insertion<span class="_"> </span>sort<span class="_ _13"> </span>can</div><div class="t m5 x1d h26 y461 ff7 fs19 fc1 sc0 ls0 ws0">be<span class="_ _14"> </span>programmed<span class="_ _15"> </span>in<span class="_ _14"> </span>a<span class="_ _14"> </span>matter<span class="_ _15"> </span>of<span class="_ _14"> </span>minutes<span class="_ _1"></span>,<span class="_ _21"> </span>whereas<span class="_ _14"> </span>a<span class="_ _15"> </span>highly<span class="_ _14"> </span>efﬁcient<span class="_ _15"> </span>sort<span class="_ _14"> </span>routine</div><div class="t m5 x1d h26 y322 ff7 fs19 fc1 sc0 ls0 ws0">may<span class="_ _16"> </span>take<span class="_ _16"> </span>a<span class="_ _16"> </span>day<span class="_ _16"> </span>or<span class="_ _16"> </span>more<span class="_ _14"> </span>to<span class="_ _16"> </span>implement<span class="_ _16"> </span>and<span class="_ _16"> </span>optimize.<span class="_ _11"> </span>At<span class="_ _14"> </span>the<span class="_ _16"> </span>coding<span class="_ _16"> </span>level,<span class="_ _14"> </span>many</div><div class="t m5 x1d h26 y323 ff7 fs19 fc1 sc0 ls0 ws0">low-level<span class="_ _11"> </span>optimizations<span class="_ _16"> </span>tend<span class="_ _16"> </span>to<span class="_ _11"> </span>reduce<span class="_ _16"> </span>code<span class="_ _11"> </span>readability<span class="_ _16"> </span>and<span class="_ _11"> </span>modularity<span class="_ _3"></span>,<span class="_ _16"> </span>making</div><div class="t m5 x1d h26 y324 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _16"> </span>programs<span class="_ _14"> </span>more<span class="_ _14"> </span>susceptible<span class="_ _14"> </span>to<span class="_ _16"> </span>bugs<span class="_ _14"> </span>and<span class="_ _14"> </span>more<span class="_ _14"> </span>difﬁcult<span class="_ _16"> </span>to<span class="_ _14"> </span>modify<span class="_ _14"> </span>or<span class="_ _16"> </span>extend.</div><div class="t m5 x1d h26 y325 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_"> </span>code<span class="_"> </span>that<span class="_"> </span>will<span class="_"> </span>be<span class="_ _13"> </span>executed<span class="_"> </span>repeatedly<span class="_"> </span>in<span class="_"> </span>a<span class="_"> </span>performance-critical<span class="_"> </span>environment,</div><div class="t m5 x1d h26 y326 ff7 fs19 fc1 sc0 ls0 ws0">extensive<span class="_ _16"> </span>optimization<span class="_ _14"> </span>may<span class="_ _14"> </span>be<span class="_ _16"> </span>appropriate.<span class="_ _16"> </span>One<span class="_ _14"> </span>challenge<span class="_ _16"> </span>is<span class="_ _14"> </span>to<span class="_ _14"> </span>maintain<span class="_ _16"> </span>some</div><div class="t m5 x1d h26 y319 ff7 fs19 fc1 sc0 ls0 ws0">degree<span class="_"> </span>of<span class="_"> </span>elegance<span class="_ _13"> </span>and<span class="_"> </span>readability<span class="_"> </span>in<span class="_"> </span>the<span class="_ _13"> </span>code<span class="_"> </span>despite<span class="_"> </span>extensive<span class="_"> </span>transformations<span class="_ _3"></span>.</div><div class="t m5 x29 h26 y31a ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _13"> </span>describe<span class="_ _6"> </span>a<span class="_ _13"> </span>number<span class="_ _13"> </span>of<span class="_ _6"> </span>techniques<span class="_ _13"> </span>for<span class="_ _13"> </span>improving<span class="_ _6"> </span>code<span class="_ _13"> </span>performance<span class="_ _1"></span>.<span class="_ _13"> </span>Ideally<span class="_ _7"></span>,</div><div class="t m5 x1d h26 y31b ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_"> </span>compiler<span class="_ _11"> </span>would<span class="_"> </span>be<span class="_ _11"> </span>able<span class="_ _11"> </span>to<span class="_"> </span>take<span class="_ _11"> </span>whatever<span class="_ _11"> </span>code<span class="_"> </span>we<span class="_ _11"> </span>write<span class="_ _11"> </span>and<span class="_"> </span>generate<span class="_ _11"> </span>the<span class="_ _11"> </span>most</div><div class="t m5 x1d h26 y31c ff7 fs19 fc1 sc0 ls0 ws0">efﬁcient<span class="_ _11"> </span>possible<span class="_ _16"> </span>machine-level<span class="_ _16"> </span>program<span class="_ _11"> </span>having<span class="_ _16"> </span>the<span class="_ _11"> </span>speciﬁed<span class="_ _16"> </span>behavior.<span class="_ _11"> </span>Modern</div><div class="t m5 x1d h26 y31d ff7 fs19 fc1 sc0 ls0 ws0">compilers<span class="_ _13"> </span>employ<span class="_ _13"> </span>sophisticated<span class="_ _13"> </span>forms<span class="_ _6"> </span>of<span class="_ _13"> </span>analysis<span class="_ _13"> </span>and<span class="_ _13"> </span>optimization,<span class="_ _13"> </span>and<span class="_ _13"> </span>they<span class="_ _13"> </span>keep</div><div class="t m5 x1d h26 y31e ff7 fs19 fc1 sc0 ls0 ws0">getting<span class="_ _13"> </span>better.<span class="_ _13"> </span>Even<span class="_ _6"> </span>the<span class="_ _13"> </span>best<span class="_ _13"> </span>compilers<span class="_ _1"></span>,<span class="_"> </span>however<span class="_ _1"></span>,<span class="_"> </span>can<span class="_ _6"> </span>be<span class="_ _13"> </span>thwarted<span class="_ _13"> </span>by<span class="_ _13"> </span><span class="ffa">optimization</span></div><div class="t m5 x1d h26 y31f ffa fs19 fc1 sc0 ls0 ws0">blockers<span class="ff7">—aspects<span class="_"> </span>of<span class="_ _16"> </span>the<span class="_"> </span>program’s<span class="_ _11"> </span>behavior<span class="_ _11"> </span>that<span class="_ _11"> </span>depend<span class="_ _16"> </span>strongly<span class="_"> </span>on<span class="_ _11"> </span>the<span class="_ _16"> </span>execu-</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
