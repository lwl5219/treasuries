<div id="pf208" class="pf w2 h11" data-page-no="208"><div class="pc pc208 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg208.png"/><div class="t m5 x107 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Solutions<span class="_ _10"> </span>to<span class="_ _10"> </span>Practice<span class="_ _10"> </span>Problems<span class="_ _1b"> </span><span class="ffe fs1e">519</span></div><div class="t m5 x21e h2d y140c ffd fs1e fc2 sc0 ls0 ws0">mrmovq<span class="_ _e"> </span>(%rdi),%rbx<span class="_ _b9"> </span>#<span class="_ _e"> </span>Get<span class="_ _1f"> </span>*start</div><div class="t m5 x21e h2d y140d ffd fs1e fc2 sc0 ls0 ws0">irmovq<span class="_ _e"> </span>$-1,%r10</div><div class="t m5 x21e h2d y1b95 ffd fs1e fc2 sc0 ls0 ws0">addq<span class="_ _3f"> </span>%r10,%rsi<span class="_ _71"> </span>#<span class="_ _1f"> </span>count--</div><div class="t m5 x21e h2d y2122 ffd fs1e fc2 sc0 ls0 ws0">irmovq<span class="_ _e"> </span>$8,%r10</div><div class="t m5 x21e h2d y1b96 ffd fs1e fc2 sc0 ls0 ws0">addq<span class="_ _3f"> </span>%r10,%rdi<span class="_ _71"> </span>#<span class="_ _1f"> </span>start++</div><div class="t m5 x21e h2d y1b97 ffd fs1e fc2 sc0 ls0 ws0">call<span class="_ _3f"> </span>rproduct</div><div class="t m5 x21e h2d y1b98 ffd fs1e fc2 sc0 ls0 ws0">imulq<span class="_ _1a"> </span>%rbx,%rax<span class="_ _71"> </span>#<span class="_ _1f"> </span>Multiply<span class="_ _e"> </span>*start<span class="_ _1f"> </span>to<span class="_ _1f"> </span>product</div><div class="t m5 x21e h2d y34a6 ffd fs1e fc2 sc0 ls0 ws0">popq<span class="_ _3f"> </span>%rbx<span class="_ _35"> </span>#<span class="_ _1f"> </span>Restore<span class="_ _e"> </span>callee-saved<span class="_ _1f"> </span>register</div><div class="t m5 x17 h2d y34a7 ffd fs1e fc2 sc0 ls0 ws0">return:</div><div class="t m5 x21e h2d y34a8 ffd fs1e fc2 sc0 ls0 ws0">ret</div><div class="t m5 x17 h28 y47e9 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>4.5</div><div class="t m5 xc3 h2f y47ea ffe fs16 fc6 sc0 ls0 ws0">(page<span class="_"> </span>406)</div><div class="t m5 x17 h26 y2b2c ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>problem<span class="_"> </span>gives<span class="_"> </span>you<span class="_"> </span>a<span class="_"> </span>chance<span class="_"> </span>to<span class="_"> </span>try<span class="_"> </span>your<span class="_"> </span>hand<span class="_"> </span>at<span class="_"> </span>writing<span class="_"> </span>assembly<span class="_"> </span>code.</div><div class="t m5 x2c h2d y2b56 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">#<span class="_ _1f"> </span>long<span class="_ _e"> </span>absSum(long<span class="_ _1f"> </span>*start,<span class="_ _1f"> </span>long<span class="_ _e"> </span>count)</span></div><div class="t m5 x2c h2d y32c7 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">#<span class="_ _1f"> </span>start<span class="_ _e"> </span>in<span class="_ _1f"> </span>%rdi,<span class="_ _1f"> </span>count<span class="_ _e"> </span>in<span class="_ _1f"> </span>%rsi</span></div><div class="t m5 x2c h2d y47eb ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _1c"> </span><span class="ffd fs1e fc2">absSum:</span></div><div class="t m5 x2c h2e y47ec ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 xc5 h2d y47ed ffd fs1e fc2 sc0 ls0 ws0">irmovq<span class="_ _e"> </span>$8,%r8<span class="_ _6b"> </span>#<span class="_ _1f"> </span>Constant<span class="_ _e"> </span>8</div><div class="t m5 x2c h2d y47ee ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _70"> </span><span class="ffd fs1e fc2">irmovq<span class="_ _e"> </span>$1,%r9<span class="_ _6b"> </span>#<span class="_ _1f"> </span>Constant<span class="_ _e"> </span>1</span></div><div class="t m5 x2c h2d y47ef ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _70"> </span><span class="ffd fs1e fc2">xorq<span class="_ _e"> </span>%rax,%rax<span class="_ _86"> </span>#<span class="_ _1f"> </span>sum<span class="_ _1f"> </span>=<span class="_ _e"> </span>0</span></div><div class="t m5 x2c h2d y47f0 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _70"> </span><span class="ffd fs1e fc2">andq<span class="_ _e"> </span>%rsi,%rsi<span class="_ _86"> </span>#<span class="_ _1f"> </span>Set<span class="_ _1f"> </span>condition<span class="_ _e"> </span>codes</span></div><div class="t m5 x2c h2d y47f1 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _70"> </span><span class="ffd fs1e fc2">jmp<span class="_ _1a"> </span>test</span></div><div class="t m5 x2c h2d y47f2 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _1c"> </span><span class="ffd fs1e fc2">loop:</span></div><div class="t m5 x17 h2d y47f3 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _70"> </span><span class="ffd fs1e fc2">mrmovq<span class="_ _e"> </span>(%rdi),%r10<span class="_ _b9"> </span>#<span class="_ _e"> </span>x<span class="_ _1f"> </span>=<span class="_ _e"> </span>*start</span></div><div class="t m5 x17 h2d y47f4 ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _70"> </span><span class="ffd fs1e fc2">xorq<span class="_ _e"> </span>%r11,%r11<span class="_ _86"> </span>#<span class="_ _1f"> </span>Constant<span class="_ _1f"> </span>0</span></div><div class="t m5 x17 h2d y47f5 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _70"> </span><span class="ffd fs1e fc2">subq<span class="_ _e"> </span>%r10,%r11<span class="_ _86"> </span>#<span class="_ _1f"> </span>-x</span></div><div class="t m5 x17 h2d y47f6 ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _70"> </span><span class="ffd fs1e fc2">jle<span class="_ _e"> </span>pos<span class="_ _15a"> </span>#<span class="_ _1f"> </span>Skip<span class="_ _e"> </span>if<span class="_ _1f"> </span>-x<span class="_ _1f"> </span>&lt;=<span class="_ _e"> </span>0</span></div><div class="t m5 x17 h2d y47f7 ff6 fs20 fc6 sc0 ls0 ws0">14<span class="_ _70"> </span><span class="ffd fs1e fc2">rrmovq<span class="_ _e"> </span>%r11,%r10<span class="_ _30"> </span><span class="ls33">#x=-<span class="_ _c4"></span>x</span></span></div><div class="t m5 x17 h2d y47f8 ff6 fs20 fc6 sc0 ls0 ws0">15<span class="_ _1c"> </span><span class="ffd fs1e fc2">pos:</span></div><div class="t m5 x17 h2d y44a3 ff6 fs20 fc6 sc0 ls0 ws0">16<span class="_ _70"> </span><span class="ffd fs1e fc2">addq<span class="_ _e"> </span>%r10,%rax<span class="_ _86"> </span>#<span class="_ _1f"> </span>Add<span class="_ _1f"> </span>to<span class="_ _e"> </span>sum</span></div><div class="t m5 x17 h2d y3d32 ff6 fs20 fc6 sc0 ls0 ws0">17<span class="_ _70"> </span><span class="ffd fs1e fc2">addq<span class="_ _e"> </span>%r8,%rdi<span class="_ _6b"> </span>#<span class="_ _1f"> </span>start++</span></div><div class="t m5 x17 h2d y29a8 ff6 fs20 fc6 sc0 ls0 ws0">18<span class="_ _70"> </span><span class="ffd fs1e fc2">subq<span class="_ _e"> </span>%r9,%rsi<span class="_ _6b"> </span>#<span class="_ _1f"> </span>count--</span></div><div class="t m5 x17 h2d y47f9 ff6 fs20 fc6 sc0 ls0 ws0">19<span class="_ _1c"> </span><span class="ffd fs1e fc2">test:</span></div><div class="t m5 x17 h2d y47fa ff6 fs20 fc6 sc0 ls0 ws0">20<span class="_ _70"> </span><span class="ffd fs1e fc2">jne<span class="_ _46"> </span>loop<span class="_ _35"> </span>#<span class="_ _1f"> </span>Stop<span class="_ _e"> </span>when<span class="_ _1f"> </span>0</span></div><div class="t m5 x17 h2e y3eb4 ff6 fs20 fc6 sc0 ls0 ws0">21</div><div class="t m5 xc5 h2d y47fb ffd fs1e fc2 sc0 ls0 ws0">ret</div><div class="t m5 x17 h28 y47fc ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>4.6</div><div class="t m5 xc3 h2f y47fd ffe fs16 fc6 sc0 ls0 ws0">(page<span class="_"> </span>406)</div><div class="t m5 x17 h26 y47fe ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _11"> </span>problem<span class="_ _16"> </span>gives<span class="_"> </span>you<span class="_ _16"> </span>a<span class="_"> </span>chance<span class="_ _16"> </span>to<span class="_"> </span>try<span class="_ _16"> </span>your<span class="_"> </span>hand<span class="_ _16"> </span>at<span class="_"> </span>writing<span class="_ _11"> </span>assembly<span class="_ _16"> </span>code<span class="_"> </span>with</div><div class="t m5 x17 h26 y47ff ff7 fs19 fc1 sc0 ls0 ws0">conditional<span class="_ _13"> </span>moves<span class="_ _1"></span>.<span class="_"> </span>W<span class="_ _7"></span>e<span class="_"> </span>show<span class="_ _13"> </span>only<span class="_ _13"> </span>the<span class="_ _13"> </span>code<span class="_"> </span>for<span class="_ _13"> </span>the<span class="_ _13"> </span>loop<span class="_ _0"></span>.<span class="_ _13"> </span>T<span class="_ _0"></span>he<span class="_ _13"> </span>rest<span class="_ _13"> </span>is<span class="_"> </span>the<span class="_ _13"> </span>same<span class="_ _13"> </span>as<span class="_ _13"> </span>for</div><div class="t m5 x17 h26 y4800 ff7 fs19 fc1 sc0 ls0 ws0">Problem<span class="_"> </span>4.5:</div><div class="t m5 x2c h2d y24e1 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _1c"> </span><span class="ffd fs1e fc2">loop:</span></div><div class="t m5 x17 h2d y543 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _70"> </span><span class="ffd fs1e fc2">mrmovq<span class="_ _e"> </span>(%rdi),%r10<span class="_ _b9"> </span>#<span class="_ _e"> </span>x<span class="_ _1f"> </span>=<span class="_ _e"> </span>*start</span></div><div class="t m5 x17 h2d ye14 ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _70"> </span><span class="ffd fs1e fc2">xorq<span class="_ _e"> </span>%r11,%r11<span class="_ _86"> </span>#<span class="_ _1f"> </span>Constant<span class="_ _1f"> </span>0</span></div><div class="t m5 x17 h2d yeef ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _70"> </span><span class="ffd fs1e fc2">subq<span class="_ _e"> </span>%r10,%r11<span class="_ _86"> </span>#<span class="_ _1f"> </span>-x</span></div><div class="t m5 x17 h2d yd7a ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _70"> </span><span class="ffd fs1e fc2">cmovg<span class="_ _e"> </span>%r11,%r10<span class="_ _87"> </span>#<span class="_ _e"> </span>If<span class="_ _1f"> </span>-<span class="ls33">x&gt;0t<span class="_ _41"></span>h<span class="_ _41"></span>e<span class="_ _41"></span>nx=-<span class="_ _41"></span>x</span></span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
