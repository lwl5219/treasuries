<div id="pf1d5" class="pf w2 h11" data-page-no="1d5"><div class="pc pc1d5 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1d5.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">468<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>4<span class="_ _3d"> </span>Processor<span class="_ _10"> </span>Architecture</span></div><div class="t m5 x53 h3f y40d6 ff49 fs27 fc1 sc0 ls0 ws0">M</div><div class="t m5 x205 h3f y40d7 ff49 fs27 fc1 sc0 ls0 ws0">M_valE = 3</div><div class="t m5 x205 h40 y40d8 ff49 fs27 fc1 sc0 ls0 ws0">M_dstE = <span class="ff4a fs28">%rax</span></div><div class="t m5 x53 h3f y40d9 ff49 fs27 fc1 sc0 ls0 ws0">D</div><div class="t m5 x205 h3f y40da ff49 fs27 fc1 sc0 ls0 ws0">valA<span class="_ _1"></span>      R[</div><div class="t m5 x152 h40 y40db ff4a fs28 fc1 sc0 ls0 ws0">%rdx<span class="ff49 fs27">] = 0</span></div><div class="t m5 x205 h40 y40dc ff49 fs27 fc1 sc0 ls0 ws0">valB      R[<span class="ff4a fs28">%rax</span>] = 0</div><div class="t m5 x180 h3f y40dd ff49 fs27 fc1 sc0 ls0 ws0">F</div><div class="t m5 x1d h40 y40de ff4a fs28 fc1 sc0 ls0 ws0">0x000: irmovq $10,%rdx</div><div class="t m5 x1d h40 y40df ff4a fs28 fc1 sc0 ls0 ws0"># prog3</div><div class="c x1d y40e0 w7 ha6"><div class="t m5 x0 h40 y40e1 ff4a fs28 fc3 sc1 ls0 ws0"># prog3</div></div><div class="t m5 x1d h40 y40e2 ff4a fs28 fc1 sc0 ls0 ws0">0x00a: irmovq  $3,%rax</div><div class="t m5 x1d h40 y40e3 ff4a fs28 fc1 sc0 ls0 ws0">0x014: nop</div><div class="t m5 x1d h40 y40e4 ff4a fs28 fc1 sc0 ls0 ws0">0x015: addq %rdx,%rax</div><div class="t m5 x1d h40 y40e5 ff4a fs28 fc1 sc0 ls0 ws0">0x017: halt</div><div class="t m5 x13d h3f y40de ff49 fs27 fc1 sc0 ls1d6 ws0">DE<span class="_ _1"></span>M<span class="_ _4"></span>W</div><div class="t m5 x13d h3f y40e6 ff49 fs27 fc1 sc0 ls1ca ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x1c9 h3f y40e7 ff49 fs27 fc1 sc0 ls1c8 ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 xe8 h3f y40e8 ff49 fs27 fc1 sc0 ls1c8 ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x152 h3f y40e9 ff49 fs27 fc1 sc0 ls1c8 ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x6d h3f y40ea ff49 fs27 fc1 sc0 ls0 ws0">Cycle 5</div><div class="t m5 xd4 h44 y40eb ff49 fs2a fc6 sc0 ls1d7 ws0">12345</div><div class="t m5 xb5 h44 y40ec ff49 fs2a fc6 sc0 ls0 ws0">6</div><div class="t m5 x1e9 h44 y40ed ff49 fs2a fc6 sc0 ls0 ws0">7</div><div class="t m5 x104 h44 y40ee ff49 fs2a fc6 sc0 ls0 ws0">8</div><div class="t m5 x231 h44 y40ef ff49 fs2a fc6 sc0 ls0 ws0">9</div><div class="t m5 x144 h3f y40f0 ff49 fs27 fc1 sc0 ls0 ws0">W</div><div class="t m5 xbd h3f y40f1 ff49 fs27 fc1 sc0 ls0 ws0">R[</div><div class="t m5 x194 h40 y40f2 ff4a fs28 fc1 sc0 ls0 ws0">%rdx<span class="ff49 fs27">]     10</span></div><div class="t m5 x16b h3f y40f3 ff1f fs27 fc1 sc0 ls0 ws0">Error</div><div class="t m8 xa h3f y40f4 ff49 fs27 fc1 sc0 ls0 ws0">. . .</div><div class="t m5 x1d h3a y40f5 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>4.45<span class="_ _66"> </span><span class="fc1">Pipelined<span class="_"> </span>execution<span class="_"> </span>of<span class="_ _10"> </span><span class="ffd fs19">prog3<span class="_ _10"> </span></span>without<span class="_ _10"> </span>special<span class="_ _10"> </span>pipeline<span class="_ _10"> </span>control.<span class="_ _10"> </span><span class="ff6">In<span class="_ _10"> </span>cycle</span></span></div><div class="t m5 x1d h34 y40f6 ff6 fs16 fc1 sc0 ls0 ws0">5,<span class="_ _14"> </span>the</div><div class="t m5 x207 h3a y40f7 ffd fs19 fc1 sc0 ls0 ws0">addq<span class="_ _16"> </span><span class="ff6 fs16">instruction<span class="_ _16"> </span>reads<span class="_ _14"> </span>its<span class="_ _16"> </span>source<span class="_ _16"> </span>operands<span class="_ _14"> </span>from<span class="_ _16"> </span>the<span class="_ _16"> </span>register<span class="_ _14"> </span>Ô¨Åle.<span class="_ _16"> </span>The<span class="_ _14"> </span>pending</span></div><div class="t m5 x1d h34 y40f8 ff6 fs16 fc1 sc0 ls0 ws0">write<span class="_ _11"> </span>to<span class="_ _16"> </span>register</div><div class="t m5 x15c h3a y40f9 ffd fs19 fc1 sc0 ls0 ws0">%rdx<span class="_ _11"> </span><span class="ff6 fs16">is<span class="_ _16"> </span>still<span class="_ _11"> </span>in<span class="_ _11"> </span>the<span class="_ _16"> </span>write-back<span class="_ _11"> </span>stage,<span class="_ _16"> </span>and<span class="_ _11"> </span>the<span class="_ _11"> </span>pending<span class="_ _16"> </span>write<span class="_ _11"> </span>to<span class="_ _16"> </span>register</span></div><div class="t m5 x1d h3a y40fa ffd fs19 fc1 sc0 ls0 ws0">%rax<span class="_ _10"> </span><span class="ff6 fs16">is<span class="_ _11"> </span>still<span class="_ _10"> </span>in<span class="_ _10"> </span>the<span class="_ _11"> </span>memory<span class="_ _11"> </span>stage.<span class="_ _10"> </span>Both<span class="_ _10"> </span>operands<span class="_ _11"> </span>valA<span class="_ _10"> </span>and<span class="_ _11"> </span>valB<span class="_ _10"> </span>get<span class="_ _11"> </span>incorrect<span class="_ _10"> </span>values.</span></div><div class="t m5 x1d h26 y40fb ff7 fs19 fc1 sc0 ls0 ws0">write<span class="_ _14"> </span>to<span class="_ _15"> </span>register<span class="_ _15"> </span><span class="ffd">%rdx<span class="_ _15"> </span></span>is<span class="_ _15"> </span>still<span class="_ _15"> </span>in<span class="_ _15"> </span>the<span class="_ _14"> </span>write-back<span class="_ _15"> </span>stage,<span class="_ _15"> </span>and<span class="_ _15"> </span>the<span class="_ _15"> </span>pending<span class="_ _14"> </span>write<span class="_ _15"> </span>to</div><div class="t m5 x1d h26 y40fc ffd fs19 fc1 sc0 ls0 ws0">%rax<span class="_ _16"> </span><span class="ff7">is<span class="_ _16"> </span>still<span class="_ _16"> </span>in<span class="_ _16"> </span>the<span class="_ _16"> </span>memory<span class="_ _16"> </span>stage<span class="_ _1"></span>.<span class="_ _16"> </span>T<span class="_ _0"></span>herefore<span class="_ _1"></span>,<span class="_ _14"> </span>the<span class="_ _16"> </span><span class="ffd">addq<span class="_ _16"> </span></span>instruction<span class="_ _16"> </span>would<span class="_ _16"> </span>get<span class="_ _16"> </span>the</span></div><div class="t m5 x1d h26 y40fd ff7 fs19 fc1 sc0 ls0 ws0">incorrect<span class="_"> </span>values<span class="_"> </span>for<span class="_"> </span>both<span class="_"> </span>operands<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y40fe ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _11"> </span>4.46<span class="_ _11"> </span>shows<span class="_ _11"> </span>what<span class="_ _11"> </span>happens<span class="_ _11"> </span>when<span class="_ _11"> </span>we<span class="_ _11"> </span>remove<span class="_ _11"> </span>all<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span><span class="ffd">nop<span class="_ _11"> </span></span>instructions</div><div class="t m5 x1d h26 y40ff ff7 fs19 fc1 sc0 ls0 ws0">between<span class="_ _15"> </span>the<span class="_ _15"> </span><span class="ffd">irmovq<span class="_ _15"> </span></span>instructions<span class="_ _21"> </span>and<span class="_ _15"> </span>the<span class="_ _15"> </span><span class="ffd">addq<span class="_ _21"> </span></span>instruction,<span class="_ _21"> </span>yielding<span class="_ _15"> </span>a<span class="_ _21"> </span>program</div><div class="t m5 x1d h26 y4100 ffd fs19 fc1 sc0 ls0 ws0">prog4<span class="ff7">.<span class="_ _11"> </span>Now<span class="_ _16"> </span>we<span class="_ _11"> </span>must<span class="_ _16"> </span>examine<span class="_ _11"> </span>the<span class="_ _11"> </span>behavior<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>pipeline<span class="_ _11"> </span>during<span class="_ _16"> </span>c<span class="_ _0"></span>ycle<span class="_ _11"> </span>4<span class="_ _16"> </span>as<span class="_ _11"> </span>the</span></div><div class="t m5 x1d h26 y4101 ffd fs19 fc1 sc0 ls0 ws0">addq<span class="_ _21"> </span><span class="ff7">instruction<span class="_ _21"> </span>passes<span class="_ _21"> </span>through<span class="_ _21"> </span>the<span class="_ _21"> </span>decode<span class="_ _21"> </span>stage.<span class="_ _15"> </span>Unfortunately<span class="_ _3"></span>,<span class="_ _f"> </span>the<span class="_ _21"> </span>pending</span></div><div class="t m5 x1d h26 y4102 ff7 fs19 fc1 sc0 ls0 ws0">write<span class="_ _14"> </span>to<span class="_ _14"> </span>register<span class="_ _14"> </span><span class="ffd">%rdx<span class="_ _15"> </span></span>is<span class="_ _14"> </span>still<span class="_ _14"> </span>in<span class="_ _15"> </span>the<span class="_ _14"> </span>memory<span class="_ _14"> </span>stage,<span class="_ _14"> </span>and<span class="_ _14"> </span>the<span class="_ _15"> </span>new<span class="_ _14"> </span>value<span class="_ _14"> </span>for<span class="_ _15"> </span><span class="ffd">%rax</span></div><div class="t m5 x1d h26 y4103 ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_ _13"> </span>just<span class="_ _13"> </span>being<span class="_ _13"> </span>computed<span class="_ _13"> </span>in<span class="_"> </span>the<span class="_ _13"> </span>execute<span class="_ _13"> </span>stage<span class="_ _1"></span>.<span class="_ _13"> </span>T<span class="_ _0"></span>herefore<span class="_ _1"></span>,<span class="_"> </span>the<span class="_ _13"> </span><span class="ffd">addq<span class="_ _13"> </span></span>instruction<span class="_ _13"> </span>would</div><div class="t m5 x1d h26 y4104 ff7 fs19 fc1 sc0 ls0 ws0">get<span class="_"> </span>the<span class="_"> </span>incorrect<span class="_"> </span>values<span class="_"> </span>for<span class="_"> </span>both<span class="_"> </span>operands<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y4105 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>hese<span class="_ _e"> </span>examples<span class="_ _f"> </span>illustrate<span class="_ _e"> </span>that<span class="_ _f"> </span>a<span class="_ _e"> </span>data<span class="_ _f"> </span>hazard<span class="_ _e"> </span>can<span class="_ _f"> </span>arise<span class="_ _f"> </span>for<span class="_ _e"> </span>an<span class="_ _f"> </span>instruction</div><div class="t m5 x1d h26 y4106 ff7 fs19 fc1 sc0 ls0 ws0">when<span class="_ _16"> </span>one<span class="_ _16"> </span>of<span class="_ _16"> </span>its<span class="_ _11"> </span>operands<span class="_ _16"> </span>is<span class="_ _16"> </span>updated<span class="_ _16"> </span>by<span class="_ _16"> </span>any<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>three<span class="_ _16"> </span>preceding<span class="_ _16"> </span>instructions<span class="_ _3"></span>.</div><div class="t m5 x1d h26 y4107 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>hese<span class="_ _16"> </span>hazards<span class="_ _11"> </span>occur<span class="_ _16"> </span>because<span class="_ _16"> </span>our<span class="_ _11"> </span>pipelined<span class="_ _16"> </span>processor<span class="_ _11"> </span>reads<span class="_ _16"> </span>the<span class="_ _11"> </span>operands<span class="_ _16"> </span>for<span class="_ _11"> </span>an</div><div class="t m5 x1d h26 y4108 ff7 fs19 fc1 sc0 ls0 ws0">instruction<span class="_ _13"> </span>from<span class="_"> </span>the<span class="_ _13"> </span>register<span class="_"> </span>Ô¨Åle<span class="_ _13"> </span>in<span class="_"> </span>the<span class="_ _13"> </span>decode<span class="_"> </span>stage<span class="_ _13"> </span>but<span class="_"> </span>does<span class="_ _13"> </span>not<span class="_"> </span>write<span class="_ _13"> </span>the<span class="_ _13"> </span>results</div><div class="t m5 x1d h26 y4109 ff7 fs19 fc1 sc0 ls0 ws0">for<span class="_"> </span>the<span class="_"> </span>instruction<span class="_ _11"> </span>to<span class="_"> </span>the<span class="_ _11"> </span>register<span class="_"> </span>Ô¨Åle<span class="_ _11"> </span>until<span class="_"> </span>three<span class="_ _11"> </span>cycles<span class="_"> </span>later,<span class="_"> </span>after<span class="_"> </span>the<span class="_"> </span>instruction</div><div class="t m5 x1d h26 y410a ff7 fs19 fc1 sc0 ls0 ws0">passes<span class="_"> </span>through<span class="_"> </span>the<span class="_"> </span>write-back<span class="_"> </span>stage<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
