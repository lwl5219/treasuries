<div id="pf1d9" class="pf w2 h11" data-page-no="1d9"><div class="pc pc1d9 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1d9.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">472<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>4<span class="_ _3d"> </span>Processor<span class="_ _10"> </span>Architecture</span></div><div class="t m5 x1d h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _13"> </span>execute<span class="_ _6"> </span>stage<span class="_ _0"></span>.<span class="_ _13"> </span>W<span class="_ _3"></span>e<span class="_ _6"> </span>will<span class="_ _13"> </span>look<span class="_ _13"> </span>at<span class="_ _6"> </span>the<span class="_ _13"> </span>detailed<span class="_ _6"> </span>mechanisms<span class="_ _13"> </span>for<span class="_ _6"> </span>making<span class="_ _13"> </span>the<span class="_ _13"> </span>pipeline</div><div class="t m5 x1d h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">stall<span class="_"> </span>and<span class="_"> </span>for<span class="_"> </span>injecting<span class="_"> </span>bubbles<span class="_"> </span>in<span class="_"> </span>Section<span class="_"> </span>4.5.8.</div><div class="t m5 x29 h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">In<span class="_ _21"> </span>using<span class="_ _f"> </span>stalling<span class="_ _f"> </span>to<span class="_ _f"> </span>handle<span class="_ _f"> </span>data<span class="_ _21"> </span>hazards<span class="_ _1"></span>,<span class="_ _e"> </span>we<span class="_ _f"> </span>effectively<span class="_ _f"> </span>execute<span class="_ _21"> </span>programs</div><div class="t m5 x1d h26 y2f7 ffd fs19 fc2 sc0 ls0 ws0">prog2<span class="_ _13"> </span><span class="ff7">and<span class="_ _13"> </span></span>prog4<span class="_ _13"> </span><span class="ff7">by<span class="_ _13"> </span>dynamically<span class="_ _13"> </span>generating<span class="_ _13"> </span>the<span class="_ _13"> </span>pipeline<span class="_ _13"> </span>ﬂow<span class="_ _13"> </span>seen<span class="_ _13"> </span>for<span class="_ _13"> </span></span>prog1<span class="_ _13"> </span><span class="ff7">(F<span class="_ _1"></span>ig-</span></div><div class="t m5 x1d h26 y2f8 ff7 fs19 fc2 sc0 ls0 ws0">ure<span class="_"> </span>4.43).<span class="_ _13"> </span>Injecting<span class="_"> </span>one<span class="_"> </span>bubble<span class="_"> </span>for<span class="_ _13"> </span><span class="ffd">prog2<span class="_ _10"> </span></span>and<span class="_"> </span>three<span class="_"> </span>for<span class="_"> </span><span class="ffd">prog4<span class="_ _13"> </span></span>has<span class="_"> </span>the<span class="_"> </span>same<span class="_"> </span>effect</div><div class="t m5 x1d h26 y2f9 ff7 fs19 fc2 sc0 ls0 ws0">as<span class="_ _11"> </span>having<span class="_ _16"> </span>three<span class="_ _11"> </span><span class="ffd">nop<span class="_ _16"> </span></span>instructions<span class="_ _11"> </span>between<span class="_ _16"> </span>the<span class="_ _11"> </span>second<span class="_ _16"> </span><span class="ffd">irmovq<span class="_ _11"> </span></span>instruction<span class="_ _11"> </span>and<span class="_ _16"> </span>the</div><div class="t m5 x1d h26 y2fa ffd fs19 fc2 sc0 ls0 ws0">addq<span class="_ _10"> </span><span class="ff7">instruction.<span class="_"> </span>T<span class="_ _0"></span>his<span class="_"> </span>mechanism<span class="_"> </span>can<span class="_"> </span>be<span class="_"> </span>implemented<span class="_"> </span>fairly<span class="_ _11"> </span>easily<span class="_"> </span>(see<span class="_"> </span>Problem</span></div><div class="t m5 x1d h26 y2fb ff7 fs19 fc2 sc0 ls0 ws0">4.53),<span class="_ _11"> </span>but<span class="_ _11"> </span>the<span class="_ _11"> </span>resulting<span class="_ _11"> </span>performance<span class="_ _11"> </span>is<span class="_"> </span>not<span class="_ _11"> </span>very<span class="_ _11"> </span>good.<span class="_ _11"> </span>There<span class="_"> </span>are<span class="_ _11"> </span>numerous<span class="_ _11"> </span>cases</div><div class="t m5 x1d h26 y2fc ff7 fs19 fc2 sc0 ls0 ws0">in<span class="_ _13"> </span>which<span class="_ _13"> </span>one<span class="_ _13"> </span>instruction<span class="_ _13"> </span>updates<span class="_ _6"> </span>a<span class="_ _13"> </span>register<span class="_ _13"> </span>and<span class="_ _13"> </span>a<span class="_ _13"> </span>closely<span class="_ _13"> </span>following<span class="_ _13"> </span>instruction<span class="_ _13"> </span>uses</div><div class="t m5 x1d h26 y2fd ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _13"> </span>same<span class="_"> </span>register<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _1"></span>his<span class="_"> </span>will<span class="_ _13"> </span>cause<span class="_ _13"> </span>the<span class="_"> </span>pipeline<span class="_ _13"> </span>to<span class="_ _13"> </span>stall<span class="_"> </span>for<span class="_ _13"> </span>up<span class="_ _13"> </span>to<span class="_"> </span>three<span class="_ _13"> </span>cycles<span class="_ _3"></span>,<span class="_"> </span>reduc-</div><div class="t m5 x1d h26 y2fe ff7 fs19 fc2 sc0 ls0 ws0">ing<span class="_"> </span>the<span class="_"> </span>overall<span class="_"> </span>throughput<span class="_"> </span>signiﬁcantly<span class="_ _3"></span>.</div><div class="t m5 x1d h42 y4198 ff6 fs29 fc6 sc0 ls0 ws0">A<span class="_ _0"></span>voiding<span class="_ _16"> </span>Data<span class="_ _11"> </span>Hazards<span class="_ _16"> </span>by<span class="_ _16"> </span>Forwarding</div><div class="t m5 x1d h46 y4199 ff7 fs19 fc1 sc0 ls0 ws0">Our<span class="_"> </span>design<span class="_"> </span>for<span class="_"> </span>PIPE<span class="ff12">−<span class="_ _10"> </span></span>reads<span class="_"> </span>source<span class="_"> </span>operands<span class="_"> </span>from<span class="_"> </span>the<span class="_"> </span>register<span class="_"> </span>ﬁle<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>decode</div><div class="t m5 x1d h26 y419a ff7 fs19 fc1 sc0 ls0 ws0">stage<span class="_ _1"></span>,<span class="_ _15"> </span>but<span class="_ _14"> </span>there<span class="_ _14"> </span>can<span class="_ _14"> </span>also<span class="_ _16"> </span>be<span class="_ _14"> </span>a<span class="_ _14"> </span>pending<span class="_ _14"> </span>write<span class="_ _14"> </span>to<span class="_ _14"> </span>one<span class="_ _14"> </span>of<span class="_ _14"> </span>these<span class="_ _16"> </span>source<span class="_ _14"> </span>registers<span class="_ _14"> </span>in</div><div class="t m5 x1d h26 y419b ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _14"> </span>write-back<span class="_ _14"> </span>stage.<span class="_ _16"> </span>Rather<span class="_ _15"> </span>than<span class="_ _14"> </span>stalling<span class="_ _14"> </span>until<span class="_ _15"> </span>the<span class="_ _14"> </span>write<span class="_ _14"> </span>has<span class="_ _14"> </span>completed,<span class="_ _21"> </span>it<span class="_ _14"> </span>can</div><div class="t m5 x1d h26 y419c ff7 fs19 fc1 sc0 ls0 ws0">simply<span class="_ _15"> </span>pass<span class="_ _15"> </span>the<span class="_ _21"> </span>value<span class="_ _15"> </span>that<span class="_ _21"> </span>is<span class="_ _15"> </span>about<span class="_ _21"> </span>to<span class="_ _15"> </span>be<span class="_ _21"> </span>written<span class="_ _15"> </span>to<span class="_ _21"> </span>pipeline<span class="_ _15"> </span>register<span class="_ _15"> </span>E<span class="_ _21"> </span>as<span class="_ _15"> </span>the</div><div class="t m5 x1d h26 y419d ff7 fs19 fc1 sc0 ls0 ws0">source<span class="_ _15"> </span>operand.<span class="_ _15"> </span>F<span class="_ _1"></span>igure<span class="_ _15"> </span>4.49<span class="_ _15"> </span>shows<span class="_ _15"> </span>this<span class="_ _15"> </span>strategy<span class="_ _21"> </span>with<span class="_ _15"> </span>an<span class="_ _15"> </span>expanded<span class="_ _15"> </span>view<span class="_ _15"> </span>of<span class="_ _15"> </span>the</div><div class="t m5 x1d h26 y419e ff7 fs19 fc1 sc0 ls0 ws0">pipeline<span class="_ _13"> </span>diagram<span class="_"> </span>for<span class="_ _13"> </span>cycle<span class="_ _13"> </span>6<span class="_ _13"> </span>of<span class="_"> </span><span class="ffd">prog2</span>.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_"> </span>decode-stage<span class="_ _13"> </span>logic<span class="_ _13"> </span>detects<span class="_"> </span>that<span class="_ _13"> </span>register</div><div class="t m8 x16a ha2 y419f ff49 fs65 fc1 sc0 ls0 ws0">. . .</div><div class="t m5 x1d ha3 y41a0 ff4a fs66 fc1 sc0 ls0 ws0">0x000: irmovq $10,%rdx</div><div class="t m5 x1d ha3 y41a1 ff4a fs66 fc1 sc0 ls0 ws0"># prog2</div><div class="c x1d y41a2 wb hb0"><div class="t m5 x0 ha3 y41a3 ff4a fs66 fc3 sc1 ls0 ws0"># prog2</div></div><div class="t m5 x1d ha3 y41a4 ff4a fs66 fc1 sc0 ls0 ws0">0x00a: irmovq  $3,%rax</div><div class="t m5 x1d ha3 y41a5 ff4a fs66 fc1 sc0 ls0 ws0">0x014: nop</div><div class="t m5 x1d ha3 y41a6 ff4a fs66 fc1 sc0 ls0 ws0">0x015: nop</div><div class="t m5 x1d ha3 y41a7 ff4a fs66 fc1 sc0 ls0 ws0">0x016: addq %rdx,%rax</div><div class="t m5 x1d ha3 y41a8 ff4a fs66 fc1 sc0 ls0 ws0">0x018: halt</div><div class="t m5 x13c ha3 y41a9 ff49 fs65 fc1 sc0 ls0 ws0">srcA<span class="_ _1"></span> = <span class="ff4a fs66">%rdx</span></div><div class="t m5 x13c ha3 y41aa ff49 fs65 fc1 sc0 ls0 ws0">srcB = <span class="ff4a fs66">%rax</span></div><div class="t m5 xf4 ha3 y41ab ff49 fs65 fc1 sc0 ls0 ws0">W_dstE = <span class="ff4a fs66">%rax</span></div><div class="t m5 xf4 ha2 y41ac ff49 fs65 fc1 sc0 ls0 ws0">W_valE = 3</div><div class="t m5 x1fd ha2 y41ad ff49 fs65 fc1 sc0 ls0 ws0">D</div><div class="t m5 x1dd ha2 y41ae ff49 fs65 fc1 sc0 ls0 ws0">valA<span class="_ _1"></span>      R[</div><div class="t m5 x1cf ha3 y41af ff4a fs66 fc1 sc0 ls0 ws0">%rdx<span class="ff49 fs65">] = 10</span></div><div class="t m5 x1dd ha2 y41b0 ff49 fs65 fc1 sc0 ls0 ws0">valB      W_valE = 3</div><div class="t m5 x1ca ha2 y41b1 ff49 fs65 fc1 sc0 ls0 ws0">W</div><div class="t m5 x1fa ha2 y41b2 ff49 fs65 fc1 sc0 ls0 ws0">Cycle 6</div><div class="t m5 x172 ha2 y41b3 ff49 fs65 fc1 sc0 ls0 ws0">R[<span class="ff4b fs67">%rax</span>]      3</div><div class="t m5 x94 ha2 y41b4 ff49 fs65 fc1 sc0 ls0 ws0">F</div><div class="t m5 x1b1 ha5 y41b5 ff49 fs67 fc6 sc0 ls1d4 ws0">12345</div><div class="t m5 x1fd ha5 y41b6 ff49 fs67 fc6 sc0 ls0 ws0">6</div><div class="t m5 x133 ha5 y41b7 ff49 fs67 fc6 sc0 ls0 ws0">7</div><div class="t m5 x224 ha5 y41b8 ff49 fs67 fc6 sc0 ls0 ws0">8</div><div class="t m5 x1e5 ha5 y41b9 ff49 fs67 fc6 sc0 ls1d5 ws0">91<span class="_ _1c5"></span>0</div><div class="t m5 x198 ha2 y41a0 ff49 fs65 fc1 sc0 ls1d2 ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x118 ha2 y41ba ff49 fs65 fc1 sc0 ls1d2 ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x1b4 ha2 y41bb ff49 fs65 fc1 sc0 ls1d3 ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 xde ha2 y41bc ff49 fs65 fc1 sc0 ls1e4 ws0">DE<span class="_ _1"></span>M<span class="_ _4"></span>W</div><div class="t m5 xb9 ha2 y41bd ff49 fs65 fc1 sc0 ls1d3 ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x1fd ha2 y41be ff49 fs65 fc1 sc0 ls1d2 ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x1d h3a y41bf ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>4.49<span class="_ _66"> </span><span class="fc1">Pipelined<span class="_"> </span>execution<span class="_"> </span>of<span class="_ _10"> </span><span class="ffd fs19">prog2<span class="_ _10"> </span></span>using<span class="_ _10"> </span>forwarding.<span class="_"> </span><span class="ff6">In<span class="_ _10"> </span>cycle<span class="_ _10"> </span>6,<span class="_ _10"> </span>the<span class="_ _10"> </span>decode-</span></span></div><div class="t m5 x1d h34 y41c0 ff6 fs16 fc1 sc0 ls0 ws0">stage<span class="_ _11"> </span>logic<span class="_ _16"> </span>detects<span class="_ _16"> </span>the<span class="_ _11"> </span>presence<span class="_ _16"> </span>of<span class="_ _11"> </span>a<span class="_ _16"> </span>pending<span class="_ _11"> </span>write<span class="_ _16"> </span>to<span class="_ _16"> </span>register</div><div class="t m5 x225 h3a y41c1 ffd fs19 fc1 sc0 ls0 ws0">%rax<span class="_ _11"> </span><span class="ff6 fs16">in<span class="_ _16"> </span>the<span class="_ _16"> </span>write-back</span></div><div class="t m5 x1d h34 y41c2 ff6 fs16 fc1 sc0 ls0 ws0">stage.<span class="_ _16"> </span>It<span class="_ _14"> </span>uses<span class="_ _14"> </span>this<span class="_ _16"> </span>value<span class="_ _14"> </span>for<span class="_ _14"> </span>source<span class="_ _16"> </span>operand<span class="_ _16"> </span>valB<span class="_ _14"> </span>rather<span class="_ _14"> </span>than<span class="_ _16"> </span>the<span class="_ _14"> </span>value<span class="_ _14"> </span>read<span class="_ _16"> </span>from<span class="_ _14"> </span>the</div><div class="t m5 x1d h34 y41c3 ff6 fs16 fc1 sc0 ls0 ws0">register<span class="_ _10"> </span>ﬁle.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
