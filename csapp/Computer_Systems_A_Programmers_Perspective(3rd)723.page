<div id="pf2d3" class="pf w2 h11" data-page-no="2d3"><div class="pc pc2d3 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg2d3.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">722<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>7<span class="_ _3d"> </span>Linking</span></div><div class="t m5 x14 h3a ye7 ff6 fs16 fc2 sc0 ls0 ws0">(a)<span class="_ _10"> </span><span class="ffd fs19">addvec.o</span></div><div class="t m5 x78 h2c y5de4 ffa fs16 fc2 sc0 ls0 ws0">code/link/addvec.c</div><div class="t m5 xb h2e y5de5 ff6 fs20 fc6 sc0 ls0 ws0">1</div><div class="t m5 x244 h2d y5de6 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>addcnt<span class="_ _1f"> </span>=<span class="_ _1f"> </span>0;</div><div class="t m5 xb h2e y5de7 ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 xb h2e y5de8 ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x244 h2d y5de9 ffd fs1e fc2 sc0 ls0 ws0">void<span class="_ _e"> </span>addvec(int<span class="_ _1f"> </span>*x,<span class="_ _1f"> </span>int<span class="_ _e"> </span>*y,</div><div class="t m5 xb h2d y3483 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _d1"> </span><span class="ffd fs1e fc2">int<span class="_ _1f"> </span>*z,<span class="_ _e"> </span>int<span class="_ _1f"> </span>n)</span></div><div class="t m5 xb h2d y2a15 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 xb h2d y35f7 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _20"> </span><span class="ffd fs1e fc2">int<span class="_ _e"> </span>i;</span></div><div class="t m5 xb h2e y4f4e ff6 fs20 fc6 sc0 ls0 ws0">7</div><div class="t m5 xb h2e y5fa8 ff6 fs20 fc6 sc0 ls0 ws0">8</div><div class="t m5 x26 h2d y4f4f ffd fs1e fc2 sc0 ls0 ws0">addcnt++;</div><div class="t m5 xb h2e y4f50 ff6 fs20 fc6 sc0 ls0 ws0">9</div><div class="t m5 x14 h2e y5fa9 ff6 fs20 fc6 sc0 ls0 ws0">10</div><div class="t m5 x26 h2d yea5 ffd fs1e fc2 sc0 ls33 ws0">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>i=0<span class="_ _41"></span>;i&lt;n<span class="_ _41"></span>;<span class="ls0">i++)</span></div><div class="t m5 x14 h2d y4f51 ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _70"> </span><span class="ffd fs1e fc2">z[i]<span class="_ _e"> </span>=<span class="_ _1f"> </span>x[i]<span class="_ _1f"> </span>+<span class="_ _e"> </span>y[i];</span></div><div class="t m5 x14 h2d y4f52 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x78 h2c y5faa ffa fs16 fc2 sc0 ls0 ws0">code/link/addvec.c</div><div class="t m5 x185 h34 y5fab ff6 fs16 fc2 sc0 ls0 ws0">(b)</div><div class="t m5 x179 h3a y255c ffd fs19 fc2 sc0 ls0 ws0">multvec.o</div><div class="t m5 x1e9 h2c y5fac ffa fs16 fc2 sc0 ls0 ws0">code/link/multvec.c</div><div class="t m5 x121 h2d ye96 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">int<span class="_ _1f"> </span>multcnt<span class="_ _e"> </span>=<span class="_ _1f"> </span>0;</span></div><div class="t m5 x121 h2e yc98 ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x121 h2e y5fad ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x208 h2d y5fae ffd fs1e fc2 sc0 ls0 ws0">void<span class="_ _e"> </span>multvec(int<span class="_ _1f"> </span>*x,<span class="_ _1f"> </span>int<span class="_ _e"> </span>*y,</div><div class="t m5 x121 h2d ydc7 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _cf"> </span><span class="ffd fs1e fc2">int<span class="_ _1f"> </span>*z,<span class="_ _e"> </span>int<span class="_ _1f"> </span>n)</span></div><div class="t m5 x121 h2d y2c2d ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x121 h2d y18a5 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _20"> </span><span class="ffd fs1e fc2">int<span class="_ _e"> </span>i;</span></div><div class="t m5 x121 h2e y2289 ff6 fs20 fc6 sc0 ls0 ws0">7</div><div class="t m5 x121 h2e y5faf ff6 fs20 fc6 sc0 ls0 ws0">8</div><div class="t m5 x1c7 h2d y5fb0 ffd fs1e fc2 sc0 ls0 ws0">multcnt++;</div><div class="t m5 x121 h2e y5fb1 ff6 fs20 fc6 sc0 ls0 ws0">9</div><div class="t m5 x185 h2e y5fb2 ff6 fs20 fc6 sc0 ls0 ws0">10</div><div class="t m5 x1c7 h2d y5fb3 ffd fs1e fc2 sc0 ls33 ws0">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>i=0<span class="_ _41"></span>;i&lt;n<span class="_ _41"></span>;<span class="ls0">i++)</span></div><div class="t m5 x185 h2d y2b2c ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _70"> </span><span class="ffd fs1e fc2">z[i]<span class="_ _e"> </span>=<span class="_ _1f"> </span>x[i]<span class="_ _1f"> </span>*<span class="_ _e"> </span>y[i];</span></div><div class="t m5 x185 h2e y5fb4 ff6 fs20 fc6 sc0 ls0 ws0">12</div><div class="t m5 x208 h2d y5fb5 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x1e9 h2c y5fb6 ffa fs16 fc2 sc0 ls0 ws0">code/link/multvec.c</div><div class="t m5 x14 h2f y5fb7 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>7.6<span class="_ _66"> </span><span class="fc1">Member<span class="_"> </span>object<span class="_"> </span>ﬁles<span class="_"> </span>in<span class="_"> </span>the</span></div><div class="t m5 x89 h3a y5fb8 ffd fs19 fc1 sc0 ls0 ws0">libvector<span class="_ _10"> </span><span class="ffe fs16">library<span class="_ _1"></span>.</span></div><div class="t m5 x29 h26 y5fb9 ff7 fs19 fc1 sc0 ls0 ws0">At<span class="_"> </span>link<span class="_ _13"> </span>time,<span class="_ _13"> </span>the<span class="_"> </span>linker<span class="_"> </span>will<span class="_"> </span>only<span class="_ _13"> </span>copy<span class="_"> </span>the<span class="_"> </span>object<span class="_ _13"> </span>modules<span class="_"> </span>that<span class="_"> </span>are<span class="_ _13"> </span>referenced</div><div class="t m5 x1d h26 y5fba ff7 fs19 fc1 sc0 ls0 ws0">by<span class="_"> </span>the<span class="_"> </span>program,<span class="_"> </span>which<span class="_"> </span>reduces<span class="_"> </span>the<span class="_"> </span>size<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_"> </span>executable<span class="_"> </span>on<span class="_"> </span>disk<span class="_"> </span>and<span class="_"> </span>in<span class="_"> </span>memory<span class="_ _7"></span>.</div><div class="t m5 x1d h26 y5fbb ff7 fs19 fc1 sc0 ls0 ws0">On<span class="_"> </span>the<span class="_"> </span>other<span class="_"> </span>hand,<span class="_"> </span>the<span class="_"> </span>application<span class="_"> </span>programmer<span class="_"> </span>only<span class="_"> </span>needs<span class="_"> </span>to<span class="_"> </span>include<span class="_"> </span>the<span class="_"> </span>names</div><div class="t m5 x1d h26 y5fbc ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_ _13"> </span>a<span class="_"> </span>few<span class="_ _13"> </span>library<span class="_"> </span>ﬁles<span class="_ _3"></span>.<span class="_"> </span>(In<span class="_ _13"> </span>fact,<span class="_"> </span>C<span class="_ _13"> </span>compiler<span class="_"> </span>drivers<span class="_ _13"> </span>always<span class="_"> </span>pass<span class="_ _13"> </span><span class="ffd">libc.a<span class="_ _10"> </span></span>to<span class="_ _13"> </span>the<span class="_"> </span>linker,</div><div class="t m5 x1d h26 y5fbd ff7 fs19 fc1 sc0 ls0 ws0">so<span class="_"> </span>the<span class="_"> </span>reference<span class="_"> </span>to<span class="_"> </span><span class="ffd">libc.a<span class="_ _10"> </span></span>mentioned<span class="_"> </span>previously<span class="_"> </span>is<span class="_"> </span>unnecessary<span class="_ _3"></span>.)</div><div class="t m5 x29 h26 y5fbe ff7 fs19 fc1 sc0 ls0 ws0">On<span class="_ _13"> </span>Linux<span class="_"> </span>systems<span class="_ _3"></span>,<span class="_"> </span>static<span class="_ _13"> </span>libraries<span class="_"> </span>are<span class="_ _13"> </span>stored<span class="_ _13"> </span>on<span class="_"> </span>disk<span class="_ _13"> </span>in<span class="_"> </span>a<span class="_ _13"> </span>particular<span class="_ _13"> </span>ﬁle<span class="_"> </span>format</div><div class="t m5 x1d h26 y5fbf ff7 fs19 fc1 sc0 ls0 ws0">known<span class="_ _13"> </span>as<span class="_ _13"> </span>an<span class="_ _13"> </span><span class="ffa">archive</span>.<span class="_ _13"> </span>An<span class="_ _13"> </span>archive<span class="_ _13"> </span>is<span class="_ _13"> </span>a<span class="_ _13"> </span>collection<span class="_ _13"> </span>of<span class="_ _13"> </span>concatenated<span class="_"> </span>relocatable<span class="_ _13"> </span>object</div><div class="t m5 x1d h26 y5fc0 ff7 fs19 fc1 sc0 ls0 ws0">ﬁles<span class="_ _1"></span>,<span class="_ _13"> </span>with<span class="_"> </span>a<span class="_ _13"> </span>header<span class="_ _13"> </span>that<span class="_ _13"> </span>describes<span class="_ _13"> </span>the<span class="_"> </span>size<span class="_ _13"> </span>and<span class="_ _13"> </span>location<span class="_ _13"> </span>of<span class="_ _13"> </span>each<span class="_"> </span>member<span class="_ _13"> </span>object<span class="_ _13"> </span>ﬁle<span class="_ _1"></span>.</div><div class="t m5 x1d h26 y5fc1 ff7 fs19 fc1 sc0 ls0 ws0">Archive<span class="_"> </span>ﬁlenames<span class="_"> </span>are<span class="_"> </span>denoted<span class="_"> </span>with<span class="_"> </span>the<span class="_"> </span><span class="ffd">.a<span class="_ _10"> </span></span>sufﬁx.</div><div class="t m5 x29 h26 y5fc2 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_ _e"> </span>make<span class="_ _21"> </span>our<span class="_ _f"> </span>discussion<span class="_ _e"> </span>of<span class="_ _21"> </span>libraries<span class="_ _e"> </span>concrete<span class="_ _1"></span>,<span class="_ _e"> </span>consider<span class="_ _f"> </span>the<span class="_ _f"> </span>pair<span class="_ _e"> </span>of<span class="_ _21"> </span>vector</div><div class="t m5 x1d h26 y5fc3 ff7 fs19 fc1 sc0 ls0 ws0">routines<span class="_"> </span>in<span class="_ _13"> </span>Figure<span class="_ _13"> </span>7.6.<span class="_"> </span>Each<span class="_ _13"> </span>routine,<span class="_ _13"> </span>deﬁned<span class="_"> </span>in<span class="_"> </span>its<span class="_ _13"> </span>own<span class="_"> </span>object<span class="_ _13"> </span>module,<span class="_ _13"> </span>performs<span class="_"> </span>a</div><div class="t m5 x1d h26 y5fc4 ff7 fs19 fc1 sc0 ls0 ws0">vector<span class="_ _6"> </span>operation<span class="_ _13"> </span>on<span class="_ _6"> </span>a<span class="_ _6"> </span>pair<span class="_ _13"> </span>of<span class="_ _6"> </span>input<span class="_ _6"> </span>vectors<span class="_ _13"> </span>and<span class="_ _6"> </span>stores<span class="_ _6"> </span>the<span class="_ _13"> </span>result<span class="_ _6"> </span>in<span class="_ _6"> </span>an<span class="_ _13"> </span>output<span class="_ _a"> </span>vector.</div><div class="t m5 x1d h26 y5fc5 ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_ _11"> </span>a<span class="_ _16"> </span>side<span class="_ _16"> </span>effect,<span class="_ _11"> </span>each<span class="_ _16"> </span>routine<span class="_ _16"> </span>records<span class="_ _11"> </span>the<span class="_ _16"> </span>number<span class="_ _11"> </span>of<span class="_ _16"> </span>times<span class="_ _11"> </span>it<span class="_ _16"> </span>has<span class="_ _11"> </span>been<span class="_ _16"> </span>called<span class="_ _16"> </span>by</div><div class="t m5 x1d h26 y5fc6 ff7 fs19 fc1 sc0 ls0 ws0">incrementing<span class="_ _11"> </span>a<span class="_ _16"> </span>global<span class="_ _16"> </span>variable<span class="_ _1"></span>.<span class="_ _16"> </span>(T<span class="_ _1"></span>his<span class="_ _16"> </span>will<span class="_ _16"> </span>be<span class="_ _11"> </span>useful<span class="_ _16"> </span>when<span class="_ _11"> </span>we<span class="_ _16"> </span>explain<span class="_ _16"> </span>the<span class="_ _11"> </span>idea<span class="_ _16"> </span>of</div><div class="t m5 x1d h26 y5fc7 ff7 fs19 fc1 sc0 ls0 ws0">position-independent<span class="_"> </span>code<span class="_"> </span>in<span class="_"> </span>Section<span class="_"> </span>7.12.)</div><div class="t m5 x29 h26 y5fc8 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_ _13"> </span>create<span class="_ _a"> </span>a<span class="_ _13"> </span>static<span class="_ _a"> </span>library<span class="_ _13"> </span>of<span class="_ _a"> </span>these<span class="_ _13"> </span>functions<span class="_ _3"></span>,<span class="_ _13"> </span>we<span class="_ _6"> </span>would<span class="_ _6"> </span>use<span class="_ _6"> </span>the<span class="_ _13"> </span><span class="ff9">ar<span class="_ _a"> </span></span>tool<span class="_ _6"> </span>as<span class="_ _13"> </span>follows:</div><div class="t m5 x1d h2d y5fc9 ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">gcc<span class="_ _1f"> </span>-c<span class="_ _1f"> </span>addvec.c<span class="_ _e"> </span>multvec.c</span></div><div class="t m5 x1d h2d y5fca ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">ar<span class="_ _1f"> </span>rcs<span class="_ _1f"> </span>libvector.a<span class="_ _e"> </span>addvec.o<span class="_ _1f"> </span>multvec.o</span></div><div class="t m5 x1d h26 y5fcb ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_ _16"> </span>use<span class="_ _16"> </span>the<span class="_ _16"> </span>library<span class="_ _3"></span>,<span class="_ _16"> </span>we<span class="_ _16"> </span>might<span class="_ _16"> </span>write<span class="_ _11"> </span>an<span class="_ _16"> </span>application<span class="_ _16"> </span>such<span class="_ _16"> </span>as<span class="_ _16"> </span><span class="ffd">main2.c<span class="_ _11"> </span></span>in<span class="_ _16"> </span>Figure<span class="_ _11"> </span>7.7,</div><div class="t m5 x1d h26 y5fcc ff7 fs19 fc2 sc0 ls0 ws0">which<span class="_"> </span>invokes<span class="_ _11"> </span>the<span class="_ _11"> </span><span class="ffd">addvec<span class="_ _11"> </span></span>library<span class="_ _11"> </span>routine<span class="_ _0"></span>.<span class="_"> </span>The<span class="_"> </span>include<span class="_"> </span>(or<span class="_ _11"> </span>header)<span class="_ _11"> </span>ﬁle<span class="_ _11"> </span><span class="ffd">vector.h</span></div><div class="t m5 x1d h26 y5fcd ff7 fs19 fc2 sc0 ls0 ws0">deﬁnes<span class="_"> </span>the<span class="_"> </span>function<span class="_"> </span>prototypes<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>routines<span class="_"> </span>in<span class="_"> </span><span class="ffd">libvector.a</span>,</div><div class="t m5 x29 h26 y5fce ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_ _16"> </span>build<span class="_ _16"> </span>the<span class="_ _16"> </span>executable<span class="_ _1"></span>,<span class="_ _16"> </span>we<span class="_ _16"> </span>would<span class="_ _16"> </span>compile<span class="_ _16"> </span>and<span class="_ _16"> </span>link<span class="_ _11"> </span>the<span class="_ _16"> </span>input<span class="_ _16"> </span>ﬁles<span class="_ _16"> </span><span class="ffd">main2.o</span></div><div class="t m5 x1d h26 y5fcf ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_"> </span><span class="ffd">libvector.a</span>:</div><div class="t m5 x1d h2d y77e ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">gcc<span class="_ _1f"> </span>-c<span class="_ _1f"> </span>main2.c</span></div><div class="t m5 x1d h2d y19e7 ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">gcc<span class="_ _1f"> </span>-static<span class="_ _1f"> </span>-o<span class="_ _e"> </span>prog2c<span class="_ _1f"> </span>main2.o<span class="_ _e"> </span>./libvector.a</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
