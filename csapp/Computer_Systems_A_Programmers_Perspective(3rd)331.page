<div id="pf14b" class="pf w2 h11" data-page-no="14b"><div class="pc pc14b w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg14b.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">330<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x75 h3d y2f34 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y9c ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>instructions<span class="_"> </span>that<span class="_"> </span>operate<span class="_"> </span>on<span class="_"> </span>ﬂoating-point<span class="_"> </span>data.</div><div class="t m5 x75 h3d y2f35 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 ye18 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>conventions<span class="_"> </span>used<span class="_"> </span>for<span class="_"> </span>passing<span class="_"> </span>ﬂoating-point<span class="_"> </span>values<span class="_"> </span>as<span class="_"> </span>arguments<span class="_"> </span>to<span class="_"> </span>func-</div><div class="t m5 x29 h26 y2f36 ff7 fs19 fc1 sc0 ls0 ws0">tions<span class="_"> </span>and<span class="_"> </span>for<span class="_"> </span>returning<span class="_"> </span>them<span class="_"> </span>as<span class="_"> </span>results<span class="_ _1"></span>.</div><div class="t m5 x75 h3d y2f37 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y2f38 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _14"> </span>conventions<span class="_ _14"> </span>for<span class="_ _16"> </span>how<span class="_ _14"> </span>registers<span class="_ _14"> </span>are<span class="_ _14"> </span>preserved<span class="_ _16"> </span>during<span class="_ _14"> </span>function<span class="_ _14"> </span>calls—for</div><div class="t m5 x29 h26 y2f39 ff7 fs19 fc1 sc0 ls0 ws0">example<span class="_ _1"></span>,<span class="_ _11"> </span>with<span class="_ _11"> </span>some<span class="_"> </span>registers<span class="_ _11"> </span>designated<span class="_"> </span>as<span class="_ _11"> </span>caller<span class="_"> </span>saved,<span class="_ _11"> </span>and<span class="_ _11"> </span>others<span class="_"> </span>as<span class="_ _11"> </span>callee</div><div class="t m5 x29 h26 y2f3a ff7 fs19 fc1 sc0 ls0 ws0">saved.</div><div class="t m5 x29 h26 y2f3b ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_ _14"> </span>understand<span class="_ _16"> </span>the<span class="_ _14"> </span>x86-64<span class="_ _16"> </span>ﬂoating-point<span class="_ _14"> </span>architecture<span class="_ _0"></span>,<span class="_ _14"> </span>it<span class="_ _16"> </span>is<span class="_ _14"> </span>helpful<span class="_ _14"> </span>to<span class="_ _16"> </span>have<span class="_ _14"> </span>a</div><div class="t m5 x1d h26 y2f3c ff7 fs19 fc1 sc0 ls0 ws0">brief<span class="_"> </span>historical<span class="_"> </span>perspective<span class="_ _1"></span>.<span class="_"> </span>Since<span class="_"> </span>the<span class="_"> </span>introduction<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>Pentium/MMX<span class="_"> </span>in<span class="_"> </span>1997,</div><div class="t m5 x1d h26 y2f3d ff7 fs19 fc1 sc0 ls0 ws0">both<span class="_"> </span>Intel<span class="_ _11"> </span>and<span class="_"> </span>AMD<span class="_ _11"> </span>have<span class="_"> </span>incorporated<span class="_ _11"> </span>successive<span class="_"> </span>generations<span class="_"> </span>of<span class="_ _11"> </span><span class="ffa">media<span class="_"> </span></span>instruc-</div><div class="t m5 x1d h26 y2f3e ff7 fs19 fc1 sc0 ls0 ws0">tions<span class="_ _11"> </span>to<span class="_ _11"> </span>support<span class="_ _16"> </span>graphics<span class="_ _11"> </span>and<span class="_ _11"> </span>image<span class="_ _16"> </span>processing<span class="_ _0"></span>.<span class="_ _11"> </span>These<span class="_"> </span>instructions<span class="_ _11"> </span>originally<span class="_ _16"> </span>fo-</div><div class="t m5 x1d h26 y2f3f ff7 fs19 fc1 sc0 ls0 ws0">cused<span class="_"> </span>on<span class="_ _13"> </span>allowing<span class="_"> </span>multiple<span class="_"> </span>operations<span class="_ _13"> </span>to<span class="_"> </span>be<span class="_ _13"> </span>performed<span class="_"> </span>in<span class="_"> </span>a<span class="_ _13"> </span>parallel<span class="_"> </span>mode<span class="_"> </span>known</div><div class="t m5 x1d h26 y2f40 ff7 fs19 fc1 sc0 ls0 ws0">as<span class="_"> </span><span class="ffa">single<span class="_ _11"> </span>instruction,<span class="_ _11"> </span>multiple<span class="_"> </span>data,<span class="_ _13"> </span></span>or<span class="_"> </span><span class="ffa">SIMD<span class="_"> </span></span>(pronounced<span class="_"> </span>sim-dee).<span class="_ _11"> </span>In<span class="_"> </span>this<span class="_ _11"> </span>mode</div><div class="t m5 x1d h26 y2f41 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>same<span class="_ _13"> </span>operation<span class="_"> </span>is<span class="_"> </span>performed<span class="_ _13"> </span>on<span class="_"> </span>a<span class="_"> </span>number<span class="_ _13"> </span>of<span class="_"> </span>different<span class="_"> </span>data<span class="_ _13"> </span>values<span class="_"> </span>in<span class="_"> </span>parallel.</div><div class="t m5 x1d h26 y2f42 ff7 fs19 fc1 sc0 ls0 ws0">Over<span class="_ _13"> </span>the<span class="_"> </span>years<span class="_ _1"></span>,<span class="_ _13"> </span>there<span class="_"> </span>has<span class="_ _13"> </span>been<span class="_"> </span>a<span class="_ _13"> </span>progression<span class="_"> </span>of<span class="_ _13"> </span>these<span class="_"> </span>extensions<span class="_ _3"></span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span>names<span class="_"> </span>have</div><div class="t m5 x1d h26 y2f43 ff7 fs19 fc1 sc0 ls0 ws0">changed<span class="_ _11"> </span>through<span class="_ _16"> </span>a<span class="_ _16"> </span>series<span class="_ _11"> </span>of<span class="_ _16"> </span>major<span class="_ _11"> </span>revisions<span class="_ _16"> </span>from<span class="_ _11"> </span>MMX<span class="_ _16"> </span>to<span class="_ _11"> </span>SSE<span class="_ _16"> </span>(for<span class="_ _16"> </span>“streaming</div><div class="t m5 x1d h26 y2f44 ff7 fs19 fc1 sc0 ls0 ws0">SIMD<span class="_"> </span>extensions”)<span class="_ _11"> </span>and<span class="_ _11"> </span>most<span class="_ _11"> </span>recently<span class="_ _11"> </span>A<span class="_ _7"></span>VX<span class="_"> </span>(for<span class="_ _11"> </span>“advanced<span class="_ _11"> </span>vector<span class="_ _11"> </span>extensions”).</div><div class="t m5 x1d h26 y2f45 ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _1"></span>ithin<span class="_"> </span>each<span class="_ _13"> </span>generation,<span class="_ _13"> </span>there<span class="_ _13"> </span>have<span class="_ _13"> </span>also<span class="_ _13"> </span>been<span class="_"> </span>different<span class="_ _13"> </span>versions<span class="_ _3"></span>.<span class="_"> </span>Each<span class="_ _13"> </span>of<span class="_ _13"> </span>these<span class="_ _13"> </span>ex-</div><div class="t m5 x1d h26 y2f46 ff7 fs19 fc1 sc0 ls0 ws0">tensions<span class="_ _13"> </span>manages<span class="_ _6"> </span>data<span class="_ _13"> </span>in<span class="_ _6"> </span>sets<span class="_ _13"> </span>of<span class="_ _6"> </span>registers<span class="_ _1"></span>,<span class="_ _13"> </span>referred<span class="_ _6"> </span>to<span class="_ _13"> </span>as<span class="_ _6"> </span>“MM”<span class="_ _13"> </span>registers<span class="_ _6"> </span>for<span class="_ _13"> </span>MMX,</div><div class="t m5 x1d h26 y2f47 ff7 fs19 fc1 sc0 ls0 ws0">“XMM”<span class="_ _11"> </span>for<span class="_ _11"> </span>SSE,<span class="_ _16"> </span>and<span class="_ _11"> </span>“YMM”<span class="_ _11"> </span>for<span class="_ _11"> </span>A<span class="_ _7"></span>VX,<span class="_ _16"> </span>ranging<span class="_ _11"> </span>from<span class="_ _11"> </span>64<span class="_ _11"> </span>bits<span class="_ _16"> </span>for<span class="_"> </span>MM<span class="_ _16"> </span>registers<span class="_ _1"></span>,</div><div class="t m5 x1d h26 y2f48 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_"> </span>128<span class="_"> </span>for<span class="_"> </span>XMM,<span class="_"> </span>to<span class="_"> </span>256<span class="_"> </span>for<span class="_"> </span>YMM.<span class="_"> </span>So<span class="_ _0"></span>,<span class="_"> </span>for<span class="_"> </span>example<span class="_ _1"></span>,<span class="_"> </span>each<span class="_"> </span>YMM<span class="_"> </span>register<span class="_"> </span>can<span class="_"> </span>hold</div><div class="t m5 x1d h26 y2f49 ff7 fs19 fc1 sc0 ls0 ws0">eight<span class="_"> </span>32-bit<span class="_"> </span>values<span class="_ _3"></span>,<span class="_"> </span>or<span class="_"> </span>four<span class="_"> </span>64-bit<span class="_"> </span>values<span class="_ _1"></span>,<span class="_"> </span>where<span class="_"> </span>these<span class="_"> </span>values<span class="_"> </span>can<span class="_"> </span>be<span class="_"> </span>either<span class="_ _13"> </span>integer</div><div class="t m5 x1d h26 y2f4a ff7 fs19 fc1 sc0 ls0 ws0">or<span class="_"> </span>ﬂoating<span class="_"> </span>point.</div><div class="t m5 x29 h26 y2f4b ff7 fs19 fc1 sc0 ls0 ws0">Starting<span class="_ _15"> </span>with<span class="_ _15"> </span>SSE2,<span class="_ _21"> </span>introduced<span class="_ _15"> </span>with<span class="_ _21"> </span>the<span class="_ _15"> </span>Pentium<span class="_ _15"> </span>4<span class="_ _15"> </span>in<span class="_ _15"> </span>2000,<span class="_ _f"> </span>the<span class="_ _15"> </span>media<span class="_ _15"> </span>in-</div><div class="t m5 x1d h26 y2f4c ff7 fs19 fc1 sc0 ls0 ws0">structions<span class="_ _13"> </span>have<span class="_ _13"> </span>included<span class="_ _6"> </span>ones<span class="_ _13"> </span>to<span class="_ _13"> </span>operate<span class="_ _13"> </span>on<span class="_ _13"> </span><span class="ffa">scalar<span class="_ _13"> </span></span>ﬂoating-point<span class="_ _13"> </span>data,<span class="_ _13"> </span>using<span class="_ _13"> </span>single</div><div class="t m5 x1d h26 y2f4d ff7 fs19 fc1 sc0 ls0 ws0">values<span class="_ _13"> </span>in<span class="_"> </span>the<span class="_ _13"> </span>low-order<span class="_ _13"> </span>32<span class="_"> </span>or<span class="_ _13"> </span>64<span class="_ _13"> </span>bits<span class="_"> </span>of<span class="_ _13"> </span>XMM<span class="_ _13"> </span>or<span class="_"> </span>YMM<span class="_ _13"> </span>registers<span class="_ _1"></span>.<span class="_ _13"> </span>This<span class="_ _13"> </span>scalar<span class="_ _13"> </span>mode</div><div class="t m5 x1d h26 y2f4e ff7 fs19 fc1 sc0 ls0 ws0">provides<span class="_"> </span>a<span class="_"> </span>set<span class="_"> </span>of<span class="_"> </span>registers<span class="_"> </span>and<span class="_"> </span>instructions<span class="_"> </span>that<span class="_"> </span>are<span class="_"> </span>more<span class="_"> </span>typical<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>way<span class="_"> </span>other</div><div class="t m5 x1d h26 y2f4f ff7 fs19 fc1 sc0 ls0 ws0">processors<span class="_ _13"> </span>support<span class="_ _6"> </span>ﬂoating<span class="_ _13"> </span>point.<span class="_ _13"> </span>All<span class="_ _13"> </span>processors<span class="_ _6"> </span>capable<span class="_ _13"> </span>of<span class="_ _13"> </span>executing<span class="_ _13"> </span>x86-64<span class="_ _6"> </span>code</div><div class="t m5 x1d h26 y2f50 ff7 fs19 fc1 sc0 ls0 ws0">support<span class="_ _13"> </span>SSE2<span class="_"> </span>or<span class="_ _13"> </span>higher,<span class="_ _13"> </span>and<span class="_ _13"> </span>hence<span class="_"> </span>x86-64<span class="_ _13"> </span>ﬂoating<span class="_ _13"> </span>point<span class="_"> </span>is<span class="_ _13"> </span>based<span class="_"> </span>on<span class="_ _13"> </span>SSE<span class="_ _13"> </span>or<span class="_"> </span>A<span class="_ _4"></span>VX,</div><div class="t m5 x1d h26 y2f51 ff7 fs19 fc1 sc0 ls0 ws0">including<span class="_"> </span>conventions<span class="_"> </span>for<span class="_"> </span>passing<span class="_"> </span>procedure<span class="_"> </span>arguments<span class="_"> </span>and<span class="_"> </span>return<span class="_"> </span>values<span class="_"> </span>[77].</div><div class="t m5 x29 h26 y2f52 ff7 fs19 fc1 sc0 ls0 ws0">Our<span class="_"> </span>presentation<span class="_"> </span>is<span class="_"> </span>based<span class="_"> </span>on<span class="_"> </span>A<span class="_ _7"></span>VX2,<span class="_"> </span>the<span class="_"> </span>second<span class="_"> </span>version<span class="_ _11"> </span>of<span class="_"> </span>A<span class="_ _7"></span>VX,<span class="_"> </span>introduced</div><div class="t m5 x1d h26 y2f53 ff7 fs19 fc1 sc0 ls0 ws0">with<span class="_"> </span>the<span class="_ _11"> </span>Core<span class="_ _11"> </span>i7<span class="_"> </span>Haswell<span class="_ _11"> </span>processor<span class="_ _11"> </span>in<span class="_ _11"> </span>2013.<span class="_"> </span><span class="ff9">Gcc<span class="_ _11"> </span></span>will<span class="_ _11"> </span>generate<span class="_ _11"> </span>A<span class="_ _7"></span>VX2<span class="_"> </span>code<span class="_ _11"> </span>when</div><div class="t m5 x1d h26 y2f54 ff7 fs19 fc1 sc0 ls0 ws0">given<span class="_"> </span>the<span class="_ _13"> </span>command-line<span class="_"> </span>parameter<span class="_ _13"> </span><span class="ffd">-mavx2</span>.<span class="_"> </span>Code<span class="_ _13"> </span>based<span class="_"> </span>on<span class="_"> </span>the<span class="_ _13"> </span>different<span class="_"> </span>versions</div><div class="t m5 x1d h26 y2f55 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span>SSE,<span class="_"> </span>as<span class="_"> </span>well<span class="_"> </span>as<span class="_ _11"> </span>the<span class="_"> </span>ﬁrst<span class="_"> </span>version<span class="_"> </span>of<span class="_"> </span>A<span class="_ _7"></span>VX,<span class="_"> </span>is<span class="_"> </span>conceptually<span class="_ _11"> </span>similar,<span class="_"> </span>although<span class="_"> </span>they</div><div class="t m5 x1d h26 y2f56 ff7 fs19 fc1 sc0 ls0 ws0">differ<span class="_ _15"> </span>in<span class="_ _21"> </span>the<span class="_ _15"> </span>instruction<span class="_ _21"> </span>names<span class="_ _15"> </span>and<span class="_ _21"> </span>formats<span class="_ _1"></span>.<span class="_ _21"> </span>W<span class="_ _3"></span>e<span class="_ _21"> </span>present<span class="_ _15"> </span>only<span class="_ _21"> </span>instructions<span class="_ _15"> </span>that</div><div class="t m5 x1d h26 y2f57 ff7 fs19 fc1 sc0 ls0 ws0">arise<span class="_"> </span>in<span class="_"> </span>compiling<span class="_"> </span>ﬂoating-point<span class="_"> </span>programs<span class="_"> </span>with<span class="_"> </span><span class="ff9">gcc</span>.<span class="_ _13"> </span>These<span class="_"> </span>are<span class="_ _1"></span>,<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>most<span class="_"> </span>part,</div><div class="t m5 x1d h26 y2f58 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>scalar<span class="_"> </span>A<span class="_ _4"></span>VX<span class="_"> </span>instructions<span class="_ _1"></span>,<span class="_"> </span>although<span class="_"> </span>we<span class="_"> </span>document<span class="_ _13"> </span>occasions<span class="_"> </span>where<span class="_"> </span>instructions</div><div class="t m5 x1d h26 y2f59 ff7 fs19 fc1 sc0 ls0 ws0">intended<span class="_ _16"> </span>for<span class="_ _16"> </span>operating<span class="_ _14"> </span>on<span class="_ _16"> </span>entire<span class="_ _16"> </span>data<span class="_ _14"> </span>vectors<span class="_ _16"> </span>arise<span class="_ _0"></span>.<span class="_ _16"> </span>A<span class="_ _16"> </span>more<span class="_ _14"> </span>complete<span class="_ _16"> </span>coverage</div><div class="t m5 x1d h26 y2f5a ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_ _14"> </span>how<span class="_ _14"> </span>to<span class="_ _14"> </span>exploit<span class="_ _14"> </span>the<span class="_ _14"> </span>SIMD<span class="_ _14"> </span>capabilities<span class="_ _14"> </span>of<span class="_ _14"> </span>SSE<span class="_ _14"> </span>and<span class="_ _14"> </span>A<span class="_ _7"></span>VX<span class="_ _16"> </span>is<span class="_ _14"> </span>presented<span class="_ _14"> </span>in<span class="_ _14"> </span>W<span class="_ _1"></span>eb</div><div class="t m5 x1d h26 y2f5b ff7 fs19 fc1 sc0 ls0 ws0">Aside<span class="_ _16"> </span><span class="ff9">opt:simd<span class="_ _14"> </span></span>on<span class="_ _14"> </span>page<span class="_ _16"> </span>582.<span class="_ _14"> </span>Readers<span class="_ _16"> </span>may<span class="_ _14"> </span>wish<span class="_ _14"> </span>to<span class="_ _16"> </span>refer<span class="_ _14"> </span>to<span class="_ _14"> </span>the<span class="_ _16"> </span>AMD<span class="_ _14"> </span>and<span class="_ _14"> </span>Intel</div><div class="t m5 x1d h26 y2f5c ff7 fs19 fc1 sc0 ls0 ws0">documentation<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>individual<span class="_"> </span>instructions<span class="_"> </span>[4,<span class="_"> </span>51].<span class="_ _11"> </span>As<span class="_"> </span>with<span class="_"> </span>integer<span class="_"> </span>operations<span class="_ _1"></span>,</div><div class="t m5 x1d h26 y2f5d ff7 fs19 fc1 sc0 ls0 ws0">note<span class="_ _13"> </span>that<span class="_"> </span>the<span class="_ _13"> </span>A<span class="_ _3"></span>TT<span class="_ _13"> </span>format<span class="_"> </span>we<span class="_ _13"> </span>use<span class="_ _13"> </span>in<span class="_ _13"> </span>our<span class="_"> </span>presentation<span class="_ _13"> </span>differs<span class="_ _13"> </span>from<span class="_ _13"> </span>the<span class="_"> </span>Intel<span class="_ _13"> </span>format</div><div class="t m5 x1d h26 y2f5e ff7 fs19 fc1 sc0 ls0 ws0">used<span class="_ _14"> </span>in<span class="_ _14"> </span>these<span class="_ _14"> </span>documents<span class="_ _1"></span>.<span class="_ _15"> </span>In<span class="_ _14"> </span>particular,<span class="_ _14"> </span>the<span class="_ _15"> </span>instruction<span class="_ _14"> </span>operands<span class="_ _14"> </span>are<span class="_ _14"> </span>listed<span class="_ _15"> </span>in<span class="_ _14"> </span>a</div><div class="t m5 x1d h26 y2f5f ff7 fs19 fc1 sc0 ls0 ws0">different<span class="_"> </span>order<span class="_"> </span>in<span class="_"> </span>these<span class="_"> </span>two<span class="_"> </span>versions<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
