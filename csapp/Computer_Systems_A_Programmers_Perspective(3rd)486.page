<div id="pf1e6" class="pf w2 h11" data-page-no="1e6"><div class="pc pc1e6 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1e6.png"/><div class="t m5 x13d h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>4.5<span class="_ _60"> </span>Pipelined<span class="_ _10"> </span>Y86-64<span class="_ _10"> </span>Implementations<span class="_ _3e"> </span><span class="ffe fs1e">485</span></div><div class="t m5 x26 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _14"> </span>PC<span class="_ _14"> </span>prediction<span class="_ _16"> </span>logic<span class="_ _14"> </span>chooses<span class="_ _16"> </span><span class="ff6">valC<span class="_ _14"> </span></span>for<span class="_ _14"> </span>the<span class="_ _16"> </span>fetched<span class="_ _14"> </span>instruction<span class="_ _14"> </span>when<span class="_ _16"> </span>it<span class="_ _14"> </span>is</div><div class="t m5 x17 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">either<span class="_"> </span>a<span class="_"> </span>call<span class="_"> </span>or<span class="_"> </span>a<span class="_"> </span>jump<span class="_ _1"></span>,<span class="_"> </span>and<span class="_"> </span><span class="ff6">valP<span class="_ _10"> </span></span>otherwise:</div><div class="t m5 x17 h2d y43b3 ffd fs1e fc2 sc0 ls0 ws0">word<span class="_ _e"> </span>f_predPC<span class="_ _1f"> </span>=<span class="_ _1f"> </span>[</div><div class="t m5 x21e h2d y43b4 ffd fs1e fc2 sc0 ls0 ws0">f_icode<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _1f"> </span>IJXX,<span class="_ _e"> </span>ICALL<span class="_ _1f"> </span>}<span class="_ _e"> </span>:<span class="_ _1f"> </span>f_valC;</div><div class="t m5 x21e h2d y43b5 ffd fs1e fc2 sc0 ls0 ws0">1<span class="_ _e"> </span>:<span class="_ _1f"> </span>f_valP;</div><div class="t m5 x17 h2d y43b6 ffd fs1e fc2 sc0 ls0 ws0">];</div><div class="t m5 x26 h26 y43b7 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _16"> </span>logic<span class="_ _16"> </span>blocks<span class="_ _14"> </span>labeled<span class="_ _16"> </span>“Instr<span class="_ _16"> </span>valid,<span class="_ _1"></span>”<span class="_ _14"> </span>“Need<span class="_ _16"> </span>regids<span class="_ _1"></span>,<span class="_ _1"></span>”<span class="_ _14"> </span>and<span class="_ _16"> </span>“Need<span class="_ _16"> </span>valC”<span class="_ _16"> </span>are</div><div class="t m5 x17 h26 y43b8 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>same<span class="_"> </span>as<span class="_"> </span>for<span class="_"> </span>SEQ,<span class="_"> </span>with<span class="_"> </span>appropriately<span class="_"> </span>named<span class="_"> </span>source<span class="_"> </span>signals<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y43b9 ff7 fs19 fc2 sc0 ls0 ws0">Unlike<span class="_ _11"> </span>in<span class="_ _16"> </span>SEQ,<span class="_ _16"> </span>we<span class="_ _11"> </span>must<span class="_ _16"> </span>split<span class="_ _11"> </span>the<span class="_ _16"> </span>computation<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>instruction<span class="_ _11"> </span>status<span class="_ _16"> </span>into</div><div class="t m5 x17 h26 y43ba ff7 fs19 fc2 sc0 ls0 ws0">two<span class="_ _13"> </span>parts<span class="_ _3"></span>.<span class="_ _13"> </span>In<span class="_ _13"> </span>the<span class="_ _13"> </span>fetch<span class="_ _6"> </span>stage,<span class="_ _13"> </span>we<span class="_ _6"> </span>can<span class="_ _13"> </span>test<span class="_ _13"> </span>for<span class="_ _6"> </span>a<span class="_ _13"> </span>memory<span class="_ _13"> </span>error<span class="_ _13"> </span>due<span class="_ _6"> </span>to<span class="_ _13"> </span>an<span class="_ _13"> </span>out-of-range</div><div class="t m5 x17 h26 y43bb ff7 fs19 fc2 sc0 ls0 ws0">instruction<span class="_"> </span>address<span class="_ _3"></span>,<span class="_"> </span>and<span class="_"> </span>we<span class="_"> </span>can<span class="_ _13"> </span>detect<span class="_"> </span>an<span class="_"> </span>illegal<span class="_"> </span>instruction<span class="_"> </span>or<span class="_ _13"> </span>a<span class="_"> </span><span class="ffd">halt<span class="_ _10"> </span></span>instruction.</div><div class="t m5 x17 h26 y43bc ff7 fs19 fc2 sc0 ls0 ws0">Detecting<span class="_"> </span>an<span class="_"> </span>invalid<span class="_"> </span>data<span class="_"> </span>address<span class="_"> </span>must<span class="_"> </span>be<span class="_"> </span>deferred<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>memory<span class="_"> </span>stage<span class="_ _1"></span>.</div><div class="t m5 x17 h47 yead ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>4.30<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>526)</span></div><div class="t m5 x17 h26 y417 ff7 fs19 fc1 sc0 ls0 ws0">Write<span class="_ _15"> </span>HCL<span class="_ _15"> </span>code<span class="_ _21"> </span>for<span class="_ _15"> </span>the<span class="_ _21"> </span>signal<span class="_ _15"> </span><span class="ff6">f_stat</span>,<span class="_ _f"> </span>providing<span class="_ _21"> </span>the<span class="_ _15"> </span>provisional<span class="_ _15"> </span>status<span class="_ _21"> </span>for<span class="_ _15"> </span>the</div><div class="t m5 x17 h26 y43bd ff7 fs19 fc1 sc0 ls0 ws0">fetched<span class="_"> </span>instruction.</div><div class="t m5 x17 h42 y43be ff6 fs29 fc6 sc0 ls0 ws0">Decode<span class="_ _11"> </span>and<span class="_ _16"> </span>Write-Back<span class="_ _11"> </span>Stages</div><div class="t m5 x17 h26 y43bf ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_"> </span>4.58<span class="_ _13"> </span>gives<span class="_ _13"> </span>a<span class="_ _13"> </span>detailed<span class="_ _13"> </span>view<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>decode<span class="_ _13"> </span>and<span class="_ _13"> </span>write-back<span class="_"> </span>logic<span class="_ _13"> </span>for<span class="_ _13"> </span>PIPE.<span class="_ _13"> </span>T<span class="_ _1"></span>he</div><div class="t m5 x17 h26 y43c0 ff7 fs19 fc1 sc0 ls0 ws0">blocks<span class="_ _16"> </span>labeled<span class="_ _14"> </span><span class="ff6">dstE</span>,<span class="_ _15"> </span><span class="ff6">dstM</span>,<span class="_ _15"> </span><span class="ff6">srcA</span>,<span class="_ _14"> </span>and<span class="_ _16"> </span><span class="ff6">srcB<span class="_ _14"> </span></span>are<span class="_ _14"> </span>very<span class="_ _16"> </span>similar<span class="_ _14"> </span>to<span class="_ _14"> </span>their<span class="_ _14"> </span>counterparts</div><div class="t m5 x17 h26 y43c1 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_ _21"> </span>the<span class="_ _21"> </span>implementation<span class="_ _21"> </span>of<span class="_ _21"> </span>SEQ.<span class="_ _21"> </span>Observe<span class="_ _21"> </span>that<span class="_ _21"> </span>the<span class="_ _21"> </span>register<span class="_ _21"> </span>IDs<span class="_ _21"> </span>supplied<span class="_ _21"> </span>to<span class="_ _f"> </span>the</div><div class="t m5 x17 h26 y43c2 ff7 fs19 fc1 sc0 ls0 ws0">write<span class="_"> </span>ports<span class="_ _13"> </span>come<span class="_"> </span>from<span class="_"> </span>the<span class="_ _13"> </span>write-back<span class="_"> </span>stage<span class="_ _13"> </span>(signals<span class="_"> </span><span class="ff6">W_dstE<span class="_ _10"> </span></span>and<span class="_"> </span><span class="ff6">W_dstM</span>),<span class="_ _13"> </span>rather</div><div class="t m5 x17 h26 y43c3 ff7 fs19 fc1 sc0 ls0 ws0">than<span class="_ _16"> </span>from<span class="_ _14"> </span>the<span class="_ _16"> </span>decode<span class="_ _14"> </span>stage<span class="_ _1"></span>.<span class="_ _14"> </span>T<span class="_ _1"></span>his<span class="_ _14"> </span>is<span class="_ _16"> </span>because<span class="_ _14"> </span>we<span class="_ _16"> </span>want<span class="_ _14"> </span>the<span class="_ _16"> </span>writes<span class="_ _14"> </span>to<span class="_ _16"> </span>occur<span class="_ _14"> </span>to<span class="_ _16"> </span>the</div><div class="t m5 x17 h26 y43c4 ff7 fs19 fc1 sc0 ls0 ws0">destination<span class="_"> </span>registers<span class="_"> </span>speciﬁed<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span>instruction<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>write-back<span class="_"> </span>stage<span class="_ _1"></span>.</div><div class="t m5 x17 h47 y43c5 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>4.31<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>526)</span></div><div class="t m5 x17 h26 y43c6 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>block<span class="_ _11"> </span>labeled<span class="_"> </span>“dstE”<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>decode<span class="_"> </span>stage<span class="_"> </span>generates<span class="_ _11"> </span>the<span class="_"> </span>register<span class="_"> </span>ID<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>E</div><div class="t m5 x17 h26 y43c7 ff7 fs19 fc1 sc0 ls0 ws0">port<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _14"> </span>register<span class="_ _16"> </span>ﬁle<span class="_ _0"></span>,<span class="_ _14"> </span>based<span class="_ _16"> </span>on<span class="_ _16"> </span>ﬁelds<span class="_ _14"> </span>from<span class="_ _16"> </span>the<span class="_ _16"> </span>fetched<span class="_ _14"> </span>instruction<span class="_ _16"> </span>in<span class="_ _16"> </span>pipeline</div><div class="t m5 x17 h26 y43c8 ff7 fs19 fc1 sc0 ls0 ws0">register<span class="_"> </span>D<span class="_ _3"></span>.<span class="_"> </span>The<span class="_"> </span>resulting<span class="_"> </span>signal<span class="_"> </span>is<span class="_"> </span>named<span class="_"> </span><span class="ff6">d_dstE<span class="_ _10"> </span></span>in<span class="_"> </span>the<span class="_"> </span>HCL<span class="_"> </span>description<span class="_"> </span>of<span class="_"> </span>PIPE.</div><div class="t m5 x17 h26 y43c9 ff7 fs19 fc1 sc0 ls0 ws0">Write<span class="_"> </span>HCL<span class="_"> </span>code<span class="_"> </span>for<span class="_"> </span>this<span class="_"> </span>signal,<span class="_"> </span>based<span class="_"> </span>on<span class="_"> </span>the<span class="_"> </span>HCL<span class="_"> </span>description<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>SEQ<span class="_"> </span>signal</div><div class="t m5 x17 h26 y43ca ff6 fs19 fc1 sc0 ls0 ws0">dstE<span class="ff7">.<span class="_ _16"> </span>(See<span class="_ _16"> </span>the<span class="_ _16"> </span>decode<span class="_ _14"> </span>stage<span class="_ _16"> </span>for<span class="_ _16"> </span>SEQ<span class="_ _16"> </span>in<span class="_ _14"> </span>Section<span class="_ _16"> </span>4.3.4.)<span class="_ _16"> </span>Do<span class="_ _16"> </span>not<span class="_ _16"> </span>concern<span class="_ _14"> </span>yourself</span></div><div class="t m5 x17 h26 y43cb ff7 fs19 fc1 sc0 ls0 ws0">with<span class="_"> </span>the<span class="_"> </span>logic<span class="_"> </span>to<span class="_"> </span>implement<span class="_"> </span>conditional<span class="_"> </span>moves<span class="_"> </span>yet.</div><div class="t m5 x26 h26 yc21 ff7 fs19 fc1 sc0 ls0 ws0">Most<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>complexity<span class="_ _11"> </span>of<span class="_ _16"> </span>this<span class="_ _16"> </span>stage<span class="_ _11"> </span>is<span class="_ _16"> </span>associated<span class="_ _11"> </span>with<span class="_ _16"> </span>the<span class="_ _16"> </span>forwarding<span class="_ _11"> </span>logic.</div><div class="t m5 x17 h26 yc22 ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_"> </span>mentioned<span class="_"> </span>earlier<span class="_ _0"></span>,<span class="_"> </span>the<span class="_"> </span>block<span class="_"> </span>labeled<span class="_"> </span>“Sel+Fwd<span class="_ _13"> </span>A<span class="_ _3"></span>”<span class="_"> </span>serves<span class="_"> </span>two<span class="_"> </span>roles<span class="_ _3"></span>.<span class="_"> </span>It<span class="_"> </span>merges</div><div class="t m5 x17 h26 yc23 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span><span class="ff6">valP<span class="_ _11"> </span></span>signal<span class="_ _11"> </span>into<span class="_"> </span>the<span class="_ _11"> </span><span class="ff6">valA<span class="_ _11"> </span></span>signal<span class="_"> </span>for<span class="_ _11"> </span>later<span class="_ _11"> </span>stages<span class="_"> </span>in<span class="_ _11"> </span>order<span class="_ _11"> </span>to<span class="_"> </span>reduce<span class="_ _11"> </span>the<span class="_ _11"> </span>amount</div><div class="t m5 x17 h26 yc24 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_ _13"> </span>state<span class="_"> </span>in<span class="_ _13"> </span>the<span class="_ _13"> </span>pipeline<span class="_ _13"> </span>register.<span class="_ _13"> </span>It<span class="_"> </span>also<span class="_ _13"> </span>implements<span class="_ _13"> </span>the<span class="_ _13"> </span>forwarding<span class="_"> </span>logic<span class="_ _13"> </span>for<span class="_ _13"> </span>source</div><div class="t m5 x17 h26 yc25 ff7 fs19 fc1 sc0 ls0 ws0">operand<span class="_"> </span><span class="ff6">valA</span>.</div><div class="t m5 x26 h26 yc26 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _11"> </span>merging<span class="_"> </span>of<span class="_ _11"> </span>signals<span class="_"> </span><span class="ff6">valA<span class="_ _11"> </span></span>and<span class="_"> </span><span class="ff6">valP<span class="_ _11"> </span></span>exploits<span class="_"> </span>the<span class="_"> </span>fact<span class="_ _11"> </span>that<span class="_"> </span>only<span class="_ _11"> </span>the<span class="_"> </span><span class="ffd">call<span class="_ _11"> </span></span>and</div><div class="t m5 x17 h26 y14b5 ff7 fs19 fc1 sc0 ls0 ws0">jump<span class="_ _14"> </span>instructions<span class="_ _15"> </span>need<span class="_ _15"> </span>the<span class="_ _15"> </span>value<span class="_ _15"> </span>of<span class="_ _14"> </span><span class="ff6">valP<span class="_ _15"> </span></span>in<span class="_ _15"> </span>later<span class="_ _15"> </span>stages<span class="_ _1"></span>,<span class="_ _21"> </span>and<span class="_ _14"> </span>these<span class="_ _15"> </span>instructions</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
