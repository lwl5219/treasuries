<div id="pf311" class="pf w2 h11" data-page-no="311"><div class="pc pc311 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg311.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">784<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>8<span class="_ _3d"> </span>Exceptional<span class="_ _10"> </span>Control<span class="_ _10"> </span>Flow</span></div><div class="t m5 x1d h2d ye7 ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">./waitpid1</span></div><div class="t m5 x1d h2d y2682 ffd fs1e fc2 sc0 ls0 ws0">child<span class="_ _e"> </span>22966<span class="_ _1f"> </span>terminated<span class="_ _1f"> </span>normally<span class="_ _e"> </span>with<span class="_ _1f"> </span>exit<span class="_ _e"> </span>status=100</div><div class="t m5 x1d h2d y2683 ffd fs1e fc2 sc0 ls0 ws0">child<span class="_ _e"> </span>22967<span class="_ _1f"> </span>terminated<span class="_ _1f"> </span>normally<span class="_ _e"> </span>with<span class="_ _1f"> </span>exit<span class="_ _e"> </span>status=101</div><div class="t m5 x1d h26 y66b9 ff7 fs19 fc2 sc0 ls0 ws0">Notice<span class="_ _11"> </span>that<span class="_ _11"> </span>the<span class="_ _11"> </span>program<span class="_ _11"> </span>reaps<span class="_ _11"> </span>its<span class="_ _11"> </span>children<span class="_ _11"> </span>in<span class="_ _11"> </span>no<span class="_ _11"> </span>particular<span class="_ _11"> </span>order.<span class="_"> </span>The<span class="_"> </span>order<span class="_ _11"> </span>that</div><div class="t m5 x1d h26 y66ba ff7 fs19 fc2 sc0 ls0 ws0">they<span class="_ _f"> </span>were<span class="_ _f"> </span>reaped<span class="_ _f"> </span>is<span class="_ _f"> </span>a<span class="_ _f"> </span>property<span class="_ _f"> </span>of<span class="_ _f"> </span>this<span class="_ _f"> </span>speciﬁc<span class="_ _f"> </span>computer<span class="_ _f"> </span>system.<span class="_ _f"> </span>On<span class="_ _f"> </span>another</div><div class="t m5 x1d h26 y66bb ff7 fs19 fc2 sc0 ls0 ws0">system,<span class="_ _14"> </span>or<span class="_ _16"> </span>even<span class="_ _14"> </span>another<span class="_ _16"> </span>execution<span class="_ _14"> </span>on<span class="_ _14"> </span>the<span class="_ _16"> </span>same<span class="_ _14"> </span>system,<span class="_ _14"> </span>the<span class="_ _16"> </span>two<span class="_ _14"> </span>children<span class="_ _16"> </span>might</div><div class="t m5 x1d h26 y66bc ff7 fs19 fc2 sc0 ls0 ws0">have<span class="_ _13"> </span>been<span class="_ _6"> </span>reaped<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_ _13"> </span>opposite<span class="_ _6"> </span>order.<span class="_ _13"> </span>T<span class="_ _1"></span>his<span class="_ _13"> </span>is<span class="_ _13"> </span>an<span class="_ _6"> </span>example<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ffa">nondeterministic</span></div><div class="t m5 x1d h26 y66bd ff7 fs19 fc2 sc0 ls0 ws0">behavior<span class="_ _13"> </span>that<span class="_ _6"> </span>can<span class="_ _13"> </span>make<span class="_ _6"> </span>reasoning<span class="_ _13"> </span>about<span class="_ _6"> </span>concurrency<span class="_ _6"> </span>so<span class="_ _13"> </span>difﬁcult.<span class="_ _6"> </span>Either<span class="_ _13"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>two</div><div class="t m5 x1d h26 y66be ff7 fs19 fc2 sc0 ls0 ws0">possible<span class="_ _13"> </span>outcomes<span class="_"> </span>is<span class="_ _13"> </span>equally<span class="_ _13"> </span>correct,<span class="_ _13"> </span>and<span class="_"> </span>as<span class="_ _13"> </span>a<span class="_ _13"> </span>programmer<span class="_ _13"> </span>you<span class="_"> </span>may<span class="_ _13"> </span><span class="ffa">never<span class="_"> </span></span>assume</div><div class="t m5 x1d h26 y66bf ff7 fs19 fc2 sc0 ls0 ws0">that<span class="_ _16"> </span>one<span class="_ _16"> </span>outcome<span class="_ _16"> </span>will<span class="_ _16"> </span>always<span class="_ _16"> </span>occur,<span class="_ _16"> </span>no<span class="_ _16"> </span>matter<span class="_ _16"> </span>how<span class="_ _16"> </span>unlikely<span class="_ _16"> </span>the<span class="_ _16"> </span>other<span class="_ _11"> </span>outcome</div><div class="t m5 x1d h26 y66c0 ff7 fs19 fc2 sc0 ls0 ws0">appears<span class="_ _6"> </span>to<span class="_ _13"> </span>be<span class="_ _1"></span>.<span class="_ _6"> </span>The<span class="_ _a"> </span>only<span class="_ _13"> </span>correct<span class="_ _6"> </span>assumption<span class="_ _6"> </span>is<span class="_ _13"> </span>that<span class="_ _6"> </span>each<span class="_ _6"> </span>possible<span class="_ _13"> </span>outcome<span class="_ _6"> </span>is<span class="_ _6"> </span>equally</div><div class="t m5 x1d h26 y66c1 ff7 fs19 fc2 sc0 ls0 ws0">likely<span class="_ _3"></span>.</div><div class="t m5 x29 h26 y66c2 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_"> </span>8.19<span class="_ _13"> </span>shows<span class="_ _13"> </span>a<span class="_"> </span>simple<span class="_ _13"> </span>change<span class="_ _13"> </span>that<span class="_"> </span>eliminates<span class="_ _13"> </span>this<span class="_ _13"> </span>nondeterminism<span class="_"> </span>in<span class="_ _13"> </span>the</div><div class="t m5 x1d h26 y66c3 ff7 fs19 fc2 sc0 ls0 ws0">output<span class="_"> </span>order<span class="_"> </span>by<span class="_"> </span>reaping<span class="_ _13"> </span>the<span class="_"> </span>children<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>same<span class="_"> </span>order<span class="_"> </span>that<span class="_ _13"> </span>they<span class="_"> </span>were<span class="_"> </span>created<span class="_"> </span>by</div><div class="t m5 x1d h26 y66c4 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>parent.<span class="_"> </span>In<span class="_"> </span>line<span class="_"> </span>11,<span class="_ _13"> </span>the<span class="_"> </span>parent<span class="_"> </span>stores<span class="_"> </span>the<span class="_"> </span>PIDs<span class="_"> </span>of<span class="_"> </span>its<span class="_"> </span>children<span class="_ _13"> </span>in<span class="_"> </span>order<span class="_"> </span>and<span class="_"> </span>then</div><div class="t m5 x1d h26 y66c5 ff7 fs19 fc2 sc0 ls0 ws0">waits<span class="_ _16"> </span>for<span class="_ _16"> </span>each<span class="_ _14"> </span>child<span class="_ _16"> </span>in<span class="_ _16"> </span>this<span class="_ _14"> </span>same<span class="_ _16"> </span>order<span class="_ _16"> </span>by<span class="_ _14"> </span>calling<span class="_ _16"> </span><span class="ffd">waitpid<span class="_ _16"> </span></span>with<span class="_ _14"> </span>the<span class="_ _16"> </span>appropriate</div><div class="t m5 x1d h26 y66c6 ff7 fs19 fc2 sc0 ls0 ws0">PID<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>ﬁrst<span class="_"> </span>argument.</div><div class="t m5 x1d h47 y66c7 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>8.4<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>833)</span></div><div class="t m5 x1d h26 y66c8 ff7 fs19 fc1 sc0 ls0 ws0">Consider<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>program:</div><div class="t m5 x18c h2c y66c9 ffa fs16 fc1 sc0 ls0 ws0">code/ecf/global-waitprob1.c</div><div class="t m5 x1f h2d y66ca ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">int<span class="_ _1f"> </span>main()</span></div><div class="t m5 x1f h2d y66cb ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x1f h2d y66cc ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2">int<span class="_ _e"> </span>status;</span></div><div class="t m5 x1f h2d y66cd ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2">pid_t<span class="_ _e"> </span>pid;</span></div><div class="t m5 x1f h2e y66ce ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x1f h2e y66cf ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 x33 h2d y66d0 ffd fs1e fc2 sc0 ls0 ws0">printf(&quot;Start\n&quot;);</div><div class="t m5 x1f h2d y66d1 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _20"> </span><span class="ffd fs1e fc2">pid<span class="_ _e"> </span>=<span class="_ _1f"> </span>Fork();</span></div><div class="t m5 x1f h2d y66d2 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _20"> </span><span class="ffd fs1e fc2">printf(&quot;%d\n&quot;,<span class="_ _e"> </span>!pid);</span></div><div class="t m5 x1f h2d y66d3 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _20"> </span><span class="ffd fs1e fc2">if<span class="_ _e"> </span>(pid<span class="_ _1f"> </span>==<span class="_ _1f"> </span>0)<span class="_ _e"> </span>{</span></div><div class="t m5 x1b0 h2e y66d4 ff6 fs20 fc6 sc0 ls0 ws0">10</div><div class="t m5 xf7 h2d y66d5 ffd fs1e fc2 sc0 ls0 ws0">printf(&quot;Child\n&quot;);</div><div class="t m5 x1b0 h2d y66d6 ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1b0 h2d y66d7 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _20"> </span><span class="ffd fs1e fc2">else<span class="_ _e"> </span>if<span class="_ _1f"> </span>((waitpid(-1,<span class="_ _1f"> </span>&amp;status,<span class="_ _e"> </span>0)<span class="_ _1f"> </span>&gt;<span class="_ _e"> </span>0)<span class="_ _1f"> </span>&amp;&amp;</span></div><div class="t m5 x117 h2d y66d8 ffd fs1e fc2 sc0 ls0 ws0">(WIFEXITED(status)<span class="_ _e"> </span>!=<span class="_ _1f"> </span>0))<span class="_ _1f"> </span>{</div><div class="t m5 x1b0 h2d y66d9 ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _70"> </span><span class="ffd fs1e fc2">printf(&quot;%d\n&quot;,<span class="_ _e"> </span>WEXITSTATUS(status));</span></div><div class="t m5 x1b0 h2d y66da ff6 fs20 fc6 sc0 ls0 ws0">14<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1b0 h2d y66db ff6 fs20 fc6 sc0 ls0 ws0">15<span class="_ _20"> </span><span class="ffd fs1e fc2">printf(&quot;Stop\n&quot;);</span></div><div class="t m5 x1b0 h2e y66dc ff6 fs20 fc6 sc0 ls0 ws0">16</div><div class="t m5 x33 h2d y66dd ffd fs1e fc2 sc0 ls0 ws0">exit(2);</div><div class="t m5 x1b0 h2d y66de ff6 fs20 fc6 sc0 ls0 ws0">17<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x18c h2c y66df ffa fs16 fc2 sc0 ls0 ws0">code/ecf/global-waitprob1.c</div><div class="t m5 x124 h26 y7a6 ff7 fs19 fc2 sc0 ls0 ws0">A.<span class="_ _1f"> </span>How<span class="_"> </span>many<span class="_"> </span>output<span class="_"> </span>lines<span class="_"> </span>does<span class="_"> </span>this<span class="_"> </span>program<span class="_"> </span>generate?</div><div class="t m5 x124 h26 y66e0 ff7 fs19 fc2 sc0 ls0 ws0">B<span class="_ _3"></span>.<span class="_ _1d"> </span>What<span class="_"> </span>is<span class="_"> </span>one<span class="_"> </span>possible<span class="_"> </span>ordering<span class="_"> </span>of<span class="_"> </span>these<span class="_"> </span>output<span class="_"> </span>lines?</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
