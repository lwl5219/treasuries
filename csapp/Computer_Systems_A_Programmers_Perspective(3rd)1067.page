<div id="pf42b" class="pf w2 h11" data-page-no="42b"><div class="pc pc42b w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg42b.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">1066<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>12<span class="_ _3d"> </span>Concurrent<span class="_ _10"> </span>Programming</span></div><div class="t m5 x124 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">C.<span class="_ _25"> </span>If<span class="_"> </span>so,<span class="_"> </span>what<span class="_"> </span>simple<span class="_ _11"> </span>change<span class="_ _11"> </span>to<span class="_ _11"> </span>the<span class="_"> </span>initial<span class="_ _11"> </span>semaphore<span class="_ _11"> </span>values<span class="_ _11"> </span>will<span class="_"> </span>eliminate<span class="_ _11"> </span>the</div><div class="t m5 x4f h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">potential<span class="_"> </span>for<span class="_"> </span>deadlock?</div><div class="t m5 x124 h26 y1acd ff7 fs19 fc2 sc0 ls0 ws0">D<span class="_ _3"></span>.<span class="_ _23"> </span>Draw<span class="_"> </span>the<span class="_"> </span>progress<span class="_"> </span>graph<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>resulting<span class="_"> </span>deadlock-free<span class="_"> </span>program.</div><div class="t m5 x1d h3b y8499 fff fs24 fc6 sc0 ls0 ws0">12.8<span class="_ _17"> </span><span class="ffe fs18">Summar<span class="_ _2"></span>y</span></div><div class="t m5 x1d h26 y849a ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_ _13"> </span>concurrent<span class="_ _13"> </span>program<span class="_ _13"> </span>consists<span class="_ _13"> </span>of<span class="_ _13"> </span>a<span class="_ _13"> </span>collection<span class="_ _13"> </span>of<span class="_ _13"> </span>logical<span class="_ _13"> </span>ﬂows<span class="_ _13"> </span>that<span class="_ _13"> </span>overlap<span class="_ _13"> </span>in<span class="_"> </span>time<span class="_ _1"></span>.</div><div class="t m5 x1d h26 y849b ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_"> </span>this<span class="_ _11"> </span>chapter,<span class="_"> </span>we<span class="_ _11"> </span>have<span class="_"> </span>studied<span class="_ _11"> </span>three<span class="_ _11"> </span>different<span class="_"> </span>mechanisms<span class="_ _11"> </span>for<span class="_ _11"> </span>building<span class="_ _11"> </span>concur<span class="_ _1"></span>-</div><div class="t m5 x1d h26 y849c ff7 fs19 fc1 sc0 ls0 ws0">rent<span class="_ _14"> </span>programs:<span class="_ _14"> </span>processes<span class="_ _1"></span>,<span class="_ _15"> </span>I/O<span class="_ _14"> </span>multiplexing,<span class="_ _14"> </span>and<span class="_ _14"> </span>threads<span class="_ _1"></span>.<span class="_ _14"> </span>W<span class="_ _3"></span>e<span class="_ _14"> </span>used<span class="_ _14"> </span>a<span class="_ _14"> </span>concurrent</div><div class="t m5 x1d h26 y849d ff7 fs19 fc1 sc0 ls0 ws0">network<span class="_"> </span>server<span class="_"> </span>as<span class="_"> </span>the<span class="_"> </span>motivating<span class="_"> </span>application<span class="_"> </span>throughout.</div><div class="t m5 x29 h26 y849e ff7 fs19 fc1 sc0 ls0 ws0">Processes<span class="_ _15"> </span>are<span class="_ _14"> </span>scheduled<span class="_ _15"> </span>automatically<span class="_ _15"> </span>by<span class="_ _15"> </span>the<span class="_ _15"> </span>kernel,<span class="_ _21"> </span>and<span class="_ _15"> </span>because<span class="_ _15"> </span>of<span class="_ _15"> </span>their</div><div class="t m5 x1d h26 y849f ff7 fs19 fc1 sc0 ls0 ws0">separate<span class="_ _14"> </span>virtual<span class="_ _14"> </span>address<span class="_ _15"> </span>spaces<span class="_ _1"></span>,<span class="_ _15"> </span>they<span class="_ _15"> </span>require<span class="_ _14"> </span>explicit<span class="_ _15"> </span>IPC<span class="_ _14"> </span>mechanisms<span class="_ _14"> </span>in<span class="_ _15"> </span>order</div><div class="t m5 x1d h26 y84a0 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _16"> </span>share<span class="_ _11"> </span>data.<span class="_ _16"> </span>Event-driven<span class="_ _16"> </span>programs<span class="_ _16"> </span>create<span class="_ _16"> </span>their<span class="_ _11"> </span>own<span class="_ _16"> </span>concurrent<span class="_ _16"> </span>logical<span class="_ _16"> </span>ﬂows<span class="_ _1"></span>,</div><div class="t m5 x1d h26 y84a1 ff7 fs19 fc1 sc0 ls0 ws0">which<span class="_ _13"> </span>are<span class="_ _13"> </span>modeled<span class="_ _6"> </span>as<span class="_ _13"> </span>state<span class="_ _13"> </span>machines<span class="_ _3"></span>,<span class="_ _13"> </span>and<span class="_ _13"> </span>use<span class="_ _13"> </span>I/O<span class="_ _13"> </span>multiplexing<span class="_ _6"> </span>to<span class="_ _13"> </span>explicitly<span class="_ _13"> </span>sched-</div><div class="t m5 x1d h26 y84a2 ff7 fs19 fc1 sc0 ls0 ws0">ule<span class="_"> </span>the<span class="_ _13"> </span>ﬂows<span class="_ _1"></span>.<span class="_"> </span>Because<span class="_"> </span>the<span class="_"> </span>program<span class="_ _13"> </span>runs<span class="_"> </span>in<span class="_"> </span>a<span class="_"> </span>single<span class="_ _13"> </span>process<span class="_ _1"></span>,<span class="_"> </span>sharing<span class="_"> </span>data<span class="_"> </span>between</div><div class="t m5 x1d h26 y84a3 ff7 fs19 fc1 sc0 ls0 ws0">ﬂows<span class="_"> </span>is<span class="_"> </span>fast<span class="_"> </span>and<span class="_"> </span>easy<span class="_ _7"></span>.<span class="_"> </span>T<span class="_ _1"></span>hreads<span class="_"> </span>are<span class="_"> </span>a<span class="_"> </span>hybrid<span class="_"> </span>of<span class="_"> </span>these<span class="_"> </span>approaches<span class="_ _3"></span>.<span class="_"> </span>Like<span class="_"> </span>ﬂows<span class="_"> </span>based</div><div class="t m5 x1d h26 y84a4 ff7 fs19 fc1 sc0 ls0 ws0">on<span class="_ _13"> </span>processes<span class="_ _1"></span>,<span class="_"> </span>threads<span class="_ _13"> </span>are<span class="_ _13"> </span>scheduled<span class="_"> </span>automatically<span class="_ _13"> </span>by<span class="_ _13"> </span>the<span class="_ _13"> </span>kernel.<span class="_"> </span>Like<span class="_ _13"> </span>ﬂows<span class="_ _13"> </span>based</div><div class="t m5 x1d h26 y84a5 ff7 fs19 fc1 sc0 ls0 ws0">on<span class="_ _11"> </span>I/O<span class="_ _16"> </span>multiplexing<span class="_ _0"></span>,<span class="_ _11"> </span>threads<span class="_ _16"> </span>run<span class="_ _11"> </span>in<span class="_ _16"> </span>the<span class="_ _11"> </span>context<span class="_ _11"> </span>of<span class="_ _16"> </span>a<span class="_ _11"> </span>single<span class="_ _11"> </span>process<span class="_ _1"></span>,<span class="_ _16"> </span>and<span class="_ _11"> </span>thus<span class="_ _16"> </span>can</div><div class="t m5 x1d h26 y84a6 ff7 fs19 fc1 sc0 ls0 ws0">share<span class="_"> </span>data<span class="_"> </span>quickly<span class="_"> </span>and<span class="_"> </span>easily<span class="_ _3"></span>.</div><div class="t m5 x29 h26 y84a7 ff7 fs19 fc1 sc0 ls0 ws0">Regardless<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _6"> </span>concurrency<span class="_ _6"> </span>mechanism,<span class="_ _13"> </span>synchronizing<span class="_ _6"> </span>concurrent<span class="_ _13"> </span>accesses</div><div class="t m5 x1d h26 y84a8 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _13"> </span>shared<span class="_ _13"> </span>data<span class="_ _13"> </span>is<span class="_"> </span>a<span class="_ _13"> </span>difﬁcult<span class="_ _13"> </span>problem.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span><span class="ff11">P<span class="_ _15"> </span></span>and<span class="_ _13"> </span><span class="ff11">V<span class="_ _21"> </span></span>operations<span class="_ _13"> </span>on<span class="_ _13"> </span>semaphores<span class="_ _13"> </span>have</div><div class="t m5 x1d h26 y84a9 ff7 fs19 fc1 sc0 ls0 ws0">been<span class="_ _6"> </span>developed<span class="_ _13"> </span>to<span class="_ _6"> </span>help<span class="_ _13"> </span>deal<span class="_ _6"> </span>with<span class="_ _13"> </span>this<span class="_ _6"> </span>problem.<span class="_ _13"> </span>Semaphore<span class="_ _6"> </span>operations<span class="_ _13"> </span>can<span class="_ _6"> </span>be<span class="_ _13"> </span>used</div><div class="t m5 x1d h26 y84aa ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _6"> </span>provide<span class="_ _13"> </span>mutually<span class="_ _6"> </span>exclusive<span class="_ _13"> </span>access<span class="_ _6"> </span>to<span class="_ _13"> </span>shared<span class="_ _6"> </span>data,<span class="_ _13"> </span>as<span class="_ _6"> </span>well<span class="_ _13"> </span>as<span class="_ _6"> </span>to<span class="_ _13"> </span>schedule<span class="_ _6"> </span>access<span class="_ _13"> </span>to</div><div class="t m5 x1d h26 y84ab ff7 fs19 fc1 sc0 ls0 ws0">resources<span class="_"> </span>such<span class="_"> </span>as<span class="_"> </span>the<span class="_"> </span>bounded<span class="_"> </span>buffers<span class="_"> </span>in<span class="_ _13"> </span>producer<span class="_ _1"></span>-consumer<span class="_"> </span>systems<span class="_"> </span>and<span class="_"> </span>shared</div><div class="t m5 x1d h26 y84ac ff7 fs19 fc1 sc0 ls0 ws0">objects<span class="_ _6"> </span>in<span class="_ _13"> </span>readers-writers<span class="_ _a"> </span>systems<span class="_ _1"></span>.<span class="_ _13"> </span>A<span class="_ _6"> </span>concurrent<span class="_ _6"> </span>prethreaded<span class="_ _13"> </span>echo<span class="_ _a"> </span>server<span class="_ _13"> </span>provides</div><div class="t m5 x1d h26 y84ad ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_"> </span>compelling<span class="_"> </span>example<span class="_"> </span>of<span class="_"> </span>these<span class="_"> </span>usage<span class="_"> </span>scenarios<span class="_"> </span>for<span class="_"> </span>semaphores<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y84ae ff7 fs19 fc1 sc0 ls0 ws0">Concurrency<span class="_ _6"> </span>introduces<span class="_ _13"> </span>other<span class="_ _13"> </span>difﬁcult<span class="_ _6"> </span>issues<span class="_ _13"> </span>as<span class="_ _6"> </span>well.<span class="_ _13"> </span>Functions<span class="_ _13"> </span>that<span class="_ _6"> </span>are<span class="_ _13"> </span>called</div><div class="t m5 x1d h26 y84af ff7 fs19 fc1 sc0 ls0 ws0">by<span class="_ _f"> </span>threads<span class="_ _f"> </span>must<span class="_ _f"> </span>have<span class="_ _f"> </span>a<span class="_ _f"> </span>property<span class="_ _f"> </span>known<span class="_ _f"> </span>as<span class="_ _f"> </span>thread<span class="_ _f"> </span>safety<span class="_ _3"></span>.<span class="_ _21"> </span>W<span class="_ _1"></span>e<span class="_ _f"> </span>have<span class="_ _f"> </span>identiﬁed</div><div class="t m5 x1d h26 y84b0 ff7 fs19 fc1 sc0 ls0 ws0">four<span class="_ _16"> </span>classes<span class="_ _11"> </span>of<span class="_ _16"> </span>thread-unsafe<span class="_ _16"> </span>functions<span class="_ _3"></span>,<span class="_ _16"> </span>along<span class="_ _16"> </span>with<span class="_ _16"> </span>suggestions<span class="_ _16"> </span>for<span class="_ _11"> </span>making<span class="_ _16"> </span>them</div><div class="t m5 x1d h26 y84b1 ff7 fs19 fc1 sc0 ls0 ws0">thread-safe<span class="_ _1"></span>.<span class="_ _14"> </span>Reentrant<span class="_ _14"> </span>functions<span class="_ _16"> </span>are<span class="_ _14"> </span>the<span class="_ _14"> </span>proper<span class="_ _14"> </span>subset<span class="_ _16"> </span>of<span class="_ _14"> </span>thread-safe<span class="_ _14"> </span>functions</div><div class="t m5 x1d h26 y84b2 ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_ _11"> </span>do<span class="_ _11"> </span>not<span class="_ _11"> </span>access<span class="_ _11"> </span>any<span class="_ _16"> </span>shared<span class="_"> </span>data.<span class="_ _16"> </span>Reentrant<span class="_"> </span>functions<span class="_ _16"> </span>are<span class="_"> </span>often<span class="_ _16"> </span>more<span class="_"> </span>efﬁcient</div><div class="t m5 x1d h26 y84b3 ff7 fs19 fc1 sc0 ls0 ws0">than<span class="_ _14"> </span>non-reentrant<span class="_ _15"> </span>functions<span class="_ _15"> </span>because<span class="_ _15"> </span>they<span class="_ _14"> </span>do<span class="_ _15"> </span>not<span class="_ _15"> </span>require<span class="_ _14"> </span>any<span class="_ _15"> </span>synchronization</div><div class="t m5 x1d h26 y84b4 ff7 fs19 fc1 sc0 ls0 ws0">primitives<span class="_ _1"></span>.<span class="_"> </span>Some<span class="_"> </span>other<span class="_ _13"> </span>difﬁcult<span class="_"> </span>issues<span class="_"> </span>that<span class="_ _13"> </span>arise<span class="_"> </span>in<span class="_"> </span>concurrent<span class="_"> </span>programs<span class="_ _13"> </span>are<span class="_"> </span>races</div><div class="t m5 x1d h26 y84b5 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _6"> </span>deadlocks<span class="_ _1"></span>.<span class="_ _6"> </span>Races<span class="_ _6"> </span>occur<span class="_ _6"> </span>when<span class="_ _6"> </span>programmers<span class="_ _6"> </span>make<span class="_ _6"> </span>incorrect<span class="_ _6"> </span>assumptions<span class="_ _6"> </span>about</div><div class="t m5 x1d h26 y84b6 ff7 fs19 fc1 sc0 ls0 ws0">how<span class="_ _16"> </span>logical<span class="_ _16"> </span>ﬂows<span class="_ _16"> </span>are<span class="_ _16"> </span>scheduled.<span class="_ _16"> </span>Deadlocks<span class="_ _16"> </span>occur<span class="_ _16"> </span>when<span class="_ _16"> </span>a<span class="_ _16"> </span>ﬂow<span class="_ _16"> </span>is<span class="_ _16"> </span>waiting<span class="_ _16"> </span>for<span class="_ _16"> </span>an</div><div class="t m5 x1d h26 y84b7 ff7 fs19 fc1 sc0 ls0 ws0">event<span class="_"> </span>that<span class="_"> </span>will<span class="_"> </span>never<span class="_"> </span>happen.</div><div class="t m5 x1d h29 y226b ffe fs14 fc1 sc0 ls0 ws0">Bibliographic<span class="_"> </span>Notes</div><div class="t m5 x1d h26 y543 ff7 fs19 fc1 sc0 ls0 ws0">Semaphore<span class="_ _f"> </span>operations<span class="_ _e"> </span>were<span class="_ _f"> </span>introduced<span class="_ _e"> </span>by<span class="_ _f"> </span>Dijkstra<span class="_ _e"> </span>[31].<span class="_ _f"> </span>T<span class="_ _1"></span>he<span class="_ _e"> </span>progress<span class="_ _f"> </span>graph</div><div class="t m5 x1d h26 y544 ff7 fs19 fc1 sc0 ls0 ws0">concept<span class="_ _21"> </span>was<span class="_ _21"> </span>introduced<span class="_ _21"> </span>by<span class="_ _21"> </span>Coffman<span class="_ _f"> </span>[23]<span class="_ _21"> </span>and<span class="_ _21"> </span>later<span class="_ _21"> </span>formalized<span class="_ _f"> </span>by<span class="_ _21"> </span>Carson<span class="_ _21"> </span>and</div><div class="t m5 x1d h26 y545 ff7 fs19 fc1 sc0 ls0 ws0">Reynolds<span class="_ _13"> </span>[16].<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span>readers-writers<span class="_ _13"> </span>problem<span class="_ _13"> </span>was<span class="_ _13"> </span>introduced<span class="_ _13"> </span>by<span class="_ _13"> </span>Courtois<span class="_ _13"> </span>et<span class="_ _13"> </span>al<span class="_ _13"> </span>[25].</div><div class="t m5 x1d h26 y546 ff7 fs19 fc1 sc0 ls0 ws0">Operating<span class="_ _11"> </span>systems<span class="_ _16"> </span>texts<span class="_ _16"> </span>describe<span class="_ _11"> </span>classical<span class="_ _16"> </span>synchronization<span class="_ _11"> </span>problems<span class="_ _16"> </span>such<span class="_ _11"> </span>as<span class="_ _16"> </span>the</div><div class="t m5 x1d h26 y547 ff7 fs19 fc1 sc0 ls0 ws0">dining<span class="_ _13"> </span>philosophers<span class="_ _1"></span>,<span class="_"> </span>sleeping<span class="_ _13"> </span>barber<span class="_ _1"></span>,<span class="_"> </span>and<span class="_ _13"> </span>cigarette<span class="_ _13"> </span>smokers<span class="_ _13"> </span>problems<span class="_ _13"> </span>in<span class="_ _13"> </span>more<span class="_"> </span>de-</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
