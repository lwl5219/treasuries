<div id="pf15c" class="pf w2 h11" data-page-no="15c"><div class="pc pc15c w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg15c.png"/><div class="t m5 x5f h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Homework<span class="_ _10"> </span>Problems<span class="_ _1b"> </span><span class="ffe fs1e">347</span></div><div class="t m5 x26 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_"> </span>we<span class="_ _13"> </span>have<span class="_"> </span>discussed,<span class="_"> </span>the<span class="_"> </span>A<span class="_ _3"></span>TT<span class="_"> </span>format<span class="_ _13"> </span>used<span class="_"> </span>by<span class="_"> </span><span class="ff9">gcc<span class="_ _10"> </span></span>is<span class="_ _13"> </span>very<span class="_"> </span>different<span class="_"> </span>from<span class="_"> </span>the</div><div class="t m5 x17 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">Intel<span class="_ _16"> </span>format<span class="_ _11"> </span>used<span class="_ _16"> </span>in<span class="_ _16"> </span>Intel<span class="_ _11"> </span>documentation<span class="_ _16"> </span>and<span class="_ _16"> </span>by<span class="_ _16"> </span>other<span class="_ _11"> </span>compilers<span class="_ _16"> </span>(including<span class="_ _16"> </span>the</div><div class="t m5 x17 h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">Microsoft<span class="_"> </span>compilers).</div><div class="t m5 x26 h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">Muchnick’s<span class="_ _13"> </span>book<span class="_"> </span>on<span class="_ _13"> </span>compiler<span class="_"> </span>design<span class="_"> </span>[80]<span class="_ _13"> </span>is<span class="_"> </span>considered<span class="_ _13"> </span>the<span class="_"> </span>most<span class="_ _13"> </span>comprehen-</div><div class="t m5 x17 h26 y2f8 ff7 fs19 fc2 sc0 ls0 ws0">sive<span class="_"> </span>reference<span class="_ _13"> </span>on<span class="_"> </span>code-optimization<span class="_"> </span>techniques<span class="_ _3"></span>.<span class="_"> </span>It<span class="_ _13"> </span>covers<span class="_"> </span>many<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>techniques</div><div class="t m5 x17 h26 y2f9 ff7 fs19 fc2 sc0 ls0 ws0">we<span class="_"> </span>discuss<span class="_"> </span>here<span class="_ _1"></span>,<span class="_"> </span>such<span class="_"> </span>as<span class="_"> </span>register<span class="_"> </span>usage<span class="_"> </span>conventions<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y2fa ff7 fs19 fc2 sc0 ls0 ws0">Much<span class="_ _13"> </span>has<span class="_ _6"> </span>been<span class="_ _13"> </span>written<span class="_ _6"> </span>about<span class="_ _13"> </span>the<span class="_ _6"> </span>use<span class="_ _13"> </span>of<span class="_ _13"> </span>buffer<span class="_ _6"> </span>overﬂow<span class="_ _13"> </span>to<span class="_ _6"> </span>attack<span class="_ _13"> </span>systems<span class="_ _6"> </span>over</div><div class="t m5 x17 h26 y2fb ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _16"> </span>Internet.<span class="_ _16"> </span>Detailed<span class="_ _16"> </span>analyses<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>1988<span class="_ _16"> </span>Internet<span class="_ _16"> </span>worm<span class="_ _16"> </span>have<span class="_ _16"> </span>been<span class="_ _16"> </span>published</div><div class="t m5 x17 h26 y2fc ff7 fs19 fc2 sc0 ls0 ws0">by<span class="_"> </span>Spafford<span class="_ _11"> </span>[105]<span class="_ _11"> </span>as<span class="_"> </span>well<span class="_ _11"> </span>as<span class="_ _11"> </span>by<span class="_"> </span>members<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_"> </span>team<span class="_ _11"> </span>at<span class="_ _11"> </span>MIT<span class="_"> </span>who<span class="_ _11"> </span>helped<span class="_ _11"> </span>stop<span class="_"> </span>its</div><div class="t m5 x17 h26 y2fd ff7 fs19 fc2 sc0 ls0 ws0">spread<span class="_ _13"> </span>[35].<span class="_ _13"> </span>Since<span class="_ _6"> </span>then<span class="_ _13"> </span>a<span class="_ _13"> </span>number<span class="_ _13"> </span>of<span class="_ _13"> </span>papers<span class="_ _13"> </span>and<span class="_ _6"> </span>projects<span class="_ _13"> </span>have<span class="_ _13"> </span>generated<span class="_ _13"> </span>ways<span class="_ _13"> </span>both</div><div class="t m5 x17 h26 y2fe ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_ _11"> </span>create<span class="_ _11"> </span>and<span class="_ _16"> </span>to<span class="_ _11"> </span>prevent<span class="_ _11"> </span>buffer<span class="_ _16"> </span>overﬂow<span class="_"> </span>attacks<span class="_ _0"></span>.<span class="_ _11"> </span>Seacord’s<span class="_ _11"> </span>book<span class="_ _11"> </span>[97]<span class="_ _11"> </span>provides<span class="_ _16"> </span>a</div><div class="t m5 x17 h26 y2ff ff7 fs19 fc2 sc0 ls0 ws0">wealth<span class="_ _13"> </span>of<span class="_"> </span>information<span class="_ _13"> </span>about<span class="_"> </span>buffer<span class="_ _13"> </span>overﬂow<span class="_ _13"> </span>and<span class="_"> </span>other<span class="_ _13"> </span>attacks<span class="_ _13"> </span>on<span class="_"> </span>code<span class="_ _13"> </span>generated</div><div class="t m5 x17 h26 y300 ff7 fs19 fc2 sc0 ls0 ws0">by<span class="_"> </span>C<span class="_"> </span>compilers<span class="_ _1"></span>.</div><div class="t m5 x17 h29 y314a ffe fs14 fc2 sc0 ls0 ws0">Homework<span class="_"> </span>Problems</div><div class="t m5 x17 h73 y314b ffe fs1e fc6 sc0 ls0 ws0">3.58<span class="_ _23"> </span><span class="ff10 fs19">◆</span></div><div class="t m5 x17 h26 y314c ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_"> </span>a<span class="_"> </span>function<span class="_"> </span>with<span class="_"> </span>prototype</div><div class="t m5 x17 h2d y314d ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>decode2(long<span class="_ _1f"> </span>x,<span class="_ _1f"> </span>long<span class="_ _e"> </span>y,<span class="_ _1f"> </span>long<span class="_ _e"> </span>z);</div><div class="t m5 x17 h26 y314e ff9 fs19 fc2 sc0 ls0 ws0">gcc<span class="_ _10"> </span><span class="ff7">generates<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>assembly<span class="_"> </span>code:</span></div><div class="t m5 x2c h2d y314f ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">decode2:</span></div><div class="t m5 x2c h2d y3150 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">subq<span class="_ _46"> </span>%rdx,<span class="_ _e"> </span>%rsi</span></div><div class="t m5 x2c h2d y3151 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">imulq<span class="_ _3f"> </span>%rsi,<span class="_ _e"> </span>%rdi</span></div><div class="t m5 x2c h2d y3152 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rsi,<span class="_ _e"> </span>%rax</span></div><div class="t m5 x2c h2d y3153 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">salq<span class="_ _46"> </span>$63,<span class="_ _e"> </span>%rax</span></div><div class="t m5 x2c h2d y3154 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">sarq<span class="_ _46"> </span>$63,<span class="_ _e"> </span>%rax</span></div><div class="t m5 x2c h2d y3155 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">xorq<span class="_ _46"> </span>%rdi,<span class="_ _e"> </span>%rax</span></div><div class="t m5 x2c h2e y3156 ff6 fs20 fc6 sc0 ls0 ws0">8</div><div class="t m5 xd1 h2d y3157 ffd fs1e fc2 sc0 ls0 ws0">ret</div><div class="t m5 x17 h26 y3158 ff7 fs19 fc2 sc0 ls0 ws0">Parameters<span class="_ _14"> </span><span class="ffd">x</span>,<span class="_ _15"> </span><span class="ffd">y</span>,<span class="_ _15"> </span>and<span class="_ _14"> </span><span class="ffd">z<span class="_ _14"> </span></span>are<span class="_ _14"> </span>passed<span class="_ _14"> </span>in<span class="_ _14"> </span>registers<span class="_ _15"> </span><span class="ffd">%rdi</span>,<span class="_ _15"> </span><span class="ffd">%rsi</span>,<span class="_ _15"> </span>and<span class="_ _14"> </span><span class="ffd">%rdx</span>.<span class="_ _14"> </span>T<span class="_ _1"></span>he<span class="_ _15"> </span>code</div><div class="t m5 x17 h26 y3159 ff7 fs19 fc2 sc0 ls0 ws0">stores<span class="_"> </span>the<span class="_"> </span>return<span class="_"> </span>value<span class="_"> </span>in<span class="_"> </span>register<span class="_"> </span><span class="ffd">%rax</span>.</div><div class="t m5 x26 h26 y315a ff7 fs19 fc2 sc0 ls0 ws0">Write<span class="_"> </span>C<span class="_"> </span>code<span class="_"> </span>for<span class="_ _13"> </span><span class="ffd">decode2<span class="_ _10"> </span></span>that<span class="_"> </span>will<span class="_"> </span>have<span class="_"> </span>an<span class="_"> </span>effect<span class="_"> </span>equivalent<span class="_"> </span>to<span class="_ _13"> </span>the<span class="_"> </span>assembly</div><div class="t m5 x17 h26 y315b ff7 fs19 fc2 sc0 ls0 ws0">code<span class="_"> </span>shown.</div><div class="t m5 x17 h73 y315c ffe fs1e fc6 sc0 ls0 ws0">3.59<span class="_ _23"> </span><span class="ff10 fs19">◆◆</span></div><div class="t m5 x17 h26 y315d ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _13"> </span>following<span class="_ _13"> </span>code<span class="_ _6"> </span>computes<span class="_ _13"> </span>the<span class="_ _13"> </span>128-bit<span class="_ _6"> </span>product<span class="_ _13"> </span>of<span class="_ _13"> </span>two<span class="_ _6"> </span>64-bit<span class="_ _13"> </span>signed<span class="_ _13"> </span>values<span class="_ _6"> </span><span class="ff11">x<span class="_ _10"> </span></span>and</div><div class="t m5 x17 h26 y315e ff11 fs19 fc1 sc0 ls0 ws0">y<span class="_"> </span><span class="ff7">and<span class="_"> </span>stores<span class="_"> </span>the<span class="_"> </span>result<span class="_"> </span>in<span class="_"> </span>memory:</span></div><div class="t m5 x2c h2d y315f ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">typedef<span class="_ _1f"> </span>__int128<span class="_ _e"> </span>int128_t;</span></div><div class="t m5 x2c h2e y3160 ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x2c h2e y3161 ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x2d h2d y3162 ffd fs1e fc2 sc0 ls0 ws0">void<span class="_ _e"> </span>store_prod(int128_t<span class="_ _1f"> </span>*dest,<span class="_ _1f"> </span>int64_t<span class="_ _e"> </span>x,<span class="_ _1f"> </span>int64_t<span class="_ _e"> </span>y)<span class="_ _1f"> </span>{</div><div class="t m5 x2c h2d y3163 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2">*des<span class="ls33">t=x*</span>(int128_t)<span class="_ _e"> </span>y;</span></div><div class="t m5 x2c h2d y3164 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x17 h26 ye95 ff9 fs19 fc2 sc0 ls0 ws0">Gcc<span class="_ _10"> </span><span class="ff7">generates<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>assembly<span class="_"> </span>code<span class="_"> </span>implementing<span class="_"> </span>the<span class="_"> </span>computation:</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
