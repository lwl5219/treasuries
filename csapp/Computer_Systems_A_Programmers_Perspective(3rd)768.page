<div id="pf300" class="pf w2 h11" data-page-no="300"><div class="pc pc300 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg300.png"/><div class="t m5 x147 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>8.1<span class="_ _60"> </span>Exceptions<span class="_ _3e"> </span><span class="ffe fs1e">767</span></div><div class="t m5 x34 h2a y257 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">A<span class="_ _11"> </span>note<span class="_ _11"> </span>on<span class="_ _11"> </span>terminology</span></div><div class="t m5 x34 h2b y258 ff7 fs1e fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _14"> </span>terminology<span class="_ _16"> </span>for<span class="_ _14"> </span>the<span class="_ _14"> </span>various<span class="_ _16"> </span>classes<span class="_ _14"> </span>of<span class="_ _16"> </span>exceptions<span class="_ _14"> </span>varies<span class="_ _14"> </span>from<span class="_ _16"> </span>system<span class="_ _14"> </span>to<span class="_ _16"> </span>system.<span class="_ _14"> </span>Processor<span class="_ _14"> </span>ISA</div><div class="t m5 x34 h2b y259 ff7 fs1e fc2 sc0 ls0 ws0">speciﬁcations<span class="_"> </span>often<span class="_"> </span>distinguish<span class="_ _13"> </span>between<span class="_"> </span>asynchronous<span class="_"> </span>“interrupts”<span class="_"> </span>and<span class="_"> </span>synchronous<span class="_ _13"> </span>“exceptions”<span class="_"> </span>yet</div><div class="t m5 x34 h2b y25a ff7 fs1e fc2 sc0 ls0 ws0">provide<span class="_ _13"> </span>no<span class="_ _13"> </span>umbrella<span class="_"> </span>term<span class="_ _13"> </span>to<span class="_ _13"> </span>refer<span class="_ _13"> </span>to<span class="_ _13"> </span>these<span class="_ _13"> </span>very<span class="_"> </span>similar<span class="_ _13"> </span>concepts<span class="_ _3"></span>.<span class="_"> </span>T<span class="_ _7"></span>o<span class="_"> </span>avoid<span class="_ _13"> </span>having<span class="_ _13"> </span>to<span class="_ _13"> </span>constantly<span class="_ _13"> </span>refer<span class="_"> </span>to</div><div class="t m5 x34 h2b y4e2 ff7 fs1e fc2 sc0 ls0 ws0">“exceptions<span class="_ _13"> </span>and<span class="_ _6"> </span>interrupts”<span class="_ _13"> </span>and<span class="_ _13"> </span>“exceptions<span class="_ _6"> </span>or<span class="_ _13"> </span>interrupts<span class="_ _1"></span>,<span class="_ _1"></span>”<span class="_ _13"> </span>we<span class="_ _13"> </span>use<span class="_ _6"> </span>the<span class="_ _13"> </span>word<span class="_ _13"> </span>“exception”<span class="_ _6"> </span>as<span class="_ _13"> </span>the<span class="_ _6"> </span>general</div><div class="t m5 x34 h2b y4e3 ff7 fs1e fc2 sc0 ls0 ws0">term<span class="_ _6"> </span>and<span class="_ _13"> </span>distinguish<span class="_ _a"> </span>between<span class="_ _13"> </span>asynchronous<span class="_ _6"> </span>exceptions<span class="_ _6"> </span>(interrupts)<span class="_ _13"> </span>and<span class="_ _6"> </span>synchronous<span class="_ _6"> </span>exceptions<span class="_ _13"> </span>(traps<span class="_ _3"></span>,</div><div class="t m5 x34 h2b y4e4 ff7 fs1e fc2 sc0 ls0 ws0">faults<span class="_ _1"></span>,<span class="_ _13"> </span>and<span class="_ _13"> </span>aborts)<span class="_ _13"> </span>only<span class="_ _13"> </span>when<span class="_ _13"> </span>it<span class="_ _13"> </span>is<span class="_ _13"> </span>appropriate<span class="_ _1"></span>.<span class="_ _13"> </span>As<span class="_ _13"> </span>we<span class="_ _13"> </span>have<span class="_ _13"> </span>noted,<span class="_ _13"> </span>the<span class="_ _13"> </span>basic<span class="_ _13"> </span>ideas<span class="_ _13"> </span>are<span class="_ _13"> </span>the<span class="_ _13"> </span>same<span class="_ _13"> </span>for<span class="_ _13"> </span>every</div><div class="t m5 x34 h2b y945 ff7 fs1e fc2 sc0 ls0 ws0">system,<span class="_"> </span>but<span class="_ _13"> </span>you<span class="_"> </span>should<span class="_"> </span>be<span class="_ _13"> </span>aware<span class="_"> </span>that<span class="_"> </span>some<span class="_ _13"> </span>manufacturers’<span class="_"> </span>manuals<span class="_ _13"> </span>use<span class="_"> </span>the<span class="_"> </span>word<span class="_ _13"> </span>“exception”<span class="_"> </span>to<span class="_"> </span>refer</div><div class="t m5 x34 h2b y946 ff7 fs1e fc2 sc0 ls0 ws0">only<span class="_"> </span>to<span class="_"> </span>those<span class="_"> </span>changes<span class="_"> </span>in<span class="_"> </span>control<span class="_"> </span>ﬂow<span class="_"> </span>caused<span class="_"> </span>by<span class="_"> </span>synchronous<span class="_"> </span>events<span class="_ _1"></span>.</div><div class="t m5 x12e h2c y64da ffa fs16 fc2 sc0 ls0 ws0">code/ecf/hello-asm64.sa</div><div class="t m5 x2c h2d y64db ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">.section<span class="_ _1f"> </span>.data</span></div><div class="t m5 x2c h2d y64dc ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">string:</span></div><div class="t m5 x2c h2d y64dd ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">.ascii<span class="_ _e"> </span>&quot;hello,<span class="_ _1f"> </span>world\n&quot;</span></div><div class="t m5 x2c h2d y64de ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _1c"> </span><span class="ffd fs1e fc2">string_end:</span></div><div class="t m5 x2c h2e y64df ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 xd1 h2d y64e0 ffd fs1e fc2 sc0 ls0 ws0">.equ<span class="_ _e"> </span>len,<span class="_ _1f"> </span>string_end<span class="_ _1f"> </span>-<span class="_ _e"> </span>string</div><div class="t m5 x2c h2d y64e1 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _1c"> </span><span class="ffd fs1e fc2">.section<span class="_ _1f"> </span>.text</span></div><div class="t m5 x2c h2d y64e2 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _1c"> </span><span class="ffd fs1e fc2">.globl<span class="_ _1f"> </span>main</span></div><div class="t m5 x2c h2d y64e3 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _1c"> </span><span class="ffd fs1e fc2">main:</span></div><div class="t m5 xd1 h61 y64e4 ff13 fs35 fc6 sc0 ls0 ws0">First,<span class="_ _f"> </span>call<span class="_ _f"> </span>write(1,<span class="_ _f"> </span>&quot;hello,<span class="_ _e"> </span>world\n&quot;,<span class="_ _21"> </span>13)</div><div class="t m5 x2c h2d y64e5 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _e"> </span>$1,<span class="_ _1f"> </span>%rax<span class="_ _81"> </span></span><span class="ff13 fs35">write<span class="_ _e"> </span>is<span class="_ _21"> </span>system<span class="_ _f"> </span>call<span class="_ _e"> </span>1</span></div><div class="t m5 x17 h2d y64e6 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _e"> </span>$1,<span class="_ _1f"> </span>%rdi<span class="_ _81"> </span></span><span class="ff13 fs35">Arg1:<span class="_ _e"> </span>stdout<span class="_ _21"> </span>has<span class="_ _f"> </span>descriptor<span class="_ _e"> </span>1</span></div><div class="t m5 x17 h2d y64e7 ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _e"> </span>$string,<span class="_ _1f"> </span>%rsi<span class="_ _93"> </span></span><span class="ff13 fs35">Arg2:<span class="_ _f"> </span>hello<span class="_ _f"> </span>world<span class="_ _e"> </span>string</span></div><div class="t m5 x17 h2d y64e8 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _e"> </span>$len,<span class="_ _1f"> </span>%rdx<span class="_ _2a"> </span></span><span class="ff13 fs35">Arg3:<span class="_ _21"> </span>string<span class="_ _e"> </span>length</span></div><div class="t m5 x17 h2e y64e9 ff6 fs20 fc6 sc0 ls0 ws0">13</div><div class="t m5 xd1 h2d y64ea ffd fs1e fc2 sc0 ls0 ws0">syscall<span class="_ _155"> </span><span class="ff13 fs35 fc6">Make<span class="_ _e"> </span>the<span class="_ _21"> </span>system<span class="_ _f"> </span>call</span></div><div class="t m5 xd1 h61 y64eb ff13 fs35 fc6 sc0 ls0 ws0">Next,<span class="_ _f"> </span>call<span class="_ _f"> </span>_exit(0)</div><div class="t m5 x17 h2d y64ec ff6 fs20 fc6 sc0 ls0 ws0">14<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _e"> </span>$60,<span class="_ _1f"> </span>%rax<span class="_ _5d"> </span></span><span class="ff13 fs35">_exit<span class="_ _f"> </span>is<span class="_ _f"> </span>system<span class="_ _f"> </span>call<span class="_ _e"> </span>60</span></div><div class="t m5 x17 h2d y64ed ff6 fs20 fc6 sc0 ls0 ws0">15<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _e"> </span>$0,<span class="_ _1f"> </span>%rdi<span class="_ _81"> </span></span><span class="ff13 fs35">Arg1:<span class="_ _e"> </span>exit<span class="_ _21"> </span>status<span class="_ _f"> </span>is<span class="_ _e"> </span>0</span></div><div class="t m5 x17 h2e y64ee ff6 fs20 fc6 sc0 ls0 ws0">16</div><div class="t m5 xd1 h2d y64ef ffd fs1e fc2 sc0 ls0 ws0">syscall<span class="_ _155"> </span><span class="ff13 fs35 fc6">Make<span class="_ _e"> </span>the<span class="_ _21"> </span>system<span class="_ _f"> </span>call</span></div><div class="t m5 x12e h2c y64f0 ffa fs16 fc2 sc0 ls0 ws0">code/ecf/hello-asm64.sa</div><div class="t m5 x17 h2f y64f1 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>8.11<span class="_ _66"> </span><span class="fc1">Implementing<span class="_"> </span>the</span></div><div class="t m5 xe6 h3a y64f2 ffd fs19 fc1 sc0 ls0 ws0">hello<span class="_ _10"> </span><span class="ffe fs16">program<span class="_"> </span>directly<span class="_"> </span>with<span class="_"> </span>Linux<span class="_"> </span>system<span class="_"> </span>calls.</span></div><div class="t m5 x26 h26 y8ff ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _1f"> </span>8.11<span class="_ _1f"> </span>shows<span class="_ _e"> </span>an<span class="_ _1f"> </span>assembly-language<span class="_ _e"> </span>version<span class="_ _1f"> </span>of<span class="_ _1f"> </span><span class="ffd">hello<span class="_ _e"> </span></span>that<span class="_ _1f"> </span>uses<span class="_ _e"> </span>the</div><div class="t m5 x17 h26 y900 ffd fs19 fc1 sc0 ls0 ws0">syscall<span class="_ _15"> </span><span class="ff7">instruction<span class="_ _15"> </span>to<span class="_ _21"> </span>invoke<span class="_ _15"> </span>the<span class="_ _21"> </span></span>write<span class="_ _15"> </span><span class="ff7">and<span class="_ _15"> </span></span>exit<span class="_ _21"> </span><span class="ff7">system<span class="_ _15"> </span>calls<span class="_ _21"> </span>directly<span class="_ _3"></span>.<span class="_ _15"> </span>Lines</span></div><div class="t m5 x17 h26 y901 ff7 fs19 fc1 sc0 ls0 ws0">9–13<span class="_"> </span>invoke<span class="_ _11"> </span>the<span class="_ _11"> </span><span class="ffd">write<span class="_ _11"> </span></span>function.<span class="_ _11"> </span>F<span class="_ _1"></span>irst,<span class="_ _11"> </span>line<span class="_ _11"> </span>9<span class="_ _11"> </span>stores<span class="_ _11"> </span>the<span class="_ _11"> </span>number<span class="_"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span><span class="ffd">write<span class="_ _11"> </span></span>sys-</div><div class="t m5 x17 h26 y902 ff7 fs19 fc1 sc0 ls0 ws0">tem<span class="_ _11"> </span>call<span class="_ _11"> </span>in<span class="_ _16"> </span><span class="ffd">%rax</span>,<span class="_ _11"> </span>and<span class="_ _11"> </span>lines<span class="_ _16"> </span>10–12<span class="_ _11"> </span>set<span class="_ _11"> </span>up<span class="_ _11"> </span>the<span class="_ _16"> </span>argument<span class="_ _11"> </span>list.<span class="_ _11"> </span>T<span class="_ _0"></span>hen,<span class="_ _11"> </span>line<span class="_ _16"> </span>13<span class="_"> </span>uses<span class="_ _16"> </span>the</div><div class="t m5 x17 h26 y903 ffd fs19 fc1 sc0 ls0 ws0">syscall<span class="_ _16"> </span><span class="ff7">instruction<span class="_ _14"> </span>to<span class="_ _16"> </span>invoke<span class="_ _14"> </span>the<span class="_ _16"> </span>system<span class="_ _14"> </span>call.<span class="_ _16"> </span>Similarly<span class="_ _3"></span>,<span class="_ _14"> </span>lines<span class="_ _14"> </span>14–16<span class="_ _16"> </span>invoke<span class="_ _14"> </span>the</span></div><div class="t m5 x17 h26 y904 ffd fs19 fc1 sc0 ls0 ws0">_exit<span class="_ _10"> </span><span class="ff7">system<span class="_"> </span>call.</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
