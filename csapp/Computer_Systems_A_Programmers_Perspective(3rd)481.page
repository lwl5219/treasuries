<div id="pf1e1" class="pf w2 h11" data-page-no="1e1"><div class="pc pc1e1 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1e1.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">480<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>4<span class="_ _3d"> </span>Processor<span class="_ _10"> </span>Architecture</span></div><div class="t m5 x198 ha2 y4311 ff49 fs65 fc1 sc0 ls1f0 ws0">FD<span class="_ _0"></span>E<span class="_ _3"></span>M<span class="_ _4"></span>W</div><div class="t m5 x118 ha2 y4312 ff49 fs65 fc1 sc0 ls1f1 ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x1b4 ha2 y4313 ff49 fs65 fc1 sc0 ls1f2 ws0">FD</div><div class="t m5 xde ha2 y4314 ff49 fs65 fc1 sc0 ls1f3 ws0">EM<span class="_ _7"></span>W</div><div class="t m5 x94 ha2 y4315 ff49 fs65 fc1 sc0 ls0 ws0">F</div><div class="t m5 xde ha2 y4316 ff49 fs65 fc1 sc0 ls1f4 ws0">DE<span class="_ _1"></span>M<span class="_ _4"></span>W</div><div class="t m5 xb9 ha2 y4317 ff49 fs65 fc1 sc0 ls1f0 ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x1fd ha2 y4318 ff49 fs65 fc1 sc0 ls1f2 ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x1d ha3 y4319 ff4a fs66 fc1 sc0 ls0 ws0">0x000: xorq %rax,%rax</div><div class="t m5 x1d ha3 y431a ff4a fs66 fc1 sc0 ls0 ws0">0x002: jne target # Not taken</div><div class="t m5 x1d ha3 y431b ff4a fs66 fc1 sc0 ls0 ws0">0x016: irmovl $2,%rdx # Target</div><div class="t m5 x1d ha3 y431c ff4a fs66 fc1 sc0 ls0 ws0">       </div><div class="t m5 x1d ha3 y431d ff4a fs66 fc1 sc0 ls0 ws0">0x020: irmovl $3,%rbx # Target+1</div><div class="t m5 x1d ha3 y431e ff4a fs66 fc1 sc0 ls0 ws0">      </div><div class="t m5 x1d ha3 y431f ff4a fs66 fc1 sc0 ls0 ws0">0x00b: irmovq $1,%rax # Fall through</div><div class="t m5 x1d ha3 y4320 ff4a fs66 fc1 sc0 ls0 ws0">0x015: halt</div><div class="t m5 x1d ha3 y4321 ff4a fs66 fc1 sc0 ls0 ws0"># prog7</div><div class="t m5 x1b1 ha5 y4322 ff49 fs67 fc6 sc0 ls1d4 ws0">12345</div><div class="t m5 x1fd ha5 y4323 ff49 fs67 fc6 sc0 ls0 ws0">6</div><div class="t m5 x133 ha5 y4324 ff49 fs67 fc6 sc0 ls0 ws0">7</div><div class="t m5 x224 ha5 y4325 ff49 fs67 fc6 sc0 ls0 ws0">8</div><div class="t m5 x1e5 ha5 y4326 ff49 fs67 fc6 sc0 ls1d5 ws0">91<span class="_ _1c5"></span>0</div><div class="t me xa3 hbc y4327 ff4a fs74 fc1 sc0 ls0 ws0">bubble</div><div class="c x1d y4328 wf hbd"><div class="t me x25c hbc y4329 ff4a fs74 fc3 sc1 ls0 ws0">bubble</div></div><div class="t me xa3 hbc y432a ff4a fs74 fc1 sc0 ls0 ws0">bubble</div><div class="c x1d y4328 wf hbd"><div class="t me x25c hbc y432b ff4a fs74 fc3 sc1 ls0 ws0">bubble</div></div><div class="t m5 x1d h34 y432c ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _15"> </span>4.56<span class="_ _c"> </span><span class="fc1">Processing<span class="_ _15"> </span>mispredicted<span class="_ _15"> </span>branch<span class="_ _21"> </span>instructions.<span class="_ _15"> </span><span class="ff6">The<span class="_ _15"> </span>pipeline<span class="_ _15"> </span>predicts</span></span></div><div class="t m5 x1d h34 y432d ff6 fs16 fc1 sc0 ls0 ws0">branches<span class="_ _15"> </span>will<span class="_ _15"> </span>be<span class="_ _21"> </span>taken<span class="_ _15"> </span>and<span class="_ _15"> </span>so<span class="_ _21"> </span>starts<span class="_ _15"> </span>fetching<span class="_ _15"> </span>instructions<span class="_ _21"> </span>at<span class="_ _15"> </span>the<span class="_ _15"> </span>jump<span class="_ _21"> </span>target.<span class="_ _15"> </span>Two</div><div class="t m5 x1d h34 y432e ff6 fs16 fc1 sc0 ls0 ws0">instructions<span class="_ _11"> </span>are<span class="_ _11"> </span>fetched<span class="_ _11"> </span>before<span class="_ _16"> </span>the<span class="_ _11"> </span>misprediction<span class="_ _11"> </span>is<span class="_ _11"> </span>detected<span class="_ _11"> </span>in<span class="_ _16"> </span>cycle<span class="_ _11"> </span>4<span class="_ _11"> </span>when<span class="_ _11"> </span>the<span class="_ _11"> </span>jump</div><div class="t m5 x1d h34 y432f ff6 fs16 fc1 sc0 ls0 ws0">instruction<span class="_ _16"> </span>ﬂows<span class="_ _14"> </span>through<span class="_ _14"> </span>the<span class="_ _16"> </span>execute<span class="_ _14"> </span>stage.<span class="_ _14"> </span>In<span class="_ _16"> </span>cycle<span class="_ _14"> </span>5,<span class="_ _15"> </span>the<span class="_ _16"> </span>pipeline<span class="_ _14"> </span><span class="ffb">cancels<span class="_ _15"> </span></span>the<span class="_ _16"> </span>two</div><div class="t m5 x1d h34 y4330 ff6 fs16 fc1 sc0 ls0 ws0">target<span class="_ _11"> </span>instructions<span class="_ _10"> </span>by<span class="_ _11"> </span>injecting<span class="_ _11"> </span>bubbles<span class="_ _11"> </span>into<span class="_ _11"> </span>the<span class="_ _10"> </span>decode<span class="_ _11"> </span>and<span class="_ _11"> </span>execute<span class="_ _11"> </span>stages,<span class="_ _11"> </span>and<span class="_ _11"> </span>it<span class="_ _11"> </span>also</div><div class="t m5 x1d h34 y4331 ff6 fs16 fc1 sc0 ls0 ws0">fetches<span class="_ _10"> </span>the<span class="_ _11"> </span>instruction<span class="_ _10"> </span>following<span class="_ _10"> </span>the<span class="_ _11"> </span>jump.</div><div class="t m5 x1d h26 y4332 ff7 fs19 fc1 sc0 ls0 ws0">reaches<span class="_ _11"> </span>the<span class="_ _16"> </span>execute<span class="_ _16"> </span>stage<span class="_ _1"></span>,<span class="_ _16"> </span>where<span class="_ _16"> </span>it<span class="_ _16"> </span>can<span class="_ _11"> </span>cause<span class="_ _16"> </span>the<span class="_ _11"> </span>condition<span class="_ _16"> </span>codes<span class="_ _16"> </span>to<span class="_ _11"> </span>change.<span class="_ _11"> </span>At</div><div class="t m5 x1d h26 y4333 ff7 fs19 fc1 sc0 ls0 ws0">this<span class="_ _13"> </span>point,<span class="_ _13"> </span>the<span class="_ _13"> </span>pipeline<span class="_ _13"> </span>can<span class="_ _13"> </span>simply<span class="_ _13"> </span><span class="ffa">cancel<span class="_ _13"> </span></span>(sometimes<span class="_ _13"> </span>called<span class="_ _13"> </span><span class="ffa">instruction<span class="_ _13"> </span>squashing<span class="_ _2"></span></span>)</div><div class="t m5 x1d h26 y4334 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>two<span class="_"> </span>misfetched<span class="_"> </span>instructions<span class="_"> </span>by<span class="_ _13"> </span>injecting<span class="_"> </span>bubbles<span class="_"> </span>into<span class="_"> </span>the<span class="_"> </span>decode<span class="_"> </span>and<span class="_"> </span>execute</div><div class="t m5 x1d h26 y4335 ff7 fs19 fc1 sc0 ls0 ws0">stages<span class="_ _13"> </span>on<span class="_ _6"> </span>the<span class="_ _13"> </span>following<span class="_ _13"> </span>c<span class="_ _1"></span>ycle<span class="_ _13"> </span>while<span class="_ _13"> </span>also<span class="_ _6"> </span>fetching<span class="_ _13"> </span>the<span class="_ _13"> </span>instruction<span class="_ _6"> </span>following<span class="_ _13"> </span>the<span class="_ _13"> </span>jump</div><div class="t m5 x1d h26 y4336 ff7 fs19 fc1 sc0 ls0 ws0">instruction.<span class="_"> </span>The<span class="_"> </span>two<span class="_ _11"> </span>misfetched<span class="_ _11"> </span>instructions<span class="_ _11"> </span>will<span class="_ _11"> </span>then<span class="_ _11"> </span>simply<span class="_ _11"> </span>disappear<span class="_ _11"> </span>from<span class="_ _11"> </span>the</div><div class="t m5 x1d h26 y4337 ff7 fs19 fc1 sc0 ls0 ws0">pipeline<span class="_ _11"> </span>and<span class="_ _16"> </span>therefore<span class="_ _11"> </span>not<span class="_ _11"> </span>have<span class="_ _11"> </span>any<span class="_ _16"> </span>effect<span class="_ _11"> </span>on<span class="_ _11"> </span>the<span class="_ _16"> </span>programmer<span class="_ _1"></span>-visible<span class="_ _11"> </span>state.<span class="_"> </span>The</div><div class="t m5 x1d h26 y4338 ff7 fs19 fc1 sc0 ls0 ws0">only<span class="_"> </span>drawback<span class="_"> </span>is<span class="_"> </span>that<span class="_"> </span>two<span class="_"> </span>clock<span class="_"> </span>c<span class="_ _1"></span>ycles’<span class="_"> </span>worth<span class="_"> </span>of<span class="_"> </span>instruction<span class="_"> </span>processing<span class="_"> </span>capability</div><div class="t m5 x1d h26 y4339 ff7 fs19 fc1 sc0 ls0 ws0">have<span class="_"> </span>been<span class="_"> </span>wasted.</div><div class="t m5 x29 h26 y433a ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _e"> </span>discussion<span class="_ _f"> </span>of<span class="_ _f"> </span>control<span class="_ _e"> </span>hazards<span class="_ _f"> </span>indicates<span class="_ _f"> </span>that<span class="_ _e"> </span>they<span class="_ _f"> </span>can<span class="_ _f"> </span>be<span class="_ _e"> </span>handled<span class="_ _f"> </span>by</div><div class="t m5 x1d h26 y433b ff7 fs19 fc1 sc0 ls0 ws0">careful<span class="_ _15"> </span>consideration<span class="_ _21"> </span>of<span class="_ _15"> </span>the<span class="_ _21"> </span>pipeline<span class="_ _15"> </span>control<span class="_ _21"> </span>logic.<span class="_ _15"> </span>T<span class="_ _7"></span>echniques<span class="_ _21"> </span>such<span class="_ _15"> </span>as<span class="_ _21"> </span>stalling</div><div class="t m5 x1d h26 y433c ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_"> </span>injecting<span class="_ _13"> </span>bubbles<span class="_"> </span>into<span class="_"> </span>the<span class="_ _13"> </span>pipeline<span class="_"> </span>dynamically<span class="_"> </span>adjust<span class="_ _13"> </span>the<span class="_"> </span>pipeline<span class="_"> </span>ﬂow<span class="_ _13"> </span>when</div><div class="t m5 x1d h26 y433d ff7 fs19 fc1 sc0 ls0 ws0">special<span class="_"> </span>conditions<span class="_"> </span>arise.<span class="_"> </span>As<span class="_"> </span>we<span class="_"> </span>will<span class="_"> </span>discuss<span class="_ _11"> </span>in<span class="_"> </span>Section<span class="_ _11"> </span>4.5.8,<span class="_"> </span>a<span class="_"> </span>simple<span class="_ _11"> </span>extension<span class="_"> </span>to</div><div class="t m5 x1d h26 y433e ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _13"> </span>basic<span class="_ _13"> </span>clocked<span class="_ _13"> </span>register<span class="_"> </span>design<span class="_ _13"> </span>will<span class="_ _13"> </span>enable<span class="_ _13"> </span>us<span class="_ _13"> </span>to<span class="_ _13"> </span>stall<span class="_ _13"> </span>stages<span class="_"> </span>and<span class="_ _13"> </span>to<span class="_ _13"> </span>inject<span class="_ _13"> </span>bubbles</div><div class="t m5 x1d h26 y433f ff7 fs19 fc1 sc0 ls0 ws0">into<span class="_"> </span>pipeline<span class="_"> </span>registers<span class="_"> </span>as<span class="_"> </span>part<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>pipeline<span class="_"> </span>control<span class="_"> </span>logic.</div><div class="t m5 x1d h41 y5fc ffe fs29 fc1 sc0 ls0 ws0">4.5.6</div><div class="t m5 x8c h43 y5fd ffe fs19 fc1 sc0 ls0 ws0">Exception<span class="_"> </span>Handling</div><div class="t m5 x1d h26 y5fe ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_ _15"> </span>we<span class="_ _14"> </span>will<span class="_ _15"> </span>discuss<span class="_ _15"> </span>in<span class="_ _15"> </span>Chapter<span class="_ _15"> </span>8,<span class="_ _21"> </span>a<span class="_ _15"> </span>variety<span class="_ _15"> </span>of<span class="_ _15"> </span>activities<span class="_ _15"> </span>in<span class="_ _14"> </span>a<span class="_ _15"> </span>processor<span class="_ _15"> </span>can<span class="_ _15"> </span>lead</div><div class="t m5 x1d h26 y5ff ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _14"> </span><span class="ffa">exceptional<span class="_ _14"> </span>control<span class="_ _14"> </span>ﬂow</span>,<span class="_ _15"> </span>where<span class="_ _14"> </span>the<span class="_ _14"> </span>normal<span class="_ _14"> </span>chain<span class="_ _15"> </span>of<span class="_ _14"> </span>program<span class="_ _14"> </span>execution<span class="_ _15"> </span>gets</div><div class="t m5 x1d h26 y600 ff7 fs19 fc1 sc0 ls0 ws0">broken.<span class="_"> </span>Exceptions<span class="_ _13"> </span>can<span class="_"> </span>be<span class="_ _13"> </span>generated<span class="_"> </span>either<span class="_ _13"> </span><span class="ffa">internally</span>,<span class="_"> </span>by<span class="_ _13"> </span>the<span class="_"> </span>executing<span class="_ _13"> </span>program,</div><div class="t m5 x1d h26 y601 ff7 fs19 fc1 sc0 ls0 ws0">or<span class="_ _15"> </span><span class="ffa">externally</span>,<span class="_ _15"> </span>by<span class="_ _15"> </span>some<span class="_ _15"> </span>outside<span class="_ _15"> </span>signal.<span class="_ _15"> </span>Our<span class="_ _15"> </span>instruction<span class="_ _15"> </span>set<span class="_ _15"> </span>architecture<span class="_ _15"> </span>includes</div><div class="t m5 x1d h26 y602 ff7 fs19 fc1 sc0 ls0 ws0">three<span class="_"> </span>different<span class="_ _11"> </span>internally<span class="_"> </span>generated<span class="_ _11"> </span>exceptions<span class="_ _1"></span>,<span class="_"> </span>caused<span class="_ _11"> </span>by<span class="_"> </span>(1)<span class="_ _11"> </span>a<span class="_"> </span><span class="ffd">halt<span class="_ _11"> </span></span>instruction,</div><div class="t m5 x1d h26 y603 ff7 fs19 fc1 sc0 ls0 ws0">(2)<span class="_ _16"> </span>an<span class="_ _16"> </span>instruction<span class="_ _11"> </span>with<span class="_ _16"> </span>an<span class="_ _16"> </span>invalid<span class="_ _16"> </span>combination<span class="_ _16"> </span>of<span class="_ _16"> </span>instruction<span class="_ _16"> </span>and<span class="_ _16"> </span>function<span class="_ _11"> </span>code,</div><div class="t m5 x1d h26 y604 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _14"> </span>(3)<span class="_ _15"> </span>an<span class="_ _15"> </span>attempt<span class="_ _15"> </span>to<span class="_ _15"> </span>access<span class="_ _15"> </span>an<span class="_ _14"> </span>invalid<span class="_ _15"> </span>address<span class="_ _1"></span>,<span class="_ _21"> </span>either<span class="_ _15"> </span>for<span class="_ _15"> </span>instruction<span class="_ _15"> </span>fetch<span class="_ _14"> </span>or</div><div class="t m5 x1d h26 y605 ff7 fs19 fc1 sc0 ls0 ws0">data<span class="_ _13"> </span>read<span class="_"> </span>or<span class="_ _13"> </span>write<span class="_ _0"></span>.<span class="_ _13"> </span>A<span class="_"> </span>more<span class="_ _13"> </span>complete<span class="_"> </span>processor<span class="_ _13"> </span>design<span class="_ _13"> </span>would<span class="_"> </span>also<span class="_ _13"> </span>handle<span class="_ _13"> </span>external</div><div class="t m5 x1d h26 y606 ff7 fs19 fc1 sc0 ls0 ws0">exceptions<span class="_ _1"></span>,<span class="_ _13"> </span>such<span class="_ _13"> </span>as<span class="_ _6"> </span>when<span class="_ _13"> </span>the<span class="_ _13"> </span>processor<span class="_ _6"> </span>receives<span class="_ _13"> </span>a<span class="_ _13"> </span>signal<span class="_ _6"> </span>that<span class="_ _13"> </span>the<span class="_ _13"> </span>network<span class="_ _6"> </span>interface</div><div class="t m5 x1d h26 y607 ff7 fs19 fc1 sc0 ls0 ws0">has<span class="_ _21"> </span>received<span class="_ _21"> </span>a<span class="_ _f"> </span>new<span class="_ _21"> </span>packet<span class="_ _21"> </span>or<span class="_ _f"> </span>the<span class="_ _21"> </span>user<span class="_ _21"> </span>has<span class="_ _f"> </span>clicked<span class="_ _21"> </span>a<span class="_ _f"> </span>mouse<span class="_ _21"> </span>button.<span class="_ _21"> </span>Handling</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
