<div id="pf249" class="pf w2 h11" data-page-no="249"><div class="pc pc249 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg249.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">584<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>5<span class="_ _3d"> </span>Optimizing<span class="_ _10"> </span>Program<span class="_ _10"> </span>Performance</span></div><div class="t m5 x29 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">By<span class="_"> </span>using<span class="_"> </span>multiple<span class="_"> </span>optimizations<span class="_ _3"></span>,<span class="_"> </span>we<span class="_"> </span>have<span class="_"> </span>been<span class="_"> </span>able<span class="_ _13"> </span>to<span class="_"> </span>achieve<span class="_"> </span>CPEs<span class="_"> </span>close<span class="_"> </span>to</div><div class="t m5 x1d h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _13"> </span>throughput<span class="_"> </span>bounds<span class="_ _13"> </span>of<span class="_ _13"> </span>0.50<span class="_ _13"> </span>and<span class="_"> </span>1.00,<span class="_ _13"> </span>limited<span class="_ _13"> </span>only<span class="_ _13"> </span>by<span class="_"> </span>the<span class="_ _13"> </span>capacities<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>func-</div><div class="t m5 x1d h46 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">tional<span class="_ _13"> </span>units<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _1"></span>hese<span class="_"> </span>represent<span class="_ _13"> </span>10–20<span class="ff12">×<span class="_ _13"></span></span>improvements<span class="_"> </span>on<span class="_ _13"> </span>the<span class="_ _13"> </span>original<span class="_"> </span>code<span class="_ _1"></span>.<span class="_ _13"> </span>This<span class="_ _13"> </span>has</div><div class="t m5 x1d h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">all<span class="_"> </span>been<span class="_ _13"> </span>done<span class="_"> </span>using<span class="_ _13"> </span>ordinary<span class="_"> </span>C<span class="_ _13"> </span>code<span class="_"> </span>and<span class="_ _13"> </span>a<span class="_"> </span>standard<span class="_ _13"> </span>compiler.<span class="_"> </span>Rewriting<span class="_ _13"> </span>the<span class="_"> </span>code</div><div class="t m5 x1d h26 y2f8 ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_"> </span>take<span class="_"> </span>advantage<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_"> </span>newer<span class="_"> </span>SIMD<span class="_"> </span>instructions<span class="_ _13"> </span>yields<span class="_"> </span>additional<span class="_"> </span>performance</div><div class="t m5 x1d h46 y2f9 ff7 fs19 fc2 sc0 ls0 ws0">gains<span class="_ _6"> </span>of<span class="_ _13"> </span>nearly<span class="_ _a"> </span>4<span class="ff12">×<span class="_ _13"></span></span>or<span class="_ _6"> </span>8<span class="ff12">×</span>.<span class="_ _6"> </span>F<span class="_ _1"></span>or<span class="_ _13"> </span>example<span class="_ _1"></span>,<span class="_ _13"> </span>for<span class="_ _6"> </span>single-precision<span class="_ _6"> </span>multiplication,<span class="_ _13"> </span>the<span class="_ _6"> </span>CPE</div><div class="t m5 x1d h26 y2fa ff7 fs19 fc2 sc0 ls0 ws0">drops<span class="_"> </span>from<span class="_"> </span>the<span class="_"> </span>original<span class="_"> </span>value<span class="_"> </span>of<span class="_ _11"> </span>11.14<span class="_"> </span>down<span class="_"> </span>to<span class="_"> </span>0.06,<span class="_ _11"> </span>an<span class="_"> </span>overall<span class="_"> </span>performance<span class="_"> </span>gain</div><div class="t m5 x1d h46 y2fb ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_ _16"> </span>over<span class="_ _16"> </span>180<span class="ff12">×</span>.<span class="_ _14"> </span>T<span class="_ _1"></span>his<span class="_ _16"> </span>example<span class="_ _14"> </span>demonstrates<span class="_ _16"> </span>that<span class="_ _16"> </span>modern<span class="_ _14"> </span>processors<span class="_ _16"> </span>have<span class="_ _16"> </span>consid-</div><div class="t m5 x1d h26 y2fc ff7 fs19 fc2 sc0 ls0 ws0">erable<span class="_"> </span>amounts<span class="_ _11"> </span>of<span class="_ _11"> </span>computing<span class="_ _11"> </span>power,<span class="_"> </span>but<span class="_ _11"> </span>we<span class="_"> </span>may<span class="_ _11"> </span>need<span class="_ _11"> </span>to<span class="_ _11"> </span>coax<span class="_"> </span>this<span class="_ _11"> </span>power<span class="_ _11"> </span>out<span class="_ _11"> </span>of</div><div class="t m5 x1d h26 y2fd ff7 fs19 fc2 sc0 ls0 ws0">them<span class="_"> </span>by<span class="_"> </span>writing<span class="_"> </span>our<span class="_"> </span>programs<span class="_"> </span>in<span class="_"> </span>very<span class="_"> </span>stylized<span class="_"> </span>ways<span class="_ _1"></span>.</div><div class="t m5 x1d h3b y4ef2 fff fs24 fc6 sc0 ls0 ws0">5.11<span class="_ _17"> </span><span class="ffe fs18">Some<span class="_"> </span>Limiting<span class="_"> </span>Factors</span></div><div class="t m5 x1d h26 y4ef3 ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _e"> </span>have<span class="_ _21"> </span>seen<span class="_ _e"> </span>that<span class="_ _f"> </span>the<span class="_ _e"> </span>critical<span class="_ _21"> </span>path<span class="_ _e"> </span>in<span class="_ _f"> </span>a<span class="_ _e"> </span>data-ﬂow<span class="_ _21"> </span>graph<span class="_ _e"> </span>representation<span class="_ _f"> </span>of<span class="_ _f"> </span>a</div><div class="t m5 x1d h26 y4ef4 ff7 fs19 fc1 sc0 ls0 ws0">program<span class="_"> </span>indicates<span class="_"> </span>a<span class="_ _11"> </span>fundamental<span class="_"> </span>lower<span class="_"> </span>bound<span class="_ _11"> </span>on<span class="_"> </span>the<span class="_ _11"> </span>time<span class="_"> </span>required<span class="_"> </span>to<span class="_ _11"> </span>execute<span class="_"> </span>a</div><div class="t m5 x1d h26 y4ef5 ff7 fs19 fc1 sc0 ls0 ws0">program.<span class="_"> </span>T<span class="_ _1"></span>hat<span class="_"> </span>is<span class="_ _1"></span>,<span class="_"> </span>if<span class="_"> </span>there<span class="_"> </span>is<span class="_ _13"> </span>some<span class="_"> </span>chain<span class="_"> </span>of<span class="_"> </span>data<span class="_"> </span>dependencies<span class="_"> </span>in<span class="_"> </span>a<span class="_ _13"> </span>program<span class="_"> </span>where</div><div class="t m5 x1d h26 y4ef6 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _16"> </span>sum<span class="_ _16"> </span>of<span class="_ _16"> </span>all<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _14"> </span>latencies<span class="_ _16"> </span>along<span class="_ _16"> </span>that<span class="_ _16"> </span>chain<span class="_ _16"> </span>equals<span class="_ _16"> </span><span class="ff11">T<span class="_ _13"> </span></span>,<span class="_ _14"> </span>then<span class="_ _16"> </span>the<span class="_ _16"> </span>program<span class="_ _16"> </span>will</div><div class="t m5 x1d h26 y4ef7 ff7 fs19 fc1 sc0 ls0 ws0">require<span class="_"> </span>at<span class="_"> </span>least<span class="_"> </span><span class="ff11">T<span class="_ _f"> </span></span>cycles<span class="_"> </span>to<span class="_"> </span>execute<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y4ef8 ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _14"> </span>have<span class="_ _14"> </span>also<span class="_ _14"> </span>seen<span class="_ _14"> </span>that<span class="_ _15"> </span>the<span class="_ _14"> </span>throughput<span class="_ _14"> </span>bounds<span class="_ _14"> </span>of<span class="_ _14"> </span>the<span class="_ _14"> </span>functional<span class="_ _14"> </span>units<span class="_ _14"> </span>also</div><div class="t m5 x1d h26 y4ef9 ff7 fs19 fc1 sc0 ls0 ws0">impose<span class="_ _21"> </span>a<span class="_ _f"> </span>lower<span class="_ _f"> </span>bound<span class="_ _f"> </span>on<span class="_ _f"> </span>the<span class="_ _21"> </span>execution<span class="_ _f"> </span>time<span class="_ _f"> </span>for<span class="_ _f"> </span>a<span class="_ _f"> </span>program.<span class="_ _21"> </span>That<span class="_ _21"> </span>is<span class="_ _1"></span>,<span class="_ _e"> </span>assume</div><div class="t m5 x1d h26 y4efa ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_ _16"> </span>a<span class="_ _14"> </span>program<span class="_ _14"> </span>requires<span class="_ _14"> </span>a<span class="_ _16"> </span>total<span class="_ _14"> </span>of<span class="_ _14"> </span><span class="ff11">N<span class="_ _f"> </span></span>computations<span class="_ _14"> </span>of<span class="_ _14"> </span>some<span class="_ _14"> </span>operation,<span class="_ _14"> </span>that<span class="_ _14"> </span>the</div><div class="t m5 x1d h26 y4efb ff7 fs19 fc1 sc0 ls0 ws0">microprocessor<span class="_"> </span>has<span class="_"> </span><span class="ff11">C<span class="_"> </span></span>functional<span class="_"> </span>units<span class="_"> </span>capable<span class="_"> </span>of<span class="_"> </span>performing<span class="_"> </span>that<span class="_"> </span>operation,<span class="_"> </span>and</div><div class="t m5 x1d h26 y4efc ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_ _16"> </span>these<span class="_ _14"> </span>units<span class="_ _16"> </span>have<span class="_ _14"> </span>an<span class="_ _16"> </span>issue<span class="_ _16"> </span>time<span class="_ _14"> </span>of<span class="_ _16"> </span><span class="ff11">I<span class="_ _a"> </span></span>.<span class="_ _14"> </span>T<span class="_ _1"></span>hen<span class="_ _14"> </span>the<span class="_ _16"> </span>program<span class="_ _14"> </span>will<span class="_ _16"> </span>require<span class="_ _14"> </span>at<span class="_ _16"> </span>least</div><div class="t m5 x1d h45 y4efd ff11 fs19 fc1 sc0 ls0 ws0">N</div><div class="t m5 x1d5 h45 y4efe ff11 fs19 fc1 sc0 ls0 ws0">.</div><div class="t m5 xa4 h26 y4efd ff11 fs19 fc1 sc0 ls222 ws0">I/<span class="_ _1"></span>C<span class="_ _13"> </span><span class="ff7 ls0">cycles<span class="_"> </span>to<span class="_"> </span>execute<span class="_ _1"></span>.</span></div><div class="t m5 x29 h26 y4eff ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _13"> </span>this<span class="_ _13"> </span>section,<span class="_"> </span>we<span class="_ _13"> </span>will<span class="_ _13"> </span>consider<span class="_ _13"> </span>some<span class="_"> </span>other<span class="_ _13"> </span>factors<span class="_ _13"> </span>that<span class="_ _13"> </span>limit<span class="_ _13"> </span>the<span class="_"> </span>performance</div><div class="t m5 x1d h26 y4f00 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span>programs<span class="_"> </span>on<span class="_"> </span>actual<span class="_"> </span>machines<span class="_ _1"></span>.</div><div class="t m5 x1d h41 y4f01 ffe fs29 fc1 sc0 ls0 ws0">5.11.1<span class="_ _48"> </span><span class="fs19">Register<span class="_"> </span>Spilling</span></div><div class="t m5 x1d h26 y4f02 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _16"> </span>beneﬁts<span class="_"> </span>of<span class="_ _16"> </span>loop<span class="_ _11"> </span>parallelism<span class="_ _11"> </span>are<span class="_ _11"> </span>limited<span class="_ _16"> </span>by<span class="_ _11"> </span>the<span class="_ _11"> </span>ability<span class="_ _11"> </span>to<span class="_ _16"> </span>express<span class="_ _11"> </span>the<span class="_ _11"> </span>compu-</div><div class="t m5 x1d h26 y4f03 ff7 fs19 fc1 sc0 ls0 ws0">tation<span class="_"> </span>in<span class="_ _11"> </span>assembly<span class="_ _11"> </span>code<span class="_ _0"></span>.<span class="_"> </span>If<span class="_ _11"> </span>a<span class="_ _11"> </span>program<span class="_ _11"> </span>has<span class="_ _11"> </span>a<span class="_"> </span>degree<span class="_ _11"> </span>of<span class="_ _11"> </span>parallelism<span class="_ _11"> </span><span class="ff11">P<span class="_ _f"> </span></span>that<span class="_ _11"> </span>exceeds</div><div class="t m5 x1d h26 y4f04 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _16"> </span>number<span class="_ _16"> </span>of<span class="_ _16"> </span>available<span class="_ _16"> </span>registers<span class="_ _1"></span>,<span class="_ _14"> </span>then<span class="_ _16"> </span>the<span class="_ _16"> </span>compiler<span class="_ _14"> </span>will<span class="_ _16"> </span>resort<span class="_ _16"> </span>to<span class="_ _16"> </span><span class="ffa">spilling<span class="_ _2"></span></span>,<span class="_ _14"> </span>stor<span class="_ _1"></span>-</div><div class="t m5 x1d h26 y4f05 ff7 fs19 fc1 sc0 ls0 ws0">ing<span class="_"> </span>some<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>temporary<span class="_"> </span>values<span class="_ _13"> </span>in<span class="_"> </span>memory<span class="_ _3"></span>,<span class="_"> </span>typically<span class="_"> </span>by<span class="_"> </span>allocating<span class="_"> </span>space<span class="_"> </span>on<span class="_"> </span>the</div><div class="t m5 x1d h26 y4f06 ff7 fs19 fc1 sc0 ls0 ws0">run-time<span class="_ _16"> </span>stack.<span class="_ _11"> </span>As<span class="_ _16"> </span>an<span class="_ _16"> </span>example<span class="_ _1"></span>,<span class="_ _16"> </span>the<span class="_ _16"> </span>following<span class="_ _16"> </span>measurements<span class="_ _11"> </span>compare<span class="_ _16"> </span>the<span class="_ _16"> </span>result</div><div class="t m5 x1d h46 y4f07 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span>extending<span class="_ _13"> </span>the<span class="_"> </span>multiple<span class="_"> </span>accumulator<span class="_"> </span>scheme<span class="_ _13"> </span>of<span class="_"> </span><span class="ffd">combine6<span class="_ _10"> </span></span>to<span class="_ _13"> </span>the<span class="_"> </span>cases<span class="_"> </span>of<span class="_ _13"> </span><span class="ff11">k<span class="_ _11"> </span><span class="ff12">=<span class="_ _13"> </span></span></span>10</div><div class="t m5 x1d h46 y4f08 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_"> </span><span class="ff11">k<span class="_ _10"> </span><span class="ff12">=<span class="_ _10"> </span></span></span><span class="ls24">20:</span></div><div class="t m5 x170 h31 y4f09 ff7 fs21 fc2 sc0 ls0 ws0">Integer<span class="_ _ba"> </span>Floating<span class="_"> </span>point</div><div class="t m5 x1d h31 y4f0a ff7 fs21 fc2 sc0 ls0 ws0">Function<span class="_ _76"> </span>Page<span class="_ _26"> </span>Method<span class="_ _107"> </span><span class="ffd fs1e ls20c">+*+*</span></div><div class="t m5 x1d h31 y4f0b ffd fs1e fc2 sc0 ls0 ws0">combine6<span class="_ _73"> </span><span class="ff7 fs21">573</span></div><div class="t m5 x167 h32 y4f0c ff7 fs21 fc2 sc0 ls0 ws0">10<span class="_"> </span><span class="ff12">×<span class="_ _13"></span></span>10<span class="_"> </span>unrolling<span class="_ _74"> </span>0.55<span class="_ _4f"> </span>1.00<span class="_ _14a"> </span>1.01<span class="_ _14a"> </span>0.52</div><div class="t m5 x167 h32 y4f0d ff7 fs21 fc2 sc0 ls0 ws0">20<span class="_"> </span><span class="ff12">×<span class="_ _13"></span></span>20<span class="_"> </span>unrolling<span class="_ _74"> </span>0.83<span class="_ _4f"> </span>1.03<span class="_ _14a"> </span>1.02<span class="_ _14a"> </span>0.68</div><div class="t m5 x1d h31 y4f0e ff7 fs21 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>hroughput<span class="_"> </span>bound<span class="_ _13f"> </span>0.50<span class="_ _14a"> </span>1.00<span class="_ _14a"> </span>1.00<span class="_ _4f"> </span>0.50</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
