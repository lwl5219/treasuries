<div id="pf260" class="pf w2 h11" data-page-no="260"><div class="pc pc260 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg260.png"/><div class="t m5 x5f h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Homework<span class="_ _10"> </span>Problems<span class="_ _1b"> </span><span class="ffe fs1e">607</span></div><div class="t m5 x2e h61 ye7 ff13 fs35 fc6 sc0 ls0 ws0">Inner<span class="_ _f"> </span>loop<span class="_ _f"> </span>of<span class="_ _f"> </span>inner4.<span class="_ _3d"> </span>data_t<span class="_ _f"> </span>=<span class="_ _e"> </span>double,<span class="_ _21"> </span>OP<span class="_ _f"> </span>=<span class="_ _e"> </span>*</div><div class="t m5 x2e h61 y26dc ff13 fs35 fc6 sc0 ls0 ws0">udata<span class="_ _f"> </span>in<span class="_ _f"> </span>%rbp,<span class="_ _f"> </span>vdata<span class="_ _e"> </span>in<span class="_ _21"> </span>%rax,<span class="_ _f"> </span>sum<span class="_ _e"> </span>in<span class="_ _21"> </span>%xmm0</div><div class="t m5 x2e h61 y5152 ff13 fs35 fc6 sc0 ls0 ws0">i<span class="_ _f"> </span>in<span class="_ _f"> </span>%rcx,<span class="_ _f"> </span>limit<span class="_ _e"> </span>in<span class="_ _21"> </span>%rbx</div><div class="t m5 x2c h2d yecc ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L15:<span class="_ _186"> </span></span><span class="ff2d fs35">loop:</span></div><div class="t m5 x2c h2d yecd ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">vmovsd<span class="_ _1a"> </span>0(%rbp,%rcx,8),<span class="_ _e"> </span>%xmm1<span class="_ _56"> </span></span><span class="ff13 fs35">Get<span class="_ _f"> </span>udata[i]</span></div><div class="t m5 x2c h2d yece ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">vmulsd<span class="_ _1a"> </span>(%rax,%rcx,8),<span class="_ _e"> </span>%xmm1,<span class="_ _1f"> </span>%xmm1<span class="_ _3a"> </span></span><span class="ff13 fs35">Multiply<span class="_ _f"> </span>by<span class="_ _f"> </span>vdata[i]</span></div><div class="t m5 x2c h2d yecf ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">vaddsd<span class="_ _1a"> </span>%xmm1,<span class="_ _e"> </span>%xmm0,<span class="_ _1f"> </span>%xmm0<span class="_ _10e"> </span></span><span class="ff13 fs35">Add<span class="_ _f"> </span>to<span class="_ _f"> </span>sum</span></div><div class="t m5 x2c h2d yed0 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">addq<span class="_ _46"> </span>$1,<span class="_ _e"> </span>%rcx<span class="_ _d2"> </span></span><span class="ff13 fs35">Increment<span class="_ _f"> </span>i</span></div><div class="t m5 x2c h2e y20fe ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 xd1 h2d y1a10 ffd fs1e fc2 sc0 ls0 ws0">cmpq<span class="_ _46"> </span>%rbx,<span class="_ _e"> </span>%rcx<span class="_ _189"> </span><span class="ff13 fs35 fc6">Compare<span class="_ _f"> </span>i:limit</span></div><div class="t m5 x2c h2d yed3 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">jne<span class="_ _8c"> </span>.L15<span class="_ _a4"> </span></span><span class="ff13 fs35">If<span class="_ _f"> </span>!=,<span class="_ _f"> </span>goto<span class="_ _e"> </span><span class="ff2d">loop</span></span></div><div class="t m5 x26 h26 y5153 ff7 fs19 fc2 sc0 ls0 ws0">Assume<span class="_ _13"> </span>that<span class="_ _13"> </span>the<span class="_"> </span>functional<span class="_ _13"> </span>units<span class="_ _13"> </span>have<span class="_ _13"> </span>the<span class="_ _13"> </span>characteristics<span class="_"> </span>listed<span class="_ _13"> </span>in<span class="_ _13"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>5.12.</div><div class="t m5 x34 h26 y5154 ff7 fs19 fc2 sc0 ls0 ws0">A.<span class="_ _1f"> </span>Diagram<span class="_ _16"> </span>how<span class="_ _11"> </span>this<span class="_ _16"> </span>instruction<span class="_ _16"> </span>sequence<span class="_ _16"> </span>would<span class="_ _16"> </span>be<span class="_ _16"> </span>decoded<span class="_ _16"> </span>into<span class="_ _11"> </span>operations</div><div class="t m5 x2d h26 y5155 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_"> </span>show<span class="_ _11"> </span>how<span class="_"> </span>the<span class="_ _11"> </span>data<span class="_"> </span>dependencies<span class="_ _11"> </span>between<span class="_"> </span>them<span class="_"> </span>would<span class="_ _11"> </span>create<span class="_"> </span>a<span class="_ _11"> </span>critical</div><div class="t m5 x2d h26 y5156 ff7 fs19 fc2 sc0 ls0 ws0">path<span class="_"> </span>of<span class="_"> </span>operations<span class="_ _1"></span>,<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>style<span class="_"> </span>of<span class="_"> </span>F<span class="_ _1"></span>igures<span class="_"> </span>5.13<span class="_"> </span>and<span class="_"> </span>5.14.</div><div class="t m5 x34 h26 y5157 ff7 fs19 fc2 sc0 ls0 ws0">B<span class="_ _3"></span>.<span class="_ _1d"> </span>F<span class="_ _1"></span>or<span class="_ _16"> </span>data<span class="_"> </span>type<span class="_ _16"> </span><span class="ffd">double</span>,<span class="_ _11"> </span>what<span class="_ _11"> </span>lower<span class="_ _16"> </span>bound<span class="_ _11"> </span>on<span class="_ _11"> </span>the<span class="_ _11"> </span>CPE<span class="_ _11"> </span>is<span class="_ _16"> </span>determined<span class="_ _11"> </span>by<span class="_ _11"> </span>the</div><div class="t m5 x2d h26 y5158 ff7 fs19 fc2 sc0 ls0 ws0">critical<span class="_"> </span>path?</div><div class="t m5 x34 h26 y5159 ff7 fs19 fc2 sc0 ls0 ws0">C.<span class="_ _25"> </span>Assuming<span class="_ _16"> </span>similar<span class="_ _16"> </span>instruction<span class="_ _16"> </span>sequences<span class="_ _14"> </span>for<span class="_ _16"> </span>the<span class="_ _16"> </span>integer<span class="_ _16"> </span>code<span class="_ _14"> </span>as<span class="_ _16"> </span>well,<span class="_ _14"> </span>what</div><div class="t m5 x2d h26 y515a ff7 fs19 fc2 sc0 ls0 ws0">lower<span class="_ _13"> </span>bound<span class="_ _13"> </span>on<span class="_ _13"> </span>the<span class="_"> </span>CPE<span class="_ _13"> </span>is<span class="_ _13"> </span>determined<span class="_ _13"> </span>by<span class="_ _13"> </span>the<span class="_ _13"> </span>critical<span class="_ _13"> </span>path<span class="_"> </span>for<span class="_ _13"> </span>integer<span class="_ _13"> </span>data?</div><div class="t m5 x34 h26 y515b ff7 fs19 fc2 sc0 ls0 ws0">D<span class="_ _3"></span>.<span class="_ _23"> </span>Explain<span class="_"> </span>how<span class="_ _13"> </span>the<span class="_ _13"> </span>ﬂoating-point<span class="_ _13"> </span>versions<span class="_"> </span>can<span class="_ _13"> </span>have<span class="_ _13"> </span>CPEs<span class="_ _13"> </span>of<span class="_ _13"> </span>3.00,<span class="_"> </span>even<span class="_ _13"> </span>though</div><div class="t m5 x2d h26 y515c ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>multiplication<span class="_"> </span>operation<span class="_"> </span>requires<span class="_"> </span>5<span class="_"> </span>clock<span class="_"> </span>cycles<span class="_ _3"></span>.</div><div class="t m5 x17 h73 y515d ffe fs1e fc6 sc0 ls0 ws0">5.14<span class="_ _23"> </span><span class="ff10 fs19">◆</span></div><div class="t m5 x17 h26 y515e ff7 fs19 fc1 sc0 ls0 ws0">Write<span class="_ _16"> </span>a<span class="_ _14"> </span>version<span class="_ _14"> </span>of<span class="_ _14"> </span>the<span class="_ _16"> </span>inner<span class="_ _14"> </span>product<span class="_ _14"> </span>procedure<span class="_ _14"> </span>described<span class="_ _16"> </span>in<span class="_ _14"> </span>Problem<span class="_ _14"> </span>5.13<span class="_ _16"> </span>that</div><div class="t m5 x17 h46 y515f ff7 fs19 fc1 sc0 ls0 ws0">uses<span class="_ _11"> </span>6<span class="_"> </span><span class="ff12">×<span class="_ _13"></span></span>1<span class="_"> </span>loop<span class="_ _11"> </span>unrolling.<span class="_ _11"> </span>F<span class="_ _1"></span>or<span class="_ _11"> </span>x86-64,<span class="_ _16"> </span>our<span class="_ _11"> </span>measurements<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>unrolled<span class="_ _11"> </span>version</div><div class="t m5 x17 h26 y5160 ff7 fs19 fc1 sc0 ls0 ws0">give<span class="_"> </span>a<span class="_"> </span>CPE<span class="_"> </span>of<span class="_"> </span>1.07<span class="_"> </span>for<span class="_"> </span>integer<span class="_"> </span>data<span class="_"> </span>but<span class="_"> </span>still<span class="_"> </span>3.01<span class="_"> </span>for<span class="_"> </span>both<span class="_"> </span>ﬂoating-point<span class="_"> </span>data.</div><div class="t m5 x34 h26 y5161 ff7 fs19 fc1 sc0 ls0 ws0">A.<span class="_ _1f"> </span>Explain<span class="_"> </span>why<span class="_"> </span>any<span class="_ _13"> </span>(scalar)<span class="_"> </span>version<span class="_"> </span>of<span class="_"> </span>an<span class="_"> </span>inner<span class="_"> </span>product<span class="_"> </span>procedure<span class="_ _13"> </span>running<span class="_"> </span>on</div><div class="t m5 x2d h26 y5162 ff7 fs19 fc1 sc0 ls0 ws0">an<span class="_"> </span>Intel<span class="_"> </span>Core<span class="_"> </span>i7<span class="_"> </span>Haswell<span class="_"> </span>processor<span class="_"> </span>cannot<span class="_"> </span>achieve<span class="_"> </span>a<span class="_"> </span>CPE<span class="_"> </span>less<span class="_"> </span>than<span class="_"> </span>1.00.</div><div class="t m5 x34 h26 y5163 ff7 fs19 fc1 sc0 ls0 ws0">B<span class="_ _3"></span>.<span class="_ _1d"> </span>Explain<span class="_ _16"> </span>why<span class="_ _11"> </span>the<span class="_ _11"> </span>performance<span class="_ _16"> </span>for<span class="_ _11"> </span>ﬂoating-point<span class="_ _11"> </span>data<span class="_ _16"> </span>did<span class="_ _11"> </span>not<span class="_ _11"> </span>improve<span class="_ _16"> </span>with</div><div class="t m5 x2d h26 y5164 ff7 fs19 fc1 sc0 ls0 ws0">loop<span class="_"> </span>unrolling.</div><div class="t m5 x17 h73 y5165 ffe fs1e fc6 sc0 ls0 ws0">5.15<span class="_ _23"> </span><span class="ff10 fs19">◆</span></div><div class="t m5 x17 h26 y5166 ff7 fs19 fc1 sc0 ls0 ws0">Write<span class="_ _16"> </span>a<span class="_ _14"> </span>version<span class="_ _14"> </span>of<span class="_ _14"> </span>the<span class="_ _16"> </span>inner<span class="_ _14"> </span>product<span class="_ _14"> </span>procedure<span class="_ _14"> </span>described<span class="_ _16"> </span>in<span class="_ _14"> </span>Problem<span class="_ _14"> </span>5.13<span class="_ _16"> </span>that</div><div class="t m5 x17 h46 y5167 ff7 fs19 fc1 sc0 ls0 ws0">uses<span class="_"> </span>6<span class="_"> </span><span class="ff12">×<span class="_ _13"></span></span>6<span class="_"> </span>loop<span class="_"> </span>unrolling.<span class="_"> </span>Our<span class="_"> </span>measurements<span class="_ _11"> </span>for<span class="_"> </span>this<span class="_"> </span>function<span class="_ _11"> </span>with<span class="_"> </span>x86-64<span class="_"> </span>give<span class="_ _11"> </span>a</div><div class="t m5 x17 h26 y5168 ff7 fs19 fc1 sc0 ls0 ws0">CPE<span class="_"> </span>of<span class="_"> </span>1.06<span class="_"> </span>for<span class="_"> </span>integer<span class="_"> </span>data<span class="_"> </span>and<span class="_"> </span>1.01<span class="_"> </span>for<span class="_"> </span>ﬂoating-point<span class="_"> </span>data.</div><div class="t m5 x26 h26 y5169 ff7 fs19 fc1 sc0 ls0 ws0">What<span class="_"> </span>factor<span class="_"> </span>limits<span class="_"> </span>the<span class="_"> </span>performance<span class="_"> </span>to<span class="_"> </span>a<span class="_"> </span>CPE<span class="_"> </span>of<span class="_"> </span>1.00?</div><div class="t m5 x17 h73 y516a ffe fs1e fc6 sc0 ls0 ws0">5.16<span class="_ _23"> </span><span class="ff10 fs19">◆</span></div><div class="t m5 x17 h26 y516b ff7 fs19 fc1 sc0 ls0 ws0">Write<span class="_ _16"> </span>a<span class="_ _14"> </span>version<span class="_ _14"> </span>of<span class="_ _14"> </span>the<span class="_ _16"> </span>inner<span class="_ _14"> </span>product<span class="_ _14"> </span>procedure<span class="_ _14"> </span>described<span class="_ _16"> </span>in<span class="_ _14"> </span>Problem<span class="_ _14"> </span>5.13<span class="_ _16"> </span>that</div><div class="t m5 x17 h46 y516c ff7 fs19 fc1 sc0 ls0 ws0">uses<span class="_ _16"> </span>6<span class="_ _13"> </span><span class="ff12">×<span class="_ _10"> </span></span>1<span class="_ _1"></span><span class="ff11">a<span class="_ _14"> </span><span class="ff7">loop<span class="_ _16"> </span>unrolling<span class="_ _16"> </span>to<span class="_ _16"> </span>enable<span class="_ _16"> </span>greater<span class="_ _11"> </span>parallelism.<span class="_ _16"> </span>Our<span class="_ _16"> </span>measurements<span class="_ _16"> </span>for</span></span></div><div class="t m5 x17 h26 y516d ff7 fs19 fc1 sc0 ls0 ws0">this<span class="_"> </span>function<span class="_"> </span>give<span class="_"> </span>a<span class="_"> </span>CPE<span class="_"> </span>of<span class="_"> </span>1.10<span class="_"> </span>for<span class="_"> </span>integer<span class="_"> </span>data<span class="_"> </span>and<span class="_"> </span>1.05<span class="_"> </span>for<span class="_"> </span>ﬂoating-point<span class="_"> </span>data.</div><div class="t m5 x17 h73 y516e ffe fs1e fc6 sc0 ls0 ws0">5.17<span class="_ _23"> </span><span class="ff10 fs19">◆◆</span></div><div class="t m5 x17 h26 y516f ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>library<span class="_"> </span>function<span class="_"> </span><span class="ffd">memset<span class="_ _10"> </span></span>has<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>prototype:</div><div class="t m5 x17 h2d y1db4 ffd fs1e fc2 sc0 ls0 ws0">void<span class="_ _e"> </span>*memset(void<span class="_ _1f"> </span>*s,<span class="_ _1f"> </span>int<span class="_ _e"> </span>c,<span class="_ _1f"> </span>size_t<span class="_ _e"> </span>n);</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
