<div id="pf3e5" class="pf w2 h11" data-page-no="3e5"><div class="pc pc3e5 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg3e5.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">996<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>11<span class="_ _3d"> </span>Network<span class="_ _10"> </span>Programming</span></div><div class="t m5 x133 h2c y27f ffa fs16 fc2 sc0 ls0 ws0">code/netp/tiny/tiny<span class="_ _1"></span>.c</div><div class="t m5 x1f h2e y280 ff6 fs20 fc6 sc0 ls0 ws0">1</div><div class="t m5 x4f h2d yad1 ffd fs1e fc2 sc0 ls0 ws0">void<span class="_ _e"> </span>read_requesthdrs(rio_t<span class="_ _1f"> </span>*rp)</div><div class="t m5 x1f h2d y281 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x1f h2d yad2 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2">char<span class="_ _e"> </span>buf[MAXLINE];</span></div><div class="t m5 x1f h2e yad3 ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 x1f h2e y61b4 ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x33 h2d y285 ffd fs1e fc2 sc0 ls0 ws0">Rio_readlineb(rp,<span class="_ _e"> </span>buf,<span class="_ _1f"> </span>MAXLINE);</div><div class="t m5 x1f h2d yad4 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _20"> </span><span class="ffd fs1e fc2">while(strcmp(buf,<span class="_ _e"> </span>&quot;\r\n&quot;))<span class="_ _1f"> </span>{</span></div><div class="t m5 x1f h2d yad5 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _70"> </span><span class="ffd fs1e fc2">Rio_readlineb(rp,<span class="_ _e"> </span>buf,<span class="_ _1f"> </span>MAXLINE);</span></div><div class="t m5 x1f h2d yad6 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _70"> </span><span class="ffd fs1e fc2">printf(&quot;%s&quot;,<span class="_ _e"> </span>buf);</span></div><div class="t m5 x1f h2d y496b ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1b0 h2d y50d4 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _20"> </span><span class="ffd fs1e fc2">return;</span></div><div class="t m5 x1b0 h2d y4a9c ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x133 h2c y7e09 ffa fs16 fc2 sc0 ls0 ws0">code/netp/tiny/tiny<span class="_ _1"></span>.c</div><div class="t m5 x1d h2f y7e0a ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>11.32<span class="_ _66"> </span><span class="ff1b fc1 ls2e6">Ti<span class="_ _5"></span>n<span class="_ _5"></span>y</span></div><div class="t m5 xd h3a y27e8 ffd fs19 fc1 sc0 ls0 ws0">read_requesthdrs<span class="_ _10"> </span><span class="ffe fs16">reads<span class="_"> </span>and<span class="_"> </span>ignores<span class="_"> </span>request<span class="_"> </span>headers.</span></div><div class="t m5 x1d h26 yeb1 ff7 fs19 fc1 sc0 ls0 ws0">status<span class="_ _11"> </span>code<span class="_ _11"> </span>and<span class="_ _16"> </span>status<span class="_ _11"> </span>message<span class="_ _11"> </span>in<span class="_ _16"> </span>the<span class="_"> </span>response<span class="_ _16"> </span>line<span class="_ _1"></span>,<span class="_ _16"> </span>along<span class="_ _11"> </span>with<span class="_ _11"> </span>an<span class="_ _16"> </span>HTML<span class="_ _11"> </span>ﬁle<span class="_ _11"> </span>in</div><div class="t m5 x1d h26 y4955 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>response<span class="_"> </span>body<span class="_"> </span>that<span class="_"> </span>explains<span class="_"> </span>the<span class="_"> </span>error<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>browser’s<span class="_"> </span>user<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y7e0b ff7 fs19 fc1 sc0 ls0 ws0">Recall<span class="_ _6"> </span>that<span class="_ _6"> </span>an<span class="_ _13"> </span>HTML<span class="_ _a"> </span>response<span class="_ _13"> </span>should<span class="_ _a"> </span>indicate<span class="_ _13"> </span>the<span class="_ _a"> </span>size<span class="_ _13"> </span>and<span class="_ _6"> </span>type<span class="_ _6"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>content</div><div class="t m5 x1d h26 y7e0c ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_"> </span>the<span class="_"> </span>body<span class="_ _3"></span>.<span class="_"> </span>T<span class="_ _1"></span>hus<span class="_ _1"></span>,<span class="_"> </span>we<span class="_"> </span>have<span class="_"> </span>opted<span class="_"> </span>to<span class="_"> </span>build<span class="_"> </span>the<span class="_"> </span>HTML<span class="_"> </span>content<span class="_"> </span>as<span class="_"> </span>a<span class="_"> </span>single<span class="_"> </span>string<span class="_"> </span>so</div><div class="t m5 x1d h26 y7e0d ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_ _14"> </span>we<span class="_ _14"> </span>can<span class="_ _14"> </span>easily<span class="_ _14"> </span>determine<span class="_ _15"> </span>its<span class="_ _14"> </span>size<span class="_ _1"></span>.<span class="_ _15"> </span>Also<span class="_ _1"></span>,<span class="_ _15"> </span>notice<span class="_ _14"> </span>that<span class="_ _15"> </span>we<span class="_ _14"> </span>are<span class="_ _14"> </span>using<span class="_ _14"> </span>the<span class="_ _14"> </span>robust</div><div class="t m5 x1d h26 y7e0e ffd fs19 fc1 sc0 ls0 ws0">rio_writen<span class="_ _10"> </span><span class="ff7">function<span class="_"> </span>from<span class="_"> </span>F<span class="_ _0"></span>igure<span class="_"> </span>10.4<span class="_"> </span>for<span class="_"> </span>all<span class="_"> </span>output.</span></div><div class="t m5 x1d h42 y7e0f ff6 fs29 fc6 sc0 ls0 ws0">The<span class="_ _11"> </span><span class="ffd fs2b">read_requesthdrs<span class="_ _16"> </span></span>Function</div><div class="t m5 x1d h26 y5183 ff9 fs19 fc1 sc0 ls0 ws0">T<span class="_ _3"></span>iny<span class="_ _6"> </span><span class="ff7">does<span class="_ _13"> </span>not<span class="_ _a"> </span>use<span class="_ _13"> </span>any<span class="_ _a"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>information<span class="_ _a"> </span>in<span class="_ _6"> </span>the<span class="_ _13"> </span>request<span class="_ _a"> </span>headers<span class="_ _1"></span>.<span class="_ _13"> </span>It<span class="_ _a"> </span>simply<span class="_ _6"> </span>reads<span class="_ _13"> </span>and</span></div><div class="t m5 x1d h26 y5184 ff7 fs19 fc1 sc0 ls0 ws0">ignores<span class="_ _16"> </span>them<span class="_ _16"> </span>by<span class="_ _11"> </span>calling<span class="_ _16"> </span>the<span class="_ _16"> </span><span class="ffd">read_requesthdrs<span class="_ _16"> </span></span>function<span class="_ _16"> </span>in<span class="_ _16"> </span>F<span class="_ _1"></span>igure<span class="_ _16"> </span>11.32.<span class="_ _16"> </span>Notice</div><div class="t m5 x1d h26 y5185 ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_"> </span>the<span class="_"> </span>empty<span class="_ _13"> </span>text<span class="_"> </span>line<span class="_"> </span>that<span class="_"> </span>terminates<span class="_"> </span>the<span class="_"> </span>request<span class="_ _13"> </span>headers<span class="_"> </span>consists<span class="_"> </span>of<span class="_"> </span>a<span class="_"> </span>carriage</div><div class="t m5 x1d h26 y7e10 ff7 fs19 fc1 sc0 ls0 ws0">return<span class="_"> </span>and<span class="_"> </span>line<span class="_"> </span>feed<span class="_"> </span>pair,<span class="_"> </span>which<span class="_"> </span>we<span class="_"> </span>check<span class="_"> </span>for<span class="_"> </span>in<span class="_"> </span>line<span class="_"> </span>6.</div><div class="t m5 x1d h42 y646e ff6 fs29 fc6 sc0 ls0 ws0">The<span class="_ _11"> </span><span class="ffd fs2b">parse_uri<span class="_ _16"> </span></span>Function</div><div class="t m5 x1d h26 y2455 ff9 fs19 fc1 sc0 ls0 ws0">T<span class="_ _3"></span>iny<span class="_ _13"> </span><span class="ff7">assumes<span class="_ _13"> </span>that<span class="_ _13"> </span>the<span class="_ _13"> </span>home<span class="_ _13"> </span>directory<span class="_ _13"> </span>for<span class="_ _13"> </span>static<span class="_ _6"> </span>content<span class="_ _13"> </span>is<span class="_ _13"> </span>its<span class="_ _13"> </span>current<span class="_ _13"> </span>directory<span class="_ _13"> </span>and</span></div><div class="t m5 x1d h26 y2456 ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_"> </span>the<span class="_ _13"> </span>home<span class="_"> </span>directory<span class="_ _13"> </span>for<span class="_"> </span>executables<span class="_ _13"> </span>is<span class="_"> </span><span class="ffd">./cgi-bin</span>.<span class="_ _13"> </span>Any<span class="_"> </span>URI<span class="_ _13"> </span>that<span class="_"> </span>contains<span class="_ _13"> </span>the</div><div class="t m5 x1d h26 y2457 ff7 fs19 fc1 sc0 ls0 ws0">string<span class="_ _11"> </span><span class="ffd">cgi-bin<span class="_ _16"> </span></span>is<span class="_ _11"> </span>assumed<span class="_ _11"> </span>to<span class="_ _11"> </span>denote<span class="_ _16"> </span>a<span class="_ _11"> </span>request<span class="_ _11"> </span>for<span class="_ _16"> </span>dynamic<span class="_ _11"> </span>content.<span class="_ _11"> </span>The<span class="_"> </span>default</div><div class="t m5 x1d h26 y2458 ff7 fs19 fc1 sc0 ls0 ws0">ﬁlename<span class="_"> </span>is<span class="_"> </span><span class="ffd">./home.html</span>.</div><div class="t m5 x29 h26 y2459 ff7 fs19 fc1 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _16"> </span><span class="ffd ls0">parse_uri<span class="_ _11"> </span><span class="ff7">function<span class="_ _16"> </span>in<span class="_"> </span>Figure<span class="_"> </span>11.33<span class="_ _16"> </span>implements<span class="_ _11"> </span>these<span class="_ _11"> </span>policies<span class="_ _1"></span>.<span class="_ _11"> </span>It<span class="_ _16"> </span>parses</span></span></div><div class="t m5 x1d h26 y4fe ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _16"> </span>URI<span class="_ _16"> </span>into<span class="_ _16"> </span>a<span class="_ _16"> </span>ﬁlename<span class="_ _16"> </span>and<span class="_ _16"> </span>an<span class="_ _16"> </span>optional<span class="_ _16"> </span>CGI<span class="_ _16"> </span>argument<span class="_ _16"> </span>string<span class="_ _0"></span>.<span class="_ _16"> </span>If<span class="_ _16"> </span>the<span class="_ _16"> </span>request<span class="_ _16"> </span>is</div><div class="t m5 x1d h26 y4ff ff7 fs19 fc1 sc0 ls0 ws0">for<span class="_ _14"> </span>static<span class="_ _15"> </span>content<span class="_ _14"> </span>(line<span class="_ _15"> </span>5),<span class="_ _15"> </span>we<span class="_ _15"> </span>clear<span class="_ _15"> </span>the<span class="_ _14"> </span>CGI<span class="_ _15"> </span>argument<span class="_ _14"> </span>string<span class="_ _15"> </span>(line<span class="_ _15"> </span>6)<span class="_ _14"> </span>and<span class="_ _15"> </span>then</div><div class="t m5 x1d h26 y500 ff7 fs19 fc1 sc0 ls0 ws0">convert<span class="_ _6"> </span>the<span class="_ _13"> </span>URI<span class="_ _6"> </span>into<span class="_ _13"> </span>a<span class="_ _6"> </span>relative<span class="_ _13"> </span>Linux<span class="_ _6"> </span>pathname<span class="_ _13"> </span>such<span class="_ _6"> </span>as<span class="_ _13"> </span><span class="ffd">./index.html<span class="_ _6"> </span></span>(lines<span class="_ _6"> </span>7–8).</div><div class="t m5 x1d h26 y501 ff7 fs19 fc1 sc0 ls0 ws0">If<span class="_"> </span>the<span class="_ _13"> </span>URI<span class="_"> </span>ends<span class="_ _13"> </span>with<span class="_"> </span>a<span class="_"> </span>‘<span class="ffd">/</span>’<span class="_ _13"> </span>character<span class="_"> </span>(line<span class="_"> </span>9),<span class="_ _13"> </span>then<span class="_"> </span>we<span class="_"> </span>append<span class="_ _13"> </span>the<span class="_"> </span>default<span class="_ _13"> </span>ﬁlename</div><div class="t m5 x1d h26 y502 ff7 fs19 fc1 sc0 ls0 ws0">(line<span class="_ _16"> </span>10).<span class="_ _11"> </span>On<span class="_ _16"> </span>the<span class="_ _16"> </span>other<span class="_ _16"> </span>hand,<span class="_ _16"> </span>if<span class="_ _16"> </span>the<span class="_ _16"> </span>request<span class="_ _16"> </span>is<span class="_ _11"> </span>for<span class="_ _16"> </span>dynamic<span class="_ _16"> </span>content<span class="_ _16"> </span>(line<span class="_ _16"> </span>13),<span class="_ _16"> </span>we</div><div class="t m5 x1d h26 y503 ff7 fs19 fc1 sc0 ls0 ws0">extract<span class="_ _13"> </span>any<span class="_ _13"> </span>CGI<span class="_ _6"> </span>arguments<span class="_ _13"> </span>(lines<span class="_ _13"> </span>14–20)<span class="_ _13"> </span>and<span class="_ _13"> </span>convert<span class="_ _13"> </span>the<span class="_ _6"> </span>remaining<span class="_ _13"> </span>portion<span class="_ _13"> </span>of<span class="_ _13"> </span>the</div><div class="t m5 x1d h26 y504 ff7 fs19 fc1 sc0 ls0 ws0">URI<span class="_"> </span>to<span class="_"> </span>a<span class="_"> </span>relative<span class="_"> </span>Linux<span class="_"> </span>ﬁlename<span class="_"> </span>(lines<span class="_"> </span>21–22).</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
