<div id="pf12e" class="pf w2 h11" data-page-no="12e"><div class="pc pc12e w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg12e.png"/><div class="t m5 xa1 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>3.9<span class="_ _60"> </span>Heterogeneous<span class="_ _10"> </span>Data<span class="_ _10"> </span>Structures<span class="_ _3e"> </span><span class="ffe fs1e">301</span></div><div class="t m5 x17 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">bounds<span class="_ _1"></span>.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span>need<span class="_ _13"> </span>for<span class="_ _6"> </span>two<span class="_ _13"> </span>values<span class="_ _13"> </span>does<span class="_ _13"> </span>not<span class="_ _6"> </span>show<span class="_ _13"> </span>up<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_ _6"> </span>C<span class="_ _13"> </span>code<span class="_ _1"></span>,<span class="_ _13"> </span>due<span class="_ _13"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>scaling</div><div class="t m5 x17 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_"> </span>pointer<span class="_"> </span>arithmetic.</div><div class="t m5 x26 h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _11"> </span>have<span class="_ _11"> </span>seen<span class="_ _11"> </span>that,<span class="_ _11"> </span>with<span class="_ _11"> </span>optimizations<span class="_"> </span>enabled,<span class="_ _16"> </span><span class="ff9">gcc<span class="_ _10"> </span></span>is<span class="_ _11"> </span>able<span class="_ _11"> </span>to<span class="_ _11"> </span>recognize<span class="_ _11"> </span>pat-</div><div class="t m5 x17 h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">terns<span class="_ _13"> </span>that<span class="_ _13"> </span>arise<span class="_ _13"> </span>when<span class="_ _13"> </span>a<span class="_"> </span>program<span class="_ _13"> </span>steps<span class="_ _13"> </span>through<span class="_ _13"> </span>the<span class="_ _13"> </span>elements<span class="_ _13"> </span>of<span class="_ _13"> </span>a<span class="_ _13"> </span>multidimensional</div><div class="t m5 x17 h26 y2f8 ff7 fs19 fc2 sc0 ls0 ws0">array<span class="_ _3"></span>.<span class="_ _11"> </span>It<span class="_ _16"> </span>can<span class="_ _11"> </span>then<span class="_ _16"> </span>generate<span class="_ _16"> </span>code<span class="_ _11"> </span>that<span class="_ _16"> </span>avoids<span class="_ _11"> </span>the<span class="_ _16"> </span>multiplication<span class="_ _11"> </span>that<span class="_ _16"> </span>would<span class="_ _11"> </span>result</div><div class="t m5 x17 h26 y2f9 ff7 fs19 fc2 sc0 ls0 ws0">from<span class="_"> </span>a<span class="_ _13"> </span>direct<span class="_"> </span>application<span class="_ _13"> </span>of<span class="_"> </span>Equation<span class="_ _13"> </span>3.1.<span class="_"> </span>W<span class="_ _1"></span>hether<span class="_"> </span>it<span class="_ _13"> </span>generates<span class="_"> </span>the<span class="_ _13"> </span>pointer<span class="_ _1"></span>-based</div><div class="t m5 x17 h26 y2fa ff7 fs19 fc2 sc0 ls0 ws0">code<span class="_"> </span>of<span class="_"> </span>F<span class="_ _0"></span>igure<span class="_"> </span>3.37(b)<span class="_"> </span>or<span class="_"> </span>the<span class="_"> </span>array-based<span class="_ _11"> </span>code<span class="_"> </span>of<span class="_"> </span>F<span class="_ _0"></span>igure<span class="_"> </span>3.38(b),<span class="_"> </span>these<span class="_"> </span>optimiza-</div><div class="t m5 x17 h26 y2fb ff7 fs19 fc2 sc0 ls0 ws0">tions<span class="_"> </span>will<span class="_"> </span>signiﬁcantly<span class="_"> </span>improve<span class="_"> </span>program<span class="_"> </span>performance<span class="_ _1"></span>.</div><div class="t m5 x17 h3b y2b8d fff fs24 fc6 sc0 ls0 ws0">3.9<span class="_ _17"> </span><span class="ffe fs18">Heterogeneous<span class="_"> </span>Data<span class="_"> </span>Structures</span></div><div class="t m5 x17 h26 y2b8e ff7 fs19 fc1 sc0 ls0 ws0">C<span class="_ _11"> </span>provides<span class="_ _11"> </span>two<span class="_ _16"> </span>mechanisms<span class="_ _11"> </span>for<span class="_ _11"> </span>creating<span class="_ _16"> </span>data<span class="_ _11"> </span>types<span class="_ _11"> </span>by<span class="_ _16"> </span>combining<span class="_ _11"> </span>objects<span class="_ _11"> </span>of<span class="_ _11"> </span>dif-</div><div class="t m5 x17 h26 y2b8f ff7 fs19 fc1 sc0 ls0 ws0">ferent<span class="_ _16"> </span>types:<span class="_ _16"> </span><span class="ffa">structures</span>,<span class="_ _14"> </span>declared<span class="_ _16"> </span>using<span class="_ _16"> </span>the<span class="_ _16"> </span>keyword<span class="_ _16"> </span><span class="ffd">struct</span>,<span class="_ _14"> </span>aggregate<span class="_ _16"> </span>multiple</div><div class="t m5 x17 h26 y2b90 ff7 fs19 fc1 sc0 ls0 ws0">objects<span class="_ _14"> </span>into<span class="_ _15"> </span>a<span class="_ _14"> </span>single<span class="_ _15"> </span>unit;<span class="_ _f"> </span><span class="ffa">unions</span>,<span class="_ _21"> </span>declared<span class="_ _14"> </span>using<span class="_ _15"> </span>the<span class="_ _15"> </span>keyword<span class="_ _14"> </span><span class="ffd">union</span>,<span class="_ _21"> </span>allow<span class="_ _14"> </span>an</div><div class="t m5 x17 h26 y2b91 ff7 fs19 fc1 sc0 ls0 ws0">object<span class="_"> </span>to<span class="_"> </span>be<span class="_"> </span>referenced<span class="_"> </span>using<span class="_"> </span>several<span class="_"> </span>different<span class="_"> </span>types<span class="_ _1"></span>.</div><div class="t m5 x17 h41 y2b92 ffe fs29 fc1 sc0 ls0 ws0">3.9.1<span class="_ _48"> </span><span class="fs19">Structures</span></div><div class="t m5 x17 h26 y2b93 ff7 fs19 fc1 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _e"> </span>C<span class="_ _21"> </span><span class="ffd ls0">struct<span class="_ _f"> </span><span class="ff7">declaration<span class="_ _21"> </span>creates<span class="_ _f"> </span>a<span class="_ _21"> </span>data<span class="_ _21"> </span>type<span class="_ _f"> </span>that<span class="_ _21"> </span>groups<span class="_ _21"> </span>objects<span class="_ _f"> </span>of<span class="_ _21"> </span>possibly</span></span></div><div class="t m5 x17 h26 y2b94 ff7 fs19 fc1 sc0 ls0 ws0">different<span class="_ _16"> </span>types<span class="_ _11"> </span>into<span class="_ _16"> </span>a<span class="_ _16"> </span>single<span class="_ _16"> </span>object.<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span>different<span class="_ _16"> </span>components<span class="_ _16"> </span>of<span class="_ _16"> </span>a<span class="_ _11"> </span>structure<span class="_ _16"> </span>are</div><div class="t m5 x17 h26 y2b95 ff7 fs19 fc1 sc0 ls0 ws0">referenced<span class="_ _13"> </span>by<span class="_"> </span>names<span class="_ _3"></span>.<span class="_"> </span>T<span class="_ _3"></span>he<span class="_"> </span>implementation<span class="_ _13"> </span>of<span class="_ _13"> </span>structures<span class="_"> </span>is<span class="_ _13"> </span>similar<span class="_ _13"> </span>to<span class="_"> </span>that<span class="_ _13"> </span>of<span class="_ _13"> </span>arrays</div><div class="t m5 x17 h26 y2b96 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_ _11"> </span>that<span class="_ _16"> </span>all<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>components<span class="_ _16"> </span>of<span class="_ _11"> </span>a<span class="_ _16"> </span>structure<span class="_ _16"> </span>are<span class="_ _11"> </span>stored<span class="_ _16"> </span>in<span class="_ _16"> </span>a<span class="_ _11"> </span>contiguous<span class="_ _16"> </span>region<span class="_ _11"> </span>of</div><div class="t m5 x17 h26 y2b97 ff7 fs19 fc1 sc0 ls0 ws0">memory<span class="_"> </span>and<span class="_ _11"> </span>a<span class="_ _11"> </span>pointer<span class="_ _11"> </span>to<span class="_ _11"> </span>a<span class="_ _11"> </span>structure<span class="_ _11"> </span>is<span class="_ _11"> </span>the<span class="_ _11"> </span>address<span class="_ _11"> </span>of<span class="_ _11"> </span>its<span class="_ _11"> </span>ﬁrst<span class="_ _11"> </span>byte<span class="_ _0"></span>.<span class="_ _11"> </span>T<span class="_ _1"></span>he<span class="_ _11"> </span>compiler</div><div class="t m5 x17 h26 y2b98 ff7 fs19 fc1 sc0 ls0 ws0">maintains<span class="_ _21"> </span>information<span class="_ _f"> </span>about<span class="_ _f"> </span>each<span class="_ _f"> </span>structure<span class="_ _f"> </span>type<span class="_ _f"> </span>indicating<span class="_ _f"> </span>the<span class="_ _f"> </span>byte<span class="_ _f"> </span>offset<span class="_ _f"> </span>of</div><div class="t m5 x17 h26 y2b99 ff7 fs19 fc1 sc0 ls0 ws0">each<span class="_ _15"> </span>ﬁeld.<span class="_ _21"> </span>It<span class="_ _21"> </span>generates<span class="_ _15"> </span>references<span class="_ _21"> </span>to<span class="_ _21"> </span>structure<span class="_ _21"> </span>elements<span class="_ _15"> </span>using<span class="_ _21"> </span>these<span class="_ _21"> </span>offsets<span class="_ _21"> </span>as</div><div class="t m5 x17 h26 y2b9a ff7 fs19 fc1 sc0 ls0 ws0">displacements<span class="_"> </span>in<span class="_"> </span>memory<span class="_"> </span>referencing<span class="_"> </span>instructions<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y2b9b ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_"> </span>an<span class="_"> </span>example<span class="_ _1"></span>,<span class="_"> </span>consider<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>structure<span class="_"> </span>declaration:</div><div class="t m5 x17 h2d y2b9c ffd fs1e fc2 sc0 ls0 ws0">struct<span class="_ _e"> </span>rec<span class="_ _1f"> </span>{</div><div class="t m5 x1b6 h2d y2b9d ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>i;</div><div class="t m5 x1b6 h2d y2b9e ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>j;</div><div class="t m5 x1b6 h2d y2b9f ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>a[2];</div><div class="t m5 x1b6 h2d y2ba0 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>*p;</div><div class="t m5 x17 h2d y2ba1 ffd fs1e fc2 sc0 ls0 ws0">};</div><div class="t m5 x17 h26 y2ba2 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _16"> </span>structure<span class="_ _11"> </span>contains<span class="_ _11"> </span>four<span class="_ _16"> </span>ﬁelds:<span class="_ _11"> </span>two<span class="_ _11"> </span>4-byte<span class="_ _16"> </span>values<span class="_ _11"> </span>of<span class="_ _11"> </span>type<span class="_ _16"> </span><span class="ffd">int</span>,<span class="_ _11"> </span>a<span class="_ _16"> </span>two-element</div><div class="t m5 x17 h26 y2ba3 ff7 fs19 fc2 sc0 ls0 ws0">array<span class="_"> </span>of<span class="_"> </span>type<span class="_"> </span><span class="ffd">int</span>,<span class="_"> </span>and<span class="_"> </span>an<span class="_"> </span>8-byte<span class="_"> </span>integer<span class="_"> </span>pointer,<span class="_"> </span>giving<span class="_"> </span>a<span class="_"> </span>total<span class="_"> </span>of<span class="_"> </span>24<span class="_"> </span>bytes:</div><div class="t m5 x62 h3f y2ba4 ff26 fs27 fc1 sc0 ls0 ws0">Offset </div><div class="t m5 x17 h3f y2ba5 ff26 fs27 fc1 sc0 ls0 ws0">Contents </div><div class="t m5 x155 h40 y2ba6 ff22 fs28 fc1 sc0 ls0 ws0">i</div><div class="t m5 x1da h3f y2ba7 ff26 fs27 fc1 sc0 ls17a ws0">048<span class="_ _121"> </span>1<span class="_ _173"></span>6<span class="_ _5d"> </span>2<span class="_ _173"></span>4</div><div class="t m5 x4d h40 y2ba6 ff22 fs28 fc1 sc0 ls0 ws0">j<span class="_ _bd"> </span>a[0]<span class="_ _b9"> </span>a[1]<span class="_ _89"> </span>p</div><div class="t m5 x26 h26 y13c0 ff7 fs19 fc2 sc0 ls0 ws0">Observe<span class="_ _16"> </span>that<span class="_ _16"> </span>array<span class="_ _16"> </span><span class="ffd">a<span class="_ _16"> </span></span>is<span class="_ _16"> </span>embedded<span class="_ _14"> </span>within<span class="_ _16"> </span>the<span class="_ _16"> </span>structure<span class="_ _0"></span>.<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _14"> </span>numbers<span class="_ _16"> </span>along</div><div class="t m5 x17 h26 y13c1 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>top<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>diagram<span class="_"> </span>give<span class="_ _13"> </span>the<span class="_"> </span>byte<span class="_ _13"> </span>offsets<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>ﬁelds<span class="_ _13"> </span>from<span class="_"> </span>the<span class="_"> </span>beginning<span class="_ _13"> </span>of<span class="_"> </span>the</div><div class="t m5 x17 h26 y13c2 ff7 fs19 fc2 sc0 ls0 ws0">structure<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y13c3 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_ _11"> </span>access<span class="_ _11"> </span>the<span class="_"> </span>ﬁelds<span class="_ _11"> </span>of<span class="_ _11"> </span>a<span class="_"> </span>structure,<span class="_"> </span>the<span class="_ _11"> </span>compiler<span class="_"> </span>generates<span class="_ _11"> </span>code<span class="_ _11"> </span>that<span class="_"> </span>adds<span class="_ _11"> </span>the</div><div class="t m5 x17 h26 y1a80 ff7 fs19 fc2 sc0 ls0 ws0">appropriate<span class="_ _13"> </span>offset<span class="_ _13"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>address<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>structure<span class="_ _1"></span>.<span class="_ _13"> </span>F<span class="_ _1"></span>or<span class="_ _13"> </span>example,<span class="_ _13"> </span>suppose<span class="_ _13"> </span>variable<span class="_ _13"> </span><span class="ffd">r</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
