<div id="pfaa" class="pf w2 h11" data-page-no="aa"><div class="pc pcaa w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bgaa.png"/><div class="t m5 x5f h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Homework<span class="_ _10"> </span>Problems<span class="_ _1b"> </span><span class="ffe fs1e">169</span></div><div class="t m5 x17 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">(most<span class="_ _16"> </span>signiﬁcant).<span class="_ _16"> </span>Y<span class="_ _3"></span>ou<span class="_ _16"> </span>have<span class="_ _16"> </span>been<span class="_ _16"> </span>assigned<span class="_ _16"> </span>the<span class="_ _16"> </span>task<span class="_ _16"> </span>of<span class="_ _16"> </span>implementing<span class="_ _16"> </span>a<span class="_ _16"> </span>function</div><div class="t m5 x17 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">for<span class="_"> </span>a<span class="_ _13"> </span>machine<span class="_"> </span>using<span class="_"> </span>two’s-complement<span class="_ _13"> </span>arithmetic<span class="_"> </span>and<span class="_"> </span>arithmetic<span class="_"> </span>right<span class="_ _13"> </span>shifts<span class="_"> </span>with</div><div class="t m5 x17 h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>following<span class="_"> </span>prototype:</div><div class="t m5 x17 h2d y1aeb ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Declaration<span class="_ _1f"> </span>of<span class="_ _1f"> </span>data<span class="_ _e"> </span>type<span class="_ _1f"> </span>where<span class="_ _e"> </span>4<span class="_ _1f"> </span>bytes<span class="_ _1f"> </span>are<span class="_ _e"> </span>packed</div><div class="t m5 x2f h2d y1aec ffd fs1e fc2 sc0 ls0 ws0">into<span class="_ _e"> </span>an<span class="_ _1f"> </span>unsigned<span class="_ _1f"> </span>*/</div><div class="t m5 x17 h2d y1aed ffd fs1e fc2 sc0 ls0 ws0">typedef<span class="_ _e"> </span>unsigned<span class="_ _1f"> </span>packed_t;</div><div class="t m5 x17 h2d y1aee ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Extract<span class="_ _1f"> </span>byte<span class="_ _1f"> </span>from<span class="_ _e"> </span>word.<span class="_ _1a"> </span>Return<span class="_ _1f"> </span>as<span class="_ _e"> </span>signed<span class="_ _1f"> </span>integer<span class="_ _1f"> </span>*/</div><div class="t m5 x17 h2d y1aef ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>xbyte(packed_t<span class="_ _1f"> </span>word,<span class="_ _1f"> </span>int<span class="_ _e"> </span>bytenum);</div><div class="t m5 x26 h26 y1af0 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>hat<span class="_ _11"> </span>is<span class="_ _1"></span>,<span class="_ _11"> </span>the<span class="_ _11"> </span>function<span class="_ _11"> </span>will<span class="_"> </span>extract<span class="_ _11"> </span>the<span class="_ _11"> </span>designated<span class="_ _11"> </span>byte<span class="_"> </span>and<span class="_ _11"> </span>sign<span class="_ _11"> </span>extend<span class="_ _11"> </span>it<span class="_"> </span>to<span class="_ _11"> </span>be</div><div class="t m5 x17 h26 y1af1 ff7 fs19 fc2 sc0 ls0 ws0">a<span class="_"> </span>32-bit<span class="_"> </span><span class="ffd">int</span>.</div><div class="t m5 x26 h26 y1af2 ff7 fs19 fc2 sc0 ls0 ws0">Y<span class="_ _3"></span>our<span class="_ _13"> </span>predecessor<span class="_ _6"> </span>(who<span class="_ _13"> </span>was<span class="_ _13"> </span>ﬁred<span class="_ _6"> </span>for<span class="_ _13"> </span>incompetence)<span class="_ _6"> </span>wrote<span class="_ _13"> </span>the<span class="_ _13"> </span>following<span class="_ _6"> </span>code:</div><div class="t m5 x17 h2d y1af3 ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Failed<span class="_ _1f"> </span>attempt<span class="_ _1f"> </span>at<span class="_ _e"> </span>xbyte<span class="_ _1f"> </span>*/</div><div class="t m5 x17 h2d y1af4 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>xbyte(packed_t<span class="_ _1f"> </span>word,<span class="_ _1f"> </span>int<span class="_ _e"> </span>bytenum)</div><div class="t m5 x17 h2d y1af5 ffd fs1e fc2 sc0 ls0 ws0">{</div><div class="t m5 x1b6 h2d y1af6 ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>(word<span class="_ _1f"> </span>&gt;&gt;<span class="_ _1f"> </span>(bytenum<span class="_ _e"> </span>&lt;&lt;<span class="_ _1f"> </span>3))<span class="_ _e"> </span>&amp;<span class="_ _1f"> </span>0xFF;</div><div class="t m5 x17 h2d y1af7 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x34 h26 y1af8 ff7 fs19 fc2 sc0 ls0 ws0">A.<span class="_ _1f"> </span>What<span class="_"> </span>is<span class="_"> </span>wrong<span class="_"> </span>with<span class="_"> </span>this<span class="_"> </span>code?</div><div class="t m5 x34 h26 y1af9 ff7 fs19 fc2 sc0 ls0 ws0">B<span class="_ _3"></span>.<span class="_ _1d"> </span>Give<span class="_ _11"> </span>a<span class="_ _16"> </span>correct<span class="_"> </span>implementation<span class="_ _16"> </span>of<span class="_"> </span>the<span class="_ _16"> </span>function<span class="_"> </span>that<span class="_ _16"> </span>uses<span class="_ _11"> </span>only<span class="_ _11"> </span>left<span class="_ _11"> </span>and<span class="_ _11"> </span>right</div><div class="t m5 x2d h26 y1afa ff7 fs19 fc2 sc0 ls0 ws0">shifts<span class="_ _1"></span>,<span class="_"> </span>along<span class="_"> </span>with<span class="_"> </span>one<span class="_"> </span>subtraction.</div><div class="t m5 x17 h73 y1afb ffe fs1e fc6 sc0 ls0 ws0">2.72<span class="_ _23"> </span><span class="ff10 fs19">◆◆</span></div><div class="t m5 x17 h26 y1afc ff7 fs19 fc1 sc0 ls0 ws0">Y<span class="_ _3"></span>ou<span class="_ _11"> </span>are<span class="_ _16"> </span>given<span class="_ _16"> </span>the<span class="_ _11"> </span>task<span class="_ _16"> </span>of<span class="_ _16"> </span>writing<span class="_ _11"> </span>a<span class="_ _16"> </span>function<span class="_ _11"> </span>that<span class="_ _16"> </span>will<span class="_ _16"> </span>copy<span class="_ _11"> </span>an<span class="_ _16"> </span>integer<span class="_ _16"> </span><span class="ffd">val<span class="_ _11"> </span></span>into<span class="_ _16"> </span>a</div><div class="t m5 x17 h26 y1afd ff7 fs19 fc1 sc0 ls0 ws0">buffer<span class="_"> </span><span class="ffd">buf</span>,<span class="_"> </span>but<span class="_"> </span>it<span class="_"> </span>should<span class="_"> </span>do<span class="_"> </span>so<span class="_"> </span>only<span class="_"> </span>if<span class="_"> </span>enough<span class="_"> </span>space<span class="_"> </span>is<span class="_"> </span>available<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>buffer.</div><div class="t m5 x26 h26 y1afe ff7 fs19 fc1 sc0 ls0 ws0">Here<span class="_"> </span>is<span class="_"> </span>the<span class="_"> </span>code<span class="_"> </span>you<span class="_"> </span>write:</div><div class="t m5 x17 h2d y1aff ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Copy<span class="_ _1f"> </span>integer<span class="_ _1f"> </span>into<span class="_ _e"> </span>buffer<span class="_ _1f"> </span>if<span class="_ _e"> </span>space<span class="_ _1f"> </span>is<span class="_ _1f"> </span>available<span class="_ _e"> </span>*/</div><div class="t m5 x17 h2d y1b00 ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>WARNING:<span class="_ _1f"> </span>The<span class="_ _1f"> </span>following<span class="_ _e"> </span>code<span class="_ _1f"> </span>is<span class="_ _e"> </span>buggy<span class="_ _1f"> </span>*/</div><div class="t m5 x17 h2d y1b01 ffd fs1e fc2 sc0 ls0 ws0">void<span class="_ _e"> </span>copy_int(int<span class="_ _1f"> </span>val,<span class="_ _1f"> </span>void<span class="_ _e"> </span>*buf,<span class="_ _1f"> </span>int<span class="_ _e"> </span>maxbytes)<span class="_ _1f"> </span>{</div><div class="t m5 x1b6 h2d y1b02 ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>(maxbytes-sizeof(val)<span class="_ _1f"> </span>&gt;=<span class="_ _1f"> </span>0)</div><div class="t m5 x155 h2d y1b03 ffd fs1e fc2 sc0 ls0 ws0">memcpy(buf,<span class="_ _e"> </span>(void<span class="_ _1f"> </span>*)<span class="_ _1f"> </span>&amp;val,<span class="_ _e"> </span>sizeof(val));</div><div class="t m5 x17 h2d y1b04 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x26 h26 y1b05 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _11"> </span>code<span class="_ _11"> </span>makes<span class="_"> </span>use<span class="_ _11"> </span>of<span class="_"> </span>the<span class="_ _11"> </span>library<span class="_ _11"> </span>function<span class="_"> </span><span class="ffd">memcpy</span>.<span class="_ _11"> </span>Although<span class="_ _11"> </span>its<span class="_"> </span>use<span class="_ _11"> </span>is<span class="_ _11"> </span>a<span class="_"> </span>bit</div><div class="t m5 x17 h26 y1b06 ff7 fs19 fc2 sc0 ls0 ws0">artiﬁcial<span class="_ _14"> </span>here<span class="_ _1"></span>,<span class="_ _15"> </span>where<span class="_ _14"> </span>we<span class="_ _14"> </span>simply<span class="_ _16"> </span>want<span class="_ _14"> </span>to<span class="_ _14"> </span>copy<span class="_ _14"> </span>an<span class="_ _14"> </span><span class="ffd">int</span>,<span class="_ _15"> </span>it<span class="_ _16"> </span>illustrates<span class="_ _14"> </span>an<span class="_ _14"> </span>approach</div><div class="t m5 x17 h26 y1b07 ff7 fs19 fc2 sc0 ls0 ws0">commonly<span class="_"> </span>used<span class="_"> </span>to<span class="_"> </span>copy<span class="_"> </span>larger<span class="_"> </span>data<span class="_"> </span>structures<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y1b08 ff7 fs19 fc2 sc0 ls0 ws0">Y<span class="_ _3"></span>ou<span class="_"> </span>carefully<span class="_ _13"> </span>test<span class="_"> </span>the<span class="_"> </span>code<span class="_ _13"> </span>and<span class="_"> </span>discover<span class="_"> </span>that<span class="_ _13"> </span>it<span class="_"> </span><span class="ffa">always<span class="_ _13"> </span></span>copies<span class="_"> </span>the<span class="_"> </span>value<span class="_ _13"> </span>to<span class="_"> </span>the</div><div class="t m5 x17 h26 y1b09 ff7 fs19 fc2 sc0 ls0 ws0">buffer,<span class="_"> </span>even<span class="_"> </span>when<span class="_"> </span><span class="ffd">maxbytes<span class="_ _10"> </span></span>is<span class="_"> </span>too<span class="_"> </span>small.</div><div class="t m5 x34 h26 y1b0a ff7 fs19 fc2 sc0 ls0 ws0">A.<span class="_ _1f"> </span>Explain<span class="_ _15"> </span>why<span class="_ _21"> </span>the<span class="_ _21"> </span>conditional<span class="_ _21"> </span>test<span class="_ _21"> </span>in<span class="_ _21"> </span>the<span class="_ _21"> </span>code<span class="_ _21"> </span>always<span class="_ _21"> </span>succeeds<span class="_ _1"></span>.<span class="_ _21"> </span><span class="ffa">Hint:<span class="_ _21"> </span></span><span class="lsd">Th<span class="_ _2"></span>e</span></div><div class="t m5 x2d h26 y1b0b ffd fs19 fc2 sc0 ls0 ws0">sizeof<span class="_ _10"> </span><span class="ff7">operator<span class="_"> </span>returns<span class="_"> </span>a<span class="_"> </span>value<span class="_"> </span>of<span class="_"> </span>type<span class="_"> </span></span>size_t<span class="ff7">.</span></div><div class="t m5 x34 h26 y1b0c ff7 fs19 fc2 sc0 ls0 ws0">B<span class="_ _3"></span>.<span class="_ _1d"> </span>Show<span class="_"> </span>how<span class="_"> </span>you<span class="_"> </span>can<span class="_"> </span>rewrite<span class="_"> </span>the<span class="_"> </span>conditional<span class="_"> </span>test<span class="_"> </span>to<span class="_"> </span>make<span class="_"> </span>it<span class="_"> </span>work<span class="_"> </span>properly<span class="_ _3"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
