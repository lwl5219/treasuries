<div id="pf2ff" class="pf w2 h11" data-page-no="2ff"><div class="pc pc2ff w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg2ff.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">766<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>8<span class="_ _3d"> </span>Exceptional<span class="_ _10"> </span>Control<span class="_ _10"> </span>Flow</span></div><div class="t m5 x14 h31 y390 ff7 fs21 fc2 sc0 ls0 ws0">Number<span class="_ _17"> </span>Name<span class="_ _3e"> </span>Description<span class="_ _20d"> </span>Number<span class="_ _17"> </span>Name<span class="_ _26"> </span>Description</div><div class="t m5 x27b h31 yc94 ff7 fs21 fc2 sc0 ls0 ws0">0<span class="_ _93"> </span><span class="ffd fs1e">read<span class="_ _3c"> </span></span>Read<span class="_"> </span>ﬁle<span class="_ _d8"> </span>33<span class="_ _93"> </span><span class="ffd fs1e">pause<span class="_ _3c"> </span></span>Suspend<span class="_"> </span>process<span class="_"> </span>until<span class="_"> </span>signal<span class="_"> </span>arrives</div><div class="t m5 x27b h31 yc96 ff7 fs21 fc2 sc0 ls0 ws0">1</div><div class="t m5 x1b6 h31 yc98 ffd fs1e fc2 sc0 ls0 ws0">write<span class="_ _17"> </span><span class="ff7 fs21">Write<span class="_"> </span>ﬁle<span class="_ _14f"> </span>37<span class="_ _74"> </span></span>alarm<span class="_ _3c"> </span><span class="ff7 fs21">Schedule<span class="_"> </span>delivery<span class="_"> </span>of<span class="_"> </span>alarm<span class="_"> </span>signal</span></div><div class="t m5 x27b h31 yc99 ff7 fs21 fc2 sc0 ls0 ws0">2</div><div class="t m5 x1b6 h31 yc9b ffd fs1e fc2 sc0 ls0 ws0">open<span class="_ _3c"> </span><span class="ff7 fs21">Open<span class="_"> </span>ﬁle<span class="_ _27"> </span>39<span class="_ _74"> </span></span>getpid<span class="_ _17"> </span><span class="ff7 fs21">Get<span class="_"> </span>process<span class="_"> </span>ID</span></div><div class="t m5 x27b h31 yc9c ff7 fs21 fc2 sc0 ls0 ws0">3</div><div class="t m5 x1b6 h31 yc9e ffd fs1e fc2 sc0 ls0 ws0">close<span class="_ _17"> </span><span class="ff7 fs21">Close<span class="_"> </span>ﬁle<span class="_ _27"> </span>57<span class="_ _74"> </span></span>fork<span class="_ _4c"> </span><span class="ff7 fs21">Create<span class="_"> </span>process</span></div><div class="t m5 x27b h31 yc9f ff7 fs21 fc2 sc0 ls0 ws0">4</div><div class="t m5 x1b6 h31 yca1 ffd fs1e fc2 sc0 ls0 ws0">stat<span class="_ _3c"> </span><span class="ff7 fs21">Get<span class="_"> </span>info<span class="_"> </span>about<span class="_"> </span>ﬁle<span class="_ _10e"> </span>59<span class="_ _74"> </span></span>execve</div><div class="t m5 x1df h31 y2254 ff7 fs21 fc2 sc0 ls0 ws0">Execute<span class="_"> </span>a<span class="_"> </span>program</div><div class="t m5 x27b h31 y64bd ff7 fs21 fc2 sc0 ls0 ws0">9</div><div class="t m5 x1b6 h31 yca4 ffd fs1e fc2 sc0 ls0 ws0">mmap<span class="_ _3c"> </span><span class="ff7 fs21">Map<span class="_"> </span>memory<span class="_"> </span>page<span class="_"> </span>to<span class="_"> </span>ﬁle<span class="_ _2b"> </span>60<span class="_ _93"> </span></span>_exit<span class="_ _3c"> </span><span class="ff7 fs21">T<span class="_ _3"></span>erminate<span class="_"> </span>process</span></div><div class="t m5 xca h31 y64be ff7 fs21 fc2 sc0 ls0 ws0">12</div><div class="t m5 x1b6 h31 y1034 ffd fs1e fc2 sc0 ls0 ws0">brk<span class="_ _4c"> </span><span class="ff7 fs21">Reset<span class="_"> </span>the<span class="_"> </span>top<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>heap<span class="_ _e2"> </span>61<span class="_ _93"> </span></span>wait4<span class="_ _3c"> </span><span class="ff7 fs21">W<span class="_ _1"></span>ait<span class="_"> </span>for<span class="_"> </span>a<span class="_"> </span>process<span class="_"> </span>to<span class="_"> </span>terminate</span></div><div class="t m5 xca h31 y64bf ff7 fs21 fc2 sc0 ls0 ws0">32</div><div class="t m5 x1b6 h31 y1036 ffd fs1e fc2 sc0 ls0 ws0">dup2<span class="_ _3c"> </span><span class="ff7 fs21">Copy<span class="_"> </span>ﬁle<span class="_"> </span>descriptor<span class="_ _2f"> </span>62<span class="_ _93"> </span></span>kill<span class="_ _4c"> </span><span class="ff7 fs21">Send<span class="_"> </span>signal<span class="_"> </span>to<span class="_"> </span>a<span class="_"> </span>process</span></div><div class="t m5 x14 h2f y1037 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>8.10<span class="_ _66"> </span><span class="fc1">Examples<span class="_"> </span>of<span class="_"> </span>popular<span class="_"> </span>system<span class="_"> </span>calls<span class="_"> </span>in<span class="_"> </span>Linux<span class="_"> </span>x86-64<span class="_"> </span>systems.</span></div><div class="t m5 x1d h26 y3278 ff7 fs19 fc1 sc0 ls0 ws0">creating<span class="_ _16"> </span>a<span class="_ _16"> </span>new<span class="_ _14"> </span>process<span class="_ _1"></span>.<span class="_ _16"> </span>Figure<span class="_ _16"> </span>8.10<span class="_ _16"> </span>lists<span class="_ _16"> </span>some<span class="_ _16"> </span>popular<span class="_ _14"> </span>Linux<span class="_ _16"> </span>system<span class="_ _14"> </span>calls<span class="_ _1"></span>.<span class="_ _16"> </span>Each</div><div class="t m5 x1d h26 y3279 ff7 fs19 fc1 sc0 ls0 ws0">system<span class="_ _11"> </span>call<span class="_ _11"> </span>has<span class="_ _16"> </span>a<span class="_ _11"> </span>unique<span class="_ _11"> </span>integer<span class="_ _16"> </span>number<span class="_"> </span>that<span class="_ _16"> </span>corresponds<span class="_ _11"> </span>to<span class="_ _11"> </span>an<span class="_ _16"> </span>offset<span class="_ _11"> </span>in<span class="_ _11"> </span>a<span class="_ _11"> </span>jump</div><div class="t m5 x1d h26 y327a ff7 fs19 fc1 sc0 ls0 ws0">table<span class="_ _11"> </span>in<span class="_ _11"> </span>the<span class="_ _11"> </span>kernel.<span class="_ _11"> </span>(Notice<span class="_ _11"> </span>that<span class="_ _16"> </span>this<span class="_"> </span>jump<span class="_ _11"> </span>table<span class="_ _16"> </span>is<span class="_"> </span>not<span class="_ _16"> </span>the<span class="_"> </span>same<span class="_ _11"> </span>as<span class="_ _16"> </span>the<span class="_"> </span>exception</div><div class="t m5 x1d h26 y64c0 ff7 fs19 fc1 sc0 ls0 ws0">table<span class="_ _1"></span>.)</div><div class="t m5 x29 h26 y64c1 ff7 fs19 fc1 sc0 ls0 ws0">C<span class="_ _13"> </span>programs<span class="_ _6"> </span>can<span class="_ _13"> </span>invoke<span class="_ _13"> </span>any<span class="_ _6"> </span>system<span class="_ _13"> </span>call<span class="_ _6"> </span>directly<span class="_ _13"> </span>by<span class="_ _13"> </span>using<span class="_ _6"> </span>the<span class="_ _13"> </span><span class="ffd">syscall<span class="_ _13"> </span></span>function.</div><div class="t m5 x1d h26 y64c2 ff7 fs19 fc1 sc0 ls0 ws0">However,<span class="_ _16"> </span>this<span class="_ _16"> </span>is<span class="_ _16"> </span>rarely<span class="_ _16"> </span>necessary<span class="_ _16"> </span>in<span class="_ _16"> </span>practice.<span class="_ _11"> </span>The<span class="_ _11"> </span>C<span class="_ _14"> </span>standard<span class="_ _16"> </span>library<span class="_ _16"> </span>provides<span class="_ _16"> </span>a</div><div class="t m5 x1d h26 y64c3 ff7 fs19 fc1 sc0 ls0 ws0">set<span class="_"> </span>of<span class="_ _13"> </span>convenient<span class="_"> </span>wrapper<span class="_"> </span>functions<span class="_"> </span>for<span class="_ _13"> </span>most<span class="_"> </span>system<span class="_"> </span>calls<span class="_ _3"></span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>wrapper<span class="_"> </span>functions</div><div class="t m5 x1d h26 y64c4 ff7 fs19 fc1 sc0 ls0 ws0">package<span class="_ _14"> </span>up<span class="_ _15"> </span>the<span class="_ _14"> </span>arguments<span class="_ _1"></span>,<span class="_ _15"> </span>trap<span class="_ _15"> </span>to<span class="_ _14"> </span>the<span class="_ _15"> </span>kernel<span class="_ _14"> </span>with<span class="_ _15"> </span>the<span class="_ _14"> </span>appropriate<span class="_ _15"> </span>system<span class="_ _14"> </span>call</div><div class="t m5 x1d h26 y64c5 ff7 fs19 fc1 sc0 ls0 ws0">instruction,<span class="_ _11"> </span>and<span class="_ _11"> </span>then<span class="_ _16"> </span>pass<span class="_ _11"> </span>the<span class="_ _11"> </span>return<span class="_ _11"> </span>status<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span>system<span class="_ _11"> </span>call<span class="_ _11"> </span>back<span class="_ _11"> </span>to<span class="_ _16"> </span>the<span class="_ _11"> </span>calling</div><div class="t m5 x1d h26 y64c6 ff7 fs19 fc1 sc0 ls0 ws0">program.<span class="_ _11"> </span>T<span class="_ _0"></span>hroughout<span class="_ _11"> </span>this<span class="_ _11"> </span>text,<span class="_ _16"> </span>we<span class="_ _11"> </span>will<span class="_ _11"> </span>refer<span class="_ _16"> </span>to<span class="_"> </span>system<span class="_ _16"> </span>calls<span class="_ _11"> </span>and<span class="_ _11"> </span>their<span class="_ _11"> </span>associated</div><div class="t m5 x1d h26 y64c7 ff7 fs19 fc1 sc0 ls0 ws0">wrapper<span class="_"> </span>functions<span class="_"> </span>interchangeably<span class="_"> </span>as<span class="_"> </span><span class="ffa">system-level<span class="_"> </span>functions</span>.</div><div class="t m5 x29 h26 y64c8 ff7 fs19 fc1 sc0 ls0 ws0">System<span class="_"> </span>calls<span class="_"> </span>are<span class="_"> </span>provided<span class="_"> </span>on<span class="_"> </span>x86-64<span class="_"> </span>systems<span class="_"> </span>via<span class="_"> </span>a<span class="_"> </span>trapping<span class="_"> </span>instruction<span class="_"> </span>called</div><div class="t m5 x1d h26 y64c9 ffd fs19 fc1 sc0 ls0 ws0">syscall<span class="ff7">.<span class="_ _14"> </span>It<span class="_ _15"> </span>is<span class="_ _14"> </span>quite<span class="_ _15"> </span>interesting<span class="_ _14"> </span>to<span class="_ _15"> </span>study<span class="_ _14"> </span>how<span class="_ _14"> </span>programs<span class="_ _15"> </span>can<span class="_ _14"> </span>use<span class="_ _15"> </span>this<span class="_ _14"> </span>instruction</span></div><div class="t m5 x1d h26 y64ca ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _15"> </span>invoke<span class="_ _15"> </span>Linux<span class="_ _15"> </span>system<span class="_ _15"> </span>calls<span class="_ _15"> </span>directly<span class="_ _3"></span>.<span class="_ _15"> </span>All<span class="_ _15"> </span>arguments<span class="_ _15"> </span>to<span class="_ _15"> </span>Linux<span class="_ _15"> </span>system<span class="_ _15"> </span>calls<span class="_ _21"> </span>are</div><div class="t m5 x1d h26 y64cb ff7 fs19 fc1 sc0 ls0 ws0">passed<span class="_ _16"> </span>through<span class="_ _14"> </span>general-purpose<span class="_ _16"> </span>registers<span class="_ _14"> </span>rather<span class="_ _16"> </span>than<span class="_ _16"> </span>the<span class="_ _14"> </span>stack.<span class="_ _16"> </span>By<span class="_ _14"> </span>convention,</div><div class="t m5 x1d h26 y64cc ff7 fs19 fc1 sc0 ls0 ws0">register<span class="_ _13"> </span><span class="ffd">%rax<span class="_ _10"> </span></span>contains<span class="_ _13"> </span>the<span class="_"> </span>syscall<span class="_ _13"> </span>number,<span class="_ _13"> </span>with<span class="_"> </span>up<span class="_ _13"> </span>to<span class="_ _13"> </span>six<span class="_"> </span>arguments<span class="_ _13"> </span>in<span class="_"> </span><span class="ffd">%rdi</span>,<span class="_ _13"> </span><span class="ffd">%rsi</span>,</div><div class="t m5 x1d h26 y64cd ffd fs19 fc1 sc0 ls0 ws0">%rdx<span class="ff7">,<span class="_ _11"> </span></span>%r10<span class="ff7">,<span class="_ _16"> </span></span>%r8<span class="ff7">,<span class="_ _11"> </span>and<span class="_ _11"> </span></span>%r9<span class="ff7">.<span class="_ _11"> </span>The<span class="_"> </span>ﬁrst<span class="_ _11"> </span>argument<span class="_ _11"> </span>is<span class="_ _16"> </span>in<span class="_"> </span></span>%rdi<span class="ff7">,<span class="_ _16"> </span>the<span class="_ _11"> </span>second<span class="_ _11"> </span>in<span class="_ _11"> </span></span>%rsi<span class="ff7">,<span class="_ _16"> </span>and</span></div><div class="t m5 x1d h26 y64ce ff7 fs19 fc1 sc0 ls0 ws0">so<span class="_"> </span>on.<span class="_ _13"> </span>On<span class="_"> </span>return<span class="_ _13"> </span>from<span class="_"> </span>the<span class="_ _13"> </span>system<span class="_"> </span>call,<span class="_ _13"> </span>registers<span class="_"> </span><span class="ffd">%rcx<span class="_ _13"> </span></span>and<span class="_"> </span><span class="ffd">%r11<span class="_ _13"> </span></span>are<span class="_"> </span>destroyed,<span class="_"> </span>and</div><div class="t m5 x1d h46 y64cf ffd fs19 fc1 sc0 ls0 ws0">%rax<span class="_ _11"> </span><span class="ff7">contains<span class="_"> </span>the<span class="_ _11"> </span>return<span class="_ _11"> </span>value<span class="_ _0"></span>.<span class="_"> </span>A<span class="_ _11"> </span>negative<span class="_ _11"> </span>return<span class="_ _11"> </span>value<span class="_ _11"> </span>between<span class="_ _11"> </span><span class="ff12">−</span>4<span class="ff11">,</span>095<span class="_"> </span>and<span class="_ _11"> </span><span class="ff12">−</span>1</span></div><div class="t m5 x1d h26 y64d0 ff7 fs19 fc1 sc0 ls0 ws0">indicates<span class="_"> </span>an<span class="_"> </span>error<span class="_"> </span>corresponding<span class="_"> </span>to<span class="_"> </span>negative<span class="_"> </span><span class="ffd">errno</span>.</div><div class="t m5 x29 h26 y64d1 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _16"> </span>example<span class="_ _1"></span>,<span class="_ _16"> </span>consider<span class="_ _16"> </span>the<span class="_ _16"> </span>following<span class="_ _16"> </span>version<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>familiar<span class="_ _16"> </span><span class="ffd">hello<span class="_ _11"> </span></span>program,</div><div class="t m5 x1d h26 y64d2 ff7 fs19 fc1 sc0 ls0 ws0">written<span class="_"> </span>using<span class="_"> </span>the<span class="_"> </span><span class="ffd">write<span class="_ _10"> </span></span>system-level<span class="_"> </span>function<span class="_"> </span>(Section<span class="_"> </span>10.4)<span class="_"> </span>instead<span class="_"> </span>of<span class="_"> </span><span class="ffd">printf</span>:</div><div class="t m5 x1f h2d y64d3 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">int<span class="_ _1f"> </span>main()</span></div><div class="t m5 x1f h2d y64d4 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x1f h2d y64d5 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2">write(1,<span class="_ _e"> </span>&quot;hello,<span class="_ _1f"> </span>world\n&quot;,<span class="_ _1f"> </span>13);</span></div><div class="t m5 x1f h2e y64d6 ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 x33 h2d y64d7 ffd fs1e fc2 sc0 ls0 ws0">_exit(0);</div><div class="t m5 x1f h2e y64d8 ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x4f h2d y64d9 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x29 h26 yeef ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _13"> </span>ﬁrst<span class="_ _13"> </span>argument<span class="_ _6"> </span>to<span class="_ _13"> </span><span class="ffd">write<span class="_ _6"> </span></span>sends<span class="_ _13"> </span>the<span class="_ _13"> </span>output<span class="_ _6"> </span>to<span class="_ _13"> </span><span class="ffd">stdout</span>.<span class="_ _6"> </span>T<span class="_ _0"></span>he<span class="_ _13"> </span>second<span class="_ _6"> </span>argument</div><div class="t m5 x1d h26 yf74 ff7 fs19 fc2 sc0 ls0 ws0">is<span class="_ _13"> </span>the<span class="_ _13"> </span>sequence<span class="_ _6"> </span>of<span class="_ _13"> </span>bytes<span class="_ _13"> </span>to<span class="_ _13"> </span>write<span class="_ _1"></span>,<span class="_ _13"> </span>and<span class="_ _13"> </span>the<span class="_ _13"> </span>third<span class="_ _13"> </span>argument<span class="_ _6"> </span>gives<span class="_ _13"> </span>the<span class="_ _13"> </span>number<span class="_ _13"> </span>of<span class="_ _13"> </span>bytes</div><div class="t m5 x1d h26 y23fe ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_"> </span>write<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
