<div id="pf42f" class="pf w2 h11" data-page-no="42f"><div class="pc pc42f w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg42f.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">1070<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>12<span class="_ _3d"> </span>Concurrent<span class="_ _10"> </span>Programming</span></div><div class="t m5 x1d h73 ye7 ffe fs1e fc6 sc0 ls0 ws0">12.30<span class="_ _23"> </span><span class="ff10 fs19">◆</span></div><div class="t m5 x1d h26 y2a7 ff7 fs19 fc1 sc0 ls0 ws0">Consider<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>program<span class="_"> </span>that<span class="_"> </span>deadlocks<span class="_ _1"></span>.</div><div class="t m5 x1d h2d y850e ffd fs1e fc2 sc0 ls0 ws0">Initially<span class="ls33">:a=1<span class="_ _41"></span>,b=1<span class="_ _41"></span>,c=1<span class="_ _41"></span>.</span></div><div class="t m5 x1d h2d y850f ffd fs1e fc2 sc0 ls0 ws0">Thread<span class="_ _e"> </span>1:<span class="_ _2b"> </span>Thread<span class="_ _e"> </span>2:<span class="_ _2b"> </span>Thread<span class="_ _e"> </span>3:</div><div class="t m5 x289 h2d y8510 ffd fs1e fc2 sc0 ls0 ws0">P(a);<span class="_ _192"> </span>P(c);<span class="_ _6b"> </span>P(c);</div><div class="t m5 x289 h2d y8511 ffd fs1e fc2 sc0 ls0 ws0">P(b);<span class="_ _192"> </span>P(b);<span class="_ _6b"> </span>V(c);</div><div class="t m5 x289 h2d y8512 ffd fs1e fc2 sc0 ls0 ws0">V(b);<span class="_ _192"> </span>V(b);<span class="_ _6b"> </span>P(b);</div><div class="t m5 x289 h2d y8513 ffd fs1e fc2 sc0 ls0 ws0">P(c);<span class="_ _192"> </span>V(c);<span class="_ _6b"> </span>P(a);</div><div class="t m5 x289 h2d y8514 ffd fs1e fc2 sc0 ls0 ws0">V(c);<span class="_ _192"> </span>P(a);<span class="_ _6b"> </span>V(a);</div><div class="t m5 x289 h2d y8515 ffd fs1e fc2 sc0 ls0 ws0">V(a);<span class="_ _192"> </span>V(a);<span class="_ _6b"> </span>V(b);</div><div class="t m5 x124 h26 y8516 ff7 fs19 fc2 sc0 ls0 ws0">A.<span class="_ _1f"> </span>F<span class="_ _1"></span>or<span class="_"> </span>each<span class="_"> </span>thread,<span class="_"> </span>list<span class="_"> </span>the<span class="_"> </span>pairs<span class="_"> </span>of<span class="_"> </span>mutexes<span class="_"> </span>that<span class="_"> </span>it<span class="_"> </span>holds<span class="_"> </span>simultaneously<span class="_ _3"></span>.</div><div class="t m5 x124 h26 y8517 ff7 fs19 fc2 sc0 ls2a ws0">B.<span class="_ _66"> </span>I<span class="_ _5"></span>f<span class="_ _16"> </span><span class="ff11 ls303">a&lt;<span class="_ _0"></span>b&lt;<span class="_ _3"></span>c<span class="_ _4a"></span><span class="ff7 ls0">,<span class="_"> </span>which<span class="_"> </span>threads<span class="_"> </span>violate<span class="_"> </span>the<span class="_"> </span>mutex<span class="_"> </span>lock<span class="_"> </span>ordering<span class="_"> </span>rule?</span></span></div><div class="t m5 x124 h26 y8518 ff7 fs19 fc2 sc0 ls0 ws0">C.<span class="_ _25"> </span>F<span class="_ _1"></span>or<span class="_"> </span>these<span class="_ _11"> </span>threads<span class="_ _1"></span>,<span class="_ _11"> </span>show<span class="_"> </span>a<span class="_ _11"> </span>new<span class="_"> </span>lock<span class="_ _11"> </span>ordering<span class="_"> </span>that<span class="_ _11"> </span>guarantees<span class="_"> </span>freedom<span class="_ _11"> </span>from</div><div class="t m5 x4f h26 y8519 ff7 fs19 fc2 sc0 ls0 ws0">deadlock.</div><div class="t m5 x1d h73 y851a ffe fs1e fc6 sc0 ls0 ws0">12.31<span class="_ _23"> </span><span class="ff10 fs19">◆◆◆</span></div><div class="t m5 x1d h26 y851b ff7 fs19 fc1 sc0 ls0 ws0">Implement<span class="_ _13"> </span>a<span class="_ _13"> </span>version<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>standard<span class="_ _13"> </span>I/O<span class="_ _13"> </span><span class="ffd">fgets<span class="_ _6"> </span></span>function,<span class="_ _13"> </span>called<span class="_ _13"> </span><span class="ffd">tfgets</span>,<span class="_ _13"> </span>that<span class="_ _13"> </span>times</div><div class="t m5 x1d h26 y851c ff7 fs19 fc1 sc0 ls0 ws0">out<span class="_"> </span>and<span class="_"> </span>returns<span class="_ _11"> </span><span class="ffd">NULL<span class="_ _10"> </span></span>if<span class="_ _11"> </span>it<span class="_"> </span>does<span class="_ _11"> </span>not<span class="_"> </span>receive<span class="_"> </span>an<span class="_ _11"> </span>input<span class="_"> </span>line<span class="_ _11"> </span>on<span class="_"> </span>standard<span class="_ _11"> </span>input<span class="_"> </span>within</div><div class="t m5 x1d h26 y851d ff7 fs19 fc1 sc0 ls0 ws0">5<span class="_ _15"> </span>seconds<span class="_ _1"></span>.<span class="_ _15"> </span>Y<span class="_ _3"></span>our<span class="_ _15"> </span>function<span class="_ _15"> </span>should<span class="_ _15"> </span>be<span class="_ _15"> </span>implemented<span class="_ _15"> </span>in<span class="_ _15"> </span>a<span class="_ _15"> </span>package<span class="_ _15"> </span>called<span class="_ _15"> </span><span class="ffd">tfgets-</span></div><div class="t m5 x1d h26 y851e ffd fs19 fc1 sc0 ls0 ws0">proc.c<span class="_ _11"> </span><span class="ff7">using<span class="_ _11"> </span>processes<span class="_ _1"></span>,<span class="_ _11"> </span>signals<span class="_ _0"></span>,<span class="_ _11"> </span>and<span class="_ _11"> </span>nonlocal<span class="_ _11"> </span>jumps<span class="_ _1"></span>.<span class="_ _16"> </span>It<span class="_"> </span>should<span class="_ _16"> </span>not<span class="_"> </span>use<span class="_ _11"> </span>the<span class="_ _16"> </span>Linux</span></div><div class="t m5 x1d h26 y851f ffd fs19 fc1 sc0 ls0 ws0">alarm<span class="_ _10"> </span><span class="ff7">function.<span class="_"> </span>T<span class="_ _7"></span>est<span class="_"> </span>your<span class="_"> </span>solution<span class="_"> </span>using<span class="_"> </span>the<span class="_"> </span>driver<span class="_"> </span>program<span class="_"> </span>in<span class="_"> </span>Figure<span class="_"> </span>12.47.</span></div><div class="t m5 x11e h2c y8520 ffa fs16 fc1 sc0 ls0 ws0">code/conc/tfgets-main.c</div><div class="t m5 x1f h2e y6842 ff6 fs20 fc6 sc0 ls0 ws0">1</div><div class="t m5 x4f h2d y6894 ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&quot;csapp.h&quot;</div><div class="t m5 x1f h2e y6843 ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x1f h2e y8521 ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x4f h2d y6844 ffd fs1e fc2 sc0 ls0 ws0">char<span class="_ _e"> </span>*tfgets(char<span class="_ _1f"> </span>*s,<span class="_ _1f"> </span>int<span class="_ _e"> </span>size,<span class="_ _1f"> </span>FILE<span class="_ _e"> </span>*stream);</div><div class="t m5 x1f h2e y6845 ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 x1f h2e y6846 ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x4f h2d y6847 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>main()</div><div class="t m5 x1f h2d y6848 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x1f h2d y6849 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _20"> </span><span class="ffd fs1e fc2">char<span class="_ _e"> </span>buf[MAXLINE];</span></div><div class="t m5 x1f h2e y684a ff6 fs20 fc6 sc0 ls0 ws0">8</div><div class="t m5 x1f h2e y8522 ff6 fs20 fc6 sc0 ls0 ws0">9</div><div class="t m5 x33 h2d y684b ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>(tfgets(buf,<span class="_ _1f"> </span>MAXLINE,<span class="_ _1f"> </span>stdin)<span class="_ _e"> </span>==<span class="_ _1f"> </span>NULL)</div><div class="t m5 x1b0 h2d y684c ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _70"> </span><span class="ffd fs1e fc2">printf(&quot;BOOM!\n&quot;);</span></div><div class="t m5 x1b0 h2d y684d ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _20"> </span><span class="ffd fs1e fc2">else</span></div><div class="t m5 x1b0 h2e ya25 ff6 fs20 fc6 sc0 ls0 ws0">12</div><div class="t m5 xf7 h2d ya26 ffd fs1e fc2 sc0 ls0 ws0">printf(&quot;%s&quot;,<span class="_ _e"> </span>buf);</div><div class="t m5 x1b0 h2e y684f ff6 fs20 fc6 sc0 ls0 ws0">13</div><div class="t m5 x1b0 h2e y8523 ff6 fs20 fc6 sc0 ls0 ws0">14</div><div class="t m5 x33 h2d y1862 ffd fs1e fc2 sc0 ls0 ws0">exit(0);</div><div class="t m5 x1b0 h2d y18db ff6 fs20 fc6 sc0 ls0 ws0">15<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x11e h2c y6850 ffa fs16 fc2 sc0 ls0 ws0">code/conc/tfgets-main.c</div><div class="t m5 x1d h2f y6851 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>12.47<span class="_ _66"> </span><span class="fc1">Driver<span class="_"> </span>program<span class="_"> </span>for<span class="_"> </span>Problems<span class="_"> </span>12.31–12.33.</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
