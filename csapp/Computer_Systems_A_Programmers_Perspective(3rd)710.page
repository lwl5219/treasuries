<div id="pf2c6" class="pf w2 h11" data-page-no="2c6"><div class="pc pc2c6 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg2c6.png"/><div class="t m5 x8a h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>7.3<span class="_ _60"> </span>Object<span class="_ _10"> </span>Files<span class="_ _3e"> </span><span class="ffe fs1e">709</span></div><div class="t m5 x26 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_"> </span>build<span class="_"> </span>the<span class="_"> </span>executable,<span class="_"> </span>the<span class="_"> </span>linker<span class="_"> </span>must<span class="_"> </span>perform<span class="_"> </span>two<span class="_"> </span>main<span class="_"> </span>tasks:</div><div class="t m5 x72 h26 y5e36 ffa fs19 fc2 sc0 ls0 ws0">Step<span class="_ _6"> </span>1.<span class="_ _6"> </span>Symbol<span class="_ _6"> </span>resolution.<span class="_ _21"> </span><span class="ff7">Object<span class="_ _6"> </span>ﬁles<span class="_ _6"> </span>deﬁne<span class="_ _6"> </span>and<span class="_ _6"> </span>reference<span class="_ _6"> </span></span>symbols<span class="ff7">,<span class="_ _6"> </span>where<span class="_ _6"> </span>each</span></div><div class="t m5 x30 h26 y5e37 ff7 fs19 fc2 sc0 ls0 ws0">symbol<span class="_ _16"> </span>corresponds<span class="_ _16"> </span>to<span class="_ _14"> </span>a<span class="_ _16"> </span>function,<span class="_ _14"> </span>a<span class="_ _16"> </span>global<span class="_ _14"> </span>variable<span class="_ _1"></span>,<span class="_ _14"> </span>or<span class="_ _14"> </span>a<span class="_ _16"> </span><span class="ffa">static<span class="_ _16"> </span>variable</span></div><div class="t m5 x30 h26 y5e38 ff7 fs19 fc2 sc0 ls0 ws0">(i.e<span class="_ _1"></span>.,<span class="_ _11"> </span>any<span class="_"> </span>C<span class="_ _11"> </span>variable<span class="_"> </span>declared<span class="_ _11"> </span>with<span class="_"> </span>the<span class="_ _11"> </span><span class="ffd">static<span class="_ _11"> </span></span>attribute).<span class="_"> </span>T<span class="_ _0"></span>he<span class="_"> </span>purpose<span class="_ _11"> </span>of</div><div class="t m5 x30 h26 y5e39 ff7 fs19 fc2 sc0 ls0 ws0">symbol<span class="_"> </span>resolution<span class="_ _11"> </span>is<span class="_ _11"> </span>to<span class="_"> </span>associate<span class="_ _11"> </span>each<span class="_ _11"> </span>symbol<span class="_ _11"> </span><span class="ffa">reference<span class="_ _11"> </span></span>with<span class="_"> </span>exactly<span class="_ _11"> </span>one</div><div class="t m5 x30 h26 y5e3a ff7 fs19 fc2 sc0 ls0 ws0">symbol<span class="_"> </span><span class="ffa">deﬁnition</span>.</div><div class="t m5 x72 h26 y5e3b ffa fs19 fc2 sc0 ls0 ws0">Step<span class="_"> </span>2.<span class="_"> </span>Relocation.<span class="_ _f"> </span><span class="ff7">Compilers<span class="_"> </span>and<span class="_"> </span>assemblers<span class="_ _11"> </span>generate<span class="_"> </span>code<span class="_"> </span>and<span class="_ _11"> </span>data<span class="_"> </span>sections</span></div><div class="t m5 x30 h26 y5e3c ff7 fs19 fc2 sc0 ls0 ws0">that<span class="_"> </span>start<span class="_ _13"> </span>at<span class="_"> </span>address<span class="_ _13"> </span>0.<span class="_"> </span>T<span class="_ _3"></span>he<span class="_"> </span>linker<span class="_"> </span><span class="ffa">relocates<span class="_ _13"> </span></span>these<span class="_"> </span>sections<span class="_ _13"> </span>by<span class="_"> </span>associating<span class="_ _13"> </span>a</div><div class="t m5 x30 h26 y5e3d ff7 fs19 fc2 sc0 ls0 ws0">memory<span class="_ _11"> </span>location<span class="_ _11"> </span>with<span class="_ _11"> </span>each<span class="_ _11"> </span>symbol<span class="_ _11"> </span>deﬁnition,<span class="_ _11"> </span>and<span class="_ _11"> </span>then<span class="_ _11"> </span>modifying<span class="_ _11"> </span>all<span class="_ _11"> </span>of</div><div class="t m5 x30 h26 y5e3e ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _6"> </span>references<span class="_ _6"> </span>to<span class="_ _13"> </span>those<span class="_ _a"> </span>symbols<span class="_ _13"> </span>so<span class="_ _a"> </span>that<span class="_ _13"> </span>they<span class="_ _a"> </span>point<span class="_ _13"> </span>to<span class="_ _6"> </span>this<span class="_ _6"> </span>memory<span class="_ _6"> </span>location.</div><div class="t m5 x30 h26 y5e3f ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>linker<span class="_"> </span>blindly<span class="_"> </span>performs<span class="_"> </span>these<span class="_ _13"> </span>relocations<span class="_"> </span>using<span class="_"> </span>detailed<span class="_"> </span>instructions<span class="_ _3"></span>,</div><div class="t m5 x30 h26 y5e40 ff7 fs19 fc2 sc0 ls0 ws0">generated<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span>assembler,<span class="_"> </span>called<span class="_"> </span><span class="ffa">relocation<span class="_"> </span>entries</span>.</div><div class="t m5 x26 h26 y5e41 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _13"> </span>sections<span class="_ _13"> </span>that<span class="_ _6"> </span>follow<span class="_ _13"> </span>describe<span class="_ _13"> </span>these<span class="_ _13"> </span>tasks<span class="_ _6"> </span>in<span class="_ _13"> </span>more<span class="_ _13"> </span>detail.<span class="_ _6"> </span>As<span class="_ _13"> </span>you<span class="_ _13"> </span>read,<span class="_ _13"> </span>keep</div><div class="t m5 x17 h26 y5e42 ff7 fs19 fc2 sc0 ls0 ws0">in<span class="_ _6"> </span>mind<span class="_ _13"> </span>some<span class="_ _6"> </span>basic<span class="_ _13"> </span>facts<span class="_ _6"> </span>about<span class="_ _13"> </span>linkers:<span class="_ _6"> </span>Object<span class="_ _13"> </span>ﬁles<span class="_ _6"> </span>are<span class="_ _13"> </span>merely<span class="_ _6"> </span>collections<span class="_ _13"> </span>of<span class="_ _6"> </span>blocks</div><div class="t m5 x17 h26 y5e43 ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_ _15"> </span>bytes<span class="_ _1"></span>.<span class="_ _15"> </span>Some<span class="_ _15"> </span>of<span class="_ _15"> </span>these<span class="_ _15"> </span>blocks<span class="_ _15"> </span>contain<span class="_ _15"> </span>program<span class="_ _15"> </span>code,<span class="_ _15"> </span>others<span class="_ _15"> </span>contain<span class="_ _15"> </span>program</div><div class="t m5 x17 h26 y5e44 ff7 fs19 fc2 sc0 ls0 ws0">data,<span class="_"> </span>and<span class="_ _13"> </span>others<span class="_ _13"> </span>contain<span class="_"> </span>data<span class="_ _13"> </span>structures<span class="_ _13"> </span>that<span class="_"> </span>guide<span class="_ _13"> </span>the<span class="_"> </span>linker<span class="_ _13"> </span>and<span class="_ _13"> </span>loader.<span class="_ _13"> </span>A<span class="_"> </span>linker</div><div class="t m5 x17 h26 y5e45 ff7 fs19 fc2 sc0 ls0 ws0">concatenates<span class="_"> </span>blocks<span class="_ _13"> </span>together,<span class="_ _13"> </span>decides<span class="_"> </span>on<span class="_"> </span>run-time<span class="_ _13"> </span>locations<span class="_"> </span>for<span class="_ _13"> </span>the<span class="_"> </span>concatenated</div><div class="t m5 x17 h26 y5e46 ff7 fs19 fc2 sc0 ls0 ws0">blocks<span class="_ _1"></span>,<span class="_ _16"> </span>and<span class="_ _16"> </span>modiﬁes<span class="_ _14"> </span>various<span class="_ _16"> </span>locations<span class="_ _16"> </span>within<span class="_ _16"> </span>the<span class="_ _16"> </span>code<span class="_ _16"> </span>and<span class="_ _16"> </span>data<span class="_ _16"> </span>blocks<span class="_ _1"></span>.<span class="_ _16"> </span>Linkers</div><div class="t m5 x17 h26 y5e47 ff7 fs19 fc2 sc0 ls0 ws0">have<span class="_ _13"> </span>minimal<span class="_ _13"> </span>understanding<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>target<span class="_ _13"> </span>machine<span class="_ _0"></span>.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span>compilers<span class="_ _13"> </span>and<span class="_ _13"> </span>assemblers</div><div class="t m5 x17 h26 y5e48 ff7 fs19 fc2 sc0 ls0 ws0">that<span class="_"> </span>generate<span class="_"> </span>the<span class="_"> </span>object<span class="_"> </span>ﬁles<span class="_"> </span>have<span class="_"> </span>already<span class="_"> </span>done<span class="_"> </span>most<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>work.</div><div class="t m5 x17 h3b y5e49 fff fs24 fc6 sc0 ls0 ws0">7.3</div><div class="t m5 x77 h3e y5e4a ffe fs18 fc6 sc0 ls0 ws0">Object<span class="_"> </span>Files</div><div class="t m5 x17 h26 y5e4b ff7 fs19 fc1 sc0 ls0 ws0">Object<span class="_"> </span>ﬁles<span class="_"> </span>come<span class="_"> </span>in<span class="_"> </span>three<span class="_"> </span>forms:</div><div class="t m5 x72 h26 y5e4c ffa fs19 fc1 sc0 ls0 ws0">Relocatable<span class="_ _14"> </span>object<span class="_ _15"> </span>ﬁle.<span class="_ _15"> </span><span class="ff7">Contains<span class="_ _15"> </span>binary<span class="_ _15"> </span>code<span class="_ _14"> </span>and<span class="_ _15"> </span>data<span class="_ _15"> </span>in<span class="_ _14"> </span>a<span class="_ _15"> </span>form<span class="_ _15"> </span>that<span class="_ _14"> </span>can<span class="_ _15"> </span>be</span></div><div class="t m5 x30 h26 y5e4d ff7 fs19 fc1 sc0 ls0 ws0">combined<span class="_"> </span>with<span class="_"> </span>other<span class="_ _13"> </span>relocatable<span class="_"> </span>object<span class="_"> </span>ﬁles<span class="_"> </span>at<span class="_"> </span>compile<span class="_ _13"> </span>time<span class="_"> </span>to<span class="_"> </span>create<span class="_"> </span>an</div><div class="t m5 x30 h26 y5e4e ff7 fs19 fc1 sc0 ls0 ws0">executable<span class="_"> </span>object<span class="_"> </span>ﬁle<span class="_ _1"></span>.</div><div class="t m5 x72 h26 y5e4f ffa fs19 fc1 sc0 ls0 ws0">Executable<span class="_ _15"> </span>object<span class="_ _15"> </span>ﬁle.<span class="_ _15"> </span><span class="ff7">Contains<span class="_ _21"> </span>binary<span class="_ _21"> </span>code<span class="_ _15"> </span>and<span class="_ _21"> </span>data<span class="_ _15"> </span>in<span class="_ _21"> </span>a<span class="_ _21"> </span>form<span class="_ _15"> </span>that<span class="_ _21"> </span>can<span class="_ _15"> </span>be</span></div><div class="t m5 x30 h26 y5e50 ff7 fs19 fc1 sc0 ls0 ws0">copied<span class="_"> </span>directly<span class="_"> </span>into<span class="_"> </span>memory<span class="_"> </span>and<span class="_"> </span>executed.</div><div class="t m5 x72 h26 y5e51 ffa fs19 fc1 sc0 ls0 ws0">Shared<span class="_ _16"> </span>object<span class="_ _16"> </span>ﬁle<span class="_ _1"></span>.<span class="_ _f"> </span><span class="ff7">A<span class="_ _16"> </span>special<span class="_ _16"> </span>type<span class="_ _16"> </span>of<span class="_ _11"> </span>relocatable<span class="_ _16"> </span>object<span class="_ _16"> </span>ﬁle<span class="_ _16"> </span>that<span class="_ _16"> </span>can<span class="_ _16"> </span>be<span class="_ _11"> </span>loaded</span></div><div class="t m5 x30 h26 y5e52 ff7 fs19 fc1 sc0 ls0 ws0">into<span class="_"> </span>memory<span class="_"> </span>and<span class="_"> </span>linked<span class="_"> </span>dynamically<span class="_ _3"></span>,<span class="_"> </span>at<span class="_"> </span>either<span class="_"> </span>load<span class="_"> </span>time<span class="_"> </span>or<span class="_"> </span>run<span class="_"> </span>time<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y5e53 ff7 fs19 fc1 sc0 ls0 ws0">Compilers<span class="_"> </span>and<span class="_ _13"> </span>assemblers<span class="_"> </span>generate<span class="_"> </span>relocatable<span class="_"> </span>object<span class="_ _13"> </span>ﬁles<span class="_"> </span>(including<span class="_"> </span>shared</div><div class="t m5 x17 h26 y5e54 ff7 fs19 fc1 sc0 ls0 ws0">object<span class="_ _6"> </span>ﬁles).<span class="_ _6"> </span>Linkers<span class="_ _6"> </span>generate<span class="_ _a"> </span>executable<span class="_ _6"> </span>object<span class="_ _6"> </span>ﬁles<span class="_ _0"></span>.<span class="_ _a"> </span>T<span class="_ _3"></span>echnically<span class="_ _3"></span>,<span class="_ _6"> </span>an<span class="_ _6"> </span><span class="ffa">object<span class="_ _6"> </span>module</span></div><div class="t m5 x17 h26 y5e55 ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_ _16"> </span>a<span class="_ _11"> </span>sequence<span class="_ _16"> </span>of<span class="_ _16"> </span>bytes<span class="_ _3"></span>,<span class="_ _16"> </span>and<span class="_ _16"> </span>an<span class="_ _16"> </span><span class="ffa">object<span class="_ _11"> </span>ﬁle<span class="_ _16"> </span></span>is<span class="_ _16"> </span>an<span class="_ _11"> </span>object<span class="_ _16"> </span>module<span class="_ _16"> </span>stored<span class="_ _11"> </span>on<span class="_ _16"> </span>disk<span class="_ _16"> </span>in<span class="_ _11"> </span>a</div><div class="t m5 x17 h26 y5e56 ff7 fs19 fc1 sc0 ls0 ws0">ﬁle<span class="_ _1"></span>.<span class="_"> </span>However,<span class="_"> </span>we<span class="_"> </span>will<span class="_"> </span>use<span class="_"> </span>these<span class="_"> </span>terms<span class="_"> </span>interchangeably<span class="_ _3"></span>.</div><div class="t m5 x26 h26 y5e57 ff7 fs19 fc1 sc0 ls0 ws0">Object<span class="_"> </span>ﬁles<span class="_ _13"> </span>are<span class="_"> </span>organized<span class="_"> </span>according<span class="_ _13"> </span>to<span class="_"> </span>speciﬁc<span class="_"> </span><span class="ffa">object<span class="_ _13"> </span>ﬁle<span class="_"> </span>formats</span>,<span class="_"> </span>which<span class="_"> </span>vary</div><div class="t m5 x17 h26 y5e58 ff7 fs19 fc1 sc0 ls0 ws0">from<span class="_ _14"> </span>system<span class="_ _15"> </span>to<span class="_ _15"> </span>system.<span class="_ _15"> </span>T<span class="_ _0"></span>he<span class="_ _14"> </span>ﬁrst<span class="_ _15"> </span>Unix<span class="_ _15"> </span>systems<span class="_ _15"> </span>from<span class="_ _15"> </span>Bell<span class="_ _14"> </span>Labs<span class="_ _15"> </span>used<span class="_ _15"> </span>the<span class="_ _15"> </span><span class="ffd">a.out</span></div><div class="t m5 x17 h26 y5e59 ff7 fs19 fc1 sc0 ls0 ws0">format.<span class="_ _15"> </span>(T<span class="_ _7"></span>o<span class="_ _15"> </span>this<span class="_ _15"> </span>day<span class="_ _3"></span>,<span class="_ _21"> </span>executables<span class="_ _21"> </span>are<span class="_ _15"> </span>still<span class="_ _15"> </span>referred<span class="_ _15"> </span>to<span class="_ _15"> </span>as<span class="_ _15"> </span><span class="ffd">a.out<span class="_ _15"> </span></span>ﬁles<span class="_ _1"></span>.)<span class="_ _15"> </span>Windows</div><div class="t m5 x17 h26 y5e5a ff7 fs19 fc1 sc0 ls0 ws0">uses<span class="_ _11"> </span>the<span class="_ _16"> </span>P<span class="_ _1"></span>ortable<span class="_ _16"> </span>Executable<span class="_ _11"> </span>(PE)<span class="_ _16"> </span>format.<span class="_ _16"> </span>Mac<span class="_ _11"> </span>OS-X<span class="_ _16"> </span>uses<span class="_ _11"> </span>the<span class="_ _16"> </span>Mach-O<span class="_ _16"> </span>format.</div><div class="t m5 x17 h26 y5e5b ff7 fs19 fc1 sc0 ls0 ws0">Modern<span class="_ _21"> </span>x86-64<span class="_ _21"> </span>Linux<span class="_ _21"> </span>and<span class="_ _21"> </span>Unix<span class="_ _21"> </span>systems<span class="_ _21"> </span>use<span class="_ _21"> </span><span class="ffa">Executable<span class="_ _21"> </span>and<span class="_ _21"> </span>Linkable<span class="_ _21"> </span>F<span class="_ _1"></span>ormat</span></div><div class="t m5 x17 h26 y5e5c ffa fs19 fc1 sc0 ls0 ws0">(ELF)<span class="_ _3"></span><span class="ff7">.<span class="_"> </span>Although<span class="_"> </span>our<span class="_ _13"> </span>discussion<span class="_"> </span>will<span class="_ _13"> </span>focus<span class="_"> </span>on<span class="_ _13"> </span>ELF<span class="_ _7"></span>,<span class="_"> </span>the<span class="_"> </span>basic<span class="_ _13"> </span>concepts<span class="_"> </span>are<span class="_ _13"> </span>similar,</span></div><div class="t m5 x17 h26 y5e5d ff7 fs19 fc1 sc0 ls0 ws0">regardless<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>particular<span class="_"> </span>format.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
