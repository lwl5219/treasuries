<div id="pf29b" class="pf w2 h11" data-page-no="29b"><div class="pc pc29b w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg29b.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">666<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>6<span class="_ _3d"> </span>The<span class="_ _10"> </span>Memory<span class="_ _10"> </span>Hierarchy</span></div><div class="t m5 x124 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">B<span class="_ _3"></span>.<span class="_ _1d"> </span>Memory<span class="_"> </span>reference:</div><div class="t m5 x4f h31 y58cc ff7 fs21 fc2 sc0 ls0 ws0">Parameter<span class="_ _1d7"> </span>V<span class="_ _7"></span>alue</div><div class="t m5 x4f h31 y58cd ff7 fs21 fc2 sc0 ls0 ws0">Cache<span class="_"> </span>block<span class="_"> </span>offset<span class="_"> </span>(CO)<span class="_ _26"> </span><span class="ffd fs1e">0x</span></div><div class="t m5 x4f h31 y58ce ff7 fs21 fc1 sc0 ls0 ws0">Cache<span class="_"> </span>set<span class="_"> </span>index<span class="_"> </span>(CI)</div><div class="t m5 x16 h2d y249e ffd fs1e fc1 sc0 ls0 ws0">0x</div><div class="t m5 x4f h31 y58cf ff7 fs21 fc1 sc0 ls0 ws0">Cache<span class="_"> </span>tag<span class="_"> </span>(CT)<span class="_ _1d5"> </span><span class="ffd fs1e">0x</span></div><div class="t m5 x4f h31 y58d0 ff7 fs21 fc1 sc0 ls0 ws0">Cache<span class="_"> </span>hit?<span class="_"> </span>(Y/N)</div><div class="t m5 x4f h31 y24e4 ff7 fs21 fc1 sc0 ls0 ws0">Cache<span class="_"> </span>byte<span class="_"> </span>returned<span class="_ _88"> </span><span class="ffd fs1e">0x</span></div><div class="t m5 x1d h47 ycdb ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>6.16<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>701)</span></div><div class="t m5 x1d h26 y37bb ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_"> </span>the<span class="_"> </span>cache<span class="_ _11"> </span>in<span class="_"> </span>Problem<span class="_"> </span>6.12,<span class="_ _11"> </span>list<span class="_"> </span>all<span class="_"> </span>of<span class="_"> </span>the<span class="_ _11"> </span>hexadecimal<span class="_"> </span>memory<span class="_"> </span>addresses<span class="_ _11"> </span>that</div><div class="t m5 x1d h26 y58d1 ff7 fs19 fc1 sc0 ls0 ws0">will<span class="_"> </span>hit<span class="_"> </span>in<span class="_"> </span>set<span class="_"> </span>3.</div><div class="t m5 x1d h41 y48d9 ffe fs29 fc1 sc0 ls0 ws0">6.4.5<span class="_ _48"> </span><span class="fs19">Issues<span class="_"> </span>with<span class="_"> </span>W<span class="_ _0"></span>rites</span></div><div class="t m5 x1d h26 y418 ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_ _13"> </span>we<span class="_ _13"> </span>have<span class="_ _13"> </span>seen,<span class="_ _13"> </span>the<span class="_ _13"> </span>operation<span class="_ _13"> </span>of<span class="_ _13"> </span>a<span class="_ _13"> </span>cache<span class="_ _13"> </span>with<span class="_ _13"> </span>respect<span class="_ _13"> </span>to<span class="_ _13"> </span>reads<span class="_ _13"> </span>is<span class="_ _13"> </span>straightforward.</div><div class="t m5 x1d h26 y419 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>irst,<span class="_ _16"> </span>look<span class="_ _11"> </span>for<span class="_ _11"> </span>a<span class="_ _16"> </span>copy<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>desired<span class="_ _11"> </span>word<span class="_ _11"> </span><span class="ff11">w<span class="_"> </span></span>in<span class="_ _11"> </span>the<span class="_ _11"> </span>cache.<span class="_"> </span>If<span class="_ _16"> </span>there<span class="_ _11"> </span>is<span class="_ _11"> </span>a<span class="_ _11"> </span>hit,<span class="_ _16"> </span>return</div><div class="t m5 x1d h26 y41a ff11 fs19 fc1 sc0 ls0 ws0">w<span class="_"> </span><span class="ff7">immediately<span class="_ _3"></span>.<span class="_ _16"> </span>If<span class="_ _16"> </span>there<span class="_ _16"> </span>is<span class="_ _14"> </span>a<span class="_ _16"> </span>miss<span class="_ _1"></span>,<span class="_ _14"> </span>fetch<span class="_ _16"> </span>the<span class="_ _16"> </span>block<span class="_ _16"> </span>that<span class="_ _16"> </span>contains<span class="_ _16"> </span><span class="ff11">w<span class="_ _14"> </span></span>from<span class="_ _16"> </span>the<span class="_ _14"> </span>next</span></div><div class="t m5 x1d h26 y41b ff7 fs19 fc1 sc0 ls0 ws0">lower<span class="_"> </span>level<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>memory<span class="_"> </span>hierarchy<span class="_ _3"></span>,<span class="_"> </span>store<span class="_"> </span>the<span class="_"> </span>block<span class="_ _13"> </span>in<span class="_"> </span>some<span class="_"> </span>cache<span class="_"> </span>line<span class="_"> </span>(possibly</div><div class="t m5 x1d h26 y41c ff7 fs19 fc1 sc0 ls0 ws0">evicting<span class="_"> </span>a<span class="_"> </span>valid<span class="_"> </span>line),<span class="_"> </span>and<span class="_"> </span>then<span class="_"> </span>return<span class="_"> </span><span class="ff11">w<span class="_ _2"></span></span>.</div><div class="t m5 x29 h26 y41d ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>situation<span class="_ _13"> </span>for<span class="_ _13"> </span>writes<span class="_"> </span>is<span class="_ _13"> </span>a<span class="_"> </span>little<span class="_ _13"> </span>more<span class="_ _13"> </span>complicated.<span class="_"> </span>Suppose<span class="_ _13"> </span>we<span class="_ _13"> </span>write<span class="_"> </span>a<span class="_ _13"> </span>word</div><div class="t m5 x1d h26 y41e ff11 fs19 fc1 sc0 ls0 ws0">w<span class="_ _11"> </span><span class="ff7">that<span class="_"> </span>is<span class="_"> </span>already<span class="_"> </span>cached<span class="_"> </span>(a<span class="_"> </span><span class="ffa">write<span class="_"> </span>hit<span class="_ _2"></span></span>).<span class="_"> </span>After<span class="_"> </span>the<span class="_"> </span>cache<span class="_ _13"> </span>updates<span class="_"> </span>its<span class="_"> </span>copy<span class="_"> </span>of<span class="_"> </span></span>w<span class="_ _2"></span><span class="ff7">,<span class="_"> </span>what</span></div><div class="t m5 x1d h26 y41f ff7 fs19 fc1 sc0 ls0 ws0">does<span class="_"> </span>it<span class="_"> </span>do<span class="_ _11"> </span>about<span class="_"> </span>updating<span class="_"> </span>the<span class="_ _11"> </span>copy<span class="_"> </span>of<span class="_"> </span><span class="ff11">w<span class="_ _16"> </span></span>in<span class="_"> </span>the<span class="_"> </span>next<span class="_"> </span>lower<span class="_ _11"> </span>level<span class="_"> </span>of<span class="_"> </span>the<span class="_ _11"> </span>hierarchy?</div><div class="t m5 x1d h26 y420 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>simplest<span class="_ _13"> </span>approach,<span class="_ _13"> </span>known<span class="_ _13"> </span>as<span class="_ _13"> </span><span class="ffa">write-through</span>,<span class="_"> </span>is<span class="_ _13"> </span>to<span class="_ _13"> </span>immediately<span class="_ _13"> </span>write<span class="_ _13"> </span><span class="ff11">w<span class="_ _2"></span></span>’s<span class="_ _13"> </span>cache</div><div class="t m5 x1d h26 y421 ff7 fs19 fc1 sc0 ls0 ws0">block<span class="_ _16"> </span>to<span class="_ _11"> </span>the<span class="_ _16"> </span>next<span class="_ _16"> </span>lower<span class="_ _11"> </span>level.<span class="_ _16"> </span>While<span class="_ _11"> </span>simple,<span class="_ _11"> </span>write-through<span class="_ _16"> </span>has<span class="_ _16"> </span>the<span class="_ _11"> </span>disadvantage</div><div class="t m5 x1d h26 y423 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_ _11"> </span>causing<span class="_ _16"> </span>bus<span class="_ _16"> </span>trafﬁc<span class="_ _11"> </span>with<span class="_ _16"> </span>every<span class="_ _11"> </span>write.<span class="_"> </span>Another<span class="_ _16"> </span>approach,<span class="_ _16"> </span>known<span class="_ _11"> </span>as<span class="_ _16"> </span><span class="ffa">write-back</span>,</div><div class="t m5 x1d h26 y424 ff7 fs19 fc1 sc0 ls0 ws0">defers<span class="_ _6"> </span>the<span class="_ _13"> </span>update<span class="_ _6"> </span>as<span class="_ _6"> </span>long<span class="_ _13"> </span>as<span class="_ _6"> </span>possible<span class="_ _6"> </span>by<span class="_ _13"> </span>writing<span class="_ _6"> </span>the<span class="_ _6"> </span>updated<span class="_ _13"> </span>block<span class="_ _6"> </span>to<span class="_ _6"> </span>the<span class="_ _13"> </span>next<span class="_ _a"> </span>lower</div><div class="t m5 x1d h26 y425 ff7 fs19 fc1 sc0 ls0 ws0">level<span class="_ _6"> </span>only<span class="_ _13"> </span>when<span class="_ _6"> </span>it<span class="_ _13"> </span>is<span class="_ _6"> </span>evicted<span class="_ _13"> </span>from<span class="_ _6"> </span>the<span class="_ _13"> </span>cache<span class="_ _6"> </span>by<span class="_ _13"> </span>the<span class="_ _6"> </span>replacement<span class="_ _13"> </span>algorithm.<span class="_ _6"> </span>Because</div><div class="t m5 x1d h26 y426 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span>locality<span class="_ _7"></span>,<span class="_"> </span>write-back<span class="_ _13"> </span>can<span class="_"> </span>signiﬁcantly<span class="_ _13"> </span>reduce<span class="_"> </span>the<span class="_ _13"> </span>amount<span class="_"> </span>of<span class="_"> </span>bus<span class="_ _13"> </span>trafﬁc,<span class="_ _13"> </span>but<span class="_"> </span>it<span class="_ _13"> </span>has</div><div class="t m5 x1d h26 y427 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _13"> </span>disadvantage<span class="_ _13"> </span>of<span class="_ _13"> </span>additional<span class="_ _13"> </span>complexity<span class="_ _3"></span>.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span>cache<span class="_ _13"> </span>must<span class="_ _13"> </span>maintain<span class="_ _13"> </span>an<span class="_ _13"> </span>additional</div><div class="t m5 x1d h26 y428 ffa fs19 fc1 sc0 ls0 ws0">dirty<span class="_ _13"> </span>bit<span class="_"> </span><span class="ff7">for<span class="_ _13"> </span>each<span class="_ _13"> </span>cache<span class="_ _13"> </span>line<span class="_ _13"> </span>that<span class="_ _13"> </span>indicates<span class="_ _13"> </span>whether<span class="_ _13"> </span>or<span class="_ _13"> </span>not<span class="_ _13"> </span>the<span class="_ _13"> </span>cache<span class="_ _13"> </span>block<span class="_ _13"> </span>has<span class="_ _13"> </span>been</span></div><div class="t m5 x1d h26 y429 ff7 fs19 fc1 sc0 ls0 ws0">modiﬁed.</div><div class="t m5 x29 h26 y42a ff7 fs19 fc1 sc0 ls0 ws0">Another<span class="_ _13"> </span>issue<span class="_ _6"> </span>is<span class="_ _13"> </span>how<span class="_ _13"> </span>to<span class="_ _6"> </span>deal<span class="_ _13"> </span>with<span class="_ _6"> </span>write<span class="_ _13"> </span>misses<span class="_ _1"></span>.<span class="_ _13"> </span>One<span class="_ _6"> </span>approach,<span class="_ _13"> </span>known<span class="_ _13"> </span>as<span class="_ _13"> </span><span class="ffa">write-</span></div><div class="t m5 x1d h26 y42b ffa fs19 fc1 sc0 ls0 ws0">allocate<span class="ff7">,<span class="_ _16"> </span>loads<span class="_ _11"> </span>the<span class="_ _16"> </span>corresponding<span class="_ _11"> </span>block<span class="_ _16"> </span>from<span class="_ _11"> </span>the<span class="_ _11"> </span>next<span class="_ _16"> </span>lower<span class="_ _11"> </span>level<span class="_ _16"> </span>into<span class="_ _11"> </span>the<span class="_ _16"> </span>cache</span></div><div class="t m5 x1d h26 y42c ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _16"> </span>then<span class="_ _11"> </span>updates<span class="_ _16"> </span>the<span class="_ _16"> </span>cache<span class="_ _16"> </span>block.<span class="_ _16"> </span>Write-allocate<span class="_ _11"> </span>tries<span class="_ _16"> </span>to<span class="_ _16"> </span>exploit<span class="_ _16"> </span>spatial<span class="_ _16"> </span>locality</div><div class="t m5 x1d h26 y42d ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_ _16"> </span>writes<span class="_ _1"></span>,<span class="_ _14"> </span>but<span class="_ _14"> </span>it<span class="_ _16"> </span>has<span class="_ _16"> </span>the<span class="_ _14"> </span>disadvantage<span class="_ _16"> </span>that<span class="_ _14"> </span>every<span class="_ _16"> </span>miss<span class="_ _16"> </span>results<span class="_ _14"> </span>in<span class="_ _16"> </span>a<span class="_ _14"> </span>block<span class="_ _16"> </span>transfer</div><div class="t m5 x1d h26 y42e ff7 fs19 fc1 sc0 ls0 ws0">from<span class="_ _13"> </span>the<span class="_ _6"> </span>next<span class="_ _13"> </span>lower<span class="_ _6"> </span>level<span class="_ _13"> </span>to<span class="_ _6"> </span>the<span class="_ _13"> </span>cache<span class="_ _1"></span>.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span>alternative<span class="_ _1"></span>,<span class="_ _13"> </span>known<span class="_ _13"> </span>as<span class="_ _6"> </span><span class="ffa">no-write-allocate</span>,</div><div class="t m5 x1d h26 y42f ff7 fs19 fc1 sc0 ls0 ws0">bypasses<span class="_ _16"> </span>the<span class="_ _14"> </span>cache<span class="_ _16"> </span>and<span class="_ _14"> </span>writes<span class="_ _14"> </span>the<span class="_ _16"> </span>word<span class="_ _14"> </span>directly<span class="_ _16"> </span>to<span class="_ _14"> </span>the<span class="_ _14"> </span>next<span class="_ _16"> </span>lower<span class="_ _14"> </span>level.<span class="_ _16"> </span>Write-</div><div class="t m5 x1d h26 y430 ff7 fs19 fc1 sc0 ls0 ws0">through<span class="_ _15"> </span>caches<span class="_ _15"> </span>are<span class="_ _21"> </span>typically<span class="_ _15"> </span>no-write-allocate.<span class="_ _14"> </span>Write-back<span class="_ _21"> </span>caches<span class="_ _15"> </span>are<span class="_ _21"> </span>typically</div><div class="t m5 x1d h26 y431 ff7 fs19 fc1 sc0 ls0 ws0">write-allocate<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y432 ff7 fs19 fc1 sc0 ls0 ws0">Optimizing<span class="_ _16"> </span>caches<span class="_ _16"> </span>for<span class="_ _14"> </span>writes<span class="_ _16"> </span>is<span class="_ _16"> </span>a<span class="_ _16"> </span>subtle<span class="_ _14"> </span>and<span class="_ _16"> </span>difﬁcult<span class="_ _16"> </span>issue,<span class="_ _16"> </span>and<span class="_ _16"> </span>we<span class="_ _14"> </span>are<span class="_ _16"> </span>only</div><div class="t m5 x1d h26 y433 ff7 fs19 fc1 sc0 ls0 ws0">scratching<span class="_"> </span>the<span class="_"> </span>surface<span class="_"> </span>here<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>details<span class="_"> </span>vary<span class="_"> </span>from<span class="_"> </span>system<span class="_"> </span>to<span class="_"> </span>system<span class="_"> </span>and<span class="_"> </span>are<span class="_ _13"> </span>often</div><div class="t m5 x1d h26 y58d2 ff7 fs19 fc1 sc0 ls0 ws0">proprietary<span class="_ _11"> </span>and<span class="_ _16"> </span>poorly<span class="_ _11"> </span>documented.<span class="_ _11"> </span>T<span class="_ _3"></span>o<span class="_ _16"> </span>the<span class="_ _11"> </span>programmer<span class="_ _11"> </span>trying<span class="_ _16"> </span>to<span class="_ _11"> </span>write<span class="_ _16"> </span>reason-</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
