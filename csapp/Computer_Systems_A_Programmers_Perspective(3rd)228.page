<div id="pfe4" class="pf w2 h11" data-page-no="e4"><div class="pc pce4 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bge4.png"/><div class="t m5 x191 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>3.5<span class="_ _60"> </span>Arithmetic<span class="_ _10"> </span>and<span class="_ _10"> </span>Logical<span class="_ _10"> </span>Operations<span class="_ _3e"> </span><span class="ffe fs1e">227</span></div><div class="t m5 x17 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>herefore,<span class="_"> </span>the<span class="_ _13"> </span>behavior<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>instruction<span class="_"> </span><span class="ffd">pushq<span class="_ _11"> </span>%rbp<span class="_ _10"> </span></span>is<span class="_"> </span>equivalent<span class="_"> </span>to<span class="_"> </span>that<span class="_"> </span>of<span class="_"> </span>the</div><div class="t m5 x17 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">pair<span class="_"> </span>of<span class="_"> </span>instructions</div><div class="t m5 x72 h2d y22f5 ffd fs1e fc2 sc0 ls0 ws0">subq<span class="_ _e"> </span>$8,%rsp<span class="_ _13b"> </span><span class="ff13 fs35 fc6">Decrement<span class="_ _f"> </span>stack<span class="_ _f"> </span>pointer</span></div><div class="t m5 x72 h2d y22f6 ffd fs1e fc2 sc0 ls0 ws0">movq<span class="_ _e"> </span>%rbp,(%rsp)<span class="_ _9a"> </span><span class="ff13 fs35 fc6">Store<span class="_ _f"> </span>%rbp<span class="_ _f"> </span>on<span class="_ _e"> </span>stack</span></div><div class="t m5 x17 h26 y22f7 ff7 fs19 fc2 sc0 ls0 ws0">except<span class="_"> </span>that<span class="_ _13"> </span>the<span class="_"> </span><span class="ffd">pushq<span class="_ _10"> </span></span>instruction<span class="_"> </span>is<span class="_ _13"> </span>encoded<span class="_"> </span>in<span class="_"> </span>the<span class="_ _13"> </span>machine<span class="_"> </span>code<span class="_"> </span>as<span class="_"> </span>a<span class="_ _13"> </span>single<span class="_"> </span>byte<span class="_ _1"></span>,</div><div class="t m5 x17 h26 y22f8 ff7 fs19 fc2 sc0 ls0 ws0">whereas<span class="_"> </span>the<span class="_"> </span>pair<span class="_"> </span>of<span class="_"> </span>instructions<span class="_"> </span>shown<span class="_"> </span>above<span class="_"> </span>requires<span class="_"> </span>a<span class="_"> </span>total<span class="_"> </span>of<span class="_"> </span>8<span class="_"> </span>bytes<span class="_ _0"></span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>ﬁrst</div><div class="t m5 x17 h26 y22f9 ff7 fs19 fc2 sc0 ls0 ws0">two<span class="_"> </span>columns<span class="_ _11"> </span>in<span class="_ _11"> </span>Figure<span class="_"> </span>3.9<span class="_ _11"> </span>illustrate<span class="_ _11"> </span>the<span class="_ _11"> </span>effect<span class="_"> </span>of<span class="_ _11"> </span>executing<span class="_ _11"> </span>the<span class="_ _11"> </span>instruction<span class="_ _11"> </span><span class="ffd">pushq</span></div><div class="t m5 x17 h26 y22fa ffd fs19 fc2 sc0 ls0 ws0">%rax<span class="_ _13"> </span><span class="ff7">when<span class="_ _13"> </span></span>%rsp<span class="_ _13"> </span><span class="ff7">is<span class="_ _6"> </span></span>0x108<span class="_ _13"> </span><span class="ff7">and<span class="_ _13"> </span></span>%rax<span class="_ _13"> </span><span class="ff7">is<span class="_ _13"> </span></span>0x123<span class="ff7">.<span class="_ _13"> </span>F<span class="_ _1"></span>irst<span class="_ _13"> </span><span class="ffd">%rsp<span class="_ _13"> </span></span>is<span class="_ _13"> </span>decremented<span class="_ _13"> </span>by<span class="_ _6"> </span>8,<span class="_"> </span>giving</span></div><div class="t m5 x17 h26 y22fb ffd fs19 fc2 sc0 ls0 ws0">0x100<span class="ff7">,<span class="_"> </span>and<span class="_"> </span>then<span class="_"> </span></span>0x123<span class="_ _10"> </span><span class="ff7">is<span class="_"> </span>stored<span class="_"> </span>at<span class="_"> </span>memory<span class="_"> </span>address<span class="_"> </span></span>0x100<span class="ff7">.</span></div><div class="t m5 x26 h26 y22fc ff7 fs19 fc2 sc0 ls0 ws0">P<span class="_ _1"></span>opping<span class="_ _15"> </span>a<span class="_ _21"> </span>quad<span class="_ _15"> </span>word<span class="_ _21"> </span>involves<span class="_ _15"> </span>reading<span class="_ _21"> </span>from<span class="_ _15"> </span>the<span class="_ _21"> </span>top-of-stack<span class="_ _15"> </span>location<span class="_ _21"> </span>and</div><div class="t m5 x17 h26 y22fd ff7 fs19 fc2 sc0 ls0 ws0">then<span class="_ _16"> </span>incrementing<span class="_ _14"> </span>the<span class="_ _14"> </span>stack<span class="_ _14"> </span>pointer<span class="_ _16"> </span>by<span class="_ _14"> </span>8.<span class="_ _14"> </span>T<span class="_ _1"></span>herefore,<span class="_ _14"> </span>the<span class="_ _16"> </span>instruction<span class="_ _14"> </span><span class="ffd">popq<span class="_ _14"> </span>%rax</span></div><div class="t m5 x17 h26 y22fe ff7 fs19 fc2 sc0 ls0 ws0">is<span class="_"> </span>equivalent<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>pair<span class="_"> </span>of<span class="_"> </span>instructions:</div><div class="t m5 x72 h2d y22ff ffd fs1e fc2 sc0 ls0 ws0">movq<span class="_ _e"> </span>(%rsp),%rax<span class="_ _9a"> </span><span class="ff13 fs35 fc6">Read<span class="_ _f"> </span>%rax<span class="_ _f"> </span>from<span class="_ _e"> </span>stack</span></div><div class="t m5 x72 h2d y2300 ffd fs1e fc2 sc0 ls0 ws0">addq<span class="_ _e"> </span>$8,%rsp<span class="_ _13b"> </span><span class="ff13 fs35 fc6">Increment<span class="_ _f"> </span>stack<span class="_ _f"> </span>pointer</span></div><div class="t m5 x26 h26 y2301 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _6"> </span>third<span class="_ _13"> </span>column<span class="_ _a"> </span>of<span class="_ _6"> </span>Figure<span class="_ _a"> </span>3.9<span class="_ _6"> </span>illustrates<span class="_ _6"> </span>the<span class="_ _13"> </span>effect<span class="_ _a"> </span>of<span class="_ _6"> </span>executing<span class="_ _6"> </span>the<span class="_ _13"> </span>instruction</div><div class="t m5 x17 h26 y2302 ffd fs19 fc2 sc0 ls0 ws0">popq<span class="_ _f"> </span>%edx<span class="_ _e"> </span><span class="ff7">immediately<span class="_ _f"> </span>after<span class="_ _f"> </span>executing<span class="_ _e"> </span>the<span class="_ _f"> </span></span>pushq<span class="ff7">.<span class="_ _e"> </span>V<span class="_ _4"></span>alue<span class="_ _e"> </span><span class="ffd">0x123<span class="_ _f"> </span></span>is<span class="_ _e"> </span>read<span class="_ _21"> </span>from</span></div><div class="t m5 x17 h26 y2303 ff7 fs19 fc2 sc0 ls0 ws0">memory<span class="_ _13"> </span>and<span class="_ _6"> </span>written<span class="_ _13"> </span>to<span class="_ _13"> </span>register<span class="_ _13"> </span><span class="ffd">%rdx</span>.<span class="_ _6"> </span>Register<span class="_ _13"> </span><span class="ffd">%rsp<span class="_ _13"> </span></span>is<span class="_ _13"> </span>incremented<span class="_ _6"> </span>back<span class="_ _13"> </span>to<span class="_ _13"> </span><span class="ffd">0x108</span>.</div><div class="t m5 x17 h26 y2304 ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_ _13"> </span>shown<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_ _13"> </span>ﬁgure,<span class="_ _13"> </span>the<span class="_ _13"> </span>value<span class="_ _13"> </span><span class="ffd">0x123<span class="_ _13"> </span></span>remains<span class="_ _13"> </span>at<span class="_ _13"> </span>memory<span class="_"> </span>location<span class="_ _13"> </span><span class="ffd">0x104<span class="_ _13"> </span></span>until<span class="_ _13"> </span>it</div><div class="t m5 x17 h26 y2305 ff7 fs19 fc2 sc0 ls0 ws0">is<span class="_"> </span>overwritten<span class="_ _13"> </span>(e.g<span class="_ _1"></span>.,<span class="_"> </span>by<span class="_"> </span>another<span class="_ _13"> </span>push<span class="_"> </span>operation).<span class="_ _13"> </span>However,<span class="_"> </span>the<span class="_ _13"> </span>stack<span class="_"> </span>top<span class="_"> </span>is<span class="_ _13"> </span>always</div><div class="t m5 x17 h26 y2306 ff7 fs19 fc2 sc0 ls0 ws0">considered<span class="_"> </span>to<span class="_"> </span>be<span class="_"> </span>the<span class="_"> </span>address<span class="_"> </span>indicated<span class="_"> </span>by<span class="_"> </span><span class="ffd">%rsp</span>.</div><div class="t m5 x26 h26 y2307 ff7 fs19 fc2 sc0 ls0 ws0">Since<span class="_ _16"> </span>the<span class="_ _14"> </span>stack<span class="_ _14"> </span>is<span class="_ _14"> </span>contained<span class="_ _16"> </span>in<span class="_ _14"> </span>the<span class="_ _14"> </span>same<span class="_ _14"> </span>memory<span class="_ _16"> </span>as<span class="_ _14"> </span>the<span class="_ _14"> </span>program<span class="_ _16"> </span>code<span class="_ _14"> </span>and</div><div class="t m5 x17 h26 y2308 ff7 fs19 fc2 sc0 ls0 ws0">other<span class="_ _11"> </span>forms<span class="_ _11"> </span>of<span class="_ _11"> </span>program<span class="_ _11"> </span>data,<span class="_ _16"> </span>programs<span class="_"> </span>can<span class="_ _16"> </span>access<span class="_"> </span>arbitrary<span class="_ _16"> </span>positions<span class="_"> </span>within<span class="_ _11"> </span>the</div><div class="t m5 x17 h26 y2309 ff7 fs19 fc2 sc0 ls0 ws0">stack<span class="_ _13"> </span>using<span class="_"> </span>the<span class="_ _13"> </span>standard<span class="_"> </span>memory<span class="_ _13"> </span>addressing<span class="_"> </span>methods<span class="_ _3"></span>.<span class="_"> </span>F<span class="_ _3"></span>or<span class="_"> </span>example<span class="_ _1"></span>,<span class="_"> </span>assuming<span class="_ _13"> </span>the</div><div class="t m5 x17 h26 y230a ff7 fs19 fc2 sc0 ls0 ws0">topmost<span class="_"> </span>element<span class="_"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>stack<span class="_"> </span>is<span class="_"> </span>a<span class="_"> </span>quad<span class="_"> </span>word,<span class="_"> </span>the<span class="_"> </span>instruction<span class="_"> </span><span class="ffd">movq<span class="_ _11"> </span>8(%rsp),%rdx</span></div><div class="t m5 x17 h26 y230b ff7 fs19 fc2 sc0 ls0 ws0">will<span class="_"> </span>copy<span class="_"> </span>the<span class="_"> </span>second<span class="_"> </span>quad<span class="_"> </span>word<span class="_"> </span>from<span class="_"> </span>the<span class="_"> </span>stack<span class="_"> </span>to<span class="_"> </span>register<span class="_"> </span><span class="ffd">%rdx</span>.</div><div class="t m5 x17 h3b y230c fff fs24 fc6 sc0 ls0 ws0">3.5<span class="_ _17"> </span><span class="ffe fs18">Arithmetic<span class="_"> </span>and<span class="_"> </span>Logical<span class="_"> </span>Operations</span></div><div class="t m5 x17 h26 y230d ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _21"> </span>3.10<span class="_ _21"> </span>lists<span class="_ _21"> </span>some<span class="_ _21"> </span>of<span class="_ _21"> </span>the<span class="_ _21"> </span>x86-64<span class="_ _21"> </span>integer<span class="_ _15"> </span>and<span class="_ _21"> </span>logic<span class="_ _21"> </span>operations<span class="_ _1"></span>.<span class="_ _21"> </span>Most<span class="_ _21"> </span>of<span class="_ _21"> </span>the</div><div class="t m5 x17 h26 y230e ff7 fs19 fc1 sc0 ls0 ws0">operations<span class="_ _13"> </span>are<span class="_ _13"> </span>given<span class="_ _13"> </span>as<span class="_ _13"> </span>instruction<span class="_ _13"> </span>classes<span class="_ _3"></span>,<span class="_"> </span>as<span class="_ _6"> </span>they<span class="_ _13"> </span>can<span class="_ _13"> </span>have<span class="_ _13"> </span>different<span class="_ _13"> </span>variants<span class="_ _13"> </span>with</div><div class="t m5 x17 h26 y230f ff7 fs19 fc1 sc0 ls0 ws0">different<span class="_"> </span>operand<span class="_ _11"> </span>sizes<span class="_ _1"></span>.<span class="_ _11"> </span>(Only<span class="_ _11"> </span><span class="ffd">leaq<span class="_ _11"> </span></span>has<span class="_"> </span>no<span class="_ _11"> </span>other<span class="_ _11"> </span>size<span class="_ _11"> </span>variants<span class="_ _1"></span>.)<span class="_ _11"> </span>F<span class="_ _1"></span>or<span class="_ _11"> </span>example<span class="_ _1"></span>,<span class="_ _11"> </span>the</div><div class="t m5 x17 h26 y2310 ff7 fs19 fc1 sc0 ls0 ws0">instruction<span class="_"> </span>class<span class="_"> </span><span class="ff9">add<span class="_ _10"> </span></span>consists<span class="_"> </span>of<span class="_"> </span>four<span class="_"> </span>addition<span class="_"> </span>instructions:<span class="_"> </span><span class="ffd">addb</span>,<span class="_"> </span><span class="ffd">addw</span>,<span class="_ _13"> </span><span class="ffd">addl</span>,<span class="_"> </span>and</div><div class="t m5 x17 h26 y2311 ffd fs19 fc1 sc0 ls0 ws0">addq<span class="ff7">,<span class="_ _16"> </span>adding<span class="_ _16"> </span>bytes<span class="_ _1"></span>,<span class="_ _16"> </span>words<span class="_ _0"></span>,<span class="_ _16"> </span>double<span class="_ _16"> </span>words<span class="_ _1"></span>,<span class="_ _16"> </span>and<span class="_ _16"> </span>quad<span class="_ _16"> </span>words<span class="_ _1"></span>,<span class="_ _14"> </span>respectively<span class="_ _3"></span>.<span class="_ _16"> </span>Indeed,</span></div><div class="t m5 x17 h26 y2312 ff7 fs19 fc1 sc0 ls0 ws0">each<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>instruction<span class="_"> </span>classes<span class="_"> </span>shown<span class="_"> </span>has<span class="_"> </span>instructions<span class="_"> </span>for<span class="_"> </span>operating<span class="_"> </span>on<span class="_"> </span>these<span class="_"> </span>four</div><div class="t m5 x17 h26 y2313 ff7 fs19 fc1 sc0 ls0 ws0">different<span class="_"> </span>sizes<span class="_ _13"> </span>of<span class="_"> </span>data.<span class="_ _13"> </span>T<span class="_ _0"></span>he<span class="_ _13"> </span>operations<span class="_"> </span>are<span class="_"> </span>divided<span class="_ _13"> </span>into<span class="_"> </span>four<span class="_ _13"> </span>groups:<span class="_"> </span>load<span class="_ _13"> </span>effective</div><div class="t m5 x17 h26 y2314 ff7 fs19 fc1 sc0 ls0 ws0">address<span class="_ _1"></span>,<span class="_ _21"> </span>unary<span class="_ _3"></span>,<span class="_ _21"> </span>binary<span class="_ _3"></span>,<span class="_ _21"> </span>and<span class="_ _15"> </span>shifts<span class="_ _0"></span>.<span class="_ _15"> </span><span class="ffa">Binary<span class="_ _14"> </span></span>operations<span class="_ _21"> </span>have<span class="_ _15"> </span>two<span class="_ _15"> </span>operands<span class="_ _1"></span>,<span class="_ _21"> </span>while</div><div class="t m5 x17 h26 y2315 ffa fs19 fc1 sc0 ls0 ws0">unary<span class="_ _13"> </span><span class="ff7">operations<span class="_"> </span>have<span class="_"> </span>one<span class="_ _13"> </span>operand.<span class="_"> </span>T<span class="_ _1"></span>hese<span class="_"> </span>operands<span class="_ _13"> </span>are<span class="_"> </span>speciﬁed<span class="_"> </span>using<span class="_ _13"> </span>the<span class="_"> </span>same</span></div><div class="t m5 x17 h26 y2316 ff7 fs19 fc1 sc0 ls0 ws0">notation<span class="_"> </span>as<span class="_"> </span>described<span class="_"> </span>in<span class="_"> </span>Section<span class="_"> </span>3.4.</div><div class="t m5 x17 h41 y1672 ffe fs29 fc1 sc0 ls0 ws0">3.5.1<span class="_ _48"> </span><span class="fs19">Load<span class="_"> </span>Effective<span class="_"> </span>Address</span></div><div class="t m5 x17 h26 y6e1 ff7 fs19 fc1 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _15"> </span><span class="ffa ls0">load<span class="_ _15"> </span>effective<span class="_ _14"> </span>address<span class="_ _14"> </span><span class="ff7">instruction<span class="_ _14"> </span><span class="ffd">leaq<span class="_ _15"> </span></span>is<span class="_ _14"> </span>actually<span class="_ _14"> </span>a<span class="_ _14"> </span>variant<span class="_ _15"> </span>of<span class="_ _14"> </span>the<span class="_ _14"> </span><span class="ffd">movq<span class="_ _14"> </span></span>in-</span></span></div><div class="t m5 x17 h26 y6e2 ff7 fs19 fc1 sc0 ls0 ws0">struction.<span class="_"> </span>It<span class="_ _11"> </span>has<span class="_ _11"> </span>the<span class="_"> </span>form<span class="_ _11"> </span>of<span class="_ _11"> </span>an<span class="_"> </span>instruction<span class="_ _11"> </span>that<span class="_ _11"> </span>reads<span class="_"> </span>from<span class="_ _11"> </span>memory<span class="_ _11"> </span>to<span class="_"> </span>a<span class="_ _11"> </span>register,</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
