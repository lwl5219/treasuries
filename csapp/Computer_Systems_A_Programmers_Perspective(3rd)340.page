<div id="pf154" class="pf w2 h11" data-page-no="154"><div class="pc pc154 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg154.png"/><div class="t m5 x195 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>3.11<span class="_ _60"> </span>Floating-Point<span class="_ _10"> </span>Code<span class="_ _3e"> </span><span class="ffe fs1e">339</span></div><div class="t m5 x2c h2d ye7 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">vsubsd<span class="_ _1a"> </span>%xmm2,<span class="_ _e"> </span>%xmm0,<span class="_ _1f"> </span>%xmm0<span class="_ _c2"> </span></span><span class="ff13 fs35">Subtract<span class="_ _f"> </span>from<span class="_ _f"> </span>a*x</span></div><div class="t m5 x2c h2d yc4d ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _45"> </span><span class="ffd fs1e fc2">ret<span class="_ _186"> </span></span><span class="ff13 fs35">Return</span></div><div class="t m5 x26 h26 y30a5 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _16"> </span>three<span class="_ _11"> </span>ﬂoating-point<span class="_ _11"> </span>arguments<span class="_ _11"> </span><span class="ffd">a</span>,<span class="_ _16"> </span><span class="ffd">x</span>,<span class="_ _11"> </span>and<span class="_ _16"> </span><span class="ffd">b<span class="_ _11"> </span></span>are<span class="_ _11"> </span>passed<span class="_ _16"> </span>in<span class="_"> </span>XMM<span class="_ _16"> </span>registers</div><div class="t m5 x17 h26 y30a6 ffd fs19 fc2 sc0 ls0 ws0">%xmm0<span class="ff7">–</span>%xmm2<span class="ff7">,<span class="_ _16"> </span>while<span class="_ _11"> </span>integer<span class="_ _11"> </span>argument<span class="_ _16"> </span></span>i<span class="_ _11"> </span><span class="ff7">is<span class="_ _16"> </span>passed<span class="_ _11"> </span>in<span class="_ _16"> </span>register<span class="_ _11"> </span></span>%edi<span class="ff7">.<span class="_ _11"> </span>The<span class="_ _11"> </span>standard</span></div><div class="t m5 x17 h26 y30a7 ff7 fs19 fc2 sc0 ls0 ws0">two-instruction<span class="_ _15"> </span>sequence<span class="_ _15"> </span>is<span class="_ _21"> </span>used<span class="_ _15"> </span>to<span class="_ _21"> </span>convert<span class="_ _15"> </span>argument<span class="_ _21"> </span><span class="ffd">x<span class="_ _15"> </span></span>to<span class="_ _15"> </span>double<span class="_ _21"> </span>(lines<span class="_ _15"> </span>2–3).</div><div class="t m5 x17 h26 y30a8 ff7 fs19 fc2 sc0 ls0 ws0">Another<span class="_"> </span>conversion<span class="_ _13"> </span>instruction<span class="_"> </span>is<span class="_ _13"> </span>required<span class="_"> </span>to<span class="_"> </span>convert<span class="_ _13"> </span>argument<span class="_"> </span><span class="ffd">i<span class="_ _10"> </span></span>to<span class="_ _13"> </span>double<span class="_"> </span>(line</div><div class="t m5 x17 h26 y30a9 ff7 fs19 fc2 sc0 ls0 ws0">5).<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>function<span class="_"> </span>value<span class="_"> </span>is<span class="_"> </span>returned<span class="_"> </span>in<span class="_"> </span>register<span class="_"> </span><span class="ffd">%xmm0</span>.</div><div class="t m5 x17 h47 y30aa ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>3.53<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>384)</span></div><div class="t m5 x17 h26 y30ab ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _21"> </span>the<span class="_ _21"> </span>following<span class="_ _21"> </span>C<span class="_ _21"> </span>function,<span class="_ _e"> </span>the<span class="_ _15"> </span>types<span class="_ _21"> </span>of<span class="_ _21"> </span>the<span class="_ _21"> </span>four<span class="_ _21"> </span>arguments<span class="_ _21"> </span>are<span class="_ _21"> </span>deﬁned<span class="_ _21"> </span>by</div><div class="t m5 x17 h26 y30ac ffd fs19 fc1 sc0 ls0 ws0">typedef<span class="ff7">:</span></div><div class="t m5 x17 h2d y30ad ffd fs1e fc2 sc0 ls0 ws0">double<span class="_ _e"> </span>funct1(arg1_t<span class="_ _1f"> </span>p,<span class="_ _1f"> </span>arg2_t<span class="_ _e"> </span>q,<span class="_ _1f"> </span>arg3_t<span class="_ _e"> </span>r,<span class="_ _1f"> </span>arg4_t<span class="_ _1f"> </span>s)</div><div class="t m5 x17 h2d y30ae ffd fs1e fc2 sc0 ls0 ws0">{</div><div class="t m5 x1b6 h2d y30af ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>p/(q+r)<span class="_ _1f"> </span>-<span class="_ _1f"> </span>s;</div><div class="t m5 x17 h2d y30b0 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x17 h26 y30b1 ff7 fs19 fc2 sc0 ls0 ws0">When<span class="_"> </span>compiled,<span class="_"> </span><span class="ff9">gcc<span class="_ _10"> </span></span>generates<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>code:</div><div class="t m5 x2e h61 y30b2 ff13 fs35 fc6 sc0 ls0 ws0">double<span class="_ _f"> </span>funct1(arg1_t<span class="_ _f"> </span>p,<span class="_ _f"> </span>arg2_t<span class="_ _e"> </span>q,<span class="_ _21"> </span>arg3_t<span class="_ _f"> </span>r,<span class="_ _e"> </span>arg4_t<span class="_ _21"> </span>s)</div><div class="t m5 x2c h2d y30b3 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">funct1:</span></div><div class="t m5 x2c h2d y30b4 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">vcvtsi2ssq<span class="_ _5a"> </span>%rsi,<span class="_ _1f"> </span>%xmm2,<span class="_ _e"> </span>%xmm2</span></div><div class="t m5 x2c h2d y30b5 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">vaddss<span class="_ _1a"> </span>%xmm0,<span class="_ _e"> </span>%xmm2,<span class="_ _1f"> </span>%xmm0</span></div><div class="t m5 x2c h2d y30b6 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">vcvtsi2ss<span class="_ _6f"> </span>%edi,<span class="_ _1f"> </span>%xmm2,<span class="_ _e"> </span>%xmm2</span></div><div class="t m5 x2c h2d y30b7 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">vdivss<span class="_ _1a"> </span>%xmm0,<span class="_ _e"> </span>%xmm2,<span class="_ _1f"> </span>%xmm0</span></div><div class="t m5 x2c h2d y30b8 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">vunpcklps<span class="_ _6f"> </span>%xmm0,<span class="_ _1f"> </span>%xmm0,<span class="_ _e"> </span>%xmm0</span></div><div class="t m5 x2c h2d y30b9 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">vcvtps2pd<span class="_ _6f"> </span>%xmm0,<span class="_ _1f"> </span>%xmm0</span></div><div class="t m5 x2c h2d y1849 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _45"> </span><span class="ffd fs1e fc2">vsubsd<span class="_ _1a"> </span>%xmm1,<span class="_ _e"> </span>%xmm0,<span class="_ _1f"> </span>%xmm0</span></div><div class="t m5 x2c h2e y30ba ff6 fs20 fc6 sc0 ls0 ws0">9</div><div class="t m5 xd1 h2d y30bb ffd fs1e fc2 sc0 ls0 ws0">ret</div><div class="t m5 x26 h26 y30bc ff7 fs19 fc2 sc0 ls0 ws0">Determine<span class="_ _16"> </span>the<span class="_ _11"> </span>possible<span class="_ _16"> </span>combinations<span class="_ _16"> </span>of<span class="_ _16"> </span>types<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>four<span class="_ _16"> </span>arguments<span class="_ _11"> </span>(there</div><div class="t m5 x17 h26 y30bd ff7 fs19 fc2 sc0 ls0 ws0">may<span class="_"> </span>be<span class="_"> </span>more<span class="_"> </span>than<span class="_"> </span>one).</div><div class="t m5 x17 h47 y30be ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>3.54<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>385)</span></div><div class="t m5 x17 h26 y30bf ff7 fs19 fc1 sc0 ls0 ws0">Function<span class="_"> </span><span class="ffd">funct2<span class="_ _10"> </span></span>has<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>prototype:</div><div class="t m5 x17 h2d y30c0 ffd fs1e fc2 sc0 ls0 ws0">double<span class="_ _e"> </span>funct2(double<span class="_ _1f"> </span>w,<span class="_ _1f"> </span>int<span class="_ _e"> </span>x,<span class="_ _1f"> </span>float<span class="_ _e"> </span>y,<span class="_ _1f"> </span>long<span class="_ _1f"> </span>z);</div><div class="t m5 x17 h26 y30c1 ff9 fs19 fc2 sc0 ls0 ws0">Gcc<span class="_ _10"> </span><span class="ff7">generates<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>code<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>function:</span></div><div class="t m5 x2e h61 y13c0 ff13 fs35 fc6 sc0 ls0 ws0">double<span class="_ _f"> </span>funct2(double<span class="_ _f"> </span>w,<span class="_ _f"> </span>int<span class="_ _e"> </span>x,<span class="_ _21"> </span>float<span class="_ _f"> </span>y,<span class="_ _e"> </span>long<span class="_ _21"> </span>z)</div><div class="t m5 x2e h61 y2e7c ff13 fs35 fc6 sc0 ls0 ws0">w<span class="_ _f"> </span>in<span class="_ _f"> </span>%xmm0,<span class="_ _f"> </span>x<span class="_ _e"> </span>in<span class="_ _21"> </span>%edi,<span class="_ _f"> </span>y<span class="_ _e"> </span>in<span class="_ _21"> </span>%xmm1,<span class="_ _f"> </span>z<span class="_ _e"> </span>in<span class="_ _21"> </span>%rsi</div><div class="t m5 x2c h2d y8d6 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">funct2:</span></div><div class="t m5 x2c h2d y77e ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">vcvtsi2ss<span class="_ _6f"> </span>%edi,<span class="_ _1f"> </span>%xmm2,<span class="_ _e"> </span>%xmm2</span></div><div class="t m5 x2c h2d ye95 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">vmulss<span class="_ _1a"> </span>%xmm1,<span class="_ _e"> </span>%xmm2,<span class="_ _1f"> </span>%xmm1</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
