<div id="pf3cf" class="pf w2 h11" data-page-no="3cf"><div class="pc pc3cf w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg3cf.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">974<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>11<span class="_ _3d"> </span>Network<span class="_ _10"> </span>Programming</span></div><div class="t m5 x14 h2f ye7 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>11.15</div><div class="t m5 x14 h2f y58a ffe fs16 fc1 sc0 ls0 ws0">Data<span class="_ _11"> </span>structure<span class="_ _16"> </span>returned</div><div class="t m5 x14 h2f y58b ffe fs16 fc1 sc0 ls0 ws0">by</div><div class="t m5 xca h3a y609 ffd fs19 fc1 sc0 ls0 ws0">getaddrinfo<span class="ffe fs16">.</span></div><div class="t m5 x11c h3f y7c16 ffe3 fs27 fc1 sc0 ls0 ws0">Socket address structs</div><div class="t m5 x138 h40 y7c17 ffe4 fs28 fc1 sc0 ls0 ws0">ai_canonname</div><div class="t m5 x187 h40 y7c18 ffe4 fs28 fc1 sc0 ls0 ws0">addrinfo</div><div class="t m5 x36 h3f y7c19 ffe3 fs27 fc1 sc0 ls0 ws0"> structs</div><div class="t m5 x13d h40 y7c1a ffe4 fs28 fc1 sc0 ls0 ws0">ai_addr</div><div class="t m5 x15c h40 y7c1b ffe4 fs28 fc1 sc0 ls0 ws0">result</div><div class="t m5 x13d h40 y7c1c ffe4 fs28 fc1 sc0 ls0 ws0">ai_next</div><div class="t m5 xd8 h40 y7c1d ffe4 fs28 fc1 sc0 ls0 ws0">NULL</div><div class="t m5 x13d h40 y7c1e ffe4 fs28 fc1 sc0 ls0 ws0">ai_addr</div><div class="t m5 x13d h40 y7c1f ffe4 fs28 fc1 sc0 ls0 ws0">ai_next</div><div class="t m5 xd8 h40 y7c20 ffe4 fs28 fc1 sc0 ls0 ws0">NULL</div><div class="t m5 x13d h40 y7c21 ffe4 fs28 fc1 sc0 ls0 ws0">ai_addr</div><div class="t m5 xd8 h40 y7c22 ffe4 fs28 fc1 sc0 ls0 ws0">NULL</div><div class="t m5 x1d h26 y7c23 ff7 fs19 fc1 sc0 ls0 ws0">Given<span class="_ _13"> </span><span class="ffd">host<span class="_ _13"> </span></span>and<span class="_ _13"> </span><span class="ffd">service<span class="_ _13"> </span></span>(the<span class="_ _13"> </span>two<span class="_ _13"> </span>components<span class="_ _13"> </span>of<span class="_ _13"> </span>a<span class="_ _13"> </span>socket<span class="_ _13"> </span>address),<span class="_ _13"> </span><span class="ffd">getaddrinfo</span></div><div class="t m5 x1d h26 y7c24 ff7 fs19 fc1 sc0 ls0 ws0">returns<span class="_ _f"> </span>a<span class="_ _e"> </span><span class="ffd">result<span class="_ _f"> </span></span>that<span class="_ _f"> </span>points<span class="_ _e"> </span>to<span class="_ _f"> </span>a<span class="_ _e"> </span>linked<span class="_ _21"> </span>list<span class="_ _e"> </span>of<span class="_ _f"> </span><span class="ffd">addrinfo<span class="_ _f"> </span></span>structures<span class="_ _0"></span>,<span class="_ _e"> </span>each<span class="_ _e"> </span>of</div><div class="t m5 x1d h26 y7c25 ff7 fs19 fc1 sc0 ls0 ws0">which<span class="_"> </span>points<span class="_"> </span>to<span class="_"> </span>a<span class="_"> </span>socket<span class="_"> </span>address<span class="_"> </span>structure<span class="_"> </span>that<span class="_"> </span>corresponds<span class="_ _13"> </span>to<span class="_"> </span><span class="ffd">host<span class="_ _10"> </span></span>and<span class="_"> </span><span class="ffd">service</span></div><div class="t m5 x1d h26 y7c26 ff7 fs19 fc1 sc0 ls0 ws0">(F<span class="_ _1"></span>igure<span class="_"> </span>11.15).</div><div class="t m5 x29 h26 y7c27 ff7 fs19 fc1 sc0 ls0 ws0">After<span class="_"> </span>a<span class="_"> </span>client<span class="_"> </span>calls<span class="_"> </span><span class="ffd">getaddrinfo</span>,<span class="_"> </span>it<span class="_"> </span>walks<span class="_ _11"> </span>this<span class="_"> </span>list,<span class="_"> </span>trying<span class="_"> </span>each<span class="_"> </span>socket<span class="_"> </span>address</div><div class="t m5 x1d h26 y7c28 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_ _f"> </span>turn<span class="_ _e"> </span>until<span class="_ _21"> </span>the<span class="_ _e"> </span>calls<span class="_ _21"> </span>to<span class="_ _e"> </span><span class="ffd">socket<span class="_ _21"> </span></span>and<span class="_ _e"> </span><span class="ffd">connect<span class="_ _21"> </span></span>succeed<span class="_ _e"> </span>and<span class="_ _21"> </span>the<span class="_ _e"> </span>connection<span class="_ _21"> </span>is</div><div class="t m5 x1d h26 y7c29 ff7 fs19 fc1 sc0 ls0 ws0">established.<span class="_"> </span>Similarly<span class="_ _3"></span>,<span class="_ _11"> </span>a<span class="_ _11"> </span>server<span class="_"> </span>tries<span class="_ _11"> </span>each<span class="_ _11"> </span>socket<span class="_ _11"> </span>address<span class="_"> </span>on<span class="_ _11"> </span>the<span class="_ _11"> </span>list<span class="_"> </span>until<span class="_ _11"> </span>the<span class="_ _11"> </span>calls</div><div class="t m5 x1d h26 y7c2a ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _13"> </span><span class="ffd">socket<span class="_ _10"> </span></span>and<span class="_ _13"> </span><span class="ffd">bind<span class="_ _10"> </span></span>succeed<span class="_ _13"> </span>and<span class="_ _13"> </span>the<span class="_"> </span>descriptor<span class="_ _13"> </span>is<span class="_"> </span>bound<span class="_ _13"> </span>to<span class="_ _13"> </span>a<span class="_"> </span>valid<span class="_ _13"> </span>socket<span class="_"> </span>address<span class="_ _3"></span>.</div><div class="t m5 x1d h26 y7c2b ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_ _14"> </span>avoid<span class="_ _14"> </span>memory<span class="_ _14"> </span>leaks<span class="_ _1"></span>,<span class="_ _15"> </span>the<span class="_ _14"> </span>application<span class="_ _14"> </span>must<span class="_ _14"> </span>eventually<span class="_ _14"> </span>free<span class="_ _14"> </span>the<span class="_ _14"> </span>list<span class="_ _14"> </span>by<span class="_ _16"> </span>calling</div><div class="t m5 x1d h26 y7c2c ffd fs19 fc1 sc0 ls0 ws0">freeaddrinfo<span class="ff7 ls2e0">.I<span class="_ _4a"></span>f<span class="ffd ls0">getaddrinfo<span class="_ _10"> </span><span class="ff7">returns<span class="_"> </span>a<span class="_"> </span>nonzero<span class="_ _13"> </span>error<span class="_"> </span>code<span class="_ _1"></span>,<span class="_"> </span>the<span class="_"> </span>application<span class="_"> </span>can</span></span></span></div><div class="t m5 x1d h26 y7c2d ff7 fs19 fc1 sc0 ls0 ws0">call<span class="_"> </span><span class="ffd">gai_strerror<span class="_ _10"> </span></span>to<span class="_"> </span>convert<span class="_"> </span>the<span class="_"> </span>code<span class="_"> </span>to<span class="_"> </span>a<span class="_"> </span>message<span class="_"> </span>string.</div><div class="t m5 x29 h26 y7c2e ff7 fs19 fc1 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_"> </span><span class="ffd ls0">host<span class="_ _6"> </span><span class="ff7">argument<span class="_ _6"> </span>to<span class="_ _13"> </span></span>getaddrinfo<span class="_ _a"> </span><span class="ff7">can<span class="_ _13"> </span>be<span class="_ _a"> </span>either<span class="_ _13"> </span>a<span class="_ _a"> </span>domain<span class="_ _13"> </span>name<span class="_ _a"> </span>or<span class="_ _13"> </span>a<span class="_ _a"> </span>numeric</span></span></div><div class="t m5 x1d h26 y7c2f ff7 fs19 fc1 sc0 ls0 ws0">address<span class="_"> </span>(e<span class="_ _0"></span>.g.,<span class="_"> </span>a<span class="_"> </span>dotted-decimal<span class="_"> </span>IP<span class="_"> </span>address).<span class="_"> </span>The<span class="_"> </span><span class="ffd">service<span class="_ _10"> </span></span>argument<span class="_"> </span>can<span class="_"> </span>be<span class="_"> </span>either</div><div class="t m5 x1d h26 y7c30 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_"> </span>service<span class="_ _11"> </span>name<span class="_ _11"> </span>(e.g<span class="_ _1"></span>.,<span class="_ _11"> </span><span class="ffd">http</span>)<span class="_ _11"> </span>or<span class="_ _11"> </span>a<span class="_ _11"> </span>decimal<span class="_ _11"> </span>port<span class="_ _11"> </span>number.<span class="_"> </span>If<span class="_ _11"> </span>we<span class="_ _11"> </span>are<span class="_ _11"> </span>not<span class="_"> </span>interested<span class="_ _11"> </span>in</div><div class="t m5 x1d h26 y7c31 ff7 fs19 fc1 sc0 ls0 ws0">converting<span class="_ _13"> </span>the<span class="_ _13"> </span>hostname<span class="_ _13"> </span>to<span class="_ _13"> </span>an<span class="_ _13"> </span>address<span class="_ _3"></span>,<span class="_"> </span>we<span class="_ _13"> </span>can<span class="_ _13"> </span>set<span class="_ _13"> </span><span class="ffd">host<span class="_ _13"> </span></span>to<span class="_ _13"> </span>NULL.<span class="_ _6"> </span>The<span class="_ _13"> </span>same<span class="_ _13"> </span>holds</div><div class="t m5 x1d h26 y7c32 ff7 fs19 fc1 sc0 ls0 ws0">for<span class="_"> </span><span class="ffd">service</span>.<span class="_"> </span>However,<span class="_"> </span>at<span class="_"> </span>least<span class="_"> </span>one<span class="_"> </span>of<span class="_"> </span>them<span class="_"> </span>must<span class="_"> </span>be<span class="_"> </span>speciﬁed.</div><div class="t m5 x29 h26 y7c33 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _15"> </span>optional<span class="_ _14"> </span><span class="ffd">hints<span class="_ _14"> </span></span>argument<span class="_ _15"> </span>is<span class="_ _14"> </span>an<span class="_ _14"> </span><span class="ffd">addrinfo<span class="_ _15"> </span></span>structure<span class="_ _14"> </span>(F<span class="_ _0"></span>igure<span class="_ _14"> </span>11.16)<span class="_ _14"> </span>that</div><div class="t m5 x1d h26 y7c34 ff7 fs19 fc1 sc0 ls0 ws0">provides<span class="_ _f"> </span>ﬁner<span class="_ _f"> </span>control<span class="_ _e"> </span>over<span class="_ _21"> </span>the<span class="_ _e"> </span>list<span class="_ _21"> </span>of<span class="_ _e"> </span>socket<span class="_ _21"> </span>addresses<span class="_ _f"> </span>that<span class="_ _e"> </span><span class="ffd">getaddrinfo<span class="_ _21"> </span></span>re-</div><div class="t m5 x1d h26 y7c35 ff7 fs19 fc1 sc0 ls0 ws0">turns<span class="_ _1"></span>.<span class="_ _21"> </span>When<span class="_ _21"> </span>passed<span class="_ _21"> </span>as<span class="_ _f"> </span>a<span class="_ _21"> </span><span class="ffd">hints<span class="_ _f"> </span></span>argument,<span class="_ _e"> </span>only<span class="_ _15"> </span>the<span class="_ _21"> </span><span class="ffd">ai_family</span>,<span class="_ _e"> </span><span class="ffd">ai_socktype</span>,</div><div class="t m5 x1d h26 y7c36 ffd fs19 fc1 sc0 ls0 ws0">ai_protocol<span class="ff7">,<span class="_"> </span>and<span class="_ _13"> </span></span>ai_flags<span class="_ _10"> </span><span class="ff7">ﬁelds<span class="_ _13"> </span>can<span class="_"> </span>be<span class="_"> </span>set.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_"> </span>other<span class="_"> </span>ﬁelds<span class="_ _13"> </span>must<span class="_"> </span>be<span class="_ _13"> </span>set<span class="_"> </span>to<span class="_ _13"> </span>zero</span></div><div class="t m5 x1d h26 y7c37 ff7 fs19 fc1 sc0 ls0 ws0">(or<span class="_"> </span>NULL).<span class="_"> </span>In<span class="_ _13"> </span>practice,<span class="_ _13"> </span>we<span class="_"> </span>use<span class="_"> </span><span class="ffd">memset<span class="_ _10"> </span></span>to<span class="_ _13"> </span>zero<span class="_"> </span>the<span class="_"> </span>entire<span class="_"> </span>structure<span class="_"> </span>and<span class="_ _13"> </span>then<span class="_"> </span>set<span class="_"> </span>a</div><div class="t m5 x1d h26 y7c38 ff7 fs19 fc1 sc0 ls0 ws0">few<span class="_"> </span>selected<span class="_"> </span>ﬁelds:</div><div class="t m5 x75 h3d y7c39 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y131f ff7 fs19 fc1 sc0 ls0 ws0">By<span class="_ _14"> </span>default,<span class="_ _21"> </span><span class="ffd">getaddrinfo<span class="_ _15"> </span></span>can<span class="_ _15"> </span>return<span class="_ _15"> </span>both<span class="_ _15"> </span>IPv4<span class="_ _15"> </span>and<span class="_ _14"> </span>IPv6<span class="_ _15"> </span>socket<span class="_ _15"> </span>addresses<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y1320 ff7 fs19 fc1 sc0 ls0 ws0">Setting<span class="_"> </span><span class="ffd">ai_family<span class="_ _10"> </span></span>to<span class="_"> </span>AF_INET<span class="_"> </span>restricts<span class="_"> </span>the<span class="_ _11"> </span>list<span class="_"> </span>to<span class="_"> </span>IPv4<span class="_"> </span>addresses<span class="_ _1"></span>.<span class="_"> </span>Setting<span class="_ _11"> </span>it</div><div class="t m5 x29 h26 y1321 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_"> </span>AF_INET6<span class="_"> </span>restricts<span class="_"> </span>the<span class="_"> </span>list<span class="_"> </span>to<span class="_"> </span>IPv6<span class="_"> </span>addresses<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
