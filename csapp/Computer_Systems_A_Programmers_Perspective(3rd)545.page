<div id="pf221" class="pf w2 h11" data-page-no="221"><div class="pc pc221 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg221.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">544<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>5<span class="_ _3d"> </span>Optimizing<span class="_ _10"> </span>Program<span class="_ _10"> </span>Performance</span></div><div class="t m5 xdf h31 ye7 ff7 fs21 fc2 sc0 ls0 ws0">Integer<span class="_ _ba"> </span>Floating<span class="_"> </span>point</div><div class="t m5 x1d h31 ye18 ff7 fs21 fc2 sc0 ls0 ws0">Function<span class="_ _76"> </span>Page<span class="_ _26"> </span>Method<span class="_ _e3"> </span><span class="ffd fs1e ls20c">+*+*</span></div><div class="t m5 x1d h31 ye1a ffd fs1e fc2 sc0 ls0 ws0">combine1<span class="_ _73"> </span><span class="ff7 fs21">543<span class="_ _61"> </span>Abstract<span class="_"> </span>unoptimized<span class="_ _f1"> </span>22.68<span class="_ _7b"> </span>20.02<span class="_ _7b"> </span>19.98<span class="_ _7b"> </span>20.18</span></div><div class="t m5 x1d h2d ye1c ffd fs1e fc2 sc0 ls0 ws0">combine1</div><div class="t m5 x25 h31 y4ab2 ff7 fs21 fc2 sc0 ls0 ws0">543<span class="_ _73"> </span>Abstract<span class="_"> </span><span class="ffd fs1e">-O1<span class="_ _31"> </span></span>10.12<span class="_ _7b"> </span>10.12<span class="_ _7b"> </span>10.17<span class="_ _7b"> </span>11.14</div><div class="t m5 x29 h26 y4ab3 ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_"> </span>can<span class="_"> </span>see<span class="_"> </span>that<span class="_"> </span>our<span class="_"> </span>measurements<span class="_ _13"> </span>are<span class="_"> </span>somewhat<span class="_"> </span>imprecise<span class="_ _0"></span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>more<span class="_"> </span>likely</div><div class="t m5 x1d h26 y4ab4 ff7 fs19 fc2 sc0 ls0 ws0">CPE<span class="_ _14"> </span>number<span class="_ _14"> </span>for<span class="_ _14"> </span>integer<span class="_ _14"> </span>sum<span class="_ _14"> </span>is<span class="_ _14"> </span>23.00,<span class="_ _15"> </span>rather<span class="_ _14"> </span>than<span class="_ _14"> </span>22.68,<span class="_ _15"> </span>while<span class="_ _14"> </span>the<span class="_ _15"> </span>number<span class="_ _14"> </span>for</div><div class="t m5 x1d h26 y4ab5 ff7 fs19 fc2 sc0 ls0 ws0">integer<span class="_ _13"> </span>product<span class="_ _13"> </span>is<span class="_ _13"> </span>likely<span class="_"> </span>20.0<span class="_ _13"> </span>instead<span class="_ _13"> </span>of<span class="_ _13"> </span>20.02.<span class="_ _13"> </span>Rather<span class="_ _13"> </span>than<span class="_ _13"> </span>“fudging”<span class="_"> </span>our<span class="_ _13"> </span>numbers</div><div class="t m5 x1d h26 y4ab6 ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_ _13"> </span>make<span class="_"> </span>them<span class="_ _13"> </span>look<span class="_ _13"> </span>good,<span class="_"> </span>we<span class="_ _13"> </span>will<span class="_ _13"> </span>present<span class="_ _13"> </span>the<span class="_"> </span>measurements<span class="_ _13"> </span>we<span class="_ _13"> </span>actually<span class="_"> </span>obtained.</div><div class="t m5 x1d h26 y4ab7 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>here<span class="_"> </span>are<span class="_"> </span>many<span class="_ _13"> </span>factors<span class="_"> </span>that<span class="_"> </span>complicate<span class="_ _13"> </span>the<span class="_"> </span>task<span class="_ _13"> </span>of<span class="_"> </span>reliably<span class="_"> </span>measuring<span class="_ _13"> </span>the<span class="_"> </span>precise</div><div class="t m5 x1d h26 y4ab8 ff7 fs19 fc2 sc0 ls0 ws0">number<span class="_ _13"> </span>of<span class="_ _13"> </span>clock<span class="_"> </span>c<span class="_ _0"></span>ycles<span class="_ _13"> </span>required<span class="_ _13"> </span>by<span class="_"> </span>some<span class="_ _13"> </span>code<span class="_ _13"> </span>sequence<span class="_ _0"></span>.<span class="_ _13"> </span>It<span class="_ _13"> </span>helps<span class="_"> </span>when<span class="_ _13"> </span>examining</div><div class="t m5 x1d h26 y4ab9 ff7 fs19 fc2 sc0 ls0 ws0">these<span class="_"> </span>numbers<span class="_ _11"> </span>to<span class="_ _11"> </span>mentally<span class="_ _11"> </span>round<span class="_ _11"> </span>the<span class="_ _11"> </span>results<span class="_ _11"> </span>up<span class="_ _11"> </span>or<span class="_ _11"> </span>down<span class="_ _11"> </span>by<span class="_ _11"> </span>a<span class="_ _11"> </span>few<span class="_ _11"> </span>hundredths<span class="_ _11"> </span>of</div><div class="t m5 x1d h26 y4aba ff7 fs19 fc2 sc0 ls0 ws0">a<span class="_"> </span>clock<span class="_"> </span>cycle<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y4abb ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _13"> </span>unoptimized<span class="_ _a"> </span>code<span class="_ _13"> </span>provides<span class="_ _6"> </span>a<span class="_ _6"> </span>direct<span class="_ _13"> </span>translation<span class="_ _a"> </span>of<span class="_ _13"> </span>the<span class="_ _6"> </span>C<span class="_ _6"> </span>code<span class="_ _13"> </span>into<span class="_ _6"> </span>machine</div><div class="t m5 x1d h26 y4abc ff7 fs19 fc2 sc0 ls0 ws0">code<span class="_ _1"></span>,<span class="_"> </span>often<span class="_ _13"> </span>with<span class="_ _13"> </span>obvious<span class="_ _13"> </span>inefﬁciencies<span class="_ _1"></span>.<span class="_ _13"> </span>By<span class="_ _13"> </span>simply<span class="_ _13"> </span>giving<span class="_ _13"> </span>the<span class="_ _13"> </span>command-line<span class="_ _13"> </span>option</div><div class="t m5 x1d h26 y4abd ffd fs19 fc2 sc0 ls0 ws0">-O1<span class="ff7">,<span class="_ _f"> </span>we<span class="_ _21"> </span>enable<span class="_ _21"> </span>a<span class="_ _21"> </span>basic<span class="_ _21"> </span>set<span class="_ _f"> </span>of<span class="_ _21"> </span>optimizations<span class="_ _1"></span>.<span class="_ _21"> </span>As<span class="_ _21"> </span>can<span class="_ _21"> </span>be<span class="_ _21"> </span>seen,<span class="_ _e"> </span>this<span class="_ _15"> </span>signiﬁcantly</span></div><div class="t m5 x1d h26 y4abe ff7 fs19 fc2 sc0 ls0 ws0">improves<span class="_ _21"> </span>the<span class="_ _21"> </span>program<span class="_ _21"> </span>performance—more<span class="_ _21"> </span>than<span class="_ _21"> </span>a<span class="_ _21"> </span>factor<span class="_ _21"> </span>of<span class="_ _21"> </span>2—with<span class="_ _21"> </span>no<span class="_ _21"> </span>effort</div><div class="t m5 x1d h26 y4abf ff7 fs19 fc2 sc0 ls0 ws0">on<span class="_ _f"> </span>behalf<span class="_ _e"> </span>of<span class="_ _f"> </span>the<span class="_ _f"> </span>programmer.<span class="_ _f"> </span>In<span class="_ _e"> </span>general,<span class="_ _e"> </span>it<span class="_ _f"> </span>is<span class="_ _e"> </span>good<span class="_ _f"> </span>to<span class="_ _e"> </span>get<span class="_ _21"> </span>into<span class="_ _e"> </span>the<span class="_ _f"> </span>habit<span class="_ _e"> </span>of</div><div class="t m5 x1d h26 y4ac0 ff7 fs19 fc2 sc0 ls0 ws0">enabling<span class="_"> </span>some<span class="_"> </span>level<span class="_"> </span>of<span class="_"> </span>optimization.<span class="_"> </span>(Similar<span class="_"> </span>performance<span class="_"> </span>results<span class="_"> </span>were<span class="_"> </span>obtained</div><div class="t m5 x1d h26 y4ac1 ff7 fs19 fc2 sc0 ls0 ws0">with<span class="_ _15"> </span>optimization<span class="_ _15"> </span>level<span class="_ _15"> </span><span class="ffd">-Og</span>.)<span class="_ _21"> </span>F<span class="_ _1"></span>or<span class="_ _15"> </span>the<span class="_ _15"> </span>remainder<span class="_ _15"> </span>of<span class="_ _21"> </span>our<span class="_ _15"> </span>measurements<span class="_ _1"></span>,<span class="_ _f"> </span>we<span class="_ _15"> </span>use</div><div class="t m5 x1d h26 y4ac2 ff7 fs19 fc2 sc0 ls0 ws0">optimization<span class="_"> </span>levels<span class="_"> </span><span class="ffd">-O1<span class="_ _10"> </span></span>and<span class="_"> </span><span class="ffd">-O2<span class="_ _10"> </span></span>when<span class="_"> </span>generating<span class="_"> </span>and<span class="_"> </span>measuring<span class="_"> </span>our<span class="_"> </span>programs<span class="_ _1"></span>.</div><div class="t m5 x1d h3b y4ac3 fff fs24 fc6 sc0 ls0 ws0">5.4<span class="_ _17"> </span><span class="ffe fs18">Eliminating<span class="_"> </span>Loop<span class="_"> </span>Inefﬁciencies</span></div><div class="t m5 x1d h26 y4ac4 ff7 fs19 fc1 sc0 ls0 ws0">Observe<span class="_ _14"> </span>that<span class="_ _15"> </span>procedure<span class="_ _15"> </span><span class="ffd">combine1</span>,<span class="_ _21"> </span>as<span class="_ _15"> </span>shown<span class="_ _15"> </span>in<span class="_ _14"> </span>Figure<span class="_ _14"> </span>5.5,<span class="_ _21"> </span>calls<span class="_ _15"> </span>function<span class="_ _15"> </span><span class="ffd">vec_</span></div><div class="t m5 x1d h26 y4ac5 ffd fs19 fc1 sc0 ls0 ws0">length<span class="_ _11"> </span><span class="ff7">as<span class="_ _16"> </span>the<span class="_ _16"> </span>test<span class="_ _11"> </span>condition<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span></span>for<span class="_ _16"> </span><span class="ff7">loop<span class="_ _1"></span>.<span class="_ _16"> </span>Recall<span class="_ _11"> </span>from<span class="_ _16"> </span>our<span class="_ _11"> </span>discussion<span class="_ _16"> </span>of<span class="_ _16"> </span>how</span></div><div class="t m5 x1d h26 y4ac6 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _14"> </span>translate<span class="_ _15"> </span>code<span class="_ _15"> </span>containing<span class="_ _15"> </span>loops<span class="_ _14"> </span>into<span class="_ _15"> </span>machine-level<span class="_ _15"> </span>programs<span class="_ _14"> </span>(Section<span class="_ _15"> </span>3.6.7)</div><div class="t m5 x1d h26 y4ac7 ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_ _11"> </span>the<span class="_ _16"> </span>test<span class="_ _16"> </span>condition<span class="_ _11"> </span>must<span class="_ _16"> </span>be<span class="_ _16"> </span>evaluated<span class="_ _11"> </span>on<span class="_ _16"> </span>every<span class="_ _11"> </span>iteration<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span>loop<span class="_ _0"></span>.<span class="_ _16"> </span>On<span class="_ _11"> </span>the</div><div class="t m5 x1d h26 y4ac8 ff7 fs19 fc1 sc0 ls0 ws0">other<span class="_ _16"> </span>hand,<span class="_ _15"> </span>the<span class="_ _16"> </span>length<span class="_ _14"> </span>of<span class="_ _14"> </span>the<span class="_ _16"> </span>vector<span class="_ _14"> </span>does<span class="_ _16"> </span>not<span class="_ _14"> </span>change<span class="_ _14"> </span>as<span class="_ _16"> </span>the<span class="_ _14"> </span>loop<span class="_ _14"> </span>proceeds<span class="_ _1"></span>.<span class="_ _16"> </span>W<span class="_ _1"></span>e</div><div class="t m5 x1d h26 y4ac9 ff7 fs19 fc1 sc0 ls0 ws0">could<span class="_ _13"> </span>therefore<span class="_ _13"> </span>compute<span class="_"> </span>the<span class="_ _13"> </span>vector<span class="_ _13"> </span>length<span class="_ _13"> </span>only<span class="_"> </span>once<span class="_ _13"> </span>and<span class="_ _13"> </span>use<span class="_ _13"> </span>this<span class="_ _13"> </span>value<span class="_"> </span>in<span class="_ _13"> </span>our<span class="_ _13"> </span>test</div><div class="t m5 x1d h26 y4aca ff7 fs19 fc1 sc0 ls0 ws0">condition.</div><div class="t m5 x29 h26 y4acb ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _16"> </span>5.6<span class="_ _11"> </span>shows<span class="_ _11"> </span>a<span class="_ _11"> </span>modiﬁed<span class="_ _16"> </span>version<span class="_"> </span>called<span class="_ _16"> </span><span class="ffd">combine2</span>.<span class="_ _11"> </span>It<span class="_ _11"> </span>calls<span class="_ _11"> </span><span class="ffd">vec_length<span class="_ _16"> </span></span>at</div><div class="t m5 x1d h26 y4acc ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _6"> </span>beginning<span class="_ _13"> </span>and<span class="_ _a"> </span>assigns<span class="_ _13"> </span>the<span class="_ _6"> </span>result<span class="_ _6"> </span>to<span class="_ _13"> </span>a<span class="_ _6"> </span>local<span class="_ _6"> </span>variable<span class="_ _13"> </span><span class="ffd">length</span>.<span class="_ _a"> </span>This<span class="_ _a"> </span>transformation</div><div class="t m5 x1d h26 y4acd ff7 fs19 fc1 sc0 ls0 ws0">has<span class="_ _16"> </span>noticeable<span class="_ _16"> </span>effect<span class="_ _16"> </span>on<span class="_ _16"> </span>the<span class="_ _11"> </span>overall<span class="_ _16"> </span>performance<span class="_ _16"> </span>for<span class="_ _16"> </span>some<span class="_ _16"> </span>data<span class="_ _16"> </span>types<span class="_ _16"> </span>and<span class="_ _16"> </span>oper<span class="_ _1"></span>-</div><div class="t m5 x1d h26 y4ace ff7 fs19 fc1 sc0 ls0 ws0">ations<span class="_ _1"></span>,<span class="_ _16"> </span>and<span class="_ _14"> </span>minimal<span class="_ _16"> </span>or<span class="_ _16"> </span>even<span class="_ _16"> </span>none<span class="_ _16"> </span>for<span class="_ _16"> </span>others<span class="_ _0"></span>.<span class="_ _16"> </span>In<span class="_ _16"> </span>any<span class="_ _16"> </span>case,<span class="_ _16"> </span>this<span class="_ _16"> </span>transformation<span class="_ _16"> </span>is</div><div class="t m5 x1d h26 y4acf ff7 fs19 fc1 sc0 ls0 ws0">required<span class="_ _13"> </span>to<span class="_"> </span>eliminate<span class="_ _13"> </span>inefﬁciencies<span class="_"> </span>that<span class="_ _13"> </span>would<span class="_"> </span>become<span class="_ _13"> </span>bottlenecks<span class="_"> </span>as<span class="_ _13"> </span>we<span class="_"> </span>attempt</div><div class="t m5 x1d h26 y4ad0 ff7 fs19 fc1 sc0 ls0 ws0">further<span class="_"> </span>optimizations<span class="_ _1"></span>.</div><div class="t m5 x1a3 h31 y4ad1 ff7 fs21 fc2 sc0 ls0 ws0">Integer<span class="_ _ba"> </span>Floating<span class="_"> </span>point</div><div class="t m5 x1d h31 y4ad2 ff7 fs21 fc2 sc0 ls0 ws0">Function<span class="_ _76"> </span>Page<span class="_ _26"> </span>Method<span class="_ _1db"> </span><span class="ffd fs1e ls20c">+*+*</span></div><div class="t m5 x1d h31 y4ad3 ffd fs1e fc2 sc0 ls0 ws0">combine1<span class="_ _73"> </span><span class="ff7 fs21">543<span class="_ _61"> </span>Abstract<span class="_"> </span></span>-O1<span class="_ _117"> </span><span class="ff7 fs21">10.12<span class="_ _7b"> </span>10.12<span class="_ _7b"> </span>10.17<span class="_ _7b"> </span>11.14</span></div><div class="t m5 x1d h31 y4ad4 ffd fs1e fc2 sc0 ls0 ws0">combine2<span class="_ _73"> </span><span class="ff7 fs21">545<span class="_ _61"> </span>Move</span></div><div class="t m5 x9f h31 y4ad5 ffd fs1e fc2 sc0 ls0 ws0">vec_length<span class="_ _74"> </span><span class="ff7 fs21">7.02<span class="_ _4f"> </span>9.03<span class="_ _14a"> </span>9.02<span class="_ _7b"> </span>11.03</span></div><div class="t m5 x29 h26 y345b ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _11"> </span>optimization<span class="_"> </span>is<span class="_ _11"> </span>an<span class="_"> </span>instance<span class="_ _11"> </span>of<span class="_"> </span>a<span class="_"> </span>general<span class="_ _11"> </span>class<span class="_"> </span>of<span class="_ _11"> </span>optimizations<span class="_"> </span>known<span class="_ _11"> </span>as</div><div class="t m5 x1d h26 y4ad6 ffa fs19 fc2 sc0 ls0 ws0">code<span class="_ _11"> </span>motion<span class="ff7">.<span class="_ _11"> </span>T<span class="_ _0"></span>hey<span class="_ _11"> </span>involve<span class="_ _11"> </span>identifying<span class="_ _16"> </span>a<span class="_ _11"> </span>computation<span class="_ _11"> </span>that<span class="_ _16"> </span>is<span class="_"> </span>performed<span class="_ _16"> </span>multiple</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
