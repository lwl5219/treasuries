<div id="pf161" class="pf w2 h11" data-page-no="161"><div class="pc pc161 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg161.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">352<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x22d h61 y287d ff13 fs35 fc6 sc0 ls0 ws0">long<span class="_ _f"> </span>switch_prob(long<span class="_ _f"> </span>x,<span class="_ _f"> </span>long<span class="_ _e"> </span>n)</div><div class="t m5 x22d h61 y287e ff13 fs35 fc6 sc0 ls0 ws0">x<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi,<span class="_ _f"> </span>n<span class="_ _e"> </span>in<span class="_ _21"> </span>%rsi</div><div class="t m5 xb h2d y287f ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">0000000000400590<span class="_ _1f"> </span>&lt;switch_prob&gt;:</span></div><div class="t m5 xb h2d y2880 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">400590:<span class="_ _1a"> </span>48<span class="_ _e"> </span>83<span class="_ _1f"> </span>ee<span class="_ _1f"> </span>3c<span class="_ _35"> </span>sub<span class="_ _46"> </span>$0x3c,%rsi</span></div><div class="t m5 xb h2d y2881 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">400594:<span class="_ _1a"> </span>48<span class="_ _e"> </span>83<span class="_ _1f"> </span>fe<span class="_ _1f"> </span>05<span class="_ _35"> </span>cmp<span class="_ _46"> </span>$0x5,%rsi</span></div><div class="t m5 xb h2d y2882 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">400598:<span class="_ _1a"> </span>77<span class="_ _e"> </span>29<span class="_ _104"> </span>ja<span class="_ _8c"> </span>4005c3<span class="_ _e"> </span>&lt;switch_prob+0x33&gt;</span></div><div class="t m5 xb h2d y2883 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">40059a:<span class="_ _1a"> </span>ff<span class="_ _e"> </span>24<span class="_ _1f"> </span>f5<span class="_ _1f"> </span>f8<span class="_ _e"> </span>06<span class="_ _1f"> </span>40<span class="_ _e"> </span>00<span class="_ _46"> </span>jmpq<span class="_ _3f"> </span>*0x4006f8(,%rsi,8)</span></div><div class="t m5 xb h2d y2884 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">4005a1:<span class="_ _1a"> </span>48<span class="_ _e"> </span>8d<span class="_ _1f"> </span>04<span class="_ _1f"> </span>fd<span class="_ _e"> </span>00<span class="_ _1f"> </span>00<span class="_ _e"> </span>00<span class="_ _46"> </span>lea<span class="_ _46"> </span>0x0(,%rdi,8),%rax</span></div><div class="t m5 xb h2d y2885 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">4005a8:<span class="_ _1a"> </span>00</span></div><div class="t m5 xb h2d y2886 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _45"> </span><span class="ffd fs1e fc2">4005a9:<span class="_ _1a"> </span>c3<span class="_ _129"> </span>retq</span></div><div class="t m5 xb h2d y2887 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _45"> </span><span class="ffd fs1e fc2">4005aa:<span class="_ _1a"> </span>48<span class="_ _e"> </span>89<span class="_ _1f"> </span>f8<span class="_ _12a"> </span>mov<span class="_ _7b"> </span>%rdi,%rax</span></div><div class="t m5 x14 h2d y2888 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _45"> </span><span class="ffd fs1e fc2">4005ad:<span class="_ _1a"> </span>48<span class="_ _e"> </span>c1<span class="_ _1f"> </span>f8<span class="_ _1f"> </span>03<span class="_ _35"> </span>sar<span class="_ _46"> </span>$0x3,%rax</span></div><div class="t m5 x14 h2e y2889 ff6 fs20 fc6 sc0 ls0 ws0">11</div><div class="t m5 x34 h2d y288a ffd fs1e fc2 sc0 ls0 ws0">4005b1:<span class="_ _1a"> </span>c3<span class="_ _129"> </span>retq</div><div class="t m5 x14 h2d y288b ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _45"> </span><span class="ffd fs1e fc2">4005b2:<span class="_ _1a"> </span>48<span class="_ _e"> </span>89<span class="_ _1f"> </span>f8<span class="_ _12a"> </span>mov<span class="_ _7b"> </span>%rdi,%rax</span></div><div class="t m5 x14 h2d y288c ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _45"> </span><span class="ffd fs1e fc2">4005b5:<span class="_ _1a"> </span>48<span class="_ _e"> </span>c1<span class="_ _1f"> </span>e0<span class="_ _1f"> </span>04<span class="_ _35"> </span>shl<span class="_ _46"> </span>$0x4,%rax</span></div><div class="t m5 x14 h2e y288d ff6 fs20 fc6 sc0 ls0 ws0">14</div><div class="t m5 x34 h2d y288e ffd fs1e fc2 sc0 ls0 ws0">4005b9:<span class="_ _1a"> </span>48<span class="_ _e"> </span>29<span class="_ _1f"> </span>f8<span class="_ _12a"> </span>sub<span class="_ _7b"> </span>%rdi,%rax</div><div class="t m5 x14 h2e y288f ff6 fs20 fc6 sc0 ls0 ws0">15</div><div class="t m5 x34 h2d y2890 ffd fs1e fc2 sc0 ls0 ws0">4005bc:<span class="_ _1a"> </span>48<span class="_ _e"> </span>89<span class="_ _1f"> </span>c7<span class="_ _12a"> </span>mov<span class="_ _7b"> </span>%rax,%rdi</div><div class="t m5 x14 h2e y2891 ff6 fs20 fc6 sc0 ls0 ws0">16</div><div class="t m5 x34 h2d y2892 ffd fs1e fc2 sc0 ls0 ws0">4005bf:<span class="_ _1a"> </span>48<span class="_ _e"> </span>0f<span class="_ _1f"> </span>af<span class="_ _1f"> </span>ff<span class="_ _35"> </span>imul<span class="_ _3f"> </span>%rdi,%rdi</div><div class="t m5 x14 h2d y2893 ff6 fs20 fc6 sc0 ls0 ws0">17<span class="_ _45"> </span><span class="ffd fs1e fc2">4005c3:<span class="_ _1a"> </span>48<span class="_ _e"> </span>8d<span class="_ _1f"> </span>47<span class="_ _1f"> </span>4b<span class="_ _35"> </span>lea<span class="_ _46"> </span>0x4b(%rdi),%rax</span></div><div class="t m5 x14 h2d y2894 ff6 fs20 fc6 sc0 ls0 ws0">18<span class="_ _45"> </span><span class="ffd fs1e fc2">4005c7:<span class="_ _1a"> </span>c3<span class="_ _129"> </span>retq</span></div><div class="t m5 x14 h2f y31d5 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>3.53<span class="_ _66"> </span><span class="fc1">Disassembled<span class="_"> </span>code<span class="_"> </span>for<span class="_"> </span>Problem<span class="_"> </span>3.63.</span></div><div class="t m5 x1d h73 y31d6 ffe fs1e fc6 sc0 ls0 ws0">3.64<span class="_ _23"> </span><span class="ff10 fs19">◆◆◆</span></div><div class="t m5 x1d h26 y31d7 ff7 fs19 fc1 sc0 ls0 ws0">Consider<span class="_ _13"> </span>the<span class="_ _6"> </span>following<span class="_ _13"> </span>source<span class="_ _13"> </span>code<span class="_ _1"></span>,<span class="_ _13"> </span>where<span class="_ _6"> </span><span class="ff11">R<span class="_ _2"></span></span>,<span class="_ _13"> </span><span class="ff11">S<span class="_ _5"></span></span>,<span class="_ _13"> </span>and<span class="_ _13"> </span><span class="ff11">T<span class="_ _14"> </span></span>are<span class="_ _13"> </span>constants<span class="_ _13"> </span>declared<span class="_ _6"> </span>with</div><div class="t m5 x1d h26 y31d8 ffd fs19 fc1 sc0 ls0 ws0">#define<span class="ff7">:</span></div><div class="t m5 x1f h2d y31d9 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">long<span class="_ _1f"> </span>A[R][S][T];</span></div><div class="t m5 x1f h2e y31da ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x1f h2e y31db ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x4f h2d y31dc ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>store_ele(long<span class="_ _1f"> </span>i,<span class="_ _1f"> </span>long<span class="_ _e"> </span>j,<span class="_ _1f"> </span>long<span class="_ _e"> </span>k,<span class="_ _1f"> </span>long<span class="_ _1f"> </span>*dest)</div><div class="t m5 x1f h2d y31dd ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x1f h2d y31de ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _20"> </span><span class="ffd fs1e fc2">*dest<span class="_ _e"> </span>=<span class="_ _1f"> </span>A[i][j][k];</span></div><div class="t m5 x1f h2d y31df ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _20"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>sizeof(A);</span></div><div class="t m5 x1f h2e y31e0 ff6 fs20 fc6 sc0 ls0 ws0">7</div><div class="t m5 x4f h2d y31e1 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x1d h26 y31e2 ff7 fs19 fc2 sc0 ls0 ws0">In<span class="_"> </span>compiling<span class="_"> </span>this<span class="_"> </span>program,<span class="_"> </span><span class="ff9">gcc<span class="_ _10"> </span></span>generates<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>assembly<span class="_"> </span>code:</div><div class="t m5 xad h61 yec2 ff13 fs35 fc6 sc0 ls0 ws0">long<span class="_ _f"> </span>store_ele(long<span class="_ _f"> </span>i,<span class="_ _f"> </span>long<span class="_ _e"> </span>j,<span class="_ _21"> </span>long<span class="_ _f"> </span>k,<span class="_ _e"> </span>long<span class="_ _21"> </span>*dest)</div><div class="t m5 xad h61 y3139 ff13 fs35 fc6 sc0 ls0 ws0">i<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi,<span class="_ _f"> </span>j<span class="_ _e"> </span>in<span class="_ _21"> </span>%rsi,<span class="_ _f"> </span>k<span class="_ _e"> </span>in<span class="_ _21"> </span>%rdx,<span class="_ _f"> </span>dest<span class="_ _e"> </span>in<span class="_ _21"> </span>%rcx</div><div class="t m5 x1f h2d yc21 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">store_ele:</span></div><div class="t m5 x1f h2d y107b ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">leaq<span class="_ _46"> </span>(%rsi,%rsi,2),<span class="_ _e"> </span>%rax</span></div><div class="t m5 x1f h2d ye93 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">leaq<span class="_ _46"> </span>(%rsi,%rax,4),<span class="_ _e"> </span>%rax</span></div><div class="t m5 x1f h2d y832 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rdi,<span class="_ _e"> </span>%rsi</span></div><div class="t m5 x1f h2d y8d6 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">salq<span class="_ _46"> </span>$6,<span class="_ _e"> </span>%rsi</span></div><div class="t m5 x1f h2d y77e ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">addq<span class="_ _46"> </span>%rsi,<span class="_ _e"> </span>%rdi</span></div><div class="t m5 x1f h2d ye95 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">addq<span class="_ _46"> </span>%rax,<span class="_ _e"> </span>%rdi</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
