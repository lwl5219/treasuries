<div id="pff7" class="pf w2 h11" data-page-no="f7"><div class="pc pcf7 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bgf7.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">246<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x1d h34 y9c ff6 fs16 fc2 sc0 ls0 ws0">(a)<span class="_ _10"> </span>Original<span class="_ _11"> </span>C<span class="_ _10"> </span>code</div><div class="t m5 x1d h2d y2283 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>lt_cnt<span class="_ _1f"> </span>=<span class="_ _1f"> </span>0;</div><div class="t m5 x1d h2d y2284 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>ge_cnt<span class="_ _1f"> </span>=<span class="_ _1f"> </span>0;</div><div class="t m5 x1d h2d y2286 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>absdiff_se(long<span class="_ _1f"> </span>x,<span class="_ _1f"> </span>long<span class="_ _e"> </span>y)</div><div class="t m5 x1d h2d y2287 ffd fs1e fc2 sc0 ls0 ws0">{</div><div class="t m5 x10c h2d y2288 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>result;</div><div class="t m5 x10c h2d y23a1 ffd fs1e fc2 sc0 ls33 ws0">i<span class="_ _41"></span>f(<span class="_ _41"></span>x&lt;y<span class="_ _41"></span>){</div><div class="t m5 x22b h2d y23a2 ffd fs1e fc2 sc0 ls0 ws0">lt_cnt++;</div><div class="t m5 x22b h2d y2554 ffd fs1e fc2 sc0 ls0 ws0">resul<span class="ls33">t=y-x<span class="_ _41"></span>;</span></div><div class="t m5 x10c h2d y2555 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x10c h2d y2556 ffd fs1e fc2 sc0 ls0 ws0">else<span class="_ _e"> </span>{</div><div class="t m5 x22b h2d y2557 ffd fs1e fc2 sc0 ls0 ws0">ge_cnt++;</div><div class="t m5 x22b h2d y2558 ffd fs1e fc2 sc0 ls0 ws0">resul<span class="ls33">t=x-y<span class="_ _41"></span>;</span></div><div class="t m5 x10c h2d y2559 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x10c h2d y255a ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>result;</div><div class="t m5 x1d h2d y255b ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x191 h34 y255c ff6 fs16 fc2 sc0 ls0 ws0">(b)<span class="_ _10"> </span>Equivalent<span class="_ _11"> </span>goto<span class="_ _10"> </span>version</div><div class="t m5 x17a h2d y255d ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">long<span class="_ _1f"> </span>gotodiff_se(long<span class="_ _e"> </span>x,<span class="_ _1f"> </span>long<span class="_ _1f"> </span>y)</span></div><div class="t m5 x17a h2d y255e ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x17a h2e y255f ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x1df h2d y2560 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>result;</div><div class="t m5 x17a h2d y2561 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2">if<span class="_ _e"> </span>(x<span class="_ _1f"> </span>&gt;=<span class="_ _1f"> </span>y)</span></div><div class="t m5 x17a h2d ycd7 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _70"> </span><span class="ffd fs1e fc2">goto<span class="_ _e"> </span>x_ge_y;</span></div><div class="t m5 x17a h2d y2562 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _20"> </span><span class="ffd fs1e fc2">lt_cnt++;</span></div><div class="t m5 x17a h2d y2563 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _20"> </span><span class="ffd fs1e fc2">result<span class="_ _e"> </span>=<span class="_ _1a"> </span>y<span class="_ _1f"> </span>-<span class="_ _1f"> </span>x;</span></div><div class="t m5 x17a h2d y2564 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _20"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>result;</span></div><div class="t m5 x17a h2d y39b ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _73"> </span><span class="ffd fs1e fc2">x_ge_y:</span></div><div class="t m5 x191 h2d y13f4 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _20"> </span><span class="ffd fs1e fc2">ge_cnt++;</span></div><div class="t m5 x191 h2d y23e0 ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _20"> </span><span class="ffd fs1e fc2">resul<span class="ls33">t=x-y<span class="_ _41"></span>;</span></span></div><div class="t m5 x191 h2d ycae ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _20"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>result;</span></div><div class="t m5 x191 h2d ycde ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1d h34 y418 ff6 fs16 fc2 sc0 ls0 ws0">(c)<span class="_ _10"> </span>Generated<span class="_ _11"> </span>assembly<span class="_ _10"> </span>code</div><div class="t m5 xad h61 yeb6 ff13 fs35 fc6 sc0 ls0 ws0">long<span class="_ _f"> </span>absdiff_se(long<span class="_ _f"> </span>x,<span class="_ _f"> </span>long<span class="_ _e"> </span>y)</div><div class="t m5 xad h61 y2565 ff13 fs35 fc6 sc0 ls0 ws0">x<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi,<span class="_ _f"> </span>y<span class="_ _e"> </span>in<span class="_ _21"> </span>%rsi</div><div class="t m5 x1f h2d y2566 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">absdiff_se:</span></div><div class="t m5 x1f h2e y2567 ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x10d h2d y2568 ffd fs1e fc2 sc0 ls0 ws0">cmpq<span class="_ _46"> </span>%rsi,<span class="_ _e"> </span>%rdi<span class="_ _c2"> </span><span class="ff13 fs35 fc6">Compare<span class="_ _e"> </span>x:y</span></div><div class="t m5 x1f h2d y2569 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">jge<span class="_ _8c"> </span>.L2<span class="_ _9c"> </span></span><span class="ff13 fs35">If<span class="_ _e"> </span>&gt;=<span class="_ _21"> </span>goto<span class="_ _f"> </span><span class="ff2d">x_ge_y</span></span></div><div class="t m5 x1f h2d y256a ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">addq<span class="_ _46"> </span>$1,<span class="_ _e"> </span>lt_cnt(%rip)<span class="_ _93"> </span></span><span class="ff13 fs35">lt_cnt++</span></div><div class="t m5 x1f h2d y256b ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rsi,<span class="_ _e"> </span>%rax</span></div><div class="t m5 x1f h2d y256c ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">subq<span class="_ _46"> </span>%rdi,<span class="_ _e"> </span>%rax<span class="_ _c2"> </span></span><span class="ff13 fs35">resul<span class="ls156">t=y-x</span></span></div><div class="t m5 x1f h2d y256d ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">ret<span class="_ _15c"> </span></span><span class="ff13 fs35">Return</span></div><div class="t m5 x1f h2d y256e ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L2:<span class="_ _96"> </span></span><span class="ff2d fs35">x_ge_y<span class="ff13">:</span></span></div><div class="t m5 x1f h2d y256f ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _45"> </span><span class="ffd fs1e fc2">addq<span class="_ _46"> </span>$1,<span class="_ _e"> </span>ge_cnt(%rip)<span class="_ _93"> </span></span><span class="ff13 fs35">ge_cnt++</span></div><div class="t m5 x1b0 h2d y2570 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rdi,<span class="_ _e"> </span>%rax</span></div><div class="t m5 x1b0 h2e y2571 ff6 fs20 fc6 sc0 ls0 ws0">11</div><div class="t m5 x10d h2d y2572 ffd fs1e fc2 sc0 ls0 ws0">subq<span class="_ _46"> </span>%rsi,<span class="_ _e"> </span>%rax<span class="_ _c2"> </span><span class="ff13 fs35 fc6">resul<span class="ls156">t=x-y</span></span></div><div class="t m5 x1b0 h2d y2573 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _45"> </span><span class="ffd fs1e fc2">ret<span class="_ _15c"> </span></span><span class="ff13 fs35">Return</span></div><div class="t m5 x1d h3a y2574 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _16"> </span>3.16<span class="_ _66"> </span><span class="fc1">Compilation<span class="_ _16"> </span>of<span class="_ _16"> </span>conditional<span class="_ _11"> </span>statements.<span class="_ _16"> </span><span class="ff6">(a)<span class="_ _16"> </span>C<span class="_ _16"> </span>procedure<span class="_ _11"> </span><span class="ffd fs19">absdiff_se</span></span></span></div><div class="t m5 x1d h34 y2575 ff6 fs16 fc1 sc0 ls0 ws0">contains<span class="_ _16"> </span>an<span class="_ _16"> </span>if-else<span class="_ _14"> </span>statement.<span class="_ _16"> </span>The<span class="_ _16"> </span>generated<span class="_ _14"> </span>assembly<span class="_ _16"> </span>code<span class="_ _16"> </span>is<span class="_ _14"> </span>shown<span class="_ _16"> </span>(c),<span class="_ _14"> </span>along<span class="_ _16"> </span>with</div><div class="t m5 x1d h34 y2576 ff6 fs16 fc1 sc0 ls0 ws0">(b)<span class="_ _10"> </span>a<span class="_ _11"> </span>C<span class="_ _10"> </span>procedure</div><div class="t m5 xb3 h3a y2577 ffd fs19 fc1 sc0 ls0 ws0">gotodiff_se<span class="_ _10"> </span><span class="ff6 fs16">that<span class="_ _11"> </span>mimics<span class="_ _10"> </span>the<span class="_ _10"> </span>control<span class="_ _11"> </span>ﬂow<span class="_ _10"> </span>of<span class="_ _11"> </span>the<span class="_ _10"> </span>assembly<span class="_ _11"> </span>code.</span></div><div class="t m5 x1d h26 y2578 ff7 fs19 fc1 sc0 ls0 ws0">assembly<span class="_ _13"> </span>code<span class="_ _1"></span>.<span class="_ _13"> </span>Using<span class="_ _13"> </span><span class="ffd">goto<span class="_ _6"> </span></span>statements<span class="_ _13"> </span>is<span class="_ _13"> </span>generally<span class="_ _13"> </span>considered<span class="_ _6"> </span>a<span class="_ _13"> </span>bad<span class="_ _13"> </span>programming</div><div class="t m5 x1d h26 y2579 ff7 fs19 fc1 sc0 ls0 ws0">style<span class="_ _1"></span>,<span class="_"> </span>since<span class="_ _13"> </span>their<span class="_"> </span>use<span class="_ _13"> </span>can<span class="_"> </span>make<span class="_ _13"> </span>code<span class="_ _13"> </span>very<span class="_"> </span>difﬁcult<span class="_ _13"> </span>to<span class="_"> </span>read<span class="_ _13"> </span>and<span class="_ _13"> </span>debug.<span class="_ _13"> </span>W<span class="_ _1"></span>e<span class="_ _13"> </span>use<span class="_"> </span>them</div><div class="t m5 x1d h26 y257a ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_ _16"> </span>our<span class="_ _14"> </span>presentation<span class="_ _14"> </span>as<span class="_ _16"> </span>a<span class="_ _14"> </span>way<span class="_ _14"> </span>to<span class="_ _16"> </span>construct<span class="_ _14"> </span>C<span class="_ _14"> </span>programs<span class="_ _16"> </span>that<span class="_ _14"> </span>describe<span class="_ _14"> </span>the<span class="_ _16"> </span>control</div><div class="t m5 x1d h26 y257b ff7 fs19 fc1 sc0 ls0 ws0">ﬂow<span class="_"> </span>of<span class="_"> </span>machine<span class="_"> </span>code<span class="_ _1"></span>.<span class="_"> </span>W<span class="_ _1"></span>e<span class="_"> </span>call<span class="_"> </span>this<span class="_"> </span>style<span class="_"> </span>of<span class="_"> </span>programming<span class="_"> </span>“goto<span class="_"> </span>code<span class="_ _0"></span>.<span class="_ _1"></span>”</div><div class="t m5 x29 h26 y257c ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _13"> </span>the<span class="_"> </span>goto<span class="_ _13"> </span>code<span class="_ _13"> </span>(Figure<span class="_ _13"> </span>3.16(b)),<span class="_"> </span>the<span class="_ _13"> </span>statement<span class="_ _13"> </span><span class="ffd">goto<span class="_ _10"> </span>x_ge_y<span class="_ _13"> </span></span>on<span class="_ _13"> </span>line<span class="_"> </span>5<span class="_ _13"> </span>causes</div><div class="t m5 x1d h46 y257d ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_"> </span>jump<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>label<span class="_"> </span><span class="ffd">x_ge_y<span class="_ _10"> </span></span>(since<span class="_ _11"> </span>it<span class="_"> </span>occurs<span class="_"> </span>when<span class="_"> </span><span class="ff11">x<span class="_ _11"> </span><span class="ff12">≥<span class="_ _10"> </span></span>y<span class="_ _2"></span></span>)<span class="_"> </span>on<span class="_"> </span>line<span class="_"> </span>9.<span class="_ _11"> </span>Continuing<span class="_"> </span>the</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
