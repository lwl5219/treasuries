<div id="pf382" class="pf w2 h11" data-page-no="382"><div class="pc pc382 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg382.png"/><div class="t m5 x1c9 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>9.9<span class="_ _60"> </span>Dynamic<span class="_ _10"> </span>Memor<span class="_"> </span>y<span class="_ _10"> </span>Allocation<span class="_ _3e"> </span><span class="ffe fs1e">897</span></div><div class="t m5 x97 h2c y27f ffa fs16 fc2 sc0 ls0 ws0">code/vm/malloc/mm.c</div><div class="t m5 x2c h2d y280 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">void<span class="_ _1f"> </span>*mm_malloc(size_t<span class="_ _e"> </span>size)</span></div><div class="t m5 x2c h2d y281 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x2c h2d y283 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2">size_t<span class="_ _e"> </span>asize;<span class="_ _b9"> </span>/*<span class="_ _e"> </span>Adjusted<span class="_ _1f"> </span>block<span class="_ _e"> </span>size<span class="_ _1f"> </span>*/</span></div><div class="t m5 x2c h2d y284 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2">size_t<span class="_ _e"> </span>extendsize;<span class="_ _1f"> </span>/*<span class="_ _1f"> </span>Amount<span class="_ _e"> </span>to<span class="_ _1f"> </span>extend<span class="_ _e"> </span>heap<span class="_ _1f"> </span>if<span class="_ _1f"> </span>no<span class="_ _e"> </span>fit<span class="_ _1f"> </span>*/</span></div><div class="t m5 x2c h2d y285 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _20"> </span><span class="ffd fs1e fc2">char<span class="_ _e"> </span>*bp;</span></div><div class="t m5 x2c h2e y286 ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 x2c h2e y6298 ff6 fs20 fc6 sc0 ls0 ws0">7</div><div class="t m5 x142 h2d y287 ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Ignore<span class="_ _1f"> </span>spurious<span class="_ _1f"> </span>requests<span class="_ _e"> </span>*/</div><div class="t m5 x2c h2d y4493 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _20"> </span><span class="ffd fs1e fc2">if<span class="_ _e"> </span>(size<span class="_ _1f"> </span>==<span class="_ _1f"> </span>0)</span></div><div class="t m5 x2c h2d y4a9a ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _70"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>NULL;</span></div><div class="t m5 x17 h2e y4a9b ff6 fs20 fc6 sc0 ls0 ws0">10</div><div class="t m5 x17 h2e y7428 ff6 fs20 fc6 sc0 ls0 ws0">11</div><div class="t m5 x142 h2d y4a9c ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Adjust<span class="_ _1f"> </span>block<span class="_ _1f"> </span>size<span class="_ _e"> </span>to<span class="_ _1f"> </span>include<span class="_ _e"> </span>overhead<span class="_ _1f"> </span>and<span class="_ _1f"> </span>alignment<span class="_ _e"> </span>reqs.<span class="_ _1f"> </span>*/</div><div class="t m5 x17 h2d y906 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _20"> </span><span class="ffd fs1e fc2">if<span class="_ _e"> </span>(size<span class="_ _1f"> </span>&lt;=<span class="_ _1f"> </span>DSIZE)</span></div><div class="t m5 x17 h2d y4a9d ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _70"> </span><span class="ffd fs1e fc2">asize<span class="_ _e"> </span>=<span class="_ _1f"> </span>2*DSIZE;</span></div><div class="t m5 x17 h2d y4a9e ff6 fs20 fc6 sc0 ls0 ws0">14<span class="_ _20"> </span><span class="ffd fs1e fc2">else</span></div><div class="t m5 x17 h2d y4a9f ff6 fs20 fc6 sc0 ls0 ws0">15<span class="_ _70"> </span><span class="ffd fs1e fc2">asize<span class="_ _e"> </span>=<span class="_ _1f"> </span>DSIZE<span class="_ _1f"> </span>*<span class="_ _e"> </span>((size<span class="_ _1f"> </span>+<span class="_ _e"> </span>(DSIZE)<span class="_ _1f"> </span>+<span class="_ _1f"> </span>(DSIZE-1))<span class="_ _e"> </span>/<span class="_ _1f"> </span>DSIZE);</span></div><div class="t m5 x17 h2e y417 ff6 fs20 fc6 sc0 ls0 ws0">16</div><div class="t m5 x17 h2e y7429 ff6 fs20 fc6 sc0 ls0 ws0">17</div><div class="t m5 x142 h2d y4aa0 ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Search<span class="_ _1f"> </span>the<span class="_ _1f"> </span>free<span class="_ _e"> </span>list<span class="_ _1f"> </span>for<span class="_ _e"> </span>a<span class="_ _1f"> </span>fit<span class="_ _1f"> </span>*/</div><div class="t m5 x17 h2d yeb4 ff6 fs20 fc6 sc0 ls0 ws0">18<span class="_ _20"> </span><span class="ffd fs1e fc2">if<span class="_ _e"> </span>((bp<span class="_ _1f"> </span>=<span class="_ _1f"> </span>find_fit(asize))<span class="_ _e"> </span>!=<span class="_ _1f"> </span>NULL)<span class="_ _e"> </span>{</span></div><div class="t m5 x17 h2d y2a2b ff6 fs20 fc6 sc0 ls0 ws0">19<span class="_ _70"> </span><span class="ffd fs1e fc2">place(bp,<span class="_ _e"> </span>asize);</span></div><div class="t m5 x17 h2d y1ab8 ff6 fs20 fc6 sc0 ls0 ws0">20<span class="_ _70"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>bp;</span></div><div class="t m5 x17 h2e y94f ff6 fs20 fc6 sc0 ls0 ws0">21</div><div class="t m5 x142 h2d y1ada ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x17 h2e y4aa1 ff6 fs20 fc6 sc0 ls0 ws0">22</div><div class="t m5 x17 h2e y4aa2 ff6 fs20 fc6 sc0 ls0 ws0">23</div><div class="t m5 x142 h2d y3228 ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>No<span class="_ _1f"> </span>fit<span class="_ _1f"> </span>found.<span class="_ _e"> </span>Get<span class="_ _1f"> </span>more<span class="_ _e"> </span>memory<span class="_ _1f"> </span>and<span class="_ _1f"> </span>place<span class="_ _e"> </span>the<span class="_ _1f"> </span>block<span class="_ _e"> </span>*/</div><div class="t m5 x17 h2d y35d ff6 fs20 fc6 sc0 ls0 ws0">24<span class="_ _20"> </span><span class="ffd fs1e fc2">extendsize<span class="_ _e"> </span>=<span class="_ _1f"> </span>MAX(asize,CHUNKSIZE);</span></div><div class="t m5 x17 h2e y4aa3 ff6 fs20 fc6 sc0 ls0 ws0">25</div><div class="t m5 x142 h2d y3229 ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>((bp<span class="_ _1f"> </span>=<span class="_ _1f"> </span>extend_heap(extendsize/WSIZE))<span class="_ _e"> </span>==<span class="_ _1f"> </span>NULL)</div><div class="t m5 x17 h2d y2467 ff6 fs20 fc6 sc0 ls0 ws0">26<span class="_ _70"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>NULL;</span></div><div class="t m5 x17 h2d y322b ff6 fs20 fc6 sc0 ls0 ws0">27<span class="_ _20"> </span><span class="ffd fs1e fc2">place(bp,<span class="_ _e"> </span>asize);</span></div><div class="t m5 x17 h2d y322c ff6 fs20 fc6 sc0 ls0 ws0">28<span class="_ _20"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>bp;</span></div><div class="t m5 x17 h2d y441 ff6 fs20 fc6 sc0 ls0 ws0">29<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x97 h2c y66e3 ffa fs16 fc2 sc0 ls0 ws0">code/vm/malloc/mm.c</div><div class="t m5 x17 h2f y66e4 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>9.47</div><div class="t m5 x156 h3a y5165 ffd fs19 fc1 sc0 ls0 ws0">mm_malloc<span class="_ _10"> </span><span class="ffe fs16">allocates<span class="_"> </span>a<span class="_"> </span>block<span class="_"> </span>from<span class="_"> </span>the<span class="_"> </span>free<span class="_"> </span>list.</span></div><div class="t m5 x17 h47 y742a ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>9.8<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>920)</span></div><div class="t m5 x17 h26 y742b ff7 fs19 fc1 sc0 ls0 ws0">Implement<span class="_ _21"> </span>a<span class="_ _f"> </span><span class="ffd">find_fit<span class="_ _21"> </span></span>function<span class="_ _f"> </span>for<span class="_ _f"> </span>the<span class="_ _21"> </span>simple<span class="_ _f"> </span>allocator<span class="_ _21"> </span>described<span class="_ _f"> </span>in<span class="_ _f"> </span>Section</div><div class="t m5 x17 h26 y742c ff7 fs19 fc1 sc0 ls0 ws0">9.9.12.</div><div class="t m5 x17 h2d y742d ffd fs1e fc2 sc0 ls0 ws0">static<span class="_ _e"> </span>void<span class="_ _1f"> </span>*find_fit(size_t<span class="_ _1f"> </span>asize)</div><div class="t m5 x26 h26 y742e ff7 fs19 fc2 sc0 ls0 ws0">Y<span class="_ _3"></span>our<span class="_"> </span>solution<span class="_"> </span>should<span class="_"> </span>perform<span class="_"> </span>a<span class="_"> </span>ﬁrst-ﬁt<span class="_"> </span>search<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>implicit<span class="_"> </span>free<span class="_"> </span>list.</div><div class="t m5 x17 h47 y742f ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>9.9<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>920)</span></div><div class="t m5 x17 h26 yc04 ff7 fs19 fc1 sc0 ls0 ws0">Implement<span class="_"> </span>a<span class="_"> </span><span class="ffd">place<span class="_ _10"> </span></span>function<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>example<span class="_"> </span>allocator.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
