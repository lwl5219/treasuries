<div id="pf35a" class="pf w2 h11" data-page-no="35a"><div class="pc pc35a w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg35a.png"/><div class="t m5 x6b h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>9.6<span class="_ _60"> </span>Address<span class="_ _10"> </span>T<span class="_ _1"></span>ranslation<span class="_ _3e"> </span><span class="ffe fs1e">857</span></div><div class="t m5 x17 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">determine<span class="_ _11"> </span>the<span class="_ _16"> </span>PPN<span class="_ _3"></span>.<span class="_ _16"> </span>As<span class="_ _16"> </span>with<span class="_ _11"> </span>a<span class="_ _16"> </span>single-level<span class="_ _11"> </span>hierarchy<span class="_ _3"></span>,<span class="_ _16"> </span>the<span class="_ _16"> </span>PPO<span class="_ _11"> </span>is<span class="_ _16"> </span>identical<span class="_ _11"> </span>to<span class="_ _16"> </span>the</div><div class="t m5 x17 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">VPO<span class="_ _3"></span>.</div><div class="t m5 x26 h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">Accessing<span class="_ _11"> </span><span class="ff11">k<span class="_"> </span></span>PTEs<span class="_"> </span>may<span class="_ _11"> </span>seem<span class="_ _11"> </span>expensive<span class="_ _11"> </span>and<span class="_ _11"> </span>impractical<span class="_ _11"> </span>at<span class="_ _11"> </span>ﬁrst<span class="_ _16"> </span>glance<span class="_ _1"></span>.<span class="_ _11"> </span>How-</div><div class="t m5 x17 h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">ever,<span class="_"> </span>the<span class="_"> </span>TLB<span class="_"> </span>comes<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>rescue<span class="_ _11"> </span>here<span class="_"> </span>by<span class="_"> </span>caching<span class="_"> </span>PTEs<span class="_"> </span>from<span class="_ _11"> </span>the<span class="_"> </span>page<span class="_"> </span>tables<span class="_"> </span>at</div><div class="t m5 x17 h26 y2f8 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>different<span class="_ _13"> </span>levels<span class="_ _0"></span>.<span class="_"> </span>In<span class="_ _13"> </span>practice,<span class="_"> </span>address<span class="_ _13"> </span>translation<span class="_"> </span>with<span class="_"> </span>multi-level<span class="_ _13"> </span>page<span class="_"> </span>tables<span class="_"> </span>is</div><div class="t m5 x17 h26 y2f9 ff7 fs19 fc2 sc0 ls0 ws0">not<span class="_"> </span>signiﬁcantly<span class="_"> </span>slower<span class="_"> </span>than<span class="_"> </span>with<span class="_"> </span>single-level<span class="_"> </span>page<span class="_"> </span>tables<span class="_ _1"></span>.</div><div class="t m5 x17 h41 y6eea ffe fs29 fc2 sc0 ls0 ws0">9.6.4<span class="_ _48"> </span><span class="fs19">Putting<span class="_"> </span>It<span class="_"> </span>T<span class="_ _3"></span>ogether:<span class="_"> </span>End-to-End<span class="_"> </span>Address<span class="_"> </span>T<span class="_ _1"></span>ranslation</span></div><div class="t m5 x17 h26 y6eeb ff7 fs19 fc2 sc0 ls0 ws0">In<span class="_ _21"> </span>this<span class="_ _f"> </span>section,<span class="_ _e"> </span>we<span class="_ _f"> </span>put<span class="_ _f"> </span>it<span class="_ _f"> </span>all<span class="_ _f"> </span>together<span class="_ _f"> </span>with<span class="_ _f"> </span>a<span class="_ _21"> </span>concrete<span class="_ _f"> </span>example<span class="_ _f"> </span>of<span class="_ _f"> </span>end-to-end</div><div class="t m5 x17 h26 y6eec ff7 fs19 fc2 sc0 ls0 ws0">address<span class="_"> </span>translation<span class="_"> </span>on<span class="_"> </span>a<span class="_ _13"> </span>small<span class="_"> </span>system<span class="_"> </span>with<span class="_"> </span>a<span class="_"> </span>TLB<span class="_"> </span>and<span class="_"> </span>L1<span class="_ _13"> </span>d-cache.<span class="_"> </span>T<span class="_ _7"></span>o<span class="_"> </span>keep<span class="_"> </span>things</div><div class="t m5 x17 h26 y6eed ff7 fs19 fc2 sc0 ls0 ws0">manageable<span class="_ _1"></span>,<span class="_"> </span>we<span class="_"> </span>make<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>assumptions:</div><div class="t m5 x72 h3d y6eee ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y6eef ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>memory<span class="_"> </span>is<span class="_"> </span>byte<span class="_"> </span>addressable.</div><div class="t m5 x72 h3d y6ef0 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y6ef1 ff7 fs19 fc1 sc0 ls0 ws0">Memory<span class="_"> </span>accesses<span class="_"> </span>are<span class="_"> </span>to<span class="_"> </span><span class="ffa">1-byte<span class="_"> </span>wor<span class="_ _1"></span>ds<span class="_"> </span><span class="ff7">(not<span class="_"> </span>4-byte<span class="_"> </span>words).</span></span></div><div class="t m5 x72 h3d y6ef2 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h46 y6ef3 ff7 fs19 fc1 sc0 ls0 ws0">V<span class="_ _1"></span>irtual<span class="_"> </span>addresses<span class="_"> </span>are<span class="_"> </span>14<span class="_"> </span>bits<span class="_"> </span>wide<span class="_"> </span>(<span class="ff11">n<span class="_ _10"> </span><span class="ff12">=<span class="_ _13"> </span></span></span><span class="lsaa">14).</span></div><div class="t m5 x72 h3d y6ef4 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h46 y6ef5 ff7 fs19 fc1 sc0 ls0 ws0">Physical<span class="_"> </span>addresses<span class="_"> </span>are<span class="_"> </span>12<span class="_"> </span>bits<span class="_"> </span>wide<span class="_"> </span>(<span class="ff11">m<span class="_ _13"> </span><span class="ff12">=<span class="_ _10"> </span></span></span>12).</div><div class="t m5 x72 h3d y6ef6 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h46 y6ef7 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>page<span class="_"> </span>size<span class="_"> </span>is<span class="_"> </span>64<span class="_"> </span>bytes<span class="_"> </span>(<span class="ff11">P<span class="_ _15"> </span><span class="ff12">=<span class="_ _10"> </span></span></span><span class="lsaa">64).</span></div><div class="t m5 x72 h3d y6ef8 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y6ef9 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>TLB<span class="_"> </span>is<span class="_"> </span>4-way<span class="_"> </span>set<span class="_"> </span>associative<span class="_"> </span>with<span class="_"> </span>16<span class="_"> </span>total<span class="_"> </span>entries<span class="_ _1"></span>.</div><div class="t m5 x72 h3d y6efa ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y6efb ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>L1<span class="_"> </span>d-cache<span class="_"> </span>is<span class="_"> </span>physically<span class="_"> </span>addressed<span class="_"> </span>and<span class="_"> </span>direct<span class="_"> </span>mapped,<span class="_"> </span>with<span class="_"> </span>a<span class="_"> </span>4-byte<span class="_ _13"> </span>line</div><div class="t m5 x26 h26 y6efc ff7 fs19 fc1 sc0 ls0 ws0">size<span class="_"> </span>and<span class="_"> </span>16<span class="_"> </span>total<span class="_"> </span>sets<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y6efd ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _13"> </span>9.19<span class="_ _13"> </span>shows<span class="_ _6"> </span>the<span class="_ _13"> </span>formats<span class="_ _13"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>virtual<span class="_ _13"> </span>and<span class="_ _6"> </span>physical<span class="_ _13"> </span>addresses<span class="_ _1"></span>.<span class="_ _13"> </span>Since<span class="_ _6"> </span>each</div><div class="t m5 x17 h26 y6efe ff7 fs19 fc1 sc0 ls0 ws0">page<span class="_ _6"> </span>is<span class="_ _6"> </span>2</div><div class="t m5 x188 h3c y6eff ff7 fs25 fc1 sc0 ls0 ws0">6</div><div class="t m5 x1da h46 y6f00 ff12 fs19 fc1 sc0 ls0 ws0">=<span class="_ _13"></span><span class="ff7">64<span class="_ _a"> </span>bytes<span class="_ _0"></span>,<span class="_ _6"> </span>the<span class="_ _6"> </span>low-order<span class="_ _6"> </span>6<span class="_ _6"> </span>bits<span class="_ _6"> </span>of<span class="_ _6"> </span>the<span class="_ _6"> </span>virtual<span class="_ _6"> </span>and<span class="_ _6"> </span>physical<span class="_ _6"> </span>addresses<span class="_ _6"> </span>serve</span></div><div class="t m5 x17 h26 y6f01 ff7 fs19 fc1 sc0 ls0 ws0">as<span class="_ _16"> </span>the<span class="_ _14"> </span>VPO<span class="_ _14"> </span>and<span class="_ _16"> </span>PPO<span class="_ _1"></span>,<span class="_ _14"> </span>respectively<span class="_ _3"></span>.<span class="_ _14"> </span>T<span class="_ _1"></span>he<span class="_ _14"> </span>high-order<span class="_ _14"> </span>8<span class="_ _14"> </span>bits<span class="_ _16"> </span>of<span class="_ _14"> </span>the<span class="_ _14"> </span>virtual<span class="_ _16"> </span>address</div><div class="t m5 x17 h26 y6f02 ff7 fs19 fc1 sc0 ls0 ws0">serve<span class="_"> </span>as<span class="_"> </span>the<span class="_"> </span>VPN<span class="_ _3"></span>.<span class="_"> </span>T<span class="_ _0"></span>he<span class="_"> </span>high-order<span class="_"> </span>6<span class="_"> </span>bits<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>physical<span class="_"> </span>address<span class="_"> </span>serve<span class="_"> </span>as<span class="_"> </span>the<span class="_"> </span>PPN<span class="_ _3"></span>.</div><div class="t m5 x26 h26 y6f03 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_"> </span>9.20<span class="_"> </span>shows<span class="_"> </span>a<span class="_ _13"> </span>snapshot<span class="_"> </span>of<span class="_"> </span>our<span class="_"> </span>little<span class="_"> </span>memory<span class="_ _13"> </span>system,<span class="_"> </span>including<span class="_"> </span>the<span class="_"> </span>TLB</div><div class="t m5 x17 h26 y6f04 ff7 fs19 fc1 sc0 ls0 ws0">(F<span class="_ _1"></span>igure<span class="_ _14"> </span>9.20(a)),<span class="_ _16"> </span>a<span class="_ _16"> </span>portion<span class="_ _14"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>page<span class="_ _16"> </span>table<span class="_ _16"> </span>(Figure<span class="_ _16"> </span>9.20(b)),<span class="_ _16"> </span>and<span class="_ _16"> </span>the<span class="_ _16"> </span>L1<span class="_ _16"> </span>cache</div><div class="t m5 x17 h26 y6f05 ff7 fs19 fc1 sc0 ls0 ws0">(F<span class="_ _1"></span>igure<span class="_ _14"> </span>9.20(c)).<span class="_ _14"> </span>Above<span class="_ _16"> </span>the<span class="_ _14"> </span>ﬁgures<span class="_ _14"> </span>of<span class="_ _14"> </span>the<span class="_ _16"> </span>TLB<span class="_ _14"> </span>and<span class="_ _14"> </span>cache<span class="_ _1"></span>,<span class="_ _15"> </span>we<span class="_ _14"> </span>have<span class="_ _16"> </span>also<span class="_ _14"> </span>shown</div><div class="t m5 x17 h26 y6f06 ff7 fs19 fc1 sc0 ls0 ws0">how<span class="_ _13"> </span>the<span class="_"> </span>bits<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>virtual<span class="_ _13"> </span>and<span class="_"> </span>physical<span class="_ _13"> </span>addresses<span class="_ _13"> </span>are<span class="_"> </span>partitioned<span class="_ _13"> </span>by<span class="_"> </span>the<span class="_ _13"> </span>hardware</div><div class="t m5 x17 h26 y6f07 ff7 fs19 fc1 sc0 ls0 ws0">as<span class="_"> </span>it<span class="_"> </span>accesses<span class="_"> </span>these<span class="_"> </span>devices<span class="_ _1"></span>.</div><div class="t m5 x26f h65 y6f08 ffb3 fs38 fc1 sc0 ls0 ws0">13<span class="_ _3e"> </span>12<span class="_ _17"> </span>1<span class="_ _1"></span>1<span class="_ _3e"> </span>10<span class="_ _fe"> </span>9<span class="_ _3f"> </span>8<span class="_ _3f"> </span>7<span class="_ _3c"> </span>6<span class="_ _ff"> </span>5<span class="_ _1c"> </span>4<span class="_ _ff"> </span>3<span class="_ _ff"> </span>2<span class="_ _103"> </span>1<span class="_ _ff"> </span>0</div><div class="t m5 x1cc h3f y6f09 ffb3 fs27 fc1 sc0 ls0 ws0">VPN</div><div class="t m5 xa4 h3f y6f0a ffb3 fs27 fc1 sc0 ls0 ws0">(Virtual page number)</div><div class="t m5 x36 h3f y6f0b ffb3 fs27 fc1 sc0 ls0 ws0">VPO</div><div class="t m5 x179 h3f y6f0c ffb3 fs27 fc1 sc0 ls0 ws0">(Virtual page of<span class="_ _0"></span>fset)</div><div class="t m5 x31 h3f y6f0d ffb3 fs27 fc1 sc0 ls0 ws0">Virtual</div><div class="t m5 x168 h3f y6f0e ffb3 fs27 fc1 sc0 ls0 ws0">address</div><div class="t m5 x127 h65 y6f0f ffb3 fs38 fc1 sc0 ls29e ws0">1<span class="_ _208"></span>1<span class="_ _4a"></span>1<span class="_ _c5"></span>0<span class="_ _7"></span>98<span class="_ _1"></span>7<span class="_ _a"> </span>65<span class="_ _2"></span>432<span class="_ _be"> </span>10</div><div class="t m5 x235 h3f y6f10 ffb3 fs27 fc1 sc0 ls0 ws0">PPN</div><div class="t m5 xcd h3f y6f11 ffb3 fs27 fc1 sc0 ls0 ws0">(Physical page number)</div><div class="t m5 x36 h3f y6f10 ffb3 fs27 fc1 sc0 ls0 ws0">PPO</div><div class="t m5 x130 h3f y6f11 ffb3 fs27 fc1 sc0 ls0 ws0">(Physical page offset)</div><div class="t m5 x17 h3f y6f12 ffb3 fs27 fc1 sc0 ls0 ws0">Physical</div><div class="t m5 x168 h3f y6f13 ffb3 fs27 fc1 sc0 ls0 ws0">address</div><div class="t m5 x17 h34 y126b ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _16"> </span>9.19<span class="_ _66"> </span><span class="fc1">Addressing<span class="_ _16"> </span>for<span class="_ _16"> </span>small<span class="_ _11"> </span>memor<span class="_ _2"></span>y<span class="_ _11"> </span>system.<span class="_ _16"> </span><span class="ff6">Assume<span class="_ _16"> </span>14-bit<span class="_ _11"> </span>virtual<span class="_ _16"> </span>addresses</span></span></div><div class="t m5 x17 h35 y126c ff6 fs16 fc1 sc0 ls0 ws0">(<span class="ff11">n<span class="_ _13"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ff7">14</span></span></span>),<span class="_ _10"> </span>12-bit<span class="_ _11"> </span>physical<span class="_ _10"> </span>addresses<span class="_ _10"> </span>(<span class="ff11">m<span class="_ _13"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ff7">12<span class="_ _2"></span></span></span></span>),<span class="_ _10"> </span>and<span class="_ _10"> </span>64-byte<span class="_ _11"> </span>pages<span class="_ _10"> </span>(<span class="ff11">P<span class="_ _14"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ff7">64</span></span></span>).</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
