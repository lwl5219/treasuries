<div id="pf415" class="pf w2 h11" data-page-no="415"><div class="pc pc415 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg415.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">1044<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>12<span class="_ _3d"> </span>Concurrent<span class="_ _10"> </span>Programming</span></div><div class="t m5 x29 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">Readers-writers<span class="_ _16"> </span>interactions<span class="_ _14"> </span>occur<span class="_ _16"> </span>frequently<span class="_ _14"> </span>in<span class="_ _16"> </span>real<span class="_ _14"> </span>systems<span class="_ _1"></span>.<span class="_ _16"> </span>F<span class="_ _1"></span>or<span class="_ _14"> </span>example<span class="_ _0"></span>,</div><div class="t m5 x1d h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">in<span class="_"> </span>an<span class="_"> </span>online<span class="_"> </span>airline<span class="_"> </span>reservation<span class="_ _13"> </span>system,<span class="_"> </span>an<span class="_"> </span>unlimited<span class="_"> </span>number<span class="_"> </span>of<span class="_"> </span>customers<span class="_"> </span>are<span class="_"> </span>al-</div><div class="t m5 x1d h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">lowed<span class="_ _13"> </span>to<span class="_ _6"> </span>concurrently<span class="_ _13"> </span>inspect<span class="_ _13"> </span>the<span class="_ _6"> </span>seat<span class="_ _13"> </span>assignments<span class="_ _1"></span>,<span class="_ _13"> </span>but<span class="_ _13"> </span>a<span class="_ _6"> </span>customer<span class="_ _13"> </span>who<span class="_ _13"> </span>is<span class="_ _6"> </span>booking</div><div class="t m5 x1d h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">a<span class="_ _13"> </span>seat<span class="_"> </span>must<span class="_ _13"> </span>have<span class="_ _13"> </span>exclusive<span class="_"> </span>access<span class="_ _13"> </span>to<span class="_ _13"> </span>the<span class="_"> </span>database<span class="_ _1"></span>.<span class="_ _13"> </span>As<span class="_"> </span>another<span class="_ _13"> </span>example<span class="_ _1"></span>,<span class="_"> </span>in<span class="_ _13"> </span>a<span class="_ _13"> </span>multi-</div><div class="t m5 x1d h26 y2f8 ff7 fs19 fc2 sc0 ls0 ws0">threaded<span class="_ _11"> </span>caching<span class="_ _16"> </span>W<span class="_ _3"></span>eb<span class="_ _16"> </span>proxy<span class="_ _7"></span>,<span class="_ _16"> </span>an<span class="_ _16"> </span>unlimited<span class="_ _11"> </span>number<span class="_ _16"> </span>of<span class="_ _11"> </span>threads<span class="_ _16"> </span>can<span class="_ _11"> </span>fetch<span class="_ _16"> </span>existing</div><div class="t m5 x1d h26 y2f9 ff7 fs19 fc2 sc0 ls0 ws0">pages<span class="_ _11"> </span>from<span class="_ _16"> </span>the<span class="_ _11"> </span>shared<span class="_ _16"> </span>page<span class="_ _16"> </span>cache<span class="_ _1"></span>,<span class="_ _16"> </span>but<span class="_ _11"> </span>any<span class="_ _16"> </span>thread<span class="_ _16"> </span>that<span class="_ _11"> </span>writes<span class="_ _16"> </span>a<span class="_ _11"> </span>new<span class="_ _16"> </span>page<span class="_ _11"> </span>to<span class="_ _16"> </span>the</div><div class="t m5 x1d h26 y2fa ff7 fs19 fc2 sc0 ls0 ws0">cache<span class="_"> </span>must<span class="_"> </span>have<span class="_"> </span>exclusive<span class="_"> </span>access<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y2fb ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>readers-writers<span class="_"> </span>problem<span class="_ _13"> </span>has<span class="_"> </span>several<span class="_"> </span>variations<span class="_ _3"></span>,<span class="_"> </span>each<span class="_"> </span>based<span class="_ _13"> </span>on<span class="_"> </span>the<span class="_"> </span>priori-</div><div class="t m5 x1d h26 y2fc ff7 fs19 fc2 sc0 ls0 ws0">ties<span class="_ _13"> </span>of<span class="_ _13"> </span>readers<span class="_ _13"> </span>and<span class="_ _13"> </span>writers<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _3"></span>he<span class="_"> </span><span class="ffa">ﬁrst<span class="_ _13"> </span>readers-writers<span class="_ _13"> </span>problem</span>,<span class="_ _13"> </span>which<span class="_ _13"> </span>favors<span class="_ _13"> </span>readers<span class="_ _1"></span>,</div><div class="t m5 x1d h26 y2fd ff7 fs19 fc2 sc0 ls0 ws0">requires<span class="_"> </span>that<span class="_ _11"> </span>no<span class="_ _11"> </span>reader<span class="_ _11"> </span>be<span class="_"> </span>kept<span class="_ _11"> </span>waiting<span class="_ _11"> </span>unless<span class="_ _11"> </span>a<span class="_"> </span>writer<span class="_ _11"> </span>has<span class="_ _11"> </span>already<span class="_ _11"> </span>been<span class="_"> </span>granted</div><div class="t m5 x1d h26 y2fe ff7 fs19 fc2 sc0 ls0 ws0">permission<span class="_ _13"> </span>to<span class="_ _6"> </span>use<span class="_ _13"> </span>the<span class="_ _13"> </span>object.<span class="_ _6"> </span>In<span class="_ _13"> </span>other<span class="_ _13"> </span>words<span class="_ _3"></span>,<span class="_ _13"> </span>no<span class="_ _13"> </span>reader<span class="_ _13"> </span>should<span class="_ _6"> </span>wait<span class="_ _13"> </span>simply<span class="_ _13"> </span>because</div><div class="t m5 x1d h26 y2ff ff7 fs19 fc2 sc0 ls0 ws0">a<span class="_ _11"> </span>writer<span class="_ _11"> </span>is<span class="_ _16"> </span>waiting<span class="_ _0"></span>.<span class="_ _11"> </span>T<span class="_ _0"></span>he<span class="_ _11"> </span><span class="ffa">second<span class="_ _11"> </span>readers-writers<span class="_ _16"> </span>problem</span>,<span class="_ _11"> </span>which<span class="_ _11"> </span>favors<span class="_ _11"> </span>writers<span class="_ _0"></span>,<span class="_ _11"> </span>re-</div><div class="t m5 x1d h26 y300 ff7 fs19 fc2 sc0 ls0 ws0">quires<span class="_ _13"> </span>that<span class="_"> </span>once<span class="_ _13"> </span>a<span class="_ _13"> </span>writer<span class="_"> </span>is<span class="_ _13"> </span>ready<span class="_ _13"> </span>to<span class="_"> </span>write<span class="_ _1"></span>,<span class="_"> </span>it<span class="_ _13"> </span>performs<span class="_ _13"> </span>its<span class="_"> </span>write<span class="_ _13"> </span>as<span class="_ _13"> </span>soon<span class="_"> </span>as<span class="_ _13"> </span>possible<span class="_ _1"></span>.</div><div class="t m5 x1d h26 y21a ff7 fs19 fc2 sc0 ls0 ws0">Unlike<span class="_"> </span>the<span class="_ _13"> </span>ﬁrst<span class="_"> </span>problem,<span class="_ _13"> </span>a<span class="_"> </span>reader<span class="_ _13"> </span>that<span class="_"> </span>arrives<span class="_ _13"> </span>after<span class="_"> </span>a<span class="_ _13"> </span>writer<span class="_"> </span>must<span class="_"> </span>wait,<span class="_ _13"> </span>even<span class="_"> </span>if<span class="_ _13"> </span>the</div><div class="t m5 x1d h26 y450 ff7 fs19 fc2 sc0 ls0 ws0">writer<span class="_"> </span>is<span class="_"> </span>also<span class="_"> </span>waiting.</div><div class="t m5 x29 h26 y451 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _14"> </span>12.26<span class="_ _16"> </span>shows<span class="_ _16"> </span>a<span class="_ _16"> </span>solution<span class="_ _16"> </span>to<span class="_ _14"> </span>the<span class="_ _16"> </span>ﬁrst<span class="_ _16"> </span>readers-writers<span class="_ _16"> </span>problem.<span class="_ _16"> </span>Like<span class="_ _14"> </span>the</div><div class="t m5 x1d h26 y452 ff7 fs19 fc2 sc0 ls0 ws0">solutions<span class="_ _11"> </span>to<span class="_ _16"> </span>many<span class="_ _16"> </span>synchronization<span class="_ _11"> </span>problems<span class="_ _1"></span>,<span class="_ _16"> </span>it<span class="_ _16"> </span>is<span class="_ _11"> </span>subtle<span class="_ _16"> </span>and<span class="_ _11"> </span>deceptively<span class="_ _16"> </span>simple<span class="_ _1"></span>.</div><div class="t m5 x1d h26 y453 ff7 fs19 fc2 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _21"> </span><span class="ffd ls0">w<span class="_ _14"> </span><span class="ff7">semaphore<span class="_ _15"> </span>controls<span class="_ _14"> </span>access<span class="_ _15"> </span>to<span class="_ _14"> </span>the<span class="_ _15"> </span>critical<span class="_ _14"> </span>sections<span class="_ _14"> </span>that<span class="_ _15"> </span>access<span class="_ _14"> </span>the<span class="_ _15"> </span>shared</span></span></div><div class="t m5 x1d h26 y454 ff7 fs19 fc2 sc0 ls0 ws0">object.<span class="_ _21"> </span>T<span class="_ _0"></span>he<span class="_ _21"> </span><span class="ffd">mutex<span class="_ _21"> </span></span>semaphore<span class="_ _21"> </span>protects<span class="_ _f"> </span>access<span class="_ _21"> </span>to<span class="_ _21"> </span>the<span class="_ _21"> </span>shared<span class="_ _f"> </span><span class="ffd">readcnt<span class="_ _21"> </span></span>variable,</div><div class="t m5 x1d h26 y455 ff7 fs19 fc2 sc0 ls0 ws0">which<span class="_ _13"> </span>counts<span class="_ _6"> </span>the<span class="_ _13"> </span>number<span class="_ _13"> </span>of<span class="_ _13"> </span>readers<span class="_ _6"> </span>currently<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_ _13"> </span>critical<span class="_ _6"> </span>section.<span class="_ _13"> </span>A<span class="_ _13"> </span>writer<span class="_ _13"> </span>locks</div><div class="t m5 x1d h26 y456 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _6"> </span><span class="ffd">w<span class="_ _6"> </span></span>mutex<span class="_ _13"> </span>each<span class="_ _a"> </span>time<span class="_ _13"> </span>it<span class="_ _a"> </span>enters<span class="_ _13"> </span>the<span class="_ _a"> </span>critical<span class="_ _13"> </span>section<span class="_ _a"> </span>and<span class="_ _13"> </span>unlocks<span class="_ _a"> </span>it<span class="_ _6"> </span>each<span class="_ _13"> </span>time<span class="_ _a"> </span>it<span class="_ _13"> </span>leaves<span class="_ _3"></span>.</div><div class="t m5 x1d h26 y457 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>guarantees<span class="_"> </span>that<span class="_ _13"> </span>there<span class="_"> </span>is<span class="_"> </span>at<span class="_ _13"> </span>most<span class="_"> </span>one<span class="_"> </span>writer<span class="_ _13"> </span>in<span class="_"> </span>the<span class="_"> </span>critical<span class="_ _13"> </span>section<span class="_"> </span>at<span class="_"> </span>any<span class="_ _13"> </span>point</div><div class="t m5 x1d h26 y458 ff7 fs19 fc2 sc0 ls0 ws0">in<span class="_"> </span>time<span class="_ _1"></span>.<span class="_"> </span>On<span class="_"> </span>the<span class="_"> </span>other<span class="_"> </span>hand,<span class="_"> </span>only<span class="_"> </span>the<span class="_"> </span>ﬁrst<span class="_"> </span>reader<span class="_"> </span>to<span class="_"> </span>enter<span class="_"> </span>the<span class="_"> </span>critical<span class="_"> </span>section<span class="_"> </span>locks</div><div class="t m5 x1d h26 y459 ffd fs19 fc2 sc0 ls0 ws0">w<span class="ff7">,<span class="_ _14"> </span>and<span class="_ _14"> </span>only<span class="_ _14"> </span>the<span class="_ _14"> </span>last<span class="_ _14"> </span>reader<span class="_ _16"> </span>to<span class="_ _14"> </span>leave<span class="_ _14"> </span>the<span class="_ _14"> </span>critical<span class="_ _14"> </span>section<span class="_ _14"> </span>unlocks<span class="_ _16"> </span>it.<span class="_ _14"> </span>The<span class="_ _16"> </span></span>w<span class="_ _16"> </span><span class="ff7">mutex</span></div><div class="t m5 x1d h26 y45a ff7 fs19 fc2 sc0 ls0 ws0">is<span class="_ _11"> </span>ignored<span class="_ _16"> </span>by<span class="_ _16"> </span>readers<span class="_ _11"> </span>who<span class="_ _16"> </span>enter<span class="_ _16"> </span>and<span class="_ _11"> </span>leave<span class="_ _16"> </span>while<span class="_ _16"> </span>other<span class="_ _11"> </span>readers<span class="_ _16"> </span>are<span class="_ _16"> </span>present.<span class="_ _11"> </span>T<span class="_ _0"></span>his</div><div class="t m5 x1d h26 y45b ff7 fs19 fc2 sc0 ls0 ws0">means<span class="_ _13"> </span>that<span class="_"> </span>as<span class="_ _13"> </span>long<span class="_"> </span>as<span class="_ _13"> </span>a<span class="_ _13"> </span>single<span class="_"> </span>reader<span class="_ _13"> </span>holds<span class="_ _13"> </span>the<span class="_"> </span><span class="ffd">w<span class="_ _13"> </span></span>mutex,<span class="_"> </span>an<span class="_ _13"> </span>unbounded<span class="_ _13"> </span>number<span class="_"> </span>of</div><div class="t m5 x1d h26 y45c ff7 fs19 fc2 sc0 ls0 ws0">readers<span class="_"> </span>can<span class="_"> </span>enter<span class="_"> </span>the<span class="_"> </span>critical<span class="_"> </span>section<span class="_"> </span>unimpeded.</div><div class="t m5 x29 h26 y227 ff7 fs19 fc2 sc0 ls0 ws0">A<span class="_ _21"> </span>correct<span class="_ _21"> </span>solution<span class="_ _21"> </span>to<span class="_ _f"> </span>either<span class="_ _21"> </span>of<span class="_ _21"> </span>the<span class="_ _f"> </span>readers-writers<span class="_ _21"> </span>problems<span class="_ _21"> </span>can<span class="_ _f"> </span>result<span class="_ _21"> </span>in</div><div class="t m5 x1d h26 y45d ffa fs19 fc2 sc0 ls0 ws0">starvation<span class="ff7">,<span class="_ _f"> </span>where<span class="_ _f"> </span>a<span class="_ _f"> </span>thread<span class="_ _f"> </span>blocks<span class="_ _21"> </span>indeﬁnitely<span class="_ _f"> </span>and<span class="_ _f"> </span>fails<span class="_ _21"> </span>to<span class="_ _f"> </span>make<span class="_ _f"> </span>progress<span class="_ _1"></span>.<span class="_ _21"> </span>F<span class="_ _0"></span>or</span></div><div class="t m5 x1d h26 y45e ff7 fs19 fc2 sc0 ls0 ws0">example<span class="_ _1"></span>,<span class="_ _21"> </span>in<span class="_ _15"> </span>the<span class="_ _15"> </span>solution<span class="_ _15"> </span>in<span class="_ _15"> </span>F<span class="_ _1"></span>igure<span class="_ _15"> </span>12.26,<span class="_ _21"> </span>a<span class="_ _15"> </span>writer<span class="_ _15"> </span>could<span class="_ _15"> </span>wait<span class="_ _15"> </span>indeﬁnitely<span class="_ _15"> </span>while</div><div class="t m5 x1d h26 y4ad ff7 fs19 fc2 sc0 ls0 ws0">a<span class="_"> </span>stream<span class="_"> </span>of<span class="_"> </span>readers<span class="_"> </span>arrived.</div><div class="t m5 x1d h47 y82ad ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>12.10<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>1074)</span></div><div class="t m5 x1d h26 y82ae ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _11"> </span>solution<span class="_ _11"> </span>to<span class="_"> </span>the<span class="_ _11"> </span>ﬁrst<span class="_ _11"> </span>readers-writers<span class="_ _11"> </span>problem<span class="_"> </span>in<span class="_ _11"> </span>F<span class="_ _0"></span>igure<span class="_"> </span>12.26<span class="_ _11"> </span>gives<span class="_ _11"> </span>priority<span class="_ _11"> </span>to</div><div class="t m5 x1d h26 y82af ff7 fs19 fc1 sc0 ls0 ws0">readers<span class="_ _1"></span>,<span class="_ _13"> </span>but<span class="_ _6"> </span>this<span class="_ _13"> </span>priority<span class="_ _6"> </span>is<span class="_ _13"> </span>weak<span class="_ _6"> </span>in<span class="_ _13"> </span>the<span class="_ _6"> </span>sense<span class="_ _13"> </span>that<span class="_ _6"> </span>a<span class="_ _13"> </span>writer<span class="_ _13"> </span>leaving<span class="_ _6"> </span>its<span class="_ _13"> </span>critical<span class="_ _6"> </span>section</div><div class="t m5 x1d h26 y82b0 ff7 fs19 fc1 sc0 ls0 ws0">might<span class="_ _15"> </span>restart<span class="_ _14"> </span>a<span class="_ _15"> </span>waiting<span class="_ _15"> </span>writer<span class="_ _15"> </span>instead<span class="_ _15"> </span>of<span class="_ _15"> </span>a<span class="_ _15"> </span>waiting<span class="_ _15"> </span>reader.<span class="_ _14"> </span>Describe<span class="_ _15"> </span>a<span class="_ _15"> </span>scenario</div><div class="t m5 x1d h26 y82b1 ff7 fs19 fc1 sc0 ls0 ws0">where<span class="_"> </span>this<span class="_"> </span>weak<span class="_"> </span>priority<span class="_"> </span>would<span class="_"> </span>allow<span class="_"> </span>a<span class="_"> </span>collection<span class="_"> </span>of<span class="_"> </span>writers<span class="_"> </span>to<span class="_"> </span>starve<span class="_"> </span>a<span class="_"> </span>reader.</div><div class="t m5 x1d h41 y1051 ffe fs29 fc1 sc0 ls0 ws0">12.5.5<span class="_ _48"> </span><span class="fs19">Putting<span class="_"> </span>It<span class="_"> </span>T<span class="_ _3"></span>ogether:<span class="_"> </span>A<span class="_"> </span>Concurrent<span class="_"> </span>Ser<span class="_ _2"></span>ver<span class="_"> </span>Based<span class="_"> </span>on<span class="_"> </span>Prethreading</span></div><div class="t m5 x1d h26 y832 ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _15"> </span>have<span class="_ _21"> </span>seen<span class="_ _15"> </span>how<span class="_ _15"> </span>semaphores<span class="_ _21"> </span>can<span class="_ _15"> </span>be<span class="_ _15"> </span>used<span class="_ _21"> </span>to<span class="_ _15"> </span>access<span class="_ _15"> </span>shared<span class="_ _21"> </span>variables<span class="_ _15"> </span>and<span class="_ _15"> </span>to</div><div class="t m5 x1d h26 y833 ff7 fs19 fc1 sc0 ls0 ws0">schedule<span class="_ _11"> </span>accesses<span class="_ _11"> </span>to<span class="_ _11"> </span>shared<span class="_ _11"> </span>resources<span class="_ _1"></span>.<span class="_ _11"> </span>T<span class="_ _3"></span>o<span class="_ _11"> </span>help<span class="_ _11"> </span>you<span class="_ _11"> </span>understand<span class="_ _11"> </span>these<span class="_ _16"> </span>ideas<span class="_"> </span>more</div><div class="t m5 x1d h26 y834 ff7 fs19 fc1 sc0 ls0 ws0">clearly<span class="_ _3"></span>,<span class="_ _f"> </span>let<span class="_ _f"> </span>us<span class="_ _21"> </span>apply<span class="_ _21"> </span>them<span class="_ _f"> </span>to<span class="_ _21"> </span>a<span class="_ _21"> </span>concurrent<span class="_ _f"> </span>server<span class="_ _21"> </span>based<span class="_ _f"> </span>on<span class="_ _21"> </span>a<span class="_ _21"> </span>technique<span class="_ _f"> </span>called</div><div class="t m5 x1d h26 y835 ffa fs19 fc1 sc0 ls0 ws0">prethreading<span class="_ _2"></span><span class="ff7">.</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
