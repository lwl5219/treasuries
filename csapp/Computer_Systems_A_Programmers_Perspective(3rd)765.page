<div id="pf2fd" class="pf w2 h11" data-page-no="2fd"><div class="pc pc2fd w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg2fd.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">764<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>8<span class="_ _3d"> </span>Exceptional<span class="_ _10"> </span>Control<span class="_ _10"> </span>Flow</span></div><div class="t m5 x14 h2f ye7 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>8.7</div><div class="t m5 x14 h2f y58a ffe fs16 fc1 sc0 ls0 ws0">Fault<span class="_ _e"> </span>handling.</div><div class="t m5 x14 h34 y58b ff6 fs16 fc1 sc0 ls0 ws0">Depending<span class="_ _10"> </span>on<span class="_ _10"> </span>whether<span class="_ _10"> </span>the</div><div class="t m5 x14 h34 y58c ff6 fs16 fc1 sc0 ls0 ws0">fault<span class="_ _16"> </span>can<span class="_ _16"> </span>be<span class="_ _16"> </span>repaired<span class="_ _16"> </span>or</div><div class="t m5 x14 h34 y58d ff6 fs16 fc1 sc0 ls0 ws0">not,<span class="_ _13"> </span>the<span class="_ _10"> </span>fault<span class="_ _13"> </span>handler<span class="_ _13"> </span>either</div><div class="t m5 x14 h34 y58e ff6 fs16 fc1 sc0 ls0 ws0">re-executes<span class="_ _16"> </span>the<span class="_ _16"> </span>faulting</div><div class="t m5 x14 h34 y58f ff6 fs16 fc1 sc0 ls0 ws0">instruction<span class="_ _10"> </span>or<span class="_ _11"> </span>aborts.</div><div class="t m5 xd4 h91 y646f ff94 fs57 fc1 sc0 ls0 ws0">(2) Control passes</div><div class="t m5 x139 h91 y6470 ff94 fs57 fc1 sc0 ls0 ws0">to handler</div><div class="t m5 x98 h91 y6471 ff94 fs57 fc1 sc0 ls0 ws0">(3) F<span class="_ _1"></span>ault</div><div class="t m5 x98 h91 y6472 ff94 fs57 fc1 sc0 ls0 ws0">handler runs</div><div class="t m5 x19b h91 y6473 ff94 fs57 fc1 sc0 ls0 ws0">(4) Handler either re-ex<span class="_ _1"></span>ecutes</div><div class="t m5 x12d h91 y6474 ff94 fs57 fc1 sc0 ls0 ws0">current instruction or abor<span class="_ _2"></span>ts</div><div class="t m5 x112 h91 y6475 ff94 fs57 fc1 sc0 ls0 ws0">(1) Current</div><div class="t m5 x1a h91 y6476 ff94 fs57 fc1 sc0 ls0 ws0">instruction</div><div class="t m5 xe0 h91 y6477 ff94 fs57 fc1 sc0 ls0 ws0">causes a fault</div><div class="t m5 x125 h91 y6478 ff94 fs57 fc1 sc0 ls0 ws0">I</div><div class="t m5 x90 he3 y6479 ff93 fs94 fc1 sc0 ls0 ws0">curr</div><div class="t m5 x220 hfb y647a ff8d fs99 fc1 sc0 ls0 ws0">abort</div><div class="t m5 x14 h2f y647b ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>8.8</div><div class="t m5 x14 h34 y647c ffe fs16 fc1 sc0 ls0 ws0">Abort<span class="_"> </span>handling.<span class="_"> </span><span class="ff6">The<span class="_ _10"> </span>abort</span></div><div class="t m5 x14 h34 y647d ff6 fs16 fc1 sc0 ls0 ws0">handler<span class="_ _10"> </span>passes<span class="_ _11"> </span>control<span class="_ _10"> </span>to<span class="_ _11"> </span>a</div><div class="t m5 x14 h34 y647e ff6 fs16 fc1 sc0 ls0 ws0">kernel</div><div class="t m5 x168 h3a y647f ffd fs19 fc1 sc0 ls0 ws0">abort<span class="_ _11"> </span><span class="ff6 fs16">routine<span class="_ _11"> </span>that</span></div><div class="t m5 x14 h34 y6480 ff6 fs16 fc1 sc0 ls0 ws0">terminates<span class="_ _11"> </span>the<span class="_ _11"> </span>application</div><div class="t m5 x14 h34 y6481 ff6 fs16 fc1 sc0 ls0 ws0">program.</div><div class="t m5 x179 h91 y6482 ff94 fs57 fc1 sc0 ls0 ws0">(2) Control passes</div><div class="t m5 x40 h91 y6483 ff94 fs57 fc1 sc0 ls0 ws0">to handler</div><div class="t m5 x1e1 h91 y6484 ff94 fs57 fc1 sc0 ls0 ws0">(3) Abor<span class="_ _2"></span>t</div><div class="t m5 x1e1 h91 y6485 ff94 fs57 fc1 sc0 ls0 ws0">handler runs</div><div class="t m5 x1dd h91 y6486 ff94 fs57 fc1 sc0 ls0 ws0">(4) Handler returns</div><div class="t m5 x23f h91 y6487 ff94 fs57 fc1 sc0 ls0 ws0">to </div><div class="t m5 x11e hfb y6488 ff8d fs99 fc1 sc0 ls0 ws0">abort<span class="ff94 fs57"> routine</span></div><div class="t m5 xe0 h91 y6489 ff94 fs57 fc1 sc0 ls0 ws0">(1) F<span class="_ _1"></span>atal hardware</div><div class="t m5 x235 h91 y648a ff94 fs57 fc1 sc0 ls0 ws0">error occurs</div><div class="t m5 xe1 h91 y648b ff94 fs57 fc1 sc0 ls0 ws0">I</div><div class="t m5 x136 he3 y648c ff93 fs94 fc1 sc0 ls0 ws0">curr</div><div class="t m5 x236 hfb y648d ff8d fs99 fc1 sc0 ls0 ws0">abort</div><div class="t m5 x1d h26 y648e ff7 fs19 fc1 sc0 ls0 ws0">run<span class="_ _11"> </span>in<span class="_ _16"> </span><span class="ffa">user<span class="_ _11"> </span>mode<span class="_ _2"></span></span>,<span class="_ _11"> </span>which<span class="_ _16"> </span>restricts<span class="_ _11"> </span>the<span class="_ _16"> </span>types<span class="_ _16"> </span>of<span class="_ _11"> </span>instructions<span class="_ _16"> </span>they<span class="_ _11"> </span>can<span class="_ _16"> </span>execute<span class="_ _1"></span>,<span class="_ _16"> </span>and</div><div class="t m5 x1d h26 y648f ff7 fs19 fc1 sc0 ls0 ws0">they<span class="_ _16"> </span>access<span class="_ _14"> </span>the<span class="_ _14"> </span>same<span class="_ _14"> </span>stack<span class="_ _14"> </span>as<span class="_ _14"> </span>the<span class="_ _14"> </span>calling<span class="_ _16"> </span>function.<span class="_ _14"> </span>A<span class="_ _14"> </span>system<span class="_ _14"> </span>call<span class="_ _14"> </span>runs<span class="_ _14"> </span>in<span class="_ _14"> </span><span class="ffa">kernel</span></div><div class="t m5 x1d h26 y6490 ffa fs19 fc1 sc0 ls0 ws0">mode<span class="ff7">,<span class="_ _13"> </span>which<span class="_ _13"> </span>allows<span class="_ _13"> </span>it<span class="_ _13"> </span>to<span class="_ _13"> </span>execute<span class="_ _13"> </span>privileged<span class="_ _13"> </span>instructions<span class="_ _13"> </span>and<span class="_ _13"> </span>access<span class="_"> </span>a<span class="_ _13"> </span>stack<span class="_ _13"> </span>deÔ¨Åned</span></div><div class="t m5 x1d h26 y6491 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_"> </span>the<span class="_"> </span>kernel.<span class="_"> </span>Section<span class="_"> </span>8.2.4<span class="_"> </span>discusses<span class="_"> </span>user<span class="_"> </span>and<span class="_"> </span>kernel<span class="_"> </span>modes<span class="_"> </span>in<span class="_"> </span>more<span class="_"> </span>detail.</div><div class="t m5 x1d h42 y6492 ff6 fs29 fc6 sc0 ls0 ws0">Faults</div><div class="t m5 x1d h26 y6493 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _3"></span>aults<span class="_"> </span>result<span class="_"> </span>from<span class="_"> </span>error<span class="_"> </span>conditions<span class="_"> </span>that<span class="_"> </span>a<span class="_"> </span>handler<span class="_ _13"> </span>might<span class="_"> </span>be<span class="_"> </span>able<span class="_"> </span>to<span class="_"> </span>correct.<span class="_"> </span>When</div><div class="t m5 x1d h26 y6494 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_ _11"> </span>fault<span class="_ _11"> </span>occurs<span class="_ _1"></span>,<span class="_ _11"> </span>the<span class="_ _11"> </span>processor<span class="_ _11"> </span>transfers<span class="_ _11"> </span>control<span class="_ _11"> </span>to<span class="_ _11"> </span>the<span class="_ _11"> </span>fault<span class="_ _11"> </span>handler.<span class="_"> </span>If<span class="_ _11"> </span>the<span class="_ _11"> </span>handler</div><div class="t m5 x1d h26 y6495 ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_"> </span>able<span class="_ _13"> </span>to<span class="_"> </span>correct<span class="_"> </span>the<span class="_ _13"> </span>error<span class="_"> </span>condition,<span class="_"> </span>it<span class="_ _13"> </span>returns<span class="_"> </span>control<span class="_ _13"> </span>to<span class="_"> </span>the<span class="_"> </span>faulting<span class="_ _13"> </span>instruction,</div><div class="t m5 x1d h26 y6496 ff7 fs19 fc1 sc0 ls0 ws0">thereby<span class="_"> </span>re-executing<span class="_ _13"> </span>it.<span class="_"> </span>Otherwise<span class="_ _3"></span>,<span class="_"> </span>the<span class="_"> </span>handler<span class="_ _13"> </span>returns<span class="_"> </span>to<span class="_ _13"> </span>an<span class="_"> </span><span class="ffd">abort<span class="_ _13"> </span></span>routine<span class="_"> </span>in<span class="_ _13"> </span>the</div><div class="t m5 x1d h26 y6497 ff7 fs19 fc1 sc0 ls0 ws0">kernel<span class="_ _16"> </span>that<span class="_ _11"> </span>terminates<span class="_ _16"> </span>the<span class="_ _16"> </span>application<span class="_ _16"> </span>program<span class="_ _16"> </span>that<span class="_ _16"> </span>caused<span class="_ _11"> </span>the<span class="_ _16"> </span>fault.<span class="_ _16"> </span>F<span class="_ _0"></span>igure<span class="_ _16"> </span>8.7</div><div class="t m5 x1d h26 y6498 ff7 fs19 fc1 sc0 ls0 ws0">summarizes<span class="_"> </span>the<span class="_"> </span>processing<span class="_"> </span>for<span class="_"> </span>a<span class="_"> </span>fault.</div><div class="t m5 x29 h26 y6499 ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_ _16"> </span>classic<span class="_ _16"> </span>example<span class="_ _16"> </span>of<span class="_ _16"> </span>a<span class="_ _16"> </span>fault<span class="_ _16"> </span>is<span class="_ _16"> </span>the<span class="_ _16"> </span>page<span class="_ _16"> </span>fault<span class="_ _16"> </span>exception,<span class="_ _14"> </span>which<span class="_ _16"> </span>occurs<span class="_ _16"> </span>when</div><div class="t m5 x1d h26 y649a ff7 fs19 fc1 sc0 ls0 ws0">an<span class="_ _11"> </span>instruction<span class="_ _16"> </span>references<span class="_ _11"> </span>a<span class="_ _16"> </span>virtual<span class="_ _11"> </span>address<span class="_ _16"> </span>whose<span class="_ _11"> </span>corresponding<span class="_ _16"> </span>page<span class="_ _11"> </span>is<span class="_ _11"> </span>not<span class="_ _16"> </span>res-</div><div class="t m5 x1d h26 y649b ff7 fs19 fc1 sc0 ls0 ws0">ident<span class="_ _14"> </span>in<span class="_ _14"> </span>memory<span class="_ _15"> </span>and<span class="_ _14"> </span>must<span class="_ _15"> </span>therefore<span class="_ _14"> </span>be<span class="_ _14"> </span>retrieved<span class="_ _15"> </span>from<span class="_ _14"> </span>disk.<span class="_ _14"> </span>As<span class="_ _15"> </span>we<span class="_ _14"> </span>will<span class="_ _15"> </span>see<span class="_ _14"> </span>in</div><div class="t m5 x1d h26 y649c ff7 fs19 fc1 sc0 ls0 ws0">Chapter<span class="_ _11"> </span>9,<span class="_ _16"> </span>a<span class="_ _11"> </span>page<span class="_ _11"> </span>is<span class="_ _16"> </span>a<span class="_ _11"> </span>contiguous<span class="_ _11"> </span>block<span class="_ _11"> </span>(typically<span class="_ _16"> </span>4<span class="_ _11"> </span>KB)<span class="_ _11"> </span>of<span class="_ _16"> </span>virtual<span class="_ _11"> </span>memory<span class="_ _3"></span>.<span class="_ _11"> </span>T<span class="_ _0"></span>he</div><div class="t m5 x1d h26 y649d ff7 fs19 fc1 sc0 ls0 ws0">page<span class="_"> </span>fault<span class="_"> </span>handler<span class="_"> </span>loads<span class="_ _13"> </span>the<span class="_"> </span>appropriate<span class="_"> </span>page<span class="_"> </span>from<span class="_"> </span>disk<span class="_"> </span>and<span class="_ _13"> </span>then<span class="_"> </span>returns<span class="_"> </span>control</div><div class="t m5 x1d h26 y649e ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_"> </span>the<span class="_ _11"> </span>instruction<span class="_"> </span>that<span class="_ _11"> </span>caused<span class="_ _11"> </span>the<span class="_"> </span>fault.<span class="_ _11"> </span>When<span class="_"> </span>the<span class="_"> </span>instruction<span class="_ _11"> </span>executes<span class="_ _11"> </span>again,<span class="_"> </span>the</div><div class="t m5 x1d h26 y649f ff7 fs19 fc1 sc0 ls0 ws0">appropriate<span class="_"> </span>page<span class="_ _11"> </span>is<span class="_"> </span>now<span class="_ _11"> </span>resident<span class="_ _11"> </span>in<span class="_"> </span>memory<span class="_ _11"> </span>and<span class="_ _11"> </span>the<span class="_"> </span>instruction<span class="_ _11"> </span>is<span class="_ _11"> </span>able<span class="_"> </span>to<span class="_ _11"> </span>run<span class="_ _11"> </span>to</div><div class="t m5 x1d h26 y64a0 ff7 fs19 fc1 sc0 ls0 ws0">completion<span class="_"> </span>without<span class="_"> </span>faulting.</div><div class="t m5 x1d h42 y107b ff6 fs29 fc6 sc0 ls0 ws0">Aborts</div><div class="t m5 x1d h26 y2fb5 ff7 fs19 fc1 sc0 ls0 ws0">Aborts<span class="_ _f"> </span>result<span class="_ _f"> </span>from<span class="_ _f"> </span>unrecoverable<span class="_ _f"> </span>fatal<span class="_ _f"> </span>errors<span class="_ _1"></span>,<span class="_ _e"> </span>typically<span class="_ _21"> </span>hardware<span class="_ _f"> </span>errors<span class="_ _f"> </span>such</div><div class="t m5 x1d h26 y4913 ff7 fs19 fc1 sc0 ls0 ws0">as<span class="_ _15"> </span>parity<span class="_ _21"> </span>errors<span class="_ _15"> </span>that<span class="_ _21"> </span>occur<span class="_ _21"> </span>when<span class="_ _15"> </span>DRAM<span class="_ _21"> </span>or<span class="_ _21"> </span>SRAM<span class="_ _15"> </span>bits<span class="_ _21"> </span>are<span class="_ _21"> </span>corrupted.<span class="_ _15"> </span>Abort</div><div class="t m5 x1d h26 y4914 ff7 fs19 fc1 sc0 ls0 ws0">handlers<span class="_ _13"> </span>never<span class="_"> </span>return<span class="_ _13"> </span>control<span class="_ _13"> </span>to<span class="_ _13"> </span>the<span class="_"> </span>application<span class="_ _13"> </span>program.<span class="_ _13"> </span>As<span class="_"> </span>shown<span class="_ _13"> </span>in<span class="_ _13"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>8.8,</div><div class="t m5 x1d h26 y4915 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _16"> </span>handler<span class="_ _16"> </span>returns<span class="_ _16"> </span>control<span class="_ _14"> </span>to<span class="_ _16"> </span>an<span class="_ _16"> </span><span class="ffd">abort<span class="_ _14"> </span></span>routine<span class="_ _16"> </span>that<span class="_ _16"> </span>terminates<span class="_ _16"> </span>the<span class="_ _14"> </span>application</div><div class="t m5 x1d h26 y4916 ff7 fs19 fc1 sc0 ls0 ws0">program.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
