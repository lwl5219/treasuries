<div id="pf383" class="pf w2 h11" data-page-no="383"><div class="pc pc383 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg383.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">898<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>9<span class="_ _3d"> </span>Virtual<span class="_ _10"> </span>Memory</span></div><div class="t m5 x1d h2d ye7 ffd fs1e fc2 sc0 ls0 ws0">static<span class="_ _e"> </span>void<span class="_ _1f"> </span>place(void<span class="_ _1f"> </span>*bp,<span class="_ _e"> </span>size_t<span class="_ _1f"> </span>asize)</div><div class="t m5 x29 h26 y7430 ff7 fs19 fc2 sc0 ls0 ws0">Y<span class="_ _3"></span>our<span class="_ _11"> </span>solution<span class="_ _16"> </span>should<span class="_ _11"> </span>place<span class="_ _16"> </span>the<span class="_ _16"> </span>requested<span class="_ _11"> </span>block<span class="_ _16"> </span>at<span class="_ _11"> </span>the<span class="_ _16"> </span>beginning<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span>free</div><div class="t m5 x1d h26 y7431 ff7 fs19 fc2 sc0 ls0 ws0">block,<span class="_"> </span>splitting<span class="_ _11"> </span>only<span class="_"> </span>if<span class="_ _11"> </span>the<span class="_ _11"> </span>size<span class="_"> </span>of<span class="_ _11"> </span>the<span class="_"> </span>remainder<span class="_ _11"> </span>would<span class="_"> </span>equal<span class="_ _11"> </span>or<span class="_"> </span>exceed<span class="_ _11"> </span>the<span class="_ _11"> </span>mini-</div><div class="t m5 x1d h26 y7432 ff7 fs19 fc2 sc0 ls0 ws0">mum<span class="_"> </span>block<span class="_"> </span>size<span class="_ _1"></span>.</div><div class="t m5 x1d h41 y7433 ffe fs29 fc1 sc0 ls0 ws0">9.9.13<span class="_ _48"> </span><span class="fs19">Explicit<span class="_"> </span>Free<span class="_"> </span>Lists</span></div><div class="t m5 x1d h26 y7434 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _e"> </span>implicit<span class="_ _21"> </span>free<span class="_ _e"> </span>list<span class="_ _f"> </span>provides<span class="_ _f"> </span>us<span class="_ _e"> </span>with<span class="_ _21"> </span>a<span class="_ _e"> </span>simple<span class="_ _f"> </span>way<span class="_ _f"> </span>to<span class="_ _e"> </span>introduce<span class="_ _21"> </span>some<span class="_ _e"> </span>basic</div><div class="t m5 x1d h26 y7435 ff7 fs19 fc1 sc0 ls0 ws0">allocator<span class="_ _11"> </span>concepts<span class="_ _0"></span>.<span class="_ _11"> </span>However,<span class="_ _16"> </span>because<span class="_ _11"> </span>block<span class="_ _16"> </span>allocation<span class="_ _16"> </span>time<span class="_ _11"> </span>is<span class="_ _16"> </span>linear<span class="_ _16"> </span>in<span class="_ _11"> </span>the<span class="_ _16"> </span>total</div><div class="t m5 x1d h26 y7436 ff7 fs19 fc1 sc0 ls0 ws0">number<span class="_ _15"> </span>of<span class="_ _21"> </span>heap<span class="_ _21"> </span>blocks<span class="_ _1"></span>,<span class="_ _e"> </span>the<span class="_ _15"> </span>implicit<span class="_ _21"> </span>free<span class="_ _21"> </span>list<span class="_ _21"> </span>is<span class="_ _15"> </span>not<span class="_ _21"> </span>appropriate<span class="_ _21"> </span>for<span class="_ _21"> </span>a<span class="_ _21"> </span>general-</div><div class="t m5 x1d h26 y7437 ff7 fs19 fc1 sc0 ls0 ws0">purpose<span class="_ _13"> </span>allocator<span class="_"> </span>(although<span class="_ _13"> </span>it<span class="_ _13"> </span>might<span class="_"> </span>be<span class="_ _13"> </span>ﬁne<span class="_"> </span>for<span class="_ _13"> </span>a<span class="_ _13"> </span>special-purpose<span class="_"> </span>allocator<span class="_ _13"> </span>where</div><div class="t m5 x1d h26 y7438 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>number<span class="_"> </span>of<span class="_"> </span>heap<span class="_"> </span>blocks<span class="_"> </span>is<span class="_"> </span>known<span class="_"> </span>beforehand<span class="_"> </span>to<span class="_"> </span>be<span class="_"> </span>small).</div><div class="t m5 x29 h26 y7439 ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_ _16"> </span>better<span class="_ _16"> </span>approach<span class="_ _16"> </span>is<span class="_ _16"> </span>to<span class="_ _16"> </span>organize<span class="_ _14"> </span>the<span class="_ _16"> </span>free<span class="_ _16"> </span>blocks<span class="_ _16"> </span>into<span class="_ _16"> </span>some<span class="_ _16"> </span>form<span class="_ _14"> </span>of<span class="_ _16"> </span>explicit</div><div class="t m5 x1d h26 y743a ff7 fs19 fc1 sc0 ls0 ws0">data<span class="_ _11"> </span>structure.<span class="_ _11"> </span>Since<span class="_ _16"> </span>by<span class="_ _11"> </span>deﬁnition<span class="_ _16"> </span>the<span class="_ _11"> </span>body<span class="_ _16"> </span>of<span class="_ _11"> </span>a<span class="_ _16"> </span>free<span class="_ _11"> </span>block<span class="_ _16"> </span>is<span class="_ _16"> </span>not<span class="_ _11"> </span>needed<span class="_ _16"> </span>by<span class="_ _11"> </span>the</div><div class="t m5 x1d h26 y743b ff7 fs19 fc1 sc0 ls0 ws0">program,<span class="_"> </span>the<span class="_"> </span>pointers<span class="_"> </span>that<span class="_"> </span>implement<span class="_ _13"> </span>the<span class="_"> </span>data<span class="_"> </span>structure<span class="_"> </span>can<span class="_"> </span>be<span class="_"> </span>stored<span class="_"> </span>within<span class="_"> </span>the</div><div class="t m5 x1d h26 y743c ff7 fs19 fc1 sc0 ls0 ws0">bodies<span class="_ _14"> </span>of<span class="_ _14"> </span>the<span class="_ _14"> </span>free<span class="_ _14"> </span>blocks<span class="_ _1"></span>.<span class="_ _14"> </span>F<span class="_ _1"></span>or<span class="_ _14"> </span>example,<span class="_ _14"> </span>the<span class="_ _14"> </span>heap<span class="_ _14"> </span>can<span class="_ _14"> </span>be<span class="_ _14"> </span>organized<span class="_ _14"> </span>as<span class="_ _14"> </span>a<span class="_ _14"> </span>doubly</div><div class="t m5 x1d h26 y743d ff7 fs19 fc1 sc0 ls0 ws0">linked<span class="_"> </span>free<span class="_"> </span>list<span class="_"> </span>by<span class="_"> </span>including<span class="_ _13"> </span>a<span class="_"> </span><span class="ffd">pred<span class="_ _10"> </span></span>(predecessor)<span class="_"> </span>and<span class="_"> </span><span class="ffd">succ<span class="_ _10"> </span></span>(successor)<span class="_"> </span>pointer<span class="_"> </span>in</div><div class="t m5 x1d h26 y743e ff7 fs19 fc1 sc0 ls0 ws0">each<span class="_"> </span>free<span class="_"> </span>block,<span class="_"> </span>as<span class="_"> </span>shown<span class="_"> </span>in<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>9.48.</div><div class="t m5 x29 h26 y743f ff7 fs19 fc1 sc0 ls0 ws0">Using<span class="_ _16"> </span>a<span class="_ _11"> </span>doubly<span class="_ _16"> </span>linked<span class="_ _16"> </span>list<span class="_ _16"> </span>instead<span class="_ _16"> </span>of<span class="_ _11"> </span>an<span class="_ _16"> </span>implicit<span class="_ _16"> </span>free<span class="_ _16"> </span>list<span class="_ _16"> </span>reduces<span class="_ _11"> </span>the<span class="_ _16"> </span>ﬁrst-ﬁt</div><div class="t m5 x1d h26 y7440 ff7 fs19 fc1 sc0 ls0 ws0">allocation<span class="_"> </span>time<span class="_ _11"> </span>from<span class="_"> </span>linear<span class="_ _11"> </span>in<span class="_"> </span>the<span class="_ _11"> </span>total<span class="_"> </span>number<span class="_"> </span>of<span class="_ _11"> </span>blocks<span class="_"> </span>to<span class="_ _11"> </span>linear<span class="_"> </span>in<span class="_ _11"> </span>the<span class="_"> </span>number</div><div class="t m5 x1d h26 y7441 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span><span class="ffa">free<span class="_"> </span></span>blocks<span class="_ _1"></span>.<span class="_"> </span>However,<span class="_"> </span>the<span class="_"> </span>time<span class="_"> </span>to<span class="_"> </span>free<span class="_"> </span>a<span class="_"> </span>block<span class="_"> </span>can<span class="_"> </span>be<span class="_"> </span>either<span class="_"> </span>linear<span class="_"> </span>or<span class="_"> </span>constant,</div><div class="t m5 x1d h26 y7442 ff7 fs19 fc1 sc0 ls0 ws0">depending<span class="_"> </span>on<span class="_"> </span>the<span class="_"> </span>policy<span class="_"> </span>we<span class="_"> </span>choose<span class="_"> </span>for<span class="_"> </span>ordering<span class="_"> </span>the<span class="_"> </span>blocks<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>free<span class="_"> </span>list.</div><div class="t m5 x207 h114 y7443 ffca fsa3 fc1 sc0 ls0 ws1a">Block size</div><div class="t m5 x145 h114 y7444 ffca fsa3 fc1 sc0 ls0 ws0">Payload</div><div class="t m5 x162 h114 y7445 ffca fsa3 fc1 sc0 ls0 ws1b">(a) Allocated <span class="_ _2"></span>block</div><div class="t m5 x32 h114 y7446 ffca fsa3 fc1 sc0 ls0 ws1a">Padding (optional)</div><div class="t m5 x24c h114 y7443 ffca fsa3 fc1 sc0 ls2c4 ws0">a/f</div><div class="t m5 x207 h114 y7447 ffca fsa3 fc1 sc0 ls0 ws1a">Block size<span class="_ _20"> </span>a<span class="_ _2"></span>/<span class="_ _2"></span>f</div><div class="t m5 xa2 h115 y7448 ffca fsa4 fc1 sc0 ls0 ws0">31<span class="_ _11b"> </span>3<span class="_ _24"> </span>2<span class="_ _22"> </span>1<span class="_ _22"> </span>0</div><div class="t m5 x67 h114 y7449 ffca fsa3 fc1 sc0 ls0 ws0">Header</div><div class="t m5 x67 h114 y744a ffca fsa3 fc1 sc0 ls0 ws0">Footer</div><div class="t m5 x24f h114 y744b ffca fsa3 fc1 sc0 ls0 ws1c">Block size</div><div class="t m5 x205 h114 y744c ffca fsa3 fc1 sc0 ls0 ws0">pred (predecessor)</div><div class="t m5 xf9 h114 y744d ffca fsa3 fc1 sc0 ls0 ws0">(b) Free block</div><div class="t m5 xfe h114 y744e ffca fsa3 fc1 sc0 ls0 ws0">succ (successor)</div><div class="t m5 x1fc h114 y744f ffca fsa3 fc1 sc0 ls0 ws1a">Padding (optional)</div><div class="t m5 x111 h114 y744b ffca fsa3 fc1 sc0 ls2c4 ws0">a/f</div><div class="t m5 x24f h114 y7450 ffca fsa3 fc1 sc0 ls0 ws1c">Block size<span class="_ _20"> </span>a<span class="_ _2"></span>/<span class="_ _2"></span>f</div><div class="t m5 x114 h115 y7451 ffca fsa4 fc1 sc0 ls0 ws0">31<span class="_ _11b"> </span>3<span class="_ _24"> </span>2<span class="_ _22"> </span>1<span class="_ _22"> </span>0</div><div class="t m5 x25f h114 y7452 ffca fsa3 fc1 sc0 ls0 ws0">Header</div><div class="t m5 x6e h114 y7453 ffca fsa3 fc1 sc0 ls0 ws0">Old payload</div><div class="t m5 x25f h114 y7454 ffca fsa3 fc1 sc0 ls0 ws0">Footer</div><div class="t m5 x1d h2f y7455 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>9.48<span class="_ _66"> </span><span class="fc1">Format<span class="_"> </span>of<span class="_"> </span>heap<span class="_"> </span>blocks<span class="_"> </span>that<span class="_"> </span>use<span class="_"> </span>doubly<span class="_"> </span>linked<span class="_"> </span>free<span class="_"> </span>lists.</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
