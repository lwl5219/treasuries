<div id="pf1fb" class="pf w2 h11" data-page-no="1fb"><div class="pc pc1fb w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1fb.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">506<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>4<span class="_ _3d"> </span>Processor<span class="_ _10"> </span>Architecture</span></div><div class="t m5 x1d h26 y9c ff7 fs19 fc2 sc0 ls0 ws0">backed<span class="_ _11"> </span>up<span class="_ _16"> </span>by<span class="_ _11"> </span>slower<span class="_ _16"> </span>and<span class="_ _16"> </span>larger<span class="_ _11"> </span>memories<span class="_ _1"></span>.<span class="_ _16"> </span>At<span class="_ _11"> </span>the<span class="_ _16"> </span>level<span class="_ _11"> </span>closest<span class="_ _16"> </span>to<span class="_ _11"> </span>the<span class="_ _16"> </span>processor,</div><div class="t m5 x1d h26 y409 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _16"> </span><span class="ffa">cache<span class="_ _11"> </span></span>memories<span class="_ _16"> </span>provide<span class="_ _16"> </span>fast<span class="_ _16"> </span>access<span class="_ _16"> </span>to<span class="_ _16"> </span>the<span class="_ _16"> </span>most<span class="_ _16"> </span>heavily<span class="_ _16"> </span>referenced<span class="_ _16"> </span>memory</div><div class="t m5 x1d h26 y40a ff7 fs19 fc2 sc0 ls0 ws0">locations<span class="_ _1"></span>.<span class="_"> </span>A<span class="_"> </span>typical<span class="_"> </span>processor<span class="_"> </span>has<span class="_ _13"> </span>two<span class="_"> </span>ﬁrst-level<span class="_"> </span>caches—one<span class="_"> </span>for<span class="_"> </span>reading<span class="_"> </span>instruc-</div><div class="t m5 x1d h26 y40b ff7 fs19 fc2 sc0 ls0 ws0">tions<span class="_ _13"> </span>and<span class="_ _6"> </span>one<span class="_ _13"> </span>for<span class="_ _13"> </span>reading<span class="_ _13"> </span>and<span class="_ _6"> </span>writing<span class="_ _13"> </span>data.<span class="_ _13"> </span>Another<span class="_ _6"> </span>type<span class="_ _13"> </span>of<span class="_ _13"> </span>cache<span class="_ _13"> </span>memory<span class="_ _7"></span>,<span class="_ _13"> </span>known</div><div class="t m5 x1d h26 y40c ff7 fs19 fc2 sc0 ls0 ws0">as<span class="_"> </span>a<span class="_"> </span><span class="ffa">translation<span class="_"> </span>look-aside<span class="_"> </span>buffer</span>,<span class="_"> </span>or<span class="_"> </span>TLB<span class="_ _3"></span>,<span class="_"> </span>provides<span class="_"> </span>a<span class="_"> </span>fast<span class="_"> </span>translation<span class="_"> </span>from<span class="_"> </span>virtual</div><div class="t m5 x1d h26 y40d ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_"> </span>physical<span class="_ _11"> </span>addresses<span class="_ _1"></span>.<span class="_ _11"> </span>Using<span class="_ _11"> </span>a<span class="_"> </span>combination<span class="_ _11"> </span>of<span class="_ _11"> </span>TLBs<span class="_ _11"> </span>and<span class="_"> </span>caches<span class="_ _0"></span>,<span class="_"> </span>it<span class="_ _11"> </span>is<span class="_ _11"> </span>indeed<span class="_ _11"> </span>pos-</div><div class="t m5 x1d h26 y40e ff7 fs19 fc2 sc0 ls0 ws0">sible<span class="_ _16"> </span>to<span class="_ _14"> </span>read<span class="_ _14"> </span>instructions<span class="_ _16"> </span>and<span class="_ _14"> </span>read<span class="_ _14"> </span>or<span class="_ _14"> </span>write<span class="_ _16"> </span>data<span class="_ _14"> </span>in<span class="_ _14"> </span>a<span class="_ _16"> </span>single<span class="_ _14"> </span>clock<span class="_ _14"> </span>cycle<span class="_ _16"> </span>most<span class="_ _14"> </span>of</div><div class="t m5 x1d h26 y40f ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _16"> </span>time.<span class="_ _16"> </span>T<span class="_ _1"></span>hus<span class="_ _1"></span>,<span class="_ _14"> </span>our<span class="_ _14"> </span>simpliﬁed<span class="_ _16"> </span>view<span class="_ _14"> </span>of<span class="_ _16"> </span>memory<span class="_ _14"> </span>referencing<span class="_ _16"> </span>by<span class="_ _14"> </span>our<span class="_ _16"> </span>processors<span class="_ _14"> </span>is</div><div class="t m5 x1d h26 y410 ff7 fs19 fc2 sc0 ls0 ws0">actually<span class="_"> </span>quite<span class="_"> </span>reasonable<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y411 ff7 fs19 fc2 sc0 ls0 ws0">Although<span class="_ _21"> </span>the<span class="_ _21"> </span>caches<span class="_ _f"> </span>hold<span class="_ _21"> </span>the<span class="_ _21"> </span>most<span class="_ _f"> </span>heavily<span class="_ _21"> </span>referenced<span class="_ _21"> </span>memory<span class="_ _f"> </span>locations<span class="_ _1"></span>,</div><div class="t m5 x1d h26 y412 ff7 fs19 fc2 sc0 ls0 ws0">there<span class="_ _16"> </span>will<span class="_ _16"> </span>be<span class="_ _16"> </span>times<span class="_ _16"> </span>when<span class="_ _16"> </span>a<span class="_ _16"> </span>cache<span class="_ _16"> </span><span class="ffa">miss<span class="_ _16"> </span></span>occurs<span class="_ _1"></span>,<span class="_ _14"> </span>where<span class="_ _16"> </span>some<span class="_ _16"> </span>reference<span class="_ _16"> </span>is<span class="_ _16"> </span>made<span class="_ _16"> </span>to</div><div class="t m5 x1d h26 y413 ff7 fs19 fc2 sc0 ls0 ws0">a<span class="_ _11"> </span>location<span class="_ _16"> </span>that<span class="_ _11"> </span>is<span class="_ _11"> </span>not<span class="_ _16"> </span>held<span class="_ _11"> </span>in<span class="_ _16"> </span>the<span class="_ _11"> </span>cache<span class="_ _0"></span>.<span class="_ _11"> </span>In<span class="_ _16"> </span>the<span class="_ _11"> </span>best<span class="_ _11"> </span>case,<span class="_ _11"> </span>the<span class="_ _16"> </span>missing<span class="_ _11"> </span>data<span class="_ _11"> </span>can<span class="_ _16"> </span>be</div><div class="t m5 x1d h26 y414 ff7 fs19 fc2 sc0 ls0 ws0">retrieved<span class="_ _16"> </span>from<span class="_ _16"> </span>a<span class="_ _16"> </span>higher<span class="_ _1"></span>-level<span class="_ _16"> </span>cache<span class="_ _16"> </span>or<span class="_ _16"> </span>from<span class="_ _16"> </span>the<span class="_ _16"> </span>main<span class="_ _16"> </span>memory<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>processor,</div><div class="t m5 x1d h26 y415 ff7 fs19 fc2 sc0 ls0 ws0">requiring<span class="_ _11"> </span>3<span class="_ _16"> </span>to<span class="_ _16"> </span>20<span class="_ _11"> </span>clock<span class="_ _16"> </span>c<span class="_ _0"></span>ycles<span class="_ _1"></span>.<span class="_ _16"> </span>Meanwhile<span class="_ _1"></span>,<span class="_ _16"> </span>the<span class="_ _16"> </span>pipeline<span class="_ _11"> </span>simply<span class="_ _16"> </span>stalls<span class="_ _3"></span>,<span class="_ _16"> </span>holding<span class="_ _16"> </span>the</div><div class="t m5 x1d h26 y416 ff7 fs19 fc2 sc0 ls0 ws0">instruction<span class="_ _14"> </span>in<span class="_ _15"> </span>the<span class="_ _15"> </span>fetch<span class="_ _14"> </span>or<span class="_ _15"> </span>memory<span class="_ _15"> </span>stage<span class="_ _14"> </span>until<span class="_ _15"> </span>the<span class="_ _15"> </span>cache<span class="_ _14"> </span>can<span class="_ _15"> </span>perform<span class="_ _15"> </span>the<span class="_ _14"> </span>read</div><div class="t m5 x1d h26 y434 ff7 fs19 fc2 sc0 ls0 ws0">or<span class="_ _16"> </span>write<span class="_ _11"> </span>operation.<span class="_ _16"> </span>In<span class="_ _16"> </span>terms<span class="_ _11"> </span>of<span class="_ _16"> </span>our<span class="_ _16"> </span>pipeline<span class="_ _11"> </span>design,<span class="_ _16"> </span>this<span class="_ _16"> </span>can<span class="_ _16"> </span>be<span class="_ _11"> </span>implemented<span class="_ _16"> </span>by</div><div class="t m5 x1d h26 y435 ff7 fs19 fc2 sc0 ls0 ws0">adding<span class="_ _16"> </span>more<span class="_ _11"> </span>stall<span class="_ _16"> </span>conditions<span class="_ _16"> </span>to<span class="_ _11"> </span>the<span class="_ _16"> </span>pipeline<span class="_ _16"> </span>control<span class="_ _11"> </span>logic.<span class="_ _16"> </span>A<span class="_ _11"> </span>cache<span class="_ _16"> </span>miss<span class="_ _16"> </span>and<span class="_ _11"> </span>the</div><div class="t m5 x1d h26 y436 ff7 fs19 fc2 sc0 ls0 ws0">consequent<span class="_ _13"> </span>synchronization<span class="_ _13"> </span>with<span class="_ _13"> </span>the<span class="_ _13"> </span>pipeline<span class="_"> </span>is<span class="_ _13"> </span>handled<span class="_ _13"> </span>completely<span class="_ _13"> </span>by<span class="_ _13"> </span>hardware<span class="_ _1"></span>,</div><div class="t m5 x1d h26 y437 ff7 fs19 fc2 sc0 ls0 ws0">keeping<span class="_"> </span>the<span class="_"> </span>time<span class="_"> </span>required<span class="_"> </span>down<span class="_"> </span>to<span class="_"> </span>a<span class="_"> </span>small<span class="_"> </span>number<span class="_"> </span>of<span class="_"> </span>clock<span class="_"> </span>cycles<span class="_ _3"></span>.</div><div class="t m5 x29 h26 y438 ff7 fs19 fc2 sc0 ls0 ws0">In<span class="_ _15"> </span>some<span class="_ _15"> </span>cases<span class="_ _1"></span>,<span class="_ _21"> </span>the<span class="_ _15"> </span>memory<span class="_ _21"> </span>location<span class="_ _15"> </span>being<span class="_ _15"> </span>referenced<span class="_ _15"> </span>is<span class="_ _15"> </span>actually<span class="_ _15"> </span>stored<span class="_ _15"> </span>in</div><div class="t m5 x1d h26 y439 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _16"> </span>disk<span class="_ _14"> </span>or<span class="_ _16"> </span>nonvolatile<span class="_ _14"> </span>memory<span class="_ _3"></span>.<span class="_ _16"> </span>When<span class="_ _16"> </span>this<span class="_ _14"> </span>occurs<span class="_ _1"></span>,<span class="_ _14"> </span>the<span class="_ _14"> </span>hardware<span class="_ _14"> </span>signals<span class="_ _16"> </span>a<span class="_ _14"> </span><span class="ffa">page</span></div><div class="t m5 x1d h26 y43a ffa fs19 fc2 sc0 ls0 ws0">fault<span class="_ _11"> </span><span class="ff7">exception.<span class="_"> </span>Like<span class="_"> </span>other<span class="_"> </span>exceptions<span class="_ _3"></span>,<span class="_"> </span>this<span class="_"> </span>will<span class="_"> </span>cause<span class="_"> </span>the<span class="_"> </span>processor<span class="_"> </span>to<span class="_ _13"> </span>invoke<span class="_"> </span>the</span></div><div class="t m5 x1d h26 y43b ff7 fs19 fc2 sc0 ls0 ws0">operating<span class="_ _11"> </span>system’s<span class="_ _16"> </span>exception<span class="_ _11"> </span>handler<span class="_ _16"> </span>code<span class="_ _1"></span>.<span class="_ _16"> </span>T<span class="_ _1"></span>his<span class="_ _16"> </span>code<span class="_ _11"> </span>will<span class="_ _16"> </span>then<span class="_ _11"> </span>set<span class="_ _16"> </span>up<span class="_ _16"> </span>a<span class="_ _11"> </span>transfer</div><div class="t m5 x1d h26 y43c ff7 fs19 fc2 sc0 ls0 ws0">from<span class="_ _13"> </span>the<span class="_"> </span>disk<span class="_ _13"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>main<span class="_"> </span>memory<span class="_ _7"></span>.<span class="_ _13"> </span>Once<span class="_"> </span>this<span class="_ _13"> </span>completes<span class="_ _1"></span>,<span class="_ _13"> </span>the<span class="_"> </span>operating<span class="_ _13"> </span>system<span class="_ _13"> </span>will</div><div class="t m5 x1d h26 y43d ff7 fs19 fc2 sc0 ls0 ws0">return<span class="_ _13"> </span>to<span class="_ _13"> </span>the<span class="_ _6"> </span>original<span class="_ _13"> </span>program,<span class="_ _13"> </span>where<span class="_ _13"> </span>the<span class="_ _13"> </span>instruction<span class="_ _13"> </span>causing<span class="_ _6"> </span>the<span class="_ _13"> </span>page<span class="_ _13"> </span>fault<span class="_ _13"> </span>will<span class="_ _13"> </span>be</div><div class="t m5 x1d h26 y43e ff7 fs19 fc2 sc0 ls0 ws0">re-executed.<span class="_ _6"> </span>T<span class="_ _0"></span>his<span class="_ _6"> </span>time<span class="_ _0"></span>,<span class="_ _6"> </span>the<span class="_ _13"> </span>memory<span class="_ _a"> </span>reference<span class="_ _13"> </span>will<span class="_ _a"> </span>succeed,<span class="_ _13"> </span>although<span class="_ _6"> </span>it<span class="_ _6"> </span>might<span class="_ _6"> </span>cause</div><div class="t m5 x1d h26 y43f ff7 fs19 fc2 sc0 ls0 ws0">a<span class="_ _6"> </span>cache<span class="_ _13"> </span>miss<span class="_ _1"></span>.<span class="_ _6"> </span>Having<span class="_ _13"> </span>the<span class="_ _6"> </span>hardware<span class="_ _13"> </span>invoke<span class="_ _6"> </span>an<span class="_ _13"> </span>operating<span class="_ _6"> </span>system<span class="_ _13"> </span>routine<span class="_ _1"></span>,<span class="_ _13"> </span>which<span class="_ _6"> </span>then</div><div class="t m5 x1d h26 y440 ff7 fs19 fc2 sc0 ls0 ws0">returns<span class="_ _16"> </span>control<span class="_ _16"> </span>back<span class="_ _11"> </span>to<span class="_ _16"> </span>the<span class="_ _16"> </span>hardware<span class="_ _0"></span>,<span class="_ _16"> </span>allows<span class="_ _16"> </span>the<span class="_ _16"> </span>hardware<span class="_ _16"> </span>and<span class="_ _11"> </span>system<span class="_ _16"> </span>software</div><div class="t m5 x1d h26 y2044 ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_ _14"> </span>cooperate<span class="_ _15"> </span>in<span class="_ _15"> </span>the<span class="_ _15"> </span>handling<span class="_ _14"> </span>of<span class="_ _15"> </span>page<span class="_ _15"> </span>faults<span class="_ _1"></span>.<span class="_ _14"> </span>Since<span class="_ _15"> </span>accessing<span class="_ _15"> </span>a<span class="_ _15"> </span>disk<span class="_ _14"> </span>can<span class="_ _15"> </span>require</div><div class="t m5 x1d h26 y2045 ff7 fs19 fc2 sc0 ls0 ws0">millions<span class="_ _16"> </span>of<span class="_ _11"> </span>clock<span class="_ _16"> </span>cycles<span class="_ _3"></span>,<span class="_ _16"> </span>the<span class="_ _16"> </span>several<span class="_ _16"> </span>thousand<span class="_ _16"> </span>c<span class="_ _0"></span>ycles<span class="_ _16"> </span>of<span class="_ _11"> </span>processing<span class="_ _16"> </span>performed<span class="_ _16"> </span>by</div><div class="t m5 x1d h26 y2046 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>OS<span class="_"> </span>page<span class="_"> </span>fault<span class="_"> </span>handler<span class="_"> </span>has<span class="_"> </span>little<span class="_"> </span>impact<span class="_"> </span>on<span class="_"> </span>performance<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y2047 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>rom<span class="_ _15"> </span>the<span class="_ _14"> </span>perspective<span class="_ _15"> </span>of<span class="_ _14"> </span>the<span class="_ _15"> </span>processor,<span class="_ _14"> </span>the<span class="_ _15"> </span>combination<span class="_ _14"> </span>of<span class="_ _15"> </span>stalling<span class="_ _14"> </span>to<span class="_ _15"> </span>han-</div><div class="t m5 x1d h26 y2048 ff7 fs19 fc2 sc0 ls0 ws0">dle<span class="_ _11"> </span>short-duration<span class="_ _11"> </span>cache<span class="_ _16"> </span>misses<span class="_"> </span>and<span class="_ _16"> </span>exception<span class="_ _11"> </span>handling<span class="_ _11"> </span>to<span class="_ _11"> </span>handle<span class="_ _16"> </span>long-duration</div><div class="t m5 x1d h26 y2049 ff7 fs19 fc2 sc0 ls0 ws0">page<span class="_"> </span>faults<span class="_ _11"> </span>takes<span class="_ _11"> </span>care<span class="_ _11"> </span>of<span class="_ _11"> </span>any<span class="_ _11"> </span>unpredictability<span class="_ _11"> </span>in<span class="_ _11"> </span>memory<span class="_ _11"> </span>access<span class="_ _11"> </span>times<span class="_ _11"> </span>due<span class="_ _11"> </span>to<span class="_ _11"> </span>the</div><div class="t m5 x1d h26 y204a ff7 fs19 fc2 sc0 ls0 ws0">structure<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>memory<span class="_"> </span>hierarchy<span class="_ _3"></span>.</div><div class="t m5 x1d h3b y2269 fff fs24 fc6 sc0 ls0 ws0">4.6<span class="_ _17"> </span><span class="ffe fs18">Summar<span class="_ _2"></span>y</span></div><div class="t m5 x1d h26 y24e1 ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _14"> </span>have<span class="_ _15"> </span>seen<span class="_ _14"> </span>that<span class="_ _15"> </span>the<span class="_ _14"> </span>instruction<span class="_ _14"> </span>set<span class="_ _15"> </span>architecture<span class="_ _1"></span>,<span class="_ _21"> </span>or<span class="_ _14"> </span>ISA,<span class="_ _15"> </span>provides<span class="_ _15"> </span>a<span class="_ _14"> </span>layer<span class="_ _15"> </span>of</div><div class="t m5 x1d h26 y4657 ff7 fs19 fc1 sc0 ls0 ws0">abstraction<span class="_ _6"> </span>between<span class="_ _6"> </span>the<span class="_ _6"> </span>behavior<span class="_ _6"> </span>of<span class="_ _6"> </span>a<span class="_ _6"> </span>processor<span class="_ _1"></span>—in<span class="_ _13"> </span>terms<span class="_ _a"> </span>of<span class="_ _6"> </span>the<span class="_ _6"> </span>set<span class="_ _6"> </span>of<span class="_ _6"> </span>instructions</div><div class="t m5 x1d h26 y4658 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _11"> </span>their<span class="_ _16"> </span>encodings—and<span class="_ _11"> </span>how<span class="_ _16"> </span>the<span class="_ _11"> </span>processor<span class="_ _16"> </span>is<span class="_ _11"> </span>implemented.<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span>ISA<span class="_ _11"> </span>provides</div><div class="t m5 x1d h26 y4659 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_ _14"> </span>very<span class="_ _14"> </span>sequential<span class="_ _15"> </span>view<span class="_ _14"> </span>of<span class="_ _14"> </span>program<span class="_ _15"> </span>execution,<span class="_ _15"> </span>with<span class="_ _14"> </span>one<span class="_ _15"> </span>instruction<span class="_ _14"> </span>executed<span class="_ _14"> </span>to</div><div class="t m5 x1d h26 y465a ff7 fs19 fc1 sc0 ls0 ws0">completion<span class="_"> </span>before<span class="_"> </span>the<span class="_"> </span>next<span class="_"> </span>one<span class="_"> </span>begins<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
