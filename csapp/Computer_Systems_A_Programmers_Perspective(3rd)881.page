<div id="pf371" class="pf w2 h11" data-page-no="371"><div class="pc pc371 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg371.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">880<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>9<span class="_ _3d"> </span>Virtual<span class="_ _10"> </span>Memory</span></div><div class="t m5 x1f h2d ye7 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">#include<span class="_ _1f"> </span>&quot;csapp.h&quot;</span></div><div class="t m5 x1f h2e yc4d ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x1f h2e y5c27 ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x4f h2d yecb ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>main()</div><div class="t m5 x1f h2d yecc ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x1f h2d yecd ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _20"> </span><span class="ffd fs1e fc2">int<span class="_ _e"> </span>*array,<span class="_ _1f"> </span>i,<span class="_ _1f"> </span>n;</span></div><div class="t m5 x1f h2e yece ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 x1f h2e y69d9 ff6 fs20 fc6 sc0 ls0 ws0">7</div><div class="t m5 x33 h2d yecf ffd fs1e fc2 sc0 ls0 ws0">scanf(&quot;%d&quot;,<span class="_ _e"> </span>&amp;n);</div><div class="t m5 x1f h2d yed0 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _20"> </span><span class="ffd fs1e fc2">array<span class="_ _e"> </span>=<span class="_ _1f"> </span>(int<span class="_ _1f"> </span>*)Malloc(n<span class="_ _e"> </span>*<span class="_ _1f"> </span>sizeof(int));</span></div><div class="t m5 x1f h2e y20fe ff6 fs20 fc6 sc0 ls0 ws0">9</div><div class="t m5 x33 h2d y1a10 ffd fs1e fc2 sc0 ls33 ws0">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>i=0<span class="_ _41"></span>;i&lt;n<span class="_ _41"></span>;<span class="ls0">i++)</span></div><div class="t m5 x1b0 h2d yed3 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _70"> </span><span class="ffd fs1e fc2">scanf(&quot;%d&quot;,<span class="_ _e"> </span>&amp;array[i]);</span></div><div class="t m5 x1b0 h2d yed4 ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _20"> </span><span class="ffd fs1e fc2">free(array);</span></div><div class="t m5 x1b0 h2d y462 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _20"> </span><span class="ffd fs1e fc2">exit(0);</span></div><div class="t m5 x1b0 h2d y26dd ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x29 h26 y7234 ff7 fs19 fc2 sc0 ls0 ws0">Dynamic<span class="_ _15"> </span>memory<span class="_ _15"> </span>allocation<span class="_ _15"> </span>is<span class="_ _15"> </span>a<span class="_ _15"> </span>useful<span class="_ _15"> </span>and<span class="_ _15"> </span>important<span class="_ _15"> </span>programming<span class="_ _15"> </span>tech-</div><div class="t m5 x1d h26 y7235 ff7 fs19 fc2 sc0 ls0 ws0">nique<span class="_ _1"></span>.<span class="_"> </span>However,<span class="_"> </span>in<span class="_"> </span>order<span class="_ _13"> </span>to<span class="_"> </span>use<span class="_"> </span>allocators<span class="_"> </span>correctly<span class="_"> </span>and<span class="_ _13"> </span>efÔ¨Åciently<span class="_ _3"></span>,<span class="_"> </span>programmers</div><div class="t m5 x1d h26 y7236 ff7 fs19 fc2 sc0 ls0 ws0">need<span class="_ _6"> </span>to<span class="_ _13"> </span>have<span class="_ _6"> </span>an<span class="_ _13"> </span>understanding<span class="_ _6"> </span>of<span class="_ _6"> </span>how<span class="_ _13"> </span>they<span class="_ _6"> </span>work.<span class="_ _13"> </span>W<span class="_ _3"></span>e<span class="_ _6"> </span>will<span class="_ _13"> </span>discuss<span class="_ _6"> </span>some<span class="_ _13"> </span>of<span class="_ _6"> </span>the<span class="_ _6"> </span>grue-</div><div class="t m5 x1d h26 y7237 ff7 fs19 fc2 sc0 ls0 ws0">some<span class="_"> </span>errors<span class="_"> </span>that<span class="_"> </span>can<span class="_"> </span>result<span class="_"> </span>from<span class="_"> </span>the<span class="_"> </span>improper<span class="_"> </span>use<span class="_"> </span>of<span class="_"> </span>allocators<span class="_"> </span>in<span class="_"> </span>Section<span class="_"> </span>9.11.</div><div class="t m5 x1d h41 y7238 ffe fs29 fc2 sc0 ls0 ws0">9.9.3<span class="_ _48"> </span><span class="fs19">Allocator<span class="_"> </span>Requirements<span class="_"> </span>and<span class="_"> </span>Goals</span></div><div class="t m5 x1d h26 y7239 ff7 fs19 fc2 sc0 ls0 ws0">Explicit<span class="_"> </span>allocators<span class="_"> </span>must<span class="_"> </span>operate<span class="_"> </span>within<span class="_"> </span>some<span class="_"> </span>rather<span class="_"> </span>stringent<span class="_"> </span>constraints:</div><div class="t m5 x75 h26 y723a ffa fs19 fc2 sc0 ls0 ws0">Handling<span class="_ _13"> </span>arbitrary<span class="_ _13"> </span>request<span class="_ _13"> </span>sequences<span class="_ _1"></span>.<span class="_ _f"> </span><span class="ff7">An<span class="_ _13"> </span>application<span class="_ _13"> </span>can<span class="_ _13"> </span>make<span class="_"> </span>an<span class="_ _13"> </span>arbitrary<span class="_ _13"> </span>se-</span></div><div class="t m5 xcd h26 y723b ff7 fs19 fc2 sc0 ls0 ws0">quence<span class="_ _11"> </span>of<span class="_ _16"> </span>allocate<span class="_ _11"> </span>and<span class="_ _16"> </span>free<span class="_ _16"> </span>requests<span class="_ _3"></span>,<span class="_ _16"> </span>subject<span class="_ _16"> </span>to<span class="_ _11"> </span>the<span class="_ _16"> </span>constraint<span class="_ _11"> </span>that<span class="_ _16"> </span>each</div><div class="t m5 xcd h26 y723c ff7 fs19 fc2 sc0 ls0 ws0">free<span class="_ _6"> </span>request<span class="_ _13"> </span>must<span class="_ _a"> </span>correspond<span class="_ _13"> </span>to<span class="_ _a"> </span>a<span class="_ _13"> </span>currently<span class="_ _6"> </span>allocated<span class="_ _6"> </span>block<span class="_ _13"> </span>obtained<span class="_ _a"> </span>from</div><div class="t m5 xcd h26 y723d ff7 fs19 fc2 sc0 ls0 ws0">a<span class="_ _13"> </span>previous<span class="_ _13"> </span>allocate<span class="_"> </span>request.<span class="_ _13"> </span>T<span class="_ _1"></span>hus<span class="_ _1"></span>,<span class="_"> </span>the<span class="_ _13"> </span>allocator<span class="_ _13"> </span>cannot<span class="_ _13"> </span>make<span class="_"> </span>any<span class="_ _13"> </span>assump-</div><div class="t m5 xcd h26 y723e ff7 fs19 fc2 sc0 ls0 ws0">tions<span class="_ _11"> </span>about<span class="_ _16"> </span>the<span class="_ _16"> </span>ordering<span class="_ _11"> </span>of<span class="_ _16"> </span>allocate<span class="_ _11"> </span>and<span class="_ _16"> </span>free<span class="_ _11"> </span>requests<span class="_ _1"></span>.<span class="_ _16"> </span>F<span class="_ _1"></span>or<span class="_ _16"> </span>example<span class="_ _1"></span>,<span class="_ _16"> </span>the</div><div class="t m5 xcd h26 y723f ff7 fs19 fc2 sc0 ls0 ws0">allocator<span class="_ _11"> </span>cannot<span class="_ _11"> </span>assume<span class="_ _11"> </span>that<span class="_ _11"> </span>all<span class="_ _11"> </span>allocate<span class="_ _16"> </span>requests<span class="_"> </span>are<span class="_ _11"> </span>accompanied<span class="_ _16"> </span>by<span class="_"> </span>a</div><div class="t m5 xcd h26 y7240 ff7 fs19 fc2 sc0 ls0 ws0">matching<span class="_ _14"> </span>free<span class="_ _15"> </span>request,<span class="_ _15"> </span>or<span class="_ _14"> </span>that<span class="_ _15"> </span>matching<span class="_ _14"> </span>allocate<span class="_ _15"> </span>and<span class="_ _14"> </span>free<span class="_ _15"> </span>requests<span class="_ _14"> </span>are</div><div class="t m5 xcd h26 y7241 ff7 fs19 fc2 sc0 ls0 ws0">nested.</div><div class="t m5 x75 h26 y7242 ffa fs19 fc2 sc0 ls0 ws0">Making<span class="_ _11"> </span>immediate<span class="_ _11"> </span>responses<span class="_ _16"> </span>to<span class="_ _11"> </span>requests<span class="_ _1"></span>.<span class="_ _21"> </span><span class="ff7">T<span class="_ _0"></span>he<span class="_ _11"> </span>allocator<span class="_ _11"> </span>must<span class="_ _16"> </span>respond<span class="_ _11"> </span>immedi-</span></div><div class="t m5 xcd h26 y7243 ff7 fs19 fc2 sc0 ls0 ws0">ately<span class="_"> </span>to<span class="_ _13"> </span>allocate<span class="_"> </span>requests<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _1"></span>hus<span class="_ _1"></span>,<span class="_"> </span>the<span class="_"> </span>allocator<span class="_"> </span>is<span class="_ _13"> </span>not<span class="_"> </span>allowed<span class="_"> </span>to<span class="_"> </span>reorder<span class="_ _13"> </span>or</div><div class="t m5 xcd h26 y7244 ff7 fs19 fc2 sc0 ls0 ws0">buffer<span class="_"> </span>requests<span class="_"> </span>in<span class="_"> </span>order<span class="_"> </span>to<span class="_"> </span>improve<span class="_"> </span>performance<span class="_ _1"></span>.</div><div class="t m5 x75 h26 y7245 ffa fs19 fc2 sc0 ls0 ws0">Using<span class="_ _13"> </span>only<span class="_ _6"> </span>the<span class="_ _13"> </span>heap<span class="_ _1"></span>.<span class="_ _21"> </span><span class="ff7">In<span class="_ _13"> </span>order<span class="_ _13"> </span>for<span class="_ _6"> </span>the<span class="_ _13"> </span>allocator<span class="_ _13"> </span>to<span class="_ _6"> </span>be<span class="_ _13"> </span>scalable<span class="_ _0"></span>,<span class="_ _13"> </span>any<span class="_ _13"> </span>nonscalar<span class="_ _6"> </span>data</span></div><div class="t m5 xcd h26 y7246 ff7 fs19 fc2 sc0 ls0 ws0">structures<span class="_"> </span>used<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span>allocator<span class="_"> </span>must<span class="_"> </span>be<span class="_"> </span>stored<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>heap<span class="_"> </span>itself<span class="_ _1"></span>.</div><div class="t m5 x75 h26 y7247 ffa fs19 fc2 sc0 ls0 ws0">Aligning<span class="_ _15"> </span>blocks<span class="_ _15"> </span>(alignment<span class="_ _21"> </span>requirement).<span class="_ _21"> </span><span class="ff7">The<span class="_ _15"> </span>allocator<span class="_ _15"> </span>must<span class="_ _21"> </span>align<span class="_ _15"> </span>blocks<span class="_ _21"> </span>in</span></div><div class="t m5 xcd h26 y7248 ff7 fs19 fc2 sc0 ls0 ws0">such<span class="_"> </span>a<span class="_"> </span>way<span class="_"> </span>that<span class="_"> </span>they<span class="_"> </span>can<span class="_"> </span>hold<span class="_"> </span>any<span class="_"> </span>type<span class="_"> </span>of<span class="_"> </span>data<span class="_"> </span>object.</div><div class="t m5 x75 h26 y7249 ffa fs19 fc2 sc0 ls0 ws0">Not<span class="_"> </span>modifying<span class="_ _13"> </span>allocated<span class="_"> </span>bloc<span class="_ _1"></span>ks<span class="_ _0"></span>.<span class="_ _21"> </span><span class="ff7">Allocators<span class="_"> </span>can<span class="_ _13"> </span>only<span class="_"> </span>manipulate<span class="_ _13"> </span>or<span class="_"> </span>change<span class="_ _13"> </span>free</span></div><div class="t m5 xcd h26 y724a ff7 fs19 fc2 sc0 ls0 ws0">blocks<span class="_ _1"></span>.<span class="_ _21"> </span>In<span class="_ _f"> </span>particular,<span class="_ _e"> </span>they<span class="_ _21"> </span>are<span class="_ _21"> </span>not<span class="_ _f"> </span>allowed<span class="_ _f"> </span>to<span class="_ _f"> </span>modify<span class="_ _21"> </span>or<span class="_ _f"> </span>move<span class="_ _f"> </span>blocks</div><div class="t m5 xcd h26 y724b ff7 fs19 fc2 sc0 ls0 ws0">once<span class="_ _13"> </span>they<span class="_ _13"> </span>are<span class="_ _13"> </span>allocated.<span class="_ _13"> </span>T<span class="_ _3"></span>hus<span class="_ _0"></span>,<span class="_ _13"> </span>techniques<span class="_ _13"> </span>such<span class="_ _13"> </span>as<span class="_ _13"> </span>compaction<span class="_ _13"> </span>of<span class="_ _6"> </span>allocated</div><div class="t m5 xcd h26 y724c ff7 fs19 fc2 sc0 ls0 ws0">blocks<span class="_"> </span>are<span class="_"> </span>not<span class="_"> </span>permitted.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
