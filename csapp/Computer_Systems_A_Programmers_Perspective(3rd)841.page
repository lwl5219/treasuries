<div id="pf349" class="pf w2 h11" data-page-no="349"><div class="pc pc349 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg349.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">840<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>9<span class="_ _3d"> </span>Virtual<span class="_ _10"> </span>Memory</span></div><div class="t m5 x14 h2f ye7 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>9.2</div><div class="t m5 x14 h2f y58a ffe fs16 fc1 sc0 ls0 ws0">A<span class="_"> </span>system<span class="_"> </span>that<span class="_"> </span>uses<span class="_"> </span>virtual</div><div class="t m5 x14 h2f y58b ffe fs16 fc1 sc0 ls0 ws0">addressing.</div><div class="t m5 x13e h3f y6c02 ffa6 fs27 fc1 sc0 ls0 ws0">Main memory</div><div class="t m5 xaf h3f y6c03 ffa6 fs27 fc1 sc0 ls0 ws0">0:</div><div class="t m5 xaf h3f y6c04 ffa6 fs27 fc1 sc0 ls0 ws0">1:</div><div class="t m5 xaf h3f y6c05 ffa6 fs27 fc1 sc0 ls0 ws0">2:</div><div class="t m5 xaf h3f y6c06 ffa6 fs27 fc1 sc0 ls0 ws0">3:</div><div class="t m5 xaf h3f y6c07 ffa6 fs27 fc1 sc0 ls0 ws0">4:</div><div class="t m5 xaf h3f y6c08 ffa6 fs27 fc1 sc0 ls0 ws0">5:</div><div class="t m5 xaf h3f y6c09 ffa6 fs27 fc1 sc0 ls0 ws0">6:</div><div class="t m5 xaf h3f y6c0a ffa6 fs27 fc1 sc0 ls0 ws0">7:</div><div class="t m5 x93 h3f y6c0b ffa6 fs27 fc1 sc0 ls0 ws0">Physical</div><div class="t m5 x3a h3f y6c0c ffa6 fs27 fc1 sc0 ls0 ws0">address</div><div class="t m5 x237 h3f y6c0d ffa6 fs27 fc1 sc0 ls0 ws0">(P<span class="_ _1"></span>A)</div><div class="t m5 x1ed h3f y6c0b ffa6 fs27 fc1 sc0 ls0 ws0">Virtual</div><div class="t m5 xe5 h3f y6c0c ffa6 fs27 fc1 sc0 ls0 ws0">address</div><div class="t m5 x49 h3f y6c0d ffa6 fs27 fc1 sc0 ls0 ws0">(V<span class="_ _1"></span>A)</div><div class="t m5 x130 h3f y6c0e ffa8 fs27 fc1 sc0 ls0 ws0">Address</div><div class="t m5 xd5 h3f y6c0f ffa8 fs27 fc1 sc0 ls0 ws0">translation</div><div class="t m5 x150 h3f y6c10 ffa6 fs27 fc1 sc0 ls0 ws0">CPU</div><div class="t m5 xe0 h3f y6c11 ffa6 fs27 fc1 sc0 ls0 ws0">CPU chip</div><div class="t m5 x92 h3f y6c10 ffa6 fs27 fc1 sc0 ls0 ws0">MMU</div><div class="t m5 x49 h40 y6c12 ffa7 fs28 fc1 sc0 ls0 ws0">4100<span class="_ _159"> </span>4</div><div class="t m5 x171 h3f y6c13 ffa8 fs27 fc1 sc0 ls0 ws0">M<span class="_ _5"></span><span class="ff24"><span class="ffa6">1:</span></span></div><div class="t m5 x1c9 h3f y6c14 ffa6 fs27 fc1 sc0 ls0 ws0">Data word</div><div class="t m8 x16b h3f y6c15 ffa6 fs27 fc1 sc0 ls0 ws0">. . .</div><div class="t m5 x29 h26 y6c16 ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _1"></span>ith<span class="_"> </span>virtual<span class="_"> </span>addressing,<span class="_"> </span>the<span class="_"> </span>CPU<span class="_ _13"> </span>accesses<span class="_"> </span>main<span class="_"> </span>memory<span class="_"> </span>by<span class="_"> </span>generating<span class="_"> </span>a<span class="_"> </span><span class="ffa">vir<span class="_ _3"></span>-</span></div><div class="t m5 x1d h26 y6c17 ffa fs19 fc1 sc0 ls0 ws0">tual<span class="_ _11"> </span>address<span class="_ _11"> </span>(V<span class="_ _7"></span>A)<span class="_ _1"></span><span class="ff7">,<span class="_ _11"> </span>which<span class="_ _11"> </span>is<span class="_ _11"> </span>converted<span class="_ _11"> </span>to<span class="_ _11"> </span>the<span class="_ _11"> </span>appropriate<span class="_ _11"> </span>physical<span class="_ _11"> </span>address<span class="_ _11"> </span>before</span></div><div class="t m5 x1d h26 y6c18 ff7 fs19 fc1 sc0 ls0 ws0">being<span class="_"> </span>sent<span class="_"> </span>to<span class="_ _13"> </span>main<span class="_"> </span>memory<span class="_ _3"></span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>task<span class="_"> </span>of<span class="_"> </span>converting<span class="_ _13"> </span>a<span class="_"> </span>virtual<span class="_"> </span>address<span class="_"> </span>to<span class="_ _13"> </span>a<span class="_"> </span>physical</div><div class="t m5 x1d h26 y6c19 ff7 fs19 fc1 sc0 ls0 ws0">one<span class="_"> </span>is<span class="_"> </span>known<span class="_"> </span>as<span class="_"> </span><span class="ffa">address<span class="_"> </span>translation</span>.<span class="_"> </span>Like<span class="_"> </span>exception<span class="_"> </span>handling<span class="_ _1"></span>,<span class="_"> </span>address<span class="_"> </span>translation</div><div class="t m5 x1d h26 y6c1a ff7 fs19 fc1 sc0 ls0 ws0">requires<span class="_ _15"> </span>close<span class="_ _15"> </span>cooperation<span class="_ _15"> </span>between<span class="_ _15"> </span>the<span class="_ _15"> </span>CPU<span class="_ _15"> </span>hardware<span class="_ _15"> </span>and<span class="_ _15"> </span>the<span class="_ _15"> </span>operating<span class="_ _15"> </span>sys-</div><div class="t m5 x1d h26 y6c1b ff7 fs19 fc1 sc0 ls0 ws0">tem.<span class="_ _11"> </span>Dedicated<span class="_ _11"> </span>hardware<span class="_ _16"> </span>on<span class="_ _11"> </span>the<span class="_ _11"> </span>CPU<span class="_ _16"> </span>chip<span class="_"> </span>called<span class="_ _16"> </span>the<span class="_ _11"> </span><span class="ffa">memory<span class="_ _11"> </span>management<span class="_ _16"> </span>unit</span></div><div class="t m5 x1d h26 y6c1c ffa fs19 fc1 sc0 ls0 ws0">(MMU)<span class="_ _6"> </span><span class="ff7">translates<span class="_ _13"> </span>virtual<span class="_"> </span>addresses<span class="_ _13"> </span>on<span class="_ _13"> </span>the<span class="_"> </span>ﬂy<span class="_ _7"></span>,<span class="_"> </span>using<span class="_ _13"> </span>a<span class="_ _13"> </span>lookup<span class="_"> </span>table<span class="_ _13"> </span>stored<span class="_ _13"> </span>in<span class="_"> </span>main</span></div><div class="t m5 x1d h26 y6c1d ff7 fs19 fc1 sc0 ls0 ws0">memory<span class="_"> </span>whose<span class="_"> </span>contents<span class="_"> </span>are<span class="_"> </span>managed<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span>operating<span class="_"> </span>system.</div><div class="t m5 x1d h3b y6c1e fff fs24 fc6 sc0 ls0 ws0">9.2<span class="_ _17"> </span><span class="ffe fs18">Address<span class="_"> </span>Spaces</span></div><div class="t m5 x1d h26 y6c1f ff7 fs19 fc1 sc0 ls0 ws0">An<span class="_"> </span><span class="ffa">address<span class="_"> </span>space<span class="_"> </span></span>is<span class="_"> </span>an<span class="_"> </span>ordered<span class="_"> </span>set<span class="_"> </span>of<span class="_"> </span>nonnegative<span class="_"> </span>integer<span class="_"> </span>addresses</div><div class="t m5 x187 h46 y6c20 ff12 fs19 fc1 sc0 ls0 ws0">{<span class="ff7">0<span class="ff11">,<span class="_ _10"> </span></span>1<span class="_ _3"></span><span class="ff11">,<span class="_ _10"> </span><span class="ff7">2</span><span class="ls42">,...<span class="_ _80"></span><span class="ff12 ls0">}</span></span></span></span></div><div class="t m5 x1d h26 y6c21 ff7 fs19 fc1 sc0 ls0 ws0">If<span class="_"> </span>the<span class="_"> </span>integers<span class="_ _11"> </span>in<span class="_"> </span>the<span class="_ _11"> </span>address<span class="_"> </span>space<span class="_ _11"> </span>are<span class="_"> </span>consecutive,<span class="_"> </span>then<span class="_"> </span>we<span class="_"> </span>say<span class="_ _11"> </span>that<span class="_"> </span>it<span class="_ _11"> </span>is<span class="_"> </span>a<span class="_ _11"> </span><span class="ffa">linear</span></div><div class="t m5 x1d h26 y6c22 ffa fs19 fc1 sc0 ls0 ws0">address<span class="_ _16"> </span>space<span class="ff7">.<span class="_ _14"> </span>T<span class="_ _3"></span>o<span class="_ _16"> </span>simplify<span class="_ _14"> </span>our<span class="_ _16"> </span>discussion,<span class="_ _14"> </span>we<span class="_ _14"> </span>will<span class="_ _16"> </span>always<span class="_ _14"> </span>assume<span class="_ _16"> </span>linear<span class="_ _14"> </span>address</span></div><div class="t m5 x1d h26 y6c23 ff7 fs19 fc1 sc0 ls0 ws0">spaces<span class="_ _1"></span>.<span class="_ _13"> </span>In<span class="_ _6"> </span>a<span class="_ _13"> </span>system<span class="_ _6"> </span>with<span class="_ _13"> </span>virtual<span class="_ _6"> </span>memory<span class="_ _3"></span>,<span class="_ _13"> </span>the<span class="_ _6"> </span>CPU<span class="_ _13"> </span>generates<span class="_ _6"> </span>virtual<span class="_ _13"> </span>addresses<span class="_ _6"> </span>from</div><div class="t m5 x1d h46 y6c24 ff7 fs19 fc1 sc0 ls0 ws0">an<span class="_"> </span>address<span class="_"> </span>space<span class="_"> </span>of<span class="_"> </span><span class="ff11">N<span class="_"> </span><span class="ff12">=<span class="_ _13"></span></span></span>2</div><div class="t m5 x16d h50 y6c25 ff11 fs25 fc1 sc0 ls0 ws0">n</div><div class="t m5 x241 h26 y6c26 ff7 fs19 fc1 sc0 ls0 ws0">addresses<span class="_"> </span>called<span class="_"> </span>the<span class="_"> </span><span class="ffa">virtual<span class="_"> </span>address<span class="_"> </span>space</span>:</div><div class="t m5 x15 h46 y6c27 ff12 fs19 fc1 sc0 ls0 ws0">{<span class="ff7">0<span class="ff11">,<span class="_ _10"> </span></span>1<span class="_ _3"></span><span class="ff11">,<span class="_ _10"> </span><span class="ff7">2</span><span class="ls42">,...,N<span class="_ _be"></span></span><span class="ff12">−<span class="_ _10"> </span><span class="ff7">1<span class="_ _1"></span><span class="ff12">}</span></span></span></span></span></div><div class="t m5 x29 h26 y6c28 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _16"> </span>size<span class="_ _16"> </span>of<span class="_ _11"> </span>an<span class="_ _16"> </span>address<span class="_ _11"> </span>space<span class="_ _16"> </span>is<span class="_ _16"> </span>characterized<span class="_ _11"> </span>by<span class="_ _16"> </span>the<span class="_ _11"> </span>number<span class="_ _16"> </span>of<span class="_ _16"> </span>bits<span class="_ _11"> </span>that<span class="_ _16"> </span>are</div><div class="t m5 x1d h26 y6c29 ff7 fs19 fc1 sc0 ls0 ws0">needed<span class="_ _21"> </span>to<span class="_ _21"> </span>represent<span class="_ _21"> </span>the<span class="_ _21"> </span>largest<span class="_ _f"> </span>address<span class="_ _1"></span>.<span class="_ _21"> </span>F<span class="_ _1"></span>or<span class="_ _21"> </span>example,<span class="_ _21"> </span>a<span class="_ _f"> </span>virtual<span class="_ _21"> </span>address<span class="_ _21"> </span>space</div><div class="t m5 x1d h46 y6c2a ff7 fs19 fc1 sc0 ls0 ws0">with<span class="_"> </span><span class="ff11">N<span class="_"> </span><span class="ff12">=<span class="_ _10"> </span></span></span>2</div><div class="t m5 x1a8 h50 y6c2b ff11 fs25 fc1 sc0 ls0 ws0">n</div><div class="t m5 x129 h26 y6c2c ff7 fs19 fc1 sc0 ls0 ws0">addresses<span class="_"> </span>is<span class="_ _11"> </span>called<span class="_ _11"> </span>an<span class="_ _11"> </span><span class="ff11">n</span>-bit<span class="_ _11"> </span>address<span class="_ _11"> </span>space.<span class="_"> </span>Modern<span class="_"> </span>systems<span class="_ _11"> </span>typically</div><div class="t m5 x1d h26 y6c2d ff7 fs19 fc1 sc0 ls0 ws0">support<span class="_"> </span>either<span class="_"> </span>32-bit<span class="_"> </span>or<span class="_"> </span>64-bit<span class="_"> </span>virtual<span class="_"> </span>address<span class="_"> </span>spaces<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y6c2e ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_ _13"> </span>system<span class="_"> </span>also<span class="_ _13"> </span>has<span class="_ _13"> </span>a<span class="_"> </span><span class="ffa">physical<span class="_ _13"> </span>address<span class="_"> </span>space<span class="_ _13"> </span></span>that<span class="_ _13"> </span>corresponds<span class="_"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ff11">M<span class="_"> </span></span>bytes<span class="_ _13"> </span>of</div><div class="t m5 x1d h26 y6c2f ff7 fs19 fc1 sc0 ls0 ws0">physical<span class="_"> </span>memory<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>system:</div><div class="t m5 xaa h46 y6c30 ff12 fs19 fc1 sc0 ls0 ws0">{<span class="ff7">0<span class="ff11">,<span class="_ _10"> </span></span>1<span class="_ _3"></span><span class="ff11">,<span class="_ _10"> </span><span class="ff7">2</span><span class="ls42">,...,M<span class="_ _5"></span></span><span class="ff12">−<span class="_ _10"> </span><span class="ff7">1<span class="_ _1"></span><span class="ff12">}</span></span></span></span></span></div><div class="t m5 x1d h26 y6c31 ff11 fs19 fc1 sc0 ls0 ws0">M<span class="_ _11"> </span><span class="ff7">is<span class="_ _13"> </span>not<span class="_ _13"> </span>required<span class="_ _13"> </span>to<span class="_ _13"> </span>be<span class="_ _13"> </span>a<span class="_ _13"> </span>power<span class="_ _13"> </span>of<span class="_ _13"> </span>2,<span class="_ _13"> </span>but<span class="_ _13"> </span>to<span class="_ _13"> </span>simplify<span class="_ _13"> </span>the<span class="_ _13"> </span>discussion,<span class="_ _13"> </span>we<span class="_ _13"> </span>will<span class="_ _13"> </span>assume</span></div><div class="t m5 x1d h46 y6c32 ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_"> </span><span class="ff11">M<span class="_ _16"> </span><span class="ff12">=<span class="_ _13"></span></span></span>2</div><div class="t m5 x1a8 h50 y1632 ff11 fs25 fc1 sc0 ls0 ws0">m</div><div class="t m5 x18e h26 y1db4 ff7 fs19 fc1 sc0 ls0 ws0">.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
