<div id="pf384" class="pf w2 h11" data-page-no="384"><div class="pc pc384 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg384.png"/><div class="t m5 x1c9 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>9.9<span class="_ _60"> </span>Dynamic<span class="_ _10"> </span>Memor<span class="_"> </span>y<span class="_ _10"> </span>Allocation<span class="_ _3e"> </span><span class="ffe fs1e">899</span></div><div class="t m5 x26 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">One<span class="_ _16"> </span>approach<span class="_ _14"> </span>is<span class="_ _16"> </span>to<span class="_ _14"> </span>maintain<span class="_ _16"> </span>the<span class="_ _16"> </span>list<span class="_ _14"> </span>in<span class="_ _16"> </span><span class="ffa">last-in<span class="_ _14"> </span>ﬁrst-out<span class="_ _15"> </span></span>(LIFO)<span class="_ _16"> </span>order<span class="_ _14"> </span>by<span class="_ _16"> </span>in-</div><div class="t m5 x17 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">serting<span class="_ _15"> </span>newly<span class="_ _21"> </span>freed<span class="_ _15"> </span>blocks<span class="_ _21"> </span>at<span class="_ _21"> </span>the<span class="_ _15"> </span>beginning<span class="_ _21"> </span>of<span class="_ _21"> </span>the<span class="_ _15"> </span>list.<span class="_ _21"> </span>With<span class="_ _14"> </span>a<span class="_ _21"> </span>LIFO<span class="_ _21"> </span>ordering</div><div class="t m5 x17 h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_ _f"> </span>a<span class="_ _e"> </span>ﬁrst-ﬁt<span class="_ _21"> </span>placement<span class="_ _e"> </span>polic<span class="_ _1"></span>y<span class="_ _3"></span>,<span class="_ _1f"> </span>the<span class="_ _f"> </span>allocator<span class="_ _f"> </span>inspects<span class="_ _e"> </span>the<span class="_ _21"> </span>most<span class="_ _e"> </span>recently<span class="_ _21"> </span>used</div><div class="t m5 x17 h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">blocks<span class="_ _f"> </span>ﬁrst.<span class="_ _e"> </span>In<span class="_ _21"> </span>this<span class="_ _e"> </span>case<span class="_ _1"></span>,<span class="_ _e"> </span>freeing<span class="_ _e"> </span>a<span class="_ _f"> </span>block<span class="_ _f"> </span>can<span class="_ _e"> </span>be<span class="_ _f"> </span>performed<span class="_ _f"> </span>in<span class="_ _e"> </span>constant<span class="_ _f"> </span>time<span class="_ _1"></span>.</div><div class="t m5 x17 h26 y2f8 ff7 fs19 fc2 sc0 ls0 ws0">If<span class="_ _15"> </span>boundary<span class="_ _21"> </span>tags<span class="_ _21"> </span>are<span class="_ _21"> </span>used,<span class="_ _f"> </span>then<span class="_ _21"> </span>coalescing<span class="_ _15"> </span>can<span class="_ _21"> </span>also<span class="_ _21"> </span>be<span class="_ _21"> </span>performed<span class="_ _15"> </span>in<span class="_ _21"> </span>constant</div><div class="t m5 x17 h26 y2f9 ff7 fs19 fc2 sc0 ls0 ws0">time<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y2fa ff7 fs19 fc2 sc0 ls0 ws0">Another<span class="_"> </span>approach<span class="_ _11"> </span>is<span class="_"> </span>to<span class="_ _11"> </span>maintain<span class="_"> </span>the<span class="_ _11"> </span>list<span class="_"> </span>in<span class="_ _11"> </span><span class="ffa">address<span class="_"> </span>order<span class="_ _2"></span></span>,<span class="_"> </span>where<span class="_"> </span>the<span class="_ _11"> </span>address</div><div class="t m5 x17 h26 y2fb ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_ _13"> </span>each<span class="_ _13"> </span>block<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_ _13"> </span>list<span class="_ _13"> </span>is<span class="_ _13"> </span>less<span class="_ _13"> </span>than<span class="_ _13"> </span>the<span class="_ _13"> </span>address<span class="_ _13"> </span>of<span class="_ _13"> </span>its<span class="_ _13"> </span>successor.<span class="_ _13"> </span>In<span class="_ _13"> </span>this<span class="_ _13"> </span>case<span class="_ _1"></span>,<span class="_ _13"> </span>freeing</div><div class="t m5 x17 h26 y2fc ff7 fs19 fc2 sc0 ls0 ws0">a<span class="_ _11"> </span>block<span class="_ _16"> </span>requires<span class="_ _11"> </span>a<span class="_ _16"> </span>linear<span class="_ _1"></span>-time<span class="_ _16"> </span>search<span class="_ _11"> </span>to<span class="_ _16"> </span>locate<span class="_ _11"> </span>the<span class="_ _16"> </span>appropriate<span class="_ _11"> </span>predecessor.<span class="_ _11"> </span>The</div><div class="t m5 x17 h26 y2fd ff7 fs19 fc2 sc0 ls0 ws0">trade-off<span class="_ _14"> </span>is<span class="_ _15"> </span>that<span class="_ _14"> </span>address-ordered<span class="_ _15"> </span>ﬁrst<span class="_ _15"> </span>ﬁt<span class="_ _14"> </span>enjoys<span class="_ _15"> </span>better<span class="_ _15"> </span>memory<span class="_ _14"> </span>utilization<span class="_ _15"> </span>than</div><div class="t m5 x17 h26 y2fe ff7 fs19 fc2 sc0 ls0 ws0">LIFO-ordered<span class="_"> </span>ﬁrst<span class="_"> </span>ﬁt,<span class="_"> </span>approaching<span class="_"> </span>the<span class="_"> </span>utilization<span class="_"> </span>of<span class="_"> </span>best<span class="_"> </span>ﬁt.</div><div class="t m5 x26 h26 y2ff ff7 fs19 fc2 sc0 ls0 ws0">A<span class="_ _14"> </span>disadvantage<span class="_ _14"> </span>of<span class="_ _14"> </span>explicit<span class="_ _14"> </span>lists<span class="_ _14"> </span>in<span class="_ _14"> </span>general<span class="_ _14"> </span>is<span class="_ _14"> </span>that<span class="_ _14"> </span>free<span class="_ _14"> </span>blocks<span class="_ _14"> </span>must<span class="_ _14"> </span>be<span class="_ _14"> </span>large</div><div class="t m5 x17 h26 y300 ff7 fs19 fc2 sc0 ls0 ws0">enough<span class="_"> </span>to<span class="_ _13"> </span>contain<span class="_"> </span>all<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>necessary<span class="_"> </span>pointers<span class="_ _3"></span>,<span class="_"> </span>as<span class="_ _13"> </span>well<span class="_"> </span>as<span class="_ _13"> </span>the<span class="_"> </span>header<span class="_ _13"> </span>and<span class="_"> </span>possibly</div><div class="t m5 x17 h26 y21a ff7 fs19 fc2 sc0 ls0 ws0">a<span class="_ _11"> </span>footer.<span class="_ _11"> </span>This<span class="_"> </span>results<span class="_ _16"> </span>in<span class="_ _11"> </span>a<span class="_ _16"> </span>larger<span class="_ _11"> </span>minimum<span class="_ _16"> </span>block<span class="_ _11"> </span>size<span class="_ _16"> </span>and<span class="_ _11"> </span>increases<span class="_ _16"> </span>the<span class="_ _11"> </span>potential</div><div class="t m5 x17 h26 y450 ff7 fs19 fc2 sc0 ls0 ws0">for<span class="_"> </span>internal<span class="_"> </span>fragmentation.</div><div class="t m5 x17 h41 y7456 ffe fs29 fc2 sc0 ls0 ws0">9.9.14<span class="_ _48"> </span><span class="fs19">Segregated<span class="_"> </span>Free<span class="_"> </span>Lists</span></div><div class="t m5 x17 h26 y7457 ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_"> </span>we<span class="_"> </span>have<span class="_"> </span>seen,<span class="_"> </span>an<span class="_"> </span>allocator<span class="_"> </span>that<span class="_"> </span>uses<span class="_"> </span>a<span class="_ _13"> </span>single<span class="_"> </span>linked<span class="_"> </span>list<span class="_"> </span>of<span class="_"> </span>free<span class="_"> </span>blocks<span class="_"> </span>requires</div><div class="t m5 x17 h26 y7458 ff7 fs19 fc2 sc0 ls0 ws0">time<span class="_ _6"> </span>linear<span class="_ _6"> </span>in<span class="_ _6"> </span>the<span class="_ _13"> </span>number<span class="_ _a"> </span>of<span class="_ _6"> </span>free<span class="_ _13"> </span>blocks<span class="_ _a"> </span>to<span class="_ _6"> </span>allocate<span class="_ _13"> </span>a<span class="_ _a"> </span>block.<span class="_ _6"> </span>A<span class="_ _13"> </span>popular<span class="_ _a"> </span>approach<span class="_ _6"> </span>for</div><div class="t m5 x17 h26 y7459 ff7 fs19 fc2 sc0 ls0 ws0">reducing<span class="_ _13"> </span>the<span class="_ _13"> </span>allocation<span class="_ _13"> </span>time<span class="_ _1"></span>,<span class="_"> </span>known<span class="_ _13"> </span>generally<span class="_ _13"> </span>as<span class="_ _13"> </span><span class="ffa">segregated<span class="_ _13"> </span>storage</span>,<span class="_ _13"> </span>is<span class="_ _13"> </span>to<span class="_ _13"> </span>maintain</div><div class="t m5 x17 h26 y745a ff7 fs19 fc2 sc0 ls0 ws0">multiple<span class="_ _13"> </span>free<span class="_ _13"> </span>lists<span class="_ _0"></span>,<span class="_ _13"> </span>where<span class="_"> </span>each<span class="_ _13"> </span>list<span class="_ _13"> </span>holds<span class="_ _13"> </span>blocks<span class="_"> </span>that<span class="_ _13"> </span>are<span class="_ _13"> </span>roughly<span class="_ _13"> </span>the<span class="_"> </span>same<span class="_ _13"> </span>size<span class="_ _1"></span>.<span class="_ _13"> </span>The</div><div class="t m5 x17 h26 y745b ff7 fs19 fc2 sc0 ls0 ws0">general<span class="_ _6"> </span>idea<span class="_ _6"> </span>is<span class="_ _6"> </span>to<span class="_ _6"> </span>partition<span class="_ _13"> </span>the<span class="_ _a"> </span>set<span class="_ _6"> </span>of<span class="_ _6"> </span>all<span class="_ _13"> </span>possible<span class="_ _a"> </span>block<span class="_ _6"> </span>sizes<span class="_ _6"> </span>into<span class="_ _6"> </span>equivalence<span class="_ _13"> </span>classes</div><div class="t m5 x17 h26 y745c ff7 fs19 fc2 sc0 ls0 ws0">called<span class="_ _13"> </span><span class="ffa">size<span class="_ _13"> </span>classes</span>.<span class="_ _13"> </span>T<span class="_ _1"></span>here<span class="_ _13"> </span>are<span class="_ _13"> </span>many<span class="_"> </span>ways<span class="_ _13"> </span>to<span class="_ _13"> </span>deﬁne<span class="_ _13"> </span>the<span class="_ _13"> </span>size<span class="_ _13"> </span>classes<span class="_ _1"></span>.<span class="_ _13"> </span>F<span class="_ _1"></span>or<span class="_ _13"> </span>example<span class="_ _0"></span>,<span class="_ _13"> </span>we</div><div class="t m5 x17 h26 y745d ff7 fs19 fc2 sc0 ls0 ws0">might<span class="_"> </span>partition<span class="_"> </span>the<span class="_"> </span>block<span class="_"> </span>sizes<span class="_"> </span>by<span class="_"> </span>powers<span class="_"> </span>of<span class="_"> </span>2:</div><div class="t m5 x1d2 h46 y745e ff12 fs19 fc2 sc0 ls0 ws0">{<span class="ff7">1<span class="_ _1"></span><span class="ff12">}<span class="ff11">,<span class="_ _10"> </span></span>{<span class="ff7">2</span>}<span class="ff11">,<span class="_ _13"> </span></span>{<span class="ff7">3<span class="ff11">,<span class="_ _13"> </span></span>4</span>}<span class="ff11">,<span class="_ _10"> </span></span>{<span class="ff7 ls97">5–8<span class="_ _2"></span></span>}<span class="ff11">,</span></span></span></div><div class="t m5 x7a h45 y745f ff11 fs19 fc2 sc0 ls42 ws0">...</div><div class="t m5 x1f2 h46 y745e ff11 fs19 fc2 sc0 ls0 ws0">,<span class="_ _13"> </span><span class="ff12">{<span class="ff7">1<span class="_ _0"></span><span class="ff11">,<span class="ff7">025–2</span>,<span class="ff7">048<span class="ff12">}</span></span>,<span class="_ _13"> </span><span class="ff12">{<span class="ff7">2</span></span>,<span class="ff7 ls18">049–4</span>,<span class="ff7">096<span class="ff12">}</span></span>,<span class="_ _10"> </span><span class="ff12">{<span class="ff7">4</span></span>,<span class="ff7 ls29">097–</span><span class="ff12">∞}</span></span></span></span></div><div class="t m5 x17 h26 y7460 ff7 fs19 fc2 sc0 ls0 ws0">Or<span class="_ _13"> </span>we<span class="_ _6"> </span>might<span class="_ _13"> </span>assign<span class="_ _13"> </span>small<span class="_ _6"> </span>blocks<span class="_ _13"> </span>to<span class="_ _13"> </span>their<span class="_ _6"> </span>own<span class="_ _13"> </span>size<span class="_ _13"> </span>classes<span class="_ _6"> </span>and<span class="_ _13"> </span>partition<span class="_ _13"> </span>large<span class="_ _6"> </span>blocks</div><div class="t m5 x17 h26 y7461 ff7 fs19 fc2 sc0 ls0 ws0">by<span class="_"> </span>powers<span class="_"> </span>of<span class="_"> </span>2:</div><div class="t m5 x63 h46 y7462 ff12 fs19 fc2 sc0 ls0 ws0">{<span class="ff7">1<span class="_ _1"></span><span class="ff12">}<span class="ff11">,<span class="_ _10"> </span></span>{<span class="ff7">2</span>}<span class="ff11">,<span class="_ _13"> </span></span>{<span class="ff7">3</span>}<span class="ff11">,</span></span></span></div><div class="t m5 x17e h45 y7463 ff11 fs19 fc2 sc0 ls42 ws0">...</div><div class="t m5 xad h46 y7462 ff11 fs19 fc2 sc0 ls0 ws0">,<span class="_ _13"> </span><span class="ff12">{<span class="ff7">1<span class="_ _0"></span><span class="ff11">,<span class="ff7">023<span class="ff12">}</span></span>,<span class="_ _13"> </span><span class="ff12">{<span class="ff7">1<span class="_ _1"></span><span class="ff11">,<span class="ff7">024<span class="ff12">}</span></span>,<span class="_ _10"> </span><span class="ff12">{<span class="ff7">1<span class="_ _1"></span><span class="ff11">,<span class="ff7">025–2</span>,<span class="ff7">048<span class="ff12">}</span></span>,<span class="_ _13"> </span><span class="ff12">{<span class="ff7">2</span></span>,<span class="ff7 ls18">049–4</span>,<span class="ff7">096<span class="ff12">}</span></span>,<span class="_ _10"> </span><span class="ff12">{<span class="ff7">4</span></span>,<span class="ff7 ls29">097–</span><span class="ff12">∞}</span></span></span></span></span></span></span></span></span></span></div><div class="t m5 x26 h26 y7464 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _11"> </span>allocator<span class="_"> </span>maintains<span class="_ _11"> </span>an<span class="_"> </span>array<span class="_ _11"> </span>of<span class="_"> </span>free<span class="_ _11"> </span>lists<span class="_ _1"></span>,<span class="_ _11"> </span>with<span class="_"> </span>one<span class="_ _11"> </span>free<span class="_"> </span>list<span class="_ _11"> </span>per<span class="_"> </span>size<span class="_ _11"> </span>class<span class="_ _1"></span>,</div><div class="t m5 x17 h26 y7465 ff7 fs19 fc2 sc0 ls0 ws0">ordered<span class="_"> </span>by<span class="_ _13"> </span>increasing<span class="_"> </span>size<span class="_ _0"></span>.<span class="_"> </span>W<span class="_ _0"></span>hen<span class="_"> </span>the<span class="_ _13"> </span>allocator<span class="_"> </span>needs<span class="_"> </span>a<span class="_"> </span>block<span class="_ _13"> </span>of<span class="_"> </span>size<span class="_"> </span><span class="ff11">n</span>,<span class="_ _13"> </span>it<span class="_"> </span>searches</div><div class="t m5 x17 h26 y7466 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>appropriate<span class="_"> </span>free</div><div class="t m5 xa3 h26 y7467 ff7 fs19 fc2 sc0 ls0 ws0">list.<span class="_"> </span>If<span class="_"> </span>it<span class="_"> </span>cannot<span class="_"> </span>ﬁnd<span class="_"> </span>a<span class="_"> </span>block<span class="_ _13"> </span>that<span class="_"> </span>ﬁts<span class="_ _1"></span>,<span class="_"> </span>it<span class="_"> </span>searches<span class="_"> </span>the<span class="_"> </span>next<span class="_"> </span>list,</div><div class="t m5 x17 h26 y7468 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_"> </span>so<span class="_"> </span>on.</div><div class="t m5 x26 h26 y7469 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>dynamic<span class="_ _13"> </span>storage<span class="_"> </span>allocation<span class="_ _13"> </span>literature<span class="_ _13"> </span>describes<span class="_"> </span>dozens<span class="_ _13"> </span>of<span class="_"> </span>variants<span class="_ _13"> </span>of<span class="_ _13"> </span>seg-</div><div class="t m5 x17 h26 y746a ff7 fs19 fc2 sc0 ls0 ws0">regated<span class="_ _15"> </span>storage<span class="_ _15"> </span>that<span class="_ _15"> </span>differ<span class="_ _15"> </span>in<span class="_ _15"> </span>how<span class="_ _15"> </span>they<span class="_ _15"> </span>deﬁne<span class="_ _15"> </span>size<span class="_ _15"> </span>classes<span class="_ _1"></span>,<span class="_ _f"> </span>when<span class="_ _15"> </span>they<span class="_ _15"> </span>perform</div><div class="t m5 x17 h26 y746b ff7 fs19 fc2 sc0 ls0 ws0">coalescing,<span class="_ _16"> </span>when<span class="_ _16"> </span>they<span class="_ _14"> </span>request<span class="_ _16"> </span>additional<span class="_ _14"> </span>heap<span class="_ _16"> </span>memory<span class="_ _16"> </span>from<span class="_ _14"> </span>the<span class="_ _16"> </span>operating<span class="_ _16"> </span>sys-</div><div class="t m5 x17 h26 y746c ff7 fs19 fc2 sc0 ls0 ws0">tem,<span class="_ _15"> </span>whether<span class="_ _14"> </span>they<span class="_ _15"> </span>allow<span class="_ _14"> </span>splitting,<span class="_ _15"> </span>and<span class="_ _14"> </span>so<span class="_ _14"> </span>forth.<span class="_ _15"> </span>T<span class="_ _7"></span>o<span class="_ _15"> </span>give<span class="_ _14"> </span>you<span class="_ _14"> </span>a<span class="_ _15"> </span>sense<span class="_ _14"> </span>of<span class="_ _14"> </span>what<span class="_ _15"> </span>is</div><div class="t m5 x17 h26 y746d ff7 fs19 fc2 sc0 ls0 ws0">possible<span class="_ _1"></span>,<span class="_ _16"> </span>we<span class="_ _11"> </span>will<span class="_ _11"> </span>describe<span class="_ _16"> </span>two<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>basic<span class="_ _11"> </span>approaches:<span class="_ _11"> </span><span class="ffa">simple<span class="_ _11"> </span>segregated<span class="_ _16"> </span>storage</span></div><div class="t m5 x17 h26 y746e ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_"> </span><span class="ffa">segregated<span class="_"> </span>ﬁts</span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
