<div id="pf329" class="pf w2 h11" data-page-no="329"><div class="pc pc329 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg329.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">808<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>8<span class="_ _3d"> </span>Exceptional<span class="_ _10"> </span>Control<span class="_ _10"> </span>Flow</span></div><div class="t m5 x1d h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">does<span class="_"> </span>some<span class="_"> </span>additional<span class="_"> </span>cleanup<span class="_"> </span>work<span class="_"> </span>(modeled<span class="_ _11"> </span>by<span class="_"> </span>the<span class="_"> </span><span class="ffd">sleep<span class="_ _10"> </span></span>statement),<span class="_ _11"> </span>and<span class="_"> </span>then</div><div class="t m5 x1d h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">returns<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y2a8 ff7 fs19 fc2 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _16"> </span><span class="ffd ls0">signal1<span class="_ _11"> </span><span class="ff7">program<span class="_ _16"> </span>in<span class="_ _11"> </span>F<span class="_ _1"></span>igure<span class="_ _16"> </span>8.36<span class="_ _11"> </span>seems<span class="_ _11"> </span>fairly<span class="_ _11"> </span>straightforward.<span class="_ _16"> </span>When<span class="_"> </span>we</span></span></div><div class="t m5 x1d h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">run<span class="_"> </span>it<span class="_"> </span>on<span class="_"> </span>our<span class="_"> </span>Linux<span class="_"> </span>system,<span class="_"> </span>however,<span class="_"> </span>we<span class="_"> </span>get<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>output:</div><div class="t m5 x1d h2d y699d ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">./signal1</span></div><div class="t m5 x1d h2d y699e ffd fs1e fc2 sc0 ls0 ws0">Hello<span class="_ _e"> </span>from<span class="_ _1f"> </span>child<span class="_ _1f"> </span>14073</div><div class="t m5 x1d h2d y699f ffd fs1e fc2 sc0 ls0 ws0">Hello<span class="_ _e"> </span>from<span class="_ _1f"> </span>child<span class="_ _1f"> </span>14074</div><div class="t m5 x1d h2d y69a0 ffd fs1e fc2 sc0 ls0 ws0">Hello<span class="_ _e"> </span>from<span class="_ _1f"> </span>child<span class="_ _1f"> </span>14075</div><div class="t m5 x1d h2d y69a1 ffd fs1e fc2 sc0 ls0 ws0">Handler<span class="_ _e"> </span>reaped<span class="_ _1f"> </span>child</div><div class="t m5 x1d h2d y69a2 ffd fs1e fc2 sc0 ls0 ws0">Handler<span class="_ _e"> </span>reaped<span class="_ _1f"> </span>child</div><div class="t m5 x1d h2d y69a3 ff13 fs1e fc2 sc0 ls0 ws0">CR</div><div class="t m5 x1d h2d y69a4 ffd fs1e fc2 sc0 ls0 ws0">Parent<span class="_ _e"> </span>processing<span class="_ _1f"> </span>input</div><div class="t m5 x1d h26 y69a5 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>rom<span class="_"> </span>the<span class="_"> </span>output,<span class="_ _13"> </span>we<span class="_"> </span>note<span class="_"> </span>that<span class="_ _13"> </span>although<span class="_"> </span>three<span class="_"> </span>SIGCHLD<span class="_ _13"> </span>signals<span class="_"> </span>were<span class="_"> </span>sent<span class="_ _13"> </span>to<span class="_"> </span>the</div><div class="t m5 x1d h26 y69a6 ff7 fs19 fc2 sc0 ls0 ws0">parent,<span class="_ _11"> </span>only<span class="_ _11"> </span>two<span class="_ _11"> </span>of<span class="_"> </span>these<span class="_ _11"> </span>signals<span class="_ _11"> </span>were<span class="_ _11"> </span>received,<span class="_ _11"> </span>and<span class="_ _11"> </span>thus<span class="_ _11"> </span>the<span class="_ _11"> </span>parent<span class="_ _11"> </span>only<span class="_ _11"> </span>reaped</div><div class="t m5 x1d h26 y69a7 ff7 fs19 fc2 sc0 ls0 ws0">two<span class="_"> </span>children.<span class="_"> </span>If<span class="_"> </span>we<span class="_"> </span>suspend<span class="_ _13"> </span>the<span class="_"> </span>parent<span class="_"> </span>process<span class="_ _1"></span>,<span class="_"> </span>we<span class="_"> </span>see<span class="_"> </span>that,<span class="_"> </span>indeed,<span class="_"> </span>child<span class="_"> </span>process</div><div class="t m5 x1d h26 y69a8 ff7 fs19 fc2 sc0 ls0 ws0">14075<span class="_ _13"> </span>was<span class="_ _13"> </span>never<span class="_"> </span>reaped<span class="_ _13"> </span>and<span class="_ _13"> </span>remains<span class="_ _13"> </span>a<span class="_ _13"> </span>zombie<span class="_ _13"> </span>(indicated<span class="_"> </span>by<span class="_ _13"> </span>the<span class="_ _13"> </span>string<span class="_ _13"> </span><span class="ffd">&lt;defunct&gt;</span></div><div class="t m5 x1d h26 y69a9 ff7 fs19 fc2 sc0 ls0 ws0">in<span class="_"> </span>the<span class="_"> </span>output<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span><span class="ffd">ps<span class="_ _10"> </span></span>command):</div><div class="t m5 x1d h2d y69aa ff13 fs1e fc2 sc0 ls0 ws0">Ctrl+Z</div><div class="t m5 x1d h2d y69ab ffd fs1e fc2 sc0 ls0 ws0">Suspended</div><div class="t m5 x1d h2d y69ac ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">ps<span class="_ _1f"> </span>t</span></div><div class="t m5 x75 h2d y69ad ffd fs1e fc2 sc0 ls0 ws0">PID<span class="_ _e"> </span>TTY<span class="_ _b9"> </span>STAT<span class="_ _3f"> </span>TIME<span class="_ _e"> </span>COMMAND</div><div class="t m5 x75 h2d y69ae ffd fs1e fc2 sc0 ls0 ws0">.</div><div class="t m5 x75 h2d y69af ffd fs1e fc2 sc0 ls0 ws0">.</div><div class="t m5 x75 h2d y69b0 ffd fs1e fc2 sc0 ls0 ws0">.</div><div class="t m5 x1d h2d y69b1 ffd fs1e fc2 sc0 ls0 ws0">14072<span class="_ _e"> </span>pts/3<span class="_ _46"> </span>T<span class="_ _b9"> </span>0:02<span class="_ _e"> </span>./signal1</div><div class="t m5 x1d h2d y69b2 ffd fs1e fc2 sc0 ls0 ws0">14075<span class="_ _e"> </span>pts/3<span class="_ _46"> </span>Z<span class="_ _b9"> </span>0:00<span class="_ _e"> </span>[signal1]<span class="_ _1f"> </span>&lt;defunct&gt;</div><div class="t m5 x1d h2d y69b3 ffd fs1e fc2 sc0 ls0 ws0">14076<span class="_ _e"> </span>pts/3<span class="_ _46"> </span>R+<span class="_ _8c"> </span>0:00<span class="_ _1f"> </span>ps<span class="_ _1f"> </span>t</div><div class="t m5 x29 h26 y19b8 ff7 fs19 fc2 sc0 ls0 ws0">What<span class="_ _13"> </span>went<span class="_ _13"> </span>wrong?<span class="_ _13"> </span>The<span class="_ _13"> </span>problem<span class="_ _13"> </span>is<span class="_"> </span>that<span class="_ _13"> </span>our<span class="_ _13"> </span>code<span class="_ _13"> </span>failed<span class="_"> </span>to<span class="_ _13"> </span>account<span class="_ _13"> </span>for<span class="_ _13"> </span>the<span class="_"> </span>fact</div><div class="t m5 x1d h26 y56b9 ff7 fs19 fc2 sc0 ls0 ws0">that<span class="_ _14"> </span>signals<span class="_ _14"> </span>are<span class="_ _14"> </span>not<span class="_ _14"> </span>queued.<span class="_ _14"> </span>Here’s<span class="_ _14"> </span>what<span class="_ _14"> </span>happened:<span class="_ _14"> </span>T<span class="_ _0"></span>he<span class="_ _14"> </span>ﬁrst<span class="_ _14"> </span>signal<span class="_ _14"> </span>is<span class="_ _14"> </span>received</div><div class="t m5 x1d h26 y69b4 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_"> </span>caught<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span>parent.<span class="_"> </span>W<span class="_ _0"></span>hile<span class="_"> </span>the<span class="_"> </span>handler<span class="_"> </span>is<span class="_"> </span>still<span class="_"> </span>processing<span class="_"> </span>the<span class="_"> </span>ﬁrst<span class="_"> </span>signal,<span class="_"> </span>the</div><div class="t m5 x1d h26 y69b5 ff7 fs19 fc2 sc0 ls0 ws0">second<span class="_ _13"> </span>signal<span class="_"> </span>is<span class="_ _13"> </span>delivered<span class="_"> </span>and<span class="_ _13"> </span>added<span class="_"> </span>to<span class="_ _13"> </span>the<span class="_"> </span>set<span class="_ _13"> </span>of<span class="_"> </span>pending<span class="_ _13"> </span>signals<span class="_ _1"></span>.<span class="_"> </span>However<span class="_ _0"></span>,<span class="_"> </span>since</div><div class="t m5 x1d h26 y69b6 ff7 fs19 fc2 sc0 ls0 ws0">SIGCHLD<span class="_ _13"> </span>signals<span class="_ _13"> </span>are<span class="_ _13"> </span>blocked<span class="_ _13"> </span>by<span class="_ _13"> </span>the<span class="_ _13"> </span>SIGCHLD<span class="_ _13"> </span>handler,<span class="_ _13"> </span>the<span class="_ _13"> </span>second<span class="_ _13"> </span>signal<span class="_ _13"> </span>is<span class="_ _13"> </span>not</div><div class="t m5 x1d h26 y69b7 ff7 fs19 fc2 sc0 ls0 ws0">received.<span class="_ _16"> </span>Shortly<span class="_ _16"> </span>thereafter,<span class="_ _16"> </span>while<span class="_ _16"> </span>the<span class="_ _16"> </span>handler<span class="_ _16"> </span>is<span class="_ _16"> </span>still<span class="_ _16"> </span>processing<span class="_ _16"> </span>the<span class="_ _16"> </span>ﬁrst<span class="_ _16"> </span>signal,</div><div class="t m5 x1d h26 y69b8 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _15"> </span>third<span class="_ _14"> </span>signal<span class="_ _15"> </span>arrives<span class="_ _1"></span>.<span class="_ _15"> </span>Since<span class="_ _15"> </span>there<span class="_ _15"> </span>is<span class="_ _15"> </span>already<span class="_ _15"> </span>a<span class="_ _15"> </span>pending<span class="_ _15"> </span>SIGCHLD<span class="_ _3"></span>,<span class="_ _21"> </span>this<span class="_ _15"> </span>third</div><div class="t m5 x1d h26 y69b9 ff7 fs19 fc2 sc0 ls0 ws0">SIGCHLD<span class="_ _14"> </span>signal<span class="_ _14"> </span>is<span class="_ _14"> </span>discarded.<span class="_ _14"> </span>Sometime<span class="_ _14"> </span>later,<span class="_ _15"> </span>after<span class="_ _14"> </span>the<span class="_ _14"> </span>handler<span class="_ _14"> </span>has<span class="_ _14"> </span>returned,</div><div class="t m5 x1d h26 y69ba ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>kernel<span class="_"> </span>notices<span class="_ _13"> </span>that<span class="_"> </span>there<span class="_"> </span>is<span class="_"> </span>a<span class="_"> </span>pending<span class="_ _13"> </span>SIGCHLD<span class="_"> </span>signal<span class="_"> </span>and<span class="_"> </span>forces<span class="_"> </span>the<span class="_ _13"> </span>parent</div><div class="t m5 x1d h26 y69bb ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_ _14"> </span>receive<span class="_ _14"> </span>the<span class="_ _14"> </span>signal.<span class="_ _14"> </span>T<span class="_ _0"></span>he<span class="_ _14"> </span>parent<span class="_ _14"> </span>catches<span class="_ _14"> </span>the<span class="_ _14"> </span>signal<span class="_ _14"> </span>and<span class="_ _14"> </span>executes<span class="_ _14"> </span>the<span class="_ _15"> </span>handler<span class="_ _14"> </span>a</div><div class="t m5 x1d h26 y69bc ff7 fs19 fc2 sc0 ls0 ws0">second<span class="_"> </span>time<span class="_ _1"></span>.<span class="_"> </span>After<span class="_"> </span>the<span class="_ _13"> </span>handler<span class="_"> </span>ﬁnishes<span class="_"> </span>processing<span class="_ _13"> </span>the<span class="_"> </span>second<span class="_"> </span>signal,<span class="_ _13"> </span>there<span class="_"> </span>are<span class="_"> </span>no</div><div class="t m5 x1d h26 y69bd ff7 fs19 fc2 sc0 ls0 ws0">more<span class="_"> </span>pending<span class="_"> </span>SIGCHLD<span class="_"> </span>signals<span class="_ _3"></span>,<span class="_"> </span>and<span class="_"> </span>there<span class="_"> </span>never<span class="_"> </span>will<span class="_"> </span>be<span class="_ _0"></span>,<span class="_"> </span>because<span class="_"> </span>all<span class="_"> </span>knowledge</div><div class="t m5 x1d h26 y69be ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_ _11"> </span>the<span class="_ _11"> </span>third<span class="_ _16"> </span>SIGCHLD<span class="_"> </span>has<span class="_ _16"> </span>been<span class="_ _11"> </span>lost.<span class="_ _11"> </span><span class="ffa">The<span class="_ _11"> </span>crucial<span class="_ _16"> </span>lesson<span class="_"> </span>is<span class="_ _16"> </span>that<span class="_ _11"> </span>signals<span class="_ _11"> </span>cannot<span class="_ _11"> </span>be</span></div><div class="t m5 x1d h30 y69bf ffa fs19 fc2 sc0 ls0 ws0">used<span class="_"> </span>to<span class="_"> </span>count<span class="_"> </span>the<span class="_"> </span>occurrence<span class="_"> </span>of<span class="_"> </span>events<span class="_"> </span>in<span class="_"> </span>other<span class="_"> </span>processes<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y69c0 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_"> </span>ﬁx<span class="_"> </span>the<span class="_"> </span>problem,<span class="_"> </span>we<span class="_"> </span>must<span class="_"> </span>recall<span class="_ _13"> </span>that<span class="_"> </span>the<span class="_"> </span>existence<span class="_"> </span>of<span class="_"> </span>a<span class="_"> </span>pending<span class="_"> </span>signal<span class="_ _13"> </span>only</div><div class="t m5 x1d h26 y69c1 ff7 fs19 fc2 sc0 ls0 ws0">implies<span class="_"> </span>that<span class="_ _11"> </span>at<span class="_ _11"> </span>least<span class="_ _11"> </span>one<span class="_ _11"> </span>signal<span class="_"> </span>has<span class="_ _11"> </span>been<span class="_ _11"> </span>delivered<span class="_ _11"> </span>since<span class="_ _11"> </span>the<span class="_"> </span>last<span class="_ _11"> </span>time<span class="_ _11"> </span>the<span class="_ _11"> </span>process</div><div class="t m5 x1d h26 y69c2 ff7 fs19 fc2 sc0 ls0 ws0">received<span class="_"> </span>a<span class="_"> </span>signal<span class="_"> </span>of<span class="_"> </span>that<span class="_"> </span>type<span class="_ _0"></span>.<span class="_"> </span>So<span class="_"> </span>we<span class="_"> </span>must<span class="_"> </span>modify<span class="_"> </span>the<span class="_"> </span>SIGCHLD<span class="_"> </span>handler<span class="_"> </span>to<span class="_"> </span>reap</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
