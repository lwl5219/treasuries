<div id="pf31f" class="pf w2 h11" data-page-no="31f"><div class="pc pc31f w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg31f.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">798<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>8<span class="_ _3d"> </span>Exceptional<span class="_ _10"> </span>Control<span class="_ _10"> </span>Flow</span></div><div class="t m5 x1d h42 ye7 ff6 fs29 fc6 sc0 ls0 ws0">Sending<span class="_ _11"> </span>Signals<span class="_ _16"> </span>with<span class="_ _16"> </span>the<span class="_ _11"> </span><span class="ffd fs2b">alarm<span class="_ _16"> </span></span>Function</div><div class="t m5 x1d h26 y5bd ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_"> </span>process<span class="_"> </span>can<span class="_"> </span>send<span class="_"> </span>SIGALRM<span class="_"> </span>signals<span class="_"> </span>to<span class="_"> </span>itself<span class="_"> </span>by<span class="_"> </span>calling<span class="_"> </span>the<span class="_"> </span><span class="ffd">alarm<span class="_ _10"> </span></span>function.</div><div class="t m5 x126 h2d y6852 ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;unistd.h&gt;</div><div class="t m5 x126 h2d y6853 ffd fs1e fc2 sc0 ls0 ws0">unsigned<span class="_ _e"> </span>int<span class="_ _1f"> </span>alarm(unsigned<span class="_ _1f"> </span>int<span class="_ _e"> </span>secs);</div><div class="t m5 xe6 hf1 y6854 ff7 fs1f fc2 sc0 ls0 ws0">Returns:<span class="_"> </span>remaining<span class="_"> </span>seconds<span class="_"> </span>of<span class="_"> </span>previous<span class="_"> </span>alarm,<span class="_"> </span>or<span class="_"> </span>0<span class="_"> </span>if<span class="_"> </span>no<span class="_"> </span>previous<span class="_"> </span>alarm</div><div class="t m5 x1d h26 y6855 ff7 fs19 fc2 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _15"> </span><span class="ffd ls0">alarm<span class="_ _14"> </span><span class="ff7">function<span class="_ _14"> </span>arranges<span class="_ _15"> </span>for<span class="_ _14"> </span>the<span class="_ _14"> </span>kernel<span class="_ _14"> </span>to<span class="_ _14"> </span>send<span class="_ _14"> </span>a<span class="_ _14"> </span>SIGALRM<span class="_ _15"> </span>signal<span class="_ _14"> </span>to<span class="_ _14"> </span>the</span></span></div><div class="t m5 x1d h26 y6856 ff7 fs19 fc2 sc0 ls0 ws0">calling<span class="_ _11"> </span>process<span class="_ _16"> </span>in<span class="_ _11"> </span><span class="ffd">secs<span class="_ _16"> </span></span>seconds<span class="_ _1"></span>.<span class="_ _11"> </span>If<span class="_ _16"> </span><span class="ffd">secs<span class="_ _11"> </span></span>is<span class="_ _16"> </span>0,<span class="_ _16"> </span>then<span class="_ _11"> </span>no<span class="_ _16"> </span>new<span class="_ _11"> </span>alarm<span class="_ _16"> </span>is<span class="_ _11"> </span>scheduled.<span class="_ _16"> </span>In</div><div class="t m5 x1d h26 y6857 ff7 fs19 fc2 sc0 ls0 ws0">any<span class="_ _11"> </span>event,<span class="_ _11"> </span>the<span class="_ _11"> </span>call<span class="_ _11"> </span>to<span class="_ _11"> </span><span class="ffd">alarm<span class="_ _16"> </span></span>cancels<span class="_"> </span>any<span class="_ _11"> </span>pending<span class="_ _11"> </span>alarms<span class="_ _11"> </span>and<span class="_ _16"> </span>returns<span class="_"> </span>the<span class="_ _11"> </span>number</div><div class="t m5 x1d h26 y6858 ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_ _11"> </span>seconds<span class="_ _16"> </span>remaining<span class="_ _16"> </span>until<span class="_ _11"> </span>any<span class="_ _16"> </span>pending<span class="_ _16"> </span>alarm<span class="_ _11"> </span>was<span class="_ _16"> </span>due<span class="_ _11"> </span>to<span class="_ _16"> </span>be<span class="_ _16"> </span>delivered<span class="_ _11"> </span>(had<span class="_ _16"> </span>not</div><div class="t m5 x1d h26 y6859 ff7 fs19 fc2 sc0 ls0 ws0">this<span class="_"> </span>call<span class="_"> </span>to<span class="_"> </span><span class="ffd">alarm<span class="_ _10"> </span></span>canceled<span class="_"> </span>it),<span class="_"> </span>or<span class="_"> </span>0<span class="_"> </span>if<span class="_"> </span>there<span class="_"> </span>were<span class="_"> </span>no<span class="_"> </span>pending<span class="_"> </span>alarms<span class="_ _1"></span>.</div><div class="t m5 x1d h41 y685a ffe fs29 fc2 sc0 ls0 ws0">8.5.3<span class="_ _48"> </span><span class="fs19">Receiving<span class="_"> </span>Signals</span></div><div class="t m5 x1d h26 y685b ff7 fs19 fc2 sc0 ls0 ws0">When<span class="_ _21"> </span>the<span class="_ _21"> </span>kernel<span class="_ _f"> </span>switches<span class="_ _f"> </span>a<span class="_ _f"> </span>process<span class="_ _f"> </span><span class="ff11">p<span class="_ _e"> </span></span>from<span class="_ _21"> </span>kernel<span class="_ _f"> </span>mode<span class="_ _21"> </span>to<span class="_ _f"> </span>user<span class="_ _f"> </span>mode<span class="_ _f"> </span>(e<span class="_ _0"></span>.g.,</div><div class="t m5 x1d h26 y685c ff7 fs19 fc2 sc0 ls0 ws0">returning<span class="_"> </span>from<span class="_ _11"> </span>a<span class="_ _11"> </span>system<span class="_ _11"> </span>call<span class="_ _11"> </span>or<span class="_ _11"> </span>completing<span class="_ _11"> </span>a<span class="_ _11"> </span>context<span class="_"> </span>switch),<span class="_ _11"> </span>it<span class="_ _11"> </span>checks<span class="_ _11"> </span>the<span class="_ _11"> </span>set<span class="_ _11"> </span>of</div><div class="t m5 x1d h26 y685d ff7 fs19 fc2 sc0 ls0 ws0">unblocked<span class="_ _11"> </span>pending<span class="_ _16"> </span>signals<span class="_ _11"> </span>(<span class="ffd">pending<span class="_ _16"> </span>&amp;<span class="_ _11"> </span>~blocked</span>)<span class="_ _16"> </span>for<span class="_ _11"> </span><span class="ff11">p<span class="_ _2"></span></span>.<span class="_ _16"> </span>If<span class="_ _11"> </span>this<span class="_ _11"> </span>set<span class="_ _16"> </span>is<span class="_ _11"> </span>empty<span class="_ _16"> </span>(the</div><div class="t m5 x1d h26 y685e ff7 fs19 fc2 sc0 ls0 ws0">usual<span class="_ _16"> </span>case),<span class="_ _15"> </span>then<span class="_ _14"> </span>the<span class="_ _16"> </span>kernel<span class="_ _14"> </span>passes<span class="_ _14"> </span>control<span class="_ _14"> </span>to<span class="_ _16"> </span>the<span class="_ _14"> </span>next<span class="_ _14"> </span>instruction<span class="_ _16"> </span>(<span class="ff11">I</span></div><div class="t m5 xea h3c y685f ff7 fs25 fc2 sc0 ls0 ws0">next</div><div class="t m5 x236 h26 y6860 ff7 fs19 fc2 sc0 ls286 ws0">)i<span class="_ _42"></span>nt<span class="_ _42"></span>h<span class="_ _42"></span>e</div><div class="t m5 x1d h26 y6861 ff7 fs19 fc2 sc0 ls0 ws0">logical<span class="_ _13"> </span>control<span class="_"> </span>ﬂow<span class="_ _13"> </span>of<span class="_ _13"> </span><span class="ff11">p<span class="_ _2"></span></span>.<span class="_"> </span>However<span class="_ _1"></span>,<span class="_"> </span>if<span class="_ _13"> </span>the<span class="_"> </span>set<span class="_ _13"> </span>is<span class="_ _13"> </span>nonempty<span class="_ _3"></span>,<span class="_"> </span>then<span class="_ _13"> </span>the<span class="_ _13"> </span>kernel<span class="_"> </span>chooses</div><div class="t m5 x1d h26 y6862 ff7 fs19 fc2 sc0 ls0 ws0">some<span class="_ _16"> </span>signal<span class="_ _14"> </span><span class="ff11">k<span class="_ _15"> </span></span>in<span class="_ _14"> </span>the<span class="_ _16"> </span>set<span class="_ _14"> </span>(typically<span class="_ _14"> </span>the<span class="_ _16"> </span>smallest<span class="_ _14"> </span><span class="ff11">k<span class="_ _2"></span></span>)<span class="_ _14"> </span>and<span class="_ _16"> </span>forces<span class="_ _14"> </span><span class="ff11">p<span class="_ _15"> </span></span>to<span class="_ _16"> </span><span class="ffa">receive<span class="_ _14"> </span></span>signal</div><div class="t m5 x1d h26 y6863 ff11 fs19 fc2 sc0 ls0 ws0">k<span class="_ _2"></span><span class="ff7">.<span class="_"> </span>T<span class="_ _0"></span>he<span class="_"> </span>receipt<span class="_"> </span>of<span class="_"> </span>the<span class="_ _11"> </span>signal<span class="_"> </span>triggers<span class="_"> </span>some<span class="_ _11"> </span><span class="ffa">action<span class="_"> </span></span>by<span class="_"> </span>the<span class="_"> </span>process<span class="_ _1"></span>.<span class="_ _11"> </span>Once<span class="_"> </span>the<span class="_"> </span>process</span></div><div class="t m5 x1d h26 y6864 ff7 fs19 fc2 sc0 ls0 ws0">completes<span class="_ _13"> </span>the<span class="_ _13"> </span>action,<span class="_ _13"> </span>then<span class="_ _13"> </span>control<span class="_ _13"> </span>passes<span class="_ _13"> </span>back<span class="_ _13"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>next<span class="_ _13"> </span>instruction<span class="_ _13"> </span>(<span class="ff11">I</span></div><div class="t m5 x6e h3c y6865 ff7 fs25 fc2 sc0 ls0 ws0">next</div><div class="t m5 x216 h26 y6866 ff7 fs19 fc2 sc0 ls287 ws0">)i<span class="_ _80"></span>nt<span class="_ _8"></span>h<span class="_ _8"></span>e</div><div class="t m5 x1d h26 y6867 ff7 fs19 fc2 sc0 ls0 ws0">logical<span class="_ _11"> </span>control<span class="_ _11"> </span>ﬂow<span class="_ _11"> </span>of<span class="_ _11"> </span><span class="ff11">p<span class="_ _2"></span></span>.<span class="_ _11"> </span>Each<span class="_ _11"> </span>signal<span class="_ _11"> </span>type<span class="_ _16"> </span>has<span class="_"> </span>a<span class="_ _11"> </span>predeﬁned<span class="_ _16"> </span><span class="ffa">default<span class="_"> </span>action</span>,<span class="_ _11"> </span>which</div><div class="t m5 x1d h26 y6868 ff7 fs19 fc2 sc0 ls0 ws0">is<span class="_"> </span>one<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>following:</div><div class="t m5 x75 h3d y6869 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y686a ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>process<span class="_"> </span>terminates<span class="_ _1"></span>.</div><div class="t m5 x75 h3d y686b ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y686c ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>process<span class="_"> </span>terminates<span class="_"> </span>and<span class="_"> </span>dumps<span class="_"> </span>core.</div><div class="t m5 x75 h3d y686d ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y686e ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>process<span class="_"> </span>stops<span class="_"> </span>(suspends)<span class="_"> </span>until<span class="_"> </span>restarted<span class="_"> </span>by<span class="_"> </span>a<span class="_"> </span>SIGCONT<span class="_"> </span>signal.</div><div class="t m5 x75 h3d y686f ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y6870 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>process<span class="_"> </span>ignores<span class="_"> </span>the<span class="_"> </span>signal.</div><div class="t m5 x29 h26 y6871 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _f"> </span>8.26<span class="_ _21"> </span>shows<span class="_ _21"> </span>the<span class="_ _21"> </span>default<span class="_ _f"> </span>actions<span class="_ _21"> </span>associated<span class="_ _21"> </span>with<span class="_ _f"> </span>each<span class="_ _21"> </span>type<span class="_ _21"> </span>of<span class="_ _21"> </span>signal.</div><div class="t m5 x1d h26 y6872 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _21"> </span>example<span class="_ _1"></span>,<span class="_ _e"> </span>the<span class="_ _15"> </span>default<span class="_ _15"> </span>action<span class="_ _21"> </span>for<span class="_ _21"> </span>the<span class="_ _21"> </span>receipt<span class="_ _21"> </span>of<span class="_ _21"> </span>a<span class="_ _21"> </span>SIGKILL<span class="_ _21"> </span>is<span class="_ _21"> </span>to<span class="_ _15"> </span>terminate</div><div class="t m5 x1d h26 y6873 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _15"> </span>receiving<span class="_ _14"> </span>process<span class="_ _0"></span>.<span class="_ _14"> </span>On<span class="_ _15"> </span>the<span class="_ _15"> </span>other<span class="_ _15"> </span>hand,<span class="_ _21"> </span>the<span class="_ _15"> </span>default<span class="_ _15"> </span>action<span class="_ _15"> </span>for<span class="_ _15"> </span>the<span class="_ _15"> </span>receipt<span class="_ _14"> </span>of</div><div class="t m5 x1d h26 y6874 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_ _21"> </span>SIGCHLD<span class="_ _21"> </span>is<span class="_ _21"> </span>to<span class="_ _21"> </span>ignore<span class="_ _f"> </span>the<span class="_ _21"> </span>signal.<span class="_ _21"> </span>A<span class="_ _21"> </span>process<span class="_ _21"> </span>can<span class="_ _f"> </span>modify<span class="_ _21"> </span>the<span class="_ _21"> </span>default<span class="_ _21"> </span>action</div><div class="t m5 x1d h26 y6875 ff7 fs19 fc1 sc0 ls0 ws0">associated<span class="_ _14"> </span>with<span class="_ _14"> </span>a<span class="_ _14"> </span>signal<span class="_ _14"> </span>by<span class="_ _14"> </span>using<span class="_ _14"> </span>the<span class="_ _14"> </span><span class="ffd">signal<span class="_ _14"> </span></span>function.<span class="_ _14"> </span>T<span class="_ _0"></span>he<span class="_ _14"> </span>only<span class="_ _14"> </span>exceptions<span class="_ _14"> </span>are</div><div class="t m5 x1d h26 y6876 ff7 fs19 fc1 sc0 ls0 ws0">SIGSTOP<span class="_"> </span>and<span class="_"> </span>SIGKILL,<span class="_"> </span>whose<span class="_"> </span>default<span class="_"> </span>actions<span class="_"> </span>cannot<span class="_"> </span>be<span class="_"> </span>changed.</div><div class="t m5 x126 h2d y6877 ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;signal.h&gt;</div><div class="t m5 x126 h2d y6878 ffd fs1e fc2 sc0 ls0 ws0">typedef<span class="_ _e"> </span>void<span class="_ _1f"> </span>(*sighandler_t)(int);</div><div class="t m5 x126 h2d y6879 ffd fs1e fc2 sc0 ls0 ws0">sighandler_t<span class="_ _e"> </span>signal(int<span class="_ _1f"> </span>signum,<span class="_ _1f"> </span>sighandler_t<span class="_ _e"> </span>handler);</div><div class="t m5 x207 hf1 y687a ff7 fs1f fc2 sc0 ls0 ws0">Returns:<span class="_"> </span>pointer<span class="_"> </span>to<span class="_"> </span>previous<span class="_"> </span>handler<span class="_"> </span>if<span class="_"> </span>OK,<span class="_"> </span>SIG_ERR<span class="_"> </span>on<span class="_"> </span>error<span class="_"> </span>(does<span class="_"> </span>not<span class="_"> </span>set<span class="_"> </span><span class="ffd fs4e">errno</span>)</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
