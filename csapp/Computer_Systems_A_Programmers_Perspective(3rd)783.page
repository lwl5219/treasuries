<div id="pf30f" class="pf w2 h11" data-page-no="30f"><div class="pc pc30f w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg30f.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">782<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>8<span class="_ _3d"> </span>Exceptional<span class="_ _10"> </span>Control<span class="_ _10"> </span>Flow</span></div><div class="t m5 x1f h2d ye7 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _70"> </span><span class="ffd fs1e fc2">printf(&quot;0&quot;);<span class="_ _e"> </span>fflush(stdout);</span></div><div class="t m5 x1f h2d yc4d ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _70"> </span><span class="ffd fs1e fc2">waitpid(-1,<span class="_ _e"> </span>NULL,<span class="_ _1f"> </span>0);</span></div><div class="t m5 x1f h2d yecb ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1b0 h2d yecc ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _20"> </span><span class="ffd fs1e fc2">printf(&quot;3&quot;);<span class="_ _e"> </span>fflush(stdout);</span></div><div class="t m5 x1b0 h2d yecd ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _20"> </span><span class="ffd fs1e fc2">printf(&quot;6&quot;);<span class="_ _e"> </span>exit(0);</span></div><div class="t m5 x1b0 h2d yece ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x18c h2c y669a ffa fs16 fc2 sc0 ls0 ws0">code/ecf/global-waitprob0.c</div><div class="t m5 x1d h42 y669b ff6 fs29 fc6 sc0 ls0 ws0">The<span class="_ _11"> </span><span class="ffd fs2b">wait<span class="_ _16"> </span></span>Function</div><div class="t m5 x1d h26 y669c ff7 fs19 fc1 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _11"> </span><span class="ffd ls0">wait<span class="_ _10"> </span><span class="ff7">function<span class="_"> </span>is<span class="_"> </span>a<span class="_"> </span>simpler<span class="_"> </span>version<span class="_"> </span>of<span class="_"> </span></span>waitpid<span class="ff7">.</span></span></div><div class="t m5 x126 h2d y669d ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;sys/types.h&gt;</div><div class="t m5 x126 h2d y669e ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;sys/wait.h&gt;</div><div class="t m5 x126 h2d y669f ffd fs1e fc2 sc0 ls0 ws0">pid_t<span class="_ _e"> </span>wait(int<span class="_ _1f"> </span>*statusp);</div><div class="t m5 x13c hf2 y66a0 ff7 fs1f fc2 sc0 ls0 ws0">Returns:<span class="_"> </span>PID<span class="_"> </span>of<span class="_"> </span>child<span class="_"> </span>if<span class="_"> </span>OK<span class="_"> </span>or<span class="_"> </span><span class="ff12">−</span>1<span class="_ _13"> </span>on<span class="_"> </span>error</div><div class="t m5 x1d h26 y66a1 ff7 fs19 fc2 sc0 ls0 ws0">Calling<span class="_"> </span><span class="ffd">wait(&amp;status)<span class="_ _10"> </span></span>is<span class="_"> </span>equivalent<span class="_"> </span>to<span class="_"> </span>calling<span class="_"> </span><span class="ffd">waitpid(-1,<span class="_ _16"> </span>&amp;status,<span class="_ _11"> </span>0)</span>.</div><div class="t m5 x1d h42 y66a2 ff6 fs29 fc6 sc0 ls0 ws0">Examples<span class="_ _11"> </span>of<span class="_ _16"> </span>Using<span class="_ _16"> </span><span class="ffd fs2b">waitpid</span></div><div class="t m5 x1d h26 y66a3 ff7 fs19 fc1 sc0 ls0 ws0">Because<span class="_ _16"> </span>the<span class="_ _16"> </span><span class="ffd">waitpid<span class="_ _14"> </span></span>function<span class="_ _16"> </span>is<span class="_ _16"> </span>somewhat<span class="_ _14"> </span>complicated,<span class="_ _14"> </span>it<span class="_ _16"> </span>is<span class="_ _14"> </span>helpful<span class="_ _16"> </span>to<span class="_ _16"> </span>look<span class="_ _14"> </span>at</div><div class="t m5 x1d h26 y66a4 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_ _14"> </span>few<span class="_ _14"> </span>examples<span class="_ _1"></span>.<span class="_ _15"> </span>F<span class="_ _1"></span>igure<span class="_ _15"> </span>8.18<span class="_ _14"> </span>shows<span class="_ _14"> </span>a<span class="_ _14"> </span>program<span class="_ _15"> </span>that<span class="_ _14"> </span>uses<span class="_ _14"> </span><span class="ffd">waitpid<span class="_ _14"> </span></span>to<span class="_ _15"> </span>wait,<span class="_ _15"> </span>in<span class="_ _14"> </span>no</div><div class="t m5 x1d h26 y66a5 ff7 fs19 fc1 sc0 ls0 ws0">particular<span class="_ _13"> </span>order,<span class="_ _13"> </span>for<span class="_ _6"> </span>all<span class="_ _13"> </span>of<span class="_ _13"> </span>its<span class="_ _13"> </span><span class="ff11">N<span class="_ _11"> </span></span>children<span class="_ _13"> </span>to<span class="_ _13"> </span>terminate<span class="_ _1"></span>.<span class="_ _13"> </span>In<span class="_ _13"> </span>line<span class="_ _13"> </span>11,<span class="_ _13"> </span>the<span class="_ _13"> </span>parent<span class="_ _13"> </span>creates</div><div class="t m5 x1d h26 y66a6 ff7 fs19 fc1 sc0 ls0 ws0">each<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span><span class="ff11">N<span class="_ _21"> </span></span>children,<span class="_ _16"> </span>and<span class="_ _11"> </span>in<span class="_ _16"> </span>line<span class="_ _11"> </span>12,<span class="_ _16"> </span>each<span class="_ _16"> </span>child<span class="_ _11"> </span>exits<span class="_ _16"> </span>with<span class="_ _11"> </span>a<span class="_ _16"> </span>unique<span class="_ _11"> </span>exit<span class="_ _16"> </span>status<span class="_ _3"></span>.</div><div class="t m5 x28 h2a y66a7 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">Constants<span class="_ _11"> </span>associated<span class="_ _11"> </span>with<span class="_ _11"> </span>Unix<span class="_ _16"> </span>functions</span></div><div class="t m5 x28 h2b y66a8 ff7 fs1e fc2 sc0 ls0 ws0">Constants<span class="_"> </span>such<span class="_"> </span>as<span class="_ _13"> </span>WNOHANG<span class="_"> </span>and<span class="_"> </span>WUNTRA<span class="_ _3"></span>CED<span class="_"> </span>are<span class="_"> </span>deﬁned<span class="_ _13"> </span>by<span class="_"> </span>system<span class="_"> </span>header<span class="_ _13"> </span>ﬁles<span class="_ _1"></span>.<span class="_"> </span>F<span class="_ _1"></span>or<span class="_"> </span>example<span class="_ _1"></span>,</div><div class="t m5 x28 h2b y66a9 ff7 fs1e fc2 sc0 ls0 ws0">WNOHANG<span class="_"> </span>and<span class="_"> </span>WUNTRA<span class="_ _1"></span>CED<span class="_"> </span>are<span class="_"> </span>deﬁned<span class="_"> </span>(indirectly)<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span><span class="ffd">wait.h<span class="_ _10"> </span></span>header<span class="_"> </span>ﬁle:</div><div class="t m5 x28 h2d y66aa ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Bits<span class="_ _1f"> </span>in<span class="_ _1f"> </span>the<span class="_ _e"> </span>third<span class="_ _1f"> </span>argument<span class="_ _e"> </span>to<span class="_ _1f"> </span>‘waitpid’.<span class="_ _1f"> </span>*/</div><div class="t m5 x28 h2d y66ab ffd fs1e fc2 sc0 ls0 ws0">#define<span class="_ _e"> </span>WNOHANG<span class="_ _46"> </span>1<span class="_ _3f"> </span>/*<span class="_ _1f"> </span>Don’t<span class="_ _1f"> </span>block<span class="_ _e"> </span>waiting.<span class="_ _1f"> </span>*/</div><div class="t m5 x28 h2d y66ac ffd fs1e fc2 sc0 ls0 ws0">#define<span class="_ _e"> </span>WUNTRACED<span class="_ _1a"> </span>2<span class="_ _3f"> </span>/*<span class="_ _1f"> </span>Report<span class="_ _1f"> </span>status<span class="_ _e"> </span>of<span class="_ _1f"> </span>stopped<span class="_ _e"> </span>children.<span class="_ _1f"> </span>*/</div><div class="t m5 x28 h2b y66ad ff7 fs1e fc2 sc0 ls0 ws0">In<span class="_"> </span>order<span class="_"> </span>to<span class="_"> </span>use<span class="_"> </span>these<span class="_"> </span>constants<span class="_ _1"></span>,<span class="_"> </span>you<span class="_"> </span>must<span class="_"> </span>include<span class="_"> </span>the<span class="_"> </span><span class="ffd">wait.h<span class="_ _10"> </span></span>header<span class="_"> </span>ﬁle<span class="_"> </span>in<span class="_"> </span>your<span class="_"> </span>code:</div><div class="t m5 x28 h2d y66ae ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;sys/wait.h&gt;</div><div class="t m5 x28 h2b y66af ff7 fs1e fc2 sc0 ls31 ws0">Th<span class="_ _2"></span>e<span class="_ _16"> </span><span class="ffd ls0">man<span class="_ _11"> </span><span class="ff7">page<span class="_ _11"> </span>for<span class="_ _11"> </span>each<span class="_ _11"> </span>Unix<span class="_ _11"> </span>function<span class="_ _11"> </span>lists<span class="_ _11"> </span>the<span class="_ _11"> </span>header<span class="_ _11"> </span>ﬁles<span class="_ _11"> </span>to<span class="_ _11"> </span>include<span class="_ _11"> </span>whenever<span class="_ _11"> </span>you<span class="_ _11"> </span>use<span class="_ _11"> </span>that<span class="_ _11"> </span>function</span></span></div><div class="t m5 x28 h2b y66b0 ff7 fs1e fc2 sc0 ls0 ws0">in<span class="_ _16"> </span>your<span class="_ _11"> </span>code.<span class="_ _11"> </span>Also,<span class="_ _16"> </span>in<span class="_ _11"> </span>order<span class="_ _16"> </span>to<span class="_ _16"> </span>check<span class="_ _16"> </span>return<span class="_ _16"> </span>codes<span class="_ _16"> </span>such<span class="_ _11"> </span>as<span class="_ _16"> </span>ECHILD<span class="_ _16"> </span>and<span class="_ _16"> </span>EINTR,<span class="_ _16"> </span>you<span class="_ _16"> </span>must<span class="_ _16"> </span>include</div><div class="t m5 x28 h2b y66b1 ffd fs1e fc2 sc0 ls0 ws0">errno.h<span class="ff7">.<span class="_ _10"> </span>T<span class="_ _3"></span>o<span class="_ _11"> </span>simplify<span class="_ _11"> </span>our<span class="_ _10"> </span>code<span class="_ _11"> </span>examples<span class="_ _1"></span>,<span class="_ _11"> </span>we<span class="_ _11"> </span>include<span class="_ _11"> </span>a<span class="_ _11"> </span>single<span class="_ _10"> </span>header<span class="_ _11"> </span>ﬁle<span class="_ _11"> </span>called<span class="_ _11"> </span><span class="ffd">csapp.h<span class="_ _11"> </span></span>that<span class="_ _10"> </span>includes</span></div><div class="t m5 x28 h2b y66b2 ff7 fs1e fc2 sc0 ls0 ws0">the<span class="_ _11"> </span>header<span class="_ _11"> </span>ﬁles<span class="_ _11"> </span>for<span class="_ _16"> </span>all<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>functions<span class="_ _11"> </span>used<span class="_ _16"> </span>in<span class="_ _11"> </span>the<span class="_ _11"> </span>book.<span class="_ _11"> </span>The<span class="_ _10"> </span><span class="ffd">csapp.h<span class="_ _16"> </span></span>header<span class="_ _11"> </span>ﬁle<span class="_ _11"> </span>is<span class="_ _11"> </span>available<span class="_ _11"> </span>online</div><div class="t m5 x28 h2b y66b3 ff7 fs1e fc2 sc0 ls0 ws0">from<span class="_"> </span>the<span class="_"> </span>CS:APP<span class="_"> </span>W<span class="_ _3"></span>eb<span class="_"> </span>site.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
