<div id="pf16d" class="pf w2 h11" data-page-no="16d"><div class="pc pc16d w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg16d.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">364<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x1d h31 ye7 ff7 fs21 fc2 sc0 ls0 ws0">Instruction<span class="_ _14b"> </span>Result</div><div class="t m5 x1d h32 yb20 ffd fs1e fc2 sc0 ls0 ws0">leaq<span class="_ _11"> </span>9(%rdx),<span class="_ _11"> </span>%rax<span class="_ _18b"> </span><span class="ff7 fs21">9<span class="_"> </span><span class="ff12">+<span class="_ _13"></span><span class="ff11">q</span></span></span></div><div class="t m5 x1d h32 y9bb ffd fs1e fc2 sc0 ls0 ws0">leaq<span class="_ _11"> </span>(%rdx,%rbx),<span class="_ _11"> </span>%rax<span class="_ _105"> </span><span class="ff11 fs21">q<span class="_"> </span><span class="ff12">+<span class="_ _13"></span></span>p</span></div><div class="t m5 x1d h32 y9bc ffd fs1e fc2 sc0 ls0 ws0">leaq<span class="_ _11"> </span>(%rdx,%rbx,3),<span class="_ _11"> </span>%rax<span class="_ _75"> </span><span class="ff11 fs21">q<span class="_ _11"> </span><span class="ff12">+<span class="_ _13"></span><span class="ff7">3</span></span>p</span></div><div class="t m5 x1d h32 y9bd ffd fs1e fc2 sc0 ls0 ws0">leaq<span class="_ _11"> </span>2(%rbx,%rbx,7),<span class="_ _11"> </span>%rax<span class="_ _26"> </span><span class="ff7 fs21">2<span class="_"> </span><span class="ff12">+<span class="_ _13"></span></span>8<span class="ff11">p</span></span></div><div class="t m5 x1d h32 y9be ffd fs1e fc2 sc0 ls0 ws0">leaq<span class="_ _11"> </span>0xE(,%rdx,3),<span class="_ _11"> </span>%rax<span class="_ _2e"> </span><span class="ff7 fs21">14<span class="_"> </span><span class="ff12">+<span class="_ _13"></span></span>3<span class="_ _0"></span><span class="ff11">q</span></span></div><div class="t m5 x1d h32 y18a5 ffd fs1e fc2 sc0 ls0 ws0">leaq<span class="_ _11"> </span>6(%rbx,%rdx,7),<span class="_ _11"> </span>%rdx<span class="_ _26"> </span><span class="ff7 fs21">6<span class="_ _13"> </span><span class="ff12">+<span class="_ _13"> </span><span class="ff11">p<span class="_ _10"> </span></span>+<span class="_ _13"> </span></span>7<span class="ff11">q</span></span></div><div class="t m5 x1d h28 y334a ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>3.7<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>229)</span></div><div class="t m5 x1d h26 y334b ff7 fs19 fc1 sc0 ls0 ws0">Again,<span class="_ _15"> </span>reverse<span class="_ _14"> </span>engineering<span class="_ _14"> </span>proves<span class="_ _15"> </span>to<span class="_ _14"> </span>be<span class="_ _14"> </span>a<span class="_ _14"> </span>useful<span class="_ _15"> </span>way<span class="_ _14"> </span>to<span class="_ _14"> </span>learn<span class="_ _14"> </span>the<span class="_ _15"> </span>relationship</div><div class="t m5 x1d h26 y334c ff7 fs19 fc1 sc0 ls0 ws0">between<span class="_"> </span>C<span class="_"> </span>code<span class="_"> </span>and<span class="_"> </span>the<span class="_"> </span>generated<span class="_"> </span>assembly<span class="_"> </span>code<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y334d ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _13"> </span>best<span class="_ _13"> </span>way<span class="_ _6"> </span>to<span class="_ _13"> </span>solve<span class="_ _6"> </span>problems<span class="_ _13"> </span>of<span class="_ _13"> </span>this<span class="_ _6"> </span>type<span class="_ _13"> </span>is<span class="_ _6"> </span>to<span class="_ _13"> </span>annotate<span class="_ _6"> </span>the<span class="_ _13"> </span>lines<span class="_ _13"> </span>of<span class="_ _6"> </span>assembly</div><div class="t m5 x1d h26 y334e ff7 fs19 fc1 sc0 ls0 ws0">code<span class="_"> </span>with<span class="_"> </span>information<span class="_"> </span>about<span class="_"> </span>the<span class="_"> </span>operations<span class="_"> </span>being<span class="_"> </span>performed.<span class="_"> </span>Here<span class="_"> </span>is<span class="_"> </span>a<span class="_"> </span>sample:</div><div class="t m5 x17e h61 y334f ff13 fs35 fc6 sc0 ls0 ws0">short<span class="_ _f"> </span>scale3(short<span class="_ _f"> </span>x,<span class="_ _f"> </span>short<span class="_ _e"> </span>y,<span class="_ _21"> </span>short<span class="_ _f"> </span>z)</div><div class="t m5 x17e h61 y3350 ff13 fs35 fc6 sc0 ls0 ws0">x<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi,<span class="_ _f"> </span>y<span class="_ _e"> </span>in<span class="_ _21"> </span>%rsi,<span class="_ _f"> </span>z<span class="_ _e"> </span>in<span class="_ _21"> </span>%rdx</div><div class="t m5 x1d h2d y3351 ffd fs1e fc2 sc0 ls0 ws0">scale3:</div><div class="t m5 x75 h2d y3352 ffd fs1e fc2 sc0 ls0 ws0">leaq<span class="_ _46"> </span>(%rsi,%rsi,9),<span class="_ _e"> </span>%rbx</div><div class="t m5 x24 h61 y3353 ff13 fs35 fc6 sc0 ls156 ws0">1<span class="_ _8a"></span>0*y</div><div class="t m5 x75 h2d y3354 ffd fs1e fc2 sc0 ls0 ws0">leaq<span class="_ _46"> </span>(%rbx,%rdx),<span class="_ _e"> </span>%rbx<span class="_ _2a"> </span><span class="ff13 fs35 fc6 ls156">1<span class="_ _8a"></span>0*y+z</span></div><div class="t m5 x75 h2d y3355 ffd fs1e fc2 sc0 ls0 ws0">leaq<span class="_ _46"> </span>(%rbx,%rdi,%rsi),<span class="_ _e"> </span>%rbx<span class="_ _b2"> </span><span class="ff13 fs35 fc6 ls156">1<span class="_ _8a"></span>0*y+z+y*x</span></div><div class="t m5 x75 h2d y3356 ffd fs1e fc2 sc0 ls0 ws0">ret</div><div class="t m5 x1d h26 y3357 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>rom<span class="_"> </span>this<span class="_ _1"></span>,<span class="_"> </span>it<span class="_"> </span>is<span class="_"> </span>easy<span class="_"> </span>to<span class="_"> </span>generate<span class="_"> </span>the<span class="_"> </span>missing<span class="_"> </span>expression:</div><div class="t m5 x10c h2d y3358 ffd fs1e fc2 sc0 ls0 ws0">shor<span class="ls33">tt=1<span class="_ _41"></span>0*y+z+y*x<span class="_ _41"></span>;</span></div><div class="t m5 x1d h28 y3359 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>3.8</div><div class="t m5 x1ed h2f y335a ffe fs16 fc6 sc0 ls0 ws0">(page<span class="_"> </span>230)</div><div class="t m5 x1d h26 y335b ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _11"> </span>problem<span class="_"> </span>gives<span class="_ _11"> </span>you<span class="_ _11"> </span>a<span class="_"> </span>chance<span class="_ _11"> </span>to<span class="_"> </span>test<span class="_ _11"> </span>your<span class="_"> </span>understanding<span class="_ _11"> </span>of<span class="_"> </span>operands<span class="_ _11"> </span>and<span class="_ _11"> </span>the</div><div class="t m5 x1d h26 y335c ff7 fs19 fc1 sc0 ls0 ws0">arithmetic<span class="_"> </span>instructions<span class="_ _1"></span>.<span class="_"> </span>The<span class="_"> </span>instruction<span class="_"> </span>sequence<span class="_"> </span>is<span class="_"> </span>designed<span class="_ _11"> </span>so<span class="_"> </span>that<span class="_ _11"> </span>the<span class="_"> </span>result<span class="_"> </span>of</div><div class="t m5 x1d h26 y335d ff7 fs19 fc1 sc0 ls0 ws0">each<span class="_"> </span>instruction<span class="_"> </span>does<span class="_"> </span>not<span class="_"> </span>affect<span class="_"> </span>the<span class="_"> </span>behavior<span class="_"> </span>of<span class="_"> </span>subsequent<span class="_"> </span>ones<span class="_ _1"></span>.</div><div class="t m5 x1d h31 y335e ff7 fs21 fc2 sc0 ls0 ws0">Instruction<span class="_ _14d"> </span>Destination<span class="_ _26"> </span>V<span class="_ _7"></span>alue</div><div class="t m5 x1d h2d y335f ffd fs1e fc2 sc0 ls0 ws0">addq<span class="_ _11"> </span>%rcx,(%rax)<span class="_ _18b"> </span>0x100<span class="_ _30"> </span>0x100</div><div class="t m5 x1d h2d y3360 ffd fs1e fc2 sc0 ls0 ws0">subq<span class="_ _11"> </span>%rdx,8(%rax)<span class="_ _121"> </span>0x108<span class="_ _30"> </span>0xA8</div><div class="t m5 x1d h2d y3361 ffd fs1e fc2 sc0 ls0 ws0">imulq<span class="_ _11"> </span>$16,(%rax,%rdx,8)<span class="_ _26"> </span>0x118<span class="_ _30"> </span>0x110</div><div class="t m5 x1d h2d y3362 ffd fs1e fc2 sc0 ls0 ws0">incq<span class="_ _11"> </span>16(%rax)<span class="_ _158"> </span>0x110<span class="_ _30"> </span>0x14</div><div class="t m5 x1d h2d y3363 ffd fs1e fc2 sc0 ls0 ws0">decq<span class="_ _11"> </span>%rcx<span class="_ _18d"> </span>%rcx<span class="_ _87"> </span>0x0</div><div class="t m5 x1d h2d y3364 ffd fs1e fc2 sc0 ls0 ws0">subq<span class="_ _11"> </span>%rdx,%rax<span class="_ _7a"> </span>%rax<span class="_ _156"> </span>0xFD</div><div class="t m5 x1d h28 y3365 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>3.9</div><div class="t m5 x1ed h2f y229f ffe fs16 fc6 sc0 ls0 ws0">(page<span class="_"> </span>231)</div><div class="t m5 x1d h26 y107b ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _15"> </span>exercise<span class="_ _14"> </span>gives<span class="_ _15"> </span>you<span class="_ _14"> </span>a<span class="_ _15"> </span>chance<span class="_ _15"> </span>to<span class="_ _14"> </span>generate<span class="_ _15"> </span>a<span class="_ _14"> </span>little<span class="_ _15"> </span>bit<span class="_ _14"> </span>of<span class="_ _15"> </span>assembly<span class="_ _14"> </span>code.<span class="_ _14"> </span>T<span class="_ _1"></span>he</div><div class="t m5 x1d h26 y21fc ff7 fs19 fc1 sc0 ls0 ws0">solution<span class="_ _11"> </span>code<span class="_ _16"> </span>was<span class="_ _16"> </span>generated<span class="_ _11"> </span>by<span class="_ _16"> </span><span class="ff9">gcc</span>.<span class="_ _11"> </span>By<span class="_ _16"> </span>loading<span class="_ _11"> </span>parameter<span class="_ _16"> </span><span class="ffd">n<span class="_ _16"> </span></span>in<span class="_ _11"> </span>register<span class="_ _16"> </span><span class="ffd">%ecx</span><span class="ls197">,i<span class="_ _42"></span>t</span></div><div class="t m5 x1d h26 y3366 ff7 fs19 fc1 sc0 ls0 ws0">can<span class="_ _13"> </span>then<span class="_"> </span>use<span class="_ _13"> </span>byte<span class="_ _13"> </span>register<span class="_ _13"> </span><span class="ffd">%cl<span class="_ _10"> </span></span>to<span class="_ _13"> </span>specify<span class="_ _13"> </span>the<span class="_ _13"> </span>shift<span class="_"> </span>amount<span class="_ _13"> </span>for<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ffd">sarq<span class="_ _10"> </span></span>instruction.</div><div class="t m5 x1d h26 y3367 ff7 fs19 fc1 sc0 ls0 ws0">It<span class="_ _11"> </span>might<span class="_ _11"> </span>seem<span class="_ _16"> </span>odd<span class="_"> </span>to<span class="_ _16"> </span>use<span class="_ _11"> </span>a<span class="_ _11"> </span><span class="ffd">movl<span class="_ _11"> </span></span>instruction,<span class="_ _16"> </span>given<span class="_ _11"> </span>that<span class="_ _11"> </span><span class="ffd">n<span class="_ _11"> </span></span>is<span class="_ _16"> </span>eight<span class="_ _11"> </span>bytes<span class="_ _11"> </span>long,<span class="_ _11"> </span>but</div><div class="t m5 x1d h26 yc03 ff7 fs19 fc1 sc0 ls0 ws0">keep<span class="_ _14"> </span>in<span class="_ _16"> </span>mind<span class="_ _14"> </span>that<span class="_ _14"> </span>only<span class="_ _14"> </span>the<span class="_ _14"> </span>least<span class="_ _14"> </span>signiﬁcant<span class="_ _14"> </span>byte<span class="_ _14"> </span>is<span class="_ _14"> </span>required<span class="_ _14"> </span>to<span class="_ _16"> </span>specify<span class="_ _14"> </span>the<span class="_ _14"> </span>shift</div><div class="t m5 x1d h26 yc04 ff7 fs19 fc1 sc0 ls0 ws0">amount.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
