<div id="pf3a4" class="pf w2 h11" data-page-no="3a4"><div class="pc pc3a4 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg3a4.png"/><div class="t m5 x205 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>10.4<span class="_ _60"> </span>Reading<span class="_ _10"> </span>and<span class="_ _10"> </span>Writing<span class="_ _10"> </span>Files<span class="_ _1b"> </span><span class="ffe fs1e">931</span></div><div class="t m5 x17 h47 yb1f ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>10.1<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>951)</span></div><div class="t m5 x17 h26 y9ba ff7 fs19 fc1 sc0 ls0 ws0">What<span class="_"> </span>is<span class="_"> </span>the<span class="_"> </span>output<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>program?</div><div class="t m5 x2c h2d y7774 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">#include<span class="_ _1f"> </span>&quot;csapp.h&quot;</span></div><div class="t m5 x2c h2e y7775 ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x2c h2e y7776 ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x2d h2d y7777 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>main()</div><div class="t m5 x2c h2d y7778 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x2c h2d y7779 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _20"> </span><span class="ffd fs1e fc2">int<span class="_ _e"> </span>fd1,<span class="_ _1f"> </span>fd2;</span></div><div class="t m5 x2c h2e y777a ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 x2c h2e y777b ff6 fs20 fc6 sc0 ls0 ws0">7</div><div class="t m5 x142 h2d y777c ffd fs1e fc2 sc0 ls0 ws0">fd1<span class="_ _e"> </span>=<span class="_ _1f"> </span>Open(&quot;foo.txt&quot;,<span class="_ _1f"> </span>O_RDONLY,<span class="_ _e"> </span>0);</div><div class="t m5 x2c h2d y777d ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _20"> </span><span class="ffd fs1e fc2">Close(fd1);</span></div><div class="t m5 x2c h2e y777e ff6 fs20 fc6 sc0 ls0 ws0">9</div><div class="t m5 x142 h2d y777f ffd fs1e fc2 sc0 ls0 ws0">fd2<span class="_ _e"> </span>=<span class="_ _1f"> </span>Open(&quot;baz.txt&quot;,<span class="_ _1f"> </span>O_RDONLY,<span class="_ _e"> </span>0);</div><div class="t m5 x17 h2d y7780 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _20"> </span><span class="ffd fs1e fc2">printf(&quot;fd2<span class="_ _e"> </span>=<span class="_ _1f"> </span>%d\n&quot;,<span class="_ _1f"> </span>fd2);</span></div><div class="t m5 x17 h2d y7781 ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _20"> </span><span class="ffd fs1e fc2">exit(0);</span></div><div class="t m5 x17 h2d y7782 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x17 h3b y7783 fff fs24 fc6 sc0 ls0 ws0">10.4<span class="_ _17"> </span><span class="ffe fs18">Reading<span class="_"> </span>and<span class="_"> </span>Writing<span class="_"> </span>Files</span></div><div class="t m5 x17 h26 y7784 ff7 fs19 fc1 sc0 ls0 ws0">Applications<span class="_ _11"> </span>perform<span class="_ _11"> </span>input<span class="_ _11"> </span>and<span class="_ _11"> </span>output<span class="_ _11"> </span>by<span class="_ _16"> </span>calling<span class="_"> </span>the<span class="_ _11"> </span><span class="ffd">read<span class="_ _16"> </span></span>and<span class="_"> </span><span class="ffd">write<span class="_ _16"> </span></span>functions<span class="_ _3"></span>,</div><div class="t m5 x17 h26 y7785 ff7 fs19 fc1 sc0 ls0 ws0">respectively<span class="_ _3"></span>.</div><div class="t m5 x31 h2d y7786 ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;unistd.h&gt;</div><div class="t m5 x31 h2d y7787 ffd fs1e fc2 sc0 ls0 ws0">ssize_t<span class="_ _e"> </span>read(int<span class="_ _1f"> </span>fd,<span class="_ _1f"> </span>void<span class="_ _e"> </span>*buf,<span class="_ _1f"> </span>size_t<span class="_ _e"> </span>n);</div><div class="t m5 x112 hf2 y7788 ff7 fs1f fc2 sc0 ls0 ws0">Returns:<span class="_"> </span>number<span class="_"> </span>of<span class="_"> </span>bytes<span class="_"> </span>read<span class="_"> </span>if<span class="_"> </span>OK,<span class="_"> </span>0<span class="_"> </span>on<span class="_"> </span>EOF<span class="_ _3"></span>,<span class="_"> </span><span class="ff12">−</span>1<span class="_ _13"> </span>on<span class="_"> </span>error</div><div class="t m5 x31 h2d y7789 ffd fs1e fc2 sc0 ls0 ws0">ssize_t<span class="_ _e"> </span>write(int<span class="_ _1f"> </span>fd,<span class="_ _1f"> </span>const<span class="_ _e"> </span>void<span class="_ _1f"> </span>*buf,<span class="_ _e"> </span>size_t<span class="_ _1f"> </span>n);</div><div class="t m5 xab hf2 y778a ff7 fs1f fc2 sc0 ls0 ws0">Returns:<span class="_"> </span>number<span class="_"> </span>of<span class="_"> </span>bytes<span class="_"> </span>written<span class="_"> </span>if<span class="_"> </span>OK,<span class="_"> </span><span class="ff12">−</span>1<span class="_ _13"> </span>on<span class="_"> </span>error</div><div class="t m5 x17 h26 y2455 ff7 fs19 fc2 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_"> </span><span class="ffd ls0">read<span class="_ _a"> </span><span class="ff7">function<span class="_ _6"> </span>copies<span class="_ _6"> </span>at<span class="_ _13"> </span>most<span class="_ _a"> </span></span>n<span class="_ _6"> </span><span class="ff7">bytes<span class="_ _6"> </span>from<span class="_ _6"> </span>the<span class="_ _6"> </span>current<span class="_ _6"> </span>ﬁle<span class="_ _13"> </span>position<span class="_ _a"> </span>of<span class="_ _6"> </span>descriptor</span></span></div><div class="t m5 x17 h46 y2456 ffd fs19 fc2 sc0 ls0 ws0">fd<span class="_ _10"> </span><span class="ff7">to<span class="_"> </span>memory<span class="_"> </span>location<span class="_"> </span></span>buf<span class="ff7">.<span class="_"> </span>A<span class="_"> </span>return<span class="_"> </span>value<span class="_"> </span>of<span class="_"> </span><span class="ff12">−</span>1<span class="_ _13"> </span>indicates<span class="_"> </span>an<span class="_"> </span>error<span class="_ _0"></span>,<span class="_"> </span>and<span class="_"> </span>a<span class="_"> </span>return</span></div><div class="t m5 x17 h26 y2457 ff7 fs19 fc2 sc0 ls0 ws0">value<span class="_ _14"> </span>of<span class="_ _14"> </span>0<span class="_ _15"> </span>indicates<span class="_ _14"> </span>EOF<span class="_ _7"></span>.<span class="_ _15"> </span>Otherwise<span class="_ _1"></span>,<span class="_ _21"> </span>the<span class="_ _14"> </span>return<span class="_ _14"> </span>value<span class="_ _15"> </span>indicates<span class="_ _14"> </span>the<span class="_ _14"> </span>number<span class="_ _15"> </span>of</div><div class="t m5 x17 h26 y2458 ff7 fs19 fc2 sc0 ls0 ws0">bytes<span class="_"> </span>that<span class="_"> </span>were<span class="_"> </span>actually<span class="_"> </span>transferred.</div><div class="t m5 x26 h26 y2459 ff7 fs19 fc2 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _16"> </span><span class="ffd ls0">write<span class="_ _11"> </span><span class="ff7">function<span class="_"> </span>copies<span class="_ _11"> </span>at<span class="_ _11"> </span>most<span class="_ _11"> </span></span>n<span class="_ _11"> </span><span class="ff7">bytes<span class="_"> </span>from<span class="_ _11"> </span>memory<span class="_ _11"> </span>location<span class="_ _11"> </span></span>buf<span class="_ _11"> </span><span class="ff7">to<span class="_"> </span>the</span></span></div><div class="t m5 x17 h26 y4fe ff7 fs19 fc2 sc0 ls0 ws0">current<span class="_"> </span>ﬁle<span class="_"> </span>position<span class="_"> </span>of<span class="_"> </span>descriptor<span class="_ _13"> </span><span class="ffd">fd</span>.<span class="_"> </span>Figure<span class="_"> </span>10.3<span class="_ _13"> </span>shows<span class="_"> </span>a<span class="_"> </span>program<span class="_"> </span>that<span class="_"> </span>uses<span class="_"> </span><span class="ffd">read</span></div><div class="t m5 x17 h26 y4ff ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_ _13"> </span><span class="ffd">write<span class="_ _13"> </span></span>calls<span class="_ _13"> </span>to<span class="_ _13"> </span>copy<span class="_ _13"> </span>the<span class="_ _13"> </span>standard<span class="_ _13"> </span>input<span class="_ _13"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>standard<span class="_ _13"> </span>output,<span class="_ _13"> </span>1<span class="_ _13"> </span>byte<span class="_ _13"> </span>at<span class="_ _13"> </span>a<span class="_ _13"> </span>time<span class="_ _0"></span>.</div><div class="t m5 x26 h26 y500 ff7 fs19 fc2 sc0 ls0 ws0">Applications<span class="_ _f"> </span>can<span class="_ _f"> </span>explicitly<span class="_ _f"> </span>modify<span class="_ _f"> </span>the<span class="_ _f"> </span>current<span class="_ _f"> </span>ﬁle<span class="_ _f"> </span>position<span class="_ _f"> </span>by<span class="_ _f"> </span>calling<span class="_ _f"> </span>the</div><div class="t m5 x17 h26 y501 ffd fs19 fc2 sc0 ls0 ws0">lseek<span class="_ _10"> </span><span class="ff7">function,<span class="_"> </span>which<span class="_"> </span>is<span class="_"> </span>beyond<span class="_"> </span>our<span class="_"> </span>scope<span class="_ _0"></span>.</span></div><div class="t m5 x26 h26 y502 ff7 fs19 fc2 sc0 ls0 ws0">In<span class="_"> </span>some<span class="_"> </span>situations<span class="_ _1"></span>,<span class="_"> </span><span class="ffd">read<span class="_ _11"> </span></span>and<span class="_"> </span><span class="ffd">write<span class="_ _10"> </span></span>transfer<span class="_"> </span>fewer<span class="_"> </span>bytes<span class="_"> </span>than<span class="_"> </span>the<span class="_ _11"> </span>application</div><div class="t m5 x17 h26 y503 ff7 fs19 fc2 sc0 ls0 ws0">requests<span class="_ _1"></span>.<span class="_"> </span>Such<span class="_ _11"> </span><span class="ffa">short<span class="_ _11"> </span>counts<span class="_ _11"> </span></span>do<span class="_ _11"> </span><span class="ffa">not<span class="_ _16"> </span></span>indicate<span class="_ _11"> </span>an<span class="_ _11"> </span>error.<span class="_"> </span>T<span class="_ _1"></span>hey<span class="_ _11"> </span>occur<span class="_ _11"> </span>for<span class="_ _11"> </span>a<span class="_ _11"> </span>number<span class="_"> </span>of</div><div class="t m5 x17 h26 y504 ff7 fs19 fc2 sc0 ls0 ws0">reasons:</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
