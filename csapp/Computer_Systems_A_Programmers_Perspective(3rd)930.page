<div id="pf3a2" class="pf w2 h11" data-page-no="3a2"><div class="pc pc3a2 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg3a2.png"/><div class="t m5 xc0 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>10.3<span class="_ _60"> </span>Opening<span class="_ _10"> </span>and<span class="_ _10"> </span>Closing<span class="_ _10"> </span>Files<span class="_ _3e"> </span><span class="ffe fs1e">929</span></div><div class="t m5 x26 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">Locations<span class="_ _13"> </span>in<span class="_"> </span>the<span class="_ _13"> </span>directory<span class="_ _13"> </span>hierarchy<span class="_"> </span>are<span class="_ _13"> </span>speciﬁed<span class="_"> </span>by<span class="_ _13"> </span><span class="ffa">pathnames</span>.<span class="_ _13"> </span>A<span class="_"> </span>pathname</div><div class="t m5 x17 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">is<span class="_ _15"> </span>a<span class="_ _15"> </span>string<span class="_ _15"> </span>consisting<span class="_ _15"> </span>of<span class="_ _15"> </span>an<span class="_ _15"> </span>optional<span class="_ _15"> </span>slash<span class="_ _15"> </span>followed<span class="_ _15"> </span>by<span class="_ _21"> </span>a<span class="_ _15"> </span>sequence<span class="_ _15"> </span>of<span class="_ _15"> </span>ﬁlenames</div><div class="t m5 x17 h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">separated<span class="_"> </span>by<span class="_"> </span>slashes<span class="_ _1"></span>.<span class="_"> </span>Pathnames<span class="_"> </span>have<span class="_"> </span>two<span class="_"> </span>forms:</div><div class="t m5 x72 h3d y7738 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y7739 ff7 fs19 fc1 sc0 ls0 ws0">An<span class="_ _16"> </span><span class="ffa">absolute<span class="_ _16"> </span>pathname<span class="_ _14"> </span></span>starts<span class="_ _16"> </span>with<span class="_ _16"> </span>a<span class="_ _16"> </span>slash<span class="_ _14"> </span>and<span class="_ _16"> </span>denotes<span class="_ _16"> </span>a<span class="_ _14"> </span>path<span class="_ _16"> </span>from<span class="_ _16"> </span>the<span class="_ _16"> </span>root</div><div class="t m5 x26 h26 y773a ff7 fs19 fc1 sc0 ls0 ws0">node<span class="_ _1"></span>.<span class="_ _f"> </span>F<span class="_ _1"></span>or<span class="_ _21"> </span>example,<span class="_ _f"> </span>in<span class="_ _21"> </span>Figure<span class="_ _15"> </span>10.1,<span class="_ _e"> </span>the<span class="_ _21"> </span>absolute<span class="_ _21"> </span>pathname<span class="_ _21"> </span>for<span class="_ _f"> </span><span class="ffd">hello.c<span class="_ _21"> </span></span>is</div><div class="t m5 x26 h26 y773b ffd fs19 fc1 sc0 ls0 ws0">/home/droh/hello.c<span class="ff7">.</span></div><div class="t m5 x72 h3d y773c ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y773d ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_ _6"> </span><span class="ffa">relative<span class="_ _13"> </span>pathname<span class="_ _13"> </span></span>starts<span class="_ _6"> </span>with<span class="_ _6"> </span>a<span class="_ _13"> </span>ﬁlename<span class="_ _6"> </span>and<span class="_ _13"> </span>denotes<span class="_ _6"> </span>a<span class="_ _13"> </span>path<span class="_ _6"> </span>from<span class="_ _13"> </span>the<span class="_ _6"> </span>current</div><div class="t m5 x26 h26 y773e ff7 fs19 fc1 sc0 ls0 ws0">working<span class="_ _11"> </span>directory<span class="_ _3"></span>.<span class="_ _16"> </span>F<span class="_ _3"></span>or<span class="_ _16"> </span>example<span class="_ _1"></span>,<span class="_ _16"> </span>in<span class="_ _16"> </span>F<span class="_ _1"></span>igure<span class="_ _16"> </span>10.1,<span class="_ _11"> </span>if<span class="_ _16"> </span><span class="ffd">/home/droh<span class="_ _11"> </span></span>is<span class="_ _11"> </span>the<span class="_ _16"> </span>current</div><div class="t m5 x26 h26 y773f ff7 fs19 fc1 sc0 ls0 ws0">working<span class="_"> </span>directory<span class="_ _7"></span>,<span class="_"> </span>then<span class="_"> </span>the<span class="_"> </span>relative<span class="_"> </span>pathname<span class="_"> </span>for<span class="_ _13"> </span><span class="ffd">hello.c<span class="_ _10"> </span></span>is<span class="_"> </span><span class="ffd">./hello.c</span><span class="ls2d2">.O<span class="_ _4a"></span>n</span></div><div class="t m5 x26 h26 y7740 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _16"> </span>other<span class="_ _14"> </span>hand,<span class="_ _14"> </span>if<span class="_ _14"> </span><span class="ffd">/home/bryant<span class="_ _14"> </span></span>is<span class="_ _16"> </span>the<span class="_ _14"> </span>current<span class="_ _14"> </span>working<span class="_ _16"> </span>directory<span class="_ _3"></span>,<span class="_ _15"> </span>then<span class="_ _16"> </span>the</div><div class="t m5 x26 h26 y7741 ff7 fs19 fc1 sc0 ls0 ws0">relative<span class="_"> </span>pathname<span class="_"> </span>is<span class="_"> </span><span class="ffd">../home/droh/hello.c</span>.</div><div class="t m5 x17 h3b y7742 fff fs24 fc6 sc0 ls0 ws0">10.3</div><div class="t m5 x123 h3e y7743 ffe fs18 fc6 sc0 ls0 ws0">Opening<span class="_"> </span>and<span class="_"> </span>Closing<span class="_"> </span>Files</div><div class="t m5 x17 h26 y7744 ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_"> </span>process<span class="_"> </span>opens<span class="_ _13"> </span>an<span class="_"> </span>existing<span class="_"> </span>ﬁle<span class="_"> </span>or<span class="_"> </span>creates<span class="_ _13"> </span>a<span class="_"> </span>new<span class="_"> </span>ﬁle<span class="_"> </span>by<span class="_"> </span>calling<span class="_ _13"> </span>the<span class="_"> </span><span class="ffd">open<span class="_ _10"> </span></span>function.</div><div class="t m5 x31 h2d y7745 ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;sys/types.h&gt;</div><div class="t m5 x31 h2d y7746 ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;sys/stat.h&gt;</div><div class="t m5 x31 h2d y7747 ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;fcntl.h&gt;</div><div class="t m5 x31 h2d y7748 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>open(char<span class="_ _1f"> </span>*filename,<span class="_ _1f"> </span>int<span class="_ _e"> </span>flags,<span class="_ _1f"> </span>mode_t<span class="_ _e"> </span>mode);</div><div class="t m5 xba hf2 y7749 ff7 fs1f fc2 sc0 ls0 ws0">Returns:<span class="_"> </span>new<span class="_"> </span>ﬁle<span class="_"> </span>descriptor<span class="_"> </span>if<span class="_"> </span>OK,<span class="_"> </span><span class="ff12">−</span>1<span class="_ _13"> </span>on<span class="_"> </span>error</div><div class="t m5 x17 h26 y774a ff7 fs19 fc2 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _15"> </span><span class="ffd ls0">open<span class="_ _14"> </span><span class="ff7">function<span class="_ _14"> </span>converts<span class="_ _16"> </span>a<span class="_ _14"> </span></span>filename<span class="_ _14"> </span><span class="ff7">to<span class="_ _14"> </span>a<span class="_ _14"> </span>ﬁle<span class="_ _14"> </span>descriptor<span class="_ _16"> </span>and<span class="_ _14"> </span>returns<span class="_ _14"> </span>the<span class="_ _14"> </span>de-</span></span></div><div class="t m5 x17 h26 y774b ff7 fs19 fc2 sc0 ls0 ws0">scriptor<span class="_"> </span>number.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>descriptor<span class="_"> </span>returned<span class="_"> </span>is<span class="_"> </span>always<span class="_"> </span>the<span class="_"> </span>smallest<span class="_"> </span>descriptor<span class="_"> </span>that<span class="_"> </span>is</div><div class="t m5 x17 h26 y774c ff7 fs19 fc2 sc0 ls0 ws0">not<span class="_"> </span>currently<span class="_ _13"> </span>open<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>process<span class="_ _3"></span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span><span class="ffd">flags<span class="_ _10"> </span></span>argument<span class="_"> </span>indicates<span class="_"> </span>how<span class="_ _13"> </span>the<span class="_"> </span>process</div><div class="t m5 x17 h26 y774d ff7 fs19 fc2 sc0 ls0 ws0">intends<span class="_"> </span>to<span class="_"> </span>access<span class="_"> </span>the<span class="_"> </span>ﬁle:</div><div class="t m5 x72 h26 y774e ff7 fs19 fc2 sc0 ls0 ws0">O_RDONL<span class="_ _7"></span>Y<span class="_ _7"></span>.<span class="_ _1f"> </span>Reading<span class="_"> </span>only</div><div class="t m5 x72 h26 y774f ff7 fs19 fc2 sc0 ls0 ws0">O_WRONL<span class="_ _4"></span>Y<span class="_ _7"></span>.<span class="_ _1f"> </span>Writing<span class="_"> </span>only</div><div class="t m5 x72 h26 y7750 ff7 fs19 fc2 sc0 ls0 ws0">O_RD<span class="_ _1"></span>WR.<span class="_ _1f"> </span>Reading<span class="_"> </span>and<span class="_"> </span>writing</div><div class="t m5 x17 h26 y7751 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_"> </span>example<span class="_ _1"></span>,<span class="_"> </span>here<span class="_"> </span>is<span class="_"> </span>how<span class="_"> </span>to<span class="_"> </span>open<span class="_"> </span>an<span class="_"> </span>existing<span class="_"> </span>ﬁle<span class="_"> </span>for<span class="_"> </span>reading:</div><div class="t m5 x1b6 h2d y7752 ffd fs1e fc2 sc0 ls0 ws0">fd<span class="_ _e"> </span>=<span class="_ _1f"> </span>Open(&quot;foo.txt&quot;,<span class="_ _1f"> </span>O_RDONLY,<span class="_ _e"> </span>0);</div><div class="t m5 x26 h26 y7753 ff7 fs19 fc2 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_"> </span><span class="ffd ls0">flags<span class="_ _13"> </span><span class="ff7">argument<span class="_ _6"> </span>can<span class="_ _13"> </span>also<span class="_ _13"> </span>be<span class="_ _6"> </span><span class="ff9">or</span>ed<span class="_ _13"> </span>with<span class="_ _6"> </span>one<span class="_ _13"> </span>or<span class="_ _13"> </span>more<span class="_ _6"> </span>bit<span class="_ _13"> </span>masks<span class="_ _6"> </span>that<span class="_ _13"> </span>provide</span></span></div><div class="t m5 x17 h26 y7754 ff7 fs19 fc2 sc0 ls0 ws0">additional<span class="_"> </span>instructions<span class="_"> </span>for<span class="_"> </span>writing:</div><div class="t m5 x72 h26 y7755 ff7 fs19 fc2 sc0 ls0 ws0">O_CREA<span class="_ _3"></span>T<span class="_ _3"></span>.<span class="_ _1f"> </span>If<span class="_ _14"> </span>the<span class="_ _14"> </span>ﬁle<span class="_ _14"> </span>doesn’t<span class="_ _16"> </span>exist,<span class="_ _15"> </span>then<span class="_ _14"> </span>create<span class="_ _14"> </span>a<span class="_ _15"> </span><span class="ffa">truncated<span class="_ _14"> </span></span>(empty)<span class="_ _15"> </span>version</div><div class="t m5 x30 h26 y7756 ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_"> </span>it.</div><div class="t m5 x72 h26 y7757 ff7 fs19 fc2 sc0 ls0 ws0">O_TR<span class="_ _1"></span>UNC.<span class="_ _e"> </span>If<span class="_"> </span>the<span class="_"> </span>ﬁle<span class="_"> </span>already<span class="_"> </span>exists<span class="_ _1"></span>,<span class="_"> </span>then<span class="_"> </span>truncate<span class="_"> </span>it.</div><div class="t m5 x72 h26 y7758 ff7 fs19 fc2 sc0 ls0 ws0">O_APPEND<span class="_ _3"></span>.<span class="_ _1f"> </span>Before<span class="_ _16"> </span>each<span class="_ _16"> </span>write<span class="_ _16"> </span>operation,<span class="_ _16"> </span>set<span class="_ _16"> </span>the<span class="_ _16"> </span>ﬁle<span class="_ _16"> </span>position<span class="_ _16"> </span>to<span class="_ _16"> </span>the<span class="_ _16"> </span>end<span class="_ _16"> </span>of</div><div class="t m5 x30 h26 y7759 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>ﬁle<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
