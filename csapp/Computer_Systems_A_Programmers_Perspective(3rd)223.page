<div id="pfdf" class="pf w2 h11" data-page-no="df"><div class="pc pcdf w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bgdf.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">222<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x28 h2a y257 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">Comparing<span class="_ _11"> </span>byte<span class="_ _11"> </span>movement<span class="_ _11"> </span>instructions</span></div><div class="t m5 x28 h2b y258 ff7 fs1e fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _13"> </span>following<span class="_ _13"> </span>example<span class="_ _13"> </span>illustrates<span class="_ _6"> </span>how<span class="_ _13"> </span>different<span class="_ _13"> </span>data<span class="_ _13"> </span>movement<span class="_ _6"> </span>instructions<span class="_ _13"> </span>either<span class="_ _13"> </span>do<span class="_ _13"> </span>or<span class="_ _6"> </span>do<span class="_ _13"> </span>not<span class="_ _13"> </span>change</div><div class="t m5 x28 h2b y259 ff7 fs1e fc2 sc0 ls0 ws0">the<span class="_ _15"> </span>high-order<span class="_ _15"> </span>bytes<span class="_ _21"> </span>of<span class="_ _15"> </span>the<span class="_ _15"> </span>destination.<span class="_ _21"> </span>Observe<span class="_ _15"> </span>that<span class="_ _15"> </span>the<span class="_ _21"> </span>three<span class="_ _15"> </span>byte-movement<span class="_ _21"> </span>instructions<span class="_ _15"> </span><span class="ffd">movb</span>,</div><div class="t m5 x28 h2b y25a ffd fs1e fc2 sc0 ls0 ws0">movsbq<span class="ff7">,<span class="_"> </span>and<span class="_"> </span></span>movzbq<span class="_ _10"> </span><span class="ff7">differ<span class="_"> </span>from<span class="_"> </span>each<span class="_"> </span>other<span class="_"> </span>in<span class="_"> </span>subtle<span class="_"> </span>ways<span class="_ _1"></span>.<span class="_"> </span>Here<span class="_"> </span>is<span class="_"> </span>an<span class="_"> </span>example:</span></div><div class="t m5 xc6 h2d y1209 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _45"> </span><span class="ffd fs1e fc2">movabsq<span class="_ _e"> </span>$0x0011223344556677,<span class="_ _1f"> </span>%rax<span class="_ _95"> </span></span><span class="ff13 fs35">%rax<span class="_ _e"> </span>=<span class="_ _21"> </span>0011223344556677</span></div><div class="t m5 xc6 h2d y120a ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">movb<span class="_ _46"> </span>$0xAA,<span class="_ _e"> </span>%dl<span class="_ _141"> </span></span><span class="ff13 fs35">%dl<span class="_ _3d"> </span>=<span class="_ _f"> </span>AA</span></div><div class="t m5 xc6 h2d y120b ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">movb<span class="_ _e"> </span>%dl,%al<span class="_ _96"> </span></span><span class="ff13 fs35">%rax<span class="_ _f"> </span>=<span class="_ _f"> </span>00112233445566AA</span></div><div class="t m5 xc6 h2d y120c ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">movsbq<span class="_ _e"> </span>%dl,%rax<span class="_ _9f"> </span></span><span class="ff13 fs35">%rax<span class="_ _21"> </span>=<span class="_ _e"> </span>FFFFFFFFFFFFFFAA</span></div><div class="t m5 xc6 h2d y120d ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">movzbq<span class="_ _e"> </span>%dl,%rax<span class="_ _9f"> </span></span><span class="ff13 fs35">%rax<span class="_ _21"> </span>=<span class="_ _e"> </span>00000000000000AA</span></div><div class="t m5 x57 h2b y2272 ff7 fs1e fc2 sc0 ls0 ws0">In<span class="_ _11"> </span>the<span class="_ _10"> </span>following<span class="_ _11"> </span>discussion,<span class="_ _11"> </span>we<span class="_ _11"> </span>use<span class="_ _11"> </span>hexadecimal<span class="_ _11"> </span>notation<span class="_ _11"> </span>for<span class="_ _11"> </span>all<span class="_ _10"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>values<span class="_ _1"></span>.<span class="_ _11"> </span>The<span class="_"> </span>Ô¨Årst<span class="_ _11"> </span>two<span class="_ _11"> </span>lines</div><div class="t m5 x28 h2b y2273 ff7 fs1e fc2 sc0 ls0 ws0">of<span class="_"> </span>the<span class="_ _13"> </span>code<span class="_ _13"> </span>initialize<span class="_"> </span>registers<span class="_ _13"> </span><span class="ffd">%rax<span class="_ _13"> </span></span>and<span class="_"> </span><span class="ffd">%dl<span class="_ _13"> </span></span>to<span class="_"> </span><span class="ffd">0011223344556677<span class="_ _13"> </span></span>and<span class="_"> </span><span class="ffd">AA</span>,<span class="_ _13"> </span>respectively<span class="_ _3"></span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>remaining</div><div class="t m5 x28 h2b y2274 ff7 fs1e fc2 sc0 ls0 ws0">instructions<span class="_ _11"> </span>all<span class="_ _16"> </span>copy<span class="_ _11"> </span>the<span class="_ _16"> </span>low-order<span class="_ _11"> </span>byte<span class="_ _16"> </span>of<span class="_ _11"> </span><span class="ffd">%rdx<span class="_ _11"> </span></span>to<span class="_ _16"> </span>the<span class="_ _11"> </span>low-order<span class="_ _16"> </span>byte<span class="_ _11"> </span>of<span class="_ _16"> </span><span class="ffd">%rax</span><span class="ls14b">.T<span class="_ _42"></span>h<span class="_ _49"></span>e<span class="ffd ls0">movb<span class="_ _11"> </span><span class="ff7">instruction</span></span></span></div><div class="t m5 x28 h2b y2275 ff7 fs1e fc2 sc0 ls0 ws0">(line<span class="_ _14"> </span>3)<span class="_ _15"> </span>does<span class="_ _14"> </span>not<span class="_ _15"> </span>change<span class="_ _14"> </span>the<span class="_ _15"> </span>other<span class="_ _14"> </span>bytes<span class="_ _1"></span>.<span class="_ _15"> </span>T<span class="_ _1"></span>he<span class="_ _15"> </span><span class="ffd">movsbq<span class="_ _14"> </span></span>instruction<span class="_ _15"> </span>(line<span class="_ _14"> </span>4)<span class="_ _15"> </span>sets<span class="_ _14"> </span>the<span class="_ _15"> </span>other<span class="_ _14"> </span>7<span class="_ _15"> </span>bytes<span class="_ _14"> </span>to</div><div class="t m5 x28 h2b y2276 ff7 fs1e fc2 sc0 ls0 ws0">either<span class="_ _16"> </span>all<span class="_ _16"> </span>ones<span class="_ _11"> </span>or<span class="_ _16"> </span>all<span class="_ _16"> </span>zeros<span class="_ _16"> </span>depending<span class="_ _16"> </span>on<span class="_ _16"> </span>the<span class="_ _16"> </span>high-order<span class="_ _11"> </span>bit<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>source<span class="_ _16"> </span>byte<span class="_ _0"></span>.<span class="_ _16"> </span>Since<span class="_ _11"> </span>hexadecimal<span class="_ _16"> </span><span class="ffd">A</span></div><div class="t m5 x28 h2b y2277 ff7 fs1e fc2 sc0 ls0 ws0">represents<span class="_ _11"> </span>binary<span class="_ _16"> </span>value<span class="_ _11"> </span><span class="ffd">1010</span>,<span class="_ _16"> </span>sign<span class="_ _16"> </span>extension<span class="_ _11"> </span>causes<span class="_ _16"> </span>the<span class="_ _11"> </span>higher<span class="_ _0"></span>-order<span class="_ _11"> </span>bytes<span class="_ _16"> </span>to<span class="_ _11"> </span>each<span class="_ _16"> </span>be<span class="_ _11"> </span>set<span class="_ _16"> </span>to<span class="_ _11"> </span><span class="ffd">FF</span><span class="ls14c">.T<span class="_ _42"></span>h<span class="_ _49"></span>e</span></div><div class="t m5 x28 h2b y2278 ffd fs1e fc2 sc0 ls0 ws0">movzbq<span class="_ _10"> </span><span class="ff7">instruction<span class="_"> </span>(line<span class="_"> </span>5)<span class="_"> </span>always<span class="_"> </span>sets<span class="_"> </span>the<span class="_"> </span>other<span class="_"> </span>7<span class="_"> </span>bytes<span class="_"> </span>to<span class="_"> </span>zero<span class="_ _1"></span>.</span></div><div class="t m5 x1d h47 y2279 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>3.3<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>362)</span></div><div class="t m5 x1d h26 y227a ff7 fs19 fc1 sc0 ls0 ws0">Each<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>following<span class="_ _11"> </span>lines<span class="_ _11"> </span>of<span class="_ _16"> </span>code<span class="_"> </span>generates<span class="_ _16"> </span>an<span class="_ _11"> </span>error<span class="_ _11"> </span>message<span class="_ _16"> </span>when<span class="_ _11"> </span>we<span class="_ _11"> </span>invoke</div><div class="t m5 x1d h26 y227b ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>assembler.<span class="_"> </span>Explain<span class="_"> </span>what<span class="_"> </span>is<span class="_"> </span>wrong<span class="_"> </span>with<span class="_"> </span>each<span class="_"> </span>line<span class="_ _1"></span>.</div><div class="t m5 x75 h2d y227c ffd fs1e fc2 sc0 ls0 ws0">movb<span class="_ _e"> </span>$0xF,<span class="_ _1f"> </span>(%ebx)</div><div class="t m5 x75 h2d y227d ffd fs1e fc2 sc0 ls0 ws0">movl<span class="_ _e"> </span>%rax,<span class="_ _1f"> </span>(%rsp)</div><div class="t m5 x75 h2d y227e ffd fs1e fc2 sc0 ls0 ws0">movw<span class="_ _e"> </span>(%rax),4(%rsp)</div><div class="t m5 x75 h2d y227f ffd fs1e fc2 sc0 ls0 ws0">movb<span class="_ _e"> </span>%al,%sl</div><div class="t m5 x75 h2d y2280 ffd fs1e fc2 sc0 ls0 ws0">movq<span class="_ _e"> </span>%rax,$0x123</div><div class="t m5 x75 h2d y2281 ffd fs1e fc2 sc0 ls0 ws0">movl<span class="_ _e"> </span>%eax,%rdx</div><div class="t m5 x75 h2d y2282 ffd fs1e fc2 sc0 ls0 ws0">movb<span class="_ _e"> </span>%si,<span class="_ _1f"> </span>8(%rbp)</div><div class="t m5 x1d h41 y5fc ffe fs29 fc1 sc0 ls0 ws0">3.4.3</div><div class="t m5 x8c h43 y5fd ffe fs19 fc1 sc0 ls0 ws0">Data<span class="_"> </span>Movement<span class="_"> </span>Example</div><div class="t m5 x1d h26 y5fe ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_ _16"> </span>an<span class="_ _11"> </span>example<span class="_ _16"> </span>of<span class="_ _16"> </span>code<span class="_ _11"> </span>that<span class="_ _16"> </span>uses<span class="_ _16"> </span>data<span class="_ _11"> </span>movement<span class="_ _16"> </span>instructions<span class="_ _1"></span>,<span class="_ _16"> </span>consider<span class="_ _16"> </span>the<span class="_ _16"> </span>data</div><div class="t m5 x1d h26 y5ff ff7 fs19 fc1 sc0 ls0 ws0">exchange<span class="_ _21"> </span>routine<span class="_ _f"> </span>shown<span class="_ _f"> </span>in<span class="_ _f"> </span>F<span class="_ _1"></span>igure<span class="_ _f"> </span>3.7,<span class="_ _e"> </span>both<span class="_ _21"> </span>as<span class="_ _f"> </span>C<span class="_ _f"> </span>code<span class="_ _f"> </span>and<span class="_ _21"> </span>as<span class="_ _f"> </span>assembly<span class="_ _f"> </span>code</div><div class="t m5 x1d h26 y600 ff7 fs19 fc1 sc0 ls0 ws0">generated<span class="_"> </span>by<span class="_"> </span><span class="ff9">gcc</span>.</div><div class="t m5 x29 h26 y601 ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_ _14"> </span>Figure<span class="_ _14"> </span>3.7(b)<span class="_ _14"> </span>shows<span class="_ _1"></span>,<span class="_ _21"> </span>function<span class="_ _15"> </span><span class="ffd">exchange<span class="_ _14"> </span></span>is<span class="_ _15"> </span>implemented<span class="_ _15"> </span>with<span class="_ _14"> </span>just<span class="_ _15"> </span>three</div><div class="t m5 x1d h26 y602 ff7 fs19 fc1 sc0 ls0 ws0">instructions:<span class="_ _14"> </span>two<span class="_ _15"> </span>data<span class="_ _15"> </span>movements<span class="_ _15"> </span>(<span class="ffd">movq</span>)<span class="_ _15"> </span>plus<span class="_ _15"> </span>an<span class="_ _14"> </span>instruction<span class="_ _15"> </span>to<span class="_ _15"> </span>return<span class="_ _15"> </span>back<span class="_ _15"> </span>to</div><div class="t m5 x1d h26 y603 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _11"> </span>point<span class="_ _16"> </span>from<span class="_ _16"> </span>which<span class="_ _11"> </span>the<span class="_ _16"> </span>function<span class="_ _16"> </span>was<span class="_ _11"> </span>called<span class="_ _16"> </span>(<span class="ffd">ret</span>).<span class="_ _16"> </span>W<span class="_ _3"></span>e<span class="_ _16"> </span>will<span class="_ _11"> </span>cover<span class="_ _16"> </span>the<span class="_ _11"> </span>details<span class="_ _16"> </span>of</div><div class="t m5 x1d h26 y604 ff7 fs19 fc1 sc0 ls0 ws0">function<span class="_ _13"> </span>call<span class="_"> </span>and<span class="_ _13"> </span>return<span class="_ _13"> </span>in<span class="_ _13"> </span>Section<span class="_"> </span>3.7.<span class="_ _13"> </span>Until<span class="_ _13"> </span>then,<span class="_ _13"> </span>it<span class="_"> </span>sufÔ¨Åces<span class="_ _13"> </span>to<span class="_ _13"> </span>say<span class="_"> </span>that<span class="_ _13"> </span>arguments</div><div class="t m5 x1d h26 y605 ff7 fs19 fc1 sc0 ls0 ws0">are<span class="_ _21"> </span>passed<span class="_ _21"> </span>to<span class="_ _21"> </span>functions<span class="_ _21"> </span>in<span class="_ _21"> </span>registers<span class="_ _1"></span>.<span class="_ _f"> </span>Our<span class="_ _21"> </span>annotated<span class="_ _21"> </span>assembly<span class="_ _21"> </span>code<span class="_ _21"> </span>documents</div><div class="t m5 x1d h26 y606 ff7 fs19 fc1 sc0 ls0 ws0">these<span class="_ _1"></span>.<span class="_ _16"> </span>A<span class="_ _14"> </span>function<span class="_ _16"> </span>returns<span class="_ _16"> </span>a<span class="_ _16"> </span>value<span class="_ _16"> </span>by<span class="_ _16"> </span>storing<span class="_ _16"> </span>it<span class="_ _14"> </span>in<span class="_ _16"> </span>register<span class="_ _16"> </span><span class="ffd">%rax</span>,<span class="_ _16"> </span>or<span class="_ _16"> </span>in<span class="_ _14"> </span>one<span class="_ _16"> </span>of<span class="_ _16"> </span>the</div><div class="t m5 x1d h26 y607 ff7 fs19 fc1 sc0 ls0 ws0">low-order<span class="_"> </span>portions<span class="_"> </span>of<span class="_"> </span>this<span class="_"> </span>register.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
