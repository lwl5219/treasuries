<div id="pf7c" class="pf w2 h11" data-page-no="7c"><div class="pc pc7c w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg7c.png"/><div class="t m5 xa9 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>2.3<span class="_ _60"> </span>Integer<span class="_ _10"> </span>Arithmetic<span class="_ _3e"> </span><span class="ffe fs1e">123</span></div><div class="t m5 x34 h2a y257 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">Security<span class="_ _11"> </span>vulnerability<span class="_ _11"> </span>in<span class="_ _11"> </span><span class="ffd fs2b">getpeername<span class="_ _16"> </span></span><span class="ffb">(continued)</span></span></div><div class="t m5 x35 h2b y258 ff7 fs1e fc2 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _14"> </span>can<span class="_ _16"> </span>see<span class="_ _14"> </span>that<span class="_ _16"> </span>this<span class="_ _14"> </span>problem<span class="_ _14"> </span>arises<span class="_ _16"> </span>due<span class="_ _14"> </span>to<span class="_ _16"> </span>the<span class="_ _14"> </span>mismatch<span class="_ _16"> </span>between<span class="_ _14"> </span>data<span class="_ _16"> </span>types:<span class="_ _14"> </span>in<span class="_ _14"> </span>one<span class="_ _16"> </span>place<span class="_ _14"> </span>the</div><div class="t m5 x34 h2b y259 ff7 fs1e fc2 sc0 ls0 ws0">length<span class="_ _11"> </span>parameter<span class="_ _11"> </span>is<span class="_ _11"> </span>signed;<span class="_ _16"> </span>in<span class="_ _10"> </span>another<span class="_ _11"> </span>place<span class="_ _16"> </span>it<span class="_ _10"> </span>is<span class="_ _11"> </span>unsigned.<span class="_ _16"> </span>Such<span class="_ _10"> </span>mismatches<span class="_ _11"> </span>can<span class="_ _11"> </span>be<span class="_ _16"> </span>a<span class="_ _10"> </span>source<span class="_ _11"> </span>of<span class="_ _11"> </span>bugs</div><div class="t m5 x34 h2b y25a ff7 fs1e fc2 sc0 ls0 ws0">and,<span class="_ _6"> </span>as<span class="_ _6"> </span>this<span class="_ _13"> </span>example<span class="_ _a"> </span>shows<span class="_ _1"></span>,<span class="_ _13"> </span>can<span class="_ _a"> </span>even<span class="_ _6"> </span>lead<span class="_ _6"> </span>to<span class="_ _6"> </span>security<span class="_ _13"> </span>vulnerabilities<span class="_ _3"></span>.<span class="_ _6"> </span>F<span class="_ _1"></span>ortunately<span class="_ _3"></span>,<span class="_ _13"> </span>there<span class="_ _a"> </span>were<span class="_ _6"> </span>no<span class="_ _13"> </span>reported</div><div class="t m5 x34 h2b y4e2 ff7 fs1e fc2 sc0 ls0 ws0">cases<span class="_ _13"> </span>where<span class="_ _13"> </span>a<span class="_ _13"> </span>programmer<span class="_ _13"> </span>had<span class="_ _13"> </span>exploited<span class="_ _13"> </span>the<span class="_ _13"> </span>vulnerability<span class="_ _6"> </span>in<span class="_"> </span>F<span class="_ _1"></span>reeBSD<span class="_ _3"></span>.<span class="_"> </span>T<span class="_ _1"></span>hey<span class="_ _13"> </span>issued<span class="_ _13"> </span>a<span class="_ _13"> </span>security<span class="_ _13"> </span>advisory</div><div class="t m5 x34 h2b y4e3 ff7 fs1e fc2 sc0 ls0 ws0">“F<span class="_ _1"></span>reeBSD-SA-02:38.signed-error”<span class="_"> </span>advising<span class="_"> </span>system<span class="_ _13"> </span>administrators<span class="_"> </span>on<span class="_ _13"> </span>how<span class="_"> </span>to<span class="_ _13"> </span>apply<span class="_"> </span>a<span class="_ _13"> </span>patch<span class="_"> </span>that<span class="_ _13"> </span>would</div><div class="t m5 x34 h2b y4e4 ff7 fs1e fc2 sc0 ls0 ws0">remove<span class="_"> </span>the<span class="_ _11"> </span>vulnerability<span class="_ _3"></span>.<span class="_"> </span>The<span class="_"> </span>bug<span class="_"> </span>can<span class="_ _10"> </span>be<span class="_ _11"> </span>ﬁxed<span class="_"> </span>by<span class="_ _11"> </span>declaring<span class="_"> </span>parameter<span class="_ _11"> </span><span class="ffd">maxlen<span class="_ _10"> </span></span>to<span class="_ _11"> </span><span class="ffd">copy_from_kernel</span></div><div class="t m5 x34 h2b y945 ff7 fs1e fc2 sc0 ls0 ws0">to<span class="_ _13"> </span>be<span class="_ _6"> </span>of<span class="_ _13"> </span>type<span class="_ _6"> </span><span class="ffd">size_t</span>,<span class="_ _13"> </span>to<span class="_ _13"> </span>be<span class="_ _6"> </span>consistent<span class="_ _13"> </span>with<span class="_ _13"> </span>parameter<span class="_ _6"> </span><span class="ffd">n<span class="_ _13"> </span></span>of<span class="_ _6"> </span><span class="ffd">memcpy</span>.<span class="_ _13"> </span>W<span class="_ _3"></span>e<span class="_ _13"> </span>should<span class="_ _6"> </span>also<span class="_ _13"> </span>declare<span class="_ _13"> </span>local<span class="_ _6"> </span>variable</div><div class="t m5 x34 h2b y946 ffd fs1e fc2 sc0 ls0 ws0">len<span class="_ _10"> </span><span class="ff7">and<span class="_"> </span>the<span class="_"> </span>return<span class="_"> </span>value<span class="_"> </span>to<span class="_"> </span>be<span class="_"> </span>of<span class="_"> </span>type<span class="_"> </span></span>size_t<span class="ff7">.</span></div><div class="t m5 x26 h26 y1234 ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_"> </span>can<span class="_"> </span>characterize<span class="_"> </span>operation<span class="_"> </span><span class="ffd">+</span></div><div class="t m5 x157 h69 y1235 ff7 fs39 fc2 sc0 ls0 ws0">u</div><div class="t m5 x157 h50 y1236 ff11 fs25 fc2 sc0 ls0 ws0">w</div><div class="t m5 xe5 h26 y1234 ff7 fs19 fc2 sc0 ls0 ws0">as<span class="_"> </span>follows:</div><div class="t m5 x17 h5b y1237 ff1b fs14 fc6 sc0 ls0 ws0">principle:<span class="_ _e"> </span><span class="ff7 fs19 fc1">Unsigned<span class="_"> </span>addition</span></div><div class="t m5 x17 h46 y1238 ff7 fs19 fc1 sc0 ls73 ws0">Fo<span class="_ _2"></span>r<span class="_ _16"> </span><span class="ff11 ls0">x<span class="_"> </span><span class="ff7">and<span class="_"> </span></span>y<span class="_ _11"> </span><span class="ff7">such<span class="_"> </span>that<span class="_"> </span>0<span class="_"> </span><span class="ff12">≤<span class="_ _13"></span></span></span><span class="ls57">x,<span class="_ _13"> </span>y<span class="_ _13"> </span>&lt;<span class="_ _6"> </span></span><span class="ff7">2</span></span></div><div class="t m5 x10e h50 y1239 ff11 fs25 fc1 sc0 ls0 ws0">w</div><div class="t m5 x189 h26 y123a ff7 fs19 fc1 sc0 ls0 ws0">:</div><div class="t m5 x1b9 h3a y123b ff11 fs19 fc1 sc0 ls0 ws0">x<span class="_ _11"> </span><span class="ffd">+</span></div><div class="t m5 x124 h69 y123c ff7 fs39 fc1 sc0 ls0 ws0">u</div><div class="t m5 x124 h50 y123d ff11 fs25 fc1 sc0 ls0 ws0">w</div><div class="t m5 xf6 h46 y123e ff11 fs19 fc1 sc0 ls0 ws0">y<span class="_ _11"> </span><span class="ff12">=</span></div><div class="t m5 x10d h5c y123f ff1e fs19 fc1 sc0 ls0 ws0"></div><div class="t m5 x66 h46 y1240 ff11 fs19 fc1 sc0 ls0 ws0">x<span class="_ _11"> </span><span class="ff12">+<span class="_ _10"> </span></span><span class="ls57">y,<span class="_ _6c"> </span>x<span class="_ _13"> </span></span><span class="ff12">+<span class="_ _10"> </span></span><span class="ls98">y&lt;<span class="_ _1"></span><span class="ff7 ls0">2</span></span></div><div class="t m5 xd4 h50 y1241 ff11 fs25 fc1 sc0 ls0 ws0">w</div><div class="t m5 x131 h26 y1242 ff7 fs19 fc1 sc0 ls0 ws0">Normal</div><div class="t m5 x66 h46 y1243 ff11 fs19 fc1 sc0 ls0 ws0">x<span class="_ _11"> </span><span class="ff12">+<span class="_ _10"> </span></span>y<span class="_ _10"> </span><span class="ff12">−<span class="_ _10"> </span><span class="ff7">2</span></span></div><div class="t m5 x48 h50 y1244 ff11 fs25 fc1 sc0 ls0 ws0">w</div><div class="t m5 x1f4 h26 y1245 ff11 fs19 fc1 sc0 ls0 ws0">,<span class="_ _1a"> </span><span class="ff7">2</span></div><div class="t m5 xe5 h50 y1244 ff11 fs25 fc1 sc0 ls0 ws0">w</div><div class="t m5 xe1 h46 y1245 ff12 fs19 fc1 sc0 ls0 ws0">≤<span class="_ _13"> </span><span class="ff11">x<span class="_ _16"> </span></span>+<span class="_ _13"></span><span class="ff11 ls98">y&lt;<span class="_ _1"></span><span class="ff7 ls0">2</span></span></div><div class="t m5 x1ae h4b y1246 ff11 fs25 fc1 sc0 ls0 ws0">w<span class="ff12">+<span class="ff7">1</span></span></div><div class="t m5 x1bb h26 y1245 ff7 fs19 fc1 sc0 ls0 ws0">Overﬂow</div><div class="t m5 x1f0 h26 y1247 ff7 fs19 fc1 sc0 ls0 ws0">(2.11)</div><div class="t m5 x26 h26 y1248 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _15"> </span>two<span class="_ _15"> </span>cases<span class="_ _15"> </span>of<span class="_ _14"> </span>Equation<span class="_ _15"> </span>2.11<span class="_ _15"> </span>are<span class="_ _14"> </span>illustrated<span class="_ _15"> </span>in<span class="_ _15"> </span>F<span class="_ _0"></span>igure<span class="_ _14"> </span>2.22,<span class="_ _21"> </span>showing<span class="_ _15"> </span>the</div><div class="t m5 x17 h46 y1249 ff7 fs19 fc1 sc0 ls0 ws0">sum<span class="_"> </span><span class="ff11">x<span class="_ _10"> </span><span class="ff12">+<span class="_ _10"> </span></span>y<span class="_ _11"> </span></span>on<span class="_"> </span>the<span class="_"> </span>left<span class="_"> </span>mapping<span class="_ _13"> </span>to<span class="_"> </span>the<span class="_"> </span>unsigned<span class="_"> </span><span class="ff11">w</span>-bit<span class="_"> </span>sum<span class="_"> </span><span class="ff11">x<span class="_ _11"> </span><span class="ffd">+</span></span></div><div class="t m5 x175 h69 y124a ff7 fs39 fc1 sc0 ls0 ws0">u</div><div class="t m5 x175 h50 y124b ff11 fs25 fc1 sc0 ls0 ws0">w</div><div class="t m5 x1aa h26 y124c ff11 fs19 fc1 sc0 ls0 ws0">y<span class="_ _11"> </span><span class="ff7">on<span class="_"> </span>the<span class="_"> </span>right.<span class="_"> </span>T<span class="_ _1"></span>he</span></div><div class="t m5 x17 h46 y124d ff7 fs19 fc1 sc0 ls0 ws0">normal<span class="_ _13"> </span>case<span class="_"> </span>preserves<span class="_ _13"> </span>the<span class="_ _13"> </span>value<span class="_"> </span>of<span class="_ _13"> </span><span class="ff11">x<span class="_ _11"> </span><span class="ff12">+<span class="_ _13"></span></span>y<span class="_ _5"></span></span>,<span class="_"> </span>while<span class="_ _13"> </span>the<span class="_ _13"> </span>overﬂow<span class="_"> </span>case<span class="_ _13"> </span>has<span class="_ _13"> </span>the<span class="_"> </span>effect<span class="_ _13"> </span>of</div><div class="t m5 x17 h26 y124e ff7 fs19 fc1 sc0 ls0 ws0">decrementing<span class="_"> </span>this<span class="_"> </span>sum<span class="_"> </span>by<span class="_"> </span>2</div><div class="t m5 x1a h50 y124f ff11 fs25 fc1 sc0 ls0 ws0">w</div><div class="t m5 x15c h26 y1250 ff7 fs19 fc1 sc0 ls0 ws0">.</div><div class="t m5 x17 h5b y1251 ff1b fs14 fc6 sc0 ls0 ws0">derivation:<span class="_ _e"> </span><span class="ff7 fs19 fc1">Unsigned<span class="_"> </span>addition</span></div><div class="t m5 x17 h46 y1252 ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _6"> </span>general,<span class="_ _13"> </span>we<span class="_ _6"> </span>can<span class="_ _13"> </span>see<span class="_ _6"> </span>that<span class="_ _6"> </span>if<span class="_ _13"> </span><span class="ff11">x<span class="_ _10"> </span><span class="ff12">+<span class="_ _13"></span></span><span class="ls99">y&lt;<span class="_ _3"></span><span class="ff7 ls0">2</span></span></span></div><div class="t m5 x110 h50 y1253 ff11 fs25 fc1 sc0 ls0 ws0">w</div><div class="t m5 xba h46 y1254 ff7 fs19 fc1 sc0 ls0 ws0">,<span class="_ _13"> </span>the<span class="_ _6"> </span>leading<span class="_ _6"> </span>bit<span class="_ _13"> </span>in<span class="_ _6"> </span>the<span class="_ _6"> </span>(<span class="ff11">w<span class="_ _10"> </span><span class="ff12">+<span class="_ _13"></span></span></span>1<span class="_ _1"></span>)-bit<span class="_ _13"> </span>represen-</div><div class="t m5 x17 h26 y1255 ff7 fs19 fc1 sc0 ls0 ws0">tation<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>sum<span class="_ _13"> </span>will<span class="_"> </span>equal<span class="_ _13"> </span>0,<span class="_"> </span>and<span class="_ _13"> </span>hence<span class="_ _13"> </span>discarding<span class="_"> </span>it<span class="_ _13"> </span>will<span class="_ _13"> </span>not<span class="_"> </span>change<span class="_ _13"> </span>the<span class="_ _13"> </span>numeric</div><div class="t m5 x17 h26 y1256 ff7 fs19 fc1 sc0 ls0 ws0">value<span class="_ _1"></span>.<span class="_ _11"> </span>On<span class="_ _11"> </span>the<span class="_ _11"> </span>other<span class="_ _11"> </span>hand,<span class="_ _11"> </span>if<span class="_ _11"> </span>2</div><div class="t m5 x137 h50 y1257 ff11 fs25 fc1 sc0 ls0 ws0">w</div><div class="t m5 x1f2 h46 y1258 ff12 fs19 fc1 sc0 ls0 ws0">≤<span class="_ _13"> </span><span class="ff11">x<span class="_"> </span></span>+<span class="_ _13"></span><span class="ff11 ls9a">y&lt;<span class="_ _1"></span><span class="ff7 ls0">2</span></span></div><div class="t m5 x1c8 h4b y1257 ff11 fs25 fc1 sc0 ls0 ws0">w<span class="ff12">+<span class="ff7">1</span></span></div><div class="t m5 x185 h46 y1258 ff7 fs19 fc1 sc0 ls0 ws0">,<span class="_ _11"> </span>the<span class="_"> </span>leading<span class="_ _11"> </span>bit<span class="_ _11"> </span>in<span class="_ _11"> </span>the<span class="_ _11"> </span>(<span class="ff11">w<span class="_ _10"> </span><span class="ff12">+<span class="_ _10"> </span></span></span>1<span class="_ _1"></span>)-bit</div><div class="t m5 x17 h26 y1259 ff7 fs19 fc1 sc0 ls0 ws0">representation<span class="_ _16"> </span>of<span class="_ _14"> </span>the<span class="_ _14"> </span>sum<span class="_ _16"> </span>will<span class="_ _14"> </span>equal<span class="_ _14"> </span>1,<span class="_ _14"> </span>and<span class="_ _14"> </span>hence<span class="_ _16"> </span>discarding<span class="_ _14"> </span>it<span class="_ _14"> </span>is<span class="_ _16"> </span>equivalent<span class="_ _14"> </span>to</div><div class="t m5 x17 h26 y125a ff7 fs19 fc1 sc0 ls0 ws0">subtracting<span class="_"> </span>2</div><div class="t m5 x8e h50 y125b ff11 fs25 fc1 sc0 ls0 ws0">w</div><div class="t m5 xcf h26 y125c ff7 fs19 fc1 sc0 ls0 ws0">from<span class="_"> </span>the<span class="_"> </span>sum.</div><div class="t m5 x26 h26 y125d ff7 fs19 fc1 sc0 ls0 ws0">An<span class="_ _13"> </span>arithmetic<span class="_ _13"> </span>operation<span class="_ _13"> </span>is<span class="_ _13"> </span>said<span class="_ _13"> </span>to<span class="_ _13"> </span><span class="ffa">o<span class="_ _1"></span>verﬂow<span class="_ _13"> </span><span class="ff7">when<span class="_ _13"> </span>the<span class="_ _13"> </span>full<span class="_ _13"> </span>integer<span class="_ _13"> </span>result<span class="_ _13"> </span>cannot</span></span></div><div class="t m5 x17 h26 y125e ff7 fs19 fc1 sc0 ls0 ws0">ﬁt<span class="_ _6"> </span>within<span class="_ _13"> </span>the<span class="_ _6"> </span>word<span class="_ _13"> </span>size<span class="_ _6"> </span>limits<span class="_ _13"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>data<span class="_ _6"> </span>type.<span class="_ _6"> </span>As<span class="_ _13"> </span>Equation<span class="_ _6"> </span>2.11<span class="_ _13"> </span>indicates<span class="_ _3"></span>,<span class="_ _13"> </span>overﬂow</div><div class="t m5 x31 h3f y125f ff1c fs27 fc1 sc0 ls0 ws0">2</div><div class="t m5 x1f5 h65 y1260 ff1f fs38 fc1 sc0 ls0 ws0">w</div><div class="t m5 x15b h3f y1261 ff1c fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 x17 h3f y1262 ff1c fs27 fc1 sc0 ls0 ws0">2</div><div class="t m5 x2c h65 y1263 ff1f fs38 fc1 sc0 ls0 ws0">w</div><div class="t m5 xee h65 y1264 ff1c fs38 fc1 sc0 ls0 ws0">+</div><div class="t m5 x3e h65 y1263 ff1c fs38 fc1 sc0 ls0 ws0">1</div><div class="t m5 x19f h3f y1265 ff1c fs27 fc1 sc0 ls0 ws0">Overflow</div><div class="t m5 x19f h3f y1266 ff1c fs27 fc1 sc0 ls0 ws0">Normal</div><div class="t m5 xa6 h3f y1267 ff1f fs27 fc1 sc0 ls0 ws0">x<span class="ff1c"> +</span></div><div class="t m5 x134 h65 y1268 ff1c fs38 fc1 sc0 ls0 ws0">u</div><div class="t m5 xa3 h3f y1269 ff1f fs27 fc1 sc0 ls0 ws0">y</div><div class="t m5 x15b h3f y126a ff1f fs27 fc1 sc0 ls0 ws0">x<span class="ff1c"> + </span>y</div><div class="t m5 x17 h35 y126b ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _10"> </span>2.22<span class="_ _66"> </span><span class="fc1">Relation<span class="_"> </span>between<span class="_ _13"> </span>integer<span class="_"> </span>addition<span class="_ _13"> </span>and<span class="_"> </span>unsigned<span class="_ _13"> </span>addition.<span class="_"> </span><span class="ff6">When<span class="_ _13"> </span><span class="ff11">x<span class="_ _11"> </span><span class="ff12">+<span class="_ _13"></span></span>y</span></span></span></div><div class="t m5 x17 h1c y126c ff6 fs16 fc1 sc0 ls0 ws0">is<span class="_ _10"> </span>greater<span class="_ _11"> </span>than<span class="_ _10"> </span><span class="ff7">2</span></div><div class="t m5 xcf h58 y126d ff11 fs32 fc1 sc0 ls0 ws0">w</div><div class="t m5 x4c h35 y126e ff12 fs16 fc1 sc0 ls0 ws0">−<span class="_ _13"> </span><span class="ff7">1<span class="_ _1"></span><span class="ff6">,<span class="_ _11"> </span>the<span class="_ _10"> </span>sum<span class="_ _10"> </span>over<span class="_ _2"></span>ﬂows.</span></span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
