<div id="pf224" class="pf w2 h11" data-page-no="224"><div class="pc pc224 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg224.png"/><div class="t m5 x1e2 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>5.4<span class="_ _60"> </span>Eliminating<span class="_ _10"> </span>Loop<span class="_ _10"> </span>Inefﬁciencies<span class="_ _3e"> </span><span class="ffe fs1e">547</span></div><div class="t m5 x63 h3f y4b0f ff58 fs27 fc1 sc0 ls20e ws0">250</div><div class="t m5 x63 h3f y4b10 ff58 fs27 fc1 sc0 ls20e ws0">200</div><div class="t m5 x63 h3f y4b11 ff58 fs27 fc1 sc0 ls20e ws0">150</div><div class="t m5 x63 h3f y4b12 ff58 fs27 fc1 sc0 ls20e ws0">100</div><div class="t m5 x1a4 h3f y4b13 ff58 fs27 fc1 sc0 ls20e ws0">50</div><div class="t m5 x2e h3f y4b14 ff58 fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 x1d2 h3f y4b15 ff58 fs27 fc1 sc0 ls0 ws0">0<span class="_ _81"> </span>100,000<span class="_ _7e"> </span>200,000<span class="_ _7e"> </span>300,000<span class="_ _7e"> </span>400,000<span class="_ _20"> </span>500,000</div><div class="t m5 x1ed h3f y4b16 ff21 fs27 fc1 sc0 ls20f ws0">Stri<span class="_ _1"></span>ng length</div><div class="t m7 xef h3f y4b17 ff21 fs27 fc1 sc0 ls0 ws0">CPU seconds</div><div class="t m5 x1c7 h40 y4b18 ff59 fs28 fc1 sc0 ls0 ws0">lower1</div><div class="t m5 x1c9 h40 y4b19 ff59 fs28 fc1 sc0 ls0 ws0">lower2</div><div class="t m5 x17 h26 y4b1a ff7 fs19 fc2 sc0 ls0 ws0">(a)</div><div class="t m5 x101 h31 y4b1b ff7 fs21 fc2 sc0 ls0 ws0">String<span class="_"> </span>length</div><div class="t m5 x17 h31 y4b1c ff7 fs21 fc2 sc0 ls0 ws0">Function<span class="_ _85"> </span>16,384<span class="_ _b9"> </span>32,768<span class="_ _5a"> </span>65,536<span class="_ _2e"> </span>131,072<span class="_ _72"> </span>262,144<span class="_ _72"> </span>524,288<span class="_ _74"> </span>1,048,576</div><div class="t m5 x17 h31 y4b1d ffd fs1e fc2 sc0 ls0 ws0">lower1<span class="_ _e2"> </span><span class="ff7 fs21">0.26<span class="_ _148"> </span>1.03<span class="_ _148"> </span>4.10<span class="_ _118"> </span>16.41<span class="_ _118"> </span>65.62<span class="_ _b9"> </span>262.48<span class="_ _94"> </span>1,049.89</span></div><div class="t m5 x17 h31 y4b1e ffd fs1e fc2 sc0 ls0 ws0">lower2<span class="_ _e2"> </span><span class="ff7 fs21">0.0000<span class="_ _b9"> </span>0.0001<span class="_ _5a"> </span>0.0001<span class="_ _b9"> </span>0.0003<span class="_ _5a"> </span>0.0005<span class="_ _b9"> </span>0.0010<span class="_ _6c"> </span>0.0020</span></div><div class="t m5 x17 h26 y4b1f ff7 fs19 fc2 sc0 ls0 ws0">(b)</div><div class="t m5 x17 h3a y4b20 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>5.8<span class="_ _66"> </span><span class="fc1">Comparative<span class="_"> </span>performance<span class="_"> </span>of<span class="_"> </span>lowercase<span class="_ _10"> </span>conversion<span class="_ _10"> </span>routines.<span class="_ _10"> </span><span class="ff6">The<span class="_ _10"> </span>original<span class="_ _10"> </span>code<span class="_ _10"> </span><span class="ffd fs19">lower1<span class="_ _10"> </span></span>has<span class="_ _10"> </span>a</span></span></div><div class="t m5 x17 h34 y4b21 ff6 fs16 fc1 sc0 ls0 ws0">quadratic<span class="_ _10"> </span>run<span class="_ _11"> </span>time<span class="_ _10"> </span>due<span class="_ _10"> </span>to<span class="_ _11"> </span>an<span class="_ _10"> </span>inefﬁcient<span class="_ _11"> </span>loop<span class="_ _10"> </span>structure.<span class="_ _11"> </span>The<span class="_ _10"> </span>modiﬁed<span class="_ _10"> </span>code</div><div class="t m5 x11b h3a y4b22 ffd fs19 fc1 sc0 ls0 ws0">lower2<span class="_ _10"> </span><span class="ff6 fs16">has<span class="_ _11"> </span>a<span class="_ _10"> </span>linear<span class="_ _10"> </span>run<span class="_ _11"> </span>time.</span></div><div class="t m5 x26 h26 y421c ff7 fs19 fc1 sc0 ls0 ws0">Function<span class="_ _14"> </span><span class="ffd">lower2<span class="_ _14"> </span></span>shown<span class="_ _14"> </span>in<span class="_ _14"> </span>F<span class="_ _0"></span>igure<span class="_ _14"> </span>5.7<span class="_ _14"> </span>is<span class="_ _14"> </span>identical<span class="_ _14"> </span>to<span class="_ _14"> </span>that<span class="_ _14"> </span>of<span class="_ _14"> </span><span class="ffd">lower1</span>,<span class="_ _15"> </span>except</div><div class="t m5 x17 h26 y421d ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_ _15"> </span>we<span class="_ _15"> </span>have<span class="_ _21"> </span>moved<span class="_ _15"> </span>the<span class="_ _15"> </span>call<span class="_ _21"> </span>to<span class="_ _15"> </span><span class="ffd">strlen<span class="_ _15"> </span></span>out<span class="_ _21"> </span>of<span class="_ _15"> </span>the<span class="_ _15"> </span>loop.<span class="_ _14"> </span>The<span class="_ _14"> </span>performance<span class="_ _15"> </span>im-</div><div class="t m5 x17 h26 y421e ff7 fs19 fc1 sc0 ls0 ws0">proves<span class="_ _13"> </span>dramatically<span class="_ _3"></span>.<span class="_"> </span>F<span class="_ _3"></span>or<span class="_"> </span>a<span class="_ _13"> </span>string<span class="_"> </span>length<span class="_ _13"> </span>of<span class="_"> </span>1,048,576,<span class="_ _13"> </span>the<span class="_"> </span>function<span class="_ _13"> </span>requires<span class="_"> </span>just<span class="_ _13"> </span>2.0</div><div class="t m5 x17 h26 y421f ff7 fs19 fc1 sc0 ls0 ws0">milliseconds—over<span class="_"> </span>500,000<span class="_ _13"> </span>times<span class="_"> </span>faster<span class="_"> </span>than<span class="_"> </span><span class="ffd">lower1</span>.<span class="_ _13"> </span>Each<span class="_"> </span>doubling<span class="_"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>string</div><div class="t m5 x17 h26 y4220 ff7 fs19 fc1 sc0 ls0 ws0">length<span class="_"> </span>causes<span class="_ _13"> </span>a<span class="_"> </span>doubling<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>run<span class="_"> </span>time—a<span class="_ _13"> </span>clear<span class="_"> </span>indicator<span class="_"> </span>of<span class="_ _13"> </span>linear<span class="_"> </span>run<span class="_ _13"> </span>time.<span class="_ _13"> </span>F<span class="_ _1"></span>or</div><div class="t m5 x17 h26 y4221 ff7 fs19 fc1 sc0 ls0 ws0">longer<span class="_"> </span>strings<span class="_ _1"></span>,<span class="_"> </span>the<span class="_"> </span>run-time<span class="_"> </span>improvement<span class="_"> </span>will<span class="_"> </span>be<span class="_"> </span>even<span class="_"> </span>greater.</div><div class="t m5 x26 h26 y4222 ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _15"> </span>an<span class="_ _14"> </span>ideal<span class="_ _15"> </span>world,<span class="_ _f"> </span>a<span class="_ _15"> </span>compiler<span class="_ _14"> </span>would<span class="_ _15"> </span>recognize<span class="_ _15"> </span>that<span class="_ _15"> </span>each<span class="_ _15"> </span>call<span class="_ _15"> </span>to<span class="_ _15"> </span><span class="ffd">strlen<span class="_ _15"> </span></span>in</div><div class="t m5 x17 h26 y4223 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>loop<span class="_ _11"> </span>test<span class="_"> </span>will<span class="_ _11"> </span>return<span class="_ _11"> </span>the<span class="_"> </span>same<span class="_ _11"> </span>result,<span class="_ _11"> </span>and<span class="_"> </span>thus<span class="_ _11"> </span>the<span class="_"> </span>call<span class="_ _11"> </span>could<span class="_ _11"> </span>be<span class="_"> </span>moved<span class="_ _11"> </span>out<span class="_"> </span>of</div><div class="t m5 x17 h26 y4224 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _16"> </span>loop.<span class="_ _16"> </span>T<span class="_ _1"></span>his<span class="_ _14"> </span>would<span class="_ _14"> </span>require<span class="_ _16"> </span>a<span class="_ _14"> </span>very<span class="_ _14"> </span>sophisticated<span class="_ _14"> </span>analysis<span class="_ _1"></span>,<span class="_ _14"> </span>since<span class="_ _14"> </span><span class="ffd">strlen<span class="_ _14"> </span></span>checks</div><div class="t m5 x17 h26 y4225 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>elements<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>string<span class="_"> </span>and<span class="_"> </span>these<span class="_ _13"> </span>values<span class="_"> </span>are<span class="_"> </span>changing<span class="_"> </span>as<span class="_ _13"> </span><span class="ffd">lower1<span class="_ _10"> </span></span>proceeds<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _0"></span>he</div><div class="t m5 x17 h26 y4226 ff7 fs19 fc1 sc0 ls0 ws0">compiler<span class="_ _6"> </span>would<span class="_ _6"> </span>need<span class="_ _6"> </span>to<span class="_ _6"> </span>detect<span class="_ _6"> </span>that<span class="_ _13"> </span>even<span class="_ _a"> </span>though<span class="_ _6"> </span>the<span class="_ _6"> </span>characters<span class="_ _6"> </span>within<span class="_ _6"> </span>the<span class="_ _13"> </span>string<span class="_ _a"> </span>are</div><div class="t m5 x17 h26 y4227 ff7 fs19 fc1 sc0 ls0 ws0">changing,<span class="_ _13"> </span>none<span class="_"> </span>are<span class="_ _13"> </span>being<span class="_ _13"> </span>set<span class="_"> </span>from<span class="_ _13"> </span>nonzero<span class="_"> </span>to<span class="_ _13"> </span>zero<span class="_ _1"></span>,<span class="_"> </span>or<span class="_ _13"> </span>vice<span class="_"> </span>versa.<span class="_ _13"> </span>Such<span class="_"> </span>an<span class="_ _13"> </span>analysis</div><div class="t m5 x17 h26 y4228 ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_ _11"> </span>well<span class="_ _16"> </span>beyond<span class="_ _16"> </span>the<span class="_ _11"> </span>ability<span class="_ _16"> </span>of<span class="_ _16"> </span>even<span class="_ _11"> </span>the<span class="_ _16"> </span>most<span class="_ _16"> </span>sophisticated<span class="_ _11"> </span>compilers<span class="_ _1"></span>,<span class="_ _16"> </span>even<span class="_ _16"> </span>if<span class="_ _16"> </span>they</div><div class="t m5 x17 h26 y4229 ff7 fs19 fc1 sc0 ls0 ws0">employ<span class="_"> </span>inlining,<span class="_"> </span>and<span class="_"> </span>so<span class="_"> </span>programmers<span class="_"> </span>must<span class="_"> </span>do<span class="_"> </span>such<span class="_"> </span>transformations<span class="_"> </span>themselves<span class="_ _3"></span>.</div><div class="t m5 x26 h26 y422a ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _16"> </span>example<span class="_ _11"> </span>illustrates<span class="_ _16"> </span>a<span class="_ _11"> </span>common<span class="_ _11"> </span>problem<span class="_ _16"> </span>in<span class="_ _11"> </span>writing<span class="_ _16"> </span>programs<span class="_ _3"></span>,<span class="_ _16"> </span>in<span class="_ _11"> </span>which<span class="_ _16"> </span>a</div><div class="t m5 x17 h26 y422b ff7 fs19 fc1 sc0 ls0 ws0">seemingly<span class="_ _16"> </span>trivial<span class="_ _11"> </span>piece<span class="_ _16"> </span>of<span class="_ _16"> </span>code<span class="_ _16"> </span>has<span class="_ _16"> </span>a<span class="_ _11"> </span>hidden<span class="_ _16"> </span>asymptotic<span class="_ _16"> </span>inefﬁciency<span class="_ _7"></span>.<span class="_ _16"> </span>One<span class="_ _16"> </span>would</div><div class="t m5 x17 h26 y422c ff7 fs19 fc1 sc0 ls0 ws0">not<span class="_ _11"> </span>expect<span class="_ _16"> </span>a<span class="_ _11"> </span>lowercase<span class="_ _16"> </span>conversion<span class="_ _11"> </span>routine<span class="_ _11"> </span>to<span class="_ _16"> </span>be<span class="_ _11"> </span>a<span class="_ _16"> </span>limiting<span class="_ _11"> </span>factor<span class="_ _16"> </span>in<span class="_ _11"> </span>a<span class="_ _11"> </span>program’s</div><div class="t m5 x17 h26 y422d ff7 fs19 fc1 sc0 ls0 ws0">performance<span class="_ _1"></span>.<span class="_ _11"> </span>T<span class="_ _3"></span>ypically<span class="_ _3"></span>,<span class="_ _11"> </span>programs<span class="_ _11"> </span>are<span class="_ _11"> </span>tested<span class="_ _11"> </span>and<span class="_ _11"> </span>analyzed<span class="_ _11"> </span>on<span class="_ _11"> </span>small<span class="_ _11"> </span>data<span class="_ _11"> </span>sets<span class="_ _1"></span>,<span class="_ _11"> </span>for</div><div class="t m5 x17 h26 y422e ff7 fs19 fc1 sc0 ls0 ws0">which<span class="_ _16"> </span>the<span class="_ _14"> </span>performance<span class="_ _16"> </span>of<span class="_ _16"> </span><span class="ffd">lower1<span class="_ _14"> </span></span>is<span class="_ _16"> </span>adequate.<span class="_ _16"> </span>When<span class="_ _16"> </span>the<span class="_ _16"> </span>program<span class="_ _16"> </span>is<span class="_ _14"> </span>ultimately</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
