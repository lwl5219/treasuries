<div id="pfcf" class="pf w2 h11" data-page-no="cf"><div class="pc pccf w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bgcf.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">206<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x1d h2d ye7 ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">gcc<span class="_ _1f"> </span>-Og<span class="_ _1f"> </span>-o<span class="_ _e"> </span>p<span class="_ _1f"> </span>p1.c<span class="_ _e"> </span>p2.c</span></div><div class="t m5 x1d h26 y2080 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>command<span class="_ _13"> </span><span class="ffd">gcc<span class="_ _10"> </span></span>indicates<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ff9">gcc<span class="_ _10"> </span></span>C<span class="_ _13"> </span>compiler.<span class="_ _13"> </span>Since<span class="_"> </span>this<span class="_ _13"> </span>is<span class="_"> </span>the<span class="_ _13"> </span>default<span class="_ _13"> </span>compiler</div><div class="t m5 x1d h26 y2081 ff7 fs19 fc2 sc0 ls0 ws0">on<span class="_ _16"> </span>Linux,<span class="_ _14"> </span>we<span class="_ _14"> </span>could<span class="_ _16"> </span>also<span class="_ _16"> </span>invoke<span class="_ _14"> </span>it<span class="_ _16"> </span>as<span class="_ _14"> </span>simply<span class="_ _16"> </span><span class="ffd">cc</span>.<span class="_ _14"> </span>T<span class="_ _1"></span>he<span class="_ _14"> </span>command-line<span class="_ _16"> </span>option<span class="_ _14"> </span><span class="ffd">-Og</span></div><div class="t m5 x128 h3c y2082 ff7 fs25 fc2 sc0 ls0 ws0">1</div><div class="t m5 x1d h26 y2083 ff7 fs19 fc2 sc0 ls0 ws0">instructs<span class="_ _16"> </span>the<span class="_ _16"> </span>compiler<span class="_ _16"> </span>to<span class="_ _16"> </span>apply<span class="_ _11"> </span>a<span class="_ _16"> </span>level<span class="_ _16"> </span>of<span class="_ _16"> </span>optimization<span class="_ _16"> </span>that<span class="_ _16"> </span>yields<span class="_ _16"> </span>machine<span class="_ _16"> </span>code</div><div class="t m5 x1d h26 y2084 ff7 fs19 fc2 sc0 ls0 ws0">that<span class="_"> </span>follows<span class="_ _13"> </span>the<span class="_"> </span>overall<span class="_"> </span>structure<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>original<span class="_"> </span>C<span class="_"> </span>code<span class="_ _1"></span>.<span class="_"> </span>Invoking<span class="_"> </span>higher<span class="_ _13"> </span>levels<span class="_"> </span>of</div><div class="t m5 x1d h26 y2085 ff7 fs19 fc2 sc0 ls0 ws0">optimization<span class="_ _6"> </span>can<span class="_ _13"> </span>generate<span class="_ _6"> </span>code<span class="_ _13"> </span>that<span class="_ _6"> </span>is<span class="_ _13"> </span>so<span class="_ _6"> </span>heavily<span class="_ _13"> </span>transformed<span class="_ _6"> </span>that<span class="_ _13"> </span>the<span class="_ _6"> </span>relationship</div><div class="t m5 x1d h26 y2086 ff7 fs19 fc2 sc0 ls0 ws0">between<span class="_ _11"> </span>the<span class="_ _16"> </span>generated<span class="_ _16"> </span>machine<span class="_ _11"> </span>code<span class="_ _16"> </span>and<span class="_ _11"> </span>the<span class="_ _16"> </span>original<span class="_ _11"> </span>source<span class="_ _16"> </span>code<span class="_ _11"> </span>is<span class="_ _16"> </span>difﬁcult<span class="_ _16"> </span>to</div><div class="t m5 x1d h26 y2087 ff7 fs19 fc2 sc0 ls0 ws0">understand.<span class="_ _13"> </span>W<span class="_ _3"></span>e<span class="_ _13"> </span>will<span class="_ _13"> </span>therefore<span class="_ _13"> </span>use<span class="_ _6"> </span><span class="ffd">-Og<span class="_ _13"> </span></span>optimization<span class="_ _13"> </span>as<span class="_ _13"> </span>a<span class="_ _13"> </span>learning<span class="_ _6"> </span>tool<span class="_ _13"> </span>and<span class="_ _13"> </span>then<span class="_ _13"> </span>see</div><div class="t m5 x1d h26 y2088 ff7 fs19 fc2 sc0 ls0 ws0">what<span class="_ _11"> </span>happens<span class="_ _16"> </span>as<span class="_ _11"> </span>we<span class="_ _11"> </span>increase<span class="_ _16"> </span>the<span class="_ _11"> </span>level<span class="_ _16"> </span>of<span class="_ _11"> </span>optimization.<span class="_ _11"> </span>In<span class="_ _16"> </span>practice<span class="_ _1"></span>,<span class="_ _16"> </span>higher<span class="_ _11"> </span>levels</div><div class="t m5 x1d h26 y2089 ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_ _13"> </span>optimization<span class="_ _13"> </span>(e.g<span class="_ _1"></span>.,<span class="_"> </span>speciﬁed<span class="_ _13"> </span>with<span class="_ _13"> </span>the<span class="_ _13"> </span>option<span class="_"> </span><span class="ffd">-O1<span class="_ _13"> </span></span>or<span class="_ _13"> </span><span class="ffd">-O2</span>)<span class="_ _13"> </span>are<span class="_ _13"> </span>considered<span class="_ _13"> </span>a<span class="_"> </span>better</div><div class="t m5 x1d h26 y208a ff7 fs19 fc2 sc0 ls0 ws0">choice<span class="_"> </span>in<span class="_"> </span>terms<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>resulting<span class="_"> </span>program<span class="_"> </span>performance<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y208b ff7 fs19 fc2 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _10"> </span><span class="ffd ls0">gcc<span class="_ _13"> </span><span class="ff7">command<span class="_"> </span>invokes<span class="_ _13"> </span>an<span class="_ _13"> </span>entire<span class="_"> </span>sequence<span class="_ _13"> </span>of<span class="_ _13"> </span>programs<span class="_ _13"> </span>to<span class="_"> </span>turn<span class="_ _13"> </span>the<span class="_ _13"> </span>source</span></span></div><div class="t m5 x1d h26 y208c ff7 fs19 fc2 sc0 ls0 ws0">code<span class="_ _11"> </span>into<span class="_ _16"> </span>executable<span class="_ _11"> </span>code<span class="_ _0"></span>.<span class="_ _11"> </span>F<span class="_ _0"></span>irst,<span class="_ _16"> </span>the<span class="_ _11"> </span>C<span class="_ _11"> </span><span class="ffa">preprocessor<span class="_ _14"> </span></span>expands<span class="_ _11"> </span>the<span class="_ _16"> </span>source<span class="_ _11"> </span>code<span class="_ _11"> </span>to</div><div class="t m5 x1d h26 y208d ff7 fs19 fc2 sc0 ls0 ws0">include<span class="_ _11"> </span>any<span class="_ _16"> </span>ﬁles<span class="_ _16"> </span>speciﬁed<span class="_ _11"> </span>with<span class="_ _16"> </span><span class="ffd">#include<span class="_ _11"> </span></span>commands<span class="_ _16"> </span>and<span class="_ _16"> </span>to<span class="_ _11"> </span>expand<span class="_ _16"> </span>any<span class="_ _11"> </span>macros<span class="_ _1"></span>,</div><div class="t m5 x1d h26 y208e ff7 fs19 fc2 sc0 ls0 ws0">speciﬁed<span class="_ _14"> </span>with<span class="_ _15"> </span><span class="ffd">#define<span class="_ _14"> </span></span>declarations<span class="_ _1"></span>.<span class="_ _15"> </span>Second,<span class="_ _15"> </span>the<span class="_ _15"> </span><span class="ffa">compiler<span class="_ _21"> </span></span>generates<span class="_ _14"> </span>assembly-</div><div class="t m5 x1d h26 y208f ff7 fs19 fc2 sc0 ls0 ws0">code<span class="_ _21"> </span>versions<span class="_ _21"> </span>of<span class="_ _21"> </span>the<span class="_ _21"> </span>two<span class="_ _21"> </span>source<span class="_ _21"> </span>ﬁles<span class="_ _21"> </span>having<span class="_ _21"> </span>names<span class="_ _21"> </span><span class="ffd">p1.s<span class="_ _21"> </span></span>and<span class="_ _21"> </span><span class="ffd">p2.s</span>.<span class="_ _21"> </span>Next,<span class="_ _e"> </span>the</div><div class="t m5 x1d h26 y2090 ffa fs19 fc2 sc0 ls0 ws0">assembler<span class="_"> </span><span class="ff7">converts<span class="_ _13"> </span>the<span class="_ _13"> </span>assembly<span class="_ _13"> </span>code<span class="_"> </span>into<span class="_ _13"> </span>binary<span class="_ _13"> </span></span>object-code<span class="_ _13"> </span><span class="ff7">ﬁles<span class="_"> </span><span class="ffd">p1.o<span class="_ _13"> </span></span>and<span class="_ _13"> </span><span class="ffd">p2.o</span>.</span></div><div class="t m5 x1d h26 y2091 ff7 fs19 fc2 sc0 ls0 ws0">Object<span class="_ _13"> </span>code<span class="_ _6"> </span>is<span class="_ _13"> </span>one<span class="_ _6"> </span>form<span class="_ _13"> </span>of<span class="_ _6"> </span>machine<span class="_ _13"> </span>code—it<span class="_ _6"> </span>contains<span class="_ _13"> </span>binary<span class="_ _6"> </span>representations<span class="_ _13"> </span>of<span class="_ _6"> </span>all</div><div class="t m5 x1d h26 y2092 ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_"> </span>the<span class="_"> </span>instructions<span class="_ _3"></span>,<span class="_"> </span>but<span class="_"> </span>the<span class="_"> </span>addresses<span class="_"> </span>of<span class="_"> </span>global<span class="_"> </span>values<span class="_"> </span>are<span class="_"> </span>not<span class="_"> </span>yet<span class="_"> </span>ﬁlled<span class="_"> </span>in.<span class="_"> </span>F<span class="_ _1"></span>inally<span class="_ _3"></span>,</div><div class="t m5 x1d h26 y2093 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _6"> </span><span class="ffa">linker<span class="_"> </span></span>merges<span class="_ _a"> </span>these<span class="_ _13"> </span>two<span class="_ _6"> </span>object-code<span class="_ _13"> </span>ﬁles<span class="_ _6"> </span>along<span class="_ _6"> </span>with<span class="_ _13"> </span>code<span class="_ _6"> </span>implementing<span class="_ _13"> </span>library</div><div class="t m5 x1d h26 y2094 ff7 fs19 fc2 sc0 ls0 ws0">functions<span class="_ _13"> </span>(e<span class="_ _0"></span>.g.,<span class="_ _13"> </span><span class="ffd">printf</span>)<span class="_ _13"> </span>and<span class="_ _13"> </span>generates<span class="_ _13"> </span>the<span class="_ _13"> </span>ﬁnal<span class="_"> </span>executable<span class="_ _13"> </span>code<span class="_ _13"> </span>ﬁle<span class="_ _13"> </span><span class="ffd">p<span class="_ _13"> </span></span>(as<span class="_ _13"> </span>speciﬁed</div><div class="t m5 x1d h26 y2095 ff7 fs19 fc2 sc0 ls0 ws0">by<span class="_ _f"> </span>the<span class="_ _e"> </span>command-line<span class="_ _21"> </span>directive<span class="_ _e"> </span><span class="ffd">-o<span class="_ _11"> </span>p</span>).<span class="_ _f"> </span>Executable<span class="_ _e"> </span>code<span class="_ _f"> </span>is<span class="_ _f"> </span>the<span class="_ _e"> </span>second<span class="_ _21"> </span>form<span class="_ _e"> </span>of</div><div class="t m5 x1d h26 y2096 ff7 fs19 fc2 sc0 ls0 ws0">machine<span class="_ _16"> </span>code<span class="_ _16"> </span>we<span class="_ _16"> </span>will<span class="_ _11"> </span>consider<span class="_ _0"></span>—it<span class="_ _16"> </span>is<span class="_ _16"> </span>the<span class="_ _11"> </span>exact<span class="_ _16"> </span>form<span class="_ _16"> </span>of<span class="_ _16"> </span>code<span class="_ _16"> </span>that<span class="_ _16"> </span>is<span class="_ _16"> </span>executed<span class="_ _16"> </span>by</div><div class="t m5 x1d h26 y2097 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _16"> </span>processor.<span class="_ _11"> </span>The<span class="_ _16"> </span>relation<span class="_ _16"> </span>between<span class="_ _16"> </span>these<span class="_ _16"> </span>different<span class="_ _16"> </span>forms<span class="_ _16"> </span>of<span class="_ _16"> </span>machine<span class="_ _16"> </span>code<span class="_ _16"> </span>and</div><div class="t m5 x1d h26 y2098 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>linking<span class="_"> </span>process<span class="_"> </span>is<span class="_"> </span>described<span class="_"> </span>in<span class="_"> </span>more<span class="_"> </span>detail<span class="_"> </span>in<span class="_"> </span>Chapter<span class="_"> </span>7.</div><div class="t m5 x1d h41 y2099 ffe fs29 fc2 sc0 ls0 ws0">3.2.1<span class="_ _48"> </span><span class="fs19">Machine-Level<span class="_"> </span>Code</span></div><div class="t m5 x1d h26 y209a ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_ _16"> </span>described<span class="_ _11"> </span>in<span class="_ _16"> </span>Section<span class="_ _16"> </span>1.9.3,<span class="_ _16"> </span>computer<span class="_ _11"> </span>systems<span class="_ _16"> </span>employ<span class="_ _16"> </span>several<span class="_ _11"> </span>different<span class="_ _16"> </span>forms</div><div class="t m5 x1d h26 y209b ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_ _11"> </span>abstraction,<span class="_ _16"> </span>hiding<span class="_ _16"> </span>details<span class="_ _11"> </span>of<span class="_ _11"> </span>an<span class="_ _16"> </span>implementation<span class="_ _11"> </span>through<span class="_ _16"> </span>the<span class="_ _11"> </span>use<span class="_ _16"> </span>of<span class="_ _11"> </span>a<span class="_ _16"> </span>simpler</div><div class="t m5 x1d h26 y209c ff7 fs19 fc2 sc0 ls0 ws0">abstract<span class="_ _13"> </span>model.<span class="_ _13"> </span>T<span class="_ _7"></span>wo<span class="_ _13"> </span>of<span class="_"> </span>these<span class="_ _13"> </span>are<span class="_ _13"> </span>especially<span class="_ _13"> </span>important<span class="_ _13"> </span>for<span class="_ _13"> </span>machine-level<span class="_ _13"> </span>program-</div><div class="t m5 x1d h26 y209d ff7 fs19 fc2 sc0 ls0 ws0">ming.<span class="_ _13"> </span>F<span class="_ _0"></span>irst,<span class="_"> </span>the<span class="_ _13"> </span>format<span class="_ _13"> </span>and<span class="_"> </span>behavior<span class="_ _13"> </span>of<span class="_"> </span>a<span class="_ _13"> </span>machine-level<span class="_"> </span>program<span class="_ _13"> </span>is<span class="_"> </span>deﬁned<span class="_ _13"> </span>by<span class="_"> </span>the</div><div class="t m5 x1d h26 y209e ffa fs19 fc2 sc0 ls0 ws0">instruction<span class="_"> </span>set<span class="_"> </span>architecture<span class="ff7">,<span class="_"> </span>or<span class="_"> </span>ISA,<span class="_"> </span>deﬁning<span class="_"> </span>the<span class="_"> </span>processor<span class="_"> </span>state<span class="_ _3"></span>,<span class="_"> </span>the<span class="_"> </span>format<span class="_"> </span>of<span class="_"> </span>the</span></div><div class="t m5 x1d h26 y209f ff7 fs19 fc2 sc0 ls0 ws0">instructions<span class="_ _1"></span>,<span class="_"> </span>and<span class="_"> </span>the<span class="_"> </span>effect<span class="_"> </span>each<span class="_"> </span>of<span class="_"> </span>these<span class="_"> </span>instructions<span class="_"> </span>will<span class="_"> </span>have<span class="_"> </span>on<span class="_ _11"> </span>the<span class="_"> </span>state<span class="_ _1"></span>.<span class="_"> </span>Most</div><div class="t m5 x1d h26 y20a0 ff7 fs19 fc2 sc0 ls0 ws0">ISAs<span class="_ _1"></span>,<span class="_ _13"> </span>including<span class="_ _13"> </span>x86-64,<span class="_ _13"> </span>describe<span class="_ _13"> </span>the<span class="_ _13"> </span>behavior<span class="_ _13"> </span>of<span class="_ _13"> </span>a<span class="_ _13"> </span>program<span class="_ _13"> </span>as<span class="_ _13"> </span>if<span class="_ _13"> </span>each<span class="_ _6"> </span>instruction<span class="_ _13"> </span>is</div><div class="t m5 x1d h26 y20a1 ff7 fs19 fc2 sc0 ls0 ws0">executed<span class="_ _13"> </span>in<span class="_ _13"> </span>sequence<span class="_ _1"></span>,<span class="_ _13"> </span>with<span class="_ _13"> </span>one<span class="_ _13"> </span>instruction<span class="_ _13"> </span>completing<span class="_ _13"> </span>before<span class="_ _13"> </span>the<span class="_ _13"> </span>next<span class="_ _13"> </span>one<span class="_ _13"> </span>begins<span class="_ _3"></span>.</div><div class="t m5 x1d h26 y20a2 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _11"> </span>processor<span class="_ _16"> </span>hardware<span class="_ _11"> </span>is<span class="_ _11"> </span>far<span class="_ _11"> </span>more<span class="_ _11"> </span>elaborate,<span class="_"> </span>executing<span class="_ _16"> </span>many<span class="_ _11"> </span>instructions<span class="_ _11"> </span>con-</div><div class="t m5 x1d h26 y20a3 ff7 fs19 fc2 sc0 ls0 ws0">currently<span class="_ _3"></span>,<span class="_ _11"> </span>but<span class="_ _11"> </span>it<span class="_ _16"> </span>employs<span class="_"> </span>safeguards<span class="_ _16"> </span>to<span class="_ _11"> </span>ensure<span class="_ _11"> </span>that<span class="_ _11"> </span>the<span class="_ _11"> </span>overall<span class="_ _16"> </span>behavior<span class="_"> </span>matches</div><div class="t m5 x1d h26 y20a4 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _13"> </span>sequential<span class="_ _13"> </span>operation<span class="_ _13"> </span>dictated<span class="_ _13"> </span>by<span class="_ _13"> </span>the<span class="_ _13"> </span>ISA.<span class="_ _13"> </span>Second,<span class="_ _13"> </span>the<span class="_ _13"> </span>memory<span class="_ _13"> </span>addresses<span class="_ _13"> </span>used</div><div class="t m5 x1d h26 y20a5 ff7 fs19 fc2 sc0 ls0 ws0">by<span class="_ _13"> </span>a<span class="_ _13"> </span>machine-level<span class="_ _13"> </span>program<span class="_ _13"> </span>are<span class="_"> </span><span class="ffa">virtual<span class="_ _13"> </span>addresses</span>,<span class="_ _13"> </span>providing<span class="_ _13"> </span>a<span class="_ _13"> </span>memory<span class="_ _13"> </span>model<span class="_ _13"> </span>that</div><div class="t m5 x1d h1d y20a6 ff7 fs17 fc2 sc0 ls0 ws0">1.<span class="_ _10"> </span>T<span class="_ _1"></span>his<span class="_ _10"> </span>optimization<span class="_ _10"> </span>level<span class="_ _10"> </span>was<span class="_ _10"> </span>introduced<span class="_ _10"> </span>in<span class="_ _10"> </span><span class="ff9">gcc<span class="_ _13"> </span></span>version<span class="_ _10"> </span>4.8.<span class="_ _10"> </span>Earlier<span class="_ _10"> </span>versions<span class="_ _10"> </span>of<span class="_ _10"> </span><span class="ff9">gcc</span>,<span class="_ _10"> </span>as<span class="_ _10"> </span>well<span class="_"> </span>as<span class="_ _10"> </span>non-</div><div class="t m5 x1d h1d y20a7 ff7 fs17 fc2 sc0 ls0 ws0">GNU<span class="_"> </span>compilers<span class="_ _1"></span>,<span class="_"> </span>will<span class="_"> </span>not<span class="_"> </span>recognize<span class="_ _6"> </span>this<span class="_"> </span>option.<span class="_"> </span>F<span class="_ _1"></span>or<span class="_"> </span>these<span class="_ _0"></span>,<span class="_"> </span>using<span class="_"> </span>optimization<span class="_ _6"> </span>level<span class="_"> </span>one<span class="_"> </span>(speciﬁed<span class="_"> </span>with</div><div class="t m5 x1d h1d y20a8 ff7 fs17 fc2 sc0 ls0 ws0">the<span class="_ _10"> </span>command-line<span class="_"> </span>ﬂag</div><div class="t m5 xd h1d y5e3 ffd fs35 fc2 sc0 ls0 ws0">-O1<span class="ff7 fs17">)<span class="_ _10"> </span>is<span class="_"> </span>probably<span class="_ _10"> </span>the<span class="_ _10"> </span>best<span class="_"> </span>choice<span class="_ _10"> </span>for<span class="_ _10"> </span>generating<span class="_"> </span>code<span class="_ _10"> </span>that<span class="_ _10"> </span>follows<span class="_"> </span>the<span class="_ _10"> </span>original</span></div><div class="t m5 x1d h1d y5e4 ff7 fs17 fc2 sc0 ls0 ws0">program<span class="_"> </span>structure<span class="_ _0"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
