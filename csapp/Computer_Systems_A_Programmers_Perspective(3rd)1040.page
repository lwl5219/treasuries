<div id="pf410" class="pf w2 h11" data-page-no="410"><div class="pc pc410 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg410.png"/><div class="t m5 x69 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>12.5<span class="_ _60"> </span>Synchronizing<span class="_ _10"> </span>Threads<span class="_ _10"> </span>with<span class="_ _10"> </span>Semaphores<span class="_ _3e"> </span><span class="ffe fs1e">1039</span></div><div class="t m5 x1a0 h3f y820c ffed fs27 fc1 sc0 ls0 ws0">Thread 2</div><div class="t m5 x6b h3f y820d ffed fs27 fc1 sc0 ls0 ws0">Thread 1</div><div class="t m5 x1b8 h3f y820e ffee fs27 fc1 sc0 ls0 ws0">S</div><div class="t m5 x5b h65 y820f ffed fs38 fc1 sc0 ls0 ws0">2</div><div class="t m5 x1b8 h3f y8210 ffee fs27 fc1 sc0 ls0 ws0">T</div><div class="t m5 x5b h65 y8211 ffed fs38 fc1 sc0 ls0 ws0">2</div><div class="t m5 x12 h3f y8212 ffee fs27 fc1 sc0 ls0 ws0">U</div><div class="t m5 x5b h65 y8213 ffed fs38 fc1 sc0 ls0 ws0">2</div><div class="t m5 x1d3 h3f y8214 ffee fs27 fc1 sc0 ls0 ws0">L</div><div class="t m5 x5b h65 y8215 ffed fs38 fc1 sc0 ls0 ws0">2</div><div class="t m5 x123 h3f y8216 ffee fs27 fc1 sc0 ls0 ws0">P<span class="_ _2"></span><span class="ffed">(</span>s<span class="ffed">)</span></div><div class="t m5 x12 h3f y8217 ffee fs27 fc1 sc0 ls0 ws0">H</div><div class="t m5 x5b h65 y8218 ffed fs38 fc1 sc0 ls0 ws0">2</div><div class="t m5 x23a h3f y8219 ffee fs27 fc1 sc0 ls0 ws0">H</div><div class="t m5 xf6 h65 y821a ffed fs38 fc1 sc0 ls0 ws0">1</div><div class="t m5 xcd h3f y8219 ffee fs27 fc1 sc0 ls0 ws0">P<span class="_ _2"></span><span class="ffed">(</span>s<span class="ffed">)<span class="_ _3c"> </span></span>L</div><div class="t m5 x1af h65 y821a ffed fs38 fc1 sc0 ls0 ws0">1</div><div class="t m5 x167 h3f y8219 ffee fs27 fc1 sc0 ls0 ws0">U</div><div class="t m5 x16c h65 y821a ffed fs38 fc1 sc0 ls0 ws0">1</div><div class="t m5 xe4 h3f y8219 ffee fs27 fc1 sc0 ls0 ws0">S</div><div class="t m5 x18 h65 y821a ffed fs38 fc1 sc0 ls0 ws0">1</div><div class="t m5 x122 h3f y8219 ffee fs27 fc1 sc0 ls0 ws0">V<span class="_ _2"></span><span class="ffed">(</span>s<span class="ffed">)</span></div><div class="t m5 x21e h3f y821b ffee fs27 fc1 sc0 ls0 ws0">V<span class="_ _2"></span><span class="ffed">(</span>s<span class="ffed">)</span></div><div class="t m5 x1c9 h3f y8219 ffee fs27 fc1 sc0 ls0 ws0">T</div><div class="t m5 xc0 h65 y821a ffed fs38 fc1 sc0 ls0 ws0">1</div><div class="t m5 x5a h65 y821c ffed fs38 fc1 sc0 ls0 ws0">1</div><div class="t m5 x5a h65 y821d ffed fs38 fc1 sc0 ls0 ws0">1</div><div class="t m5 x5a h65 y821e ffed fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 x5a h65 y821f ffed fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 x5a h65 y8220 ffed fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 x5a h65 y8221 ffed fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 xa3 h65 y8222 ffed fs38 fc1 sc0 ls0 ws0">1</div><div class="t m5 xa3 h65 y8223 ffed fs38 fc1 sc0 ls0 ws0">1</div><div class="t m5 xa3 h65 y8224 ffed fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 xa3 h65 y8225 ffed fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 xa3 h65 y8226 ffed fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 xa3 h65 y8227 ffed fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 x1a h65 y8228 ffed fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 x1a h65 y8229 ffed fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 x25 h65 y822a ffed fs38 fc1 sc0 ls0 ws0">–1</div><div class="t m5 x25 h65 y822b ffed fs38 fc1 sc0 ls0 ws0">–1</div><div class="t m5 x25 h65 y822c ffed fs38 fc1 sc0 ls0 ws0">–1</div><div class="t m5 x25 h65 y822d ffed fs38 fc1 sc0 ls0 ws0">–1</div><div class="t m5 x1f4 h65 y822e ffed fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 x1f4 h65 y822f ffed fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 x1f4 h65 y8230 ffed fs38 fc1 sc0 ls0 ws0">–1</div><div class="t m5 x1f4 h65 y8231 ffed fs38 fc1 sc0 ls0 ws0">–1</div><div class="t m5 x1f4 h65 y8232 ffed fs38 fc1 sc0 ls0 ws0">–1</div><div class="t m5 x1f4 h65 y8233 ffed fs38 fc1 sc0 ls0 ws0">–1</div><div class="t m5 x241 h65 y8234 ffed fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 x241 h65 y8235 ffed fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 x143 h65 y8236 ffed fs38 fc1 sc0 ls0 ws0">–1</div><div class="t m5 x143 h65 y8237 ffed fs38 fc1 sc0 ls0 ws0">–1</div><div class="t m5 x143 h65 y8238 ffed fs38 fc1 sc0 ls0 ws0">–1</div><div class="t m5 x143 h65 y8239 ffed fs38 fc1 sc0 ls0 ws0">–1</div><div class="t m5 x121 h65 y823a ffed fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 x121 h65 y823b ffed fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 x7b h65 y823c ffed fs38 fc1 sc0 ls0 ws0">–1</div><div class="t m5 x7b h65 y823d ffed fs38 fc1 sc0 ls0 ws0">–1</div><div class="t m5 x7b h65 y823e ffed fs38 fc1 sc0 ls0 ws0">–1</div><div class="t m5 x7b h65 y823f ffed fs38 fc1 sc0 ls0 ws0">–1</div><div class="t m5 x1d9 h65 y8240 ffed fs38 fc1 sc0 ls0 ws0">1</div><div class="t m5 x1d9 h65 y8241 ffed fs38 fc1 sc0 ls0 ws0">1</div><div class="t m5 x1d9 h65 y8242 ffed fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 x1d9 h65 y8243 ffed fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 x1d9 h65 y8244 ffed fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 x1d9 h65 y8245 ffed fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 x1a3 h65 y8246 ffed fs38 fc1 sc0 ls0 ws0">1</div><div class="t m5 x1a3 h65 y8247 ffed fs38 fc1 sc0 ls0 ws0">1</div><div class="t m5 x1a3 h65 y8248 ffed fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 x1a3 h65 y8249 ffed fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 x1a3 h65 y824a ffed fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 x1a3 h65 y824b ffed fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 x5a h65 y824c ffed fs38 fc1 sc0 ls2f5 ws0">11000011</div><div class="t m5 x5a h65 y824d ffed fs38 fc1 sc0 ls2f5 ws0">11000011</div><div class="t m5 xe6 h3f y824e ffed fs27 fc1 sc0 ls0 ws0">Unsafe region</div><div class="t m5 x1a6 h3f y824f ffed fs27 fc1 sc0 ls0 ws0">Forbidden region</div><div class="t m5 x2c h3f y8250 ffed fs27 fc1 sc0 ls0 ws0">Initially</div><div class="t m5 xee h3f y8251 ffee fs27 fc1 sc0 ls0 ws0">s<span class="ff24"><span class="ffed">1</span></span></div><div class="t m5 x17 h34 y8252 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _16"> </span>12.22<span class="_ _c"> </span><span class="fc1">Using<span class="_ _16"> </span>semaphores<span class="_ _16"> </span>for<span class="_ _16"> </span>mutual<span class="_ _16"> </span>exclusion.<span class="_ _14"> </span><span class="ff6">The<span class="_ _16"> </span>infeasible<span class="_ _16"> </span>states<span class="_ _16"> </span>where</span></span></div><div class="t m5 x17 h1c y8253 ff11 fs16 fc1 sc0 ls2f6 ws0">s&lt;<span class="_ _1"></span><span class="ff7 ls0">0<span class="_"> </span><span class="ff6">deﬁne<span class="_ _13"> </span>a<span class="_ _13"> </span><span class="ffb">forbidden<span class="_ _10"> </span>region<span class="_ _13"> </span></span>that<span class="_ _13"> </span>surrounds<span class="_ _10"> </span>the<span class="_ _13"> </span>unsafe<span class="_ _13"> </span>region<span class="_ _10"> </span>and<span class="_ _13"> </span>prevents<span class="_ _13"> </span>any<span class="_ _13"> </span>feasible</span></span></div><div class="t m5 x17 h34 y8254 ff6 fs16 fc1 sc0 ls0 ws0">trajectory<span class="_ _10"> </span>from<span class="_ _11"> </span>touching<span class="_ _10"> </span>the<span class="_ _11"> </span>unsafe<span class="_ _10"> </span>region.</div><div class="t m5 x17 h26 y421c ff7 fs19 fc1 sc0 ls0 ws0">each<span class="_ _16"> </span>shared<span class="_ _16"> </span>variable<span class="_ _16"> </span>(or<span class="_ _16"> </span>related<span class="_ _16"> </span>set<span class="_ _14"> </span>of<span class="_ _16"> </span>shared<span class="_ _16"> </span>variables)<span class="_ _16"> </span>and<span class="_ _16"> </span>then<span class="_ _16"> </span>surround<span class="_ _14"> </span>the</div><div class="t m5 x17 h26 y421d ff7 fs19 fc1 sc0 ls0 ws0">corresponding<span class="_"> </span>critical<span class="_"> </span>section<span class="_"> </span>with<span class="_"> </span><span class="ff11 ls2f3">P(<span class="_ _4"></span>s<span class="_ _3"></span>)<span class="_ _be"></span><span class="ff7 ls0">and<span class="_"> </span></span><span class="ls2f4">V(<span class="_ _8"></span>s<span class="_ _7"></span>)<span class="_ _5"></span><span class="ff7 ls0">operations<span class="_ _1"></span>.</span></span></span></div><div class="t m5 x26 h26 y421e ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_ _16"> </span>semaphore<span class="_ _16"> </span>that<span class="_ _16"> </span>is<span class="_ _16"> </span>used<span class="_ _16"> </span>in<span class="_ _16"> </span>this<span class="_ _11"> </span>way<span class="_ _16"> </span>to<span class="_ _16"> </span>protect<span class="_ _16"> </span>shared<span class="_ _16"> </span>variables<span class="_ _16"> </span>is<span class="_ _16"> </span>called<span class="_ _16"> </span>a</div><div class="t m5 x17 h26 y421f ffa fs19 fc1 sc0 ls0 ws0">binary<span class="_ _16"> </span>semaphore<span class="_ _14"> </span><span class="ff7">because<span class="_ _14"> </span>its<span class="_ _14"> </span>value<span class="_ _16"> </span>is<span class="_ _14"> </span>always<span class="_ _14"> </span>0<span class="_ _16"> </span>or<span class="_ _14"> </span>1<span class="_ _1"></span>.<span class="_ _14"> </span>Binary<span class="_ _14"> </span>semaphores<span class="_ _16"> </span>whose</span></div><div class="t m5 x17 h26 y4220 ff7 fs19 fc1 sc0 ls0 ws0">purpose<span class="_ _14"> </span>is<span class="_ _15"> </span>to<span class="_ _14"> </span>provide<span class="_ _15"> </span>mutual<span class="_ _14"> </span>exclusion<span class="_ _15"> </span>are<span class="_ _14"> </span>often<span class="_ _14"> </span>called<span class="_ _15"> </span><span class="ffa">mutexes</span>.<span class="_ _14"> </span>Performing<span class="_ _14"> </span>a</div><div class="t m5 x17 h26 y4221 ff11 fs19 fc1 sc0 ls0 ws0">P<span class="_ _1f"> </span><span class="ff7">operation<span class="_ _14"> </span>on<span class="_ _15"> </span>a<span class="_ _14"> </span>mutex<span class="_ _15"> </span>is<span class="_ _14"> </span>called<span class="_ _15"> </span><span class="ffa">locking<span class="_ _15"> </span></span>the<span class="_ _15"> </span>mutex.<span class="_ _14"> </span>Similarly<span class="_ _3"></span>,<span class="_ _15"> </span>performing<span class="_ _15"> </span>the</span></div><div class="t m5 x17 h26 y4222 ff11 fs19 fc1 sc0 ls0 ws0">V<span class="_ _e"> </span><span class="ff7">operation<span class="_"> </span>is<span class="_ _11"> </span>called<span class="_ _16"> </span><span class="ffa">unlocking<span class="_ _11"> </span></span>the<span class="_ _11"> </span>mutex.<span class="_ _16"> </span>A<span class="_"> </span>thread<span class="_ _16"> </span>that<span class="_"> </span>has<span class="_ _16"> </span>locked<span class="_"> </span>but<span class="_ _16"> </span>not<span class="_"> </span>yet</span></div><div class="t m5 x17 h26 y4223 ff7 fs19 fc1 sc0 ls0 ws0">unlocked<span class="_"> </span>a<span class="_"> </span>mutex<span class="_ _11"> </span>is<span class="_"> </span>said<span class="_ _11"> </span>to<span class="_"> </span>be<span class="_"> </span><span class="ffa">holding<span class="_ _16"> </span></span>the<span class="_"> </span>mutex.<span class="_"> </span>A<span class="_ _11"> </span>semaphore<span class="_"> </span>that<span class="_ _11"> </span>is<span class="_"> </span>used<span class="_"> </span>as<span class="_ _11"> </span>a</div><div class="t m5 x17 h26 y4224 ff7 fs19 fc1 sc0 ls0 ws0">counter<span class="_"> </span>for<span class="_"> </span>a<span class="_"> </span>set<span class="_"> </span>of<span class="_"> </span>available<span class="_"> </span>resources<span class="_"> </span>is<span class="_"> </span>called<span class="_"> </span>a<span class="_"> </span><span class="ffa">counting<span class="_"> </span>semaphore</span>.</div><div class="t m5 x26 h26 y4225 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _14"> </span>progress<span class="_ _14"> </span>graph<span class="_ _14"> </span>in<span class="_ _14"> </span>Figure<span class="_ _16"> </span>12.22<span class="_ _14"> </span>shows<span class="_ _14"> </span>how<span class="_ _14"> </span>we<span class="_ _14"> </span>would<span class="_ _14"> </span>use<span class="_ _14"> </span>binary<span class="_ _14"> </span>sema-</div><div class="t m5 x17 h26 y4226 ff7 fs19 fc1 sc0 ls0 ws0">phores<span class="_"> </span>to<span class="_"> </span>properly<span class="_"> </span>synchronize<span class="_"> </span>our<span class="_"> </span>example<span class="_"> </span>counter<span class="_"> </span>program.</div><div class="t m5 x26 h26 y4227 ff7 fs19 fc1 sc0 ls0 ws0">Each<span class="_"> </span>state<span class="_ _11"> </span>is<span class="_ _11"> </span>labeled<span class="_"> </span>with<span class="_ _11"> </span>the<span class="_ _11"> </span>value<span class="_ _11"> </span>of<span class="_"> </span>semaphore<span class="_ _11"> </span><span class="ff11">s<span class="_"> </span></span>in<span class="_ _11"> </span>that<span class="_"> </span>state.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_ _11"> </span>crucial</div><div class="t m5 x17 h26 y4228 ff7 fs19 fc1 sc0 ls0 ws0">idea<span class="_"> </span>is<span class="_"> </span>that<span class="_"> </span>this<span class="_"> </span>combination<span class="_ _11"> </span>of<span class="_"> </span><span class="ff11">P<span class="_ _21"> </span></span>and<span class="_"> </span><span class="ff11">V<span class="_ _e"> </span></span>operations<span class="_"> </span>creates<span class="_"> </span>a<span class="_"> </span>collection<span class="_"> </span>of<span class="_"> </span>states<span class="_ _1"></span>,</div><div class="t m5 x17 h26 y4229 ff7 fs19 fc1 sc0 ls0 ws0">called<span class="_ _16"> </span>a<span class="_ _16"> </span><span class="ffa">forbidden<span class="_ _16"> </span>region</span>,<span class="_ _16"> </span>where<span class="_ _16"> </span><span class="ff11 lsa4">s&lt;<span class="_ _1"></span><span class="ff7 ls58">0.<span class="_ _16"> </span>Because<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _14"> </span>semaphore<span class="_ _16"> </span>invariant,<span class="_ _16"> </span>no</span></span></div><div class="t m5 x17 h26 y422a ff7 fs19 fc1 sc0 ls0 ws0">feasible<span class="_ _13"> </span>trajectory<span class="_ _13"> </span>can<span class="_ _13"> </span>include<span class="_ _13"> </span>one<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>states<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_ _13"> </span>forbidden<span class="_ _13"> </span>region.<span class="_ _13"> </span>And<span class="_ _13"> </span>since</div><div class="t m5 x17 h26 y422b ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _13"> </span>forbidden<span class="_ _13"> </span>region<span class="_ _13"> </span>completely<span class="_ _13"> </span>encloses<span class="_ _13"> </span>the<span class="_ _13"> </span>unsafe<span class="_ _13"> </span>region,<span class="_"> </span>no<span class="_ _13"> </span>feasible<span class="_ _13"> </span>trajectory</div><div class="t m5 x17 h26 y422c ff7 fs19 fc1 sc0 ls0 ws0">can<span class="_ _13"> </span>touch<span class="_ _13"> </span>any<span class="_ _13"> </span>part<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>unsafe<span class="_ _13"> </span>region.<span class="_ _13"> </span>T<span class="_ _1"></span>hus<span class="_ _1"></span>,<span class="_"> </span>every<span class="_ _13"> </span>feasible<span class="_ _13"> </span>trajectory<span class="_ _13"> </span>is<span class="_ _13"> </span>safe<span class="_ _0"></span>,<span class="_ _13"> </span>and</div><div class="t m5 x17 h26 y422d ff7 fs19 fc1 sc0 ls0 ws0">regardless<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>ordering<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>instructions<span class="_ _11"> </span>at<span class="_ _16"> </span>run<span class="_ _16"> </span>time<span class="_ _1"></span>,<span class="_ _16"> </span>the<span class="_ _16"> </span>program<span class="_ _16"> </span>correctly</div><div class="t m5 x17 h26 y422e ff7 fs19 fc1 sc0 ls0 ws0">increments<span class="_"> </span>the<span class="_"> </span>counter.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
