<div id="pfd3" class="pf w2 h11" data-page-no="d3"><div class="pc pcd3 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bgd3.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">210<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 xc4 h75 ye7 ff13 fs35 fc6 sc0 ls0 ws0">Disassembly<span class="_ _f"> </span>of<span class="_ _f"> </span>function<span class="_ _f"> </span><span class="ffd fs1f">sum<span class="_ _e"> </span></span>in<span class="_ _21"> </span>binary<span class="_ _f"> </span>file<span class="_ _e"> </span><span class="ffd fs1f">mstore.o</span></div><div class="t m5 x1f h2d yc4d ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">0000000000000000<span class="_ _1f"> </span>&lt;multstore&gt;:</span></div><div class="t m5 x4f h61 yecb ff13 fs35 fc6 sc0 ls0 ws0">Offset<span class="_ _3e"> </span>Bytes<span class="_ _d8"> </span>Equivalent<span class="_ _f"> </span>assembly<span class="_ _f"> </span>language</div><div class="t m5 x1f h2d yecc ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _5b"> </span><span class="ffd fs1e fc2">0:<span class="_ _3f"> </span>53<span class="_ _129"> </span>push<span class="_ _3f"> </span>%rbx</span></div><div class="t m5 x1f h2d yecd ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _5b"> </span><span class="ffd fs1e fc2">1:<span class="_ _3f"> </span>48<span class="_ _1f"> </span>89<span class="_ _e"> </span>d3<span class="_ _12a"> </span>mov<span class="_ _46"> </span>%rdx,%rbx</span></div><div class="t m5 x1f h2d yece ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _5b"> </span><span class="ffd fs1e fc2">4:<span class="_ _3f"> </span>e8<span class="_ _1f"> </span>00<span class="_ _e"> </span>00<span class="_ _1f"> </span>00<span class="_ _e"> </span>00<span class="_ _86"> </span>callq<span class="_ _1a"> </span>9<span class="_ _1f"> </span>&lt;multstore+0x9&gt;</span></div><div class="t m5 x1f h2d yecf ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _5b"> </span><span class="ffd fs1e fc2">9:<span class="_ _3f"> </span>48<span class="_ _1f"> </span>89<span class="_ _e"> </span>03<span class="_ _12a"> </span>mov<span class="_ _46"> </span>%rax,(%rbx)</span></div><div class="t m5 x1f h2d yed0 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _5b"> </span><span class="ffd fs1e fc2">c:<span class="_ _3f"> </span>5b<span class="_ _129"> </span>pop<span class="_ _46"> </span>%rbx</span></div><div class="t m5 x1f h2e y20fe ff6 fs20 fc6 sc0 ls0 ws0">7</div><div class="t m5 x1c4 h2d y1a10 ffd fs1e fc2 sc0 ls0 ws0">d:<span class="_ _3f"> </span>c3<span class="_ _129"> </span>retq</div><div class="t m5 x1d h26 y20ff ff7 fs19 fc2 sc0 ls0 ws0">On<span class="_ _14"> </span>the<span class="_ _14"> </span>left<span class="_ _14"> </span>we<span class="_ _14"> </span>see<span class="_ _14"> </span>the<span class="_ _14"> </span>14<span class="_ _14"> </span>hexadecimal<span class="_ _14"> </span>byte<span class="_ _14"> </span>values<span class="_ _1"></span>,<span class="_ _15"> </span>listed<span class="_ _14"> </span>in<span class="_ _14"> </span>the<span class="_ _14"> </span>byte<span class="_ _15"> </span>sequence</div><div class="t m5 x1d h26 y2100 ff7 fs19 fc2 sc0 ls0 ws0">shown<span class="_"> </span>earlier,<span class="_ _11"> </span>partitioned<span class="_ _11"> </span>into<span class="_"> </span>groups<span class="_ _11"> </span>of<span class="_ _11"> </span>1<span class="_ _11"> </span>to<span class="_ _11"> </span>5<span class="_ _11"> </span>bytes<span class="_"> </span>each.<span class="_ _11"> </span>Each<span class="_ _11"> </span>of<span class="_ _11"> </span>these<span class="_ _11"> </span>groups</div><div class="t m5 x1d h26 y2101 ff7 fs19 fc2 sc0 ls0 ws0">is<span class="_"> </span>a<span class="_"> </span>single<span class="_ _13"> </span>instruction,<span class="_"> </span>with<span class="_"> </span>the<span class="_"> </span>assembly-language<span class="_ _13"> </span>equivalent<span class="_"> </span>shown<span class="_"> </span>on<span class="_"> </span>the<span class="_ _13"> </span>right.</div><div class="t m5 x29 h26 y2102 ff7 fs19 fc2 sc0 ls0 ws0">Several<span class="_ _13"> </span>features<span class="_"> </span>about<span class="_ _13"> </span>machine<span class="_"> </span>code<span class="_ _13"> </span>and<span class="_"> </span>its<span class="_ _13"> </span>disassembled<span class="_ _13"> </span>representation<span class="_"> </span>are</div><div class="t m5 x1d h26 y2103 ff7 fs19 fc2 sc0 ls0 ws0">worth<span class="_"> </span>noting:</div><div class="t m5 x75 h3d y2104 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y2105 ff7 fs19 fc1 sc0 ls0 ws0">x86-64<span class="_ _14"> </span>instructions<span class="_ _14"> </span>can<span class="_ _15"> </span>range<span class="_ _14"> </span>in<span class="_ _15"> </span>length<span class="_ _14"> </span>from<span class="_ _15"> </span>1<span class="_ _14"> </span>to<span class="_ _14"> </span>15<span class="_ _15"> </span>bytes<span class="_ _1"></span>.<span class="_ _14"> </span>The<span class="_ _16"> </span>instruction</div><div class="t m5 x29 h26 y2106 ff7 fs19 fc1 sc0 ls0 ws0">encoding<span class="_ _13"> </span>is<span class="_ _6"> </span>designed<span class="_ _13"> </span>so<span class="_ _6"> </span>that<span class="_ _13"> </span>commonly<span class="_ _13"> </span>used<span class="_ _6"> </span>instructions<span class="_ _13"> </span>and<span class="_ _13"> </span>those<span class="_ _6"> </span>with<span class="_ _13"> </span>fewer</div><div class="t m5 x29 h26 y2107 ff7 fs19 fc1 sc0 ls0 ws0">operands<span class="_ _6"> </span>require<span class="_ _13"> </span>a<span class="_ _6"> </span>smaller<span class="_ _13"> </span>number<span class="_ _6"> </span>of<span class="_ _13"> </span>bytes<span class="_ _6"> </span>than<span class="_ _13"> </span>do<span class="_ _6"> </span>less<span class="_ _13"> </span>common<span class="_ _6"> </span>ones<span class="_ _13"> </span>or<span class="_ _6"> </span>ones</div><div class="t m5 x29 h26 y2108 ff7 fs19 fc1 sc0 ls0 ws0">with<span class="_"> </span>more<span class="_"> </span>operands<span class="_ _1"></span>.</div><div class="t m5 x75 h3d y2109 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y210a ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _14"> </span>instruction<span class="_ _16"> </span>format<span class="_ _16"> </span>is<span class="_ _14"> </span>designed<span class="_ _16"> </span>in<span class="_ _14"> </span>such<span class="_ _16"> </span>a<span class="_ _16"> </span>way<span class="_ _14"> </span>that<span class="_ _16"> </span>from<span class="_ _14"> </span>a<span class="_ _16"> </span>given<span class="_ _16"> </span>starting</div><div class="t m5 x29 h26 y210b ff7 fs19 fc1 sc0 ls0 ws0">position,<span class="_ _14"> </span>there<span class="_ _16"> </span>is<span class="_ _14"> </span>a<span class="_ _16"> </span>unique<span class="_ _14"> </span>decoding<span class="_ _14"> </span>of<span class="_ _16"> </span>the<span class="_ _14"> </span>bytes<span class="_ _16"> </span>into<span class="_ _14"> </span>machine<span class="_ _16"> </span>instructions<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y210c ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_"> </span>example<span class="_ _1"></span>,<span class="_"> </span>only<span class="_"> </span>the<span class="_"> </span>instruction<span class="_"> </span><span class="ffd">pushq<span class="_ _16"> </span>%rbx<span class="_ _10"> </span></span>can<span class="_"> </span>start<span class="_"> </span>with<span class="_"> </span>byte<span class="_"> </span>value<span class="_"> </span><span class="ffd">53</span>.</div><div class="t m5 x75 h3d y210d ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y210e ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _21"> </span>disassembler<span class="_ _15"> </span>determines<span class="_ _21"> </span>the<span class="_ _15"> </span>assembly<span class="_ _21"> </span>code<span class="_ _15"> </span>based<span class="_ _21"> </span>purely<span class="_ _15"> </span>on<span class="_ _21"> </span>the<span class="_ _15"> </span>byte</div><div class="t m5 x29 h26 y210f ff7 fs19 fc1 sc0 ls0 ws0">sequences<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_"> </span>machine-code<span class="_ _13"> </span>ﬁle<span class="_ _1"></span>.<span class="_ _13"> </span>It<span class="_"> </span>does<span class="_ _13"> </span>not<span class="_ _13"> </span>require<span class="_ _13"> </span>access<span class="_ _13"> </span>to<span class="_"> </span>the<span class="_ _13"> </span>source<span class="_ _13"> </span>or</div><div class="t m5 x29 h26 y2110 ff7 fs19 fc1 sc0 ls0 ws0">assembly-code<span class="_"> </span>versions<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>program.</div><div class="t m5 x75 h3d y2111 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y1e74 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>disassembler<span class="_"> </span>uses<span class="_ _11"> </span>a<span class="_"> </span>slightly<span class="_"> </span>different<span class="_"> </span>naming<span class="_"> </span>convention<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>instruc-</div><div class="t m5 x29 h26 y2112 ff7 fs19 fc1 sc0 ls0 ws0">tions<span class="_ _16"> </span>than<span class="_ _11"> </span>does<span class="_ _16"> </span>the<span class="_ _16"> </span>assembly<span class="_ _16"> </span>code<span class="_ _11"> </span>generated<span class="_ _16"> </span>by<span class="_ _16"> </span><span class="ff9">gcc</span>.<span class="_ _11"> </span>In<span class="_ _16"> </span>our<span class="_ _16"> </span>example<span class="_ _1"></span>,<span class="_ _14"> </span>it<span class="_ _16"> </span>has</div><div class="t m5 x29 h26 y2113 ff7 fs19 fc1 sc0 ls0 ws0">omitted<span class="_ _16"> </span>the<span class="_ _14"> </span>sufﬁx<span class="_ _16"> </span>‘<span class="ffd">q</span>’<span class="_ _14"> </span>from<span class="_ _16"> </span>many<span class="_ _14"> </span>of<span class="_ _14"> </span>the<span class="_ _16"> </span>instructions<span class="_ _1"></span>.<span class="_ _14"> </span>T<span class="_ _1"></span>hese<span class="_ _14"> </span>sufﬁxes<span class="_ _14"> </span>are<span class="_ _16"> </span>size</div><div class="t m5 x29 h26 y2114 ff7 fs19 fc1 sc0 ls0 ws0">designators<span class="_ _16"> </span>and<span class="_ _16"> </span>can<span class="_ _16"> </span>be<span class="_ _16"> </span>omitted<span class="_ _11"> </span>in<span class="_ _16"> </span>most<span class="_ _16"> </span>cases<span class="_ _1"></span>.<span class="_ _16"> </span>Conversely<span class="_ _3"></span>,<span class="_ _14"> </span>the<span class="_ _16"> </span>disassembler</div><div class="t m5 x29 h26 y2115 ff7 fs19 fc1 sc0 ls0 ws0">adds<span class="_"> </span>the<span class="_ _11"> </span>sufﬁx<span class="_"> </span>‘<span class="ffd">q</span><span class="ls148">’t<span class="_ _4a"></span>ot<span class="_ _49"></span>h<span class="_ _4a"></span>e<span class="ffd ls0">call<span class="_ _11"> </span><span class="ff7">and<span class="_"> </span></span>ret<span class="_ _11"> </span><span class="ff7">instructions<span class="_ _1"></span>.<span class="_"> </span>Again,<span class="_ _11"> </span>these<span class="_ _11"> </span>sufﬁxes<span class="_"> </span>can</span></span></span></div><div class="t m5 x29 h26 y2116 ff7 fs19 fc1 sc0 ls0 ws0">safely<span class="_"> </span>be<span class="_"> </span>omitted.</div><div class="t m5 x29 h26 y2117 ff7 fs19 fc1 sc0 ls0 ws0">Generating<span class="_ _16"> </span>the<span class="_ _14"> </span>actual<span class="_ _16"> </span>executable<span class="_ _16"> </span>code<span class="_ _14"> </span>requires<span class="_ _16"> </span>running<span class="_ _14"> </span>a<span class="_ _16"> </span>linker<span class="_ _14"> </span>on<span class="_ _16"> </span>the<span class="_ _16"> </span>set</div><div class="t m5 x1d h26 y2118 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_ _16"> </span>object-code<span class="_ _16"> </span>ﬁles<span class="_ _1"></span>,<span class="_ _14"> </span>one<span class="_ _14"> </span>of<span class="_ _16"> </span>which<span class="_ _16"> </span>must<span class="_ _14"> </span>contain<span class="_ _16"> </span>a<span class="_ _16"> </span>function<span class="_ _14"> </span><span class="ffd">main</span>.<span class="_ _16"> </span>Suppose<span class="_ _14"> </span>in<span class="_ _16"> </span>ﬁle</div><div class="t m5 x1d h26 y2119 ffd fs19 fc1 sc0 ls0 ws0">main.c<span class="_ _10"> </span><span class="ff7">we<span class="_"> </span>had<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>function:</span></div><div class="t m5 x1d h2d y211a ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;stdio.h&gt;</div><div class="t m5 x1d h2d y211b ffd fs1e fc2 sc0 ls0 ws0">void<span class="_ _e"> </span>multstore(long,<span class="_ _1f"> </span>long,<span class="_ _1f"> </span>long<span class="_ _e"> </span>*);</div><div class="t m5 x1d h2d y211c ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>main()<span class="_ _1f"> </span>{</div><div class="t m5 x10c h2d y211d ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>d;</div><div class="t m5 x10c h2d y211e ffd fs1e fc2 sc0 ls0 ws0">multstore(2,<span class="_ _e"> </span>3,<span class="_ _1f"> </span>&amp;d);</div><div class="t m5 x10c h2d y211f ffd fs1e fc2 sc0 ls0 ws0">printf(&quot;2<span class="_ _e"> </span>*<span class="_ _1f"> </span>3<span class="_ _1f"> </span>--&gt;<span class="_ _e"> </span>%ld\n&quot;,<span class="_ _1f"> </span>d);</div><div class="t m5 x10c h2d y2120 ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>0;</div><div class="t m5 x1d h2d y2121 ffd fs1e fc2 sc0 ls0 ws0">}</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
