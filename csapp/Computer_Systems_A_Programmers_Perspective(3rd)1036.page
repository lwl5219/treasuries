<div id="pf40c" class="pf w2 h11" data-page-no="40c"><div class="pc pc40c w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg40c.png"/><div class="t m5 x69 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>12.5<span class="_ _60"> </span>Synchronizing<span class="_ _10"> </span>Threads<span class="_ _10"> </span>with<span class="_ _10"> </span>Semaphores<span class="_ _3e"> </span><span class="ffe fs1e">1035</span></div><div class="t m5 x52 h31 y9c ff7 fs21 fc2 sc0 ls0 ws0">10<span class="_ _88"> </span>2<span class="_ _7f"> </span><span class="ff11">T</span></div><div class="t m5 xcd h33 yf3c ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 x26 h26 y817c ff7 fs19 fc1 sc0 ls0 ws0">Does<span class="_"> </span>this<span class="_"> </span>ordering<span class="_"> </span>result<span class="_"> </span>in<span class="_"> </span>a<span class="_"> </span>correct<span class="_"> </span>value<span class="_"> </span>for<span class="_"> </span><span class="ffd">cnt</span>?</div><div class="t m5 x17 h41 y817d ffe fs29 fc1 sc0 ls0 ws0">12.5.1<span class="_ _48"> </span><span class="fs19">Progress<span class="_"> </span>Graphs</span></div><div class="t m5 x17 h26 y817e ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_ _14"> </span><span class="ffa">progress<span class="_ _14"> </span>graph<span class="_ _16"> </span></span>models<span class="_ _14"> </span>the<span class="_ _14"> </span>execution<span class="_ _14"> </span>of<span class="_ _14"> </span><span class="ff11">n<span class="_ _14"> </span></span>concurrent<span class="_ _14"> </span>threads<span class="_ _14"> </span>as<span class="_ _14"> </span>a<span class="_ _14"> </span>trajectory</div><div class="t m5 x17 h26 y817f ff7 fs19 fc1 sc0 ls0 ws0">through<span class="_ _6"> </span>an<span class="_ _6"> </span><span class="ff11">n</span>-dimensional<span class="_ _13"> </span>Cartesian<span class="_ _a"> </span>space.<span class="_ _a"> </span>Each<span class="_ _6"> </span>axis<span class="_ _13"> </span><span class="ff11">k<span class="_ _13"> </span></span>corresponds<span class="_ _a"> </span>to<span class="_ _6"> </span>the<span class="_ _13"> </span>progress</div><div class="t m5 x17 h26 y8180 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_ _11"> </span>thread<span class="_ _16"> </span><span class="ff11">k<span class="_ _2"></span></span>.<span class="_ _16"> </span>Each<span class="_ _11"> </span>point<span class="_ _16"> </span><span class="ff11">(I</span></div><div class="t m5 x1c6 h3c y8181 ff7 fs25 fc1 sc0 ls0 ws0">1</div><div class="t m5 x112 h45 y8182 ff11 fs19 fc1 sc0 ls2f1 ws0">,I</div><div class="t m5 x150 h3c y8181 ff7 fs25 fc1 sc0 ls0 ws0">2</div><div class="t m5 x76 h45 y8182 ff11 fs19 fc1 sc0 ls2f1 ws0">,...,I</div><div class="t m5 x110 h50 y8181 ff11 fs25 fc1 sc0 ls0 ws0">n</div><div class="t m5 x9b h46 y8182 ff11 fs19 fc1 sc0 ls0 ws0">)<span class="_ _11"> </span><span class="ff7">represents<span class="_ _16"> </span>the<span class="_ _16"> </span>state<span class="_ _11"> </span>where<span class="_ _16"> </span>thread<span class="_ _16"> </span></span>k<span class="_"> </span><span class="ff7">(</span>k<span class="_ _10"> </span><span class="ff12">=</span></div><div class="t m5 x17 h26 y8183 ff7 fs19 fc1 sc0 ls0 ws0">1<span class="_ _1"></span><span class="ff11 ls195">,..<span class="_ _2"></span>.,n<span class="_ _80"></span><span class="ff7 ls0">)<span class="_ _13"> </span>has<span class="_"> </span>completed<span class="_ _13"> </span>instruction<span class="_ _13"> </span><span class="ff11">I</span></span></span></div><div class="t m5 x116 h50 y8184 ff11 fs25 fc1 sc0 ls0 ws0">k</div><div class="t m5 x90 h26 y8185 ff7 fs19 fc1 sc0 ls0 ws0">.<span class="_ _13"> </span>T<span class="_ _0"></span>he<span class="_ _13"> </span>origin<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>graph<span class="_ _13"> </span>corresponds<span class="_ _13"> </span>to<span class="_"> </span>the</div><div class="t m5 x17 h26 y8186 ffa fs19 fc1 sc0 ls0 ws0">initial<span class="_"> </span>state<span class="_"> </span><span class="ff7">where<span class="_"> </span>none<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>threads<span class="_"> </span>has<span class="_"> </span>yet<span class="_"> </span>completed<span class="_"> </span>an<span class="_"> </span>instruction.</span></div><div class="t m5 x26 h26 y8187 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _f"> </span>12.19<span class="_ _e"> </span>shows<span class="_ _21"> </span>the<span class="_ _f"> </span>two-dimensional<span class="_ _f"> </span>progress<span class="_ _f"> </span>graph<span class="_ _f"> </span>for<span class="_ _f"> </span>the<span class="_ _f"> </span>ﬁrst<span class="_ _e"> </span>loop</div><div class="t m5 x17 h26 y8188 ff7 fs19 fc1 sc0 ls0 ws0">iteration<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span><span class="ffd">badcnt.c<span class="_ _11"> </span></span>program.<span class="_ _11"> </span>The<span class="_"> </span>horizontal<span class="_ _11"> </span>axis<span class="_ _11"> </span>corresponds<span class="_ _11"> </span>to<span class="_ _11"> </span>thread<span class="_ _16"> </span>1,</div><div class="t m5 x17 h26 y8189 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>vertical<span class="_"> </span>axis<span class="_"> </span>to<span class="_ _11"> </span>thread<span class="_"> </span>2.<span class="_"> </span>P<span class="_ _0"></span>oint<span class="_"> </span><span class="ff11">(L</span></div><div class="t m5 x116 h3c y818a ff7 fs25 fc1 sc0 ls0 ws0">1</div><div class="t m5 x90 h45 y818b ff11 fs19 fc1 sc0 ls38 ws0">,S</div><div class="t m5 x192 h3c y818a ff7 fs25 fc1 sc0 ls0 ws0">2</div><div class="t m5 xa0 h26 y818b ff11 fs19 fc1 sc0 ls0 ws0">)<span class="_ _10"> </span><span class="ff7">corresponds<span class="_"> </span>to<span class="_ _11"> </span>the<span class="_"> </span>state<span class="_"> </span>where<span class="_ _11"> </span>thread</span></div><div class="t m5 x17 h26 y818c ff7 fs19 fc1 sc0 ls0 ws0">1<span class="_"> </span>has<span class="_"> </span>completed<span class="_"> </span><span class="ff11">L</span></div><div class="t m5 xce h3c y818d ff7 fs25 fc1 sc0 ls0 ws0">1</div><div class="t m5 x127 h26 y818e ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_"> </span>thread<span class="_"> </span>2<span class="_"> </span>has<span class="_"> </span>completed<span class="_"> </span><span class="ff11">S</span></div><div class="t m5 x130 h3c y818d ff7 fs25 fc1 sc0 ls0 ws0">2</div><div class="t m5 x179 h26 y818e ff7 fs19 fc1 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y818f ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_"> </span>progress<span class="_"> </span>graph<span class="_"> </span>models<span class="_"> </span>instruction<span class="_"> </span>execution<span class="_"> </span>as<span class="_"> </span>a<span class="_"> </span><span class="ffa">transition<span class="_"> </span></span>from<span class="_"> </span>one<span class="_"> </span>state</div><div class="t m5 x17 h26 y8190 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _16"> </span>another.<span class="_ _16"> </span>A<span class="_ _16"> </span>transition<span class="_ _16"> </span>is<span class="_ _16"> </span>represented<span class="_ _16"> </span>as<span class="_ _16"> </span>a<span class="_ _14"> </span>directed<span class="_ _16"> </span>edge<span class="_ _16"> </span>from<span class="_ _16"> </span>one<span class="_ _16"> </span>point<span class="_ _14"> </span>to<span class="_ _16"> </span>an</div><div class="t m5 x17 h26 y8191 ff7 fs19 fc1 sc0 ls0 ws0">adjacent<span class="_ _15"> </span>point.<span class="_ _15"> </span>Legal<span class="_ _21"> </span>transitions<span class="_ _15"> </span>move<span class="_ _15"> </span>to<span class="_ _21"> </span>the<span class="_ _15"> </span>right<span class="_ _15"> </span>(an<span class="_ _21"> </span>instruction<span class="_ _15"> </span>in<span class="_ _15"> </span>thread<span class="_ _21"> </span>1</div><div class="t m5 x17 h26 y8192 ff7 fs19 fc1 sc0 ls0 ws0">completes)<span class="_"> </span>or<span class="_"> </span>up<span class="_"> </span>(an<span class="_"> </span>instruction<span class="_ _11"> </span>in<span class="_"> </span>thread<span class="_"> </span>2<span class="_"> </span>completes).<span class="_ _11"> </span>T<span class="_ _7"></span>wo<span class="_"> </span>instructions<span class="_"> </span>cannot</div><div class="t m5 x17 h26 y8193 ff7 fs19 fc1 sc0 ls0 ws0">complete<span class="_ _13"> </span>at<span class="_ _13"> </span>the<span class="_ _13"> </span>same<span class="_ _13"> </span>time—diagonal<span class="_ _13"> </span>transitions<span class="_ _13"> </span>are<span class="_"> </span>not<span class="_ _13"> </span>allowed.<span class="_ _13"> </span>Programs<span class="_ _13"> </span>never</div><div class="t m5 x17 h26 y8194 ff7 fs19 fc1 sc0 ls0 ws0">run<span class="_"> </span>backward<span class="_"> </span>so<span class="_"> </span>transitions<span class="_"> </span>that<span class="_"> </span>move<span class="_"> </span>down<span class="_"> </span>or<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>left<span class="_"> </span>are<span class="_"> </span>not<span class="_"> </span>legal<span class="_"> </span>either.</div><div class="t m5 x17 h2f y8195 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>12.19</div><div class="t m5 x17 h2f y8196 ffe fs16 fc1 sc0 ls0 ws0">Progress<span class="_ _16"> </span>graph<span class="_ _16"> </span>for<span class="_ _11"> </span>the</div><div class="t m5 x17 h2f y8197 ffe fs16 fc1 sc0 ls0 ws0">ﬁrst<span class="_ _16"> </span>loop<span class="_ _14"> </span>iteration<span class="_ _14"> </span>of</div><div class="t m5 x17 h3a y8198 ffd fs19 fc1 sc0 ls0 ws0">badcnt.c<span class="ffe fs16">.</span></div><div class="t m5 xb3 h8b y8199 ffed fs51 fc1 sc0 ls0 ws0">Thread 2</div><div class="t m5 x1dc h8b y819a ffed fs51 fc1 sc0 ls0 ws0">Thread 1</div><div class="t m5 x79 h8b y819b ffee fs51 fc1 sc0 ls0 ws0">T</div><div class="t m5 xb2 h8c y819c ffed fs52 fc1 sc0 ls0 ws0">2</div><div class="t m5 x1f2 h8b y819d ffee fs51 fc1 sc0 ls0 ws0">S</div><div class="t m5 xb2 h8c y819e ffed fs52 fc1 sc0 ls0 ws0">2</div><div class="t m5 xf0 h8b y819f ffee fs51 fc1 sc0 ls0 ws0">U</div><div class="t m5 xb2 h8c y81a0 ffed fs52 fc1 sc0 ls0 ws0">2</div><div class="t m5 x79 h8b y81a1 ffee fs51 fc1 sc0 ls0 ws0">L</div><div class="t m5 xb2 h8c y81a2 ffed fs52 fc1 sc0 ls0 ws0">2</div><div class="t m5 x1f2 h8b y81a3 ffee fs51 fc1 sc0 ls0 ws0">H</div><div class="t m5 xb2 h8c y81a4 ffed fs52 fc1 sc0 ls0 ws0">2</div><div class="t m5 x16c h8b y81a5 ffee fs51 fc1 sc0 ls0 ws0">H</div><div class="t m5 xe5 h8c y81a6 ffed fs52 fc1 sc0 ls0 ws0">1</div><div class="t m5 x15 h8b y81a5 ffee fs51 fc1 sc0 ls0 ws0">L</div><div class="t m5 x24e h8c y81a6 ffed fs52 fc1 sc0 ls0 ws0">1</div><div class="t m5 x131 h8b y81a5 ffee fs51 fc1 sc0 ls0 ws0">U</div><div class="t m5 x208 h8c y81a6 ffed fs52 fc1 sc0 ls0 ws0">1</div><div class="t m5 x15f h8b y81a5 ffee fs51 fc1 sc0 ls0 ws0">S</div><div class="t m5 x1fb h8c y81a6 ffed fs52 fc1 sc0 ls0 ws0">1</div><div class="t m5 x247 h8b y81a5 ffee fs51 fc1 sc0 ls0 ws0">T</div><div class="t m5 x144 h8c y81a6 ffed fs52 fc1 sc0 ls0 ws0">1</div><div class="t m5 x113 h8b y81a7 ffed fs51 fc1 sc0 ls0 ws0">(<span class="ffee">L</span></div><div class="t m5 xfc h8c y81a8 ffed fs52 fc1 sc0 ls0 ws0">1</div><div class="t m5 x184 h8b y81a7 ffed fs51 fc1 sc0 ls0 ws0">, <span class="ffee">S</span></div><div class="t m5 x92 h8c y81a8 ffed fs52 fc1 sc0 ls0 ws0">2</div><div class="t m5 x1ab h8b y81a7 ffed fs51 fc1 sc0 ls0 ws0">)</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
