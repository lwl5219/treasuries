<div id="pf321" class="pf w2 h11" data-page-no="321"><div class="pc pc321 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg321.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">800<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>8<span class="_ _3d"> </span>Exceptional<span class="_ _10"> </span>Control<span class="_ _10"> </span>Flow</span></div><div class="t m5 x54 h79 y68a9 ffa2 fs42 fc1 sc0 ls0 ws0">(4) Control passes</div><div class="t m5 x1dd h79 y68aa ffa2 fs42 fc1 sc0 ls0 ws0">to handler <span class="_ _1"></span>T</div><div class="t m5 x161 h79 y68ab ffa2 fs42 fc1 sc0 ls0 ws0">(1) Program</div><div class="t m5 x1f h79 y68ac ffa2 fs42 fc1 sc0 ls0 ws0">catches signal s</div><div class="t m5 xd2 h79 y68ad ffa2 fs42 fc1 sc0 ls0 ws0">(3) Program</div><div class="t m5 x184 h79 y68ae ffa2 fs42 fc1 sc0 ls0 ws0">catches signal t</div><div class="t m5 x1d h79 y68af ffa2 fs42 fc1 sc0 ls0 ws0">(7) Main program</div><div class="t m5 xa4 h79 y68b0 ffa2 fs42 fc1 sc0 ls0 ws0">resumes</div><div class="t m5 x196 h79 y68b1 ffa2 fs42 fc1 sc0 ls0 ws0">(5) Handler <span class="_ _1"></span>T </div><div class="t m5 x8a h79 y68b2 ffa2 fs42 fc1 sc0 ls0 ws0">returns to </div><div class="t m5 x16a h79 y68b3 ffa2 fs42 fc1 sc0 ls0 ws0">handler S</div><div class="t m5 xdd h79 y68b4 ffa2 fs42 fc1 sc0 ls0 ws0">(2) Control passes</div><div class="t m5 x16e h79 y68b5 ffa2 fs42 fc1 sc0 ls0 ws0">to handler S</div><div class="t m5 x25 h79 y68b6 ff5b fs42 fc1 sc0 ls0 ws0">Main program<span class="_ _d1"> </span>Handler S<span class="_ _67"> </span>Handler </div><div class="c x1d y68b7 w2e h105"><div class="t m5 x82 h79 y68b8 ff5b fs42 fc1 sc0 ls0 ws0">T</div></div><div class="t m5 x16d h79 y68b9 ffa2 fs42 fc1 sc0 ls0 ws0">(6) Handler S returns</div><div class="t m5 x1d1 h79 y68ba ffa2 fs42 fc1 sc0 ls0 ws0">to main program</div><div class="t m5 x1a6 h79 y68bb ffa2 fs42 fc1 sc0 ls0 ws0">I</div><div class="t m5 xb3 h106 y68bc ffa3 fs9d fc1 sc0 ls0 ws0">curr</div><div class="t m5 x1a6 h79 y68bd ffa2 fs42 fc1 sc0 ls0 ws0">I</div><div class="t m5 xb3 h106 y68be ffa3 fs9d fc1 sc0 ls0 ws0">next</div><div class="t m5 x1d h2f y68bf ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>8.31<span class="_ _66"> </span><span class="fc1">Handlers<span class="_"> </span>can<span class="_"> </span>be<span class="_"> </span>interrupted<span class="_"> </span>by<span class="_"> </span>other<span class="_"> </span>handlers.</span></div><div class="t m5 x1d h26 y68c0 ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_ _16"> </span>to<span class="_ _16"> </span>immediately<span class="_ _11"> </span>terminate<span class="_ _16"> </span>the<span class="_ _16"> </span>process<span class="_ _1"></span>.<span class="_ _16"> </span>In<span class="_ _16"> </span>this<span class="_ _16"> </span>example<span class="_ _1"></span>,<span class="_ _16"> </span>we<span class="_ _16"> </span>modify<span class="_ _16"> </span>the<span class="_ _16"> </span>default</div><div class="t m5 x1d h26 y68c1 ff7 fs19 fc1 sc0 ls0 ws0">behavior<span class="_"> </span>to<span class="_"> </span>catch<span class="_"> </span>the<span class="_"> </span>signal,<span class="_"> </span>print<span class="_"> </span>a<span class="_"> </span>message<span class="_ _1"></span>,<span class="_"> </span>and<span class="_"> </span>then<span class="_"> </span>terminate<span class="_"> </span>the<span class="_"> </span>process<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y68c2 ff7 fs19 fc1 sc0 ls0 ws0">Signal<span class="_ _13"> </span>handlers<span class="_ _13"> </span>can<span class="_ _13"> </span>be<span class="_"> </span>interrupted<span class="_ _13"> </span>by<span class="_ _13"> </span>other<span class="_ _13"> </span>handlers<span class="_ _1"></span>,<span class="_ _13"> </span>as<span class="_"> </span>shown<span class="_ _13"> </span>in<span class="_ _13"> </span>F<span class="_ _1"></span>igure<span class="_ _13"> </span>8.31.</div><div class="t m5 x1d h26 y68c3 ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _14"> </span>this<span class="_ _15"> </span>example<span class="_ _1"></span>,<span class="_ _21"> </span>the<span class="_ _15"> </span>main<span class="_ _14"> </span>program<span class="_ _15"> </span>catches<span class="_ _14"> </span>signal<span class="_ _15"> </span><span class="ff11">s<span class="_ _2"></span></span>,<span class="_ _21"> </span>which<span class="_ _15"> </span>interrupts<span class="_ _14"> </span>the<span class="_ _15"> </span>main</div><div class="t m5 x1d h26 y68c4 ff7 fs19 fc1 sc0 ls0 ws0">program<span class="_ _21"> </span>and<span class="_ _21"> </span>transfers<span class="_ _21"> </span>control<span class="_ _21"> </span>to<span class="_ _f"> </span>handler<span class="_ _21"> </span><span class="ff11">S<span class="_ _5"></span></span>.<span class="_ _21"> </span>While<span class="_ _21"> </span><span class="ff11">S<span class="_ _e"> </span></span>is<span class="_ _15"> </span>running,<span class="_ _e"> </span>the<span class="_ _15"> </span>program</div><div class="t m5 x1d h46 y68c5 ff7 fs19 fc1 sc0 ls0 ws0">catches<span class="_"> </span>signal<span class="_"> </span><span class="ff11">t<span class="_"> </span><span class="ff12">Óòè=<span class="_ _10"> </span></span>s<span class="_ _2"></span></span>,<span class="_ _11"> </span>which<span class="_"> </span>interrupts<span class="_"> </span><span class="ff11">S<span class="_"> </span></span>and<span class="_"> </span>transfers<span class="_"> </span>control<span class="_"> </span>to<span class="_"> </span>handler<span class="_ _11"> </span><span class="ff11">T<span class="_ _13"> </span></span>.<span class="_"> </span>When</div><div class="t m5 x1d h26 y68c6 ff11 fs19 fc1 sc0 ls0 ws0">T<span class="_ _f"> </span><span class="ff7">returns<span class="_ _1"></span>,<span class="_"> </span><span class="ff11">S<span class="_ _11"> </span></span>resumes<span class="_"> </span>where<span class="_"> </span>it<span class="_"> </span>was<span class="_ _13"> </span>interrupted.<span class="_"> </span>Eventually<span class="_ _3"></span>,<span class="_"> </span><span class="ff11">S<span class="_ _11"> </span></span>returns<span class="_ _1"></span>,<span class="_"> </span>transferring</span></div><div class="t m5 x1b0 h26 y68c7 ff7 fs19 fc1 sc0 ls0 ws0">control<span class="_"> </span>back<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>main<span class="_"> </span>program,<span class="_"> </span>which<span class="_"> </span>resumes<span class="_"> </span>where<span class="_"> </span>it<span class="_"> </span>left<span class="_"> </span>off<span class="_ _1"></span>.</div><div class="t m5 x1d h47 y68c8 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>8.7<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>834)</span></div><div class="t m5 x1d h26 y68c9 ff7 fs19 fc1 sc0 ls0 ws0">Write<span class="_"> </span>a<span class="_"> </span>program<span class="_"> </span>called<span class="_ _11"> </span><span class="ffd">snooze<span class="_ _10"> </span></span>that<span class="_ _11"> </span>takes<span class="_"> </span>a<span class="_"> </span>single<span class="_ _11"> </span>command-line<span class="_"> </span>argument,<span class="_"> </span>calls</div><div class="t m5 x1d h26 y68ca ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _16"> </span><span class="ffd">snooze<span class="_ _11"> </span></span>function<span class="_ _16"> </span>from<span class="_ _16"> </span>Problem<span class="_ _11"> </span>8.5<span class="_ _16"> </span>with<span class="_ _16"> </span>this<span class="_ _11"> </span>argument,<span class="_ _16"> </span>and<span class="_ _16"> </span>then<span class="_ _16"> </span>terminates<span class="_ _3"></span>.</div><div class="t m5 x1d h26 y68cb ff7 fs19 fc1 sc0 ls0 ws0">Write<span class="_"> </span>your<span class="_"> </span>program<span class="_ _11"> </span>so<span class="_"> </span>that<span class="_"> </span>the<span class="_ _11"> </span>user<span class="_"> </span>can<span class="_"> </span>interrupt<span class="_ _11"> </span>the<span class="_"> </span><span class="ffd">snooze<span class="_ _10"> </span></span>function<span class="_ _11"> </span>by<span class="_"> </span>typing</div><div class="t m5 x1d h26 y68cc ff7 fs19 fc1 sc0 ls0 ws0">Ctrl+C<span class="_"> </span>at<span class="_"> </span>the<span class="_"> </span>keyboard.<span class="_"> </span>F<span class="_ _1"></span>or<span class="_"> </span>example:</div><div class="t m5 x1d h2d y68cd ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">./snooze<span class="_ _1f"> </span>5</span></div><div class="t m5 x1d h2d y68ce ff13 fs1e fc2 sc0 ls0 ws0">CTRL+C</div><div class="t m5 x16 h61 y68cf ff13 fs35 fc6 sc0 ls0 ws0">User<span class="_ _f"> </span>hits<span class="_ _f"> </span>Crtl+C<span class="_ _f"> </span>after<span class="_ _e"> </span>3<span class="_ _21"> </span>seconds</div><div class="t m5 x1d h2d y68d0 ffd fs1e fc2 sc0 ls0 ws0">Slept<span class="_ _e"> </span>for<span class="_ _1f"> </span>3<span class="_ _1f"> </span>of<span class="_ _e"> </span>5<span class="_ _1f"> </span>secs.</div><div class="t m5 x1d h2d y68d1 ffd fs1e fc2 sc0 ls0 ws0">linux&gt;</div><div class="t m5 x1d h41 y68d2 ffe fs29 fc1 sc0 ls0 ws0">8.5.4<span class="_ _48"> </span><span class="fs19">Blocking<span class="_"> </span>and<span class="_"> </span>Unblocking<span class="_"> </span>Signals</span></div><div class="t m5 x1d h26 y68d3 ff7 fs19 fc1 sc0 ls0 ws0">Linux<span class="_"> </span>provides<span class="_"> </span>implicit<span class="_"> </span>and<span class="_"> </span>explicit<span class="_"> </span>mechanisms<span class="_"> </span>for<span class="_"> </span>blocking<span class="_"> </span>signals:</div><div class="t m5 x75 h26 y68d4 ffa fs19 fc1 sc0 ls0 ws0">Implicit<span class="_ _14"> </span>blocking<span class="_ _14"> </span>mechanism.<span class="_ _21"> </span><span class="ff7">By<span class="_ _14"> </span>default,<span class="_ _21"> </span>the<span class="_ _14"> </span>kernel<span class="_ _15"> </span>blocks<span class="_ _14"> </span>any<span class="_ _14"> </span>pending<span class="_ _15"> </span>sig-</span></div><div class="t m5 xcd h26 y68d5 ff7 fs19 fc1 sc0 ls0 ws0">nals<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>type<span class="_ _11"> </span>currently<span class="_ _11"> </span>being<span class="_ _11"> </span>processed<span class="_ _11"> </span>by<span class="_ _11"> </span>a<span class="_ _11"> </span>handler.<span class="_ _11"> </span>F<span class="_ _1"></span>or<span class="_ _11"> </span>example,<span class="_"> </span>in</div><div class="t m5 xcd h26 y68d6 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _13"> </span>8.31,<span class="_"> </span>suppose<span class="_ _13"> </span>the<span class="_ _13"> </span>program<span class="_ _13"> </span>has<span class="_ _13"> </span>caught<span class="_ _13"> </span>signal<span class="_ _13"> </span><span class="ff11">s<span class="_ _10"> </span></span>and<span class="_"> </span>is<span class="_ _13"> </span>currently<span class="_ _13"> </span>run-</div><div class="t m5 xcd h26 y68d7 ff7 fs19 fc1 sc0 ls0 ws0">ning<span class="_ _6"> </span>handler<span class="_ _13"> </span><span class="ff11">S<span class="_ _2"></span></span>.<span class="_ _13"> </span>If<span class="_ _6"> </span>another<span class="_ _6"> </span>signal<span class="_ _13"> </span><span class="ff11">s<span class="_ _10"> </span></span>is<span class="_ _6"> </span>sent<span class="_ _6"> </span>to<span class="_ _13"> </span>the<span class="_ _6"> </span>process<span class="_ _1"></span>,<span class="_ _13"> </span>then<span class="_ _13"> </span><span class="ff11">s<span class="_ _13"> </span></span>will<span class="_ _13"> </span>become</div><div class="t m5 xcd h26 y68d8 ff7 fs19 fc1 sc0 ls0 ws0">pending<span class="_"> </span>but<span class="_"> </span>will<span class="_"> </span>not<span class="_"> </span>be<span class="_"> </span>received<span class="_"> </span>until<span class="_"> </span>after<span class="_"> </span>handler<span class="_"> </span><span class="ff11">S<span class="_"> </span></span>returns<span class="_ _3"></span>.</div><div class="t m5 x75 h26 y68d9 ffa fs19 fc1 sc0 ls0 ws0">Explicit<span class="_ _15"> </span>blocking<span class="_ _21"> </span>mechanism.<span class="_ _21"> </span><span class="ff7">Applications<span class="_ _15"> </span>can<span class="_ _21"> </span>explicitly<span class="_ _21"> </span>block<span class="_ _21"> </span>and<span class="_ _21"> </span>unblock</span></div><div class="t m5 xcd h26 y68da ff7 fs19 fc1 sc0 ls0 ws0">selected<span class="_"> </span>signals<span class="_"> </span>using<span class="_"> </span>the<span class="_"> </span><span class="ffd">sigprocmask<span class="_ _10"> </span></span>function<span class="_"> </span>and<span class="_"> </span>its<span class="_"> </span>helpers<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
