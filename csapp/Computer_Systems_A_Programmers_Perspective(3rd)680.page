<div id="pf2a8" class="pf w2 h11" data-page-no="2a8"><div class="pc pc2a8 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg2a8.png"/><div class="t m5 x1c4 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>6.6<span class="_ _60"> </span>Putting<span class="_ _10"> </span>It<span class="_ _10"> </span>T<span class="_ _1"></span>ogether:<span class="_ _10"> </span>The<span class="_ _10"> </span>Impact<span class="_ _10"> </span>of<span class="_ _10"> </span>Caches<span class="_ _10"> </span>on<span class="_ _10"> </span>Program<span class="_ _10"> </span>Performance<span class="_ _3e"> </span><span class="ffe fs1e">679</span></div><div class="t m5 x15b h3f y5a7a ff86 fs27 fc1 sc0 ls0 ws0">12,000</div><div class="t m5 x15b h3f y5a7b ff86 fs27 fc1 sc0 ls0 ws0">10,000</div><div class="t m5 x20b h3f y5a7c ff86 fs27 fc1 sc0 ls0 ws0">8,000</div><div class="t m5 x20b h3f y5a7d ff86 fs27 fc1 sc0 ls0 ws0">6,000</div><div class="t m5 x20b h3f y5a7e ff86 fs27 fc1 sc0 ls0 ws0">4,000</div><div class="t m5 x20b h3f y5a7f ff86 fs27 fc1 sc0 ls0 ws0">2,000</div><div class="t m5 x77 h3f y5a80 ff86 fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 x26f h3f y5a81 ff86 fs27 fc1 sc0 ls0 ws0">s1<span class="_ _d"> </span>s2<span class="_ _d"> </span>s3<span class="_ _188"> </span>s4<span class="_ _d"> </span>s5<span class="_ _188"> </span>s6<span class="_ _d"> </span>s7<span class="_ _188"> </span>s8<span class="_ _d"> </span>s9<span class="_ _13d"> </span>s10<span class="_ _1e"> </span>s1<span class="_ _1"></span>1</div><div class="t m7 xef h3f y5a82 ff7d fs27 fc1 sc0 ls0 ws0">Read throughput (MB/s)</div><div class="t m5 x20 h3f y5a83 ff7d fs27 fc1 sc0 ls0 ws0">Stride (x8 bytes)</div><div class="t m5 x180 h3f y5a84 ff86 fs27 fc1 sc0 ls0 ws0">One access</div><div class="t m5 xa7 h3f y5a85 ff86 fs27 fc1 sc0 ls0 ws0">per cache line</div><div class="t m5 x17 h34 y5a86 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _11"> </span>6.43<span class="_ _c"> </span><span class="fc1">A<span class="_ _11"> </span>slope<span class="_ _16"> </span>of<span class="_ _11"> </span>spatial<span class="_ _11"> </span>locality<span class="_ _1"></span>.<span class="_ _16"> </span><span class="ff6">The<span class="_ _11"> </span>graph<span class="_ _11"> </span>shows<span class="_ _11"> </span>a<span class="_ _16"> </span>slice<span class="_ _11"> </span>through<span class="_ _11"> </span>Figure<span class="_ _16"> </span>6.41</span></span></div><div class="t m5 x17 h34 y5a87 ff6 fs16 fc1 sc0 ls0 ws0">with</div><div class="t m5 x1b6 h35 y5a88 ffd fs19 fc1 sc0 ls0 ws0">size<span class="_ _6"> </span><span class="ff12 fs16">=<span class="_ _13"> </span><span class="ff7 ls259">4M<span class="_ _8"></span>B<span class="_ _80"></span><span class="ff6 ls0">.</span></span></span></div><div class="t m5 x17 h26 y5a89 ff7 fs19 fc1 sc0 ls0 ws0">on<span class="_ _11"> </span>the<span class="_ _16"> </span>block<span class="_ _11"> </span>in<span class="_ _11"> </span>L2,<span class="_ _16"> </span>depending<span class="_ _16"> </span>on<span class="_ _11"> </span>the<span class="_ _11"> </span>stride.<span class="_ _11"> </span>As<span class="_ _11"> </span>the<span class="_ _16"> </span>stride<span class="_ _11"> </span>increases<span class="_ _1"></span>,<span class="_ _16"> </span>the<span class="_ _11"> </span>ratio<span class="_ _16"> </span>of</div><div class="t m5 x17 h26 y5a8a ff7 fs19 fc1 sc0 ls0 ws0">L2<span class="_"> </span>misses<span class="_ _11"> </span>to<span class="_"> </span>L2<span class="_ _11"> </span>hits<span class="_"> </span>increases<span class="_ _1"></span>.<span class="_ _11"> </span>Since<span class="_"> </span>misses<span class="_ _11"> </span>are<span class="_"> </span>served<span class="_ _11"> </span>more<span class="_"> </span>slowly<span class="_ _11"> </span>than<span class="_"> </span>hits<span class="_ _1"></span>,<span class="_ _11"> </span>the</div><div class="t m5 x17 h26 y5a8b ff7 fs19 fc1 sc0 ls0 ws0">read<span class="_"> </span>throughput<span class="_"> </span>decreases<span class="_ _1"></span>.<span class="_"> </span>Once<span class="_"> </span>the<span class="_"> </span>stride<span class="_ _11"> </span>reaches<span class="_"> </span>eight<span class="_"> </span>8-byte<span class="_"> </span>words<span class="_ _1"></span>,<span class="_"> </span>which<span class="_"> </span>on</div><div class="t m5 x17 h26 y5a8c ff7 fs19 fc1 sc0 ls0 ws0">this<span class="_"> </span>system<span class="_"> </span>equals<span class="_"> </span>the<span class="_"> </span>block<span class="_"> </span>size<span class="_ _11"> </span>of<span class="_"> </span>64<span class="_"> </span>bytes<span class="_ _1"></span>,<span class="_"> </span>every<span class="_ _11"> </span>read<span class="_"> </span>request<span class="_"> </span>misses<span class="_"> </span>in<span class="_"> </span>L2<span class="_ _11"> </span>and</div><div class="t m5 x17 h26 y5a8d ff7 fs19 fc1 sc0 ls0 ws0">must<span class="_"> </span>be<span class="_ _11"> </span>served<span class="_ _11"> </span>from<span class="_ _11"> </span>L3.<span class="_"> </span>Thus<span class="_ _3"></span>,<span class="_ _11"> </span>the<span class="_ _11"> </span>read<span class="_"> </span>throughput<span class="_ _11"> </span>for<span class="_ _11"> </span>strides<span class="_ _11"> </span>of<span class="_ _11"> </span>at<span class="_"> </span>least<span class="_ _11"> </span>eight<span class="_ _11"> </span>is</div><div class="t m5 x17 h26 y5a8e ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_"> </span>constant<span class="_"> </span>rate<span class="_"> </span>determined<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span>rate<span class="_ _11"> </span>that<span class="_"> </span>cache<span class="_"> </span>blocks<span class="_"> </span>can<span class="_"> </span>be<span class="_"> </span>transferred<span class="_ _11"> </span>from</div><div class="t m5 x17 h26 y5a8f ff7 fs19 fc1 sc0 ls0 ws0">L3<span class="_"> </span>into<span class="_"> </span>L2.</div><div class="t m5 x26 h26 y5a90 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_ _13"> </span>summarize<span class="_ _a"> </span>our<span class="_ _6"> </span>discussion<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _a"> </span>memory<span class="_ _6"> </span>mountain,<span class="_ _13"> </span>the<span class="_ _a"> </span>performance<span class="_ _13"> </span>of<span class="_ _a"> </span>the</div><div class="t m5 x17 h26 y5a91 ff7 fs19 fc1 sc0 ls0 ws0">memory<span class="_"> </span>system<span class="_"> </span>is<span class="_"> </span>not<span class="_"> </span>characterized<span class="_"> </span>by<span class="_"> </span>a<span class="_ _13"> </span>single<span class="_"> </span>number.<span class="_"> </span>Instead,<span class="_"> </span>it<span class="_"> </span>is<span class="_"> </span>a<span class="_"> </span>mountain</div><div class="t m5 x17 h26 y5a92 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_ _14"> </span>temporal<span class="_ _14"> </span>and<span class="_ _14"> </span>spatial<span class="_ _14"> </span>locality<span class="_ _14"> </span>whose<span class="_ _14"> </span>elevations<span class="_ _14"> </span>can<span class="_ _14"> </span>vary<span class="_ _14"> </span>by<span class="_ _14"> </span>over<span class="_ _14"> </span>an<span class="_ _14"> </span>order<span class="_ _15"> </span>of</div><div class="t m5 x17 h26 y5a93 ff7 fs19 fc1 sc0 ls0 ws0">magnitude<span class="_ _1"></span>.<span class="_"> </span>Wise<span class="_"> </span>programmers<span class="_ _13"> </span>try<span class="_"> </span>to<span class="_"> </span>structure<span class="_"> </span>their<span class="_"> </span>programs<span class="_"> </span>so<span class="_"> </span>that<span class="_"> </span>they<span class="_"> </span>run<span class="_"> </span>in</div><div class="t m5 x17 h26 y5a94 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _16"> </span>peaks<span class="_ _14"> </span>instead<span class="_ _14"> </span>of<span class="_ _14"> </span>the<span class="_ _14"> </span>valleys<span class="_ _1"></span>.<span class="_ _14"> </span>T<span class="_ _1"></span>he<span class="_ _14"> </span>aim<span class="_ _14"> </span>is<span class="_ _14"> </span>to<span class="_ _16"> </span>exploit<span class="_ _14"> </span>temporal<span class="_ _14"> </span>locality<span class="_ _14"> </span>so<span class="_ _14"> </span>that</div><div class="t m5 x17 h26 y5a95 ff7 fs19 fc1 sc0 ls0 ws0">heavily<span class="_ _11"> </span>used<span class="_ _11"> </span>words<span class="_ _11"> </span>are<span class="_ _11"> </span>fetched<span class="_ _11"> </span>from<span class="_ _11"> </span>the<span class="_ _11"> </span>L1<span class="_ _11"> </span>cache,<span class="_"> </span>and<span class="_ _11"> </span>to<span class="_ _16"> </span>exploit<span class="_"> </span>spatial<span class="_ _11"> </span>locality</div><div class="t m5 x17 h26 y5a96 ff7 fs19 fc1 sc0 ls0 ws0">so<span class="_"> </span>that<span class="_"> </span>as<span class="_"> </span>many<span class="_"> </span>words<span class="_"> </span>as<span class="_"> </span>possible<span class="_"> </span>are<span class="_"> </span>accessed<span class="_"> </span>from<span class="_"> </span>a<span class="_"> </span>single<span class="_"> </span>L1<span class="_"> </span>cache<span class="_"> </span>line<span class="_ _1"></span>.</div><div class="t m5 x17 h47 y5a97 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>6.21<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>702)</span></div><div class="t m5 x17 h26 y5a98 ff7 fs19 fc1 sc0 ls0 ws0">Use<span class="_"> </span>the<span class="_ _11"> </span>memory<span class="_ _11"> </span>mountain<span class="_ _11"> </span>in<span class="_ _11"> </span>F<span class="_ _1"></span>igure<span class="_ _11"> </span>6.41<span class="_ _11"> </span>to<span class="_ _11"> </span>estimate<span class="_ _11"> </span>the<span class="_"> </span>time,<span class="_"> </span>in<span class="_ _11"> </span>CPU<span class="_"> </span>cycles<span class="_ _1"></span>,<span class="_ _11"> </span>to</div><div class="t m5 x17 h26 y5a99 ff7 fs19 fc1 sc0 ls0 ws0">read<span class="_"> </span>a<span class="_"> </span>16-byte<span class="_"> </span>word<span class="_"> </span>from<span class="_"> </span>the<span class="_"> </span>L1<span class="_"> </span>d-cache<span class="_ _1"></span>.</div><div class="t m5 x17 h41 y5a9a ffe fs29 fc1 sc0 ls0 ws0">6.6.2</div><div class="t m5 x182 h43 y5a9b ffe fs19 fc1 sc0 ls0 ws0">Rearranging<span class="_"> </span>Loops<span class="_"> </span>to<span class="_"> </span>Increase<span class="_"> </span>Spatial<span class="_"> </span>Locality</div><div class="t m5 x17 h46 y5a9c ff7 fs19 fc1 sc0 ls0 ws0">Consider<span class="_"> </span>the<span class="_ _13"> </span>problem<span class="_"> </span>of<span class="_ _13"> </span>multiplying<span class="_"> </span>a<span class="_"> </span>pair<span class="_ _13"> </span>of<span class="_"> </span><span class="ff11">n<span class="_ _13"> </span><span class="ff12">×<span class="_ _10"> </span></span>n<span class="_ _13"> </span></span>matrices:<span class="_"> </span><span class="ff11">C<span class="_ _10"> </span><span class="ff12">=<span class="_ _10"> </span></span>AB<span class="_ _5"></span></span>.<span class="_"> </span>F<span class="_ _3"></span>or<span class="_"> </span>exam-</div><div class="t m5 x17 h46 y5a9d ff7 fs19 fc1 sc0 ls0 ws0">ple<span class="_ _1"></span>,<span class="_"> </span>if<span class="_"> </span><span class="ff11">n<span class="_ _10"> </span><span class="ff12">=<span class="_ _13"> </span></span></span>2<span class="_ _2"></span>,<span class="_"> </span>then</div><div class="t m5 x15a h5c y5a9e ff1e fs19 fc1 sc0 ls0 ws0"></div><div class="t m5 x17f h45 y5a9f ff11 fs19 fc1 sc0 ls0 ws0">c</div><div class="t m5 x145 h3c y5aa0 ff7 fs25 fc1 sc0 ls0 ws0">11</div><div class="t m5 x1d0 h45 y5aa1 ff11 fs19 fc1 sc0 ls0 ws0">c</div><div class="t m5 x1a5 h3c y5aa2 ff7 fs25 fc1 sc0 ls0 ws0">12</div><div class="t m5 x17f h45 y5aa3 ff11 fs19 fc1 sc0 ls0 ws0">c</div><div class="t m5 x145 h3c y5aa4 ff7 fs25 fc1 sc0 ls0 ws0">21</div><div class="t m5 x1d0 h45 y5aa5 ff11 fs19 fc1 sc0 ls0 ws0">c</div><div class="t m5 x1a5 h3c y5aa6 ff7 fs25 fc1 sc0 ls0 ws0">22</div><div class="t m5 xf1 h5c y5aa7 ff1e fs19 fc1 sc0 ls0 ws0"></div><div class="t m5 x47 h46 y5aa8 ff12 fs19 fc1 sc0 ls0 ws0">=</div><div class="t m5 x1b2 h5c y5aa7 ff1e fs19 fc1 sc0 ls0 ws0"></div><div class="t m5 x110 h45 y5aa9 ff11 fs19 fc1 sc0 ls0 ws0">a</div><div class="t m5 xe5 h3c y5aa2 ff7 fs25 fc1 sc0 ls0 ws0">11</div><div class="t m5 x68 h45 y5aa1 ff11 fs19 fc1 sc0 ls0 ws0">a</div><div class="t m5 x18 h3c y5aa2 ff7 fs25 fc1 sc0 ls0 ws0">12</div><div class="t m5 x110 h45 y5aa5 ff11 fs19 fc1 sc0 ls0 ws0">a</div><div class="t m5 xe5 h3c y5aa6 ff7 fs25 fc1 sc0 ls0 ws0">21</div><div class="t m5 x68 h45 y5aa5 ff11 fs19 fc1 sc0 ls0 ws0">a</div><div class="t m5 x18 h3c y5aa6 ff7 fs25 fc1 sc0 ls0 ws0">22</div><div class="t m5 x16 h5c y5aa7 ff1e fs19 fc1 sc0 ls42 ws0"></div><div class="t m5 xd2 h45 y5aa9 ff11 fs19 fc1 sc0 ls0 ws0">b</div><div class="t m5 x215 h3c y5aa2 ff7 fs25 fc1 sc0 ls0 ws0">11</div><div class="t m5 x1d9 h45 y5aa1 ff11 fs19 fc1 sc0 ls0 ws0">b</div><div class="t m5 xf4 h3c y5aa2 ff7 fs25 fc1 sc0 ls0 ws0">12</div><div class="t m5 xd2 h45 y5aa5 ff11 fs19 fc1 sc0 ls0 ws0">b</div><div class="t m5 x215 h3c y5aa6 ff7 fs25 fc1 sc0 ls0 ws0">21</div><div class="t m5 x1d9 h45 y5aa5 ff11 fs19 fc1 sc0 ls0 ws0">b</div><div class="t m5 xf4 h3c y5aa6 ff7 fs25 fc1 sc0 ls0 ws0">22</div><div class="t m5 x15f h5c y5aa7 ff1e fs19 fc1 sc0 ls0 ws0"></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
