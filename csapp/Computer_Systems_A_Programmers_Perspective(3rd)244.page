<div id="pff4" class="pf w2 h11" data-page-no="f4"><div class="pc pcf4 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bgf4.png"/><div class="t m5 x1dc h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>3.6<span class="_ _60"> </span>Control<span class="_ _3e"> </span><span class="ffe fs1e">243</span></div><div class="t m5 x17 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_ _14"> </span>the<span class="_ _15"> </span>conditions<span class="_ _14"> </span>under<span class="_ _15"> </span>which<span class="_ _15"> </span>they<span class="_ _14"> </span>jump<span class="_ _15"> </span>match<span class="_ _14"> </span>those<span class="_ _15"> </span>of<span class="_ _14"> </span>the<span class="_ _15"> </span><span class="ff9">set<span class="_ _15"> </span></span>instructions</div><div class="t m5 x17 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">(see<span class="_ _16"> </span>F<span class="_ _1"></span>igure<span class="_ _16"> </span>3.14).<span class="_ _16"> </span>As<span class="_ _16"> </span>with<span class="_ _16"> </span>the<span class="_ _16"> </span><span class="ff9">set<span class="_ _16"> </span></span>instructions<span class="_ _0"></span>,<span class="_ _16"> </span>some<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>underlying<span class="_ _16"> </span>machine</div><div class="t m5 x17 h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">instructions<span class="_"> </span>have<span class="_"> </span>multiple<span class="_"> </span>names<span class="_ _1"></span>.<span class="_"> </span>Conditional<span class="_"> </span>jumps<span class="_"> </span>can<span class="_"> </span>only<span class="_"> </span>be<span class="_"> </span>direct.</div><div class="t m5 x17 h41 y24fc ffe fs29 fc2 sc0 ls0 ws0">3.6.4<span class="_ _48"> </span><span class="fs19">Jump<span class="_"> </span>Instruction<span class="_"> </span>Encodings</span></div><div class="t m5 x17 h26 y24fd ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_"> </span>the<span class="_ _11"> </span>most<span class="_ _11"> </span>part,<span class="_ _11"> </span>we<span class="_"> </span>will<span class="_ _11"> </span>not<span class="_ _11"> </span>concern<span class="_ _11"> </span>ourselves<span class="_"> </span>with<span class="_ _11"> </span>the<span class="_ _11"> </span>detailed<span class="_"> </span>format<span class="_ _11"> </span>of<span class="_ _11"> </span>ma-</div><div class="t m5 x17 h26 y24fe ff7 fs19 fc2 sc0 ls0 ws0">chine<span class="_ _6"> </span>code.<span class="_ _6"> </span>On<span class="_ _13"> </span>the<span class="_ _6"> </span>other<span class="_ _13"> </span>hand,<span class="_ _6"> </span>understanding<span class="_ _13"> </span>how<span class="_ _6"> </span>the<span class="_ _13"> </span>targets<span class="_ _6"> </span>of<span class="_ _13"> </span>jump<span class="_ _6"> </span>instructions</div><div class="t m5 x17 h26 y24ff ff7 fs19 fc2 sc0 ls0 ws0">are<span class="_ _16"> </span>encoded<span class="_ _16"> </span>will<span class="_ _16"> </span>become<span class="_ _16"> </span>important<span class="_ _16"> </span>when<span class="_ _16"> </span>we<span class="_ _16"> </span>study<span class="_ _16"> </span>linking<span class="_ _16"> </span>in<span class="_ _16"> </span>Chapter<span class="_ _16"> </span>7.<span class="_ _16"> </span>In<span class="_ _16"> </span>ad-</div><div class="t m5 x17 h26 y2500 ff7 fs19 fc2 sc0 ls0 ws0">dition,<span class="_"> </span>it<span class="_"> </span>helps<span class="_"> </span>when<span class="_"> </span>interpreting<span class="_"> </span>the<span class="_"> </span>output<span class="_"> </span>of<span class="_"> </span>a<span class="_"> </span>disassembler<span class="_ _0"></span>.<span class="_"> </span>In<span class="_"> </span>assembly<span class="_"> </span>code<span class="_ _1"></span>,</div><div class="t m5 x17 h26 y2501 ff7 fs19 fc2 sc0 ls0 ws0">jump<span class="_ _13"> </span>targets<span class="_ _13"> </span>are<span class="_ _6"> </span>written<span class="_ _13"> </span>using<span class="_ _13"> </span>symbolic<span class="_ _13"> </span>labels<span class="_ _3"></span>.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span>assembler,<span class="_ _13"> </span>and<span class="_ _13"> </span>later<span class="_ _6"> </span>the<span class="_ _13"> </span>linker,</div><div class="t m5 x17 h26 y2502 ff7 fs19 fc2 sc0 ls0 ws0">generate<span class="_ _13"> </span>the<span class="_ _13"> </span>proper<span class="_"> </span>encodings<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>jump<span class="_"> </span>targets<span class="_ _3"></span>.<span class="_ _13"> </span>There<span class="_ _13"> </span>are<span class="_ _13"> </span>several<span class="_ _13"> </span>different<span class="_ _13"> </span>en-</div><div class="t m5 x17 h26 y2503 ff7 fs19 fc2 sc0 ls0 ws0">codings<span class="_ _13"> </span>for<span class="_ _6"> </span>jumps<span class="_ _1"></span>,<span class="_ _13"> </span>but<span class="_ _13"> </span>some<span class="_ _13"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>most<span class="_ _13"> </span>commonly<span class="_ _13"> </span>used<span class="_ _6"> </span>ones<span class="_ _13"> </span>are<span class="_ _13"> </span><span class="ffa">PC<span class="_ _6"> </span>relative<span class="_ _2"></span></span>.<span class="_ _6"> </span>That</div><div class="t m5 x17 h26 y2504 ff7 fs19 fc2 sc0 ls0 ws0">is<span class="_ _1"></span>,<span class="_ _16"> </span>they<span class="_ _16"> </span>encode<span class="_ _16"> </span>the<span class="_ _16"> </span>difference<span class="_ _11"> </span>between<span class="_ _16"> </span>the<span class="_ _16"> </span>address<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>target<span class="_ _11"> </span>instruction<span class="_ _16"> </span>and</div><div class="t m5 x17 h26 y2505 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>address<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>instruction<span class="_ _11"> </span>immediately<span class="_ _11"> </span>following<span class="_ _11"> </span>the<span class="_ _11"> </span>jump<span class="_ _0"></span>.<span class="_"> </span>These<span class="_"> </span>offsets<span class="_ _11"> </span>can</div><div class="t m5 x17 h26 y2506 ff7 fs19 fc2 sc0 ls0 ws0">be<span class="_"> </span>encoded<span class="_"> </span>using<span class="_"> </span>1,<span class="_"> </span>2,<span class="_"> </span>or<span class="_"> </span>4<span class="_"> </span>bytes<span class="_ _1"></span>.<span class="_"> </span>A<span class="_"> </span>second<span class="_"> </span>encoding<span class="_ _11"> </span>method<span class="_"> </span>is<span class="_"> </span>to<span class="_"> </span>give<span class="_"> </span>an<span class="_"> </span>“abso-</div><div class="t m5 x17 h26 y2507 ff7 fs19 fc2 sc0 ls0 ws0">lute”<span class="_ _13"> </span>address<span class="_ _1"></span>,<span class="_ _13"> </span>using<span class="_ _13"> </span>4<span class="_ _13"> </span>bytes<span class="_ _13"> </span>to<span class="_ _13"> </span>directly<span class="_ _13"> </span>specify<span class="_ _13"> </span>the<span class="_ _13"> </span>target.<span class="_ _6"> </span>The<span class="_ _13"> </span>assembler<span class="_ _6"> </span>and<span class="_ _13"> </span>linker</div><div class="t m5 x17 h26 y2508 ff7 fs19 fc2 sc0 ls0 ws0">select<span class="_"> </span>the<span class="_"> </span>appropriate<span class="_"> </span>encodings<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>jump<span class="_"> </span>destinations<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y2509 ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_ _11"> </span>an<span class="_ _11"> </span>example<span class="_ _16"> </span>of<span class="_"> </span>PC-relative<span class="_ _16"> </span>addressing<span class="_ _0"></span>,<span class="_ _11"> </span>the<span class="_ _16"> </span>following<span class="_ _11"> </span>assembly<span class="_ _11"> </span>code<span class="_ _11"> </span>for<span class="_ _16"> </span>a</div><div class="t m5 x17 h26 y250a ff7 fs19 fc2 sc0 ls0 ws0">function<span class="_ _11"> </span>was<span class="_ _11"> </span>generated<span class="_ _16"> </span>by<span class="_ _11"> </span>compiling<span class="_ _11"> </span>a<span class="_ _11"> </span>ﬁle<span class="_ _16"> </span><span class="ffd">branch.c</span>.<span class="_"> </span>It<span class="_ _16"> </span>contains<span class="_ _11"> </span>two<span class="_ _11"> </span>jumps:<span class="_ _11"> </span>the</div><div class="t m5 x17 h26 y250b ffd fs19 fc2 sc0 ls0 ws0">jmp<span class="_ _6"> </span><span class="ff7">instruction<span class="_ _6"> </span>on<span class="_ _6"> </span>line<span class="_ _6"> </span>2<span class="_ _6"> </span>jumps<span class="_ _13"> </span>forward<span class="_ _a"> </span>to<span class="_ _6"> </span>a<span class="_ _6"> </span>higher<span class="_ _6"> </span>address<span class="_ _1"></span>,<span class="_ _13"> </span>while<span class="_ _6"> </span>the<span class="_ _6"> </span><span class="ffd">jg<span class="_ _6"> </span></span>instruction</span></div><div class="t m5 x17 h26 y250c ff7 fs19 fc2 sc0 ls0 ws0">on<span class="_"> </span>line<span class="_"> </span>7<span class="_"> </span>jumps<span class="_"> </span>back<span class="_"> </span>to<span class="_"> </span>a<span class="_"> </span>lower<span class="_"> </span>one<span class="_ _1"></span>.</div><div class="t m5 x2c h2d y250d ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rdi,<span class="_ _e"> </span>%rax</span></div><div class="t m5 x2c h2d y250e ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">jmp<span class="_ _8c"> </span>.L2</span></div><div class="t m5 x2c h2d y250f ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L3:</span></div><div class="t m5 x2c h2d y2510 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">sarq<span class="_ _46"> </span>%rax</span></div><div class="t m5 x2c h2d y2511 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L2:</span></div><div class="t m5 x2c h2d y2512 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">testq<span class="_ _3f"> </span>%rax,<span class="_ _e"> </span>%rax</span></div><div class="t m5 x2c h2d y2513 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">jg<span class="_ _5a"> </span>.L3</span></div><div class="t m5 x2c h2e y2514 ff6 fs20 fc6 sc0 ls0 ws0">8</div><div class="t m5 xd1 h2d y2515 ffd fs1e fc2 sc0 ls0 ws0">rep;<span class="_ _e"> </span>ret</div><div class="t m5 x26 h26 y2516 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _16"> </span>disassembled<span class="_ _11"> </span>version<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span><span class="ffd">.o<span class="_ _11"> </span></span>format<span class="_ _16"> </span>generated<span class="_ _11"> </span>by<span class="_ _16"> </span>the<span class="_ _11"> </span>assembler<span class="_ _11"> </span>is<span class="_ _16"> </span>as</div><div class="t m5 x17 h26 y2517 ff7 fs19 fc2 sc0 ls0 ws0">follows:</div><div class="t m5 x2c h2e y2518 ff6 fs20 fc6 sc0 ls0 ws0">1</div><div class="t m5 x123 h2d y2519 ffd fs1e fc2 sc0 ls0 ws0">0:<span class="_ _3f"> </span>48<span class="_ _e"> </span>89<span class="_ _1f"> </span>f8<span class="_ _12a"> </span>mov<span class="_ _7b"> </span>%rdi,%rax</div><div class="t m5 x2c h2d y251a ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _5b"> </span><span class="ffd fs1e fc2">3:<span class="_ _3f"> </span>eb<span class="_ _1f"> </span>03<span class="_ _159"> </span>jmp<span class="_ _46"> </span>8<span class="_ _e"> </span>&lt;loop+0x8&gt;</span></div><div class="t m5 x2c h2d y251b ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _5b"> </span><span class="ffd fs1e fc2">5:<span class="_ _3f"> </span>48<span class="_ _1f"> </span>d1<span class="_ _e"> </span>f8<span class="_ _12a"> </span>sar<span class="_ _46"> </span>%rax</span></div><div class="t m5 x2c h2d y251c ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _5b"> </span><span class="ffd fs1e fc2">8:<span class="_ _3f"> </span>48<span class="_ _1f"> </span>85<span class="_ _e"> </span>c0<span class="_ _12a"> </span>test<span class="_ _3f"> </span>%rax,%rax</span></div><div class="t m5 x2c h2d y251d ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _5b"> </span><span class="ffd fs1e fc2">b:<span class="_ _3f"> </span>7f<span class="_ _1f"> </span>f8<span class="_ _159"> </span>jg<span class="_ _8c"> </span>5<span class="_ _e"> </span>&lt;loop+0x5&gt;</span></div><div class="t m5 x2c h2d y251e ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _5b"> </span><span class="ffd fs1e fc2">d:<span class="_ _3f"> </span>f3<span class="_ _1f"> </span>c3<span class="_ _159"> </span>repz<span class="_ _e"> </span>retq</span></div><div class="t m5 x26 h26 y543 ff7 fs19 fc2 sc0 ls0 ws0">In<span class="_ _6"> </span>the<span class="_ _6"> </span>annotations<span class="_ _6"> </span>on<span class="_ _6"> </span>the<span class="_ _6"> </span>right<span class="_ _6"> </span>generated<span class="_ _6"> </span>by<span class="_ _13"> </span>the<span class="_ _a"> </span>disassembler,<span class="_ _6"> </span>the<span class="_ _6"> </span>jump<span class="_ _6"> </span>targets</div><div class="t m5 x17 h26 y544 ff7 fs19 fc2 sc0 ls0 ws0">are<span class="_ _21"> </span>indicated<span class="_ _21"> </span>as<span class="_ _21"> </span><span class="ffd">0x8<span class="_ _21"> </span></span>for<span class="_ _f"> </span>the<span class="_ _21"> </span>jump<span class="_ _21"> </span>instruction<span class="_ _21"> </span>on<span class="_ _f"> </span>line<span class="_ _21"> </span>2<span class="_ _21"> </span>and<span class="_ _21"> </span><span class="ffd">0x5<span class="_ _f"> </span></span>for<span class="_ _21"> </span>the<span class="_ _21"> </span>jump</div><div class="t m5 x17 h26 y545 ff7 fs19 fc2 sc0 ls0 ws0">instruction<span class="_"> </span>on<span class="_ _13"> </span>line<span class="_"> </span>5<span class="_ _13"> </span>(the<span class="_"> </span>disassembler<span class="_ _13"> </span>lists<span class="_"> </span>all<span class="_ _13"> </span>numbers<span class="_"> </span>in<span class="_ _13"> </span>hexadecimal).<span class="_"> </span>Looking</div><div class="t m5 x17 h26 y546 ff7 fs19 fc2 sc0 ls0 ws0">at<span class="_ _6"> </span>the<span class="_ _13"> </span>byte<span class="_ _6"> </span>encodings<span class="_ _13"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>instructions<span class="_ _3"></span>,<span class="_ _13"> </span>however,<span class="_ _13"> </span>we<span class="_ _6"> </span>see<span class="_ _13"> </span>that<span class="_ _6"> </span>the<span class="_ _13"> </span>target<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _6"> </span>ﬁrst</div><div class="t m5 x17 h26 y547 ff7 fs19 fc2 sc0 ls0 ws0">jump<span class="_"> </span>instruction<span class="_"> </span>is<span class="_"> </span>encoded<span class="_"> </span>(in<span class="_"> </span>the<span class="_"> </span>second<span class="_"> </span>byte)<span class="_"> </span>as<span class="_"> </span><span class="ffd">0x03</span>.<span class="_"> </span>Adding<span class="_"> </span>this<span class="_"> </span>to<span class="_"> </span><span class="ffd">0x5</span>,<span class="_"> </span>the</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
