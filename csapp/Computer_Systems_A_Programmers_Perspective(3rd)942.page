<div id="pf3ae" class="pf w2 h11" data-page-no="3ae"><div class="pc pc3ae w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg3ae.png"/><div class="t m5 x19b h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>10.7<span class="_ _60"> </span>Reading<span class="_ _10"> </span>Director<span class="_"> </span>y<span class="_ _10"> </span>Contents<span class="_ _3e"> </span><span class="ffe fs1e">941</span></div><div class="t m5 x17 h3b ye7 fff fs24 fc6 sc0 ls0 ws0">10.7<span class="_ _17"> </span><span class="ffe fs18">Reading<span class="_"> </span>Director<span class="_ _2"></span>y<span class="_"> </span>Contents</span></div><div class="t m5 x17 h26 y327 ff7 fs19 fc1 sc0 ls0 ws0">Applications<span class="_ _21"> </span>can<span class="_ _21"> </span>read<span class="_ _21"> </span>the<span class="_ _21"> </span>contents<span class="_ _21"> </span>of<span class="_ _21"> </span>a<span class="_ _21"> </span>directory<span class="_ _f"> </span>with<span class="_ _21"> </span>the<span class="_ _21"> </span><span class="ffd">readdir<span class="_ _21"> </span></span>family<span class="_ _21"> </span>of</div><div class="t m5 x17 h26 y328 ff7 fs19 fc1 sc0 ls0 ws0">functions<span class="_ _1"></span>.</div><div class="t m5 x31 h2d y784a ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;sys/types.h&gt;</div><div class="t m5 x31 h2d y784b ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;dirent.h&gt;</div><div class="t m5 x31 h2d y784c ffd fs1e fc2 sc0 ls0 ws0">DIR<span class="_ _e"> </span>*opendir(const<span class="_ _1f"> </span>char<span class="_ _1f"> </span>*name);</div><div class="t m5 x1eb hf1 y784d ff7 fs1f fc2 sc0 ls0 ws0">Returns:<span class="_"> </span>pointer<span class="_"> </span>to<span class="_"> </span>handle<span class="_"> </span>if<span class="_"> </span>OK,<span class="_"> </span>NULL<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m5 x17 h26 y784e ff7 fs19 fc2 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_"> </span><span class="ffd ls0">opendir<span class="_ _a"> </span><span class="ff7">function<span class="_ _13"> </span>takes<span class="_ _a"> </span>a<span class="_ _6"> </span>pathname<span class="_ _6"> </span>and<span class="_ _6"> </span>returns<span class="_ _13"> </span>a<span class="_ _a"> </span>pointer<span class="_ _6"> </span>to<span class="_ _6"> </span>a<span class="_ _13"> </span><span class="ffa">directory<span class="_ _a"> </span>stream</span>.</span></span></div><div class="t m5 x17 h26 y784f ff7 fs19 fc2 sc0 ls0 ws0">A<span class="_ _13"> </span>stream<span class="_ _6"> </span>is<span class="_ _13"> </span>an<span class="_ _13"> </span>abstraction<span class="_ _6"> </span>for<span class="_ _13"> </span>an<span class="_ _13"> </span>ordered<span class="_ _13"> </span>list<span class="_ _6"> </span>of<span class="_ _13"> </span>items<span class="_ _1"></span>,<span class="_ _13"> </span>in<span class="_ _13"> </span>this<span class="_ _6"> </span>case<span class="_ _13"> </span>a<span class="_ _13"> </span>list<span class="_ _6"> </span>of<span class="_ _13"> </span>directory</div><div class="t m5 x17 h26 y7850 ff7 fs19 fc2 sc0 ls0 ws0">entries<span class="_ _1"></span>.</div><div class="t m5 x31 h2d y7851 ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;dirent.h&gt;</div><div class="t m5 x31 h2d y7852 ffd fs1e fc2 sc0 ls0 ws0">struct<span class="_ _e"> </span>dirent<span class="_ _1f"> </span>*readdir(DIR<span class="_ _1f"> </span>*dirp);</div><div class="t m5 x1a0 hf1 y7853 ff7 fs1f fc2 sc0 ls0 ws0">Returns:<span class="_"> </span>pointer<span class="_"> </span>to<span class="_"> </span>next<span class="_"> </span>directory<span class="_"> </span>entry<span class="_"> </span>if<span class="_"> </span>OK,<span class="_"> </span>NULL<span class="_"> </span>if<span class="_"> </span>no<span class="_"> </span>more<span class="_"> </span>entries<span class="_"> </span>or<span class="_"> </span>error</div><div class="t m5 x17 h26 y7854 ff7 fs19 fc2 sc0 ls0 ws0">Each<span class="_ _11"> </span>call<span class="_ _16"> </span>to<span class="_ _16"> </span><span class="ffd">readdir<span class="_ _11"> </span></span>returns<span class="_ _16"> </span>a<span class="_ _11"> </span>pointer<span class="_ _16"> </span>to<span class="_ _11"> </span>the<span class="_ _16"> </span>next<span class="_ _11"> </span>directory<span class="_ _16"> </span>entry<span class="_ _16"> </span>in<span class="_ _11"> </span>the<span class="_ _16"> </span>stream</div><div class="t m5 x17 h26 y7855 ffd fs19 fc2 sc0 ls0 ws0">dirp<span class="ff7">,<span class="_"> </span>or<span class="_ _13"> </span>NULL<span class="_"> </span>if<span class="_ _13"> </span>there<span class="_"> </span>are<span class="_ _13"> </span>no<span class="_ _13"> </span>more<span class="_"> </span>entries<span class="_ _1"></span>.<span class="_ _13"> </span>Each<span class="_"> </span>directory<span class="_ _13"> </span>entry<span class="_"> </span>is<span class="_ _13"> </span>a<span class="_"> </span>structure<span class="_ _13"> </span>of</span></div><div class="t m5 x17 h26 y7856 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>form</div><div class="t m5 x17 h2d y7857 ffd fs1e fc2 sc0 ls0 ws0">struct<span class="_ _e"> </span>dirent<span class="_ _1f"> </span>{</div><div class="t m5 x1b6 h2d y7858 ffd fs1e fc2 sc0 ls0 ws0">ino_t<span class="_ _e"> </span>d_ino;<span class="_ _2b"> </span>/*<span class="_ _e"> </span>inode<span class="_ _1f"> </span>number<span class="_ _1f"> </span>*/</div><div class="t m5 x1b6 h2d y7859 ffd fs1e fc2 sc0 ls0 ws0">char<span class="_ _1a"> </span>d_name[256];<span class="_ _e"> </span>/*<span class="_ _1f"> </span>Filename<span class="_ _1f"> </span>*/</div><div class="t m5 x17 h2d y785a ffd fs1e fc2 sc0 ls0 ws0">};</div><div class="t m5 x26 h26 y785b ff7 fs19 fc2 sc0 ls0 ws0">Although<span class="_ _21"> </span>some<span class="_ _21"> </span>versions<span class="_ _21"> </span>of<span class="_ _21"> </span>Linux<span class="_ _f"> </span>include<span class="_ _21"> </span>other<span class="_ _21"> </span>structure<span class="_ _21"> </span>members<span class="_ _1"></span>,<span class="_ _e"> </span>these</div><div class="t m5 x17 h26 y785c ff7 fs19 fc2 sc0 ls0 ws0">are<span class="_ _11"> </span>the<span class="_ _11"> </span>only<span class="_ _11"> </span>two<span class="_ _11"> </span>that<span class="_ _11"> </span>are<span class="_ _11"> </span>standard<span class="_ _11"> </span>across<span class="_ _11"> </span>all<span class="_ _11"> </span>systems<span class="_ _1"></span>.<span class="_ _11"> </span>T<span class="_ _0"></span>he<span class="_ _11"> </span><span class="ffd">d_name<span class="_ _11"> </span></span>member<span class="_ _11"> </span>is<span class="_ _11"> </span>the</div><div class="t m5 x17 h26 y785d ff7 fs19 fc2 sc0 ls0 ws0">ﬁlename<span class="_ _1"></span>,<span class="_"> </span>and<span class="_"> </span><span class="ffd">d_ino<span class="_ _11"> </span></span>is<span class="_"> </span>the<span class="_"> </span>ﬁle<span class="_"> </span>location.</div><div class="t m5 x26 h26 y785e ff7 fs19 fc2 sc0 ls0 ws0">On<span class="_ _6"> </span>error,<span class="_ _13"> </span><span class="ffd">readdir<span class="_ _6"> </span></span>returns<span class="_ _13"> </span>NULL<span class="_ _6"> </span>and<span class="_ _13"> </span>sets<span class="_ _6"> </span><span class="ffd">errno</span>.<span class="_ _13"> </span>Unfortunately<span class="_ _7"></span>,<span class="_ _13"> </span>the<span class="_ _13"> </span>only<span class="_ _6"> </span>way</div><div class="t m5 x17 h26 y785f ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_"> </span>distinguish<span class="_ _11"> </span>an<span class="_ _11"> </span>error<span class="_"> </span>from<span class="_ _11"> </span>the<span class="_ _11"> </span>end-of-stream<span class="_ _11"> </span>condition<span class="_"> </span>is<span class="_ _11"> </span>to<span class="_ _11"> </span>check<span class="_"> </span>if<span class="_ _11"> </span><span class="ffd">errno<span class="_ _11"> </span></span>has</div><div class="t m5 x17 h26 y7860 ff7 fs19 fc2 sc0 ls0 ws0">been<span class="_"> </span>modiﬁed<span class="_"> </span>since<span class="_"> </span>the<span class="_"> </span>call<span class="_"> </span>to<span class="_"> </span><span class="ffd">readdir</span>.</div><div class="t m5 x31 h2d y7861 ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;dirent.h&gt;</div><div class="t m5 x31 h2d y7862 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>closedir(DIR<span class="_ _1f"> </span>*dirp);</div><div class="t m5 xd2 hf2 y7863 ff7 fs1f fc2 sc0 ls0 ws0">Returns:<span class="_"> </span>0<span class="_"> </span>on<span class="_"> </span>success<span class="_ _1"></span>,<span class="_"> </span><span class="ff12">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m5 x17 h26 y77e ff7 fs19 fc2 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _14"> </span><span class="ffd ls0">closedir<span class="_ _16"> </span><span class="ff7">function<span class="_ _16"> </span>closes<span class="_ _14"> </span>the<span class="_ _16"> </span>stream<span class="_ _16"> </span>and<span class="_ _16"> </span>frees<span class="_ _16"> </span>up<span class="_ _16"> </span>any<span class="_ _16"> </span>of<span class="_ _14"> </span>its<span class="_ _16"> </span>resources<span class="_ _1"></span>.<span class="_ _16"> </span>F<span class="_ _0"></span>ig-</span></span></div><div class="t m5 x17 h26 y77f ff7 fs19 fc2 sc0 ls0 ws0">ure<span class="_"> </span>10.11<span class="_"> </span>shows<span class="_"> </span>how<span class="_"> </span>we<span class="_"> </span>might<span class="_"> </span>use<span class="_"> </span><span class="ffd">readdir<span class="_ _10"> </span></span>to<span class="_"> </span>read<span class="_"> </span>the<span class="_"> </span>contents<span class="_"> </span>of<span class="_"> </span>a<span class="_"> </span>directory<span class="_ _3"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
