<div id="pf152" class="pf w2 h11" data-page-no="152"><div class="pc pc152 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg152.png"/><div class="t m5 x195 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>3.11<span class="_ _60"> </span>Floating-Point<span class="_ _10"> </span>Code<span class="_ _3e"> </span><span class="ffe fs1e">337</span></div><div class="t m5 x17 h26 y9c ffd fs19 fc2 sc0 ls0 ws0">%xmm0<span class="_ _14"> </span><span class="ff7">(ﬂoating-point<span class="_ _14"> </span>result).<span class="_ _16"> </span>Show<span class="_ _14"> </span>the<span class="_ _14"> </span>instruction(s),<span class="_ _15"> </span>including<span class="_ _14"> </span>the<span class="_ _14"> </span>source<span class="_ _14"> </span>and</span></div><div class="t m5 x17 h26 y409 ff7 fs19 fc2 sc0 ls0 ws0">destination<span class="_"> </span>registers<span class="_ _1"></span>.</div><div class="t m5 x62 h55 y3053 ff11 fs21 fc2 sc0 ls0 ws0">T</div><div class="t m5 x2f h6d y3054 ffd fs2c fc2 sc0 ls0 ws0">x</div><div class="t m5 x1b0 h55 y3053 ff11 fs21 fc2 sc0 ls0 ws0">T</div><div class="t m5 x1f6 h6d y3054 ffd fs2c fc2 sc0 ls0 ws0">y</div><div class="t m5 x64 h31 y3053 ff7 fs21 fc2 sc0 ls0 ws0">Instruction(s)</div><div class="t m5 x52 h2d y3055 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _75"> </span>double<span class="_ _26"> </span>vcvtsi2sdq<span class="_ _11"> </span>%rdi,<span class="_ _11"> </span>%xmm0</div><div class="t m5 x17 h2d y3056 ffd fs1e fc2 sc0 ls0 ws0">double<span class="_ _72"> </span>int</div><div class="t m5 x17 h2d y3057 ffd fs1e fc1 sc0 ls0 ws0">double<span class="_ _61"> </span>float</div><div class="t m5 x52 h2d y3058 ffd fs1e fc1 sc0 ls0 ws0">long<span class="_ _72"> </span>float</div><div class="t m5 x243 h2d y3059 ffd fs1e fc1 sc0 ls0 ws0">float<span class="_ _72"> </span>long</div><div class="t m5 x17 h41 y305a ffe fs29 fc1 sc0 ls0 ws0">3.11.2<span class="_ _48"> </span><span class="fs19">Floating-Point<span class="_"> </span>Code<span class="_"> </span>in<span class="_"> </span>Procedures</span></div><div class="t m5 x17 h26 y305b ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _1"></span>ith<span class="_"> </span>x86-64,<span class="_"> </span>the<span class="_"> </span>XMM<span class="_"> </span>registers<span class="_"> </span>are<span class="_"> </span>used<span class="_"> </span>for<span class="_"> </span>passing<span class="_"> </span>ﬂoating-point<span class="_ _13"> </span>arguments<span class="_"> </span>to</div><div class="t m5 x17 h26 y305c ff7 fs19 fc1 sc0 ls0 ws0">functions<span class="_ _16"> </span>and<span class="_ _16"> </span>for<span class="_ _16"> </span>returning<span class="_ _14"> </span>ﬂoating-point<span class="_ _16"> </span>values<span class="_ _16"> </span>from<span class="_ _16"> </span>them.<span class="_ _16"> </span>As<span class="_ _14"> </span>is<span class="_ _16"> </span>illustrated<span class="_ _16"> </span>in</div><div class="t m5 x17 h26 y305d ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_"> </span>3.45,<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>conventions<span class="_"> </span>are<span class="_"> </span>observed:</div><div class="t m5 x72 h3d y305e ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y305f ff7 fs19 fc1 sc0 ls0 ws0">Up<span class="_ _13"> </span>to<span class="_"> </span>eight<span class="_ _13"> </span>ﬂoating-point<span class="_ _13"> </span>arguments<span class="_"> </span>can<span class="_ _13"> </span>be<span class="_ _13"> </span>passed<span class="_ _13"> </span>in<span class="_"> </span>XMM<span class="_ _13"> </span>registers<span class="_ _13"> </span><span class="ffd">%xmm0</span>–</div><div class="t m5 x26 h26 y3060 ffd fs19 fc1 sc0 ls0 ws0">%xmm7<span class="ff7">.<span class="_ _11"> </span>T<span class="_ _0"></span>hese<span class="_ _11"> </span>registers<span class="_ _11"> </span>are<span class="_ _11"> </span>used<span class="_ _16"> </span>in<span class="_"> </span>the<span class="_ _16"> </span>order<span class="_ _11"> </span>the<span class="_ _11"> </span>arguments<span class="_ _11"> </span>are<span class="_ _11"> </span>listed.<span class="_ _16"> </span>Addi-</span></div><div class="t m5 x26 h26 y3061 ff7 fs19 fc1 sc0 ls0 ws0">tional<span class="_"> </span>ﬂoating-point<span class="_"> </span>arguments<span class="_"> </span>can<span class="_"> </span>be<span class="_"> </span>passed<span class="_"> </span>on<span class="_"> </span>the<span class="_"> </span>stack.</div><div class="t m5 x72 h3d y3062 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y3063 ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_"> </span>function<span class="_"> </span>that<span class="_"> </span>returns<span class="_"> </span>a<span class="_"> </span>ﬂoating-point<span class="_"> </span>value<span class="_"> </span>does<span class="_"> </span>so<span class="_"> </span>in<span class="_"> </span>register<span class="_"> </span><span class="ffd">%xmm0</span>.</div><div class="t m5 x72 h3d y3064 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y3065 ff7 fs19 fc1 sc0 ls0 ws0">All<span class="_ _16"> </span>XMM<span class="_ _16"> </span>registers<span class="_ _14"> </span>are<span class="_ _16"> </span>caller<span class="_ _16"> </span>saved.<span class="_ _16"> </span>The<span class="_ _16"> </span>callee<span class="_ _16"> </span>may<span class="_ _16"> </span>overwrite<span class="_ _16"> </span>any<span class="_ _14"> </span>of<span class="_ _16"> </span>these</div><div class="t m5 x26 h26 y3066 ff7 fs19 fc1 sc0 ls0 ws0">registers<span class="_"> </span>without<span class="_"> </span>ﬁrst<span class="_"> </span>saving<span class="_"> </span>it.</div><div class="t m5 x26 h26 y3067 ff7 fs19 fc1 sc0 ls0 ws0">When<span class="_ _14"> </span>a<span class="_ _21"> </span>function<span class="_ _15"> </span>contains<span class="_ _21"> </span>a<span class="_ _15"> </span>combination<span class="_ _21"> </span>of<span class="_ _15"> </span>pointer,<span class="_ _f"> </span>integer,<span class="_ _21"> </span>and<span class="_ _15"> </span>ﬂoating-</div><div class="t m5 x17 h26 y3068 ff7 fs19 fc1 sc0 ls0 ws0">point<span class="_ _6"> </span>arguments<span class="_ _1"></span>,<span class="_ _13"> </span>the<span class="_ _13"> </span>pointers<span class="_ _6"> </span>and<span class="_ _13"> </span>integers<span class="_ _6"> </span>are<span class="_ _6"> </span>passed<span class="_ _13"> </span>in<span class="_ _6"> </span>general-purpose<span class="_ _13"> </span>registers<span class="_ _3"></span>,</div><div class="t m5 x17 h26 y3069 ff7 fs19 fc1 sc0 ls0 ws0">while<span class="_"> </span>the<span class="_"> </span>ﬂoating-point<span class="_"> </span>values<span class="_ _11"> </span>are<span class="_"> </span>passed<span class="_"> </span>in<span class="_"> </span>XMM<span class="_ _11"> </span>registers<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _0"></span>his<span class="_"> </span>means<span class="_"> </span>that<span class="_"> </span>the</div><div class="t m5 x17 h26 y306a ff7 fs19 fc1 sc0 ls0 ws0">mapping<span class="_ _13"> </span>of<span class="_ _13"> </span>arguments<span class="_ _13"> </span>to<span class="_ _13"> </span>registers<span class="_ _6"> </span>depends<span class="_ _13"> </span>on<span class="_ _13"> </span>both<span class="_ _13"> </span>their<span class="_ _13"> </span>types<span class="_ _13"> </span>and<span class="_ _13"> </span>their<span class="_ _13"> </span>ordering<span class="_ _0"></span>.</div><div class="t m5 x17 h26 y306b ff7 fs19 fc1 sc0 ls0 ws0">Here<span class="_"> </span>are<span class="_"> </span>several<span class="_"> </span>examples:</div><div class="t m5 x245 h2d y306c ffd fs1e fc2 sc0 ls0 ws0">double<span class="_ _e"> </span>f1(int<span class="_ _1f"> </span>x,<span class="_ _1f"> </span>double<span class="_ _e"> </span>y,<span class="_ _1f"> </span>long<span class="_ _e"> </span>z);</div><div class="t m5 x17 h26 y306d ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>function<span class="_"> </span>would<span class="_"> </span>have<span class="_"> </span><span class="ffd">x<span class="_ _10"> </span></span>in<span class="_"> </span><span class="ffd">%edi</span>,<span class="_"> </span><span class="ffd">y<span class="_ _11"> </span></span>in<span class="_"> </span><span class="ffd">%xmm0</span>,<span class="_"> </span>and<span class="_"> </span><span class="ffd">z<span class="_ _10"> </span></span>in<span class="_"> </span><span class="ffd">%rsi</span>.</div><div class="t m5 x245 h2d y306e ffd fs1e fc2 sc0 ls0 ws0">double<span class="_ _e"> </span>f2(double<span class="_ _1f"> </span>y,<span class="_ _1f"> </span>int<span class="_ _e"> </span>x,<span class="_ _1f"> </span>long<span class="_ _e"> </span>z);</div><div class="t m5 x17 h26 y306f ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>function<span class="_"> </span>would<span class="_"> </span>have<span class="_"> </span>the<span class="_"> </span>same<span class="_"> </span>register<span class="_"> </span>assignment<span class="_"> </span>as<span class="_"> </span>function<span class="_"> </span><span class="ffd">f1</span>.</div><div class="t m5 x245 h2d y3070 ffd fs1e fc2 sc0 ls0 ws0">double<span class="_ _e"> </span>f1(float<span class="_ _1f"> </span>x,<span class="_ _1f"> </span>double<span class="_ _e"> </span>*y,<span class="_ _1f"> </span>long<span class="_ _e"> </span>*z);</div><div class="t m5 x17 h26 y3071 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>function<span class="_"> </span>would<span class="_"> </span>have<span class="_"> </span><span class="ffd">x<span class="_ _10"> </span></span>in<span class="_"> </span><span class="ffd">%xmm0</span>,<span class="_"> </span><span class="ffd">y<span class="_ _11"> </span></span>in<span class="_"> </span><span class="ffd">%rdi</span>,<span class="_"> </span>and<span class="_"> </span><span class="ffd">z<span class="_ _10"> </span></span>in<span class="_"> </span><span class="ffd">%rsi</span>.</div><div class="t m5 x17 h47 y3072 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>3.52<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>384)</span></div><div class="t m5 x17 h26 y3073 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _6"> </span>each<span class="_ _6"> </span>of<span class="_ _6"> </span>the<span class="_ _6"> </span>following<span class="_ _6"> </span>function<span class="_ _6"> </span>declarations<span class="_ _1"></span>,<span class="_ _13"> </span>determine<span class="_ _a"> </span>the<span class="_ _6"> </span>register<span class="_ _6"> </span>assignments</div><div class="t m5 x17 h26 y3074 ff7 fs19 fc1 sc0 ls0 ws0">for<span class="_"> </span>the<span class="_"> </span>arguments:</div><div class="t m5 x34 h26 y15bf ff7 fs19 fc1 sc0 ls0 ws0">A.</div><div class="t m5 x2d h2d yd7a ffd fs1e fc2 sc0 ls0 ws0">double<span class="_ _e"> </span>g1(double<span class="_ _1f"> </span>a,<span class="_ _1f"> </span>long<span class="_ _e"> </span>b,<span class="_ _1f"> </span>float<span class="_ _e"> </span>c,<span class="_ _1f"> </span>int<span class="_ _1f"> </span>d);</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
