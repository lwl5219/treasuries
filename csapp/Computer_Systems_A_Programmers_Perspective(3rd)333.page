<div id="pf14d" class="pf w2 h11" data-page-no="14d"><div class="pc pc14d w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg14d.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">332<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x1d h31 y390 ff7 fs21 fc2 sc0 ls0 ws0">Instruction<span class="_ _26"> </span>Source<span class="_ _26"> </span>Destination<span class="_ _26"> </span>Description</div><div class="t m5 x1d h2d yc94 ffd fs1e fc2 sc0 ls0 ws0">vmovss<span class="_ _64"> </span><span class="ff11 fs21">M</span></div><div class="t m5 xf1 h33 yc95 ff7 fs20 fc2 sc0 ls0 ws0">32</div><div class="t m5 x176 h31 yc94 ff11 fs21 fc2 sc0 ls0 ws0">X<span class="_ _64"> </span><span class="ff7">Move<span class="_"> </span>single<span class="_"> </span>precision</span></div><div class="t m5 x1d h2d yc98 ffd fs1e fc2 sc0 ls0 ws0">vmovss<span class="_ _10d"> </span><span class="ff11 fs21 ls188">XM</span></div><div class="t m5 x15 h33 yc97 ff7 fs20 fc2 sc0 ls0 ws0">32</div><div class="t m5 x24 h31 yc98 ff7 fs21 fc2 sc0 ls0 ws0">Move<span class="_"> </span>single<span class="_"> </span>precision</div><div class="t m5 x1d h2d ycd6 ffd fs1e fc2 sc0 ls0 ws0">vmovsd<span class="_ _64"> </span><span class="ff11 fs21">M</span></div><div class="t m5 xf1 h33 y2f94 ff7 fs20 fc2 sc0 ls0 ws0">64</div><div class="t m5 x176 h31 ycd6 ff11 fs21 fc2 sc0 ls0 ws0">X<span class="_ _64"> </span><span class="ff7">Move<span class="_"> </span>double<span class="_"> </span>precision</span></div><div class="t m5 x1d h2d ycd7 ffd fs1e fc2 sc0 ls0 ws0">vmovsd<span class="_ _10d"> </span><span class="ff11 fs21 ls189">XM</span></div><div class="t m5 x15 h33 y2f95 ff7 fs20 fc2 sc0 ls0 ws0">64</div><div class="t m5 x24 h31 ycd7 ff7 fs21 fc2 sc0 ls0 ws0">Move<span class="_"> </span>double<span class="_"> </span>precision</div><div class="t m5 x1d h31 y2318 ffd fs1e fc2 sc0 ls0 ws0">vmovaps<span class="_ _d0"> </span><span class="ff11 fs21 ls18a">XX<span class="_ _b5"></span><span class="ff7 ls0">Move<span class="_"> </span>aligned,<span class="_"> </span>packed<span class="_"> </span>single<span class="_"> </span>precision</span></span></div><div class="t m5 x1d h2d y2d56 ffd fs1e fc2 sc0 ls0 ws0">vmovapd</div><div class="t m5 x1af h31 y221d ff11 fs21 fc2 sc0 ls18a ws0">XX<span class="_ _b4"></span><span class="ff7 ls0">Move<span class="_"> </span>aligned,<span class="_"> </span>packed<span class="_"> </span>double<span class="_"> </span>precision</span></div><div class="t m5 x1d h34 y221e ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>3.46<span class="_ _c"> </span><span class="fc1">Floating-point<span class="_"> </span>movement<span class="_"> </span>instructions.<span class="_ _11"> </span><span class="ff6">These<span class="_ _11"> </span>operations<span class="_ _10"> </span>transfer<span class="_ _11"> </span>values</span></span></div><div class="t m5 x1d h34 y2f96 ff6 fs16 fc1 sc0 ls0 ws0">between<span class="_ _11"> </span>memory<span class="_ _11"> </span>and<span class="_ _11"> </span>registers,<span class="_ _10"> </span>as<span class="_ _11"> </span>well<span class="_ _11"> </span>as<span class="_ _11"> </span>between<span class="_ _11"> </span>pairs<span class="_ _11"> </span>of<span class="_ _10"> </span>registers.<span class="_ _11"> </span>(<span class="ff11">X<span class="_ _2"></span></span>:<span class="_ _11"> </span>XMM<span class="_ _10"> </span>register</div><div class="t m5 x1d h34 y2f97 ff6 fs16 fc1 sc0 ls0 ws0">(e.g.,</div><div class="t m5 xad h3a y2f98 ffd fs19 fc1 sc0 ls0 ws0">%xmm3<span class="ff6 fs16">);<span class="_ _10"> </span><span class="ff11">M</span></span></div><div class="t m5 x15c h5d y2f99 ff7 fs32 fc1 sc0 ls0 ws0">32</div><div class="t m5 xb3 h34 y24e7 ff6 fs16 fc1 sc0 ls0 ws0">:<span class="_ _10"> </span>32-bit<span class="_ _11"> </span>memory<span class="_ _10"> </span>range;<span class="_ _11"> </span><span class="ff11">M</span></div><div class="t m5 x1d9 h5d y2f99 ff7 fs32 fc1 sc0 ls0 ws0">64</div><div class="t m5 x36 h34 y24e7 ff6 fs16 fc1 sc0 ls0 ws0">:<span class="_ _10"> </span>64-bit<span class="_ _11"> </span>memory<span class="_ _10"> </span>range)</div><div class="t m5 x1d h41 y2636 ffe fs29 fc1 sc0 ls0 ws0">3.11.1<span class="_ _48"> </span><span class="fs19">Floating-Point<span class="_"> </span>Movement<span class="_"> </span>and<span class="_"> </span>Conversion<span class="_"> </span>Operations</span></div><div class="t m5 x1d h26 y2f9a ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _13"> </span>3.46<span class="_ _13"> </span>shows<span class="_ _13"> </span>a<span class="_ _13"> </span>set<span class="_ _13"> </span>of<span class="_ _13"> </span>instructions<span class="_ _13"> </span>for<span class="_ _6"> </span>transferring<span class="_ _13"> </span>ﬂoating-point<span class="_ _13"> </span>data<span class="_ _13"> </span>between</div><div class="t m5 x1d h26 y2f9b ff7 fs19 fc1 sc0 ls0 ws0">memory<span class="_ _6"> </span>and<span class="_ _13"> </span>XMM<span class="_ _6"> </span>registers<span class="_ _1"></span>,<span class="_ _13"> </span>as<span class="_ _6"> </span>well<span class="_ _13"> </span>as<span class="_ _6"> </span>from<span class="_ _6"> </span>one<span class="_ _13"> </span>XMM<span class="_ _6"> </span>register<span class="_ _6"> </span>to<span class="_ _13"> </span>another<span class="_ _6"> </span>without</div><div class="t m5 x1d h26 y2f9c ff7 fs19 fc1 sc0 ls0 ws0">any<span class="_ _16"> </span>conversions<span class="_ _1"></span>.<span class="_ _14"> </span>T<span class="_ _1"></span>hose<span class="_ _14"> </span>that<span class="_ _16"> </span>reference<span class="_ _16"> </span>memory<span class="_ _14"> </span>are<span class="_ _16"> </span><span class="ffa">scalar<span class="_ _15"> </span></span>instructions<span class="_ _1"></span>,<span class="_ _14"> </span>meaning</div><div class="t m5 x1d h26 y2f9d ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_ _14"> </span>they<span class="_ _15"> </span>operate<span class="_ _14"> </span>on<span class="_ _15"> </span>individual,<span class="_ _21"> </span>rather<span class="_ _14"> </span>than<span class="_ _15"> </span>packed,<span class="_ _21"> </span>data<span class="_ _14"> </span>values<span class="_ _1"></span>.<span class="_ _15"> </span>T<span class="_ _0"></span>he<span class="_ _14"> </span>data<span class="_ _15"> </span>are</div><div class="t m5 x1d h26 y2f9e ff7 fs19 fc1 sc0 ls0 ws0">held<span class="_ _13"> </span>either<span class="_ _6"> </span>in<span class="_ _13"> </span>memory<span class="_ _13"> </span>(indicated<span class="_ _6"> </span>in<span class="_ _13"> </span>the<span class="_ _13"> </span>table<span class="_ _6"> </span>as<span class="_ _13"> </span><span class="ff11">M</span></div><div class="t m5 x60 h3c y2f9f ff7 fs25 fc1 sc0 ls0 ws0">32</div><div class="t m5 xda h26 y2fa0 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _13"> </span><span class="ff11">M</span></div><div class="t m5 x166 h3c y2f9f ff7 fs25 fc1 sc0 ls0 ws0">64</div><div class="t m5 xae h26 y2fa0 ff7 fs19 fc1 sc0 ls0 ws0">)<span class="_ _13"> </span>or<span class="_ _6"> </span>in<span class="_ _13"> </span>XMM<span class="_ _13"> </span>registers</div><div class="t m5 x1d h26 y2fa1 ff7 fs19 fc1 sc0 ls0 ws0">(shown<span class="_"> </span>in<span class="_ _13"> </span>the<span class="_"> </span>table<span class="_"> </span>as<span class="_ _13"> </span><span class="ff11">X<span class="_ _2"></span></span>).<span class="_"> </span>T<span class="_ _1"></span>hese<span class="_"> </span>instructions<span class="_ _13"> </span>will<span class="_"> </span>work<span class="_"> </span>correctly<span class="_ _13"> </span>regardless<span class="_"> </span>of<span class="_"> </span>the</div><div class="t m5 x1d h26 y2fa2 ff7 fs19 fc1 sc0 ls0 ws0">alignment<span class="_ _13"> </span>of<span class="_ _13"> </span>data,<span class="_ _13"> </span>although<span class="_ _13"> </span>the<span class="_"> </span>code<span class="_ _13"> </span>optimization<span class="_ _13"> </span>guidelines<span class="_ _13"> </span>recommend<span class="_ _13"> </span>that<span class="_ _13"> </span>32-</div><div class="t m5 x1d h26 y2fa3 ff7 fs19 fc1 sc0 ls0 ws0">bit<span class="_ _11"> </span>memory<span class="_ _11"> </span>data<span class="_ _11"> </span>satisfy<span class="_ _11"> </span>a<span class="_ _11"> </span>4-byte<span class="_ _11"> </span>alignment<span class="_ _11"> </span>and<span class="_ _11"> </span>that<span class="_ _11"> </span>64-bit<span class="_ _16"> </span>data<span class="_"> </span>satisfy<span class="_ _11"> </span>an<span class="_ _11"> </span>8-byte</div><div class="t m5 x1d h26 y2fa4 ff7 fs19 fc1 sc0 ls0 ws0">alignment.<span class="_ _13"> </span>Memory<span class="_ _6"> </span>references<span class="_ _13"> </span>are<span class="_ _6"> </span>speciﬁed<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_ _6"> </span>same<span class="_ _13"> </span>way<span class="_ _13"> </span>as<span class="_ _6"> </span>for<span class="_ _13"> </span>the<span class="_ _6"> </span>integer<span class="_ _13"> </span><span class="ff9">mo<span class="_ _0"></span>v</span></div><div class="t m5 x1d h26 y2fa5 ff7 fs19 fc1 sc0 ls0 ws0">instructions<span class="_ _1"></span>,<span class="_"> </span>with<span class="_"> </span>all<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>different<span class="_"> </span>possible<span class="_"> </span>combinations<span class="_"> </span>of<span class="_ _13"> </span>displacement,<span class="_"> </span>base</div><div class="t m5 x1d h26 y2fa6 ff7 fs19 fc1 sc0 ls0 ws0">register,<span class="_"> </span>index<span class="_"> </span>register<span class="_ _1"></span>,<span class="_"> </span>and<span class="_"> </span>scaling<span class="_"> </span>factor.</div><div class="t m5 x29 h26 y2fa7 ff9 fs19 fc1 sc0 ls0 ws0">Gcc<span class="_ _13"> </span><span class="ff7">uses<span class="_"> </span>the<span class="_ _13"> </span>scalar<span class="_"> </span>movement<span class="_ _13"> </span>operations<span class="_"> </span>only<span class="_ _13"> </span>to<span class="_"> </span>transfer<span class="_ _13"> </span>data<span class="_ _13"> </span>from<span class="_"> </span>memory</span></div><div class="t m5 x1d h26 y2fa8 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _11"> </span>an<span class="_ _11"> </span>XMM<span class="_ _11"> </span>register<span class="_ _16"> </span>or<span class="_ _11"> </span>from<span class="_ _11"> </span>an<span class="_ _11"> </span>XMM<span class="_ _11"> </span>register<span class="_ _16"> </span>to<span class="_ _11"> </span>memory<span class="_ _3"></span>.<span class="_ _11"> </span>F<span class="_ _1"></span>or<span class="_ _11"> </span>transferring<span class="_ _11"> </span>data</div><div class="t m5 x1d h26 y2fa9 ff7 fs19 fc1 sc0 ls0 ws0">between<span class="_"> </span>two<span class="_"> </span>XMM<span class="_"> </span>registers<span class="_ _3"></span>,<span class="_"> </span>it<span class="_"> </span>uses<span class="_"> </span>one<span class="_"> </span>of<span class="_"> </span>two<span class="_"> </span>different<span class="_ _13"> </span>instructions<span class="_"> </span>for<span class="_"> </span>copying</div><div class="t m5 x1d h26 y2faa ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _13"> </span>entire<span class="_"> </span>contents<span class="_ _13"> </span>of<span class="_ _13"> </span>one<span class="_"> </span>XMM<span class="_ _13"> </span>register<span class="_"> </span>to<span class="_ _13"> </span>another<span class="_ _1"></span>—namely<span class="_ _3"></span>,<span class="_ _13"> </span><span class="ffd">vmovaps<span class="_ _10"> </span></span>for<span class="_ _13"> </span>single-</div><div class="t m5 x1d h26 y2fab ff7 fs19 fc1 sc0 ls0 ws0">precision<span class="_ _11"> </span>and<span class="_ _16"> </span><span class="ffd">vmovapd<span class="_ _11"> </span></span>for<span class="_ _16"> </span>double-precision<span class="_ _11"> </span>values<span class="_ _1"></span>.<span class="_ _16"> </span>F<span class="_ _3"></span>or<span class="_ _16"> </span>these<span class="_ _11"> </span>cases<span class="_ _1"></span>,<span class="_ _16"> </span>whether<span class="_ _16"> </span>the</div><div class="t m5 x1d h26 y2fac ff7 fs19 fc1 sc0 ls0 ws0">program<span class="_"> </span>copies<span class="_ _11"> </span>the<span class="_ _11"> </span>entire<span class="_ _11"> </span>register<span class="_ _11"> </span>or<span class="_ _11"> </span>just<span class="_ _11"> </span>the<span class="_ _11"> </span>low-order<span class="_ _11"> </span>value<span class="_ _11"> </span>affects<span class="_ _11"> </span>neither<span class="_ _11"> </span>the</div><div class="t m5 x1d h26 y2fad ff7 fs19 fc1 sc0 ls0 ws0">program<span class="_ _14"> </span>functionality<span class="_ _14"> </span>nor<span class="_ _14"> </span>the<span class="_ _15"> </span>execution<span class="_ _14"> </span>speed,<span class="_ _15"> </span>and<span class="_ _14"> </span>so<span class="_ _14"> </span>using<span class="_ _15"> </span>these<span class="_ _14"> </span>instructions</div><div class="t m5 x1d h26 y2fae ff7 fs19 fc1 sc0 ls0 ws0">rather<span class="_ _14"> </span>than<span class="_ _14"> </span>ones<span class="_ _14"> </span>speciﬁc<span class="_ _14"> </span>to<span class="_ _14"> </span>scalar<span class="_ _14"> </span>data<span class="_ _14"> </span>makes<span class="_ _14"> </span>no<span class="_ _14"> </span>real<span class="_ _14"> </span>difference<span class="_ _1"></span>.<span class="_ _14"> </span>The<span class="_ _16"> </span>letter<span class="_ _14"> </span>‘<span class="ffd">a</span>’</div><div class="t m5 x1d h26 y2faf ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_ _15"> </span>these<span class="_ _15"> </span>instruction<span class="_ _21"> </span>names<span class="_ _15"> </span>stands<span class="_ _21"> </span>for<span class="_ _15"> </span>“aligned.<span class="_ _1"></span>”<span class="_ _21"> </span>When<span class="_ _14"> </span>used<span class="_ _21"> </span>to<span class="_ _15"> </span>read<span class="_ _21"> </span>and<span class="_ _15"> </span>write</div><div class="t m5 x1d h26 y2fb0 ff7 fs19 fc1 sc0 ls0 ws0">memory<span class="_ _3"></span>,<span class="_ _15"> </span>they<span class="_ _15"> </span>will<span class="_ _14"> </span>cause<span class="_ _15"> </span>an<span class="_ _14"> </span>exception<span class="_ _15"> </span>if<span class="_ _15"> </span>the<span class="_ _14"> </span>address<span class="_ _15"> </span>does<span class="_ _15"> </span>not<span class="_ _14"> </span>satisfy<span class="_ _15"> </span>a<span class="_ _14"> </span>16-byte</div><div class="t m5 x1d h26 y2fb1 ff7 fs19 fc1 sc0 ls0 ws0">alignment.<span class="_ _14"> </span>F<span class="_ _1"></span>or<span class="_ _15"> </span>transferring<span class="_ _15"> </span>between<span class="_ _15"> </span>two<span class="_ _14"> </span>registers<span class="_ _0"></span>,<span class="_ _15"> </span>there<span class="_ _15"> </span>is<span class="_ _15"> </span>no<span class="_ _15"> </span>possibility<span class="_ _14"> </span>of<span class="_ _15"> </span>an</div><div class="t m5 x1d h26 y2fb2 ff7 fs19 fc1 sc0 ls0 ws0">incorrect<span class="_"> </span>alignment.</div><div class="t m5 x29 h26 y2fb3 ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_ _11"> </span>an<span class="_ _11"> </span>example<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span>different<span class="_ _11"> </span>ﬂoating-point<span class="_ _11"> </span>move<span class="_ _11"> </span>operations<span class="_ _0"></span>,<span class="_ _11"> </span>consider<span class="_ _11"> </span>the</div><div class="t m5 x1d h26 y2fb4 ff7 fs19 fc1 sc0 ls0 ws0">C<span class="_"> </span>function</div><div class="t m5 x1d h2d y2fb5 ffd fs1e fc2 sc0 ls0 ws0">float<span class="_ _e"> </span>float_mov(float<span class="_ _1f"> </span>v1,<span class="_ _1f"> </span>float<span class="_ _e"> </span>*src,<span class="_ _1f"> </span>float<span class="_ _e"> </span>*dst)<span class="_ _1f"> </span>{</div><div class="t m5 x10c h2d y2fb6 ffd fs1e fc2 sc0 ls0 ws0">float<span class="_ _e"> </span>v2<span class="_ _1f"> </span>=<span class="_ _1f"> </span>*src;</div><div class="t m5 x10c h2d y2fb7 ffd fs1e fc2 sc0 ls0 ws0">*dst<span class="_ _e"> </span>=<span class="_ _1f"> </span>v1;</div><div class="t m5 x10c h2d y2fb8 ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>v2;</div><div class="t m5 x1d h2d y2fb9 ffd fs1e fc2 sc0 ls0 ws0">}</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
