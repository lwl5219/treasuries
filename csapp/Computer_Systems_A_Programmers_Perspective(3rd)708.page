<div id="pf2c4" class="pf w2 h11" data-page-no="2c4"><div class="pc pc2c4 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg2c4.png"/><div class="t m5 x107 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>7.1<span class="_ _60"> </span>Compiler<span class="_ _10"> </span>Drivers<span class="_ _3e"> </span><span class="ffe fs1e">707</span></div><div class="t m5 x17 h3a ye7 ff6 fs16 fc2 sc0 ls0 ws0">(a)<span class="_ _10"> </span><span class="ffd fs19">main.c</span></div><div class="t m5 xb7 h2c y5de4 ffa fs16 fc2 sc0 ls0 ws0">code/link/main.c</div><div class="t m5 x2c h2e y5de5 ff6 fs20 fc6 sc0 ls0 ws0">1</div><div class="t m5 x2d h2d y5de6 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>sum(int<span class="_ _1f"> </span>*a,<span class="_ _1f"> </span>int<span class="_ _e"> </span>n);</div><div class="t m5 x2c h2e y5de7 ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x2c h2e y5de8 ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x2d h2d y5de9 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>array[2]<span class="_ _1f"> </span>=<span class="_ _1f"> </span>{1,<span class="_ _e"> </span>2};</div><div class="t m5 x2c h2e y3483 ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 x2c h2e y5dea ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x2d h2d y2a15 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>main()</div><div class="t m5 x2c h2d y35f7 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x2c h2d y4f4e ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _20"> </span><span class="ffd fs1e fc2">int<span class="_ _e"> </span>val<span class="_ _1f"> </span>=<span class="_ _1f"> </span>sum(array,<span class="_ _e"> </span>2);</span></div><div class="t m5 x2c h2d y4f4f ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _20"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>val;</span></div><div class="t m5 x2c h2d y4f50 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 xb7 h2c y5deb ffa fs16 fc2 sc0 ls0 ws0">code/link/main.c</div><div class="t m5 x114 h34 y5dec ff6 fs16 fc2 sc0 ls0 ws0">(b)</div><div class="t m5 x1b4 h3a y26f7 ffd fs19 fc2 sc0 ls0 ws0">sum.c</div><div class="t m5 x174 h2c y5ded ffa fs16 fc2 sc0 ls0 ws0">code/link/sum.c</div><div class="t m5 x24 h2d y5dee ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">int<span class="_ _1f"> </span>sum(int<span class="_ _e"> </span>*a,<span class="_ _1f"> </span>int<span class="_ _1f"> </span>n)</span></div><div class="t m5 x24 h2d y5def ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x24 h2d y5df0 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2 ls33">i<span class="_ _41"></span>n<span class="_ _41"></span>ti<span class="_ _41"></span>,s=0<span class="_ _41"></span>;</span></div><div class="t m5 x24 h2e y5df1 ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 x24 h2e y5df2 ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x195 h2d y5df3 ffd fs1e fc2 sc0 ls33 ws0">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>i=0<span class="_ _41"></span>;i&lt;n<span class="_ _41"></span>;<span class="ls0">i++)<span class="_ _e"> </span>{</span></div><div class="t m5 x24 h2d y5df4 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _70"> </span><span class="ffd fs1e fc2">s<span class="_ _e"> </span>+=<span class="_ _1f"> </span>a[i];</span></div><div class="t m5 x24 h2d y5df5 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x24 h2e y5df6 ff6 fs20 fc6 sc0 ls0 ws0">8</div><div class="t m5 x195 h2d y5df7 ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>s;</div><div class="t m5 x24 h2d y5df8 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x174 h2c y5df9 ffa fs16 fc2 sc0 ls0 ws0">code/link/sum.c</div><div class="t m5 x17 h34 y5dfa ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _13"> </span>7.1<span class="_ _c"> </span><span class="fc1">Example<span class="_"> </span>program<span class="_ _13"> </span>1.<span class="_"> </span><span class="ff6">The<span class="_ _13"> </span>example<span class="_ _13"> </span>program<span class="_ _10"> </span>consists<span class="_ _10"> </span>of<span class="_ _13"> </span>two<span class="_ _10"> </span>sour<span class="_ _0"></span>ce<span class="_ _13"> </span>ﬁles,</span></span></div><div class="t m5 x164 h3a y5dfb ffd fs19 fc1 sc0 ls0 ws0">main.c<span class="_ _13"> </span><span class="ff6 fs16">and<span class="_ _10"> </span></span>sum.c<span class="ff6 fs16">.<span class="_ _10"> </span>The</span></div><div class="t m5 x17 h3a y46b0 ffd fs19 fc1 sc0 ls0 ws0">main<span class="_ _10"> </span><span class="ff6 fs16">function<span class="_ _11"> </span>initializes<span class="_ _10"> </span>an<span class="_ _10"> </span>array<span class="_ _11"> </span>of<span class="_ _10"> </span></span>int<span class="ff6 fs16">s,<span class="_ _11"> </span>and<span class="_ _10"> </span>then<span class="_ _11"> </span>calls<span class="_ _10"> </span>the<span class="_ _10"> </span></span>sum<span class="_ _11"> </span><span class="ff6 fs16">function<span class="_ _10"> </span>to<span class="_ _11"> </span>sum<span class="_ _10"> </span>the<span class="_ _10"> </span>array<span class="_ _11"> </span>elements.</span></div><div class="t m5 x26 h26 y5dfc ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _15"> </span>chapter<span class="_ _14"> </span>provides<span class="_ _15"> </span>a<span class="_ _14"> </span>thorough<span class="_ _14"> </span>discussion<span class="_ _15"> </span>of<span class="_ _14"> </span>all<span class="_ _15"> </span>aspects<span class="_ _14"> </span>of<span class="_ _15"> </span>linking,<span class="_ _14"> </span>from</div><div class="t m5 x17 h26 y5dfd ff7 fs19 fc1 sc0 ls0 ws0">traditional<span class="_ _f"> </span>static<span class="_ _e"> </span>linking<span class="_ _0"></span>,<span class="_ _e"> </span>to<span class="_ _e"> </span>dynamic<span class="_ _f"> </span>linking<span class="_ _e"> </span>of<span class="_ _f"> </span>shared<span class="_ _e"> </span>libraries<span class="_ _21"> </span>at<span class="_ _e"> </span>load<span class="_ _f"> </span>time,</div><div class="t m5 x17 h26 y5dfe ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _21"> </span>dynamic<span class="_ _21"> </span>linking<span class="_ _21"> </span>of<span class="_ _21"> </span>shared<span class="_ _f"> </span>libraries<span class="_ _21"> </span>at<span class="_ _21"> </span>run<span class="_ _21"> </span>time.<span class="_ _15"> </span>W<span class="_ _3"></span>e<span class="_ _f"> </span>will<span class="_ _21"> </span>describe<span class="_ _21"> </span>the<span class="_ _21"> </span>basic</div><div class="t m5 x17 h26 y5dff ff7 fs19 fc1 sc0 ls0 ws0">mechanisms<span class="_ _11"> </span>using<span class="_ _11"> </span>real<span class="_ _11"> </span>examples<span class="_ _1"></span>,<span class="_ _11"> </span>and<span class="_ _11"> </span>we<span class="_ _11"> </span>will<span class="_ _11"> </span>identify<span class="_ _11"> </span>situations<span class="_ _11"> </span>in<span class="_ _11"> </span>which<span class="_ _11"> </span>linking</div><div class="t m5 x17 h26 y5e00 ff7 fs19 fc1 sc0 ls0 ws0">issues<span class="_ _6"> </span>can<span class="_ _6"> </span>affect<span class="_ _6"> </span>the<span class="_ _6"> </span>performance<span class="_ _6"> </span>and<span class="_ _13"> </span>correctness<span class="_ _a"> </span>of<span class="_ _6"> </span>your<span class="_ _6"> </span>programs<span class="_ _1"></span>.<span class="_ _6"> </span>T<span class="_ _3"></span>o<span class="_ _6"> </span>keep<span class="_ _6"> </span>things</div><div class="t m5 x17 h26 y5e01 ff7 fs19 fc1 sc0 ls0 ws0">concrete<span class="_ _6"> </span>and<span class="_ _6"> </span>understandable,<span class="_ _6"> </span>we<span class="_ _6"> </span>will<span class="_ _6"> </span>couch<span class="_ _13"> </span>our<span class="_ _a"> </span>discussion<span class="_ _6"> </span>in<span class="_ _13"> </span>the<span class="_ _a"> </span>context<span class="_ _6"> </span>of<span class="_ _13"> </span>an<span class="_ _a"> </span>x86-</div><div class="t m5 x17 h26 y5e02 ff7 fs19 fc1 sc0 ls0 ws0">64<span class="_"> </span>system<span class="_ _13"> </span>running<span class="_"> </span>Linux<span class="_"> </span>and<span class="_ _13"> </span>using<span class="_"> </span>the<span class="_"> </span>standard<span class="_ _13"> </span>ELF-64<span class="_"> </span>(hereafter<span class="_"> </span>referred<span class="_ _13"> </span>to<span class="_"> </span>as</div><div class="t m5 x17 h26 y5e03 ff7 fs19 fc1 sc0 ls0 ws0">ELF)<span class="_ _13"> </span>object<span class="_ _13"> </span>ﬁle<span class="_ _13"> </span>format.<span class="_ _13"> </span>However<span class="_ _1"></span>,<span class="_ _13"> </span>it<span class="_ _13"> </span>is<span class="_ _13"> </span>important<span class="_ _13"> </span>to<span class="_ _13"> </span>realize<span class="_ _13"> </span>that<span class="_ _13"> </span>the<span class="_ _13"> </span>basic<span class="_ _6"> </span>concepts</div><div class="t m5 x17 h26 y5e04 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_ _13"> </span>linking<span class="_"> </span>are<span class="_ _13"> </span>universal,<span class="_"> </span>regardless<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>operating<span class="_ _13"> </span>system,<span class="_"> </span>the<span class="_ _13"> </span>ISA,<span class="_"> </span>or<span class="_ _13"> </span>the<span class="_ _13"> </span>object</div><div class="t m5 x17 h26 y5e05 ff7 fs19 fc1 sc0 ls0 ws0">ﬁle<span class="_"> </span>format.<span class="_"> </span>Details<span class="_"> </span>may<span class="_"> </span>vary<span class="_ _3"></span>,<span class="_"> </span>but<span class="_"> </span>the<span class="_"> </span>concepts<span class="_"> </span>are<span class="_"> </span>the<span class="_"> </span>same<span class="_ _1"></span>.</div><div class="t m5 x17 h3b y5e06 fff fs24 fc6 sc0 ls0 ws0">7.1<span class="_ _17"> </span><span class="ffe fs18">Compiler<span class="_"> </span>Drivers</span></div><div class="t m5 x17 h26 y5e07 ff7 fs19 fc1 sc0 ls0 ws0">Consider<span class="_ _11"> </span>the<span class="_ _16"> </span>C<span class="_ _11"> </span>program<span class="_ _11"> </span>in<span class="_ _11"> </span>Figure<span class="_ _11"> </span>7.1.<span class="_ _11"> </span>It<span class="_ _16"> </span>will<span class="_ _11"> </span>serve<span class="_ _11"> </span>as<span class="_ _11"> </span>a<span class="_ _16"> </span>simple<span class="_ _11"> </span>running<span class="_ _11"> </span>example</div><div class="t m5 x17 h26 y5e08 ff7 fs19 fc1 sc0 ls0 ws0">throughout<span class="_ _11"> </span>this<span class="_ _11"> </span>chapter<span class="_ _16"> </span>that<span class="_ _11"> </span>will<span class="_ _11"> </span>allow<span class="_ _16"> </span>us<span class="_ _11"> </span>to<span class="_ _11"> </span>make<span class="_ _16"> </span>some<span class="_ _11"> </span>important<span class="_ _11"> </span>points<span class="_ _11"> </span>about</div><div class="t m5 x17 h26 y5e09 ff7 fs19 fc1 sc0 ls0 ws0">how<span class="_"> </span>linkers<span class="_"> </span>work.</div><div class="t m5 x26 h26 y5e0a ff7 fs19 fc1 sc0 ls0 ws0">Most<span class="_ _6"> </span>compilation<span class="_ _13"> </span>systems<span class="_ _6"> </span>provide<span class="_ _13"> </span>a<span class="_ _6"> </span><span class="ffa">compiler<span class="_ _13"> </span>driver<span class="_ _13"> </span></span>that<span class="_ _6"> </span>invokes<span class="_ _13"> </span>the<span class="_ _6"> </span>language</div><div class="t m5 x17 h26 y5e0b ff7 fs19 fc1 sc0 ls0 ws0">preprocessor,<span class="_ _6"> </span>compiler,<span class="_ _13"> </span>assembler,<span class="_ _6"> </span>and<span class="_ _13"> </span>linker,<span class="_ _6"> </span>as<span class="_ _13"> </span>needed<span class="_ _6"> </span>on<span class="_ _13"> </span>behalf<span class="_ _13"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>user<span class="_ _1"></span>.<span class="_ _13"> </span>F<span class="_ _1"></span>or</div><div class="t m5 x17 h26 y5e0c ff7 fs19 fc1 sc0 ls0 ws0">example<span class="_ _1"></span>,<span class="_ _16"> </span>to<span class="_ _16"> </span>build<span class="_ _16"> </span>the<span class="_ _11"> </span>example<span class="_ _16"> </span>program<span class="_ _16"> </span>using<span class="_ _11"> </span>the<span class="_ _16"> </span>GNU<span class="_ _11"> </span>compilation<span class="_ _16"> </span>system,<span class="_ _16"> </span>we</div><div class="t m5 x17 h26 y5e0d ff7 fs19 fc1 sc0 ls0 ws0">might<span class="_"> </span>invoke<span class="_"> </span>the<span class="_"> </span><span class="ff9">gcc<span class="_ _10"> </span></span>driver<span class="_"> </span>by<span class="_"> </span>typing<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>command<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>shell:</div><div class="t m5 x17 h2d y5e0e ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">gcc<span class="_ _1f"> </span>-Og<span class="_ _1f"> </span>-o<span class="_ _e"> </span>prog<span class="_ _1f"> </span>main.c<span class="_ _e"> </span>sum.c</span></div><div class="t m5 x17 h26 y5e0f ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _21"> </span>7.2<span class="_ _21"> </span>summarizes<span class="_ _21"> </span>the<span class="_ _f"> </span>activities<span class="_ _21"> </span>of<span class="_ _21"> </span>the<span class="_ _21"> </span>driver<span class="_ _21"> </span>as<span class="_ _21"> </span>it<span class="_ _21"> </span>translates<span class="_ _21"> </span>the<span class="_ _21"> </span>example</div><div class="t m5 x17 h26 y5e10 ff7 fs19 fc2 sc0 ls0 ws0">program<span class="_ _16"> </span>from<span class="_ _14"> </span>an<span class="_ _14"> </span>ASCII<span class="_ _16"> </span>source<span class="_ _14"> </span>ﬁle<span class="_ _14"> </span>into<span class="_ _16"> </span>an<span class="_ _14"> </span>executable<span class="_ _14"> </span>object<span class="_ _16"> </span>ﬁle.<span class="_ _16"> </span>(If<span class="_ _16"> </span>you<span class="_ _14"> </span>want</div><div class="t m5 x17 h26 y5e11 ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_ _11"> </span>see<span class="_ _16"> </span>these<span class="_ _11"> </span>steps<span class="_ _11"> </span>for<span class="_ _16"> </span>yourself<span class="_ _1"></span>,<span class="_ _16"> </span>run<span class="_ _11"> </span><span class="ff9">gcc<span class="_ _16"> </span></span>with<span class="_ _11"> </span>the<span class="_ _11"> </span><span class="ffd">-v<span class="_ _16"> </span></span>option.)<span class="_ _11"> </span>T<span class="_ _0"></span>he<span class="_ _11"> </span>driver<span class="_ _16"> </span>ﬁrst<span class="_ _11"> </span>runs</div><div class="t m5 x17 h26 y5e12 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _13"> </span>C<span class="_ _6"> </span>preprocessor<span class="_ _13"> </span>(<span class="ffd">cpp</span>),</div><div class="t m5 x4d h3c y5e13 ff7 fs25 fc2 sc0 ls0 ws0">1</div><div class="t m5 x15e h26 y5e14 ff7 fs19 fc2 sc0 ls0 ws0">which<span class="_ _13"> </span>translates<span class="_ _6"> </span>the<span class="_ _13"> </span>C<span class="_ _6"> </span>source<span class="_ _13"> </span>ﬁle<span class="_ _6"> </span><span class="ffd">main.c<span class="_ _13"> </span></span>into<span class="_ _6"> </span>an<span class="_ _13"> </span>ASCII</div><div class="t m5 x17 h26 y5e15 ff7 fs19 fc2 sc0 ls0 ws0">intermediate<span class="_"> </span>ﬁle<span class="_"> </span><span class="ffd">main.i</span>:</div><div class="t m5 x17 h1d y2dcb ff7 fs17 fc2 sc0 ls0 ws0">1.<span class="_"> </span>In<span class="_"> </span>some<span class="_"> </span>versions<span class="_"> </span>of<span class="_"> </span><span class="ff9">gcc</span>,<span class="_"> </span>the<span class="_"> </span>preprocessor<span class="_"> </span>is<span class="_"> </span>integrated<span class="_"> </span>into<span class="_"> </span>the<span class="_"> </span>compiler<span class="_"> </span>driver.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
