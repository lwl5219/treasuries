<div id="pf289" class="pf w2 h11" data-page-no="289"><div class="pc pc289 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg289.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">648<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>6<span class="_ _3d"> </span>The<span class="_ _10"> </span>Memory<span class="_ _10"> </span>Hierarchy</span></div><div class="t m5 x1d h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _16"> </span>6.22,<span class="_"> </span>the<span class="_ _16"> </span>cache<span class="_"> </span>at<span class="_ _16"> </span>level<span class="_"> </span><span class="ff11">k<span class="_"> </span></span>has<span class="_ _11"> </span>room<span class="_ _11"> </span>for<span class="_ _11"> </span>four<span class="_ _11"> </span>blocks<span class="_ _16"> </span>and<span class="_"> </span>currently<span class="_ _16"> </span>contains</div><div class="t m5 x1d h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">copies<span class="_"> </span>of<span class="_"> </span>blocks<span class="_"> </span>4,<span class="_"> </span>9,<span class="_"> </span>14,<span class="_"> </span>and<span class="_"> </span>3.</div><div class="t m5 x29 h46 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">Data<span class="_ _15"> </span>are<span class="_ _15"> </span>always<span class="_ _15"> </span>copied<span class="_ _15"> </span>back<span class="_ _15"> </span>and<span class="_ _15"> </span>forth<span class="_ _15"> </span>between<span class="_ _15"> </span>level<span class="_ _15"> </span><span class="ff11">k<span class="_ _f"> </span></span>and<span class="_ _15"> </span>level<span class="_ _15"> </span><span class="ff11">k<span class="_ _11"> </span><span class="ff12">+<span class="_ _10"> </span></span></span><span class="ls237">1i<span class="_ _42"></span>n</span></div><div class="t m5 x1d h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">block-size<span class="_"> </span><span class="ffa">transfer<span class="_ _13"> </span>units</span>.<span class="_"> </span>It<span class="_ _13"> </span>is<span class="_"> </span>important<span class="_ _13"> </span>to<span class="_"> </span>realize<span class="_ _13"> </span>that<span class="_"> </span>while<span class="_ _13"> </span>the<span class="_"> </span>block<span class="_ _13"> </span>size<span class="_"> </span>is<span class="_ _13"> </span>ﬁxed</div><div class="t m5 x1d h26 y2f8 ff7 fs19 fc2 sc0 ls0 ws0">between<span class="_ _13"> </span>any<span class="_ _6"> </span>particular<span class="_ _13"> </span>pair<span class="_ _6"> </span>of<span class="_ _13"> </span>adjacent<span class="_ _13"> </span>levels<span class="_ _6"> </span>in<span class="_ _13"> </span>the<span class="_ _6"> </span>hierarchy<span class="_ _3"></span>,<span class="_ _13"> </span>other<span class="_ _13"> </span>pairs<span class="_ _6"> </span>of<span class="_ _13"> </span>levels</div><div class="t m5 x1d h26 y2f9 ff7 fs19 fc2 sc0 ls0 ws0">can<span class="_"> </span>have<span class="_ _11"> </span>different<span class="_ _11"> </span>block<span class="_ _11"> </span>sizes<span class="_ _1"></span>.<span class="_ _11"> </span>F<span class="_ _1"></span>or<span class="_ _11"> </span>example<span class="_ _1"></span>,<span class="_ _11"> </span>in<span class="_ _11"> </span>Figure<span class="_"> </span>6.21,<span class="_ _11"> </span>transfers<span class="_"> </span>between<span class="_ _11"> </span>L1</div><div class="t m5 x1d h26 y2fa ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_"> </span>L0<span class="_"> </span>typically<span class="_ _11"> </span>use<span class="_"> </span>word-size<span class="_"> </span>blocks<span class="_ _1"></span>.<span class="_ _11"> </span>T<span class="_ _7"></span>ransfers<span class="_"> </span>between<span class="_ _11"> </span>L2<span class="_"> </span>and<span class="_"> </span>L1<span class="_ _11"> </span>(and<span class="_"> </span>L3<span class="_"> </span>and</div><div class="t m5 x1d h26 y2fb ff7 fs19 fc2 sc0 ls0 ws0">L2,<span class="_ _13"> </span>and<span class="_ _13"> </span>L4<span class="_ _13"> </span>and<span class="_ _13"> </span>L3)<span class="_ _13"> </span>typically<span class="_ _13"> </span>use<span class="_ _13"> </span>blocks<span class="_ _13"> </span>of<span class="_ _6"> </span>tens<span class="_ _13"> </span>of<span class="_ _13"> </span>bytes<span class="_ _1"></span>.<span class="_ _13"> </span>And<span class="_ _13"> </span>transfers<span class="_ _13"> </span>between<span class="_ _13"> </span>L5</div><div class="t m5 x1d h26 y2fc ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_"> </span>L4<span class="_"> </span>use<span class="_ _13"> </span>blocks<span class="_"> </span>with<span class="_"> </span>hundreds<span class="_"> </span>or<span class="_"> </span>thousands<span class="_ _13"> </span>of<span class="_"> </span>bytes<span class="_ _1"></span>.<span class="_"> </span>In<span class="_"> </span>general,<span class="_"> </span>devices<span class="_"> </span>lower</div><div class="t m5 x1d h26 y2fd ff7 fs19 fc2 sc0 ls0 ws0">in<span class="_"> </span>the<span class="_ _11"> </span>hierarchy<span class="_ _11"> </span>(further<span class="_ _11"> </span>from<span class="_ _11"> </span>the<span class="_ _11"> </span>CPU)<span class="_"> </span>have<span class="_ _11"> </span>longer<span class="_ _11"> </span>access<span class="_ _11"> </span>times<span class="_ _1"></span>,<span class="_ _11"> </span>and<span class="_ _11"> </span>thus<span class="_ _11"> </span>tend</div><div class="t m5 x1d h26 y2fe ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_"> </span>use<span class="_"> </span>larger<span class="_"> </span>block<span class="_"> </span>sizes<span class="_"> </span>in<span class="_"> </span>order<span class="_"> </span>to<span class="_"> </span>amortize<span class="_"> </span>these<span class="_"> </span>longer<span class="_"> </span>access<span class="_"> </span>times<span class="_ _1"></span>.</div><div class="t m5 x1d h42 y906 ff6 fs29 fc6 sc0 ls0 ws0">Cache<span class="_ _11"> </span>Hits</div><div class="t m5 x1d h46 y4b43 ff7 fs19 fc1 sc0 ls0 ws0">When<span class="_ _11"> </span>a<span class="_ _16"> </span>program<span class="_ _16"> </span>needs<span class="_ _16"> </span>a<span class="_ _16"> </span>particular<span class="_ _16"> </span>data<span class="_ _16"> </span>object<span class="_ _16"> </span><span class="ff11">d<span class="_ _15"> </span></span>from<span class="_ _16"> </span>level<span class="_ _16"> </span><span class="ff11">k<span class="_ _11"> </span><span class="ff12">+<span class="_ _10"> </span></span></span>1<span class="_ _1"></span>,<span class="_ _16"> </span>it<span class="_ _16"> </span>ﬁrst<span class="_ _16"> </span>looks</div><div class="t m5 x1d h26 y565c ff7 fs19 fc1 sc0 ls0 ws0">for<span class="_ _16"> </span><span class="ff11">d<span class="_ _15"> </span></span>in<span class="_ _16"> </span>one<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span>blocks<span class="_ _16"> </span>currently<span class="_ _16"> </span>stored<span class="_ _16"> </span>at<span class="_ _16"> </span>level<span class="_ _16"> </span><span class="ff11">k<span class="_ _2"></span></span><span class="ls197">.I<span class="_ _49"></span>f<span class="ff11 ls0">d<span class="_ _14"> </span><span class="ff7">happens<span class="_ _16"> </span>to<span class="_ _16"> </span>be<span class="_ _16"> </span>cached</span></span></span></div><div class="t m5 x1d h26 y565d ff7 fs19 fc1 sc0 ls0 ws0">at<span class="_ _11"> </span>level<span class="_ _16"> </span><span class="ff11">k<span class="_ _2"></span></span>,<span class="_ _16"> </span>then<span class="_ _11"> </span>we<span class="_ _11"> </span>have<span class="_ _16"> </span>what<span class="_ _11"> </span>is<span class="_ _16"> </span>called<span class="_ _11"> </span>a<span class="_ _16"> </span><span class="ffa">cache<span class="_ _11"> </span>hit<span class="_ _2"></span></span>.<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span>program<span class="_ _11"> </span>reads<span class="_ _16"> </span><span class="ff11">d<span class="_"> </span></span>directly</div><div class="t m5 x1d h26 y565e ff7 fs19 fc1 sc0 ls0 ws0">from<span class="_"> </span>level<span class="_ _11"> </span><span class="ff11">k<span class="_ _2"></span></span>,<span class="_"> </span>which<span class="_ _11"> </span>by<span class="_ _11"> </span>the<span class="_"> </span>nature<span class="_ _11"> </span>of<span class="_"> </span>the<span class="_ _11"> </span>memory<span class="_"> </span>hierarchy<span class="_ _11"> </span>is<span class="_"> </span>faster<span class="_ _11"> </span>than<span class="_ _11"> </span>reading</div><div class="t m5 x1d h46 y565f ff11 fs19 fc1 sc0 ls0 ws0">d<span class="_ _10"> </span><span class="ff7">from<span class="_ _13"> </span>level<span class="_ _13"> </span></span>k<span class="_ _10"> </span><span class="ff12">+<span class="_ _13"></span><span class="ff7">1<span class="_ _1"></span>.<span class="_ _13"> </span>F<span class="_ _3"></span>or<span class="_ _13"> </span>example,<span class="_ _6"> </span>a<span class="_ _13"> </span>program<span class="_ _13"> </span>with<span class="_ _13"> </span>good<span class="_ _6"> </span>temporal<span class="_ _13"> </span>locality<span class="_ _13"> </span>might<span class="_ _13"> </span>read</span></span></div><div class="t m5 x1d h26 y5660 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_"> </span>data<span class="_"> </span>object<span class="_"> </span>from<span class="_"> </span>block<span class="_"> </span>14,<span class="_"> </span>resulting<span class="_"> </span>in<span class="_"> </span>a<span class="_"> </span>cache<span class="_"> </span>hit<span class="_"> </span>from<span class="_"> </span>level<span class="_"> </span><span class="ff11">k<span class="_ _2"></span></span>.</div><div class="t m5 x1d h42 y2b5c ff6 fs29 fc6 sc0 ls0 ws0">Cache<span class="_ _11"> </span>Misses</div><div class="t m5 x1d h26 y30b5 ff7 fs19 fc1 sc0 ls0 ws0">If<span class="_ _1"></span>,<span class="_"> </span>on<span class="_ _13"> </span>the<span class="_"> </span>other<span class="_ _13"> </span>hand,<span class="_"> </span>the<span class="_ _13"> </span>data<span class="_ _13"> </span>object<span class="_"> </span><span class="ff11">d<span class="_ _11"> </span></span>is<span class="_"> </span>not<span class="_ _13"> </span>cached<span class="_"> </span>at<span class="_ _13"> </span>level<span class="_"> </span><span class="ff11">k</span>,<span class="_"> </span>then<span class="_ _13"> </span>we<span class="_"> </span>have<span class="_ _13"> </span>what</div><div class="t m5 x1d h26 y5661 ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_"> </span>called<span class="_"> </span>a<span class="_"> </span><span class="ffa">cache<span class="_"> </span>miss</span>.<span class="_ _11"> </span>When<span class="_"> </span>there<span class="_"> </span>is<span class="_"> </span>a<span class="_"> </span>miss<span class="_ _1"></span>,<span class="_"> </span>the<span class="_ _11"> </span>cache<span class="_"> </span>at<span class="_"> </span>level<span class="_ _11"> </span><span class="ff11">k<span class="_ _11"> </span></span>fetches<span class="_ _11"> </span>the<span class="_"> </span>block</div><div class="t m5 x1d h46 y5662 ff7 fs19 fc1 sc0 ls0 ws0">containing<span class="_"> </span><span class="ff11">d<span class="_"> </span></span>from<span class="_"> </span>the<span class="_ _11"> </span>cache<span class="_"> </span>at<span class="_ _11"> </span>level<span class="_"> </span><span class="ff11">k<span class="_ _11"> </span><span class="ff12">+<span class="_ _13"></span></span></span>1<span class="_ _0"></span>,<span class="_"> </span>possibly<span class="_"> </span>overwriting<span class="_ _11"> </span>an<span class="_"> </span>existing<span class="_"> </span>block</div><div class="t m5 x1d h26 y5663 ff7 fs19 fc1 sc0 ls0 ws0">if<span class="_"> </span>the<span class="_"> </span>level<span class="_"> </span><span class="ff11">k<span class="_ _11"> </span></span>cache<span class="_"> </span>is<span class="_"> </span>already<span class="_"> </span>full.</div><div class="t m5 x29 h26 y5664 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>process<span class="_ _13"> </span>of<span class="_ _13"> </span>overwriting<span class="_ _13"> </span>an<span class="_"> </span>existing<span class="_ _13"> </span>block<span class="_ _13"> </span>is<span class="_ _13"> </span>known<span class="_"> </span>as<span class="_ _13"> </span><span class="ffa">replacing<span class="_"> </span></span>or<span class="_ _13"> </span><span class="ffa">evicting</span></div><div class="t m5 x1d h26 y5665 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _14"> </span>block.<span class="_ _14"> </span>T<span class="_ _1"></span>he<span class="_ _14"> </span>block<span class="_ _14"> </span>that<span class="_ _14"> </span>is<span class="_ _14"> </span>evicted<span class="_ _14"> </span>is<span class="_ _14"> </span>sometimes<span class="_ _14"> </span>referred<span class="_ _14"> </span>to<span class="_ _14"> </span>as<span class="_ _14"> </span>a<span class="_ _14"> </span><span class="ffa">victim<span class="_ _14"> </span>block</span>.</div><div class="t m5 x1d h26 y5666 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>decision<span class="_ _13"> </span>about<span class="_"> </span>which<span class="_ _13"> </span>block<span class="_ _13"> </span>to<span class="_"> </span>replace<span class="_ _13"> </span>is<span class="_ _13"> </span>governed<span class="_"> </span>by<span class="_ _13"> </span>the<span class="_"> </span>cache’<span class="_ _1"></span>s<span class="_"> </span><span class="ffa">replacement</span></div><div class="t m5 x1d h26 y5667 ffa fs19 fc1 sc0 ls0 ws0">policy<span class="ff7">.<span class="_ _16"> </span>F<span class="_ _1"></span>or<span class="_ _16"> </span>example<span class="_ _0"></span>,<span class="_ _14"> </span>a<span class="_ _16"> </span>cache<span class="_ _16"> </span>with<span class="_ _14"> </span>a<span class="_ _16"> </span><span class="ffa">random<span class="_ _16"> </span>replacement<span class="_ _16"> </span>policy<span class="_ _16"> </span></span>would<span class="_ _14"> </span>choose<span class="_ _16"> </span>a</span></div><div class="t m5 x1d h26 y5668 ff7 fs19 fc1 sc0 ls0 ws0">random<span class="_ _13"> </span>victim<span class="_ _13"> </span>block.<span class="_ _13"> </span>A<span class="_ _13"> </span>cache<span class="_ _13"> </span>with<span class="_ _13"> </span>a<span class="_ _13"> </span><span class="ffa">least<span class="_ _13"> </span>recently<span class="_ _6"> </span>used<span class="_ _13"> </span>(LRU)<span class="_ _a"> </span></span>replacement<span class="_ _13"> </span>policy</div><div class="t m5 x1d h26 y5669 ff7 fs19 fc1 sc0 ls0 ws0">would<span class="_"> </span>choose<span class="_"> </span>the<span class="_"> </span>block<span class="_"> </span>that<span class="_"> </span>was<span class="_"> </span>last<span class="_"> </span>accessed<span class="_"> </span>the<span class="_"> </span>furthest<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>past.</div><div class="t m5 x29 h46 y566a ff7 fs19 fc1 sc0 ls0 ws0">After<span class="_"> </span>the<span class="_ _13"> </span>cache<span class="_"> </span>at<span class="_ _13"> </span>level<span class="_"> </span><span class="ff11">k<span class="_ _11"> </span></span>has<span class="_"> </span>fetched<span class="_ _13"> </span>the<span class="_"> </span>block<span class="_ _13"> </span>from<span class="_"> </span>level<span class="_"> </span><span class="ff11">k<span class="_ _10"> </span><span class="ff12">+<span class="_ _13"></span></span></span>1<span class="_ _1"></span>,<span class="_"> </span>the<span class="_"> </span>program</div><div class="t m5 x1d h26 y566b ff7 fs19 fc1 sc0 ls0 ws0">can<span class="_ _6"> </span>read<span class="_ _13"> </span><span class="ff11">d<span class="_ _10"> </span></span>from<span class="_ _13"> </span>level<span class="_ _6"> </span><span class="ff11">k<span class="_ _13"> </span></span>as<span class="_ _13"> </span>before<span class="_ _1"></span>.<span class="_ _13"> </span>F<span class="_ _3"></span>or<span class="_ _13"> </span>example<span class="_ _1"></span>,<span class="_ _13"> </span>in<span class="_ _13"> </span>F<span class="_ _1"></span>igure<span class="_ _13"> </span>6.22,<span class="_ _6"> </span>reading<span class="_ _13"> </span>a<span class="_ _6"> </span>data<span class="_ _13"> </span>object</div><div class="t m5 x1d h26 y566c ff7 fs19 fc1 sc0 ls0 ws0">from<span class="_ _13"> </span>block<span class="_"> </span>12<span class="_ _13"> </span>in<span class="_"> </span>the<span class="_ _13"> </span>level<span class="_"> </span><span class="ff11">k<span class="_ _10"> </span></span>cache<span class="_"> </span>would<span class="_ _13"> </span>result<span class="_"> </span>in<span class="_ _13"> </span>a<span class="_ _13"> </span>cache<span class="_"> </span>miss<span class="_ _13"> </span>because<span class="_"> </span>block<span class="_ _13"> </span>12<span class="_"> </span>is</div><div class="t m5 x1d h46 y566d ff7 fs19 fc1 sc0 ls0 ws0">not<span class="_"> </span>currently<span class="_ _13"> </span>stored<span class="_"> </span>in<span class="_"> </span>the<span class="_ _13"> </span>level<span class="_"> </span><span class="ff11">k<span class="_ _11"> </span></span>cache<span class="_ _0"></span>.<span class="_"> </span>Once<span class="_ _13"> </span>it<span class="_"> </span>has<span class="_"> </span>been<span class="_ _13"> </span>copied<span class="_"> </span>from<span class="_"> </span>level<span class="_ _13"> </span><span class="ff11">k<span class="_ _11"> </span><span class="ff12">+<span class="_ _13"> </span></span></span>1</div><div class="t m5 x1d h26 y566e ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_"> </span>level<span class="_"> </span><span class="ff11">k<span class="_ _2"></span></span>,<span class="_"> </span>block<span class="_"> </span>12<span class="_"> </span>will<span class="_"> </span>remain<span class="_"> </span>there<span class="_"> </span>in<span class="_"> </span>expectation<span class="_"> </span>of<span class="_"> </span>later<span class="_"> </span>accesses<span class="_ _1"></span>.</div><div class="t m5 x1d h42 y278 ff6 fs29 fc6 sc0 ls0 ws0">Kinds<span class="_ _11"> </span>of<span class="_ _16"> </span>Cache<span class="_ _16"> </span>Misses</div><div class="t m5 x1d h26 y464c ff7 fs19 fc1 sc0 ls0 ws0">It<span class="_ _11"> </span>is<span class="_ _11"> </span>sometimes<span class="_ _11"> </span>helpful<span class="_ _11"> </span>to<span class="_ _11"> </span>distinguish<span class="_ _16"> </span>between<span class="_"> </span>different<span class="_ _11"> </span>kinds<span class="_ _16"> </span>of<span class="_"> </span>cache<span class="_ _16"> </span>misses<span class="_ _3"></span>.<span class="_ _11"> </span>If</div><div class="t m5 x1d h26 y566f ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _14"> </span>cache<span class="_ _15"> </span>at<span class="_ _14"> </span>level<span class="_ _15"> </span><span class="ff11">k<span class="_ _21"> </span></span>is<span class="_ _15"> </span>empty<span class="_ _3"></span>,<span class="_ _15"> </span>then<span class="_ _15"> </span>any<span class="_ _14"> </span>access<span class="_ _15"> </span>of<span class="_ _14"> </span>any<span class="_ _15"> </span>data<span class="_ _14"> </span>object<span class="_ _15"> </span>will<span class="_ _15"> </span>miss<span class="_ _1"></span>.<span class="_ _14"> </span>An</div><div class="t m5 x1d h26 y5670 ff7 fs19 fc1 sc0 ls0 ws0">empty<span class="_"> </span>cache<span class="_"> </span>is<span class="_ _11"> </span>sometimes<span class="_"> </span>referred<span class="_"> </span>to<span class="_ _11"> </span>as<span class="_"> </span>a<span class="_"> </span><span class="ffa">cold<span class="_ _11"> </span>cache</span>,<span class="_"> </span>and<span class="_"> </span>misses<span class="_"> </span>of<span class="_ _11"> </span>this<span class="_"> </span>kind<span class="_"> </span>are</div><div class="t m5 x1d h26 y5671 ff7 fs19 fc1 sc0 ls0 ws0">called<span class="_"> </span><span class="ffa">compulsory<span class="_"> </span>misses<span class="_"> </span></span>or<span class="_"> </span><span class="ffa">cold<span class="_"> </span>misses</span>.<span class="_"> </span>Cold<span class="_"> </span>misses<span class="_"> </span>are<span class="_"> </span>important<span class="_"> </span>because<span class="_"> </span>they</div><div class="t m5 x1d h26 y5672 ff7 fs19 fc1 sc0 ls0 ws0">are<span class="_"> </span>often<span class="_ _13"> </span>transient<span class="_"> </span>events<span class="_"> </span>that<span class="_ _13"> </span>might<span class="_"> </span>not<span class="_ _13"> </span>occur<span class="_"> </span>in<span class="_"> </span>steady<span class="_ _13"> </span>state,<span class="_ _13"> </span>after<span class="_"> </span>the<span class="_"> </span>cache<span class="_ _13"> </span>has</div><div class="t m5 x1d h26 y5673 ff7 fs19 fc1 sc0 ls0 ws0">been<span class="_"> </span><span class="ffa">warmed<span class="_"> </span>up<span class="_ _13"> </span></span>by<span class="_"> </span>repeated<span class="_"> </span>memory<span class="_"> </span>accesses<span class="_ _0"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
