<div id="pf11b" class="pf w2 h11" data-page-no="11b"><div class="pc pc11b w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg11b.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">282<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x1d h26 y9c ff7 fs19 fc2 sc0 ls0 ws0">ordering<span class="_ _6"> </span>in<span class="_ _6"> </span>the<span class="_ _6"> </span>argument<span class="_ _6"> </span>list.<span class="_ _13"> </span>Arguments<span class="_ _a"> </span>smaller<span class="_ _6"> </span>than<span class="_ _13"> </span>64<span class="_ _a"> </span>bits<span class="_ _6"> </span>can<span class="_ _13"> </span>be<span class="_ _a"> </span>accessed<span class="_ _6"> </span>using</div><div class="t m5 x1d h26 y409 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _13"> </span>appropriate<span class="_ _6"> </span>subsection<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _6"> </span>64-bit<span class="_ _13"> </span>register.<span class="_ _6"> </span>F<span class="_ _0"></span>or<span class="_ _13"> </span>example<span class="_ _1"></span>,<span class="_ _13"> </span>if<span class="_ _13"> </span>the<span class="_ _6"> </span>ﬁrst<span class="_ _13"> </span>argument</div><div class="t m5 x1d h26 y40a ff7 fs19 fc2 sc0 ls0 ws0">is<span class="_"> </span>32<span class="_"> </span>bits<span class="_ _1"></span>,<span class="_"> </span>it<span class="_"> </span>can<span class="_"> </span>be<span class="_"> </span>accessed<span class="_"> </span>as<span class="_"> </span><span class="ffd">%edi</span>.</div><div class="t m5 x29 h26 y40b ff7 fs19 fc2 sc0 ls0 ws0">When<span class="_ _16"> </span>a<span class="_ _15"> </span>function<span class="_ _14"> </span>has<span class="_ _14"> </span>more<span class="_ _14"> </span>than<span class="_ _15"> </span>six<span class="_ _14"> </span>integral<span class="_ _14"> </span>arguments<span class="_ _1"></span>,<span class="_ _15"> </span>the<span class="_ _15"> </span>other<span class="_ _14"> </span>ones<span class="_ _14"> </span>are</div><div class="t m5 x1d h26 y40c ff7 fs19 fc2 sc0 ls0 ws0">passed<span class="_ _16"> </span>on<span class="_ _16"> </span>the<span class="_ _16"> </span>stack.<span class="_ _16"> </span>Assume<span class="_ _16"> </span>that<span class="_ _16"> </span>procedure<span class="_ _16"> </span><span class="ffd">P<span class="_ _16"> </span></span>calls<span class="_ _16"> </span>procedure<span class="_ _16"> </span><span class="ffd">Q<span class="_ _16"> </span></span>with<span class="_ _16"> </span><span class="ff11">n<span class="_"> </span></span>integral</div><div class="t m5 x1d h26 y40d ff7 fs19 fc2 sc0 ls0 ws0">arguments<span class="_ _1"></span>,<span class="_"> </span>such<span class="_ _11"> </span>that<span class="_"> </span><span class="ff11 ls2f">n&gt;</span><span class="ls17">6.<span class="_ _11"> </span>T<span class="_ _0"></span>hen<span class="_"> </span>the<span class="_ _11"> </span>code<span class="_"> </span>for<span class="_ _11"> </span><span class="ffd ls0">P<span class="_ _11"> </span><span class="ff7">must<span class="_"> </span>allocate<span class="_ _11"> </span>a<span class="_"> </span>stack<span class="_ _11"> </span>frame<span class="_"> </span>with</span></span></span></div><div class="t m5 x1d h26 y40e ff7 fs19 fc2 sc0 ls0 ws0">enough<span class="_"> </span>storage<span class="_ _11"> </span>for<span class="_"> </span>arguments<span class="_ _11"> </span>7<span class="_ _11"> </span>through<span class="_"> </span><span class="ff11">n</span>,<span class="_ _11"> </span>as<span class="_ _11"> </span>illustrated<span class="_ _11"> </span>in<span class="_"> </span>Figure<span class="_"> </span>3.25.<span class="_"> </span>It<span class="_ _11"> </span>copies</div><div class="t m5 x1d h26 y40f ff7 fs19 fc2 sc0 ls0 ws0">arguments<span class="_ _11"> </span>1–6<span class="_ _16"> </span>into<span class="_ _11"> </span>the<span class="_ _16"> </span>appropriate<span class="_ _11"> </span>registers<span class="_ _1"></span>,<span class="_ _16"> </span>and<span class="_ _16"> </span>it<span class="_ _11"> </span>puts<span class="_ _16"> </span>arguments<span class="_ _11"> </span>7<span class="_ _16"> </span>through<span class="_ _11"> </span><span class="ff11">n</span></div><div class="t m5 x1d h26 y410 ff7 fs19 fc2 sc0 ls0 ws0">onto<span class="_"> </span>the<span class="_ _13"> </span>stack,<span class="_"> </span>with<span class="_"> </span>argument<span class="_"> </span>7<span class="_ _13"> </span>at<span class="_"> </span>the<span class="_"> </span>top<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>stack.<span class="_"> </span>W<span class="_ _1"></span>hen<span class="_"> </span>passing<span class="_"> </span>parameters</div><div class="t m5 x1d h26 y411 ff7 fs19 fc2 sc0 ls0 ws0">on<span class="_ _15"> </span>the<span class="_ _21"> </span>stack,<span class="_ _f"> </span>all<span class="_ _21"> </span>data<span class="_ _21"> </span>sizes<span class="_ _21"> </span>are<span class="_ _15"> </span>rounded<span class="_ _21"> </span>up<span class="_ _21"> </span>to<span class="_ _21"> </span>be<span class="_ _15"> </span>multiples<span class="_ _21"> </span>of<span class="_ _21"> </span>eight.<span class="_ _21"> </span>W<span class="_ _0"></span>ith<span class="_ _15"> </span>the</div><div class="t m5 x1d h26 y412 ff7 fs19 fc2 sc0 ls0 ws0">arguments<span class="_ _11"> </span>in<span class="_ _16"> </span>place<span class="_ _1"></span>,<span class="_ _16"> </span>the<span class="_ _11"> </span>program<span class="_ _11"> </span>can<span class="_ _16"> </span>then<span class="_ _11"> </span>execute<span class="_ _11"> </span>a<span class="_ _16"> </span><span class="ffd">call<span class="_ _11"> </span></span>instruction<span class="_ _11"> </span>to<span class="_ _16"> </span>transfer</div><div class="t m5 x1d h26 y413 ff7 fs19 fc2 sc0 ls0 ws0">control<span class="_ _14"> </span>to<span class="_ _14"> </span>procedure<span class="_ _15"> </span><span class="ffd">Q</span>.<span class="_ _14"> </span>Procedure<span class="_ _15"> </span><span class="ffd">Q<span class="_ _14"> </span></span>can<span class="_ _14"> </span>access<span class="_ _15"> </span>its<span class="_ _14"> </span>arguments<span class="_ _14"> </span>via<span class="_ _15"> </span>registers<span class="_ _14"> </span>and</div><div class="t m5 x1d h26 y414 ff7 fs19 fc2 sc0 ls0 ws0">possibly<span class="_ _16"> </span>from<span class="_ _11"> </span>the<span class="_ _16"> </span>stack.<span class="_ _16"> </span>If<span class="_ _11"> </span><span class="ffd">Q</span>,<span class="_ _16"> </span>in<span class="_ _16"> </span>turn,<span class="_ _16"> </span>calls<span class="_ _16"> </span>some<span class="_ _11"> </span>function<span class="_ _16"> </span>that<span class="_ _16"> </span>has<span class="_ _16"> </span>more<span class="_ _11"> </span>than<span class="_ _16"> </span>six</div><div class="t m5 x1d h26 y415 ff7 fs19 fc2 sc0 ls0 ws0">arguments<span class="_ _1"></span>,<span class="_ _16"> </span>it<span class="_ _16"> </span>can<span class="_ _11"> </span>allocate<span class="_ _16"> </span>space<span class="_ _11"> </span>within<span class="_ _16"> </span>its<span class="_ _16"> </span>stack<span class="_ _11"> </span>frame<span class="_ _16"> </span>for<span class="_ _16"> </span>these<span class="_ _1"></span>,<span class="_ _16"> </span>as<span class="_ _16"> </span>is<span class="_ _11"> </span>illustrated</div><div class="t m5 x1d h26 y416 ff7 fs19 fc2 sc0 ls0 ws0">by<span class="_"> </span>the<span class="_"> </span>area<span class="_"> </span>labeled<span class="_"> </span>“<span class="_ _7"></span>Argument<span class="_"> </span>build<span class="_"> </span>area”<span class="_"> </span>in<span class="_"> </span>F<span class="_ _0"></span>igure<span class="_"> </span>3.25.</div><div class="t m5 x29 h26 y434 ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_ _11"> </span>an<span class="_ _16"> </span>example<span class="_ _11"> </span>of<span class="_ _11"> </span>argument<span class="_ _16"> </span>passing<span class="_ _0"></span>,<span class="_ _16"> </span>consider<span class="_ _11"> </span>the<span class="_ _11"> </span>C<span class="_ _16"> </span>function<span class="_ _11"> </span><span class="ffd">proc<span class="_ _11"> </span></span>shown<span class="_ _16"> </span>in</div><div class="t m5 x1d h26 y435 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _13"> </span>3.29(a).<span class="_ _6"> </span>This<span class="_ _6"> </span>function<span class="_ _13"> </span>has<span class="_ _6"> </span>eight<span class="_ _13"> </span>arguments<span class="_ _3"></span>,<span class="_ _13"> </span>including<span class="_ _13"> </span>integers<span class="_ _6"> </span>with<span class="_ _13"> </span>different</div><div class="t m5 x1d h26 y436 ff7 fs19 fc2 sc0 ls0 ws0">numbers<span class="_ _6"> </span>of<span class="_ _6"> </span>bytes<span class="_ _6"> </span>(8,<span class="_ _13"> </span>4,<span class="_ _6"> </span>2,<span class="_ _13"> </span>and<span class="_ _6"> </span>1),<span class="_ _13"> </span>as<span class="_ _a"> </span>well<span class="_ _6"> </span>as<span class="_ _6"> </span>different<span class="_ _13"> </span>types<span class="_ _a"> </span>of<span class="_ _6"> </span>pointers<span class="_ _1"></span>,<span class="_ _13"> </span>each<span class="_ _6"> </span>of<span class="_ _6"> </span>which</div><div class="t m5 x1d h26 y437 ff7 fs19 fc2 sc0 ls0 ws0">is<span class="_"> </span>8<span class="_"> </span>bytes<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y438 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _16"> </span>assembly<span class="_ _14"> </span>code<span class="_ _16"> </span>generated<span class="_ _16"> </span>for<span class="_ _16"> </span><span class="ffd">proc<span class="_ _16"> </span></span>is<span class="_ _16"> </span>shown<span class="_ _14"> </span>in<span class="_ _16"> </span>F<span class="_ _1"></span>igure<span class="_ _14"> </span>3.29(b).<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _14"> </span>ﬁrst</div><div class="t m5 x1d h26 y439 ff7 fs19 fc2 sc0 ls0 ws0">six<span class="_ _14"> </span>arguments<span class="_ _15"> </span>are<span class="_ _15"> </span>passed<span class="_ _15"> </span>in<span class="_ _14"> </span>registers<span class="_ _1"></span>.<span class="_ _15"> </span>The<span class="_ _14"> </span>last<span class="_ _14"> </span>two<span class="_ _15"> </span>are<span class="_ _15"> </span>passed<span class="_ _15"> </span>on<span class="_ _14"> </span>the<span class="_ _15"> </span>stack,<span class="_ _21"> </span>as</div><div class="t m5 x1d h26 y43a ff7 fs19 fc2 sc0 ls0 ws0">documented<span class="_ _16"> </span>by<span class="_ _11"> </span>the<span class="_ _16"> </span>diagram<span class="_ _16"> </span>of<span class="_ _16"> </span>F<span class="_ _1"></span>igure<span class="_ _16"> </span>3.30.<span class="_ _16"> </span>T<span class="_ _1"></span>his<span class="_ _16"> </span>diagram<span class="_ _16"> </span>shows<span class="_ _16"> </span>the<span class="_ _11"> </span>state<span class="_ _16"> </span>of<span class="_ _16"> </span>the</div><div class="t m5 x1d h26 y43b ff7 fs19 fc2 sc0 ls0 ws0">stack<span class="_ _13"> </span>during<span class="_ _13"> </span>the<span class="_ _13"> </span>execution<span class="_ _13"> </span>of<span class="_ _13"> </span><span class="ffd">proc</span>.<span class="_ _6"> </span>W<span class="_ _1"></span>e<span class="_ _13"> </span>can<span class="_ _13"> </span>see<span class="_ _13"> </span>that<span class="_ _13"> </span>the<span class="_ _13"> </span>return<span class="_ _13"> </span>address<span class="_ _13"> </span>was<span class="_ _13"> </span>pushed</div><div class="t m5 x1d h26 y43c ff7 fs19 fc2 sc0 ls0 ws0">onto<span class="_ _16"> </span>the<span class="_ _14"> </span>stack<span class="_ _16"> </span>as<span class="_ _14"> </span>part<span class="_ _16"> </span>of<span class="_ _14"> </span>the<span class="_ _16"> </span>procedure<span class="_ _14"> </span>call.<span class="_ _16"> </span>The<span class="_ _16"> </span>two<span class="_ _16"> </span>arguments<span class="_ _1"></span>,<span class="_ _15"> </span>therefore<span class="_ _1"></span>,<span class="_ _14"> </span>are</div><div class="t m5 x1d h26 y43d ff7 fs19 fc2 sc0 ls0 ws0">at<span class="_ _16"> </span>positions<span class="_ _14"> </span>8<span class="_ _14"> </span>and<span class="_ _16"> </span>16<span class="_ _14"> </span>relative<span class="_ _14"> </span>to<span class="_ _16"> </span>the<span class="_ _14"> </span>stack<span class="_ _14"> </span>pointer.<span class="_ _16"> </span>W<span class="_ _1"></span>ithin<span class="_ _14"> </span>the<span class="_ _14"> </span>code<span class="_ _1"></span>,<span class="_ _15"> </span>we<span class="_ _14"> </span>can<span class="_ _16"> </span>see</div><div class="t m5 x1d h26 y43e ff7 fs19 fc2 sc0 ls0 ws0">that<span class="_ _13"> </span>different<span class="_ _13"> </span>versions<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ff9">add<span class="_ _13"> </span></span>instruction<span class="_"> </span>are<span class="_ _13"> </span>used<span class="_ _13"> </span>according<span class="_ _13"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>sizes<span class="_ _13"> </span>of<span class="_ _13"> </span>the</div><div class="t m5 x1d h26 y43f ff7 fs19 fc2 sc0 ls0 ws0">operands:<span class="_ _13"> </span><span class="ffd">addq<span class="_ _13"> </span></span>for<span class="_ _6"> </span><span class="ffd">a1<span class="_ _13"> </span></span>(<span class="ffd">long</span>),<span class="_ _13"> </span><span class="ffd">addl<span class="_ _13"> </span></span>for<span class="_ _13"> </span><span class="ffd">a2<span class="_ _13"> </span></span>(<span class="ffd">int</span>),<span class="_ _13"> </span><span class="ffd">addw<span class="_ _6"> </span></span>for<span class="_ _13"> </span><span class="ffd">a3<span class="_ _13"> </span></span>(<span class="ffd">short</span>),<span class="_ _13"> </span>and<span class="_ _13"> </span><span class="ffd">addb<span class="_ _13"> </span></span>for</div><div class="t m5 x1b0 h26 y440 ffd fs19 fc2 sc0 ls0 ws0">a4<span class="_ _13"> </span><span class="ff7">(</span>char<span class="ff7">).<span class="_"> </span>Observe<span class="_ _13"> </span>that<span class="_ _13"> </span>the<span class="_ _13"> </span></span>movl<span class="_ _10"> </span><span class="ff7">instruction<span class="_ _13"> </span>of<span class="_ _13"> </span>line<span class="_"> </span>6<span class="_ _13"> </span>reads<span class="_ _13"> </span>4<span class="_ _13"> </span>bytes<span class="_"> </span>from<span class="_ _13"> </span>memory;</span></div><div class="t m5 x1b0 h26 y2044 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>following<span class="_"> </span><span class="ffd">addb<span class="_ _10"> </span></span>instruction<span class="_"> </span>only<span class="_"> </span>makes<span class="_"> </span>use<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>low-order<span class="_"> </span>byte<span class="_ _0"></span>.</div><div class="t m5 x1d h47 y29a8 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>3.33<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>375)</span></div><div class="t m5 x1d h26 y29a9 ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_"> </span>C<span class="_"> </span>function<span class="_ _11"> </span><span class="ffd">procprob<span class="_ _10"> </span></span>has<span class="_"> </span>four<span class="_ _11"> </span>arguments<span class="_"> </span><span class="ffd">u</span>,<span class="_ _11"> </span><span class="ffd">a</span>,<span class="_"> </span><span class="ffd">v</span>,<span class="_ _11"> </span>and<span class="_"> </span><span class="ffd">b</span>.<span class="_"> </span>Each<span class="_ _11"> </span>is<span class="_"> </span>either<span class="_"> </span>a<span class="_ _11"> </span>signed</div><div class="t m5 x1d h26 y29aa ff7 fs19 fc1 sc0 ls0 ws0">number<span class="_"> </span>or<span class="_"> </span>a<span class="_"> </span>pointer<span class="_ _13"> </span>to<span class="_"> </span>a<span class="_"> </span>signed<span class="_"> </span>number,<span class="_ _13"> </span>where<span class="_"> </span>the<span class="_"> </span>numbers<span class="_"> </span>have<span class="_"> </span>different<span class="_"> </span>sizes<span class="_ _3"></span>.</div><div class="t m5 x1d h26 y29ab ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>function<span class="_"> </span>has<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>body:</div><div class="t m5 x10c h2d y29ac ffd fs1e fc2 sc0 ls0 ws0">*u<span class="_ _e"> </span>+=<span class="_ _1f"> </span>a;</div><div class="t m5 x10c h2d y29ad ffd fs1e fc2 sc0 ls0 ws0">*v<span class="_ _e"> </span>+=<span class="_ _1f"> </span>b;</div><div class="t m5 x10c h2d y29ae ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>sizeof(a)<span class="_ _1f"> </span>+<span class="_ _1f"> </span>sizeof(b);</div><div class="t m5 x29 h26 y29af ff7 fs19 fc2 sc0 ls0 ws0">It<span class="_"> </span>compiles<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>x86-64<span class="_"> </span>code:</div><div class="t m5 x1f h2d y13c0 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">procprob:</span></div><div class="t m5 x1f h2e y587 ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x10d h2d y832 ffd fs1e fc2 sc0 ls0 ws0">movslq<span class="_ _1a"> </span>%edi,<span class="_ _e"> </span>%rdi</div><div class="t m5 x1f h2d y8d6 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">addq<span class="_ _46"> </span>%rdi,<span class="_ _e"> </span>(%rdx)</span></div><div class="t m5 x1f h2d y77e ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">addb<span class="_ _46"> </span>%sil,<span class="_ _e"> </span>(%rcx)</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
