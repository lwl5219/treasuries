<div id="pf3d3" class="pf w2 h11" data-page-no="3d3"><div class="pc pc3d3 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg3d3.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">978<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>11<span class="_ _3d"> </span>Network<span class="_ _10"> </span>Programming</span></div><div class="t m5 x1d h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">that<span class="_"> </span>can<span class="_ _11"> </span>be<span class="_ _11"> </span>used<span class="_"> </span>as<span class="_ _11"> </span>end<span class="_ _11"> </span>points<span class="_ _11"> </span>of<span class="_"> </span>connections<span class="_ _11"> </span>(line<span class="_ _11"> </span>17).<span class="_"> </span>Since<span class="_ _11"> </span>we<span class="_ _11"> </span>are<span class="_ _11"> </span>only<span class="_"> </span>asking</div><div class="t m5 x1d h26 y2a7 ffd fs19 fc2 sc0 ls0 ws0">getaddrinfo<span class="_ _6"> </span><span class="ff7">to<span class="_ _6"> </span>convert<span class="_ _6"> </span>domain<span class="_ _6"> </span>names<span class="_ _1"></span>,<span class="_ _13"> </span>we<span class="_ _a"> </span>call<span class="_ _6"> </span>it<span class="_ _6"> </span>with<span class="_ _6"> </span>a<span class="_ _6"> </span>NULL<span class="_ _6"> </span><span class="ffd">service<span class="_ _6"> </span></span>argument.</span></div><div class="t m5 x29 h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">After<span class="_"> </span>the<span class="_"> </span>call<span class="_"> </span>to<span class="_"> </span><span class="ffd">getaddrinfo</span>,<span class="_"> </span>we<span class="_"> </span>walk<span class="_"> </span>the<span class="_"> </span>list<span class="_"> </span>of<span class="_"> </span><span class="ffd">addrinfo<span class="_ _10"> </span></span>structures<span class="_ _1"></span>,<span class="_ _11"> </span>using</div><div class="t m5 x1d h26 y2f7 ffd fs19 fc2 sc0 ls0 ws0">getnameinfo<span class="_ _11"> </span><span class="ff7">to<span class="_ _16"> </span>convert<span class="_ _11"> </span>each<span class="_ _11"> </span>socket<span class="_ _16"> </span>address<span class="_ _11"> </span>to<span class="_ _11"> </span>a<span class="_ _16"> </span>dotted-decimal<span class="_ _11"> </span>address<span class="_ _11"> </span>string.</span></div><div class="t m5 x1d h26 y2f8 ff7 fs19 fc2 sc0 ls0 ws0">After<span class="_ _13"> </span>walking<span class="_"> </span>the<span class="_ _13"> </span>list,<span class="_"> </span>we<span class="_ _13"> </span>are<span class="_ _13"> </span>careful<span class="_"> </span>to<span class="_ _13"> </span>free<span class="_"> </span>it<span class="_ _13"> </span>by<span class="_ _13"> </span>calling<span class="_"> </span><span class="ffd">freeaddrinfo<span class="_ _13"> </span></span>(although</div><div class="t m5 x1d h26 y2f9 ff7 fs19 fc2 sc0 ls0 ws0">for<span class="_"> </span>this<span class="_"> </span>simple<span class="_"> </span>program<span class="_"> </span>it<span class="_"> </span>is<span class="_"> </span>not<span class="_"> </span>strictly<span class="_"> </span>necessary).</div><div class="t m5 x29 h26 y2fa ff7 fs19 fc2 sc0 ls0 ws0">When<span class="_"> </span>we<span class="_"> </span>run<span class="_"> </span><span class="ff9">hostinfo</span>,<span class="_"> </span>we<span class="_"> </span>see<span class="_"> </span>that<span class="_"> </span><span class="ffd">twitter.com<span class="_ _10"> </span></span>maps<span class="_"> </span>to<span class="_"> </span>four<span class="_"> </span>IP<span class="_"> </span>addresses<span class="_ _1"></span>,</div><div class="t m5 x1d h26 y2fb ff7 fs19 fc2 sc0 ls0 ws0">which<span class="_"> </span>is<span class="_"> </span>what<span class="_"> </span>we<span class="_"> </span>saw<span class="_"> </span>using<span class="_"> </span><span class="ff9">nslookup<span class="_ _10"> </span></span>in<span class="_"> </span>Section<span class="_"> </span>11.3.2.</div><div class="t m5 x1d h2d y7c7f ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">./hostinfo<span class="_ _1f"> </span>twitter.com</span></div><div class="t m5 x1d h2d y7c80 ffd fs1e fc2 sc0 ls0 ws0">199.16.156.102</div><div class="t m5 x1d h2d y7c81 ffd fs1e fc2 sc0 ls0 ws0">199.16.156.230</div><div class="t m5 x1d h2d y7c82 ffd fs1e fc2 sc0 ls0 ws0">199.16.156.6</div><div class="t m5 x1d h2d y7c83 ffd fs1e fc2 sc0 ls0 ws0">199.16.156.70</div><div class="t m5 x1d h47 y7c84 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>11.4<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>1004)</span></div><div class="t m5 x1d h26 y7c85 ff7 fs19 fc1 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _10"> </span><span class="ffd ls0">getaddrinfo<span class="_ _13"> </span><span class="ff7">and<span class="_ _13"> </span></span>getnameinfo<span class="_ _13"> </span><span class="ff7">functions<span class="_ _13"> </span>subsume<span class="_ _13"> </span>the<span class="_ _6"> </span>functionality<span class="_ _13"> </span>of<span class="_ _13"> </span></span>inet_</span></div><div class="t m5 x1d h26 y7c86 ffd fs19 fc1 sc0 ls0 ws0">pton<span class="_ _10"> </span><span class="ff7">and<span class="_ _11"> </span></span>inet_ntop<span class="ff7">,<span class="_"> </span>respectively<span class="_ _3"></span>,<span class="_"> </span>and<span class="_ _11"> </span>they<span class="_"> </span>provide<span class="_ _11"> </span>a<span class="_"> </span>higher<span class="_ _1"></span>-level<span class="_ _11"> </span>of<span class="_"> </span>abstraction</span></div><div class="t m5 x1d h26 y7c87 ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_ _16"> </span>is<span class="_ _16"> </span>independent<span class="_ _16"> </span>of<span class="_ _16"> </span>any<span class="_ _14"> </span>particular<span class="_ _16"> </span>address<span class="_ _16"> </span>format.<span class="_ _16"> </span>T<span class="_ _3"></span>o<span class="_ _16"> </span>convince<span class="_ _16"> </span>yourself<span class="_ _16"> </span>how</div><div class="t m5 x1d h26 y7c88 ff7 fs19 fc1 sc0 ls0 ws0">handy<span class="_ _11"> </span>this<span class="_ _11"> </span>is<span class="_ _1"></span>,<span class="_ _16"> </span>write<span class="_ _11"> </span>a<span class="_ _11"> </span>version<span class="_ _16"> </span>of<span class="_"> </span><span class="ff9">hostinfo<span class="_ _16"> </span></span>(F<span class="_ _1"></span>igure<span class="_ _11"> </span>11.17)<span class="_ _16"> </span>that<span class="_ _11"> </span>uses<span class="_ _11"> </span><span class="ffd">inet_ntop<span class="_ _11"> </span></span>in-</div><div class="t m5 x1d h26 y7c89 ff7 fs19 fc1 sc0 ls0 ws0">stead<span class="_ _13"> </span>of<span class="_"> </span><span class="ffd">getnameinfo<span class="_ _13"> </span></span>to<span class="_"> </span>convert<span class="_ _13"> </span>each<span class="_ _13"> </span>socket<span class="_"> </span>address<span class="_ _13"> </span>to<span class="_ _13"> </span>a<span class="_"> </span>dotted-decimal<span class="_ _13"> </span>address</div><div class="t m5 x1d h26 y7c8a ff7 fs19 fc1 sc0 ls0 ws0">string.</div><div class="t m5 x1d h41 y7c8b ffe fs29 fc1 sc0 ls0 ws0">11.4.8<span class="_ _48"> </span><span class="fs19">Helper<span class="_"> </span>Functions<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>Sockets<span class="_"> </span>Interface</span></div><div class="t m5 x1d h26 y7c8c ff7 fs19 fc1 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_"> </span><span class="ffd ls0">getaddrinfo<span class="_ _13"> </span><span class="ff7">function<span class="_ _6"> </span>and<span class="_ _13"> </span>the<span class="_ _6"> </span>sockets<span class="_ _13"> </span>interface<span class="_ _6"> </span>can<span class="_ _13"> </span>seem<span class="_ _13"> </span>somewhat<span class="_ _6"> </span>daunting</span></span></div><div class="t m5 x1d h26 y7c8d ff7 fs19 fc1 sc0 ls0 ws0">when<span class="_"> </span>you<span class="_ _13"> </span>ﬁrst<span class="_"> </span>learn<span class="_"> </span>about<span class="_ _13"> </span>them.<span class="_"> </span>W<span class="_ _3"></span>e<span class="_"> </span>ﬁnd<span class="_"> </span>it<span class="_ _13"> </span>convenient<span class="_"> </span>to<span class="_"> </span>wrap<span class="_ _13"> </span>them<span class="_"> </span>with<span class="_"> </span>higher<span class="_ _3"></span>-</div><div class="t m5 x1d h26 y7c8e ff7 fs19 fc1 sc0 ls0 ws0">level<span class="_ _6"> </span>helper<span class="_ _13"> </span>functions<span class="_ _1"></span>,<span class="_ _13"> </span>called<span class="_ _6"> </span><span class="ffd">open_clientfd<span class="_ _13"> </span></span>and<span class="_ _6"> </span><span class="ffd">open_listenfd</span>,<span class="_ _13"> </span>that<span class="_ _6"> </span>clients<span class="_ _13"> </span>and</div><div class="t m5 x1d h26 y7c8f ff7 fs19 fc1 sc0 ls0 ws0">servers<span class="_"> </span>can<span class="_"> </span>use<span class="_"> </span>when<span class="_"> </span>they<span class="_"> </span>want<span class="_"> </span>to<span class="_"> </span>communicate<span class="_"> </span>with<span class="_"> </span>each<span class="_"> </span>other.</div><div class="t m5 x1d h42 y7c90 ff6 fs29 fc6 sc0 ls0 ws0">The<span class="_ _11"> </span><span class="ffd fs2b">open_clientfd<span class="_ _16"> </span></span>Function</div><div class="t m5 x1d h26 y7c91 ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_"> </span>client<span class="_"> </span>establishes<span class="_"> </span>a<span class="_"> </span>connection<span class="_"> </span>with<span class="_"> </span>a<span class="_"> </span>server<span class="_"> </span>by<span class="_"> </span>calling<span class="_"> </span><span class="ffd">open_clientfd</span>.</div><div class="t m5 x126 h2d y7c92 ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&quot;csapp.h&quot;</div><div class="t m5 x126 h2d y7c93 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>open_clientfd(char<span class="_ _1f"> </span>*hostname,<span class="_ _1f"> </span>char<span class="_ _e"> </span>*port);</div><div class="t m5 xfe hf2 y7c94 ff7 fs1f fc2 sc0 ls0 ws0">Returns:<span class="_"> </span>descriptor<span class="_"> </span>if<span class="_"> </span>OK,<span class="_"> </span><span class="ff12">−</span>1<span class="_ _13"> </span>on<span class="_"> </span>error</div><div class="t m5 x1d h26 y107b ff7 fs19 fc2 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _14"> </span><span class="ffd ls0">open_clientfd<span class="_ _16"> </span><span class="ff7">function<span class="_ _16"> </span>establishes<span class="_ _16"> </span>a<span class="_ _16"> </span>connection<span class="_ _16"> </span>with<span class="_ _14"> </span>a<span class="_ _16"> </span>server<span class="_ _16"> </span>running<span class="_ _16"> </span>on</span></span></div><div class="t m5 x1d h26 y21fc ff7 fs19 fc2 sc0 ls0 ws0">host<span class="_ _21"> </span><span class="ffd">hostname<span class="_ _21"> </span></span>and<span class="_ _21"> </span>listening<span class="_ _21"> </span>for<span class="_ _21"> </span>connection<span class="_ _21"> </span>requests<span class="_ _21"> </span>on<span class="_ _21"> </span>port<span class="_ _21"> </span>number<span class="_ _21"> </span><span class="ffd">port</span><span class="ls2e2">.I<span class="_ _12"></span>t</span></div><div class="t m5 x1d h26 y3366 ff7 fs19 fc2 sc0 ls0 ws0">returns<span class="_ _14"> </span>an<span class="_ _15"> </span>open<span class="_ _15"> </span>socket<span class="_ _14"> </span>descriptor<span class="_ _15"> </span>that<span class="_ _15"> </span>is<span class="_ _14"> </span>ready<span class="_ _15"> </span>for<span class="_ _14"> </span>input<span class="_ _15"> </span>and<span class="_ _15"> </span>output<span class="_ _14"> </span>using<span class="_ _15"> </span>the</div><div class="t m5 x1d h26 y3367 ff7 fs19 fc2 sc0 ls0 ws0">Unix<span class="_"> </span>I/O<span class="_"> </span>functions<span class="_ _1"></span>.<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>11.18<span class="_"> </span>shows<span class="_"> </span>the<span class="_"> </span>code<span class="_"> </span>for<span class="_"> </span><span class="ffd">open_clientfd</span>.</div><div class="t m5 x29 h26 yc03 ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _15"> </span>call<span class="_ _15"> </span><span class="ffd">getaddrinfo</span>,<span class="_ _21"> </span>which<span class="_ _15"> </span>returns<span class="_ _15"> </span>a<span class="_ _15"> </span>list<span class="_ _15"> </span>of<span class="_ _15"> </span><span class="ffd">addrinfo<span class="_ _15"> </span></span>structures<span class="_ _1"></span>,<span class="_ _21"> </span>each<span class="_ _15"> </span>of</div><div class="t m5 x1d h26 yc04 ff7 fs19 fc2 sc0 ls0 ws0">which<span class="_ _11"> </span>points<span class="_ _11"> </span>to<span class="_ _11"> </span>a<span class="_ _16"> </span>socket<span class="_"> </span>address<span class="_ _16"> </span>structure<span class="_"> </span>that<span class="_ _16"> </span>is<span class="_"> </span>suitable<span class="_ _16"> </span>for<span class="_"> </span>establishing<span class="_ _16"> </span>a<span class="_"> </span>con-</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
