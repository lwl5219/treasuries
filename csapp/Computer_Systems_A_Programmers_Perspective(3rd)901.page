<div id="pf385" class="pf w2 h11" data-page-no="385"><div class="pc pc385 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg385.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">900<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>9<span class="_ _3d"> </span>Virtual<span class="_ _10"> </span>Memory</span></div><div class="t m5 x1d h42 ye7 ff6 fs29 fc6 sc0 ls0 ws0">Simple<span class="_ _11"> </span>Segregated<span class="_ _16"> </span>Storage</div><div class="t m5 x1d h26 y5bd ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _1"></span>ith<span class="_"> </span>simple<span class="_"> </span>segregated<span class="_ _13"> </span>storage<span class="_ _1"></span>,<span class="_"> </span>the<span class="_"> </span>free<span class="_ _13"> </span>list<span class="_"> </span>for<span class="_ _13"> </span>each<span class="_"> </span>size<span class="_ _13"> </span>class<span class="_"> </span>contains<span class="_ _13"> </span>same-size</div><div class="t m5 x1d h26 y5be ff7 fs19 fc1 sc0 ls0 ws0">blocks<span class="_ _1"></span>,<span class="_"> </span>each<span class="_"> </span>the<span class="_"> </span>size<span class="_"> </span>of<span class="_"> </span>the<span class="_ _11"> </span>largest<span class="_"> </span>element<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>size<span class="_"> </span>class<span class="_ _1"></span>.<span class="_ _11"> </span>F<span class="_ _1"></span>or<span class="_"> </span>example<span class="_ _0"></span>,<span class="_"> </span>if<span class="_"> </span>some</div><div class="t m5 x1d h26 y5bf ff7 fs19 fc1 sc0 ls0 ws0">size<span class="_"> </span>class<span class="_ _11"> </span>is<span class="_ _11"> </span>deﬁned<span class="_ _11"> </span>as<span class="_ _11"> </span>{17–32},<span class="_ _11"> </span>then<span class="_ _11"> </span>the<span class="_ _11"> </span>free<span class="_ _11"> </span>list<span class="_"> </span>for<span class="_ _11"> </span>that<span class="_ _11"> </span>class<span class="_ _11"> </span>consists<span class="_ _11"> </span>entirely<span class="_ _11"> </span>of</div><div class="t m5 x1d h26 y5c0 ff7 fs19 fc1 sc0 ls0 ws0">blocks<span class="_"> </span>of<span class="_"> </span>size<span class="_"> </span>32.</div><div class="t m5 x29 h26 y5c1 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_ _13"> </span>allocate<span class="_ _13"> </span>a<span class="_ _6"> </span>block<span class="_ _13"> </span>of<span class="_ _6"> </span>some<span class="_ _13"> </span>given<span class="_ _6"> </span>size,<span class="_ _6"> </span>we<span class="_ _13"> </span>check<span class="_ _6"> </span>the<span class="_ _13"> </span>appropriate<span class="_ _13"> </span>free<span class="_ _6"> </span>list.<span class="_ _13"> </span>If<span class="_ _6"> </span>the</div><div class="t m5 x1d h26 y5c2 ff7 fs19 fc1 sc0 ls0 ws0">list<span class="_"> </span>is<span class="_ _11"> </span>not<span class="_ _11"> </span>empty<span class="_ _3"></span>,<span class="_ _11"> </span>we<span class="_ _11"> </span>simply<span class="_ _11"> </span>allocate<span class="_ _11"> </span>the<span class="_ _11"> </span>ﬁrst<span class="_ _11"> </span>block<span class="_ _11"> </span>in<span class="_ _11"> </span>its<span class="_ _11"> </span>entirety<span class="_ _3"></span>.<span class="_ _11"> </span>F<span class="_ _0"></span>ree<span class="_"> </span>blocks<span class="_ _11"> </span>are</div><div class="t m5 x1d h26 y5c3 ff7 fs19 fc1 sc0 ls0 ws0">never<span class="_"> </span>split<span class="_ _13"> </span>to<span class="_"> </span>satisfy<span class="_"> </span>allocation<span class="_"> </span>requests<span class="_ _3"></span>.<span class="_"> </span>If<span class="_"> </span>the<span class="_ _13"> </span>list<span class="_"> </span>is<span class="_"> </span>empty<span class="_ _7"></span>,<span class="_"> </span>the<span class="_"> </span>allocator<span class="_ _13"> </span>requests</div><div class="t m5 x1d h26 y5c4 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_ _16"> </span>ﬁxed-size<span class="_ _16"> </span>chunk<span class="_ _16"> </span>of<span class="_ _16"> </span>additional<span class="_ _16"> </span>memory<span class="_ _14"> </span>from<span class="_ _16"> </span>the<span class="_ _16"> </span>operating<span class="_ _16"> </span>system<span class="_ _16"> </span>(typically<span class="_ _16"> </span>a</div><div class="t m5 x1d h26 y5c5 ff7 fs19 fc1 sc0 ls0 ws0">multiple<span class="_"> </span>of<span class="_"> </span>the<span class="_ _11"> </span>page<span class="_"> </span>size),<span class="_ _11"> </span>divides<span class="_"> </span>the<span class="_ _11"> </span>chunk<span class="_"> </span>into<span class="_"> </span>equal-size<span class="_ _11"> </span>blocks<span class="_ _1"></span>,<span class="_"> </span>and<span class="_ _11"> </span>links<span class="_"> </span>the</div><div class="t m5 x1d h26 y5c6 ff7 fs19 fc1 sc0 ls0 ws0">blocks<span class="_ _14"> </span>together<span class="_ _14"> </span>to<span class="_ _14"> </span>form<span class="_ _14"> </span>the<span class="_ _14"> </span>new<span class="_ _14"> </span>free<span class="_ _14"> </span>list.<span class="_ _14"> </span>T<span class="_ _3"></span>o<span class="_ _14"> </span>free<span class="_ _14"> </span>a<span class="_ _14"> </span>block,<span class="_ _15"> </span>the<span class="_ _14"> </span>allocator<span class="_ _14"> </span>simply</div><div class="t m5 x1d h26 y5c7 ff7 fs19 fc1 sc0 ls0 ws0">inserts<span class="_"> </span>the<span class="_"> </span>block<span class="_"> </span>at<span class="_"> </span>the<span class="_"> </span>front<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>appropriate<span class="_"> </span>free<span class="_"> </span>list.</div><div class="t m5 x29 h26 y5c8 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>here<span class="_ _f"> </span>are<span class="_ _21"> </span>a<span class="_ _f"> </span>number<span class="_ _21"> </span>of<span class="_ _f"> </span>advantages<span class="_ _21"> </span>to<span class="_ _f"> </span>this<span class="_ _21"> </span>simple<span class="_ _f"> </span>scheme<span class="_ _0"></span>.<span class="_ _21"> </span>Allocating<span class="_ _f"> </span>and</div><div class="t m5 x1d h26 y5c9 ff7 fs19 fc1 sc0 ls0 ws0">freeing<span class="_ _16"> </span>blocks<span class="_ _16"> </span>are<span class="_ _16"> </span>both<span class="_ _16"> </span>fast<span class="_ _16"> </span>constant-time<span class="_ _16"> </span>operations<span class="_ _1"></span>.<span class="_ _16"> </span>Further,<span class="_ _16"> </span>the<span class="_ _16"> </span>combination</div><div class="t m5 x1d h26 y5ca ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span>the<span class="_"> </span>same-size<span class="_"> </span>blocks<span class="_"> </span>in<span class="_"> </span>each<span class="_"> </span>chunk,<span class="_ _11"> </span>no<span class="_"> </span>splitting,<span class="_"> </span>and<span class="_"> </span>no<span class="_"> </span>coalescing<span class="_"> </span>means<span class="_"> </span>that</div><div class="t m5 x1d h26 y746f ff7 fs19 fc1 sc0 ls0 ws0">there<span class="_"> </span>is<span class="_"> </span>very<span class="_"> </span>little<span class="_"> </span>per<span class="_ _1"></span>-block<span class="_"> </span>memory<span class="_ _11"> </span>overhead.<span class="_"> </span>Since<span class="_"> </span>each<span class="_"> </span>chunk<span class="_"> </span>has<span class="_"> </span>only<span class="_"> </span>same-</div><div class="t m5 x1d h26 y7470 ff7 fs19 fc1 sc0 ls0 ws0">size<span class="_ _11"> </span>blocks<span class="_ _1"></span>,<span class="_ _11"> </span>the<span class="_ _16"> </span>size<span class="_"> </span>of<span class="_ _16"> </span>an<span class="_"> </span>allocated<span class="_ _16"> </span>block<span class="_"> </span>can<span class="_ _11"> </span>be<span class="_ _16"> </span>inferred<span class="_"> </span>from<span class="_ _16"> </span>its<span class="_"> </span>address<span class="_ _0"></span>.<span class="_ _11"> </span>Since</div><div class="t m5 x1d h26 y7471 ff7 fs19 fc1 sc0 ls0 ws0">there<span class="_ _11"> </span>is<span class="_ _16"> </span>no<span class="_ _16"> </span>coalescing<span class="_ _0"></span>,<span class="_ _16"> </span>allocated<span class="_ _11"> </span>blocks<span class="_ _16"> </span>do<span class="_ _11"> </span>not<span class="_ _16"> </span>need<span class="_ _16"> </span>an<span class="_ _11"> </span>allocated/free<span class="_ _16"> </span>ﬂag<span class="_ _11"> </span>in<span class="_ _16"> </span>the</div><div class="t m5 x1d h26 y7472 ff7 fs19 fc1 sc0 ls0 ws0">header.<span class="_ _6"> </span>T<span class="_ _0"></span>hus<span class="_ _1"></span>,<span class="_ _13"> </span>allocated<span class="_ _6"> </span>blocks<span class="_ _13"> </span>require<span class="_ _6"> </span>no<span class="_ _13"> </span>headers<span class="_ _3"></span>,<span class="_ _13"> </span>and<span class="_ _13"> </span>since<span class="_ _6"> </span>there<span class="_ _13"> </span>is<span class="_ _6"> </span>no<span class="_ _13"> </span>coalescing,</div><div class="t m5 x1d h26 y7473 ff7 fs19 fc1 sc0 ls0 ws0">they<span class="_ _16"> </span>do<span class="_ _11"> </span>not<span class="_ _16"> </span>require<span class="_ _16"> </span>any<span class="_ _16"> </span>footers<span class="_ _11"> </span>either.<span class="_ _16"> </span>Since<span class="_ _16"> </span>allocate<span class="_ _11"> </span>and<span class="_ _16"> </span>free<span class="_ _16"> </span>operations<span class="_ _16"> </span>insert</div><div class="t m5 x1d h26 y7474 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _14"> </span>delete<span class="_ _15"> </span>blocks<span class="_ _15"> </span>at<span class="_ _14"> </span>the<span class="_ _15"> </span>beginning<span class="_ _15"> </span>of<span class="_ _14"> </span>the<span class="_ _15"> </span>free<span class="_ _14"> </span>list,<span class="_ _21"> </span>the<span class="_ _15"> </span>list<span class="_ _14"> </span>need<span class="_ _15"> </span>only<span class="_ _15"> </span>be<span class="_ _14"> </span>singly</div><div class="t m5 x1d h26 y7475 ff7 fs19 fc1 sc0 ls0 ws0">linked<span class="_"> </span>instead<span class="_"> </span>of<span class="_"> </span>doubly<span class="_"> </span>linked.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>bottom<span class="_"> </span>line<span class="_ _11"> </span>is<span class="_"> </span>that<span class="_"> </span>the<span class="_"> </span>only<span class="_"> </span>required<span class="_"> </span>ﬁeld<span class="_"> </span>in</div><div class="t m5 x1d h26 y7476 ff7 fs19 fc1 sc0 ls0 ws0">any<span class="_ _11"> </span>block<span class="_ _16"> </span>is<span class="_ _11"> </span>a<span class="_ _11"> </span>one-word<span class="_ _11"> </span><span class="ffd">succ<span class="_ _16"> </span></span>pointer<span class="_ _11"> </span>in<span class="_ _11"> </span>each<span class="_ _16"> </span>free<span class="_ _11"> </span>block,<span class="_ _16"> </span>and<span class="_ _11"> </span>thus<span class="_ _11"> </span>the<span class="_ _16"> </span>minimum</div><div class="t m5 x1d h26 y7477 ff7 fs19 fc1 sc0 ls0 ws0">block<span class="_"> </span>size<span class="_"> </span>is<span class="_"> </span>only<span class="_"> </span>one<span class="_"> </span>word.</div><div class="t m5 x29 h26 y7478 ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_"> </span>signiﬁcant<span class="_ _11"> </span>disadvantage<span class="_ _11"> </span>is<span class="_ _11"> </span>that<span class="_ _11"> </span>simple<span class="_"> </span>segregated<span class="_ _11"> </span>storage<span class="_ _11"> </span>is<span class="_ _11"> </span>susceptible<span class="_ _11"> </span>to</div><div class="t m5 x1d h26 y7479 ff7 fs19 fc1 sc0 ls0 ws0">internal<span class="_ _16"> </span>and<span class="_ _16"> </span>external<span class="_ _16"> </span>fragmentation.<span class="_ _16"> </span>Internal<span class="_ _16"> </span>fragmentation<span class="_ _16"> </span>is<span class="_ _16"> </span>possible<span class="_ _16"> </span>because</div><div class="t m5 x1d h26 y747a ff7 fs19 fc1 sc0 ls0 ws0">free<span class="_ _11"> </span>blocks<span class="_ _16"> </span>are<span class="_ _16"> </span>never<span class="_ _11"> </span>split.<span class="_ _16"> </span>W<span class="_ _3"></span>orse<span class="_ _0"></span>,<span class="_ _16"> </span>certain<span class="_ _11"> </span>reference<span class="_ _16"> </span>patterns<span class="_ _16"> </span>can<span class="_ _11"> </span>cause<span class="_ _16"> </span>extreme</div><div class="t m5 x1d h26 y747b ff7 fs19 fc1 sc0 ls0 ws0">external<span class="_ _16"> </span>fragmentation<span class="_ _16"> </span>because<span class="_ _16"> </span>free<span class="_ _11"> </span>blocks<span class="_ _16"> </span>are<span class="_ _16"> </span>never<span class="_ _16"> </span>coalesced<span class="_ _16"> </span>(Practice<span class="_ _16"> </span>Prob-</div><div class="t m5 x1d h26 y747c ff7 fs19 fc1 sc0 ls0 ws0">lem<span class="_"> </span>9.10).</div><div class="t m5 x1d h47 y747d ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>9.10<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>921)</span></div><div class="t m5 x1d h26 yee7 ff7 fs19 fc1 sc0 ls0 ws0">Describe<span class="_ _16"> </span>a<span class="_ _11"> </span>reference<span class="_ _16"> </span>pattern<span class="_ _16"> </span>that<span class="_ _16"> </span>results<span class="_ _11"> </span>in<span class="_ _16"> </span>severe<span class="_ _16"> </span>external<span class="_ _16"> </span>fragmentation<span class="_ _11"> </span>in<span class="_ _16"> </span>an</div><div class="t m5 x1d h26 y747e ff7 fs19 fc1 sc0 ls0 ws0">allocator<span class="_"> </span>based<span class="_"> </span>on<span class="_"> </span>simple<span class="_"> </span>segregated<span class="_"> </span>storage<span class="_ _1"></span>.</div><div class="t m5 x1d h42 y2972 ff6 fs29 fc6 sc0 ls0 ws0">Segregated<span class="_ _11"> </span>Fits</div><div class="t m5 x1d h26 y747f ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _1"></span>ith<span class="_ _11"> </span>this<span class="_"> </span>approach,<span class="_ _11"> </span>the<span class="_"> </span>allocator<span class="_ _11"> </span>maintains<span class="_"> </span>an<span class="_ _11"> </span>array<span class="_"> </span>of<span class="_ _11"> </span>free<span class="_"> </span>lists<span class="_ _1"></span>.<span class="_ _11"> </span>Each<span class="_"> </span>free<span class="_"> </span>list<span class="_ _11"> </span>is</div><div class="t m5 x1d h26 y7480 ff7 fs19 fc1 sc0 ls0 ws0">associated<span class="_ _13"> </span>with<span class="_ _13"> </span>a<span class="_ _13"> </span>size<span class="_ _6"> </span>class<span class="_ _13"> </span>and<span class="_ _13"> </span>is<span class="_ _13"> </span>organized<span class="_ _13"> </span>as<span class="_ _13"> </span>some<span class="_ _6"> </span>kind<span class="_ _13"> </span>of<span class="_ _13"> </span>explicit<span class="_ _13"> </span>or<span class="_ _13"> </span>implicit<span class="_ _13"> </span>list.</div><div class="t m5 x1d h26 y7481 ff7 fs19 fc1 sc0 ls0 ws0">Each<span class="_ _13"> </span>list<span class="_ _13"> </span>contains<span class="_ _13"> </span>potentially<span class="_ _13"> </span>different-size<span class="_ _6"> </span>blocks<span class="_ _13"> </span>whose<span class="_ _13"> </span>sizes<span class="_ _13"> </span>are<span class="_ _13"> </span>members<span class="_ _13"> </span>of<span class="_ _13"> </span>the</div><div class="t m5 x1d h26 y7482 ff7 fs19 fc1 sc0 ls0 ws0">size<span class="_"> </span>class<span class="_ _3"></span>.<span class="_"> </span>T<span class="_ _0"></span>here<span class="_"> </span>are<span class="_"> </span>many<span class="_"> </span>variants<span class="_ _13"> </span>of<span class="_"> </span>segregated<span class="_"> </span>ﬁts<span class="_"> </span>allocators<span class="_ _3"></span>.<span class="_"> </span>Here<span class="_"> </span>we<span class="_"> </span>describe</div><div class="t m5 x1d h26 y7483 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_"> </span>simple<span class="_"> </span>version.</div><div class="t m5 x29 h26 y3bc1 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_ _11"> </span>allocate<span class="_"> </span>a<span class="_ _11"> </span>block,<span class="_"> </span>we<span class="_ _11"> </span>determine<span class="_"> </span>the<span class="_ _11"> </span>size<span class="_"> </span>class<span class="_ _11"> </span>of<span class="_"> </span>the<span class="_ _11"> </span>request<span class="_"> </span>and<span class="_ _11"> </span>do<span class="_"> </span>a<span class="_ _11"> </span>ﬁrst-</div><div class="t m5 x1d h26 y3bc2 ff7 fs19 fc1 sc0 ls0 ws0">ﬁt<span class="_ _11"> </span>search<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>appropriate<span class="_ _11"> </span>free<span class="_ _11"> </span>list<span class="_ _16"> </span>for<span class="_"> </span>a<span class="_ _11"> </span>block<span class="_ _11"> </span>that<span class="_ _16"> </span>ﬁts<span class="_ _3"></span>.<span class="_ _11"> </span>If<span class="_ _16"> </span>we<span class="_"> </span>ﬁnd<span class="_ _11"> </span>one,<span class="_"> </span>then<span class="_ _16"> </span>we</div><div class="t m5 x1d h26 y3bc3 ff7 fs19 fc1 sc0 ls0 ws0">(optionally)<span class="_ _6"> </span>split<span class="_ _13"> </span>it<span class="_ _a"> </span>and<span class="_ _13"> </span>insert<span class="_ _6"> </span>the<span class="_ _6"> </span>fragment<span class="_ _13"> </span>in<span class="_ _6"> </span>the<span class="_ _6"> </span>appropriate<span class="_ _13"> </span>free<span class="_ _6"> </span>list.<span class="_ _6"> </span>If<span class="_ _13"> </span>we<span class="_ _a"> </span>cannot</div><div class="t m5 x1d h26 y3bc4 ff7 fs19 fc1 sc0 ls0 ws0">ﬁnd<span class="_"> </span>a<span class="_"> </span>block<span class="_"> </span>that<span class="_ _11"> </span>ﬁts<span class="_ _1"></span>,<span class="_"> </span>then<span class="_"> </span>we<span class="_ _11"> </span>search<span class="_"> </span>the<span class="_"> </span>free<span class="_"> </span>list<span class="_ _11"> </span>for<span class="_"> </span>the<span class="_"> </span>next<span class="_"> </span>larger<span class="_ _11"> </span>size<span class="_"> </span>class<span class="_ _1"></span>.<span class="_"> </span>W<span class="_ _1"></span>e</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
