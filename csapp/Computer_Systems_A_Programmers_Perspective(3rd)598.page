<div id="pf256" class="pf w2 h11" data-page-no="256"><div class="pc pc256 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg256.png"/><div class="t m5 xc1 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>5.13<span class="_ _60"> </span>Life<span class="_ _10"> </span>in<span class="_ _10"> </span>the<span class="_ _10"> </span>Real<span class="_ _10"> </span>World:<span class="_ _13"> </span>Per<span class="_ _2"></span>formance<span class="_ _10"> </span>Improvement<span class="_ _10"> </span>T<span class="_ _3"></span>echniques<span class="_ _3e"> </span><span class="ffe fs1e">597</span></div><div class="t m5 x17 h47 yb1f ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>5.11<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>613)</span></div><div class="t m5 x246 h26 yb20 ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _13"> </span>saw<span class="_ _6"> </span>that<span class="_ _6"> </span>our<span class="_ _13"> </span>measurements<span class="_ _6"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>preﬁx-sum<span class="_ _6"> </span>function<span class="_ _13"> </span><span class="ffd">psum1<span class="_ _6"> </span></span>(F<span class="_ _1"></span>igure<span class="_ _13"> </span>5.1)<span class="_ _6"> </span>yield</div><div class="t m5 x17 h26 yb21 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_"> </span>CPE<span class="_"> </span>of<span class="_"> </span>9.00<span class="_"> </span>on<span class="_"> </span>a<span class="_"> </span>machine<span class="_"> </span>where<span class="_"> </span>the<span class="_ _13"> </span>basic<span class="_"> </span>operation<span class="_"> </span>to<span class="_"> </span>be<span class="_"> </span>performed,<span class="_"> </span>ﬂoating-</div><div class="t m5 x17 h26 yb22 ff7 fs19 fc1 sc0 ls0 ws0">point<span class="_ _11"> </span>addition,<span class="_ _16"> </span>has<span class="_ _16"> </span>a<span class="_ _11"> </span>latency<span class="_ _11"> </span>of<span class="_ _16"> </span>just<span class="_ _11"> </span>3<span class="_ _16"> </span>clock<span class="_ _11"> </span>cycles<span class="_ _3"></span>.<span class="_ _16"> </span>Let<span class="_ _11"> </span>us<span class="_ _16"> </span>try<span class="_ _11"> </span>to<span class="_ _16"> </span>understand<span class="_ _11"> </span>why</div><div class="t m5 x17 h26 yba3 ff7 fs19 fc1 sc0 ls0 ws0">our<span class="_"> </span>function<span class="_"> </span>performs<span class="_"> </span>so<span class="_"> </span>poorly<span class="_ _3"></span>.</div><div class="t m5 x26 h26 y1656 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>following<span class="_"> </span>is<span class="_"> </span>the<span class="_"> </span>assembly<span class="_"> </span>code<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>inner<span class="_"> </span>loop<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>function:</div><div class="t m5 x2e h61 y508b ff13 fs35 fc6 sc0 ls0 ws0">Inner<span class="_ _f"> </span>loop<span class="_ _f"> </span>of<span class="_ _f"> </span>psum1</div><div class="t m5 x2e h61 y508c ff13 fs35 fc6 sc0 ls0 ws0">a<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi,<span class="_ _f"> </span>i<span class="_ _e"> </span>in<span class="_ _21"> </span>%rax,<span class="_ _f"> </span>cnt<span class="_ _e"> </span>in<span class="_ _21"> </span>%rdx</div><div class="t m5 x2c h2d y508d ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L5:<span class="_ _1ee"> </span></span><span class="ff2d fs35">loop:</span></div><div class="t m5 x2c h2d y508e ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">vmovss<span class="_ _1a"> </span>-4(%rsi,%rax,4),<span class="_ _e"> </span>%xmm0<span class="_ _12e"> </span></span><span class="ff13 fs35">Get<span class="_ _e"> </span>p[i-1]</span></div><div class="t m5 x2c h2d y508f ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">vaddss<span class="_ _1a"> </span>(%rdi,%rax,4),<span class="_ _e"> </span>%xmm0,<span class="_ _1f"> </span>%xmm0<span class="_ _68"> </span></span><span class="ff13 fs35">Add<span class="_ _f"> </span>a[i]</span></div><div class="t m5 x2c h2d y5090 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">vmovss<span class="_ _1a"> </span>%xmm0,<span class="_ _e"> </span>(%rsi,%rax,4)<span class="_ _29"> </span></span><span class="ff13 fs35">Store<span class="_ _e"> </span>at<span class="_ _21"> </span>p[i]</span></div><div class="t m5 x2c h2e y5091 ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 xd1 h2d y5092 ffd fs1e fc2 sc0 ls0 ws0">addq<span class="_ _46"> </span>$1,<span class="_ _e"> </span>%rax<span class="_ _a3"> </span><span class="ff13 fs35 fc6">Increment<span class="_ _f"> </span>i</span></div><div class="t m5 x2c h2d y5093 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">cmpq<span class="_ _46"> </span>%rdx,<span class="_ _e"> </span>%rax<span class="_ _d2"> </span></span><span class="ff13 fs35">Compare<span class="_ _f"> </span>i:cnt</span></div><div class="t m5 x2c h2d y5094 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">jne<span class="_ _8c"> </span>.L5<span class="_ _180"> </span></span><span class="ff13 fs35">If<span class="_ _f"> </span>!=,<span class="_ _f"> </span>goto<span class="_ _e"> </span><span class="ff2d">loop</span></span></div><div class="t m5 x26 h26 y5095 ff7 fs19 fc2 sc0 ls0 ws0">Perform<span class="_ _13"> </span>an<span class="_ _13"> </span>analysis<span class="_ _13"> </span>similar<span class="_ _6"> </span>to<span class="_ _13"> </span>those<span class="_ _13"> </span>shown<span class="_ _13"> </span>for<span class="_ _13"> </span><span class="ffd">combine3<span class="_ _13"> </span></span>(F<span class="_ _1"></span>igure<span class="_ _13"> </span>5.14)<span class="_ _13"> </span>and<span class="_ _6"> </span>for</div><div class="t m5 x17 h26 y5096 ffd fs19 fc2 sc0 ls0 ws0">write_read<span class="_ _10"> </span><span class="ff7">(F<span class="_ _1"></span>igure<span class="_"> </span>5.36)<span class="_"> </span>to<span class="_"> </span>diagram<span class="_ _13"> </span>the<span class="_"> </span>data<span class="_"> </span>dependencies<span class="_"> </span>created<span class="_ _13"> </span>by<span class="_"> </span>this<span class="_"> </span>loop<span class="_ _1"></span>,</span></div><div class="t m5 x17 h26 y5097 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_"> </span>hence<span class="_"> </span>the<span class="_"> </span>critical<span class="_ _11"> </span>path<span class="_"> </span>that<span class="_"> </span>forms<span class="_ _11"> </span>as<span class="_"> </span>the<span class="_"> </span>computation<span class="_ _11"> </span>proceeds<span class="_ _1"></span>.<span class="_"> </span>Explain<span class="_"> </span>why</div><div class="t m5 x17 h26 y5098 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>CPE<span class="_"> </span>is<span class="_"> </span>so<span class="_"> </span>high.</div><div class="t m5 x17 h47 y5099 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>5.12<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>613)</span></div><div class="t m5 x17 h26 y509a ff7 fs19 fc1 sc0 ls0 ws0">Rewrite<span class="_ _14"> </span>the<span class="_ _16"> </span>code<span class="_ _14"> </span>for<span class="_ _14"> </span><span class="ffd">psum1<span class="_ _14"> </span></span>(Figure<span class="_ _16"> </span>5.1)<span class="_ _14"> </span>so<span class="_ _14"> </span>that<span class="_ _14"> </span>it<span class="_ _16"> </span>does<span class="_ _14"> </span>not<span class="_ _14"> </span>need<span class="_ _14"> </span>to<span class="_ _14"> </span>repeatedly</div><div class="t m5 x17 h26 y509b ff7 fs19 fc1 sc0 ls0 ws0">retrieve<span class="_ _11"> </span>the<span class="_ _11"> </span>value<span class="_ _11"> </span>of<span class="_ _11"> </span><span class="ffd">p[i]<span class="_ _11"> </span></span>from<span class="_ _11"> </span>memory<span class="_ _3"></span>.<span class="_ _11"> </span>Y<span class="_ _3"></span>ou<span class="_ _11"> </span>do<span class="_ _11"> </span>not<span class="_ _11"> </span>need<span class="_ _11"> </span>to<span class="_ _11"> </span>use<span class="_ _11"> </span>loop<span class="_ _11"> </span>unrolling.</div><div class="t m5 x17 h26 y509c ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _11"> </span>measured<span class="_ _11"> </span>the<span class="_"> </span>resulting<span class="_ _11"> </span>code<span class="_ _11"> </span>to<span class="_ _11"> </span>have<span class="_"> </span>a<span class="_ _11"> </span>CPE<span class="_ _11"> </span>of<span class="_ _11"> </span>3.00,<span class="_ _11"> </span>limited<span class="_"> </span>by<span class="_ _11"> </span>the<span class="_ _11"> </span>latency<span class="_"> </span>of</div><div class="t m5 x17 h26 y509d ff7 fs19 fc1 sc0 ls0 ws0">ﬂoating-point<span class="_"> </span>addition.</div><div class="t m5 x17 h3b y509e fff fs24 fc6 sc0 ls0 ws0">5.13<span class="_ _17"> </span><span class="ffe fs18">Life<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>Real<span class="_"> </span>World:<span class="_"> </span>Performance<span class="_"> </span>Improvement</span></div><div class="t m5 x123 h3e y509f ffe fs18 fc6 sc0 ls0 ws0">T<span class="_ _3"></span>echniques</div><div class="t m5 x17 h26 y50a0 ff7 fs19 fc1 sc0 ls0 ws0">Although<span class="_ _15"> </span>we<span class="_ _21"> </span>have<span class="_ _21"> </span>only<span class="_ _21"> </span>considered<span class="_ _15"> </span>a<span class="_ _21"> </span>limited<span class="_ _21"> </span>set<span class="_ _21"> </span>of<span class="_ _15"> </span>applications<span class="_ _0"></span>,<span class="_ _f"> </span>we<span class="_ _15"> </span>can<span class="_ _21"> </span>draw</div><div class="t m5 x17 h26 y50a1 ff7 fs19 fc1 sc0 ls0 ws0">important<span class="_ _16"> </span>lessons<span class="_ _14"> </span>on<span class="_ _14"> </span>how<span class="_ _14"> </span>to<span class="_ _16"> </span>write<span class="_ _14"> </span>efﬁcient<span class="_ _14"> </span>code<span class="_ _0"></span>.<span class="_ _16"> </span>W<span class="_ _1"></span>e<span class="_ _16"> </span>have<span class="_ _14"> </span>described<span class="_ _14"> </span>a<span class="_ _14"> </span>number</div><div class="t m5 x17 h26 y50a2 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span>basic<span class="_"> </span>strategies<span class="_"> </span>for<span class="_"> </span>optimizing<span class="_"> </span>program<span class="_"> </span>performance:</div><div class="t m5 x72 h26 y50a3 ffa fs19 fc1 sc0 ls0 ws0">High-level<span class="_ _16"> </span>design.<span class="_ _21"> </span><span class="ff7">Choose<span class="_ _16"> </span>appropriate<span class="_ _16"> </span>algorithms<span class="_ _16"> </span>and<span class="_ _16"> </span>data<span class="_ _16"> </span>structures<span class="_ _16"> </span>for<span class="_ _16"> </span>the</span></div><div class="t m5 x30 h26 y50a4 ff7 fs19 fc1 sc0 ls0 ws0">problem<span class="_ _15"> </span>at<span class="_ _21"> </span>hand.<span class="_ _15"> </span>Be<span class="_ _21"> </span>especially<span class="_ _15"> </span>vigilant<span class="_ _21"> </span>to<span class="_ _21"> </span>avoid<span class="_ _15"> </span>algorithms<span class="_ _21"> </span>or<span class="_ _15"> </span>coding</div><div class="t m5 x30 h26 y50a5 ff7 fs19 fc1 sc0 ls0 ws0">techniques<span class="_"> </span>that<span class="_"> </span>yield<span class="_"> </span>asymptotically<span class="_"> </span>poor<span class="_"> </span>performance<span class="_ _1"></span>.</div><div class="t m5 x72 h26 y50a6 ffa fs19 fc1 sc0 ls0 ws0">Basic<span class="_ _15"> </span>coding<span class="_ _21"> </span>principles<span class="_ _1"></span>.<span class="_ _21"> </span><span class="ff7">A<span class="_ _3"></span>void<span class="_ _21"> </span>optimization<span class="_ _15"> </span>blockers<span class="_ _21"> </span>so<span class="_ _15"> </span>that<span class="_ _21"> </span>a<span class="_ _15"> </span>compiler<span class="_ _21"> </span>can</span></div><div class="t m5 x30 h26 y50a7 ff7 fs19 fc1 sc0 ls0 ws0">generate<span class="_"> </span>efﬁcient<span class="_"> </span>code<span class="_ _1"></span>.</div><div class="t m5 xd0 h26 y8d6 ff7 fs19 fc1 sc0 ls0 ws0">Eliminate<span class="_ _15"> </span>excessive<span class="_ _14"> </span>function<span class="_ _15"> </span>calls<span class="_ _1"></span>.<span class="_ _15"> </span>Move<span class="_ _15"> </span>computations<span class="_ _15"> </span>out<span class="_ _15"> </span>of<span class="_ _15"> </span>loops</div><div class="t m5 xd0 h26 y8d7 ff7 fs19 fc1 sc0 ls0 ws0">when<span class="_ _6"> </span>possible.<span class="_ _a"> </span>Consider<span class="_ _13"> </span>selective<span class="_ _6"> </span>compromises<span class="_ _6"> </span>of<span class="_ _13"> </span>program<span class="_ _6"> </span>modularity</div><div class="t m5 xd0 h26 y8d8 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_"> </span>gain<span class="_"> </span>greater<span class="_"> </span>efﬁciency<span class="_ _7"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
