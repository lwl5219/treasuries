<div id="pf1ad" class="pf w2 h11" data-page-no="1ad"><div class="pc pc1ad w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1ad.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">428<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>4<span class="_ _3d"> </span>Processor<span class="_ _10"> </span>Architecture</span></div><div class="t m5 x28 h2a y257 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">T<span class="_ _3"></span>racing<span class="_ _11"> </span>the<span class="_ _11"> </span>execution<span class="_ _16"> </span>of<span class="_ _11"> </span>a<span class="_ _11"> </span><span class="ffd fs2b">pushq<span class="_ _11"> </span></span>instruction</span></div><div class="t m5 x28 h2b y2d0 ff7 fs1e fc2 sc0 ls0 ws0">Let<span class="_"> </span>us<span class="_ _10"> </span>trace<span class="_ _11"> </span>the<span class="_"> </span>processing<span class="_"> </span>of<span class="_ _11"> </span>the<span class="_"> </span><span class="ffd">pushq<span class="_ _10"> </span></span>instruction<span class="_ _11"> </span>on<span class="_"> </span>line<span class="_"> </span>6<span class="_ _11"> </span>of<span class="_"> </span>the<span class="_ _10"> </span>object<span class="_ _11"> </span>code<span class="_"> </span>shown<span class="_"> </span>in<span class="_ _11"> </span>F<span class="_ _1"></span>igure<span class="_ _11"> </span>4.17.</div><div class="t m5 x28 h2b y2d1 ff7 fs1e fc2 sc0 ls0 ws0">At<span class="_ _13"> </span>this<span class="_ _13"> </span>point,<span class="_"> </span>we<span class="_ _13"> </span>have<span class="_ _13"> </span>9<span class="_ _13"> </span>in<span class="_ _13"> </span>register<span class="_ _13"> </span><span class="ffd">%rdx<span class="_ _13"> </span></span>and<span class="_ _13"> </span>128<span class="_ _13"> </span>in<span class="_ _13"> </span>register<span class="_ _13"> </span><span class="ffd">%rsp</span>.<span class="_ _13"> </span>W<span class="_ _3"></span>e<span class="_"> </span>can<span class="_ _13"> </span>also<span class="_ _13"> </span>see<span class="_ _13"> </span>that<span class="_ _13"> </span>the<span class="_ _13"> </span>instruction<span class="_ _13"> </span>is</div><div class="t m5 x28 h2b y2d2 ff7 fs1e fc2 sc0 ls0 ws0">located<span class="_ _6"> </span>at<span class="_ _13"> </span>address<span class="_ _6"> </span><span class="ffd">0x02a<span class="_ _13"> </span></span>and<span class="_ _6"> </span>consists<span class="_ _13"> </span>of<span class="_ _6"> </span>2<span class="_ _13"> </span>bytes<span class="_ _6"> </span>having<span class="_ _13"> </span>values<span class="_ _6"> </span><span class="ffd">0xa0<span class="_ _13"> </span></span>and<span class="_ _6"> </span><span class="ffd">0x2f</span>.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span>stages<span class="_ _6"> </span>would<span class="_ _13"> </span>proceed</div><div class="t m5 x28 h2b y2d3 ff7 fs1e fc2 sc0 ls0 ws0">as<span class="_"> </span>follows:</div><div class="t m5 x12 h31 y3b4b ff7 fs21 fc2 sc0 ls0 ws0">Generic<span class="_ _165"> </span>Speciﬁc</div><div class="t m5 x28 h31 y3b4c ff7 fs21 fc2 sc0 ls0 ws0">Stage</div><div class="t m5 x12 h93 y3b4d ffd fs1e fc2 sc0 ls0 ws0">pushq<span class="_ _11"> </span><span class="ff6 fs21">rA</span></div><div class="t m5 x1eb h2d y3b4e ffd fs1e fc2 sc0 ls0 ws0">pushq<span class="_ _11"> </span>%rdx</div><div class="t m5 x28 h32 y3b4f ff7 fs21 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>etch<span class="_ _30"> </span><span class="ff6">icode<span class="_ _a"> </span></span>:<span class="_ _be"></span><span class="ff6">ifun<span class="_ _23"> </span><span class="ff12">←<span class="_ _25"> </span></span>M</span></div><div class="t m5 x218 h33 y3b50 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x1d0 h32 y3b4f ff7 fs21 fc2 sc0 ls0 ws0">[<span class="ff6">PC</span>]<span class="_ _19"> </span><span class="ff6">icode<span class="_ _a"> </span></span>:<span class="_ _be"></span><span class="ff6">ifun<span class="_ _23"> </span><span class="ff12">←<span class="_ _23"> </span></span>M</span></div><div class="t m5 xd8 h33 y3b50 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x3f h32 y3b4f ff7 fs21 fc2 sc0 ls0 ws0">[<span class="ffd fs1e">0x02a</span>]<span class="_ _6"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ffd fs1e">a:0</span></span></div><div class="t m5 x12 h32 y3b51 ff6 fs21 fc2 sc0 ls0 ws0">rA<span class="_ _6"> </span><span class="ff7">:<span class="_ _be"></span></span>rB<span class="_ _25"> </span><span class="ff12">←<span class="_ _23"> </span></span>M</div><div class="t m5 x22b h33 y3b52 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x66 h32 y3b51 ff7 fs21 fc2 sc0 ls0 ws0">[<span class="ff6">PC<span class="_ _13"> </span><span class="ff12">+<span class="_ _13"> </span></span></span>1]<span class="_ _8b"> </span><span class="ff6">rA<span class="_ _13"> </span></span>:<span class="_ _5"></span><span class="ff6">rB<span class="_ _25"> </span><span class="ff12">←<span class="_ _23"> </span></span>M</span></div><div class="t m5 x20c h33 y3b52 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x130 h32 y3b51 ff7 fs21 fc2 sc0 ls0 ws0">[<span class="ffd fs1e">0x02b</span>]<span class="_ _6"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ffd fs1e">2:f</span></span></div><div class="t m5 x12 h32 y3ad7 ff6 fs21 fc2 sc0 ls0 ws0">valP<span class="_ _23"> </span><span class="ff12">←<span class="_ _25"> </span></span>PC<span class="_ _13"> </span><span class="ff12">+<span class="_ _13"> </span><span class="ff7">2<span class="_ _156"> </span></span></span>valP<span class="_ _23"> </span><span class="ff12">←<span class="_ _25"> </span><span class="ffd fs1e">0x02a<span class="_ _13"> </span></span>+<span class="_ _13"> </span><span class="ff7">2<span class="_"> </span></span>=<span class="_ _13"></span><span class="ffd fs1e">0x02c</span></span></div><div class="t m5 x28 h32 y3b53 ff7 fs21 fc2 sc0 ls0 ws0">Decode<span class="_ _5b"> </span><span class="ff6">valA<span class="_ _24"> </span><span class="ff12">←<span class="_ _25"> </span></span>R</span>[<span class="ff6">rA<span class="_ _2"></span></span>]<span class="_ _65"> </span><span class="ff6">valA<span class="_ _25"> </span><span class="ff12">←<span class="_ _23"> </span></span>R<span class="_ _2"></span></span>[<span class="ffd fs1e">%rdx</span>]<span class="_ _6"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ffd fs1e">9</span></span></div><div class="t m5 x12 h32 y3b54 ff6 fs21 fc2 sc0 ls0 ws0">valB<span class="_ _23"> </span><span class="ff12">←<span class="_ _25"> </span></span>R<span class="ff7">[<span class="ffd fs1e">%rsp</span>]<span class="_ _ed"> </span></span>valB<span class="_ _23"> </span><span class="ff12">←<span class="_ _25"> </span></span>R<span class="_ _2"></span><span class="ff7">[<span class="ffd fs1e">%rsp</span>]<span class="_ _a"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ffd fs1e">128</span></span></span></div><div class="t m5 x28 h32 y3b55 ff7 fs21 fc2 sc0 ls0 ws0">Execute<span class="_ _28"> </span><span class="ff6">valE<span class="_ _25"> </span><span class="ff12">←<span class="_ _25"> </span></span>valB<span class="_ _13"> </span><span class="ff12">+<span class="_ _13"></span><span class="ff11">(</span>−</span></span>8<span class="ff11">)<span class="_ _45"> </span><span class="ff6">valE<span class="_ _25"> </span><span class="ff12">←</span></span></span></div><div class="t m5 xd3 h32 y3b56 ffd fs1e fc2 sc0 ls0 ws0">128<span class="_ _13"> </span><span class="ff12 fs21">+<span class="_ _13"> </span><span class="ff11">(</span>−<span class="ff7">8<span class="ff11">)<span class="_ _13"> </span></span></span>=<span class="_ _13"> </span></span>120</div><div class="t m5 x28 h31 y3b57 ff7 fs21 fc2 sc0 ls0 ws0">Memory<span class="_ _2e"> </span><span class="ff6">M</span></div><div class="t m5 x1b9 h33 y3b58 ff7 fs20 fc2 sc0 ls0 ws0">8</div><div class="t m5 x5c h32 y3b57 ff7 fs21 fc2 sc0 ls0 ws0">[<span class="ff6">valE</span>]<span class="_ _22"> </span><span class="ff12">←<span class="_ _25"> </span><span class="ff6">valA<span class="_ _ba"> </span>M</span></span></div><div class="t m5 x9b h33 y3b58 ff7 fs20 fc2 sc0 ls0 ws0">8</div><div class="t m5 xbe h32 y3b59 ff7 fs21 fc2 sc0 ls0 ws0">[<span class="ffd fs1e">120</span>]<span class="_ _22"> </span><span class="ff12">←<span class="_ _25"> </span><span class="ffd fs1e">9</span></span></div><div class="t m5 x28 h32 y3b5a ff7 fs21 fc2 sc0 ls0 ws0">Write<span class="_"> </span>back<span class="_ _26"> </span><span class="ff6">R</span>[<span class="ffd fs1e">%rsp</span>]<span class="_ _23"> </span><span class="ff12">←<span class="_ _23"> </span><span class="ff6">valE<span class="_ _117"> </span>R<span class="_ _2"></span></span></span>[<span class="ffd fs1e">%rsp</span>]<span class="_ _22"> </span><span class="ff12">←<span class="_ _25"> </span><span class="ffd fs1e">120</span></span></div><div class="t m5 x28 h32 y3b5b ff7 fs21 fc2 sc0 ls0 ws0">PC<span class="_"> </span>update<span class="_ _46"> </span><span class="ff6">PC<span class="_ _25"> </span><span class="ff12">←<span class="_ _23"> </span></span>valP<span class="_ _6a"> </span>PC<span class="_ _25"> </span><span class="ff12">←<span class="_ _23"> </span><span class="ffd fs1e">0x02c</span></span></span></div><div class="t m5 x57 h2b y3b5c ff7 fs1e fc2 sc0 ls0 ws0">As<span class="_"> </span>this<span class="_ _10"> </span>trace<span class="_ _11"> </span>shows<span class="_ _1"></span>,<span class="_ _10"> </span>the<span class="_ _11"> </span>instruction<span class="_"> </span>has<span class="_ _10"> </span>the<span class="_ _11"> </span>effect<span class="_"> </span>of<span class="_ _10"> </span>setting<span class="_ _11"> </span><span class="ffd">%rsp<span class="_ _10"> </span></span>to<span class="_ _10"> </span>120,<span class="_ _11"> </span>writing<span class="_"> </span>9<span class="_ _10"> </span>to<span class="_ _11"> </span>address<span class="_"> </span>120,</div><div class="t m5 x28 h2b y3b5d ff7 fs1e fc2 sc0 ls0 ws0">and<span class="_"> </span>incrementing<span class="_"> </span>the<span class="_"> </span>PC<span class="_"> </span>by<span class="_"> </span>2.</div><div class="t m5 x1d h47 y3b5e ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>4.16<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>522)</span></div><div class="t m5 x1d h26 y3b5f ff7 fs19 fc1 sc0 ls0 ws0">Assume<span class="_ _13"> </span>the<span class="_ _13"> </span>two<span class="_"> </span>register<span class="_ _13"> </span>writes<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_"> </span>write-back<span class="_ _13"> </span>stage<span class="_ _13"> </span>for<span class="_ _13"> </span><span class="ffd">popq<span class="_ _10"> </span></span>occur<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_"> </span>order</div><div class="t m5 x1d h26 y3b60 ff7 fs19 fc1 sc0 ls0 ws0">listed<span class="_"> </span>in<span class="_ _13"> </span>Figure<span class="_ _13"> </span>4.20.<span class="_"> </span>W<span class="_ _0"></span>hat<span class="_"> </span>would<span class="_ _13"> </span>be<span class="_"> </span>the<span class="_"> </span>effect<span class="_ _13"> </span>of<span class="_"> </span>executing<span class="_"> </span><span class="ffd">popq<span class="_ _11"> </span>%rsp</span>?<span class="_"> </span>Does<span class="_ _13"> </span>this</div><div class="t m5 x1d h26 y3b61 ff7 fs19 fc1 sc0 ls0 ws0">conform<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>desired<span class="_"> </span>behavior<span class="_"> </span>for<span class="_"> </span>Y86-64,<span class="_"> </span>as<span class="_"> </span>determined<span class="_"> </span>in<span class="_"> </span>Problem<span class="_"> </span>4.8?</div><div class="t m5 x29 h26 ye4e ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_"> </span>4.21<span class="_ _13"> </span>indicates<span class="_"> </span>the<span class="_ _13"> </span>processing<span class="_ _13"> </span>of<span class="_"> </span>our<span class="_ _13"> </span>three<span class="_"> </span>control<span class="_ _13"> </span>transfer<span class="_ _13"> </span>instructions:</div><div class="t m5 x1d h26 ye4f ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>different<span class="_ _11"> </span>jumps<span class="_ _1"></span>,<span class="_ _11"> </span><span class="ffd">call</span>,<span class="_ _16"> </span>and<span class="_"> </span><span class="ffd">ret</span>.<span class="_ _11"> </span>W<span class="_ _3"></span>e<span class="_ _11"> </span>see<span class="_ _11"> </span>that<span class="_ _11"> </span>we<span class="_ _11"> </span>can<span class="_ _11"> </span>implement<span class="_ _11"> </span>these<span class="_"> </span>instruc-</div><div class="t m5 x1d h26 ye50 ff7 fs19 fc1 sc0 ls0 ws0">tions<span class="_"> </span>with<span class="_"> </span>the<span class="_"> </span>same<span class="_"> </span>overall<span class="_"> </span>ﬂow<span class="_"> </span>as<span class="_"> </span>the<span class="_"> </span>preceding<span class="_"> </span>ones<span class="_ _1"></span>.</div><div class="t m5 x29 h26 ye51 ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_ _21"> </span>with<span class="_ _21"> </span>integer<span class="_ _21"> </span>operations<span class="_ _1"></span>,<span class="_ _e"> </span>we<span class="_ _15"> </span>can<span class="_ _21"> </span>process<span class="_ _21"> </span>all<span class="_ _f"> </span>of<span class="_ _21"> </span>the<span class="_ _21"> </span>jumps<span class="_ _21"> </span>in<span class="_ _21"> </span>a<span class="_ _21"> </span>uniform</div><div class="t m5 x1d h26 ye52 ff7 fs19 fc1 sc0 ls0 ws0">manner,<span class="_ _e"> </span>since<span class="_ _21"> </span>they<span class="_ _f"> </span>differ<span class="_ _f"> </span>only<span class="_ _f"> </span>when<span class="_ _f"> </span>determining<span class="_ _f"> </span>whether<span class="_ _f"> </span>or<span class="_ _f"> </span>not<span class="_ _f"> </span>to<span class="_ _f"> </span>take<span class="_ _e"> </span>the</div><div class="t m5 x1d h26 ye53 ff7 fs19 fc1 sc0 ls0 ws0">branch.<span class="_ _22"> </span>A<span class="_ _22"> </span>jump<span class="_ _22"> </span>instruction<span class="_ _23"> </span>proceeds<span class="_ _22"> </span>through<span class="_ _22"> </span>fetch<span class="_ _22"> </span>and<span class="_ _22"> </span>decode<span class="_ _23"> </span>much<span class="_ _22"> </span>like</div><div class="t m5 x1d h26 ye54 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>previous<span class="_ _11"> </span>instructions<span class="_ _1"></span>,<span class="_"> </span>except<span class="_ _11"> </span>that<span class="_"> </span>it<span class="_ _11"> </span>does<span class="_"> </span>not<span class="_ _11"> </span>require<span class="_"> </span>a<span class="_ _11"> </span>register<span class="_"> </span>speciﬁer<span class="_ _11"> </span>byte<span class="_ _0"></span>.</div><div class="t m5 x1d h26 ye55 ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_"> </span>the<span class="_"> </span>execute<span class="_"> </span>stage<span class="_ _1"></span>,<span class="_"> </span>we<span class="_"> </span>check<span class="_"> </span>the<span class="_"> </span>condition<span class="_ _13"> </span>codes<span class="_"> </span>and<span class="_"> </span>the<span class="_"> </span>jump<span class="_"> </span>condition<span class="_"> </span>to<span class="_"> </span>de-</div><div class="t m5 x1d h26 ye56 ff7 fs19 fc1 sc0 ls0 ws0">termine<span class="_ _13"> </span>whether<span class="_"> </span>or<span class="_ _13"> </span>not<span class="_ _13"> </span>to<span class="_ _13"> </span>take<span class="_"> </span>the<span class="_ _13"> </span>branch,<span class="_ _13"> </span>yielding<span class="_ _13"> </span>a<span class="_"> </span>1-bit<span class="_ _13"> </span>signal<span class="_ _13"> </span><span class="ff6">Cnd</span>.<span class="_ _13"> </span>During<span class="_"> </span>the</div><div class="t m5 x1d h26 ye57 ff7 fs19 fc1 sc0 ls0 ws0">PC<span class="_ _11"> </span>update<span class="_ _11"> </span>stage,<span class="_"> </span>we<span class="_ _16"> </span>test<span class="_"> </span>this<span class="_ _16"> </span>ﬂag<span class="_ _11"> </span>and<span class="_ _11"> </span>set<span class="_ _11"> </span>the<span class="_ _11"> </span>PC<span class="_ _16"> </span>to<span class="_ _11"> </span><span class="ff6">valC<span class="_ _11"> </span></span>(the<span class="_ _11"> </span>jump<span class="_ _16"> </span>target)<span class="_"> </span>if<span class="_ _16"> </span>the</div><div class="t m5 x1d h26 ye58 ff7 fs19 fc1 sc0 ls0 ws0">ﬂag<span class="_"> </span>is<span class="_ _11"> </span>1<span class="_ _11"> </span>and<span class="_ _11"> </span>to<span class="_ _11"> </span><span class="ff6">valP<span class="_ _11"> </span></span>(the<span class="_"> </span>address<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>following<span class="_"> </span>instruction)<span class="_ _11"> </span>if<span class="_ _11"> </span>the<span class="_ _11"> </span>ﬂag<span class="_ _11"> </span>is<span class="_"> </span>0.<span class="_ _11"> </span>Our</div><div class="t m5 x1d h26 ye59 ff7 fs19 fc1 sc0 ls0 ws0">notation<span class="_"> </span><span class="ff11">x<span class="_ _11"> </span></span>?<span class="_ _13"> </span><span class="ff11">a<span class="_ _11"> </span></span>:<span class="_ _13"> </span><span class="ff11">b<span class="_ _11"> </span></span>is<span class="_"> </span>similar<span class="_ _11"> </span>to<span class="_"> </span>the<span class="_ _11"> </span>conditional<span class="_"> </span>expression<span class="_ _11"> </span>in<span class="_"> </span>C—it<span class="_ _11"> </span>yields<span class="_"> </span><span class="ff11">a<span class="_"> </span></span>when<span class="_"> </span><span class="ff11">x</span></div><div class="t m5 x1d h26 y3b62 ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_"> </span>1<span class="_"> </span>and<span class="_"> </span><span class="ff11">b<span class="_ _10"> </span></span>when<span class="_"> </span><span class="ff11">x<span class="_"> </span></span>is<span class="_"> </span>0.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
