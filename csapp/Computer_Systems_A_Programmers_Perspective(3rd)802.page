<div id="pf322" class="pf w2 h11" data-page-no="322"><div class="pc pc322 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg322.png"/><div class="t m5 x1e0 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>8.5<span class="_ _60"> </span>Signals<span class="_ _3e"> </span><span class="ffe fs1e">801</span></div><div class="t m5 x31 h2d y68db ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;signal.h&gt;</div><div class="t m5 x31 h2d y68dc ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>sigprocmask(int<span class="_ _1f"> </span>how,<span class="_ _1f"> </span>const<span class="_ _e"> </span>sigset_t<span class="_ _1f"> </span>*set,<span class="_ _e"> </span>sigset_t<span class="_ _1f"> </span>*oldset);</div><div class="t m5 x31 h2d y68dd ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>sigemptyset(sigset_t<span class="_ _1f"> </span>*set);</div><div class="t m5 x31 h2d y68de ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>sigfillset(sigset_t<span class="_ _1f"> </span>*set);</div><div class="t m5 x31 h2d y68df ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>sigaddset(sigset_t<span class="_ _1f"> </span>*set,<span class="_ _1f"> </span>int<span class="_ _e"> </span>signum);</div><div class="t m5 x31 h2d y68e0 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>sigdelset(sigset_t<span class="_ _1f"> </span>*set,<span class="_ _1f"> </span>int<span class="_ _e"> </span>signum);</div><div class="t m5 x1db hf2 y68e1 ff7 fs1f fc2 sc0 ls0 ws0">Returns:<span class="_"> </span>0<span class="_"> </span>if<span class="_"> </span>OK,<span class="_"> </span><span class="ff12">−</span>1<span class="_ _13"> </span>on<span class="_"> </span>error</div><div class="t m5 x31 h2d y68e2 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>sigismember(const<span class="_ _1f"> </span>sigset_t<span class="_ _1f"> </span>*set,<span class="_ _e"> </span>int<span class="_ _1f"> </span>signum);</div><div class="t m5 x68 hf2 y68e3 ff7 fs1f fc2 sc0 ls0 ws0">Returns:<span class="_"> </span>1<span class="_"> </span>if<span class="_"> </span>member,<span class="_"> </span>0<span class="_"> </span>if<span class="_"> </span>not,<span class="_"> </span><span class="ff12">−</span>1<span class="_ _6"> </span>on<span class="_"> </span>error</div><div class="t m5 x26 h26 y68e4 ff7 fs19 fc2 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _16"> </span><span class="ffd ls0">sigprocmask<span class="_ _16"> </span><span class="ff7">function<span class="_ _11"> </span>changes<span class="_ _16"> </span>the<span class="_ _11"> </span>set<span class="_ _16"> </span>of<span class="_ _11"> </span>currently<span class="_ _11"> </span>blocked<span class="_ _16"> </span>signals<span class="_ _11"> </span>(the</span></span></div><div class="t m5 x17 h26 y68e5 ffd fs19 fc2 sc0 ls0 ws0">blocked<span class="_ _10"> </span><span class="ff7">bit<span class="_ _11"> </span>vector<span class="_ _11"> </span>described<span class="_ _11"> </span>in<span class="_"> </span>Section<span class="_ _11"> </span>8.5.1).<span class="_ _11"> </span>T<span class="_ _1"></span>he<span class="_ _11"> </span>speciﬁc<span class="_ _11"> </span>behavior<span class="_ _11"> </span>depends<span class="_"> </span>on</span></div><div class="t m5 x17 h26 y68e6 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>value<span class="_"> </span>of<span class="_"> </span><span class="ffd">how</span>:</div><div class="t m5 x62 h26 y68e7 ff7 fs19 fc2 sc0 ls0 ws0">SIG_BLOCK.<span class="_ _e"> </span>Add<span class="_"> </span>the<span class="_"> </span>signals<span class="_"> </span>in<span class="_ _13"> </span><span class="ffd">set<span class="_ _10"> </span></span>to<span class="_"> </span><span class="ffd">blocked<span class="_ _13"> </span></span>(<span class="ffd">blocked<span class="_ _16"> </span>=<span class="_ _16"> </span>blocked<span class="_ _11"> </span>|<span class="_ _16"> </span>set</span>).</div><div class="t m5 x62 h26 y68e8 ff7 fs19 fc2 sc0 ls0 ws0">SIG_UNBLOCK.<span class="_ _e"> </span>Remove<span class="_ _25"> </span>the<span class="_ _25"> </span>signals<span class="_ _25"> </span>in<span class="_ _25"> </span><span class="ffd">set<span class="_ _25"> </span></span>from<span class="_ _25"> </span><span class="ffd">blocked<span class="_ _25"> </span></span>(<span class="ffd">blocked<span class="_ _16"> </span>=</span></div><div class="t m5 x30 h26 y68e9 ffd fs19 fc2 sc0 ls0 ws0">blocked<span class="_ _11"> </span>&amp;<span class="_ _16"> </span>~set<span class="ff7">).</span></div><div class="t m5 x62 h26 y68ea ff7 fs19 fc2 sc0 ls0 ws0">SIG_SETMASK.<span class="_ _e"> </span><span class="ffd">blocked<span class="_ _16"> </span>=<span class="_ _16"> </span>set</span>.</div><div class="t m5 x17 h26 y68eb ff7 fs19 fc2 sc0 ls0 ws0">If<span class="_"> </span><span class="ffd">oldset<span class="_ _10"> </span></span>is<span class="_"> </span>non-NULL,<span class="_"> </span>the<span class="_ _11"> </span>previous<span class="_"> </span>value<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span><span class="ffd">blocked<span class="_ _10"> </span></span>bit<span class="_ _11"> </span>vector<span class="_"> </span>is<span class="_"> </span>stored<span class="_"> </span>in</div><div class="t m5 x17 h26 y68ec ffd fs19 fc2 sc0 ls0 ws0">oldset<span class="ff7">.</span></div><div class="t m5 x26 h26 y68ed ff7 fs19 fc2 sc0 ls0 ws0">Signal<span class="_ _14"> </span>sets<span class="_ _14"> </span>such<span class="_ _14"> </span>as<span class="_ _14"> </span><span class="ffd">set<span class="_ _14"> </span></span>are<span class="_ _14"> </span>manipulated<span class="_ _14"> </span>using<span class="_ _14"> </span>the<span class="_ _14"> </span>following<span class="_ _14"> </span>functions:<span class="_ _14"> </span>The</div><div class="t m5 x17 h26 y68ee ffd fs19 fc2 sc0 ls0 ws0">sigemptyset<span class="_ _13"> </span><span class="ff7">initializes<span class="_ _6"> </span></span>set<span class="_ _13"> </span><span class="ff7">to<span class="_ _6"> </span>the<span class="_ _13"> </span>empty<span class="_ _6"> </span>set.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_ _6"> </span><span class="ffd">sigfillset<span class="_ _13"> </span></span>function<span class="_ _6"> </span>adds<span class="_ _13"> </span>every</span></div><div class="t m5 x17 h26 y68ef ff7 fs19 fc2 sc0 ls0 ws0">signal<span class="_ _14"> </span>to<span class="_ _14"> </span><span class="ffd">set</span><span class="ls288">.T<span class="_ _12"></span>h<span class="_ _42"></span>e<span class="ffd ls0">sigaddset<span class="_ _14"> </span><span class="ff7">function<span class="_ _14"> </span>adds<span class="_ _15"> </span></span>signum<span class="_ _14"> </span><span class="ff7">to<span class="_ _14"> </span></span>set<span class="ff7">,<span class="_ _21"> </span></span>sigdelset<span class="_ _14"> </span><span class="ff7">deletes</span></span></span></div><div class="t m5 x17 h26 y68f0 ffd fs19 fc2 sc0 ls0 ws0">signum<span class="_ _11"> </span><span class="ff7">from<span class="_"> </span></span>set<span class="ff7">,<span class="_ _16"> </span>and<span class="_"> </span></span>sigismember<span class="_ _11"> </span><span class="ff7">returns<span class="_ _11"> </span>1<span class="_ _11"> </span>if<span class="_ _11"> </span></span>signum<span class="_ _11"> </span><span class="ff7">is<span class="_"> </span>a<span class="_ _11"> </span>member<span class="_ _11"> </span>of<span class="_ _11"> </span></span>set<span class="ff7">,<span class="_ _11"> </span>and</span></div><div class="t m5 x17 h26 y68f1 ff7 fs19 fc2 sc0 ls0 ws0">0<span class="_"> </span>if<span class="_"> </span>not.</div><div class="t m5 x26 h26 y68f2 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _11"> </span>example<span class="_ _0"></span>,<span class="_ _11"> </span>Figure<span class="_"> </span>8.32<span class="_ _11"> </span>shows<span class="_ _16"> </span>how<span class="_"> </span>you<span class="_ _16"> </span>would<span class="_"> </span>use<span class="_ _16"> </span><span class="ffd">sigprocmask<span class="_ _11"> </span></span>to<span class="_ _11"> </span>tempo-</div><div class="t m5 x17 h26 y68f3 ff7 fs19 fc2 sc0 ls0 ws0">rarily<span class="_"> </span>block<span class="_"> </span>the<span class="_"> </span>receipt<span class="_"> </span>of<span class="_"> </span>SIGINT<span class="_"> </span>signals<span class="_ _1"></span>.</div><div class="t m5 x2c h2e y68f4 ff6 fs20 fc6 sc0 ls0 ws0">1</div><div class="t m5 x142 h2d y68f5 ffd fs1e fc2 sc0 ls0 ws0">sigset_t<span class="_ _e"> </span>mask,<span class="_ _1f"> </span>prev_mask;</div><div class="t m5 x2c h2e y68f6 ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x2c h2e y68f7 ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x142 h2d y68f8 ffd fs1e fc2 sc0 ls0 ws0">Sigemptyset(&amp;mask);</div><div class="t m5 x2c h2e y68f9 ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 x142 h2d y68fa ffd fs1e fc2 sc0 ls0 ws0">Sigaddset(&amp;mask,<span class="_ _e"> </span>SIGINT);</div><div class="t m5 x2c h2e y68fb ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x2c h2e y68fc ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 x142 h2d y68fd ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Block<span class="_ _1f"> </span>SIGINT<span class="_ _1f"> </span>and<span class="_ _e"> </span>save<span class="_ _1f"> </span>previous<span class="_ _e"> </span>blocked<span class="_ _1f"> </span>set<span class="_ _1f"> </span>*/</div><div class="t m5 x2c h2d y68fe ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _20"> </span><span class="ffd fs1e fc2">Sigprocmask(SIG_BLOCK,<span class="_ _e"> </span>&amp;mask,<span class="_ _1f"> </span>&amp;prev_mask);</span></div><div class="t m5 x2c h2e y68ff ff6 fs20 fc6 sc0 ls0 ws0">8</div><div class="t m5 x142 h2d y6900 ffd fs1e fc2 sc0 ls0 ws0">.</div><div class="t m5 x142 h2d y6901 ffd fs1e fc2 sc0 ls0 ws0">.</div><div class="t m5 x142 h2d y6902 ffd fs1e fc2 sc0 ls0 ws0">.</div><div class="t m5 x1d h53 y6903 ffa fs1e fc2 sc0 ls0 ws0">//<span class="_"> </span>Code<span class="_"> </span>region<span class="_"> </span>that<span class="_"> </span>will<span class="_"> </span>not<span class="_"> </span>be<span class="_"> </span>interrupted<span class="_"> </span>by<span class="_"> </span>SIGINT</div><div class="t m5 x2c h2d y6904 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _20"> </span><span class="ffd fs1e fc2">/*<span class="_ _e"> </span>Restore<span class="_ _1f"> </span>previous<span class="_ _1f"> </span>blocked<span class="_ _e"> </span>set,<span class="_ _1f"> </span>unblocking<span class="_ _e"> </span>SIGINT<span class="_ _1f"> </span>*/</span></div><div class="t m5 x17 h2d y260b ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _20"> </span><span class="ffd fs1e fc2">Sigprocmask(SIG_SETMASK,<span class="_ _e"> </span>&amp;prev_mask,<span class="_ _1f"> </span>NULL);</span></div><div class="t m5 x17 h2e y6905 ff6 fs20 fc6 sc0 ls0 ws0">11</div><div class="t m5 x17 h2f y6906 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>8.32<span class="_ _66"> </span><span class="fc1">T<span class="_ _1"></span>emporarily<span class="_"> </span>blocking<span class="_"> </span>a<span class="_"> </span>signal<span class="_"> </span>from<span class="_"> </span>being<span class="_"> </span>received.</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
