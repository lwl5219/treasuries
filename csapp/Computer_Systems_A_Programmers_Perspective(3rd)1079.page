<div id="pf437" class="pf w2 h11" data-page-no="437"><div class="pc pc437 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg437.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">1078<span class="_ _1b"> </span><span class="ff6 fs1f">Appendix<span class="_ _10"> </span>A<span class="_ _3d"> </span>Error<span class="_ _10"> </span>Handling</span></div><div class="t m5 x1d h3b ye7 fff fs24 fc6 sc0 ls0 ws0">A.1<span class="_ _17"> </span><span class="ffe fs18">Error<span class="_"> </span>Handling<span class="_"> </span>in<span class="_"> </span>Unix<span class="_"> </span>Systems</span></div><div class="t m5 x1d h26 y327 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _21"> </span>systems-level<span class="_ _15"> </span>function<span class="_ _21"> </span>calls<span class="_ _21"> </span>that<span class="_ _15"> </span>we<span class="_ _21"> </span>will<span class="_ _15"> </span>encounter<span class="_ _21"> </span>in<span class="_ _15"> </span>this<span class="_ _21"> </span>book<span class="_ _21"> </span>use<span class="_ _15"> </span>three</div><div class="t m5 x1d h26 y328 ff7 fs19 fc1 sc0 ls0 ws0">different<span class="_"> </span>styles<span class="_"> </span>for<span class="_"> </span>returning<span class="_"> </span>errors:<span class="_"> </span><span class="ffa">Unix-style</span>,<span class="_"> </span><span class="ffa">P<span class="_ _1"></span>osix-style<span class="ff7">,<span class="_"> </span>and<span class="_"> </span></span>GAI-style<span class="ff7">.</span></span></div><div class="t m5 x1d h42 y8612 ff6 fs29 fc6 sc0 ls0 ws0">Unix-Style<span class="_ _11"> </span>Error<span class="_ _16"> </span>Handling</div><div class="t m5 x1d h26 y8613 ff7 fs19 fc1 sc0 ls0 ws0">Functions<span class="_ _13"> </span>such<span class="_ _13"> </span>as<span class="_ _6"> </span><span class="ffd">fork<span class="_ _13"> </span></span>and<span class="_ _13"> </span><span class="ffd">wait<span class="_ _13"> </span></span>that<span class="_ _13"> </span>were<span class="_ _13"> </span>developed<span class="_ _6"> </span>in<span class="_ _13"> </span>the<span class="_ _13"> </span>early<span class="_ _13"> </span>days<span class="_ _13"> </span>of<span class="_ _6"> </span>Unix<span class="_ _13"> </span>(as</div><div class="t m5 x1d h26 y8614 ff7 fs19 fc1 sc0 ls0 ws0">well<span class="_"> </span>as<span class="_"> </span>some<span class="_ _11"> </span>older<span class="_"> </span>P<span class="_ _1"></span>osix<span class="_ _11"> </span>functions)<span class="_"> </span>overload<span class="_ _11"> </span>the<span class="_"> </span>function<span class="_"> </span>return<span class="_ _11"> </span>value<span class="_"> </span>with<span class="_ _11"> </span>both</div><div class="t m5 x1d h26 y8615 ff7 fs19 fc1 sc0 ls0 ws0">error<span class="_ _16"> </span>codes<span class="_ _16"> </span><span class="ffa">and<span class="_ _14"> </span></span>useful<span class="_ _16"> </span>results<span class="_ _1"></span>.<span class="_ _16"> </span>F<span class="_ _1"></span>or<span class="_ _14"> </span>example<span class="_ _1"></span>,<span class="_ _14"> </span>when<span class="_ _16"> </span>the<span class="_ _16"> </span>Unix-style<span class="_ _14"> </span><span class="ffd">wait<span class="_ _16"> </span></span>function</div><div class="t m5 x1d h46 y8616 ff7 fs19 fc1 sc0 ls0 ws0">encounters<span class="_"> </span>an<span class="_"> </span>error<span class="_ _13"> </span>(e.g<span class="_ _0"></span>.,<span class="_"> </span>there<span class="_"> </span>is<span class="_ _13"> </span>no<span class="_"> </span>child<span class="_"> </span>process<span class="_"> </span>to<span class="_"> </span>reap),<span class="_"> </span>it<span class="_ _13"> </span>returns<span class="_"> </span><span class="ff12">−</span>1<span class="_ _13"> </span>and<span class="_"> </span>sets</div><div class="t m5 x1d h26 y8617 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>global<span class="_"> </span>variable<span class="_ _13"> </span><span class="ffd">errno<span class="_ _10"> </span></span>to<span class="_"> </span>an<span class="_"> </span>error<span class="_"> </span>code<span class="_"> </span>that<span class="_ _13"> </span>indicates<span class="_"> </span>the<span class="_"> </span>cause<span class="_"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>error.<span class="_"> </span>If</div><div class="t m5 x1d h26 y8618 ffd fs19 fc1 sc0 ls0 ws0">wait<span class="_ _10"> </span><span class="ff7">completes<span class="_ _11"> </span>successfully<span class="_ _3"></span>,<span class="_"> </span>then<span class="_"> </span>it<span class="_ _11"> </span>returns<span class="_"> </span>the<span class="_ _11"> </span>useful<span class="_"> </span>result,<span class="_ _11"> </span>which<span class="_"> </span>is<span class="_"> </span>the<span class="_ _11"> </span>PID<span class="_"> </span>of</span></div><div class="t m5 x1d h26 y8619 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _13"> </span>reaped<span class="_ _13"> </span>child.<span class="_ _13"> </span>Unix-style<span class="_ _13"> </span>error<span class="_ _3"></span>-handling<span class="_ _13"> </span>code<span class="_ _13"> </span>is<span class="_ _13"> </span>typically<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>following<span class="_ _13"> </span>form:</div><div class="t m5 x1f h2e y861a ff6 fs20 fc6 sc0 ls0 ws0">1</div><div class="t m5 x33 h2d y861b ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>((pid<span class="_ _1f"> </span>=<span class="_ _1f"> </span>wait(NULL))<span class="_ _e"> </span>&lt;<span class="_ _1f"> </span>0)<span class="_ _e"> </span>{</div><div class="t m5 x1f h2d y861c ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _70"> </span><span class="ffd fs1e fc2">fprintf(stderr,<span class="_ _e"> </span>&quot;wait<span class="_ _1f"> </span>error:<span class="_ _1f"> </span>%s\n&quot;,<span class="_ _e"> </span>strerror(errno));</span></div><div class="t m5 x1f h2d y861d ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _70"> </span><span class="ffd fs1e fc2">exit(0);</span></div><div class="t m5 x1f h2e y861e ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 x33 h2d y861f ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x29 h26 y8620 ff7 fs19 fc2 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _21"> </span><span class="ffd ls0">strerror<span class="_ _15"> </span><span class="ff7">function<span class="_ _21"> </span>returns<span class="_ _15"> </span>a<span class="_ _15"> </span>text<span class="_ _15"> </span>description<span class="_ _15"> </span>for<span class="_ _21"> </span>a<span class="_ _15"> </span>particular<span class="_ _15"> </span>value<span class="_ _15"> </span>of</span></span></div><div class="t m5 x1d h26 y8621 ffd fs19 fc2 sc0 ls0 ws0">errno<span class="ff7">.</span></div><div class="t m5 x1d h42 y8622 ff6 fs29 fc6 sc0 ls0 ws0">Posix-Style<span class="_ _11"> </span>Error<span class="_ _16"> </span>Handling</div><div class="t m5 x1d h26 y8623 ff7 fs19 fc1 sc0 ls0 ws0">Many<span class="_ _14"> </span>of<span class="_ _14"> </span>the<span class="_ _15"> </span>newer<span class="_ _14"> </span>P<span class="_ _1"></span>osix<span class="_ _15"> </span>functions<span class="_ _14"> </span>such<span class="_ _14"> </span>as<span class="_ _15"> </span>Pthreads<span class="_ _14"> </span>use<span class="_ _14"> </span>the<span class="_ _15"> </span>return<span class="_ _14"> </span>value<span class="_ _14"> </span>only</div><div class="t m5 x1d h26 y8624 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _14"> </span>indicate<span class="_ _14"> </span>success<span class="_ _14"> </span>(zero)<span class="_ _14"> </span>or<span class="_ _14"> </span>failure<span class="_ _14"> </span>(nonzero).<span class="_ _14"> </span>Any<span class="_ _14"> </span>useful<span class="_ _14"> </span>results<span class="_ _14"> </span>are<span class="_ _14"> </span>returned</div><div class="t m5 x1d h26 y8625 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_"> </span>function<span class="_ _11"> </span>arguments<span class="_ _11"> </span>that<span class="_"> </span>are<span class="_ _11"> </span>passed<span class="_ _11"> </span>by<span class="_"> </span>reference.<span class="_"> </span>W<span class="_ _3"></span>e<span class="_ _11"> </span>refer<span class="_"> </span>to<span class="_ _11"> </span>this<span class="_ _11"> </span>approach<span class="_ _11"> </span>as</div><div class="t m5 x1d h26 y8626 ffa fs19 fc1 sc0 ls0 ws0">P<span class="_ _1"></span>osix-style<span class="_ _13"> </span>error<span class="_ _13"> </span>handling<span class="_ _2"></span><span class="ff7">.<span class="_ _13"> </span>F<span class="_ _1"></span>or<span class="_"> </span>example<span class="_ _1"></span>,<span class="_ _13"> </span>the<span class="_ _13"> </span>P<span class="_ _0"></span>osix-style<span class="_ _13"> </span><span class="ffd">pthread_create<span class="_ _13"> </span></span>function</span></div><div class="t m5 x1d h26 y8627 ff7 fs19 fc1 sc0 ls0 ws0">indicates<span class="_ _11"> </span>success<span class="_ _11"> </span>or<span class="_ _11"> </span>failure<span class="_ _16"> </span>with<span class="_"> </span>its<span class="_ _16"> </span>return<span class="_"> </span>value<span class="_ _16"> </span>and<span class="_"> </span>returns<span class="_ _16"> </span>the<span class="_"> </span>ID<span class="_ _16"> </span>of<span class="_"> </span>the<span class="_ _16"> </span>newly</div><div class="t m5 x1d h26 y8628 ff7 fs19 fc1 sc0 ls0 ws0">created<span class="_ _14"> </span>thread<span class="_ _14"> </span>(the<span class="_ _14"> </span>useful<span class="_ _14"> </span>result)<span class="_ _14"> </span>by<span class="_ _14"> </span>reference<span class="_ _14"> </span>in<span class="_ _14"> </span>its<span class="_ _14"> </span>ﬁrst<span class="_ _14"> </span>argument.<span class="_ _14"> </span>Posix-style</div><div class="t m5 x1d h26 y8629 ff7 fs19 fc1 sc0 ls0 ws0">error<span class="_ _1"></span>-handling<span class="_"> </span>code<span class="_"> </span>is<span class="_"> </span>typically<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>form:</div><div class="t m5 x19f h2d y862a ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _73"> </span><span class="ffd fs1e fc2">if<span class="_ _1f"> </span>((retcode<span class="_ _e"> </span>=<span class="_ _1f"> </span>pthread_create(&amp;tid,<span class="_ _1f"> </span>NULL,<span class="_ _e"> </span>thread,<span class="_ _1f"> </span>NULL))<span class="_ _e"> </span>!=<span class="_ _1f"> </span>0)<span class="_ _1f"> </span>{</span></div><div class="t m5 x19f h2d y862b ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _ed"> </span><span class="ffd fs1e fc2">fprintf(stderr,<span class="_ _e"> </span>&quot;pthread_create<span class="_ _1f"> </span>error:<span class="_ _1f"> </span>%s\n&quot;,<span class="_ _e"> </span>strerror(retcode));</span></div><div class="t m5 x19f h2d y862c ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _ed"> </span><span class="ffd fs1e fc2">exit(0);</span></div><div class="t m5 x19f h2d y862d ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _73"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x29 h26 y862e ff7 fs19 fc2 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _21"> </span><span class="ffd ls0">strerror<span class="_ _15"> </span><span class="ff7">function<span class="_ _21"> </span>returns<span class="_ _15"> </span>a<span class="_ _15"> </span>text<span class="_ _15"> </span>description<span class="_ _15"> </span>for<span class="_ _21"> </span>a<span class="_ _15"> </span>particular<span class="_ _15"> </span>value<span class="_ _15"> </span>of</span></span></div><div class="t m5 x1d h26 y862f ffd fs19 fc2 sc0 ls0 ws0">retcode<span class="ff7">.</span></div><div class="t m5 x1d h42 y8630 ff6 fs29 fc6 sc0 ls0 ws0">GAI-Style<span class="_ _11"> </span>Error<span class="_ _16"> </span>Handling</div><div class="t m5 x1d h26 y8631 ff7 fs19 fc1 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _16"> </span><span class="ffd ls0">getaddrinfo<span class="_ _10"> </span><span class="ff7">(GAI)<span class="_ _11"> </span>and<span class="_"> </span></span>getnameinfo<span class="_ _11"> </span><span class="ff7">functions<span class="_ _11"> </span>return<span class="_"> </span>zero<span class="_ _11"> </span>on<span class="_ _11"> </span>success<span class="_"> </span>and</span></span></div><div class="t m5 x1d h26 y8632 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_ _14"> </span>nonzero<span class="_ _14"> </span>value<span class="_ _14"> </span>on<span class="_ _14"> </span>failure.<span class="_ _16"> </span>GAI<span class="_ _14"> </span>error<span class="_ _1"></span>-handling<span class="_ _14"> </span>code<span class="_ _15"> </span>is<span class="_ _14"> </span>typically<span class="_ _14"> </span>of<span class="_ _14"> </span>the<span class="_ _14"> </span>follow-</div><div class="t m5 x1d h26 y8633 ff7 fs19 fc1 sc0 ls0 ws0">ing<span class="_"> </span>form:</div><div class="t m5 x35 h2d y8d6 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _73"> </span><span class="ffd fs1e fc2">if<span class="_ _1f"> </span>((retcode<span class="_ _e"> </span>=<span class="_ _1f"> </span>getaddrinfo(host,<span class="_ _1f"> </span>service,<span class="_ _e"> </span>&amp;hints,<span class="_ _1f"> </span>&amp;result))<span class="_ _e"> </span>!=<span class="_ _1f"> </span>0)<span class="_ _1f"> </span>{</span></div><div class="t m5 x35 h2d y77e ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _ed"> </span><span class="ffd fs1e fc2">fprintf(stderr,<span class="_ _e"> </span>&quot;getaddrinfo<span class="_ _1f"> </span>error:<span class="_ _1f"> </span>%s\n&quot;,<span class="_ _e"> </span>gai_strerror(retcode));</span></div><div class="t m5 x35 h2d ye95 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _ed"> </span><span class="ffd fs1e fc2">exit(0);</span></div><div class="t m5 x35 h2d y177d ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _73"> </span><span class="ffd fs1e fc2">}</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
