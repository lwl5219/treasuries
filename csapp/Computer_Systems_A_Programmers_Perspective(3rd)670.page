<div id="pf29e" class="pf w2 h11" data-page-no="29e"><div class="pc pc29e w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg29e.png"/><div class="t m5 xf5 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>6.5<span class="_ _60"> </span>Writing<span class="_ _10"> </span>Cache-Friendly<span class="_ _10"> </span>Code<span class="_ _1b"> </span><span class="ffe fs1e">669</span></div><div class="t m5 x17 h42 ye7 ff6 fs29 fc6 sc0 ls0 ws0">Impact<span class="_ _11"> </span>of<span class="_ _16"> </span>Block<span class="_ _16"> </span>Size</div><div class="t m5 x17 h26 y5bd ff7 fs19 fc1 sc0 ls0 ws0">Large<span class="_ _f"> </span>blocks<span class="_ _f"> </span>are<span class="_ _e"> </span>a<span class="_ _21"> </span>mixed<span class="_ _e"> </span>blessing<span class="_ _1"></span>.<span class="_ _e"> </span>On<span class="_ _21"> </span>the<span class="_ _f"> </span>one<span class="_ _e"> </span>hand,<span class="_ _e"> </span>larger<span class="_ _21"> </span>blocks<span class="_ _e"> </span>can<span class="_ _21"> </span>help</div><div class="t m5 x17 h26 y5be ff7 fs19 fc1 sc0 ls0 ws0">increase<span class="_ _13"> </span>the<span class="_ _6"> </span>hit<span class="_ _13"> </span>rate<span class="_ _6"> </span>by<span class="_ _13"> </span>exploiting<span class="_ _6"> </span>any<span class="_ _13"> </span>spatial<span class="_ _6"> </span>locality<span class="_ _13"> </span>that<span class="_ _13"> </span>might<span class="_ _6"> </span>exist<span class="_ _13"> </span>in<span class="_ _6"> </span>a<span class="_ _13"> </span>program.</div><div class="t m5 x17 h26 y5bf ff7 fs19 fc1 sc0 ls0 ws0">However,<span class="_ _16"> </span>for<span class="_ _11"> </span>a<span class="_ _16"> </span>given<span class="_ _16"> </span>cache<span class="_ _16"> </span>size<span class="_ _1"></span>,<span class="_ _16"> </span>larger<span class="_ _16"> </span>blocks<span class="_ _16"> </span>imply<span class="_ _16"> </span>a<span class="_ _16"> </span>smaller<span class="_ _11"> </span>number<span class="_ _16"> </span>of<span class="_ _16"> </span>cache</div><div class="t m5 x17 h26 y5c0 ff7 fs19 fc1 sc0 ls0 ws0">lines<span class="_ _1"></span>,<span class="_ _14"> </span>which<span class="_ _16"> </span>can<span class="_ _14"> </span>hurt<span class="_ _16"> </span>the<span class="_ _16"> </span>hit<span class="_ _14"> </span>rate<span class="_ _16"> </span>in<span class="_ _14"> </span>programs<span class="_ _16"> </span>with<span class="_ _16"> </span>more<span class="_ _14"> </span>temporal<span class="_ _16"> </span>locality<span class="_ _14"> </span>than</div><div class="t m5 x17 h26 y5c1 ff7 fs19 fc1 sc0 ls0 ws0">spatial<span class="_ _14"> </span>locality<span class="_ _3"></span>.<span class="_ _14"> </span>Larger<span class="_ _14"> </span>blocks<span class="_ _15"> </span>also<span class="_ _14"> </span>have<span class="_ _15"> </span>a<span class="_ _14"> </span>negative<span class="_ _14"> </span>impact<span class="_ _15"> </span>on<span class="_ _14"> </span>the<span class="_ _14"> </span>miss<span class="_ _15"> </span>penalty<span class="_ _3"></span>,</div><div class="t m5 x17 h26 y5c2 ff7 fs19 fc1 sc0 ls0 ws0">since<span class="_"> </span>larger<span class="_ _11"> </span>blocks<span class="_ _11"> </span>cause<span class="_"> </span>larger<span class="_ _11"> </span>transfer<span class="_ _11"> </span>times<span class="_ _1"></span>.<span class="_"> </span>Modern<span class="_ _11"> </span>systems<span class="_ _11"> </span>such<span class="_"> </span>as<span class="_ _11"> </span>the<span class="_ _11"> </span>Core</div><div class="t m5 x17 h26 y5c3 ff7 fs19 fc1 sc0 ls0 ws0">i7<span class="_"> </span>compromise<span class="_"> </span>with<span class="_"> </span>cache<span class="_"> </span>blocks<span class="_"> </span>that<span class="_"> </span>contain<span class="_"> </span>64<span class="_"> </span>bytes<span class="_ _1"></span>.</div><div class="t m5 x17 h42 y5906 ff6 fs29 fc6 sc0 ls0 ws0">Impact<span class="_ _11"> </span>of<span class="_ _16"> </span>Associativity</div><div class="t m5 x17 h26 y5907 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _15"> </span>issue<span class="_ _15"> </span>here<span class="_ _15"> </span>is<span class="_ _14"> </span>the<span class="_ _15"> </span>impact<span class="_ _15"> </span>of<span class="_ _14"> </span>the<span class="_ _15"> </span>choice<span class="_ _15"> </span>of<span class="_ _15"> </span>the<span class="_ _14"> </span>parameter<span class="_ _15"> </span><span class="ff11">E<span class="_ _5"></span></span>,<span class="_ _21"> </span>the<span class="_ _14"> </span>number<span class="_ _15"> </span>of</div><div class="t m5 x17 h26 y5908 ff7 fs19 fc1 sc0 ls0 ws0">cache<span class="_"> </span>lines<span class="_"> </span>per<span class="_"> </span>set.<span class="_ _13"> </span>The<span class="_"> </span>advantage<span class="_ _13"> </span>of<span class="_"> </span>higher<span class="_"> </span>associativity<span class="_"> </span>(i.e<span class="_ _1"></span>.,<span class="_"> </span>larger<span class="_"> </span>values<span class="_"> </span>of<span class="_"> </span><span class="ff11">E<span class="_ _2"></span></span>)</div><div class="t m5 x17 h26 y5909 ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_ _6"> </span>that<span class="_ _13"> </span>it<span class="_ _6"> </span>decreases<span class="_ _13"> </span>the<span class="_ _6"> </span>vulnerability<span class="_ _13"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>cache<span class="_ _6"> </span>to<span class="_ _13"> </span>thrashing<span class="_ _6"> </span>due<span class="_ _13"> </span>to<span class="_ _6"> </span>conﬂict<span class="_ _13"> </span>misses<span class="_ _3"></span>.</div><div class="t m5 x17 h26 y590a ff7 fs19 fc1 sc0 ls0 ws0">However,<span class="_ _16"> </span>higher<span class="_ _11"> </span>associativity<span class="_ _16"> </span>comes<span class="_ _16"> </span>at<span class="_ _16"> </span>a<span class="_ _16"> </span>signiﬁcant<span class="_ _11"> </span>cost.<span class="_ _16"> </span>Higher<span class="_ _16"> </span>associativity<span class="_ _16"> </span>is</div><div class="t m5 x17 h26 y590b ff7 fs19 fc1 sc0 ls0 ws0">expensive<span class="_ _21"> </span>to<span class="_ _f"> </span>implement<span class="_ _21"> </span>and<span class="_ _f"> </span>hard<span class="_ _21"> </span>to<span class="_ _f"> </span>make<span class="_ _21"> </span>fast.<span class="_ _f"> </span>It<span class="_ _f"> </span>requires<span class="_ _21"> </span>more<span class="_ _f"> </span>tag<span class="_ _21"> </span>bits<span class="_ _f"> </span>per</div><div class="t m5 x17 h26 y590c ff7 fs19 fc1 sc0 ls0 ws0">line<span class="_ _1"></span>,<span class="_ _1f"> </span>additional<span class="_ _f"> </span>LRU<span class="_ _f"> </span>state<span class="_ _e"> </span>bits<span class="_ _21"> </span>per<span class="_ _e"> </span>line<span class="_ _1"></span>,<span class="_ _1f"> </span>and<span class="_ _f"> </span>additional<span class="_ _e"> </span>control<span class="_ _f"> </span>logic.<span class="_ _f"> </span>Higher</div><div class="t m5 x17 h26 y590d ff7 fs19 fc1 sc0 ls0 ws0">associativity<span class="_ _13"> </span>can<span class="_"> </span>increase<span class="_ _13"> </span>hit<span class="_"> </span>time<span class="_ _1"></span>,<span class="_"> </span>because<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>increased<span class="_ _13"> </span>complexity<span class="_ _3"></span>,<span class="_"> </span>and<span class="_ _13"> </span>it<span class="_ _13"> </span>can</div><div class="t m5 x17 h26 y590e ff7 fs19 fc1 sc0 ls0 ws0">also<span class="_"> </span>increase<span class="_ _11"> </span>the<span class="_"> </span>miss<span class="_ _11"> </span>penalty<span class="_"> </span>because<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_"> </span>increased<span class="_ _11"> </span>complexity<span class="_"> </span>of<span class="_ _11"> </span>choosing<span class="_"> </span>a</div><div class="t m5 x17 h26 y590f ff7 fs19 fc1 sc0 ls0 ws0">victim<span class="_"> </span>line<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y5910 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _16"> </span>choice<span class="_ _11"> </span>of<span class="_ _16"> </span>associativity<span class="_ _11"> </span>ultimately<span class="_ _16"> </span>boils<span class="_ _11"> </span>down<span class="_ _16"> </span>to<span class="_ _11"> </span>a<span class="_ _16"> </span>trade-off<span class="_ _11"> </span>between<span class="_ _16"> </span>the</div><div class="t m5 x17 h26 y5911 ff7 fs19 fc1 sc0 ls0 ws0">hit<span class="_ _6"> </span>time<span class="_ _13"> </span>and<span class="_ _6"> </span>the<span class="_ _13"> </span>miss<span class="_ _6"> </span>penalty<span class="_ _3"></span>.<span class="_ _13"> </span>T<span class="_ _7"></span>raditionally<span class="_ _3"></span>,<span class="_ _13"> </span>high-performance<span class="_ _6"> </span>systems<span class="_ _13"> </span>that<span class="_ _6"> </span>pushed</div><div class="t m5 x17 h26 y5912 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>clock<span class="_ _11"> </span>rates<span class="_ _11"> </span>would<span class="_ _11"> </span>opt<span class="_ _11"> </span>for<span class="_ _11"> </span>smaller<span class="_ _11"> </span>associativity<span class="_ _11"> </span>for<span class="_ _11"> </span>L1<span class="_ _11"> </span>caches<span class="_ _11"> </span>(where<span class="_ _11"> </span>the<span class="_ _11"> </span>miss</div><div class="t m5 x17 h26 y5913 ff7 fs19 fc1 sc0 ls0 ws0">penalty<span class="_ _14"> </span>is<span class="_ _14"> </span>only<span class="_ _14"> </span>a<span class="_ _15"> </span>few<span class="_ _14"> </span>cycles)<span class="_ _16"> </span>and<span class="_ _15"> </span>a<span class="_ _14"> </span>higher<span class="_ _14"> </span>degree<span class="_ _14"> </span>of<span class="_ _15"> </span>associativity<span class="_ _14"> </span>for<span class="_ _14"> </span>the<span class="_ _14"> </span>lower</div><div class="t m5 x17 h26 y5914 ff7 fs19 fc1 sc0 ls0 ws0">levels<span class="_ _1"></span>,<span class="_"> </span>where<span class="_ _13"> </span>the<span class="_"> </span>miss<span class="_ _13"> </span>penalty<span class="_"> </span>is<span class="_ _13"> </span>higher.<span class="_ _13"> </span>F<span class="_ _1"></span>or<span class="_"> </span>example<span class="_ _1"></span>,<span class="_"> </span>in<span class="_"> </span>Intel<span class="_ _13"> </span>Core<span class="_"> </span>i7<span class="_ _13"> </span>systems<span class="_ _1"></span>,<span class="_"> </span>the</div><div class="t m5 x17 h26 y5915 ff7 fs19 fc1 sc0 ls0 ws0">L1<span class="_"> </span>and<span class="_"> </span>L2<span class="_"> </span>caches<span class="_"> </span>are<span class="_"> </span>8-way<span class="_"> </span>associative<span class="_ _1"></span>,<span class="_"> </span>and<span class="_"> </span>the<span class="_"> </span>L3<span class="_"> </span>cache<span class="_"> </span>is<span class="_"> </span>16-way<span class="_ _3"></span>.</div><div class="t m5 x17 h42 y5916 ff6 fs29 fc6 sc0 ls0 ws0">Impact<span class="_ _11"> </span>of<span class="_ _16"> </span>Write<span class="_ _11"> </span>Strategy</div><div class="t m5 x17 h26 y5917 ff7 fs19 fc1 sc0 ls0 ws0">Write-through<span class="_ _16"> </span>caches<span class="_ _14"> </span>are<span class="_ _16"> </span>simpler<span class="_ _14"> </span>to<span class="_ _16"> </span>implement<span class="_ _14"> </span>and<span class="_ _14"> </span>can<span class="_ _16"> </span>use<span class="_ _14"> </span>a<span class="_ _16"> </span><span class="ffa">write<span class="_ _14"> </span>buffer<span class="_ _15"> </span></span>that</div><div class="t m5 x17 h26 y5918 ff7 fs19 fc1 sc0 ls0 ws0">works<span class="_ _16"> </span>independently<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>cache<span class="_ _11"> </span>to<span class="_ _16"> </span>update<span class="_ _11"> </span>memory<span class="_ _3"></span>.<span class="_ _16"> </span>Furthermore<span class="_ _0"></span>,<span class="_ _16"> </span>read<span class="_ _11"> </span>misses</div><div class="t m5 x17 h26 y5919 ff7 fs19 fc1 sc0 ls0 ws0">are<span class="_ _15"> </span>less<span class="_ _21"> </span>expensive<span class="_ _21"> </span>because<span class="_ _21"> </span>they<span class="_ _21"> </span>do<span class="_ _15"> </span>not<span class="_ _21"> </span>trigger<span class="_ _21"> </span>a<span class="_ _21"> </span>memory<span class="_ _21"> </span>write<span class="_ _1"></span>.<span class="_ _21"> </span>On<span class="_ _21"> </span>the<span class="_ _21"> </span>other</div><div class="t m5 x17 h26 y591a ff7 fs19 fc1 sc0 ls0 ws0">hand,<span class="_ _16"> </span>write-back<span class="_ _16"> </span>caches<span class="_ _11"> </span>result<span class="_ _16"> </span>in<span class="_ _16"> </span>fewer<span class="_ _16"> </span>transfers<span class="_ _3"></span>,<span class="_ _16"> </span>which<span class="_ _16"> </span>allows<span class="_ _16"> </span>more<span class="_ _16"> </span>bandwidth</div><div class="t m5 x17 h26 y591b ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_"> </span>memory<span class="_ _11"> </span>for<span class="_"> </span>I/O<span class="_ _11"> </span>devices<span class="_ _11"> </span>that<span class="_"> </span>perform<span class="_ _11"> </span>DMA.<span class="_"> </span>Further,<span class="_"> </span>reducing<span class="_ _11"> </span>the<span class="_ _11"> </span>number<span class="_"> </span>of</div><div class="t m5 x17 h26 y591c ff7 fs19 fc1 sc0 ls0 ws0">transfers<span class="_ _13"> </span>becomes<span class="_"> </span>increasingly<span class="_ _13"> </span>important<span class="_ _13"> </span>as<span class="_ _13"> </span>we<span class="_"> </span>move<span class="_ _13"> </span>down<span class="_ _13"> </span>the<span class="_"> </span>hierarchy<span class="_ _13"> </span>and<span class="_ _13"> </span>the</div><div class="t m5 x17 h26 y591d ff7 fs19 fc1 sc0 ls0 ws0">transfer<span class="_ _16"> </span>times<span class="_ _16"> </span>increase<span class="_ _1"></span>.<span class="_ _16"> </span>In<span class="_ _16"> </span>general,<span class="_ _16"> </span>caches<span class="_ _16"> </span>further<span class="_ _16"> </span>down<span class="_ _16"> </span>the<span class="_ _16"> </span>hierarchy<span class="_ _16"> </span>are<span class="_ _16"> </span>more</div><div class="t m5 x17 h26 y591e ff7 fs19 fc1 sc0 ls0 ws0">likely<span class="_"> </span>to<span class="_"> </span>use<span class="_"> </span>write-back<span class="_"> </span>than<span class="_"> </span>write-through.</div><div class="t m5 x17 h3b y5647 fff fs24 fc6 sc0 ls0 ws0">6.5</div><div class="t m5 x77 h3e y591f ffe fs18 fc6 sc0 ls0 ws0">W<span class="_ _1"></span>riting<span class="_"> </span>Cache-Friendly<span class="_"> </span>Code</div><div class="t m5 x17 h26 ye93 ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _11"> </span>Section<span class="_ _11"> </span>6.2,<span class="_ _16"> </span>we<span class="_"> </span>introduced<span class="_ _16"> </span>the<span class="_"> </span>idea<span class="_ _16"> </span>of<span class="_"> </span>locality<span class="_ _16"> </span>and<span class="_ _11"> </span>talked<span class="_ _11"> </span>in<span class="_ _11"> </span>qualitative<span class="_ _11"> </span>terms</div><div class="t m5 x17 h26 y2532 ff7 fs19 fc1 sc0 ls0 ws0">about<span class="_"> </span>what<span class="_"> </span>constitutes<span class="_"> </span>good<span class="_"> </span>locality<span class="_ _3"></span>.<span class="_"> </span>Now<span class="_"> </span>that<span class="_ _11"> </span>we<span class="_"> </span>understand<span class="_"> </span>how<span class="_"> </span>cache<span class="_"> </span>memo-</div><div class="t m5 x17 h26 y2533 ff7 fs19 fc1 sc0 ls0 ws0">ries<span class="_"> </span>work,<span class="_ _13"> </span>we<span class="_"> </span>can<span class="_ _13"> </span>be<span class="_"> </span>more<span class="_ _13"> </span>precise<span class="_ _0"></span>.<span class="_"> </span>Programs<span class="_ _13"> </span>with<span class="_"> </span>better<span class="_ _13"> </span>locality<span class="_"> </span>will<span class="_ _13"> </span>tend<span class="_"> </span>to<span class="_ _13"> </span>have</div><div class="t m5 x17 h26 y2534 ff7 fs19 fc1 sc0 ls0 ws0">lower<span class="_"> </span>miss<span class="_ _11"> </span>rates<span class="_ _1"></span>,<span class="_ _11"> </span>and<span class="_ _11"> </span>programs<span class="_ _11"> </span>with<span class="_ _11"> </span>lower<span class="_ _11"> </span>miss<span class="_ _11"> </span>rates<span class="_ _11"> </span>will<span class="_ _11"> </span>tend<span class="_"> </span>to<span class="_ _11"> </span>run<span class="_ _11"> </span>faster<span class="_ _11"> </span>than</div><div class="t m5 x17 h26 y2535 ff7 fs19 fc1 sc0 ls0 ws0">programs<span class="_ _16"> </span>with<span class="_ _16"> </span>higher<span class="_ _14"> </span>miss<span class="_ _16"> </span>rates<span class="_ _1"></span>.<span class="_ _14"> </span>T<span class="_ _1"></span>hus<span class="_ _1"></span>,<span class="_ _14"> </span>good<span class="_ _14"> </span>programmers<span class="_ _16"> </span>should<span class="_ _16"> </span>always<span class="_ _14"> </span>try<span class="_ _16"> </span>to</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
