<div id="pf110" class="pf w2 h11" data-page-no="110"><div class="pc pc110 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg110.png"/><div class="t m5 x1dc h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>3.6<span class="_ _60"> </span>Control<span class="_ _3e"> </span><span class="ffe fs1e">271</span></div><div class="t m5 x2e h61 y287d ff13 fs35 fc6 sc0 ls0 ws0">void<span class="_ _f"> </span>switch_eg(long<span class="_ _f"> </span>x,<span class="_ _f"> </span>long<span class="_ _e"> </span>n,<span class="_ _21"> </span>long<span class="_ _f"> </span>*dest)</div><div class="t m5 x2e h61 y287e ff13 fs35 fc6 sc0 ls0 ws0">x<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi,<span class="_ _f"> </span>n<span class="_ _e"> </span>in<span class="_ _21"> </span>%rsi,<span class="_ _f"> </span>dest<span class="_ _e"> </span>in<span class="_ _21"> </span>%rdx</div><div class="t m5 x2c h2d y287f ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">switch_eg:</span></div><div class="t m5 x2c h2d y2880 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">subq<span class="_ _46"> </span>$100,<span class="_ _e"> </span>%rsi<span class="_ _158"> </span></span><span class="ff13 fs35">Compute<span class="_ _21"> </span>index<span class="_ _f"> </span>=<span class="_ _e"> </span>n-100</span></div><div class="t m5 x2c h2d y2881 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">cmpq<span class="_ _46"> </span>$6,<span class="_ _e"> </span>%rsi<span class="_ _15f"> </span></span><span class="ff13 fs35">Compare<span class="_ _f"> </span>index:6</span></div><div class="t m5 x2c h2d y2882 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">ja<span class="_ _5a"> </span>.L8<span class="_ _136"> </span></span><span class="ff13 fs35">If<span class="_ _f"> </span>&gt;,<span class="_ _e"> </span>goto<span class="_ _21"> </span><span class="ffd fs1f">loc_def</span></span></div><div class="t m5 x2c h2d y2883 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">jmp<span class="_ _8c"> </span>*.L4(,%rsi,8)<span class="_ _110"> </span></span><span class="ff13 fs35">Goto<span class="_ _f"> </span>*jg[index]</span></div><div class="t m5 x2c h2d y2884 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L3:<span class="_ _160"> </span><span class="fs1f fc6">loc_A:</span></span></div><div class="t m5 x2c h2d y2885 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">leaq<span class="_ _46"> </span>(%rdi,%rdi,2),<span class="_ _e"> </span>%rax<span class="_ _3a"> </span></span><span class="ff13 fs35">3*x</span></div><div class="t m5 x2c h2d y2886 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _45"> </span><span class="ffd fs1e fc2">leaq<span class="_ _46"> </span>(%rdi,%rax,4),<span class="_ _e"> </span>%rdi<span class="_ _3a"> </span></span><span class="ff13 fs35">val<span class="_ _e"> </span>=<span class="_ _21"> </span>13*x</span></div><div class="t m5 x2c h2d y2887 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _45"> </span><span class="ffd fs1e fc2">jmp<span class="_ _8c"> </span>.L2<span class="_ _136"> </span></span><span class="ff13 fs35">Goto<span class="_ _f"> </span><span class="ffd fs1f">done</span></span></div><div class="t m5 x17 h2d y2888 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L5:<span class="_ _160"> </span><span class="fs1f fc6">loc_B:</span></span></div><div class="t m5 x17 h2e y2889 ff6 fs20 fc6 sc0 ls0 ws0">11</div><div class="t m5 xd1 h2d y288a ffd fs1e fc2 sc0 ls0 ws0">addq<span class="_ _46"> </span>$10,<span class="_ _e"> </span>%rdi<span class="_ _161"> </span><span class="ff13 fs35 fc6 ls156">x=x+1<span class="_ _8a"></span>0</span></div><div class="t m5 x17 h2d y288b ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L6:<span class="_ _160"> </span><span class="fs1f fc6">loc_C:</span></span></div><div class="t m5 x17 h2d y288c ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _45"> </span><span class="ffd fs1e fc2">addq<span class="_ _46"> </span>$11,<span class="_ _e"> </span>%rdi<span class="_ _161"> </span></span><span class="ff13 fs35 ls156">v<span class="_ _8a"></span>a<span class="_ _8a"></span>l=x+1<span class="_ _12"></span>1</span></div><div class="t m5 x17 h2e y288d ff6 fs20 fc6 sc0 ls0 ws0">14</div><div class="t m5 xd1 h2d y288e ffd fs1e fc2 sc0 ls0 ws0">jmp<span class="_ _8c"> </span>.L2<span class="_ _136"> </span><span class="ff13 fs35 fc6">Goto<span class="_ _f"> </span><span class="ffd fs1f">done</span></span></div><div class="t m5 x17 h2e y288f ff6 fs20 fc6 sc0 ls0 ws0">15</div><div class="t m5 x2d h2d y2890 ffd fs1e fc2 sc0 ls0 ws0">.L7:<span class="_ _160"> </span><span class="fs1f fc6">loc_D:</span></div><div class="t m5 x17 h2e y2891 ff6 fs20 fc6 sc0 ls0 ws0">16</div><div class="t m5 xd1 h2d y2892 ffd fs1e fc2 sc0 ls0 ws0">imulq<span class="_ _3f"> </span>%rdi,<span class="_ _e"> </span>%rdi<span class="_ _158"> </span><span class="ff13 fs35 fc6 ls156">v<span class="_ _8a"></span>a<span class="_ _8a"></span>l=x*x</span></div><div class="t m5 x17 h2d y2893 ff6 fs20 fc6 sc0 ls0 ws0">17<span class="_ _45"> </span><span class="ffd fs1e fc2">jmp<span class="_ _8c"> </span>.L2<span class="_ _136"> </span></span><span class="ff13 fs35">Goto<span class="_ _f"> </span><span class="ffd fs1f">done</span></span></div><div class="t m5 x17 h2d y2894 ff6 fs20 fc6 sc0 ls0 ws0">18<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L8:<span class="_ _160"> </span><span class="fs1f fc6">loc_def:</span></span></div><div class="t m5 x17 h2d y2895 ff6 fs20 fc6 sc0 ls0 ws0">19<span class="_ _45"> </span><span class="ffd fs1e fc2">movl<span class="_ _46"> </span>$0,<span class="_ _e"> </span>%edi<span class="_ _15f"> </span></span><span class="ff13 fs35 ls156">v<span class="_ _8a"></span>a<span class="_ _8a"></span>l=0</span></div><div class="t m5 x17 h2d y2896 ff6 fs20 fc6 sc0 ls0 ws0">20<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L2:<span class="_ _160"> </span><span class="fs1f fc6">done:</span></span></div><div class="t m5 x17 h2e y2897 ff6 fs20 fc6 sc0 ls0 ws0">21</div><div class="t m5 xd1 h2d y2898 ffd fs1e fc2 sc0 ls0 ws0">movq<span class="_ _46"> </span>%rdi,<span class="_ _e"> </span>(%rdx)<span class="_ _12e"> </span><span class="ff13 fs35 fc6">*dest<span class="_ _e"> </span>=<span class="_ _21"> </span>val</span></div><div class="t m5 x17 h2d y2899 ff6 fs20 fc6 sc0 ls0 ws0">22<span class="_ _45"> </span><span class="ffd fs1e fc2">ret<span class="_ _162"> </span></span><span class="ff13 fs35">Return</span></div><div class="t m5 x17 h3a y289a ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>3.23<span class="_ _66"> </span><span class="fc1">Assembly<span class="_"> </span>code<span class="_"> </span>for<span class="_"> </span><span class="ffd fs19">switch<span class="_ _11"> </span></span>statement<span class="_"> </span>example<span class="_"> </span>in<span class="_"> </span>Figure<span class="_"> </span>3.22.</span></div><div class="t m5 x17 h26 y289b ffd fs19 fc1 sc0 ls0 ws0">index<span class="ff7">,<span class="_ _13"> </span>corresponding<span class="_ _13"> </span>to<span class="_ _13"> </span>values<span class="_ _13"> </span>100â€“106<span class="_ _13"> </span>of<span class="_ _13"> </span></span>n<span class="ff7">.<span class="_ _13"> </span>Observe<span class="_ _13"> </span>that<span class="_ _13"> </span>the<span class="_ _13"> </span>jump<span class="_ _13"> </span>table<span class="_ _13"> </span>handles</span></div><div class="t m5 x17 h26 y289c ff7 fs19 fc1 sc0 ls0 ws0">duplicate<span class="_"> </span>cases<span class="_"> </span>by<span class="_"> </span>simply<span class="_"> </span>having<span class="_"> </span>the<span class="_"> </span>same<span class="_"> </span>code<span class="_"> </span>label<span class="_"> </span>(<span class="ffd">loc_D</span>)<span class="_"> </span>for<span class="_"> </span>entries<span class="_"> </span>4<span class="_ _11"> </span>and<span class="_"> </span>6,</div><div class="t m5 x17 h26 y289d ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _11"> </span>it<span class="_ _16"> </span>handles<span class="_ _11"> </span>missing<span class="_ _11"> </span>cases<span class="_ _16"> </span>by<span class="_ _11"> </span>using<span class="_ _11"> </span>the<span class="_ _16"> </span>label<span class="_ _11"> </span>for<span class="_ _11"> </span>the<span class="_ _16"> </span>default<span class="_ _11"> </span>case<span class="_ _11"> </span>(<span class="ffd">loc_def</span><span class="ls16a">)a<span class="_ _49"></span>s</span></div><div class="t m5 x17 h26 y289e ff7 fs19 fc1 sc0 ls0 ws0">entries<span class="_"> </span>1<span class="_"> </span>and<span class="_"> </span>5.</div><div class="t m5 x26 h26 y289f ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _6"> </span>the<span class="_ _13"> </span>assembly<span class="_ _6"> </span>code<span class="_ _1"></span>,<span class="_ _13"> </span>the<span class="_ _6"> </span>jump<span class="_ _13"> </span>table<span class="_ _6"> </span>is<span class="_ _13"> </span>indicated<span class="_ _a"> </span>by<span class="_ _13"> </span>the<span class="_ _6"> </span>following<span class="_ _13"> </span>declarations<span class="_ _3"></span>,</div><div class="t m5 x17 h26 y28a0 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_"> </span>which<span class="_"> </span>we<span class="_"> </span>have<span class="_"> </span>added<span class="_"> </span>comments:</div><div class="t m5 x2c h2e y107a ff6 fs20 fc6 sc0 ls0 ws0">1</div><div class="t m5 xd1 h2d y5fe ffd fs1e fc2 sc0 ls0 ws0">.section<span class="_ _71"> </span>.rodata</div><div class="t m5 x2c h2d yec2 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">.align<span class="_ _e"> </span>8<span class="_ _c2"> </span></span><span class="ff13 fs35">Align<span class="_ _e"> </span>address<span class="_ _21"> </span>to<span class="_ _f"> </span>multiple<span class="_ _e"> </span>of<span class="_ _21"> </span>8</span></div><div class="t m5 x2c h2d y5b5 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L4:</span></div><div class="t m5 x2c h2d yc21 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">.quad<span class="_ _3f"> </span>.L3<span class="_ _2a"> </span></span><span class="ff13 fs35">Case<span class="_ _21"> </span>100:<span class="_ _f"> </span>loc_A</span></div><div class="t m5 x2c h2d y107b ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">.quad<span class="_ _3f"> </span>.L8<span class="_ _2a"> </span></span><span class="ff13 fs35">Case<span class="_ _21"> </span>101:<span class="_ _f"> </span>loc_def</span></div><div class="t m5 x2c h2d ye93 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">.quad<span class="_ _3f"> </span>.L5<span class="_ _2a"> </span></span><span class="ff13 fs35">Case<span class="_ _21"> </span>102:<span class="_ _f"> </span>loc_B</span></div><div class="t m5 x2c h2d y832 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">.quad<span class="_ _3f"> </span>.L6<span class="_ _2a"> </span></span><span class="ff13 fs35">Case<span class="_ _21"> </span>103:<span class="_ _f"> </span>loc_C</span></div><div class="t m5 x2c h2d y8d6 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _45"> </span><span class="ffd fs1e fc2">.quad<span class="_ _3f"> </span>.L7<span class="_ _2a"> </span></span><span class="ff13 fs35">Case<span class="_ _21"> </span>104:<span class="_ _f"> </span>loc_D</span></div><div class="t m5 x2c h2d y77e ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _45"> </span><span class="ffd fs1e fc2">.quad<span class="_ _3f"> </span>.L8<span class="_ _2a"> </span></span><span class="ff13 fs35">Case<span class="_ _21"> </span>105:<span class="_ _f"> </span>loc_def</span></div><div class="t m5 x17 h2d ye95 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _45"> </span><span class="ffd fs1e fc2">.quad<span class="_ _3f"> </span>.L7<span class="_ _2a"> </span></span><span class="ff13 fs35">Case<span class="_ _21"> </span>106:<span class="_ _f"> </span>loc_D</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
