<div id="pf335" class="pf w2 h11" data-page-no="335"><div class="pc pc335 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg335.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">820<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>8<span class="_ _3d"> </span>Exceptional<span class="_ _10"> </span>Control<span class="_ _10"> </span>Flow</span></div><div class="t m5 x38 h2c y27f ffa fs16 fc2 sc0 ls0 ws0">code/ecf/setjmp<span class="_ _1"></span>.c</div><div class="t m5 x1f h2d y280 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">#include<span class="_ _1f"> </span>&quot;csapp.h&quot;</span></div><div class="t m5 x1f h2e y281 ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x1f h2e y282 ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x4f h2d y283 ffd fs1e fc2 sc0 ls0 ws0">jmp_buf<span class="_ _e"> </span>buf;</div><div class="t m5 x1f h2e y284 ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 x1f h2e y69c3 ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x4f h2d y285 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>error1<span class="_ _1f"> </span>=<span class="_ _1f"> </span>0;</div><div class="t m5 x1f h2d y286 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _1c"> </span><span class="ffd fs1e fc2">int<span class="_ _1f"> </span>error2<span class="_ _e"> </span>=<span class="_ _1f"> </span>1;</span></div><div class="t m5 x1f h2e y287 ff6 fs20 fc6 sc0 ls0 ws0">7</div><div class="t m5 x1f h2e y5fd1 ff6 fs20 fc6 sc0 ls0 ws0">8</div><div class="t m5 x4f h2d y4493 ffd fs1e fc2 sc0 ls0 ws0">void<span class="_ _e"> </span>foo(void),<span class="_ _1f"> </span>bar(void);</div><div class="t m5 x1f h2e y4a9a ff6 fs20 fc6 sc0 ls0 ws0">9</div><div class="t m5 x1b0 h2e y6a52 ff6 fs20 fc6 sc0 ls0 ws0">10</div><div class="t m5 x4f h2d y4a9b ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>main()</div><div class="t m5 x1b0 h2d y4a9c ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x1b0 h2d y906 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _20"> </span><span class="ffd fs1e fc2">switch(setjmp(buf))<span class="_ _e"> </span>{</span></div><div class="t m5 x1b0 h2d y4a9d ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _20"> </span><span class="ffd fs1e fc2">case<span class="_ _e"> </span>0:</span></div><div class="t m5 x1b0 h2d y4a9e ff6 fs20 fc6 sc0 ls0 ws0">14<span class="_ _70"> </span><span class="ffd fs1e fc2">foo();</span></div><div class="t m5 x1b0 h2d y4a9f ff6 fs20 fc6 sc0 ls0 ws0">15<span class="_ _70"> </span><span class="ffd fs1e fc2">break;</span></div><div class="t m5 x1b0 h2d y417 ff6 fs20 fc6 sc0 ls0 ws0">16<span class="_ _20"> </span><span class="ffd fs1e fc2">case<span class="_ _e"> </span>1:</span></div><div class="t m5 x1b0 h2d y4aa0 ff6 fs20 fc6 sc0 ls0 ws0">17<span class="_ _70"> </span><span class="ffd fs1e fc2">printf(&quot;Detected<span class="_ _e"> </span>an<span class="_ _1f"> </span>error1<span class="_ _1f"> </span>condition<span class="_ _e"> </span>in<span class="_ _1f"> </span>foo\n&quot;);</span></div><div class="t m5 x1b0 h2d yeb4 ff6 fs20 fc6 sc0 ls0 ws0">18<span class="_ _70"> </span><span class="ffd fs1e fc2">break;</span></div><div class="t m5 x1b0 h2d y2a2b ff6 fs20 fc6 sc0 ls0 ws0">19<span class="_ _20"> </span><span class="ffd fs1e fc2">case<span class="_ _e"> </span>2:</span></div><div class="t m5 x1b0 h2d y1ab8 ff6 fs20 fc6 sc0 ls0 ws0">20<span class="_ _70"> </span><span class="ffd fs1e fc2">printf(&quot;Detected<span class="_ _e"> </span>an<span class="_ _1f"> </span>error2<span class="_ _1f"> </span>condition<span class="_ _e"> </span>in<span class="_ _1f"> </span>foo\n&quot;);</span></div><div class="t m5 x1b0 h2e y94f ff6 fs20 fc6 sc0 ls0 ws0">21</div><div class="t m5 xf7 h2d y1ada ffd fs1e fc2 sc0 ls0 ws0">break;</div><div class="t m5 x1b0 h2d y4aa1 ff6 fs20 fc6 sc0 ls0 ws0">22<span class="_ _20"> </span><span class="ffd fs1e fc2">default:</span></div><div class="t m5 x1b0 h2d y3228 ff6 fs20 fc6 sc0 ls0 ws0">23<span class="_ _70"> </span><span class="ffd fs1e fc2">printf(&quot;Unknown<span class="_ _e"> </span>error<span class="_ _1f"> </span>condition<span class="_ _1f"> </span>in<span class="_ _e"> </span>foo\n&quot;);</span></div><div class="t m5 x1b0 h2d y35d ff6 fs20 fc6 sc0 ls0 ws0">24<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1b0 h2e y4aa3 ff6 fs20 fc6 sc0 ls0 ws0">25</div><div class="t m5 x33 h2d y3229 ffd fs1e fc2 sc0 ls0 ws0">exit(0);</div><div class="t m5 x1b0 h2d y2467 ff6 fs20 fc6 sc0 ls0 ws0">26<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1b0 h2e y322b ff6 fs20 fc6 sc0 ls0 ws0">27</div><div class="t m5 x1b0 h2e y66e2 ff6 fs20 fc6 sc0 ls0 ws0">28</div><div class="t m5 x4f h2d y322c ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Deeply<span class="_ _1f"> </span>nested<span class="_ _1f"> </span>function<span class="_ _e"> </span>foo<span class="_ _1f"> </span>*/</div><div class="t m5 x1b0 h2d y441 ff6 fs20 fc6 sc0 ls0 ws0">29<span class="_ _1c"> </span><span class="ffd fs1e fc2">void<span class="_ _1f"> </span>foo(void)</span></div><div class="t m5 x1b0 h2d y2c5c ff6 fs20 fc6 sc0 ls0 ws0">30<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x1b0 h2d y322d ff6 fs20 fc6 sc0 ls0 ws0">31<span class="_ _20"> </span><span class="ffd fs1e fc2">if<span class="_ _e"> </span>(error1)</span></div><div class="t m5 x1b0 h2d y24a ff6 fs20 fc6 sc0 ls0 ws0">32<span class="_ _70"> </span><span class="ffd fs1e fc2">longjmp(buf,<span class="_ _e"> </span>1);</span></div><div class="t m5 x1b0 h2d y8f9 ff6 fs20 fc6 sc0 ls0 ws0">33<span class="_ _20"> </span><span class="ffd fs1e fc2">bar();</span></div><div class="t m5 x1b0 h2d y5fd ff6 fs20 fc6 sc0 ls0 ws0">34<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1b0 h2e y4aa5 ff6 fs20 fc6 sc0 ls0 ws0">35</div><div class="t m5 x1b0 h2e y6a53 ff6 fs20 fc6 sc0 ls0 ws0">36</div><div class="t m5 x4f h2d y74d ffd fs1e fc2 sc0 ls0 ws0">void<span class="_ _e"> </span>bar(void)</div><div class="t m5 x1b0 h2d y277 ff6 fs20 fc6 sc0 ls0 ws0">37<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x1b0 h2d y2269 ff6 fs20 fc6 sc0 ls0 ws0">38<span class="_ _20"> </span><span class="ffd fs1e fc2">if<span class="_ _e"> </span>(error2)</span></div><div class="t m5 x1b0 h2d y226b ff6 fs20 fc6 sc0 ls0 ws0">39<span class="_ _70"> </span><span class="ffd fs1e fc2">longjmp(buf,<span class="_ _e"> </span>2);</span></div><div class="t m5 x1b0 h2d y226d ff6 fs20 fc6 sc0 ls0 ws0">40<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x38 h2c y62c3 ffa fs16 fc2 sc0 ls0 ws0">code/ecf/setjmp<span class="_ _1"></span>.c</div><div class="t m5 x1d h34 y62c4 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _16"> </span>8.43<span class="_ _66"> </span><span class="fc1">Nonlocal<span class="_ _14"> </span>jump<span class="_ _16"> </span>example.<span class="_ _16"> </span><span class="ff6">This<span class="_ _16"> </span>example<span class="_ _16"> </span>shows<span class="_ _16"> </span>the<span class="_ _16"> </span>framework<span class="_ _16"> </span>for<span class="_ _16"> </span>using</span></span></div><div class="t m5 x1d h34 y6a54 ff6 fs16 fc1 sc0 ls0 ws0">nonlocal<span class="_ _14"> </span>jumps<span class="_ _14"> </span>to<span class="_ _14"> </span>recover<span class="_ _14"> </span>from<span class="_ _14"> </span>error<span class="_ _14"> </span>conditions<span class="_ _14"> </span>in<span class="_ _14"> </span>deeply<span class="_ _14"> </span>nested<span class="_ _14"> </span>functions<span class="_ _15"> </span>without</div><div class="t m5 x1d h34 y6a55 ff6 fs16 fc1 sc0 ls0 ws0">having<span class="_ _10"> </span>to<span class="_ _11"> </span>unwind<span class="_ _10"> </span>the<span class="_ _10"> </span>entire<span class="_ _11"> </span>stack.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
