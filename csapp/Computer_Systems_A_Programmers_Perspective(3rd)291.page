<div id="pf123" class="pf w2 h11" data-page-no="123"><div class="pc pc123 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg123.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">290<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x1d h34 y9c ff6 fs16 fc2 sc0 ls0 ws0">(a)<span class="_ _10"> </span>C<span class="_ _11"> </span>code</div><div class="t m5 x1d h2d y1bbd ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>rfact(long<span class="_ _1f"> </span>n)</div><div class="t m5 x1d h2d y2769 ffd fs1e fc2 sc0 ls0 ws0">{</div><div class="t m5 x10c h2d y276a ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>result;</div><div class="t m5 x10c h2d y276b ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>(n<span class="_ _1f"> </span>&lt;=<span class="_ _1f"> </span>1)</div><div class="t m5 x22b h2d y276c ffd fs1e fc2 sc0 ls0 ws0">result<span class="_ _e"> </span>=<span class="_ _1f"> </span>1;</div><div class="t m5 x10c h2d y276d ffd fs1e fc2 sc0 ls0 ws0">else</div><div class="t m5 x22b h2d y276e ffd fs1e fc2 sc0 ls0 ws0">resul<span class="ls33">t=n*</span>rfact(n-1);</div><div class="t m5 x10c h2d y276f ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>result;</div><div class="t m5 x1d h2d y2770 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x1d h34 ycdb ff6 fs16 fc2 sc0 ls0 ws0">(b)<span class="_ _10"> </span>Generated<span class="_ _11"> </span>assembly<span class="_ _10"> </span>code</div><div class="t m5 xad h61 y2a3d ff13 fs35 fc6 sc0 ls0 ws0">long<span class="_ _f"> </span>rfact(long<span class="_ _f"> </span>n)</div><div class="t m5 xad h61 y2a3e ff13 fs35 fc6 sc0 ls0 ws0">n<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi</div><div class="t m5 x1f h2d y228d ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">rfact:</span></div><div class="t m5 x1f h2d y13a3 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">pushq<span class="_ _3f"> </span>%rbx<span class="_ _15f"> </span></span><span class="ff13 fs35">Save<span class="_ _21"> </span>%rbx</span></div><div class="t m5 x1f h2d ycb7 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rdi,<span class="_ _e"> </span>%rbx<span class="_ _7d"> </span></span><span class="ff13 fs35">Store<span class="_ _e"> </span>n<span class="_ _21"> </span>in<span class="_ _f"> </span>callee-saved<span class="_ _e"> </span>register</span></div><div class="t m5 x1f h2d y24e8 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">movl<span class="_ _46"> </span>$1,<span class="_ _e"> </span>%eax<span class="_ _12e"> </span></span><span class="ff13 fs35">Set<span class="_ _e"> </span>return<span class="_ _21"> </span>value<span class="_ _f"> </span>=<span class="_ _e"> </span>1</span></div><div class="t m5 x1f h2d y23a8 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">cmpq<span class="_ _46"> </span>$1,<span class="_ _e"> </span>%rdi<span class="_ _12e"> </span></span><span class="ff13 fs35">Compare<span class="_ _e"> </span>n:1</span></div><div class="t m5 x1f h2d y2a3f ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">jle<span class="_ _8c"> </span>.L35<span class="_ _15f"> </span></span><span class="ff13 fs35">If<span class="_ _21"> </span>&lt;=,<span class="_ _f"> </span>goto<span class="_ _e"> </span>done</span></div><div class="t m5 x1f h2d y2a40 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">leaq<span class="_ _46"> </span>-1(%rdi),<span class="_ _e"> </span>%rdi<span class="_ _119"> </span></span><span class="ff13 fs35">Compute<span class="_ _f"> </span>n-1</span></div><div class="t m5 x1f h2d y2a41 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _45"> </span><span class="ffd fs1e fc2">call<span class="_ _46"> </span>rfact<span class="_ _112"> </span></span><span class="ff13 fs35">Call<span class="_ _f"> </span>rfact(n-1)</span></div><div class="t m5 x1f h2d y29ff ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _45"> </span><span class="ffd fs1e fc2">imulq<span class="_ _3f"> </span>%rbx,<span class="_ _e"> </span>%rax<span class="_ _7d"> </span></span><span class="ff13 fs35">Multiply<span class="_ _e"> </span>result<span class="_ _21"> </span>by<span class="_ _f"> </span>n</span></div><div class="t m5 x1b0 h2d y29bc ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L35:<span class="_ _139"> </span></span><span class="ff2d fs35">done:</span></div><div class="t m5 x1b0 h2d y29bd ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _45"> </span><span class="ffd fs1e fc2">popq<span class="_ _46"> </span>%rbx<span class="_ _15f"> </span></span><span class="ff13 fs35">Restore<span class="_ _21"> </span>%rbx</span></div><div class="t m5 x1b0 h2d y28f6 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _45"> </span><span class="ffd fs1e fc2">ret<span class="_ _16a"> </span></span><span class="ff13 fs35">Return</span></div><div class="t m5 x1d h34 y2a42 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>3.35<span class="_ _c"> </span><span class="fc1">Code<span class="_"> </span>for<span class="_"> </span>recursive<span class="_"> </span>factorial<span class="_"> </span>program.<span class="_"> </span><span class="ff6">The<span class="_ _11"> </span>standard<span class="_ _10"> </span>procedure<span class="_ _11"> </span>handling</span></span></div><div class="t m5 x1d h34 y2a43 ff6 fs16 fc1 sc0 ls0 ws0">mechanisms<span class="_ _10"> </span>sufÔ¨Åce<span class="_ _11"> </span>for<span class="_ _10"> </span>implementing<span class="_ _10"> </span>recursive<span class="_ _11"> </span>functions.</div><div class="t m5 x1d h26 y2a2f ffd fs19 fc1 sc0 ls0 ws0">%rax<span class="ff7">,<span class="_ _13"> </span>and<span class="_"> </span>(2)<span class="_ _13"> </span>the<span class="_ _13"> </span>value<span class="_"> </span>of<span class="_ _13"> </span>argument<span class="_ _13"> </span></span>n<span class="_ _13"> </span><span class="ff7">will<span class="_"> </span>held<span class="_ _13"> </span>in<span class="_ _13"> </span>register<span class="_"> </span></span>%rbx<span class="ff7">.<span class="_ _13"> </span>Multiplying<span class="_ _13"> </span>these</span></div><div class="t m5 x1d h26 y2a30 ff7 fs19 fc1 sc0 ls0 ws0">two<span class="_"> </span>values<span class="_"> </span>then<span class="_"> </span>computes<span class="_"> </span>the<span class="_"> </span>desired<span class="_"> </span>result.</div><div class="t m5 x29 h26 y2a31 ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _13"> </span>can<span class="_"> </span>see<span class="_ _13"> </span>from<span class="_ _13"> </span>this<span class="_ _13"> </span>example<span class="_ _13"> </span>that<span class="_"> </span>calling<span class="_ _13"> </span>a<span class="_ _13"> </span>function<span class="_ _13"> </span>recursively<span class="_ _13"> </span>proceeds<span class="_ _13"> </span>just</div><div class="t m5 x1d h26 y2a32 ff7 fs19 fc1 sc0 ls0 ws0">like<span class="_ _14"> </span>any<span class="_ _15"> </span>other<span class="_ _15"> </span>function<span class="_ _15"> </span>call.<span class="_ _15"> </span>Our<span class="_ _14"> </span>stack<span class="_ _15"> </span>discipline<span class="_ _15"> </span>provides<span class="_ _15"> </span>a<span class="_ _14"> </span>mechanism<span class="_ _15"> </span>where</div><div class="t m5 x1d h26 y2a33 ff7 fs19 fc1 sc0 ls0 ws0">each<span class="_ _14"> </span>invocation<span class="_ _14"> </span>of<span class="_ _14"> </span>a<span class="_ _15"> </span>function<span class="_ _14"> </span>has<span class="_ _14"> </span>its<span class="_ _15"> </span>own<span class="_ _14"> </span>private<span class="_ _14"> </span>storage<span class="_ _14"> </span>for<span class="_ _15"> </span>state<span class="_ _14"> </span>information</div><div class="t m5 x1d h26 y2a34 ff7 fs19 fc1 sc0 ls0 ws0">(saved<span class="_ _15"> </span>values<span class="_ _21"> </span>of<span class="_ _21"> </span>the<span class="_ _21"> </span>return<span class="_ _21"> </span>location<span class="_ _21"> </span>and<span class="_ _21"> </span>callee-saved<span class="_ _21"> </span>registers).<span class="_ _21"> </span>If<span class="_ _21"> </span>need<span class="_ _21"> </span>be,<span class="_ _21"> </span>it</div><div class="t m5 x1d h26 y2a35 ff7 fs19 fc1 sc0 ls0 ws0">can<span class="_"> </span>also<span class="_"> </span>provide<span class="_ _13"> </span>storage<span class="_"> </span>for<span class="_"> </span>local<span class="_"> </span>variables<span class="_ _3"></span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>stack<span class="_"> </span>discipline<span class="_"> </span>of<span class="_ _13"> </span>allocation<span class="_"> </span>and</div><div class="t m5 x1d h26 y2a36 ff7 fs19 fc1 sc0 ls0 ws0">deallocation<span class="_"> </span>naturally<span class="_ _13"> </span>matches<span class="_"> </span>the<span class="_ _13"> </span>call-return<span class="_"> </span>ordering<span class="_"> </span>of<span class="_ _13"> </span>functions<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _1"></span>his<span class="_"> </span>method</div><div class="t m5 x1d h26 y2a44 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_ _13"> </span>implementing<span class="_ _6"> </span>function<span class="_ _13"> </span>calls<span class="_ _13"> </span>and<span class="_ _13"> </span>returns<span class="_ _6"> </span>even<span class="_ _13"> </span>works<span class="_ _13"> </span>for<span class="_ _6"> </span>more<span class="_ _13"> </span>complex<span class="_ _13"> </span>patterns<span class="_ _1"></span>,</div><div class="t m5 x1d h26 y2a45 ff7 fs19 fc1 sc0 ls0 ws0">including<span class="_"> </span>mutual<span class="_"> </span>recursion<span class="_"> </span>(e<span class="_ _1"></span>.g.,<span class="_"> </span>when<span class="_"> </span>procedure<span class="_"> </span><span class="ffd">P<span class="_ _10"> </span></span>calls<span class="_"> </span><span class="ffd">Q</span>,<span class="_"> </span>which<span class="_"> </span>in<span class="_"> </span>turn<span class="_"> </span>calls<span class="_"> </span><span class="ffd">P</span>).</div><div class="t m5 x1d h47 y2a46 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>3.35<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>376)</span></div><div class="t m5 x1d h26 y77e ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_"> </span>a<span class="_"> </span>C<span class="_"> </span>function<span class="_"> </span>having<span class="_"> </span>the<span class="_"> </span>general<span class="_"> </span>structure</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
