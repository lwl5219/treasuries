<div id="pf1b0" class="pf w2 h11" data-page-no="1b0"><div class="pc pc1b0 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1b0.png"/><div class="t m5 x99 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>4.3<span class="_ _60"> </span>Sequential<span class="_ _10"> </span>Y86-64<span class="_ _10"> </span>Implementations<span class="_ _3e"> </span><span class="ffe fs1e">431</span></div><div class="t m5 x34 h2a y257 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">T<span class="_ _3"></span>racing<span class="_ _11"> </span>the<span class="_ _11"> </span>execution<span class="_ _16"> </span>of<span class="_ _11"> </span>a<span class="_ _11"> </span><span class="ffd fs2b">ret<span class="_ _11"> </span></span>instruction</span></div><div class="t m5 x34 h2b y258 ff7 fs1e fc2 sc0 ls0 ws0">Let<span class="_ _11"> </span>us<span class="_ _11"> </span>trace<span class="_ _11"> </span>the<span class="_ _11"> </span>processing<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span><span class="ffd">ret<span class="_ _11"> </span></span>instruction<span class="_ _11"> </span>on<span class="_ _11"> </span>line<span class="_ _16"> </span>13<span class="_ _10"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>object<span class="_ _16"> </span>code<span class="_ _10"> </span>shown<span class="_ _11"> </span>in<span class="_ _11"> </span>Figure<span class="_ _10"> </span>4.17.</div><div class="t m5 x34 h2b y259 ff7 fs1e fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _11"> </span>instruction<span class="_ _11"> </span>address<span class="_"> </span>is<span class="_ _11"> </span><span class="ffd">0x041<span class="_ _11"> </span></span>and<span class="_"> </span>is<span class="_ _11"> </span>encoded<span class="_ _11"> </span>by<span class="_ _10"> </span>a<span class="_ _11"> </span>single<span class="_ _11"> </span>byte<span class="_"> </span><span class="ffd">0x90</span>.<span class="_ _11"> </span>T<span class="_ _0"></span>he<span class="_ _10"> </span>previous<span class="_ _11"> </span><span class="ffd">call<span class="_ _11"> </span></span>instruction</div><div class="t m5 x34 h2b y25a ff7 fs1e fc2 sc0 ls0 ws0">set<span class="_ _13"> </span><span class="ffd">%rsp<span class="_ _13"> </span></span>to<span class="_"> </span>120<span class="_ _13"> </span>and<span class="_"> </span>stored<span class="_ _13"> </span>the<span class="_ _13"> </span>return<span class="_"> </span>address<span class="_ _13"> </span><span class="ffd">0x040<span class="_ _13"> </span></span>at<span class="_"> </span>memory<span class="_ _13"> </span>address<span class="_ _13"> </span>120.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span>stages<span class="_"> </span>would<span class="_ _13"> </span>proceed</div><div class="t m5 x34 h2b y4e2 ff7 fs1e fc2 sc0 ls0 ws0">as<span class="_"> </span>follows:</div><div class="t m5 x29 h31 ya7a ff7 fs21 fc2 sc0 ls0 ws0">Generic<span class="_ _15a"> </span>Speciﬁc</div><div class="t m5 x34 h31 y3ba6 ff7 fs21 fc2 sc0 ls0 ws0">Stage</div><div class="t m5 x29 h2d y3ba7 ffd fs1e fc2 sc0 ls0 ws0">ret<span class="_ _111"> </span>ret</div><div class="t m5 x34 h32 y3ba8 ff7 fs21 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>etch<span class="_ _55"> </span><span class="ff6">icode<span class="_ _a"> </span></span>:<span class="_ _be"></span><span class="ff6">ifun<span class="_ _23"> </span><span class="ff12">←<span class="_ _25"> </span></span>M</span></div><div class="t m5 xe7 h33 y3ba9 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x1b2 h32 y3ba8 ff7 fs21 fc2 sc0 ls0 ws0">[<span class="ff6">PC</span>]<span class="_ _74"> </span><span class="ff6">icode<span class="_ _a"> </span></span>:<span class="_ _be"></span><span class="ff6">ifun<span class="_ _23"> </span><span class="ff12">←<span class="_ _25"> </span></span>M</span></div><div class="t m5 xff h33 y3ba9 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x60 h32 y3ba8 ff7 fs21 fc2 sc0 ls0 ws0">[<span class="ffd fs1e">0x041</span>]<span class="_ _6"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ffd fs1e">9:0</span></span></div><div class="t m5 x29 h32 y3baa ff6 fs21 fc2 sc0 ls0 ws0">valP<span class="_ _23"> </span><span class="ff12">←<span class="_ _25"> </span></span>PC<span class="_ _13"> </span><span class="ff12">+<span class="_ _13"> </span><span class="ff7">1<span class="_ _69"> </span></span></span>valP<span class="_ _25"> </span><span class="ff12">←<span class="_ _23"> </span><span class="ffd fs1e">0x041<span class="_ _13"> </span></span>+<span class="_ _10"> </span><span class="ff7">1<span class="_ _a"> </span></span>=<span class="_ _10"> </span><span class="ffd fs1e">0x042</span></span></div><div class="t m5 x34 h32 y3b13 ff7 fs21 fc2 sc0 ls0 ws0">Decode<span class="_ _bd"> </span><span class="ff6">valA<span class="_ _25"> </span><span class="ff12">←<span class="_ _25"> </span></span>R</span>[<span class="ffd fs1e">%rsp</span>]<span class="_ _55"> </span><span class="ff6">valA<span class="_ _25"> </span><span class="ff12">←<span class="_ _25"> </span></span>R</span>[<span class="ffd fs1e">%rsp</span>]<span class="_ _6"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ffd fs1e">120</span></span></div><div class="t m5 x29 h32 y3b15 ff6 fs21 fc2 sc0 ls0 ws0">valB<span class="_ _23"> </span><span class="ff12">←<span class="_ _25"> </span></span>R<span class="ff7">[<span class="ffd fs1e">%rsp</span>]<span class="_ _54"> </span></span>valB<span class="_ _25"> </span><span class="ff12">←<span class="_ _23"> </span></span>R<span class="_ _2"></span><span class="ff7">[<span class="ffd fs1e">%rsp</span>]<span class="_ _6"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ffd fs1e">120</span></span></span></div><div class="t m5 x34 h32 y3b16 ff7 fs21 fc2 sc0 ls0 ws0">Execute<span class="_ _f4"> </span><span class="ff6">valE<span class="_ _25"> </span><span class="ff12">←<span class="_ _23"> </span></span>valB<span class="_ _13"> </span><span class="ff12">+<span class="_ _13"> </span></span></span>8<span class="_ _55"> </span><span class="ff6">valE<span class="_ _25"> </span><span class="ff12">←<span class="_ _25"> </span><span class="ffd fs1e">120<span class="_ _13"> </span></span>+<span class="_ _13"> </span></span></span>8<span class="_"> </span><span class="ff12">=<span class="_ _13"></span><span class="ffd fs1e">128</span></span></div><div class="t m5 x34 h32 y3bab ff7 fs21 fc2 sc0 ls0 ws0">Memory<span class="_ _88"> </span><span class="ff6">valM<span class="_ _22"> </span><span class="ff12">←<span class="_ _25"> </span></span>M</span></div><div class="t m5 x50 h33 y3bac ff7 fs20 fc2 sc0 ls0 ws0">8</div><div class="t m5 x1af h32 y3bab ff7 fs21 fc2 sc0 ls0 ws0">[<span class="ff6">valA<span class="_ _2"></span></span>]<span class="_ _148"> </span><span class="ff6">valM<span class="_ _23"> </span><span class="ff12">←<span class="_ _23"> </span></span>M</span></div><div class="t m5 x1c9 h33 y3bac ff7 fs20 fc2 sc0 ls0 ws0">8</div><div class="t m5 x1c2 h32 y3bab ff7 fs21 fc2 sc0 ls0 ws0">[<span class="ffd fs1e">120</span>]<span class="_ _6"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ffd fs1e">0x040</span></span></div><div class="t m5 x34 h32 y3bad ff7 fs21 fc2 sc0 ls0 ws0">Write<span class="_"> </span>back<span class="_ _4f"> </span><span class="ff6">R</span>[<span class="ffd fs1e">%rsp</span>]<span class="_ _23"> </span><span class="ff12">←<span class="_ _23"> </span><span class="ff6">valE<span class="_ _14c"> </span>R</span></span>[<span class="ffd fs1e">%rsp</span>]<span class="_ _23"> </span><span class="ff12">←<span class="_ _23"> </span><span class="ffd fs1e">128</span></span></div><div class="t m5 x34 h32 y3bae ff7 fs21 fc2 sc0 ls0 ws0">PC<span class="_"> </span>update<span class="_ _45"> </span><span class="ff6">PC<span class="_ _25"> </span><span class="ff12">←<span class="_ _23"> </span></span>valM<span class="_ _107"> </span>PC<span class="_ _25"> </span><span class="ff12">←<span class="_ _25"> </span><span class="ffd fs1e">0x040</span></span></span></div><div class="t m5 x35 h2b y3baf ff7 fs1e fc2 sc0 ls0 ws0">As<span class="_ _11"> </span>this<span class="_ _16"> </span>trace<span class="_ _11"> </span>shows<span class="_ _1"></span>,<span class="_ _16"> </span>the<span class="_ _16"> </span>instruction<span class="_ _11"> </span>has<span class="_ _11"> </span>the<span class="_ _16"> </span>effect<span class="_ _11"> </span>of<span class="_ _16"> </span>setting<span class="_ _11"> </span>the<span class="_ _16"> </span>PC<span class="_ _11"> </span>to<span class="_ _16"> </span><span class="ffd">0x040</span>,<span class="_ _11"> </span>the<span class="_ _16"> </span>address<span class="_ _11"> </span>of<span class="_ _16"> </span>the</div><div class="t m5 x34 h2b y3bb0 ffd fs1e fc2 sc0 ls0 ws0">halt<span class="_ _10"> </span><span class="ff7">instruction.<span class="_"> </span>It<span class="_"> </span>also<span class="_"> </span>sets<span class="_"> </span></span>%rsp<span class="_ _10"> </span><span class="ff7">to<span class="_"> </span>128.</span></div><div class="t m5 x75 h31 y3bb1 ff7 fs21 fc2 sc0 ls0 ws0">Generic<span class="_ _15a"> </span>Speciﬁc</div><div class="t m5 x17 h31 y3bb2 ff7 fs21 fc2 sc0 ls0 ws0">Stage</div><div class="t m5 x75 h93 y3bb3 ffd fs1e fc2 sc0 ls0 ws0">call<span class="_ _11"> </span><span class="ff6 fs21">Dest<span class="_ _175"> </span></span>call<span class="_ _11"> </span>0x041</div><div class="t m5 x17 h31 y3bb4 ff7 fs21 fc2 sc0 ls0 ws0">Decode</div><div class="t m5 x75 h32 y3bb5 ff6 fs21 fc2 sc0 ls0 ws0">valB<span class="_ _23"> </span><span class="ff12">←<span class="_ _25"> </span></span>R<span class="ff7">[</span></div><div class="t m5 x112 h2d y3bb6 ffd fs1e fc2 sc0 ls0 ws0">%rsp</div><div class="t m5 xf0 h31 y3bb7 ff7 fs21 fc2 sc0 ls0 ws0">]</div><div class="t m5 x17 h32 y3bb8 ff7 fs21 fc2 sc0 ls0 ws0">Execute<span class="_ _f4"> </span><span class="ff6">valE<span class="_ _25"> </span><span class="ff12">←<span class="_ _23"> </span></span>valB<span class="_ _13"> </span><span class="ff12">+<span class="_ _13"> </span><span class="ff11">(</span>−</span></span>8<span class="ff11">)</span></div><div class="t m5 x17 h31 y3bb9 ff7 fs21 fc2 sc0 ls0 ws0">Memory<span class="_ _88"> </span><span class="ff6">M</span></div><div class="t m5 x178 h33 y3bba ff7 fs20 fc2 sc0 ls0 ws0">8</div><div class="t m5 x13 h32 y3bbb ff7 fs21 fc2 sc0 ls0 ws0">[<span class="ff6">valE</span>]<span class="_ _22"> </span><span class="ff12">←<span class="_ _25"> </span><span class="ff6">valP</span></span></div><div class="t m5 x17 h31 y3bbc ff7 fs21 fc2 sc0 ls0 ws0">Write<span class="_"> </span>back<span class="_ _4f"> </span><span class="ff6">R</span>[</div><div class="t m5 x29 h32 y3bbd ffd fs1e fc2 sc0 ls0 ws0">%rsp<span class="ff7 fs21">]<span class="_ _22"> </span><span class="ff12">←<span class="_ _25"> </span><span class="ff6">valE</span></span></span></div><div class="t m5 x17 h32 y3bbe ff7 fs21 fc2 sc0 ls0 ws0">PC<span class="_"> </span>update<span class="_ _45"> </span><span class="ff6">PC<span class="_ _25"> </span><span class="ff12">←<span class="_ _23"> </span></span>valC</span></div><div class="t m5 x26 h26 y3bbf ff7 fs19 fc2 sc0 ls0 ws0">What<span class="_ _16"> </span>effect<span class="_ _16"> </span>would<span class="_ _14"> </span>this<span class="_ _14"> </span>instruction<span class="_ _16"> </span>execution<span class="_ _14"> </span>have<span class="_ _14"> </span>on<span class="_ _16"> </span>the<span class="_ _14"> </span>registers<span class="_ _1"></span>,<span class="_ _15"> </span>the<span class="_ _16"> </span>PC,</div><div class="t m5 x17 h26 y3bc0 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_"> </span>the<span class="_"> </span>memory?</div><div class="t m5 x26 h26 y3bc1 ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _13"> </span>have<span class="_ _6"> </span>created<span class="_ _6"> </span>a<span class="_ _13"> </span>uniform<span class="_ _6"> </span>framework<span class="_ _6"> </span>that<span class="_ _13"> </span>handles<span class="_ _6"> </span>all<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _6"> </span>different<span class="_ _6"> </span>types<span class="_ _13"> </span>of</div><div class="t m5 x17 h26 y3bc2 ff7 fs19 fc1 sc0 ls0 ws0">Y86-64<span class="_"> </span>instructions<span class="_ _0"></span>.<span class="_"> </span>Even<span class="_ _11"> </span>though<span class="_ _11"> </span>the<span class="_ _11"> </span>instructions<span class="_ _11"> </span>have<span class="_ _11"> </span>widely<span class="_ _11"> </span>varying<span class="_ _11"> </span>behavior,</div><div class="t m5 x17 h26 y3bc3 ff7 fs19 fc1 sc0 ls0 ws0">we<span class="_ _6"> </span>can<span class="_ _13"> </span>organize<span class="_ _a"> </span>the<span class="_ _13"> </span>processing<span class="_ _6"> </span>into<span class="_ _6"> </span>six<span class="_ _13"> </span>stages<span class="_ _3"></span>.<span class="_ _13"> </span>Our<span class="_ _6"> </span>task<span class="_ _6"> </span>now<span class="_ _13"> </span>is<span class="_ _a"> </span>to<span class="_ _13"> </span>create<span class="_ _6"> </span>a<span class="_ _6"> </span>hardware</div><div class="t m5 x17 h26 y3bc4 ff7 fs19 fc1 sc0 ls0 ws0">design<span class="_"> </span>that<span class="_"> </span>implements<span class="_"> </span>the<span class="_"> </span>stages<span class="_"> </span>and<span class="_"> </span>connects<span class="_"> </span>them<span class="_"> </span>together.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
