<div id="pf118" class="pf w2 h11" data-page-no="118"><div class="pc pc118 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg118.png"/><div class="t m5 xb5 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>3.7<span class="_ _60"> </span>Procedures<span class="_ _3e"> </span><span class="ffe fs1e">279</span></div><div class="t m5 x17 h34 ye7 ff6 fs16 fc2 sc0 ls0 ws0">(a)<span class="_ _10"> </span>Disassembled<span class="_ _11"> </span>code<span class="_ _10"> </span>for<span class="_ _10"> </span>demonstrating<span class="_ _11"> </span>procedure<span class="_ _10"> </span>calls<span class="_ _11"> </span>and<span class="_ _10"> </span>returns</div><div class="t m5 x239 h61 y2283 ff13 fs35 fc6 sc0 ls0 ws0">Disassembly<span class="_ _f"> </span>of<span class="_ _f"> </span>leaf(long<span class="_ _f"> </span>y)</div><div class="t m5 x239 h61 y28e4 ff13 fs35 fc6 sc0 ls0 ws0">y<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi</div><div class="t m5 x2c h2d yc51 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">0000000000400540<span class="_ _1f"> </span>&lt;leaf&gt;:</span></div><div class="t m5 x2c h2d y28e5 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">400540:<span class="_ _1a"> </span>48<span class="_ _e"> </span>8d<span class="_ _1f"> </span>47<span class="_ _1f"> </span>02<span class="_ _35"> </span>lea<span class="_ _46"> </span>0x2(%rdi),%rax<span class="_ _95"> </span></span><span class="ff13 fs35">L1:<span class="_ _f"> </span>z+2</span></div><div class="t m5 x2c h2e y28e6 ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 xd1 h2d y28e7 ffd fs1e fc2 sc0 ls0 ws0">400544:<span class="_ _1a"> </span>c3<span class="_ _129"> </span>retq<span class="_ _12c"> </span><span class="ff13 fs35 fc6">L2:<span class="_ _21"> </span>Return</span></div><div class="t m5 x2c h2d y28e8 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _1c"> </span><span class="ffd fs1e fc2">0000000000400545<span class="_ _1f"> </span>&lt;top&gt;:</span></div><div class="t m5 x239 h61 y28e9 ff13 fs35 fc6 sc0 ls0 ws0">Disassembly<span class="_ _f"> </span>of<span class="_ _f"> </span>top(long<span class="_ _f"> </span>x)</div><div class="t m5 x239 h61 y2960 ff13 fs35 fc6 sc0 ls0 ws0">x<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi</div><div class="t m5 x2c h2d y28ea ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">400545:<span class="_ _1a"> </span>48<span class="_ _e"> </span>83<span class="_ _1f"> </span>ef<span class="_ _1f"> </span>05<span class="_ _35"> </span>sub<span class="_ _46"> </span>$0x5,%rdi<span class="_ _5d"> </span></span><span class="ff13 fs35">T1:<span class="_ _21"> </span>x-5</span></div><div class="t m5 x2c h2d y28eb ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">400549:<span class="_ _1a"> </span>e8<span class="_ _e"> </span>f2<span class="_ _1f"> </span>ff<span class="_ _1f"> </span>ff<span class="_ _e"> </span>ff<span class="_ _86"> </span>callq<span class="_ _1a"> </span>400540<span class="_ _1f"> </span>&lt;leaf&gt;<span class="_ _74"> </span></span><span class="ff13 fs35">T2:<span class="_ _f"> </span>Call<span class="_ _f"> </span>leaf(x-5)</span></div><div class="t m5 x2c h2d y28ec ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">40054e:<span class="_ _1a"> </span>48<span class="_ _e"> </span>01<span class="_ _1f"> </span>c0<span class="_ _12a"> </span>add<span class="_ _7b"> </span>%rax,%rax<span class="_ _5d"> </span></span><span class="ff13 fs35">T3:<span class="_ _f"> </span>Double<span class="_ _f"> </span>result</span></div><div class="t m5 x2c h2d y28ed ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _45"> </span><span class="ffd fs1e fc2">400551:<span class="_ _1a"> </span>c3<span class="_ _129"> </span>retq<span class="_ _12c"> </span></span><span class="ff13 fs35">T4:<span class="_ _21"> </span>Return</span></div><div class="t m5 x239 h61 y2961 ff13 fs35 fc6 sc0 ls156 ws0">...</div><div class="t m5 x249 h61 y2962 ff13 fs35 fc6 sc0 ls0 ws0">Call<span class="_ _f"> </span>to<span class="_ _f"> </span>top<span class="_ _f"> </span>from<span class="_ _e"> </span>function<span class="_ _21"> </span>main</div><div class="t m5 x2c h2d y2963 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _45"> </span><span class="ffd fs1e fc2">40055b:<span class="_ _1a"> </span>e8<span class="_ _e"> </span>e5<span class="_ _1f"> </span>ff<span class="_ _1f"> </span>ff<span class="_ _e"> </span>ff<span class="_ _86"> </span>callq<span class="_ _1a"> </span>400545<span class="_ _1f"> </span>&lt;top&gt;<span class="_ _62"> </span></span><span class="ff13 fs35">M1:<span class="_ _f"> </span>Call<span class="_ _e"> </span>top(100)</span></div><div class="t m5 x17 h2d y2964 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _45"> </span><span class="ffd fs1e fc2">400560:<span class="_ _1a"> </span>48<span class="_ _e"> </span>89<span class="_ _1f"> </span>c2<span class="_ _12a"> </span>mov<span class="_ _7b"> </span>%rax,%rdx<span class="_ _5d"> </span></span><span class="ff13 fs35">M2:<span class="_ _f"> </span>Resume</span></div><div class="t m5 x17 h34 y2965 ff6 fs16 fc2 sc0 ls0 ws0">(b)<span class="_ _10"> </span>Execution<span class="_ _11"> </span>trace<span class="_ _10"> </span>of<span class="_ _10"> </span>example<span class="_ _11"> </span>code</div><div class="t m5 x12 h31 y2966 ff7 fs21 fc2 sc0 ls0 ws0">Instruction<span class="_ _14f"> </span>State<span class="_"> </span>values<span class="_"> </span>(at<span class="_"> </span>beginning)</div><div class="t m5 x17 h31 y2967 ff7 fs21 fc2 sc0 ls0 ws0">Label<span class="_ _3e"> </span>PC<span class="_ _163"> </span>Instruction<span class="_ _3e"> </span><span class="ffd fs1e">%rdi<span class="_ _3e"> </span>%rax<span class="_ _ba"> </span>%rsp<span class="_ _156"> </span>*%rsp<span class="_ _61"> </span></span>Description</div><div class="t m5 x17 h31 y2968 ff7 fs21 fc2 sc0 ls0 ws0">M1<span class="_ _ab"> </span><span class="ffd fs1e">0x40055b<span class="_ _3e"> </span>callq<span class="_ _f4"> </span></span>100<span class="_ _8b"> </span>—<span class="_ _95"> </span><span class="ffd fs1e">0x7fffffffe820<span class="_ _62"> </span></span>—<span class="_ _62"> </span>Call<span class="_"> </span><span class="ffd fs1e">top(100)</span></div><div class="t m5 x17 h31 y2969 ff7 fs21 fc2 sc0 ls0 ws0">T1<span class="_ _72"> </span><span class="ffd fs1e">0x400545<span class="_ _3e"> </span>sub<span class="_ _87"> </span></span>100<span class="_ _85"> </span>—<span class="_ _95"> </span><span class="ffd fs1e">0x7fffffffe818<span class="_ _3e"> </span>0x400560<span class="_ _3e"> </span></span>Entry<span class="_"> </span>of<span class="_"> </span><span class="ffd fs1e">top</span></div><div class="t m5 x17 h31 y296a ff7 fs21 fc2 sc0 ls0 ws0">T2<span class="_ _72"> </span><span class="ffd fs1e">0x400549<span class="_ _3e"> </span>callq<span class="_ _d0"> </span></span>95<span class="_ _93"> </span>—</div><div class="t m5 x101 h31 y296b ffd fs1e fc2 sc0 ls0 ws0">0x7fffffffe818<span class="_ _3e"> </span>0x400560<span class="_ _3e"> </span><span class="ff7 fs21">Call<span class="_"> </span></span>leaf(95)</div><div class="t m5 x17 h31 y296c ff7 fs21 fc2 sc0 ls0 ws0">L1<span class="_ _72"> </span><span class="ffd fs1e">0x400540<span class="_ _3e"> </span>lea<span class="_ _122"> </span></span>95<span class="_ _93"> </span>—<span class="_ _5e"> </span><span class="ffd fs1e">0x7fffffffe810<span class="_ _b3"> </span>0x40054e<span class="_ _3e"> </span></span>Entry<span class="_"> </span>of<span class="_"> </span><span class="ffd fs1e">leaf</span></div><div class="t m5 x17 h31 y2156 ff7 fs21 fc2 sc0 ls0 ws0">L2</div><div class="t m5 x30 h31 y296d ffd fs1e fc2 sc0 ls0 ws0">0x400544<span class="_ _3e"> </span>retq<span class="_ _53"> </span><span class="ff7 fs21 ls16d">—9<span class="_ _164"></span>7</span></div><div class="t m5 x101 h31 y296e ffd fs1e fc2 sc0 ls0 ws0">0x7fffffffe810<span class="_ _3e"> </span>0x40054e<span class="_ _3e"> </span><span class="ff7 fs21">Return<span class="_"> </span>97<span class="_"> </span>from<span class="_"> </span></span>leaf</div><div class="t m5 x17 h31 y296f ff7 fs21 fc2 sc0 ls0 ws0">T3<span class="_ _72"> </span><span class="ffd fs1e">0x40054e<span class="_ _3e"> </span>add<span class="_ _122"> </span></span><span class="ls16d">—9<span class="_ _164"></span>7<span class="_ _c4"></span><span class="ffd fs1e ls0">0x7fffffffe818<span class="_ _3e"> </span>0x400560<span class="_ _3e"> </span><span class="ff7 fs21">Resume<span class="_"> </span></span>top</span></span></div><div class="t m5 x17 h31 y1ac1 ff7 fs21 fc2 sc0 ls0 ws0">T4<span class="_ _72"> </span><span class="ffd fs1e">0x400551<span class="_ _3e"> </span>retq<span class="_ _53"> </span></span>—<span class="_ _8b"> </span>194<span class="_ _103"> </span><span class="ffd fs1e">0x7fffffffe818<span class="_ _3e"> </span>0x400560<span class="_ _3e"> </span></span>Return<span class="_"> </span>194<span class="_"> </span>from<span class="_"> </span><span class="ffd fs1e">top</span></div><div class="t m5 x17 h31 y2970 ff7 fs21 fc2 sc0 ls0 ws0">M2</div><div class="t m5 x30 h31 y2971 ffd fs1e fc2 sc0 ls0 ws0">0x400560<span class="_ _3e"> </span>mov<span class="_ _122"> </span><span class="ff7 fs21">—<span class="_ _85"> </span>194<span class="_ _1c"> </span></span>0x7fffffffe820<span class="_ _62"> </span><span class="ff7 fs21">—<span class="_ _62"> </span>Resume<span class="_"> </span></span>main</div><div class="t m5 x17 h34 y2972 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _16"> </span>3.27<span class="_ _66"> </span><span class="fc1">Detailed<span class="_ _16"> </span>execution<span class="_ _16"> </span>of<span class="_ _16"> </span>program<span class="_ _16"> </span>involving<span class="_ _16"> </span>procedure<span class="_ _11"> </span>calls<span class="_ _16"> </span>and<span class="_ _16"> </span>returns.<span class="_ _16"> </span><span class="ff6">Using<span class="_ _16"> </span>the<span class="_ _16"> </span>stack<span class="_ _16"> </span>to</span></span></div><div class="t m5 x17 h34 y2973 ff6 fs16 fc1 sc0 ls0 ws0">store<span class="_ _10"> </span>return<span class="_ _11"> </span>addresses<span class="_ _10"> </span>makes<span class="_ _10"> </span>it<span class="_ _11"> </span>possible<span class="_ _10"> </span>to<span class="_ _11"> </span>return<span class="_ _10"> </span>to<span class="_ _11"> </span>the<span class="_ _10"> </span>right<span class="_ _10"> </span>point<span class="_ _11"> </span>in<span class="_ _10"> </span>the<span class="_ _11"> </span>procedures.</div><div class="t m5 x17 h26 y2878 ff7 fs19 fc1 sc0 ls0 ws0">then<span class="_ _16"> </span>returns<span class="_ _16"> </span>194<span class="_ _11"> </span>to<span class="_ _16"> </span><span class="ffd">main</span>.<span class="_ _16"> </span>T<span class="_ _0"></span>he<span class="_ _16"> </span>ﬁrst<span class="_ _11"> </span>three<span class="_ _16"> </span>columns<span class="_ _16"> </span>describe<span class="_ _16"> </span>the<span class="_ _16"> </span>instruction<span class="_ _16"> </span>being</div><div class="t m5 x17 h26 y2879 ff7 fs19 fc1 sc0 ls0 ws0">executed,<span class="_ _13"> </span>including<span class="_ _6"> </span>the<span class="_ _6"> </span>instruction<span class="_ _13"> </span>label,<span class="_ _13"> </span>the<span class="_ _6"> </span>address<span class="_ _1"></span>,<span class="_ _13"> </span>and<span class="_ _6"> </span>the<span class="_ _13"> </span>instruction<span class="_ _a"> </span>type.<span class="_ _6"> </span>T<span class="_ _1"></span>he</div><div class="t m5 x17 h26 y287a ff7 fs19 fc1 sc0 ls0 ws0">next<span class="_ _6"> </span>four<span class="_ _13"> </span>columns<span class="_ _6"> </span>show<span class="_ _13"> </span>the<span class="_ _6"> </span>state<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _6"> </span>program<span class="_ _6"> </span><span class="ffa">before<span class="_ _13"> </span></span>the<span class="_ _6"> </span>instruction<span class="_ _13"> </span>is<span class="_ _6"> </span>executed,</div><div class="t m5 x17 h26 y287b ff7 fs19 fc1 sc0 ls0 ws0">including<span class="_ _16"> </span>the<span class="_ _16"> </span>contents<span class="_ _16"> </span>of<span class="_ _16"> </span>registers<span class="_ _11"> </span><span class="ffd">%rdi</span>,<span class="_ _14"> </span><span class="ffd">%rax</span>,<span class="_ _16"> </span>and<span class="_ _16"> </span><span class="ffd">%rsp</span>,<span class="_ _14"> </span>as<span class="_ _16"> </span>well<span class="_ _16"> </span>as<span class="_ _16"> </span>the<span class="_ _11"> </span>value<span class="_ _16"> </span>at</div><div class="t m5 x17 h26 y287c ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>top<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>stack.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>contents<span class="_ _13"> </span>of<span class="_"> </span>this<span class="_ _13"> </span>table<span class="_"> </span>should<span class="_"> </span>be<span class="_ _13"> </span>studied<span class="_"> </span>carefully<span class="_ _7"></span>,<span class="_"> </span>as<span class="_ _13"> </span>they</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
