<div id="pf259" class="pf w2 h11" data-page-no="259"><div class="pc pc259 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg259.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">600<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>5<span class="_ _3d"> </span>Optimizing<span class="_ _10"> </span>Program<span class="_ _10"> </span>Performance</span></div><div class="t m5 x29 h26 y9c ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _13"> </span>second<span class="_ _13"> </span>part<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>proﬁle<span class="_ _6"> </span>report<span class="_ _13"> </span>shows<span class="_ _13"> </span>the<span class="_ _6"> </span>calling<span class="_ _13"> </span>history<span class="_ _13"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>functions<span class="_ _1"></span>.</div><div class="t m5 x1d h26 y409 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>following<span class="_"> </span>is<span class="_"> </span>the<span class="_"> </span>history<span class="_"> </span>for<span class="_"> </span>a<span class="_"> </span>recursive<span class="_"> </span>function<span class="_"> </span><span class="ffd">find_ele_rec</span>:</div><div class="t m5 x119 h2d ye98 ffd fs1e fc2 sc0 ls0 ws0">158655725<span class="_ _35"> </span>find_ele_rec<span class="_ _1f"> </span>[5]</div><div class="t m5 x89 h2d y50cf ffd fs1e fc2 sc0 ls0 ws0">4.85<span class="_ _46"> </span>0.10<span class="_ _1a"> </span>965027/965027<span class="_ _5a"> </span>insert_string<span class="_ _1f"> </span>[4]</div><div class="t m5 x1d h2d y50d0 ffd fs1e fc2 sc0 ls0 ws0">[5]<span class="_ _5a"> </span>2.4<span class="_ _46"> </span>4.85<span class="_ _46"> </span>0.10<span class="_ _1a"> </span>965027+158655725<span class="_ _1f"> </span>find_ele_rec<span class="_ _e"> </span>[5]</div><div class="t m5 x89 h2d y50d1 ffd fs1e fc2 sc0 ls0 ws0">0.08<span class="_ _46"> </span>0.01<span class="_ _1a"> </span>363039/363039<span class="_ _5a"> </span>save_string<span class="_ _1f"> </span>[8]</div><div class="t m5 x89 h2d y50d2 ffd fs1e fc2 sc0 ls0 ws0">0.00<span class="_ _46"> </span>0.01<span class="_ _1a"> </span>363039/363039<span class="_ _5a"> </span>new_ele<span class="_ _1f"> </span>[12]</div><div class="t m5 x119 h2d y50d3 ffd fs1e fc2 sc0 ls0 ws0">158655725<span class="_ _35"> </span>find_ele_rec<span class="_ _1f"> </span>[5]</div><div class="t m5 x1d h26 y50d4 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _1f"> </span>history<span class="_ _1f"> </span>shows<span class="_ _e"> </span>both<span class="_ _1f"> </span>the<span class="_ _e"> </span>functions<span class="_ _1f"> </span>that<span class="_ _1f"> </span>called<span class="_ _e"> </span><span class="ffd">find_ele_rec</span>,<span class="_ _23"> </span>as<span class="_ _e"> </span>well<span class="_ _1f"> </span>as</div><div class="t m5 x1d h26 y50d5 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _21"> </span>functions<span class="_ _21"> </span>that<span class="_ _21"> </span>it<span class="_ _21"> </span>called.<span class="_ _f"> </span>T<span class="_ _1"></span>he<span class="_ _21"> </span>ﬁrst<span class="_ _f"> </span>two<span class="_ _21"> </span>lines<span class="_ _21"> </span>show<span class="_ _21"> </span>the<span class="_ _21"> </span>calls<span class="_ _f"> </span>to<span class="_ _21"> </span>the<span class="_ _21"> </span>function:</div><div class="t m5 x1d h26 y50d6 ff7 fs19 fc2 sc0 ls0 ws0">158,655,725<span class="_ _6"> </span>calls<span class="_ _6"> </span>by<span class="_ _13"> </span>itself<span class="_ _a"> </span>recursively<span class="_ _3"></span>,<span class="_ _13"> </span>and<span class="_ _a"> </span>965,027<span class="_ _13"> </span>calls<span class="_ _a"> </span>by<span class="_ _13"> </span>function<span class="_ _a"> </span><span class="ffd">insert_string</span></div><div class="t m5 x1d h26 y50d7 ff7 fs19 fc2 sc0 ls0 ws0">(which<span class="_"> </span>is<span class="_"> </span>itself<span class="_"> </span>called<span class="_"> </span>965,027<span class="_"> </span>times).<span class="_"> </span>Function<span class="_"> </span><span class="ffd">find_ele_rec</span>,<span class="_"> </span>in<span class="_"> </span>turn,<span class="_"> </span>called<span class="_"> </span>two</div><div class="t m5 x1d h26 y50d8 ff7 fs19 fc2 sc0 ls0 ws0">other<span class="_"> </span>functions<span class="_ _1"></span>,<span class="_"> </span><span class="ffd">save_string<span class="_ _10"> </span></span>and<span class="_"> </span><span class="ffd">new_ele</span>,<span class="_"> </span>each<span class="_"> </span>a<span class="_"> </span>total<span class="_"> </span>of<span class="_"> </span>363,039<span class="_"> </span>times<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y50d9 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>rom<span class="_ _13"> </span>these<span class="_ _13"> </span>call<span class="_ _13"> </span>data,<span class="_ _13"> </span>we<span class="_ _13"> </span>can<span class="_ _6"> </span>often<span class="_ _13"> </span>infer<span class="_ _13"> </span>useful<span class="_ _13"> </span>information<span class="_ _6"> </span>about<span class="_ _13"> </span>the<span class="_ _13"> </span>program</div><div class="t m5 x1d h26 y50da ff7 fs19 fc2 sc0 ls0 ws0">behavior.<span class="_"> </span>F<span class="_ _1"></span>or<span class="_ _11"> </span>example<span class="_ _0"></span>,<span class="_ _11"> </span>the<span class="_ _11"> </span>function<span class="_ _11"> </span><span class="ffd">find_ele_rec<span class="_ _11"> </span></span>is<span class="_ _11"> </span>a<span class="_ _11"> </span>recursive<span class="_ _11"> </span>procedure<span class="_ _11"> </span>that</div><div class="t m5 x1d h26 y50db ff7 fs19 fc2 sc0 ls0 ws0">scans<span class="_ _15"> </span>the<span class="_ _15"> </span>linked<span class="_ _21"> </span>list<span class="_ _15"> </span>for<span class="_ _21"> </span>a<span class="_ _15"> </span>hash<span class="_ _15"> </span>bucket<span class="_ _21"> </span>looking<span class="_ _15"> </span>for<span class="_ _21"> </span>a<span class="_ _15"> </span>particular<span class="_ _21"> </span>string.<span class="_ _14"> </span>F<span class="_ _1"></span>or<span class="_ _21"> </span>this</div><div class="t m5 x1d h26 y50dc ff7 fs19 fc2 sc0 ls0 ws0">function,<span class="_ _16"> </span>comparing<span class="_ _16"> </span>the<span class="_ _16"> </span>number<span class="_ _16"> </span>of<span class="_ _16"> </span>recursive<span class="_ _16"> </span>calls<span class="_ _16"> </span>with<span class="_ _11"> </span>the<span class="_ _16"> </span>number<span class="_ _16"> </span>of<span class="_ _16"> </span>top-level</div><div class="t m5 x1d h26 y50dd ff7 fs19 fc2 sc0 ls0 ws0">calls<span class="_ _16"> </span>provides<span class="_ _11"> </span>statistical<span class="_ _16"> </span>information<span class="_ _16"> </span>about<span class="_ _16"> </span>the<span class="_ _16"> </span>lengths<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>traversals<span class="_ _16"> </span>through</div><div class="t m5 x1d h26 y50de ff7 fs19 fc2 sc0 ls0 ws0">these<span class="_ _13"> </span>lists<span class="_ _0"></span>.<span class="_ _13"> </span>Given<span class="_"> </span>that<span class="_ _13"> </span>their<span class="_"> </span>ratio<span class="_ _13"> </span>is<span class="_"> </span>164.4:1,<span class="_ _13"> </span>we<span class="_"> </span>can<span class="_ _13"> </span>infer<span class="_"> </span>that<span class="_ _13"> </span>the<span class="_"> </span>program<span class="_ _13"> </span>scanned</div><div class="t m5 x1d h26 y50df ff7 fs19 fc2 sc0 ls0 ws0">an<span class="_"> </span>average<span class="_"> </span>of<span class="_"> </span>around<span class="_"> </span>164<span class="_"> </span>elements<span class="_"> </span>each<span class="_"> </span>time<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y50e0 ff7 fs19 fc2 sc0 ls0 ws0">Some<span class="_"> </span>properties<span class="_"> </span>of<span class="_"> </span><span class="ff9">gprof<span class="_ _10"> </span></span>are<span class="_"> </span>worth<span class="_"> </span>noting:</div><div class="t m5 x75 h3d y50e1 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y47f5 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _13"> </span>timing<span class="_ _13"> </span>is<span class="_ _13"> </span>not<span class="_ _13"> </span>very<span class="_ _13"> </span>precise<span class="_ _1"></span>.<span class="_ _13"> </span>It<span class="_ _13"> </span>is<span class="_ _13"> </span>based<span class="_ _13"> </span>on<span class="_ _13"> </span>a<span class="_ _13"> </span>simple<span class="_ _13"> </span><span class="ffa">interval<span class="_ _13"> </span>counting<span class="_ _13"> </span></span>scheme</div><div class="t m5 x29 h26 y50e2 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_ _13"> </span>which<span class="_"> </span>the<span class="_ _13"> </span>compiled<span class="_ _13"> </span>program<span class="_"> </span>maintains<span class="_ _13"> </span>a<span class="_ _13"> </span>counter<span class="_"> </span>for<span class="_ _13"> </span>each<span class="_ _13"> </span>function<span class="_"> </span>record-</div><div class="t m5 x29 h26 y50e3 ff7 fs19 fc1 sc0 ls0 ws0">ing<span class="_ _11"> </span>the<span class="_ _16"> </span>time<span class="_ _16"> </span>spent<span class="_ _11"> </span>executing<span class="_ _16"> </span>that<span class="_ _11"> </span>function.<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span>operating<span class="_ _16"> </span>system<span class="_ _11"> </span>causes<span class="_ _16"> </span>the</div><div class="t m5 x29 h26 y50e4 ff7 fs19 fc1 sc0 ls0 ws0">program<span class="_ _11"> </span>to<span class="_ _11"> </span>be<span class="_ _16"> </span>interrupted<span class="_ _11"> </span>at<span class="_ _11"> </span>some<span class="_ _16"> </span>regular<span class="_"> </span>time<span class="_ _16"> </span>interval<span class="_ _11"> </span><span class="ff11">δ<span class="_ _2"></span></span>.<span class="_ _11"> </span>T<span class="_ _3"></span>ypical<span class="_ _11"> </span>values<span class="_ _11"> </span>of</div><div class="t m5 x29 h26 y50e5 ff11 fs19 fc1 sc0 ls0 ws0">δ<span class="_"> </span><span class="ff7">range<span class="_"> </span>between<span class="_ _11"> </span>1.0<span class="_ _11"> </span>and<span class="_ _11"> </span>10.0<span class="_ _11"> </span>milliseconds<span class="_ _1"></span>.<span class="_ _11"> </span>It<span class="_ _11"> </span>then<span class="_ _11"> </span>determines<span class="_ _11"> </span>what<span class="_ _11"> </span>function</span></div><div class="t m5 x29 h26 y50e6 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _11"> </span>program<span class="_ _11"> </span>was<span class="_ _16"> </span>executing<span class="_ _11"> </span>when<span class="_ _11"> </span>the<span class="_ _16"> </span>interrupt<span class="_ _11"> </span>occurred<span class="_ _11"> </span>and<span class="_ _16"> </span>increments<span class="_ _11"> </span>the</div><div class="t m5 x29 h26 y50e7 ff7 fs19 fc1 sc0 ls0 ws0">counter<span class="_ _13"> </span>for<span class="_ _13"> </span>that<span class="_"> </span>function<span class="_ _13"> </span>by<span class="_ _13"> </span><span class="ff11">δ<span class="_ _2"></span></span>.<span class="_ _13"> </span>Of<span class="_ _13"> </span>course,<span class="_ _13"> </span>it<span class="_ _13"> </span>may<span class="_ _13"> </span>happen<span class="_"> </span>that<span class="_ _13"> </span>this<span class="_ _13"> </span>function<span class="_ _13"> </span>just</div><div class="t m5 x29 h26 y50e8 ff7 fs19 fc1 sc0 ls0 ws0">started<span class="_ _13"> </span>executing<span class="_"> </span>and<span class="_ _13"> </span>will<span class="_"> </span>shortly<span class="_ _13"> </span>be<span class="_ _13"> </span>completed,<span class="_"> </span>but<span class="_ _13"> </span>it<span class="_"> </span>is<span class="_ _13"> </span>assigned<span class="_ _13"> </span>the<span class="_"> </span>full<span class="_ _13"> </span>cost</div><div class="t m5 x29 h26 y50e9 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_ _16"> </span>the<span class="_ _11"> </span>execution<span class="_ _16"> </span>since<span class="_ _16"> </span>the<span class="_ _16"> </span>previous<span class="_ _11"> </span>interrupt.<span class="_ _16"> </span>Some<span class="_ _16"> </span>other<span class="_ _16"> </span>function<span class="_ _11"> </span>may<span class="_ _16"> </span>run</div><div class="t m5 x29 h26 y50ea ff7 fs19 fc1 sc0 ls0 ws0">between<span class="_"> </span>two<span class="_"> </span>interrupts<span class="_"> </span>and<span class="_"> </span>therefore<span class="_"> </span>not<span class="_"> </span>be<span class="_"> </span>charged<span class="_"> </span>any<span class="_"> </span>time<span class="_"> </span>at<span class="_"> </span>all.</div><div class="t m5 xcd h26 y50eb ff7 fs19 fc1 sc0 ls0 ws0">Over<span class="_ _13"> </span>a<span class="_ _13"> </span>long<span class="_ _13"> </span>duration,<span class="_ _13"> </span>this<span class="_ _13"> </span>scheme<span class="_ _13"> </span>works<span class="_ _13"> </span>reasonably<span class="_ _13"> </span>well.<span class="_ _6"> </span>Statistically<span class="_ _3"></span>,<span class="_"> </span>ev-</div><div class="t m5 x29 h26 y50ec ff7 fs19 fc1 sc0 ls0 ws0">ery<span class="_ _13"> </span>function<span class="_"> </span>should<span class="_ _13"> </span>be<span class="_ _13"> </span>charged<span class="_"> </span>according<span class="_ _13"> </span>to<span class="_ _13"> </span>the<span class="_"> </span>relative<span class="_ _13"> </span>time<span class="_ _13"> </span>spent<span class="_"> </span>executing</div><div class="t m5 x29 h26 y50ed ff7 fs19 fc1 sc0 ls0 ws0">it.<span class="_ _13"> </span>F<span class="_ _3"></span>or<span class="_ _13"> </span>programs<span class="_ _13"> </span>that<span class="_ _13"> </span>run<span class="_ _13"> </span>for<span class="_ _13"> </span>less<span class="_ _13"> </span>than<span class="_ _13"> </span>around<span class="_ _6"> </span>1<span class="_ _13"> </span>second,<span class="_ _13"> </span>however,<span class="_ _13"> </span>the<span class="_ _13"> </span>numbers</div><div class="t m5 x29 h26 y50ee ff7 fs19 fc1 sc0 ls0 ws0">should<span class="_"> </span>be<span class="_"> </span>viewed<span class="_"> </span>as<span class="_"> </span>only<span class="_"> </span>rough<span class="_"> </span>estimates<span class="_ _1"></span>.</div><div class="t m5 x75 h3d y50ef ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y50f0 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _f"> </span>calling<span class="_ _f"> </span>information<span class="_ _f"> </span>is<span class="_ _f"> </span>quite<span class="_ _f"> </span>reliable,<span class="_ _f"> </span>assuming<span class="_ _f"> </span>no<span class="_ _f"> </span>inline<span class="_ _f"> </span>substitutions</div><div class="t m5 x29 h26 y50f1 ff7 fs19 fc1 sc0 ls0 ws0">have<span class="_ _16"> </span>been<span class="_ _16"> </span>performed.<span class="_ _16"> </span>The<span class="_ _16"> </span>compiled<span class="_ _16"> </span>program<span class="_ _16"> </span>maintains<span class="_ _16"> </span>a<span class="_ _16"> </span>counter<span class="_ _14"> </span>for<span class="_ _16"> </span>each</div><div class="t m5 x29 h26 y50f2 ff7 fs19 fc1 sc0 ls0 ws0">combination<span class="_ _21"> </span>of<span class="_ _21"> </span>caller<span class="_ _f"> </span>and<span class="_ _21"> </span>callee.<span class="_ _15"> </span>The<span class="_ _15"> </span>appropriate<span class="_ _f"> </span>counter<span class="_ _21"> </span>is<span class="_ _f"> </span>incremented</div><div class="t m5 x29 h26 y50f3 ff7 fs19 fc1 sc0 ls0 ws0">every<span class="_"> </span>time<span class="_"> </span>a<span class="_"> </span>procedure<span class="_"> </span>is<span class="_"> </span>called.</div><div class="t m5 x75 h3d y50f4 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y7a6 ff7 fs19 fc1 sc0 ls0 ws0">By<span class="_ _14"> </span>default,<span class="_ _f"> </span>the<span class="_ _14"> </span>timings<span class="_ _15"> </span>for<span class="_ _15"> </span>library<span class="_ _15"> </span>functions<span class="_ _15"> </span>are<span class="_ _15"> </span>not<span class="_ _15"> </span>shown.<span class="_ _14"> </span>Instead,<span class="_ _21"> </span>these</div><div class="t m5 x29 h26 y7a7 ff7 fs19 fc1 sc0 ls0 ws0">times<span class="_"> </span>are<span class="_"> </span>incorporated<span class="_"> </span>into<span class="_"> </span>the<span class="_"> </span>times<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>calling<span class="_"> </span>functions<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
