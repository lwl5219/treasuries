<div id="pf124" class="pf w2 h11" data-page-no="124"><div class="pc pc124 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg124.png"/><div class="t m5 xc0 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>3.8<span class="_ _60"> </span>Array<span class="_ _10"> </span>Allocation<span class="_ _10"> </span>and<span class="_ _10"> </span>Access<span class="_ _3e"> </span><span class="ffe fs1e">291</span></div><div class="t m5 x17 h2d y140c ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>rfun(unsigned<span class="_ _1f"> </span>long<span class="_ _1f"> </span>x)<span class="_ _e"> </span>{</div><div class="t m5 x1b6 h2d y140d ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>(</div><div class="t m5 x209 h2d yc4d ffd fs1e fc2 sc0 ls0 ws0">)</div><div class="t m5 x21e h2d y2720 ffd fs1e fc2 sc0 ls0 ws0">return</div><div class="t m5 x25 h2d yecb ffd fs1e fc2 sc0 ls0 ws0">;</div><div class="t m5 x1b6 h2d y2145 ffd fs1e fc2 sc0 ls0 ws0">unsigned<span class="_ _e"> </span>long<span class="_ _1f"> </span>nx<span class="_ _1f"> </span>=</div><div class="t m5 x16c h2d yecc ffd fs1e fc2 sc0 ls0 ws0">;</div><div class="t m5 x1b6 h2d y23be ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>rv<span class="_ _1f"> </span>=<span class="_ _1f"> </span>rfun(nx);</div><div class="t m5 x1b6 h2d y2721 ffd fs1e fc2 sc0 ls0 ws0">return</div><div class="t m5 x21f h2d yece ffd fs1e fc2 sc0 ls0 ws0">;</div><div class="t m5 x17 h2d y23c0 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x17 h26 y2a47 ff9 fs19 fc2 sc0 ls0 ws0">gcc<span class="_ _10"> </span><span class="ff7">generates<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>assembly<span class="_"> </span>code:</span></div><div class="t m5 x2e h61 y280a ff13 fs35 fc6 sc0 ls0 ws0">long<span class="_ _f"> </span>rfun(unsigned<span class="_ _f"> </span>long<span class="_ _f"> </span>x)</div><div class="t m5 x2e h61 y2a48 ff13 fs35 fc6 sc0 ls0 ws0">x<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi</div><div class="t m5 x2c h2d y280c ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">rfun:</span></div><div class="t m5 x2c h2d y280d ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">pushq<span class="_ _3f"> </span>%rbx</span></div><div class="t m5 x2c h2d y280e ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rdi,<span class="_ _e"> </span>%rbx</span></div><div class="t m5 x2c h2d y280f ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">movl<span class="_ _46"> </span>$0,<span class="_ _e"> </span>%eax</span></div><div class="t m5 x2c h2d y2a49 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">testq<span class="_ _3f"> </span>%rdi,<span class="_ _e"> </span>%rdi</span></div><div class="t m5 x2c h2d y2a4a ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">je<span class="_ _5a"> </span>.L2</span></div><div class="t m5 x2c h2d y2a4b ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">shrq<span class="_ _46"> </span>$2,<span class="_ _e"> </span>%rdi</span></div><div class="t m5 x2c h2d y2a4c ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _45"> </span><span class="ffd fs1e fc2">call<span class="_ _46"> </span>rfun</span></div><div class="t m5 x2c h2d y2a4d ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _45"> </span><span class="ffd fs1e fc2">addq<span class="_ _46"> </span>%rbx,<span class="_ _e"> </span>%rax</span></div><div class="t m5 x17 h2d y2a4e ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L2:</span></div><div class="t m5 x17 h2d y2a4f ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _45"> </span><span class="ffd fs1e fc2">popq<span class="_ _46"> </span>%rbx</span></div><div class="t m5 x17 h2d y2a50 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _45"> </span><span class="ffd fs1e fc2">ret</span></div><div class="t m5 x34 h26 y2a51 ff7 fs19 fc2 sc0 ls0 ws0">A.<span class="_ _1f"> </span>What<span class="_"> </span>value<span class="_"> </span>does<span class="_"> </span><span class="ffd">rfun<span class="_ _10"> </span></span>store<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>callee-saved<span class="_"> </span>register<span class="_"> </span><span class="ffd">%rbx</span>?</div><div class="t m5 x34 h26 y2a52 ff7 fs19 fc2 sc0 ls0 ws0">B<span class="_ _3"></span>.<span class="_ _1d"> </span>Fill<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>missing<span class="_"> </span>expressions<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>C<span class="_"> </span>code<span class="_"> </span>shown<span class="_"> </span>above<span class="_ _1"></span>.</div><div class="t m5 x17 h3b y2a53 fff fs24 fc6 sc0 ls0 ws0">3.8<span class="_ _17"> </span><span class="ffe fs18">Array<span class="_"> </span>Allocation<span class="_"> </span>and<span class="_"> </span>Access</span></div><div class="t m5 x17 h26 y1fd9 ff7 fs19 fc1 sc0 ls0 ws0">Arrays<span class="_ _16"> </span>in<span class="_ _14"> </span>C<span class="_ _14"> </span>are<span class="_ _14"> </span>one<span class="_ _14"> </span>means<span class="_ _14"> </span>of<span class="_ _14"> </span>aggregating<span class="_ _16"> </span>scalar<span class="_ _14"> </span>data<span class="_ _14"> </span>into<span class="_ _14"> </span>larger<span class="_ _14"> </span>data<span class="_ _14"> </span>types<span class="_ _1"></span>.<span class="_ _16"> </span>C</div><div class="t m5 x17 h26 y1fda ff7 fs19 fc1 sc0 ls0 ws0">uses<span class="_ _15"> </span>a<span class="_ _15"> </span>particularly<span class="_ _15"> </span>simple<span class="_ _14"> </span>implementation<span class="_ _15"> </span>of<span class="_ _15"> </span>arrays<span class="_ _1"></span>,<span class="_ _f"> </span>and<span class="_ _15"> </span>hence<span class="_ _15"> </span>the<span class="_ _15"> </span>translation</div><div class="t m5 x17 h26 y1fdb ff7 fs19 fc1 sc0 ls0 ws0">into<span class="_ _11"> </span>machine<span class="_ _16"> </span>code<span class="_ _11"> </span>is<span class="_ _16"> </span>fairly<span class="_ _11"> </span>straightforward.<span class="_ _16"> </span>One<span class="_ _11"> </span>unusual<span class="_ _16"> </span>feature<span class="_ _11"> </span>of<span class="_ _11"> </span>C<span class="_ _16"> </span>is<span class="_ _11"> </span>that<span class="_ _16"> </span>we</div><div class="t m5 x17 h26 y2a54 ff7 fs19 fc1 sc0 ls0 ws0">can<span class="_ _13"> </span>generate<span class="_ _6"> </span>pointers<span class="_ _13"> </span>to<span class="_ _13"> </span>elements<span class="_ _6"> </span>within<span class="_ _13"> </span>arrays<span class="_ _13"> </span>and<span class="_ _6"> </span>perform<span class="_ _13"> </span>arithmetic<span class="_ _13"> </span>with<span class="_ _6"> </span>these</div><div class="t m5 x17 h26 y2a55 ff7 fs19 fc1 sc0 ls0 ws0">pointers<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _1"></span>hese<span class="_"> </span>are<span class="_"> </span>translated<span class="_"> </span>into<span class="_"> </span>address<span class="_"> </span>computations<span class="_"> </span>in<span class="_"> </span>machine<span class="_"> </span>code.</div><div class="t m5 x26 h26 y2a56 ff7 fs19 fc1 sc0 ls0 ws0">Optimizing<span class="_ _13"> </span>compilers<span class="_ _13"> </span>are<span class="_ _13"> </span>particularly<span class="_ _13"> </span>good<span class="_ _13"> </span>at<span class="_ _13"> </span>simplifying<span class="_ _13"> </span>the<span class="_ _13"> </span>address<span class="_ _6"> </span>compu-</div><div class="t m5 x17 h26 y2a57 ff7 fs19 fc1 sc0 ls0 ws0">tations<span class="_"> </span>used<span class="_ _13"> </span>by<span class="_"> </span>array<span class="_ _13"> </span>indexing.<span class="_"> </span>T<span class="_ _1"></span>his<span class="_"> </span>can<span class="_ _13"> </span>make<span class="_"> </span>the<span class="_"> </span>correspondence<span class="_ _13"> </span>between<span class="_"> </span>the<span class="_ _13"> </span>C</div><div class="t m5 x17 h26 y2a58 ff7 fs19 fc1 sc0 ls0 ws0">code<span class="_"> </span>and<span class="_"> </span>its<span class="_"> </span>translation<span class="_"> </span>into<span class="_"> </span>machine<span class="_"> </span>code<span class="_"> </span>somewhat<span class="_"> </span>difÔ¨Åcult<span class="_"> </span>to<span class="_"> </span>decipher.</div><div class="t m5 x17 h41 y2a59 ffe fs29 fc1 sc0 ls0 ws0">3.8.1<span class="_ _48"> </span><span class="fs19">Basic<span class="_"> </span>Principles</span></div><div class="t m5 x17 h26 y2a5a ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_"> </span>data<span class="_"> </span>type<span class="_"> </span><span class="ff11">T<span class="_ _f"> </span></span>and<span class="_"> </span>integer<span class="_"> </span>constant<span class="_"> </span><span class="ff11">N<span class="_ _be"> </span></span>,<span class="_"> </span>consider<span class="_"> </span>a<span class="_"> </span>declaration<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>form</div><div class="t m5 x17 h53 y77e ffa fs1e fc2 sc0 ls0 ws0">T<span class="_ _23"> </span><span class="ffd">A[</span>N<span class="_ _5"></span><span class="ffd">];</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
