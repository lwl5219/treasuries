<div id="pf1f2" class="pf w2 h11" data-page-no="1f2"><div class="pc pc1f2 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1f2.png"/><div class="t m5 x13d h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>4.5<span class="_ _60"> </span>Pipelined<span class="_ _10"> </span>Y86-64<span class="_ _10"> </span>Implementations<span class="_ _3e"> </span><span class="ffe fs1e">497</span></div><div class="t m5 x17 h2f ye7 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>4.67</div><div class="t m5 x17 h2f y58a ffe fs16 fc1 sc0 ls0 ws0">Pipeline<span class="_"> </span>states<span class="_"> </span>for<span class="_"> </span>special</div><div class="t m5 x17 h34 y58b ffe fs16 fc1 sc0 ls0 ws0">control<span class="_ _16"> </span>conditions.<span class="_ _11"> </span><span class="ff6">The</span></div><div class="t m5 x17 h34 y58c ff6 fs16 fc1 sc0 ls0 ws0">two<span class="_ _16"> </span>pairs<span class="_ _16"> </span>indicated<span class="_ _16"> </span>can</div><div class="t m5 x17 h34 y58d ff6 fs16 fc1 sc0 ls0 ws0">arise<span class="_ _10"> </span>simultaneously<span class="_ _1"></span>.</div><div class="t m5 x183 h3f y4566 ff51 fs27 fc1 sc0 ls0 ws0">Load/use</div><div class="t m5 xb3 h3f y4567 ff51 fs27 fc1 sc0 ls0 ws0">M</div><div class="t m5 x16 h3f y4568 ff51 fs27 fc1 sc0 ls0 ws0">Mispredict</div><div class="t m5 x6a h40 y4569 ff52 fs28 fc1 sc0 ls0 ws0">ret <span class="ff51 fs27">1<span class="_ _94"> </span></span>ret <span class="ff51 fs27">2<span class="_ _2e"> </span></span>ret <span class="ff51 fs27">3</span></div><div class="t m5 xb3 h3f y456a ff51 fs27 fc1 sc0 ls0 ws0">E</div><div class="t m5 xb3 h3f y456b ff51 fs27 fc1 sc0 ls0 ws0">D</div><div class="t m5 x15 h3f y456c ff51 fs27 fc1 sc0 ls0 ws0">M</div><div class="t m5 x15 h3f y456a ff51 fs27 fc1 sc0 ls0 ws0">E</div><div class="t m5 x138 h40 y456d ff52 fs28 fc1 sc0 ls0 ws0">JXX<span class="_ _1a6"></span><span class="ff51 fs27">Load</span></div><div class="t m5 x85 h40 y456e ff52 fs28 fc1 sc0 ls0 ws0">ret<span class="_ _1d4"></span><span class="ff51 fs27">Use</span></div><div class="t m5 x23c h3f y456f ff51 fs27 fc1 sc0 ls0 ws0">bubble</div><div class="t m5 x1dc h40 y4570 ff52 fs28 fc1 sc0 ls0 ws0">ret</div><div class="t m5 x71 h3f y4571 ff51 fs27 fc1 sc0 ls0 ws0">bubble</div><div class="t m5 x71 h3f y4572 ff51 fs27 fc1 sc0 ls0 ws0">bubble</div><div class="t m5 x248 h40 y4573 ff52 fs28 fc1 sc0 ls0 ws0">ret</div><div class="t m5 x15 h3f y4574 ff51 fs27 fc1 sc0 ls0 ws0">D</div><div class="t m5 x24f h3f y4575 ff51 fs27 fc1 sc0 ls0 ws0">M</div><div class="t m5 x13d h3f y4576 ff51 fs27 fc1 sc0 ls0 ws5">Combination A</div><div class="t m5 xd3 h3f y4577 ff51 fs27 fc1 sc0 ls0 ws0">Combination B</div><div class="t m5 x24f h3f y4578 ff51 fs27 fc1 sc0 ls0 ws0">E</div><div class="t m5 x24f h3f y4579 ff51 fs27 fc1 sc0 ls0 ws0">D</div><div class="t m5 x1dd h3f y457a ff51 fs27 fc1 sc0 ls0 ws0">M</div><div class="t m5 x1dd h3f y4578 ff51 fs27 fc1 sc0 ls0 ws0">E</div><div class="t m5 x1dd h3f y4579 ff51 fs27 fc1 sc0 ls0 ws0">D</div><div class="t m5 x104 h3f y457a ff51 fs27 fc1 sc0 ls0 ws0">M</div><div class="t m5 x104 h3f y4578 ff51 fs27 fc1 sc0 ls0 ws0">E</div><div class="t m5 x104 h3f y4579 ff51 fs27 fc1 sc0 ls0 ws0">D</div><div class="t m5 x17 h26 y457b ff7 fs19 fc1 sc0 ls0 ws0">conditions<span class="_ _1"></span>.<span class="_ _15"> </span>T<span class="_ _1"></span>hese<span class="_ _15"> </span>diagrams<span class="_ _21"> </span>show<span class="_ _15"> </span>blocks<span class="_ _15"> </span>for<span class="_ _15"> </span>the<span class="_ _15"> </span>decode<span class="_ _0"></span>,<span class="_ _21"> </span>execute<span class="_ _0"></span>,<span class="_ _21"> </span>and<span class="_ _15"> </span>memory</div><div class="t m5 x17 h26 y457c ff7 fs19 fc1 sc0 ls0 ws0">stages<span class="_ _1"></span>.<span class="_ _16"> </span>The<span class="_ _16"> </span>shaded<span class="_ _16"> </span>boxes<span class="_ _16"> </span>represent<span class="_ _14"> </span>particular<span class="_ _16"> </span>constraints<span class="_ _14"> </span>that<span class="_ _16"> </span>must<span class="_ _14"> </span>be<span class="_ _16"> </span>satisﬁed</div><div class="t m5 x17 h26 y457d ff7 fs19 fc1 sc0 ls0 ws0">for<span class="_ _11"> </span>the<span class="_ _16"> </span>condition<span class="_ _16"> </span>to<span class="_ _11"> </span>arise.<span class="_ _11"> </span>A<span class="_ _16"> </span>load/use<span class="_ _11"> </span>hazard<span class="_ _16"> </span>requires<span class="_ _11"> </span>that<span class="_ _16"> </span>the<span class="_ _16"> </span>instruction<span class="_ _11"> </span>in<span class="_ _16"> </span>the</div><div class="t m5 x17 h26 y457e ff7 fs19 fc1 sc0 ls0 ws0">execute<span class="_"> </span>stage<span class="_"> </span>reads<span class="_"> </span>a<span class="_"> </span>value<span class="_"> </span>from<span class="_"> </span>memory<span class="_"> </span>into<span class="_"> </span>a<span class="_"> </span>register<span class="_ _1"></span>,<span class="_"> </span>and<span class="_"> </span>that<span class="_"> </span>the<span class="_"> </span>instruction</div><div class="t m5 x17 h26 y457f ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_"> </span>the<span class="_ _11"> </span>decode<span class="_"> </span>stage<span class="_ _11"> </span>has<span class="_"> </span>this<span class="_ _11"> </span>register<span class="_"> </span>as<span class="_ _11"> </span>a<span class="_"> </span>source<span class="_ _11"> </span>operand.<span class="_"> </span>A<span class="_ _11"> </span>mispredicted<span class="_"> </span>branch</div><div class="t m5 x17 h26 y4580 ff7 fs19 fc1 sc0 ls0 ws0">requires<span class="_ _13"> </span>the<span class="_"> </span>instruction<span class="_ _13"> </span>in<span class="_"> </span>the<span class="_ _13"> </span>execute<span class="_ _13"> </span>stage<span class="_"> </span>to<span class="_ _13"> </span>have<span class="_"> </span>a<span class="_ _13"> </span>jump<span class="_ _13"> </span>instruction.<span class="_"> </span>T<span class="_ _1"></span>here<span class="_"> </span>are</div><div class="t m5 x17 h26 y4581 ff7 fs19 fc1 sc0 ls0 ws0">three<span class="_ _13"> </span>possible<span class="_"> </span>cases<span class="_ _13"> </span>for<span class="_"> </span><span class="ffd">ret</span>—the<span class="_ _13"> </span>instruction<span class="_"> </span>can<span class="_ _13"> </span>be<span class="_"> </span>in<span class="_ _13"> </span>either<span class="_"> </span>the<span class="_ _13"> </span>decode<span class="_ _1"></span>,<span class="_"> </span>execute<span class="_ _1"></span>,</div><div class="t m5 x17 h26 y4582 ff7 fs19 fc1 sc0 ls0 ws0">or<span class="_ _11"> </span>memory<span class="_ _11"> </span>stage.<span class="_"> </span>As<span class="_ _11"> </span>the<span class="_ _11"> </span><span class="ffd">ret<span class="_ _16"> </span></span>instruction<span class="_"> </span>moves<span class="_ _16"> </span>through<span class="_"> </span>the<span class="_ _16"> </span>pipeline<span class="_ _1"></span>,<span class="_ _16"> </span>the<span class="_"> </span>earlier</div><div class="t m5 x17 h26 y4583 ff7 fs19 fc1 sc0 ls0 ws0">pipeline<span class="_"> </span>stages<span class="_"> </span>will<span class="_"> </span>have<span class="_"> </span>bubbles<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y4584 ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _13"> </span>can<span class="_ _13"> </span>see<span class="_ _13"> </span>by<span class="_ _6"> </span>these<span class="_ _13"> </span>diagrams<span class="_ _13"> </span>that<span class="_ _13"> </span>most<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>control<span class="_ _13"> </span>conditions<span class="_ _13"> </span>are<span class="_ _6"> </span>mutually</div><div class="t m5 x17 h26 y4585 ff7 fs19 fc1 sc0 ls0 ws0">exclusive<span class="_ _1"></span>.<span class="_ _11"> </span>F<span class="_ _1"></span>or<span class="_"> </span>example,<span class="_"> </span>it<span class="_"> </span>is<span class="_"> </span>not<span class="_"> </span>possible<span class="_ _11"> </span>to<span class="_"> </span>have<span class="_ _11"> </span>a<span class="_"> </span>load/use<span class="_"> </span>hazard<span class="_ _11"> </span>and<span class="_"> </span>a<span class="_"> </span>mispre-</div><div class="t m5 x17 h26 y4586 ff7 fs19 fc1 sc0 ls0 ws0">dicted<span class="_ _14"> </span>branch<span class="_ _14"> </span>simultaneously<span class="_ _3"></span>,<span class="_ _21"> </span>since<span class="_ _14"> </span>one<span class="_ _15"> </span>requires<span class="_ _14"> </span>a<span class="_ _14"> </span>load<span class="_ _15"> </span>instruction<span class="_ _14"> </span>(<span class="ffd">mrmovq<span class="_ _15"> </span></span>or</div><div class="t m5 x17 h26 y4587 ffd fs19 fc1 sc0 ls0 ws0">popq<span class="ff7">)<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>execute<span class="_"> </span>stage,<span class="_"> </span>while<span class="_"> </span>the<span class="_"> </span>other<span class="_"> </span>requires<span class="_"> </span>a<span class="_"> </span>jump.<span class="_"> </span>Similarly<span class="_ _7"></span>,<span class="_ _11"> </span>the<span class="_"> </span>second</span></div><div class="t m5 x17 h26 y4588 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _13"> </span>third<span class="_"> </span><span class="ffd">ret<span class="_ _13"> </span></span>combinations<span class="_ _13"> </span>cannot<span class="_"> </span>occur<span class="_ _13"> </span>at<span class="_"> </span>the<span class="_ _13"> </span>same<span class="_ _13"> </span>time<span class="_"> </span>as<span class="_ _13"> </span>a<span class="_ _13"> </span>load/use<span class="_"> </span>hazard<span class="_ _13"> </span>or</div><div class="t m5 x17 h26 y4589 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_"> </span>mispredicted<span class="_"> </span>branch.<span class="_ _11"> </span>Only<span class="_"> </span>the<span class="_ _11"> </span>two<span class="_"> </span>combinations<span class="_ _11"> </span>indicated<span class="_"> </span>by<span class="_ _11"> </span>arrows<span class="_"> </span>can<span class="_ _11"> </span>arise</div><div class="t m5 x17 h26 y458a ff7 fs19 fc1 sc0 ls0 ws0">simultaneously<span class="_ _3"></span>.</div><div class="t m5 x26 h26 y458b ff7 fs19 fc1 sc0 ls0 ws0">Combination<span class="_ _6"> </span>A<span class="_ _13"> </span>involves<span class="_ _6"> </span>a<span class="_ _13"> </span>not-taken<span class="_ _6"> </span>jump<span class="_ _6"> </span>instruction<span class="_ _13"> </span>in<span class="_ _6"> </span>the<span class="_ _13"> </span>execute<span class="_ _6"> </span>stage<span class="_ _13"> </span>and</div><div class="t m5 x17 h26 y458c ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_ _13"> </span><span class="ffd">ret<span class="_ _13"> </span></span>instruction<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_ _13"> </span>decode<span class="_ _13"> </span>stage<span class="_ _1"></span>.<span class="_ _13"> </span>Setting<span class="_ _13"> </span>up<span class="_ _13"> </span>this<span class="_ _13"> </span>combination<span class="_ _13"> </span>requires<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ffd">ret</span></div><div class="t m5 x17 h26 y458d ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_"> </span>be<span class="_ _13"> </span>at<span class="_"> </span>the<span class="_"> </span>target<span class="_"> </span>of<span class="_ _13"> </span>a<span class="_"> </span>not-taken<span class="_"> </span>branch.<span class="_ _13"> </span>The<span class="_ _13"> </span>pipeline<span class="_"> </span>control<span class="_"> </span>logic<span class="_"> </span>should<span class="_ _13"> </span>detect</div><div class="t m5 x17 h26 y458e ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_"> </span>the<span class="_"> </span>branch<span class="_"> </span>was<span class="_"> </span>mispredicted<span class="_"> </span>and<span class="_"> </span>therefore<span class="_"> </span>cancel<span class="_"> </span>the<span class="_"> </span><span class="ffd">ret<span class="_ _10"> </span></span>instruction.</div><div class="t m5 x17 h47 y458f ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>4.37<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>528)</span></div><div class="t m5 x17 h26 y4590 ff7 fs19 fc1 sc0 ls0 ws0">Write<span class="_ _16"> </span>a<span class="_ _11"> </span>Y86-64<span class="_ _16"> </span>assembly-language<span class="_ _16"> </span>program<span class="_ _16"> </span>that<span class="_ _16"> </span>causes<span class="_ _11"> </span>combination<span class="_ _16"> </span>A<span class="_ _16"> </span>to<span class="_ _16"> </span>arise</div><div class="t m5 x17 h26 y4591 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_"> </span>determines<span class="_"> </span>whether<span class="_"> </span>the<span class="_"> </span>control<span class="_"> </span>logic<span class="_"> </span>handles<span class="_"> </span>it<span class="_"> </span>correctly<span class="_ _3"></span>.</div><div class="t m5 x26 h26 y4592 ff7 fs19 fc1 sc0 ls0 ws0">Combining<span class="_ _6"> </span>the<span class="_ _6"> </span>control<span class="_ _6"> </span>actions<span class="_ _13"> </span>for<span class="_ _a"> </span>the<span class="_ _6"> </span>combination<span class="_ _13"> </span>A<span class="_ _a"> </span>conditions<span class="_ _6"> </span>(Figure<span class="_ _a"> </span>4.66),</div><div class="t m5 x17 h26 y4593 ff7 fs19 fc1 sc0 ls0 ws0">we<span class="_"> </span>get<span class="_ _11"> </span>the<span class="_ _11"> </span>following<span class="_ _11"> </span>pipeline<span class="_"> </span>control<span class="_ _11"> </span>actions<span class="_ _11"> </span>(assuming<span class="_ _11"> </span>that<span class="_"> </span>either<span class="_ _11"> </span>a<span class="_ _11"> </span>bubble<span class="_ _11"> </span>or<span class="_"> </span>a</div><div class="t m5 x17 h26 y4594 ff7 fs19 fc1 sc0 ls0 ws0">stall<span class="_"> </span>overrides<span class="_"> </span>the<span class="_"> </span>normal<span class="_"> </span>case):</div><div class="t m5 xdd h31 y4595 ff7 fs21 fc2 sc0 ls0 ws0">Pipeline<span class="_"> </span>register</div><div class="t m5 x17 h31 y4596 ff7 fs21 fc2 sc0 ls0 ws0">Condition<span class="_ _17d"> </span>F<span class="_ _71"> </span>D<span class="_ _1b3"> </span>E<span class="_ _1b3"> </span>M<span class="_ _ba"> </span>W</div><div class="t m5 x17 h31 y1ef9 ff7 fs21 fc2 sc0 ls0 ws0">Processing<span class="_"> </span><span class="ffd fs1e">ret<span class="_ _7d"> </span></span>stall<span class="_ _4f"> </span>bubble<span class="_ _26"> </span>normal<span class="_ _26"> </span>normal<span class="_ _26"> </span>normal</div><div class="t m5 x17 h31 y4597 ff7 fs21 fc2 sc0 ls0 ws0">Mispredicted<span class="_"> </span>branch<span class="_ _26"> </span>normal<span class="_ _26"> </span>bubble<span class="_ _5e"> </span>bubble<span class="_ _95"> </span>normal<span class="_ _26"> </span>normal</div><div class="t m5 x17 h31 y4598 ff7 fs21 fc2 sc0 ls0 ws0">Combination<span class="_ _1d5"> </span>stall<span class="_ _4f"> </span>bubble<span class="_ _95"> </span>bubble<span class="_ _95"> </span>normal<span class="_ _26"> </span>normal</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
