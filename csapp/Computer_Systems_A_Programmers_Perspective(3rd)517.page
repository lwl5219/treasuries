<div id="pf205" class="pf w2 h11" data-page-no="205"><div class="pc pc205 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg205.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">516<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>4<span class="_ _3d"> </span>Processor<span class="_ _10"> </span>Architecture</span></div><div class="t m5 x10c h2d ye7 ffd fs1e fc2 sc0 ls0 ws0">iaddq<span class="_ _1a"> </span>$8,<span class="_ _e"> </span>%rsp</div><div class="t m5 x10c h39 y2682 ffd fs1e fc2 sc0 ls0 ws0">mrmovq<span class="_ _e"> </span>-8(%rsp),<span class="_ _1f"> </span><span class="ff6">rA</span></div><div class="t m5 x1d h26 y4782 ff7 fs19 fc2 sc0 ls0 ws0">(See<span class="_ _16"> </span>Practice<span class="_ _14"> </span>Problem<span class="_ _14"> </span>4.3<span class="_ _16"> </span>for<span class="_ _14"> </span>a<span class="_ _16"> </span>description<span class="_ _14"> </span>of<span class="_ _14"> </span>the<span class="_ _16"> </span><span class="ffd">iaddq<span class="_ _14"> </span></span>instruction.)<span class="_ _14"> </span>Note<span class="_ _16"> </span>the</div><div class="t m5 x1d h26 y4783 ff7 fs19 fc2 sc0 ls0 ws0">ordering<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>two<span class="_ _13"> </span>instructions<span class="_"> </span>to<span class="_ _13"> </span>make<span class="_"> </span>sure<span class="_ _13"> </span><span class="ffd">popq<span class="_ _16"> </span>%rsp<span class="_ _10"> </span></span>works<span class="_ _13"> </span>properly<span class="_ _3"></span>.<span class="_"> </span>Y<span class="_ _7"></span>ou<span class="_"> </span>can</div><div class="t m5 x1d h26 y4784 ff7 fs19 fc2 sc0 ls0 ws0">do<span class="_"> </span>this<span class="_ _13"> </span>by<span class="_"> </span>having<span class="_ _13"> </span>the<span class="_"> </span>logic<span class="_ _13"> </span>in<span class="_"> </span>the<span class="_ _13"> </span>decode<span class="_"> </span>stage<span class="_ _13"> </span>treat<span class="_"> </span><span class="ffd">popq<span class="_ _10"> </span></span>the<span class="_ _13"> </span>same<span class="_"> </span>as<span class="_ _13"> </span>it<span class="_"> </span>would<span class="_ _13"> </span>the</div><div class="t m5 x1d h26 y4785 ffd fs19 fc2 sc0 ls0 ws0">iaddq<span class="_ _10"> </span><span class="ff7">listed<span class="_ _11"> </span>above,<span class="_"> </span>except<span class="_"> </span>that<span class="_ _11"> </span>it<span class="_"> </span>predicts<span class="_ _11"> </span>the<span class="_ _11"> </span>next<span class="_"> </span>PC<span class="_ _11"> </span>to<span class="_ _11"> </span>be<span class="_"> </span>equal<span class="_ _11"> </span>to<span class="_ _11"> </span>the<span class="_"> </span>current</span></div><div class="t m5 x1d h26 y4786 ff7 fs19 fc2 sc0 ls0 ws0">PC.<span class="_"> </span>On<span class="_"> </span>the<span class="_"> </span>next<span class="_ _11"> </span>cycle<span class="_ _1"></span>,<span class="_ _11"> </span>the<span class="_ _11"> </span><span class="ffd">popq<span class="_ _10"> </span></span>instruction<span class="_ _11"> </span>is<span class="_ _11"> </span>refetched,<span class="_"> </span>but<span class="_ _11"> </span>the<span class="_ _11"> </span>instruction<span class="_"> </span>code</div><div class="t m5 x1d h26 y4787 ff7 fs19 fc2 sc0 ls0 ws0">is<span class="_ _11"> </span>converted<span class="_ _11"> </span>to<span class="_ _11"> </span>a<span class="_ _11"> </span>special<span class="_ _11"> </span>value<span class="_ _11"> </span><span class="ffd">IPOP2</span>.<span class="_ _11"> </span>This<span class="_"> </span>is<span class="_ _11"> </span>treated<span class="_ _11"> </span>as<span class="_ _11"> </span>a<span class="_ _11"> </span>special<span class="_ _11"> </span>instruction<span class="_ _11"> </span>that</div><div class="t m5 x1d h26 y4788 ff7 fs19 fc2 sc0 ls0 ws0">has<span class="_"> </span>the<span class="_"> </span>same<span class="_"> </span>behavior<span class="_"> </span>as<span class="_"> </span>the<span class="_"> </span><span class="ffd">mrmovq<span class="_ _10"> </span></span>instruction<span class="_"> </span>listed<span class="_"> </span>above<span class="_ _0"></span>.</div><div class="t m5 x29 h26 y4789 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>ﬁle<span class="_ _13"> </span><span class="ffd">pipe-1w.hcl<span class="_ _10"> </span></span>contains<span class="_"> </span>the<span class="_ _13"> </span>modiﬁed<span class="_"> </span>write<span class="_ _13"> </span>port<span class="_"> </span>logic<span class="_ _13"> </span>described<span class="_"> </span>above<span class="_ _1"></span>.</div><div class="t m5 x1d h26 y478a ff7 fs19 fc2 sc0 ls0 ws0">It<span class="_ _14"> </span>contains<span class="_ _15"> </span>a<span class="_ _14"> </span>declaration<span class="_ _15"> </span>of<span class="_ _15"> </span>the<span class="_ _14"> </span>constant<span class="_ _15"> </span><span class="ffd">IPOP2<span class="_ _14"> </span></span>having<span class="_ _15"> </span>hexadecimal<span class="_ _14"> </span>value<span class="_ _15"> </span><span class="ffd">E</span><span class="ls204">.I<span class="_ _9"></span>t</span></div><div class="t m5 x1d h26 y478b ff7 fs19 fc2 sc0 ls0 ws0">also<span class="_ _16"> </span>contains<span class="_ _11"> </span>the<span class="_ _16"> </span>deﬁnition<span class="_ _16"> </span>of<span class="_ _16"> </span>a<span class="_ _16"> </span>signal<span class="_ _11"> </span><span class="ff6">f_icode<span class="_ _16"> </span></span>that<span class="_ _16"> </span>generates<span class="_ _16"> </span>the<span class="_ _11"> </span><span class="ff6">icode<span class="_ _16"> </span></span>ﬁeld<span class="_ _16"> </span>for</div><div class="t m5 x1d h26 y478c ff7 fs19 fc2 sc0 ls0 ws0">pipeline<span class="_"> </span>register<span class="_ _11"> </span>D<span class="_ _3"></span>.<span class="_ _11"> </span>T<span class="_ _1"></span>his<span class="_ _11"> </span>deﬁnition<span class="_"> </span>can<span class="_ _11"> </span>be<span class="_"> </span>modiﬁed<span class="_ _11"> </span>to<span class="_"> </span>insert<span class="_ _11"> </span>the<span class="_"> </span>instruction<span class="_ _11"> </span>code</div><div class="t m5 x1d h26 y478d ffd fs19 fc2 sc0 ls0 ws0">IPOP2<span class="_ _10"> </span><span class="ff7">the<span class="_ _13"> </span>second<span class="_"> </span>time<span class="_ _13"> </span>the<span class="_"> </span></span>popq<span class="_ _10"> </span><span class="ff7">instruction<span class="_ _13"> </span>is<span class="_"> </span>fetched.<span class="_ _13"> </span>The<span class="_ _13"> </span>HCL<span class="_"> </span>ﬁle<span class="_ _13"> </span>also<span class="_"> </span>contains</span></div><div class="t m5 x1d h26 y478e ff7 fs19 fc2 sc0 ls0 ws0">a<span class="_ _13"> </span>declaration<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>signal<span class="_"> </span><span class="ff6">f_pc</span>,<span class="_ _13"> </span>the<span class="_ _13"> </span>value<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>program<span class="_"> </span>counter<span class="_ _13"> </span>generated<span class="_ _13"> </span>in<span class="_ _13"> </span>the</div><div class="t m5 x1d h26 y478f ff7 fs19 fc2 sc0 ls0 ws0">fetch<span class="_"> </span>stage<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span>block<span class="_"> </span>labeled<span class="_"> </span>“Select<span class="_"> </span>PC”<span class="_"> </span>(F<span class="_ _1"></span>igure<span class="_"> </span>4.57).</div><div class="t m5 x29 h26 y4790 ff7 fs19 fc2 sc0 ls0 ws0">Modify<span class="_ _13"> </span>the<span class="_ _13"> </span>control<span class="_"> </span>logic<span class="_ _13"> </span>in<span class="_ _13"> </span>this<span class="_ _13"> </span>ﬁle<span class="_ _13"> </span>to<span class="_"> </span>process<span class="_ _13"> </span><span class="ffd">popq<span class="_ _13"> </span></span>instructions<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_"> </span>manner</div><div class="t m5 x1d h26 y4791 ff7 fs19 fc2 sc0 ls0 ws0">we<span class="_ _f"> </span>have<span class="_ _f"> </span>described.<span class="_ _f"> </span>See<span class="_ _f"> </span>the<span class="_ _f"> </span>lab<span class="_ _f"> </span>material<span class="_ _f"> </span>for<span class="_ _f"> </span>directions<span class="_ _f"> </span>on<span class="_ _f"> </span>how<span class="_ _f"> </span>to<span class="_ _f"> </span>generate<span class="_ _f"> </span>a</div><div class="t m5 x1d h26 y4792 ff7 fs19 fc2 sc0 ls0 ws0">simulator<span class="_"> </span>for<span class="_"> </span>your<span class="_"> </span>solution<span class="_"> </span>and<span class="_"> </span>how<span class="_"> </span>to<span class="_"> </span>test<span class="_"> </span>it.</div><div class="t m5 x1d h73 y4793 ffe fs1e fc6 sc0 ls0 ws0">4.59<span class="_ _23"> </span><span class="ff10 fs19">◆◆</span></div><div class="t m5 x1d h26 y4794 ff7 fs19 fc1 sc0 ls0 ws0">Compare<span class="_ _14"> </span>the<span class="_ _15"> </span>performance<span class="_ _14"> </span>of<span class="_ _15"> </span>the<span class="_ _15"> </span>three<span class="_ _14"> </span>versions<span class="_ _15"> </span>of<span class="_ _15"> </span>bubblesort<span class="_ _14"> </span>(Problems<span class="_ _15"> </span>4.47,</div><div class="t m5 x1d h26 y4795 ff7 fs19 fc1 sc0 ls0 ws0">4.48,<span class="_"> </span>and<span class="_"> </span>4.49).<span class="_"> </span>Explain<span class="_"> </span>why<span class="_"> </span>one<span class="_"> </span>version<span class="_"> </span>performs<span class="_"> </span>better<span class="_"> </span>than<span class="_"> </span>the<span class="_"> </span>other.</div><div class="t m5 x1d h29 y4796 ffe fs14 fc1 sc0 ls0 ws0">Solutions<span class="_"> </span>to<span class="_"> </span>Practice<span class="_"> </span>Problems</div><div class="t m5 x1d h28 y4797 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>4.1<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>396)</span></div><div class="t m5 x1d h26 y4798 ff7 fs19 fc1 sc0 ls0 ws0">Encoding<span class="_ _16"> </span>instructions<span class="_ _14"> </span>by<span class="_ _14"> </span>hand<span class="_ _16"> </span>is<span class="_ _14"> </span>rather<span class="_ _14"> </span>tedious<span class="_ _1"></span>,<span class="_ _14"> </span>but<span class="_ _14"> </span>it<span class="_ _16"> </span>will<span class="_ _14"> </span>solidify<span class="_ _14"> </span>your<span class="_ _16"> </span>under<span class="_ _0"></span>-</div><div class="t m5 x1d h26 y4799 ff7 fs19 fc1 sc0 ls0 ws0">standing<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _14"> </span>idea<span class="_ _16"> </span>that<span class="_ _16"> </span>assembly<span class="_ _14"> </span>code<span class="_ _16"> </span>gets<span class="_ _14"> </span>turned<span class="_ _16"> </span>into<span class="_ _16"> </span>byte<span class="_ _14"> </span>sequences<span class="_ _16"> </span>by<span class="_ _16"> </span>the</div><div class="t m5 x1d h26 y479a ff7 fs19 fc1 sc0 ls0 ws0">assembler.<span class="_ _11"> </span>In<span class="_ _16"> </span>the<span class="_ _16"> </span>following<span class="_ _16"> </span>output<span class="_ _16"> </span>from<span class="_ _16"> </span>our<span class="_ _16"> </span>Y86-64<span class="_ _16"> </span>assembler<span class="_ _0"></span>,<span class="_ _16"> </span>each<span class="_ _16"> </span>line<span class="_ _16"> </span>shows</div><div class="t m5 x1d h26 y479b ff7 fs19 fc1 sc0 ls0 ws0">an<span class="_"> </span>address<span class="_"> </span>and<span class="_"> </span>a<span class="_"> </span>byte<span class="_"> </span>sequence<span class="_"> </span>that<span class="_"> </span>starts<span class="_"> </span>at<span class="_"> </span>that<span class="_"> </span>address:</div><div class="t m5 x1f h2e y479c ff6 fs20 fc6 sc0 ls0 ws0">1</div><div class="t m5 x4f h2d y479d ffd fs1e fc2 sc0 ls0 ws0">0x100:<span class="_ _129"> </span>|<span class="_ _e"> </span>.pos<span class="_ _1f"> </span>0x100<span class="_ _1a"> </span>#<span class="_ _e"> </span>Start<span class="_ _1f"> </span>code<span class="_ _1f"> </span>at<span class="_ _e"> </span>address</div><div class="t m5 x1d h2d y479e ffd fs1e fc2 sc0 ls0 ws0">0x100</div><div class="t m5 x1f h2d y479f ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">0x100:<span class="_ _1f"> </span>30f30f00000000000000<span class="_ _e"> </span>|<span class="_ _8c"> </span>irmovq<span class="_ _1f"> </span>$15,%rbx</span></div><div class="t m5 x1f h2d y47a0 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _1c"> </span><span class="ffd fs1e fc2">0x10a:<span class="_ _1f"> </span>2031<span class="_ _15a"> </span>|<span class="_ _58"> </span>rrmovq<span class="_ _1f"> </span>%rbx,%rcx</span></div><div class="t m5 x1f h2d y47a1 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _1c"> </span><span class="ffd fs1e fc2">0x10c:<span class="_ _129"> </span>|<span class="_ _1f"> </span>loop:</span></div><div class="t m5 x1f h2d y47a2 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _1c"> </span><span class="ffd fs1e fc2">0x10c:<span class="_ _1f"> </span>4013fdffffffffffffff<span class="_ _e"> </span>|<span class="_ _8c"> </span>rmmovq<span class="_ _1f"> </span>%rcx,-3(%rbx)</span></div><div class="t m5 x1f h2d y47a3 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _1c"> </span><span class="ffd fs1e fc2">0x116:<span class="_ _1f"> </span>6031<span class="_ _15a"> </span>|<span class="_ _58"> </span>addq<span class="_ _3f"> </span>%rbx,%rcx</span></div><div class="t m5 x1f h2d y47a4 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _1c"> </span><span class="ffd fs1e fc2">0x118:<span class="_ _1f"> </span>700c01000000000000<span class="_ _3f"> </span>|<span class="_ _8c"> </span>jmp<span class="_ _e"> </span>loop</span></div><div class="t m5 x29 h26 y47a5 ff7 fs19 fc2 sc0 ls0 ws0">Several<span class="_"> </span>features<span class="_"> </span>of<span class="_"> </span>this<span class="_"> </span>encoding<span class="_"> </span>are<span class="_"> </span>worth<span class="_"> </span>noting:</div><div class="t m5 x75 h3d y3660 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y15bf ff7 fs19 fc1 sc0 ls0 ws0">Decimal<span class="_ _13"> </span>15<span class="_ _6"> </span>(line<span class="_ _13"> </span>2)<span class="_ _13"> </span>has<span class="_ _13"> </span>hex<span class="_ _6"> </span>representation<span class="_ _13"> </span><span class="ffd">0x000000000000000f</span>.<span class="_ _13"> </span>Writing<span class="_ _13"> </span>the</div><div class="t m5 x29 h26 y15c0 ff7 fs19 fc1 sc0 ls0 ws0">bytes<span class="_"> </span>in<span class="_"> </span>reverse<span class="_"> </span>order<span class="_"> </span>gives<span class="_"> </span><span class="ffd">0f<span class="_ _11"> </span>00<span class="_ _16"> </span>00<span class="_ _16"> </span>00<span class="_ _11"> </span>00<span class="_ _16"> </span>00<span class="_ _16"> </span>00<span class="_ _11"> </span>00</span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
