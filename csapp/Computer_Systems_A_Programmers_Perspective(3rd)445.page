<div id="pf1bd" class="pf w2 h11" data-page-no="1bd"><div class="pc pc1bd w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1bd.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">444<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>4<span class="_ _3d"> </span>Processor<span class="_ _10"> </span>Architecture</span></div><div class="t m5 x1d h47 yb1f ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>4.21<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>524)</span></div><div class="t m5 x1d h26 yb20 ff7 fs19 fc1 sc0 ls0 ws0">Register<span class="_"> </span>ID<span class="_ _13"> </span><span class="ff6">dstM<span class="_ _10"> </span></span>indicates<span class="_ _13"> </span>the<span class="_"> </span>destination<span class="_ _13"> </span>register<span class="_"> </span>for<span class="_ _13"> </span>write<span class="_"> </span>port<span class="_ _13"> </span>M,<span class="_"> </span>where<span class="_ _13"> </span><span class="ff6">valM</span>,</div><div class="t m5 x1d h26 yb21 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>value<span class="_ _13"> </span>read<span class="_"> </span>from<span class="_ _13"> </span>memory<span class="_ _3"></span>,<span class="_"> </span>is<span class="_ _13"> </span>stored.<span class="_"> </span>T<span class="_ _1"></span>his<span class="_"> </span>is<span class="_ _13"> </span>shown<span class="_"> </span>in<span class="_ _13"> </span>F<span class="_ _1"></span>igures<span class="_"> </span>4.18<span class="_"> </span>to<span class="_ _13"> </span>4.21<span class="_"> </span>as<span class="_ _13"> </span>the</div><div class="t m5 x1d h26 yb22 ff7 fs19 fc1 sc0 ls0 ws0">second<span class="_"> </span>step<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>write-back<span class="_"> </span>stage<span class="_ _1"></span>.<span class="_"> </span>Write<span class="_"> </span>HCL<span class="_"> </span>code<span class="_"> </span>for<span class="_"> </span><span class="ff6">dstM</span>.</div><div class="t m5 x1d h47 y3d56 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>4.22<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>524)</span></div><div class="t m5 x1d h26 y3d57 ff7 fs19 fc1 sc0 ls0 ws0">Only<span class="_ _16"> </span>the<span class="_ _16"> </span><span class="ffd">popq<span class="_ _16"> </span></span>instruction<span class="_ _11"> </span>uses<span class="_ _16"> </span>both<span class="_ _16"> </span>register<span class="_ _16"> </span>ﬁle<span class="_ _16"> </span>write<span class="_ _16"> </span>ports<span class="_ _16"> </span>simultaneously<span class="_ _3"></span>.<span class="_ _16"> </span>F<span class="_ _3"></span>or</div><div class="t m5 x1d h26 y3d58 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _16"> </span>instruction<span class="_ _16"> </span><span class="ffd">popq<span class="_ _16"> </span>%rsp</span>,<span class="_ _14"> </span>the<span class="_ _16"> </span>same<span class="_ _14"> </span>address<span class="_ _16"> </span>will<span class="_ _16"> </span>be<span class="_ _16"> </span>used<span class="_ _14"> </span>for<span class="_ _16"> </span>both<span class="_ _16"> </span>the<span class="_ _16"> </span>E<span class="_ _14"> </span>and<span class="_ _16"> </span>M</div><div class="t m5 x1d h26 y3d59 ff7 fs19 fc1 sc0 ls0 ws0">write<span class="_ _16"> </span>ports<span class="_ _1"></span>,<span class="_ _14"> </span>but<span class="_ _16"> </span>with<span class="_ _14"> </span>different<span class="_ _16"> </span>data.<span class="_ _16"> </span>T<span class="_ _3"></span>o<span class="_ _16"> </span>handle<span class="_ _16"> </span>this<span class="_ _14"> </span>conﬂict,<span class="_ _14"> </span>we<span class="_ _16"> </span>must<span class="_ _16"> </span>establish<span class="_ _16"> </span>a</div><div class="t m5 x1d h26 y3d5a ffa fs19 fc1 sc0 ls0 ws0">priority<span class="_ _11"> </span><span class="ff7">among<span class="_ _11"> </span>the<span class="_ _16"> </span>two<span class="_ _11"> </span>write<span class="_ _16"> </span>ports<span class="_ _11"> </span>so<span class="_ _11"> </span>that<span class="_ _16"> </span>when<span class="_ _11"> </span>both<span class="_ _16"> </span>attempt<span class="_ _11"> </span>to<span class="_ _11"> </span>write<span class="_ _16"> </span>the<span class="_ _11"> </span>same</span></div><div class="t m5 x1d h26 y3d5b ff7 fs19 fc1 sc0 ls0 ws0">register<span class="_ _13"> </span>on<span class="_ _13"> </span>the<span class="_ _6"> </span>same<span class="_ _13"> </span>cycle<span class="_ _1"></span>,<span class="_ _13"> </span>only<span class="_ _13"> </span>the<span class="_ _13"> </span>write<span class="_ _13"> </span>from<span class="_ _13"> </span>the<span class="_ _6"> </span>higher<span class="_ _0"></span>-priority<span class="_ _13"> </span>port<span class="_ _13"> </span>takes<span class="_ _6"> </span>place.</div><div class="t m5 x1d h26 y3d5c ff7 fs19 fc1 sc0 ls0 ws0">Which<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>two<span class="_"> </span>ports<span class="_ _13"> </span>should<span class="_ _13"> </span>be<span class="_ _13"> </span>given<span class="_"> </span>priority<span class="_ _13"> </span>in<span class="_ _13"> </span>order<span class="_ _13"> </span>to<span class="_"> </span>implement<span class="_ _13"> </span>the<span class="_ _13"> </span>desired</div><div class="t m5 x1d h26 y3d5d ff7 fs19 fc1 sc0 ls0 ws0">behavior,<span class="_"> </span>as<span class="_"> </span>determined<span class="_"> </span>in<span class="_"> </span>Practice<span class="_"> </span>Problem<span class="_"> </span>4.8?</div><div class="t m5 x1d h42 y3d5e ff6 fs29 fc6 sc0 ls0 ws0">Execute<span class="_ _11"> </span>Stage</div><div class="t m5 x1d h26 y3d5f ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _14"> </span>execute<span class="_ _16"> </span>stage<span class="_ _16"> </span>includes<span class="_ _16"> </span>the<span class="_ _14"> </span>arithmetic/logic<span class="_ _16"> </span>unit<span class="_ _16"> </span>(ALU).<span class="_ _16"> </span>This<span class="_ _16"> </span>unit<span class="_ _16"> </span>performs</div><div class="t m5 x1d h26 y3d60 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _13"> </span>operation<span class="_ _13"> </span><span class="ff9">add</span>,<span class="_"> </span><span class="ff9">subtra<span class="_ _1"></span>ct<span class="ff7">,<span class="_"> </span></span>and<span class="ff7 ls1be">,o<span class="_ _4a"></span>r<span class="ff9 ls0">exclusive-or<span class="_ _13"> </span><span class="ff7">on<span class="_ _13"> </span>inputs<span class="_ _13"> </span><span class="ff6">aluA<span class="_ _13"> </span></span>and<span class="_ _13"> </span><span class="ff6">aluB<span class="_ _13"> </span></span>based</span></span></span></span></div><div class="t m5 x1d h26 y3d61 ff7 fs19 fc1 sc0 ls0 ws0">on<span class="_ _11"> </span>the<span class="_ _16"> </span>setting<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span><span class="ff6">alufun<span class="_ _16"> </span></span>signal.<span class="_ _11"> </span>T<span class="_ _0"></span>hese<span class="_ _11"> </span>data<span class="_ _16"> </span>and<span class="_ _11"> </span>control<span class="_ _16"> </span>signals<span class="_ _11"> </span>are<span class="_ _11"> </span>generated</div><div class="t m5 x1d h26 y3d62 ff7 fs19 fc1 sc0 ls0 ws0">by<span class="_"> </span>three<span class="_ _13"> </span>control<span class="_"> </span>blocks<span class="_ _3"></span>,<span class="_"> </span>as<span class="_ _13"> </span>diagrammed<span class="_"> </span>in<span class="_"> </span>F<span class="_ _3"></span>igure<span class="_"> </span>4.29.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span>ALU<span class="_"> </span>output<span class="_"> </span>becomes</div><div class="t m5 x1d h26 y3d63 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>signal<span class="_"> </span><span class="ff6">valE</span>.</div><div class="t m5 x29 h26 y3d64 ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _13"> </span>F<span class="_ _0"></span>igures<span class="_ _13"> </span>4.18<span class="_ _13"> </span>to<span class="_"> </span>4.21,<span class="_ _13"> </span>the<span class="_ _13"> </span>ALU<span class="_ _13"> </span>computation<span class="_ _13"> </span>for<span class="_"> </span>each<span class="_ _13"> </span>instruction<span class="_ _13"> </span>is<span class="_ _13"> </span>shown<span class="_ _13"> </span>as</div><div class="t m5 x1d h26 y3d65 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _13"> </span>ﬁrst<span class="_"> </span>step<span class="_ _13"> </span>in<span class="_"> </span>the<span class="_ _13"> </span>execute<span class="_"> </span>stage<span class="_ _1"></span>.<span class="_ _13"> </span>The<span class="_ _13"> </span>operands<span class="_ _13"> </span>are<span class="_"> </span>listed<span class="_ _13"> </span>with<span class="_"> </span><span class="ff6">aluB<span class="_ _13"> </span></span>ﬁrst,<span class="_"> </span>followed</div><div class="t m5 x1d h26 y3d66 ff7 fs19 fc1 sc0 ls0 ws0">by<span class="_ _16"> </span><span class="ff6">aluA<span class="_ _16"> </span></span>to<span class="_ _11"> </span>make<span class="_ _16"> </span>sure<span class="_ _16"> </span>the<span class="_ _16"> </span><span class="ffd">subq<span class="_ _16"> </span></span>instruction<span class="_ _16"> </span>subtracts<span class="_ _16"> </span><span class="ff6">valA<span class="_ _16"> </span></span>from<span class="_ _16"> </span><span class="ff6">valB</span>.<span class="_ _11"> </span>W<span class="_ _1"></span>e<span class="_ _16"> </span>can<span class="_ _16"> </span>see</div><div class="t m5 x1d h46 y3d67 ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_ _16"> </span>the<span class="_ _14"> </span>value<span class="_ _14"> </span>of<span class="_ _16"> </span><span class="ff6">aluA<span class="_ _14"> </span></span>can<span class="_ _14"> </span>be<span class="_ _16"> </span><span class="ff6">valA</span>,<span class="_ _15"> </span><span class="ff6">valC</span>,<span class="_ _14"> </span>or<span class="_ _14"> </span>either<span class="_ _14"> </span><span class="ff12">−</span><span class="ls1bf">8o<span class="_ _42"></span>r<span class="ff12 ls0">+</span><span class="ls132">8,<span class="_ _14"> </span>depending<span class="_ _14"> </span>on<span class="_ _14"> </span>the</span></span></div><div class="t m5 x1d h26 y3d68 ff7 fs19 fc1 sc0 ls0 ws0">instruction<span class="_"> </span>type<span class="_ _0"></span>.<span class="_"> </span>W<span class="_ _3"></span>e<span class="_ _11"> </span>can<span class="_"> </span>therefore<span class="_"> </span>express<span class="_ _11"> </span>the<span class="_"> </span>behavior<span class="_"> </span>of<span class="_"> </span>the<span class="_ _11"> </span>control<span class="_"> </span>block<span class="_"> </span>that</div><div class="t m5 x1d h26 y3d69 ff7 fs19 fc1 sc0 ls0 ws0">generates<span class="_"> </span><span class="ff6">aluA<span class="_ _10"> </span></span>as<span class="_"> </span>follows:</div><div class="t m5 x1d h2d y3d6a ffd fs1e fc2 sc0 ls0 ws0">word<span class="_ _e"> </span>aluA<span class="_ _1f"> </span>=<span class="_ _1f"> </span>[</div><div class="t m5 x22b h2d y3d6b ffd fs1e fc2 sc0 ls0 ws0">icode<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _1f"> </span>IRRMOVQ,<span class="_ _e"> </span>IOPQ<span class="_ _1f"> </span>}<span class="_ _e"> </span>:<span class="_ _1f"> </span>valA;</div><div class="t m5 x22b h2d y3d6c ffd fs1e fc2 sc0 ls0 ws0">icode<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _1f"> </span>IIRMOVQ,<span class="_ _e"> </span>IRMMOVQ,<span class="_ _1f"> </span>IMRMOVQ<span class="_ _e"> </span>}<span class="_ _1f"> </span>:<span class="_ _1f"> </span>valC;</div><div class="t m5 x14 h2f y3d6d ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>4.29</div><div class="t m5 x14 h34 y3d6e ffe fs16 fc2 sc0 ls0 ws0">SEQ<span class="_ _11"> </span>execute<span class="_ _16"> </span>stage.<span class="_ _16"> </span><span class="ff6">The</span></div><div class="t m5 x14 h34 y3d6f ff6 fs16 fc2 sc0 ls0 ws0">ALU<span class="_ _16"> </span>either<span class="_ _16"> </span>performs<span class="_ _16"> </span>the</div><div class="t m5 x14 h34 y3d70 ff6 fs16 fc2 sc0 ls0 ws0">operation<span class="_ _16"> </span>for<span class="_ _16"> </span>an<span class="_ _16"> </span>integer</div><div class="t m5 x14 h34 y3d71 ff6 fs16 fc2 sc0 ls0 ws0">operation<span class="_ _16"> </span>instruction<span class="_ _16"> </span>or</div><div class="t m5 x14 h34 y3d72 ff6 fs16 fc2 sc0 ls0 ws0">acts<span class="_ _14"> </span>as<span class="_ _14"> </span>an<span class="_ _15"> </span>adder<span class="_ _3"></span>.<span class="_ _15"> </span>The</div><div class="t m5 x14 h34 y3d73 ff6 fs16 fc2 sc0 ls0 ws0">condition<span class="_ _16"> </span>code<span class="_ _16"> </span>registers</div><div class="t m5 x14 h34 y3d74 ff6 fs16 fc2 sc0 ls0 ws0">are<span class="_ _16"> </span>set<span class="_ _16"> </span>according<span class="_ _16"> </span>to<span class="_ _11"> </span>the</div><div class="t m5 x14 h34 y3d75 ff6 fs16 fc2 sc0 ls0 ws0">ALU<span class="_ _11"> </span>value.<span class="_ _16"> </span>The<span class="_ _11"> </span>condition</div><div class="t m5 x14 h34 y3d76 ff6 fs16 fc2 sc0 ls0 ws0">code<span class="_ _14"> </span>values<span class="_ _16"> </span>are<span class="_ _14"> </span>tested</div><div class="t m5 x14 h34 y3d77 ff6 fs16 fc2 sc0 ls0 ws0">to<span class="_ _16"> </span>determine<span class="_ _16"> </span>whether<span class="_ _16"> </span>a</div><div class="t m5 x14 h34 y3d78 ff6 fs16 fc2 sc0 ls0 ws0">branch<span class="_ _10"> </span>should<span class="_ _11"> </span>be<span class="_ _10"> </span>taken.</div><div class="t m5 x1a6 h3f y3d79 ff41 fs27 fc1 sc0 ls0 ws0">Cnd</div><div class="t m5 x17c h3f y3d7a ff41 fs27 fc1 sc0 ls0 ws0">valE</div><div class="t m5 x50 h3f y3d7b ff41 fs27 fc1 sc0 ls0 ws0">cond</div><div class="t m5 xed h3f y3d7c ff41 fs27 fc1 sc0 ls0 ws0">CC</div><div class="t m5 x167 h3f y3d7d ff41 fs27 fc1 sc0 ls0 ws0">Set</div><div class="t m5 x167 h3f y3d7e ff41 fs27 fc1 sc0 ls0 ws0">CC</div><div class="t m5 x119 h3f y3d7f ff41 fs27 fc1 sc0 ls0 ws0">ALU</div><div class="t m5 x41 h3f y3d80 ff41 fs27 fc1 sc0 ls0 ws0">ALU</div><div class="t m5 x1fb h3f y3d81 ff41 fs27 fc1 sc0 ls0 ws0">fun.</div><div class="t m5 x13d h3f y3d82 ff41 fs27 fc1 sc0 ls0 ws0">ALU</div><div class="t m5 x17a h3f y3d83 ff41 fs27 fc1 sc0 ls0 ws0">B</div><div class="t m5 xe4 h3f y3d82 ff41 fs27 fc1 sc0 ls0 ws0">ALU</div><div class="t m5 x1c8 h3f y3d83 ff41 fs27 fc1 sc0 ls0 ws0">A</div><div class="t m5 x1d1 h3f y3d84 ff41 fs27 fc1 sc0 ls0 ws0">valC<span class="_ _15"> </span>valA</div><div class="t m5 x23b h3f y3d85 ff41 fs27 fc1 sc0 ls0 ws0">valB</div><div class="t m5 xe0 h3f y3d86 ff41 fs27 fc1 sc0 ls0 ws0">icode<span class="_ _e"> </span>ifun</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
