<div id="pf3ad" class="pf w2 h11" data-page-no="3ad"><div class="pc pc3ad w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg3ad.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">940<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>10<span class="_ _3d"> </span>System-Level<span class="_ _10"> </span>I/O</span></div><div class="t m5 xa9 h2c y27f ffa fs16 fc2 sc0 ls0 ws0">statbuf<span class="_ _1"></span>.h<span class="_"> </span>(included<span class="_"> </span>by<span class="_"> </span>sys/stat.h)</div><div class="t m5 x1d h88 y280 ffd fs4e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Metadata<span class="_ _f"> </span>returned<span class="_ _e"> </span>by<span class="_ _e"> </span>the<span class="_ _f"> </span>stat<span class="_ _e"> </span>and<span class="_ _e"> </span>fstat<span class="_ _f"> </span>functions<span class="_ _e"> </span>*/</div><div class="t m5 x1d h88 y7819 ffd fs4e fc2 sc0 ls0 ws0">struct<span class="_ _e"> </span>stat<span class="_ _f"> </span>{</div><div class="t m5 x29 h88 y781a ffd fs4e fc2 sc0 ls0 ws0">dev_t<span class="_ _6d"> </span>st_dev;<span class="_ _5c"> </span>/*<span class="_ _e"> </span>Device<span class="_ _e"> </span>*/</div><div class="t m5 x29 h88 y781b ffd fs4e fc2 sc0 ls0 ws0">ino_t<span class="_ _6d"> </span>st_ino;<span class="_ _5c"> </span>/*<span class="_ _e"> </span>inode<span class="_ _e"> </span>*/</div><div class="t m5 x29 h88 y781c ffd fs4e fc2 sc0 ls0 ws0">mode_t<span class="_ _7f"> </span>st_mode;<span class="_ _75"> </span>/*<span class="_ _e"> </span>Protection<span class="_ _f"> </span>and<span class="_ _e"> </span>file<span class="_ _e"> </span>type<span class="_ _f"> </span>*/</div><div class="t m5 x29 h88 y781d ffd fs4e fc2 sc0 ls0 ws0">nlink_t<span class="_ _68"> </span>st_nlink;<span class="_ _5e"> </span>/*<span class="_ _e"> </span>Number<span class="_ _f"> </span>of<span class="_ _e"> </span>hard<span class="_ _e"> </span>links<span class="_ _f"> </span>*/</div><div class="t m5 x29 h88 y781e ffd fs4e fc2 sc0 ls0 ws0">uid_t<span class="_ _6d"> </span>st_uid;<span class="_ _5c"> </span>/*<span class="_ _e"> </span>User<span class="_ _e"> </span>ID<span class="_ _e"> </span>of<span class="_ _f"> </span>owner<span class="_ _e"> </span>*/</div><div class="t m5 x29 h88 y781f ffd fs4e fc2 sc0 ls0 ws0">gid_t<span class="_ _6d"> </span>st_gid;<span class="_ _5c"> </span>/*<span class="_ _e"> </span>Group<span class="_ _e"> </span>ID<span class="_ _e"> </span>of<span class="_ _f"> </span>owner<span class="_ _e"> </span>*/</div><div class="t m5 x29 h88 y7820 ffd fs4e fc2 sc0 ls0 ws0">dev_t<span class="_ _6d"> </span>st_rdev;<span class="_ _ab"> </span>/*<span class="_ _e"> </span>Device<span class="_ _e"> </span>type<span class="_ _e"> </span>(if<span class="_ _f"> </span>inode<span class="_ _e"> </span>device)<span class="_ _e"> </span>*/</div><div class="t m5 x29 h88 y7821 ffd fs4e fc2 sc0 ls0 ws0">off_t<span class="_ _6d"> </span>st_size;<span class="_ _ab"> </span>/*<span class="_ _e"> </span>Total<span class="_ _e"> </span>size,<span class="_ _e"> </span>in<span class="_ _f"> </span>bytes<span class="_ _e"> </span>*/</div><div class="t m5 x29 h88 y7822 ffd fs4e fc2 sc0 ls0 ws0">unsigned<span class="_ _e"> </span>long<span class="_ _f"> </span>st_blksize;<span class="_ _13d"> </span>/*<span class="_ _e"> </span>Block<span class="_ _e"> </span>size<span class="_ _f"> </span>for<span class="_ _e"> </span>filesystem<span class="_ _e"> </span>I/O<span class="_ _f"> </span>*/</div><div class="t m5 x29 h88 y7823 ffd fs4e fc2 sc0 ls0 ws0">unsigned<span class="_ _e"> </span>long<span class="_ _f"> </span>st_blocks;<span class="_ _b2"> </span>/*<span class="_ _e"> </span>Number<span class="_ _e"> </span>of<span class="_ _f"> </span>blocks<span class="_ _e"> </span>allocated<span class="_ _e"> </span>*/</div><div class="t m5 x29 h88 y7824 ffd fs4e fc2 sc0 ls0 ws0">time_t<span class="_ _7f"> </span>st_atime;<span class="_ _5e"> </span>/*<span class="_ _e"> </span>Time<span class="_ _e"> </span>of<span class="_ _f"> </span>last<span class="_ _e"> </span>access<span class="_ _e"> </span>*/</div><div class="t m5 x29 h88 y7825 ffd fs4e fc2 sc0 ls0 ws0">time_t<span class="_ _7f"> </span>st_mtime;<span class="_ _5e"> </span>/*<span class="_ _e"> </span>Time<span class="_ _e"> </span>of<span class="_ _f"> </span>last<span class="_ _e"> </span>modification<span class="_ _e"> </span>*/</div><div class="t m5 x29 h88 y7826 ffd fs4e fc2 sc0 ls0 ws0">time_t<span class="_ _7f"> </span>st_ctime;<span class="_ _5e"> </span>/*<span class="_ _e"> </span>Time<span class="_ _e"> </span>of<span class="_ _f"> </span>last<span class="_ _e"> </span>change<span class="_ _e"> </span>*/</div><div class="t m5 x1d h88 y7827 ffd fs4e fc2 sc0 ls0 ws0">};</div><div class="t m5 xa9 h2c y7828 ffa fs16 fc2 sc0 ls0 ws0">statbuf<span class="_ _1"></span>.h<span class="_"> </span>(included<span class="_"> </span>by<span class="_"> </span>sys/stat.h)</div><div class="t m5 x1d h2f y7829 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>10.9<span class="_ _66"> </span><span class="fc1">The</span></div><div class="t m5 xb3 h3a y782a ffd fs19 fc1 sc0 ls0 ws0">stat<span class="_ _10"> </span><span class="ffe fs16">structure.</span></div><div class="t m5 x164 h2c y782b ffa fs16 fc1 sc0 ls0 ws0">code/io/statcheck.c</div><div class="t m5 x1f h88 y782c ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs4e fc2">#include<span class="_ _e"> </span>&quot;csapp.h&quot;</span></div><div class="t m5 x1f h2e y782d ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x1f h2e y782e ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x4f h88 y782f ffd fs4e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>main<span class="_ _f"> </span>(int<span class="_ _e"> </span>argc,<span class="_ _e"> </span>char<span class="_ _f"> </span>**argv)</div><div class="t m5 x1f h88 y7830 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _1c"> </span><span class="ffd fs4e fc2">{</span></div><div class="t m5 x1f h88 y7831 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _e2"> </span><span class="ffd fs4e fc2">struct<span class="_ _e"> </span>stat<span class="_ _e"> </span>stat;</span></div><div class="t m5 x1f h2e y7832 ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 x1b7 h88 y7833 ffd fs4e fc2 sc0 ls0 ws0">char<span class="_ _e"> </span>*type,<span class="_ _f"> </span>*readok;</div><div class="t m5 x1f h2e y7834 ff6 fs20 fc6 sc0 ls0 ws0">7</div><div class="t m5 x1f h2e y7835 ff6 fs20 fc6 sc0 ls0 ws0">8</div><div class="t m5 x1b7 h88 y7836 ffd fs4e fc2 sc0 ls0 ws0">Stat(argv[1],<span class="_ _e"> </span>&amp;stat);</div><div class="t m5 x1f h88 y7837 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _e2"> </span><span class="ffd fs4e fc2">if<span class="_ _e"> </span>(S_ISREG(stat.st_mode))<span class="_ _75"> </span>/*<span class="_ _e"> </span>Determine<span class="_ _f"> </span>file<span class="_ _e"> </span>type<span class="_ _e"> </span>*/</span></div><div class="t m5 x1b0 h88 y7838 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _18b"> </span><span class="ffd fs4e fc2">type<span class="_ _e"> </span>=<span class="_ _f"> </span>&quot;regular&quot;;</span></div><div class="t m5 x1b0 h88 y7839 ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _e2"> </span><span class="ffd fs4e fc2">else<span class="_ _e"> </span>if<span class="_ _e"> </span>(S_ISDIR(stat.st_mode))</span></div><div class="t m5 x1b0 h88 y783a ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _18b"> </span><span class="ffd fs4e fc2">type<span class="_ _e"> </span>=<span class="_ _f"> </span>&quot;directory&quot;;</span></div><div class="t m5 x1b0 h88 y783b ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _e2"> </span><span class="ffd fs4e fc2">else</span></div><div class="t m5 x1b0 h88 y783c ff6 fs20 fc6 sc0 ls0 ws0">14<span class="_ _18b"> </span><span class="ffd fs4e fc2">type<span class="_ _e"> </span>=<span class="_ _f"> </span>&quot;other&quot;;</span></div><div class="t m5 x1b0 h2e y783d ff6 fs20 fc6 sc0 ls0 ws0">15</div><div class="t m5 x1b7 h88 y783e ffd fs4e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>((stat.st_mode<span class="_ _f"> </span>&amp;<span class="_ _e"> </span>S_IRUSR))<span class="_ _e"> </span>/*<span class="_ _f"> </span>Check<span class="_ _e"> </span>read<span class="_ _e"> </span>access<span class="_ _f"> </span>*/</div><div class="t m5 x1b0 h88 y783f ff6 fs20 fc6 sc0 ls0 ws0">16<span class="_ _18b"> </span><span class="ffd fs4e fc2">readok<span class="_ _e"> </span>=<span class="_ _f"> </span>&quot;yes&quot;;</span></div><div class="t m5 x1b0 h88 y7840 ff6 fs20 fc6 sc0 ls0 ws0">17<span class="_ _e2"> </span><span class="ffd fs4e fc2">else</span></div><div class="t m5 x1b0 h88 y7841 ff6 fs20 fc6 sc0 ls0 ws0">18<span class="_ _18b"> </span><span class="ffd fs4e fc2">readok<span class="_ _e"> </span>=<span class="_ _f"> </span>&quot;no&quot;;</span></div><div class="t m5 x1b0 h2e y7842 ff6 fs20 fc6 sc0 ls0 ws0">19</div><div class="t m5 x1b0 h2e y7843 ff6 fs20 fc6 sc0 ls0 ws0">20</div><div class="t m5 x1b7 h88 y7844 ffd fs4e fc2 sc0 ls0 ws0">printf(&quot;type:<span class="_ _e"> </span>%s,<span class="_ _f"> </span>read:<span class="_ _e"> </span>%s\n&quot;,<span class="_ _e"> </span>type,<span class="_ _f"> </span>readok);</div><div class="t m5 x1b0 h88 y7845 ff6 fs20 fc6 sc0 ls0 ws0">21<span class="_ _e2"> </span><span class="ffd fs4e fc2">exit(0);</span></div><div class="t m5 x1b0 h88 y7846 ff6 fs20 fc6 sc0 ls0 ws0">22<span class="_ _1c"> </span><span class="ffd fs4e fc2">}</span></div><div class="t m5 x164 h2c y7847 ffa fs16 fc2 sc0 ls0 ws0">code/io/statcheck.c</div><div class="t m5 x1d h2f y7848 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>10.10<span class="_ _66"> </span><span class="fc1">Quer<span class="_ _2"></span>ying<span class="_"> </span>and<span class="_"> </span>manipulating<span class="_"> </span>a<span class="_"> </span>ﬁle’<span class="_ _1"></span>s</span></div><div class="t m5 x1df h3a y7849 ffd fs19 fc1 sc0 ls0 ws0">st_mode<span class="_ _10"> </span><span class="ffe fs16">bits.</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
