<div id="pf1c1" class="pf w2 h11" data-page-no="1c1"><div class="pc pc1c1 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1c1.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">448<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>4<span class="_ _3d"> </span>Processor<span class="_ _10"> </span>Architecture</span></div><div class="t m5 x29 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _11"> </span>only<span class="_ _16"> </span>problem<span class="_"> </span>with<span class="_ _16"> </span>SEQ<span class="_"> </span>is<span class="_ _16"> </span>that<span class="_"> </span>it<span class="_ _16"> </span>is<span class="_"> </span>too<span class="_ _16"> </span>slow<span class="_ _3"></span>.<span class="_ _11"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span>clock<span class="_"> </span>must<span class="_ _16"> </span>run<span class="_"> </span>slowly</div><div class="t m5 x1d h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">enough<span class="_ _15"> </span>so<span class="_ _15"> </span>that<span class="_ _21"> </span>signals<span class="_ _15"> </span>can<span class="_ _21"> </span>propagate<span class="_ _15"> </span>through<span class="_ _21"> </span>all<span class="_ _15"> </span>of<span class="_ _21"> </span>the<span class="_ _15"> </span>stages<span class="_ _21"> </span>within<span class="_ _15"> </span>a<span class="_ _15"> </span>single</div><div class="t m5 x1d h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">cycle<span class="_ _1"></span>.<span class="_ _11"> </span>As<span class="_ _11"> </span>an<span class="_ _16"> </span>example<span class="_ _1"></span>,<span class="_ _16"> </span>consider<span class="_ _11"> </span>the<span class="_ _11"> </span>processing<span class="_ _11"> </span>of<span class="_ _16"> </span>a<span class="_ _11"> </span><span class="ffd">ret<span class="_ _11"> </span></span>instruction.<span class="_ _16"> </span>Starting<span class="_"> </span>with</div><div class="t m5 x1d h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">an<span class="_ _16"> </span>updated<span class="_ _11"> </span>program<span class="_ _16"> </span>counter<span class="_ _16"> </span>at<span class="_ _11"> </span>the<span class="_ _16"> </span>beginning<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>clock<span class="_ _16"> </span>cycle<span class="_ _1"></span>,<span class="_ _16"> </span>the<span class="_ _16"> </span>instruction</div><div class="t m5 x1d h26 y2f8 ff7 fs19 fc2 sc0 ls0 ws0">must<span class="_ _11"> </span>be<span class="_ _11"> </span>read<span class="_ _16"> </span>from<span class="_ _11"> </span>the<span class="_ _11"> </span>instruction<span class="_ _16"> </span>memory<span class="_ _7"></span>,<span class="_ _16"> </span>the<span class="_ _11"> </span>stack<span class="_ _16"> </span>pointer<span class="_ _11"> </span>must<span class="_ _11"> </span>be<span class="_ _11"> </span>read<span class="_ _16"> </span>from</div><div class="t m5 x1d h26 y2f9 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _11"> </span>register<span class="_ _11"> </span>ﬁle,<span class="_ _11"> </span>the<span class="_ _11"> </span>ALU<span class="_ _16"> </span>must<span class="_ _11"> </span>increment<span class="_ _11"> </span>the<span class="_ _16"> </span>stack<span class="_ _11"> </span>pointer<span class="_ _11"> </span>by<span class="_ _11"> </span>8,<span class="_ _16"> </span>and<span class="_ _11"> </span>the<span class="_ _16"> </span>return</div><div class="t m5 x1d h26 y2fa ff7 fs19 fc2 sc0 ls0 ws0">address<span class="_"> </span>must<span class="_ _11"> </span>be<span class="_ _11"> </span>read<span class="_ _11"> </span>from<span class="_ _11"> </span>the<span class="_ _11"> </span>memory<span class="_ _11"> </span>in<span class="_ _11"> </span>order<span class="_ _11"> </span>to<span class="_ _11"> </span>determine<span class="_ _11"> </span>the<span class="_ _11"> </span>next<span class="_ _11"> </span>value<span class="_ _11"> </span>for</div><div class="t m5 x1d h26 y2fb ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _13"> </span>program<span class="_ _13"> </span>counter<span class="_ _1"></span>.<span class="_ _13"> </span>All<span class="_ _13"> </span>of<span class="_ _13"> </span>these<span class="_ _13"> </span>must<span class="_ _13"> </span>be<span class="_ _6"> </span>completed<span class="_ _13"> </span>by<span class="_ _13"> </span>the<span class="_ _13"> </span>end<span class="_ _13"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>clock<span class="_ _13"> </span>cycle<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y2fc ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _16"> </span>style<span class="_ _11"> </span>of<span class="_ _16"> </span>implementation<span class="_ _11"> </span>does<span class="_ _16"> </span>not<span class="_ _11"> </span>make<span class="_ _16"> </span>very<span class="_ _11"> </span>good<span class="_ _11"> </span>use<span class="_ _16"> </span>of<span class="_ _11"> </span>our<span class="_ _16"> </span>hardware</div><div class="t m5 x1d h26 y2fd ff7 fs19 fc2 sc0 ls0 ws0">units<span class="_ _1"></span>,<span class="_ _11"> </span>since<span class="_ _11"> </span>each<span class="_ _11"> </span>unit<span class="_ _11"> </span>is<span class="_ _11"> </span>only<span class="_ _11"> </span>active<span class="_ _11"> </span>for<span class="_ _11"> </span>a<span class="_ _11"> </span>fraction<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>total<span class="_ _11"> </span>clock<span class="_ _11"> </span>cycle<span class="_ _1"></span>.<span class="_ _11"> </span>W<span class="_ _3"></span>e<span class="_ _11"> </span>will</div><div class="t m5 x1d h26 y2fe ff7 fs19 fc2 sc0 ls0 ws0">see<span class="_"> </span>that<span class="_"> </span>we<span class="_"> </span>can<span class="_"> </span>achieve<span class="_"> </span>much<span class="_"> </span>better<span class="_"> </span>performance<span class="_"> </span>by<span class="_"> </span>introducing<span class="_"> </span>pipelining.</div><div class="t m5 x1d h3b y3de8 fff fs24 fc6 sc0 ls0 ws0">4.4<span class="_ _17"> </span><span class="ffe fs18">General<span class="_"> </span>Principles<span class="_"> </span>of<span class="_"> </span>Pipelining</span></div><div class="t m5 x1d h26 y3de9 ff7 fs19 fc1 sc0 ls0 ws0">Before<span class="_ _16"> </span>attempting<span class="_ _11"> </span>to<span class="_ _16"> </span>design<span class="_ _16"> </span>a<span class="_ _11"> </span>pipelined<span class="_ _16"> </span>Y86-64<span class="_ _11"> </span>processor,<span class="_ _16"> </span>let<span class="_ _16"> </span>us<span class="_ _11"> </span>consider<span class="_ _16"> </span>some</div><div class="t m5 x1d h26 y3dea ff7 fs19 fc1 sc0 ls0 ws0">general<span class="_"> </span>properties<span class="_"> </span>and<span class="_ _11"> </span>principles<span class="_"> </span>of<span class="_"> </span>pipelined<span class="_ _11"> </span>systems<span class="_ _1"></span>.<span class="_"> </span>Such<span class="_ _11"> </span>systems<span class="_"> </span>are<span class="_"> </span>familiar</div><div class="t m5 x1d h26 y3deb ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _13"> </span>anyone<span class="_ _6"> </span>who<span class="_ _13"> </span>has<span class="_ _13"> </span>been<span class="_ _6"> </span>through<span class="_ _13"> </span>the<span class="_ _13"> </span>serving<span class="_ _13"> </span>line<span class="_ _6"> </span>at<span class="_ _13"> </span>a<span class="_ _13"> </span>cafeteria<span class="_ _6"> </span>or<span class="_ _13"> </span>run<span class="_ _13"> </span>a<span class="_ _6"> </span>car<span class="_ _13"> </span>through</div><div class="t m5 x1d h26 y3dec ff7 fs19 fc1 sc0 ls0 ws0">an<span class="_ _13"> </span>automated<span class="_"> </span>car<span class="_ _13"> </span>wash.<span class="_ _13"> </span>In<span class="_"> </span>a<span class="_ _13"> </span>pipelined<span class="_ _13"> </span>system,<span class="_"> </span>the<span class="_ _13"> </span>task<span class="_ _13"> </span>to<span class="_ _13"> </span>be<span class="_"> </span>performed<span class="_ _13"> </span>is<span class="_ _13"> </span>divided</div><div class="t m5 x1d h26 y3ded ff7 fs19 fc1 sc0 ls0 ws0">into<span class="_ _21"> </span>a<span class="_ _21"> </span>series<span class="_ _21"> </span>of<span class="_ _21"> </span>discrete<span class="_ _21"> </span>stages<span class="_ _1"></span>.<span class="_ _21"> </span>In<span class="_ _f"> </span>a<span class="_ _21"> </span>cafeteria,<span class="_ _f"> </span>this<span class="_ _21"> </span>involves<span class="_ _f"> </span>supplying<span class="_ _21"> </span>salad,<span class="_ _f"> </span>a</div><div class="t m5 x1d h26 y3dee ff7 fs19 fc1 sc0 ls0 ws0">main<span class="_"> </span>dish,<span class="_ _11"> </span>dessert,<span class="_ _11"> </span>and<span class="_ _11"> </span>beverage<span class="_ _1"></span>.<span class="_ _11"> </span>In<span class="_ _11"> </span>a<span class="_"> </span>car<span class="_ _11"> </span>wash,<span class="_ _11"> </span>this<span class="_ _11"> </span>involves<span class="_"> </span>spraying<span class="_ _11"> </span>water<span class="_ _11"> </span>and</div><div class="t m5 x1d h26 y3def ff7 fs19 fc1 sc0 ls0 ws0">soap<span class="_ _1"></span>,<span class="_"> </span>scrubbing,<span class="_"> </span>applying<span class="_"> </span>wax,<span class="_"> </span>and<span class="_ _11"> </span>drying.<span class="_"> </span>Rather<span class="_"> </span>than<span class="_"> </span>having<span class="_"> </span>one<span class="_"> </span>customer<span class="_"> </span>run</div><div class="t m5 x1d h26 y3df0 ff7 fs19 fc1 sc0 ls0 ws0">through<span class="_"> </span>the<span class="_ _13"> </span>entire<span class="_"> </span>sequence<span class="_"> </span>from<span class="_ _13"> </span>beginning<span class="_"> </span>to<span class="_"> </span>end<span class="_ _13"> </span>before<span class="_"> </span>the<span class="_"> </span>next<span class="_ _13"> </span>can<span class="_"> </span>begin,<span class="_"> </span>we</div><div class="t m5 x1d h26 y3df1 ff7 fs19 fc1 sc0 ls0 ws0">allow<span class="_"> </span>multiple<span class="_ _11"> </span>customers<span class="_"> </span>to<span class="_ _11"> </span>proceed<span class="_ _11"> </span>through<span class="_"> </span>the<span class="_ _11"> </span>system<span class="_"> </span>at<span class="_ _11"> </span>once.<span class="_"> </span>In<span class="_"> </span>a<span class="_"> </span>traditional</div><div class="t m5 x1d h26 y3df2 ff7 fs19 fc1 sc0 ls0 ws0">cafeteria<span class="_ _14"> </span>line,<span class="_ _15"> </span>the<span class="_ _14"> </span>customers<span class="_ _15"> </span>maintain<span class="_ _15"> </span>the<span class="_ _14"> </span>same<span class="_ _15"> </span>order<span class="_ _15"> </span>in<span class="_ _14"> </span>the<span class="_ _15"> </span>pipeline<span class="_ _15"> </span>and<span class="_ _15"> </span>pass</div><div class="t m5 x1d h26 y3df3 ff7 fs19 fc1 sc0 ls0 ws0">through<span class="_ _16"> </span>all<span class="_ _16"> </span>stages<span class="_ _1"></span>,<span class="_ _14"> </span>even<span class="_ _14"> </span>if<span class="_ _16"> </span>they<span class="_ _14"> </span>do<span class="_ _16"> </span>not<span class="_ _16"> </span>want<span class="_ _14"> </span>some<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _14"> </span>courses<span class="_ _1"></span>.<span class="_ _16"> </span>In<span class="_ _14"> </span>the<span class="_ _16"> </span>case<span class="_ _16"> </span>of</div><div class="t m5 x1d h26 y3df4 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _16"> </span>car<span class="_ _14"> </span>wash,<span class="_ _14"> </span>a<span class="_ _16"> </span>new<span class="_ _14"> </span>car<span class="_ _14"> </span>is<span class="_ _16"> </span>allowed<span class="_ _14"> </span>to<span class="_ _16"> </span>enter<span class="_ _14"> </span>the<span class="_ _16"> </span>spraying<span class="_ _14"> </span>stage<span class="_ _16"> </span>as<span class="_ _14"> </span>the<span class="_ _16"> </span>preceding</div><div class="t m5 x1d h26 y3df5 ff7 fs19 fc1 sc0 ls0 ws0">car<span class="_ _14"> </span>moves<span class="_ _15"> </span>from<span class="_ _15"> </span>the<span class="_ _15"> </span>spraying<span class="_ _15"> </span>stage<span class="_ _15"> </span>to<span class="_ _14"> </span>the<span class="_ _15"> </span>scrubbing<span class="_ _15"> </span>stage<span class="_ _0"></span>.<span class="_ _15"> </span>In<span class="_ _14"> </span>general,<span class="_ _21"> </span>the<span class="_ _15"> </span>cars</div><div class="t m5 x1d h26 y3df6 ff7 fs19 fc1 sc0 ls0 ws0">must<span class="_ _13"> </span>move<span class="_"> </span>through<span class="_ _13"> </span>the<span class="_ _13"> </span>system<span class="_"> </span>at<span class="_ _13"> </span>the<span class="_ _13"> </span>same<span class="_"> </span>rate<span class="_ _13"> </span>to<span class="_ _13"> </span>avoid<span class="_"> </span>having<span class="_ _13"> </span>one<span class="_ _13"> </span>car<span class="_ _13"> </span>crash<span class="_"> </span>into</div><div class="t m5 x1d h26 y3df7 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>next.</div><div class="t m5 x29 h26 y3df8 ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_ _11"> </span>key<span class="_ _16"> </span>feature<span class="_ _16"> </span>of<span class="_ _11"> </span>pipelining<span class="_ _16"> </span>is<span class="_ _11"> </span>that<span class="_ _16"> </span>it<span class="_ _16"> </span>increases<span class="_ _11"> </span>the<span class="_ _16"> </span><span class="ffa">throughput<span class="_ _14"> </span></span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>system</div><div class="t m5 x1d h26 y3df9 ff7 fs19 fc1 sc0 ls0 ws0">(i.e<span class="_ _1"></span>.,<span class="_ _e"> </span>the<span class="_ _f"> </span>number<span class="_ _f"> </span>of<span class="_ _21"> </span>customers<span class="_ _f"> </span>served<span class="_ _f"> </span>per<span class="_ _f"> </span>unit<span class="_ _f"> </span>time),<span class="_ _e"> </span>but<span class="_ _21"> </span>it<span class="_ _f"> </span>may<span class="_ _f"> </span>also<span class="_ _f"> </span>slightly</div><div class="t m5 x1d h26 y3dfa ff7 fs19 fc1 sc0 ls0 ws0">increase<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ffa">latency<span class="_ _13"> </span></span>(i.e.,<span class="_ _13"> </span>the<span class="_ _13"> </span>time<span class="_ _13"> </span>required<span class="_ _13"> </span>to<span class="_"> </span>service<span class="_ _13"> </span>an<span class="_ _13"> </span>individual<span class="_ _13"> </span>customer).<span class="_ _13"> </span>F<span class="_ _1"></span>or</div><div class="t m5 x1d h26 y3dfb ff7 fs19 fc1 sc0 ls0 ws0">example<span class="_ _1"></span>,<span class="_"> </span>a<span class="_"> </span>customer<span class="_"> </span>in<span class="_"> </span>a<span class="_ _13"> </span>cafeteria<span class="_"> </span>who<span class="_"> </span>only<span class="_"> </span>wants<span class="_"> </span>a<span class="_ _13"> </span>dessert<span class="_"> </span>could<span class="_"> </span>pass<span class="_"> </span>through<span class="_"> </span>a</div><div class="t m5 x1d h26 y3dfc ff7 fs19 fc1 sc0 ls0 ws0">nonpipelined<span class="_ _6"> </span>system<span class="_ _6"> </span>very<span class="_ _6"> </span>quickly<span class="_ _3"></span>,<span class="_ _13"> </span>stopping<span class="_ _6"> </span>only<span class="_ _6"> </span>at<span class="_ _6"> </span>the<span class="_ _6"> </span>dessert<span class="_ _13"> </span>stage<span class="_ _1"></span>.<span class="_ _6"> </span>A<span class="_ _6"> </span>customer<span class="_ _6"> </span>in</div><div class="t m5 x1d h26 y3dfd ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_"> </span>pipelined<span class="_ _13"> </span>system<span class="_"> </span>who<span class="_ _13"> </span>attempts<span class="_"> </span>to<span class="_ _13"> </span>go<span class="_"> </span>directly<span class="_ _13"> </span>to<span class="_"> </span>the<span class="_"> </span>dessert<span class="_ _13"> </span>stage<span class="_"> </span>risks<span class="_ _13"> </span>incurring</div><div class="t m5 x1d h26 y3dfe ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>wrath<span class="_"> </span>of<span class="_"> </span>other<span class="_"> </span>customers<span class="_ _1"></span>.</div><div class="t m5 x1d h41 y3dff ffe fs29 fc1 sc0 ls0 ws0">4.4.1<span class="_ _48"> </span><span class="fs19">Computational<span class="_"> </span>Pipelines</span></div><div class="t m5 x1d h26 y2578 ff7 fs19 fc1 sc0 ls0 ws0">Shifting<span class="_ _14"> </span>our<span class="_ _14"> </span>focus<span class="_ _14"> </span>to<span class="_ _14"> </span>computational<span class="_ _14"> </span>pipelines<span class="_ _1"></span>,<span class="_ _15"> </span>the<span class="_ _14"> </span>“customers”<span class="_ _14"> </span>are<span class="_ _14"> </span>instructions</div><div class="t m5 x1d h26 y2579 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_"> </span>the<span class="_"> </span>stages<span class="_ _11"> </span>perform<span class="_"> </span>some<span class="_ _11"> </span>portion<span class="_"> </span>of<span class="_ _11"> </span>the<span class="_"> </span>instruction<span class="_ _11"> </span>execution.<span class="_"> </span>Figure<span class="_"> </span>4.32(a)</div><div class="t m5 x1d h26 y257a ff7 fs19 fc1 sc0 ls0 ws0">shows<span class="_"> </span>an<span class="_"> </span>example<span class="_"> </span>of<span class="_"> </span>a<span class="_"> </span>simple<span class="_"> </span>nonpipelined<span class="_"> </span>hardware<span class="_"> </span>system.<span class="_"> </span>It<span class="_"> </span>consists<span class="_"> </span>of<span class="_"> </span>some</div><div class="t m5 x1d h26 y257b ff7 fs19 fc1 sc0 ls0 ws0">logic<span class="_ _13"> </span>that<span class="_ _13"> </span>performs<span class="_ _13"> </span>a<span class="_ _6"> </span>computation,<span class="_"> </span>followed<span class="_ _6"> </span>by<span class="_ _13"> </span>a<span class="_ _13"> </span>register<span class="_ _13"> </span>to<span class="_ _13"> </span>hold<span class="_ _13"> </span>the<span class="_ _6"> </span>results<span class="_ _13"> </span>of<span class="_ _13"> </span>this</div><div class="t m5 x1d h26 y257c ff7 fs19 fc1 sc0 ls0 ws0">computation.<span class="_ _11"> </span>A<span class="_ _16"> </span>clock<span class="_ _11"> </span>signal<span class="_ _16"> </span>controls<span class="_ _11"> </span>the<span class="_ _16"> </span>loading<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span>register<span class="_ _16"> </span>at<span class="_ _11"> </span>some<span class="_ _16"> </span>regular</div><div class="t m5 x1d h26 y257d ff7 fs19 fc1 sc0 ls0 ws0">time<span class="_ _13"> </span>interval.<span class="_"> </span>An<span class="_ _13"> </span>example<span class="_ _13"> </span>of<span class="_"> </span>such<span class="_ _13"> </span>a<span class="_"> </span>system<span class="_ _13"> </span>is<span class="_ _13"> </span>the<span class="_"> </span>decoder<span class="_ _13"> </span>in<span class="_ _13"> </span>a<span class="_"> </span>compact<span class="_ _13"> </span>disk<span class="_ _13"> </span>(CD)</div><div class="t m5 x1d h26 y3e00 ff7 fs19 fc1 sc0 ls0 ws0">player.<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _14"> </span>incoming<span class="_ _14"> </span>signals<span class="_ _14"> </span>are<span class="_ _16"> </span>the<span class="_ _14"> </span>bits<span class="_ _14"> </span>read<span class="_ _14"> </span>from<span class="_ _14"> </span>the<span class="_ _16"> </span>surface<span class="_ _14"> </span>of<span class="_ _14"> </span>the<span class="_ _14"> </span>CD<span class="_ _3"></span>,<span class="_ _15"> </span>and</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
