<div id="pf33f" class="pf w2 h11" data-page-no="33f"><div class="pc pc33f w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg33f.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">830<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>8<span class="_ _3d"> </span>Exceptional<span class="_ _10"> </span>Control<span class="_ _10"> </span>Flow</span></div><div class="t m5 xb4 h2c y27f ffa fs16 fc2 sc0 ls0 ws0">code/ecf/counterprob<span class="_ _1"></span>.c</div><div class="t m5 x1f h2d y280 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">#include<span class="_ _1f"> </span>&quot;csapp.h&quot;</span></div><div class="t m5 x1f h2e y281 ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x1f h2e y282 ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x4f h2d y283 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>counter<span class="_ _1f"> </span>=<span class="_ _1f"> </span>0;</div><div class="t m5 x1f h2e y284 ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 x1f h2e y69c3 ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x4f h2d y285 ffd fs1e fc2 sc0 ls0 ws0">void<span class="_ _e"> </span>handler(int<span class="_ _1f"> </span>sig)</div><div class="t m5 x1f h2d y286 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x1f h2d y287 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _20"> </span><span class="ffd fs1e fc2">counter++;</span></div><div class="t m5 x1f h2d y4493 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _20"> </span><span class="ffd fs1e fc2">sleep(1);<span class="_ _e"> </span>/*<span class="_ _1f"> </span>Do<span class="_ _1f"> </span>some<span class="_ _e"> </span>work<span class="_ _1f"> </span>in<span class="_ _e"> </span>the<span class="_ _1f"> </span>handler<span class="_ _1f"> </span>*/</span></div><div class="t m5 x1f h2d y4a9a ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _20"> </span><span class="ffd fs1e fc2">return;</span></div><div class="t m5 x1b0 h2d y4a9b ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1b0 h2e y4a9c ff6 fs20 fc6 sc0 ls0 ws0">11</div><div class="t m5 x1b0 h2e y65f2 ff6 fs20 fc6 sc0 ls0 ws0">12</div><div class="t m5 x4f h2d y906 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>main()</div><div class="t m5 x1b0 h2d y4a9d ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x1b0 h2d y4a9e ff6 fs20 fc6 sc0 ls0 ws0">14<span class="_ _20"> </span><span class="ffd fs1e fc2">int<span class="_ _e"> </span>i;</span></div><div class="t m5 x1b0 h2e y4a9f ff6 fs20 fc6 sc0 ls0 ws0">15</div><div class="t m5 x1b0 h2e y6a28 ff6 fs20 fc6 sc0 ls0 ws0">16</div><div class="t m5 x33 h2d y417 ffd fs1e fc2 sc0 ls0 ws0">Signal(SIGUSR2,<span class="_ _e"> </span>handler);</div><div class="t m5 x1b0 h2e y4aa0 ff6 fs20 fc6 sc0 ls0 ws0">17</div><div class="t m5 x1b0 h2e y6a25 ff6 fs20 fc6 sc0 ls0 ws0">18</div><div class="t m5 x33 h2d yeb4 ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>(Fork()<span class="_ _1f"> </span>==<span class="_ _1f"> </span>0)<span class="_ _e"> </span>{<span class="_ _1a"> </span>/*<span class="_ _1f"> </span>Child<span class="_ _e"> </span>*/</div><div class="t m5 x1b0 h2d y2a2b ff6 fs20 fc6 sc0 ls0 ws0">19<span class="_ _70"> </span><span class="ffd fs1e fc2 ls33">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>i=0<span class="_ _41"></span>;i&lt;5<span class="_ _41"></span>;<span class="ls0">i++)<span class="_ _e"> </span>{</span></span></div><div class="t m5 x1b0 h2d y1ab8 ff6 fs20 fc6 sc0 ls0 ws0">20<span class="_ _d1"> </span><span class="ffd fs1e fc2">Kill(getppid(),<span class="_ _1f"> </span>SIGUSR2);</span></div><div class="t m5 x1b0 h2e y94f ff6 fs20 fc6 sc0 ls0 ws0">21</div><div class="t m5 xb2 h2d y1ada ffd fs1e fc2 sc0 ls0 ws0">printf(&quot;sent<span class="_ _e"> </span>SIGUSR2<span class="_ _1f"> </span>to<span class="_ _1f"> </span>parent\n&quot;);</div><div class="t m5 x1b0 h2d y4aa1 ff6 fs20 fc6 sc0 ls0 ws0">22<span class="_ _70"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1b0 h2d y3228 ff6 fs20 fc6 sc0 ls0 ws0">23<span class="_ _70"> </span><span class="ffd fs1e fc2">exit(0);</span></div><div class="t m5 x1b0 h2d y35d ff6 fs20 fc6 sc0 ls0 ws0">24<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1b0 h2e y4aa3 ff6 fs20 fc6 sc0 ls0 ws0">25</div><div class="t m5 x1b0 h2e y6b3a ff6 fs20 fc6 sc0 ls0 ws0">26</div><div class="t m5 x33 h2d y2467 ffd fs1e fc2 sc0 ls0 ws0">Wait(NULL);</div><div class="t m5 x1b0 h2d y322b ff6 fs20 fc6 sc0 ls0 ws0">27<span class="_ _20"> </span><span class="ffd fs1e fc2">printf(&quot;counter=%d\n&quot;,<span class="_ _e"> </span>counter);</span></div><div class="t m5 x1b0 h2d y322c ff6 fs20 fc6 sc0 ls0 ws0">28<span class="_ _20"> </span><span class="ffd fs1e fc2">exit(0);</span></div><div class="t m5 x1b0 h2d y441 ff6 fs20 fc6 sc0 ls0 ws0">29<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 xb4 h2c y66e3 ffa fs16 fc2 sc0 ls0 ws0">code/ecf/counterprob<span class="_ _1"></span>.c</div><div class="t m5 x1d h2f y66e4 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>8.45<span class="_ _66"> </span><span class="fc1">Counter<span class="_"> </span>program<span class="_"> </span>referenced<span class="_"> </span>in<span class="_"> </span>Problem<span class="_"> </span>8.23.</span></div><div class="t m5 x1d h73 y6b3b ffe fs1e fc6 sc0 ls0 ws0">8.25<span class="_ _23"> </span><span class="ff10 fs19">◆◆◆</span></div><div class="t m5 x1d h26 y6b3c ff7 fs19 fc1 sc0 ls0 ws0">Write<span class="_ _6"> </span>a<span class="_ _6"> </span>version<span class="_ _13"> </span>of<span class="_ _a"> </span>the<span class="_ _6"> </span><span class="ffd">fgets<span class="_ _13"> </span></span>function,<span class="_ _6"> </span>called<span class="_ _6"> </span><span class="ffd">tfgets</span>,<span class="_ _13"> </span>that<span class="_ _6"> </span>times<span class="_ _6"> </span>out<span class="_ _6"> </span>after<span class="_ _13"> </span>5<span class="_ _a"> </span>seconds<span class="_ _1"></span>.</div><div class="t m5 x1d h26 y6b3d ff7 fs19 fc1 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _10"> </span><span class="ffd ls0">tfgets<span class="_ _10"> </span><span class="ff7">function<span class="_ _13"> </span>accepts<span class="_"> </span>the<span class="_ _13"> </span>same<span class="_"> </span>inputs<span class="_ _13"> </span>as<span class="_"> </span></span>fgets<span class="ff7">.<span class="_ _13"> </span>If<span class="_ _13"> </span>the<span class="_"> </span>user<span class="_ _13"> </span>doesn’t<span class="_ _13"> </span>type<span class="_"> </span>an</span></span></div><div class="t m5 x1d h26 y6b3e ff7 fs19 fc1 sc0 ls0 ws0">input<span class="_ _13"> </span>line<span class="_ _13"> </span>within<span class="_"> </span>5<span class="_ _13"> </span>seconds<span class="_ _3"></span>,<span class="_"> </span><span class="ffd">tfgets<span class="_ _13"> </span></span>returns<span class="_ _13"> </span>NULL.<span class="_ _13"> </span>Otherwise,<span class="_ _13"> </span>it<span class="_ _13"> </span>returns<span class="_ _13"> </span>a<span class="_"> </span>pointer</div><div class="t m5 x1d h26 y6b3f ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_"> </span>the<span class="_"> </span>input<span class="_"> </span>line<span class="_ _1"></span>.</div><div class="t m5 x1d h73 y6b40 ffe fs1e fc6 sc0 ls0 ws0">8.26<span class="_ _23"> </span><span class="ff10 fs19">◆◆◆◆</span></div><div class="t m5 x1d h26 y6b41 ff7 fs19 fc1 sc0 ls0 ws0">Using<span class="_ _16"> </span>the<span class="_ _16"> </span>example<span class="_ _16"> </span>in<span class="_ _16"> </span>F<span class="_ _1"></span>igure<span class="_ _14"> </span>8.23<span class="_ _16"> </span>as<span class="_ _16"> </span>a<span class="_ _16"> </span>starting<span class="_ _16"> </span>point,<span class="_ _16"> </span>write<span class="_ _16"> </span>a<span class="_ _16"> </span>shell<span class="_ _16"> </span>program<span class="_ _16"> </span>that</div><div class="t m5 x1d h26 y6b42 ff7 fs19 fc1 sc0 ls0 ws0">supports<span class="_"> </span>job<span class="_"> </span>control.<span class="_"> </span>Y<span class="_ _3"></span>our<span class="_"> </span>shell<span class="_"> </span>should<span class="_"> </span>have<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>features:</div><div class="t m5 x75 h3d y6b43 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y77e ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _13"> </span>command<span class="_ _13"> </span>line<span class="_ _13"> </span>typed<span class="_ _13"> </span>by<span class="_ _13"> </span>the<span class="_ _6"> </span>user<span class="_ _13"> </span>consists<span class="_ _13"> </span>of<span class="_ _13"> </span>a<span class="_ _13"> </span><span class="ffd">name<span class="_ _13"> </span></span>and<span class="_ _6"> </span>zero<span class="_ _13"> </span>or<span class="_ _13"> </span>more<span class="_ _13"> </span>argu-</div><div class="t m5 x29 h26 y77f ff7 fs19 fc1 sc0 ls0 ws0">ments<span class="_ _1"></span>,<span class="_ _13"> </span>all<span class="_"> </span>separated<span class="_ _13"> </span>by<span class="_ _13"> </span>one<span class="_ _13"> </span>or<span class="_"> </span>more<span class="_ _13"> </span>spaces<span class="_ _3"></span>.<span class="_"> </span>If<span class="_ _13"> </span><span class="ffd">name<span class="_ _13"> </span></span>is<span class="_ _13"> </span>a<span class="_"> </span>built-in<span class="_ _13"> </span>command,<span class="_ _13"> </span>the</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
