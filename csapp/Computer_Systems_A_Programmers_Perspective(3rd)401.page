<div id="pf191" class="pf w2 h11" data-page-no="191"><div class="pc pc191 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg191.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">400<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>4<span class="_ _3d"> </span>Processor<span class="_ _10"> </span>Architecture</span></div><div class="t m5 x1d h31 y390 ff7 fs21 fc2 sc0 ls0 ws0">V<span class="_ _7"></span>alue<span class="_ _26"> </span>Name<span class="_ _26"> </span>Meaning</div><div class="t m5 x17e h31 yc94 ff7 fs21 fc2 sc0 ls0 ws0">1<span class="_ _57"> </span><span class="ffd fs1e">AOK<span class="_ _3a"> </span></span>Normal<span class="_"> </span>operation</div><div class="t m5 x17e h31 yc96 ff7 fs21 fc2 sc0 ls0 ws0">2</div><div class="t m5 x1cc h31 yc98 ffd fs1e fc2 sc0 ls0 ws0">HLT<span class="_ _3a"> </span>halt<span class="_ _10"> </span><span class="ff7 fs21">instruction<span class="_"> </span>encountered</span></div><div class="t m5 x17e h31 yc99 ff7 fs21 fc2 sc0 ls0 ws0">3</div><div class="t m5 x1cc h31 yc9b ffd fs1e fc2 sc0 ls0 ws0">ADR<span class="_ _3a"> </span><span class="ff7 fs21">Invalid<span class="_"> </span>address<span class="_"> </span>encountered</span></div><div class="t m5 x17e h31 yc9c ff7 fs21 fc2 sc0 ls0 ws0">4</div><div class="t m5 x1cc h31 yc9e ffd fs1e fc2 sc0 ls0 ws0">INS<span class="_ _3a"> </span><span class="ff7 fs21">Invalid<span class="_"> </span>instruction<span class="_"> </span>encountered</span></div><div class="t m5 x1d h34 y1328 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>4.5<span class="_ _c"> </span><span class="fc1">Y86-64<span class="_"> </span>status<span class="_"> </span>codes.<span class="_"> </span><span class="ff6">In<span class="_ _11"> </span>our<span class="_ _11"> </span>design,<span class="_ _10"> </span>the<span class="_ _11"> </span>processor<span class="_ _10"> </span>halts<span class="_ _11"> </span>for<span class="_ _11"> </span>any<span class="_ _10"> </span>code<span class="_ _11"> </span>other</span></span></div><div class="t m5 x1d h34 y1329 ff6 fs16 fc1 sc0 ls0 ws0">than</div><div class="t m5 xce h3a y15c2 ffd fs19 fc1 sc0 ls0 ws0">AOK<span class="ff6 fs16">.</span></div><div class="t m5 x1d h26 y3793 ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_"> </span>executing<span class="_"> </span>normally<span class="_ _3"></span>,<span class="_ _11"> </span>while<span class="_"> </span>the<span class="_ _11"> </span>other<span class="_"> </span>codes<span class="_"> </span>indicate<span class="_ _11"> </span>that<span class="_"> </span>some<span class="_ _11"> </span>type<span class="_"> </span>of<span class="_ _11"> </span><span class="ffa">exception</span></div><div class="t m5 x1d h26 y3794 ff7 fs19 fc1 sc0 ls0 ws0">has<span class="_ _13"> </span>occurred.<span class="_ _6"> </span>Code<span class="_ _13"> </span>2,<span class="_ _13"> </span>named<span class="_ _6"> </span><span class="ffd">HLT</span>,<span class="_ _13"> </span>indicates<span class="_ _13"> </span>that<span class="_ _6"> </span>the<span class="_ _13"> </span>processor<span class="_ _13"> </span>has<span class="_ _6"> </span>executed<span class="_ _13"> </span>a<span class="_ _6"> </span><span class="ffd">halt</span></div><div class="t m5 x1d h26 y3795 ff7 fs19 fc1 sc0 ls0 ws0">instruction.<span class="_ _16"> </span>Code<span class="_ _16"> </span>3,<span class="_ _14"> </span>named<span class="_ _14"> </span><span class="ffd">ADR</span>,<span class="_ _14"> </span>indicates<span class="_ _16"> </span>that<span class="_ _14"> </span>the<span class="_ _16"> </span>processor<span class="_ _14"> </span>attempted<span class="_ _16"> </span>to<span class="_ _16"> </span>read</div><div class="t m5 x1d h26 y3796 ff7 fs19 fc1 sc0 ls0 ws0">from<span class="_ _11"> </span>or<span class="_ _11"> </span>write<span class="_ _16"> </span>to<span class="_"> </span>an<span class="_ _16"> </span>invalid<span class="_ _11"> </span>memory<span class="_ _11"> </span>address<span class="_ _1"></span>,<span class="_ _16"> </span>either<span class="_ _11"> </span>while<span class="_ _11"> </span>fetching<span class="_ _11"> </span>an<span class="_ _16"> </span>instruction</div><div class="t m5 x1d h26 y3797 ff7 fs19 fc1 sc0 ls0 ws0">or<span class="_ _11"> </span>while<span class="_ _11"> </span>reading<span class="_ _11"> </span>or<span class="_ _11"> </span>writing<span class="_ _11"> </span>data.<span class="_ _11"> </span>W<span class="_ _3"></span>e<span class="_ _11"> </span>limit<span class="_ _16"> </span>the<span class="_"> </span>maximum<span class="_ _11"> </span>address<span class="_ _11"> </span>(the<span class="_ _11"> </span>exact<span class="_ _11"> </span>limit</div><div class="t m5 x1d h26 y3798 ff7 fs19 fc1 sc0 ls0 ws0">varies<span class="_ _14"> </span>by<span class="_ _14"> </span>implementation),<span class="_ _15"> </span>and<span class="_ _15"> </span>any<span class="_ _14"> </span>access<span class="_ _14"> </span>to<span class="_ _14"> </span>an<span class="_ _15"> </span>address<span class="_ _14"> </span>beyond<span class="_ _14"> </span>this<span class="_ _15"> </span>limit<span class="_ _14"> </span>will</div><div class="t m5 x1d h26 y3799 ff7 fs19 fc1 sc0 ls0 ws0">trigger<span class="_"> </span>an<span class="_ _13"> </span><span class="ffd">ADR<span class="_ _10"> </span></span>exception.<span class="_ _13"> </span>Code<span class="_"> </span>4,<span class="_ _13"> </span>named<span class="_"> </span><span class="ffd">INS</span>,<span class="_"> </span>indicates<span class="_ _13"> </span>that<span class="_"> </span>an<span class="_ _13"> </span>invalid<span class="_"> </span>instruction</div><div class="t m5 x1d h26 y379a ff7 fs19 fc1 sc0 ls0 ws0">code<span class="_"> </span>has<span class="_"> </span>been<span class="_"> </span>encountered.</div><div class="t m5 x29 h26 y379b ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _15"> </span>Y86-64,<span class="_ _f"> </span>we<span class="_ _15"> </span>will<span class="_ _15"> </span>simply<span class="_ _15"> </span>have<span class="_ _21"> </span>the<span class="_ _15"> </span>processor<span class="_ _15"> </span>stop<span class="_ _21"> </span>executing<span class="_ _15"> </span>instructions</div><div class="t m5 x1d h26 y379c ff7 fs19 fc1 sc0 ls0 ws0">when<span class="_ _11"> </span>it<span class="_ _16"> </span>encounters<span class="_ _16"> </span>any<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span>exceptions<span class="_ _16"> </span>listed.<span class="_ _16"> </span>In<span class="_ _11"> </span>a<span class="_ _16"> </span>more<span class="_ _11"> </span>complete<span class="_ _16"> </span>design,<span class="_ _16"> </span>the</div><div class="t m5 x1d h26 y379d ff7 fs19 fc1 sc0 ls0 ws0">processor<span class="_ _16"> </span>would<span class="_ _14"> </span>typically<span class="_ _14"> </span>invoke<span class="_ _14"> </span>an<span class="_ _16"> </span><span class="ffa">exception<span class="_ _14"> </span>handler<span class="_ _2"></span></span>,<span class="_ _15"> </span>a<span class="_ _16"> </span>procedure<span class="_ _14"> </span>designated</div><div class="t m5 x1d h26 y379e ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_"> </span>handle<span class="_ _11"> </span>the<span class="_"> </span>speciﬁc<span class="_ _11"> </span>type<span class="_"> </span>of<span class="_ _11"> </span>exception<span class="_ _11"> </span>encountered.<span class="_"> </span>As<span class="_ _11"> </span>described<span class="_"> </span>in<span class="_ _11"> </span>Chapter<span class="_"> </span>8,</div><div class="t m5 x1d h26 y379f ff7 fs19 fc1 sc0 ls0 ws0">exception<span class="_ _16"> </span>handlers<span class="_ _16"> </span>can<span class="_ _16"> </span>be<span class="_ _11"> </span>conﬁgured<span class="_ _16"> </span>to<span class="_ _16"> </span>have<span class="_ _16"> </span>different<span class="_ _16"> </span>effects<span class="_ _1"></span>,<span class="_ _16"> </span>such<span class="_ _16"> </span>as<span class="_ _16"> </span>aborting</div><div class="t m5 x1d h26 y37a0 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>program<span class="_"> </span>or<span class="_"> </span>invoking<span class="_"> </span>a<span class="_"> </span>user<span class="_ _1"></span>-deﬁned<span class="_"> </span><span class="ffa">signal<span class="_"> </span>handler<span class="_ _2"></span></span>.</div><div class="t m5 x1d h41 y37a1 ffe fs29 fc1 sc0 ls0 ws0">4.1.5</div><div class="t m5 x8c h43 y37a2 ffe fs19 fc1 sc0 ls0 ws0">Y86-64<span class="_"> </span>Programs</div><div class="t m5 x1d h26 y37a3 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_"> </span>4.6<span class="_"> </span>shows<span class="_"> </span>x86-64<span class="_"> </span>and<span class="_"> </span>Y86-64<span class="_"> </span>assembly<span class="_"> </span>code<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>C<span class="_"> </span>function:</div><div class="t m5 x1f h2e y37a4 ff6 fs20 fc6 sc0 ls0 ws0">1</div><div class="t m5 x4f h2d y37a5 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>sum(long<span class="_ _1f"> </span>*start,<span class="_ _1f"> </span>long<span class="_ _e"> </span>count)</div><div class="t m5 x1f h2e y37a6 ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x4f h2d y37a7 ffd fs1e fc2 sc0 ls0 ws0">{</div><div class="t m5 x1f h2e y37a8 ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x33 h2d y37a9 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>sum<span class="_ _1f"> </span>=<span class="_ _1f"> </span>0;</div><div class="t m5 x1f h2d y37aa ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2">while<span class="_ _e"> </span>(count)<span class="_ _1f"> </span>{</span></div><div class="t m5 x1f h2d y37ab ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _70"> </span><span class="ffd fs1e fc2">sum<span class="_ _e"> </span>+=<span class="_ _1f"> </span>*start;</span></div><div class="t m5 x1f h2d y37ac ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _70"> </span><span class="ffd fs1e fc2">start++;</span></div><div class="t m5 x1f h2d y37ad ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _70"> </span><span class="ffd fs1e fc2">count--;</span></div><div class="t m5 x1f h2d y37ae ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1f h2d y37af ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _20"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>sum;</span></div><div class="t m5 x1b0 h2e y37b0 ff6 fs20 fc6 sc0 ls0 ws0">10</div><div class="t m5 x4f h2d y37b1 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x29 h26 y37b2 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _f"> </span>x86-64<span class="_ _21"> </span>code<span class="_ _21"> </span>was<span class="_ _f"> </span>generated<span class="_ _21"> </span>by<span class="_ _21"> </span>the<span class="_ _f"> </span><span class="ff9">gcc<span class="_ _21"> </span></span>compiler.<span class="_ _21"> </span>T<span class="_ _1"></span>he<span class="_ _f"> </span>Y86-64<span class="_ _21"> </span>code<span class="_ _21"> </span>is</div><div class="t m5 x1d h26 y37b3 ff7 fs19 fc2 sc0 ls0 ws0">similar,<span class="_"> </span>but<span class="_"> </span>with<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>differences:</div><div class="t m5 x75 h3d y77d ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y15bf ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>Y86-64<span class="_ _13"> </span>code<span class="_"> </span>loads<span class="_"> </span>constants<span class="_ _13"> </span>into<span class="_"> </span>registers<span class="_ _13"> </span>(lines<span class="_"> </span>2–3),<span class="_ _13"> </span>since<span class="_"> </span>it<span class="_ _13"> </span>cannot<span class="_"> </span>use</div><div class="t m5 x29 h26 y15c0 ff7 fs19 fc1 sc0 ls0 ws0">immediate<span class="_"> </span>data<span class="_"> </span>in<span class="_"> </span>arithmetic<span class="_"> </span>instructions<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
