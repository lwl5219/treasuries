<div id="pf246" class="pf w2 h11" data-page-no="246"><div class="pc pc246 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg246.png"/><div class="t m5 x93 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>5.9<span class="_ _60"> </span>Enhancing<span class="_ _10"> </span>Parallelism<span class="_ _3e"> </span><span class="ffe fs1e">581</span></div><div class="t m5 x62 h9a y4e0f ff6c fs5e fc1 sc0 ls0 ws0">6</div><div class="t m5 x62 h9a y4e10 ff6c fs5e fc1 sc0 ls0 ws0">5</div><div class="t m5 x62 h9a y4e11 ff6c fs5e fc1 sc0 ls0 ws0">4</div><div class="t m5 x62 h9a y4e12 ff6c fs5e fc1 sc0 ls0 ws0">3</div><div class="t m5 x62 h9a y4e13 ff6c fs5e fc1 sc0 ls0 ws0">2</div><div class="t m5 x62 h9a y4e14 ff6c fs5e fc1 sc0 ls0 ws0">1</div><div class="t m5 x62 h9a y4e15 ff6c fs5e fc1 sc0 ls0 ws0">0</div><div class="t m5 xe h9a y4e16 ff6c fs5e fc1 sc0 ls0 ws0">1</div><div class="t m5 x1a7 h9a y4e17 ff6c fs5e fc1 sc0 ls0 ws0">2<span class="_ _79"> </span>3<span class="_ _79"> </span>4</div><div class="t m5 x1a8 h9a y4e18 ff21 fs5e fc1 sc0 ls0 ws0">Unrolling factor <span class="ff5b">k</span></div><div class="t m7 xef h9a y4e19 ff21 fs5e fc1 sc0 ls0 ws0">CPE</div><div class="t m5 x7c h9a y4e17 ff6c fs5e fc1 sc0 ls0 ws0">5<span class="_ _79"> </span>6</div><div class="t m5 x1e1 hd5 y4e1a ff6c fs86 fc1 sc0 ls0 ws0">double </div><div class="t m5 xd7 hd6 y4e1b ff6c fs87 fc1 sc0 ls0 ws0">*</div><div class="t m5 x1e1 hd5 y4e1c ff6c fs86 fc1 sc0 ls0 ws0">double +</div><div class="t m5 x1e1 hd5 y4e1d ff6c fs86 fc1 sc0 ls0 ws0">long </div><div class="t m5 x11d hd6 y4e1e ff6c fs87 fc1 sc0 ls0 ws0">*</div><div class="t m5 x1e1 hd5 y4e1f ff6c fs86 fc1 sc0 ls0 ws0">long +</div><div class="t m5 x1e6 h9a y4e17 ff6c fs5e fc1 sc0 ls0 ws0">7<span class="_ _79"> </span>8<span class="_ _79"> </span>9<span class="_ _3c"> </span>10</div><div class="t m5 x17 h35 y4e20 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>5.30<span class="_ _66"> </span><span class="fc1">CPE<span class="_"> </span>performance<span class="_"> </span>for<span class="_ _13"> </span><span class="ff11">k<span class="_ _10"> </span><span class="ff12">×<span class="_ _13"></span><span class="ff7">1<span class="_ _1"></span><span class="ff11">a<span class="_"> </span><span class="ffe">loop<span class="_ _13"> </span>unrolling.<span class="_"> </span><span class="ff6">All<span class="_ _10"> </span>of<span class="_ _10"> </span>the<span class="_ _13"> </span>CPEs<span class="_ _10"> </span>improve<span class="_ _10"> </span>with</span></span></span></span></span></span></span></div><div class="t m5 x17 h34 y4e21 ff6 fs16 fc1 sc0 ls0 ws0">this<span class="_ _10"> </span>transformation,<span class="_ _11"> </span>nearly<span class="_ _10"> </span>approaching<span class="_ _10"> </span>their<span class="_ _11"> </span>throughput<span class="_ _10"> </span>bounds.</div><div class="t m5 x17 h26 y4e93 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _11"> </span>outcome.<span class="_ _11"> </span>W<span class="_ _3"></span>e<span class="_ _16"> </span>would<span class="_ _11"> </span>argue<span class="_ _16"> </span>that<span class="_ _11"> </span>the<span class="_ _16"> </span>difference<span class="_ _11"> </span>would<span class="_ _16"> </span>be<span class="_ _11"> </span>immaterial<span class="_ _16"> </span>for<span class="_ _11"> </span>most</div><div class="t m5 x17 h26 y4e94 ff7 fs19 fc1 sc0 ls0 ws0">applications<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y4e95 ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_"> </span>summary<span class="_ _7"></span>,<span class="_"> </span>a<span class="_ _13"> </span>reassociation<span class="_"> </span>transformation<span class="_ _13"> </span>can<span class="_"> </span>reduce<span class="_"> </span>the<span class="_ _13"> </span>number<span class="_"> </span>of<span class="_ _13"> </span>opera-</div><div class="t m5 x17 h26 y4e96 ff7 fs19 fc1 sc0 ls0 ws0">tions<span class="_"> </span>along<span class="_"> </span>the<span class="_"> </span>critical<span class="_ _11"> </span>path<span class="_"> </span>in<span class="_"> </span>a<span class="_ _11"> </span>computation,<span class="_"> </span>resulting<span class="_"> </span>in<span class="_ _11"> </span>better<span class="_"> </span>performance<span class="_"> </span>by</div><div class="t m5 x17 h26 y4e97 ff7 fs19 fc1 sc0 ls0 ws0">better<span class="_ _13"> </span>utilizing<span class="_ _6"> </span>the<span class="_ _13"> </span>multiple<span class="_ _13"> </span>functional<span class="_ _13"> </span>units<span class="_ _6"> </span>and<span class="_ _13"> </span>their<span class="_ _13"> </span>pipelining<span class="_ _13"> </span>capabilities<span class="_ _3"></span>.<span class="_ _13"> </span>Most</div><div class="t m5 x17 h26 y4e98 ff7 fs19 fc1 sc0 ls0 ws0">compilers<span class="_ _16"> </span>will<span class="_ _16"> </span>not<span class="_ _16"> </span>attempt<span class="_ _16"> </span>any<span class="_ _11"> </span>reassociations<span class="_ _16"> </span>of<span class="_ _16"> </span>ﬂoating-point<span class="_ _16"> </span>operations<span class="_ _1"></span>,<span class="_ _14"> </span>since</div><div class="t m5 x17 h26 y4e99 ff7 fs19 fc1 sc0 ls0 ws0">these<span class="_"> </span>operations<span class="_ _13"> </span>are<span class="_"> </span>not<span class="_"> </span>guaranteed<span class="_ _13"> </span>to<span class="_"> </span>be<span class="_"> </span>associative<span class="_ _1"></span>.<span class="_"> </span>Current<span class="_ _13"> </span>versions<span class="_"> </span>of<span class="_"> </span><span class="ff9">gcc<span class="_ _13"> </span></span>do</div><div class="t m5 x17 h26 y4e9a ff7 fs19 fc1 sc0 ls0 ws0">perform<span class="_"> </span>reassociations<span class="_"> </span>of<span class="_ _13"> </span>integer<span class="_"> </span>operations<span class="_ _1"></span>,<span class="_"> </span>but<span class="_"> </span>not<span class="_ _13"> </span>always<span class="_"> </span>with<span class="_"> </span>good<span class="_"> </span>effects<span class="_ _3"></span>.<span class="_"> </span>In</div><div class="t m5 x17 h26 y4e9b ff7 fs19 fc1 sc0 ls0 ws0">general,<span class="_"> </span>we<span class="_ _13"> </span>have<span class="_"> </span>found<span class="_"> </span>that<span class="_"> </span>unrolling<span class="_ _13"> </span>a<span class="_"> </span>loop<span class="_"> </span>and<span class="_ _13"> </span>accumulating<span class="_"> </span>multiple<span class="_"> </span>values<span class="_ _13"> </span>in</div><div class="t m5 x17 h26 y4e9c ff7 fs19 fc1 sc0 ls0 ws0">parallel<span class="_"> </span>is<span class="_"> </span>a<span class="_"> </span>more<span class="_"> </span>reliable<span class="_"> </span>way<span class="_"> </span>to<span class="_"> </span>achieve<span class="_"> </span>improved<span class="_"> </span>program<span class="_"> </span>performance<span class="_ _1"></span>.</div><div class="t m5 x17 h47 y4e9d ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>5.8<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>612)</span></div><div class="t m5 x17 h26 y4e9e ff7 fs19 fc1 sc0 ls0 ws0">Consider<span class="_ _6"> </span>the<span class="_ _13"> </span>following<span class="_ _a"> </span>function<span class="_ _13"> </span>for<span class="_ _a"> </span>computing<span class="_ _13"> </span>the<span class="_ _6"> </span>product<span class="_ _6"> </span>of<span class="_ _13"> </span>an<span class="_ _a"> </span>array<span class="_ _13"> </span>of<span class="_ _6"> </span><span class="ff11">n<span class="_ _6"> </span></span>double-</div><div class="t m5 x17 h26 y4e9f ff7 fs19 fc1 sc0 ls0 ws0">precision<span class="_"> </span>numbers<span class="_ _1"></span>.<span class="_"> </span>W<span class="_ _3"></span>e<span class="_"> </span>have<span class="_"> </span>unrolled<span class="_"> </span>the<span class="_"> </span>loop<span class="_"> </span>by<span class="_"> </span>a<span class="_"> </span>factor<span class="_"> </span>of<span class="_"> </span>3.</div><div class="t m5 x17 h2d y2455 ffd fs1e fc2 sc0 ls0 ws0">double<span class="_ _e"> </span>aprod(double<span class="_ _1f"> </span>a[],<span class="_ _1f"> </span>long<span class="_ _e"> </span>n)</div><div class="t m5 x17 h2d y4ea0 ffd fs1e fc2 sc0 ls0 ws0">{</div><div class="t m5 x1b6 h2d y4ea1 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>i;</div><div class="t m5 x1b6 h2d y4ea2 ffd fs1e fc2 sc0 ls0 ws0">double<span class="_ _e"> </span>x,<span class="_ _1f"> </span>y,<span class="_ _1f"> </span>z;</div><div class="t m5 x1b6 h2d y4ea3 ffd fs1e fc2 sc0 ls0 ws0">doubl<span class="ls33">er=1<span class="_ _41"></span>;</span></div><div class="t m5 x1b6 h2d y4ea4 ffd fs1e fc2 sc0 ls0 ws0">for<span class="_ _e"> </span>(i<span class="_ _1f"> </span>=<span class="_ _1f"> </span>0;<span class="_ _e"> </span>i<span class="_ _1f"> </span>&lt;<span class="_ _e"> </span>n-2;<span class="_ _1f"> </span>i+=<span class="_ _1f"> </span>3)<span class="_ _e"> </span>{</div><div class="t m5 x21e h2d y4ea5 ffd fs1e fc2 sc0 ls0 ws0">x<span class="_ _e"> </span>=<span class="_ _1f"> </span>a[i];<span class="_ _1f"> </span>y<span class="_ _e"> </span>=<span class="_ _1f"> </span>a[i+1];<span class="_ _e"> </span>z<span class="_ _1f"> </span>=<span class="_ _1f"> </span>a[i+2];</div><div class="t m5 x21e h2d y4ea6 ffd fs1e fc2 sc0 ls33 ws0">r=r*x*y*z<span class="_ _41"></span>;/<span class="_ _41"></span>*<span class="ls0">Product<span class="_ _e"> </span>computation<span class="_ _1f"> </span>*/</span></div><div class="t m5 x1b6 h2d y4ea7 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x1b6 h2d y4ea8 ffd fs1e fc2 sc0 ls33 ws0">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>;i&lt;n<span class="_ _41"></span>;<span class="ls0">i++)</span></div><div class="t m5 x21e h2d y4ea9 ffd fs1e fc2 sc0 ls0 ws0">r<span class="_ _e"> </span>*=<span class="_ _1f"> </span>a[i];</div><div class="t m5 x1b6 h2d y4eaa ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>r;</div><div class="t m5 x17 h2d y4eab ffd fs1e fc2 sc0 ls0 ws0">}</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
