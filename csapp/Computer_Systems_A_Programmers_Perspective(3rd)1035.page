<div id="pf40b" class="pf w2 h11" data-page-no="40b"><div class="pc pc40b w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg40b.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">1034<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>12<span class="_ _3d"> </span>Concurrent<span class="_ _10"> </span>Programming</span></div><div class="t m5 x1d2 h31 yb4e ff7 fs21 fc2 sc0 ls0 ws0">(a)<span class="_"> </span>Correct<span class="_"> </span>ordering</div><div class="t m5 x14 h31 y1bbd ff7 fs21 fc2 sc0 ls0 ws0">Step<span class="_ _3e"> </span>T<span class="_ _0"></span>hread<span class="_ _3e"> </span>Instr.<span class="_ _3e"> </span><span class="ffd fs1e">%rdx</span></div><div class="t m5 x66 h33 y8132 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x218 h2d y1bbd ffd fs1e fc2 sc0 ls0 ws0">%rdx</div><div class="t m5 x79 h33 y8132 ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 x9c h2d y1bbd ffd fs1e fc2 sc0 ls0 ws0">cnt</div><div class="t m5 x4a h31 yc98 ff7 fs21 fc2 sc0 ls2eb ws0">11<span class="_ _a"> </span><span class="ff11 ls0">H</span></div><div class="t m5 x155 h33 yc97 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x1c h31 yc98 ff7 fs21 fc2 sc0 ls2ec ws0">——<span class="_ _8"></span>0</div><div class="t m5 x4a h31 yc99 ff7 fs21 fc2 sc0 ls2eb ws0">21<span class="_ _6"> </span><span class="ff11 ls0">L</span></div><div class="t m5 xa2 h33 yc9a ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x203 h31 yc9b ff7 fs21 fc2 sc0 ls2ed ws0">0—<span class="_ _8a"></span>0</div><div class="t m5 x4a h31 yc9c ff7 fs21 fc2 sc0 ls2eb ws0">31<span class="_ _6"> </span><span class="ff11 ls0">U</span></div><div class="t m5 x155 h33 yc9d ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x203 h31 yc9e ff7 fs21 fc2 sc0 ls2ed ws0">1—<span class="_ _8a"></span>0</div><div class="t m5 x4a h31 yc9f ff7 fs21 fc2 sc0 ls2eb ws0">41<span class="_ _10"> </span><span class="ff11 ls0">S</span></div><div class="t m5 x1d h33 yca0 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x203 h31 y2254 ff7 fs21 fc2 sc0 ls2ed ws0">1—<span class="_ _8a"></span>1</div><div class="t m5 x4a h31 y64bd ff7 fs21 fc2 sc0 ls2eb ws0">52<span class="_ _be"></span><span class="ff11 ls0">H</span></div><div class="t m5 x155 h33 yca3 ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 x1c h31 yca4 ff7 fs21 fc2 sc0 ls2ec ws0">——<span class="_ _8"></span>1</div><div class="t m5 x4a h31 y64be ff7 fs21 fc2 sc0 ls2eb ws0">62<span class="_ _6"> </span><span class="ff11 ls0">L</span></div><div class="t m5 xa2 h33 y8133 ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 x1c h31 y1034 ff7 fs21 fc2 sc0 ls2ed ws0">—1<span class="_ _8"></span>1</div><div class="t m5 x4a h31 y64bf ff7 fs21 fc2 sc0 ls2eb ws0">72<span class="_ _a"> </span><span class="ff11 ls0">U</span></div><div class="t m5 xa2 h33 y8134 ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 x1c h31 y1036 ff7 fs21 fc2 sc0 ls2ed ws0">—2<span class="_ _8"></span>1</div><div class="t m5 x4a h31 y67a3 ff7 fs21 fc2 sc0 ls2eb ws0">82<span class="_ _13"> </span><span class="ff11 ls0">S</span></div><div class="t m5 x1d h33 y8135 ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 x1c h31 y67a5 ff7 fs21 fc2 sc0 ls2ed ws0">—2<span class="_ _8"></span>2</div><div class="t m5 x4a h31 y67a6 ff7 fs21 fc2 sc0 ls2eb ws0">92<span class="_ _13"> </span><span class="ff11 ls0">T</span></div><div class="t m5 x1d h33 y8136 ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 x1c h31 y23e0 ff7 fs21 fc2 sc0 ls2ed ws0">—2<span class="_ _8"></span>2</div><div class="t m5 x25d h31 y8137 ff7 fs21 fc2 sc0 ls0 ws0">10<span class="_ _11a"> </span>1<span class="_ _2c"> </span><span class="ff11">T</span></div><div class="t m5 x1d h33 y8138 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x203 h31 y67a9 ff7 fs21 fc2 sc0 ls2ed ws0">1—<span class="_ _8a"></span>2</div><div class="t m5 x194 h31 y8139 ff7 fs21 fc2 sc0 ls0 ws0">(b)<span class="_"> </span>Incorrect<span class="_"> </span>ordering</div><div class="t m5 xd5 h31 y813a ff7 fs21 fc2 sc0 ls0 ws0">Step<span class="_ _3e"> </span>T<span class="_ _0"></span>hread<span class="_ _3e"> </span>Instr.<span class="_ _3e"> </span><span class="ffd fs1e">%rdx</span></div><div class="t m5 x46 h33 y813b ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x221 h2d y813a ffd fs1e fc2 sc0 ls0 ws0">%rdx</div><div class="t m5 x174 h33 y813b ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 xbc h2d y813a ffd fs1e fc2 sc0 ls0 ws0">cnt</div><div class="t m5 x92 h31 y813c ff7 fs21 fc2 sc0 ls2eb ws0">11<span class="_ _a"> </span><span class="ff11 ls0">H</span></div><div class="t m5 x108 h33 y813d ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x1f0 h31 y813c ff7 fs21 fc2 sc0 ls2ec ws0">——<span class="_ _8"></span>0</div><div class="t m5 x92 h31 y813e ff7 fs21 fc2 sc0 ls2eb ws0">21<span class="_ _6"> </span><span class="ff11 ls0">L</span></div><div class="t m5 x100 h33 y813f ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x5f h31 y8140 ff7 fs21 fc2 sc0 ls2ed ws0">0—<span class="_ _8a"></span>0</div><div class="t m5 x92 h31 y8141 ff7 fs21 fc2 sc0 ls2eb ws0">31<span class="_ _6"> </span><span class="ff11 ls0">U</span></div><div class="t m5 x100 h33 y8142 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x5f h31 y8143 ff7 fs21 fc2 sc0 ls2ed ws0">1—<span class="_ _8a"></span>0</div><div class="t m5 x92 h31 y8144 ff7 fs21 fc2 sc0 ls2eb ws0">42<span class="_ _be"></span><span class="ff11 ls0">H</span></div><div class="t m5 x100 h33 y8145 ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 x1f0 h31 y8146 ff7 fs21 fc2 sc0 ls2ec ws0">——<span class="_ _8"></span>0</div><div class="t m5 x92 h31 y8147 ff7 fs21 fc2 sc0 ls2eb ws0">52<span class="_ _6"> </span><span class="ff11 ls0">L</span></div><div class="t m5 x204 h33 y8148 ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 x1f0 h31 y8149 ff7 fs21 fc2 sc0 ls2ee ws0">—0<span class="_ _8"></span>0</div><div class="t m5 x92 h31 y814a ff7 fs21 fc2 sc0 ls2eb ws0">61<span class="_ _10"> </span><span class="ff11 ls0">S</span></div><div class="t m5 x54 h33 y814b ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x5f h31 y814c ff7 fs21 fc2 sc0 ls2ed ws0">1—<span class="_ _8a"></span>1</div><div class="t m5 x92 h31 y814d ff7 fs21 fc2 sc0 ls2eb ws0">71<span class="_ _10"> </span><span class="ff11 ls0">T</span></div><div class="t m5 x54 h33 y814e ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x5f h31 y814f ff7 fs21 fc2 sc0 ls2ed ws0">1—<span class="_ _8a"></span>1</div><div class="t m5 x92 h31 y8150 ff7 fs21 fc2 sc0 ls2eb ws0">82<span class="_ _a"> </span><span class="ff11 ls0">U</span></div><div class="t m5 x100 h33 y8151 ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 x1f0 h31 y8152 ff7 fs21 fc2 sc0 ls2ee ws0">—1<span class="_ _8"></span>1</div><div class="t m5 x92 h31 y8153 ff7 fs21 fc2 sc0 ls2eb ws0">92<span class="_ _13"> </span><span class="ff11 ls0">S</span></div><div class="t m5 x54 h33 y8154 ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 x1f0 h31 y8155 ff7 fs21 fc2 sc0 ls2ee ws0">—1<span class="_ _8"></span>1</div><div class="t m5 x130 h31 y8156 ff7 fs21 fc2 sc0 ls0 ws0">10<span class="_ _11a"> </span>2<span class="_ _128"> </span><span class="ff11">T</span></div><div class="t m5 x54 h33 y8157 ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 x1f0 h31 y8158 ff7 fs21 fc2 sc0 ls2ee ws0">—1<span class="_ _8"></span>1</div><div class="t m5 x14 h3a y8159 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>12.18<span class="_ _66"> </span><span class="fc1">Instruction<span class="_"> </span>orderings<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>ﬁrst<span class="_"> </span>loop<span class="_"> </span>iteration<span class="_"> </span>in<span class="_"> </span><span class="ffd fs19">badcnt.c</span>.</span></div><div class="t m5 x29 h26 y815a ff7 fs19 fc1 sc0 ls0 ws0">Here<span class="_ _13"> </span>is<span class="_"> </span>the<span class="_ _13"> </span>crucial<span class="_"> </span>point:<span class="_ _13"> </span><span class="ffa">In<span class="_"> </span>general,<span class="_ _13"> </span>there<span class="_"> </span>is<span class="_ _13"> </span>no<span class="_"> </span>wa<span class="_ _1"></span>y<span class="_"> </span>for<span class="_ _13"> </span>you<span class="_"> </span>to<span class="_ _13"> </span>predict<span class="_"> </span>whether</span></div><div class="t m5 x1d h26 y815b ffa fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>operating<span class="_ _11"> </span>system<span class="_"> </span>will<span class="_ _11"> </span>choose<span class="_"> </span>a<span class="_"> </span>correct<span class="_ _11"> </span>ordering<span class="_"> </span>for<span class="_"> </span>your<span class="_ _11"> </span>threads<span class="_ _1"></span>.<span class="_ _13"> </span><span class="ff7">F<span class="_ _3"></span>or<span class="_ _11"> </span>example<span class="_ _0"></span>,</span></div><div class="t m5 x1d h26 y815c ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _13"> </span>12.18(a)<span class="_ _13"> </span>shows<span class="_ _13"> </span>the<span class="_ _13"> </span>step-by-step<span class="_ _6"> </span>operation<span class="_ _13"> </span>of<span class="_ _13"> </span>a<span class="_ _13"> </span>correct<span class="_ _13"> </span>instruction<span class="_ _6"> </span>ordering.</div><div class="t m5 x1d h26 y815d ff7 fs19 fc1 sc0 ls0 ws0">After<span class="_"> </span>each<span class="_ _11"> </span>thread<span class="_ _11"> </span>has<span class="_"> </span>updated<span class="_ _11"> </span>the<span class="_ _11"> </span>shared<span class="_ _11"> </span>variable<span class="_"> </span><span class="ffd">cnt</span>,<span class="_ _11"> </span>its<span class="_ _11"> </span>value<span class="_ _11"> </span>in<span class="_"> </span>memory<span class="_ _11"> </span>is<span class="_ _11"> </span>2,</div><div class="t m5 x1d h26 y815e ff7 fs19 fc1 sc0 ls0 ws0">which<span class="_"> </span>is<span class="_"> </span>the<span class="_"> </span>expected<span class="_"> </span>result.</div><div class="t m5 x29 h26 y815f ff7 fs19 fc1 sc0 ls0 ws0">On<span class="_ _6"> </span>the<span class="_ _6"> </span>other<span class="_ _6"> </span>hand,<span class="_ _13"> </span>the<span class="_ _6"> </span>ordering<span class="_ _6"> </span>in<span class="_ _6"> </span>Figure<span class="_ _a"> </span>12.18(b)<span class="_ _13"> </span>produces<span class="_ _a"> </span>an<span class="_ _6"> </span>incorrect<span class="_ _13"> </span>value</div><div class="t m5 x1d h26 y8160 ff7 fs19 fc1 sc0 ls0 ws0">for<span class="_ _11"> </span><span class="ffd">cnt</span>.<span class="_ _11"> </span>T<span class="_ _1"></span>he<span class="_ _11"> </span>problem<span class="_ _11"> </span>occurs<span class="_ _16"> </span>because<span class="_"> </span>thread<span class="_ _11"> </span>2<span class="_ _11"> </span>loads<span class="_ _11"> </span><span class="ffd">cnt<span class="_ _16"> </span></span>in<span class="_"> </span>step<span class="_ _11"> </span>5,<span class="_ _16"> </span>after<span class="_"> </span>thread<span class="_ _11"> </span>1</div><div class="t m5 x1d h26 y8161 ff7 fs19 fc1 sc0 ls0 ws0">loads<span class="_ _13"> </span><span class="ffd">cnt<span class="_ _6"> </span></span>in<span class="_ _13"> </span>step<span class="_ _6"> </span>2<span class="_ _13"> </span>but<span class="_ _13"> </span>before<span class="_ _6"> </span>thread<span class="_ _13"> </span>1<span class="_ _13"> </span>stores<span class="_ _6"> </span>its<span class="_ _13"> </span>updated<span class="_ _6"> </span>value<span class="_ _13"> </span>in<span class="_ _13"> </span>step<span class="_ _6"> </span>6.<span class="_ _13"> </span>T<span class="_ _1"></span>hus<span class="_ _1"></span>,<span class="_ _13"> </span>each</div><div class="t m5 x1d h26 y8162 ff7 fs19 fc1 sc0 ls0 ws0">thread<span class="_ _13"> </span>ends<span class="_ _13"> </span>up<span class="_ _13"> </span>storing<span class="_ _13"> </span>an<span class="_ _13"> </span>updated<span class="_ _13"> </span>counter<span class="_ _13"> </span>value<span class="_ _13"> </span>of<span class="_ _13"> </span>1.<span class="_ _13"> </span>W<span class="_ _3"></span>e<span class="_ _13"> </span>can<span class="_ _13"> </span>clarify<span class="_ _13"> </span>these<span class="_ _13"> </span>notions</div><div class="t m5 x1d h26 y8163 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span>correct<span class="_"> </span>and<span class="_ _11"> </span>incorrect<span class="_"> </span>instruction<span class="_ _11"> </span>orderings<span class="_"> </span>with<span class="_ _11"> </span>the<span class="_"> </span>help<span class="_ _11"> </span>of<span class="_"> </span>a<span class="_ _11"> </span>device<span class="_"> </span>known<span class="_"> </span>as</div><div class="t m5 x1d h26 y8164 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_"> </span><span class="ffa">progress<span class="_"> </span>graph</span>,<span class="_"> </span>which<span class="_"> </span>we<span class="_"> </span>introduce<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>next<span class="_"> </span>section.</div><div class="t m5 x1d h47 y8165 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>12.7<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>1073)</span></div><div class="t m5 x1d h26 y8166 ff7 fs19 fc1 sc0 ls0 ws0">Complete<span class="_"> </span>the<span class="_"> </span>table<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>instruction<span class="_"> </span>ordering<span class="_"> </span>of<span class="_"> </span><span class="ffd">badcnt.c</span>:</div><div class="t m5 x1d h31 y8167 ff7 fs21 fc2 sc0 ls0 ws0">Step<span class="_ _26"> </span>T<span class="_ _1"></span>hread<span class="_ _26"> </span>Instr.<span class="_ _58"> </span><span class="ffd fs1e">%rdx</span></div><div class="t m5 x187 h33 y8168 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x1b4 h2d y8167 ffd fs1e fc2 sc0 ls0 ws0">%rdx</div><div class="t m5 xb0 h33 y8168 ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 x1c3 h2d y8167 ffd fs1e fc2 sc0 ls0 ws0">cnt</div><div class="t m5 x75 h31 y8169 ff7 fs21 fc2 sc0 ls2ef ws0">11<span class="_ _a"> </span><span class="ff11 ls0">H</span></div><div class="t m5 x255 h33 y816a ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x87 h31 y8169 ff7 fs21 fc2 sc0 ls2f0 ws0">——<span class="_ _10"> </span>0</div><div class="t m5 x75 h31 y816b ff7 fs21 fc2 sc0 ls2ef ws0">21<span class="_ _6"> </span><span class="ff11 ls0">L</span></div><div class="t m5 x255 h33 y816c ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x75 h31 y816d ff7 fs21 fc1 sc0 ls2ef ws0">32<span class="_ _be"></span><span class="ff11 ls0">H</span></div><div class="t m5 x255 h33 y816e ff7 fs20 fc1 sc0 ls0 ws0">2</div><div class="t m5 x75 h31 y816f ff7 fs21 fc1 sc0 ls2ef ws0">42<span class="_ _6"> </span><span class="ff11 ls0">L</span></div><div class="t m5 x1b2 h33 y8170 ff7 fs20 fc1 sc0 ls0 ws0">2</div><div class="t m5 x75 h31 y8171 ff7 fs21 fc1 sc0 ls2ef ws0">52<span class="_ _a"> </span><span class="ff11 ls0">U</span></div><div class="t m5 x1b2 h33 y8172 ff7 fs20 fc1 sc0 ls0 ws0">2</div><div class="t m5 x75 h31 yc71 ff7 fs21 fc1 sc0 ls2ef ws0">62<span class="_ _13"> </span><span class="ff11 ls0">S</span></div><div class="t m5 xdc h33 y8173 ff7 fs20 fc1 sc0 ls0 ws0">2</div><div class="t m5 x75 h31 y8174 ff7 fs21 fc1 sc0 ls2ef ws0">71<span class="_ _6"> </span><span class="ff11 ls0">U</span></div><div class="t m5 x255 h33 y8175 ff7 fs20 fc1 sc0 ls0 ws0">1</div><div class="t m5 x1d h31 y8176 ff7 fs21 fc2 sc0 ls0 ws0">Step<span class="_ _26"> </span>T<span class="_ _1"></span>hread<span class="_ _26"> </span>Instr.<span class="_ _58"> </span><span class="ffd fs1e">%rdx</span></div><div class="t m5 x187 h33 y8177 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x1b4 h2d y8176 ffd fs1e fc2 sc0 ls0 ws0">%rdx</div><div class="t m5 xb0 h33 y8177 ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 x1c3 h2d y8176 ffd fs1e fc2 sc0 ls0 ws0">cnt</div><div class="t m5 x75 h31 y8178 ff7 fs21 fc2 sc0 ls2ef ws0">81<span class="_ _10"> </span><span class="ff11 ls0">S</span></div><div class="t m5 x1b2 h33 y8179 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x75 h31 y817a ff7 fs21 fc1 sc0 ls2ef ws0">91<span class="_ _10"> </span><span class="ff11 ls0">T</span></div><div class="t m5 x1b2 h33 y817b ff7 fs20 fc1 sc0 ls0 ws0">1</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
