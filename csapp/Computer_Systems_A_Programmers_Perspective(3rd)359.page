<div id="pf167" class="pf w2 h11" data-page-no="167"><div class="pc pc167 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg167.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">358<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x1d h73 ye7 ffe fs1e fc6 sc0 ls0 ws0">3.70<span class="_ _23"> </span><span class="ff10 fs19">◆◆◆</span></div><div class="t m5 x1d h26 y2a7 ff7 fs19 fc1 sc0 ls0 ws0">Consider<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>union<span class="_"> </span>declaration:</div><div class="t m5 x1f h2d y326d ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">union<span class="_ _1f"> </span>ele<span class="_ _e"> </span>{</span></div><div class="t m5 x1f h2d y326e ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _20"> </span><span class="ffd fs1e fc2">struct<span class="_ _e"> </span>{</span></div><div class="t m5 x1f h2d y326f ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _70"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>*p;</span></div><div class="t m5 x1f h2d y3270 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _70"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>y;</span></div><div class="t m5 x1f h2e y3271 ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x33 h2d y3272 ffd fs1e fc2 sc0 ls0 ws0">}<span class="_ _e"> </span>e1;</div><div class="t m5 x1f h2d y3273 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _20"> </span><span class="ffd fs1e fc2">struct<span class="_ _e"> </span>{</span></div><div class="t m5 x1f h2d y3274 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _70"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>x;</span></div><div class="t m5 x1f h2d y3275 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _70"> </span><span class="ffd fs1e fc2">union<span class="_ _e"> </span>ele<span class="_ _1f"> </span>*next;</span></div><div class="t m5 x1f h2d y3276 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _20"> </span><span class="ffd fs1e fc2">}<span class="_ _e"> </span>e2;</span></div><div class="t m5 x1b0 h2d y3277 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _1c"> </span><span class="ffd fs1e fc2">};</span></div><div class="t m5 x1d h26 y3278 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>declaration<span class="_"> </span>illustrates<span class="_"> </span>that<span class="_"> </span>structures<span class="_"> </span>can<span class="_"> </span>be<span class="_"> </span>embedded<span class="_"> </span>within<span class="_"> </span>unions<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y3279 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>following<span class="_ _13"> </span>function<span class="_"> </span>(with<span class="_ _13"> </span>some<span class="_"> </span>expressions<span class="_ _13"> </span>omitted)<span class="_"> </span>operates<span class="_ _13"> </span>on<span class="_"> </span>a<span class="_ _13"> </span>linked</div><div class="t m5 x1d h26 y327a ff7 fs19 fc2 sc0 ls0 ws0">list<span class="_"> </span>having<span class="_"> </span>these<span class="_"> </span>unions<span class="_"> </span>as<span class="_"> </span>list<span class="_"> </span>elements:</div><div class="t m5 x1f h2d y327b ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">void<span class="_ _1f"> </span>proc<span class="_ _e"> </span>(union<span class="_ _1f"> </span>ele<span class="_ _1f"> </span>*up)<span class="_ _e"> </span>{</span></div><div class="t m5 x1f h2d y327c ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _20"> </span><span class="ffd fs1e fc2">up-&gt;<span class="_ _86"> </span><span class="ls33">=*<span class="_ _41"></span>(<span class="_ _71"> </span>)-<span class="_ _82"> </span><span class="ls0">;</span></span></span></div><div class="t m5 x1f h2d y327d ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x124 h26 y2a05 ff7 fs19 fc2 sc0 ls0 ws0">A.<span class="_ _1f"> </span>What<span class="_"> </span>are<span class="_"> </span>the<span class="_"> </span>offsets<span class="_"> </span>(in<span class="_"> </span>bytes)<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>ﬁelds:</div><div class="t m5 x4f h2d y327e ffd fs1e fc2 sc0 ls0 ws0">e1.p</div><div class="t m5 x4f h2d y327f ffd fs1e fc1 sc0 ls0 ws0">e1.y</div><div class="t m5 x4f h2d y3280 ffd fs1e fc1 sc0 ls0 ws0">e2.x</div><div class="t m5 x4f h2d y3281 ffd fs1e fc1 sc0 ls0 ws0">e2.next</div><div class="t m5 x124 h26 y3282 ff7 fs19 fc1 sc0 ls0 ws0">B<span class="_ _3"></span>.<span class="_ _1d"> </span>How<span class="_"> </span>many<span class="_"> </span>total<span class="_"> </span>bytes<span class="_"> </span>does<span class="_"> </span>the<span class="_"> </span>structure<span class="_"> </span>require?</div><div class="t m5 x124 h26 y3283 ff7 fs19 fc1 sc0 ls0 ws0">C.<span class="_ _25"> </span>T<span class="_ _1"></span>he<span class="_"> </span>compiler<span class="_"> </span>generates<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>assembly<span class="_"> </span>code<span class="_"> </span>for<span class="_"> </span><span class="ffd">proc</span>:</div><div class="t m5 x1a8 h61 y3284 ff13 fs35 fc6 sc0 ls0 ws0">void<span class="_ _f"> </span>proc<span class="_ _f"> </span>(union<span class="_ _f"> </span>ele<span class="_ _e"> </span>*up)</div><div class="t m5 x1a8 h61 y3285 ff13 fs35 fc6 sc0 ls0 ws0">up<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi</div><div class="t m5 x207 h2e y3286 ff6 fs20 fc6 sc0 ls0 ws0">1</div><div class="t m5 xe0 h2d y3287 ffd fs1e fc2 sc0 ls0 ws0">proc:</div><div class="t m5 x207 h2d y3288 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>8(%rdi),<span class="_ _e"> </span>%rax</span></div><div class="t m5 x207 h2d y3289 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>(%rax),<span class="_ _e"> </span>%rdx</span></div><div class="t m5 x207 h2d y328a ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>(%rdx),<span class="_ _e"> </span>%rdx</span></div><div class="t m5 x207 h2d y328b ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">subq<span class="_ _46"> </span>8(%rax),<span class="_ _e"> </span>%rdx</span></div><div class="t m5 x207 h2e y328c ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 x112 h2d y328d ffd fs1e fc2 sc0 ls0 ws0">movq<span class="_ _46"> </span>%rdx,<span class="_ _e"> </span>(%rdi)</div><div class="t m5 x207 h2d y328e ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">ret</span></div><div class="t m5 x4f h26 y8d6 ff7 fs19 fc2 sc0 ls0 ws0">On<span class="_ _11"> </span>the<span class="_ _16"> </span>basis<span class="_ _11"> </span>of<span class="_ _11"> </span>this<span class="_ _16"> </span>information,<span class="_ _16"> </span>ﬁll<span class="_ _11"> </span>in<span class="_ _11"> </span>the<span class="_ _16"> </span>missing<span class="_ _11"> </span>expressions<span class="_ _16"> </span>in<span class="_ _11"> </span>the<span class="_ _11"> </span>code</div><div class="t m5 x4f h26 y8d7 ff7 fs19 fc2 sc0 ls0 ws0">for<span class="_"> </span><span class="ffd">proc</span>.<span class="_"> </span><span class="ffa">Hint:<span class="_"> </span></span>Some<span class="_"> </span>union<span class="_"> </span>references<span class="_"> </span>can<span class="_ _13"> </span>have<span class="_"> </span>ambiguous<span class="_"> </span>interpretations<span class="_ _1"></span>.</div><div class="t m5 x4f h26 y8d8 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>hese<span class="_"> </span>ambiguities<span class="_"> </span>get<span class="_"> </span>resolved<span class="_"> </span>as<span class="_"> </span>you<span class="_"> </span>see<span class="_"> </span>where<span class="_"> </span>the<span class="_"> </span>references<span class="_"> </span>lead.<span class="_"> </span>T<span class="_ _1"></span>here</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
