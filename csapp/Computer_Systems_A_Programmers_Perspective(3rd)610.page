<div id="pf262" class="pf w2 h11" data-page-no="262"><div class="pc pc262 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg262.png"/><div class="t m5 x107 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Solutions<span class="_ _10"> </span>to<span class="_ _10"> </span>Practice<span class="_ _10"> </span>Problems<span class="_ _1b"> </span><span class="ffe fs1e">609</span></div><div class="t m5 x17 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">faster<span class="_ _6"> </span>versions<span class="_ _6"> </span>of<span class="_ _6"> </span>the<span class="_ _6"> </span>function<span class="_ _6"> </span>using<span class="_ _13"> </span>the<span class="_ _a"> </span>optimization<span class="_ _6"> </span>techniques<span class="_ _6"> </span>we<span class="_ _6"> </span>have<span class="_ _6"> </span>explored,</div><div class="t m5 x17 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">including<span class="_ _16"> </span>loop<span class="_ _11"> </span>unrolling,<span class="_ _16"> </span>parallel<span class="_ _16"> </span>accumulation,<span class="_ _16"> </span>and<span class="_ _11"> </span>reassociation.<span class="_ _16"> </span>Y<span class="_ _3"></span>ou<span class="_ _11"> </span>will<span class="_ _16"> </span>ﬁnd</div><div class="t m5 x17 h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">many<span class="_ _16"> </span>different<span class="_ _16"> </span>ways<span class="_ _14"> </span>of<span class="_ _16"> </span>mixing<span class="_ _16"> </span>together<span class="_ _14"> </span>Horner’s<span class="_ _16"> </span>scheme<span class="_ _16"> </span>and<span class="_ _16"> </span>direct<span class="_ _14"> </span>evaluation</div><div class="t m5 x17 h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">with<span class="_"> </span>these<span class="_"> </span>optimization<span class="_"> </span>techniques<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y2f8 ff7 fs19 fc2 sc0 ls0 ws0">Ideally<span class="_ _3"></span>,<span class="_ _16"> </span>you<span class="_ _16"> </span>should<span class="_ _16"> </span>be<span class="_ _16"> </span>able<span class="_ _16"> </span>to<span class="_ _16"> </span>reach<span class="_ _16"> </span>a<span class="_ _16"> </span>CPE<span class="_ _11"> </span>close<span class="_ _16"> </span>to<span class="_ _16"> </span>the<span class="_ _16"> </span>throughput<span class="_ _16"> </span>limit<span class="_ _16"> </span>of</div><div class="t m5 x17 h26 y2f9 ff7 fs19 fc2 sc0 ls0 ws0">your<span class="_ _13"> </span>machine<span class="_ _0"></span>.<span class="_ _13"> </span>Our<span class="_ _13"> </span>best<span class="_"> </span>version<span class="_ _13"> </span>achieves<span class="_ _13"> </span>a<span class="_ _13"> </span>CPE<span class="_ _13"> </span>of<span class="_"> </span>1.07<span class="_ _13"> </span>on<span class="_ _13"> </span>our<span class="_ _13"> </span>reference<span class="_ _13"> </span>machine.</div><div class="t m5 x17 h73 y5197 ffe fs1e fc6 sc0 ls0 ws0">5.19<span class="_ _23"> </span><span class="ff10 fs19">◆◆◆</span></div><div class="t m5 x17 h26 y5198 ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _13"> </span>Problem<span class="_"> </span>5.12,<span class="_"> </span>we<span class="_ _13"> </span>were<span class="_ _13"> </span>able<span class="_"> </span>to<span class="_ _13"> </span>reduce<span class="_"> </span>the<span class="_ _13"> </span>CPE<span class="_"> </span>for<span class="_ _13"> </span>the<span class="_"> </span>preﬁx-sum<span class="_ _13"> </span>computation</div><div class="t m5 x17 h26 y5199 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _11"> </span>3.00,<span class="_ _11"> </span>limited<span class="_ _11"> </span>by<span class="_ _16"> </span>the<span class="_"> </span>latency<span class="_ _11"> </span>of<span class="_ _11"> </span>ﬂoating-point<span class="_ _11"> </span>addition<span class="_ _11"> </span>on<span class="_ _11"> </span>this<span class="_ _16"> </span>machine<span class="_ _1"></span>.<span class="_ _11"> </span>Simple</div><div class="t m5 x17 h26 y519a ff7 fs19 fc1 sc0 ls0 ws0">loop<span class="_"> </span>unrolling<span class="_"> </span>does<span class="_"> </span>not<span class="_"> </span>improve<span class="_"> </span>things<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y519b ff7 fs19 fc1 sc0 ls0 ws0">Using<span class="_ _15"> </span>a<span class="_ _15"> </span>combination<span class="_ _15"> </span>of<span class="_ _14"> </span>loop<span class="_ _15"> </span>unrolling<span class="_ _15"> </span>and<span class="_ _15"> </span>reassociation,<span class="_ _21"> </span>write<span class="_ _15"> </span>code<span class="_ _15"> </span>for<span class="_ _15"> </span>a</div><div class="t m5 x17 h26 y519c ff7 fs19 fc1 sc0 ls0 ws0">preﬁx<span class="_ _14"> </span>sum<span class="_ _14"> </span>that<span class="_ _14"> </span>achieves<span class="_ _14"> </span>a<span class="_ _15"> </span>CPE<span class="_ _14"> </span>less<span class="_ _14"> </span>than<span class="_ _14"> </span>the<span class="_ _14"> </span>latency<span class="_ _14"> </span>of<span class="_ _14"> </span>ﬂoating-point<span class="_ _14"> </span>addition</div><div class="t m5 x17 h26 y519d ff7 fs19 fc1 sc0 ls0 ws0">on<span class="_"> </span>your<span class="_ _13"> </span>machine<span class="_ _0"></span>.<span class="_"> </span>Doing<span class="_ _13"> </span>this<span class="_"> </span>requires<span class="_ _13"> </span>actually<span class="_"> </span>increasing<span class="_ _13"> </span>the<span class="_"> </span>number<span class="_"> </span>of<span class="_ _13"> </span>additions</div><div class="t m5 x17 h26 y519e ff7 fs19 fc1 sc0 ls0 ws0">performed.<span class="_ _16"> </span>F<span class="_ _1"></span>or<span class="_ _16"> </span>example<span class="_ _1"></span>,<span class="_ _14"> </span>our<span class="_ _16"> </span>version<span class="_ _16"> </span>with<span class="_ _16"> </span>two-way<span class="_ _16"> </span>unrolling<span class="_ _16"> </span>requires<span class="_ _16"> </span>three<span class="_ _16"> </span>ad-</div><div class="t m5 x17 h26 y519f ff7 fs19 fc1 sc0 ls0 ws0">ditions<span class="_"> </span>per<span class="_"> </span>iteration,<span class="_"> </span>while<span class="_ _13"> </span>our<span class="_"> </span>version<span class="_"> </span>with<span class="_"> </span>four<span class="_ _1"></span>-way<span class="_"> </span>unrolling<span class="_"> </span>requires<span class="_ _13"> </span>ﬁve.<span class="_"> </span>Our</div><div class="t m5 x17 h26 y51a0 ff7 fs19 fc1 sc0 ls0 ws0">best<span class="_"> </span>implementation<span class="_"> </span>achieves<span class="_"> </span>a<span class="_"> </span>CPE<span class="_"> </span>of<span class="_"> </span>1.67<span class="_"> </span>on<span class="_"> </span>our<span class="_"> </span>reference<span class="_"> </span>machine<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y51a1 ff7 fs19 fc1 sc0 ls0 ws0">Determine<span class="_ _11"> </span>how<span class="_ _11"> </span>the<span class="_ _11"> </span>throughput<span class="_ _16"> </span>and<span class="_ _11"> </span>latency<span class="_"> </span>limits<span class="_ _11"> </span>of<span class="_ _16"> </span>your<span class="_ _11"> </span>machine<span class="_ _11"> </span>limit<span class="_ _11"> </span>the</div><div class="t m5 x17 h26 y51a2 ff7 fs19 fc1 sc0 ls0 ws0">minimum<span class="_"> </span>CPE<span class="_"> </span>you<span class="_"> </span>can<span class="_"> </span>achieve<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>preﬁx-sum<span class="_"> </span>operation.</div><div class="t m5 x17 h29 y51a3 ffe fs14 fc1 sc0 ls0 ws0">Solutions<span class="_"> </span>to<span class="_"> </span>Practice<span class="_"> </span>Problems</div><div class="t m5 x17 h28 y51a4 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>5.1<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>536)</span></div><div class="t m5 x17 h26 y51a5 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>problem<span class="_"> </span>illustrates<span class="_"> </span>some<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>subtle<span class="_"> </span>effects<span class="_"> </span>of<span class="_"> </span>memory<span class="_"> </span>aliasing.</div><div class="t m5 x26 h26 y51a6 ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_"> </span>the<span class="_ _13"> </span>following<span class="_"> </span>commented<span class="_ _13"> </span>code<span class="_"> </span>shows<span class="_ _1"></span>,<span class="_"> </span>the<span class="_ _13"> </span>effect<span class="_"> </span>will<span class="_"> </span>be<span class="_ _13"> </span>to<span class="_"> </span>set<span class="_"> </span>the<span class="_ _13"> </span>value<span class="_"> </span>at</div><div class="t m5 x17 h26 y51a7 ffd fs19 fc1 sc0 ls0 ws0">xp<span class="_ _10"> </span><span class="ff7">to<span class="_"> </span>zero:</span></div><div class="t m5 x2c h2d y51a8 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2">*xp<span class="_ _e"> </span>=<span class="_ _1f"> </span>*xp<span class="_ _1f"> </span>+<span class="_ _e"> </span>*xp;<span class="_ _1f"> </span>/*<span class="_ _e"> </span>2x<span class="_ _1f"> </span>*/</span></div><div class="t m5 x2c h2d y51a9 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _20"> </span><span class="ffd fs1e fc2">*xp<span class="_ _e"> </span>=<span class="_ _1f"> </span>*xp<span class="_ _1f"> </span>-<span class="_ _e"> </span>*xp;<span class="_ _1f"> </span>/*<span class="_ _e"> </span>2x-2<span class="ls33">x=0*<span class="_ _41"></span>/</span></span></div><div class="t m5 x2c h2d y51aa ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _20"> </span><span class="ffd fs1e fc2">*xp<span class="_ _e"> </span>=<span class="_ _1f"> </span>*xp<span class="_ _1f"> </span>-<span class="_ _e"> </span>*xp;<span class="_ _1f"> </span>/*<span class="_ _e"> </span>0-<span class="ls33">0=0*<span class="_ _41"></span>/</span></span></div><div class="t m5 x26 h26 y51ab ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>example<span class="_"> </span>illustrates<span class="_"> </span>that<span class="_"> </span>our<span class="_"> </span>intuition<span class="_"> </span>about<span class="_"> </span>program<span class="_"> </span>behavior<span class="_"> </span>can<span class="_"> </span>often</div><div class="t m5 x17 h26 y51ac ff7 fs19 fc2 sc0 ls0 ws0">be<span class="_ _13"> </span>wrong<span class="_ _0"></span>.<span class="_ _13"> </span>W<span class="_ _3"></span>e<span class="_ _13"> </span>naturally<span class="_ _6"> </span>think<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>case<span class="_ _6"> </span>where<span class="_ _13"> </span><span class="ffd">xp<span class="_ _13"> </span></span>and<span class="_ _13"> </span><span class="ffd">yp<span class="_ _6"> </span></span>are<span class="_ _13"> </span>distinct<span class="_ _13"> </span>but<span class="_ _13"> </span>overlook</div><div class="t m5 x17 h26 y51ad ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _16"> </span>possibility<span class="_ _14"> </span>that<span class="_ _16"> </span>they<span class="_ _14"> </span>might<span class="_ _16"> </span>be<span class="_ _14"> </span>equal.<span class="_ _14"> </span>Bugs<span class="_ _16"> </span>often<span class="_ _14"> </span>arise<span class="_ _16"> </span>due<span class="_ _14"> </span>to<span class="_ _16"> </span>conditions<span class="_ _14"> </span>the</div><div class="t m5 x17 h26 y51ae ff7 fs19 fc2 sc0 ls0 ws0">programmer<span class="_"> </span>does<span class="_"> </span>not<span class="_"> </span>anticipate<span class="_ _1"></span>.</div><div class="t m5 x17 h28 y51af ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>5.2<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>540)</span></div><div class="t m5 x17 h26 y51b0 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _13"> </span>problem<span class="_ _13"> </span>illustrates<span class="_ _13"> </span>the<span class="_ _13"> </span>relationship<span class="_ _13"> </span>between<span class="_ _6"> </span>CPE<span class="_ _13"> </span>and<span class="_ _13"> </span>absolute<span class="_ _13"> </span>performance<span class="_ _1"></span>.</div><div class="t m5 x17 h46 y51b1 ff7 fs19 fc1 sc0 ls0 ws0">It<span class="_"> </span>can<span class="_"> </span>be<span class="_"> </span>solved<span class="_"> </span>using<span class="_"> </span>elementary<span class="_"> </span>algebra.<span class="_"> </span>W<span class="_ _1"></span>e<span class="_"> </span>ﬁnd<span class="_"> </span>that<span class="_"> </span>for<span class="_"> </span><span class="ff11">n<span class="_ _10"> </span><span class="ff12">≤<span class="_ _13"></span></span></span>2,<span class="_"> </span>version<span class="_"> </span>1<span class="_"> </span>is<span class="_"> </span>the</div><div class="t m5 x17 h46 y51b2 ff7 fs19 fc1 sc0 ls0 ws0">fastest.<span class="_"> </span>V<span class="_ _3"></span>ersion<span class="_"> </span>2<span class="_"> </span>is<span class="_"> </span>fastest<span class="_"> </span>for<span class="_"> </span>3<span class="_ _13"> </span><span class="ff12">≤<span class="_ _13"></span><span class="ff11">n<span class="_ _10"> </span></span>≤<span class="_ _13"></span></span><span class="ls132">7,<span class="_"> </span>and<span class="_"> </span>version<span class="_"> </span>3<span class="_"> </span>is<span class="_"> </span>fastest<span class="_"> </span>for<span class="_"> </span></span><span class="ff11">n<span class="_ _10"> </span><span class="ff12">≥<span class="_ _13"> </span></span></span><span class="ls63">8.</span></div><div class="t m5 x17 h28 y51b3 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>5.3<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>548)</span></div><div class="t m5 x17 h26 y20a6 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>is<span class="_"> </span>a<span class="_"> </span>simple<span class="_"> </span>exercise,<span class="_"> </span>but<span class="_"> </span>it<span class="_"> </span>is<span class="_"> </span>important<span class="_"> </span>to<span class="_"> </span>recognize<span class="_"> </span>that<span class="_"> </span>the<span class="_"> </span>four<span class="_"> </span>statements</div><div class="t m5 x17 h26 y5195 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span>a<span class="_"> </span><span class="ffd">for<span class="_ _10"> </span></span>loop—initial,<span class="_"> </span>test,<span class="_ _13"> </span>update,<span class="_"> </span>and<span class="_ _13"> </span>body—get<span class="_"> </span>executed<span class="_"> </span>different<span class="_"> </span>numbers<span class="_"> </span>of</div><div class="t m5 x17 h26 y5196 ff7 fs19 fc1 sc0 ls0 ws0">times<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
