<div id="pf3b7" class="pf w2 h11" data-page-no="3b7"><div class="pc pc3b7 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg3b7.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">950<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>10<span class="_ _3d"> </span>System-Level<span class="_ _10"> </span>I/O</span></div><div class="t m5 x1d h26 y9c ff7 fs19 fc2 sc0 ls0 ws0">simpler,<span class="_ _16"> </span>preferred<span class="_ _16"> </span>alternative<span class="_ _16"> </span>to<span class="_ _11"> </span>Unix<span class="_ _16"> </span>I/O<span class="_ _1"></span>.<span class="_ _16"> </span>However,<span class="_ _16"> </span>because<span class="_ _16"> </span>of<span class="_ _16"> </span>some<span class="_ _16"> </span>mutually</div><div class="t m5 x1d h26 y409 ff7 fs19 fc2 sc0 ls0 ws0">incompatible<span class="_ _13"> </span>restrictions<span class="_ _13"> </span>on<span class="_ _13"> </span>standard<span class="_"> </span>I/O<span class="_ _13"> </span>and<span class="_ _13"> </span>network<span class="_ _13"> </span>ﬁles<span class="_ _1"></span>,<span class="_"> </span>Unix<span class="_ _13"> </span>I/O<span class="_ _3"></span>,<span class="_ _13"> </span>rather<span class="_ _13"> </span>than</div><div class="t m5 x1d h26 y40a ff7 fs19 fc2 sc0 ls0 ws0">standard<span class="_"> </span>I/O<span class="_ _3"></span>,<span class="_"> </span>should<span class="_"> </span>be<span class="_"> </span>used<span class="_"> </span>for<span class="_"> </span>network<span class="_"> </span>applications<span class="_ _1"></span>.</div><div class="t m5 x1d h29 y7970 ffe fs14 fc2 sc0 ls0 ws0">Bibliographic<span class="_"> </span>Notes</div><div class="t m5 x1d h26 y7971 ff7 fs19 fc2 sc0 ls0 ws0">Kerrisk<span class="_ _21"> </span>gives<span class="_ _21"> </span>a<span class="_ _f"> </span>comprehensive<span class="_ _21"> </span>treatment<span class="_ _f"> </span>of<span class="_ _21"> </span>Unix<span class="_ _f"> </span>I/O<span class="_ _f"> </span>and<span class="_ _21"> </span>the<span class="_ _f"> </span>Linux<span class="_ _21"> </span>ﬁle<span class="_ _f"> </span>sys-</div><div class="t m5 x1d h26 y7972 ff7 fs19 fc2 sc0 ls0 ws0">tem<span class="_ _16"> </span>[62].<span class="_ _16"> </span>Stevens<span class="_ _16"> </span>wrote<span class="_ _16"> </span>the<span class="_ _11"> </span>original<span class="_ _16"> </span>standard<span class="_ _16"> </span>reference<span class="_ _16"> </span>text<span class="_ _16"> </span>for<span class="_ _16"> </span>Unix<span class="_ _16"> </span>I/O<span class="_ _16"> </span>[111].</div><div class="t m5 x1d h26 y7973 ff7 fs19 fc2 sc0 ls0 ws0">Kernighan<span class="_ _11"> </span>and<span class="_ _11"> </span>Ritchie<span class="_ _16"> </span>give<span class="_ _11"> </span>a<span class="_ _11"> </span>clear<span class="_ _16"> </span>and<span class="_ _11"> </span>complete<span class="_ _11"> </span>discussion<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>standard<span class="_ _16"> </span>I/O</div><div class="t m5 x1d h26 y7974 ff7 fs19 fc2 sc0 ls0 ws0">functions<span class="_"> </span>[61].</div><div class="t m5 x1d h29 y7975 ffe fs14 fc2 sc0 ls0 ws0">Homework<span class="_"> </span>Problems</div><div class="t m5 x1d h73 y7976 ffe fs1e fc6 sc0 ls0 ws0">10.6<span class="_ _23"> </span><span class="ff10 fs19">◆</span></div><div class="t m5 x1d h26 y7977 ff7 fs19 fc1 sc0 ls0 ws0">What<span class="_"> </span>is<span class="_"> </span>the<span class="_"> </span>output<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>program?</div><div class="t m5 x1f h2d y7978 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">#include<span class="_ _1f"> </span>&quot;csapp.h&quot;</span></div><div class="t m5 x1f h2e y7979 ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x1f h2e y797a ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x4f h2d y797b ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>main()</div><div class="t m5 x1f h2d y797c ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x1f h2d y797d ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _20"> </span><span class="ffd fs1e fc2">int<span class="_ _e"> </span>fd1,<span class="_ _1f"> </span>fd2;</span></div><div class="t m5 x1f h2e y797e ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 x1f h2e y797f ff6 fs20 fc6 sc0 ls0 ws0">7</div><div class="t m5 x33 h2d y7980 ffd fs1e fc2 sc0 ls0 ws0">fd1<span class="_ _e"> </span>=<span class="_ _1f"> </span>Open(&quot;foo.txt&quot;,<span class="_ _1f"> </span>O_RDONLY,<span class="_ _e"> </span>0);</div><div class="t m5 x1f h2d y7981 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _20"> </span><span class="ffd fs1e fc2">fd2<span class="_ _e"> </span>=<span class="_ _1f"> </span>Open(&quot;bar.txt&quot;,<span class="_ _1f"> </span>O_RDONLY,<span class="_ _e"> </span>0);</span></div><div class="t m5 x1f h2d y7982 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _20"> </span><span class="ffd fs1e fc2">Close(fd2);</span></div><div class="t m5 x1b0 h2d y7983 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _20"> </span><span class="ffd fs1e fc2">fd2<span class="_ _e"> </span>=<span class="_ _1f"> </span>Open(&quot;baz.txt&quot;,<span class="_ _1f"> </span>O_RDONLY,<span class="_ _e"> </span>0);</span></div><div class="t m5 x1b0 h2d y7984 ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _20"> </span><span class="ffd fs1e fc2">printf(&quot;fd2<span class="_ _e"> </span>=<span class="_ _1f"> </span>%d\n&quot;,<span class="_ _1f"> </span>fd2);</span></div><div class="t m5 x1b0 h2d y7985 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _20"> </span><span class="ffd fs1e fc2">exit(0);</span></div><div class="t m5 x1b0 h2d y7986 ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1d h28 y7987 ffe fs1e fc6 sc0 ls0 ws0">10.7</div><div class="t m5 xc4 h73 y7988 ff10 fs19 fc6 sc0 ls0 ws0">◆</div><div class="t m5 x1d h26 y7989 ff7 fs19 fc1 sc0 ls0 ws0">Modify<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ffd">cpfile<span class="_ _13"> </span></span>program<span class="_ _13"> </span>in<span class="_ _13"> </span>F<span class="_ _1"></span>igure<span class="_ _13"> </span>10.5<span class="_ _13"> </span>so<span class="_ _13"> </span>that<span class="_ _13"> </span>it<span class="_ _6"> </span>uses<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ff9">Rio<span class="_ _13"> </span></span>functions<span class="_ _13"> </span>to<span class="_ _13"> </span>copy</div><div class="t m5 x1d h26 y798a ff7 fs19 fc1 sc0 ls0 ws0">standard<span class="_"> </span>input<span class="_"> </span>to<span class="_"> </span>standard<span class="_"> </span>output,<span class="_"> </span>MAXBUF<span class="_"> </span>bytes<span class="_"> </span>at<span class="_"> </span>a<span class="_"> </span>time<span class="_ _1"></span>.</div><div class="t m5 x1d h73 y798b ffe fs1e fc6 sc0 ls0 ws0">10.8<span class="_ _23"> </span><span class="ff10 fs19">◆◆</span></div><div class="t m5 x1d h26 y798c ff7 fs19 fc1 sc0 ls0 ws0">Write<span class="_ _16"> </span>a<span class="_ _14"> </span>version<span class="_ _14"> </span>of<span class="_ _16"> </span>the<span class="_ _14"> </span><span class="ffd">statcheck<span class="_ _14"> </span></span>program<span class="_ _14"> </span>in<span class="_ _16"> </span>Figure<span class="_ _16"> </span>10.10,<span class="_ _14"> </span>called<span class="_ _14"> </span><span class="ffd">fstatcheck</span>,</div><div class="t m5 x1d h26 y798d ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_"> </span>takes<span class="_"> </span>a<span class="_"> </span>descriptor<span class="_"> </span>number<span class="_"> </span>on<span class="_"> </span>the<span class="_"> </span>command<span class="_"> </span>line<span class="_"> </span>rather<span class="_"> </span>than<span class="_"> </span>a<span class="_"> </span>ﬁlename<span class="_ _1"></span>.</div><div class="t m5 x1d h73 y798e ffe fs1e fc6 sc0 ls0 ws0">10.9<span class="_ _23"> </span><span class="ff10 fs19">◆◆</span></div><div class="t m5 x1d h26 y798f ff7 fs19 fc1 sc0 ls0 ws0">Consider<span class="_ _13"> </span>the<span class="_ _6"> </span>following<span class="_ _13"> </span>invocation<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _6"> </span><span class="ffd">fstatcheck<span class="_ _13"> </span></span>program<span class="_ _6"> </span>from<span class="_ _13"> </span>Problem<span class="_ _6"> </span>10.8:</div><div class="t m5 x1d h2d y7990 ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">fstatcheck<span class="_ _1f"> </span>3<span class="_ _1f"> </span>&lt;<span class="_ _e"> </span>foo.txt</span></div><div class="t m5 x1d h26 y543 ff7 fs19 fc2 sc0 ls0 ws0">Y<span class="_ _3"></span>ou<span class="_ _15"> </span>might<span class="_ _15"> </span>expect<span class="_ _15"> </span>that<span class="_ _15"> </span>this<span class="_ _21"> </span>invocation<span class="_ _15"> </span>of<span class="_ _15"> </span><span class="ffd">fstatcheck<span class="_ _15"> </span></span>would<span class="_ _21"> </span>fetch<span class="_ _15"> </span>and<span class="_ _15"> </span>display</div><div class="t m5 x1d h26 y544 ff7 fs19 fc2 sc0 ls0 ws0">metadata<span class="_ _11"> </span>for<span class="_ _16"> </span>ﬁle<span class="_ _16"> </span><span class="ffd">foo.txt</span>.<span class="_ _11"> </span>However,<span class="_ _16"> </span>when<span class="_ _11"> </span>we<span class="_ _16"> </span>run<span class="_ _16"> </span>it<span class="_ _11"> </span>on<span class="_ _16"> </span>our<span class="_ _11"> </span>system,<span class="_ _16"> </span>it<span class="_ _16"> </span>fails<span class="_ _16"> </span>with</div><div class="t m5 x1d h26 y545 ff7 fs19 fc2 sc0 ls0 ws0">a<span class="_ _11"> </span>“bad<span class="_ _16"> </span>ﬁle<span class="_ _16"> </span>descriptor<span class="_ _0"></span>.<span class="_ _1"></span>”<span class="_ _11"> </span>Given<span class="_ _16"> </span>this<span class="_ _16"> </span>behavior<span class="_ _0"></span>,<span class="_ _16"> </span>ﬁll<span class="_ _11"> </span>in<span class="_ _16"> </span>the<span class="_ _11"> </span>pseudocode<span class="_ _16"> </span>that<span class="_ _16"> </span>the<span class="_ _11"> </span>shell</div><div class="t m5 x1d h26 y546 ff7 fs19 fc2 sc0 ls0 ws0">must<span class="_"> </span>be<span class="_"> </span>executing<span class="_"> </span>between<span class="_"> </span>the<span class="_"> </span><span class="ffd">fork<span class="_ _10"> </span></span>and<span class="_"> </span><span class="ffd">execve<span class="_ _10"> </span></span>calls:</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
