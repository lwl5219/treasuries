<div id="pf114" class="pf w2 h11" data-page-no="114"><div class="pc pc114 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg114.png"/><div class="t m5 xb5 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>3.7<span class="_ _60"> </span>Procedures<span class="_ _3e"> </span><span class="ffe fs1e">275</span></div><div class="t m5 x17 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">in<span class="_ _11"> </span>different<span class="_ _11"> </span>programming<span class="_ _11"> </span>languages—functions<span class="_ _0"></span>,<span class="_ _11"> </span>methods<span class="_ _1"></span>,<span class="_ _16"> </span>subroutines<span class="_ _1"></span>,<span class="_ _11"> </span>handlers<span class="_ _1"></span>,</div><div class="t m5 x17 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_"> </span>so<span class="_"> </span>on—but<span class="_"> </span>they<span class="_"> </span>all<span class="_"> </span>share<span class="_"> </span>a<span class="_"> </span>general<span class="_"> </span>set<span class="_"> </span>of<span class="_"> </span>features<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>here<span class="_ _15"> </span>are<span class="_ _21"> </span>many<span class="_ _15"> </span>different<span class="_ _15"> </span>attributes<span class="_ _21"> </span>that<span class="_ _15"> </span>must<span class="_ _15"> </span>be<span class="_ _15"> </span>handled<span class="_ _21"> </span>when<span class="_ _15"> </span>providing</div><div class="t m5 x17 h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">machine-level<span class="_ _14"> </span>support<span class="_ _14"> </span>for<span class="_ _14"> </span>procedures<span class="_ _1"></span>.<span class="_ _15"> </span>F<span class="_ _1"></span>or<span class="_ _14"> </span>discussion<span class="_ _14"> </span>purposes<span class="_ _1"></span>,<span class="_ _21"> </span>suppose<span class="_ _14"> </span>proce-</div><div class="t m5 x17 h26 y2f8 ff7 fs19 fc2 sc0 ls0 ws0">dure<span class="_ _13"> </span><span class="ffd">P<span class="_ _10"> </span></span>calls<span class="_ _13"> </span>procedure<span class="_"> </span><span class="ffd">Q</span>,<span class="_ _13"> </span>and<span class="_"> </span><span class="ffd">Q<span class="_ _13"> </span></span>then<span class="_ _13"> </span>executes<span class="_"> </span>and<span class="_ _13"> </span>returns<span class="_ _13"> </span>back<span class="_"> </span>to<span class="_ _13"> </span><span class="ffd">P</span>.<span class="_"> </span>T<span class="_ _3"></span>hese<span class="_"> </span>actions</div><div class="t m5 x17 h26 y2f9 ff7 fs19 fc2 sc0 ls0 ws0">involve<span class="_"> </span>one<span class="_"> </span>or<span class="_"> </span>more<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>mechanisms:</div><div class="t m5 x62 h26 y2903 ffa fs19 fc2 sc0 ls0 ws0">P<span class="_ _1"></span>assing<span class="_ _13"> </span>control.<span class="_ _f"> </span><span class="ff7">T<span class="_ _1"></span>he<span class="_"> </span>program<span class="_ _13"> </span>counter<span class="_"> </span>must<span class="_ _13"> </span>be<span class="_ _13"> </span>set<span class="_"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>starting<span class="_"> </span>address<span class="_ _13"> </span>of<span class="_ _13"> </span>the</span></div><div class="t m5 x30 h26 y2904 ff7 fs19 fc2 sc0 ls0 ws0">code<span class="_ _16"> </span>for<span class="_ _11"> </span><span class="ffd">Q<span class="_ _16"> </span></span>upon<span class="_ _16"> </span>entry<span class="_ _16"> </span>and<span class="_ _16"> </span>then<span class="_ _16"> </span>set<span class="_ _11"> </span>to<span class="_ _16"> </span>the<span class="_ _16"> </span>instruction<span class="_ _16"> </span>in<span class="_ _16"> </span><span class="ffd">P<span class="_ _11"> </span></span>following<span class="_ _16"> </span>the</div><div class="t m5 x30 h26 y2905 ff7 fs19 fc2 sc0 ls0 ws0">call<span class="_"> </span>to<span class="_"> </span><span class="ffd">Q<span class="_ _10"> </span></span>upon<span class="_"> </span>return.</div><div class="t m5 x62 h26 y2906 ffa fs19 fc2 sc0 ls0 ws0">P<span class="_ _1"></span>assing<span class="_ _13"> </span>data.<span class="_ _15"> </span><span class="ffd">P<span class="_ _13"> </span><span class="ff7">must<span class="_ _6"> </span>be<span class="_ _13"> </span>able<span class="_ _13"> </span>to<span class="_ _6"> </span>provide<span class="_ _13"> </span>one<span class="_ _6"> </span>or<span class="_ _13"> </span>more<span class="_ _6"> </span>parameters<span class="_ _13"> </span>to<span class="_ _13"> </span></span>Q<span class="ff7">,<span class="_ _6"> </span>and<span class="_ _13"> </span></span>Q<span class="_ _13"> </span><span class="ff7">must</span></span></div><div class="t m5 x30 h26 y2907 ff7 fs19 fc2 sc0 ls0 ws0">be<span class="_"> </span>able<span class="_"> </span>to<span class="_"> </span>return<span class="_"> </span>a<span class="_"> </span>value<span class="_"> </span>back<span class="_"> </span>to<span class="_"> </span><span class="ffd">P</span>.</div><div class="t m5 x62 h26 y2908 ffa fs19 fc2 sc0 ls0 ws0">Allocating<span class="_ _15"> </span>and<span class="_ _21"> </span>deallocating<span class="_ _21"> </span>memory<span class="_ _1"></span>.<span class="_ _21"> </span><span class="ffd">Q<span class="_ _21"> </span><span class="ff7">may<span class="_ _21"> </span>need<span class="_ _21"> </span>to<span class="_ _15"> </span>allocate<span class="_ _21"> </span>space<span class="_ _21"> </span>for<span class="_ _21"> </span>local</span></span></div><div class="t m5 x30 h26 y2909 ff7 fs19 fc2 sc0 ls0 ws0">variables<span class="_"> </span>when<span class="_"> </span>it<span class="_"> </span>begins<span class="_"> </span>and<span class="_"> </span>then<span class="_"> </span>free<span class="_"> </span>that<span class="_"> </span>storage<span class="_"> </span>before<span class="_"> </span>it<span class="_"> </span>returns<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y290a ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _11"> </span>x86-64<span class="_ _16"> </span>implementation<span class="_"> </span>of<span class="_ _11"> </span>procedures<span class="_ _16"> </span>involves<span class="_"> </span>a<span class="_ _16"> </span>combination<span class="_"> </span>of<span class="_ _11"> </span>special</div><div class="t m5 x17 h26 y290b ff7 fs19 fc2 sc0 ls0 ws0">instructions<span class="_ _13"> </span>and<span class="_ _13"> </span>a<span class="_ _13"> </span>set<span class="_ _13"> </span>of<span class="_ _13"> </span>conventions<span class="_ _13"> </span>on<span class="_ _13"> </span>how<span class="_ _13"> </span>to<span class="_ _13"> </span>use<span class="_ _13"> </span>the<span class="_ _13"> </span>machine<span class="_ _13"> </span>resources<span class="_ _1"></span>,<span class="_"> </span>such<span class="_ _13"> </span>as</div><div class="t m5 x17 h26 y290c ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _11"> </span>registers<span class="_ _11"> </span>and<span class="_ _16"> </span>the<span class="_"> </span>program<span class="_ _16"> </span>memory<span class="_ _7"></span>.<span class="_ _16"> </span>Great<span class="_ _11"> </span>effort<span class="_ _11"> </span>has<span class="_ _11"> </span>been<span class="_ _16"> </span>made<span class="_"> </span>to<span class="_ _16"> </span>minimize</div><div class="t m5 x17 h26 y290d ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _13"> </span>overhead<span class="_ _13"> </span>involved<span class="_"> </span>in<span class="_ _13"> </span>invoking<span class="_ _13"> </span>a<span class="_ _13"> </span>procedure<span class="_ _0"></span>.<span class="_ _13"> </span>As<span class="_ _13"> </span>a<span class="_"> </span>consequence<span class="_ _1"></span>,<span class="_ _13"> </span>it<span class="_"> </span>follows<span class="_ _13"> </span>what</div><div class="t m5 x17 h26 y290e ff7 fs19 fc2 sc0 ls0 ws0">can<span class="_"> </span>be<span class="_"> </span>seen<span class="_"> </span>as<span class="_"> </span>a<span class="_"> </span>minimalist<span class="_"> </span>strategy<span class="_ _7"></span>,<span class="_"> </span>implementing<span class="_"> </span>only<span class="_"> </span>as<span class="_"> </span>much<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>above<span class="_"> </span>set</div><div class="t m5 x17 h26 y290f ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_ _11"> </span>mechanisms<span class="_ _11"> </span>as<span class="_ _11"> </span>is<span class="_ _11"> </span>required<span class="_ _11"> </span>for<span class="_ _11"> </span>each<span class="_ _11"> </span>particular<span class="_ _11"> </span>procedure<span class="_ _0"></span>.<span class="_"> </span>In<span class="_ _11"> </span>our<span class="_ _16"> </span>presentation,</div><div class="t m5 x17 h26 y2910 ff7 fs19 fc2 sc0 ls0 ws0">we<span class="_ _11"> </span>build<span class="_ _16"> </span>up<span class="_ _11"> </span>the<span class="_ _16"> </span>different<span class="_ _11"> </span>mechanisms<span class="_ _16"> </span>step<span class="_ _11"> </span>by<span class="_ _16"> </span>step<span class="_ _1"></span>,<span class="_ _16"> </span>ﬁrst<span class="_ _11"> </span>describing<span class="_ _16"> </span>control,<span class="_ _11"> </span>then</div><div class="t m5 x17 h26 y2911 ff7 fs19 fc2 sc0 ls0 ws0">data<span class="_"> </span>passing,<span class="_"> </span>and,<span class="_"> </span>ﬁnally<span class="_ _7"></span>,<span class="_"> </span>memory<span class="_"> </span>management.</div><div class="t m5 x17 h41 y2912 ffe fs29 fc2 sc0 ls0 ws0">3.7.1<span class="_ _48"> </span><span class="fs19">The<span class="_"> </span>Run-Time<span class="_"> </span>Stack</span></div><div class="t m5 x17 h26 y2913 ff7 fs19 fc2 sc0 ls0 ws0">A<span class="_ _16"> </span>key<span class="_ _16"> </span>feature<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span>procedure-calling<span class="_ _16"> </span>mechanism<span class="_ _16"> </span>of<span class="_ _16"> </span>C,<span class="_ _16"> </span>and<span class="_ _16"> </span>of<span class="_ _16"> </span>most<span class="_ _16"> </span>other<span class="_ _16"> </span>lan-</div><div class="t m5 x17 h26 y2914 ff7 fs19 fc2 sc0 ls0 ws0">guages<span class="_ _1"></span>,<span class="_"> </span>is<span class="_"> </span>that<span class="_"> </span>it<span class="_"> </span>can<span class="_"> </span>make<span class="_ _13"> </span>use<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>last-in,<span class="_"> </span>ﬁrst-out<span class="_"> </span>memory<span class="_"> </span>management<span class="_"> </span>disci-</div><div class="t m5 x17 h26 y2915 ff7 fs19 fc2 sc0 ls0 ws0">pline<span class="_ _13"> </span>provided<span class="_ _13"> </span>by<span class="_ _13"> </span>a<span class="_ _13"> </span>stack<span class="_ _13"> </span>data<span class="_ _13"> </span>structure<span class="_ _1"></span>.<span class="_ _13"> </span>Using<span class="_ _13"> </span>our<span class="_ _13"> </span>example<span class="_ _13"> </span>of<span class="_ _13"> </span>procedure<span class="_ _13"> </span><span class="ffd">P<span class="_ _6"> </span></span>calling</div><div class="t m5 x17 h26 y2916 ff7 fs19 fc2 sc0 ls0 ws0">procedure<span class="_"> </span><span class="ffd">Q</span>,<span class="_"> </span>we<span class="_ _11"> </span>can<span class="_"> </span>see<span class="_"> </span>that<span class="_ _11"> </span>while<span class="_"> </span><span class="ffd">Q<span class="_ _11"> </span></span>is<span class="_"> </span>executing,<span class="_"> </span><span class="ffd">P</span>,<span class="_"> </span>along<span class="_"> </span>with<span class="_ _11"> </span>any<span class="_"> </span>of<span class="_"> </span>the<span class="_ _11"> </span>proce-</div><div class="t m5 x17 h26 y2917 ff7 fs19 fc2 sc0 ls0 ws0">dures<span class="_ _11"> </span>in<span class="_ _11"> </span>the<span class="_ _16"> </span>chain<span class="_ _11"> </span>of<span class="_ _11"> </span>calls<span class="_ _11"> </span>up<span class="_ _16"> </span>to<span class="_ _11"> </span><span class="ffd">P</span>,<span class="_ _11"> </span>is<span class="_ _16"> </span>temporarily<span class="_ _11"> </span>suspended.<span class="_ _11"> </span>While<span class="_ _11"> </span><span class="ffd">Q<span class="_ _11"> </span></span>is<span class="_ _11"> </span>running,</div><div class="t m5 x17 h26 y2918 ff7 fs19 fc2 sc0 ls0 ws0">only<span class="_ _6"> </span>it<span class="_ _13"> </span>will<span class="_ _6"> </span>need<span class="_ _13"> </span>the<span class="_ _6"> </span>ability<span class="_ _6"> </span>to<span class="_ _13"> </span>allocate<span class="_ _6"> </span>new<span class="_ _13"> </span>storage<span class="_ _6"> </span>for<span class="_ _13"> </span>its<span class="_ _a"> </span>local<span class="_ _13"> </span>variables<span class="_ _6"> </span>or<span class="_ _13"> </span>to<span class="_ _6"> </span>set<span class="_ _13"> </span>up</div><div class="t m5 x17 h26 y2919 ff7 fs19 fc2 sc0 ls0 ws0">a<span class="_ _13"> </span>call<span class="_ _6"> </span>to<span class="_ _13"> </span>another<span class="_ _13"> </span>procedure<span class="_ _1"></span>.<span class="_ _13"> </span>On<span class="_ _6"> </span>the<span class="_ _13"> </span>other<span class="_ _13"> </span>hand,<span class="_ _13"> </span>when<span class="_ _6"> </span><span class="ffd">Q<span class="_ _13"> </span></span>returns<span class="_ _1"></span>,<span class="_ _13"> </span>any<span class="_ _13"> </span>local<span class="_ _6"> </span>storage<span class="_ _13"> </span>it</div><div class="t m5 x17 h26 y291a ff7 fs19 fc2 sc0 ls0 ws0">has<span class="_ _13"> </span>allocated<span class="_ _13"> </span>can<span class="_ _13"> </span>be<span class="_ _13"> </span>freed.<span class="_ _13"> </span>T<span class="_ _1"></span>herefore<span class="_ _1"></span>,<span class="_"> </span>a<span class="_ _13"> </span>program<span class="_ _6"> </span>can<span class="_ _13"> </span>manage<span class="_ _13"> </span>the<span class="_ _13"> </span>storage<span class="_ _13"> </span>required</div><div class="t m5 x17 h26 y291b ff7 fs19 fc2 sc0 ls0 ws0">by<span class="_ _11"> </span>its<span class="_ _16"> </span>procedures<span class="_ _11"> </span>using<span class="_ _16"> </span>a<span class="_ _11"> </span>stack,<span class="_ _16"> </span>where<span class="_ _11"> </span>the<span class="_ _16"> </span>stack<span class="_ _11"> </span>and<span class="_ _11"> </span>the<span class="_ _16"> </span>program<span class="_ _11"> </span>registers<span class="_ _16"> </span>store</div><div class="t m5 x17 h26 y291c ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _13"> </span>information<span class="_ _13"> </span>required<span class="_"> </span>for<span class="_ _13"> </span>passing<span class="_ _13"> </span>control<span class="_ _13"> </span>and<span class="_"> </span>data,<span class="_ _13"> </span>and<span class="_ _13"> </span>for<span class="_ _13"> </span>allocating<span class="_"> </span>memory<span class="_ _7"></span>.</div><div class="t m5 x17 h26 y291d ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_"> </span><span class="ffd">P<span class="_ _10"> </span></span>calls<span class="_"> </span><span class="ffd">Q</span>,<span class="_"> </span>control<span class="_"> </span>and<span class="_"> </span>data<span class="_ _11"> </span>information<span class="_"> </span>are<span class="_"> </span>added<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>end<span class="_"> </span>of<span class="_"> </span>the<span class="_ _11"> </span>stack.<span class="_"> </span>T<span class="_ _1"></span>his</div><div class="t m5 x17 h26 y291e ff7 fs19 fc2 sc0 ls0 ws0">information<span class="_"> </span>gets<span class="_"> </span>deallocated<span class="_"> </span>when<span class="_"> </span><span class="ffd">P<span class="_ _10"> </span></span>returns<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y291f ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_"> </span>described<span class="_"> </span>in<span class="_ _13"> </span>Section<span class="_"> </span>3.4.4,<span class="_"> </span>the<span class="_"> </span>x86-64<span class="_"> </span>stack<span class="_ _13"> </span>grows<span class="_"> </span>toward<span class="_"> </span>lower<span class="_"> </span>addresses</div><div class="t m5 x17 h26 y2920 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_ _16"> </span>the<span class="_ _14"> </span>stack<span class="_ _16"> </span>pointer<span class="_ _14"> </span><span class="ffd">%rsp<span class="_ _16"> </span></span>points<span class="_ _14"> </span>to<span class="_ _16"> </span>the<span class="_ _14"> </span>top<span class="_ _16"> </span>element<span class="_ _14"> </span>of<span class="_ _16"> </span>the<span class="_ _14"> </span>stack.<span class="_ _16"> </span>Data<span class="_ _14"> </span>can<span class="_ _16"> </span>be</div><div class="t m5 x17 h26 y2921 ff7 fs19 fc2 sc0 ls0 ws0">stored<span class="_ _14"> </span>on<span class="_ _15"> </span>and<span class="_ _15"> </span>retrieved<span class="_ _15"> </span>from<span class="_ _15"> </span>the<span class="_ _15"> </span>stack<span class="_ _14"> </span>using<span class="_ _15"> </span>the<span class="_ _15"> </span><span class="ffd">pushq<span class="_ _15"> </span></span>and<span class="_ _15"> </span><span class="ffd">popq<span class="_ _14"> </span></span>instructions<span class="_ _0"></span>.</div><div class="t m5 x17 h26 y2922 ff7 fs19 fc2 sc0 ls0 ws0">Space<span class="_ _6"> </span>for<span class="_ _6"> </span>data<span class="_ _6"> </span>with<span class="_ _6"> </span>no<span class="_ _13"> </span>speciﬁed<span class="_ _a"> </span>initial<span class="_ _6"> </span>value<span class="_ _6"> </span>can<span class="_ _13"> </span>be<span class="_ _a"> </span>allocated<span class="_ _6"> </span>on<span class="_ _6"> </span>the<span class="_ _6"> </span>stack<span class="_ _13"> </span>by<span class="_ _a"> </span>simply</div><div class="t m5 x17 h26 y2923 ff7 fs19 fc2 sc0 ls0 ws0">decrementing<span class="_ _13"> </span>the<span class="_ _13"> </span>stack<span class="_ _13"> </span>pointer<span class="_ _13"> </span>by<span class="_"> </span>an<span class="_ _13"> </span>appropriate<span class="_ _13"> </span>amount.<span class="_ _13"> </span>Similarly<span class="_ _3"></span>,<span class="_ _13"> </span>space<span class="_ _13"> </span>can<span class="_ _13"> </span>be</div><div class="t m5 x17 h26 y2924 ff7 fs19 fc2 sc0 ls0 ws0">deallocated<span class="_"> </span>by<span class="_"> </span>incrementing<span class="_"> </span>the<span class="_"> </span>stack<span class="_"> </span>pointer.</div><div class="t m5 x26 h26 y2925 ff7 fs19 fc2 sc0 ls0 ws0">When<span class="_"> </span>an<span class="_ _11"> </span>x86-64<span class="_ _16"> </span>procedure<span class="_"> </span>requires<span class="_ _16"> </span>storage<span class="_"> </span>beyond<span class="_ _16"> </span>what<span class="_"> </span>it<span class="_ _16"> </span>can<span class="_ _11"> </span>hold<span class="_ _11"> </span>in<span class="_ _11"> </span>reg-</div><div class="t m5 x17 h26 y2926 ff7 fs19 fc2 sc0 ls0 ws0">isters<span class="_ _1"></span>,<span class="_"> </span>it<span class="_"> </span>allocates<span class="_"> </span>space<span class="_"> </span>on<span class="_"> </span>the<span class="_"> </span>stack.<span class="_"> </span>T<span class="_ _1"></span>his<span class="_"> </span>region<span class="_"> </span>is<span class="_"> </span>referred<span class="_"> </span>to<span class="_"> </span>as<span class="_"> </span>the<span class="_"> </span>procedure’<span class="_ _1"></span>s</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
