<div id="pffd" class="pf w2 h11" data-page-no="fd"><div class="pc pcfd w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bgfd.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">252<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x28 h2a y257 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">How<span class="_ _11"> </span>did<span class="_ _11"> </span>you<span class="_ _11"> </span>determine<span class="_ _16"> </span>this<span class="_ _11"> </span>penalty?</span></div><div class="t m5 x28 h2b y2d0 ff7 fs1e fc2 sc0 ls0 ws0">Assume<span class="_ _11"> </span>the<span class="_ _16"> </span>probability<span class="_ _16"> </span>of<span class="_ _11"> </span>misprediction<span class="_ _16"> </span>is<span class="_ _16"> </span><span class="ff11">p</span>,<span class="_ _16"> </span>the<span class="_ _16"> </span>time<span class="_ _16"> </span>to<span class="_ _11"> </span>execute<span class="_ _16"> </span>the<span class="_ _16"> </span>code<span class="_ _11"> </span>without<span class="_ _16"> </span>misprediction<span class="_ _16"> </span>is</div><div class="t m5 x28 h49 y2d1 ff11 fs1e fc2 sc0 ls0 ws0">T</div><div class="t m5 xca h48 y837 ff7 fs2c fc2 sc0 ls0 ws0">OK</div><div class="t m5 x17 h2b y838 ff7 fs1e fc2 sc0 ls0 ws0">,<span class="_"> </span>and<span class="_"> </span>the<span class="_"> </span>misprediction<span class="_ _13"> </span>penalty<span class="_"> </span>is<span class="_"> </span><span class="ff11">T</span></div><div class="t m5 x47 h48 y260e ff7 fs2c fc2 sc0 ls0 ws0">MP</div><div class="t m5 x9c h2b y838 ff7 fs1e fc2 sc0 ls0 ws0">.<span class="_"> </span>T<span class="_ _1"></span>hen<span class="_"> </span>the<span class="_"> </span>average<span class="_"> </span>time<span class="_"> </span>to<span class="_"> </span>execute<span class="_ _13"> </span>the<span class="_"> </span>code<span class="_"> </span>as<span class="_"> </span>a<span class="_"> </span>function<span class="_"> </span>of</div><div class="t m5 x28 h2b y839 ff11 fs1e fc2 sc0 ls0 ws0">p<span class="_ _13"> </span><span class="ff7">is<span class="_ _6"> </span></span>T</div><div class="t m5 x2c h48 y1053 ff7 fs2c fc2 sc0 ls0 ws0">avg</div><div class="t m5 x245 h4a yb7a ff11 fs1e fc2 sc0 ls0 ws0">(p<span class="_ _2"></span>)<span class="_ _13"> </span><span class="ff12">=<span class="_ _6"></span></span>(<span class="ff7">1<span class="_ _6"> </span><span class="ff12">−<span class="_ _13"> </span></span></span><span class="ls162">p)T</span></div><div class="t m5 x1ee h48 y1053 ff7 fs2c fc2 sc0 ls0 ws0">OK</div><div class="t m5 x134 h4a yb7a ff12 fs1e fc2 sc0 ls0 ws0">+<span class="_ _13"></span><span class="ff11 ls162">p(<span class="_ _1"></span>T</span></div><div class="t m5 x141 h48 y1053 ff7 fs2c fc2 sc0 ls0 ws0">OK</div><div class="t m5 x1a5 h4a yb7a ff12 fs1e fc2 sc0 ls0 ws0">+<span class="_ _13"></span><span class="ff11">T</span></div><div class="t m5 xd h48 y1053 ff7 fs2c fc2 sc0 ls0 ws0">MP</div><div class="t m5 x189 h4a yb7a ff11 fs1e fc2 sc0 ls0 ws0">)<span class="_ _13"> </span><span class="ff12">=<span class="_ _13"></span></span>T</div><div class="t m5 x1e6 h48 y1053 ff7 fs2c fc2 sc0 ls0 ws0">OK</div><div class="t m5 x197 h4a yb7a ff12 fs1e fc2 sc0 ls0 ws0">+<span class="_ _13"></span><span class="ff11 ls162">pT</span></div><div class="t m5 x181 h48 y1053 ff7 fs2c fc2 sc0 ls0 ws0">MP</div><div class="t m5 x99 h2b yb7a ff7 fs1e fc2 sc0 ls0 ws0">.<span class="_ _6"> </span>W<span class="_ _1"></span>e<span class="_ _6"> </span>are<span class="_ _13"> </span>given<span class="_ _6"> </span><span class="ff11">T</span></div><div class="t m5 x12f h48 y1053 ff7 fs2c fc2 sc0 ls0 ws0">OK</div><div class="t m5 x108 h2b yb7a ff7 fs1e fc2 sc0 ls0 ws0">and<span class="_ _6"> </span><span class="ff11">T</span></div><div class="t m5 x1e1 h48 y1053 ff7 fs2c fc2 sc0 ls0 ws0">ran</div><div class="t m5 x44 h2b yb7a ff7 fs1e fc2 sc0 ls0 ws0">,<span class="_ _13"> </span>the<span class="_ _6"> </span>average<span class="_ _6"> </span>time</div><div class="t m5 x28 h4a yb7b ff7 fs1e fc2 sc0 ls0 ws0">when<span class="_"> </span><span class="ff11">p<span class="_ _13"> </span><span class="ff12">=<span class="_ _13"> </span></span></span>0<span class="ff11">.</span>5,<span class="_"> </span>and<span class="_ _13"> </span>we<span class="_"> </span>want<span class="_ _13"> </span>to<span class="_"> </span>determine<span class="_ _13"> </span><span class="ff11">T</span></div><div class="t m5 x9c h48 y260f ff7 fs2c fc2 sc0 ls0 ws0">MP</div><div class="t m5 xba h2b y2610 ff7 fs1e fc2 sc0 ls0 ws0">.<span class="_"> </span>Substituting<span class="_ _13"> </span>into<span class="_"> </span>the<span class="_ _13"> </span>equation,<span class="_"> </span>we<span class="_ _13"> </span>get<span class="_"> </span><span class="ff11">T</span></div><div class="t m5 x1d8 h48 y260f ff7 fs2c fc2 sc0 ls0 ws0">ran</div><div class="t m5 xd6 h4a y2610 ff12 fs1e fc2 sc0 ls0 ws0">=<span class="_ _13"></span><span class="ff11">T</span></div><div class="t m5 xea h48 y260f ff7 fs2c fc2 sc0 ls0 ws0">avg</div><div class="t m5 x61 h4a y2610 ff11 fs1e fc2 sc0 ls0 ws0">(<span class="ff7">0</span>.<span class="ff7">5</span>)<span class="_ _13"> </span><span class="ff12">=</span></div><div class="t m5 x28 h49 y2611 ff11 fs1e fc2 sc0 ls0 ws0">T</div><div class="t m5 xca h48 y2612 ff7 fs2c fc2 sc0 ls0 ws0">OK</div><div class="t m5 x246 h4a y2613 ff12 fs1e fc2 sc0 ls0 ws0">+<span class="_ _13"> </span><span class="ff7">0<span class="ff11">.</span>5<span class="ff11">T</span></span></div><div class="t m5 x146 h48 y2612 ff7 fs2c fc2 sc0 ls0 ws0">MP</div><div class="t m5 x21e h2b y2613 ff7 fs1e fc2 sc0 ls0 ws0">,<span class="_"> </span>and<span class="_"> </span>therefore<span class="_"> </span><span class="ff11">T</span></div><div class="t m5 x4d h48 y2612 ff7 fs2c fc2 sc0 ls0 ws0">MP</div><div class="t m5 x7a h4a y2613 ff12 fs1e fc2 sc0 ls0 ws0">=<span class="_ _13"> </span><span class="ff7">2<span class="ff11">(T</span></span></div><div class="t m5 x10e h48 y2612 ff7 fs2c fc2 sc0 ls0 ws0">ran</div><div class="t m5 x117 h4a y2613 ff12 fs1e fc2 sc0 ls0 ws0">−<span class="_ _13"> </span><span class="ff11">T</span></div><div class="t m5 x49 h48 y2612 ff7 fs2c fc2 sc0 ls0 ws0">OK</div><div class="t m5 xe3 h2b y2613 ff11 fs1e fc2 sc0 ls0 ws0">)<span class="ff7">.<span class="_"> </span>So<span class="_ _1"></span>,<span class="_"> </span>for<span class="_"> </span><span class="ff11">T</span></span></div><div class="t m5 x114 h48 y2612 ff7 fs2c fc2 sc0 ls0 ws0">OK</div><div class="t m5 x1e7 h4a y2613 ff12 fs1e fc2 sc0 ls0 ws0">=<span class="_ _13"> </span><span class="ff7">8<span class="_"> </span>and<span class="_"> </span><span class="ff11">T</span></span></div><div class="t m5 x247 h48 y2612 ff7 fs2c fc2 sc0 ls0 ws0">ran</div><div class="t m5 x108 h4a y2613 ff12 fs1e fc2 sc0 ls0 ws0">=<span class="_ _13"> </span><span class="ff7">17<span class="ff11">.</span>5,<span class="_"> </span>we<span class="_"> </span>get<span class="_"> </span><span class="ff11">T</span></span></div><div class="t m5 xea h48 y2612 ff7 fs2c fc2 sc0 ls0 ws0">MP</div><div class="t m5 x248 h4a y2613 ff12 fs1e fc2 sc0 ls0 ws0">=<span class="_ _13"> </span><span class="ff7 ls163">19.</span></div><div class="t m5 x29 h26 y2614 ff7 fs19 fc2 sc0 ls0 ws0">On<span class="_ _f"> </span>the<span class="_ _e"> </span>other<span class="_ _f"> </span>hand,<span class="_ _1f"> </span>the<span class="_ _f"> </span>code<span class="_ _e"> </span>compiled<span class="_ _f"> </span>using<span class="_ _e"> </span>conditional<span class="_ _f"> </span>moves<span class="_ _e"> </span>requires</div><div class="t m5 x1d h26 y2615 ff7 fs19 fc2 sc0 ls0 ws0">around<span class="_ _15"> </span>8<span class="_ _21"> </span>clock<span class="_ _15"> </span>cycles<span class="_ _15"> </span>regardless<span class="_ _15"> </span>of<span class="_ _21"> </span>the<span class="_ _21"> </span>data<span class="_ _15"> </span>being<span class="_ _21"> </span>tested.<span class="_ _15"> </span>The<span class="_ _14"> </span>ﬂow<span class="_ _21"> </span>of<span class="_ _15"> </span>control</div><div class="t m5 x1d h26 y2616 ff7 fs19 fc2 sc0 ls0 ws0">does<span class="_ _16"> </span>not<span class="_ _16"> </span>depend<span class="_ _14"> </span>on<span class="_ _16"> </span>data,<span class="_ _14"> </span>and<span class="_ _14"> </span>this<span class="_ _16"> </span>makes<span class="_ _14"> </span>it<span class="_ _16"> </span>easier<span class="_ _16"> </span>for<span class="_ _14"> </span>the<span class="_ _16"> </span>processor<span class="_ _14"> </span>to<span class="_ _16"> </span>keep<span class="_ _16"> </span>its</div><div class="t m5 x1d h26 y2617 ff7 fs19 fc2 sc0 ls0 ws0">pipeline<span class="_"> </span>full.</div><div class="t m5 x1d h47 y2618 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>3.19<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>368)</span></div><div class="t m5 x1d h26 y2619 ff7 fs19 fc1 sc0 ls0 ws0">Running<span class="_ _13"> </span>on<span class="_"> </span>a<span class="_ _13"> </span>new<span class="_ _13"> </span>processor<span class="_"> </span>model,<span class="_ _13"> </span>our<span class="_"> </span>code<span class="_ _13"> </span>required<span class="_ _13"> </span>around<span class="_"> </span>45<span class="_ _13"> </span>cycles<span class="_ _13"> </span>when<span class="_ _13"> </span>the</div><div class="t m5 x1d h26 y261a ff7 fs19 fc1 sc0 ls0 ws0">branching<span class="_ _13"> </span>pattern<span class="_"> </span>was<span class="_ _13"> </span>random,<span class="_"> </span>and<span class="_ _13"> </span>around<span class="_ _13"> </span>25<span class="_"> </span>c<span class="_ _1"></span>ycles<span class="_"> </span>when<span class="_ _13"> </span>the<span class="_ _13"> </span>pattern<span class="_"> </span>was<span class="_ _13"> </span>highly</div><div class="t m5 x1d h26 y261b ff7 fs19 fc1 sc0 ls0 ws0">predictable<span class="_ _1"></span>.</div><div class="t m5 x124 h26 y261c ff7 fs19 fc1 sc0 ls0 ws0">A.<span class="_ _1f"> </span>What<span class="_"> </span>is<span class="_"> </span>the<span class="_"> </span>approximate<span class="_"> </span>miss<span class="_"> </span>penalty?</div><div class="t m5 x124 h26 y261d ff7 fs19 fc1 sc0 ls0 ws0">B<span class="_ _3"></span>.<span class="_ _1d"> </span>How<span class="_ _14"> </span>many<span class="_ _15"> </span>cycles<span class="_ _16"> </span>would<span class="_ _14"> </span>the<span class="_ _15"> </span>function<span class="_ _14"> </span>require<span class="_ _14"> </span>when<span class="_ _14"> </span>the<span class="_ _14"> </span>branch<span class="_ _15"> </span>is<span class="_ _14"> </span>mispre-</div><div class="t m5 x4f h26 y261e ff7 fs19 fc1 sc0 ls0 ws0">dicted?</div><div class="t m5 x29 h26 y261f ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _13"> </span>3.18<span class="_ _a"> </span>illustrates<span class="_ _6"> </span>some<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _a"> </span>conditional<span class="_ _6"> </span>move<span class="_ _6"> </span>instructions<span class="_ _6"> </span>available<span class="_ _13"> </span>with</div><div class="t m5 x1d h26 y2620 ff7 fs19 fc1 sc0 ls0 ws0">x86-64.<span class="_"> </span>Each<span class="_ _13"> </span>of<span class="_"> </span>these<span class="_"> </span>instructions<span class="_ _13"> </span>has<span class="_"> </span>two<span class="_"> </span>operands:<span class="_ _13"> </span>a<span class="_"> </span>source<span class="_"> </span>register<span class="_ _13"> </span>or<span class="_"> </span>memory</div><div class="t m5 x1d h26 y2621 ff7 fs19 fc1 sc0 ls0 ws0">location<span class="_ _11"> </span><span class="ffa">S</span>,<span class="_ _16"> </span>and<span class="_"> </span>a<span class="_ _11"> </span>destination<span class="_ _11"> </span>register<span class="_ _11"> </span><span class="ffa">R</span>.<span class="_ _11"> </span>As<span class="_ _11"> </span>with<span class="_ _11"> </span>the<span class="_ _11"> </span>different<span class="_ _11"> </span><span class="ff9">set<span class="_ _11"> </span></span>(Section<span class="_ _11"> </span>3.6.2)</div><div class="t m5 x1d h26 y2622 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_"> </span>jump<span class="_ _11"> </span>(Section<span class="_ _11"> </span>3.6.3)<span class="_ _11"> </span>instructions<span class="_ _1"></span>,<span class="_ _11"> </span>the<span class="_"> </span>outcome<span class="_ _11"> </span>of<span class="_ _11"> </span>these<span class="_ _11"> </span>instructions<span class="_"> </span>depends</div><div class="t m5 x1d h26 y2623 ff7 fs19 fc1 sc0 ls0 ws0">on<span class="_ _13"> </span>the<span class="_ _13"> </span>values<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>condition<span class="_ _13"> </span>codes<span class="_ _1"></span>.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span>source<span class="_ _13"> </span>value<span class="_ _13"> </span>is<span class="_ _13"> </span>read<span class="_ _13"> </span>from<span class="_ _13"> </span>either<span class="_ _13"> </span>memory</div><div class="t m5 x1d h26 y2624 ff7 fs19 fc1 sc0 ls0 ws0">or<span class="_ _21"> </span>the<span class="_ _21"> </span>source<span class="_ _21"> </span>register,<span class="_ _f"> </span>but<span class="_ _f"> </span>it<span class="_ _21"> </span>is<span class="_ _21"> </span>copied<span class="_ _21"> </span>to<span class="_ _f"> </span>the<span class="_ _21"> </span>destination<span class="_ _21"> </span>only<span class="_ _21"> </span>if<span class="_ _f"> </span>the<span class="_ _21"> </span>speciﬁed</div><div class="t m5 x1d h26 y2625 ff7 fs19 fc1 sc0 ls0 ws0">condition<span class="_"> </span>holds<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y2626 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _f"> </span>source<span class="_ _f"> </span>and<span class="_ _f"> </span>destination<span class="_ _f"> </span>values<span class="_ _f"> </span>can<span class="_ _f"> </span>be<span class="_ _f"> </span>16,<span class="_ _e"> </span>32,<span class="_ _e"> </span>or<span class="_ _f"> </span>64<span class="_ _f"> </span>bits<span class="_ _f"> </span>long.<span class="_ _f"> </span>Single-</div><div class="t m5 x1d h26 y2627 ff7 fs19 fc1 sc0 ls0 ws0">byte<span class="_"> </span>conditional<span class="_ _13"> </span>moves<span class="_"> </span>are<span class="_"> </span>not<span class="_"> </span>supported.<span class="_ _13"> </span>Unlike<span class="_"> </span>the<span class="_"> </span>unconditional<span class="_ _13"> </span>instructions<span class="_ _0"></span>,</div><div class="t m5 x1d h26 y2628 ff7 fs19 fc1 sc0 ls0 ws0">where<span class="_ _13"> </span>the<span class="_"> </span>operand<span class="_ _13"> </span>length<span class="_"> </span>is<span class="_ _13"> </span>explicitly<span class="_"> </span>encoded<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_"> </span>instruction<span class="_ _13"> </span>name<span class="_"> </span>(e<span class="_ _1"></span>.g.,<span class="_ _13"> </span><span class="ffd">movw</span></div><div class="t m5 x1d h26 y2629 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _15"> </span><span class="ffd">movl</span>),<span class="_ _e"> </span>the<span class="_ _15"> </span>assembler<span class="_ _15"> </span>can<span class="_ _21"> </span>infer<span class="_ _21"> </span>the<span class="_ _21"> </span>operand<span class="_ _15"> </span>length<span class="_ _21"> </span>of<span class="_ _21"> </span>a<span class="_ _21"> </span>conditional<span class="_ _21"> </span>move</div><div class="t m5 x1d h26 y262a ff7 fs19 fc1 sc0 ls0 ws0">instruction<span class="_"> </span>from<span class="_ _13"> </span>the<span class="_"> </span>name<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>destination<span class="_ _13"> </span>register,<span class="_"> </span>and<span class="_ _13"> </span>so<span class="_"> </span>the<span class="_"> </span>same<span class="_ _13"> </span>instruction</div><div class="t m5 x1d h26 y262b ff7 fs19 fc1 sc0 ls0 ws0">name<span class="_"> </span>can<span class="_"> </span>be<span class="_"> </span>used<span class="_"> </span>for<span class="_"> </span>all<span class="_"> </span>operand<span class="_"> </span>lengths<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y262c ff7 fs19 fc1 sc0 ls0 ws0">Unlike<span class="_ _15"> </span>conditional<span class="_ _15"> </span>jumps<span class="_ _1"></span>,<span class="_ _f"> </span>the<span class="_ _15"> </span>processor<span class="_ _15"> </span>can<span class="_ _15"> </span>execute<span class="_ _21"> </span>conditional<span class="_ _15"> </span>move<span class="_ _15"> </span>in-</div><div class="t m5 x1d h26 y262d ff7 fs19 fc1 sc0 ls0 ws0">structions<span class="_ _13"> </span>without<span class="_ _13"> </span>having<span class="_ _13"> </span>to<span class="_ _13"> </span>predict<span class="_"> </span>the<span class="_ _13"> </span>outcome<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>test.<span class="_ _13"> </span>T<span class="_ _0"></span>he<span class="_ _13"> </span>processor<span class="_ _13"> </span>simply</div><div class="t m5 x1d h26 y262e ff7 fs19 fc1 sc0 ls0 ws0">reads<span class="_ _16"> </span>the<span class="_ _11"> </span>source<span class="_ _16"> </span>value<span class="_ _16"> </span>(possibly<span class="_ _16"> </span>from<span class="_ _11"> </span>memory),<span class="_ _16"> </span>checks<span class="_ _16"> </span>the<span class="_ _16"> </span>condition<span class="_ _16"> </span>code<span class="_ _1"></span>,<span class="_ _16"> </span>and</div><div class="t m5 x1d h26 y262f ff7 fs19 fc1 sc0 ls0 ws0">then<span class="_"> </span>either<span class="_"> </span>updates<span class="_"> </span>the<span class="_"> </span>destination<span class="_"> </span>register<span class="_"> </span>or<span class="_"> </span>keeps<span class="_"> </span>it<span class="_"> </span>the<span class="_"> </span>same<span class="_ _0"></span>.<span class="_"> </span>W<span class="_ _3"></span>e<span class="_"> </span>will<span class="_"> </span>explore</div><div class="t m5 x1d h26 y2630 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>implementation<span class="_"> </span>of<span class="_"> </span>conditional<span class="_"> </span>moves<span class="_"> </span>in<span class="_"> </span>Chapter<span class="_"> </span>4.</div><div class="t m5 x29 h26 y2631 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_ _15"> </span>understand<span class="_ _15"> </span>how<span class="_ _15"> </span>conditional<span class="_ _15"> </span>operations<span class="_ _15"> </span>can<span class="_ _15"> </span>be<span class="_ _15"> </span>implemented<span class="_ _15"> </span>via<span class="_ _15"> </span>condi-</div><div class="t m5 x1d h26 y2632 ff7 fs19 fc1 sc0 ls0 ws0">tional<span class="_ _6"> </span>data<span class="_ _6"> </span>transfers<span class="_ _1"></span>,<span class="_ _13"> </span>consider<span class="_ _6"> </span>the<span class="_ _6"> </span>following<span class="_ _6"> </span>general<span class="_ _6"> </span>form<span class="_ _13"> </span>of<span class="_ _a"> </span>conditional<span class="_ _6"> </span>expression</div><div class="t m5 x1d h26 y2633 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_"> </span>assignment:</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
