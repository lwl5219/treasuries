<div id="pf17c" class="pf w2 h11" data-page-no="17c"><div class="pc pc17c w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg17c.png"/><div class="t m5 x107 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Solutions<span class="_ _10"> </span>to<span class="_ _10"> </span>Practice<span class="_ _10"> </span>Problems<span class="_ _1b"> </span><span class="ffe fs1e">379</span></div><div class="t m5 x2c h2d ye7 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">cmpq<span class="_ _46"> </span>$1088,<span class="_ _e"> </span>%rax<span class="_ _161"> </span></span><span class="ff13 fs35">Compare<span class="_ _f"> </span>index4:<span class="_ _f"> </span>4N(N+1)</span></div><div class="t m5 x2c h2d yc4d ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">jne<span class="_ _8c"> </span>.L13<span class="_ _189"> </span></span><span class="ff13 fs35">If<span class="_ _21"> </span>!=,<span class="_ _f"> </span>goto<span class="_ _e"> </span><span class="ff2d">loop</span></span></div><div class="t m5 x2c h2d yecb ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _45"> </span><span class="ffd fs1e fc2">rep;<span class="_ _e"> </span>ret<span class="_ _a3"> </span></span><span class="ff13 fs35">Return</span></div><div class="t m5 x17 h28 y354b ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>3.41<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>304)</span></div><div class="t m5 x17 h26 y354c ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>problem<span class="_ _13"> </span>gets<span class="_ _13"> </span>you<span class="_"> </span>to<span class="_ _13"> </span>think<span class="_"> </span>about<span class="_ _13"> </span>structure<span class="_ _13"> </span>layout<span class="_"> </span>and<span class="_ _13"> </span>the<span class="_ _13"> </span>code<span class="_"> </span>used<span class="_ _13"> </span>to<span class="_ _13"> </span>access</div><div class="t m5 x17 h26 y354d ff7 fs19 fc1 sc0 ls0 ws0">structure<span class="_ _14"> </span>ﬁelds<span class="_ _1"></span>.<span class="_ _14"> </span>T<span class="_ _0"></span>he<span class="_ _14"> </span>structure<span class="_ _14"> </span>declaration<span class="_ _14"> </span>is<span class="_ _14"> </span>a<span class="_ _14"> </span>variant<span class="_ _14"> </span>of<span class="_ _15"> </span>the<span class="_ _14"> </span>example<span class="_ _14"> </span>shown<span class="_ _14"> </span>in</div><div class="t m5 x17 h26 y354e ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _14"> </span>text.<span class="_ _15"> </span>It<span class="_ _15"> </span>shows<span class="_ _15"> </span>that<span class="_ _15"> </span>nested<span class="_ _15"> </span>structures<span class="_ _14"> </span>are<span class="_ _15"> </span>allocated<span class="_ _15"> </span>by<span class="_ _15"> </span>embedding<span class="_ _15"> </span>the<span class="_ _14"> </span>inner</div><div class="t m5 x17 h26 y354f ff7 fs19 fc1 sc0 ls0 ws0">structures<span class="_"> </span>within<span class="_"> </span>the<span class="_"> </span>outer<span class="_"> </span>ones<span class="_ _1"></span>.</div><div class="t m5 x34 h26 y3550 ff7 fs19 fc1 sc0 ls0 ws0">A.<span class="_ _1f"> </span>T<span class="_ _1"></span>he<span class="_"> </span>layout<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>structure<span class="_"> </span>is<span class="_"> </span>as<span class="_"> </span>follows:</div><div class="t m5 x182 h84 y3551 ff30 fs49 fc1 sc0 ls0 ws0">Offset </div><div class="t m5 x2d h84 y3552 ff30 fs49 fc1 sc0 ls0 ws0">Contents </div><div class="t m5 x33 h85 y3553 ff31 fs4a fc1 sc0 ls0 ws0">p</div><div class="t m5 x1f h84 y3554 ff30 fs49 fc1 sc0 ls1a2 ws0">01<span class="_ _196"></span>0<span class="_ _197"></span><span class="ls1a3">81<span class="_ _198"></span>2<span class="_ _8a"></span>2<span class="_ _198"></span>0</span></div><div class="t m5 xba h85 y3553 ff31 fs4a fc1 sc0 ls0 ws0">s.x<span class="_ _6c"> </span>s.y<span class="_ _d6"> </span>next</div><div class="t m5 x34 h26 y3555 ff7 fs19 fc1 sc0 ls0 ws0">B<span class="_ _3"></span>.<span class="_ _1d"> </span>It<span class="_"> </span>uses<span class="_"> </span>20<span class="_"> </span>bytes<span class="_ _1"></span>.</div><div class="t m5 x34 h26 y3556 ff7 fs19 fc1 sc0 ls0 ws0">C.<span class="_ _25"> </span>As<span class="_"> </span>always<span class="_ _1"></span>,<span class="_"> </span>we<span class="_"> </span>start<span class="_"> </span>by<span class="_"> </span>annotating<span class="_"> </span>the<span class="_"> </span>assembly<span class="_"> </span>code:</div><div class="t m5 x1c5 h61 y3557 ff13 fs35 fc6 sc0 ls0 ws0">void<span class="_ _f"> </span>st_init(struct<span class="_ _f"> </span>test<span class="_ _f"> </span>*st)</div><div class="t m5 x1c5 h61 y3558 ff13 fs35 fc6 sc0 ls0 ws0">st<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi</div><div class="t m5 x146 h2d y3559 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">st_init:</span></div><div class="t m5 x146 h2d y355a ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">movl<span class="_ _46"> </span>8(%rdi),<span class="_ _e"> </span>%eax<span class="_ _59"> </span></span><span class="ff13 fs35">Get<span class="_ _f"> </span>st-&gt;s.x</span></div><div class="t m5 x146 h2d y355b ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">movl<span class="_ _46"> </span>%eax,<span class="_ _e"> </span>10(%rdi)<span class="_ _93"> </span></span><span class="ff13 fs35">Save<span class="_ _e"> </span>in<span class="_ _21"> </span>st-&gt;s.y</span></div><div class="t m5 x146 h2d y355c ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">leaq<span class="_ _46"> </span>10(%rdi),<span class="_ _e"> </span>%rax<span class="_ _93"> </span></span><span class="ff13 fs35">Compute<span class="_ _e"> </span>&amp;(st-&gt;s.y)</span></div><div class="t m5 x146 h2d y355d ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rax,<span class="_ _e"> </span>(%rdi)<span class="_ _18c"> </span></span><span class="ff13 fs35">Store<span class="_ _f"> </span>in<span class="_ _e"> </span>st-&gt;p</span></div><div class="t m5 x146 h2d y355e ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rdi,<span class="_ _e"> </span>12(%rdi)<span class="_ _93"> </span></span><span class="ff13 fs35">Store<span class="_ _e"> </span>st<span class="_ _21"> </span>in<span class="_ _f"> </span>st-&gt;next</span></div><div class="t m5 x146 h2d y355f ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">ret</span></div><div class="t m5 x1d4 h26 y3560 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>rom<span class="_"> </span>this<span class="_ _1"></span>,<span class="_"> </span>we<span class="_"> </span>can<span class="_"> </span>generate<span class="_"> </span>C<span class="_"> </span>code<span class="_"> </span>as<span class="_"> </span>follows:</div><div class="t m5 x2d h2d y3561 ffd fs1e fc2 sc0 ls0 ws0">void<span class="_ _e"> </span>st_init(struct<span class="_ _1f"> </span>test<span class="_ _1f"> </span>*st)</div><div class="t m5 x2d h2d y3562 ffd fs1e fc2 sc0 ls0 ws0">{</div><div class="t m5 x142 h2d y3563 ffd fs1e fc2 sc0 ls0 ws0">st-&gt;s.y<span class="_ _3f"> </span>=<span class="_ _e"> </span>st-&gt;s.x;</div><div class="t m5 x142 h2d y3564 ffd fs1e fc2 sc0 ls0 ws0">st-&gt;p<span class="_ _8c"> </span>=<span class="_ _e"> </span>&amp;(st-&gt;s.y);</div><div class="t m5 x142 h2d y3565 ffd fs1e fc2 sc0 ls0 ws0">st-&gt;next<span class="_ _1a"> </span>=<span class="_ _e"> </span>st;</div><div class="t m5 x2d h2d y3566 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x17 h28 y3567 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>3.42</div><div class="t m5 x112 h2f y3568 ffe fs16 fc6 sc0 ls0 ws0">(page<span class="_"> </span>305)</div><div class="t m5 x17 h26 y3569 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>problem<span class="_"> </span>demonstrates<span class="_"> </span>how<span class="_"> </span>a<span class="_"> </span>very<span class="_"> </span>common<span class="_"> </span>data<span class="_"> </span>structure<span class="_"> </span>and<span class="_"> </span>operation<span class="_"> </span>on</div><div class="t m5 x17 h26 y356a ff7 fs19 fc1 sc0 ls0 ws0">it<span class="_"> </span>is<span class="_ _11"> </span>implemented<span class="_ _11"> </span>in<span class="_ _11"> </span>machine<span class="_ _11"> </span>code<span class="_ _0"></span>.<span class="_"> </span>W<span class="_ _1"></span>e<span class="_ _11"> </span>solve<span class="_"> </span>the<span class="_ _11"> </span>problem<span class="_ _11"> </span>by<span class="_ _11"> </span>ﬁrst<span class="_ _11"> </span>annotating<span class="_ _11"> </span>the</div><div class="t m5 x17 h26 y356b ff7 fs19 fc1 sc0 ls0 ws0">assembly<span class="_ _15"> </span>code<span class="_ _1"></span>,<span class="_ _21"> </span>recognizing<span class="_ _15"> </span>that<span class="_ _15"> </span>the<span class="_ _15"> </span>two<span class="_ _15"> </span>ﬁelds<span class="_ _15"> </span>of<span class="_ _15"> </span>the<span class="_ _15"> </span>structure<span class="_ _15"> </span>are<span class="_ _15"> </span>at<span class="_ _15"> </span>offsets<span class="_ _14"> </span>0</div><div class="t m5 x17 h26 y356c ff7 fs19 fc1 sc0 ls0 ws0">(for<span class="_"> </span><span class="ffd">v</span>)<span class="_"> </span>and<span class="_"> </span>2<span class="_"> </span>(for<span class="_"> </span><span class="ffd">p</span>).</div><div class="t m5 x2e h61 y13c0 ff13 fs35 fc6 sc0 ls0 ws0">short<span class="_ _f"> </span>test(struct<span class="_ _f"> </span>ACE<span class="_ _f"> </span>*ptr)</div><div class="t m5 x2e h61 y2e7c ff13 fs35 fc6 sc0 ls0 ws0">ptr<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi</div><div class="t m5 x2c h2d y8d6 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">test:</span></div><div class="t m5 x2c h2d y77e ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">movl<span class="_ _46"> </span>$1,<span class="_ _e"> </span>%eax<span class="_ _12e"> </span></span><span class="ff13 fs35">result<span class="_ _e"> </span>=<span class="_ _21"> </span>1</span></div><div class="t m5 x2c h2d ye95 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">jmp<span class="_ _8c"> </span>.L2<span class="_ _e5"> </span></span><span class="ff13 fs35">Goto<span class="_ _e"> </span><span class="ff2d">middle</span></span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
