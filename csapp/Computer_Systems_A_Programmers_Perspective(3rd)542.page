<div id="pf21e" class="pf w2 h11" data-page-no="21e"><div class="pc pc21e w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg21e.png"/><div class="t m5 xb9 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>5.3<span class="_ _60"> </span>Program<span class="_ _10"> </span>Example<span class="_ _3e"> </span><span class="ffe fs1e">541</span></div><div class="t m5 x32 h3f y4a71 ff55 fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 x17f h3f y4a72 ff55 fs27 fc1 sc0 ls0 ws0">1</div><div class="t m5 x129 h3f y4a73 ff55 fs27 fc1 sc0 ls0 ws0">2</div><div class="t m5 x52 h40 y4a74 ff56 fs28 fc1 sc0 ls0 ws0">len</div><div class="t m5 x90 hd0 y4a75 ff57 fs27 fc1 sc0 ls0 ws0">len<span class="ff24"><span class="_ _80"></span><span class="ff57">1</span></span></div><div class="t m5 x19f hd0 y4a76 ff57 fs27 fc1 sc0 ls0 ws0">len</div><div class="t m5 x17 h40 y4a77 ff56 fs28 fc1 sc0 ls0 ws0">data</div><div class="t m5 x89 hd1 y4a78 ff55 fs84 fc1 sc0 ls0 ws0">. . .</div><div class="t m5 x17 h34 y4a79 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>5.3<span class="_ _c"> </span><span class="fc1">V<span class="_ _0"></span>ector<span class="_"> </span>abstract<span class="_ _11"> </span>data<span class="_ _16"> </span>type.<span class="_"> </span><span class="ff6">A<span class="_ _11"> </span>vector<span class="_ _11"> </span>is<span class="_ _11"> </span>represented<span class="_ _16"> </span>by<span class="_ _11"> </span>header<span class="_ _11"> </span>information</span></span></div><div class="t m5 x17 h34 y4a7a ff6 fs16 fc1 sc0 ls0 ws0">plus<span class="_ _10"> </span>an<span class="_ _11"> </span>array<span class="_ _10"> </span>of<span class="_ _10"> </span>designated<span class="_ _11"> </span>length.</div><div class="t m5 x204 h2c y4a7b ffa fs16 fc1 sc0 ls0 ws0">code/opt/vec.h</div><div class="t m5 x2c h2d y4a7c ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">/*<span class="_ _1f"> </span>Create<span class="_ _e"> </span>abstract<span class="_ _1f"> </span>data<span class="_ _1f"> </span>type<span class="_ _e"> </span>for<span class="_ _1f"> </span>vector<span class="_ _e"> </span>*/</span></div><div class="t m5 x2c h2d y4a7d ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">typedef<span class="_ _1f"> </span>struct<span class="_ _e"> </span>{</span></div><div class="t m5 x2c h2d y4a7e ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>len;</span></div><div class="t m5 x2c h2d y4a7f ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2">data_t<span class="_ _e"> </span>*data;</span></div><div class="t m5 x2c h2d y4a80 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _1c"> </span><span class="ffd fs1e fc2">}<span class="_ _1f"> </span>vec_rec,<span class="_ _e"> </span>*vec_ptr;</span></div><div class="t m5 x204 h2c y4a81 ffa fs16 fc2 sc0 ls0 ws0">code/opt/vec.h</div><div class="t m5 x17 h26 y4a82 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _13"> </span>declaration<span class="_ _6"> </span>uses<span class="_ _13"> </span><span class="ffd">data_t<span class="_ _a"> </span></span>to<span class="_ _13"> </span>designate<span class="_ _6"> </span>the<span class="_ _13"> </span>data<span class="_ _6"> </span>type<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _6"> </span>underlying<span class="_ _13"> </span>elements<span class="_ _3"></span>.</div><div class="t m5 x17 h26 y4a83 ff7 fs19 fc2 sc0 ls0 ws0">In<span class="_ _11"> </span>our<span class="_ _11"> </span>evaluation,<span class="_ _16"> </span>we<span class="_"> </span>measured<span class="_ _16"> </span>the<span class="_"> </span>performance<span class="_ _16"> </span>of<span class="_ _11"> </span>our<span class="_ _11"> </span>code<span class="_ _11"> </span>for<span class="_ _11"> </span>integer<span class="_ _16"> </span>(C<span class="_"> </span><span class="ffd">int</span></div><div class="t m5 x17 h26 y4a84 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_ _13"> </span><span class="ffd">long</span>),<span class="_ _13"> </span>and<span class="_ _13"> </span>ﬂoating-point<span class="_ _13"> </span>(C<span class="_ _6"> </span><span class="ffd">float<span class="_ _13"> </span></span>and<span class="_ _13"> </span><span class="ffd">double</span>)<span class="_ _13"> </span>data.<span class="_ _13"> </span>W<span class="_ _3"></span>e<span class="_ _13"> </span>do<span class="_ _6"> </span>this<span class="_ _13"> </span>by<span class="_ _13"> </span>compiling</div><div class="t m5 x17 h26 y4a85 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_ _16"> </span>running<span class="_ _16"> </span>the<span class="_ _14"> </span>program<span class="_ _16"> </span>separately<span class="_ _16"> </span>for<span class="_ _14"> </span>different<span class="_ _16"> </span>type<span class="_ _16"> </span>declarations<span class="_ _1"></span>,<span class="_ _14"> </span>such<span class="_ _14"> </span>as<span class="_ _16"> </span>the</div><div class="t m5 x17 h26 y4a86 ff7 fs19 fc2 sc0 ls0 ws0">following<span class="_"> </span>for<span class="_"> </span>data<span class="_"> </span>type<span class="_"> </span><span class="ffd">long</span>:</div><div class="t m5 x17 h2d y4a87 ffd fs1e fc2 sc0 ls0 ws0">typedef<span class="_ _e"> </span>long<span class="_ _1f"> </span>data_t;</div><div class="t m5 x17 h26 y4a88 ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _11"> </span>allocate<span class="_ _16"> </span>the<span class="_ _11"> </span>data<span class="_ _11"> </span>array<span class="_ _11"> </span>block<span class="_ _16"> </span>to<span class="_ _11"> </span>store<span class="_ _11"> </span>the<span class="_ _11"> </span>vector<span class="_ _16"> </span>elements<span class="_ _11"> </span>as<span class="_ _11"> </span>an<span class="_ _11"> </span>array<span class="_ _16"> </span>of<span class="_ _11"> </span><span class="ffd">len</span></div><div class="t m5 x17 h26 y4a89 ff7 fs19 fc2 sc0 ls0 ws0">objects<span class="_"> </span>of<span class="_"> </span>type<span class="_"> </span><span class="ffd">data_t</span>.</div><div class="t m5 x26 h26 y4a8a ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_"> </span>5.4<span class="_ _13"> </span>shows<span class="_ _13"> </span>some<span class="_ _13"> </span>basic<span class="_ _13"> </span>procedures<span class="_ _13"> </span>for<span class="_"> </span>generating<span class="_ _13"> </span>vectors<span class="_ _3"></span>,<span class="_"> </span>accessing<span class="_ _13"> </span>vec-</div><div class="t m5 x17 h26 y4a8b ff7 fs19 fc2 sc0 ls0 ws0">tor<span class="_ _13"> </span>elements<span class="_ _3"></span>,<span class="_ _13"> </span>and<span class="_ _13"> </span>determining<span class="_ _13"> </span>the<span class="_ _6"> </span>length<span class="_ _13"> </span>of<span class="_ _13"> </span>a<span class="_ _6"> </span>vector.<span class="_ _13"> </span>An<span class="_ _6"> </span>important<span class="_ _13"> </span>feature<span class="_ _13"> </span>to<span class="_ _13"> </span>note</div><div class="t m5 x17 h26 y4a8c ff7 fs19 fc2 sc0 ls0 ws0">is<span class="_ _13"> </span>that<span class="_ _13"> </span><span class="ffd">get_vec_element</span>,<span class="_ _13"> </span>the<span class="_ _6"> </span>vector<span class="_ _13"> </span>access<span class="_ _13"> </span>routine<span class="_ _1"></span>,<span class="_ _13"> </span>performs<span class="_ _13"> </span>bounds<span class="_ _13"> </span>checking<span class="_ _6"> </span>for</div><div class="t m5 x17 h26 y4a8d ff7 fs19 fc2 sc0 ls0 ws0">every<span class="_ _16"> </span>vector<span class="_ _16"> </span>reference<span class="_ _1"></span>.<span class="_ _16"> </span>T<span class="_ _0"></span>his<span class="_ _16"> </span>code<span class="_ _16"> </span>is<span class="_ _11"> </span>similar<span class="_ _16"> </span>to<span class="_ _16"> </span>the<span class="_ _16"> </span>array<span class="_ _16"> </span>representations<span class="_ _16"> </span>used<span class="_ _16"> </span>in</div><div class="t m5 x17 h26 y4a8e ff7 fs19 fc2 sc0 ls0 ws0">many<span class="_ _16"> </span>other<span class="_ _14"> </span>languages<span class="_ _1"></span>,<span class="_ _14"> </span>including<span class="_ _16"> </span>J<span class="_ _1"></span>ava.<span class="_ _16"> </span>Bounds<span class="_ _14"> </span>checking<span class="_ _16"> </span>reduces<span class="_ _14"> </span>the<span class="_ _16"> </span>chances<span class="_ _14"> </span>of</div><div class="t m5 x17 h26 y4a8f ff7 fs19 fc2 sc0 ls0 ws0">program<span class="_"> </span>error,<span class="_"> </span>but<span class="_"> </span>it<span class="_"> </span>can<span class="_"> </span>also<span class="_"> </span>slow<span class="_"> </span>down<span class="_"> </span>program<span class="_"> </span>execution.</div><div class="t m5 x26 h26 y4a90 ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_ _16"> </span>an<span class="_ _14"> </span>optimization<span class="_ _14"> </span>example<span class="_ _0"></span>,<span class="_ _14"> </span>consider<span class="_ _14"> </span>the<span class="_ _14"> </span>code<span class="_ _16"> </span>shown<span class="_ _14"> </span>in<span class="_ _14"> </span>F<span class="_ _0"></span>igure<span class="_ _14"> </span>5.5,<span class="_ _14"> </span>which</div><div class="t m5 x17 h26 y4a91 ff7 fs19 fc2 sc0 ls0 ws0">combines<span class="_ _14"> </span>all<span class="_ _14"> </span>of<span class="_ _15"> </span>the<span class="_ _14"> </span>elements<span class="_ _14"> </span>in<span class="_ _14"> </span>a<span class="_ _15"> </span>vector<span class="_ _14"> </span>into<span class="_ _14"> </span>a<span class="_ _15"> </span>single<span class="_ _14"> </span>value<span class="_ _14"> </span>according<span class="_ _15"> </span>to<span class="_ _14"> </span>some</div><div class="t m5 x17 h26 y4a92 ff7 fs19 fc2 sc0 ls0 ws0">operation.<span class="_ _15"> </span>By<span class="_ _21"> </span>using<span class="_ _21"> </span>different<span class="_ _21"> </span>deﬁnitions<span class="_ _21"> </span>of<span class="_ _21"> </span>compile-time<span class="_ _21"> </span>constants<span class="_ _21"> </span><span class="ffd">IDENT<span class="_ _21"> </span></span>and</div><div class="t m5 x17 h26 y4a93 ffd fs19 fc2 sc0 ls0 ws0">OP<span class="ff7">,<span class="_ _16"> </span>the<span class="_ _14"> </span>code<span class="_ _16"> </span>can<span class="_ _16"> </span>be<span class="_ _16"> </span>recompiled<span class="_ _16"> </span>to<span class="_ _14"> </span>perform<span class="_ _16"> </span>different<span class="_ _16"> </span>operations<span class="_ _16"> </span>on<span class="_ _16"> </span>the<span class="_ _14"> </span>data.<span class="_ _16"> </span>In</span></div><div class="t m5 x17 h26 y4a94 ff7 fs19 fc2 sc0 ls0 ws0">particular,<span class="_"> </span>using<span class="_"> </span>the<span class="_"> </span>declarations</div><div class="t m5 x17 h2d y4a95 ffd fs1e fc2 sc0 ls0 ws0">#define<span class="_ _e"> </span>IDENT<span class="_ _1f"> </span>0</div><div class="t m5 x17 h2d y4a96 ffd fs1e fc2 sc0 ls0 ws0">#define<span class="_ _e"> </span>OP<span class="_ _1a"> </span>+</div><div class="t m5 x17 h26 y4a97 ff7 fs19 fc2 sc0 ls0 ws0">it<span class="_"> </span>sums<span class="_"> </span>the<span class="_"> </span>elements<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>vector.<span class="_"> </span>Using<span class="_"> </span>the<span class="_"> </span>declarations</div><div class="t m5 x17 h2d y4a98 ffd fs1e fc2 sc0 ls0 ws0">#define<span class="_ _e"> </span>IDENT<span class="_ _1f"> </span>1</div><div class="t m5 x17 h2d y4a99 ffd fs1e fc2 sc0 ls0 ws0">#define<span class="_ _e"> </span>OP<span class="_ _1a"> </span>*</div><div class="t m5 x17 h26 y7a6 ff7 fs19 fc2 sc0 ls0 ws0">it<span class="_"> </span>computes<span class="_"> </span>the<span class="_"> </span>product<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>vector<span class="_"> </span>elements<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y7a7 ff7 fs19 fc2 sc0 ls0 ws0">In<span class="_ _16"> </span>our<span class="_ _16"> </span>presentation,<span class="_ _14"> </span>we<span class="_ _16"> </span>will<span class="_ _16"> </span>proceed<span class="_ _16"> </span>through<span class="_ _16"> </span>a<span class="_ _16"> </span>series<span class="_ _16"> </span>of<span class="_ _16"> </span>transformations<span class="_ _16"> </span>of</div><div class="t m5 x17 h26 y7a8 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>code<span class="_ _1"></span>,<span class="_"> </span>writing<span class="_ _13"> </span>different<span class="_"> </span>versions<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>combining<span class="_"> </span>function.<span class="_"> </span>T<span class="_ _7"></span>o<span class="_"> </span>gauge<span class="_ _13"> </span>progress<span class="_ _1"></span>,</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
