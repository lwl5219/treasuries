<div id="pf107" class="pf w2 h11" data-page-no="107"><div class="pc pc107 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg107.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">262<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x1d h2d y9c ffd fs1e fc2 sc0 ls0 ws0">loop:</div><div class="t m5 x10c h53 y24c2 ffa fs1e fc2 sc0 ls0 ws0">body-statement</div><div class="t m5 x10c h53 y2745 ffd fs1e fc2 sc0 ls33 ws0">t=<span class="ffa ls0">test-expr<span class="_ _2"></span><span class="ffd">;</span></span></div><div class="t m5 x10c h2d y2746 ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>(t)</div><div class="t m5 x22b h2d y2747 ffd fs1e fc2 sc0 ls0 ws0">goto<span class="_ _e"> </span>loop;</div><div class="t m5 x1d h2d y2748 ffd fs1e fc2 sc0 ls0 ws0">done:</div><div class="t m5 x1d h26 y2749 ff7 fs19 fc2 sc0 ls0 ws0">Using<span class="_ _14"> </span>this<span class="_ _14"> </span>implementation<span class="_ _14"> </span>strategy<span class="_ _3"></span>,<span class="_ _15"> </span>the<span class="_ _14"> </span>compiler<span class="_ _14"> </span>can<span class="_ _15"> </span>often<span class="_ _14"> </span>optimize<span class="_ _14"> </span>the<span class="_ _14"> </span>initial</div><div class="t m5 x1d h26 y274a ff7 fs19 fc2 sc0 ls0 ws0">test,<span class="_"> </span>for<span class="_"> </span>example<span class="_ _1"></span>,<span class="_"> </span>determining<span class="_"> </span>that<span class="_"> </span>the<span class="_"> </span>test<span class="_"> </span>condition<span class="_"> </span>will<span class="_"> </span>always<span class="_"> </span>hold.</div><div class="t m5 x29 h26 y274b ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_ _16"> </span>an<span class="_ _14"> </span>example<span class="_ _1"></span>,<span class="_ _14"> </span>Figure<span class="_ _16"> </span>3.21<span class="_ _16"> </span>shows<span class="_ _16"> </span>the<span class="_ _14"> </span>same<span class="_ _16"> </span>C<span class="_ _14"> </span>code<span class="_ _16"> </span>for<span class="_ _14"> </span>a<span class="_ _16"> </span>factorial<span class="_ _16"> </span>function</div><div class="t m5 x1d h26 y274c ff7 fs19 fc2 sc0 ls0 ws0">as<span class="_ _f"> </span>in<span class="_ _e"> </span>F<span class="_ _1"></span>igure<span class="_ _e"> </span>3.20,<span class="_ _e"> </span>but<span class="_ _f"> </span>demonstrates<span class="_ _e"> </span>the<span class="_ _f"> </span>compilation<span class="_ _e"> </span>that<span class="_ _f"> </span>occurs<span class="_ _f"> </span>when<span class="_ _e"> </span><span class="ff9">gcc<span class="_ _f"> </span></span>is</div><div class="t m5 x1d h26 y274d ff7 fs19 fc2 sc0 ls0 ws0">given<span class="_ _16"> </span>command-line<span class="_ _16"> </span>option<span class="_ _16"> </span><span class="ffd">-O1</span>.<span class="_ _16"> </span>Figure<span class="_ _16"> </span>3.21(c)<span class="_ _16"> </span>shows<span class="_ _16"> </span>the<span class="_ _16"> </span>actual<span class="_ _16"> </span>assembly<span class="_ _16"> </span>code</div><div class="t m5 x1d h26 y274e ff7 fs19 fc2 sc0 ls0 ws0">generated,<span class="_"> </span>while<span class="_"> </span>F<span class="_ _0"></span>igure<span class="_"> </span>3.21(b)<span class="_"> </span>renders<span class="_"> </span>this<span class="_"> </span>assembly<span class="_"> </span>code<span class="_"> </span>in<span class="_ _11"> </span>a<span class="_"> </span>more<span class="_"> </span>readable<span class="_"> </span>C</div><div class="t m5 x1d h26 y274f ff7 fs19 fc2 sc0 ls0 ws0">representation.<span class="_ _11"> </span>Referring<span class="_ _11"> </span>to<span class="_ _11"> </span>this<span class="_ _11"> </span>goto<span class="_ _11"> </span>code,<span class="_ _11"> </span>we<span class="_ _11"> </span>see<span class="_ _11"> </span>that<span class="_ _11"> </span>the<span class="_ _11"> </span>loop<span class="_ _11"> </span>will<span class="_ _16"> </span>be<span class="_"> </span>skipped</div><div class="t m5 x1d h46 y2750 ff7 fs19 fc2 sc0 ls0 ws0">if<span class="_ _16"> </span><span class="ff11">n<span class="_ _13"> </span><span class="ff12">≤<span class="_ _10"> </span></span></span>1<span class="_ _1"></span>,<span class="_ _16"> </span>for<span class="_ _16"> </span>the<span class="_ _16"> </span>initial<span class="_ _16"> </span>value<span class="_ _16"> </span>of<span class="_ _16"> </span><span class="ff11">n</span>.<span class="_ _11"> </span>The<span class="_ _11"> </span>loop<span class="_ _16"> </span>itself<span class="_ _16"> </span>has<span class="_ _16"> </span>the<span class="_ _11"> </span>same<span class="_ _16"> </span>general<span class="_ _16"> </span>structure</div><div class="t m5 x1d h26 y2751 ff7 fs19 fc2 sc0 ls0 ws0">as<span class="_ _15"> </span>that<span class="_ _21"> </span>generated<span class="_ _15"> </span>for<span class="_ _21"> </span>the<span class="_ _15"> </span><span class="ffd">do</span>-<span class="ffd">while<span class="_ _21"> </span></span>version<span class="_ _15"> </span>of<span class="_ _21"> </span>the<span class="_ _15"> </span>function<span class="_ _21"> </span>(F<span class="_ _0"></span>igure<span class="_ _15"> </span>3.19).<span class="_ _21"> </span>One</div><div class="t m5 x1d h26 y2752 ff7 fs19 fc2 sc0 ls0 ws0">interesting<span class="_ _16"> </span>feature,<span class="_ _14"> </span>however,<span class="_ _14"> </span>is<span class="_ _14"> </span>that<span class="_ _16"> </span>the<span class="_ _14"> </span>loop<span class="_ _14"> </span>test<span class="_ _14"> </span>(line<span class="_ _14"> </span>9<span class="_ _14"> </span>of<span class="_ _16"> </span>the<span class="_ _14"> </span>assembly<span class="_ _14"> </span>code)</div><div class="t m5 x1d h46 y2753 ff7 fs19 fc2 sc0 ls0 ws0">has<span class="_ _16"> </span>been<span class="_ _16"> </span>changed<span class="_ _14"> </span>from<span class="_ _16"> </span><span class="ff11 ls166">n&gt;</span>1<span class="_ _11"> </span>in<span class="_ _14"> </span>the<span class="_ _16"> </span>original<span class="_ _14"> </span>C<span class="_ _16"> </span>code<span class="_ _16"> </span>to<span class="_ _14"> </span><span class="ff11">n<span class="_ _10"> </span><span class="ff12">=<span class="_ _10"> </span></span></span>1<span class="_ _1"></span>.<span class="_ _14"> </span>T<span class="_ _1"></span>he<span class="_ _14"> </span>compiler<span class="_ _16"> </span>has</div><div class="t m5 x1d h26 y2754 ff7 fs19 fc2 sc0 ls0 ws0">determined<span class="_"> </span>that<span class="_"> </span>the<span class="_ _13"> </span>loop<span class="_"> </span>can<span class="_"> </span>only<span class="_"> </span>be<span class="_"> </span>entered<span class="_ _13"> </span>when<span class="_"> </span><span class="ff11 ls167">n&gt;</span>1<span class="_ _1"></span>,<span class="_"> </span>and<span class="_"> </span>that<span class="_"> </span>decrementing</div><div class="t m5 x1d h46 y2755 ff11 fs19 fc2 sc0 ls0 ws0">n<span class="_ _10"> </span><span class="ff7">will<span class="_ _13"> </span>result<span class="_"> </span>in<span class="_ _13"> </span>either<span class="_"> </span></span><span class="ls168">n&gt;<span class="ff7 ls169">1o<span class="_ _8"></span>r<span class="_ _2"></span><span class="ff11 ls0">n<span class="_ _10"> </span><span class="ff12">=<span class="_ _13"></span><span class="ff7">1<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _1"></span>herefore<span class="_ _0"></span>,<span class="_"> </span>the<span class="_ _13"> </span>test<span class="_"> </span><span class="ff11">n<span class="_ _13"> </span><span class="ff12"><span class="_ _2"></span>=<span class="_ _13"></span></span></span>1<span class="_ _13"> </span>will<span class="_"> </span>be<span class="_ _13"> </span>equivalent<span class="_"> </span>to</span></span></span></span></span></div><div class="t m5 x1d h46 y2756 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>test<span class="_"> </span><span class="ff11">n<span class="_ _13"> </span><span class="ff12">≤<span class="_ _10"> </span></span></span><span class="ls25">1.</span></div><div class="t m5 x1d h47 y2757 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>3.25<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>371)</span></div><div class="t m5 x1d h26 y2758 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_"> </span>C<span class="_"> </span>code<span class="_"> </span>having<span class="_"> </span>the<span class="_"> </span>general<span class="_"> </span>form</div><div class="t m5 x1d h2d y2759 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>loop_while2(long<span class="_ _1f"> </span>a,<span class="_ _1f"> </span>long<span class="_ _e"> </span>b)</div><div class="t m5 x1d h2d y275a ffd fs1e fc2 sc0 ls0 ws0">{</div><div class="t m5 x10c h2d y275b ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>result<span class="_ _1f"> </span>=</div><div class="t m5 x23d h2d y275c ffd fs1e fc2 sc0 ls0 ws0">;</div><div class="t m5 x10c h2d y275d ffd fs1e fc2 sc0 ls0 ws0">while<span class="_ _e"> </span>(</div><div class="t m5 x117 h2d y275e ffd fs1e fc2 sc0 ls33 ws0">){</div><div class="t m5 x22b h2d y275f ffd fs1e fc2 sc0 ls0 ws0">result<span class="_ _e"> </span>=</div><div class="t m5 x18 h2d y2760 ffd fs1e fc2 sc0 ls0 ws0">;</div><div class="t m5 x22b h2d y2761 ffd fs1e fc2 sc0 ls33 ws0">b=</div><div class="t m5 x90 h2d y2762 ffd fs1e fc2 sc0 ls0 ws0">;</div><div class="t m5 x10c h2d y2763 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x10c h2d y2764 ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>result;</div><div class="t m5 x1d h2d y2765 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x1d h26 y2766 ff9 fs19 fc2 sc0 ls0 ws0">gcc<span class="ff7">,<span class="_"> </span>run<span class="_"> </span>with<span class="_"> </span>command-line<span class="_"> </span>option<span class="_"> </span><span class="ffd">-O1</span>,<span class="_"> </span>produces<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>code:</span></div><div class="t m5 xad h61 yc40 ff13 fs35 fc6 sc0 ls0 ws0">a<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi,<span class="_ _f"> </span>b<span class="_ _e"> </span>in<span class="_ _21"> </span>%rsi</div><div class="t m5 x1f h2d yc43 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">loop_while2:</span></div><div class="t m5 x1f h2d yc47 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">testq<span class="_ _3f"> </span>%rsi,<span class="_ _e"> </span>%rsi</span></div><div class="t m5 x1f h2d y2767 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">jle<span class="_ _8c"> </span>.L8</span></div><div class="t m5 x1f h2d y2768 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rsi,<span class="_ _e"> </span>%rax</span></div><div class="t m5 x1f h2d y1c0f ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L7:</span></div><div class="t m5 x1f h2e ye14 ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 x10d h2d yd76 ffd fs1e fc2 sc0 ls0 ws0">imulq<span class="_ _3f"> </span>%rdi,<span class="_ _e"> </span>%rax</div><div class="t m5 x1f h2d yeef ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">subq<span class="_ _46"> </span>%rdi,<span class="_ _e"> </span>%rsi</span></div><div class="t m5 x1f h2d yd7a ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _45"> </span><span class="ffd fs1e fc2">testq<span class="_ _3f"> </span>%rsi,<span class="_ _e"> </span>%rsi</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
