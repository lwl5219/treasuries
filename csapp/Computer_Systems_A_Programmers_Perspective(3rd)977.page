<div id="pf3d1" class="pf w2 h11" data-page-no="3d1"><div class="pc pc3d1 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg3d1.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">976<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>11<span class="_ _3d"> </span>Network<span class="_ _10"> </span>Programming</span></div><div class="t m5 x29 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">When<span class="_ _16"> </span><span class="ffd">getaddrinfo<span class="_ _16"> </span></span>creates<span class="_ _14"> </span>an<span class="_ _16"> </span><span class="ffd">addrinfo<span class="_ _14"> </span></span>structure<span class="_ _14"> </span>in<span class="_ _16"> </span>the<span class="_ _14"> </span>output<span class="_ _16"> </span>list,<span class="_ _15"> </span>it<span class="_ _16"> </span>ﬁlls</div><div class="t m5 x1d h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">in<span class="_ _16"> </span>each<span class="_ _16"> </span>ﬁeld<span class="_ _16"> </span>except<span class="_ _16"> </span>for<span class="_ _16"> </span><span class="ffd">ai_flags</span><span class="ls2e1">.T<span class="_ _42"></span>h<span class="_ _42"></span>e<span class="ffd ls0">ai_addr<span class="_ _16"> </span><span class="ff7">ﬁeld<span class="_ _16"> </span>points<span class="_ _14"> </span>to<span class="_ _16"> </span>a<span class="_ _16"> </span>socket<span class="_ _16"> </span>address</span></span></span></div><div class="t m5 x1d h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">structure<span class="_ _1"></span>,<span class="_"> </span>the<span class="_"> </span><span class="ffd">ai_addrlen<span class="_ _13"> </span></span>ﬁeld<span class="_"> </span>gives<span class="_"> </span>the<span class="_ _13"> </span>size<span class="_"> </span>of<span class="_"> </span>this<span class="_ _13"> </span>socket<span class="_"> </span>address<span class="_"> </span>structure<span class="_ _1"></span>,<span class="_"> </span>and</div><div class="t m5 x1d h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _13"> </span><span class="ffd">ai_next<span class="_ _13"> </span></span>ﬁeld<span class="_ _13"> </span>points<span class="_ _13"> </span>to<span class="_"> </span>the<span class="_ _13"> </span>next<span class="_ _13"> </span><span class="ffd">addrinfo<span class="_ _13"> </span></span>structure<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_ _13"> </span>list.<span class="_ _13"> </span>T<span class="_ _0"></span>he<span class="_ _13"> </span>other<span class="_ _13"> </span>ﬁelds</div><div class="t m5 x1d h26 y2f8 ff7 fs19 fc2 sc0 ls0 ws0">describe<span class="_"> </span>various<span class="_"> </span>attributes<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>socket<span class="_"> </span>address<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y2f9 ff7 fs19 fc2 sc0 ls0 ws0">One<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>elegant<span class="_ _11"> </span>aspects<span class="_ _11"> </span>of<span class="_ _16"> </span><span class="ffd">getaddrinfo<span class="_ _11"> </span></span>is<span class="_ _11"> </span>that<span class="_ _16"> </span>the<span class="_ _11"> </span>ﬁelds<span class="_ _11"> </span>in<span class="_ _11"> </span>an<span class="_ _16"> </span><span class="ffd">addrinfo</span></div><div class="t m5 x1d h26 y2fa ff7 fs19 fc2 sc0 ls0 ws0">structure<span class="_ _13"> </span>are<span class="_ _13"> </span>opaque,<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_ _13"> </span>sense<span class="_ _13"> </span>that<span class="_ _13"> </span>they<span class="_"> </span>can<span class="_ _13"> </span>be<span class="_ _13"> </span>passed<span class="_ _13"> </span>directly<span class="_ _13"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>functions</div><div class="t m5 x1d h26 y2fb ff7 fs19 fc2 sc0 ls0 ws0">in<span class="_ _13"> </span>the<span class="_ _13"> </span>sockets<span class="_"> </span>interface<span class="_ _13"> </span>without<span class="_ _13"> </span>any<span class="_ _13"> </span>further<span class="_ _13"> </span>manipulation<span class="_ _13"> </span>by<span class="_"> </span>the<span class="_ _13"> </span>application<span class="_ _13"> </span>code<span class="_ _1"></span>.</div><div class="t m5 x1d h26 y2fc ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_"> </span>example<span class="_ _0"></span>,<span class="_"> </span><span class="ffd">ai_family</span>,<span class="_"> </span><span class="ffd">ai_socktype</span>,<span class="_"> </span>and<span class="_ _11"> </span><span class="ffd">ai_protocol<span class="_ _10"> </span></span>can<span class="_"> </span>be<span class="_"> </span>passed<span class="_ _11"> </span>directly</div><div class="t m5 x1b0 h26 y2fd ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_"> </span><span class="ffd">socket</span>.<span class="_"> </span>Similarly<span class="_ _7"></span>,<span class="_"> </span><span class="ffd">ai_addr<span class="_ _10"> </span></span>and<span class="_"> </span><span class="ffd">ai_addrlen<span class="_ _13"> </span></span>can<span class="_"> </span>be<span class="_"> </span>passed<span class="_"> </span>directly<span class="_"> </span>to<span class="_ _13"> </span><span class="ffd">connect</span></div><div class="t m5 x1d h26 y2fe ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_ _16"> </span><span class="ffd">bind</span>.<span class="_ _11"> </span>This<span class="_ _11"> </span>powerful<span class="_ _16"> </span>property<span class="_ _16"> </span>allows<span class="_ _11"> </span>us<span class="_ _16"> </span>to<span class="_ _16"> </span>write<span class="_ _16"> </span>clients<span class="_ _11"> </span>and<span class="_ _16"> </span>servers<span class="_ _16"> </span>that<span class="_ _16"> </span>are</div><div class="t m5 x1d h26 y2ff ff7 fs19 fc2 sc0 ls0 ws0">independent<span class="_"> </span>of<span class="_"> </span>any<span class="_"> </span>particular<span class="_"> </span>version<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>IP<span class="_"> </span>protocol.</div><div class="t m5 x1d h42 y7c61 ff6 fs29 fc6 sc0 ls0 ws0">The<span class="_ _11"> </span><span class="ffd fs2b">getnameinfo<span class="_ _16"> </span></span>Function</div><div class="t m5 x1d h26 y7c62 ff7 fs19 fc1 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _10"> </span><span class="ffd ls0">getnameinfo<span class="_ _10"> </span><span class="ff7">function<span class="_ _13"> </span>is<span class="_ _13"> </span>the<span class="_"> </span>inverse<span class="_ _13"> </span>of<span class="_ _13"> </span></span>getaddrinfo<span class="ff7">.<span class="_"> </span>It<span class="_ _13"> </span>converts<span class="_ _13"> </span>a<span class="_"> </span>socket<span class="_ _13"> </span>ad-</span></span></div><div class="t m5 x1d h26 y7c63 ff7 fs19 fc1 sc0 ls0 ws0">dress<span class="_ _6"> </span>structure<span class="_ _13"> </span>to<span class="_ _a"> </span>the<span class="_ _13"> </span>corresponding<span class="_ _6"> </span>host<span class="_ _6"> </span>and<span class="_ _13"> </span>service<span class="_ _6"> </span>name<span class="_ _6"> </span>strings<span class="_ _1"></span>.<span class="_ _13"> </span>It<span class="_ _6"> </span>is<span class="_ _6"> </span>the<span class="_ _13"> </span>modern</div><div class="t m5 x1d h26 y7c64 ff7 fs19 fc1 sc0 ls0 ws0">replacement<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>obsolete<span class="_"> </span><span class="ffd">gethostbyaddr<span class="_ _10"> </span></span>and<span class="_"> </span><span class="ffd">getservbyport<span class="_ _10"> </span></span>functions<span class="_ _1"></span>,<span class="_"> </span>and</div><div class="t m5 x1d h26 y7c65 ff7 fs19 fc1 sc0 ls0 ws0">unlike<span class="_"> </span>those<span class="_"> </span>functions<span class="_ _1"></span>,<span class="_"> </span>it<span class="_"> </span>is<span class="_"> </span>reentrant<span class="_"> </span>and<span class="_"> </span>protocol-independent.</div><div class="t m5 x126 h2d y7c66 ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;sys/socket.h&gt;</div><div class="t m5 x126 h2d y7c67 ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;netdb.h&gt;</div><div class="t m5 x126 h2d y7c68 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>getnameinfo(const<span class="_ _1f"> </span>struct<span class="_ _1f"> </span>sockaddr<span class="_ _e"> </span>*sa,<span class="_ _1f"> </span>socklen_t<span class="_ _e"> </span>salen,</div><div class="t m5 xac h2d y7c69 ffd fs1e fc2 sc0 ls0 ws0">char<span class="_ _e"> </span>*host,<span class="_ _1f"> </span>size_t<span class="_ _1f"> </span>hostlen,</div><div class="t m5 xac h2d y7c6a ffd fs1e fc2 sc0 ls0 ws0">char<span class="_ _e"> </span>*service,<span class="_ _1f"> </span>size_t<span class="_ _1f"> </span>servlen,<span class="_ _e"> </span>int<span class="_ _1f"> </span>flags);</div><div class="t m5 x254 hf1 y7c6b ff7 fs1f fc2 sc0 ls0 ws0">Returns:<span class="_"> </span>0<span class="_"> </span>if<span class="_"> </span>OK,<span class="_"> </span>nonzero<span class="_"> </span>error<span class="_"> </span>code<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m5 x1d h26 y7c6c ff7 fs19 fc2 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _14"> </span><span class="ffd ls0">sa<span class="_ _14"> </span><span class="ff7">argument<span class="_ _16"> </span>points<span class="_ _16"> </span>to<span class="_ _16"> </span>a<span class="_ _16"> </span>socket<span class="_ _14"> </span>address<span class="_ _16"> </span>structure<span class="_ _16"> </span>of<span class="_ _16"> </span>size<span class="_ _14"> </span></span>salen<span class="_ _16"> </span><span class="ff7">bytes<span class="_ _1"></span>,<span class="_ _14"> </span><span class="ffd">host</span></span></span></div><div class="t m5 x1d h26 y7c6d ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_"> </span>a<span class="_ _11"> </span>buffer<span class="_ _11"> </span>of<span class="_ _11"> </span>size<span class="_ _11"> </span><span class="ffd">hostlen<span class="_ _11"> </span></span>bytes<span class="_ _1"></span>,<span class="_ _11"> </span>and<span class="_ _11"> </span><span class="ffd">service<span class="_ _11"> </span></span>to<span class="_ _11"> </span>a<span class="_ _11"> </span>buffer<span class="_"> </span>of<span class="_ _11"> </span>size<span class="_ _11"> </span><span class="ffd">servlen<span class="_ _11"> </span></span>bytes<span class="_ _1"></span>.</div><div class="t m5 x1d h26 y7c6e ff7 fs19 fc2 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _11"> </span><span class="ffd ls0">getnameinfo<span class="_ _11"> </span><span class="ff7">function<span class="_"> </span>converts<span class="_"> </span>the<span class="_"> </span>socket<span class="_"> </span>address<span class="_"> </span>structure<span class="_"> </span></span>sa<span class="_ _11"> </span><span class="ff7">to<span class="_"> </span>the<span class="_"> </span>corre-</span></span></div><div class="t m5 x1d h26 y7c6f ff7 fs19 fc2 sc0 ls0 ws0">sponding<span class="_"> </span>host<span class="_ _13"> </span>and<span class="_"> </span>service<span class="_ _13"> </span>name<span class="_"> </span>strings<span class="_ _13"> </span>and<span class="_"> </span>copies<span class="_ _13"> </span>them<span class="_"> </span>to<span class="_"> </span>the<span class="_ _13"> </span><span class="ffd">host<span class="_ _10"> </span></span>and<span class="_ _13"> </span><span class="ffd">service</span></div><div class="t m5 x1d h26 y7c70 ff7 fs19 fc2 sc0 ls0 ws0">buffers<span class="_ _1"></span>.<span class="_ _13"> </span>If<span class="_"> </span><span class="ffd">getnameinfo<span class="_ _13"> </span></span>returns<span class="_ _13"> </span>a<span class="_"> </span>nonzero<span class="_ _13"> </span>error<span class="_ _13"> </span>code,<span class="_ _13"> </span>the<span class="_ _13"> </span>application<span class="_"> </span>can<span class="_ _13"> </span>convert</div><div class="t m5 x1d h26 y7c71 ff7 fs19 fc2 sc0 ls0 ws0">it<span class="_"> </span>to<span class="_"> </span>a<span class="_"> </span>string<span class="_"> </span>by<span class="_"> </span>calling<span class="_"> </span><span class="ffd">gai_strerror</span>.</div><div class="t m5 x29 h26 y7c72 ff7 fs19 fc2 sc0 ls0 ws0">If<span class="_ _13"> </span>we<span class="_ _6"> </span>don’t<span class="_ _6"> </span>want<span class="_ _13"> </span>the<span class="_ _6"> </span>hostname,<span class="_ _13"> </span>we<span class="_ _6"> </span>can<span class="_ _13"> </span>set<span class="_ _6"> </span><span class="ffd">host<span class="_ _13"> </span></span>to<span class="_ _13"> </span>NULL<span class="_ _6"> </span>and<span class="_ _13"> </span><span class="ffd">hostlen<span class="_ _6"> </span></span>to<span class="_ _13"> </span>zero<span class="_ _1"></span>.</div><div class="t m5 x1d h26 y7c73 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>same<span class="_"> </span>holds<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>service<span class="_"> </span>ﬁelds<span class="_ _1"></span>.<span class="_"> </span>However,<span class="_"> </span>one<span class="_"> </span>or<span class="_"> </span>the<span class="_"> </span>other<span class="_"> </span>must<span class="_"> </span>be<span class="_"> </span>set.</div><div class="t m5 x29 h26 y7c74 ff7 fs19 fc2 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _15"> </span><span class="ffd ls0">flags<span class="_ _14"> </span><span class="ff7">argument<span class="_ _15"> </span>is<span class="_ _14"> </span>a<span class="_ _14"> </span>bit<span class="_ _14"> </span>mask<span class="_ _14"> </span>that<span class="_ _15"> </span>modiﬁes<span class="_ _14"> </span>the<span class="_ _14"> </span>default<span class="_ _14"> </span>behavior.<span class="_ _14"> </span>Y<span class="_ _3"></span>ou</span></span></div><div class="t m5 x1d h26 y7c75 ff7 fs19 fc2 sc0 ls0 ws0">create<span class="_ _14"> </span>it<span class="_ _15"> </span>by<span class="_ _15"> </span><span class="ff9">or</span>ing<span class="_ _15"> </span>combinations<span class="_ _14"> </span>of<span class="_ _15"> </span>various<span class="_ _15"> </span>values<span class="_ _1"></span>.<span class="_ _15"> </span>Here<span class="_ _14"> </span>are<span class="_ _15"> </span>a<span class="_ _15"> </span>couple<span class="_ _14"> </span>of<span class="_ _15"> </span>useful</div><div class="t m5 x1d h26 y7c76 ff7 fs19 fc2 sc0 ls0 ws0">ones:</div><div class="t m5 x23a h26 y7c77 ff7 fs19 fc2 sc0 ls0 ws0">NI_NUMERICHOST<span class="_ _3"></span>.<span class="_ _e"> </span>By<span class="_ _13"> </span>default,<span class="_ _13"> </span><span class="ffd">getnameinfo<span class="_ _6"> </span></span>tries<span class="_ _13"> </span>to<span class="_ _13"> </span>return<span class="_ _6"> </span>a<span class="_ _13"> </span>domain<span class="_ _6"> </span>name</div><div class="t m5 xcd h26 y7c78 ff7 fs19 fc2 sc0 ls0 ws0">in<span class="_ _11"> </span><span class="ffd">host</span>.<span class="_ _16"> </span>Setting<span class="_ _16"> </span>this<span class="_ _11"> </span>ﬂag<span class="_ _16"> </span>will<span class="_ _16"> </span>cause<span class="_ _11"> </span>it<span class="_ _16"> </span>to<span class="_ _11"> </span>return<span class="_ _16"> </span>a<span class="_ _16"> </span>numeric<span class="_ _11"> </span>address<span class="_ _16"> </span>string</div><div class="t m5 xcd h26 y7c79 ff7 fs19 fc2 sc0 ls0 ws0">instead.</div><div class="t m5 x23a h26 y7c7a ff7 fs19 fc2 sc0 ls0 ws0">NI_NUMERICSER<span class="_ _3"></span>V<span class="_ _7"></span>.<span class="_ _1f"> </span>By<span class="_ _16"> </span>default,<span class="_ _15"> </span><span class="ffd">getnameinfo<span class="_ _15"> </span></span>will<span class="_ _14"> </span>look<span class="_ _14"> </span>in<span class="_ _14"> </span><span class="ffd">/etc/services</span></div><div class="t m5 xcd h26 y7c7b ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_ _16"> </span>if<span class="_ _11"> </span>possible,<span class="_ _11"> </span>return<span class="_ _16"> </span>a<span class="_ _16"> </span>service<span class="_ _11"> </span>name<span class="_ _16"> </span>instead<span class="_ _16"> </span>of<span class="_ _11"> </span>a<span class="_ _16"> </span>port<span class="_ _16"> </span>number<span class="_ _0"></span>.<span class="_ _11"> </span>Setting</div><div class="t m5 xcd h26 y7c7c ff7 fs19 fc2 sc0 ls0 ws0">this<span class="_"> </span>ﬂag<span class="_"> </span>forces<span class="_"> </span>it<span class="_"> </span>to<span class="_"> </span>skip<span class="_"> </span>the<span class="_"> </span>lookup<span class="_"> </span>and<span class="_"> </span>simply<span class="_"> </span>return<span class="_"> </span>the<span class="_"> </span>port<span class="_"> </span>number.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
