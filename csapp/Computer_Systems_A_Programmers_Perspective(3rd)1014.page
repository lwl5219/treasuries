<div id="pf3f6" class="pf w2 h11" data-page-no="3f6"><div class="pc pc3f6 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg3f6.png"/><div class="t m5 x125 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>12.2<span class="_ _60"> </span>Concurrent<span class="_ _10"> </span>Programming<span class="_ _10"> </span>with<span class="_ _10"> </span>I/O<span class="_ _10"> </span>Multiplexing<span class="_ _3e"> </span><span class="ffe fs1e">1013</span></div><div class="t m5 x34 h2a y257 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">Unix<span class="_ _11"> </span>IPC</span></div><div class="t m5 x62 h2b y2d0 ff7 fs1e fc2 sc0 ls0 ws0">Y<span class="_ _3"></span>ou<span class="_"> </span>have<span class="_ _13"> </span>already<span class="_"> </span>encountered<span class="_"> </span>several<span class="_ _13"> </span>examples<span class="_"> </span>of<span class="_ _13"> </span>IPC<span class="_"> </span>in<span class="_"> </span>this<span class="_ _13"> </span>text.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span><span class="ffd">waitpid<span class="_ _10"> </span></span>function<span class="_ _13"> </span>and<span class="_"> </span>signals</div><div class="t m5 x34 h2b y2d1 ff7 fs1e fc2 sc0 ls0 ws0">from<span class="_"> </span>Chapter<span class="_"> </span>8<span class="_ _13"> </span>are<span class="_"> </span>primitive<span class="_"> </span>IPC<span class="_ _13"> </span>mechanisms<span class="_"> </span>that<span class="_"> </span>allow<span class="_ _13"> </span>processes<span class="_"> </span>to<span class="_"> </span>send<span class="_ _13"> </span>tiny<span class="_"> </span>messages<span class="_"> </span>to<span class="_ _13"> </span>processes</div><div class="t m5 x34 h2b y2d2 ff7 fs1e fc2 sc0 ls0 ws0">running<span class="_ _16"> </span>on<span class="_ _16"> </span>the<span class="_ _16"> </span>same<span class="_ _16"> </span>host.<span class="_ _14"> </span>T<span class="_ _1"></span>he<span class="_ _14"> </span>sockets<span class="_ _16"> </span>interface<span class="_ _16"> </span>from<span class="_ _16"> </span>Chapter<span class="_ _16"> </span>11<span class="_ _14"> </span>is<span class="_ _16"> </span>an<span class="_ _16"> </span>important<span class="_ _16"> </span>form<span class="_ _16"> </span>of<span class="_ _14"> </span>IPC<span class="_ _16"> </span>that</div><div class="t m5 x34 h2b y2d3 ff7 fs1e fc2 sc0 ls0 ws0">allows<span class="_ _11"> </span>processes<span class="_ _11"> </span>on<span class="_ _11"> </span>different<span class="_ _11"> </span>hosts<span class="_ _11"> </span>to<span class="_ _11"> </span>exchange<span class="_ _11"> </span>arbitrary<span class="_ _11"> </span>byte<span class="_ _11"> </span>streams<span class="_ _1"></span>.<span class="_ _11"> </span>However,<span class="_ _11"> </span>the<span class="_ _11"> </span>term<span class="_ _11"> </span><span class="ffa">Unix<span class="_ _11"> </span>IPC</span></div><div class="t m5 x34 h2b y2d4 ff7 fs1e fc2 sc0 ls0 ws0">is<span class="_ _10"> </span>typically<span class="_ _11"> </span>reserved<span class="_ _11"> </span>for<span class="_ _11"> </span>a<span class="_ _10"> </span>hodgepodge<span class="_ _11"> </span>of<span class="_ _11"> </span>techniques<span class="_ _11"> </span>that<span class="_ _10"> </span>allow<span class="_ _11"> </span>processes<span class="_ _11"> </span>to<span class="_ _10"> </span>communicate<span class="_ _11"> </span>with<span class="_ _11"> </span>other</div><div class="t m5 x34 h2b y2d5 ff7 fs1e fc2 sc0 ls0 ws0">processes<span class="_ _13"> </span>that<span class="_ _6"> </span>are<span class="_ _13"> </span>running<span class="_ _6"> </span>on<span class="_ _13"> </span>the<span class="_ _13"> </span>same<span class="_ _6"> </span>host.<span class="_ _13"> </span>Examples<span class="_ _6"> </span>include<span class="_ _13"> </span>pipes<span class="_ _1"></span>,<span class="_ _13"> </span>FIFOs<span class="_ _1"></span>,<span class="_ _13"> </span>System<span class="_ _13"> </span>V<span class="_ _6"> </span>shared<span class="_ _13"> </span>memory<span class="_ _7"></span>,</div><div class="t m5 x34 h2b y2d6 ff7 fs1e fc2 sc0 ls0 ws0">and<span class="_ _11"> </span>System<span class="_ _11"> </span>V<span class="_ _11"> </span>semaphores<span class="_ _1"></span>.<span class="_ _11"> </span>These<span class="_"> </span>mechanisms<span class="_ _11"> </span>are<span class="_ _11"> </span>beyond<span class="_ _11"> </span>our<span class="_ _11"> </span>scope.<span class="_ _10"> </span>The<span class="_ _10"> </span>book<span class="_ _11"> </span>by<span class="_ _11"> </span>Kerrisk<span class="_ _11"> </span>[62]<span class="_ _11"> </span>is<span class="_ _11"> </span>an</div><div class="t m5 x34 h2b y549 ff7 fs1e fc2 sc0 ls0 ws0">excellent<span class="_"> </span>reference<span class="_ _1"></span>.</div><div class="t m5 x17 h3b y7f38 fff fs24 fc6 sc0 ls0 ws0">12.2<span class="_ _17"> </span><span class="ffe fs18">Concurrent<span class="_"> </span>Programming<span class="_"> </span>with<span class="_"> </span>I/O<span class="_"> </span>Multiplexing</span></div><div class="t m5 x17 h26 y7f39 ff7 fs19 fc1 sc0 ls0 ws0">Suppose<span class="_ _13"> </span>you<span class="_ _13"> </span>are<span class="_ _13"> </span>asked<span class="_ _13"> </span>to<span class="_ _13"> </span>write<span class="_ _13"> </span>an<span class="_ _13"> </span>echo<span class="_ _13"> </span>server<span class="_ _13"> </span>that<span class="_ _13"> </span>can<span class="_ _13"> </span>also<span class="_ _13"> </span>respond<span class="_ _13"> </span>to<span class="_ _13"> </span>interactive</div><div class="t m5 x17 h26 y7f3a ff7 fs19 fc1 sc0 ls0 ws0">commands<span class="_ _15"> </span>that<span class="_ _15"> </span>the<span class="_ _15"> </span>user<span class="_ _21"> </span>types<span class="_ _15"> </span>to<span class="_ _15"> </span>standard<span class="_ _21"> </span>input.<span class="_ _15"> </span>In<span class="_ _15"> </span>this<span class="_ _15"> </span>case,<span class="_ _21"> </span>the<span class="_ _15"> </span>server<span class="_ _15"> </span>must</div><div class="t m5 x17 h26 y7f3b ff7 fs19 fc1 sc0 ls0 ws0">respond<span class="_ _13"> </span>to<span class="_ _13"> </span>two<span class="_"> </span>independent<span class="_ _13"> </span>I/O<span class="_ _13"> </span>events:<span class="_ _13"> </span>(1)<span class="_"> </span>a<span class="_ _13"> </span>network<span class="_ _13"> </span>client<span class="_ _13"> </span>making<span class="_"> </span>a<span class="_ _13"> </span>connection</div><div class="t m5 x17 h26 y7f3c ff7 fs19 fc1 sc0 ls0 ws0">request,<span class="_ _f"> </span>and<span class="_ _21"> </span>(2)<span class="_ _21"> </span>a<span class="_ _21"> </span>user<span class="_ _15"> </span>typing<span class="_ _21"> </span>a<span class="_ _21"> </span>command<span class="_ _21"> </span>line<span class="_ _21"> </span>at<span class="_ _21"> </span>the<span class="_ _21"> </span>keyboard.<span class="_ _21"> </span>Which<span class="_ _15"> </span>event</div><div class="t m5 x17 h26 y7f3d ff7 fs19 fc1 sc0 ls0 ws0">do<span class="_ _16"> </span>we<span class="_ _14"> </span>wait<span class="_ _16"> </span>for<span class="_ _14"> </span>ﬁrst?<span class="_ _16"> </span>Neither<span class="_ _16"> </span>option<span class="_ _14"> </span>is<span class="_ _16"> </span>ideal.<span class="_ _14"> </span>If<span class="_ _16"> </span>we<span class="_ _14"> </span>are<span class="_ _16"> </span>waiting<span class="_ _14"> </span>for<span class="_ _16"> </span>a<span class="_ _14"> </span>connection</div><div class="t m5 x17 h26 y7f3e ff7 fs19 fc1 sc0 ls0 ws0">request<span class="_ _13"> </span>in<span class="_ _6"> </span><span class="ffd">accept</span>,<span class="_ _13"> </span>then<span class="_ _13"> </span>we<span class="_ _13"> </span>cannot<span class="_ _6"> </span>respond<span class="_ _13"> </span>to<span class="_ _13"> </span>input<span class="_ _13"> </span>commands<span class="_ _3"></span>.<span class="_ _13"> </span>Similarly<span class="_ _7"></span>,<span class="_ _13"> </span>if<span class="_ _13"> </span>we<span class="_ _13"> </span>are</div><div class="t m5 x17 h26 y7f3f ff7 fs19 fc1 sc0 ls0 ws0">waiting<span class="_ _13"> </span>for<span class="_ _13"> </span>an<span class="_"> </span>input<span class="_ _13"> </span>command<span class="_ _13"> </span>in<span class="_ _13"> </span><span class="ffd">read</span>,<span class="_ _13"> </span>then<span class="_"> </span>we<span class="_ _13"> </span>cannot<span class="_ _13"> </span>respond<span class="_ _13"> </span>to<span class="_ _13"> </span>any<span class="_ _13"> </span>connection</div><div class="t m5 x17 h26 y7f40 ff7 fs19 fc1 sc0 ls0 ws0">requests<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y7f41 ff7 fs19 fc1 sc0 ls0 ws0">One<span class="_ _13"> </span>solution<span class="_ _13"> </span>to<span class="_ _13"> </span>this<span class="_ _13"> </span>dilemma<span class="_ _13"> </span>is<span class="_ _13"> </span>a<span class="_ _13"> </span>technique<span class="_ _13"> </span>called<span class="_ _13"> </span><span class="ffa">I/O<span class="_ _13"> </span>multiplexing<span class="_ _2"></span></span>.<span class="_ _13"> </span>T<span class="_ _0"></span>he<span class="_ _13"> </span>basic</div><div class="t m5 x17 h26 y7f42 ff7 fs19 fc1 sc0 ls0 ws0">idea<span class="_ _13"> </span>is<span class="_ _13"> </span>to<span class="_ _13"> </span>use<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ffd">select<span class="_ _13"> </span></span>function<span class="_ _13"> </span>to<span class="_"> </span>ask<span class="_ _13"> </span>the<span class="_ _13"> </span>kernel<span class="_ _13"> </span>to<span class="_ _13"> </span>suspend<span class="_ _13"> </span>the<span class="_ _13"> </span>process<span class="_ _3"></span>,<span class="_"> </span>return-</div><div class="t m5 x17 h26 y7f43 ff7 fs19 fc1 sc0 ls0 ws0">ing<span class="_"> </span>control<span class="_ _13"> </span>to<span class="_"> </span>the<span class="_ _13"> </span>application<span class="_"> </span>only<span class="_ _13"> </span>after<span class="_"> </span>one<span class="_ _13"> </span>or<span class="_"> </span>more<span class="_ _13"> </span>I/O<span class="_"> </span>events<span class="_ _13"> </span>have<span class="_"> </span>occurred,<span class="_ _13"> </span>as</div><div class="t m5 x17 h26 y7f44 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>examples:</div><div class="t m5 x72 h3d y7f45 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h46 y2ff7 ff7 fs19 fc1 sc0 ls0 ws0">Return<span class="_"> </span>when<span class="_"> </span>any<span class="_"> </span>descriptor<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>set<span class="_"> </span><span class="ff12">{</span>0<span class="ff11">,<span class="_ _10"> </span></span>4<span class="ff12">}<span class="_ _10"> </span></span>is<span class="_"> </span>ready<span class="_"> </span>for<span class="_"> </span>reading<span class="_ _0"></span>.</div><div class="t m5 x72 h3d y7f46 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h46 y7f47 ff7 fs19 fc1 sc0 ls0 ws0">Return<span class="_"> </span>when<span class="_"> </span>any<span class="_"> </span>descriptor<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>set<span class="_"> </span><span class="ff12">{</span>1<span class="_ _1"></span><span class="ff11">,<span class="_ _10"> </span><span class="ff7">2</span>,<span class="_ _13"> </span><span class="ff7">7<span class="ff12">}<span class="_ _10"> </span></span>is<span class="_"> </span>ready<span class="_"> </span>for<span class="_"> </span>writing.</span></span></div><div class="t m5 x72 h3d y7f48 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y7f49 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>ime<span class="_"> </span>out<span class="_"> </span>if<span class="_"> </span>152<span class="ff11">.</span>13<span class="_"> </span>seconds<span class="_"> </span>have<span class="_"> </span>elapsed<span class="_"> </span>waiting<span class="_"> </span>for<span class="_"> </span>an<span class="_"> </span>I/O<span class="_"> </span>event<span class="_"> </span>to<span class="_"> </span>occur<span class="_ _0"></span>.</div><div class="t m5 x26 h26 y7f4a ffd fs19 fc1 sc0 ls0 ws0">Select<span class="_ _14"> </span><span class="ff7">is<span class="_ _15"> </span>a<span class="_ _15"> </span>complicated<span class="_ _15"> </span>function<span class="_ _14"> </span>with<span class="_ _15"> </span>many<span class="_ _15"> </span>different<span class="_ _15"> </span>usage<span class="_ _14"> </span>scenarios<span class="_ _1"></span>.<span class="_ _15"> </span>W<span class="_ _1"></span>e</span></div><div class="t m5 x17 h26 y7f4b ff7 fs19 fc1 sc0 ls0 ws0">will<span class="_"> </span>only<span class="_"> </span>discuss<span class="_ _11"> </span>the<span class="_"> </span>ﬁrst<span class="_ _11"> </span>scenario:<span class="_"> </span>waiting<span class="_ _11"> </span>for<span class="_"> </span>a<span class="_ _11"> </span>set<span class="_"> </span>of<span class="_ _11"> </span>descriptors<span class="_"> </span>to<span class="_"> </span>be<span class="_ _11"> </span>ready<span class="_"> </span>for</div><div class="t m5 x17 h26 y7f4c ff7 fs19 fc1 sc0 ls0 ws0">reading.<span class="_"> </span>See<span class="_"> </span>[62,<span class="_"> </span>110]<span class="_"> </span>for<span class="_"> </span>a<span class="_"> </span>complete<span class="_"> </span>discussion.</div><div class="t m5 x31 h2d y7f4d ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;sys/select.h&gt;</div><div class="t m5 x31 h2d y7f4e ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>select(int<span class="_ _1f"> </span>n,<span class="_ _1f"> </span>fd_set<span class="_ _e"> </span>*fdset,<span class="_ _1f"> </span>NULL,<span class="_ _e"> </span>NULL,<span class="_ _1f"> </span>NULL);</div><div class="t m5 x76 hf2 y7f4f ff7 fs1f fc2 sc0 ls0 ws0">Returns:<span class="_"> </span>nonzero<span class="_"> </span>count<span class="_"> </span>of<span class="_"> </span>ready<span class="_"> </span>descriptors<span class="_ _1"></span>,<span class="_"> </span><span class="ff12">−</span>1<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m5 x31 h2d y7f50 ffd fs1e fc2 sc0 ls0 ws0">FD_ZERO(fd_set<span class="_ _e"> </span>*fdset);<span class="_ _6b"> </span>/*<span class="_ _1f"> </span>Clear<span class="_ _e"> </span>all<span class="_ _1f"> </span>bits<span class="_ _1f"> </span>in<span class="_ _e"> </span>fdset<span class="_ _1f"> </span>*/</div><div class="t m5 x31 h2d y7f51 ffd fs1e fc2 sc0 ls0 ws0">FD_CLR(int<span class="_ _e"> </span>fd,<span class="_ _1f"> </span>fd_set<span class="_ _1f"> </span>*fdset);<span class="_ _7b"> </span>/*<span class="_ _1f"> </span>Clear<span class="_ _1f"> </span>bit<span class="_ _e"> </span>fd<span class="_ _1f"> </span>in<span class="_ _e"> </span>fdset<span class="_ _1f"> </span>*/</div><div class="t m5 x31 h2d y7f52 ffd fs1e fc2 sc0 ls0 ws0">FD_SET(int<span class="_ _e"> </span>fd,<span class="_ _1f"> </span>fd_set<span class="_ _1f"> </span>*fdset);<span class="_ _7b"> </span>/*<span class="_ _1f"> </span>Turn<span class="_ _1f"> </span>on<span class="_ _e"> </span>bit<span class="_ _1f"> </span>fd<span class="_ _e"> </span>in<span class="_ _1f"> </span>fdset<span class="_ _1f"> </span>*/</div><div class="t m5 x31 h2d y7f53 ffd fs1e fc2 sc0 ls0 ws0">FD_ISSET(int<span class="_ _e"> </span>fd,<span class="_ _1f"> </span>fd_set<span class="_ _1f"> </span>*fdset);<span class="_ _3b"> </span>/*<span class="_ _1f"> </span>Is<span class="_ _1f"> </span>bit<span class="_ _e"> </span>fd<span class="_ _1f"> </span>in<span class="_ _e"> </span>fdset<span class="_ _1f"> </span>on?<span class="_ _1f"> </span>*/</div><div class="t m5 x23d hf1 y7f54 ff7 fs1f fc2 sc0 ls0 ws0">Macros<span class="_"> </span>for<span class="_"> </span>manipulating<span class="_"> </span>descriptor<span class="_"> </span>sets</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
