<div id="pf18c" class="pf w2 h11" data-page-no="18c"><div class="pc pc18c w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg18c.png"/><div class="t m5 xfc h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>4.1<span class="_ _60"> </span>The<span class="_ _10"> </span>Y86-64<span class="_ _10"> </span>Instruction<span class="_ _10"> </span>Set<span class="_ _10"> </span>Architecture<span class="_ _1b"> </span><span class="ffe fs1e">395</span></div><div class="t m5 x17 h31 y390 ff7 fs21 fc2 sc0 ls0 ws0">Number<span class="_ _26"> </span>Register<span class="_"> </span>name<span class="_ _20"> </span>Number<span class="_ _26"> </span>Register<span class="_"> </span>name</div><div class="t m5 x63 h2d yc94 ffd fs1e fc2 sc0 ls0 ws0">0<span class="_ _69"> </span>%rax<span class="_ _e4"> </span>8<span class="_ _31"> </span>%r8</div><div class="t m5 x63 h2d y1031 ffd fs1e fc2 sc0 ls0 ws0">1<span class="_ _69"> </span>%rcx<span class="_ _e4"> </span>9<span class="_ _31"> </span>%r9</div><div class="t m5 x63 h2d y3727 ffd fs1e fc2 sc0 ls0 ws0">2<span class="_ _69"> </span>%rdx<span class="_ _e4"> </span>A<span class="_ _69"> </span>%r10</div><div class="t m5 x63 h2d y3728 ffd fs1e fc2 sc0 ls0 ws0">3<span class="_ _69"> </span>%rbx<span class="_ _e4"> </span>B<span class="_ _69"> </span>%r11</div><div class="t m5 x63 h2d y3729 ffd fs1e fc2 sc0 ls0 ws0">4<span class="_ _69"> </span>%rsp<span class="_ _e4"> </span>C<span class="_ _69"> </span>%r12</div><div class="t m5 x63 h2d y372a ffd fs1e fc2 sc0 ls0 ws0">5<span class="_ _69"> </span>%rbp<span class="_ _e4"> </span>D<span class="_ _69"> </span>%r13</div><div class="t m5 x63 h2d y372b ffd fs1e fc2 sc0 ls0 ws0">6<span class="_ _69"> </span>%rsi<span class="_ _e4"> </span>E<span class="_ _69"> </span>%r14</div><div class="t m5 x63 h2d y372c ffd fs1e fc2 sc0 ls0 ws0">7<span class="_ _69"> </span>%rdi<span class="_ _e4"> </span>F</div><div class="t m5 x17c h31 y1036 ff7 fs21 fc2 sc0 ls0 ws0">No<span class="_"> </span>register</div><div class="t m5 x17 h34 y1037 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _16"> </span>4.4<span class="_ _c"> </span><span class="fc1">Y86-64<span class="_ _14"> </span>program<span class="_ _14"> </span>register<span class="_ _16"> </span>identiﬁers.<span class="_ _14"> </span><span class="ff6">Each<span class="_ _14"> </span>of<span class="_ _16"> </span>the<span class="_ _14"> </span>15<span class="_ _14"> </span>program<span class="_ _16"> </span>registers</span></span></div><div class="t m5 x17 h34 y1038 ff6 fs16 fc1 sc0 ls0 ws0">has<span class="_ _11"> </span>an<span class="_ _11"> </span>associated<span class="_ _16"> </span>identiﬁer<span class="_ _11"> </span>(ID)<span class="_ _11"> </span>ranging<span class="_ _16"> </span>from</div><div class="t m5 xe3 h3a y372d ffd fs19 fc1 sc0 ls0 ws0">0<span class="_ _11"> </span><span class="ff6 fs16">to<span class="_ _11"> </span></span>0xE<span class="ff6 fs16 ls1ac">.I<span class="_ _49"></span>D<span class="ffd fs19 ls0">0xF<span class="_ _16"> </span></span><span class="ls0">in<span class="_ _11"> </span>a<span class="_ _11"> </span>register<span class="_ _16"> </span>ﬁeld<span class="_ _11"> </span>of<span class="_ _11"> </span>an</span></span></div><div class="t m5 x17 h34 y372e ff6 fs16 fc1 sc0 ls0 ws0">instruction<span class="_ _10"> </span>indicates<span class="_ _11"> </span>the<span class="_ _10"> </span>absence<span class="_ _10"> </span>of<span class="_ _11"> </span>a<span class="_ _10"> </span>register<span class="_ _11"> </span>operand.</div><div class="t m5 x17 h26 y682 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _11"> </span>other<span class="_ _11"> </span>register<span class="_ _16"> </span>speciﬁer<span class="_ _11"> </span>set<span class="_ _11"> </span>to<span class="_ _16"> </span>value<span class="_"> </span><span class="ffd">0xF</span>.<span class="_ _16"> </span>T<span class="_ _1"></span>his<span class="_ _11"> </span>convention<span class="_ _16"> </span>will<span class="_ _11"> </span>prove<span class="_ _11"> </span>useful<span class="_ _16"> </span>in</div><div class="t m5 x17 h26 y683 ff7 fs19 fc1 sc0 ls0 ws0">our<span class="_"> </span>processor<span class="_"> </span>implementation.</div><div class="t m5 x26 h26 y684 ff7 fs19 fc1 sc0 ls0 ws0">Some<span class="_"> </span>instructions<span class="_"> </span>require<span class="_"> </span>an<span class="_"> </span>additional<span class="_"> </span>8-byte<span class="_ _11"> </span><span class="ffa">constant<span class="_"> </span>word</span>.<span class="_"> </span>This<span class="_"> </span>word<span class="_"> </span>can</div><div class="t m5 x17 h26 y685 ff7 fs19 fc1 sc0 ls0 ws0">serve<span class="_"> </span>as<span class="_ _13"> </span>the<span class="_"> </span>immediate<span class="_ _13"> </span>data<span class="_"> </span>for<span class="_"> </span><span class="ffd">irmovq</span>,<span class="_ _13"> </span>the<span class="_"> </span>displacement<span class="_ _13"> </span>for<span class="_"> </span><span class="ffd">rmmovq<span class="_ _10"> </span></span>and<span class="_ _13"> </span><span class="ffd">mrmovq</span></div><div class="t m5 x17 h26 y686 ff7 fs19 fc1 sc0 ls0 ws0">address<span class="_ _13"> </span>speciﬁers<span class="_ _1"></span>,<span class="_"> </span>and<span class="_ _13"> </span>the<span class="_ _13"> </span>destination<span class="_ _13"> </span>of<span class="_ _13"> </span>branches<span class="_ _13"> </span>and<span class="_"> </span>calls<span class="_ _3"></span>.<span class="_ _13"> </span>Note<span class="_"> </span>that<span class="_ _13"> </span>branch<span class="_ _13"> </span>and</div><div class="t m5 x17 h26 y687 ff7 fs19 fc1 sc0 ls0 ws0">call<span class="_ _13"> </span>destinations<span class="_ _13"> </span>are<span class="_ _13"> </span>given<span class="_ _13"> </span>as<span class="_ _13"> </span>absolute<span class="_ _13"> </span>addresses<span class="_ _1"></span>,<span class="_ _13"> </span>rather<span class="_ _13"> </span>than<span class="_ _13"> </span>using<span class="_ _13"> </span>the<span class="_ _13"> </span>PC-relative</div><div class="t m5 x17 h26 y688 ff7 fs19 fc1 sc0 ls0 ws0">addressing<span class="_ _15"> </span>seen<span class="_ _15"> </span>in<span class="_ _15"> </span>x86-64.<span class="_ _15"> </span>Processors<span class="_ _15"> </span>use<span class="_ _15"> </span>PC-relative<span class="_ _15"> </span>addressing<span class="_ _15"> </span>to<span class="_ _15"> </span>give<span class="_ _21"> </span>more</div><div class="t m5 x17 h26 y689 ff7 fs19 fc1 sc0 ls0 ws0">compact<span class="_ _16"> </span>encodings<span class="_ _14"> </span>of<span class="_ _16"> </span>branch<span class="_ _14"> </span>instructions<span class="_ _16"> </span>and<span class="_ _14"> </span>to<span class="_ _16"> </span>allow<span class="_ _14"> </span>code<span class="_ _16"> </span>to<span class="_ _14"> </span>be<span class="_ _16"> </span>shifted<span class="_ _14"> </span>from</div><div class="t m5 x17 h26 y68a ff7 fs19 fc1 sc0 ls0 ws0">one<span class="_ _13"> </span>part<span class="_ _13"> </span>of<span class="_ _13"> </span>memory<span class="_ _13"> </span>to<span class="_ _13"> </span>another<span class="_ _13"> </span>without<span class="_ _13"> </span>the<span class="_ _13"> </span>need<span class="_ _13"> </span>to<span class="_ _13"> </span>update<span class="_ _13"> </span>all<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>branch<span class="_ _13"> </span>target</div><div class="t m5 x17 h26 y68b ff7 fs19 fc1 sc0 ls0 ws0">addresses<span class="_ _1"></span>.<span class="_ _16"> </span>Since<span class="_ _16"> </span>we<span class="_ _11"> </span>are<span class="_ _16"> </span>more<span class="_ _16"> </span>concerned<span class="_ _16"> </span>with<span class="_ _16"> </span>simplicity<span class="_ _11"> </span>in<span class="_ _16"> </span>our<span class="_ _16"> </span>presentation,<span class="_ _16"> </span>we</div><div class="t m5 x17 h26 y68c ff7 fs19 fc1 sc0 ls0 ws0">use<span class="_ _13"> </span>absolute<span class="_ _13"> </span>addressing<span class="_ _1"></span>.<span class="_ _13"> </span>As<span class="_ _13"> </span>with<span class="_ _13"> </span>x86-64,<span class="_ _13"> </span>all<span class="_ _13"> </span>integers<span class="_ _13"> </span>have<span class="_ _13"> </span>a<span class="_ _6"> </span>little-endian<span class="_ _13"> </span>encoding.</div><div class="t m5 x17 h26 y68d ff7 fs19 fc1 sc0 ls0 ws0">When<span class="_ _a"> </span>the<span class="_ _6"> </span>instruction<span class="_ _13"> </span>is<span class="_ _a"> </span>written<span class="_ _6"> </span>in<span class="_ _6"> </span>disassembled<span class="_ _6"> </span>form,<span class="_ _13"> </span>these<span class="_ _6"> </span>bytes<span class="_ _6"> </span>appear<span class="_ _6"> </span>in<span class="_ _6"> </span>reverse</div><div class="t m5 x17 h26 y68e ff7 fs19 fc1 sc0 ls0 ws0">order.</div><div class="t m5 x26 h26 y68f ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_ _16"> </span>an<span class="_ _11"> </span>example,<span class="_ _16"> </span>let<span class="_ _11"> </span>us<span class="_ _16"> </span>generate<span class="_ _16"> </span>the<span class="_ _16"> </span>byte<span class="_ _11"> </span>encoding<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>instruction<span class="_ _11"> </span><span class="ffd">rmmovq</span></div><div class="t m5 x17 h26 y690 ffd fs19 fc1 sc0 ls0 ws0">%rsp,0x123456789abcd(%rdx)<span class="_ _10"> </span><span class="ff7">in<span class="_"> </span>hexadecimal.<span class="_ _13"> </span>From<span class="_ _13"> </span>Figure<span class="_ _13"> </span>4.2,<span class="_"> </span>we<span class="_"> </span>can<span class="_"> </span>see<span class="_ _13"> </span>that</span></div><div class="t m5 x17 h26 y691 ffd fs19 fc1 sc0 ls0 ws0">rmmovq<span class="_ _16"> </span><span class="ff7">has<span class="_ _14"> </span>initial<span class="_ _16"> </span>byte<span class="_ _16"> </span></span>40<span class="ff7">.<span class="_ _14"> </span>W<span class="_ _3"></span>e<span class="_ _14"> </span>can<span class="_ _16"> </span>also<span class="_ _14"> </span>see<span class="_ _16"> </span>that<span class="_ _16"> </span>source<span class="_ _14"> </span>register<span class="_ _16"> </span><span class="ffd">%rsp<span class="_ _14"> </span></span>should<span class="_ _16"> </span>be</span></div><div class="t m5 x17 h26 y692 ff7 fs19 fc1 sc0 ls0 ws0">encoded<span class="_"> </span>in<span class="_ _11"> </span>the<span class="_"> </span><span class="ff6">rA<span class="_ _11"> </span></span>ﬁeld,<span class="_"> </span>and<span class="_ _11"> </span>base<span class="_ _11"> </span>register<span class="_"> </span><span class="ffd">%rdx<span class="_ _11"> </span></span>should<span class="_"> </span>be<span class="_ _11"> </span>encoded<span class="_"> </span>in<span class="_ _11"> </span>the<span class="_ _11"> </span><span class="ff6">rB<span class="_ _10"> </span></span>ﬁeld.</div><div class="t m5 x17 h26 y693 ff7 fs19 fc1 sc0 ls0 ws0">Using<span class="_ _16"> </span>the<span class="_ _14"> </span>register<span class="_ _16"> </span>numbers<span class="_ _14"> </span>in<span class="_ _16"> </span>Figure<span class="_ _16"> </span>4.4,<span class="_ _14"> </span>we<span class="_ _16"> </span>get<span class="_ _14"> </span>a<span class="_ _16"> </span>register<span class="_ _14"> </span>speciﬁer<span class="_ _16"> </span>byte<span class="_ _14"> </span>of<span class="_ _16"> </span><span class="ffd">42</span>.</div><div class="t m5 x17 h26 y694 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>inally<span class="_ _3"></span>,<span class="_ _21"> </span>the<span class="_ _15"> </span>displacement<span class="_ _15"> </span>is<span class="_ _14"> </span>encoded<span class="_ _15"> </span>in<span class="_ _15"> </span>the<span class="_ _15"> </span>8-byte<span class="_ _15"> </span>constant<span class="_ _14"> </span>word.<span class="_ _15"> </span>W<span class="_ _1"></span>e<span class="_ _14"> </span>ﬁrst<span class="_ _15"> </span>pad</div><div class="t m5 x17 h26 y695 ffd fs19 fc1 sc0 ls0 ws0">0x123456789abcd<span class="_ _10"> </span><span class="ff7">with<span class="_"> </span>leading<span class="_"> </span>zeros<span class="_"> </span>to<span class="_"> </span>ﬁll<span class="_"> </span>out<span class="_"> </span>8<span class="_"> </span>bytes<span class="_ _1"></span>,<span class="_ _11"> </span>giving<span class="_"> </span>a<span class="_"> </span>byte<span class="_"> </span>sequence<span class="_"> </span>of</span></div><div class="t m5 x17 h26 y696 ffd fs19 fc1 sc0 ls0 ws0">00<span class="_ _6"> </span>01<span class="_ _13"> </span>23<span class="_ _6"> </span>45<span class="_ _6"> </span>67<span class="_ _13"> </span>89<span class="_ _6"> </span>ab<span class="_ _6"> </span>cd<span class="ff7">.<span class="_ _13"> </span>W<span class="_ _3"></span>e<span class="_ _6"> </span>write<span class="_ _13"> </span>this<span class="_ _6"> </span>in<span class="_ _6"> </span>byte-reversed<span class="_ _13"> </span>order<span class="_ _6"> </span>as<span class="_ _13"> </span><span class="ffd">cd<span class="_ _6"> </span>ab<span class="_ _6"> </span>89<span class="_ _13"> </span>67<span class="_ _6"> </span>45<span class="_ _6"> </span>23<span class="_ _13"> </span>01</span></span></div><div class="t m5 x17 h26 y697 ffd fs19 fc1 sc0 ls0 ws0">00<span class="ff7">.<span class="_"> </span>Combining<span class="_"> </span>these<span class="_ _1"></span>,<span class="_"> </span>we<span class="_"> </span>get<span class="_"> </span>an<span class="_"> </span>instruction<span class="_"> </span>encoding<span class="_"> </span>of<span class="_"> </span><span class="ffd">4042cdab896745230100</span>.</span></div><div class="t m5 x26 h26 y698 ff7 fs19 fc1 sc0 ls0 ws0">One<span class="_ _13"> </span>important<span class="_ _13"> </span>property<span class="_"> </span>of<span class="_ _13"> </span>any<span class="_ _13"> </span>instruction<span class="_ _13"> </span>set<span class="_"> </span>is<span class="_ _13"> </span>that<span class="_ _13"> </span>the<span class="_ _13"> </span>byte<span class="_"> </span>encodings<span class="_ _13"> </span>must</div><div class="t m5 x17 h26 y699 ff7 fs19 fc1 sc0 ls0 ws0">have<span class="_ _14"> </span>a<span class="_ _15"> </span>unique<span class="_ _14"> </span>interpretation.<span class="_ _15"> </span>An<span class="_ _15"> </span>arbitrary<span class="_ _14"> </span>sequence<span class="_ _15"> </span>of<span class="_ _14"> </span>bytes<span class="_ _15"> </span>either<span class="_ _14"> </span>encodes<span class="_ _15"> </span>a</div><div class="t m5 x17 h26 y69a ff7 fs19 fc1 sc0 ls0 ws0">unique<span class="_ _6"> </span>instruction<span class="_ _13"> </span>sequence<span class="_ _6"> </span>or<span class="_ _6"> </span>is<span class="_ _13"> </span>not<span class="_ _6"> </span>a<span class="_ _6"> </span>legal<span class="_ _13"> </span>byte<span class="_ _6"> </span>sequence<span class="_ _1"></span>.<span class="_ _13"> </span>T<span class="_ _1"></span>his<span class="_ _6"> </span>property<span class="_ _13"> </span>holds<span class="_ _6"> </span>for</div><div class="t m5 x17 h26 y69b ff7 fs19 fc1 sc0 ls0 ws0">Y86-64,<span class="_ _13"> </span>because<span class="_"> </span>every<span class="_ _13"> </span>instruction<span class="_ _13"> </span>has<span class="_"> </span>a<span class="_ _13"> </span>unique<span class="_ _13"> </span>combination<span class="_"> </span>of<span class="_ _13"> </span>code<span class="_ _13"> </span>and<span class="_ _13"> </span>function</div><div class="t m5 x17 h26 y69c ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_ _13"> </span>its<span class="_"> </span>initial<span class="_ _13"> </span>byte<span class="_ _1"></span>,<span class="_"> </span>and<span class="_ _13"> </span>given<span class="_ _13"> </span>this<span class="_"> </span>byte<span class="_ _1"></span>,<span class="_"> </span>we<span class="_ _13"> </span>can<span class="_ _13"> </span>determine<span class="_"> </span>the<span class="_ _13"> </span>length<span class="_ _13"> </span>and<span class="_"> </span>meaning<span class="_ _13"> </span>of</div><div class="t m5 x17 h26 y69d ff7 fs19 fc1 sc0 ls0 ws0">any<span class="_ _13"> </span>additional<span class="_ _6"> </span>bytes<span class="_ _1"></span>.<span class="_ _13"> </span>T<span class="_ _1"></span>his<span class="_ _13"> </span>property<span class="_ _13"> </span>ensures<span class="_ _6"> </span>that<span class="_ _13"> </span>a<span class="_ _13"> </span>processor<span class="_ _6"> </span>can<span class="_ _13"> </span>execute<span class="_ _13"> </span>an<span class="_ _6"> </span>object-</div><div class="t m5 x17 h26 y69e ff7 fs19 fc1 sc0 ls0 ws0">code<span class="_"> </span>program<span class="_"> </span>without<span class="_"> </span>any<span class="_ _11"> </span>ambiguity<span class="_"> </span>about<span class="_"> </span>the<span class="_ _11"> </span>meaning<span class="_"> </span>of<span class="_"> </span>the<span class="_ _11"> </span>code<span class="_ _1"></span>.<span class="_ _11"> </span>Even<span class="_"> </span>if<span class="_"> </span>the</div><div class="t m5 x17 h26 ya9e ff7 fs19 fc1 sc0 ls0 ws0">code<span class="_ _16"> </span>is<span class="_ _16"> </span>embedded<span class="_ _16"> </span>within<span class="_ _16"> </span>other<span class="_ _16"> </span>bytes<span class="_ _16"> </span>in<span class="_ _16"> </span>the<span class="_ _16"> </span>program,<span class="_ _14"> </span>we<span class="_ _16"> </span>can<span class="_ _16"> </span>readily<span class="_ _16"> </span>determine</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
