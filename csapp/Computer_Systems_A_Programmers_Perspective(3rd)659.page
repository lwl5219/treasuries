<div id="pf293" class="pf w2 h11" data-page-no="293"><div class="pc pc293 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg293.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">658<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>6<span class="_ _3d"> </span>The<span class="_ _10"> </span>Memory<span class="_ _10"> </span>Hierarchy</span></div><div class="t m5 x1d h42 ye7 ff6 fs29 fc6 sc0 ls0 ws0">Conﬂict<span class="_ _11"> </span>Misses<span class="_ _16"> </span>in<span class="_ _16"> </span>Direct-Mapped<span class="_ _11"> </span>Caches</div><div class="t m5 x1d h26 y5bd ff7 fs19 fc1 sc0 ls0 ws0">Conﬂict<span class="_ _13"> </span>misses<span class="_"> </span>are<span class="_ _13"> </span>common<span class="_"> </span>in<span class="_ _13"> </span>real<span class="_"> </span>programs<span class="_ _13"> </span>and<span class="_"> </span>can<span class="_ _13"> </span>cause<span class="_"> </span>bafﬂing<span class="_ _13"> </span>performance</div><div class="t m5 x1d h26 y5be ff7 fs19 fc1 sc0 ls0 ws0">problems<span class="_ _1"></span>.<span class="_ _13"> </span>Conﬂict<span class="_ _13"> </span>misses<span class="_ _13"> </span>in<span class="_ _13"> </span>direct-mapped<span class="_ _13"> </span>caches<span class="_ _13"> </span>typically<span class="_ _13"> </span>occur<span class="_ _13"> </span>when<span class="_ _13"> </span>programs</div><div class="t m5 x1d h26 y5bf ff7 fs19 fc1 sc0 ls0 ws0">access<span class="_"> </span>arrays<span class="_"> </span>whose<span class="_"> </span>sizes<span class="_ _11"> </span>are<span class="_"> </span>a<span class="_"> </span>power<span class="_ _11"> </span>of<span class="_"> </span>2.<span class="_"> </span>F<span class="_ _1"></span>or<span class="_ _11"> </span>example<span class="_ _1"></span>,<span class="_ _11"> </span>consider<span class="_"> </span>a<span class="_"> </span>function<span class="_ _11"> </span>that</div><div class="t m5 x1d h26 y5c0 ff7 fs19 fc1 sc0 ls0 ws0">computes<span class="_"> </span>the<span class="_"> </span>dot<span class="_"> </span>product<span class="_"> </span>of<span class="_"> </span>two<span class="_"> </span>vectors:</div><div class="t m5 x1f h2d y57ab ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">float<span class="_ _1f"> </span>dotprod(float<span class="_ _e"> </span>x[8],<span class="_ _1f"> </span>float<span class="_ _1f"> </span>y[8])</span></div><div class="t m5 x1f h2d y57ac ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x1f h2d y57ad ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2">float<span class="_ _e"> </span>sum<span class="_ _1f"> </span>=<span class="_ _1f"> </span>0.0;</span></div><div class="t m5 x1f h2d y57ae ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2">int<span class="_ _e"> </span>i;</span></div><div class="t m5 x1f h2e y57af ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x1f h2e y57b0 ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 x33 h2d y57b1 ffd fs1e fc2 sc0 ls33 ws0">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>i=0<span class="_ _41"></span>;i&lt;8<span class="_ _41"></span>;<span class="ls0">i++)</span></div><div class="t m5 x1f h2d y57b2 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _70"> </span><span class="ffd fs1e fc2">sum<span class="_ _e"> </span>+=<span class="_ _1f"> </span>x[i]<span class="_ _1f"> </span>*<span class="_ _e"> </span>y[i];</span></div><div class="t m5 x1f h2d y57b3 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _20"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>sum;</span></div><div class="t m5 x1f h2d y57b4 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1d h26 y57b5 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _13"> </span>function<span class="_"> </span>has<span class="_ _13"> </span>good<span class="_ _13"> </span>spatial<span class="_ _13"> </span>locality<span class="_ _13"> </span>with<span class="_ _13"> </span>respect<span class="_ _13"> </span>to<span class="_"> </span><span class="ffd">x<span class="_ _13"> </span></span>and<span class="_ _13"> </span><span class="ffd">y</span>,<span class="_ _13"> </span>and<span class="_ _13"> </span>so<span class="_ _13"> </span>we<span class="_ _13"> </span>might<span class="_"> </span>ex-</div><div class="t m5 x1d h26 y57b6 ff7 fs19 fc2 sc0 ls0 ws0">pect<span class="_ _13"> </span>it<span class="_ _13"> </span>to<span class="_ _13"> </span>enjoy<span class="_ _13"> </span>a<span class="_ _13"> </span>good<span class="_ _13"> </span>number<span class="_ _13"> </span>of<span class="_ _13"> </span>cache<span class="_ _13"> </span>hits<span class="_ _1"></span>.<span class="_ _13"> </span>Unfortunately<span class="_ _3"></span>,<span class="_ _13"> </span>this<span class="_ _13"> </span>is<span class="_ _13"> </span>not<span class="_ _13"> </span>always<span class="_ _13"> </span>true<span class="_ _0"></span>.</div><div class="t m5 x29 h26 y57b7 ff7 fs19 fc2 sc0 ls0 ws0">Suppose<span class="_ _13"> </span>that<span class="_ _13"> </span>ﬂoats<span class="_ _13"> </span>are<span class="_ _13"> </span>4<span class="_ _13"> </span>bytes<span class="_ _1"></span>,<span class="_"> </span>that<span class="_ _13"> </span><span class="ffd">x<span class="_ _13"> </span></span>is<span class="_ _13"> </span>loaded<span class="_ _13"> </span>into<span class="_ _13"> </span>the<span class="_ _13"> </span>32<span class="_ _13"> </span>bytes<span class="_ _13"> </span>of<span class="_ _13"> </span>contiguous</div><div class="t m5 x1d h26 y57b8 ff7 fs19 fc2 sc0 ls0 ws0">memory<span class="_"> </span>starting<span class="_"> </span>at<span class="_"> </span>address<span class="_"> </span>0,<span class="_"> </span>and<span class="_"> </span>that<span class="_"> </span><span class="ffd">y<span class="_ _10"> </span></span>starts<span class="_"> </span>immediately<span class="_"> </span>after<span class="_ _11"> </span><span class="ffd">x<span class="_ _10"> </span></span>at<span class="_"> </span>address<span class="_"> </span>32.</div><div class="t m5 x1d h26 y57b9 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _16"> </span>simplicity<span class="_ _3"></span>,<span class="_ _14"> </span>suppose<span class="_ _16"> </span>that<span class="_ _14"> </span>a<span class="_ _16"> </span>block<span class="_ _16"> </span>is<span class="_ _14"> </span>16<span class="_ _16"> </span>bytes<span class="_ _16"> </span>(big<span class="_ _14"> </span>enough<span class="_ _16"> </span>to<span class="_ _16"> </span>hold<span class="_ _14"> </span>four<span class="_ _16"> </span>ﬂoats)</div><div class="t m5 x1d h26 y57ba ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_ _11"> </span>that<span class="_ _11"> </span>the<span class="_ _11"> </span>cache<span class="_ _16"> </span>consists<span class="_"> </span>of<span class="_ _16"> </span>two<span class="_"> </span>sets<span class="_ _1"></span>,<span class="_ _16"> </span>for<span class="_ _11"> </span>a<span class="_ _11"> </span>total<span class="_ _11"> </span>cache<span class="_ _16"> </span>size<span class="_"> </span>of<span class="_ _16"> </span>32<span class="_"> </span>bytes<span class="_ _0"></span>.<span class="_ _11"> </span>W<span class="_ _3"></span>e<span class="_ _11"> </span>will</div><div class="t m5 x1d h26 y57bb ff7 fs19 fc2 sc0 ls0 ws0">assume<span class="_ _13"> </span>that<span class="_ _13"> </span>the<span class="_ _13"> </span>variable<span class="_ _13"> </span><span class="ffd">sum<span class="_ _13"> </span></span>is<span class="_ _13"> </span>actually<span class="_ _13"> </span>stored<span class="_ _13"> </span>in<span class="_ _13"> </span>a<span class="_ _13"> </span>CPU<span class="_ _13"> </span>register<span class="_ _13"> </span>and<span class="_ _13"> </span>thus<span class="_ _13"> </span>does<span class="_ _13"> </span>not</div><div class="t m5 x1d h26 y57bc ff7 fs19 fc2 sc0 ls0 ws0">require<span class="_ _16"> </span>a<span class="_ _11"> </span>memory<span class="_ _16"> </span>reference<span class="_ _0"></span>.<span class="_ _16"> </span>Given<span class="_ _11"> </span>these<span class="_ _16"> </span>assumptions<span class="_ _1"></span>,<span class="_ _16"> </span>each<span class="_ _16"> </span><span class="ffd">x[i]<span class="_ _11"> </span></span>and<span class="_ _16"> </span><span class="ffd">y[i]<span class="_ _16"> </span></span>will</div><div class="t m5 x1d h26 y57bd ff7 fs19 fc2 sc0 ls0 ws0">map<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>identical<span class="_"> </span>cache<span class="_"> </span>set:</div><div class="t m5 x1d h31 y327f ff7 fs21 fc2 sc0 ls0 ws0">Element<span class="_ _26"> </span>Address<span class="_ _26"> </span>Set<span class="_"> </span>index<span class="_ _5a"> </span>Element<span class="_ _26"> </span>Address<span class="_ _26"> </span>Set<span class="_"> </span>index</div><div class="t m5 x126 h2d y57be ffd fs1e fc2 sc0 ls0 ws0">x[0]</div><div class="t m5 x235 h31 y57bf ff7 fs21 fc2 sc0 ls247 ws0">00<span class="_ _1e"> </span><span class="ffd fs1e ls0">y[0]</span></div><div class="t m5 x108 h31 y57c0 ff7 fs21 fc2 sc0 ls0 ws0">32<span class="_ _c0"> </span>0</div><div class="t m5 x126 h2d y57c1 ffd fs1e fc2 sc0 ls0 ws0">x[1]</div><div class="t m5 x235 h31 y57c2 ff7 fs21 fc2 sc0 ls247 ws0">40<span class="_ _1e"> </span><span class="ffd fs1e ls0">y[1]<span class="_ _d0"> </span></span><span class="ls0">36<span class="_ _55"> </span>0</span></div><div class="t m5 x126 h31 y57c3 ffd fs1e fc2 sc0 ls0 ws0">x[2]<span class="_ _10d"> </span><span class="ff7 fs21 ls247">80<span class="_ _1e"> </span></span>y[2]<span class="_ _d0"> </span><span class="ff7 fs21">40<span class="_ _55"> </span>0</span></div><div class="t m5 x126 h31 y57c4 ffd fs1e fc2 sc0 ls0 ws0">x[3]<span class="_ _d0"> </span><span class="ff7 fs21">12<span class="_ _55"> </span>0<span class="_ _d6"> </span></span>y[3]<span class="_ _ba"> </span><span class="ff7 fs21">44<span class="_ _c0"> </span>0</span></div><div class="t m5 x126 h31 y2231 ffd fs1e fc2 sc0 ls0 ws0">x[4]<span class="_ _d0"> </span><span class="ff7 fs21">16<span class="_ _55"> </span>1<span class="_ _d6"> </span></span>y[4]<span class="_ _ba"> </span><span class="ff7 fs21">48<span class="_ _c0"> </span>1</span></div><div class="t m5 x126 h31 y57c5 ffd fs1e fc2 sc0 ls0 ws0">x[5]<span class="_ _d0"> </span><span class="ff7 fs21">20<span class="_ _55"> </span>1<span class="_ _d6"> </span></span>y[5]<span class="_ _ba"> </span><span class="ff7 fs21">52<span class="_ _c0"> </span>1</span></div><div class="t m5 x126 h31 y57c6 ffd fs1e fc2 sc0 ls0 ws0">x[6]<span class="_ _d0"> </span><span class="ff7 fs21">24<span class="_ _55"> </span>1<span class="_ _d6"> </span></span>y[6]<span class="_ _ba"> </span><span class="ff7 fs21">56<span class="_ _c0"> </span>1</span></div><div class="t m5 x126 h31 y57c7 ffd fs1e fc2 sc0 ls0 ws0">x[7]<span class="_ _d0"> </span><span class="ff7 fs21">28<span class="_ _55"> </span>1<span class="_ _d6"> </span></span>y[7]<span class="_ _ba"> </span><span class="ff7 fs21">60<span class="_ _c0"> </span>1</span></div><div class="t m5 x29 h26 y2972 ff7 fs19 fc2 sc0 ls0 ws0">At<span class="_"> </span>run<span class="_"> </span>time<span class="_ _1"></span>,<span class="_"> </span>the<span class="_"> </span>ﬁrst<span class="_"> </span>iteration<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>loop<span class="_"> </span>references<span class="_ _13"> </span><span class="ffd">x[0]</span>,<span class="_"> </span>a<span class="_"> </span>miss<span class="_"> </span>that<span class="_"> </span>causes</div><div class="t m5 x1d h26 y4f80 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _11"> </span>block<span class="_ _11"> </span>containing<span class="_ _11"> </span><span class="ffd">x[0]</span>–<span class="ffd">x[3]<span class="_ _11"> </span></span>to<span class="_ _11"> </span>be<span class="_ _16"> </span>loaded<span class="_"> </span>into<span class="_ _16"> </span>set<span class="_"> </span>0.<span class="_ _11"> </span>The<span class="_"> </span>next<span class="_ _11"> </span>reference<span class="_ _11"> </span>is<span class="_ _16"> </span>to</div><div class="t m5 x1d h26 y4f81 ffd fs19 fc2 sc0 ls0 ws0">y[0]<span class="ff7">,<span class="_"> </span>another<span class="_"> </span>miss<span class="_"> </span>that<span class="_ _11"> </span>causes<span class="_"> </span>the<span class="_"> </span>block<span class="_"> </span>containing<span class="_ _11"> </span></span>y[0]<span class="ff7">–</span>y[3]<span class="_ _10"> </span><span class="ff7">to<span class="_"> </span>be<span class="_"> </span>copied<span class="_ _11"> </span>into</span></div><div class="t m5 x1d h26 y4f82 ff7 fs19 fc2 sc0 ls0 ws0">set<span class="_ _16"> </span>0,<span class="_ _16"> </span>overwriting<span class="_ _11"> </span>the<span class="_ _16"> </span>values<span class="_ _16"> </span>of<span class="_ _11"> </span><span class="ffd">x<span class="_ _16"> </span></span>that<span class="_ _16"> </span>were<span class="_ _11"> </span>copied<span class="_ _16"> </span>in<span class="_ _16"> </span>by<span class="_ _11"> </span>the<span class="_ _16"> </span>previous<span class="_ _16"> </span>reference<span class="_ _1"></span>.</div><div class="t m5 x1d h26 y4f83 ff7 fs19 fc2 sc0 ls0 ws0">During<span class="_ _16"> </span>the<span class="_ _11"> </span>next<span class="_ _16"> </span>iteration,<span class="_ _16"> </span>the<span class="_ _16"> </span>reference<span class="_ _11"> </span>to<span class="_ _16"> </span><span class="ffd">x[1]<span class="_ _16"> </span></span>misses<span class="_ _3"></span>,<span class="_ _16"> </span>which<span class="_ _16"> </span>causes<span class="_ _16"> </span>the<span class="_ _11"> </span><span class="ffd">x[0]</span>–</div><div class="t m5 x1d h26 y2878 ffd fs19 fc2 sc0 ls0 ws0">x[3]<span class="_ _13"> </span><span class="ff7">block<span class="_"> </span>to<span class="_ _13"> </span>be<span class="_ _13"> </span>loaded<span class="_ _13"> </span>back<span class="_"> </span>into<span class="_ _13"> </span>set<span class="_ _13"> </span>0,<span class="_"> </span>overwriting<span class="_ _13"> </span>the<span class="_ _13"> </span></span>y[0]<span class="ff7">–</span>y[3]<span class="_ _13"> </span><span class="ff7">block.<span class="_"> </span>So<span class="_ _13"> </span>now</span></div><div class="t m5 x1d h26 y2879 ff7 fs19 fc2 sc0 ls0 ws0">we<span class="_ _13"> </span>have<span class="_ _13"> </span>a<span class="_ _13"> </span>conﬂict<span class="_ _13"> </span>miss<span class="_ _3"></span>,<span class="_"> </span>and<span class="_ _6"> </span>in<span class="_ _13"> </span>fact<span class="_ _13"> </span>each<span class="_ _13"> </span>subsequent<span class="_ _13"> </span>reference<span class="_ _13"> </span>to<span class="_ _13"> </span><span class="ffd">x<span class="_ _13"> </span></span>and<span class="_ _13"> </span><span class="ffd">y<span class="_ _13"> </span></span>will<span class="_ _13"> </span>result</div><div class="t m5 x1d h26 y287a ff7 fs19 fc2 sc0 ls0 ws0">in<span class="_ _13"> </span>a<span class="_"> </span>conﬂict<span class="_ _13"> </span>miss<span class="_"> </span>as<span class="_ _13"> </span>we<span class="_"> </span>thrash<span class="_ _13"> </span>back<span class="_ _13"> </span>and<span class="_"> </span>forth<span class="_ _13"> </span>between<span class="_"> </span>blocks<span class="_ _13"> </span>of<span class="_ _13"> </span><span class="ffd">x<span class="_ _10"> </span></span>and<span class="_ _13"> </span><span class="ffd">y</span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>term</div><div class="t m5 x1d h26 y287b ffa fs19 fc2 sc0 ls0 ws0">thrashing<span class="_"> </span><span class="ff7">describes<span class="_ _13"> </span>any<span class="_ _13"> </span>situation<span class="_ _13"> </span>where<span class="_"> </span>a<span class="_ _13"> </span>cache<span class="_ _13"> </span>is<span class="_ _13"> </span>repeatedly<span class="_ _13"> </span>loading<span class="_"> </span>and<span class="_ _13"> </span>evicting</span></div><div class="t m5 x1d h26 y287c ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>same<span class="_"> </span>sets<span class="_"> </span>of<span class="_"> </span>cache<span class="_"> </span>blocks<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
