<div id="pf252" class="pf w2 h11" data-page-no="252"><div class="pc pc252 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg252.png"/><div class="t m5 x187 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>5.12<span class="_ _60"> </span>Understanding<span class="_ _10"> </span>Memor<span class="_"> </span>y<span class="_ _10"> </span>Per<span class="_ _2"></span>formance<span class="_ _1b"> </span><span class="ffe fs1e">593</span></div><div class="t m5 x17 h2f ye7 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>5.34</div><div class="t m5 x17 h2f y58a ffe fs16 fc1 sc0 ls0 ws0">Detail<span class="_ _11"> </span>of<span class="_ _16"> </span>load<span class="_ _11"> </span>and<span class="_ _11"> </span>store</div><div class="t m5 x17 h34 y58b ffe fs16 fc1 sc0 ls0 ws0">units.<span class="_ _14"> </span><span class="ff6">The<span class="_ _15"> </span>store<span class="_ _15"> </span>unit</span></div><div class="t m5 x17 h34 y58c ff6 fs16 fc1 sc0 ls0 ws0">maintains<span class="_ _14"> </span>a<span class="_ _15"> </span>buffer<span class="_ _15"> </span>of</div><div class="t m5 x17 h34 y58d ff6 fs16 fc1 sc0 ls0 ws0">pending<span class="_ _11"> </span>writes.<span class="_ _16"> </span>The<span class="_ _11"> </span>load</div><div class="t m5 x17 h34 y58e ff6 fs16 fc1 sc0 ls0 ws0">unit<span class="_ _10"> </span>must<span class="_ _11"> </span>check<span class="_ _10"> </span>its<span class="_ _11"> </span>address</div><div class="t m5 x17 h34 y58f ff6 fs16 fc1 sc0 ls0 ws0">with<span class="_ _16"> </span>those<span class="_ _14"> </span>in<span class="_ _16"> </span>the<span class="_ _14"> </span>store</div><div class="t m5 x17 h34 y8d9 ff6 fs16 fc1 sc0 ls0 ws0">unit<span class="_ _11"> </span>to<span class="_ _10"> </span>detect<span class="_ _11"> </span>a<span class="_ _11"> </span>write/read</div><div class="t m5 x17 h34 y8da ff6 fs16 fc1 sc0 ls0 ws0">dependency<span class="_ _3"></span>.</div><div class="t m5 x10e h94 y4fff ff6f fs58 fc1 sc0 ls0 ws0">Load unit<span class="_ _1ec"> </span>Store unit</div><div class="t m5 x9 h94 y5000 ff6f fs58 fc1 sc0 ls0 ws0">Store buffer</div><div class="t m5 x22f h96 y5001 ff6f fs5a fc1 sc0 ls0 ws0">Address</div><div class="t m5 xb3 h94 y5002 ff6f fs58 fc1 sc0 ls0 ws0">Address</div><div class="t m5 x24e h94 y5003 ff6f fs58 fc1 sc0 ls0 ws0">Address</div><div class="t m5 x5f h96 y5004 ff6f fs5a fc1 sc0 ls0 ws0">Data</div><div class="t m5 xe3 h94 y5005 ff6f fs58 fc1 sc0 ls0 ws0">Data</div><div class="t m5 x185 h94 y5006 ff6f fs58 fc1 sc0 ls0 ws0">Data</div><div class="t m5 x1c9 h96 y5007 ff6f fs5a fc1 sc0 ls0 ws0">Matching</div><div class="t m5 x36 h96 y5008 ff6f fs5a fc1 sc0 ls0 ws0">addresses</div><div class="t m5 x93 h94 y5009 ff6f fs58 fc1 sc0 ls0 ws0">Address<span class="_ _118"> </span>Data</div><div class="t m5 xb1 h94 y500a ff6f fs58 fc1 sc0 ls0 ws0">Data cache</div><div class="t m5 x17 h26 y500b ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_ _11"> </span>a<span class="_ _11"> </span>consequence,<span class="_ _11"> </span>a<span class="_ _11"> </span>series<span class="_ _16"> </span>of<span class="_ _11"> </span>ascending<span class="_ _11"> </span>values<span class="_ _16"> </span>will<span class="_ _11"> </span>be<span class="_ _11"> </span>stored<span class="_ _11"> </span>in<span class="_ _16"> </span>this<span class="_ _11"> </span>location.<span class="_ _11"> </span>In</div><div class="t m5 x17 h26 y500c ff7 fs19 fc1 sc0 ls0 ws0">general,<span class="_ _11"> </span>if<span class="_"> </span>function<span class="_ _11"> </span><span class="ffd">write_read<span class="_ _11"> </span></span>is<span class="_ _11"> </span>called<span class="_ _11"> </span>with<span class="_"> </span>arguments<span class="_ _23"> </span><span class="ffd">src<span class="_ _11"> </span></span>and<span class="_"> </span><span class="ffd">dest<span class="_ _11"> </span></span>pointing</div><div class="t m5 x17 h26 y500d ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _13"> </span>the<span class="_ _6"> </span>same<span class="_ _13"> </span>memory<span class="_ _6"> </span>location,<span class="_ _13"> </span>and<span class="_ _6"> </span>with<span class="_ _13"> </span>argument<span class="_ _6"> </span><span class="ffd">cnt<span class="_ _13"> </span></span>having<span class="_ _6"> </span>some<span class="_ _13"> </span>value<span class="_ _13"> </span><span class="ff11 ls226">n&gt;</span><span class="lsb1">0,<span class="_ _6"> </span>the</span></div><div class="t m5 x17 h46 y500e ff7 fs19 fc1 sc0 ls0 ws0">net<span class="_ _13"> </span>effect<span class="_ _13"> </span>is<span class="_ _13"> </span>to<span class="_ _13"> </span>set<span class="_ _13"> </span>the<span class="_ _13"> </span>location<span class="_ _13"> </span>to<span class="_ _13"> </span><span class="ff11">n<span class="_ _13"> </span><span class="ff12">−<span class="_ _13"></span></span></span>1<span class="_ _1"></span>.<span class="_ _13"> </span>T<span class="_ _0"></span>his<span class="_ _13"> </span>example<span class="_ _13"> </span>illustrates<span class="_ _13"> </span>a<span class="_ _13"> </span>phenomenon<span class="_ _13"> </span>we</div><div class="t m5 x17 h26 y500f ff7 fs19 fc1 sc0 ls0 ws0">will<span class="_ _11"> </span>call<span class="_ _16"> </span>a<span class="_ _16"> </span><span class="ffa">write/read<span class="_ _11"> </span>dependency</span>—the<span class="_ _11"> </span>outcome<span class="_ _16"> </span>of<span class="_ _16"> </span>a<span class="_ _11"> </span>memory<span class="_ _16"> </span>read<span class="_ _11"> </span>depends<span class="_ _16"> </span>on<span class="_ _16"> </span>a</div><div class="t m5 x17 h26 y5010 ff7 fs19 fc1 sc0 ls0 ws0">recent<span class="_"> </span>memory<span class="_"> </span>write<span class="_ _1"></span>.<span class="_"> </span>Our<span class="_"> </span>performance<span class="_"> </span>measurements<span class="_ _13"> </span>show<span class="_"> </span>that<span class="_"> </span>Example<span class="_"> </span>B<span class="_"> </span>has</div><div class="t m5 x17 h26 y5011 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_"> </span>CPE<span class="_"> </span>of<span class="_"> </span>7.3.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>write/read<span class="_"> </span>dependency<span class="_"> </span>causes<span class="_"> </span>a<span class="_"> </span>slowdown<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>processing<span class="_"> </span>of</div><div class="t m5 x17 h26 y5012 ff7 fs19 fc1 sc0 ls0 ws0">around<span class="_"> </span>6<span class="_"> </span>clock<span class="_"> </span>cycles<span class="_ _3"></span>.</div><div class="t m5 x26 h26 y5013 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_ _16"> </span>see<span class="_ _16"> </span>how<span class="_ _16"> </span>the<span class="_ _16"> </span>processor<span class="_ _16"> </span>can<span class="_ _16"> </span>distinguish<span class="_ _16"> </span>between<span class="_ _16"> </span>these<span class="_ _16"> </span>two<span class="_ _16"> </span>cases<span class="_ _16"> </span>and<span class="_ _16"> </span>why</div><div class="t m5 x17 h26 y5014 ff7 fs19 fc1 sc0 ls0 ws0">one<span class="_ _13"> </span>runs<span class="_ _13"> </span>slower<span class="_"> </span>than<span class="_ _13"> </span>the<span class="_ _13"> </span>other,<span class="_ _13"> </span>we<span class="_ _13"> </span>must<span class="_"> </span>take<span class="_ _13"> </span>a<span class="_ _13"> </span>more<span class="_ _13"> </span>detailed<span class="_"> </span>look<span class="_ _13"> </span>at<span class="_ _13"> </span>the<span class="_ _13"> </span>load<span class="_"> </span>and</div><div class="t m5 x17 h26 y5015 ff7 fs19 fc1 sc0 ls0 ws0">store<span class="_ _13"> </span>execution<span class="_ _6"> </span>units<span class="_ _1"></span>,<span class="_ _13"> </span>as<span class="_ _13"> </span>shown<span class="_ _6"> </span>in<span class="_ _13"> </span>F<span class="_ _1"></span>igure<span class="_ _13"> </span>5.34.<span class="_ _6"> </span>T<span class="_ _0"></span>he<span class="_ _13"> </span>store<span class="_ _6"> </span>unit<span class="_ _13"> </span>includes<span class="_ _6"> </span>a<span class="_ _13"> </span><span class="ffa">store<span class="_ _6"> </span>buffer</span></div><div class="t m5 x17 h26 y5016 ff7 fs19 fc1 sc0 ls0 ws0">containing<span class="_ _11"> </span>the<span class="_ _16"> </span>addresses<span class="_ _11"> </span>and<span class="_ _16"> </span>data<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>store<span class="_ _11"> </span>operations<span class="_ _16"> </span>that<span class="_ _11"> </span>have<span class="_ _16"> </span>been<span class="_ _11"> </span>issued</div><div class="t m5 x17 h26 y5017 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _16"> </span>the<span class="_ _14"> </span>store<span class="_ _14"> </span>unit,<span class="_ _14"> </span>but<span class="_ _14"> </span>have<span class="_ _14"> </span>not<span class="_ _16"> </span>yet<span class="_ _14"> </span>been<span class="_ _14"> </span>completed,<span class="_ _14"> </span>where<span class="_ _14"> </span>completion<span class="_ _16"> </span>involves</div><div class="t m5 x17 h26 y5018 ff7 fs19 fc1 sc0 ls0 ws0">updating<span class="_ _13"> </span>the<span class="_ _13"> </span>data<span class="_ _6"> </span>cache.<span class="_ _13"> </span>T<span class="_ _3"></span>his<span class="_ _13"> </span>buffer<span class="_ _13"> </span>is<span class="_ _13"> </span>provided<span class="_ _13"> </span>so<span class="_ _13"> </span>that<span class="_ _6"> </span>a<span class="_ _13"> </span>series<span class="_ _13"> </span>of<span class="_ _13"> </span>store<span class="_ _13"> </span>operations</div><div class="t m5 x17 h26 y5019 ff7 fs19 fc1 sc0 ls0 ws0">can<span class="_ _11"> </span>be<span class="_ _11"> </span>executed<span class="_ _16"> </span>without<span class="_"> </span>having<span class="_ _16"> </span>to<span class="_ _11"> </span>wait<span class="_ _11"> </span>for<span class="_ _11"> </span>each<span class="_ _16"> </span>one<span class="_"> </span>to<span class="_ _16"> </span>update<span class="_ _11"> </span>the<span class="_ _11"> </span>cache<span class="_ _0"></span>.<span class="_ _11"> </span>When</div><div class="t m5 x17 h26 y501a ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_"> </span>load<span class="_ _13"> </span>operation<span class="_"> </span>occurs<span class="_ _1"></span>,<span class="_"> </span>it<span class="_"> </span>must<span class="_"> </span>check<span class="_ _13"> </span>the<span class="_"> </span>entries<span class="_"> </span>in<span class="_"> </span>the<span class="_ _13"> </span>store<span class="_"> </span>buffer<span class="_"> </span>for<span class="_ _13"> </span>matching</div><div class="t m5 x17 h26 y501b ff7 fs19 fc1 sc0 ls0 ws0">addresses<span class="_ _1"></span>.<span class="_ _13"> </span>If<span class="_ _13"> </span>it<span class="_ _13"> </span>ﬁnds<span class="_ _13"> </span>a<span class="_ _13"> </span>match<span class="_ _13"> </span>(meaning<span class="_ _13"> </span>that<span class="_ _13"> </span>any<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>bytes<span class="_ _13"> </span>being<span class="_ _13"> </span>written<span class="_ _13"> </span>have<span class="_ _13"> </span>the</div><div class="t m5 x17 h26 y501c ff7 fs19 fc1 sc0 ls0 ws0">same<span class="_"> </span>address<span class="_ _11"> </span>as<span class="_"> </span>any<span class="_ _11"> </span>of<span class="_"> </span>the<span class="_ _11"> </span>bytes<span class="_"> </span>being<span class="_ _11"> </span>read),<span class="_"> </span>it<span class="_ _11"> </span>retrieves<span class="_ _11"> </span>the<span class="_"> </span>corresponding<span class="_ _11"> </span>data</div><div class="t m5 x17 h26 y501d ff7 fs19 fc1 sc0 ls0 ws0">entry<span class="_"> </span>as<span class="_"> </span>the<span class="_"> </span>result<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>load<span class="_"> </span>operation.</div><div class="t m5 x26 h26 y501e ff9 fs19 fc1 sc0 ls0 ws0">gcc<span class="_ _10"> </span><span class="ff7">generates<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>code<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>inner<span class="_"> </span>loop<span class="_"> </span>of<span class="_"> </span><span class="ffd">write_read</span>:</span></div><div class="t m5 xee h61 y74e ff13 fs35 fc6 sc0 ls0 ws0">Inner<span class="_ _f"> </span>loop<span class="_ _f"> </span>of<span class="_ _f"> </span>write_read</div><div class="t m5 xee h61 y501f ff13 fs35 fc6 sc0 ls0 ws0">src<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi,<span class="_ _f"> </span>dst<span class="_ _e"> </span>in<span class="_ _21"> </span>%rsi,<span class="_ _f"> </span>val<span class="_ _e"> </span>in<span class="_ _21"> </span>%rax</div><div class="t m5 x17 h2d y107b ffd fs1e fc2 sc0 ls0 ws0">.L3:<span class="_ _142"> </span><span class="ff2d fs35 fc6">loop:</span></div><div class="t m5 x72 h2d y13c0 ffd fs1e fc2 sc0 ls0 ws0">movq<span class="_ _46"> </span>%rax,<span class="_ _e"> </span>(%rsi)<span class="_ _119"> </span><span class="ff13 fs35 fc6">Write<span class="_ _f"> </span>val<span class="_ _f"> </span>to<span class="_ _f"> </span>dst</span></div><div class="t m5 x72 h2d y587 ffd fs1e fc2 sc0 ls0 ws0">movq<span class="_ _46"> </span>(%rdi),<span class="_ _e"> </span>%rax<span class="_ _119"> </span><span class="ff13 fs35 fc6">t<span class="_ _f"> </span>=<span class="_ _f"> </span>*src</span></div><div class="t m5 x72 h2d y8d6 ffd fs1e fc2 sc0 ls0 ws0">addq<span class="_ _46"> </span>$1,<span class="_ _e"> </span>%rax<span class="_ _7d"> </span><span class="ff13 fs35 fc6">val<span class="_ _e"> </span>=<span class="_ _21"> </span>t+1</span></div><div class="t m5 x72 h2d y77e ffd fs1e fc2 sc0 ls0 ws0">subq<span class="_ _46"> </span>$1,<span class="_ _e"> </span>%rdx<span class="_ _7d"> </span><span class="ff13 fs35 fc6">cnt--</span></div><div class="t m5 x72 h2d ye95 ffd fs1e fc2 sc0 ls0 ws0">jne<span class="_ _8c"> </span>.L3<span class="_ _112"> </span><span class="ff13 fs35 fc6">If<span class="_ _f"> </span>!=<span class="_ _f"> </span>0,<span class="_ _e"> </span>goto<span class="_ _21"> </span><span class="ff2d">loop</span></span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
