<div id="pf379" class="pf w2 h11" data-page-no="379"><div class="pc pc379 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg379.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">888<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>9<span class="_ _3d"> </span>Virtual<span class="_ _10"> </span>Memory</span></div><div class="t m5 x14 h2f ye7 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>9.39</div><div class="t m5 x14 h2f y58a ffe fs16 fc1 sc0 ls0 ws0">Format<span class="_ _13"> </span>of<span class="_ _13"> </span>heap<span class="_"> </span>block<span class="_ _13"> </span>that</div><div class="t m5 x14 h2f y58b ffe fs16 fc1 sc0 ls0 ws0">uses<span class="_"> </span>a<span class="_"> </span>boundary<span class="_"> </span>tag.</div><div class="t m5 x1ba h3f y733e ffc6 fs27 fc1 sc0 ls0 ws0">Block size</div><div class="t m5 x238 h3f y733f ffc6 fs27 fc1 sc0 ls0 ws0">Payload</div><div class="t m5 xc1 h3f y7340 ffc6 fs27 fc1 sc0 ls0 ws0">(allocated block only)</div><div class="t m5 xf7 h3f y7341 ffc6 fs27 fc1 sc0 ls0 ws0">Padding (optional)</div><div class="t m5 x18 h3f y733e ffc6 fs27 fc1 sc0 ls0 ws0">a/f</div><div class="t m5 x82 h3f y7342 ffc8 fs27 fc1 sc0 ls0 ws0">a = 001:<span class="_ _1"></span> Allocate</div><div class="c xe0 y7343 w35 h111"><div class="t m5 x286 h3f y7344 ffc8 fs27 fc1 sc0 ls0 ws0">d</div></div><div class="t m5 x82 h3f y7345 ffc8 fs27 fc1 sc0 ls0 ws0">a = 000:<span class="_ _1"></span> Free</div><div class="t m5 x1ba h3f y7346 ffc6 fs27 fc1 sc0 ls0 ws0">Block size<span class="_ _94"> </span>a/f</div><div class="t m5 xe0 h65 y7347 ffc6 fs38 fc1 sc0 ls0 ws0">31<span class="_ _107"> </span>3<span class="_ _e"> </span>2<span class="_ _21"> </span>1<span class="_ _21"> </span>0</div><div class="t m5 x121 h3f y7348 ffc6 fs27 fc1 sc0 ls0 ws0">Header</div><div class="t m5 x121 h3f y7349 ffc6 fs27 fc1 sc0 ls0 ws0">Footer</div><div class="t m5 x1d h26 y734a ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_"> </span>9.40<span class="_"> </span>shows<span class="_"> </span>how<span class="_"> </span>we<span class="_"> </span>would<span class="_"> </span>coalesce<span class="_"> </span>each<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>four<span class="_"> </span>cases<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y734b ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _13"> </span>case<span class="_ _6"> </span>1,<span class="_ _13"> </span>both<span class="_ _6"> </span>adjacent<span class="_ _13"> </span>blocks<span class="_ _6"> </span>are<span class="_ _13"> </span>allocated<span class="_ _6"> </span>and<span class="_ _13"> </span>thus<span class="_ _6"> </span>no<span class="_ _13"> </span>coalescing<span class="_ _6"> </span>is<span class="_ _13"> </span>possible<span class="_ _1"></span>.</div><div class="t m5 x1d h26 y734c ff7 fs19 fc1 sc0 ls0 ws0">So<span class="_ _13"> </span>the<span class="_"> </span>status<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>current<span class="_"> </span>block<span class="_ _13"> </span>is<span class="_ _13"> </span>simply<span class="_ _13"> </span>changed<span class="_"> </span>from<span class="_ _13"> </span>allocated<span class="_ _13"> </span>to<span class="_ _13"> </span>free.<span class="_ _13"> </span>In<span class="_ _13"> </span>case</div><div class="t m5 x1d h26 y734d ff7 fs19 fc1 sc0 ls0 ws0">2,<span class="_ _13"> </span>the<span class="_ _13"> </span>current<span class="_ _13"> </span>block<span class="_ _6"> </span>is<span class="_ _13"> </span>merged<span class="_ _13"> </span>with<span class="_ _13"> </span>the<span class="_ _6"> </span>next<span class="_ _13"> </span>block.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span>header<span class="_ _13"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>current<span class="_ _13"> </span>block</div><div class="t m5 x1d h26 y734e ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _6"> </span>the<span class="_ _13"> </span>footer<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _6"> </span>next<span class="_ _13"> </span>block<span class="_ _6"> </span>are<span class="_ _13"> </span>updated<span class="_ _6"> </span>with<span class="_ _13"> </span>the<span class="_ _6"> </span>combined<span class="_ _13"> </span>sizes<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _6"> </span>current</div><div class="t m5 x1d h26 y734f ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _16"> </span>next<span class="_ _11"> </span>blocks<span class="_ _1"></span>.<span class="_ _16"> </span>In<span class="_ _16"> </span>case<span class="_ _16"> </span>3,<span class="_ _16"> </span>the<span class="_ _11"> </span>previous<span class="_ _16"> </span>block<span class="_ _16"> </span>is<span class="_ _11"> </span>merged<span class="_ _16"> </span>with<span class="_ _16"> </span>the<span class="_ _16"> </span>current<span class="_ _11"> </span>block.</div><div class="t m5 x1d h26 y7350 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>header<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>previous<span class="_"> </span>block<span class="_ _13"> </span>and<span class="_"> </span>the<span class="_"> </span>footer<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_"> </span>current<span class="_"> </span>block<span class="_ _13"> </span>are<span class="_"> </span>updated</div><div class="t m5 x1d h26 y7351 ff7 fs19 fc1 sc0 ls0 ws0">with<span class="_"> </span>the<span class="_ _11"> </span>combined<span class="_ _11"> </span>sizes<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_"> </span>two<span class="_ _11"> </span>blocks<span class="_ _1"></span>.<span class="_ _11"> </span>In<span class="_ _11"> </span>case<span class="_ _11"> </span>4,<span class="_ _11"> </span>all<span class="_"> </span>three<span class="_ _11"> </span>blocks<span class="_ _11"> </span>are<span class="_ _11"> </span>merged</div><div class="t m5 x1d h26 y7352 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _13"> </span>form<span class="_ _13"> </span>a<span class="_ _13"> </span>single<span class="_ _13"> </span>free<span class="_ _13"> </span>block,<span class="_ _13"> </span>with<span class="_ _13"> </span>the<span class="_ _13"> </span>header<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>previous<span class="_ _13"> </span>block<span class="_ _13"> </span>and<span class="_ _13"> </span>the<span class="_ _13"> </span>footer<span class="_ _13"> </span>of</div><div class="t m5 x1d h26 y7353 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>next<span class="_"> </span>block<span class="_"> </span>updated<span class="_"> </span>with<span class="_"> </span>the<span class="_"> </span>combined<span class="_"> </span>sizes<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>three<span class="_"> </span>blocks<span class="_ _1"></span>.<span class="_"> </span>In<span class="_"> </span>each<span class="_"> </span>case<span class="_ _1"></span>,</div><div class="t m5 x1d h26 y7354 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>coalescing<span class="_"> </span>is<span class="_"> </span>performed<span class="_"> </span>in<span class="_"> </span>constant<span class="_"> </span>time<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y7355 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _15"> </span>idea<span class="_ _15"> </span>of<span class="_ _15"> </span>boundary<span class="_ _15"> </span>tags<span class="_ _15"> </span>is<span class="_ _15"> </span>a<span class="_ _15"> </span>simple<span class="_ _15"> </span>and<span class="_ _15"> </span>elegant<span class="_ _15"> </span>one<span class="_ _15"> </span>that<span class="_ _15"> </span>generalizes<span class="_ _15"> </span>to</div><div class="t m5 x1d h26 y7356 ff7 fs19 fc1 sc0 ls0 ws0">many<span class="_ _16"> </span>different<span class="_ _16"> </span>types<span class="_ _11"> </span>of<span class="_ _16"> </span>allocators<span class="_ _16"> </span>and<span class="_ _16"> </span>free<span class="_ _16"> </span>list<span class="_ _16"> </span>organizations<span class="_ _1"></span>.<span class="_ _16"> </span>However,<span class="_ _16"> </span>there<span class="_ _11"> </span>is</div><div class="t m5 x1d h26 y7357 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_ _16"> </span>potential<span class="_ _14"> </span>disadvantage<span class="_ _0"></span>.<span class="_ _16"> </span>Requiring<span class="_ _14"> </span>each<span class="_ _14"> </span>block<span class="_ _16"> </span>to<span class="_ _14"> </span>contain<span class="_ _14"> </span>both<span class="_ _16"> </span>a<span class="_ _14"> </span>header<span class="_ _14"> </span>and<span class="_ _16"> </span>a</div><div class="t m5 x1d h26 y7358 ff7 fs19 fc1 sc0 ls0 ws0">footer<span class="_ _11"> </span>can<span class="_ _16"> </span>introduce<span class="_ _11"> </span>signiﬁcant<span class="_ _11"> </span>memory<span class="_ _16"> </span>overhead<span class="_ _11"> </span>if<span class="_ _16"> </span>an<span class="_ _11"> </span>application<span class="_ _11"> </span>manipulates</div><div class="t m5 x1d h26 y7359 ff7 fs19 fc1 sc0 ls0 ws0">many<span class="_ _16"> </span>small<span class="_ _16"> </span>blocks<span class="_ _3"></span>.<span class="_ _16"> </span>F<span class="_ _1"></span>or<span class="_ _16"> </span>example,<span class="_ _16"> </span>if<span class="_ _16"> </span>a<span class="_ _11"> </span>graph<span class="_ _16"> </span>application<span class="_ _16"> </span>dynamically<span class="_ _16"> </span>creates<span class="_ _16"> </span>and</div><div class="t m5 x1d h26 y735a ff7 fs19 fc1 sc0 ls0 ws0">destroys<span class="_ _6"> </span>graph<span class="_ _6"> </span>nodes<span class="_ _6"> </span>by<span class="_ _6"> </span>making<span class="_ _6"> </span>repeated<span class="_ _6"> </span>calls<span class="_ _6"> </span>to<span class="_ _6"> </span><span class="ffd">malloc<span class="_ _6"> </span></span>and<span class="_ _13"> </span><span class="ffd">free</span>,<span class="_ _6"> </span>and<span class="_ _6"> </span>each<span class="_ _6"> </span>graph</div><div class="t m5 x1d h26 y735b ff7 fs19 fc1 sc0 ls0 ws0">node<span class="_"> </span>requires<span class="_"> </span>only<span class="_ _11"> </span>a<span class="_"> </span>couple<span class="_"> </span>of<span class="_ _11"> </span>words<span class="_"> </span>of<span class="_"> </span>memory<span class="_ _3"></span>,<span class="_ _11"> </span>then<span class="_"> </span>the<span class="_"> </span>header<span class="_ _11"> </span>and<span class="_"> </span>the<span class="_"> </span>footer</div><div class="t m5 x1d h26 y735c ff7 fs19 fc1 sc0 ls0 ws0">will<span class="_"> </span>consume<span class="_"> </span>half<span class="_"> </span>of<span class="_"> </span>each<span class="_"> </span>allocated<span class="_"> </span>block.</div><div class="t m5 x29 h26 y735d ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>ortunately<span class="_ _3"></span>,<span class="_ _14"> </span>there<span class="_ _16"> </span>is<span class="_ _16"> </span>a<span class="_ _14"> </span>clever<span class="_ _16"> </span>optimization<span class="_ _16"> </span>of<span class="_ _14"> </span>boundary<span class="_ _16"> </span>tags<span class="_ _14"> </span>that<span class="_ _16"> </span>eliminates</div><div class="t m5 x1d h26 y735e ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>need<span class="_ _13"> </span>for<span class="_"> </span>a<span class="_ _13"> </span>footer<span class="_"> </span>in<span class="_ _13"> </span>allocated<span class="_"> </span>blocks<span class="_ _3"></span>.<span class="_"> </span>Recall<span class="_ _13"> </span>that<span class="_"> </span>when<span class="_ _13"> </span>we<span class="_"> </span>attempt<span class="_ _13"> </span>to<span class="_"> </span>coalesce</div><div class="t m5 x1d h26 y735f ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _16"> </span>current<span class="_ _11"> </span>block<span class="_ _16"> </span>with<span class="_ _16"> </span>the<span class="_ _11"> </span>previous<span class="_ _16"> </span>and<span class="_ _11"> </span>next<span class="_ _16"> </span>blocks<span class="_ _16"> </span>in<span class="_ _11"> </span>memory<span class="_ _3"></span>,<span class="_ _16"> </span>the<span class="_ _16"> </span>size<span class="_ _16"> </span>ﬁeld<span class="_ _11"> </span>in</div><div class="t m5 x1d h26 y7360 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>footer<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>previous<span class="_"> </span>block<span class="_"> </span>is<span class="_"> </span>only<span class="_"> </span>needed<span class="_"> </span>if<span class="_"> </span>the<span class="_"> </span>previous<span class="_"> </span>block<span class="_ _11"> </span>is<span class="_"> </span><span class="ffa">free</span><span class="ls2c2">.I<span class="_ _4a"></span>fw<span class="_ _4a"></span>e</span></div><div class="t m5 x1d h26 y7361 ff7 fs19 fc1 sc0 ls0 ws0">were<span class="_"> </span>to<span class="_ _13"> </span>store<span class="_"> </span>the<span class="_ _13"> </span>allocated/free<span class="_"> </span>bit<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>previous<span class="_"> </span>block<span class="_ _13"> </span>in<span class="_"> </span>one<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_"> </span>excess<span class="_ _13"> </span>low-</div><div class="t m5 x1d h26 y7362 ff7 fs19 fc1 sc0 ls0 ws0">order<span class="_"> </span>bits<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>current<span class="_"> </span>block,<span class="_"> </span>then<span class="_ _13"> </span>allocated<span class="_"> </span>blocks<span class="_"> </span>would<span class="_ _13"> </span>not<span class="_"> </span>need<span class="_"> </span>footers<span class="_ _3"></span>,<span class="_"> </span>and</div><div class="t m5 x1d h26 y7363 ff7 fs19 fc1 sc0 ls0 ws0">we<span class="_"> </span>could<span class="_"> </span>use<span class="_"> </span>that<span class="_"> </span>extra<span class="_"> </span>space<span class="_"> </span>for<span class="_"> </span>payload.<span class="_"> </span>Note<span class="_ _1"></span>,<span class="_"> </span>however,<span class="_ _13"> </span>that<span class="_"> </span>free<span class="_"> </span>blocks<span class="_"> </span>would</div><div class="t m5 x1d h26 y7364 ff7 fs19 fc1 sc0 ls0 ws0">still<span class="_"> </span>need<span class="_"> </span>footers<span class="_ _1"></span>.</div><div class="t m5 x1d h47 y9b8 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>9.7<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>919)</span></div><div class="t m5 x1d h26 y7a6 ff7 fs19 fc1 sc0 ls0 ws0">Determine<span class="_ _15"> </span>the<span class="_ _15"> </span>minimum<span class="_ _15"> </span>block<span class="_ _15"> </span>size<span class="_ _21"> </span>for<span class="_ _15"> </span>each<span class="_ _15"> </span>of<span class="_ _15"> </span>the<span class="_ _15"> </span>following<span class="_ _21"> </span>combinations<span class="_ _15"> </span>of</div><div class="t m5 x1d h26 y7a7 ff7 fs19 fc1 sc0 ls0 ws0">alignment<span class="_"> </span>requirements<span class="_ _11"> </span>and<span class="_"> </span>block<span class="_ _11"> </span>formats<span class="_ _1"></span>.<span class="_"> </span>Assumptions:<span class="_ _11"> </span>Implicit<span class="_"> </span>free<span class="_ _11"> </span>list,<span class="_"> </span>zero-</div><div class="t m5 x1d h26 y7a8 ff7 fs19 fc1 sc0 ls0 ws0">size<span class="_ _13"> </span>payloads<span class="_ _13"> </span>are<span class="_"> </span>not<span class="_ _13"> </span>allowed,<span class="_ _13"> </span>and<span class="_ _13"> </span>headers<span class="_"> </span>and<span class="_ _13"> </span>footers<span class="_ _13"> </span>are<span class="_ _13"> </span>stored<span class="_ _13"> </span>in<span class="_"> </span>4-byte<span class="_ _13"> </span>words<span class="_ _3"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
