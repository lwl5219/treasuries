<div id="pf25a" class="pf w2 h11" data-page-no="25a"><div class="pc pc25a w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg25a.png"/><div class="t m5 x10f h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>5.14<span class="_ _60"> </span>Identifying<span class="_ _10"> </span>and<span class="_ _10"> </span>Eliminating<span class="_ _10"> </span>Performance<span class="_ _10"> </span>Bottlenecks<span class="_ _3e"> </span><span class="ffe fs1e">601</span></div><div class="t m5 x17 h41 y9c ffe fs29 fc2 sc0 ls0 ws0">5.14.2<span class="_ _48"> </span><span class="fs19">Using<span class="_"> </span>a<span class="_"> </span>Proﬁler<span class="_"> </span>to<span class="_"> </span>Guide<span class="_"> </span>Optimization</span></div><div class="t m5 x17 h26 y327 ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_ _6"> </span>an<span class="_ _13"> </span>example<span class="_ _a"> </span>of<span class="_ _13"> </span>using<span class="_ _a"> </span>a<span class="_ _13"> </span>proﬁler<span class="_ _6"> </span>to<span class="_ _6"> </span>guide<span class="_ _13"> </span>program<span class="_ _a"> </span>optimization,<span class="_ _13"> </span>we<span class="_ _6"> </span>created<span class="_ _13"> </span>an<span class="_ _a"> </span>ap-</div><div class="t m5 x17 h26 y328 ff7 fs19 fc2 sc0 ls0 ws0">plication<span class="_ _13"> </span>that<span class="_ _13"> </span>involves<span class="_ _13"> </span>several<span class="_"> </span>different<span class="_ _13"> </span>tasks<span class="_ _13"> </span>and<span class="_ _13"> </span>data<span class="_ _13"> </span>structures<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _3"></span>his<span class="_"> </span>application</div><div class="t m5 x17 h26 y329 ff7 fs19 fc2 sc0 ls0 ws0">analyzes<span class="_"> </span>the<span class="_"> </span><span class="ff11">n<span class="ffa">-gram<span class="_"> </span></span></span>statistics<span class="_"> </span>of<span class="_ _11"> </span>a<span class="_"> </span>text<span class="_"> </span>document,<span class="_ _11"> </span>where<span class="_"> </span>an<span class="_"> </span><span class="ff11">n</span>-gram<span class="_ _11"> </span>is<span class="_"> </span>a<span class="_"> </span>sequence</div><div class="t m5 x17 h46 y32a ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_"> </span><span class="ff11">n<span class="_ _11"> </span></span>words<span class="_ _11"> </span>occurring<span class="_ _11"> </span>in<span class="_ _11"> </span>a<span class="_ _11"> </span>document.<span class="_ _11"> </span>F<span class="_ _1"></span>or<span class="_ _11"> </span><span class="ff11">n<span class="_ _10"> </span><span class="ff12">=<span class="_ _13"> </span></span></span>1<span class="_ _0"></span>,<span class="_ _11"> </span>we<span class="_ _11"> </span>collect<span class="_ _11"> </span>statistics<span class="_ _11"> </span>on<span class="_ _11"> </span>individual</div><div class="t m5 x17 h46 y32b ff7 fs19 fc2 sc0 ls0 ws0">words<span class="_ _1"></span>,<span class="_"> </span>for<span class="_"> </span><span class="ff11">n<span class="_ _13"> </span><span class="ff12">=<span class="_ _13"></span></span></span>2<span class="_"> </span>on<span class="_"> </span>pairs<span class="_"> </span>of<span class="_ _13"> </span>words<span class="_ _1"></span>,<span class="_"> </span>and<span class="_"> </span>so<span class="_"> </span>on.<span class="_ _13"> </span>F<span class="_ _0"></span>or<span class="_"> </span>a<span class="_ _13"> </span>given<span class="_"> </span>value<span class="_"> </span>of<span class="_"> </span><span class="ff11">n</span>,<span class="_ _13"> </span>our<span class="_"> </span>program</div><div class="t m5 x17 h26 y32c ff7 fs19 fc2 sc0 ls0 ws0">reads<span class="_"> </span>a<span class="_"> </span>text<span class="_"> </span>ﬁle,<span class="_"> </span>creates<span class="_"> </span>a<span class="_"> </span>table<span class="_"> </span>of<span class="_ _11"> </span>unique<span class="_"> </span><span class="ff11">n</span>-grams<span class="_"> </span>and<span class="_ _11"> </span>how<span class="_"> </span>many<span class="_"> </span>times<span class="_"> </span>each<span class="_ _11"> </span>one</div><div class="t m5 x17 h26 y32d ff7 fs19 fc2 sc0 ls0 ws0">occurs<span class="_ _1"></span>,<span class="_"> </span>then<span class="_"> </span>sorts<span class="_"> </span>the<span class="_"> </span><span class="ff11">n</span>-grams<span class="_"> </span>in<span class="_"> </span>descending<span class="_"> </span>order<span class="_"> </span>of<span class="_"> </span>occurrence<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y32e ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_ _6"> </span>a<span class="_ _6"> </span>benchmark,<span class="_ _13"> </span>we<span class="_ _6"> </span>ran<span class="_ _6"> </span>it<span class="_ _13"> </span>on<span class="_ _a"> </span>a<span class="_ _13"> </span>ﬁle<span class="_ _6"> </span>consisting<span class="_ _6"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>complete<span class="_ _a"> </span>works<span class="_ _13"> </span>of<span class="_ _a"> </span>William</div><div class="t m5 x17 h26 y1cf ff7 fs19 fc2 sc0 ls0 ws0">Shakespeare<span class="_ _1"></span>,<span class="_ _16"> </span>totaling<span class="_ _11"> </span>965,028<span class="_ _16"> </span>words<span class="_ _3"></span>,<span class="_ _16"> </span>of<span class="_ _11"> </span>which<span class="_ _16"> </span>23,706<span class="_ _11"> </span>are<span class="_ _11"> </span>unique<span class="_ _0"></span>.<span class="_ _11"> </span>W<span class="_ _1"></span>e<span class="_ _11"> </span>found<span class="_ _11"> </span>that</div><div class="t m5 x17 h46 y32f ff7 fs19 fc2 sc0 ls0 ws0">for<span class="_ _13"> </span><span class="ff11">n<span class="_ _13"> </span><span class="ff12">=<span class="_ _13"></span></span></span>1<span class="_ _1"></span>,<span class="_ _13"> </span>even<span class="_ _13"> </span>a<span class="_ _13"> </span>poorly<span class="_ _13"> </span>written<span class="_ _6"> </span>analysis<span class="_ _13"> </span>program<span class="_ _13"> </span>can<span class="_ _13"> </span>readily<span class="_ _6"> </span>process<span class="_ _13"> </span>the<span class="_ _13"> </span>entire<span class="_ _13"> </span>ﬁle</div><div class="t m5 x17 h46 y330 ff7 fs19 fc2 sc0 ls0 ws0">in<span class="_"> </span>under<span class="_ _11"> </span>1<span class="_ _11"> </span>second,<span class="_ _16"> </span>and<span class="_"> </span>so<span class="_ _11"> </span>we<span class="_ _11"> </span>set<span class="_ _11"> </span><span class="ff11">n<span class="_ _10"> </span><span class="ff12">=<span class="_ _13"> </span></span></span>2<span class="_ _11"> </span>to<span class="_ _11"> </span>make<span class="_ _11"> </span>things<span class="_ _11"> </span>more<span class="_ _11"> </span>challenging.<span class="_ _11"> </span>F<span class="_ _1"></span>or<span class="_ _11"> </span>the</div><div class="t m5 x17 h46 y331 ff7 fs19 fc2 sc0 ls0 ws0">case<span class="_"> </span>of<span class="_"> </span><span class="ff11">n<span class="_ _13"> </span><span class="ff12">=<span class="_ _10"> </span></span></span><span class="ls26">2,<span class="_ _10"> </span></span><span class="ff11">n</span>-grams<span class="_"> </span>are<span class="_"> </span>referred<span class="_"> </span>to<span class="_ _13"> </span>as<span class="_"> </span><span class="ffa">bigrams<span class="_"> </span></span>(pronounced<span class="_"> </span>“bye-grams”).<span class="_"> </span>W<span class="_ _1"></span>e</div><div class="t m5 x17 h26 y4da6 ff7 fs19 fc2 sc0 ls0 ws0">determined<span class="_"> </span>that<span class="_ _11"> </span>Shakespeare’s<span class="_"> </span>works<span class="_"> </span>contain<span class="_ _11"> </span>363,039<span class="_ _11"> </span>unique<span class="_"> </span>bigrams<span class="_ _1"></span>.<span class="_ _11"> </span>The<span class="_"> </span>most</div><div class="t m5 x17 h26 y203d ff7 fs19 fc2 sc0 ls0 ws0">common<span class="_ _16"> </span>is<span class="_ _16"> </span>“I<span class="_ _16"> </span>am,<span class="_ _1"></span>”<span class="_ _14"> </span>occurring<span class="_ _16"> </span>1,892<span class="_ _16"> </span>times<span class="_ _1"></span>.<span class="_ _16"> </span>Perhaps<span class="_ _16"> </span>his<span class="_ _16"> </span>most<span class="_ _16"> </span>famous<span class="_ _14"> </span>bigram,<span class="_ _16"> </span>“to</div><div class="t m5 x17 h26 y203e ff7 fs19 fc2 sc0 ls0 ws0">be<span class="_ _1"></span>,<span class="_ _1"></span>”<span class="_"> </span>occurs<span class="_"> </span>1,020<span class="_"> </span>times<span class="_ _0"></span>.<span class="_"> </span>Fully<span class="_"> </span>266,018<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>bigrams<span class="_"> </span>occur<span class="_"> </span>only<span class="_"> </span>once<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y203f ff7 fs19 fc2 sc0 ls0 ws0">Our<span class="_ _14"> </span>program<span class="_ _14"> </span>consists<span class="_ _14"> </span>of<span class="_ _14"> </span>the<span class="_ _14"> </span>following<span class="_ _14"> </span>parts<span class="_ _1"></span>.<span class="_ _14"> </span>W<span class="_ _3"></span>e<span class="_ _14"> </span>created<span class="_ _15"> </span>multiple<span class="_ _14"> </span>versions<span class="_ _1"></span>,</div><div class="t m5 x17 h26 y50f5 ff7 fs19 fc2 sc0 ls0 ws0">starting<span class="_ _14"> </span>with<span class="_ _14"> </span>simple<span class="_ _14"> </span>algorithms<span class="_ _14"> </span>for<span class="_ _14"> </span>the<span class="_ _14"> </span>different<span class="_ _14"> </span>parts<span class="_ _14"> </span>and<span class="_ _14"> </span>then<span class="_ _14"> </span>replacing<span class="_ _14"> </span>them</div><div class="t m5 x17 h26 y50f6 ff7 fs19 fc2 sc0 ls0 ws0">with<span class="_"> </span>more<span class="_"> </span>sophisticated<span class="_"> </span>ones:</div><div class="t m5 x52 h26 y50f7 ffc fs19 fc2 sc0 ls0 ws0">1.<span class="_ _e"> </span><span class="ff7">Each<span class="_ _13"> </span>word<span class="_ _13"> </span>is<span class="_ _6"> </span>read<span class="_ _13"> </span>from<span class="_ _6"> </span>the<span class="_ _13"> </span>ﬁle<span class="_ _13"> </span>and<span class="_ _6"> </span>converted<span class="_ _13"> </span>to<span class="_ _6"> </span>lowercase.<span class="_ _6"> </span>Our<span class="_ _13"> </span>initial<span class="_ _6"> </span>version</span></div><div class="t m5 x26 h26 y50f8 ff7 fs19 fc2 sc0 ls0 ws0">used<span class="_"> </span>the<span class="_"> </span>function<span class="_"> </span><span class="ffd">lower1<span class="_ _10"> </span></span>(Figure<span class="_"> </span>5.7),<span class="_"> </span>which<span class="_"> </span>we<span class="_"> </span>know<span class="_"> </span>to<span class="_"> </span>have<span class="_"> </span>quadratic<span class="_"> </span>run</div><div class="t m5 x26 h26 y50f9 ff7 fs19 fc2 sc0 ls0 ws0">time<span class="_"> </span>due<span class="_"> </span>to<span class="_"> </span>repeated<span class="_"> </span>calls<span class="_"> </span>to<span class="_"> </span><span class="ffd">strlen</span>.</div><div class="t m5 x52 h26 y50fa ffc fs19 fc2 sc0 ls0 ws0">2.<span class="_ _e"> </span><span class="ff7">A<span class="_ _14"> </span>hash<span class="_ _14"> </span>function<span class="_ _14"> </span>is<span class="_ _16"> </span>applied<span class="_ _14"> </span>to<span class="_ _14"> </span>the<span class="_ _16"> </span>string<span class="_ _14"> </span>to<span class="_ _14"> </span>create<span class="_ _14"> </span>a<span class="_ _16"> </span>number<span class="_ _14"> </span>between<span class="_ _14"> </span>0<span class="_ _16"> </span>and</span></div><div class="t m5 x26 h46 y50fb ff11 fs19 fc2 sc0 ls0 ws0">s<span class="_ _11"> </span><span class="ff12">−<span class="_ _13"> </span><span class="ff7">1<span class="_ _0"></span>,<span class="_"> </span>for<span class="_ _13"> </span>a<span class="_"> </span>hash<span class="_"> </span>table<span class="_ _13"> </span>with<span class="_"> </span><span class="ff11">s<span class="_ _11"> </span></span>buckets<span class="_ _0"></span>.<span class="_"> </span>Our<span class="_ _13"> </span>initial<span class="_"> </span>function<span class="_"> </span>simply<span class="_ _13"> </span>summed<span class="_"> </span>the</span></span></div><div class="t m5 x26 h26 y50fc ff7 fs19 fc2 sc0 ls0 ws0">ASCII<span class="_"> </span>codes<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>characters<span class="_"> </span>modulo<span class="_"> </span><span class="ff11">s<span class="_ _2"></span></span>.</div><div class="t m5 x1cd h26 y50fd ffc fs19 fc2 sc0 ls0 ws0">3.<span class="_ _e"> </span><span class="ff7">Each<span class="_ _16"> </span>hash<span class="_"> </span>bucket<span class="_ _11"> </span>is<span class="_ _11"> </span>organized<span class="_ _11"> </span>as<span class="_ _11"> </span>a<span class="_ _11"> </span>linked<span class="_ _16"> </span>list.<span class="_"> </span>The<span class="_"> </span>program<span class="_ _11"> </span>scans<span class="_ _11"> </span>down<span class="_ _11"> </span>this</span></div><div class="t m5 x26 h26 y50fe ff7 fs19 fc2 sc0 ls0 ws0">list<span class="_ _13"> </span>looking<span class="_ _13"> </span>for<span class="_ _13"> </span>a<span class="_ _13"> </span>matching<span class="_ _13"> </span>entry<span class="_ _7"></span>.<span class="_ _13"> </span>If<span class="_ _13"> </span>one<span class="_ _13"> </span>is<span class="_ _13"> </span>found,<span class="_ _13"> </span>the<span class="_ _13"> </span>frequency<span class="_ _13"> </span>for<span class="_ _13"> </span>this<span class="_ _13"> </span><span class="ff11">n</span>-gram</div><div class="t m5 x26 h26 y50ff ff7 fs19 fc2 sc0 ls0 ws0">is<span class="_ _11"> </span>incremented.<span class="_ _16"> </span>Otherwise<span class="_ _1"></span>,<span class="_ _16"> </span>a<span class="_ _16"> </span>new<span class="_ _11"> </span>list<span class="_ _16"> </span>element<span class="_ _11"> </span>is<span class="_ _16"> </span>created.<span class="_ _16"> </span>Our<span class="_ _11"> </span>initial<span class="_ _16"> </span>version</div><div class="t m5 x26 h26 y5100 ff7 fs19 fc2 sc0 ls0 ws0">performed<span class="_ _13"> </span>this<span class="_ _13"> </span>operation<span class="_ _13"> </span>recursively<span class="_ _7"></span>,<span class="_ _13"> </span>inserting<span class="_ _13"> </span>new<span class="_ _13"> </span>elements<span class="_ _13"> </span>at<span class="_ _13"> </span>the<span class="_ _13"> </span>end<span class="_ _13"> </span>of<span class="_ _13"> </span>the</div><div class="t m5 x26 h26 y5101 ff7 fs19 fc2 sc0 ls0 ws0">list.</div><div class="t m5 x1cd h26 y5102 ffc fs19 fc2 sc0 ls0 ws0">4.<span class="_ _e"> </span><span class="ff7">Once<span class="_ _16"> </span>the<span class="_ _11"> </span>table<span class="_ _11"> </span>has<span class="_ _16"> </span>been<span class="_ _11"> </span>generated,<span class="_ _11"> </span>we<span class="_ _16"> </span>sort<span class="_ _11"> </span>all<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_"> </span>elements<span class="_ _16"> </span>according<span class="_ _11"> </span>to</span></div><div class="t m5 x26 h26 y5103 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>frequencies<span class="_ _1"></span>.<span class="_"> </span>Our<span class="_"> </span>initial<span class="_"> </span>version<span class="_"> </span>used<span class="_"> </span>insertion<span class="_"> </span>sort.</div><div class="t m5 x26 h26 y5104 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _11"> </span>5.38<span class="_"> </span>shows<span class="_ _11"> </span>the<span class="_ _11"> </span>proﬁle<span class="_"> </span>results<span class="_ _11"> </span>for<span class="_"> </span>six<span class="_ _11"> </span>different<span class="_"> </span>versions<span class="_ _11"> </span>of<span class="_ _11"> </span>our<span class="_"> </span><span class="ff11">n</span>-gram-</div><div class="t m5 x17 h26 y5105 ff7 fs19 fc2 sc0 ls0 ws0">frequency<span class="_ _13"> </span>analysis<span class="_"> </span>program.<span class="_"> </span>F<span class="_ _3"></span>or<span class="_"> </span>each<span class="_"> </span>version,<span class="_ _13"> </span>we<span class="_"> </span>divide<span class="_"> </span>the<span class="_ _13"> </span>time<span class="_"> </span>into<span class="_"> </span>the<span class="_"> </span>follow-</div><div class="t m5 x17 h26 y5106 ff7 fs19 fc2 sc0 ls0 ws0">ing<span class="_"> </span>categories:</div><div class="t m5 x72 h26 y5107 ff7 fs19 fc2 sc0 ls0 ws0">Sort.<span class="_ _e"> </span>Sorting<span class="_"> </span><span class="ff11">n</span>-grams<span class="_"> </span>by<span class="_"> </span>frequency</div><div class="t m5 x72 h26 y5108 ff7 fs19 fc2 sc0 ls0 ws0">List.<span class="_ _e"> </span>Scanning<span class="_"> </span>the<span class="_"> </span>linked<span class="_ _13"> </span>list<span class="_"> </span>for<span class="_ _13"> </span>a<span class="_"> </span>matching<span class="_"> </span><span class="ff11">n</span>-gram,<span class="_ _13"> </span>inserting<span class="_"> </span>a<span class="_ _13"> </span>new<span class="_"> </span>element<span class="_"> </span>if</div><div class="t m5 x30 h26 y5109 ff7 fs19 fc2 sc0 ls0 ws0">necessary</div><div class="t m5 x72 h26 y510a ff7 fs19 fc2 sc0 ls0 ws0">Lower.<span class="_ _e"> </span>Converting<span class="_"> </span>strings<span class="_"> </span>to<span class="_"> </span>lowercase</div><div class="t m5 x72 h26 y510b ff7 fs19 fc2 sc0 ls0 ws0">Strlen.<span class="_ _e"> </span>Computing<span class="_"> </span>string<span class="_"> </span>lengths</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
