<div id="pf314" class="pf w2 h11" data-page-no="314"><div class="pc pc314 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg314.png"/><div class="t m5 x100 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>8.4<span class="_ _60"> </span>Process<span class="_ _10"> </span>Control<span class="_ _3e"> </span><span class="ffe fs1e">787</span></div><div class="t m5 x17 h2f ye7 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>8.20</div><div class="t m5 x17 h2f y58a ffe fs16 fc1 sc0 ls0 ws0">Organization<span class="_ _15"> </span>of<span class="_ _15"> </span>an</div><div class="t m5 x17 h2f y58b ffe fs16 fc1 sc0 ls0 ws0">argument<span class="_"> </span>list.</div><div class="t m8 xfe h3f y66fa ff97 fs27 fc1 sc0 ls0 ws0">…</div><div class="t m5 x19b h70 y66fb ff9b fs27 fc1 sc0 ls0 ws0">argv[]</div><div class="c xb3 y66fc w2c h102"><div class="t m5 x31 h70 y66fd ff9b fs27 fc3 sc1 ls0 ws0">argv[]</div></div><div class="t m5 x1e7 h70 y66fe ff9b fs27 fc1 sc0 ls0 ws0">argv[0]<span class="_ _e8"> </span>&quot;ls&quot;</div><div class="t m5 xe9 h70 y66ff ff9b fs27 fc1 sc0 ls0 ws0">&quot;-lt&quot;</div><div class="t m5 x164 h70 y6700 ff9b fs27 fc1 sc0 ls0 ws0">&quot;/user/include&quot;</div><div class="t m5 x27e h70 y6701 ff9b fs27 fc1 sc0 ls0 ws0">argv</div><div class="t m5 x1e7 h70 y6702 ff9b fs27 fc1 sc0 ls0 ws0">argv[1]</div><div class="t m5 x114 h70 y6703 ff9b fs27 fc1 sc0 ls0 ws0">argv[argc<span class="_ _6"> </span><span class="ff24"><span class="_ _6"> </span></span>1]</div><div class="t m5 xfb h70 y6704 ff9b fs27 fc1 sc0 ls0 ws0">NULL</div><div class="t m5 x17 h2f y6705 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>8.21</div><div class="t m5 x17 h2f y6706 ffe fs16 fc1 sc0 ls0 ws0">Organization<span class="_ _15"> </span>of<span class="_ _15"> </span>an</div><div class="t m5 x17 h2f y6707 ffe fs16 fc1 sc0 ls0 ws0">environment<span class="_"> </span>variable<span class="_"> </span>list.</div><div class="t m8 xfe h3f y6708 ff97 fs27 fc1 sc0 ls0 ws0">…</div><div class="t m5 x19b h70 y6709 ff9b fs27 fc1 sc0 ls0 ws0">envp[]</div><div class="c xb3 y670a w2c h102"><div class="t m5 x31 h70 y66fd ff9b fs27 fc3 sc1 ls0 ws0">envp[]</div></div><div class="t m5 x1e7 h70 y670b ff9b fs27 fc1 sc0 ls0 ws0">envp[0]<span class="_ _7a"> </span>&quot;PWD<span class="ff24"></span>/usr/droh&quot;</div><div class="t m5 x46 h70 y670c ff9b fs27 fc1 sc0 ls0 ws0">&quot;PRINTER<span class="ff24"></span>iron&quot;</div><div class="t m5 x1c1 h70 y670d ff9b fs27 fc1 sc0 ls0 ws0">&quot;USER<span class="ff24"></span>droh&quot;</div><div class="t m5 x27e h70 y670e ff9b fs27 fc1 sc0 ls0 ws0">envp</div><div class="t m5 x1e7 h70 y670f ff9b fs27 fc1 sc0 ls0 ws0">envp[1]</div><div class="t m5 x5e h70 y6710 ff9b fs27 fc1 sc0 ls0 ws0">envp[n<span class="_ _6"> </span><span class="ff24"><span class="_ _6"> </span></span>1]</div><div class="t m5 xfb h70 y6711 ff9b fs27 fc1 sc0 ls0 ws0">NULL</div><div class="t m5 x26 h26 y6712 ff7 fs19 fc1 sc0 ls0 ws0">After<span class="_ _21"> </span><span class="ffd">execve<span class="_ _21"> </span></span>loads<span class="_ _f"> </span><span class="ffd">filename</span>,<span class="_ _e"> </span>it<span class="_ _15"> </span>calls<span class="_ _f"> </span>the<span class="_ _21"> </span>start-up<span class="_ _f"> </span>code<span class="_ _21"> </span>described<span class="_ _f"> </span>in<span class="_ _21"> </span>Sec-</div><div class="t m5 x17 h26 y6713 ff7 fs19 fc1 sc0 ls0 ws0">tion<span class="_ _13"> </span>7.9.<span class="_ _13"> </span>T<span class="_ _0"></span>he<span class="_ _13"> </span>start-up<span class="_ _13"> </span>code<span class="_ _13"> </span>sets<span class="_ _13"> </span>up<span class="_ _13"> </span>the<span class="_ _13"> </span>stack<span class="_"> </span>and<span class="_ _13"> </span>passes<span class="_ _13"> </span>control<span class="_ _13"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>main<span class="_ _13"> </span>routine</div><div class="t m5 x17 h26 y6714 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span>the<span class="_"> </span>new<span class="_"> </span>program,<span class="_"> </span>which<span class="_"> </span>has<span class="_"> </span>a<span class="_"> </span>prototype<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>form</div><div class="t m5 x17 h2d y6715 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>main(int<span class="_ _1f"> </span>argc,<span class="_ _1f"> </span>char<span class="_ _e"> </span>**argv,<span class="_ _1f"> </span>char<span class="_ _e"> </span>**envp);</div><div class="t m5 x17 h26 y6716 ff7 fs19 fc2 sc0 ls0 ws0">or<span class="_"> </span>equivalently<span class="_ _3"></span>,</div><div class="t m5 x17 h2d y6717 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>main(int<span class="_ _1f"> </span>argc,<span class="_ _1f"> </span>char<span class="_ _e"> </span>*argv[],<span class="_ _1f"> </span>char<span class="_ _e"> </span>*envp[]);</div><div class="t m5 x17 h26 y6718 ff7 fs19 fc2 sc0 ls0 ws0">When<span class="_ _16"> </span><span class="ffd">main<span class="_ _16"> </span></span>begins<span class="_ _16"> </span>executing,<span class="_ _16"> </span>the<span class="_ _14"> </span>user<span class="_ _16"> </span>stack<span class="_ _16"> </span>has<span class="_ _16"> </span>the<span class="_ _14"> </span>organization<span class="_ _16"> </span>shown<span class="_ _16"> </span>in<span class="_ _14"> </span>F<span class="_ _1"></span>ig-</div><div class="t m5 x17 h26 y6719 ff7 fs19 fc2 sc0 ls0 ws0">ure<span class="_ _11"> </span>8.22.<span class="_ _11"> </span>Let’s<span class="_ _11"> </span>work<span class="_ _16"> </span>our<span class="_ _11"> </span>way<span class="_ _11"> </span>from<span class="_ _11"> </span>the<span class="_ _16"> </span>bottom<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>stack<span class="_ _11"> </span>(the<span class="_ _11"> </span>highest<span class="_ _16"> </span>address)</div><div class="t m5 x17 h26 y671a ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_ _11"> </span>the<span class="_ _16"> </span>top<span class="_ _11"> </span>(the<span class="_ _11"> </span>lowest<span class="_ _16"> </span>address).<span class="_ _11"> </span>F<span class="_ _0"></span>irst<span class="_ _11"> </span>are<span class="_ _16"> </span>the<span class="_ _11"> </span>argument<span class="_ _11"> </span>and<span class="_ _16"> </span>environment<span class="_ _11"> </span>strings<span class="_ _1"></span>.</div><div class="t m5 x17 h26 y671b ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>hese<span class="_ _14"> </span>are<span class="_ _14"> </span>followed<span class="_ _16"> </span>further<span class="_ _14"> </span>up<span class="_ _14"> </span>the<span class="_ _16"> </span>stack<span class="_ _14"> </span>by<span class="_ _14"> </span>a<span class="_ _14"> </span>null-terminated<span class="_ _16"> </span>array<span class="_ _14"> </span>of<span class="_ _14"> </span>pointers<span class="_ _1"></span>,</div><div class="t m5 x17 h26 y671c ff7 fs19 fc2 sc0 ls0 ws0">each<span class="_ _11"> </span>of<span class="_ _16"> </span>which<span class="_ _16"> </span>points<span class="_ _11"> </span>to<span class="_ _16"> </span>an<span class="_ _16"> </span>environment<span class="_ _11"> </span>variable<span class="_ _16"> </span>string<span class="_ _16"> </span>on<span class="_ _11"> </span>the<span class="_ _16"> </span>stack.<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span>global</div><div class="t m5 x17 h26 y671d ff7 fs19 fc2 sc0 ls0 ws0">variable<span class="_"> </span><span class="ffd">environ<span class="_ _11"> </span></span>points<span class="_"> </span>to<span class="_ _11"> </span>the<span class="_ _11"> </span>ﬁrst<span class="_"> </span>of<span class="_ _11"> </span>these<span class="_"> </span>pointers<span class="_ _0"></span>,<span class="_"> </span><span class="ffd">envp[0]</span>.<span class="_ _11"> </span>T<span class="_ _1"></span>he<span class="_ _11"> </span>environment</div><div class="t m5 x17 h26 y671e ff7 fs19 fc2 sc0 ls0 ws0">array<span class="_ _13"> </span>is<span class="_ _13"> </span>followed<span class="_ _13"> </span>by<span class="_ _13"> </span>the<span class="_"> </span>null-terminated<span class="_ _13"> </span><span class="ffd">argv[]<span class="_ _13"> </span></span>array<span class="_ _7"></span>,<span class="_"> </span>with<span class="_ _13"> </span>each<span class="_ _13"> </span>element<span class="_ _13"> </span>pointing</div><div class="t m5 x17 h26 y671f ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_"> </span>an<span class="_ _11"> </span>argument<span class="_ _11"> </span>string<span class="_ _11"> </span>on<span class="_ _11"> </span>the<span class="_ _11"> </span>stack.<span class="_ _11"> </span>At<span class="_ _11"> </span>the<span class="_ _11"> </span>top<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_"> </span>stack<span class="_ _11"> </span>is<span class="_ _11"> </span>the<span class="_ _11"> </span>stack<span class="_ _11"> </span>frame<span class="_ _11"> </span>for</div><div class="t m5 x17 h26 y6720 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>system<span class="_"> </span>start-up<span class="_"> </span>function,<span class="_"> </span><span class="ffd">libc_start_main<span class="_ _10"> </span></span>(Section<span class="_"> </span>7.9).</div><div class="t m5 x26 h26 y6721 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>here<span class="_"> </span>are<span class="_"> </span>three<span class="_ _13"> </span>arguments<span class="_"> </span>to<span class="_"> </span>function<span class="_ _13"> </span><span class="ffd">main</span>,<span class="_"> </span>each<span class="_"> </span>stored<span class="_ _13"> </span>in<span class="_"> </span>a<span class="_"> </span>register<span class="_ _13"> </span>accord-</div><div class="t m5 x17 h26 y6722 ff7 fs19 fc2 sc0 ls0 ws0">ing<span class="_ _16"> </span>to<span class="_ _16"> </span>the<span class="_ _16"> </span>x86-64<span class="_ _16"> </span>stack<span class="_ _16"> </span>discipline:<span class="_ _16"> </span>(1)<span class="_ _11"> </span><span class="ffd">argc</span>,<span class="_ _14"> </span>which<span class="_ _16"> </span>gives<span class="_ _16"> </span>the<span class="_ _16"> </span>number<span class="_ _16"> </span>of<span class="_ _16"> </span>non-null</div><div class="t m5 x17 h26 y6723 ff7 fs19 fc2 sc0 ls0 ws0">pointers<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_ _6"> </span><span class="ffd">argv[]<span class="_ _13"> </span></span>array;<span class="_ _13"> </span>(2)<span class="_ _13"> </span><span class="ffd">argv</span>,<span class="_ _13"> </span>which<span class="_ _13"> </span>points<span class="_ _13"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>ﬁrst<span class="_ _6"> </span>entry<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ffd">argv[]</span></div><div class="t m5 x17 h26 y6724 ff7 fs19 fc2 sc0 ls0 ws0">array;<span class="_"> </span>and<span class="_"> </span>(3)<span class="_"> </span><span class="ffd">envp</span>,<span class="_"> </span>which<span class="_"> </span>points<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>ﬁrst<span class="_"> </span>entry<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span><span class="ffd">envp[]<span class="_ _10"> </span></span>array<span class="_ _3"></span>.</div><div class="t m5 x26 h26 y6725 ff7 fs19 fc2 sc0 ls0 ws0">Linux<span class="_"> </span>provides<span class="_"> </span>several<span class="_"> </span>functions<span class="_"> </span>for<span class="_"> </span>manipulating<span class="_"> </span>the<span class="_"> </span>environment<span class="_"> </span>array:</div><div class="t m5 x31 h2d y619c ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;stdlib.h&gt;</div><div class="t m5 x31 h2d y619d ffd fs1e fc2 sc0 ls0 ws0">char<span class="_ _e"> </span>*getenv(const<span class="_ _1f"> </span>char<span class="_ _1f"> </span>*name);</div><div class="t m5 x89 hf1 y619e ff7 fs1f fc2 sc0 ls0 ws0">Returns:<span class="_"> </span>pointer<span class="_"> </span>to<span class="_"> </span><span class="ffd fs4e">name<span class="_ _13"> </span></span>if<span class="_"> </span>it<span class="_"> </span>exists,<span class="_"> </span>NULL<span class="_"> </span>if<span class="_"> </span>no<span class="_"> </span>match</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
