<div id="pf105" class="pf w2 h11" data-page-no="105"><div class="pc pc105 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg105.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">260<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x1d h34 ye7 ff6 fs16 fc2 sc0 ls0 ws0">(a)<span class="_ _10"> </span>C<span class="_ _11"> </span>code</div><div class="t m5 x1d h2d y2283 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>fact_while(long<span class="_ _1f"> </span>n)</div><div class="t m5 x1d h2d y2284 ffd fs1e fc2 sc0 ls0 ws0">{</div><div class="t m5 x10c h2d y2285 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>result<span class="_ _1f"> </span>=<span class="_ _1f"> </span>1;</div><div class="t m5 x10c h2d y2286 ffd fs1e fc2 sc0 ls0 ws0">while<span class="_ _e"> </span>(n<span class="_ _1f"> </span>&gt;<span class="_ _1f"> </span>1)<span class="_ _e"> </span>{</div><div class="t m5 x22b h2d y2287 ffd fs1e fc2 sc0 ls0 ws0">result<span class="_ _e"> </span>*=<span class="_ _1f"> </span>n;</div><div class="t m5 x22b h2d y2288 ffd fs1e fc2 sc0 ls0 ws0">n<span class="_ _e"> </span>=<span class="_ _1f"> </span>n-1;</div><div class="t m5 x10c h2d y23a1 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x10c h2d y23a2 ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>result;</div><div class="t m5 x1d h2d y2554 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x1e2 h34 y26f7 ff6 fs16 fc2 sc0 ls0 ws0">(b)<span class="_ _10"> </span>Equivalent<span class="_ _11"> </span>goto<span class="_ _10"> </span>version</div><div class="t m5 x1e2 h2d y26f8 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>fact_while_jm_goto(long<span class="_ _1f"> </span>n)</div><div class="t m5 x1e2 h2d y26f9 ffd fs1e fc2 sc0 ls0 ws0">{</div><div class="t m5 x1bc h2d y26fa ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>result<span class="_ _1f"> </span>=<span class="_ _1f"> </span>1;</div><div class="t m5 x1bc h2d y26fb ffd fs1e fc2 sc0 ls0 ws0">goto<span class="_ _e"> </span>test;</div><div class="t m5 x19b h2d y26fc ffd fs1e fc2 sc0 ls0 ws0">loop:</div><div class="t m5 x1bc h2d y26fd ffd fs1e fc2 sc0 ls0 ws0">result<span class="_ _e"> </span>*=<span class="_ _1f"> </span>n;</div><div class="t m5 x1bc h2d y26fe ffd fs1e fc2 sc0 ls0 ws0">n<span class="_ _e"> </span>=<span class="_ _1f"> </span>n-1;</div><div class="t m5 x19b h2d y26ff ffd fs1e fc2 sc0 ls0 ws0">test:</div><div class="t m5 x1bc h2d y2700 ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>(n<span class="_ _1f"> </span>&gt;<span class="_ _1f"> </span>1)</div><div class="t m5 x1e8 h2d y2701 ffd fs1e fc2 sc0 ls0 ws0">goto<span class="_ _e"> </span>loop;</div><div class="t m5 x1bc h2d y2702 ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>result;</div><div class="t m5 x1e2 h2d y2703 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x1d h34 y2704 ff6 fs16 fc2 sc0 ls0 ws0">(c)<span class="_ _10"> </span>Corresponding<span class="_ _11"> </span>assembly-language<span class="_ _10"> </span>code</div><div class="t m5 x17e h61 y2705 ff13 fs35 fc6 sc0 ls0 ws0">long<span class="_ _f"> </span>fact_while(long<span class="_ _f"> </span>n)</div><div class="t m5 x17e h61 y2706 ff13 fs35 fc6 sc0 ls0 ws0">n<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi</div><div class="t m5 x1d h2d y2707 ffd fs1e fc2 sc0 ls0 ws0">fact_while:</div><div class="t m5 x75 h2d y2708 ffd fs1e fc2 sc0 ls0 ws0">movl<span class="_ _46"> </span>$1,<span class="_ _e"> </span>%eax</div><div class="t m5 xd9 h61 y2709 ff13 fs35 fc6 sc0 ls0 ws0">Set<span class="_ _f"> </span>result<span class="_ _f"> </span>=<span class="_ _f"> </span>1</div><div class="t m5 x75 h2d y270a ffd fs1e fc2 sc0 ls0 ws0">jmp<span class="_ _8c"> </span>.L5<span class="_ _12b"> </span><span class="ff13 fs35 fc6">Goto<span class="_ _f"> </span><span class="ff2d">test</span></span></div><div class="t m5 x1d h2d y270b ffd fs1e fc2 sc0 ls0 ws0">.L6:<span class="_ _151"> </span><span class="ff2d fs35 fc6">loop:</span></div><div class="t m5 x75 h2d y270c ffd fs1e fc2 sc0 ls0 ws0">imulq<span class="_ _3f"> </span>%rdi,<span class="_ _e"> </span>%rax<span class="_ _93"> </span><span class="ff13 fs35 fc6">Compute<span class="_ _e"> </span>result<span class="_ _21"> </span>*=<span class="_ _f"> </span>n</span></div><div class="t m5 x75 h2d y270d ffd fs1e fc2 sc0 ls0 ws0">subq<span class="_ _46"> </span>$1,<span class="_ _e"> </span>%rdi<span class="_ _88"> </span><span class="ff13 fs35 fc6">Decrement<span class="_ _21"> </span>n</span></div><div class="t m5 x1d h2d y270e ffd fs1e fc2 sc0 ls0 ws0">.L5:<span class="_ _151"> </span><span class="ff2d fs35 fc6">test:</span></div><div class="t m5 x75 h2d y270f ffd fs1e fc2 sc0 ls0 ws0">cmpq<span class="_ _46"> </span>$1,<span class="_ _e"> </span>%rdi<span class="_ _88"> </span><span class="ff13 fs35 fc6">Compare<span class="_ _21"> </span>n:1</span></div><div class="t m5 x75 h2d y2213 ffd fs1e fc2 sc0 ls0 ws0">jg<span class="_ _5a"> </span>.L6<span class="_ _12b"> </span><span class="ff13 fs35 fc6">If<span class="_ _f"> </span>&gt;,<span class="_ _e"> </span>goto<span class="_ _21"> </span><span class="ff2d">loop</span></span></div><div class="t m5 x75 h2d y2710 ffd fs1e fc2 sc0 ls0 ws0">rep;<span class="_ _e"> </span>ret<span class="_ _c1"> </span><span class="ff13 fs35 fc6">Return</span></div><div class="t m5 x1d h3a y2711 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _16"> </span>3.20<span class="_ _c"> </span><span class="fc1">C<span class="_ _14"> </span>and<span class="_ _14"> </span>assembly<span class="_ _14"> </span>code<span class="_ _16"> </span>for<span class="_ _14"> </span><span class="ffd fs19">while<span class="_ _14"> </span></span>version<span class="_ _14"> </span>of<span class="_ _16"> </span>factorial<span class="_ _14"> </span>using<span class="_ _14"> </span>jump-to-</span></div><div class="t m5 x1d h34 y2712 ffe fs16 fc1 sc0 ls0 ws0">middle<span class="_"> </span>translation.<span class="_ _11"> </span><span class="ff6">The<span class="_ _11"> </span>C<span class="_ _11"> </span>function</span></div><div class="t m5 x17c h3a y2713 ffd fs19 fc1 sc0 ls0 ws0">fact_while_jm_goto<span class="_ _11"> </span><span class="ff6 fs16">illustrates<span class="_ _11"> </span>the<span class="_ _11"> </span>operation<span class="_ _10"> </span>of</span></div><div class="t m5 x1d h34 y2714 ff6 fs16 fc1 sc0 ls0 ws0">the<span class="_ _10"> </span>assembly-code<span class="_ _11"> </span>version.</div><div class="t m5 x1d h26 y2715 ff7 fs19 fc1 sc0 ls0 ws0">function<span class="_ _11"> </span><span class="ffd">fact_while_jm_goto<span class="_ _16"> </span></span>(F<span class="_ _1"></span>igure<span class="_ _16"> </span>3.20(b))<span class="_ _11"> </span>is<span class="_ _16"> </span>a<span class="_ _11"> </span>C<span class="_ _16"> </span>rendition<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>assembly</div><div class="t m5 x1d h26 y2716 ff7 fs19 fc1 sc0 ls0 ws0">code<span class="_"> </span>generated<span class="_ _13"> </span>by<span class="_"> </span><span class="ff9">gcc<span class="_ _10"> </span></span>when<span class="_ _13"> </span>optimization<span class="_"> </span>is<span class="_"> </span>speciﬁed<span class="_"> </span>with<span class="_ _13"> </span>the<span class="_"> </span>command-line<span class="_"> </span>op-</div><div class="t m5 x1d h26 y2717 ff7 fs19 fc1 sc0 ls0 ws0">tion<span class="_"> </span><span class="ffd">-Og</span>.<span class="_ _13"> </span>Comparing<span class="_"> </span>the<span class="_"> </span>goto<span class="_ _13"> </span>code<span class="_"> </span>generated<span class="_"> </span>for<span class="_ _13"> </span><span class="ffd">fact_while<span class="_ _10"> </span></span>(F<span class="_ _1"></span>igure<span class="_"> </span>3.20(b))<span class="_"> </span>to</div><div class="t m5 x1d h26 y2718 ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_ _16"> </span>for<span class="_ _11"> </span><span class="ffd">fact_do<span class="_ _16"> </span></span>(F<span class="_ _0"></span>igure<span class="_ _16"> </span>3.19(b)),<span class="_ _16"> </span>we<span class="_ _11"> </span>see<span class="_ _16"> </span>that<span class="_ _16"> </span>they<span class="_ _11"> </span>are<span class="_ _16"> </span>very<span class="_ _16"> </span>similar,<span class="_ _16"> </span>except<span class="_ _11"> </span>that</div><div class="t m5 x1d h26 y2719 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>statement<span class="_"> </span><span class="ffd">goto<span class="_ _16"> </span>test<span class="_ _10"> </span></span>before<span class="_"> </span>the<span class="_"> </span>loop<span class="_ _11"> </span>causes<span class="_"> </span>the<span class="_"> </span>program<span class="_"> </span>to<span class="_"> </span>ﬁrst<span class="_ _11"> </span>perform<span class="_"> </span>the</div><div class="t m5 x1d h26 y271a ff7 fs19 fc1 sc0 ls0 ws0">test<span class="_ _11"> </span>of<span class="_ _16"> </span><span class="ffd">n<span class="_ _11"> </span></span>before<span class="_ _11"> </span>modifying<span class="_ _16"> </span>the<span class="_ _11"> </span>values<span class="_ _16"> </span>of<span class="_ _11"> </span><span class="ffd">result<span class="_ _16"> </span></span>or<span class="_ _11"> </span><span class="ffd">n</span>.<span class="_ _11"> </span>The<span class="_"> </span>bottom<span class="_ _16"> </span>portion<span class="_ _11"> </span>of<span class="_ _16"> </span>the</div><div class="t m5 x1d h26 y271b ff7 fs19 fc1 sc0 ls0 ws0">ﬁgure<span class="_"> </span>(F<span class="_ _1"></span>igure<span class="_"> </span>3.20(c))<span class="_"> </span>shows<span class="_"> </span>the<span class="_"> </span>actual<span class="_"> </span>assembly<span class="_"> </span>code<span class="_"> </span>generated.</div><div class="t m5 x1d h47 y271c ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>3.24<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>371)</span></div><div class="t m5 x1d h26 y271d ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_"> </span>C<span class="_"> </span>code<span class="_"> </span>having<span class="_"> </span>the<span class="_"> </span>general<span class="_"> </span>form</div><div class="t m5 x1d h2d y271e ffd fs1e fc2 sc0 ls0 ws0">short<span class="_ _e"> </span>loop_while(short<span class="_ _1f"> </span>a,<span class="_ _1f"> </span>short<span class="_ _e"> </span>b)</div><div class="t m5 x1d h2d y271f ffd fs1e fc2 sc0 ls0 ws0">{</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
