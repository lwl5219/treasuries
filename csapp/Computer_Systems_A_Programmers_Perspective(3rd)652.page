<div id="pf28c" class="pf w2 h11" data-page-no="28c"><div class="pc pc28c w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg28c.png"/><div class="t m5 xf2 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>6.4<span class="_ _60"> </span>Cache<span class="_ _10"> </span>Memories<span class="_ _3e"> </span><span class="ffe fs1e">651</span></div><div class="t m5 x17 h2f ye7 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>6.24</div><div class="t m5 x17 h2f y58a ffe fs16 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>ypical<span class="_ _16"> </span>bus<span class="_"> </span>structure<span class="_ _11"> </span>for</div><div class="t m5 x17 h2f y58b ffe fs16 fc1 sc0 ls0 ws0">cache<span class="_"> </span>memories.</div><div class="t m5 x18c h3f y569f ff81 fs27 fc1 sc0 ls0 ws0">I/O</div><div class="t m5 x108 h3f y56a0 ff81 fs27 fc1 sc0 ls0 ws0">bridge</div><div class="t m5 xb3 h3f y56a1 ff81 fs27 fc1 sc0 ls0 ws0">CPU chip</div><div class="t m5 xdc h3f y56a2 ff81 fs27 fc1 sc0 ls0 ws0">Cache</div><div class="t m5 xab h3f y56a3 ff81 fs27 fc1 sc0 ls0 ws0">memories</div><div class="t m5 x176 h3f y56a4 ff81 fs27 fc1 sc0 ls0 ws0">Register file</div><div class="t m5 x6c h3f y56a5 ff81 fs27 fc1 sc0 ls0 ws0">System bus</div><div class="t m5 x19e h3f y56a6 ff81 fs27 fc1 sc0 ls0 ws0">Memory bus</div><div class="t m5 xe2 h3f y56a7 ff81 fs27 fc1 sc0 ls0 ws0">Bus interface</div><div class="t m5 x165 h3f y56a8 ff81 fs27 fc1 sc0 ls0 ws0">Main</div><div class="t m5 x223 h3f y56a9 ff81 fs27 fc1 sc0 ls0 ws0">memory</div><div class="t m5 x19b h3f y56aa ff81 fs27 fc1 sc0 ls0 ws0">ALU</div><div class="t m5 x17 h26 y56ab ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_ _14"> </span>small<span class="_ _15"> </span>SRAM<span class="_ _14"> </span><span class="ffa">cache<span class="_ _14"> </span>memory</span>,<span class="_ _15"> </span>called<span class="_ _15"> </span>an<span class="_ _14"> </span><span class="ffa">L1<span class="_ _14"> </span>cache<span class="_ _15"> </span></span>(level<span class="_ _14"> </span>1<span class="_ _15"> </span>cache)<span class="_ _14"> </span>between<span class="_ _14"> </span>the</div><div class="t m5 x17 h26 y56ac ff7 fs19 fc1 sc0 ls0 ws0">CPU<span class="_ _13"> </span>register<span class="_"> </span>ﬁle<span class="_ _13"> </span>and<span class="_"> </span>main<span class="_ _13"> </span>memory<span class="_ _3"></span>,<span class="_"> </span>as<span class="_ _13"> </span>shown<span class="_ _13"> </span>in<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>6.24.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_"> </span>L1<span class="_ _13"> </span>cache<span class="_"> </span>can<span class="_ _13"> </span>be</div><div class="t m5 x17 h26 y56ad ff7 fs19 fc1 sc0 ls0 ws0">accessed<span class="_"> </span>nearly<span class="_"> </span>as<span class="_"> </span>fast<span class="_"> </span>as<span class="_"> </span>the<span class="_"> </span>registers<span class="_ _1"></span>,<span class="_"> </span>typically<span class="_"> </span>in<span class="_"> </span>about<span class="_"> </span>4<span class="_"> </span>clock<span class="_"> </span>cycles<span class="_ _3"></span>.</div><div class="t m5 x26 h26 y56ae ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_ _f"> </span>the<span class="_ _f"> </span>performance<span class="_ _f"> </span>gap<span class="_ _e"> </span>between<span class="_ _21"> </span>the<span class="_ _f"> </span>CPU<span class="_ _f"> </span>and<span class="_ _e"> </span>main<span class="_ _21"> </span>memory<span class="_ _f"> </span>continued</div><div class="t m5 x17 h26 y56af ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _16"> </span>increase<span class="_ _1"></span>,<span class="_ _16"> </span>system<span class="_ _16"> </span>designers<span class="_ _16"> </span>responded<span class="_ _16"> </span>by<span class="_ _16"> </span>inserting<span class="_ _11"> </span>an<span class="_ _16"> </span>additional<span class="_ _16"> </span>larger<span class="_ _16"> </span>cache<span class="_ _1"></span>,</div><div class="t m5 x17 h26 y56b0 ff7 fs19 fc1 sc0 ls0 ws0">called<span class="_ _13"> </span>an<span class="_"> </span><span class="ffa">L2<span class="_ _13"> </span>cache</span>,<span class="_"> </span>between<span class="_ _13"> </span>the<span class="_"> </span>L1<span class="_ _13"> </span>cache<span class="_"> </span>and<span class="_ _13"> </span>main<span class="_ _13"> </span>memory<span class="_ _3"></span>,<span class="_"> </span>that<span class="_ _13"> </span>can<span class="_"> </span>be<span class="_ _13"> </span>accessed</div><div class="t m5 x17 h26 y56b1 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_ _6"> </span>about<span class="_ _13"> </span>10<span class="_ _6"> </span>clock<span class="_ _6"> </span>cycles<span class="_ _1"></span>.<span class="_ _6"> </span>Many<span class="_ _13"> </span>modern<span class="_ _6"> </span>systems<span class="_ _6"> </span>include<span class="_ _13"> </span>an<span class="_ _6"> </span>even<span class="_ _6"> </span>larger<span class="_ _13"> </span>cache<span class="_ _1"></span>,<span class="_ _13"> </span>called</div><div class="t m5 x17 h26 y56b2 ff7 fs19 fc1 sc0 ls0 ws0">an<span class="_ _11"> </span><span class="ffa">L3<span class="_ _16"> </span>cac<span class="_ _0"></span>he<span class="ff7">,<span class="_ _16"> </span>which<span class="_ _11"> </span>sits<span class="_ _11"> </span>between<span class="_ _16"> </span>the<span class="_ _11"> </span>L2<span class="_ _11"> </span>cache<span class="_ _16"> </span>and<span class="_ _11"> </span>main<span class="_ _11"> </span>memory<span class="_ _16"> </span>in<span class="_ _11"> </span>the<span class="_ _11"> </span>memory</span></span></div><div class="t m5 x17 h26 y56b3 ff7 fs19 fc1 sc0 ls0 ws0">hierarchy<span class="_ _15"> </span>and<span class="_ _21"> </span>can<span class="_ _15"> </span>be<span class="_ _21"> </span>accessed<span class="_ _21"> </span>in<span class="_ _15"> </span>about<span class="_ _21"> </span>50<span class="_ _21"> </span>cycles<span class="_ _3"></span>.<span class="_ _21"> </span>While<span class="_ _15"> </span>there<span class="_ _21"> </span>is<span class="_ _15"> </span>considerable</div><div class="t m5 x17 h26 y56b4 ff7 fs19 fc1 sc0 ls0 ws0">variety<span class="_ _6"> </span>in<span class="_ _13"> </span>the<span class="_ _a"> </span>arrangements<span class="_ _1"></span>,<span class="_ _13"> </span>the<span class="_ _6"> </span>general<span class="_ _13"> </span>principles<span class="_ _6"> </span>are<span class="_ _6"> </span>the<span class="_ _13"> </span>same<span class="_ _1"></span>.<span class="_ _6"> </span>F<span class="_ _1"></span>or<span class="_ _13"> </span>our<span class="_ _a"> </span>discussion</div><div class="t m5 x17 h26 y56b5 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_ _16"> </span>the<span class="_ _11"> </span>next<span class="_ _16"> </span>section,<span class="_ _16"> </span>we<span class="_ _16"> </span>will<span class="_ _16"> </span>assume<span class="_ _16"> </span>a<span class="_ _16"> </span>simple<span class="_ _16"> </span>memory<span class="_ _11"> </span>hierarchy<span class="_ _16"> </span>with<span class="_ _16"> </span>a<span class="_ _16"> </span>single<span class="_ _16"> </span>L1</div><div class="t m5 x17 h26 y56b6 ff7 fs19 fc1 sc0 ls0 ws0">cache<span class="_"> </span>between<span class="_"> </span>the<span class="_"> </span>CPU<span class="_"> </span>and<span class="_"> </span>main<span class="_"> </span>memory<span class="_ _3"></span>.</div><div class="t m5 x17 h41 y3229 ffe fs29 fc1 sc0 ls0 ws0">6.4.1<span class="_ _48"> </span><span class="fs19">Generic<span class="_"> </span>Cache<span class="_"> </span>Memory<span class="_"> </span>Organization</span></div><div class="t m5 x17 h26 y2154 ff7 fs19 fc1 sc0 ls0 ws0">Consider<span class="_ _16"> </span>a<span class="_ _14"> </span>computer<span class="_ _14"> </span>system<span class="_ _14"> </span>where<span class="_ _14"> </span>each<span class="_ _16"> </span>memory<span class="_ _14"> </span>address<span class="_ _14"> </span>has<span class="_ _14"> </span><span class="ff11">m<span class="_"> </span></span>bits<span class="_ _14"> </span>that<span class="_ _14"> </span>form</div><div class="t m5 x17 h46 y40a2 ff11 fs19 fc1 sc0 ls0 ws0">M<span class="_"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ff7">2</span></span></div><div class="t m5 x1b5 h50 y56b7 ff11 fs25 fc1 sc0 ls0 ws0">m</div><div class="t m5 x1a9 h26 y2155 ff7 fs19 fc1 sc0 ls0 ws0">unique<span class="_ _21"> </span>addresses<span class="_ _1"></span>.<span class="_ _21"> </span>As<span class="_ _21"> </span>illustrated<span class="_ _21"> </span>in<span class="_ _21"> </span>Figure<span class="_ _15"> </span>6.25(a),<span class="_ _e"> </span>a<span class="_ _15"> </span>cache<span class="_ _21"> </span>for<span class="_ _21"> </span>such<span class="_ _21"> </span>a</div><div class="t m5 x17 h46 y4814 ff7 fs19 fc1 sc0 ls0 ws0">machine<span class="_"> </span>is<span class="_ _13"> </span>organized<span class="_"> </span>as<span class="_ _13"> </span>an<span class="_"> </span>array<span class="_"> </span>of<span class="_ _13"> </span><span class="ff11">S<span class="_ _11"> </span><span class="ff12">=<span class="_ _10"> </span></span></span>2</div><div class="t m5 x136 h50 y56b8 ff11 fs25 fc1 sc0 ls0 ws0">s</div><div class="t m5 xe4 h26 y19b8 ffa fs19 fc1 sc0 ls0 ws0">cache<span class="_ _13"> </span>sets<span class="ff7">.<span class="_"> </span>Each<span class="_"> </span>set<span class="_ _13"> </span>consists<span class="_"> </span>of<span class="_ _13"> </span><span class="ff11">E<span class="_ _16"> </span></span></span>cache</div><div class="t m5 x17 h46 y56b9 ffa fs19 fc1 sc0 ls0 ws0">lines<span class="ff7">.<span class="_ _11"> </span>Each<span class="_ _11"> </span>line<span class="_ _11"> </span>consists<span class="_ _11"> </span>of<span class="_ _11"> </span>a<span class="_ _11"> </span>data<span class="_ _11"> </span></span>block<span class="_ _11"> </span><span class="ff7">of<span class="_ _11"> </span><span class="ff11">B<span class="_"> </span><span class="ff12">=<span class="_ _13"></span></span></span>2</span></div><div class="t m5 x20c h50 y56ba ff11 fs25 fc1 sc0 ls0 ws0">b</div><div class="t m5 x139 h26 y2156 ff7 fs19 fc1 sc0 ls0 ws0">bytes<span class="_ _1"></span>,<span class="_ _11"> </span>a<span class="_ _11"> </span><span class="ffa">valid<span class="_ _11"> </span>bit<span class="_ _16"> </span></span>that<span class="_ _11"> </span>indicates</div><div class="t m5 x17 h46 y248b ff7 fs19 fc1 sc0 ls0 ws0">whether<span class="_"> </span>or<span class="_"> </span>not<span class="_"> </span>the<span class="_"> </span>line<span class="_"> </span>contains<span class="_"> </span>meaningful<span class="_"> </span>information,<span class="_"> </span>and<span class="_"> </span><span class="ff11">t<span class="_"> </span><span class="ff12">=<span class="_ _13"></span></span>m<span class="_ _10"> </span><span class="ff12">−<span class="_ _13"></span></span>(b<span class="_ _10"> </span><span class="ff12">+<span class="_ _13"> </span></span><span class="ls57">s)<span class="_ _13"> </span></span><span class="ffa">tag</span></span></div><div class="t m5 x17 h26 y248c ffa fs19 fc1 sc0 ls0 ws0">bits<span class="_"> </span><span class="ff7">(a<span class="_"> </span>subset<span class="_ _11"> </span>of<span class="_"> </span>the<span class="_"> </span>bits<span class="_ _11"> </span>from<span class="_"> </span>the<span class="_"> </span>current<span class="_ _11"> </span>block’s<span class="_"> </span>memory<span class="_"> </span>address)<span class="_"> </span>that<span class="_"> </span>uniquely</span></div><div class="t m5 x17 h26 y248d ff7 fs19 fc1 sc0 ls0 ws0">identify<span class="_"> </span>the<span class="_"> </span>block<span class="_"> </span>stored<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>cache<span class="_"> </span>line<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y248e ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _14"> </span>general,<span class="_ _15"> </span>a<span class="_ _14"> </span>cache’s<span class="_ _16"> </span>organization<span class="_ _14"> </span>can<span class="_ _14"> </span>be<span class="_ _15"> </span>characterized<span class="_ _14"> </span>by<span class="_ _14"> </span>the<span class="_ _14"> </span>tuple<span class="_ _14"> </span><span class="ff11">(S<span class="_ _5"></span>,<span class="_ _10"> </span>E<span class="_ _2"></span>,</span></div><div class="t m5 x17 h26 y248f ff11 fs19 fc1 sc0 ls239 ws0">B,<span class="_ _6"> </span>m<span class="_ _1"></span>)<span class="_ _1"></span><span class="ff7 ls0">.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>size<span class="_"> </span>(or<span class="_"> </span>capacity)<span class="_"> </span>of<span class="_ _13"> </span>a<span class="_"> </span>cache<span class="_ _0"></span>,<span class="_"> </span><span class="ff11">C<span class="_ _2"></span></span>,<span class="_"> </span>is<span class="_"> </span>stated<span class="_"> </span>in<span class="_ _13"> </span>terms<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>aggregate<span class="_ _13"> </span>size</span></div><div class="t m5 x17 h46 y2490 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_ _13"> </span>all<span class="_"> </span>the<span class="_ _13"> </span>blocks<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>tag<span class="_ _13"> </span>bits<span class="_"> </span>and<span class="_ _13"> </span>valid<span class="_"> </span>bit<span class="_ _13"> </span>are<span class="_"> </span>not<span class="_ _13"> </span>included.<span class="_"> </span>T<span class="_ _1"></span>hus<span class="_ _1"></span>,<span class="_"> </span><span class="ff11">C<span class="_ _10"> </span><span class="ff12">=<span class="_ _10"> </span></span>S<span class="_ _10"> </span><span class="ff12">×<span class="_ _10"> </span></span>E<span class="_ _10"> </span><span class="ff12">×<span class="_ _13"> </span></span>B<span class="_ _be"></span></span>.</div><div class="t m5 x26 h26 y2491 ff7 fs19 fc1 sc0 ls0 ws0">When<span class="_ _13"> </span>the<span class="_ _13"> </span>CPU<span class="_ _13"> </span>is<span class="_ _13"> </span>instructed<span class="_ _13"> </span>by<span class="_ _13"> </span>a<span class="_ _6"> </span>load<span class="_ _13"> </span>instruction<span class="_ _13"> </span>to<span class="_ _13"> </span>read<span class="_ _13"> </span>a<span class="_ _13"> </span>word<span class="_ _13"> </span>from<span class="_ _13"> </span>address</div><div class="t m5 x17 h26 y2492 ff11 fs19 fc1 sc0 ls0 ws0">A<span class="_ _10"> </span><span class="ff7">of<span class="_"> </span>main<span class="_"> </span>memory<span class="_ _3"></span>,<span class="_"> </span>it<span class="_"> </span>sends<span class="_"> </span>address<span class="_"> </span><span class="ff11">A<span class="_ _10"> </span></span>to<span class="_"> </span>the<span class="_"> </span>cache<span class="_ _1"></span>.<span class="_"> </span>If<span class="_"> </span>the<span class="_"> </span>cache<span class="_"> </span>is<span class="_"> </span>holding<span class="_"> </span>a<span class="_"> </span>copy</span></div><div class="t m5 x17 h26 y2493 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span>the<span class="_ _13"> </span>word<span class="_"> </span>at<span class="_ _13"> </span>address<span class="_ _13"> </span><span class="ff11">A</span>,<span class="_"> </span>it<span class="_"> </span>sends<span class="_ _13"> </span>the<span class="_"> </span>word<span class="_ _13"> </span>immediately<span class="_"> </span>back<span class="_ _13"> </span>to<span class="_"> </span>the<span class="_ _13"> </span>CPU<span class="_ _3"></span>.<span class="_ _13"> </span>So<span class="_"> </span>how</div><div class="t m5 x17 h26 y2494 ff7 fs19 fc1 sc0 ls0 ws0">does<span class="_ _16"> </span>the<span class="_ _16"> </span>cache<span class="_ _16"> </span>know<span class="_ _16"> </span>whether<span class="_ _16"> </span>it<span class="_ _16"> </span>contains<span class="_ _16"> </span>a<span class="_ _16"> </span>copy<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>word<span class="_ _16"> </span>at<span class="_ _16"> </span>address<span class="_ _16"> </span><span class="ff11">A</span><span class="ls23a">?T<span class="_ _9"></span>h<span class="_ _49"></span>e</span></div><div class="t m5 x17 h26 y2495 ff7 fs19 fc1 sc0 ls0 ws0">cache<span class="_"> </span>is<span class="_"> </span>organized<span class="_"> </span>so<span class="_ _13"> </span>that<span class="_"> </span>it<span class="_"> </span>can<span class="_"> </span>ﬁnd<span class="_"> </span>the<span class="_"> </span>requested<span class="_"> </span>word<span class="_ _13"> </span>by<span class="_"> </span>simply<span class="_"> </span>inspecting<span class="_"> </span>the</div><div class="t m5 x17 h26 y2496 ff7 fs19 fc1 sc0 ls0 ws0">bits<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>address<span class="_ _1"></span>,<span class="_ _13"> </span>similar<span class="_"> </span>to<span class="_ _13"> </span>a<span class="_ _13"> </span>hash<span class="_"> </span>table<span class="_ _13"> </span>with<span class="_ _13"> </span>an<span class="_"> </span>extremely<span class="_ _13"> </span>simple<span class="_ _13"> </span>hash<span class="_ _13"> </span>function.</div><div class="t m5 x17 h26 y2497 ff7 fs19 fc1 sc0 ls0 ws0">Here<span class="_"> </span>is<span class="_"> </span>how<span class="_"> </span>it<span class="_"> </span>works:</div><div class="t m5 x26 h26 y44a4 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _11"> </span>parameters<span class="_ _16"> </span><span class="ff11">S<span class="_"> </span></span>and<span class="_ _11"> </span><span class="ff11">B<span class="_ _14"> </span></span>induce<span class="_ _11"> </span>a<span class="_ _16"> </span>partitioning<span class="_"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span><span class="ff11">m<span class="_ _11"> </span></span>address<span class="_ _11"> </span>bits<span class="_ _11"> </span>into<span class="_ _16"> </span>the</div><div class="t m5 x17 h26 y56bb ff7 fs19 fc1 sc0 ls0 ws0">three<span class="_ _11"> </span>ﬁelds<span class="_ _11"> </span>shown<span class="_ _16"> </span>in<span class="_ _11"> </span>F<span class="_ _1"></span>igure<span class="_ _16"> </span>6.25(b).<span class="_ _11"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span><span class="ff11">s<span class="_"> </span><span class="ffa">set<span class="_ _11"> </span>index<span class="_ _11"> </span>bits<span class="_ _16"> </span></span></span>in<span class="_ _11"> </span><span class="ff11">A<span class="_ _11"> </span></span>form<span class="_ _11"> </span>an<span class="_ _16"> </span>index<span class="_ _11"> </span>into</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
