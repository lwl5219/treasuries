<div id="pf1c8" class="pf w2 h11" data-page-no="1c8"><div class="pc pc1c8 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1c8.png"/><div class="t m5 x1d9 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>4.4<span class="_ _60"> </span>General<span class="_ _10"> </span>Principles<span class="_ _10"> </span>of<span class="_ _10"> </span>Pipelining<span class="_ _3e"> </span><span class="ffe fs1e">455</span></div><div class="t m5 x34 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">A.<span class="_ _1f"> </span>What<span class="_ _11"> </span>would<span class="_ _11"> </span>be<span class="_ _16"> </span>the<span class="_ _11"> </span>latency<span class="_ _11"> </span>and<span class="_ _16"> </span>the<span class="_ _11"> </span>throughput<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>system,<span class="_ _16"> </span>as<span class="_ _11"> </span>functions</div><div class="t m5 x2d h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_"> </span><span class="ff11">k<span class="_ _2"></span></span>?</div><div class="t m5 x34 h26 y1acd ff7 fs19 fc2 sc0 ls0 ws0">B<span class="_ _3"></span>.<span class="_ _1d"> </span>What<span class="_"> </span>would<span class="_"> </span>be<span class="_"> </span>the<span class="_"> </span>ultimate<span class="_"> </span>limit<span class="_"> </span>on<span class="_"> </span>the<span class="_"> </span>throughput?</div><div class="t m5 x17 h41 y3f0d ffe fs29 fc1 sc0 ls0 ws0">4.4.4<span class="_ _48"> </span><span class="fs19">Pipelining<span class="_"> </span>a<span class="_"> </span>System<span class="_"> </span>with<span class="_"> </span>Feedback</span></div><div class="t m5 x17 h26 y3f0e ff7 fs19 fc1 sc0 ls0 ws0">Up<span class="_ _16"> </span>to<span class="_ _16"> </span>this<span class="_ _16"> </span>point,<span class="_ _14"> </span>we<span class="_ _16"> </span>have<span class="_ _14"> </span>considered<span class="_ _16"> </span>only<span class="_ _16"> </span>systems<span class="_ _16"> </span>in<span class="_ _14"> </span>which<span class="_ _16"> </span>the<span class="_ _16"> </span>objects<span class="_ _16"> </span>passing</div><div class="t m5 x17 h26 y3f0f ff7 fs19 fc1 sc0 ls0 ws0">through<span class="_ _16"> </span>the<span class="_ _11"> </span>pipeline—whether<span class="_ _16"> </span>cars<span class="_ _1"></span>,<span class="_ _14"> </span>people<span class="_ _1"></span>,<span class="_ _14"> </span>or<span class="_ _16"> </span>instructions—are<span class="_ _11"> </span>completely<span class="_ _16"> </span>in-</div><div class="t m5 x17 h26 y3f10 ff7 fs19 fc1 sc0 ls0 ws0">dependent<span class="_"> </span>of<span class="_"> </span>one<span class="_"> </span>another.<span class="_"> </span>F<span class="_ _1"></span>or<span class="_"> </span>a<span class="_"> </span>system<span class="_"> </span>that<span class="_"> </span>executes<span class="_ _11"> </span>machine<span class="_"> </span>programs<span class="_"> </span>such<span class="_"> </span>as</div><div class="t m5 x17 h26 y3f11 ff7 fs19 fc1 sc0 ls0 ws0">x86-64<span class="_"> </span>or<span class="_"> </span>Y86-64,<span class="_"> </span>however<span class="_ _1"></span>,<span class="_"> </span>there<span class="_"> </span>are<span class="_"> </span>potential<span class="_"> </span>dependencies<span class="_"> </span>between<span class="_"> </span>successive</div><div class="t m5 x17 h26 y3f12 ff7 fs19 fc1 sc0 ls0 ws0">instructions<span class="_ _1"></span>.<span class="_"> </span>F<span class="_ _1"></span>or<span class="_"> </span>example<span class="_ _0"></span>,<span class="_"> </span>consider<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>Y86-64<span class="_"> </span>instruction<span class="_"> </span>sequence:</div><div class="t m5 x17 h70 y3f13 ff46 fs27 fc6 sc0 ls0 ws0">1<span class="fc1">    irmovq $50, %rax</span></div><div class="t m5 x17 h70 y3f14 ff46 fs27 fc6 sc0 ls0 ws0">2<span class="fc1">    addq  %rax , %rbx</span></div><div class="t m5 x17 h70 y3f15 ff46 fs27 fc6 sc0 ls0 ws0">3<span class="fc1">    mrmovq 100( %rbx ), %rdx</span></div><div class="t m5 x26 h26 y3f16 ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _11"> </span>this<span class="_ _16"> </span>three-instruction<span class="_ _16"> </span>sequence<span class="_ _1"></span>,<span class="_ _16"> </span>there<span class="_ _16"> </span>is<span class="_ _11"> </span>a<span class="_ _16"> </span><span class="ffa">data<span class="_ _16"> </span>dependency<span class="_ _11"> </span></span>between<span class="_ _16"> </span>each</div><div class="t m5 x17 h26 y3f17 ff7 fs19 fc1 sc0 ls0 ws0">successive<span class="_"> </span>pair<span class="_ _11"> </span>of<span class="_ _11"> </span>instructions<span class="_ _1"></span>,<span class="_ _11"> </span>as<span class="_ _11"> </span>indicated<span class="_ _11"> </span>by<span class="_ _11"> </span>the<span class="_ _11"> </span>circled<span class="_"> </span>register<span class="_ _11"> </span>names<span class="_ _11"> </span>and<span class="_ _11"> </span>the</div><div class="t m5 x17 h26 y3f18 ff7 fs19 fc1 sc0 ls0 ws0">arrows<span class="_ _14"> </span>between<span class="_ _14"> </span>them.<span class="_ _14"> </span>T<span class="_ _1"></span>he<span class="_ _14"> </span><span class="ffd">irmovq<span class="_ _14"> </span></span>instruction<span class="_ _14"> </span>(line<span class="_ _14"> </span>1)<span class="_ _14"> </span>stores<span class="_ _14"> </span>its<span class="_ _14"> </span>result<span class="_ _14"> </span>in<span class="_ _14"> </span><span class="ffd">%rax</span>,</div><div class="t m5 x17 h26 y3f19 ff7 fs19 fc1 sc0 ls0 ws0">which<span class="_ _6"> </span>then<span class="_ _13"> </span>must<span class="_ _6"> </span>be<span class="_ _13"> </span>read<span class="_ _6"> </span>by<span class="_ _13"> </span>the<span class="_ _6"> </span><span class="ffd">addq<span class="_ _13"> </span></span>instruction<span class="_ _6"> </span>(line<span class="_ _6"> </span>2);<span class="_ _13"> </span>and<span class="_ _13"> </span>this<span class="_ _6"> </span>instruction<span class="_ _13"> </span>stores</div><div class="t m5 x17 h26 y3f1a ff7 fs19 fc1 sc0 ls0 ws0">its<span class="_"> </span>result<span class="_"> </span>in<span class="_"> </span><span class="ffd">%rbx</span>,<span class="_"> </span>which<span class="_"> </span>must<span class="_"> </span>then<span class="_"> </span>be<span class="_"> </span>read<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span><span class="ffd">mrmovq<span class="_ _10"> </span></span>instruction<span class="_"> </span>(line<span class="_"> </span>3).</div><div class="t m5 x26 h26 y3f1b ff7 fs19 fc1 sc0 ls0 ws0">Another<span class="_ _f"> </span>source<span class="_ _f"> </span>of<span class="_ _f"> </span>sequential<span class="_ _f"> </span>dependencies<span class="_ _e"> </span>occurs<span class="_ _21"> </span>due<span class="_ _f"> </span>to<span class="_ _f"> </span>the<span class="_ _e"> </span>instruction</div><div class="t m5 x17 h26 y3f1c ff7 fs19 fc1 sc0 ls0 ws0">control<span class="_"> </span>ﬂow<span class="_ _3"></span>.<span class="_"> </span>Consider<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>Y86-64<span class="_"> </span>instruction<span class="_"> </span>sequence:</div><div class="t m5 x2c h2e y3f1d ff6 fs20 fc6 sc0 ls0 ws0">1</div><div class="t m5 x2d h88 y3f1e ffd fs4e fc2 sc0 ls0 ws0">loop:</div><div class="t m5 x2c h88 y3f1f ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _e2"> </span><span class="ffd fs4e fc2">subq<span class="_ _e"> </span>%rdx,%rbx</span></div><div class="t m5 x2c h88 y3f20 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _e2"> </span><span class="ffd fs4e fc2">jne<span class="_ _e"> </span>targ</span></div><div class="t m5 x2c h88 y3f21 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _e2"> </span><span class="ffd fs4e fc2">irmovq<span class="_ _e"> </span>$10,%rdx</span></div><div class="t m5 x2c h88 y3f22 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _e2"> </span><span class="ffd fs4e fc2">jmp<span class="_ _e"> </span>loop</span></div><div class="t m5 x2c h88 y3f23 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _1c"> </span><span class="ffd fs4e fc2">targ:</span></div><div class="t m5 x2c h88 y3f24 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _e2"> </span><span class="ffd fs4e fc2">halt</span></div><div class="t m5 x17 h26 y5b5 ff7 fs19 fc2 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _15"> </span><span class="ffd ls0">jne<span class="_ _14"> </span><span class="ff7">instruction<span class="_ _14"> </span>(line<span class="_ _14"> </span>3)<span class="_ _14"> </span>creates<span class="_ _16"> </span>a<span class="_ _14"> </span><span class="ffa">control<span class="_ _14"> </span>dependency<span class="_ _14"> </span></span>since<span class="_ _14"> </span>the<span class="_ _14"> </span>outcome<span class="_ _14"> </span>of</span></span></div><div class="t m5 x17 h26 y5b6 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _13"> </span>conditional<span class="_ _13"> </span>test<span class="_ _13"> </span>determines<span class="_ _13"> </span>whether<span class="_ _13"> </span>the<span class="_ _13"> </span>next<span class="_ _13"> </span>instruction<span class="_ _13"> </span>to<span class="_ _13"> </span>execute<span class="_ _13"> </span>will<span class="_ _13"> </span>be<span class="_ _13"> </span>the</div><div class="t m5 x17 h26 y5b7 ffd fs19 fc2 sc0 ls0 ws0">irmovq<span class="_ _13"> </span><span class="ff7">instruction<span class="_"> </span>(line<span class="_ _13"> </span>4)<span class="_ _13"> </span>or<span class="_ _13"> </span>the<span class="_"> </span></span>halt<span class="_ _13"> </span><span class="ff7">instruction<span class="_ _13"> </span>(line<span class="_ _13"> </span>7).<span class="_"> </span>In<span class="_ _13"> </span>our<span class="_ _13"> </span>design<span class="_ _13"> </span>for<span class="_"> </span>SEQ,</span></div><div class="t m5 x17 h26 y5b8 ff7 fs19 fc2 sc0 ls0 ws0">these<span class="_ _13"> </span>dependencies<span class="_"> </span>were<span class="_ _13"> </span>handled<span class="_"> </span>by<span class="_ _13"> </span>the<span class="_"> </span>feedback<span class="_ _13"> </span>paths<span class="_"> </span>shown<span class="_ _13"> </span>on<span class="_"> </span>the<span class="_ _13"> </span>right-hand</div><div class="t m5 x17 h26 y5b9 ff7 fs19 fc2 sc0 ls0 ws0">side<span class="_"> </span>of<span class="_"> </span>F<span class="_ _0"></span>igure<span class="_"> </span>4.22.<span class="_"> </span>T<span class="_ _0"></span>his<span class="_"> </span>feedback<span class="_"> </span>brings<span class="_"> </span>the<span class="_"> </span>updated<span class="_ _11"> </span>register<span class="_"> </span>values<span class="_"> </span>down<span class="_"> </span>to<span class="_"> </span>the</div><div class="t m5 x17 h26 y5ba ff7 fs19 fc2 sc0 ls0 ws0">register<span class="_"> </span>ﬁle<span class="_"> </span>and<span class="_"> </span>the<span class="_"> </span>new<span class="_"> </span>PC<span class="_"> </span>value<span class="_"> </span>down<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>PC<span class="_"> </span>register.</div><div class="t m5 x26 h26 y5bb ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _16"> </span>4.38<span class="_ _11"> </span>illustrates<span class="_ _11"> </span>the<span class="_ _16"> </span>perils<span class="_ _11"> </span>of<span class="_ _11"> </span>introducing<span class="_ _16"> </span>pipelining<span class="_"> </span>into<span class="_ _16"> </span>a<span class="_ _11"> </span>system<span class="_ _11"> </span>con-</div><div class="t m5 x17 h26 y5bc ff7 fs19 fc2 sc0 ls0 ws0">taining<span class="_"> </span>feedback<span class="_"> </span>paths<span class="_ _1"></span>.<span class="_ _11"> </span>In<span class="_"> </span>the<span class="_ _11"> </span>original<span class="_"> </span>system<span class="_ _11"> </span>(F<span class="_ _1"></span>igure<span class="_ _11"> </span>4.38(a)),<span class="_"> </span>the<span class="_ _11"> </span>result<span class="_"> </span>of<span class="_ _11"> </span>each</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
