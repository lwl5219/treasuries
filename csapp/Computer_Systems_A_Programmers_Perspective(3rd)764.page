<div id="pf2fc" class="pf w2 h11" data-page-no="2fc"><div class="pc pc2fc w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg2fc.png"/><div class="t m5 x147 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>8.1<span class="_ _60"> </span>Exceptions<span class="_ _3e"> </span><span class="ffe fs1e">763</span></div><div class="t m5 x17 h2f ye7 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>8.5</div><div class="t m5 x17 h2f y58a ffe fs16 fc1 sc0 ls0 ws0">Interrupt<span class="_ _15"> </span>handling.</div><div class="t m5 x17 h34 y58b ff6 fs16 fc1 sc0 ls0 ws0">The<span class="_ _14"> </span>interrupt<span class="_ _14"> </span>handler</div><div class="t m5 x17 h34 y58c ff6 fs16 fc1 sc0 ls0 ws0">returns<span class="_ _14"> </span>control<span class="_ _14"> </span>to<span class="_ _14"> </span>the</div><div class="t m5 x17 h34 y58d ff6 fs16 fc1 sc0 ls0 ws0">next<span class="_ _16"> </span>instruction<span class="_ _14"> </span>in<span class="_ _14"> </span>the</div><div class="t m5 x17 h34 y58e ff6 fs16 fc1 sc0 ls0 ws0">application<span class="_ _14"> </span>program’<span class="_ _1"></span>s</div><div class="t m5 x17 h34 y58f ff6 fs16 fc1 sc0 ls0 ws0">control<span class="_ _10"> </span>ﬂow<span class="_ _1"></span>.</div><div class="t m5 xfb h3f y643e ff94 fs27 fc1 sc0 ls0 ws0">(2) Control passes</div><div class="t m5 x7e h3f y643f ff94 fs27 fc1 sc0 ls0 ws0">to handler after current</div><div class="t m5 x12d h3f y6440 ff94 fs27 fc1 sc0 ls0 ws0">instruction finishes</div><div class="t m5 x25f h3f y6441 ff94 fs27 fc1 sc0 ls0 ws0">(3) Interrupt</div><div class="t m5 x25f h3f y6442 ff94 fs27 fc1 sc0 ls0 ws0">handler run</div><div class="c xb3 y6443 w27 hf9"><div class="t m5 x167 h3f y6444 ff94 fs27 fc1 sc0 ls0 ws0">s</div></div><div class="t m5 xb0 h3f y6445 ff94 fs27 fc1 sc0 ls0 ws0">(4) Handler</div><div class="t m5 x19c h3f y6446 ff94 fs27 fc1 sc0 ls0 ws0">returns to</div><div class="t m5 x41 h3f y6447 ff94 fs27 fc1 sc0 ls0 ws0">next instruction</div><div class="t m5 x238 h3f y6448 ff94 fs27 fc1 sc0 ls0 ws0">(1) Interrupt pin</div><div class="t m5 xf0 h3f y6449 ff94 fs27 fc1 sc0 ls0 ws0">goes high during</div><div class="t m5 x1b2 h3f y644a ff94 fs27 fc1 sc0 ls0 ws0">ex<span class="_ _1"></span>ecution of</div><div class="t m5 xb3 h3f y644b ff94 fs27 fc1 sc0 ls0 ws0">current instruction</div><div class="t m5 xfc h3f y644c ff94 fs27 fc1 sc0 ls0 ws0">I</div><div class="t m5 x121 h65 y644d ff93 fs38 fc1 sc0 ls0 ws0">curr</div><div class="t m5 x119 h3f y644e ff94 fs27 fc1 sc0 ls0 ws0">I</div><div class="t m5 x1b3 h65 y644f ff93 fs38 fc1 sc0 ls0 ws0">next</div><div class="t m5 x17 h2f y6450 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>8.6</div><div class="t m5 x17 h34 y6451 ffe fs16 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>rap<span class="_ _16"> </span>handling.<span class="_ _11"> </span><span class="ff6">The<span class="_ _16"> </span>trap</span></div><div class="t m5 x17 h34 y6452 ff6 fs16 fc1 sc0 ls0 ws0">handler<span class="_ _16"> </span>returns<span class="_ _14"> </span>control</div><div class="t m5 x17 h34 y6453 ff6 fs16 fc1 sc0 ls0 ws0">to<span class="_ _11"> </span>the<span class="_ _16"> </span>next<span class="_ _11"> </span>instruction<span class="_ _16"> </span>in</div><div class="t m5 x17 h34 y6454 ff6 fs16 fc1 sc0 ls0 ws0">the<span class="_ _11"> </span>application<span class="_ _11"> </span>program’<span class="_ _1"></span>s</div><div class="t m5 x17 h34 y6455 ff6 fs16 fc1 sc0 ls0 ws0">control<span class="_ _10"> </span>ﬂow<span class="_ _1"></span>.</div><div class="t m5 x1bb h3f y6456 ff94 fs27 fc1 sc0 ls0 ws0">(2) Control passes</div><div class="t m5 x1df h3f y6457 ff94 fs27 fc1 sc0 ls0 ws0">to handler</div><div class="t m5 x193 h3f y6458 ff94 fs27 fc1 sc0 ls0 wsf">(3) T<span class="_ _7"></span>rap</div><div class="t m5 x193 h3f y6459 ff94 fs27 fc1 sc0 ls0 ws0">handler run</div><div class="c xb3 y645a w28 hfa"><div class="t m5 x116 h3f y645b ff94 fs27 fc1 sc0 ls0 ws0">s</div></div><div class="t m5 x1fc h3f y645c ff94 fs27 fc1 sc0 ls0 ws0">(4) Handler returns</div><div class="t m5 x1a3 h3f y645d ff94 fs27 fc1 sc0 ls0 ws0">to instruction</div><div class="t m5 x1c2 h40 y645e ff94 fs27 fc1 sc0 ls0 ws0">follo<span class="_ _1"></span>wing the <span class="ff8d fs28">syscall</span></div><div class="t m5 xb3 h3f y645f ff94 fs27 fc1 sc0 ls0 ws0">(1) Application</div><div class="t m5 x1b2 h3f y6460 ff94 fs27 fc1 sc0 ls0 ws0">makes a</div><div class="t m5 x47 h3f y6461 ff94 fs27 fc1 sc0 ls0 ws0">system call</div><div class="t m5 x15 h40 y6462 ff8d fs28 fc1 sc0 ls0 ws0">syscall</div><div class="t m5 x184 h3f y6463 ff94 fs27 fc1 sc0 ls0 ws0">I</div><div class="t m5 x122 h65 y6464 ff93 fs38 fc1 sc0 ls0 ws0">next</div><div class="t m5 x26 h26 y6465 ff7 fs19 fc1 sc0 ls0 ws0">After<span class="_ _13"> </span>the<span class="_ _13"> </span>current<span class="_ _13"> </span>instruction<span class="_ _13"> </span>ﬁnishes<span class="_ _13"> </span>executing,<span class="_ _13"> </span>the<span class="_ _13"> </span>processor<span class="_ _13"> </span>notices<span class="_ _13"> </span>that<span class="_ _13"> </span>the</div><div class="t m5 x17 h26 y6466 ff7 fs19 fc1 sc0 ls0 ws0">interrupt<span class="_ _13"> </span>pin<span class="_ _13"> </span>has<span class="_"> </span>gone<span class="_ _13"> </span>high,<span class="_ _13"> </span>reads<span class="_ _13"> </span>the<span class="_ _13"> </span>exception<span class="_"> </span>number<span class="_ _13"> </span>from<span class="_ _13"> </span>the<span class="_ _13"> </span>system<span class="_ _13"> </span>bus<span class="_ _1"></span>,<span class="_"> </span>and</div><div class="t m5 x17 h26 y6467 ff7 fs19 fc1 sc0 ls0 ws0">then<span class="_"> </span>calls<span class="_"> </span>the<span class="_"> </span>appropriate<span class="_ _13"> </span>interrupt<span class="_"> </span>handler.<span class="_"> </span>W<span class="_ _1"></span>hen<span class="_"> </span>the<span class="_"> </span>handler<span class="_"> </span>returns<span class="_ _1"></span>,<span class="_"> </span>it<span class="_"> </span>returns</div><div class="t m5 x17 h26 y6468 ff7 fs19 fc1 sc0 ls0 ws0">control<span class="_"> </span>to<span class="_ _11"> </span>the<span class="_ _11"> </span>next<span class="_ _11"> </span>instruction<span class="_ _11"> </span>(i.e.,<span class="_"> </span>the<span class="_ _11"> </span>instruction<span class="_ _11"> </span>that<span class="_ _11"> </span>would<span class="_ _11"> </span>have<span class="_ _11"> </span>followed<span class="_ _11"> </span>the</div><div class="t m5 x17 h26 y6469 ff7 fs19 fc1 sc0 ls0 ws0">current<span class="_ _6"> </span>instruction<span class="_ _13"> </span>in<span class="_ _6"> </span>the<span class="_ _6"> </span>control<span class="_ _13"> </span>ﬂow<span class="_ _6"> </span>had<span class="_ _13"> </span>the<span class="_ _6"> </span>interrupt<span class="_ _6"> </span>not<span class="_ _13"> </span>occurred).<span class="_ _6"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span>effect<span class="_ _6"> </span>is</div><div class="t m5 x17 h26 y646a ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_ _6"> </span>the<span class="_ _13"> </span>program<span class="_ _a"> </span>continues<span class="_ _13"> </span>executing<span class="_ _6"> </span>as<span class="_ _6"> </span>though<span class="_ _13"> </span>the<span class="_ _a"> </span>interrupt<span class="_ _13"> </span>had<span class="_ _6"> </span>never<span class="_ _6"> </span>happened.</div><div class="t m5 x26 h26 y646b ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _f"> </span>remaining<span class="_ _f"> </span>classes<span class="_ _f"> </span>of<span class="_ _f"> </span>exceptions<span class="_ _f"> </span>(traps<span class="_ _1"></span>,<span class="_ _e"> </span>faults<span class="_ _1"></span>,<span class="_ _e"> </span>and<span class="_ _21"> </span>aborts)<span class="_ _f"> </span>occur<span class="_ _f"> </span><span class="ffa">syn-</span></div><div class="t m5 x17 h26 y646c ffa fs19 fc1 sc0 ls0 ws0">chronously<span class="_ _16"> </span><span class="ff7">as<span class="_ _14"> </span>a<span class="_ _14"> </span>result<span class="_ _14"> </span>of<span class="_ _14"> </span>executing<span class="_ _15"> </span>the<span class="_ _14"> </span>current<span class="_ _14"> </span>instruction.<span class="_ _14"> </span>W<span class="_ _3"></span>e<span class="_ _14"> </span>refer<span class="_ _14"> </span>to<span class="_ _15"> </span>this<span class="_ _14"> </span>in-</span></div><div class="t m5 x17 h26 y646d ff7 fs19 fc1 sc0 ls0 ws0">struction<span class="_"> </span>as<span class="_"> </span>the<span class="_"> </span><span class="ffa">faulting<span class="_"> </span>instruction</span>.</div><div class="t m5 x17 h42 y646e ff6 fs29 fc6 sc0 ls0 ws0">T<span class="_ _3"></span>raps<span class="_ _16"> </span>and<span class="_ _11"> </span>System<span class="_ _16"> </span>Calls</div><div class="t m5 x17 h26 y2455 ffa fs19 fc1 sc0 ls0 ws0">T<span class="_ _3"></span>raps<span class="_"> </span><span class="ff7">are<span class="_"> </span></span>intentional<span class="_"> </span><span class="ff7">exceptions<span class="_"> </span>that<span class="_ _13"> </span>occur<span class="_"> </span>as<span class="_"> </span>a<span class="_ _13"> </span>result<span class="_"> </span>of<span class="_"> </span>executing<span class="_ _13"> </span>an<span class="_"> </span>instruction.</span></div><div class="t m5 x17 h26 y2456 ff7 fs19 fc1 sc0 ls0 ws0">Like<span class="_"> </span>interrupt<span class="_"> </span>handlers<span class="_ _0"></span>,<span class="_"> </span>trap<span class="_"> </span>handlers<span class="_ _11"> </span>return<span class="_"> </span>control<span class="_ _11"> </span>to<span class="_"> </span>the<span class="_ _11"> </span>next<span class="_"> </span>instruction.<span class="_ _11"> </span>T<span class="_ _1"></span>he</div><div class="t m5 x17 h26 y2457 ff7 fs19 fc1 sc0 ls0 ws0">most<span class="_"> </span>important<span class="_ _13"> </span>use<span class="_"> </span>of<span class="_ _13"> </span>traps<span class="_"> </span>is<span class="_ _13"> </span>to<span class="_"> </span>provide<span class="_ _13"> </span>a<span class="_"> </span>procedure-like<span class="_"> </span>interface<span class="_ _13"> </span>between<span class="_"> </span>user</div><div class="t m5 x17 h26 y2458 ff7 fs19 fc1 sc0 ls0 ws0">programs<span class="_"> </span>and<span class="_"> </span>the<span class="_"> </span>kernel,<span class="_"> </span>known<span class="_"> </span>as<span class="_"> </span>a<span class="_"> </span><span class="ffa">system<span class="_"> </span>call<span class="_ _2"></span></span>.</div><div class="t m5 x26 h26 y2459 ff7 fs19 fc1 sc0 ls0 ws0">User<span class="_ _13"> </span>programs<span class="_ _13"> </span>often<span class="_ _13"> </span>need<span class="_"> </span>to<span class="_ _13"> </span>request<span class="_ _13"> </span>services<span class="_ _13"> </span>from<span class="_ _13"> </span>the<span class="_ _13"> </span>kernel<span class="_"> </span>such<span class="_ _13"> </span>as<span class="_ _13"> </span>reading</div><div class="t m5 x17 h26 y4fe ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_ _13"> </span>ﬁle<span class="_ _13"> </span>(<span class="ffd">read</span>),<span class="_ _13"> </span>creating<span class="_"> </span>a<span class="_ _13"> </span>new<span class="_ _13"> </span>process<span class="_ _13"> </span>(<span class="ffd">fork</span>),<span class="_ _13"> </span>loading<span class="_ _13"> </span>a<span class="_ _13"> </span>new<span class="_ _13"> </span>program<span class="_"> </span>(<span class="ffd">execve</span>),<span class="_ _13"> </span>and</div><div class="t m5 x17 h26 y4ff ff7 fs19 fc1 sc0 ls0 ws0">terminating<span class="_"> </span>the<span class="_"> </span>current<span class="_ _13"> </span>process<span class="_"> </span>(<span class="ffd">exit</span>).<span class="_"> </span>T<span class="_ _3"></span>o<span class="_"> </span>allow<span class="_ _13"> </span>controlled<span class="_"> </span>access<span class="_"> </span>to<span class="_"> </span>such<span class="_"> </span>kernel</div><div class="t m5 x17 h26 y500 ff7 fs19 fc1 sc0 ls0 ws0">services<span class="_ _1"></span>,<span class="_ _13"> </span>processors<span class="_ _a"> </span>provide<span class="_ _13"> </span>a<span class="_ _6"> </span>special<span class="_ _6"> </span><span class="ffd">syscall<span class="_ _13"> </span><span class="ff11">n<span class="_ _a"> </span></span></span>instruction<span class="_ _13"> </span>that<span class="_ _6"> </span>user<span class="_ _6"> </span>programs<span class="_ _6"> </span>can</div><div class="t m5 x17 h26 y501 ff7 fs19 fc1 sc0 ls0 ws0">execute<span class="_ _11"> </span>when<span class="_ _11"> </span>they<span class="_ _11"> </span>want<span class="_ _11"> </span>to<span class="_ _16"> </span>request<span class="_"> </span>service<span class="_ _16"> </span><span class="ff11">n</span>.<span class="_"> </span>Executing<span class="_ _16"> </span>the<span class="_"> </span><span class="ffd">syscall<span class="_ _16"> </span></span>instruction</div><div class="t m5 x17 h26 y502 ff7 fs19 fc1 sc0 ls0 ws0">causes<span class="_ _14"> </span>a<span class="_ _14"> </span>trap<span class="_ _14"> </span>to<span class="_ _15"> </span>an<span class="_ _14"> </span>exception<span class="_ _14"> </span>handler<span class="_ _14"> </span>that<span class="_ _15"> </span>decodes<span class="_ _14"> </span>the<span class="_ _14"> </span>argument<span class="_ _14"> </span>and<span class="_ _15"> </span>calls<span class="_ _14"> </span>the</div><div class="t m5 x17 h26 y503 ff7 fs19 fc1 sc0 ls0 ws0">appropriate<span class="_ _13"> </span>kernel<span class="_ _6"> </span>routine<span class="_ _1"></span>.<span class="_ _13"> </span>F<span class="_ _1"></span>igure<span class="_ _13"> </span>8.6<span class="_ _13"> </span>summarizes<span class="_ _6"> </span>the<span class="_ _13"> </span>processing<span class="_ _6"> </span>for<span class="_ _13"> </span>a<span class="_ _6"> </span>system<span class="_ _13"> </span>call.</div><div class="t m5 x26 h26 y504 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>rom<span class="_"> </span>a<span class="_"> </span>programmer’s<span class="_ _13"> </span>perspective<span class="_ _0"></span>,<span class="_"> </span>a<span class="_"> </span>system<span class="_ _13"> </span>call<span class="_"> </span>is<span class="_"> </span>identical<span class="_ _13"> </span>to<span class="_"> </span>a<span class="_"> </span>regular<span class="_"> </span>func-</div><div class="t m5 x17 h26 y505 ff7 fs19 fc1 sc0 ls0 ws0">tion<span class="_ _11"> </span>call.<span class="_ _16"> </span>However<span class="_ _0"></span>,<span class="_ _11"> </span>their<span class="_ _16"> </span>implementations<span class="_ _11"> </span>are<span class="_ _16"> </span>quite<span class="_ _11"> </span>different.<span class="_ _11"> </span>Regular<span class="_ _16"> </span>functions</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
