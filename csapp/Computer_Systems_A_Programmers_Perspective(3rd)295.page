<div id="pf127" class="pf w2 h11" data-page-no="127"><div class="pc pc127 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg127.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">294<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x1d h47 yb1f ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>3.37<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>377)</span></div><div class="t m5 x1d h26 yb20 ff7 fs19 fc1 sc0 ls0 ws0">Suppose<span class="_ _6"> </span><span class="ff11">x</span></div><div class="t m5 x66 h6e y2aaf ffd fs25 fc1 sc0 ls0 ws0">P</div><div class="t m5 x1a8 h26 yb20 ff7 fs19 fc1 sc0 ls0 ws0">,<span class="_ _13"> </span>the<span class="_ _6"> </span>address<span class="_ _13"> </span>of<span class="_ _6"> </span>short<span class="_ _13"> </span>integer<span class="_ _6"> </span>array<span class="_ _13"> </span><span class="ffd">P</span>,<span class="_ _13"> </span>and<span class="_ _6"> </span>long<span class="_ _13"> </span>integer<span class="_ _6"> </span>index<span class="_ _13"> </span><span class="ff11">i<span class="_ _13"> </span></span>are<span class="_ _13"> </span>stored</div><div class="t m5 x1d h26 yb21 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_ _6"> </span>registers<span class="_ _13"> </span><span class="ffd">%rdx<span class="_ _6"> </span></span>and<span class="_ _13"> </span><span class="ffd">%rcx</span>,<span class="_ _13"> </span>respectively<span class="_ _7"></span>.<span class="_ _13"> </span>F<span class="_ _3"></span>or<span class="_ _13"> </span>each<span class="_ _6"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>following<span class="_ _6"> </span>expressions<span class="_ _1"></span>,<span class="_ _13"> </span>give</div><div class="t m5 x1d h26 yb22 ff7 fs19 fc1 sc0 ls0 ws0">its<span class="_ _13"> </span>type,<span class="_ _13"> </span>a<span class="_"> </span>formula<span class="_ _13"> </span>for<span class="_ _13"> </span>its<span class="_"> </span>value<span class="_ _1"></span>,<span class="_"> </span>and<span class="_ _13"> </span>an<span class="_"> </span>assembly-code<span class="_ _13"> </span>implementation.<span class="_ _13"> </span>The<span class="_ _13"> </span>result</div><div class="t m5 x1d h26 yba3 ff7 fs19 fc1 sc0 ls0 ws0">should<span class="_ _13"> </span>be<span class="_"> </span>stored<span class="_ _13"> </span>in<span class="_"> </span>register<span class="_ _13"> </span><span class="ffd">%rax<span class="_ _13"> </span></span>if<span class="_"> </span>it<span class="_ _13"> </span>is<span class="_ _13"> </span>a<span class="_"> </span>pointer<span class="_ _13"> </span>and<span class="_"> </span>register<span class="_ _13"> </span>element<span class="_ _13"> </span><span class="ffd">%ax<span class="_ _10"> </span></span>if<span class="_ _13"> </span>it<span class="_"> </span>has</div><div class="t m5 x1d h26 y1656 ff7 fs19 fc1 sc0 ls0 ws0">data<span class="_"> </span>type<span class="_"> </span><span class="ffd">short</span>.</div><div class="t m5 x1d h31 y2ab0 ff7 fs21 fc2 sc0 ls0 ws0">Expression<span class="_ _4f"> </span>T<span class="_ _3"></span>ype<span class="_ _f4"> </span>V<span class="_ _7"></span>alue<span class="_ _57"> </span>Assembly<span class="_"> </span>code</div><div class="t m5 x1d h2d y2ab1 ffd fs1e fc2 sc0 ls0 ws0">P[1]</div><div class="t m5 x1d h2d y2ab2 ffd fs1e fc1 sc0 ls4c ws0">P+3+i</div><div class="t m5 x1d h2d y2ab3 ffd fs1e fc1 sc0 ls4c ws0">P<span class="_ _49"></span>[<span class="_ _49"></span>i*6-5<span class="_ _4a"></span>]</div><div class="t m5 x1d h2d y2ab4 ffd fs1e fc1 sc0 ls0 ws0">P[2]</div><div class="t m5 x1d h2d y2ab5 ffd fs1e fc1 sc0 ls0 ws0">&amp;P[i<span class="_ _11"> </span>+<span class="_ _11"> </span>2]</div><div class="t m5 x1d h41 y2ab6 ffe fs29 fc1 sc0 ls0 ws0">3.8.3<span class="_ _48"> </span><span class="fs19">Nested<span class="_"> </span>Arrays</span></div><div class="t m5 x1d h26 y2ab7 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _15"> </span>general<span class="_ _15"> </span>principles<span class="_ _15"> </span>of<span class="_ _15"> </span>array<span class="_ _15"> </span>allocation<span class="_ _15"> </span>and<span class="_ _15"> </span>referencing<span class="_ _15"> </span>hold<span class="_ _15"> </span>even<span class="_ _15"> </span>when<span class="_ _15"> </span>we</div><div class="t m5 x1d h26 y2ab8 ff7 fs19 fc1 sc0 ls0 ws0">create<span class="_"> </span>arrays<span class="_"> </span>of<span class="_"> </span>arrays<span class="_ _1"></span>.<span class="_"> </span>F<span class="_ _1"></span>or<span class="_"> </span>example<span class="_ _0"></span>,<span class="_"> </span>the<span class="_"> </span>declaration</div><div class="t m5 x1d h2d y2ab9 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>A[5][3];</div><div class="t m5 x1d h26 y2aba ff7 fs19 fc2 sc0 ls0 ws0">is<span class="_"> </span>equivalent<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>declaration</div><div class="t m5 x1d h2d y2abb ffd fs1e fc2 sc0 ls0 ws0">typedef<span class="_ _e"> </span>int<span class="_ _1f"> </span>row3_t[3];</div><div class="t m5 x1d h2d y2abc ffd fs1e fc2 sc0 ls0 ws0">row3_t<span class="_ _e"> </span>A[5];</div><div class="t m5 x1d h26 y2abd ff7 fs19 fc2 sc0 ls0 ws0">Data<span class="_ _13"> </span>type<span class="_"> </span><span class="ffd">row3_t<span class="_ _13"> </span></span>is<span class="_"> </span>deﬁned<span class="_ _13"> </span>to<span class="_"> </span>be<span class="_ _13"> </span>an<span class="_ _13"> </span>array<span class="_"> </span>of<span class="_ _13"> </span>three<span class="_"> </span>integers<span class="_ _3"></span>.<span class="_"> </span>Array<span class="_ _13"> </span><span class="ffd">A<span class="_ _13"> </span></span>contains<span class="_"> </span>ﬁve</div><div class="t m5 x1d h26 y2abe ff7 fs19 fc2 sc0 ls0 ws0">such<span class="_"> </span>elements<span class="_ _3"></span>,<span class="_"> </span>each<span class="_"> </span>requiring<span class="_"> </span>12<span class="_"> </span>bytes<span class="_"> </span>to<span class="_"> </span>store<span class="_"> </span>the<span class="_ _13"> </span>three<span class="_"> </span>integers<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _0"></span>he<span class="_"> </span>total<span class="_"> </span>array</div><div class="t m5 x1d h26 y2abf ff7 fs19 fc2 sc0 ls0 ws0">size<span class="_"> </span>is<span class="_"> </span>then<span class="_"> </span>4</div><div class="t m5 x135 h45 y2ac0 ff11 fs19 fc2 sc0 ls0 ws0">.</div><div class="t m5 x20 h26 y2abf ff7 fs19 fc2 sc0 ls0 ws0">5</div><div class="t m5 x235 h45 y2ac0 ff11 fs19 fc2 sc0 ls0 ws0">.</div><div class="t m5 x8f h46 y2abf ff7 fs19 fc2 sc0 ls0 ws0">3<span class="_ _13"> </span><span class="ff12">=<span class="_ _13"></span></span>60<span class="_"> </span>bytes<span class="_ _0"></span>.</div><div class="t m5 x29 h26 y2ac1 ff7 fs19 fc2 sc0 ls0 ws0">Array<span class="_ _14"> </span><span class="ffd">A<span class="_ _14"> </span></span>can<span class="_ _14"> </span>also<span class="_ _14"> </span>be<span class="_ _14"> </span>viewed<span class="_ _14"> </span>as<span class="_ _14"> </span>a<span class="_ _14"> </span>two-dimensional<span class="_ _15"> </span>array<span class="_ _14"> </span>with<span class="_ _14"> </span>ﬁve<span class="_ _14"> </span>rows<span class="_ _14"> </span>and</div><div class="t m5 x1d h26 y2ac2 ff7 fs19 fc2 sc0 ls0 ws0">three<span class="_"> </span>columns<span class="_ _1"></span>,<span class="_"> </span>referenced<span class="_ _11"> </span>as<span class="_"> </span><span class="ffd">A[0][0]<span class="_ _10"> </span></span>through<span class="_ _22"> </span><span class="ffd">A[4][2]</span>.<span class="_ _11"> </span>T<span class="_ _1"></span>he<span class="_ _11"> </span>array<span class="_"> </span>elements<span class="_"> </span>are</div><div class="t m5 x1d h26 y2ac3 ff7 fs19 fc2 sc0 ls0 ws0">ordered<span class="_ _14"> </span>in<span class="_ _15"> </span>memory<span class="_ _14"> </span>in<span class="_ _14"> </span><span class="ffa">row-major<span class="_ _21"> </span></span>order,<span class="_ _14"> </span>meaning<span class="_ _15"> </span>all<span class="_ _14"> </span>elements<span class="_ _15"> </span>of<span class="_ _14"> </span>row<span class="_ _15"> </span>0,<span class="_ _15"> </span>which</div><div class="t m5 x1d h26 y2ac4 ff7 fs19 fc2 sc0 ls0 ws0">can<span class="_"> </span>be<span class="_ _11"> </span>written<span class="_ _11"> </span><span class="ffd">A[0]</span>,<span class="_ _11"> </span>followed<span class="_ _11"> </span>by<span class="_ _11"> </span>all<span class="_ _11"> </span>elements<span class="_ _11"> </span>of<span class="_ _11"> </span>row<span class="_ _11"> </span>1<span class="_"> </span>(<span class="ffd">A[1]</span>),<span class="_ _16"> </span>and<span class="_"> </span>so<span class="_ _11"> </span>on.<span class="_ _11"> </span>T<span class="_ _1"></span>his<span class="_ _11"> </span>is</div><div class="t m5 x1d h26 y2ac5 ff7 fs19 fc2 sc0 ls0 ws0">illustrated<span class="_"> </span>in<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>3.36.</div><div class="t m5 x29 h26 y2ac6 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _15"> </span>ordering<span class="_ _14"> </span>is<span class="_ _15"> </span>a<span class="_ _14"> </span>consequence<span class="_ _14"> </span>of<span class="_ _15"> </span>our<span class="_ _14"> </span>nested<span class="_ _15"> </span>declaration.<span class="_ _14"> </span>Viewing<span class="_ _16"> </span><span class="ffd">A<span class="_ _15"> </span></span>as<span class="_ _14"> </span>an</div><div class="t m5 x1d h26 y2ac7 ff7 fs19 fc2 sc0 ls0 ws0">array<span class="_"> </span>of<span class="_ _13"> </span>ﬁve<span class="_"> </span>elements<span class="_ _3"></span>,<span class="_"> </span>each<span class="_"> </span>of<span class="_ _13"> </span>which<span class="_"> </span>is<span class="_ _13"> </span>an<span class="_"> </span>array<span class="_"> </span>of<span class="_ _13"> </span>three<span class="_"> </span><span class="ffd">int</span>’<span class="_ _1"></span>s<span class="_ _1"></span>,<span class="_"> </span>we<span class="_"> </span>ﬁrst<span class="_ _13"> </span>have<span class="_"> </span><span class="ffd">A[0]</span>,</div><div class="t m5 x1d h26 y2ac8 ff7 fs19 fc2 sc0 ls0 ws0">followed<span class="_"> </span>by<span class="_"> </span><span class="ffd">A[1]</span>,<span class="_"> </span>and<span class="_"> </span>so<span class="_"> </span>on.</div><div class="t m5 x29 h26 y2ac9 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_ _13"> </span>access<span class="_ _6"> </span>elements<span class="_ _6"> </span>of<span class="_ _13"> </span>multidimensional<span class="_ _6"> </span>arrays<span class="_ _1"></span>,<span class="_ _13"> </span>the<span class="_ _6"> </span>compiler<span class="_ _6"> </span>generates<span class="_ _13"> </span>code<span class="_ _a"> </span>to</div><div class="t m5 x1d h26 y2aca ff7 fs19 fc2 sc0 ls0 ws0">compute<span class="_ _6"> </span>the<span class="_ _6"> </span>offset<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _a"> </span>desired<span class="_ _6"> </span>element<span class="_ _13"> </span>and<span class="_ _a"> </span>then<span class="_ _6"> </span>uses<span class="_ _13"> </span>one<span class="_ _a"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span><span class="ff9">mo<span class="_ _1"></span>v<span class="_ _6"> </span><span class="ff7">instructions</span></span></div><div class="t m5 x1d h26 y2acb ff7 fs19 fc2 sc0 ls0 ws0">with<span class="_ _11"> </span>the<span class="_ _11"> </span>start<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_"> </span>array<span class="_ _16"> </span>as<span class="_"> </span>the<span class="_ _16"> </span>base<span class="_"> </span>address<span class="_ _16"> </span>and<span class="_"> </span>the<span class="_ _16"> </span>(possibly<span class="_"> </span>scaled)<span class="_ _16"> </span>offset<span class="_ _11"> </span>as</div><div class="t m5 x1d h26 y2acc ff7 fs19 fc2 sc0 ls0 ws0">an<span class="_"> </span>index.<span class="_"> </span>In<span class="_"> </span>general,<span class="_"> </span>for<span class="_"> </span>an<span class="_"> </span>array<span class="_"> </span>declared<span class="_"> </span>as</div><div class="t m5 x1d h53 y2acd ffa fs1e fc2 sc0 ls0 ws0">T<span class="_ _23"> </span><span class="ffd">D[</span>R<span class="ffd">][</span>C<span class="_ _2"></span><span class="ffd">];</span></div><div class="t m5 x1d h26 y2ace ff7 fs19 fc2 sc0 ls0 ws0">array<span class="_"> </span>element<span class="_"> </span><span class="ffd">D[i][j]<span class="_ _10"> </span></span>is<span class="_"> </span>at<span class="_"> </span>memory<span class="_"> </span>address</div><div class="t m5 x192 h46 y2acf ff7 fs19 fc2 sc0 ls0 ws0">&amp;<span class="ffd">D</span>[<span class="ffd">i<span class="_ _1"></span><span class="ff7 ls2d">][<span class="_ _2"></span><span class="ffd ls0">j<span class="_ _7"></span><span class="ff7">]<span class="_ _13"> </span><span class="ff12">=<span class="_ _13"></span><span class="ff11">x</span></span></span></span></span></span></div><div class="t m5 x1ae h6e y1574 ffd fs25 fc2 sc0 ls0 ws0">D</div><div class="t m5 x40 h46 ye95 ff12 fs19 fc2 sc0 ls0 ws0">+<span class="_ _13"> </span><span class="ff11">L(C</span></div><div class="t m5 x194 h45 y2ad0 ff11 fs19 fc2 sc0 ls0 ws0">.</div><div class="t m5 xff h46 ye95 ff11 fs19 fc2 sc0 ls0 ws0">i<span class="_ _11"> </span><span class="ff12">+<span class="_ _10"> </span></span><span class="ls174">j)<span class="_ _bc"> </span></span><span class="ff7">(3.1)</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
