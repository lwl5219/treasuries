<div id="pf196" class="pf w2 h11" data-page-no="196"><div class="pc pc196 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg196.png"/><div class="t m5 xfc h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>4.1<span class="_ _60"> </span>The<span class="_ _10"> </span>Y86-64<span class="_ _10"> </span>Instruction<span class="_ _10"> </span>Set<span class="_ _10"> </span>Architecture<span class="_ _1b"> </span><span class="ffe fs1e">405</span></div><div class="t m5 x17 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _f"> </span>program<span class="_ _f"> </span>on<span class="_ _f"> </span>the<span class="_ _f"> </span>hardware<span class="_ _f"> </span>itself<span class="_ _1"></span>.<span class="_ _f"> </span>Running<span class="_ _f"> </span>on<span class="_ _f"> </span>our<span class="_ _f"> </span>sample<span class="_ _f"> </span>object<span class="_ _f"> </span>code,<span class="_ _e"> </span><span class="ff9">yis</span></div><div class="t m5 x17 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">generates<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>output:</div><div class="t m5 x17 h2d y3853 ffd fs1e fc2 sc0 ls0 ws0">Stopped<span class="_ _e"> </span>in<span class="_ _1f"> </span>34<span class="_ _1f"> </span>steps<span class="_ _e"> </span>at<span class="_ _1f"> </span>PC<span class="_ _e"> </span>=<span class="_ _1f"> </span>0x13.<span class="_ _1a"> </span>Status<span class="_ _1f"> </span>’HLT’,<span class="_ _e"> </span>CC<span class="_ _1f"> </span>Z=1<span class="_ _e"> </span>S=0<span class="_ _1f"> </span>O=0</div><div class="t m5 x17 h2d y3854 ffd fs1e fc2 sc0 ls0 ws0">Changes<span class="_ _e"> </span>to<span class="_ _1f"> </span>registers:</div><div class="t m5 x17 h2d y3855 ffd fs1e fc2 sc0 ls0 ws0">%rax:<span class="_ _3f"> </span>0x0000000000000000<span class="_ _5a"> </span>0x0000abcdabcdabcd</div><div class="t m5 x17 h2d y3856 ffd fs1e fc2 sc0 ls0 ws0">%rsp:<span class="_ _3f"> </span>0x0000000000000000<span class="_ _5a"> </span>0x0000000000000200</div><div class="t m5 x17 h2d y3857 ffd fs1e fc2 sc0 ls0 ws0">%rdi:<span class="_ _3f"> </span>0x0000000000000000<span class="_ _5a"> </span>0x0000000000000038</div><div class="t m5 x17 h2d y3858 ffd fs1e fc2 sc0 ls0 ws0">%r8:<span class="_ _46"> </span>0x0000000000000000<span class="_ _5a"> </span>0x0000000000000008</div><div class="t m5 x17 h2d y3859 ffd fs1e fc2 sc0 ls0 ws0">%r9:<span class="_ _46"> </span>0x0000000000000000<span class="_ _5a"> </span>0x0000000000000001</div><div class="t m5 x17 h2d y385a ffd fs1e fc2 sc0 ls0 ws0">%r10:<span class="_ _3f"> </span>0x0000000000000000<span class="_ _5a"> </span>0x0000a000a000a000</div><div class="t m5 x17 h2d y385b ffd fs1e fc2 sc0 ls0 ws0">Changes<span class="_ _e"> </span>to<span class="_ _1f"> </span>memory:</div><div class="t m5 x17 h2d y385c ffd fs1e fc2 sc0 ls0 ws0">0x01f0:<span class="_ _e"> </span>0x0000000000000000<span class="_ _b9"> </span>0x0000000000000055</div><div class="t m5 x17 h2d y385d ffd fs1e fc2 sc0 ls0 ws0">0x01f8:<span class="_ _e"> </span>0x0000000000000000<span class="_ _b9"> </span>0x0000000000000013</div><div class="t m5 x26 h26 y385e ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _f"> </span>ﬁrst<span class="_ _f"> </span>line<span class="_ _21"> </span>of<span class="_ _f"> </span>the<span class="_ _f"> </span>simulation<span class="_ _21"> </span>output<span class="_ _f"> </span>summarizes<span class="_ _f"> </span>the<span class="_ _21"> </span>execution<span class="_ _f"> </span>and<span class="_ _f"> </span>the</div><div class="t m5 x17 h26 y385f ff7 fs19 fc2 sc0 ls0 ws0">resulting<span class="_ _16"> </span>values<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>PC<span class="_ _16"> </span>and<span class="_ _16"> </span>program<span class="_ _16"> </span>status<span class="_ _3"></span>.<span class="_ _16"> </span>In<span class="_ _16"> </span>printing<span class="_ _16"> </span>register<span class="_ _16"> </span>and<span class="_ _16"> </span>memory</div><div class="t m5 x17 h26 y3860 ff7 fs19 fc2 sc0 ls0 ws0">values<span class="_ _1"></span>,<span class="_ _11"> </span>it<span class="_ _11"> </span>only<span class="_ _11"> </span>prints<span class="_ _11"> </span>out<span class="_ _11"> </span>words<span class="_ _11"> </span>that<span class="_ _11"> </span>change<span class="_ _11"> </span>during<span class="_ _11"> </span>simulation,<span class="_ _16"> </span>either<span class="_"> </span>in<span class="_ _11"> </span>registers</div><div class="t m5 x17 h26 y3861 ff7 fs19 fc2 sc0 ls0 ws0">or<span class="_ _11"> </span>in<span class="_ _11"> </span>memory<span class="_ _3"></span>.<span class="_ _11"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span>original<span class="_"> </span>values<span class="_ _11"> </span>(here<span class="_ _16"> </span>they<span class="_"> </span>are<span class="_ _11"> </span>all<span class="_ _11"> </span>zero)<span class="_ _16"> </span>are<span class="_"> </span>shown<span class="_ _11"> </span>on<span class="_ _16"> </span>the<span class="_"> </span>left,</div><div class="t m5 x17 h26 y3862 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_"> </span>the<span class="_ _13"> </span>ﬁnal<span class="_"> </span>values<span class="_ _13"> </span>are<span class="_"> </span>shown<span class="_ _13"> </span>on<span class="_"> </span>the<span class="_ _13"> </span>right.<span class="_"> </span>W<span class="_ _3"></span>e<span class="_ _13"> </span>can<span class="_"> </span>see<span class="_"> </span>in<span class="_ _13"> </span>this<span class="_"> </span>output<span class="_ _13"> </span>that<span class="_"> </span>register</div><div class="t m5 x17 h26 y3863 ffd fs19 fc2 sc0 ls0 ws0">%rax<span class="_ _14"> </span><span class="ff7">contains<span class="_ _14"> </span></span>0xabcdabcdabcdabcd<span class="ff7">,<span class="_ _15"> </span>the<span class="_ _15"> </span>sum<span class="_ _14"> </span>of<span class="_ _14"> </span>the<span class="_ _14"> </span>4-element<span class="_ _15"> </span>array<span class="_ _14"> </span>passed<span class="_ _14"> </span>to</span></div><div class="t m5 x17 h26 y3864 ff7 fs19 fc2 sc0 ls0 ws0">procedure<span class="_ _6"> </span><span class="ffd">sum</span>.<span class="_ _13"> </span>In<span class="_ _6"> </span>addition,<span class="_ _13"> </span>we<span class="_ _6"> </span>can<span class="_ _13"> </span>see<span class="_ _a"> </span>that<span class="_ _13"> </span>the<span class="_ _6"> </span>stack,<span class="_ _13"> </span>which<span class="_ _6"> </span>starts<span class="_ _13"> </span>at<span class="_ _6"> </span>address<span class="_ _6"> </span><span class="ffd">0x200</span></div><div class="t m5 x17 h26 y3865 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_ _16"> </span>grows<span class="_ _16"> </span>toward<span class="_ _16"> </span>lower<span class="_ _14"> </span>addresses<span class="_ _1"></span>,<span class="_ _14"> </span>has<span class="_ _16"> </span>been<span class="_ _16"> </span>used,<span class="_ _14"> </span>causing<span class="_ _16"> </span>changes<span class="_ _16"> </span>to<span class="_ _14"> </span>words<span class="_ _16"> </span>of</div><div class="t m5 x17 h26 y3866 ff7 fs19 fc2 sc0 ls0 ws0">memory<span class="_ _13"> </span>at<span class="_"> </span>addresses<span class="_ _13"> </span><span class="ffd">0x1f0</span>–<span class="ffd">0x1f8</span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>maximum<span class="_ _13"> </span>address<span class="_ _13"> </span>for<span class="_"> </span>executable<span class="_ _13"> </span>code<span class="_"> </span>is</div><div class="t m5 x17 h26 y3867 ffd fs19 fc2 sc0 ls0 ws0">0x090<span class="ff7">,<span class="_"> </span>and<span class="_"> </span>so<span class="_"> </span>the<span class="_ _13"> </span>pushing<span class="_"> </span>and<span class="_"> </span>popping<span class="_"> </span>of<span class="_"> </span>values<span class="_"> </span>on<span class="_ _13"> </span>the<span class="_"> </span>stack<span class="_"> </span>did<span class="_"> </span>not<span class="_"> </span>corrupt<span class="_"> </span>the</span></div><div class="t m5 x17 h26 y3868 ff7 fs19 fc2 sc0 ls0 ws0">executable<span class="_"> </span>code<span class="_ _1"></span>.</div><div class="t m5 x17 h47 y3869 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>4.3<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>518)</span></div><div class="t m5 x17 h26 y386a ff7 fs19 fc1 sc0 ls0 ws0">One<span class="_ _11"> </span>common<span class="_ _16"> </span>pattern<span class="_ _16"> </span>in<span class="_ _11"> </span>machine-level<span class="_ _16"> </span>programs<span class="_ _16"> </span>is<span class="_ _11"> </span>to<span class="_ _16"> </span>add<span class="_ _11"> </span>a<span class="_ _16"> </span>constant<span class="_ _16"> </span>value<span class="_ _11"> </span>to<span class="_ _16"> </span>a</div><div class="t m5 x17 h26 y386b ff7 fs19 fc1 sc0 ls0 ws0">register.<span class="_ _a"> </span>With<span class="_ _a"> </span>the<span class="_ _6"> </span>Y86-64<span class="_ _13"> </span>instructions<span class="_ _a"> </span>presented<span class="_ _13"> </span>thus<span class="_ _a"> </span>far,<span class="_ _6"> </span>this<span class="_ _13"> </span>requires<span class="_ _a"> </span>ﬁrst<span class="_ _13"> </span>using<span class="_ _a"> </span>an</div><div class="t m5 x17 h26 y386c ffd fs19 fc1 sc0 ls0 ws0">irmovq<span class="_ _13"> </span><span class="ff7">instruction<span class="_ _6"> </span>to<span class="_ _13"> </span>set<span class="_ _13"> </span>a<span class="_ _13"> </span>register<span class="_ _6"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>constant,<span class="_ _13"> </span>and<span class="_ _13"> </span>then<span class="_ _6"> </span>an<span class="_ _13"> </span></span>addq<span class="_ _13"> </span><span class="ff7">instruction<span class="_ _13"> </span>to</span></div><div class="t m5 x17 h26 y386d ff7 fs19 fc1 sc0 ls0 ws0">add<span class="_ _6"> </span>this<span class="_ _6"> </span>value<span class="_ _6"> </span>to<span class="_ _13"> </span>the<span class="_ _a"> </span>destination<span class="_ _13"> </span>register<span class="_ _1"></span>.<span class="_ _13"> </span>Suppose<span class="_ _a"> </span>we<span class="_ _6"> </span>want<span class="_ _13"> </span>to<span class="_ _a"> </span>add<span class="_ _6"> </span>a<span class="_ _13"> </span>new<span class="_ _a"> </span>instruction</div><div class="t m5 x17 h26 y386e ffd fs19 fc1 sc0 ls0 ws0">iaddq<span class="_ _10"> </span><span class="ff7">with<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>format:</span></div><div class="t m5 x1b9 h40 y386f ff3a fs28 fc1 sc0 ls0 ws0">0</div><div class="t m5 x5c h40 y3870 ff3a fs28 fc1 sc0 ls1ae ws0">C0</div><div class="t m5 x17 h3f y3871 ff30 fs27 fc1 sc0 ls0 ws0">Byte</div><div class="t m5 x17 h40 y3872 ff3a fs28 fc1 sc0 ls0 ws0">iaddq <span class="ff30 fs27">V<span class="_ _3"></span>, rB</span></div><div class="t m5 x23 h40 y386f ff3a fs28 fc1 sc0 ls0 ws0">1</div><div class="t m5 x127 h40 y3870 ff3a fs28 fc1 sc0 ls0 ws0">F</div><div class="t m5 x1c4 h3f y3873 ff30 fs27 fc1 sc0 ls0 ws0">rB<span class="_ _1a4"> </span>V</div><div class="t m5 x1ec h40 y386f ff3a fs28 fc1 sc0 ls1af ws0">23456789</div><div class="t m5 x17 h26 y3874 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>instruction<span class="_"> </span>adds<span class="_"> </span>the<span class="_"> </span>constant<span class="_"> </span>value<span class="_"> </span><span class="ff6">V<span class="_ _10"> </span></span>to<span class="_"> </span>register<span class="_"> </span><span class="ff6">rB</span>.</div><div class="t m5 x26 h26 y3875 ff7 fs19 fc1 sc0 ls0 ws0">Rewrite<span class="_ _21"> </span>the<span class="_ _21"> </span>Y86-64<span class="_ _21"> </span><span class="ffd">sum<span class="_ _21"> </span></span>function<span class="_ _21"> </span>of<span class="_ _21"> </span>Figure<span class="_ _15"> </span>4.6<span class="_ _21"> </span>to<span class="_ _f"> </span>make<span class="_ _21"> </span>use<span class="_ _21"> </span>of<span class="_ _21"> </span>the<span class="_ _21"> </span><span class="ffd">iaddq</span></div><div class="t m5 x17 h26 y3876 ff7 fs19 fc1 sc0 ls0 ws0">instruction.<span class="_ _16"> </span>In<span class="_ _14"> </span>the<span class="_ _14"> </span>original<span class="_ _14"> </span>version,<span class="_ _14"> </span>we<span class="_ _14"> </span>dedicated<span class="_ _14"> </span>registers<span class="_ _14"> </span><span class="ffd">%r8<span class="_ _14"> </span></span>and<span class="_ _16"> </span><span class="ffd">%r9<span class="_ _14"> </span></span>to<span class="_ _14"> </span>hold</div><div class="t m5 x17 h26 y3877 ff7 fs19 fc1 sc0 ls0 ws0">constant<span class="_"> </span>values<span class="_ _1"></span>.<span class="_"> </span>Now<span class="_ _3"></span>,<span class="_"> </span>we<span class="_"> </span>can<span class="_"> </span>avoid<span class="_"> </span>using<span class="_"> </span>those<span class="_"> </span>registers<span class="_"> </span>altogether.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
