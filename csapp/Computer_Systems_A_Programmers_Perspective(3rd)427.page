<div id="pf1ab" class="pf w2 h11" data-page-no="1ab"><div class="pc pc1ab w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1ab.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">426<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>4<span class="_ _3d"> </span>Processor<span class="_ _10"> </span>Architecture</span></div><div class="t m5 x28 h2a y257 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">T<span class="_ _3"></span>racing<span class="_ _11"> </span>the<span class="_ _11"> </span>execution<span class="_ _16"> </span>of<span class="_ _11"> </span>an<span class="_ _11"> </span><span class="ffd fs2b">rmmovq<span class="_ _11"> </span></span>instruction</span></div><div class="t m5 x28 h2b y2d0 ff7 fs1e fc2 sc0 ls0 ws0">Let<span class="_"> </span>us<span class="_"> </span>trace<span class="_ _13"> </span>the<span class="_"> </span>processing<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_"> </span><span class="ffd">rmmovq<span class="_ _13"> </span></span>instruction<span class="_"> </span>on<span class="_"> </span>line<span class="_"> </span>5<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_"> </span>object<span class="_ _13"> </span>code<span class="_"> </span>shown<span class="_"> </span>in<span class="_ _13"> </span>F<span class="_ _0"></span>igure<span class="_"> </span>4.17.</div><div class="t m5 x28 h2b y2d1 ff7 fs1e fc2 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _16"> </span>can<span class="_ _11"> </span>see<span class="_ _11"> </span>that<span class="_ _16"> </span>the<span class="_ _11"> </span>previous<span class="_ _11"> </span>instruction<span class="_ _16"> </span>initialized<span class="_ _11"> </span>register<span class="_ _11"> </span><span class="ffd">%rsp<span class="_ _16"> </span></span>to<span class="_ _11"> </span>128,<span class="_ _16"> </span>while<span class="_ _11"> </span><span class="ffd">%rbx<span class="_ _11"> </span></span>still<span class="_ _16"> </span>holds<span class="_ _11"> </span>12,<span class="_ _16"> </span>as</div><div class="t m5 x28 h2b y2d2 ff7 fs1e fc2 sc0 ls0 ws0">computed<span class="_ _11"> </span>by<span class="_ _16"> </span>the<span class="_ _16"> </span><span class="ffd">subq<span class="_ _11"> </span></span>instruction<span class="_ _16"> </span>(line<span class="_ _11"> </span>3).<span class="_ _16"> </span>W<span class="_ _3"></span>e<span class="_ _16"> </span>can<span class="_ _11"> </span>also<span class="_ _16"> </span>see<span class="_ _16"> </span>that<span class="_ _11"> </span>the<span class="_ _16"> </span>instruction<span class="_ _11"> </span>is<span class="_ _16"> </span>located<span class="_ _11"> </span>at<span class="_ _16"> </span>address</div><div class="t m5 x28 h2b y2d3 ffd fs1e fc2 sc0 ls0 ws0">0x020<span class="_ _10"> </span><span class="ff7">and<span class="_"> </span>consists<span class="_"> </span>of<span class="_"> </span>10<span class="_"> </span>bytes<span class="_ _1"></span>.<span class="_ _10"> </span>The<span class="_"> </span>ﬁrst<span class="_"> </span>2<span class="_"> </span>bytes<span class="_"> </span>have<span class="_"> </span>values<span class="_"> </span><span class="ffd">0x40<span class="_ _10"> </span></span>and<span class="_"> </span><span class="ffd">0x43</span>,<span class="_"> </span>while<span class="_ _10"> </span>the<span class="_"> </span>ﬁnal<span class="_ _10"> </span>8<span class="_ _10"> </span>bytes<span class="_"> </span>are</span></div><div class="t m5 x28 h2b y2d4 ff7 fs1e fc2 sc0 ls0 ws0">a<span class="_ _13"> </span>byte-reversed<span class="_"> </span>version<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>number<span class="_ _13"> </span><span class="ffd">0x0000000000000064<span class="_ _13"> </span></span>(decimal<span class="_"> </span>100).<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_"> </span>stages<span class="_ _13"> </span>would<span class="_"> </span>proceed</div><div class="t m5 x28 h2b y2d5 ff7 fs1e fc2 sc0 ls0 ws0">as<span class="_"> </span>follows:</div><div class="t m5 x5b h31 y3b0c ff7 fs21 fc2 sc0 ls0 ws0">Generic<span class="_ _15a"> </span>Speciﬁc</div><div class="t m5 x28 h31 y3b0d ff7 fs21 fc2 sc0 ls0 ws0">Stage</div><div class="t m5 x5b h93 y3b0e ffd fs1e fc2 sc0 ls0 ws0">rmmovq<span class="_ _11"> </span><span class="ff6 fs21">rA</span>,<span class="_ _11"> </span><span class="ff6 fs21">D</span>(<span class="ff6 fs21">rB</span>)<span class="_ _53"> </span>rmmovq<span class="_ _11"> </span>%rsp,<span class="_ _11"> </span>100(%rbx)</div><div class="t m5 x28 h32 y3b0f ff7 fs21 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>etch<span class="_ _55"> </span><span class="ff6">icode<span class="_ _a"> </span></span>:<span class="_ _be"></span><span class="ff6">ifun<span class="_ _23"> </span><span class="ff12">←<span class="_ _25"> </span></span>M</span></div><div class="t m5 x7c h33 y3b10 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x235 h32 y3b0f ff7 fs21 fc2 sc0 ls0 ws0">[<span class="ff6">PC</span>]<span class="_ _74"> </span><span class="ff6">icode<span class="_ _a"> </span></span>:<span class="_ _be"></span><span class="ff6">ifun<span class="_ _23"> </span><span class="ff12">←<span class="_ _25"> </span></span>M</span></div><div class="t m5 x1e7 h33 y3b10 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x1c9 h32 y3b0f ff7 fs21 fc2 sc0 ls0 ws0">[<span class="ffd fs1e">0x020</span>]<span class="_ _6"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ffd fs1e">4:0</span></span></div><div class="t m5 x5b h32 y3b11 ff6 fs21 fc2 sc0 ls0 ws0">rA<span class="_ _6"> </span><span class="ff7">:<span class="_ _be"></span></span>rB<span class="_ _25"> </span><span class="ff12">←<span class="_ _23"> </span></span>M</div><div class="t m5 x1cc h33 y3b12 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x4d h32 y3b11 ff7 fs21 fc2 sc0 ls0 ws0">[<span class="ff6">PC<span class="_ _13"> </span><span class="ff12">+<span class="_ _13"> </span></span></span>1]<span class="_ _5c"> </span><span class="ff6">rA<span class="_ _6"> </span></span>:<span class="_ _a"> </span><span class="ff6">rB<span class="_ _23"> </span><span class="ff12">←<span class="_ _25"> </span></span>M</span></div><div class="t m5 x1ab h33 y3b12 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x1ae h32 y3b11 ff7 fs21 fc2 sc0 ls0 ws0">[<span class="ffd fs1e">0x021</span>]<span class="_ _6"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ffd fs1e">4:3</span></span></div><div class="t m5 x5b h32 y3b13 ff6 fs21 fc2 sc0 ls0 ws0">valC<span class="_ _25"> </span><span class="ff12">←<span class="_ _23"> </span></span>M</div><div class="t m5 x21f h33 y3b14 ff7 fs20 fc2 sc0 ls0 ws0">8</div><div class="t m5 x145 h32 y3b13 ff7 fs21 fc2 sc0 ls0 ws0">[<span class="ff6">PC<span class="_ _13"> </span><span class="ff12">+<span class="_ _13"> </span></span></span>2]<span class="_ _2c"> </span><span class="ff6">valC<span class="_ _25"> </span><span class="ff12">←<span class="_ _23"> </span></span>M</span></div><div class="t m5 x99 h33 y3b14 ff7 fs20 fc2 sc0 ls0 ws0">8</div><div class="t m5 x118 h32 y3b13 ff7 fs21 fc2 sc0 ls0 ws0">[<span class="ffd fs1e">0x022</span>]<span class="_ _6"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ffd fs1e">100</span></span></div><div class="t m5 x5b h32 y3b15 ff6 fs21 fc2 sc0 ls0 ws0">valP<span class="_ _23"> </span><span class="ff12">←<span class="_ _25"> </span></span>PC<span class="_ _13"> </span><span class="ff12">+<span class="_ _13"> </span><span class="ff7">10<span class="_ _54"> </span></span></span>valP<span class="_ _25"> </span><span class="ff12">←<span class="_ _23"> </span><span class="ffd fs1e">0x020<span class="_ _13"> </span></span>+<span class="_ _13"> </span><span class="ff7">10<span class="_"> </span></span>=<span class="_ _13"> </span><span class="ffd fs1e">0x02a</span></span></div><div class="t m5 x28 h32 y3b16 ff7 fs21 fc2 sc0 ls0 ws0">Decode<span class="_ _bd"> </span><span class="ff6">valA<span class="_ _25"> </span><span class="ff12">←<span class="_ _25"> </span></span>R</span>[<span class="ff6">rA<span class="_ _2"></span></span>]<span class="_ _2f"> </span><span class="ff6">valA<span class="_ _24"> </span><span class="ff12">←<span class="_ _23"> </span></span>R<span class="_ _2"></span></span>[<span class="ffd fs1e">%rsp</span>]<span class="_ _a"> </span><span class="ff12">=<span class="_ _10"> </span><span class="ffd fs1e">128</span></span></div><div class="t m5 x5b h32 y3b17 ff6 fs21 fc2 sc0 ls0 ws0">valB<span class="_ _23"> </span><span class="ff12">←<span class="_ _25"> </span></span>R<span class="ff7">[</span>rB<span class="ff7">]<span class="_ _12b"> </span></span>valB<span class="_ _23"> </span><span class="ff12">←<span class="_ _25"> </span></span>R<span class="ff7">[<span class="ffd fs1e">%rbx</span><span class="ls1b8">]=<span class="_ _2"></span></span><span class="ffd fs1e">12</span></span></div><div class="t m5 x28 h32 y3b18 ff7 fs21 fc2 sc0 ls0 ws0">Execute<span class="_ _f4"> </span><span class="ff6">valE<span class="_ _25"> </span><span class="ff12">←<span class="_ _23"> </span></span>valB<span class="_ _13"> </span><span class="ff12">+<span class="_ _13"> </span></span>valC<span class="_ _63"> </span>valE<span class="_ _25"> </span><span class="ff12">←</span></span></div><div class="t m5 x187 h32 y3b19 ffd fs1e fc2 sc0 ls0 ws0">12<span class="_ _13"> </span><span class="ff12 fs21">+<span class="_ _13"> </span></span>100<span class="_ _13"> </span><span class="ff12 fs21">=<span class="_ _13"> </span></span>112</div><div class="t m5 x28 h31 y3b1a ff7 fs21 fc2 sc0 ls0 ws0">Memory<span class="_ _88"> </span><span class="ff6">M</span></div><div class="t m5 x155 h33 y3b1b ff7 fs20 fc2 sc0 ls0 ws0">8</div><div class="t m5 x1f6 h32 y3b1c ff7 fs21 fc2 sc0 ls0 ws0">[<span class="ff6">valE</span>]<span class="_ _22"> </span><span class="ff12">←<span class="_ _25"> </span><span class="ff6">valA<span class="_ _5d"> </span>M</span></span></div><div class="t m5 x136 h33 y3b1d ff7 fs20 fc2 sc0 ls0 ws0">8</div><div class="t m5 x67 h32 y3b1c ff7 fs21 fc2 sc0 ls0 ws0">[<span class="ffd fs1e">112</span>]<span class="_ _22"> </span><span class="ff12">←</span></div><div class="t m5 x191 h2d y3b1e ffd fs1e fc2 sc0 ls0 ws0">128</div><div class="t m5 x28 h31 y3b1f ff7 fs21 fc2 sc0 ls0 ws0">Write<span class="_"> </span>back</div><div class="t m5 x28 h32 y3b20 ff7 fs21 fc2 sc0 ls0 ws0">PC<span class="_"> </span>update<span class="_ _45"> </span><span class="ff6">PC<span class="_ _25"> </span><span class="ff12">←<span class="_ _23"> </span></span>valP<span class="_ _158"> </span>PC<span class="_ _23"> </span><span class="ff12">←</span></span></div><div class="t m5 x185 h2d y3b21 ffd fs1e fc2 sc0 ls0 ws0">0x02a</div><div class="t m5 x57 h2b y3b22 ff7 fs1e fc2 sc0 ls0 ws0">As<span class="_ _15"> </span>this<span class="_ _15"> </span>trace<span class="_ _15"> </span>shows<span class="_ _0"></span>,<span class="_ _21"> </span>the<span class="_ _15"> </span>instruction<span class="_ _21"> </span>has<span class="_ _15"> </span>the<span class="_ _15"> </span>effect<span class="_ _21"> </span>of<span class="_ _15"> </span>writing<span class="_ _15"> </span>128<span class="_ _21"> </span>to<span class="_ _15"> </span>memory<span class="_ _15"> </span>address<span class="_ _15"> </span>112<span class="_ _21"> </span>and</div><div class="t m5 x28 h2b y3b23 ff7 fs1e fc2 sc0 ls0 ws0">incrementing<span class="_"> </span>the<span class="_"> </span>PC<span class="_"> </span>by<span class="_"> </span>10.</div><div class="t m5 x1d h26 y3b24 ff7 fs19 fc2 sc0 ls0 ws0">(and<span class="_"> </span>x86-64)<span class="_"> </span>convention<span class="_ _11"> </span>that<span class="_"> </span><span class="ffd">popq<span class="_ _11"> </span></span>should<span class="_"> </span>ﬁrst<span class="_"> </span>read<span class="_ _11"> </span>memory<span class="_"> </span>and<span class="_"> </span>then<span class="_ _11"> </span>increment</div><div class="t m5 x1d h26 y3b25 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>stack<span class="_"> </span>pointer.</div><div class="t m5 x1d h47 y3b26 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>4.14<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>522)</span></div><div class="t m5 x1d h26 y3b27 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>ill<span class="_ _11"> </span>in<span class="_ _11"> </span>the<span class="_ _11"> </span>right-hand<span class="_ _11"> </span>column<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_"> </span>following<span class="_ _11"> </span>table<span class="_ _11"> </span>to<span class="_ _11"> </span>describe<span class="_ _11"> </span>the<span class="_ _11"> </span>processing<span class="_ _11"> </span>of</div><div class="t m5 x1d h26 y3b28 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span><span class="ffd">popq<span class="_ _10"> </span></span>instruction<span class="_"> </span>on<span class="_"> </span>line<span class="_"> </span>7<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>object<span class="_"> </span>code<span class="_"> </span>in<span class="_"> </span>F<span class="_ _0"></span>igure<span class="_"> </span>4.17.</div><div class="t m5 x50 h31 y3b29 ff7 fs21 fc2 sc0 ls0 ws0">Generic<span class="_ _15a"> </span>Speciﬁc</div><div class="t m5 x1d h31 y3b2a ff7 fs21 fc2 sc0 ls0 ws0">Stage</div><div class="t m5 x50 h93 y3b2b ffd fs1e fc2 sc0 ls0 ws0">popq<span class="_ _11"> </span><span class="ff6 fs21">rA<span class="_ _99"> </span></span>popq<span class="_ _11"> </span>%rax</div><div class="t m5 x1d h32 y3b2c ff7 fs21 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>etch<span class="_ _55"> </span><span class="ff6">icode<span class="_ _a"> </span></span>:<span class="_ _be"></span><span class="ff6">ifun<span class="_ _23"> </span><span class="ff12">←<span class="_ _25"> </span></span>M</span></div><div class="t m5 x1b1 h33 y3b2d ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x119 h31 y3b2c ff7 fs21 fc2 sc0 ls0 ws0">[<span class="ff6">PC</span>]</div><div class="t m5 x50 h32 y3b2e ff6 fs21 fc2 sc0 ls0 ws0">rA<span class="_ _6"> </span><span class="ff7">:<span class="_ _be"></span></span>rB<span class="_ _25"> </span><span class="ff12">←<span class="_ _23"> </span></span>M</div><div class="t m5 x9e h33 y3b2f ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x68 h32 y3b30 ff7 fs21 fc2 sc0 ls0 ws0">[<span class="ff6">PC<span class="_ _13"> </span><span class="ff12">+<span class="_ _13"> </span></span></span>1]</div><div class="t m5 x50 h32 y3b31 ff6 fs21 fc2 sc0 ls0 ws0">valP<span class="_ _23"> </span><span class="ff12">←<span class="_ _25"> </span></span>PC<span class="_ _13"> </span><span class="ff12">+<span class="_ _13"> </span><span class="ff7">2</span></span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
