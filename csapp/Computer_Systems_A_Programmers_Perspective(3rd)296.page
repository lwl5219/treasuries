<div id="pf128" class="pf w2 h11" data-page-no="128"><div class="pc pc128 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg128.png"/><div class="t m5 xc0 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>3.8<span class="_ _60"> </span>Array<span class="_ _10"> </span>Allocation<span class="_ _10"> </span>and<span class="_ _10"> </span>Access<span class="_ _3e"> </span><span class="ffe fs1e">295</span></div><div class="t m5 x17 h2f ye7 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>3.36</div><div class="t m5 x17 h2f y58a ffe fs16 fc1 sc0 ls0 ws0">Elements<span class="_ _14"> </span>of<span class="_ _14"> </span>array<span class="_ _15"> </span>in</div><div class="t m5 x17 h2f y58b ffe fs16 fc1 sc0 ls0 ws0">row-major<span class="_"> </span>order<span class="_ _3"></span>.</div><div class="t m5 x157 h71 y2ad1 ff22 fs28 fc1 sc0 ls170 ws0">A[0][0]<span class="_ _16e"></span><span class="ls0">A[0]<span class="_ _9a"> </span><span class="ff1f">x</span></span></div><div class="t m5 x119 h7c y2ad2 ff22 fs44 fc1 sc0 ls0 ws0">A</div><div class="t m5 x116 h3f y2ad3 ff26 fs27 fc1 sc0 ls0 ws0">Element<span class="_ _11e"></span>Row<span class="_ _9a"> </span>Address</div><div class="t m5 x157 h71 y2ad4 ff22 fs28 fc1 sc0 ls170 ws0">A[0][1]<span class="_ _3b"> </span><span class="ff1f ls0">x</span></div><div class="t m5 x119 h7c y2ad5 ff22 fs44 fc1 sc0 ls0 ws0">A</div><div class="t m5 x121 h71 y2ad4 ff26 fs28 fc1 sc0 ls0 ws0"> + 4</div><div class="t m5 x157 h71 y2ad6 ff22 fs28 fc1 sc0 ls170 ws0">A[0][2]<span class="_ _3b"> </span><span class="ff1f ls0">x</span></div><div class="t m5 x119 h7c y2ad7 ff22 fs44 fc1 sc0 ls0 ws0">A</div><div class="t m5 x121 h71 y2ad6 ff26 fs28 fc1 sc0 ls0 ws0"> + 8</div><div class="t m5 x157 h71 y2ad8 ff22 fs28 fc1 sc0 ls170 ws0">A[1][0]<span class="_ _16e"></span><span class="ls0">A[1]<span class="_ _9a"> </span><span class="ff1f">x</span></span></div><div class="t m5 x119 h7c y2ad9 ff22 fs44 fc1 sc0 ls0 ws0">A</div><div class="t m5 x121 h71 y2ad8 ff26 fs28 fc1 sc0 ls0 ws0"> + 12</div><div class="t m5 x157 h71 y2ada ff22 fs28 fc1 sc0 ls170 ws0">A[1][1]<span class="_ _3b"> </span><span class="ff1f ls0">x</span></div><div class="t m5 x119 h7c y2adb ff22 fs44 fc1 sc0 ls0 ws0">A</div><div class="t m5 x121 h71 y2ada ff26 fs28 fc1 sc0 ls0 ws0"> + 16</div><div class="t m5 x157 h71 y2adc ff22 fs28 fc1 sc0 ls170 ws0">A[1][2]<span class="_ _3b"> </span><span class="ff1f ls0">x</span></div><div class="t m5 x119 h7c y2add ff22 fs44 fc1 sc0 ls0 ws0">A</div><div class="t m5 x121 h71 y2adc ff26 fs28 fc1 sc0 ls0 ws0"> + 20</div><div class="t m5 x157 h71 y2ade ff22 fs28 fc1 sc0 ls170 ws0">A[2][0]<span class="_ _16e"></span><span class="ls0">A[2]<span class="_ _9a"> </span><span class="ff1f">x</span></span></div><div class="t m5 x119 h7c y2adf ff22 fs44 fc1 sc0 ls0 ws0">A</div><div class="t m5 x121 h71 y2ade ff26 fs28 fc1 sc0 ls0 ws0"> + 24</div><div class="t m5 x157 h71 y2ae0 ff22 fs28 fc1 sc0 ls170 ws0">A[2][1]<span class="_ _3b"> </span><span class="ff1f ls0">x</span></div><div class="t m5 x119 h7c y2ae1 ff22 fs44 fc1 sc0 ls0 ws0">A</div><div class="t m5 x121 h71 y2ae0 ff26 fs28 fc1 sc0 ls0 ws0"> + 28</div><div class="t m5 x157 h71 y2ae2 ff22 fs28 fc1 sc0 ls170 ws0">A[2][2]<span class="_ _3b"> </span><span class="ff1f ls0">x</span></div><div class="t m5 x119 h7c y2ae3 ff22 fs44 fc1 sc0 ls0 ws0">A</div><div class="t m5 x121 h71 y2ae2 ff26 fs28 fc1 sc0 ls0 ws0"> + 32</div><div class="t m5 x157 h71 y2ae4 ff22 fs28 fc1 sc0 ls170 ws0">A[3][0]<span class="_ _16e"></span><span class="ls0">A[3]<span class="_ _9a"> </span><span class="ff1f">x</span></span></div><div class="t m5 x119 h7c y2ae5 ff22 fs44 fc1 sc0 ls0 ws0">A</div><div class="t m5 x121 h71 y2ae4 ff26 fs28 fc1 sc0 ls0 ws0"> + 36</div><div class="t m5 x157 h71 y2ae6 ff22 fs28 fc1 sc0 ls170 ws0">A[3][1]<span class="_ _3b"> </span><span class="ff1f ls0">x</span></div><div class="t m5 x119 h7c y2ae7 ff22 fs44 fc1 sc0 ls0 ws0">A</div><div class="t m5 x121 h71 y2ae6 ff26 fs28 fc1 sc0 ls0 ws0"> + 40</div><div class="t m5 x157 h71 y2ae8 ff22 fs28 fc1 sc0 ls170 ws0">A[4][2]<span class="_ _3b"> </span><span class="ff1f ls0">x</span></div><div class="t m5 x119 h7c y2ae9 ff22 fs44 fc1 sc0 ls0 ws0">A</div><div class="t m5 x121 h71 y2ae8 ff26 fs28 fc1 sc0 ls0 ws0"> + 44</div><div class="t m5 x157 h71 y2aea ff22 fs28 fc1 sc0 ls170 ws0">A[4][0]<span class="_ _16e"></span><span class="ls0">A[4]<span class="_ _9a"> </span><span class="ff1f">x</span></span></div><div class="t m5 x119 h7c y2aeb ff22 fs44 fc1 sc0 ls0 ws0">A</div><div class="t m5 x121 h71 y2aea ff26 fs28 fc1 sc0 ls0 ws0"> + 48</div><div class="t m5 x157 h71 y2aec ff22 fs28 fc1 sc0 ls170 ws0">A[4][1]<span class="_ _3b"> </span><span class="ff1f ls0">x</span></div><div class="t m5 x119 h7c y2aed ff22 fs44 fc1 sc0 ls0 ws0">A</div><div class="t m5 x121 h71 y2aec ff26 fs28 fc1 sc0 ls0 ws0"> + 52</div><div class="t m5 x157 h71 y2aee ff22 fs28 fc1 sc0 ls170 ws0">A[4][2]<span class="_ _3b"> </span><span class="ff1f ls0">x</span></div><div class="t m5 x119 h7c y2aef ff22 fs44 fc1 sc0 ls0 ws0">A</div><div class="t m5 x121 h71 y2aee ff26 fs28 fc1 sc0 ls0 ws0"> + 56</div><div class="t m5 x17 h46 y2af0 ff7 fs19 fc1 sc0 ls0 ws0">where<span class="_ _6"> </span><span class="ff11">L<span class="_ _6"> </span></span>is<span class="_ _6"> </span>the<span class="_ _6"> </span>size<span class="_ _13"> </span>of<span class="_ _a"> </span>data<span class="_ _6"> </span>type<span class="_ _6"> </span><span class="ff11">T<span class="_ _14"> </span></span>in<span class="_ _13"> </span>bytes<span class="_ _3"></span>.<span class="_ _6"> </span>As<span class="_ _6"> </span>an<span class="_ _6"> </span>example,<span class="_ _6"> </span>consider<span class="_ _6"> </span>the<span class="_ _6"> </span>5<span class="_ _13"> </span><span class="ff12">×<span class="_ _13"></span></span>3<span class="_ _a"></span>integer</div><div class="t m5 x17 h26 y2af1 ff7 fs19 fc1 sc0 ls0 ws0">array<span class="_"> </span><span class="ffd">A<span class="_ _13"> </span></span>deﬁned<span class="_"> </span>earlier.<span class="_"> </span>Suppose<span class="_ _13"> </span><span class="ff11">x</span></div><div class="t m5 xa5 h6e y2af2 ffd fs25 fc1 sc0 ls0 ws0">A</div><div class="t m5 x22 h26 y2af3 ff7 fs19 fc1 sc0 ls0 ws0">,<span class="_"> </span><span class="ff11">i<span class="_ _2"></span></span>,<span class="_"> </span>and<span class="_"> </span><span class="ff11">j<span class="_"> </span></span>are<span class="_"> </span>in<span class="_ _13"> </span>registers<span class="_"> </span><span class="ffd">%rdi</span>,<span class="_"> </span><span class="ffd">%rsi</span>,<span class="_"> </span>and<span class="_ _13"> </span><span class="ffd">%rdx</span>,</div><div class="t m5 x17 h26 y2af4 ff7 fs19 fc1 sc0 ls0 ws0">respectively<span class="_ _3"></span>.<span class="_ _11"> </span>Then<span class="_ _11"> </span>array<span class="_ _16"> </span>element<span class="_ _11"> </span><span class="ffd">A[i][j]<span class="_ _16"> </span></span>can<span class="_ _16"> </span>be<span class="_ _11"> </span>copied<span class="_ _16"> </span>to<span class="_ _16"> </span>register<span class="_ _11"> </span><span class="ffd">%eax<span class="_ _16"> </span></span>by<span class="_ _16"> </span>the</div><div class="t m5 x17 h26 y2af5 ff7 fs19 fc1 sc0 ls0 ws0">following<span class="_"> </span>code:</div><div class="t m5 x2e h61 y2af6 ff13 fs35 fc6 sc0 ls0 ws0">A<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi,<span class="_ _f"> </span>i<span class="_ _e"> </span>in<span class="_ _21"> </span>%rsi,<span class="_ _f"> </span>and<span class="_ _e"> </span>j<span class="_ _21"> </span>in<span class="_ _f"> </span>%rdx</div><div class="t m5 x2c h2d y2af7 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _45"> </span><span class="ffd fs1e fc2">leaq<span class="_ _46"> </span>(%rsi,%rsi,2),<span class="_ _e"> </span>%rax<span class="_ _93"> </span></span><span class="ff13 fs35">Compute<span class="_ _e"> </span><span class="ff7">3<span class="_ _1"></span><span class="ff11">i</span></span></span></div><div class="t m5 x2c h2d y2af8 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">leaq<span class="_ _46"> </span>(%rdi,%rax,4),<span class="_ _e"> </span>%rax<span class="_ _93"> </span></span><span class="ff13 fs35">Compute<span class="_ _e"> </span><span class="ff11">x</span></span></div><div class="t m5 x40 h7d y2af9 ffd fs45 fc6 sc0 ls0 ws0">A</div><div class="t m5 x19d h7e y2af8 ff12 fs35 fc6 sc0 ls0 ws0">+<span class="_ _13"> </span><span class="ff7">12<span class="ff11">i</span></span></div><div class="t m5 x2c h2e y2afa ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 xd1 h2d y2afb ffd fs1e fc2 sc0 ls0 ws0">movl<span class="_ _46"> </span>(%rax,%rdx,4),<span class="_ _e"> </span>%eax<span class="_ _93"> </span><span class="ff13 fs35 fc6">Read<span class="_ _e"> </span>from<span class="_ _21"> </span><span class="ff6">M<span class="_ _1"></span><span class="ff7">[<span class="ff11">x</span></span></span></span></div><div class="t m5 x51 h7d y2afc ffd fs45 fc6 sc0 ls0 ws0">A</div><div class="t m5 x41 h7e y2afb ff12 fs35 fc6 sc0 ls0 ws0">+<span class="_ _13"> </span><span class="ff7">12<span class="ff11">i<span class="_ _13"> </span></span></span>+<span class="_ _13"> </span><span class="ff7">4]</span></div><div class="t m5 x17 h26 y2afd ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_ _13"> </span>can<span class="_"> </span>be<span class="_ _13"> </span>seen,<span class="_"> </span>this<span class="_ _13"> </span>code<span class="_"> </span>computes<span class="_ _13"> </span>the<span class="_"> </span>element’<span class="_ _0"></span>s<span class="_ _13"> </span>address<span class="_"> </span>as<span class="_ _13"> </span><span class="ff11">x</span></div><div class="t m5 x1a3 h6e y2afe ffd fs25 fc2 sc0 ls0 ws0">A</div><div class="t m5 x93 h46 y2aff ff12 fs19 fc2 sc0 ls0 ws0">+<span class="_ _13"></span><span class="ff7">12<span class="ff11">i<span class="_ _11"> </span></span></span>+<span class="_ _10"> </span><span class="ff7">4<span class="ff11">j<span class="_"> </span></span></span>=<span class="_ _13"></span><span class="ff11">x</span></div><div class="t m5 x11d h6e y2afe ffd fs25 fc2 sc0 ls0 ws0">A</div><div class="t m5 x4e h46 y2aff ff12 fs19 fc2 sc0 ls0 ws0">+</div><div class="t m5 x17 h46 y2b00 ff7 fs19 fc2 sc0 ls0 ws0">4<span class="ff11">(</span>3<span class="ff11">i<span class="_ _10"> </span><span class="ff12">+<span class="_ _10"> </span></span><span class="ls174">j)<span class="_ _a"> </span></span></span>using<span class="_"> </span>the<span class="_"> </span>scaling<span class="_"> </span>and<span class="_"> </span>addition<span class="_"> </span>capabilities<span class="_"> </span>of<span class="_"> </span>x86-64<span class="_"> </span>address<span class="_"> </span>arithmetic.</div><div class="t m5 x17 h47 y2b01 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>3.38<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>377)</span></div><div class="t m5 x17 h26 y2b02 ff7 fs19 fc1 sc0 ls0 ws0">Consider<span class="_"> </span>the<span class="_"> </span>following<span class="_ _11"> </span>source<span class="_"> </span>code,<span class="_"> </span>where<span class="_"> </span><span class="ff11">M<span class="_"> </span></span>and<span class="_"> </span><span class="ff11">N<span class="_ _15"> </span></span>are<span class="_"> </span>constants<span class="_ _11"> </span>declared<span class="_"> </span>with</div><div class="t m5 x17 h26 y2b03 ffd fs19 fc1 sc0 ls0 ws0">#define<span class="ff7">:</span></div><div class="t m5 x17 h2d y2b04 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>P[M][N];</div><div class="t m5 x17 h2d y2b05 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>Q[N][M];</div><div class="t m5 x17 h2d y2b06 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>sum_element(long<span class="_ _1f"> </span>i,<span class="_ _1f"> </span>long<span class="_ _e"> </span>j)<span class="_ _1f"> </span>{</div><div class="t m5 x1b6 h2d y2b07 ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>P[i][j]<span class="_ _1f"> </span>+<span class="_ _1f"> </span>Q[j][i];</div><div class="t m5 x17 h2d y2b08 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x17 h26 y1152 ff7 fs19 fc2 sc0 ls0 ws0">In<span class="_"> </span>compiling<span class="_"> </span>this<span class="_"> </span>program,<span class="_"> </span><span class="ff9">gcc<span class="_ _10"> </span></span>generates<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>assembly<span class="_"> </span>code:</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
