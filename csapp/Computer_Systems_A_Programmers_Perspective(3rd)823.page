<div id="pf337" class="pf w2 h11" data-page-no="337"><div class="pc pc337 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg337.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">822<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>8<span class="_ _3d"> </span>Exceptional<span class="_ _10"> </span>Control<span class="_ _10"> </span>Flow</span></div><div class="t m5 x28 h2a y257 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">Software<span class="_ _11"> </span>exceptions<span class="_ _11"> </span>in<span class="_ _11"> </span>C++<span class="_ _16"> </span>and<span class="_ _11"> </span>Java</span></div><div class="t m5 x28 h2b y2d0 ff7 fs1e fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>exception<span class="_ _13"> </span>mechanisms<span class="_ _13"> </span>provided<span class="_ _13"> </span>by<span class="_ _13"> </span>C++<span class="_ _13"> </span>and<span class="_ _13"> </span>J<span class="_ _3"></span>ava<span class="_ _13"> </span>are<span class="_ _13"> </span>higher<span class="_ _1"></span>-level,<span class="_ _13"> </span>more<span class="_ _13"> </span>structured<span class="_ _13"> </span>versions<span class="_ _13"> </span>of<span class="_ _13"> </span>the</div><div class="t m5 x28 h2b y2d1 ff7 fs1e fc2 sc0 ls0 ws0">C<span class="_"> </span><span class="ffd">setjmp<span class="_ _13"> </span></span>and<span class="_ _13"> </span><span class="ffd">longjmp<span class="_ _10"> </span></span>functions<span class="_ _3"></span>.<span class="_"> </span>Y<span class="_ _3"></span>ou<span class="_"> </span>can<span class="_ _13"> </span>think<span class="_ _13"> </span>of<span class="_"> </span>a<span class="_ _13"> </span><span class="ffd">catch<span class="_ _13"> </span></span>clause<span class="_"> </span>inside<span class="_"> </span>a<span class="_ _13"> </span><span class="ffd">try<span class="_ _13"> </span></span>statement<span class="_"> </span>as<span class="_ _13"> </span>being<span class="_"> </span>akin</div><div class="t m5 x28 h2b y2d2 ff7 fs1e fc2 sc0 ls0 ws0">to<span class="_"> </span>a<span class="_"> </span><span class="ffd">setjmp<span class="_ _10"> </span></span>function.<span class="_"> </span>Similarly<span class="_ _3"></span>,<span class="_"> </span>a<span class="_"> </span><span class="ffd">throw<span class="_ _10"> </span></span>statement<span class="_"> </span>is<span class="_"> </span>similar<span class="_"> </span>to<span class="_"> </span>a<span class="_"> </span><span class="ffd">longjmp<span class="_ _13"> </span></span>function.</div><div class="t m5 x1d h88 y6a59 ffd fs4e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13 fs1f">./restart</span></div><div class="t m5 x1d h88 y6a5a ffd fs4e fc2 sc0 ls0 ws0">starting</div><div class="t m5 x1d h88 y6a5b ffd fs4e fc2 sc0 ls0 ws0">processing...</div><div class="t m5 x1d h88 y6a5c ffd fs4e fc2 sc0 ls0 ws0">processing...</div><div class="t m5 x1d h75 y6a5d ff13 fs1f fc2 sc0 ls0 ws0">Ctrl+C</div><div class="t m5 x1d h88 y6a5e ffd fs4e fc2 sc0 ls0 ws0">restarting</div><div class="t m5 x1d h88 y6a5f ffd fs4e fc2 sc0 ls0 ws0">processing...</div><div class="t m5 x1d h75 y6a60 ff13 fs1f fc2 sc0 ls0 ws0">Ctrl+C</div><div class="t m5 x1d h88 y6a61 ffd fs4e fc2 sc0 ls0 ws0">restarting</div><div class="t m5 x1d h88 y6a62 ffd fs4e fc2 sc0 ls0 ws0">processing...</div><div class="t m5 x29 h26 y6a63 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>here<span class="_ _13"> </span>a<span class="_ _13"> </span>couple<span class="_ _13"> </span>of<span class="_ _13"> </span>interesting<span class="_ _13"> </span>things<span class="_ _13"> </span>about<span class="_"> </span>this<span class="_ _13"> </span>program.<span class="_ _13"> </span>F<span class="_ _1"></span>irst,<span class="_ _13"> </span>T<span class="_ _3"></span>o<span class="_ _13"> </span>avoid<span class="_ _13"> </span>a<span class="_ _13"> </span>race<span class="_ _1"></span>,</div><div class="t m5 x1d h26 y6a64 ff7 fs19 fc2 sc0 ls0 ws0">we<span class="_ _15"> </span>must<span class="_ _15"> </span>install<span class="_ _15"> </span>the<span class="_ _14"> </span>handler<span class="_ _15"> </span><span class="ffa">after<span class="_ _f"> </span></span>we<span class="_ _15"> </span>call<span class="_ _15"> </span><span class="ffd">sigsetjmp</span>.<span class="_ _15"> </span>If<span class="_ _15"> </span>not,<span class="_ _21"> </span>we<span class="_ _15"> </span>would<span class="_ _15"> </span>run<span class="_ _15"> </span>the</div><div class="t m5 x1d h26 y6a65 ff7 fs19 fc2 sc0 ls0 ws0">risk<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>handler<span class="_ _13"> </span>running<span class="_"> </span>before<span class="_"> </span>the<span class="_"> </span>initial<span class="_"> </span>call<span class="_"> </span>to<span class="_"> </span><span class="ffd">sigsetjmp<span class="_ _13"> </span></span>sets<span class="_"> </span>up<span class="_"> </span>the<span class="_"> </span>calling</div><div class="t m5 x1d h26 y6a66 ff7 fs19 fc2 sc0 ls0 ws0">environment<span class="_ _13"> </span>for<span class="_ _6"> </span><span class="ffd">siglongjmp</span>.<span class="_ _13"> </span>Second,<span class="_ _13"> </span>you<span class="_ _6"> </span>might<span class="_ _13"> </span>have<span class="_ _13"> </span>noticed<span class="_ _6"> </span>that<span class="_ _13"> </span>the<span class="_ _6"> </span><span class="ffd">sigsetjmp</span></div><div class="t m5 x1d h26 y6a67 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_ _15"> </span><span class="ffd">siglongjmp<span class="_ _21"> </span></span>functions<span class="_ _21"> </span>are<span class="_ _15"> </span>not<span class="_ _21"> </span>on<span class="_ _21"> </span>the<span class="_ _21"> </span>list<span class="_ _15"> </span>of<span class="_ _21"> </span>async-signal-safe<span class="_ _21"> </span>functions<span class="_ _21"> </span>in</div><div class="t m5 x1d h26 y6a68 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _15"> </span>8.33.<span class="_ _15"> </span>T<span class="_ _0"></span>he<span class="_ _15"> </span>reason<span class="_ _15"> </span>is<span class="_ _14"> </span>that<span class="_ _15"> </span>in<span class="_ _15"> </span>general<span class="_ _15"> </span><span class="ffd">siglongjmp<span class="_ _15"> </span></span>can<span class="_ _15"> </span>jump<span class="_ _15"> </span>into<span class="_ _15"> </span>arbitrary</div><div class="t m5 x1d h26 y6a69 ff7 fs19 fc2 sc0 ls0 ws0">code<span class="_ _1"></span>,<span class="_"> </span>so<span class="_"> </span>we<span class="_ _13"> </span>must<span class="_"> </span>be<span class="_ _13"> </span>careful<span class="_"> </span>to<span class="_ _13"> </span>call<span class="_"> </span>only<span class="_ _13"> </span>safe<span class="_"> </span>functions<span class="_ _13"> </span>in<span class="_"> </span>any<span class="_"> </span>code<span class="_ _13"> </span>reachable<span class="_"> </span>from</div><div class="t m5 x1d h26 y6a6a ff7 fs19 fc2 sc0 ls0 ws0">a<span class="_ _16"> </span><span class="ffd">siglongjmp</span>.<span class="_ _14"> </span>In<span class="_ _16"> </span>our<span class="_ _14"> </span>example<span class="_ _0"></span>,<span class="_ _14"> </span>we<span class="_ _16"> </span>call<span class="_ _14"> </span>the<span class="_ _14"> </span>safe<span class="_ _16"> </span><span class="ffd">sio_puts<span class="_ _14"> </span></span>and<span class="_ _16"> </span><span class="ffd">sleep<span class="_ _14"> </span></span>functions<span class="_ _1"></span>.</div><div class="t m5 x1d h26 y6a6b ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>unsafe<span class="_"> </span><span class="ffd">exit<span class="_ _10"> </span></span>function<span class="_"> </span>is<span class="_"> </span>unreachable.</div><div class="t m5 x1d h3b y6a6c fff fs24 fc6 sc0 ls0 ws0">8.7<span class="_ _17"> </span><span class="ffe fs18">T<span class="_ _1"></span>ools<span class="_"> </span>for<span class="_"> </span>Manipulating<span class="_"> </span>Processes</span></div><div class="t m5 x1d h26 y6a6d ff7 fs19 fc1 sc0 ls0 ws0">Linux<span class="_"> </span>systems<span class="_"> </span>provide<span class="_ _13"> </span>a<span class="_"> </span>number<span class="_"> </span>of<span class="_"> </span>useful<span class="_ _13"> </span>tools<span class="_"> </span>for<span class="_"> </span>monitoring<span class="_"> </span>and<span class="_ _13"> </span>manipulating</div><div class="t m5 x1d h26 y6a6e ff7 fs19 fc1 sc0 ls0 ws0">processes:</div><div class="t m5 x75 h26 y6a6f ff9 fs19 fc1 sc0 ls0 ws0">strace<span class="ff7">.<span class="_ _e"> </span>Prints<span class="_ _16"> </span>a<span class="_ _16"> </span>trace<span class="_ _16"> </span>of<span class="_ _16"> </span>each<span class="_ _16"> </span>system<span class="_ _16"> </span>call<span class="_ _16"> </span>invoked<span class="_ _16"> </span>by<span class="_ _16"> </span>a<span class="_ _16"> </span>running<span class="_ _16"> </span>program<span class="_ _16"> </span>and</span></div><div class="t m5 xcd h26 y6a70 ff7 fs19 fc1 sc0 ls0 ws0">its<span class="_"> </span>children.<span class="_"> </span>It<span class="_"> </span>is<span class="_ _11"> </span>a<span class="_"> </span>fascinating<span class="_"> </span>tool<span class="_"> </span>for<span class="_ _11"> </span>the<span class="_"> </span>curious<span class="_"> </span>student.<span class="_"> </span>Compile<span class="_ _11"> </span>your</div><div class="t m5 xcd h26 y6a71 ff7 fs19 fc1 sc0 ls0 ws0">program<span class="_ _6"> </span>with<span class="_ _6"> </span><span class="ffd">-static<span class="_ _6"> </span></span>to<span class="_ _6"> </span>get<span class="_ _6"> </span>a<span class="_ _13"> </span>cleaner<span class="_ _a"> </span>trace<span class="_ _6"> </span>without<span class="_ _6"> </span>a<span class="_ _6"> </span>lot<span class="_ _13"> </span>of<span class="_ _a"> </span>output<span class="_ _6"> </span>related</div><div class="t m5 xcd h26 y6a72 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_"> </span>shared<span class="_"> </span>libraries<span class="_ _1"></span>.</div><div class="t m5 x75 h26 y6a73 ff9 fs19 fc1 sc0 ls0 ws0">ps<span class="ff7">.<span class="_ _e"> </span>Lists<span class="_"> </span>processes<span class="_"> </span>(including<span class="_"> </span>zombies)<span class="_"> </span>currently<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>system.</span></div><div class="t m5 x75 h26 y6a74 ff9 fs19 fc1 sc0 ls0 ws0">top<span class="ff7">.<span class="_ _e"> </span>Prints<span class="_"> </span>information<span class="_"> </span>about<span class="_"> </span>the<span class="_"> </span>resource<span class="_"> </span>usage<span class="_"> </span>of<span class="_"> </span>current<span class="_"> </span>processes<span class="_ _0"></span>.</span></div><div class="t m5 x75 h26 y6a75 ff9 fs19 fc1 sc0 ls0 ws0">pmap<span class="ff7">.<span class="_ _e"> </span>Displays<span class="_"> </span>the<span class="_"> </span>memory<span class="_"> </span>map<span class="_"> </span>of<span class="_"> </span>a<span class="_"> </span>process<span class="_ _0"></span>.</span></div><div class="t m5 x75 h26 y6a76 ffd fs19 fc1 sc0 ls0 ws0">/proc<span class="ff7">.<span class="_ _e"> </span>A<span class="_ _11"> </span>virtual<span class="_"> </span>ﬁlesystem<span class="_"> </span>that<span class="_ _11"> </span>exports<span class="_"> </span>the<span class="_"> </span>contents<span class="_ _11"> </span>of<span class="_"> </span>numerous<span class="_"> </span>kernel<span class="_ _11"> </span>data</span></div><div class="t m5 xcd h26 y6a77 ff7 fs19 fc1 sc0 ls0 ws0">structures<span class="_"> </span>in<span class="_ _11"> </span>an<span class="_"> </span>ASCII<span class="_ _11"> </span>text<span class="_"> </span>form<span class="_ _11"> </span>that<span class="_ _11"> </span>can<span class="_"> </span>be<span class="_ _11"> </span>read<span class="_"> </span>by<span class="_ _11"> </span>user<span class="_"> </span>programs<span class="_ _1"></span>.<span class="_ _11"> </span>F<span class="_ _1"></span>or</div><div class="t m5 xcd h26 y6a78 ff7 fs19 fc1 sc0 ls0 ws0">example<span class="_ _1"></span>,<span class="_ _f"> </span>type<span class="_ _21"> </span><span class="ffd">cat<span class="_ _16"> </span>/proc/loadavg<span class="_ _15"> </span></span>to<span class="_ _15"> </span>see<span class="_ _15"> </span>the<span class="_ _21"> </span>current<span class="_ _15"> </span>load<span class="_ _21"> </span>average<span class="_ _15"> </span>on</div><div class="t m5 xcd h26 y6a79 ff7 fs19 fc1 sc0 ls0 ws0">your<span class="_"> </span>Linux<span class="_"> </span>system.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
