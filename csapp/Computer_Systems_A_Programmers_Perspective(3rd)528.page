<div id="pf210" class="pf w2 h11" data-page-no="210"><div class="pc pc210 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg210.png"/><div class="t m5 x107 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Solutions<span class="_ _10"> </span>to<span class="_ _10"> </span>Practice<span class="_ _10"> </span>Problems<span class="_ _1b"> </span><span class="ffe fs1e">527</span></div><div class="t m5 x17 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_ _16"> </span>the<span class="_ _16"> </span><span class="ffd">rrmovq<span class="_ _11"> </span></span>instruction.<span class="_ _16"> </span>T<span class="_ _0"></span>his<span class="_ _16"> </span>would<span class="_ _16"> </span>not<span class="_ _11"> </span>be<span class="_ _16"> </span>consistent<span class="_ _16"> </span>with<span class="_ _16"> </span>the<span class="_ _16"> </span>convention<span class="_ _16"> </span>for</div><div class="t m5 x17 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">handling<span class="_"> </span><span class="ffd">popq<span class="_ _10"> </span>%rsp<span class="_ _10"> </span></span>determined<span class="_"> </span>in<span class="_"> </span>Practice<span class="_"> </span>Problem<span class="_"> </span>4.8.</div><div class="t m5 x17 h28 y4917 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>4.33<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>488)</span></div><div class="t m5 x17 h26 y4918 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _13"> </span>problem<span class="_ _13"> </span>lets<span class="_ _13"> </span>you<span class="_ _13"> </span>experience<span class="_ _6"> </span>one<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>important<span class="_ _13"> </span>tasks<span class="_ _6"> </span>in<span class="_ _13"> </span>processor<span class="_ _13"> </span>design—</div><div class="t m5 x17 h26 y4919 ff7 fs19 fc1 sc0 ls0 ws0">devising<span class="_ _11"> </span>test<span class="_ _11"> </span>programs<span class="_ _11"> </span>for<span class="_ _11"> </span>a<span class="_ _11"> </span>new<span class="_ _11"> </span>processor.<span class="_ _11"> </span>In<span class="_ _11"> </span>general,<span class="_ _11"> </span>we<span class="_ _16"> </span>should<span class="_"> </span>have<span class="_ _11"> </span>test<span class="_ _11"> </span>pro-</div><div class="t m5 x17 h26 y491a ff7 fs19 fc1 sc0 ls0 ws0">grams<span class="_ _11"> </span>that<span class="_ _11"> </span>will<span class="_ _11"> </span>exercise<span class="_ _11"> </span>all<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>different<span class="_ _11"> </span>hazard<span class="_ _11"> </span>possibilities<span class="_ _16"> </span>and<span class="_"> </span>will<span class="_ _11"> </span>generate</div><div class="t m5 x17 h26 y491b ff7 fs19 fc1 sc0 ls0 ws0">incorrect<span class="_"> </span>results<span class="_"> </span>if<span class="_"> </span>some<span class="_"> </span>dependency<span class="_"> </span>is<span class="_"> </span>not<span class="_"> </span>handled<span class="_"> </span>properly<span class="_ _7"></span>.</div><div class="t m5 x26 h26 y491c ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _13"> </span>this<span class="_ _13"> </span>example<span class="_ _1"></span>,<span class="_ _13"> </span>we<span class="_ _13"> </span>can<span class="_ _13"> </span>use<span class="_ _13"> </span>a<span class="_ _6"> </span>slightly<span class="_ _13"> </span>modiﬁed<span class="_ _13"> </span>version<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>program<span class="_ _6"> </span>shown</div><div class="t m5 x17 h26 y491d ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_"> </span>Practice<span class="_"> </span>Problem<span class="_"> </span>4.32:</div><div class="t m5 x2c h2d y491e ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _20"> </span><span class="ffd fs1e fc2">irmovq<span class="_ _e"> </span>$5,<span class="_ _1f"> </span>%rdx</span></div><div class="t m5 x2c h2d y491f ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _20"> </span><span class="ffd fs1e fc2">irmovq<span class="_ _e"> </span>$0x100,%rsp</span></div><div class="t m5 x2c h2d y4920 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2">rmmovq<span class="_ _e"> </span>%rdx,0(%rsp)</span></div><div class="t m5 x2c h2d y4921 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2">popq<span class="_ _e"> </span>%rsp</span></div><div class="t m5 x2c h2d y4922 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _20"> </span><span class="ffd fs1e fc2">nop</span></div><div class="t m5 x2c h2e y4923 ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 x142 h2d y4924 ffd fs1e fc2 sc0 ls0 ws0">nop</div><div class="t m5 x2c h2d y4925 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _20"> </span><span class="ffd fs1e fc2">rrmovq<span class="_ _e"> </span>%rsp,%rax</span></div><div class="t m5 x26 h26 y4926 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _13"> </span>two<span class="_ _6"> </span><span class="ffd">nop<span class="_ _6"> </span></span>instructions<span class="_ _13"> </span>will<span class="_ _6"> </span>cause<span class="_ _13"> </span>the<span class="_ _a"> </span><span class="ffd">popq<span class="_ _13"> </span></span>instruction<span class="_ _6"> </span>to<span class="_ _13"> </span>be<span class="_ _6"> </span>in<span class="_ _6"> </span>the<span class="_ _13"> </span>write-back</div><div class="t m5 x17 h26 y4927 ff7 fs19 fc2 sc0 ls0 ws0">stage<span class="_ _16"> </span>when<span class="_ _16"> </span>the<span class="_ _16"> </span><span class="ffd">rrmovq<span class="_ _16"> </span></span>instruction<span class="_ _16"> </span>is<span class="_ _16"> </span>in<span class="_ _16"> </span>the<span class="_ _16"> </span>decode<span class="_ _16"> </span>stage<span class="_ _1"></span>.<span class="_ _16"> </span>If<span class="_ _16"> </span>the<span class="_ _16"> </span>two<span class="_ _16"> </span>forwarding</div><div class="t m5 x17 h26 y4928 ff7 fs19 fc2 sc0 ls0 ws0">sources<span class="_ _16"> </span>in<span class="_ _16"> </span>the<span class="_ _14"> </span>write-back<span class="_ _16"> </span>stage<span class="_ _16"> </span>are<span class="_ _14"> </span>given<span class="_ _16"> </span>the<span class="_ _14"> </span>wrong<span class="_ _16"> </span>priority<span class="_ _3"></span>,<span class="_ _14"> </span>then<span class="_ _16"> </span>register<span class="_ _16"> </span><span class="ffd">%rax</span></div><div class="t m5 x17 h26 y4929 ff7 fs19 fc2 sc0 ls0 ws0">will<span class="_ _11"> </span>be<span class="_ _16"> </span>set<span class="_ _11"> </span>to<span class="_ _11"> </span>the<span class="_ _16"> </span>incremented<span class="_ _11"> </span>program<span class="_ _16"> </span>counter<span class="_ _11"> </span>rather<span class="_ _11"> </span>than<span class="_ _16"> </span>the<span class="_ _11"> </span>value<span class="_ _16"> </span>read<span class="_ _11"> </span>from</div><div class="t m5 x17 h26 y492a ff7 fs19 fc2 sc0 ls0 ws0">memory<span class="_ _3"></span>.</div><div class="t m5 x17 h28 y492b ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>4.34<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>489)</span></div><div class="t m5 x17 h26 y492c ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>logic<span class="_"> </span>only<span class="_"> </span>needs<span class="_"> </span>to<span class="_"> </span>check<span class="_"> </span>the<span class="_"> </span>ﬁve<span class="_"> </span>forwarding<span class="_"> </span>sources:</div><div class="t m5 x17 h2d y492d ffd fs1e fc2 sc0 ls0 ws0">word<span class="_ _e"> </span>d_valB<span class="_ _1f"> </span>=<span class="_ _1f"> </span>[</div><div class="t m5 x21e h2d y492e ffd fs1e fc2 sc0 ls0 ws0">d_srcB<span class="_ _e"> </span>==<span class="_ _1f"> </span>e_dstE<span class="_ _1f"> </span>:<span class="_ _e"> </span>e_valE;<span class="_ _46"> </span>#<span class="_ _1f"> </span>Forward<span class="_ _e"> </span>valE<span class="_ _1f"> </span>from<span class="_ _1f"> </span>execute</div><div class="t m5 x21e h2d y492f ffd fs1e fc2 sc0 ls0 ws0">d_srcB<span class="_ _e"> </span>==<span class="_ _1f"> </span>M_dstM<span class="_ _1f"> </span>:<span class="_ _e"> </span>m_valM;<span class="_ _46"> </span>#<span class="_ _1f"> </span>Forward<span class="_ _e"> </span>valM<span class="_ _1f"> </span>from<span class="_ _1f"> </span>memory</div><div class="t m5 x21e h2d y4930 ffd fs1e fc2 sc0 ls0 ws0">d_srcB<span class="_ _e"> </span>==<span class="_ _1f"> </span>M_dstE<span class="_ _1f"> </span>:<span class="_ _e"> </span>M_valE;<span class="_ _46"> </span>#<span class="_ _1f"> </span>Forward<span class="_ _e"> </span>valE<span class="_ _1f"> </span>from<span class="_ _1f"> </span>memory</div><div class="t m5 x21e h2d y4931 ffd fs1e fc2 sc0 ls0 ws0">d_srcB<span class="_ _e"> </span>==<span class="_ _1f"> </span>W_dstM<span class="_ _1f"> </span>:<span class="_ _e"> </span>W_valM;<span class="_ _46"> </span>#<span class="_ _1f"> </span>Forward<span class="_ _e"> </span>valM<span class="_ _1f"> </span>from<span class="_ _1f"> </span>write<span class="_ _e"> </span>back</div><div class="t m5 x21e h2d y4932 ffd fs1e fc2 sc0 ls0 ws0">d_srcB<span class="_ _e"> </span>==<span class="_ _1f"> </span>W_dstE<span class="_ _1f"> </span>:<span class="_ _e"> </span>W_valE;<span class="_ _46"> </span>#<span class="_ _1f"> </span>Forward<span class="_ _e"> </span>valE<span class="_ _1f"> </span>from<span class="_ _1f"> </span>write<span class="_ _e"> </span>back</div><div class="t m5 x21e h2d y4933 ffd fs1e fc2 sc0 ls0 ws0">1<span class="_ _e"> </span>:<span class="_ _1f"> </span>d_rvalB;<span class="_ _1a"> </span>#<span class="_ _1f"> </span>Use<span class="_ _e"> </span>value<span class="_ _1f"> </span>read<span class="_ _e"> </span>from<span class="_ _1f"> </span>register<span class="_ _1f"> </span>file</div><div class="t m5 x17 h2d y4934 ffd fs1e fc2 sc0 ls0 ws0">];</div><div class="t m5 x17 h28 y4935 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>4.35</div><div class="t m5 x112 h2f y4936 ffe fs16 fc6 sc0 ls0 ws0">(page<span class="_"> </span>490)</div><div class="t m5 x17 h26 y4937 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _16"> </span>change<span class="_ _11"> </span>would<span class="_ _11"> </span>not<span class="_ _16"> </span>handle<span class="_ _11"> </span>the<span class="_ _11"> </span>case<span class="_ _16"> </span>where<span class="_ _11"> </span>a<span class="_ _11"> </span>conditional<span class="_ _16"> </span>move<span class="_ _11"> </span>fails<span class="_ _16"> </span>to<span class="_ _11"> </span>satisfy</div><div class="t m5 x17 h26 y4938 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _6"> </span>condition,<span class="_ _13"> </span>and<span class="_ _13"> </span>therefore<span class="_ _6"> </span>sets<span class="_ _13"> </span>the<span class="_ _6"> </span><span class="ff6">dstE<span class="_ _13"> </span></span>value<span class="_ _6"> </span>to<span class="_ _6"> </span><span class="ffd">RNONE</span>.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span>resulting<span class="_ _6"> </span>value<span class="_ _13"> </span>could</div><div class="t m5 x17 h26 y4939 ff7 fs19 fc1 sc0 ls0 ws0">get<span class="_ _11"> </span>forwarded<span class="_ _11"> </span>to<span class="_ _11"> </span>the<span class="_ _11"> </span>next<span class="_ _11"> </span>instruction,<span class="_ _16"> </span>even<span class="_ _11"> </span>though<span class="_ _11"> </span>the<span class="_ _11"> </span>conditional<span class="_ _11"> </span>transfer<span class="_ _11"> </span>does</div><div class="t m5 x17 h26 y493a ff7 fs19 fc1 sc0 ls0 ws0">not<span class="_"> </span>occur.</div><div class="t m5 x2c h2e y493b ff6 fs20 fc6 sc0 ls0 ws0">1</div><div class="t m5 xc5 h2d y464c ffd fs1e fc2 sc0 ls0 ws0">irmovq<span class="_ _e"> </span>$0x123,%rax</div><div class="t m5 x2c h2d y2fb5 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _70"> </span><span class="ffd fs1e fc2">irmovq<span class="_ _e"> </span>$0x321,%rdx</span></div><div class="t m5 x2c h2d y1a57 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _70"> </span><span class="ffd fs1e fc2">xorq<span class="_ _e"> </span>%rcx,%rcx<span class="_ _86"> </span>#<span class="_ _1f"> </span>CC<span class="_ _1f"> </span>=<span class="_ _e"> </span>100</span></div><div class="t m5 x2c h2d y345b ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _70"> </span><span class="ffd fs1e fc2">cmovne<span class="_ _1a"> </span>%rax,%rdx<span class="_ _6f"> </span>#<span class="_ _e"> </span>Not<span class="_ _1f"> </span>transferred</span></div><div class="t m5 x2c h2d y493c ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _70"> </span><span class="ffd fs1e fc2">addq<span class="_ _e"> </span>%rdx,%rdx<span class="_ _86"> </span>#<span class="_ _1f"> </span>Should<span class="_ _1f"> </span>be<span class="_ _e"> </span>0x642</span></div><div class="t m5 x2c h2d y493d ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _70"> </span><span class="ffd fs1e fc2">halt</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
