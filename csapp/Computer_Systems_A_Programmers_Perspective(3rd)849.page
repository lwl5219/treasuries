<div id="pf351" class="pf w2 h11" data-page-no="351"><div class="pc pc351 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg351.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">848<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>9<span class="_ _3d"> </span>Virtual<span class="_ _10"> </span>Memory</span></div><div class="t m5 x29 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">grows<span class="_ _6"> </span>downward.<span class="_ _6"> </span>Such<span class="_ _6"> </span>uniformity<span class="_ _6"> </span>greatly<span class="_ _13"> </span>simpliﬁes<span class="_ _a"> </span>the<span class="_ _6"> </span>design<span class="_ _13"> </span>and<span class="_ _a"> </span>implemen-</div><div class="t m5 x29 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">tation<span class="_ _11"> </span>of<span class="_ _16"> </span>linkers<span class="_ _1"></span>,<span class="_ _16"> </span>allowing<span class="_ _11"> </span>them<span class="_ _11"> </span>to<span class="_ _16"> </span>produce<span class="_ _11"> </span>fully<span class="_ _16"> </span>linked<span class="_ _11"> </span>executables<span class="_ _16"> </span>that<span class="_ _11"> </span>are</div><div class="t m5 x29 h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">independent<span class="_ _13"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>ultimate<span class="_ _13"> </span>location<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>code<span class="_ _13"> </span>and<span class="_ _6"> </span>data<span class="_ _13"> </span>in<span class="_ _13"> </span>physical<span class="_ _6"> </span>memory<span class="_ _3"></span>.</div><div class="t m5 x75 h3d y780 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y781 ffa fs19 fc1 sc0 ls0 ws0">Simplifying<span class="_ _14"> </span>loading.<span class="_"> </span><span class="ff7">V<span class="_ _0"></span>irtual<span class="_ _14"> </span>memory<span class="_ _14"> </span>also<span class="_ _15"> </span>makes<span class="_ _14"> </span>it<span class="_ _14"> </span>easy<span class="_ _15"> </span>to<span class="_ _14"> </span>load<span class="_ _15"> </span>executable</span></div><div class="t m5 x29 h26 y782 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_"> </span>shared<span class="_ _13"> </span>object<span class="_"> </span>ﬁles<span class="_"> </span>into<span class="_ _13"> </span>memory<span class="_ _3"></span>.<span class="_"> </span>T<span class="_ _7"></span>o<span class="_"> </span>load<span class="_ _13"> </span>the<span class="_"> </span><span class="ffd">.text<span class="_ _10"> </span></span>and<span class="_ _13"> </span><span class="ffd">.data<span class="_ _10"> </span></span>sections<span class="_"> </span>of</div><div class="t m5 x29 h26 y783 ff7 fs19 fc1 sc0 ls0 ws0">an<span class="_"> </span>object<span class="_ _11"> </span>ﬁle<span class="_"> </span>into<span class="_ _11"> </span>a<span class="_"> </span>newly<span class="_ _11"> </span>created<span class="_ _11"> </span>process<span class="_ _1"></span>,<span class="_"> </span>the<span class="_ _11"> </span>Linux<span class="_ _11"> </span>loader<span class="_"> </span>allocates<span class="_ _11"> </span>virtual</div><div class="t m5 x29 h26 y784 ff7 fs19 fc1 sc0 ls0 ws0">pages<span class="_ _13"> </span>for<span class="_ _6"> </span>the<span class="_ _13"> </span>code<span class="_ _13"> </span>and<span class="_ _13"> </span>data<span class="_ _6"> </span>segments<span class="_ _1"></span>,<span class="_ _13"> </span>marks<span class="_ _13"> </span>them<span class="_ _13"> </span>as<span class="_ _6"> </span>invalid<span class="_ _13"> </span>(i.e<span class="_ _0"></span>.,<span class="_ _13"> </span>not<span class="_ _13"> </span>cached),</div><div class="t m5 x29 h26 y785 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _11"> </span>points<span class="_ _11"> </span>their<span class="_ _11"> </span>page<span class="_ _11"> </span>table<span class="_ _11"> </span>entries<span class="_ _11"> </span>to<span class="_ _11"> </span>the<span class="_ _11"> </span>appropriate<span class="_ _11"> </span>locations<span class="_ _11"> </span>in<span class="_ _11"> </span>the<span class="_ _11"> </span>object</div><div class="t m5 x29 h26 y6d87 ff7 fs19 fc1 sc0 ls0 ws0">ﬁle<span class="_ _1"></span>.<span class="_ _15"> </span>T<span class="_ _1"></span>he<span class="_ _15"> </span>interesting<span class="_ _15"> </span>point<span class="_ _14"> </span>is<span class="_ _15"> </span>that<span class="_ _14"> </span>the<span class="_ _15"> </span>loader<span class="_ _14"> </span>never<span class="_ _15"> </span>actually<span class="_ _14"> </span>copies<span class="_ _15"> </span>any<span class="_ _14"> </span>data</div><div class="t m5 x29 h26 y6d88 ff7 fs19 fc1 sc0 ls0 ws0">from<span class="_"> </span>disk<span class="_"> </span>into<span class="_"> </span>memory<span class="_ _3"></span>.<span class="_ _11"> </span>T<span class="_ _1"></span>he<span class="_ _11"> </span>data<span class="_"> </span>are<span class="_"> </span>paged<span class="_"> </span>in<span class="_ _11"> </span>automatically<span class="_"> </span>and<span class="_"> </span>on<span class="_ _11"> </span>demand</div><div class="t m5 x29 h26 y6d89 ff7 fs19 fc1 sc0 ls0 ws0">by<span class="_ _13"> </span>the<span class="_"> </span>virtual<span class="_ _13"> </span>memory<span class="_"> </span>system<span class="_ _13"> </span>the<span class="_"> </span>ﬁrst<span class="_ _13"> </span>time<span class="_"> </span>each<span class="_ _13"> </span>page<span class="_"> </span>is<span class="_ _13"> </span>referenced,<span class="_"> </span>either<span class="_ _13"> </span>by</div><div class="t m5 x29 h26 y6d8a ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _13"> </span>CPU<span class="_"> </span>when<span class="_ _13"> </span>it<span class="_"> </span>fetches<span class="_ _13"> </span>an<span class="_"> </span>instruction<span class="_ _13"> </span>or<span class="_"> </span>by<span class="_ _13"> </span>an<span class="_ _13"> </span>executing<span class="_"> </span>instruction<span class="_ _13"> </span>when<span class="_"> </span>it</div><div class="t m5 x29 h26 y6d8b ff7 fs19 fc1 sc0 ls0 ws0">references<span class="_"> </span>a<span class="_"> </span>memory<span class="_"> </span>location.</div><div class="t m5 xcd h26 y6d8c ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _16"> </span>notion<span class="_ _11"> </span>of<span class="_ _11"> </span>mapping<span class="_ _16"> </span>a<span class="_ _11"> </span>set<span class="_ _11"> </span>of<span class="_ _11"> </span>contiguous<span class="_ _16"> </span>virtual<span class="_ _11"> </span>pages<span class="_ _11"> </span>to<span class="_ _16"> </span>an<span class="_ _11"> </span>arbitrary</div><div class="t m5 x29 h26 y6d8d ff7 fs19 fc1 sc0 ls0 ws0">location<span class="_ _14"> </span>in<span class="_ _15"> </span>an<span class="_ _15"> </span>arbitrary<span class="_ _15"> </span>ﬁle<span class="_ _14"> </span>is<span class="_ _15"> </span>known<span class="_ _15"> </span>as<span class="_ _15"> </span><span class="ffa">memory<span class="_ _15"> </span>mapping<span class="_ _2"></span></span>.<span class="_ _14"> </span>Linux<span class="_ _15"> </span>provides</div><div class="t m5 x29 h26 y6d8e ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_ _14"> </span>system<span class="_ _14"> </span>call<span class="_ _16"> </span>called<span class="_ _14"> </span><span class="ffd">mmap<span class="_ _14"> </span></span>that<span class="_ _14"> </span>allows<span class="_ _14"> </span>application<span class="_ _14"> </span>programs<span class="_ _14"> </span>to<span class="_ _14"> </span>do<span class="_ _14"> </span>their<span class="_ _14"> </span>own</div><div class="t m5 x29 h26 y6d8f ff7 fs19 fc1 sc0 ls0 ws0">memory<span class="_ _21"> </span>mapping.<span class="_ _21"> </span>W<span class="_ _1"></span>e<span class="_ _21"> </span>will<span class="_ _f"> </span>describe<span class="_ _f"> </span>application-level<span class="_ _21"> </span>memory<span class="_ _f"> </span>mapping<span class="_ _f"> </span>in</div><div class="t m5 x29 h26 y6d90 ff7 fs19 fc1 sc0 ls0 ws0">more<span class="_"> </span>detail<span class="_"> </span>in<span class="_"> </span>Section<span class="_"> </span>9.8.</div><div class="t m5 x75 h3d y573 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y47ef ffa fs19 fc1 sc0 ls0 ws0">Simplifying<span class="_ _15"> </span>sharing.<span class="_"> </span><span class="ff7">Separate<span class="_ _15"> </span>address<span class="_ _21"> </span>spaces<span class="_ _15"> </span>provide<span class="_ _15"> </span>the<span class="_ _15"> </span>operating<span class="_ _15"> </span>system</span></div><div class="t m5 x29 h26 y6d91 ff7 fs19 fc1 sc0 ls0 ws0">with<span class="_ _14"> </span>a<span class="_ _14"> </span>consistent<span class="_ _14"> </span>mechanism<span class="_ _14"> </span>for<span class="_ _14"> </span>managing<span class="_ _14"> </span>sharing<span class="_ _14"> </span>between<span class="_ _14"> </span>user<span class="_ _14"> </span>processes</div><div class="t m5 x29 h26 y6d92 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _11"> </span>the<span class="_ _16"> </span>operating<span class="_ _16"> </span>system<span class="_ _11"> </span>itself<span class="_ _1"></span>.<span class="_ _16"> </span>In<span class="_ _16"> </span>general,<span class="_ _11"> </span>each<span class="_ _16"> </span>process<span class="_ _16"> </span>has<span class="_ _11"> </span>its<span class="_ _16"> </span>own<span class="_ _11"> </span>private</div><div class="t m5 x29 h26 y6d93 ff7 fs19 fc1 sc0 ls0 ws0">code<span class="_ _1"></span>,<span class="_ _13"> </span>data,<span class="_ _13"> </span>heap<span class="_ _0"></span>,<span class="_ _13"> </span>and<span class="_ _6"> </span>stack<span class="_ _13"> </span>areas<span class="_ _13"> </span>that<span class="_ _6"> </span>are<span class="_ _13"> </span>not<span class="_ _13"> </span>shared<span class="_ _6"> </span>with<span class="_ _13"> </span>any<span class="_ _6"> </span>other<span class="_ _13"> </span>process<span class="_ _1"></span>.<span class="_ _13"> </span>In</div><div class="t m5 x29 h26 y6d94 ff7 fs19 fc1 sc0 ls0 ws0">this<span class="_ _13"> </span>case<span class="_ _1"></span>,<span class="_ _13"> </span>the<span class="_ _13"> </span>operating<span class="_ _6"> </span>system<span class="_ _13"> </span>creates<span class="_ _6"> </span>page<span class="_ _13"> </span>tables<span class="_ _13"> </span>that<span class="_ _6"> </span>map<span class="_ _13"> </span>the<span class="_ _6"> </span>corresponding</div><div class="t m5 x29 h26 y6d95 ff7 fs19 fc1 sc0 ls0 ws0">virtual<span class="_"> </span>pages<span class="_"> </span>to<span class="_"> </span>disjoint<span class="_"> </span>physical<span class="_"> </span>pages<span class="_ _1"></span>.</div><div class="t m5 xcd h26 y6d96 ff7 fs19 fc1 sc0 ls0 ws0">However,<span class="_ _15"> </span>in<span class="_ _14"> </span>some<span class="_ _15"> </span>instances<span class="_ _14"> </span>it<span class="_ _15"> </span>is<span class="_ _15"> </span>desirable<span class="_ _14"> </span>for<span class="_ _15"> </span>processes<span class="_ _14"> </span>to<span class="_ _15"> </span>share<span class="_ _15"> </span>code</div><div class="t m5 x29 h26 y6d97 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _14"> </span>data.<span class="_ _14"> </span>F<span class="_ _1"></span>or<span class="_ _15"> </span>example<span class="_ _1"></span>,<span class="_ _21"> </span>every<span class="_ _14"> </span>process<span class="_ _14"> </span>must<span class="_ _15"> </span>call<span class="_ _14"> </span>the<span class="_ _14"> </span>same<span class="_ _15"> </span>operating<span class="_ _14"> </span>system</div><div class="t m5 x29 h26 y6d98 ff7 fs19 fc1 sc0 ls0 ws0">kernel<span class="_ _11"> </span>code<span class="_ _0"></span>,<span class="_ _11"> </span>and<span class="_ _11"> </span>every<span class="_ _11"> </span>C<span class="_ _16"> </span>program<span class="_"> </span>makes<span class="_ _16"> </span>calls<span class="_"> </span>to<span class="_ _16"> </span>routines<span class="_"> </span>in<span class="_ _11"> </span>the<span class="_ _16"> </span>standard<span class="_"> </span>C</div><div class="t m5 x29 h26 y6d99 ff7 fs19 fc1 sc0 ls0 ws0">library<span class="_ _16"> </span>such<span class="_ _16"> </span>as<span class="_ _16"> </span><span class="ffd">printf</span>.<span class="_ _11"> </span>Rather<span class="_ _16"> </span>than<span class="_ _16"> </span>including<span class="_ _16"> </span>separate<span class="_ _16"> </span>copies<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>kernel</div><div class="t m5 x29 h26 y6d9a ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _15"> </span>standard<span class="_ _21"> </span>C<span class="_ _21"> </span>library<span class="_ _21"> </span>in<span class="_ _21"> </span>each<span class="_ _21"> </span>process<span class="_ _1"></span>,<span class="_ _e"> </span>the<span class="_ _15"> </span>operating<span class="_ _15"> </span>system<span class="_ _21"> </span>can<span class="_ _21"> </span>arrange</div><div class="t m5 x29 h26 y6d9b ff7 fs19 fc1 sc0 ls0 ws0">for<span class="_ _15"> </span>multiple<span class="_ _15"> </span>processes<span class="_ _21"> </span>to<span class="_ _15"> </span>share<span class="_ _15"> </span>a<span class="_ _21"> </span>single<span class="_ _15"> </span>copy<span class="_ _21"> </span>of<span class="_ _15"> </span>this<span class="_ _15"> </span>code<span class="_ _21"> </span>by<span class="_ _15"> </span>mapping<span class="_ _15"> </span>the</div><div class="t m5 x29 h26 y6d9c ff7 fs19 fc1 sc0 ls0 ws0">appropriate<span class="_ _16"> </span>virtual<span class="_ _16"> </span>pages<span class="_ _14"> </span>in<span class="_ _16"> </span>different<span class="_ _16"> </span>processes<span class="_ _16"> </span>to<span class="_ _14"> </span>the<span class="_ _16"> </span>same<span class="_ _16"> </span>physical<span class="_ _14"> </span>pages<span class="_ _1"></span>,</div><div class="t m5 x29 h26 y6d9d ff7 fs19 fc1 sc0 ls0 ws0">as<span class="_"> </span>we<span class="_"> </span>saw<span class="_"> </span>in<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>9.9.</div><div class="t m5 x75 h3d y6d9e ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y6d9f ffa fs19 fc1 sc0 ls0 ws0">Simplifying<span class="_ _13"> </span>memory<span class="_ _6"> </span>allocation.<span class="_ _be"></span><span class="ff7">Virtual<span class="_ _6"> </span>memory<span class="_ _13"> </span>provides<span class="_ _13"> </span>a<span class="_ _6"> </span>simple<span class="_ _13"> </span>mechanism</span></div><div class="t m5 x29 h26 y6da0 ff7 fs19 fc1 sc0 ls0 ws0">for<span class="_"> </span>allocating<span class="_ _13"> </span>additional<span class="_"> </span>memory<span class="_ _13"> </span>to<span class="_"> </span>user<span class="_ _13"> </span>processes<span class="_ _1"></span>.<span class="_"> </span>W<span class="_ _1"></span>hen<span class="_"> </span>a<span class="_"> </span>program<span class="_ _13"> </span>running</div><div class="t m5 x29 h26 y6da1 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_ _14"> </span>a<span class="_ _16"> </span>user<span class="_ _14"> </span>process<span class="_ _14"> </span>requests<span class="_ _14"> </span>additional<span class="_ _14"> </span>heap<span class="_ _14"> </span>space<span class="_ _14"> </span>(e<span class="_ _0"></span>.g.,<span class="_ _14"> </span>as<span class="_ _14"> </span>a<span class="_ _16"> </span>result<span class="_ _14"> </span>of<span class="_ _14"> </span>calling</div><div class="t m5 x29 h26 y6da2 ffd fs19 fc1 sc0 ls0 ws0">malloc<span class="ff7">),<span class="_ _21"> </span>the<span class="_ _15"> </span>operating<span class="_ _21"> </span>system<span class="_ _15"> </span>allocates<span class="_ _15"> </span>an<span class="_ _21"> </span>appropriate<span class="_ _15"> </span>number,<span class="_ _21"> </span>say<span class="_ _3"></span>,<span class="_ _21"> </span><span class="ff11">k<span class="_ _2"></span></span><span class="ls294">,o<span class="_ _12"></span>f</span></span></div><div class="t m5 x29 h26 y6da3 ff7 fs19 fc1 sc0 ls0 ws0">contiguous<span class="_ _6"> </span>virtual<span class="_ _13"> </span>memory<span class="_ _6"> </span>pages<span class="_ _1"></span>,<span class="_ _13"> </span>and<span class="_ _13"> </span>maps<span class="_ _6"> </span>them<span class="_ _6"> </span>to<span class="_ _13"> </span><span class="ff11">k<span class="_ _13"> </span></span>arbitrary<span class="_ _6"> </span>physical<span class="_ _13"> </span>pages</div><div class="t m5 x29 h26 y6da4 ff7 fs19 fc1 sc0 ls0 ws0">located<span class="_"> </span>anywhere<span class="_"> </span>in<span class="_"> </span>physical<span class="_"> </span>memory<span class="_ _3"></span>.<span class="_"> </span>Because<span class="_"> </span>of<span class="_ _11"> </span>the<span class="_"> </span>way<span class="_"> </span>page<span class="_"> </span>tables<span class="_"> </span>work,</div><div class="t m5 x29 h26 y6da5 ff7 fs19 fc1 sc0 ls0 ws0">there<span class="_ _15"> </span>is<span class="_ _15"> </span>no<span class="_ _21"> </span>need<span class="_ _15"> </span>for<span class="_ _15"> </span>the<span class="_ _21"> </span>operating<span class="_ _15"> </span>system<span class="_ _21"> </span>to<span class="_ _15"> </span>locate<span class="_ _15"> </span><span class="ff11">k<span class="_ _f"> </span></span>contiguous<span class="_ _21"> </span>pages<span class="_ _15"> </span>of</div><div class="t m5 x29 h26 y6da6 ff7 fs19 fc1 sc0 ls0 ws0">physical<span class="_"> </span>memory<span class="_ _3"></span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>pages<span class="_"> </span>can<span class="_"> </span>be<span class="_"> </span>scattered<span class="_"> </span>randomly<span class="_"> </span>in<span class="_"> </span>physical<span class="_"> </span>memory<span class="_ _3"></span>.</div><div class="t m5 x1d h3b y2270 fff fs24 fc6 sc0 ls0 ws0">9.5<span class="_ _17"> </span><span class="ffe fs18">VM<span class="_"> </span>as<span class="_"> </span>a<span class="_"> </span>T<span class="_ _1"></span>ool<span class="_"> </span>for<span class="_"> </span>Memory<span class="_"> </span>Protection</span></div><div class="t m5 x1d h26 y15bf ff7 fs19 fc1 sc0 ls0 ws0">Any<span class="_"> </span>modern<span class="_ _11"> </span>computer<span class="_ _11"> </span>system<span class="_ _11"> </span>must<span class="_ _11"> </span>provide<span class="_ _11"> </span>the<span class="_ _11"> </span>means<span class="_ _11"> </span>for<span class="_ _11"> </span>the<span class="_ _11"> </span>operating<span class="_ _11"> </span>system</div><div class="t m5 x1d h26 y15c0 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _16"> </span>control<span class="_ _14"> </span>access<span class="_ _14"> </span>to<span class="_ _16"> </span>the<span class="_ _14"> </span>memory<span class="_ _14"> </span>system.<span class="_ _14"> </span>A<span class="_ _16"> </span>user<span class="_ _14"> </span>process<span class="_ _14"> </span>should<span class="_ _16"> </span>not<span class="_ _14"> </span>be<span class="_ _14"> </span>allowed</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
