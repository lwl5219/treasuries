<div id="pf3ce" class="pf w2 h11" data-page-no="3ce"><div class="pc pc3ce w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg3ce.png"/><div class="t m5 x1df h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>11.4<span class="_ _60"> </span>The<span class="_ _10"> </span>Sockets<span class="_ _10"> </span>Interface<span class="_ _3e"> </span><span class="ffe fs1e">973</span></div><div class="t m5 x34 h2a y257 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">Why<span class="_ _11"> </span>the<span class="_ _11"> </span>distinction<span class="_ _11"> </span>between<span class="_ _16"> </span>listening<span class="_ _11"> </span>and<span class="_ _11"> </span>connected<span class="_ _11"> </span>descriptors?</span></div><div class="t m5 x34 h2b y2d0 ff7 fs1e fc2 sc0 ls0 ws0">Y<span class="_ _3"></span>ou<span class="_ _14"> </span>might<span class="_ _14"> </span>wonder<span class="_ _14"> </span>why<span class="_ _15"> </span>the<span class="_ _14"> </span>sockets<span class="_ _14"> </span>interface<span class="_ _14"> </span>makes<span class="_ _15"> </span>a<span class="_ _14"> </span>distinction<span class="_ _14"> </span>between<span class="_ _14"> </span>listening<span class="_ _15"> </span>and<span class="_ _14"> </span>connected</div><div class="t m5 x34 h2b y2d1 ff7 fs1e fc2 sc0 ls0 ws0">descriptors<span class="_ _1"></span>.<span class="_ _14"> </span>At<span class="_ _15"> </span>ﬁrst<span class="_ _14"> </span>glance,<span class="_ _15"> </span>it<span class="_ _14"> </span>appears<span class="_ _15"> </span>to<span class="_ _14"> </span>be<span class="_ _15"> </span>an<span class="_ _14"> </span>unnecessary<span class="_ _15"> </span>complication.<span class="_ _14"> </span>However,<span class="_ _15"> </span>distinguishing</div><div class="t m5 x34 h2b y2d2 ff7 fs1e fc2 sc0 ls0 ws0">between<span class="_"> </span>the<span class="_"> </span>two<span class="_"> </span>turns<span class="_"> </span>out<span class="_"> </span>to<span class="_ _10"> </span>be<span class="_ _10"> </span>quite<span class="_"> </span>useful,<span class="_ _10"> </span>because<span class="_ _10"> </span>it<span class="_"> </span>allows<span class="_ _10"> </span>us<span class="_ _10"> </span>to<span class="_"> </span>build<span class="_ _10"> </span>concurrent<span class="_"> </span>servers<span class="_ _10"> </span>that<span class="_ _10"> </span>can</div><div class="t m5 x34 h2b y2d3 ff7 fs1e fc2 sc0 ls0 ws0">process<span class="_"> </span>many<span class="_ _10"> </span>client<span class="_ _11"> </span>connections<span class="_"> </span>simultaneously<span class="_ _3"></span>.<span class="_"> </span>F<span class="_ _0"></span>or<span class="_"> </span>example,<span class="_"> </span>each<span class="_"> </span>time<span class="_ _10"> </span>a<span class="_ _11"> </span>connection<span class="_"> </span>request<span class="_"> </span>arrives</div><div class="t m5 x34 h2b y2d4 ff7 fs1e fc2 sc0 ls0 ws0">on<span class="_ _16"> </span>the<span class="_ _16"> </span>listening<span class="_ _16"> </span>descriptor,<span class="_ _16"> </span>we<span class="_ _16"> </span>might<span class="_ _16"> </span>fork<span class="_ _14"> </span>a<span class="_ _16"> </span>new<span class="_ _16"> </span>process<span class="_ _16"> </span>that<span class="_ _16"> </span>communicates<span class="_ _16"> </span>with<span class="_ _16"> </span>the<span class="_ _16"> </span>client<span class="_ _16"> </span>over<span class="_ _14"> </span>its</div><div class="t m5 x34 h2b y2d5 ff7 fs1e fc2 sc0 ls0 ws0">connected<span class="_"> </span>descriptor.<span class="_"> </span>Y<span class="_ _7"></span>ou’ll<span class="_"> </span>learn<span class="_"> </span>more<span class="_"> </span>about<span class="_"> </span>concurrent<span class="_"> </span>servers<span class="_"> </span>in<span class="_"> </span>Chapter<span class="_"> </span>12.</div><div class="t m5 x17 h26 y7bfc ff7 fs19 fc2 sc0 ls0 ws0">client<span class="_ _16"> </span>also<span class="_ _16"> </span>returns<span class="_ _14"> </span>from<span class="_ _16"> </span>the<span class="_ _14"> </span><span class="ffd">connect</span>,<span class="_ _14"> </span>and<span class="_ _16"> </span>from<span class="_ _16"> </span>this<span class="_ _14"> </span>point,<span class="_ _14"> </span>the<span class="_ _16"> </span>client<span class="_ _14"> </span>and<span class="_ _16"> </span>server</div><div class="t m5 x17 h26 y7bfd ff7 fs19 fc2 sc0 ls0 ws0">can<span class="_ _16"> </span>pass<span class="_ _14"> </span>data<span class="_ _16"> </span>back<span class="_ _14"> </span>and<span class="_ _16"> </span>forth<span class="_ _14"> </span>by<span class="_ _16"> </span>reading<span class="_ _14"> </span>and<span class="_ _16"> </span>writing<span class="_ _14"> </span><span class="ffd">clientfd<span class="_ _16"> </span></span>and<span class="_ _14"> </span><span class="ffd">connfd</span>,<span class="_ _14"> </span>re-</div><div class="t m5 x17 h26 y7bfe ff7 fs19 fc2 sc0 ls0 ws0">spectively<span class="_ _3"></span>.</div><div class="t m5 x17 h41 y7bff ffe fs29 fc2 sc0 ls0 ws0">11.4.7<span class="_ _48"> </span><span class="fs19">Host<span class="_"> </span>and<span class="_"> </span>Service<span class="_"> </span>Conversion</span></div><div class="t m5 x17 h26 y7c00 ff7 fs19 fc2 sc0 ls0 ws0">Linux<span class="_"> </span>provides<span class="_ _11"> </span>some<span class="_ _11"> </span>powerful<span class="_ _11"> </span>functions<span class="_ _1"></span>,<span class="_ _11"> </span>called<span class="_ _11"> </span><span class="ffd">getaddrinfo<span class="_ _11"> </span></span>and<span class="_ _11"> </span><span class="ffd">getnameinfo</span>,</div><div class="t m5 x17 h26 y7c01 ff7 fs19 fc2 sc0 ls0 ws0">for<span class="_ _11"> </span>converting<span class="_ _16"> </span>back<span class="_ _16"> </span>and<span class="_ _11"> </span>forth<span class="_ _16"> </span>between<span class="_ _11"> </span>binary<span class="_ _16"> </span>socket<span class="_ _16"> </span>address<span class="_ _11"> </span>structures<span class="_ _16"> </span>and<span class="_ _11"> </span>the</div><div class="t m5 x17 h26 y7c02 ff7 fs19 fc2 sc0 ls0 ws0">string<span class="_ _e"> </span>representations<span class="_ _f"> </span>of<span class="_ _e"> </span>hostnames<span class="_ _1"></span>,<span class="_ _1f"> </span>host<span class="_ _e"> </span>addresses<span class="_ _1"></span>,<span class="_ _1f"> </span>service<span class="_ _e"> </span>names<span class="_ _3"></span>,<span class="_ _1f"> </span>and<span class="_ _e"> </span>port</div><div class="t m5 x17 h26 y7c03 ff7 fs19 fc2 sc0 ls0 ws0">numbers<span class="_ _1"></span>.<span class="_ _16"> </span>When<span class="_ _11"> </span>used<span class="_ _16"> </span>in<span class="_ _16"> </span>conjunction<span class="_ _16"> </span>with<span class="_ _16"> </span>the<span class="_ _16"> </span>sockets<span class="_ _11"> </span>interface,<span class="_ _16"> </span>they<span class="_ _16"> </span>allow<span class="_ _11"> </span>us<span class="_ _16"> </span>to</div><div class="t m5 x17 h26 y7c04 ff7 fs19 fc2 sc0 ls0 ws0">write<span class="_"> </span>network<span class="_ _11"> </span>programs<span class="_"> </span>that<span class="_ _11"> </span>are<span class="_"> </span>independent<span class="_ _11"> </span>of<span class="_ _11"> </span>any<span class="_"> </span>particular<span class="_ _11"> </span>version<span class="_"> </span>of<span class="_ _11"> </span>the<span class="_"> </span>IP</div><div class="t m5 x17 h26 y7c05 ff7 fs19 fc2 sc0 ls0 ws0">protocol.</div><div class="t m5 x17 h42 y7c06 ff6 fs29 fc6 sc0 ls0 ws0">The<span class="_ _11"> </span><span class="ffd fs2b">getaddrinfo<span class="_ _16"> </span></span>Function</div><div class="t m5 x17 h26 y7c07 ff7 fs19 fc1 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _e"> </span><span class="ffd ls0">getaddrinfo<span class="_ _15"> </span><span class="ff7">function<span class="_ _f"> </span>converts<span class="_ _f"> </span>string<span class="_ _21"> </span>representations<span class="_ _f"> </span>of<span class="_ _21"> </span>hostnames<span class="_ _0"></span>,<span class="_ _e"> </span>host</span></span></div><div class="t m5 x17 h26 y7c08 ff7 fs19 fc1 sc0 ls0 ws0">addresses<span class="_ _1"></span>,<span class="_ _14"> </span>service<span class="_ _16"> </span>names<span class="_ _1"></span>,<span class="_ _14"> </span>and<span class="_ _16"> </span>port<span class="_ _14"> </span>numbers<span class="_ _16"> </span>into<span class="_ _16"> </span>socket<span class="_ _16"> </span>address<span class="_ _14"> </span>structures<span class="_ _1"></span>.<span class="_ _16"> </span>It<span class="_ _16"> </span>is</div><div class="t m5 x17 h26 y7c09 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _15"> </span>modern<span class="_ _15"> </span>replacement<span class="_ _15"> </span>for<span class="_ _15"> </span>the<span class="_ _15"> </span>obsolete<span class="_ _21"> </span><span class="ffd">gethostbyname<span class="_ _15"> </span></span>and<span class="_ _15"> </span><span class="ffd">getservbyname</span></div><div class="t m5 x17 h26 y7c0a ff7 fs19 fc1 sc0 ls0 ws0">functions<span class="_ _1"></span>.<span class="_ _16"> </span>Unlike<span class="_ _14"> </span>these<span class="_ _14"> </span>functions<span class="_ _1"></span>,<span class="_ _14"> </span>it<span class="_ _14"> </span>is<span class="_ _16"> </span>reentrant<span class="_ _14"> </span>(see<span class="_ _16"> </span>Section<span class="_ _14"> </span>12.7.2)<span class="_ _14"> </span>and<span class="_ _16"> </span>works</div><div class="t m5 x17 h26 y7c0b ff7 fs19 fc1 sc0 ls0 ws0">with<span class="_"> </span>any<span class="_"> </span>protocol.</div><div class="t m5 x31 h2d y7c0c ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;sys/types.h&gt;</div><div class="t m5 x31 h2d y7c0d ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;sys/socket.h&gt;</div><div class="t m5 x31 h2d y7c0e ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;netdb.h&gt;</div><div class="t m5 x31 h2d y7c0f ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>getaddrinfo(const<span class="_ _1f"> </span>char<span class="_ _1f"> </span>*host,<span class="_ _e"> </span>const<span class="_ _1f"> </span>char<span class="_ _e"> </span>*service,</div><div class="t m5 x286 h2d y7c10 ffd fs1e fc2 sc0 ls0 ws0">const<span class="_ _e"> </span>struct<span class="_ _1f"> </span>addrinfo<span class="_ _1f"> </span>*hints,</div><div class="t m5 x286 h2d y7c11 ffd fs1e fc2 sc0 ls0 ws0">struct<span class="_ _e"> </span>addrinfo<span class="_ _1f"> </span>**result);</div><div class="t m5 x16d hf1 y7c12 ff7 fs1f fc2 sc0 ls0 ws0">Returns:<span class="_"> </span>0<span class="_"> </span>if<span class="_"> </span>OK,<span class="_"> </span>nonzero<span class="_"> </span>error<span class="_"> </span>code<span class="_"> </span>on<span class="_"> </span>error</div><div class="t m5 x31 h2d y7c13 ffd fs1e fc2 sc0 ls0 ws0">void<span class="_ _e"> </span>freeaddrinfo(struct<span class="_ _1f"> </span>addrinfo<span class="_ _1f"> </span>*result);</div><div class="t m5 x6d hf1 y7c14 ff7 fs1f fc2 sc0 ls0 ws0">Returns:<span class="_"> </span>nothing</div><div class="t m5 x31 h2d y7c15 ffd fs1e fc2 sc0 ls0 ws0">const<span class="_ _e"> </span>char<span class="_ _1f"> </span>*gai_strerror(int<span class="_ _1f"> </span>errcode);</div><div class="t m5 xbd hf1 y619e ff7 fs1f fc2 sc0 ls0 ws0">Returns:<span class="_"> </span>error<span class="_"> </span>message</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
