<div id="pf2a1" class="pf w2 h11" data-page-no="2a1"><div class="pc pc2a1 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg2a1.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">672<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>6<span class="_ _3d"> </span>The<span class="_ _10"> </span>Memory<span class="_ _10"> </span>Hierarchy</span></div><div class="t m5 x29 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">But<span class="_ _16"> </span>consider<span class="_ _14"> </span>what<span class="_ _16"> </span>happens<span class="_ _14"> </span>if<span class="_ _14"> </span>we<span class="_ _16"> </span>make<span class="_ _14"> </span>the<span class="_ _16"> </span>seemingly<span class="_ _14"> </span>innocuous<span class="_ _14"> </span>change<span class="_ _16"> </span>of</div><div class="t m5 x1d h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">permuting<span class="_"> </span>the<span class="_"> </span>loops:</div><div class="t m5 x1f h2d y5968 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">int<span class="_ _1f"> </span>sumarraycols(int<span class="_ _e"> </span>a[M][N])</span></div><div class="t m5 x1f h2d y5969 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x1f h2d y596a ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2">int<span class="_ _e"> </span>i,<span class="_ _1f"> </span>j,<span class="_ _1f"> </span>sum<span class="_ _e"> </span>=<span class="_ _1f"> </span>0;</span></div><div class="t m5 x1f h2e y596b ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 x1f h2e y596c ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x33 h2d y30c2 ffd fs1e fc2 sc0 ls33 ws0">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>j=0<span class="_ _41"></span>;j&lt;N<span class="_ _41"></span>;<span class="ls0">j++)</span></div><div class="t m5 x1f h2e y596d ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 xf7 h2d y596e ffd fs1e fc2 sc0 ls33 ws0">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>i=0<span class="_ _41"></span>;i&lt;M<span class="_ _41"></span>;<span class="ls0">i++)</span></div><div class="t m5 x1f h2d y596f ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _d1"> </span><span class="ffd fs1e fc2">sum<span class="_ _1f"> </span>+=<span class="_ _e"> </span>a[i][j];</span></div><div class="t m5 x1f h2d y5970 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _20"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>sum;</span></div><div class="t m5 x1f h2d y5971 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1d h26 y5972 ff7 fs19 fc2 sc0 ls0 ws0">In<span class="_"> </span>this<span class="_ _11"> </span>case,<span class="_"> </span>we<span class="_ _11"> </span>are<span class="_ _11"> </span>scanning<span class="_ _11"> </span>the<span class="_ _11"> </span>array<span class="_ _11"> </span>column<span class="_ _11"> </span>by<span class="_ _11"> </span>column<span class="_ _11"> </span>instead<span class="_ _11"> </span>of<span class="_ _11"> </span>row<span class="_ _11"> </span>by<span class="_ _11"> </span>row<span class="_ _3"></span>.</div><div class="t m5 x1d h26 y5973 ff7 fs19 fc2 sc0 ls0 ws0">If<span class="_"> </span>we<span class="_"> </span>are<span class="_ _11"> </span>lucky<span class="_"> </span>and<span class="_"> </span>the<span class="_ _11"> </span>entire<span class="_"> </span>array<span class="_ _11"> </span>ﬁts<span class="_"> </span>in<span class="_"> </span>the<span class="_ _11"> </span>cache<span class="_ _0"></span>,<span class="_"> </span>then<span class="_"> </span>we<span class="_ _11"> </span>will<span class="_"> </span>enjoy<span class="_"> </span>the<span class="_ _11"> </span>same</div><div class="t m5 x1d h26 y5974 ff7 fs19 fc2 sc0 ls0 ws0">miss<span class="_ _16"> </span>rate<span class="_ _16"> </span>of<span class="_ _16"> </span>1/4.<span class="_ _16"> </span>However,<span class="_ _16"> </span>if<span class="_ _14"> </span>the<span class="_ _16"> </span>array<span class="_ _16"> </span>is<span class="_ _16"> </span>larger<span class="_ _16"> </span>than<span class="_ _16"> </span>the<span class="_ _14"> </span>cache<span class="_ _16"> </span>(the<span class="_ _16"> </span>more<span class="_ _16"> </span>likely</div><div class="t m5 x1d h26 y5975 ff7 fs19 fc2 sc0 ls0 ws0">case),<span class="_"> </span>then<span class="_"> </span>each<span class="_"> </span>and<span class="_"> </span>every<span class="_"> </span>access<span class="_"> </span>of<span class="_"> </span><span class="ffd">a[i][j]<span class="_ _10"> </span></span>will<span class="_"> </span>miss!</div><div class="t m5 x15d h32 y5976 ffd fs1e fc2 sc0 ls0 ws0">a[i][j]<span class="_ _5e"> </span><span class="ff11 fs21">j<span class="_"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ff7">0<span class="_ _79"> </span></span></span>j<span class="_"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ff7">1<span class="_ _8b"> </span></span></span>j<span class="_"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ff7">2<span class="_ _93"> </span></span></span>j<span class="_"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ff7">3<span class="_ _74"> </span></span></span>j<span class="_"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ff7">4<span class="_ _74"> </span></span></span>j<span class="_"> </span><span class="ff12">=<span class="_ _10"> </span><span class="ff7">5<span class="_ _74"> </span></span></span>j<span class="_"> </span><span class="ff12">=<span class="_ _13"></span><span class="ff7">6<span class="_ _74"> </span></span></span>j<span class="_"> </span><span class="ff12">=<span class="_ _13"></span><span class="ff7">7</span></span></span></div><div class="t m5 x15d h32 yeb4 ff11 fs21 fc2 sc0 ls0 ws0">i<span class="_ _10"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ff7 ls252">01<span class="_ _168"></span><span class="ffc ls0">[m]<span class="_ _26"> </span><span class="ff7">5<span class="_"> </span></span>[m]<span class="_ _1f9"> </span><span class="ff7">9<span class="_"> </span></span>[m]<span class="_ _1f9"> </span><span class="ff7">13<span class="_"> </span></span>[m]<span class="_ _26"> </span><span class="ff7">17<span class="_"> </span></span>[m]<span class="_ _26"> </span><span class="ff7">21<span class="_"> </span></span>[m]<span class="_ _26"> </span><span class="ff7">25<span class="_"> </span></span>[m]<span class="_ _26"> </span><span class="ff7">29<span class="_"> </span></span>[m]</span></span></span></div><div class="t m5 x15d h32 yeb5 ff11 fs21 fc2 sc0 ls0 ws0">i<span class="_ _10"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ff7 ls252">12<span class="_ _168"></span><span class="ffc ls0">[m]<span class="_ _26"> </span><span class="ff7">6<span class="_"> </span></span>[m]<span class="_ _26"> </span><span class="ff7">10<span class="_"> </span></span>[m]<span class="_ _26"> </span><span class="ff7">14<span class="_"> </span></span>[m]<span class="_ _26"> </span><span class="ff7">18<span class="_"> </span></span>[m]<span class="_ _26"> </span><span class="ff7">22<span class="_"> </span></span>[m]<span class="_ _26"> </span><span class="ff7">26<span class="_"> </span></span>[m]<span class="_ _26"> </span><span class="ff7">30<span class="_"> </span></span>[m]</span></span></span></div><div class="t m5 x15d h32 y5977 ff11 fs21 fc2 sc0 ls0 ws0">i<span class="_ _10"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ff7 ls252">23<span class="_ _168"></span><span class="ffc ls0">[m]<span class="_ _26"> </span><span class="ff7">7<span class="_"> </span></span>[m]<span class="_ _26"> </span><span class="ff7">11<span class="_"> </span></span>[m]<span class="_ _26"> </span><span class="ff7">15<span class="_"> </span></span>[m]<span class="_ _26"> </span><span class="ff7">19<span class="_"> </span></span>[m]<span class="_ _26"> </span><span class="ff7">23<span class="_"> </span></span>[m]<span class="_ _26"> </span><span class="ff7">27<span class="_"> </span></span>[m]<span class="_ _26"> </span><span class="ff7">31<span class="_"> </span></span>[m]</span></span></span></div><div class="t m5 x15d h32 y5978 ff11 fs21 fc2 sc0 ls0 ws0">i<span class="_ _10"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ff7 ls252">34<span class="_ _168"></span><span class="ffc ls0">[m]<span class="_ _26"> </span><span class="ff7">8<span class="_"> </span></span>[m]<span class="_ _26"> </span><span class="ff7">12<span class="_"> </span></span>[m]<span class="_ _26"> </span><span class="ff7">16<span class="_"> </span></span>[m]<span class="_ _26"> </span><span class="ff7">20<span class="_"> </span></span>[m]<span class="_ _26"> </span><span class="ff7">24<span class="_"> </span></span>[m]<span class="_ _26"> </span><span class="ff7">28<span class="_"> </span></span>[m]<span class="_ _26"> </span><span class="ff7">32<span class="_"> </span></span>[m]</span></span></span></div><div class="t m5 x29 h26 y1eb7 ff7 fs19 fc2 sc0 ls0 ws0">Higher<span class="_ _13"> </span>miss<span class="_ _13"> </span>rates<span class="_"> </span>can<span class="_ _13"> </span>have<span class="_ _13"> </span>a<span class="_ _13"> </span>signiﬁcant<span class="_ _13"> </span>impact<span class="_ _13"> </span>on<span class="_"> </span>running<span class="_ _13"> </span>time<span class="_ _1"></span>.<span class="_ _13"> </span>F<span class="_ _1"></span>or<span class="_"> </span>example<span class="_ _1"></span>,</div><div class="t m5 x1d h26 y1eb8 ff7 fs19 fc2 sc0 ls0 ws0">on<span class="_"> </span>our<span class="_ _11"> </span>desktop<span class="_"> </span>machine,<span class="_"> </span><span class="ffd">sumarrayrows<span class="_ _10"> </span></span>runs<span class="_ _11"> </span>25<span class="_"> </span>times<span class="_ _11"> </span>faster<span class="_"> </span>than<span class="_ _11"> </span><span class="ffd">sumarraycols</span></div><div class="t m5 x1d h26 y1eb9 ff7 fs19 fc2 sc0 ls0 ws0">for<span class="_ _11"> </span>large<span class="_ _16"> </span>array<span class="_ _11"> </span>sizes<span class="_ _1"></span>.<span class="_ _16"> </span>T<span class="_ _7"></span>o<span class="_ _16"> </span>summarize<span class="_ _1"></span>,<span class="_ _16"> </span>programmers<span class="_ _11"> </span>should<span class="_ _16"> </span>be<span class="_ _11"> </span>aware<span class="_ _16"> </span>of<span class="_ _11"> </span>locality<span class="_ _16"> </span>in</div><div class="t m5 x1d h26 y1eba ff7 fs19 fc2 sc0 ls0 ws0">their<span class="_"> </span>programs<span class="_"> </span>and<span class="_"> </span>try<span class="_"> </span>to<span class="_"> </span>write<span class="_"> </span>programs<span class="_"> </span>that<span class="_"> </span>exploit<span class="_"> </span>it.</div><div class="t m5 x1d h47 y5979 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>6.17<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>701)</span></div><div class="t m5 x1d h26 y597a ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _7"></span>ransposing<span class="_ _11"> </span>the<span class="_ _11"> </span>rows<span class="_ _11"> </span>and<span class="_ _11"> </span>columns<span class="_ _11"> </span>of<span class="_ _16"> </span>a<span class="_"> </span>matrix<span class="_ _11"> </span>is<span class="_ _11"> </span>an<span class="_ _11"> </span>important<span class="_ _16"> </span>problem<span class="_"> </span>in<span class="_ _11"> </span>signal</div><div class="t m5 x1d h26 y597b ff7 fs19 fc1 sc0 ls0 ws0">processing<span class="_ _13"> </span>and<span class="_ _13"> </span>scientiﬁc<span class="_ _6"> </span>computing<span class="_ _13"> </span>applications<span class="_ _1"></span>.<span class="_ _13"> </span>It<span class="_ _13"> </span>is<span class="_ _13"> </span>also<span class="_ _13"> </span>interesting<span class="_ _6"> </span>from<span class="_ _13"> </span>a<span class="_ _13"> </span>local-</div><div class="t m5 x1d h26 y597c ff7 fs19 fc1 sc0 ls0 ws0">ity<span class="_"> </span>point<span class="_"> </span>of<span class="_"> </span>view<span class="_"> </span>because<span class="_"> </span>its<span class="_"> </span>reference<span class="_"> </span>pattern<span class="_"> </span>is<span class="_"> </span>both<span class="_"> </span>row-wise<span class="_"> </span>and<span class="_"> </span>column-wise<span class="_ _1"></span>.</div><div class="t m5 x1d h26 y597d ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_"> </span>example<span class="_ _1"></span>,<span class="_"> </span>consider<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>transpose<span class="_"> </span>routine:</div><div class="t m5 x1f h2d y597e ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">typedef<span class="_ _1f"> </span>int<span class="_ _e"> </span>array[2][2];</span></div><div class="t m5 x1f h2e y597f ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x1f h2e y5980 ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x4f h2d y3478 ffd fs1e fc2 sc0 ls0 ws0">void<span class="_ _e"> </span>transpose1(array<span class="_ _1f"> </span>dst,<span class="_ _1f"> </span>array<span class="_ _e"> </span>src)</div><div class="t m5 x1f h2e y5981 ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 x4f h2d y3de7 ffd fs1e fc2 sc0 ls0 ws0">{</div><div class="t m5 x1f h2e y36fd ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x33 h2d y5982 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>i,<span class="_ _1f"> </span>j;</div><div class="t m5 x1f h2e y4c74 ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 x1f h2e y5983 ff6 fs20 fc6 sc0 ls0 ws0">7</div><div class="t m5 x33 h2d y464c ffd fs1e fc2 sc0 ls33 ws0">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>i=0<span class="_ _41"></span>;i&lt;2<span class="_ _41"></span>;<span class="ls0">i++)<span class="_ _e"> </span>{</span></div><div class="t m5 x1f h2e y1864 ff6 fs20 fc6 sc0 ls0 ws0">8</div><div class="t m5 xf7 h2d y2fb5 ffd fs1e fc2 sc0 ls33 ws0">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>j=0<span class="_ _41"></span>;j&lt;2<span class="_ _41"></span>;<span class="ls0">j++)<span class="_ _e"> </span>{</span></div><div class="t m5 x1f h2d y20a6 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _d1"> </span><span class="ffd fs1e fc2">dst[j][i]<span class="_ _1f"> </span>=<span class="_ _e"> </span>src[i][j];</span></div><div class="t m5 x1b0 h2d y131f ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _70"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1b0 h2d y4af6 ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1b0 h2e y4c76 ff6 fs20 fc6 sc0 ls0 ws0">12</div><div class="t m5 x4f h2d y1397 ffd fs1e fc2 sc0 ls0 ws0">}</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
