<div id="pf3a3" class="pf w2 h11" data-page-no="3a3"><div class="pc pc3a3 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg3a3.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">930<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>10<span class="_ _3d"> </span>System-Level<span class="_ _10"> </span>I/O</span></div><div class="t m5 x1d h31 y1398 ff7 fs21 fc2 sc0 ls0 ws0">Mask<span class="_ _71"> </span>Description</div><div class="t m5 x1d h31 yc94 ff7 fs21 fc2 sc0 ls0 ws0">S_IR<span class="_ _1"></span>USR<span class="_ _76"> </span>User<span class="_"> </span>(owner)<span class="_"> </span>can<span class="_"> </span>read<span class="_"> </span>this<span class="_"> </span>ﬁle</div><div class="t m5 x1d h31 yc96 ff7 fs21 fc2 sc0 ls0 ws0">S_IWUSR<span class="_ _f1"> </span>User<span class="_"> </span>(owner)<span class="_"> </span>can<span class="_"> </span>write<span class="_"> </span>this<span class="_"> </span>ﬁle</div><div class="t m5 x1d h31 y5521 ff7 fs21 fc2 sc0 ls0 ws0">S_IXUSR<span class="_ _8b"> </span>User<span class="_"> </span>(owner)<span class="_"> </span>can<span class="_"> </span>execute<span class="_"> </span>this<span class="_"> </span>ﬁle</div><div class="t m5 x1d h31 y139c ff7 fs21 fc2 sc0 ls0 ws0">S_IRGRP<span class="_ _61"> </span>Members<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>owner’s<span class="_"> </span>group<span class="_"> </span>can<span class="_"> </span>read<span class="_"> </span>this<span class="_"> </span>ﬁle</div><div class="t m5 x1d h31 y775a ff7 fs21 fc2 sc0 ls0 ws0">S_IWGRP<span class="_ _95"> </span>Members<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>owner’s<span class="_"> </span>group<span class="_"> </span>can<span class="_"> </span>write<span class="_"> </span>this<span class="_"> </span>ﬁle</div><div class="t m5 x1d h31 y775b ff7 fs21 fc2 sc0 ls0 ws0">S_IXGRP<span class="_ _61"> </span>Members<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>owner’s<span class="_"> </span>group<span class="_"> </span>can<span class="_"> </span>execute<span class="_"> </span>this<span class="_"> </span>ﬁle</div><div class="t m5 x1d h31 y775c ff7 fs21 fc2 sc0 ls0 ws0">S_IRO<span class="_ _1"></span>TH<span class="_ _46"> </span>Others<span class="_"> </span>(anyone)<span class="_"> </span>can<span class="_"> </span>read<span class="_"> </span>this<span class="_"> </span>ﬁle</div><div class="t m5 x1d h31 y775d ff7 fs21 fc2 sc0 ls0 ws0">S_IW<span class="_ _0"></span>OTH<span class="_ _26"> </span>Others<span class="_"> </span>(anyone)<span class="_"> </span>can<span class="_"> </span>write<span class="_"> </span>this<span class="_"> </span>ﬁle</div><div class="t m5 x1d h31 y775e ff7 fs21 fc2 sc0 ls0 ws0">S_IXOTH<span class="_ _7b"> </span>Others<span class="_"> </span>(anyone)<span class="_"> </span>can<span class="_"> </span>execute<span class="_"> </span>this<span class="_"> </span>ﬁle</div><div class="t m5 x1d h3a y775f ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>10.2<span class="_ _66"> </span><span class="fc1">Access<span class="_"> </span>permission<span class="_"> </span>bits.<span class="_"> </span><span class="ff6">Deﬁned<span class="_ _11"> </span>in<span class="_ _10"> </span><span class="ffd fs19">sys/stat.h</span>.</span></span></div><div class="t m5 x1d h26 y7760 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _f"> </span>example,<span class="_ _e"> </span>here<span class="_ _f"> </span>is<span class="_ _e"> </span>how<span class="_ _f"> </span>you<span class="_ _f"> </span>might<span class="_ _e"> </span>open<span class="_ _f"> </span>an<span class="_ _e"> </span>existing<span class="_ _21"> </span>ﬁle<span class="_ _e"> </span>with<span class="_ _f"> </span>the<span class="_ _f"> </span>intent<span class="_ _e"> </span>of</div><div class="t m5 x1d h26 y7761 ff7 fs19 fc1 sc0 ls0 ws0">appending<span class="_"> </span>some<span class="_"> </span>data:</div><div class="t m5 x10c h2d y7762 ffd fs1e fc2 sc0 ls0 ws0">fd<span class="_ _e"> </span>=<span class="_ _1f"> </span>Open(&quot;foo.txt&quot;,<span class="_ _1f"> </span>O_WRONLY|O_APPEND,<span class="_ _e"> </span>0);</div><div class="t m5 x29 h26 y7763 ff7 fs19 fc2 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _e"> </span><span class="ffd ls0">mode<span class="_ _f"> </span><span class="ff7">argument<span class="_ _e"> </span>speciﬁes<span class="_ _f"> </span>the<span class="_ _f"> </span>access<span class="_ _e"> </span>permission<span class="_ _21"> </span>bits<span class="_ _e"> </span>of<span class="_ _f"> </span>new<span class="_ _f"> </span>ﬁles<span class="_ _1"></span>.<span class="_ _e"> </span>T<span class="_ _1"></span>he</span></span></div><div class="t m5 x1d h26 y7764 ff7 fs19 fc2 sc0 ls0 ws0">symbolic<span class="_"> </span>names<span class="_"> </span>for<span class="_"> </span>these<span class="_"> </span>bits<span class="_"> </span>are<span class="_"> </span>shown<span class="_"> </span>in<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>10.2.</div><div class="t m5 x29 h26 y7765 ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_ _15"> </span>part<span class="_ _21"> </span>of<span class="_ _21"> </span>its<span class="_ _21"> </span>context,<span class="_ _f"> </span>each<span class="_ _21"> </span>process<span class="_ _15"> </span>has<span class="_ _21"> </span>a<span class="_ _21"> </span><span class="ffd">umask<span class="_ _21"> </span></span>that<span class="_ _21"> </span>is<span class="_ _15"> </span>set<span class="_ _21"> </span>by<span class="_ _21"> </span>calling<span class="_ _21"> </span>the</div><div class="t m5 x1d h26 y7766 ffd fs19 fc2 sc0 ls0 ws0">umask<span class="_ _16"> </span><span class="ff7">function.<span class="_ _14"> </span>When<span class="_ _16"> </span>a<span class="_ _14"> </span>process<span class="_ _16"> </span>creates<span class="_ _14"> </span>a<span class="_ _16"> </span>new<span class="_ _14"> </span>ﬁle<span class="_ _14"> </span>by<span class="_ _16"> </span>calling<span class="_ _14"> </span>the<span class="_ _14"> </span></span>open<span class="_ _16"> </span><span class="ff7">function</span></div><div class="t m5 x1d h26 y7767 ff7 fs19 fc2 sc0 ls0 ws0">with<span class="_ _16"> </span>some<span class="_ _14"> </span><span class="ffd">mode<span class="_ _14"> </span></span>argument,<span class="_ _14"> </span>then<span class="_ _14"> </span>the<span class="_ _14"> </span>access<span class="_ _16"> </span>permission<span class="_ _14"> </span>bits<span class="_ _14"> </span>of<span class="_ _16"> </span>the<span class="_ _14"> </span>ﬁle<span class="_ _14"> </span>are<span class="_ _16"> </span>set<span class="_ _14"> </span>to</div><div class="t m5 x1d h26 y7768 ffd fs19 fc2 sc0 ls0 ws0">mode<span class="_ _11"> </span>&amp;<span class="_ _16"> </span>~umask<span class="ff7">.<span class="_ _16"> </span>F<span class="_ _1"></span>or<span class="_ _16"> </span>example<span class="_ _1"></span>,<span class="_ _14"> </span>suppose<span class="_ _16"> </span>we<span class="_ _16"> </span>are<span class="_ _16"> </span>given<span class="_ _16"> </span>the<span class="_ _11"> </span>following<span class="_ _16"> </span>default<span class="_ _16"> </span>values</span></div><div class="t m5 x1d h26 y7769 ff7 fs19 fc2 sc0 ls0 ws0">for<span class="_"> </span><span class="ffd">mode<span class="_ _10"> </span></span>and<span class="_"> </span><span class="ffd">umask</span>:</div><div class="t m5 x1d h2d y776a ffd fs1e fc2 sc0 ls0 ws0">#define<span class="_ _e"> </span>DEF_MODE<span class="_ _3f"> </span>S_IRUSR|S_IWUSR|S_IRGRP|S_IWGRP|S_IROTH|S_IWOTH</div><div class="t m5 x1d h2d y776b ffd fs1e fc2 sc0 ls0 ws0">#define<span class="_ _e"> </span>DEF_UMASK<span class="_ _1a"> </span>S_IWGRP|S_IWOTH</div><div class="t m5 x1d h26 y776c ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>hen<span class="_"> </span>the<span class="_ _13"> </span>following<span class="_"> </span>code<span class="_ _13"> </span>fragment<span class="_"> </span>creates<span class="_ _13"> </span>a<span class="_ _13"> </span>new<span class="_"> </span>ﬁle<span class="_ _13"> </span>in<span class="_"> </span>which<span class="_ _13"> </span>the<span class="_"> </span>owner<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>ﬁle</div><div class="t m5 x1d h26 y776d ff7 fs19 fc2 sc0 ls0 ws0">has<span class="_"> </span>read<span class="_"> </span>and<span class="_"> </span>write<span class="_"> </span>permissions<span class="_ _1"></span>,<span class="_"> </span>and<span class="_"> </span>all<span class="_"> </span>other<span class="_"> </span>users<span class="_"> </span>have<span class="_"> </span>read<span class="_"> </span>permissions:</div><div class="t m5 x10c h2d y776e ffd fs1e fc2 sc0 ls0 ws0">umask(DEF_UMASK);</div><div class="t m5 x10c h2d y776f ffd fs1e fc2 sc0 ls0 ws0">fd<span class="_ _e"> </span>=<span class="_ _1f"> </span>Open(&quot;foo.txt&quot;,<span class="_ _1f"> </span>O_CREAT|O_TRUNC|O_WRONLY,<span class="_ _e"> </span>DEF_MODE);</div><div class="t m5 x29 h26 y7770 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>inally<span class="_ _3"></span>,<span class="_"> </span>a<span class="_"> </span>process<span class="_"> </span>closes<span class="_"> </span>an<span class="_"> </span>open<span class="_"> </span>ﬁle<span class="_"> </span>by<span class="_"> </span>calling<span class="_"> </span>the<span class="_"> </span><span class="ffd">close<span class="_ _10"> </span></span>function.</div><div class="t m5 x126 h2d y7771 ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;unistd.h&gt;</div><div class="t m5 x126 h2d y7772 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>close(int<span class="_ _1f"> </span>fd);</div><div class="t m5 x107 hf2 y7773 ff7 fs1f fc2 sc0 ls0 ws0">Returns:<span class="_"> </span>0<span class="_"> </span>if<span class="_"> </span>OK,<span class="_"> </span><span class="ff12">−</span>1<span class="_ _13"> </span>on<span class="_"> </span>error</div><div class="t m5 x1d h26 y6e1 ff7 fs19 fc2 sc0 ls0 ws0">Closing<span class="_"> </span>a<span class="_"> </span>descriptor<span class="_"> </span>that<span class="_"> </span>is<span class="_"> </span>already<span class="_"> </span>closed<span class="_"> </span>is<span class="_"> </span>an<span class="_"> </span>error.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
