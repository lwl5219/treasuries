<div id="pf137" class="pf w2 h11" data-page-no="137"><div class="pc pc137 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg137.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">310<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x29 h26 y9c ff7 fs19 fc2 sc0 ls0 ws0">Alignment<span class="_"> </span>is<span class="_ _11"> </span>enforced<span class="_ _11"> </span>by<span class="_ _11"> </span>making<span class="_ _11"> </span>sure<span class="_ _11"> </span>that<span class="_"> </span>every<span class="_ _11"> </span>data<span class="_ _11"> </span>type<span class="_ _11"> </span>is<span class="_ _11"> </span>organized<span class="_ _11"> </span>and</div><div class="t m5 x1d h26 y409 ff7 fs19 fc2 sc0 ls0 ws0">allocated<span class="_ _16"> </span>in<span class="_ _14"> </span>such<span class="_ _14"> </span>a<span class="_ _14"> </span>way<span class="_ _14"> </span>that<span class="_ _16"> </span>every<span class="_ _14"> </span>object<span class="_ _14"> </span>within<span class="_ _14"> </span>the<span class="_ _14"> </span>type<span class="_ _16"> </span>satisﬁes<span class="_ _14"> </span>its<span class="_ _14"> </span>alignment</div><div class="t m5 x1d h26 y40a ff7 fs19 fc2 sc0 ls0 ws0">restrictions<span class="_ _1"></span>.<span class="_ _14"> </span>T<span class="_ _0"></span>he<span class="_ _14"> </span>compiler<span class="_ _14"> </span>places<span class="_ _14"> </span>directives<span class="_ _15"> </span>in<span class="_ _14"> </span>the<span class="_ _14"> </span>assembly<span class="_ _15"> </span>code<span class="_ _14"> </span>indicating<span class="_ _14"> </span>the</div><div class="t m5 x1d h26 y40b ff7 fs19 fc2 sc0 ls0 ws0">desired<span class="_"> </span>alignment<span class="_ _13"> </span>for<span class="_"> </span>global<span class="_"> </span>data.<span class="_ _13"> </span>F<span class="_ _1"></span>or<span class="_"> </span>example<span class="_ _1"></span>,<span class="_"> </span>the<span class="_"> </span>assembly-code<span class="_ _13"> </span>declaration<span class="_"> </span>of</div><div class="t m5 x1d h26 y40c ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>jump<span class="_"> </span>table<span class="_"> </span>on<span class="_"> </span>page<span class="_"> </span>271<span class="_"> </span>contains<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>directive<span class="_"> </span>on<span class="_"> </span>line<span class="_"> </span>2:</div><div class="t m5 x1d h2d y2ca2 ffd fs1e fc2 sc0 ls0 ws0">.align<span class="_ _e"> </span>8</div><div class="t m5 x1d h26 y2ca3 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>ensures<span class="_ _13"> </span>that<span class="_ _13"> </span>the<span class="_"> </span>data<span class="_ _13"> </span>following<span class="_ _13"> </span>it<span class="_ _13"> </span>(in<span class="_"> </span>this<span class="_ _13"> </span>case<span class="_ _13"> </span>the<span class="_"> </span>start<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>jump<span class="_ _13"> </span>table)<span class="_ _13"> </span>will</div><div class="t m5 x1d h26 y2ca4 ff7 fs19 fc2 sc0 ls0 ws0">start<span class="_"> </span>with<span class="_"> </span>an<span class="_"> </span>address<span class="_"> </span>that<span class="_ _13"> </span>is<span class="_"> </span>a<span class="_"> </span>multiple<span class="_"> </span>of<span class="_"> </span>8.<span class="_"> </span>Since<span class="_"> </span>each<span class="_"> </span>table<span class="_ _13"> </span>entry<span class="_"> </span>is<span class="_"> </span>8<span class="_"> </span>bytes<span class="_"> </span>long,</div><div class="t m5 x1d h26 y2ca5 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>successive<span class="_"> </span>elements<span class="_"> </span>will<span class="_"> </span>obey<span class="_"> </span>the<span class="_"> </span>8-byte<span class="_"> </span>alignment<span class="_"> </span>restriction.</div><div class="t m5 x29 h26 y2ca6 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _14"> </span>code<span class="_ _14"> </span>involving<span class="_ _15"> </span>structures<span class="_ _1"></span>,<span class="_ _15"> </span>the<span class="_ _15"> </span>compiler<span class="_ _14"> </span>may<span class="_ _14"> </span>need<span class="_ _15"> </span>to<span class="_ _14"> </span>insert<span class="_ _14"> </span>gaps<span class="_ _15"> </span>in<span class="_ _14"> </span>the</div><div class="t m5 x1d h26 y2ca7 ff7 fs19 fc2 sc0 ls0 ws0">ﬁeld<span class="_ _14"> </span>allocation<span class="_ _14"> </span>to<span class="_ _14"> </span>ensure<span class="_ _14"> </span>that<span class="_ _15"> </span>each<span class="_ _14"> </span>structure<span class="_ _14"> </span>element<span class="_ _14"> </span>satisﬁes<span class="_ _14"> </span>its<span class="_ _14"> </span>alignment<span class="_ _15"> </span>re-</div><div class="t m5 x1d h26 y2ca8 ff7 fs19 fc2 sc0 ls0 ws0">quirement.<span class="_"> </span>The<span class="_"> </span>structure<span class="_ _11"> </span>will<span class="_ _11"> </span>then<span class="_ _11"> </span>have<span class="_ _11"> </span>some<span class="_ _11"> </span>required<span class="_ _11"> </span>alignment<span class="_ _11"> </span>for<span class="_ _11"> </span>its<span class="_"> </span>starting</div><div class="t m5 x1d h26 y2ca9 ff7 fs19 fc2 sc0 ls0 ws0">address<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y2caa ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_"> </span>example<span class="_ _1"></span>,<span class="_"> </span>consider<span class="_"> </span>the<span class="_"> </span>structure<span class="_"> </span>declaration</div><div class="t m5 x1d h2d y2cab ffd fs1e fc2 sc0 ls0 ws0">struct<span class="_ _e"> </span>S1<span class="_ _1f"> </span>{</div><div class="t m5 x10c h2d y2cac ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _1a"> </span>i;</div><div class="t m5 x10c h2d y2cad ffd fs1e fc2 sc0 ls0 ws0">char<span class="_ _e"> </span>c;</div><div class="t m5 x10c h2d y2cae ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _1a"> </span>j;</div><div class="t m5 x1d h2d y2caf ffd fs1e fc2 sc0 ls0 ws0">};</div><div class="t m5 x1d h26 y2cb0 ff7 fs19 fc2 sc0 ls0 ws0">Suppose<span class="_ _13"> </span>the<span class="_ _13"> </span>compiler<span class="_ _13"> </span>used<span class="_ _13"> </span>the<span class="_ _13"> </span>minimal<span class="_ _13"> </span>9-byte<span class="_ _13"> </span>allocation,<span class="_ _13"> </span>diagrammed<span class="_ _13"> </span>as<span class="_ _13"> </span>follows:</div><div class="t m5 x1d5 h3f y2cb1 ff2e fs27 fc1 sc0 ls0 ws0">Offset </div><div class="t m5 x1d h3f y2cb2 ff2e fs27 fc1 sc0 ls0 ws0">Contents </div><div class="t m5 x1a h40 y2cb3 ff2f fs28 fc1 sc0 ls0 ws0">i</div><div class="t m5 x17f h3f y2cb4 ff2e fs27 fc1 sc0 ls17e ws0">04<span class="_ _e6"></span>59</div><div class="t m5 x22 h40 y2cb3 ff2f fs28 fc1 sc0 ls17f ws0">cj</div><div class="t m5 x1d h26 y2cb5 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>hen<span class="_"> </span>it<span class="_"> </span>would<span class="_"> </span>be<span class="_"> </span>impossible<span class="_ _13"> </span>to<span class="_"> </span>satisfy<span class="_"> </span>the<span class="_"> </span>4-byte<span class="_"> </span>alignment<span class="_"> </span>requirement<span class="_ _13"> </span>for<span class="_"> </span>both</div><div class="t m5 x1d h26 y2cb6 ff7 fs19 fc2 sc0 ls0 ws0">ﬁelds<span class="_ _13"> </span><span class="ffd">i<span class="_ _6"> </span></span>(offset<span class="_ _13"> </span>0)<span class="_ _6"> </span>and<span class="_ _13"> </span><span class="ffd">j<span class="_ _6"> </span></span>(offset<span class="_ _13"> </span>5).<span class="_ _6"> </span>Instead,<span class="_ _13"> </span>the<span class="_ _13"> </span>compiler<span class="_ _6"> </span>inserts<span class="_ _13"> </span>a<span class="_ _13"> </span>3-byte<span class="_ _6"> </span>gap<span class="_ _13"> </span>(shown</div><div class="t m5 x1d h26 y2cb7 ff7 fs19 fc2 sc0 ls0 ws0">here<span class="_"> </span>as<span class="_"> </span>shaded<span class="_"> </span>in<span class="_"> </span>blue)<span class="_"> </span>between<span class="_"> </span>ﬁelds<span class="_"> </span><span class="ffd">c<span class="_ _10"> </span></span>and<span class="_"> </span><span class="ffd">j</span>:</div><div class="t m5 x1d5 h3f y2cb8 ff2e fs27 fc1 sc0 ls0 ws0">Offset </div><div class="t m5 x1d h3f y2cb9 ff2e fs27 fc1 sc0 ls0 ws0">Contents </div><div class="t m5 x1a h40 y2cba ff2f fs28 fc1 sc0 ls0 ws0">i</div><div class="t m5 x17f h3f y2cbb ff2e fs27 fc1 sc0 ls17e ws0">04<span class="_ _e6"></span>5<span class="_ _dd"></span>81<span class="_ _176"></span>2</div><div class="t m5 x22 h40 y2cba ff2f fs28 fc1 sc0 ls180 ws0">cj</div><div class="t m5 x1d h26 y2cbc ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_"> </span>a<span class="_"> </span>result,<span class="_"> </span><span class="ffd">j<span class="_ _10"> </span></span>has<span class="_"> </span>offset<span class="_"> </span>8,<span class="_"> </span>and<span class="_"> </span>the<span class="_"> </span>overall<span class="_"> </span>structure<span class="_"> </span>size<span class="_"> </span>is<span class="_"> </span>12<span class="_"> </span>bytes<span class="_ _1"></span>.<span class="_"> </span>Furthermore<span class="_ _0"></span>,</div><div class="t m5 x1d h26 y2cbd ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>compiler<span class="_"> </span>must<span class="_"> </span>ensure<span class="_"> </span>that<span class="_"> </span>any<span class="_"> </span>pointer<span class="_"> </span><span class="ffd">p<span class="_ _11"> </span></span>of<span class="_"> </span>type<span class="_"> </span><span class="ffd">struct<span class="_ _10"> </span>S1*<span class="_ _10"> </span></span>satisﬁes<span class="_ _11"> </span>a<span class="_"> </span>4-byte</div><div class="t m5 x1d h26 y2cbe ff7 fs19 fc2 sc0 ls0 ws0">alignment.<span class="_ _11"> </span>Using<span class="_ _16"> </span>our<span class="_ _11"> </span>earlier<span class="_ _11"> </span>notation,<span class="_ _16"> </span>let<span class="_ _11"> </span>pointer<span class="_ _16"> </span><span class="ffd">p<span class="_ _11"> </span></span>have<span class="_ _11"> </span>value<span class="_ _16"> </span><span class="ff11">x</span></div><div class="t m5 x158 h6e y2cbf ffd fs25 fc2 sc0 ls0 ws0">p</div><div class="t m5 x159 h26 y2cc0 ff7 fs19 fc2 sc0 ls0 ws0">.<span class="_ _11"> </span>T<span class="_ _0"></span>hen<span class="_ _11"> </span><span class="ff11">x</span></div><div class="t m5 x14e h6e y2cc1 ffd fs25 fc2 sc0 ls0 ws0">p</div><div class="t m5 xdb h26 y2cc0 ff7 fs19 fc2 sc0 ls0 ws0">must</div><div class="t m5 x1d h26 y2cc2 ff7 fs19 fc2 sc0 ls0 ws0">be<span class="_"> </span>a<span class="_ _13"> </span>multiple<span class="_"> </span>of<span class="_"> </span>4.<span class="_ _13"> </span>T<span class="_ _0"></span>his<span class="_"> </span>guarantees<span class="_ _13"> </span>that<span class="_"> </span>both<span class="_"> </span><span class="ffd">p-&gt;i<span class="_ _13"> </span></span>(address<span class="_"> </span><span class="ff11">x</span></div><div class="t m5 x1f3 h6e y2cc3 ffd fs25 fc2 sc0 ls0 ws0">p</div><div class="t m5 x132 h26 y2cc4 ff7 fs19 fc2 sc0 ls0 ws0">)<span class="_"> </span>and<span class="_ _13"> </span><span class="ffd">p-&gt;j<span class="_ _10"> </span></span>(address</div><div class="t m5 x1d h45 y2cc5 ff11 fs19 fc2 sc0 ls0 ws0">x</div><div class="t m5 xc5 h6e yd73 ffd fs25 fc2 sc0 ls0 ws0">p</div><div class="t m5 x161 h46 y543 ff12 fs19 fc2 sc0 ls0 ws0">+<span class="_ _13"> </span><span class="ff7 ls77">8)<span class="_"> </span>will<span class="_"> </span>satisfy<span class="_"> </span>their<span class="_"> </span>4-byte<span class="_"> </span>alignment<span class="_"> </span>requirements<span class="_ _0"></span>.</span></div><div class="t m5 x29 h26 y544 ff7 fs19 fc2 sc0 ls0 ws0">In<span class="_ _13"> </span>addition,<span class="_"> </span>the<span class="_ _13"> </span>compiler<span class="_ _13"> </span>may<span class="_ _13"> </span>need<span class="_ _13"> </span>to<span class="_"> </span>add<span class="_ _13"> </span>padding<span class="_ _13"> </span>to<span class="_ _13"> </span>the<span class="_"> </span>end<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>structure</div><div class="t m5 x1d h26 y545 ff7 fs19 fc2 sc0 ls0 ws0">so<span class="_ _6"> </span>that<span class="_ _6"> </span>each<span class="_ _6"> </span>element<span class="_ _6"> </span>in<span class="_ _13"> </span>an<span class="_ _a"> </span>array<span class="_ _6"> </span>of<span class="_ _13"> </span>structures<span class="_ _a"> </span>will<span class="_ _6"> </span>satisfy<span class="_ _13"> </span>its<span class="_ _a"> </span>alignment<span class="_ _6"> </span>requirement.</div><div class="t m5 x1d h26 y546 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_"> </span>example<span class="_ _1"></span>,<span class="_"> </span>consider<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>structure<span class="_"> </span>declaration:</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
