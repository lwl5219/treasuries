<div id="pf21d" class="pf w2 h11" data-page-no="21d"><div class="pc pc21d w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg21d.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">540<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>5<span class="_ _3d"> </span>Optimizing<span class="_ _10"> </span>Program<span class="_ _10"> </span>Performance</span></div><div class="t m5 x28 h2a y257 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">What<span class="_ _11"> </span>is<span class="_ _11"> </span>a<span class="_ _11"> </span>least<span class="_ _16"> </span>squares<span class="_ _11"> </span>ﬁt?</span></div><div class="t m5 x28 h2b y2d0 ff7 fs1e fc2 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_"> </span>a<span class="_"> </span>set<span class="_ _10"> </span>of<span class="_ _10"> </span>data<span class="_ _10"> </span>points<span class="_ _10"> </span><span class="ff11">(x</span></div><div class="t m5 xc2 h48 y836 ff7 fs2c fc2 sc0 ls0 ws0">1</div><div class="t m5 x15a h49 y2d0 ff11 fs1e fc2 sc0 ls20a ws0">,y</div><div class="t m5 x66 h48 y836 ff7 fs2c fc2 sc0 ls0 ws0">1</div><div class="t m5 x154 h49 y2d0 ff11 fs1e fc2 sc0 ls0 ws0">),<span class="_ _13"> </span>.<span class="_ _13"> </span>.<span class="_ _10"> </span>.<span class="_ _13"> </span>(x</div><div class="t m5 xf0 h54 y836 ff11 fs2c fc2 sc0 ls0 ws0">n</div><div class="t m5 xb7 h49 y2d0 ff11 fs1e fc2 sc0 ls20a ws0">,y</div><div class="t m5 x10f h54 y836 ff11 fs2c fc2 sc0 ls0 ws0">n</div><div class="t m5 x9c h2b y2d0 ff11 fs1e fc2 sc0 ls0 ws0">)<span class="ff7">,<span class="_"> </span>we<span class="_"> </span>often<span class="_"> </span>try<span class="_ _10"> </span>to<span class="_ _10"> </span>draw<span class="_ _10"> </span>a<span class="_ _10"> </span>line<span class="_ _11"> </span>that<span class="_"> </span>best<span class="_"> </span>approximates<span class="_"> </span>the<span class="_"> </span>X–</span></div><div class="t m5 x28 h4a y2d1 ff7 fs1e fc2 sc0 ls0 ws0">Y<span class="_"> </span>trend<span class="_ _11"> </span>represented<span class="_"> </span>by<span class="_ _11"> </span>these<span class="_"> </span>data.<span class="_ _11"> </span>W<span class="_ _0"></span>ith<span class="_"> </span>a<span class="_ _11"> </span>least<span class="_"> </span>squares<span class="_ _11"> </span>ﬁt,<span class="_"> </span>we<span class="_ _11"> </span>look<span class="_ _10"> </span>for<span class="_ _11"> </span>a<span class="_"> </span>line<span class="_ _11"> </span>of<span class="_"> </span>the<span class="_ _11"> </span>form<span class="_ _10"> </span><span class="ff11">y<span class="_"> </span><span class="ff12">=<span class="_ _13"></span></span>mx<span class="_ _10"> </span><span class="ff12">+<span class="_ _10"> </span></span>b</span></div><div class="t m5 x28 h2b y2d2 ff7 fs1e fc2 sc0 ls0 ws0">that<span class="_"> </span>minimizes<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>error<span class="_"> </span>measure:</div><div class="t m5 x137 h4a y4a56 ff11 fs1e fc2 sc0 ls0 ws0">E<span class="_ _2"></span>(m,<span class="_ _13"> </span>b<span class="_ _2"></span>)<span class="_ _13"> </span><span class="ff12">=</span></div><div class="t m5 xe1 h5f y4a57 ff1e fs1e fc2 sc0 ls0 ws0"></div><div class="t m5 x49 h5e y4a58 ff11 fs2c fc2 sc0 ls0 ws0">i<span class="_ _2"></span><span class="ff12">=<span class="ff7">1<span class="_ _0"></span><span class="ff11">,n</span></span></span></div><div class="t m5 x15 h49 y4a59 ff11 fs1e fc2 sc0 ls0 ws0">(mx</div><div class="t m5 x181 h54 y4a5a ff11 fs2c fc2 sc0 ls0 ws0">i</div><div class="t m5 x138 h4a y4a59 ff12 fs1e fc2 sc0 ls0 ws0">+<span class="_ _13"> </span><span class="ff11">b<span class="_ _10"> </span></span>−<span class="_ _13"></span><span class="ff11">y</span></div><div class="t m5 x1b4 h54 y4a5a ff11 fs2c fc2 sc0 ls0 ws0">i</div><div class="t m5 x1c9 h49 y4a59 ff11 fs1e fc2 sc0 ls0 ws0">)</div><div class="t m5 x1c2 h48 y4a5b ff7 fs2c fc2 sc0 ls0 ws0">2</div><div class="t m5 x28 h2b y4a5c ff7 fs1e fc2 sc0 ls0 ws0">An<span class="_"> </span>algorithm<span class="_"> </span>for<span class="_"> </span>computing<span class="_ _13"> </span><span class="ff11">m<span class="_ _10"> </span></span>and<span class="_"> </span><span class="ff11">b<span class="_ _10"> </span></span>can<span class="_"> </span>be<span class="_ _13"> </span>derived<span class="_"> </span>by<span class="_"> </span>ﬁnding<span class="_"> </span>the<span class="_"> </span>derivatives<span class="_ _13"> </span>of<span class="_"> </span><span class="ff11">E<span class="_ _2"></span>(m,<span class="_ _13"> </span>b<span class="_ _2"></span>)<span class="_ _10"> </span></span>with<span class="_ _13"> </span>respect</div><div class="t m5 x28 h2b y4a5d ff7 fs1e fc2 sc0 ls0 ws0">to<span class="_"> </span><span class="ff11">m<span class="_ _10"> </span></span>and<span class="_"> </span><span class="ff11">b<span class="_ _10"> </span></span>and<span class="_"> </span>setting<span class="_"> </span>them<span class="_"> </span>to<span class="_"> </span>0.</div><div class="t m5 x1d h26 y4a5e ff7 fs19 fc2 sc0 ls0 ws0">procedure<span class="_ _1"></span>,<span class="_ _14"> </span>plus<span class="_ _16"> </span>a<span class="_ _16"> </span>linear<span class="_ _11"> </span>factor<span class="_ _16"> </span>of<span class="_ _16"> </span>6.0<span class="_ _16"> </span>or<span class="_ _16"> </span>9.0<span class="_ _16"> </span>cycles<span class="_ _11"> </span>per<span class="_ _16"> </span>element.<span class="_ _16"> </span>F<span class="_ _1"></span>or<span class="_ _16"> </span>large<span class="_ _16"> </span>values</div><div class="t m5 x1d h26 y4a5f ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_"> </span><span class="ff11">n<span class="_ _10"> </span></span>(say<span class="_ _7"></span>,<span class="_"> </span>greater<span class="_"> </span>than<span class="_"> </span>200),<span class="_"> </span>the<span class="_"> </span>run<span class="_"> </span>times<span class="_ _13"> </span>will<span class="_"> </span>be<span class="_"> </span>dominated<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span>linear<span class="_"> </span>factors<span class="_ _3"></span>.</div><div class="t m5 x1d h26 y4a60 ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _16"> </span>refer<span class="_ _16"> </span>to<span class="_ _11"> </span>the<span class="_ _16"> </span>coefﬁcients<span class="_ _16"> </span>in<span class="_ _16"> </span>these<span class="_ _16"> </span>terms<span class="_ _11"> </span>as<span class="_ _16"> </span>the<span class="_ _16"> </span>effective<span class="_ _16"> </span>number<span class="_ _11"> </span>of<span class="_ _16"> </span>cycles<span class="_ _11"> </span>per</div><div class="t m5 x1d h26 y4a61 ff7 fs19 fc2 sc0 ls0 ws0">element.<span class="_ _11"> </span>W<span class="_ _1"></span>e<span class="_ _11"> </span>prefer<span class="_ _11"> </span>measuring<span class="_ _16"> </span>the<span class="_ _11"> </span>number<span class="_ _16"> </span>of<span class="_ _11"> </span>cycles<span class="_"> </span>per<span class="_ _16"> </span><span class="ffa">element<span class="_ _16"> </span></span>rather<span class="_ _16"> </span>than<span class="_ _11"> </span>the</div><div class="t m5 x1d h26 y4a62 ff7 fs19 fc2 sc0 ls0 ws0">number<span class="_ _13"> </span>of<span class="_"> </span>c<span class="_ _0"></span>ycles<span class="_ _13"> </span>per<span class="_"> </span><span class="ffa">iteration<span class="_ _0"></span><span class="ff7">,<span class="_"> </span>because<span class="_ _13"> </span>techniques<span class="_ _13"> </span>such<span class="_"> </span>as<span class="_ _13"> </span>loop<span class="_ _13"> </span>unrolling<span class="_"> </span>allow<span class="_ _13"> </span>us</span></span></div><div class="t m5 x1d h26 y4a63 ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_"> </span>use<span class="_ _11"> </span>fewer<span class="_"> </span>iterations<span class="_ _11"> </span>to<span class="_ _11"> </span>complete<span class="_"> </span>the<span class="_ _11"> </span>computation,<span class="_ _11"> </span>but<span class="_ _11"> </span>our<span class="_"> </span>ultimate<span class="_ _11"> </span>concern<span class="_"> </span>is</div><div class="t m5 x1d h26 y4a64 ff7 fs19 fc2 sc0 ls0 ws0">how<span class="_"> </span>fast<span class="_ _13"> </span>the<span class="_"> </span>procedure<span class="_"> </span>will<span class="_"> </span>run<span class="_ _13"> </span>for<span class="_"> </span>a<span class="_"> </span>given<span class="_"> </span>vector<span class="_ _13"> </span>length.<span class="_"> </span>W<span class="_ _3"></span>e<span class="_"> </span>focus<span class="_"> </span>our<span class="_"> </span>efforts<span class="_ _13"> </span>on</div><div class="t m5 x1d h26 y4a65 ff7 fs19 fc2 sc0 ls0 ws0">minimizing<span class="_ _13"> </span>the<span class="_"> </span>CPE<span class="_ _13"> </span>for<span class="_ _13"> </span>our<span class="_ _13"> </span>computations<span class="_ _1"></span>.<span class="_"> </span>By<span class="_ _13"> </span>this<span class="_ _13"> </span>measure,<span class="_ _13"> </span><span class="ffd">psum2</span>,<span class="_ _13"> </span>with<span class="_"> </span>a<span class="_ _13"> </span>CPE<span class="_ _13"> </span>of</div><div class="t m5 x1d h26 y4a66 ff7 fs19 fc2 sc0 ls0 ws0">6.0,<span class="_"> </span>is<span class="_"> </span>superior<span class="_"> </span>to<span class="_"> </span><span class="ffd">psum1</span>,<span class="_"> </span>with<span class="_"> </span>a<span class="_"> </span>CPE<span class="_"> </span>of<span class="_"> </span>9.0.</div><div class="t m5 x1d h47 y4a67 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>5.2<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>609)</span></div><div class="t m5 x1d h26 y4a68 ff7 fs19 fc1 sc0 ls0 ws0">Later<span class="_ _13"> </span>in<span class="_"> </span>this<span class="_ _13"> </span>chapter<span class="_"> </span>we<span class="_ _13"> </span>will<span class="_ _13"> </span>start<span class="_"> </span>with<span class="_ _13"> </span>a<span class="_ _13"> </span>single<span class="_"> </span>function<span class="_ _13"> </span>and<span class="_"> </span>generate<span class="_ _13"> </span>many<span class="_ _13"> </span>differ<span class="_ _1"></span>-</div><div class="t m5 x1d h26 y4a69 ff7 fs19 fc1 sc0 ls0 ws0">ent<span class="_ _13"> </span>variants<span class="_"> </span>that<span class="_ _13"> </span>preserve<span class="_ _13"> </span>the<span class="_ _13"> </span>function’s<span class="_ _13"> </span>behavior,<span class="_ _13"> </span>but<span class="_"> </span>with<span class="_ _13"> </span>different<span class="_ _13"> </span>performance</div><div class="t m5 x1d h26 y4a6a ff7 fs19 fc1 sc0 ls0 ws0">characteristics<span class="_ _1"></span>.<span class="_ _11"> </span>F<span class="_ _1"></span>or<span class="_ _11"> </span>three<span class="_ _11"> </span>of<span class="_ _11"> </span>these<span class="_ _11"> </span>variants<span class="_ _1"></span>,<span class="_ _16"> </span>we<span class="_"> </span>found<span class="_ _11"> </span>that<span class="_ _11"> </span>the<span class="_ _11"> </span>run<span class="_ _11"> </span>times<span class="_ _11"> </span>(in<span class="_ _16"> </span>clock</div><div class="t m5 x1d h26 y4a6b ff7 fs19 fc1 sc0 ls0 ws0">cycles)<span class="_"> </span>can<span class="_"> </span>be<span class="_"> </span>approximated<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>functions:</div><div class="t m5 x75 h46 y4a6c ff7 fs19 fc1 sc0 ls0 ws0">V<span class="_ _3"></span>ersion<span class="_"> </span>1:<span class="_ _e"> </span>60<span class="_"> </span><span class="ff12">+<span class="_ _13"> </span></span>35<span class="ff11">n</span></div><div class="t m5 x75 h46 y4a6d ff7 fs19 fc1 sc0 ls0 ws0">V<span class="_ _3"></span>ersion<span class="_"> </span>2:<span class="_ _e"> </span>136<span class="_"> </span><span class="ff12">+<span class="_ _13"></span></span>4<span class="ff11">n</span></div><div class="t m5 x75 h46 y4a6e ff7 fs19 fc1 sc0 ls0 ws0">V<span class="_ _3"></span>ersion<span class="_"> </span>3:<span class="_ _e"> </span>157<span class="_"> </span><span class="ff12">+<span class="_ _13"></span></span>1<span class="_ _1"></span><span class="ff11">.<span class="ff7">25</span>n</span></div><div class="t m5 x1b0 h26 y4a6f ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _11"> </span>what<span class="_ _16"> </span>values<span class="_ _11"> </span>of<span class="_ _11"> </span><span class="ff11">n<span class="_ _11"> </span></span>would<span class="_ _16"> </span>each<span class="_ _11"> </span>version<span class="_ _11"> </span>be<span class="_ _16"> </span>the<span class="_ _11"> </span>fastest<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_"> </span>three?<span class="_ _16"> </span>Remember</div><div class="t m5 x1b0 h26 y4a70 ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_"> </span><span class="ff11">n<span class="_ _10"> </span></span>will<span class="_"> </span>always<span class="_"> </span>be<span class="_"> </span>an<span class="_"> </span>integer.</div><div class="t m5 x1d h3b y1051 fff fs24 fc6 sc0 ls0 ws0">5.3<span class="_ _17"> </span><span class="ffe fs18">Program<span class="_"> </span>Example</span></div><div class="t m5 x1d h26 y587 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_"> </span>demonstrate<span class="_"> </span>how<span class="_"> </span>an<span class="_"> </span>abstract<span class="_ _11"> </span>program<span class="_"> </span>can<span class="_"> </span>be<span class="_"> </span>systematically<span class="_"> </span>transformed<span class="_"> </span>into</div><div class="t m5 x1d h26 y588 ff7 fs19 fc1 sc0 ls0 ws0">more<span class="_ _21"> </span>efﬁcient<span class="_ _21"> </span>code,<span class="_ _f"> </span>we<span class="_ _21"> </span>will<span class="_ _21"> </span>use<span class="_ _f"> </span>a<span class="_ _21"> </span>running<span class="_ _f"> </span>example<span class="_ _21"> </span>based<span class="_ _21"> </span>on<span class="_ _f"> </span>the<span class="_ _21"> </span>vector<span class="_ _21"> </span>data</div><div class="t m5 x1d h26 y589 ff7 fs19 fc1 sc0 ls0 ws0">structure<span class="_ _13"> </span>shown<span class="_ _13"> </span>in<span class="_ _13"> </span>F<span class="_ _1"></span>igure<span class="_ _13"> </span>5.3.<span class="_ _13"> </span>A<span class="_ _13"> </span>vector<span class="_ _13"> </span>is<span class="_ _13"> </span>represented<span class="_ _13"> </span>with<span class="_ _13"> </span>two<span class="_ _13"> </span>blocks<span class="_ _13"> </span>of<span class="_ _13"> </span>memory:</div><div class="t m5 x1d h26 ya77 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>header<span class="_"> </span>and<span class="_"> </span>the<span class="_"> </span>data<span class="_"> </span>array<span class="_ _3"></span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>header<span class="_"> </span>is<span class="_"> </span>a<span class="_"> </span>structure<span class="_"> </span>declared<span class="_"> </span>as<span class="_"> </span>follows:</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
