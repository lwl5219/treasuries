<div id="pf24e" class="pf w2 h11" data-page-no="24e"><div class="pc pc24e w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg24e.png"/><div class="t m5 x187 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>5.12<span class="_ _60"> </span>Understanding<span class="_ _10"> </span>Memor<span class="_"> </span>y<span class="_ _10"> </span>Per<span class="_ _2"></span>formance<span class="_ _1b"> </span><span class="ffe fs1e">589</span></div><div class="t m5 x17 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_ _13"> </span>experimentation,<span class="_"> </span>writing<span class="_ _13"> </span>different<span class="_ _13"> </span>versions<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>function<span class="_"> </span>and<span class="_ _13"> </span>then<span class="_ _13"> </span>examining</div><div class="t m5 x17 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>generated<span class="_"> </span>assembly<span class="_"> </span>code<span class="_"> </span>and<span class="_"> </span>measuring<span class="_"> </span>performance<span class="_ _1"></span>.</div><div class="t m5 x17 h47 y4f65 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>5.9<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>612)</span></div><div class="t m5 x17 h26 y4f66 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _15"> </span>traditional<span class="_ _21"> </span>implementation<span class="_ _15"> </span>of<span class="_ _15"> </span>the<span class="_ _15"> </span>merge<span class="_ _15"> </span>step<span class="_ _15"> </span>of<span class="_ _15"> </span>mergesort<span class="_ _15"> </span>requires<span class="_ _21"> </span>three</div><div class="t m5 x17 h26 y4f67 ff7 fs19 fc1 sc0 ls0 ws0">loops<span class="_"> </span>[98]:</div><div class="t m5 x2c h2d y4f68 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">void<span class="_ _1f"> </span>merge(long<span class="_ _e"> </span>src1[],<span class="_ _1f"> </span>long<span class="_ _1f"> </span>src2[],<span class="_ _e"> </span>long<span class="_ _1f"> </span>dest[],<span class="_ _e"> </span>long<span class="_ _1f"> </span>n)<span class="_ _1f"> </span>{</span></div><div class="t m5 x2c h2d y4f69 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _20"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>i1<span class="_ _1f"> </span>=<span class="_ _1f"> </span>0;</span></div><div class="t m5 x2c h2d y4f6a ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>i2<span class="_ _1f"> </span>=<span class="_ _1f"> </span>0;</span></div><div class="t m5 x2c h2e y4f6b ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 x142 h2d y4f6c ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>id<span class="_ _1f"> </span>=<span class="_ _1f"> </span>0;</div><div class="t m5 x2c h2d y4f6d ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _20"> </span><span class="ffd fs1e fc2">while<span class="_ _e"> </span>(i<span class="ls33">1&lt;n&amp;<span class="_ _41"></span>&amp;i<span class="_ _41"></span>2&lt;n<span class="_ _41"></span>){</span></span></div><div class="t m5 x2c h2d y4f6e ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _70"> </span><span class="ffd fs1e fc2">if<span class="_ _e"> </span>(src1[i1]<span class="_ _1f"> </span>&lt;<span class="_ _1f"> </span>src2[i2])</span></div><div class="t m5 x2c h2d y4f6f ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _d1"> </span><span class="ffd fs1e fc2">dest[id++]<span class="_ _1f"> </span>=<span class="_ _e"> </span>src1[i1++];</span></div><div class="t m5 x2c h2d y4f70 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _70"> </span><span class="ffd fs1e fc2">else</span></div><div class="t m5 x2c h2d y4f71 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _d1"> </span><span class="ffd fs1e fc2">dest[id++]<span class="_ _1f"> </span>=<span class="_ _e"> </span>src2[i2++];</span></div><div class="t m5 x17 h2d y4f72 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x17 h2d y4f73 ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _20"> </span><span class="ffd fs1e fc2">while<span class="_ _e"> </span>(i1<span class="_ _1f"> </span>&lt;<span class="_ _1f"> </span>n)</span></div><div class="t m5 x17 h2d y4f74 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _70"> </span><span class="ffd fs1e fc2">dest[id++]<span class="_ _e"> </span>=<span class="_ _1f"> </span>src1[i1++];</span></div><div class="t m5 x17 h2d y4f75 ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _20"> </span><span class="ffd fs1e fc2">while<span class="_ _e"> </span>(i2<span class="_ _1f"> </span>&lt;<span class="_ _1f"> </span>n)</span></div><div class="t m5 x17 h2d y4f76 ff6 fs20 fc6 sc0 ls0 ws0">14<span class="_ _70"> </span><span class="ffd fs1e fc2">dest[id++]<span class="_ _e"> </span>=<span class="_ _1f"> </span>src2[i2++];</span></div><div class="t m5 x17 h2d y4f77 ff6 fs20 fc6 sc0 ls0 ws0">15<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x17 h26 y4f78 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>branches<span class="_ _13"> </span>caused<span class="_"> </span>by<span class="_ _13"> </span>comparing<span class="_"> </span>variables<span class="_ _13"> </span><span class="ffd">i1<span class="_ _10"> </span></span>and<span class="_"> </span><span class="ffd">i2<span class="_ _13"> </span></span>to<span class="_"> </span><span class="ffd">n<span class="_ _13"> </span></span>have<span class="_"> </span>good<span class="_ _13"> </span>prediction</div><div class="t m5 x17 h26 y4f79 ff7 fs19 fc2 sc0 ls0 ws0">performance—the<span class="_ _14"> </span>only<span class="_ _16"> </span>mispredictions<span class="_ _14"> </span>occur<span class="_ _14"> </span>when<span class="_ _14"> </span>they<span class="_ _14"> </span>ﬁrst<span class="_ _14"> </span>become<span class="_ _14"> </span>false<span class="_ _1"></span>.<span class="_ _14"> </span>The</div><div class="t m5 x17 h26 y4f7a ff7 fs19 fc2 sc0 ls0 ws0">comparison<span class="_"> </span>between<span class="_ _11"> </span>values<span class="_ _11"> </span><span class="ffd">src1[i1]<span class="_ _10"> </span></span>and<span class="_ _11"> </span><span class="ffd">src2[i2]<span class="_ _11"> </span></span>(line<span class="_"> </span>6),<span class="_ _11"> </span>on<span class="_ _11"> </span>the<span class="_ _11"> </span>other<span class="_"> </span>hand,</div><div class="t m5 x17 h26 y4f7b ff7 fs19 fc2 sc0 ls0 ws0">is<span class="_ _16"> </span>highly<span class="_ _14"> </span>unpredictable<span class="_ _14"> </span>for<span class="_ _16"> </span>typical<span class="_ _14"> </span>data.<span class="_ _14"> </span>T<span class="_ _1"></span>his<span class="_ _14"> </span>comparison<span class="_ _14"> </span>controls<span class="_ _14"> </span>a<span class="_ _16"> </span>conditional</div><div class="t m5 x17 h26 y4f7c ff7 fs19 fc2 sc0 ls0 ws0">branch,<span class="_ _13"> </span>yielding<span class="_ _13"> </span>a<span class="_ _13"> </span>CPE<span class="_ _13"> </span>(where<span class="_ _13"> </span>the<span class="_ _13"> </span>number<span class="_ _13"> </span>of<span class="_ _6"> </span>elements<span class="_ _13"> </span>is<span class="_ _13"> </span>2<span class="ff11">n</span>)<span class="_ _13"> </span>of<span class="_ _13"> </span>around<span class="_ _13"> </span>15.0<span class="_ _13"> </span>when</div><div class="t m5 x17 h26 y4f7d ff7 fs19 fc2 sc0 ls0 ws0">run<span class="_"> </span>on<span class="_"> </span>random<span class="_"> </span>data.</div><div class="t m5 x26 h26 y4f7e ff7 fs19 fc2 sc0 ls0 ws0">Rewrite<span class="_ _16"> </span>the<span class="_ _16"> </span>code<span class="_ _14"> </span>so<span class="_ _16"> </span>that<span class="_ _16"> </span>the<span class="_ _14"> </span>effect<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _14"> </span>conditional<span class="_ _16"> </span>statement<span class="_ _16"> </span>in<span class="_ _14"> </span>the<span class="_ _16"> </span>ﬁrst</div><div class="t m5 x17 h26 y4f7f ff7 fs19 fc2 sc0 ls0 ws0">loop<span class="_"> </span>(lines<span class="_"> </span>6–9)<span class="_"> </span>can<span class="_"> </span>be<span class="_"> </span>implemented<span class="_"> </span>with<span class="_"> </span>a<span class="_"> </span>conditional<span class="_"> </span>move<span class="_ _1"></span>.</div><div class="t m5 x17 h3b y5fc fff fs24 fc6 sc0 ls0 ws0">5.12</div><div class="t m5 x123 h3e y5fd ffe fs18 fc6 sc0 ls0 ws0">Understanding<span class="_"> </span>Memory<span class="_"> </span>Per<span class="_ _2"></span>formance</div><div class="t m5 x17 h26 y2972 ff7 fs19 fc1 sc0 ls0 ws0">All<span class="_ _14"> </span>of<span class="_ _14"> </span>the<span class="_ _14"> </span>code<span class="_ _15"> </span>we<span class="_ _14"> </span>have<span class="_ _14"> </span>written<span class="_ _15"> </span>thus<span class="_ _14"> </span>far,<span class="_ _14"> </span>and<span class="_ _15"> </span>all<span class="_ _14"> </span>the<span class="_ _14"> </span>tests<span class="_ _14"> </span>we<span class="_ _15"> </span>have<span class="_ _14"> </span>run,<span class="_ _15"> </span>access</div><div class="t m5 x17 h26 y4f80 ff7 fs19 fc1 sc0 ls0 ws0">relatively<span class="_ _16"> </span>small<span class="_ _11"> </span>amounts<span class="_ _16"> </span>of<span class="_ _16"> </span>memory<span class="_ _3"></span>.<span class="_ _16"> </span>F<span class="_ _1"></span>or<span class="_ _16"> </span>example<span class="_ _1"></span>,<span class="_ _16"> </span>the<span class="_ _16"> </span>combining<span class="_ _16"> </span>routines<span class="_ _16"> </span>were</div><div class="t m5 x17 h26 y4f81 ff7 fs19 fc1 sc0 ls0 ws0">measured<span class="_"> </span>over<span class="_ _13"> </span>vectors<span class="_"> </span>of<span class="_ _13"> </span>length<span class="_"> </span>less<span class="_ _13"> </span>than<span class="_"> </span>1,000<span class="_ _13"> </span>elements<span class="_ _0"></span>,<span class="_"> </span>requiring<span class="_ _13"> </span>no<span class="_"> </span>more<span class="_ _13"> </span>than</div><div class="t m5 x17 h26 y4f82 ff7 fs19 fc1 sc0 ls0 ws0">8,000<span class="_"> </span>bytes<span class="_ _11"> </span>of<span class="_"> </span>data.<span class="_ _11"> </span>All<span class="_"> </span>modern<span class="_ _11"> </span>processors<span class="_ _11"> </span>contain<span class="_"> </span>one<span class="_ _11"> </span>or<span class="_"> </span>more<span class="_ _11"> </span><span class="ffa">cache<span class="_"> </span></span>memories</div><div class="t m5 x17 h26 y4f83 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _16"> </span>provide<span class="_ _11"> </span>fast<span class="_ _16"> </span>access<span class="_ _16"> </span>to<span class="_ _11"> </span>such<span class="_ _16"> </span>small<span class="_ _16"> </span>amounts<span class="_ _16"> </span>of<span class="_ _11"> </span>memory<span class="_ _3"></span>.<span class="_ _16"> </span>In<span class="_ _16"> </span>this<span class="_ _11"> </span>section,<span class="_ _16"> </span>we<span class="_ _16"> </span>will</div><div class="t m5 x17 h26 y2878 ff7 fs19 fc1 sc0 ls0 ws0">further<span class="_"> </span>investigate<span class="_"> </span>the<span class="_"> </span>performance<span class="_ _11"> </span>of<span class="_"> </span>programs<span class="_"> </span>that<span class="_"> </span>involve<span class="_ _11"> </span>load<span class="_"> </span>(reading<span class="_"> </span>from</div><div class="t m5 x17 h26 y2879 ff7 fs19 fc1 sc0 ls0 ws0">memory<span class="_"> </span>into<span class="_ _11"> </span>registers)<span class="_ _11"> </span>and<span class="_ _11"> </span>store<span class="_ _11"> </span>(writing<span class="_"> </span>from<span class="_ _11"> </span>registers<span class="_ _11"> </span>to<span class="_ _11"> </span>memory)<span class="_ _11"> </span>operations<span class="_ _1"></span>,</div><div class="t m5 x17 h26 y287a ff7 fs19 fc1 sc0 ls0 ws0">considering<span class="_ _11"> </span>only<span class="_ _16"> </span>the<span class="_ _11"> </span>cases<span class="_ _11"> </span>where<span class="_ _16"> </span>all<span class="_ _11"> </span>data<span class="_ _16"> </span>are<span class="_ _11"> </span>held<span class="_ _11"> </span>in<span class="_ _16"> </span>cache<span class="_ _1"></span>.<span class="_ _16"> </span>In<span class="_ _11"> </span>Chapter<span class="_ _16"> </span>6,<span class="_ _11"> </span>we<span class="_ _16"> </span>go</div><div class="t m5 x17 h26 y287b ff7 fs19 fc1 sc0 ls0 ws0">into<span class="_"> </span>much<span class="_ _13"> </span>more<span class="_"> </span>detail<span class="_"> </span>about<span class="_"> </span>how<span class="_ _13"> </span>caches<span class="_"> </span>work,<span class="_"> </span>their<span class="_ _13"> </span>performance<span class="_"> </span>characteristics<span class="_ _1"></span>,</div><div class="t m5 x17 h26 y287c ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_"> </span>how<span class="_"> </span>to<span class="_"> </span>write<span class="_"> </span>code<span class="_"> </span>that<span class="_"> </span>makes<span class="_"> </span>best<span class="_"> </span>use<span class="_"> </span>of<span class="_"> </span>caches<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
