<div id="pf1d4" class="pf w2 h11" data-page-no="1d4"><div class="pc pc1d4 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1d4.png"/><div class="t m5 x13d h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>4.5<span class="_ _60"> </span>Pipelined<span class="_ _10"> </span>Y86-64<span class="_ _10"> </span>Implementations<span class="_ _3e"> </span><span class="ffe fs1e">467</span></div><div class="t m5 xfb ha2 y40b3 ff49 fs65 fc1 sc0 ls0 ws0">D</div><div class="t m5 x101 ha2 y40b4 ff49 fs65 fc1 sc0 ls0 ws0">valA<span class="_ _1"></span>      R[</div><div class="t m5 xc0 ha3 y40b5 ff4a fs66 fc1 sc0 ls0 ws0">%rdx<span class="ff49 fs65">] = 10</span></div><div class="t m5 x101 ha2 y40b6 ff49 fs65 fc1 sc0 ls0 ws0">valB      R[</div><div class="t m5 xc0 ha3 y40b7 ff4a fs66 fc1 sc0 ls0 ws0">%rax<span class="ff49 fs65">] = 0</span></div><div class="t m5 x238 ha2 y40b8 ff49 fs65 fc1 sc0 ls0 ws0">F</div><div class="t m5 x17 ha3 y40b9 ff4a fs66 fc1 sc0 ls0 ws0">0x000: irmovq $10,%rdx</div><div class="t m5 x17 ha3 y40ba ff4a fs66 fc1 sc0 ls0 ws0"># prog2</div><div class="c x17 y40bb w6 ha4"><div class="t m5 x0 ha3 y40bc ff4a fs66 fc3 sc1 ls0 ws0"># prog2</div></div><div class="t m5 x17 ha3 y40bd ff4a fs66 fc1 sc0 ls0 ws0">0x00a: irmovq  $3,%rax</div><div class="t m5 x17 ha3 y40be ff4a fs66 fc1 sc0 ls0 ws0">0x014: nop</div><div class="t m5 x17 ha3 y40bf ff4a fs66 fc1 sc0 ls0 ws0">0x015: nop</div><div class="t m5 x17 ha3 y40c0 ff4a fs66 fc1 sc0 ls0 ws0">0x016: addq %rdx,%rax</div><div class="t m5 x17 ha3 y40c1 ff4a fs66 fc1 sc0 ls0 ws0">0x018: halt</div><div class="t m5 x125 ha2 y40b9 ff49 fs65 fc1 sc0 ls1d1 ws0">DE<span class="_ _1"></span>M<span class="_ _4"></span>W</div><div class="t m5 xe2 ha2 y40c2 ff49 fs65 fc1 sc0 ls1d2 ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x68 ha2 y40c3 ff49 fs65 fc1 sc0 ls1d3 ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x1b3 ha2 y40c4 ff49 fs65 fc1 sc0 ls1d3 ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x208 ha2 y40c5 ff49 fs65 fc1 sc0 ls1d3 ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x1c2 ha2 y40c6 ff49 fs65 fc1 sc0 ls1d2 ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x82 ha2 y40c7 ff49 fs65 fc1 sc0 ls0 ws0">Cycle 6</div><div class="t m5 x183 ha5 y40c8 ff49 fs67 fc6 sc0 ls1d4 ws0">12345</div><div class="t m5 xc0 ha5 y40c9 ff49 fs67 fc6 sc0 ls0 ws0">6</div><div class="t m5 x93 ha5 y40ca ff49 fs67 fc6 sc0 ls0 ws0">7</div><div class="t m5 x18a ha5 y40cb ff49 fs67 fc6 sc0 ls0 ws0">8</div><div class="t m5 x1bd ha5 y40cc ff49 fs67 fc6 sc0 ls1d5 ws0">91<span class="_ _1c5"></span>0</div><div class="t m5 x12d ha2 y40cd ff49 fs65 fc1 sc0 ls0 ws0">W</div><div class="t m5 xfd ha2 y40ce ff49 fs65 fc1 sc0 ls0 ws0">R[</div><div class="t m5 x13d ha3 y40cf ff4a fs66 fc1 sc0 ls0 ws0">%rax<span class="ff49 fs65">]      3</span></div><div class="t m5 x1fd ha2 y40d0 ff1f fs65 fc1 sc0 ls0 ws0">Error</div><div class="t m8 x1de ha2 y40d1 ff49 fs65 fc1 sc0 ls0 ws0">. . .</div><div class="t m5 x17 h3a y40d2 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _14"> </span>4.44<span class="_ _66"> </span><span class="fc1">Pipelined<span class="_ _14"> </span>execution<span class="_ _14"> </span>of<span class="_ _14"> </span><span class="ffd fs19">prog2<span class="_ _14"> </span></span>without<span class="_ _14"> </span>special<span class="_ _14"> </span>pipeline<span class="_ _16"> </span>control.<span class="_ _14"> </span><span class="ff6">The</span></span></div><div class="t m5 x17 h34 y40d3 ff6 fs16 fc1 sc0 ls0 ws0">write<span class="_ _10"> </span>to<span class="_ _13"> </span>program<span class="_ _10"> </span>register</div><div class="t m5 x66 h3a y40d4 ffd fs19 fc1 sc0 ls0 ws0">%rax<span class="_ _10"> </span><span class="ff6 fs16">does<span class="_ _13"> </span>not<span class="_ _10"> </span>occur<span class="_ _10"> </span>until<span class="_ _13"> </span>the<span class="_ _10"> </span>start<span class="_ _10"> </span>of<span class="_ _13"> </span>cycle<span class="_ _10"> </span>7,<span class="_ _10"> </span>and<span class="_ _13"> </span>so<span class="_ _10"> </span>the<span class="_ _10"> </span></span>addq</div><div class="t m5 x17 h34 y40d5 ff6 fs16 fc1 sc0 ls0 ws0">instruction<span class="_ _10"> </span>gets<span class="_ _11"> </span>the<span class="_ _10"> </span>incorrect<span class="_ _10"> </span>value<span class="_ _11"> </span>for<span class="_ _10"> </span>this<span class="_ _11"> </span>register<span class="_ _10"> </span>in<span class="_ _11"> </span>the<span class="_ _10"> </span>decode<span class="_ _10"> </span>stage.</div><div class="t m5 x17 h26 y2154 ff7 fs19 fc1 sc0 ls0 ws0">dependencies<span class="_ _1"></span>.<span class="_ _14"> </span>Let<span class="_ _14"> </span>us<span class="_ _15"> </span>see<span class="_ _14"> </span>what<span class="_ _14"> </span>happens<span class="_ _14"> </span>as<span class="_ _15"> </span>these<span class="_ _14"> </span><span class="ffd">nop<span class="_ _14"> </span></span>instructions<span class="_ _15"> </span>are<span class="_ _14"> </span>removed.</div><div class="t m5 x17 h26 y40a2 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _14"> </span>4.44<span class="_ _16"> </span>illustrates<span class="_ _16"> </span>the<span class="_ _16"> </span>pipeline<span class="_ _16"> </span>ﬂow<span class="_ _14"> </span>of<span class="_ _16"> </span>a<span class="_ _16"> </span>program,<span class="_ _14"> </span>named<span class="_ _16"> </span><span class="ffd">prog2</span>,<span class="_ _14"> </span>containing</div><div class="t m5 x17 h26 y40a3 ff7 fs19 fc1 sc0 ls0 ws0">two<span class="_ _16"> </span><span class="ffd">nop<span class="_ _11"> </span></span>instructions<span class="_ _16"> </span>between<span class="_ _16"> </span>the<span class="_ _16"> </span>two<span class="_ _16"> </span><span class="ffd">irmovq<span class="_ _11"> </span></span>instructions<span class="_ _16"> </span>generating<span class="_ _16"> </span>values<span class="_ _16"> </span>for</div><div class="t m5 x17 h26 y40a4 ff7 fs19 fc1 sc0 ls0 ws0">registers<span class="_ _14"> </span><span class="ffd">%rdx<span class="_ _14"> </span></span>and<span class="_ _14"> </span><span class="ffd">%rax<span class="_ _14"> </span></span>and<span class="_ _15"> </span>the<span class="_ _14"> </span><span class="ffd">addq<span class="_ _14"> </span></span>instruction<span class="_ _14"> </span>having<span class="_ _15"> </span>these<span class="_ _14"> </span>two<span class="_ _14"> </span>registers<span class="_ _14"> </span>as</div><div class="t m5 x17 h26 y40a5 ff7 fs19 fc1 sc0 ls0 ws0">operands<span class="_ _1"></span>.<span class="_ _16"> </span>In<span class="_ _16"> </span>this<span class="_ _16"> </span>case<span class="_ _1"></span>,<span class="_ _16"> </span>the<span class="_ _16"> </span>crucial<span class="_ _16"> </span>step<span class="_ _16"> </span>occurs<span class="_ _16"> </span>in<span class="_ _16"> </span>cycle<span class="_ _11"> </span>6,<span class="_ _14"> </span>when<span class="_ _16"> </span>the<span class="_ _16"> </span><span class="ffd">addq<span class="_ _16"> </span></span>instruc-</div><div class="t m5 x17 h26 y40a6 ff7 fs19 fc1 sc0 ls0 ws0">tion<span class="_ _16"> </span>reads<span class="_ _16"> </span>its<span class="_ _11"> </span>operands<span class="_ _16"> </span>from<span class="_ _16"> </span>the<span class="_ _16"> </span>register<span class="_ _16"> </span>ﬁle<span class="_ _1"></span>.<span class="_ _16"> </span>An<span class="_ _16"> </span>expanded<span class="_ _16"> </span>view<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span>pipeline</div><div class="t m5 x17 h26 y40a7 ff7 fs19 fc1 sc0 ls0 ws0">activities<span class="_ _11"> </span>during<span class="_ _16"> </span>this<span class="_ _11"> </span>cycle<span class="_ _11"> </span>is<span class="_ _16"> </span>shown<span class="_ _11"> </span>at<span class="_ _11"> </span>the<span class="_ _16"> </span>bottom<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span>ﬁgure<span class="_ _0"></span>.<span class="_ _11"> </span>The<span class="_"> </span>ﬁrst<span class="_ _16"> </span><span class="ffd">irmovq</span></div><div class="t m5 x17 h26 y40a8 ff7 fs19 fc1 sc0 ls0 ws0">instruction<span class="_ _13"> </span>has<span class="_ _13"> </span>passed<span class="_ _13"> </span>through<span class="_ _13"> </span>the<span class="_ _13"> </span>write-back<span class="_ _13"> </span>stage,<span class="_ _13"> </span>and<span class="_ _13"> </span>so<span class="_ _13"> </span>program<span class="_ _13"> </span>register<span class="_ _13"> </span><span class="ffd">%rdx</span></div><div class="t m5 x17 h26 y40a9 ff7 fs19 fc1 sc0 ls0 ws0">has<span class="_ _13"> </span>been<span class="_ _13"> </span>updated<span class="_ _13"> </span>in<span class="_ _6"> </span>the<span class="_ _13"> </span>register<span class="_ _13"> </span>ﬁle<span class="_ _1"></span>.<span class="_ _13"> </span>T<span class="_ _0"></span>he<span class="_ _13"> </span>second<span class="_ _13"> </span><span class="ffd">irmovq<span class="_ _13"> </span></span>instruction<span class="_ _6"> </span>is<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_ _13"> </span>write-</div><div class="t m5 x17 h26 y40aa ff7 fs19 fc1 sc0 ls0 ws0">back<span class="_ _13"> </span>stage<span class="_ _13"> </span>during<span class="_"> </span>this<span class="_ _13"> </span>c<span class="_ _0"></span>ycle<span class="_ _1"></span>,<span class="_"> </span>and<span class="_ _13"> </span>so<span class="_ _13"> </span>the<span class="_ _13"> </span>write<span class="_"> </span>to<span class="_ _13"> </span>program<span class="_ _13"> </span>register<span class="_ _13"> </span><span class="ffd">%rax<span class="_ _13"> </span></span>only<span class="_"> </span>occurs</div><div class="t m5 x17 h26 y40ab ff7 fs19 fc1 sc0 ls0 ws0">at<span class="_ _13"> </span>the<span class="_"> </span>start<span class="_ _13"> </span>of<span class="_"> </span>cycle<span class="_ _13"> </span>7<span class="_"> </span>as<span class="_ _13"> </span>the<span class="_ _13"> </span>clock<span class="_"> </span>rises<span class="_ _1"></span>.<span class="_"> </span>As<span class="_ _13"> </span>a<span class="_ _13"> </span>result,<span class="_"> </span>the<span class="_"> </span>incorrect<span class="_ _13"> </span>value<span class="_ _13"> </span>zero<span class="_"> </span>would</div><div class="t m5 x17 h26 y40ac ff7 fs19 fc1 sc0 ls0 ws0">be<span class="_ _16"> </span>read<span class="_ _14"> </span>for<span class="_ _16"> </span>register<span class="_ _14"> </span><span class="ffd">%rax<span class="_ _14"> </span></span>(recall<span class="_ _16"> </span>that<span class="_ _14"> </span>we<span class="_ _14"> </span>assume<span class="_ _16"> </span>all<span class="_ _14"> </span>registers<span class="_ _16"> </span>are<span class="_ _14"> </span>initially<span class="_ _14"> </span>zero),</div><div class="t m5 x17 h26 y40ad ff7 fs19 fc1 sc0 ls0 ws0">since<span class="_ _13"> </span>the<span class="_ _13"> </span>pending<span class="_"> </span>write<span class="_ _13"> </span>for<span class="_ _13"> </span>this<span class="_ _13"> </span>register<span class="_ _13"> </span>has<span class="_"> </span>not<span class="_ _13"> </span>yet<span class="_ _13"> </span>occurred.<span class="_ _13"> </span>Clearly<span class="_ _3"></span>,<span class="_ _13"> </span>we<span class="_"> </span>will<span class="_ _13"> </span>have</div><div class="t m5 x17 h26 y40ae ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_"> </span>adapt<span class="_"> </span>our<span class="_"> </span>pipeline<span class="_"> </span>to<span class="_"> </span>handle<span class="_"> </span>this<span class="_"> </span>hazard<span class="_"> </span>properly<span class="_ _3"></span>.</div><div class="t m5 x26 h26 y40af ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _e"> </span>4.45<span class="_ _21"> </span>shows<span class="_ _f"> </span>what<span class="_ _e"> </span>happens<span class="_ _21"> </span>when<span class="_ _f"> </span>we<span class="_ _e"> </span>have<span class="_ _21"> </span>only<span class="_ _f"> </span>one<span class="_ _f"> </span><span class="ffd">nop<span class="_ _e"> </span></span>instruction</div><div class="t m5 x17 h26 y40b0 ff7 fs19 fc1 sc0 ls0 ws0">between<span class="_ _15"> </span>the<span class="_ _15"> </span><span class="ffd">irmovq<span class="_ _15"> </span></span>instructions<span class="_ _21"> </span>and<span class="_ _15"> </span>the<span class="_ _15"> </span><span class="ffd">addq<span class="_ _21"> </span></span>instruction,<span class="_ _21"> </span>yielding<span class="_ _15"> </span>a<span class="_ _21"> </span>program</div><div class="t m5 x17 h26 y40b1 ffd fs19 fc1 sc0 ls0 ws0">prog3<span class="ff7">.<span class="_ _11"> </span>Now<span class="_ _16"> </span>we<span class="_ _11"> </span>must<span class="_ _16"> </span>examine<span class="_ _11"> </span>the<span class="_ _11"> </span>behavior<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>pipeline<span class="_ _11"> </span>during<span class="_ _16"> </span>c<span class="_ _0"></span>ycle<span class="_ _11"> </span>5<span class="_ _16"> </span>as<span class="_ _11"> </span>the</span></div><div class="t m5 x17 h26 y40b2 ffd fs19 fc1 sc0 ls0 ws0">addq<span class="_ _21"> </span><span class="ff7">instruction<span class="_ _21"> </span>passes<span class="_ _21"> </span>through<span class="_ _21"> </span>the<span class="_ _21"> </span>decode<span class="_ _21"> </span>stage.<span class="_ _15"> </span>Unfortunately<span class="_ _3"></span>,<span class="_ _f"> </span>the<span class="_ _21"> </span>pending</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
