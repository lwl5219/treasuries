<div id="pf3b8" class="pf w2 h11" data-page-no="3b8"><div class="pc pc3b8 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg3b8.png"/><div class="t m5 x107 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Solutions<span class="_ _10"> </span>to<span class="_ _10"> </span>Practice<span class="_ _10"> </span>Problems<span class="_ _1b"> </span><span class="ffe fs1e">951</span></div><div class="t m5 x1b6 h2d y140c ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>(Fork()<span class="_ _1f"> </span>==<span class="_ _1f"> </span>0)<span class="_ _e"> </span>{<span class="_ _1f"> </span>/*<span class="_ _e"> </span>child<span class="_ _1f"> </span>*/</div><div class="t m5 x21e h2d y140d ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>What<span class="_ _1f"> </span>code<span class="_ _1f"> </span>is<span class="_ _e"> </span>the<span class="_ _1f"> </span>shell<span class="_ _e"> </span>executing<span class="_ _1f"> </span>right<span class="_ _1f"> </span>here?<span class="_ _e"> </span>*/</div><div class="t m5 x21e h2d y1b95 ffd fs1e fc2 sc0 ls0 ws0">Execve(&quot;fstatcheck&quot;,<span class="_ _e"> </span>argv,<span class="_ _1f"> </span>envp);</div><div class="t m5 x1b6 h2d y2122 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x17 h28 y7991 ffe fs1e fc6 sc0 ls0 ws0">10.10</div><div class="t m5 x1d2 h73 y7992 ff10 fs19 fc6 sc0 ls0 ws0">◆◆</div><div class="t m5 x17 h26 y7993 ff7 fs19 fc1 sc0 ls0 ws0">Modify<span class="_"> </span>the<span class="_"> </span><span class="ffd">cpfile<span class="_ _10"> </span></span>program<span class="_"> </span>in<span class="_ _13"> </span>Figure<span class="_"> </span>10.5<span class="_ _13"> </span>so<span class="_"> </span>that<span class="_"> </span>it<span class="_"> </span>takes<span class="_"> </span>an<span class="_"> </span>optional<span class="_"> </span>command-</div><div class="t m5 x17 h26 y7994 ff7 fs19 fc1 sc0 ls0 ws0">line<span class="_ _11"> </span>argument<span class="_ _16"> </span><span class="ffd">infile</span><span class="ls2d7">.I<span class="_ _49"></span>f<span class="ffd ls0">infile<span class="_ _11"> </span><span class="ff7">is<span class="_ _16"> </span>given,<span class="_ _11"> </span>then<span class="_ _16"> </span>copy<span class="_ _11"> </span></span>infile<span class="_ _16"> </span><span class="ff7">to<span class="_ _11"> </span>standard<span class="_ _16"> </span>output;</span></span></span></div><div class="t m5 x17 h26 y7995 ff7 fs19 fc1 sc0 ls0 ws0">otherwise<span class="_ _1"></span>,<span class="_"> </span>copy<span class="_ _13"> </span>standard<span class="_ _13"> </span>input<span class="_ _13"> </span>to<span class="_ _13"> </span>standard<span class="_ _13"> </span>output<span class="_ _13"> </span>as<span class="_ _13"> </span>before<span class="_ _1"></span>.<span class="_ _13"> </span>T<span class="_ _0"></span>he<span class="_ _13"> </span>twist<span class="_ _13"> </span>is<span class="_ _13"> </span>that<span class="_ _13"> </span>your</div><div class="t m5 x17 h26 y7996 ff7 fs19 fc1 sc0 ls0 ws0">solution<span class="_"> </span>must<span class="_"> </span>use<span class="_"> </span>the<span class="_"> </span>original<span class="_"> </span>copy<span class="_"> </span>loop<span class="_"> </span>(lines<span class="_"> </span>9–11)<span class="_ _13"> </span>for<span class="_"> </span>both<span class="_"> </span>cases<span class="_ _1"></span>.<span class="_"> </span>Y<span class="_ _3"></span>ou<span class="_"> </span>are<span class="_"> </span>only</div><div class="t m5 x17 h26 y7997 ff7 fs19 fc1 sc0 ls0 ws0">allowed<span class="_ _13"> </span>to<span class="_ _13"> </span>insert<span class="_ _13"> </span>code<span class="_ _1"></span>,<span class="_ _13"> </span>and<span class="_ _13"> </span>you<span class="_ _13"> </span>are<span class="_ _13"> </span>not<span class="_ _13"> </span>allowed<span class="_ _13"> </span>to<span class="_ _13"> </span>change<span class="_ _13"> </span>any<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>existing<span class="_ _13"> </span>code<span class="_ _1"></span>.</div><div class="t m5 x17 h29 y7998 ffe fs14 fc1 sc0 ls0 ws0">Solutions<span class="_"> </span>to<span class="_"> </span>Practice<span class="_"> </span>Problems</div><div class="t m5 x17 h28 y7999 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>10.1<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>931)</span></div><div class="t m5 x17 h26 y799a ff7 fs19 fc1 sc0 ls0 ws0">Unix<span class="_"> </span>processes<span class="_"> </span>begin<span class="_"> </span>life<span class="_"> </span>with<span class="_"> </span>open<span class="_ _11"> </span>descriptors<span class="_"> </span>assigned<span class="_"> </span>to<span class="_"> </span><span class="ffd">stdin<span class="_ _11"> </span></span>(descriptor<span class="_"> </span>0),</div><div class="t m5 x17 h26 y799b ffd fs19 fc1 sc0 ls0 ws0">stdout<span class="_ _16"> </span><span class="ff7">(descriptor<span class="_ _16"> </span>1),<span class="_ _14"> </span>and<span class="_ _16"> </span></span>stderr<span class="_ _16"> </span><span class="ff7">(descriptor<span class="_ _16"> </span>2).<span class="_ _14"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span><span class="ffd">open<span class="_ _14"> </span></span>function<span class="_ _16"> </span>always<span class="_ _16"> </span>re-</span></div><div class="t m5 x17 h26 y799c ff7 fs19 fc1 sc0 ls0 ws0">turns<span class="_ _13"> </span>the<span class="_ _13"> </span>lowest<span class="_ _13"> </span>unopened<span class="_"> </span>descriptor<span class="_ _1"></span>,<span class="_"> </span>so<span class="_ _13"> </span>the<span class="_ _13"> </span>ﬁrst<span class="_ _13"> </span>call<span class="_ _13"> </span>to<span class="_"> </span><span class="ffd">open<span class="_ _13"> </span></span>returns<span class="_ _13"> </span>descriptor<span class="_ _13"> </span>3.</div><div class="t m5 x17 h26 y799d ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>call<span class="_"> </span>to<span class="_"> </span>the<span class="_ _13"> </span><span class="ffd">close<span class="_ _10"> </span></span>function<span class="_"> </span>frees<span class="_"> </span>up<span class="_"> </span>descriptor<span class="_ _13"> </span>3.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>ﬁnal<span class="_"> </span>call<span class="_"> </span>to<span class="_ _13"> </span><span class="ffd">open<span class="_ _10"> </span></span>returns</div><div class="t m5 x17 h26 y799e ff7 fs19 fc1 sc0 ls0 ws0">descriptor<span class="_"> </span>3,<span class="_"> </span>and<span class="_"> </span>thus<span class="_"> </span>the<span class="_"> </span>output<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>program<span class="_"> </span>is<span class="_"> </span><span class="ffd ls4b">f<span class="_ _49"></span>d<span class="_ _42"></span>2=3<span class="_ _49"></span><span class="ff7 ls0">.</span></span></div><div class="t m5 x17 h28 y799f ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>10.2<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>944)</span></div><div class="t m5 x17 h26 y79a0 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _14"> </span>descriptors<span class="_ _16"> </span><span class="ffd">fd1<span class="_ _16"> </span></span>and<span class="_ _14"> </span><span class="ffd">fd2<span class="_ _16"> </span></span>each<span class="_ _16"> </span>have<span class="_ _14"> </span>their<span class="_ _16"> </span>own<span class="_ _14"> </span>open<span class="_ _16"> </span>ﬁle<span class="_ _16"> </span>table<span class="_ _14"> </span>entry<span class="_ _3"></span>,<span class="_ _14"> </span>so<span class="_ _16"> </span>each</div><div class="t m5 x17 h26 y79a1 ff7 fs19 fc1 sc0 ls0 ws0">descriptor<span class="_ _13"> </span>has<span class="_"> </span>its<span class="_ _13"> </span>own<span class="_ _13"> </span>ﬁle<span class="_"> </span>position<span class="_ _13"> </span>for<span class="_"> </span><span class="ffd">foobar.txt</span>.<span class="_ _13"> </span>T<span class="_ _1"></span>hus<span class="_ _1"></span>,<span class="_"> </span>the<span class="_ _13"> </span>read<span class="_"> </span>from<span class="_ _13"> </span><span class="ffd">fd2<span class="_ _13"> </span></span>reads</div><div class="t m5 x17 h26 y79a2 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>ﬁrst<span class="_"> </span>byte<span class="_"> </span>of<span class="_"> </span><span class="ffd">foobar.txt</span>,<span class="_"> </span>and<span class="_"> </span>the<span class="_"> </span>output<span class="_"> </span>is</div><div class="t m5 x17 h2d y79a3 ffd fs1e fc2 sc0 ls33 ws0">c=f</div><div class="t m5 x17 h26 y79a4 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_"> </span>not</div><div class="t m5 x17 h2d y79a5 ffd fs1e fc2 sc0 ls33 ws0">c=o</div><div class="t m5 x17 h26 y79a6 ff7 fs19 fc2 sc0 ls0 ws0">as<span class="_"> </span>you<span class="_"> </span>might<span class="_"> </span>have<span class="_"> </span>thought<span class="_"> </span>initially<span class="_ _3"></span>.</div><div class="t m5 x17 h28 y79a7 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>10.3<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>944)</span></div><div class="t m5 x17 h26 y79a8 ff7 fs19 fc1 sc0 ls0 ws0">Recall<span class="_ _11"> </span>that<span class="_ _16"> </span>the<span class="_ _16"> </span>child<span class="_ _11"> </span>inherits<span class="_ _16"> </span>the<span class="_ _11"> </span>parent’s<span class="_ _11"> </span>descriptor<span class="_ _16"> </span>table<span class="_ _16"> </span>and<span class="_ _11"> </span>that<span class="_ _16"> </span>all<span class="_ _11"> </span>processes</div><div class="t m5 x17 h26 y79a9 ff7 fs19 fc1 sc0 ls0 ws0">shared<span class="_ _16"> </span>the<span class="_ _16"> </span>same<span class="_ _14"> </span>open<span class="_ _16"> </span>ﬁle<span class="_ _14"> </span>table<span class="_ _1"></span>.<span class="_ _14"> </span>T<span class="_ _1"></span>hus<span class="_ _1"></span>,<span class="_ _15"> </span>the<span class="_ _16"> </span>descriptor<span class="_ _16"> </span><span class="ffd">fd<span class="_ _14"> </span></span>in<span class="_ _16"> </span>both<span class="_ _16"> </span>the<span class="_ _14"> </span>parent<span class="_ _16"> </span>and</div><div class="t m5 x17 h26 y79aa ff7 fs19 fc1 sc0 ls0 ws0">child<span class="_"> </span>points<span class="_ _11"> </span>to<span class="_ _11"> </span>the<span class="_"> </span>same<span class="_ _11"> </span>open<span class="_ _11"> </span>ﬁle<span class="_ _11"> </span>table<span class="_"> </span>entry<span class="_ _3"></span>.<span class="_ _11"> </span>When<span class="_"> </span>the<span class="_ _11"> </span>child<span class="_"> </span>reads<span class="_ _11"> </span>the<span class="_ _11"> </span>ﬁrst<span class="_"> </span>byte</div><div class="t m5 x17 h26 y79ab ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span>the<span class="_"> </span>ﬁle<span class="_ _1"></span>,<span class="_"> </span>the<span class="_"> </span>ﬁle<span class="_"> </span>position<span class="_ _13"> </span>increases<span class="_"> </span>by<span class="_"> </span>1.<span class="_"> </span>T<span class="_ _1"></span>hus<span class="_ _1"></span>,<span class="_"> </span>the<span class="_"> </span>parent<span class="_"> </span>reads<span class="_"> </span>the<span class="_"> </span>second<span class="_ _13"> </span>byte,</div><div class="t m5 x17 h26 y79ac ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_"> </span>the<span class="_"> </span>output<span class="_"> </span>is</div><div class="t m5 x17 h2d y79ad ffd fs1e fc2 sc0 ls33 ws0">c=o</div><div class="t m5 x17 h28 y79ae ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>10.4</div><div class="t m5 x112 h2f y79af ffe fs16 fc6 sc0 ls0 ws0">(page<span class="_"> </span>945)</div><div class="t m5 x17 h26 y79b0 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_ _13"> </span>redirect<span class="_ _13"> </span>standard<span class="_ _6"> </span>input<span class="_ _13"> </span>(descriptor<span class="_ _6"> </span>0)<span class="_ _13"> </span>to<span class="_ _6"> </span>descriptor<span class="_ _13"> </span>5,<span class="_ _13"> </span>we<span class="_ _6"> </span>would<span class="_ _13"> </span>call<span class="_ _13"> </span><span class="ffd">dup2(5,0)</span>,</div><div class="t m5 x17 h26 y79b1 ff7 fs19 fc1 sc0 ls0 ws0">or<span class="_"> </span>equivalently<span class="_ _3"></span>,<span class="_"> </span><span class="ffd">dup2(5,STDIN_FILENO)</span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
