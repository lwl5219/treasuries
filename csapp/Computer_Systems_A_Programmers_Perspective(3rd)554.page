<div id="pf22a" class="pf w2 h11" data-page-no="22a"><div class="pc pc22a w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg22a.png"/><div class="t m5 x23b h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>5.7<span class="_ _60"> </span>Understanding<span class="_ _10"> </span>Modern<span class="_ _10"> </span>Processors<span class="_ _3e"> </span><span class="ffe fs1e">553</span></div><div class="t m5 x2c h2d ye7 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">addq<span class="_ _46"> </span>$8,<span class="_ _e"> </span>%rdx<span class="_ _d5"> </span></span><span class="ff13 fs35">Increment<span class="_ _f"> </span>data+i</span></div><div class="t m5 x2c h2d yc4d ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">cmpq<span class="_ _46"> </span>%rax,<span class="_ _e"> </span>%rdx<span class="_ _161"> </span></span><span class="ff13 fs35">Compare<span class="_ _f"> </span>to<span class="_ _f"> </span>data+length</span></div><div class="t m5 x2c h2d yecb ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">jne<span class="_ _8c"> </span>.L17<span class="_ _136"> </span></span><span class="ff13 fs35">If<span class="_ _f"> </span>!=,<span class="_ _f"> </span>goto<span class="_ _f"> </span><span class="ff2d">loop</span></span></div><div class="t m5 x17 h26 y4ba3 ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _16"> </span>see<span class="_ _16"> </span>that,<span class="_ _16"> </span>besides<span class="_ _16"> </span>some<span class="_ _16"> </span>reordering<span class="_ _16"> </span>of<span class="_ _16"> </span>instructions<span class="_ _1"></span>,<span class="_ _16"> </span>the<span class="_ _16"> </span>only<span class="_ _16"> </span>difference<span class="_ _16"> </span>is<span class="_ _16"> </span>that</div><div class="t m5 x17 h26 y4ba4 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _11"> </span>more<span class="_ _11"> </span>optimized<span class="_ _11"> </span>version<span class="_ _11"> </span>does<span class="_ _11"> </span>not<span class="_ _16"> </span>contain<span class="_"> </span>the<span class="_ _11"> </span><span class="ffd">vmovsd<span class="_ _16"> </span></span>implementing<span class="_"> </span>the<span class="_ _11"> </span>read</div><div class="t m5 x17 h26 y4ba5 ff7 fs19 fc2 sc0 ls0 ws0">from<span class="_"> </span>the<span class="_"> </span>location<span class="_"> </span>designated<span class="_"> </span>by<span class="_"> </span><span class="ffd">dest<span class="_ _10"> </span></span>(line<span class="_"> </span>2).</div><div class="t m5 x34 h26 y4ba6 ff7 fs19 fc2 sc0 ls0 ws0">A.<span class="_ _1f"> </span>How<span class="_"> </span>does<span class="_"> </span>the<span class="_"> </span>role<span class="_"> </span>of<span class="_"> </span>register<span class="_"> </span><span class="ffd">%xmm0<span class="_ _10"> </span></span>differ<span class="_"> </span>in<span class="_"> </span>these<span class="_"> </span>two<span class="_"> </span>loops?</div><div class="t m5 x34 h26 y4ba7 ff7 fs19 fc2 sc0 ls0 ws0">B<span class="_ _3"></span>.<span class="_ _1d"> </span>Will<span class="_ _16"> </span>the<span class="_ _16"> </span>more<span class="_ _14"> </span>optimized<span class="_ _16"> </span>version<span class="_ _14"> </span>faithfully<span class="_ _14"> </span>implement<span class="_ _16"> </span>the<span class="_ _14"> </span>C<span class="_ _16"> </span>code<span class="_ _14"> </span>of<span class="_ _14"> </span><span class="ffd">com-</span></div><div class="t m5 x2d h26 y4ba8 ffd fs19 fc2 sc0 ls0 ws0">bine3<span class="ff7">,<span class="_"> </span>including<span class="_"> </span>when<span class="_"> </span>there<span class="_"> </span>is<span class="_ _11"> </span>memory<span class="_"> </span>aliasing<span class="_"> </span>between<span class="_"> </span></span>dest<span class="_ _11"> </span><span class="ff7">and<span class="_"> </span>the<span class="_"> </span>vec-</span></div><div class="t m5 x2d h26 y4ba9 ff7 fs19 fc2 sc0 ls0 ws0">tor<span class="_"> </span>data?</div><div class="t m5 x34 h26 y4baa ff7 fs19 fc2 sc0 ls0 ws0">C.<span class="_ _25"> </span>Either<span class="_ _13"> </span>explain<span class="_"> </span>why<span class="_ _13"> </span>this<span class="_ _13"> </span>optimization<span class="_ _13"> </span>preserves<span class="_"> </span>the<span class="_ _13"> </span>desired<span class="_ _13"> </span>behavior,<span class="_ _13"> </span>or<span class="_"> </span>give</div><div class="t m5 x2d h26 y4bab ff7 fs19 fc2 sc0 ls0 ws0">an<span class="_ _13"> </span>example<span class="_"> </span>where<span class="_ _13"> </span>it<span class="_ _13"> </span>would<span class="_ _13"> </span>produce<span class="_"> </span>different<span class="_ _13"> </span>results<span class="_ _13"> </span>than<span class="_ _13"> </span>the<span class="_"> </span>less<span class="_ _13"> </span>optimized</div><div class="t m5 x2d h26 y4bac ff7 fs19 fc2 sc0 ls0 ws0">code<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y4bad ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _1"></span>ith<span class="_ _6"> </span>this<span class="_ _13"> </span>ﬁnal<span class="_ _a"> </span>transformation,<span class="_ _13"> </span>we<span class="_ _a"> </span>reached<span class="_ _6"> </span>a<span class="_ _6"> </span>point<span class="_ _6"> </span>where<span class="_ _13"> </span>we<span class="_ _a"> </span>require<span class="_ _6"> </span>just<span class="_ _6"> </span>1.25–5</div><div class="t m5 x17 h26 y4bae ff7 fs19 fc1 sc0 ls0 ws0">clock<span class="_ _13"> </span>cycles<span class="_ _6"> </span>for<span class="_ _13"> </span>each<span class="_ _13"> </span>element<span class="_ _13"> </span>to<span class="_ _13"> </span>be<span class="_ _13"> </span>computed.<span class="_ _13"> </span>T<span class="_ _1"></span>his<span class="_ _13"> </span>is<span class="_ _13"> </span>a<span class="_ _13"> </span>considerable<span class="_ _13"> </span>improvement</div><div class="t m5 x17 h26 y4baf ff7 fs19 fc1 sc0 ls0 ws0">over<span class="_"> </span>the<span class="_ _11"> </span>original<span class="_ _11"> </span>9–11<span class="_ _11"> </span>cycles<span class="_"> </span>when<span class="_"> </span>we<span class="_ _11"> </span>ﬁrst<span class="_ _11"> </span>enabled<span class="_ _11"> </span>optimization.<span class="_"> </span>W<span class="_ _1"></span>e<span class="_ _11"> </span>would<span class="_"> </span>now</div><div class="t m5 x17 h26 y4bb0 ff7 fs19 fc1 sc0 ls0 ws0">like<span class="_ _13"> </span>to<span class="_ _13"> </span>see<span class="_ _13"> </span>just<span class="_ _13"> </span>what<span class="_ _13"> </span>factors<span class="_ _13"> </span>are<span class="_ _6"> </span>constraining<span class="_ _13"> </span>the<span class="_ _13"> </span>performance<span class="_ _13"> </span>of<span class="_ _13"> </span>our<span class="_ _13"> </span>code<span class="_ _13"> </span>and<span class="_ _13"> </span>how</div><div class="t m5 x17 h26 y4bb1 ff7 fs19 fc1 sc0 ls0 ws0">we<span class="_"> </span>can<span class="_"> </span>improve<span class="_"> </span>things<span class="_"> </span>even<span class="_"> </span>further.</div><div class="t m5 x17 h3b y3228 fff fs24 fc6 sc0 ls0 ws0">5.7<span class="_ _17"> </span><span class="ffe fs18">Understanding<span class="_"> </span>Modern<span class="_"> </span>Processors</span></div><div class="t m5 x17 h26 y2659 ff7 fs19 fc1 sc0 ls0 ws0">Up<span class="_"> </span>to<span class="_"> </span>this<span class="_ _11"> </span>point,<span class="_"> </span>we<span class="_ _11"> </span>have<span class="_"> </span>applied<span class="_ _11"> </span>optimizations<span class="_"> </span>that<span class="_"> </span>did<span class="_ _11"> </span>not<span class="_"> </span>rely<span class="_ _11"> </span>on<span class="_"> </span>any<span class="_"> </span>features</div><div class="t m5 x17 h26 y2e8e ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span>the<span class="_ _11"> </span>target<span class="_ _11"> </span>machine.<span class="_"> </span>T<span class="_ _1"></span>hey<span class="_ _11"> </span>simply<span class="_ _11"> </span>reduced<span class="_ _11"> </span>the<span class="_ _11"> </span>overhead<span class="_ _11"> </span>of<span class="_ _11"> </span>procedure<span class="_ _11"> </span>calls<span class="_ _11"> </span>and</div><div class="t m5 x17 h26 y2e8f ff7 fs19 fc1 sc0 ls0 ws0">eliminated<span class="_ _f"> </span>some<span class="_ _f"> </span>of<span class="_ _e"> </span>the<span class="_ _21"> </span>critical<span class="_ _f"> </span>“optimization<span class="_ _e"> </span>blockers”<span class="_ _21"> </span>that<span class="_ _f"> </span>cause<span class="_ _e"> </span>difﬁculties</div><div class="t m5 x17 h26 y2e90 ff7 fs19 fc1 sc0 ls0 ws0">for<span class="_ _11"> </span>optimizing<span class="_ _16"> </span>compilers<span class="_ _1"></span>.<span class="_ _16"> </span>As<span class="_ _11"> </span>we<span class="_ _16"> </span>seek<span class="_ _11"> </span>to<span class="_ _16"> </span>push<span class="_ _11"> </span>the<span class="_ _16"> </span>performance<span class="_ _16"> </span>further<span class="_ _0"></span>,<span class="_ _16"> </span>we<span class="_ _11"> </span>must</div><div class="t m5 x17 h26 y2e91 ff7 fs19 fc1 sc0 ls0 ws0">consider<span class="_ _13"> </span>optimizations<span class="_ _6"> </span>that<span class="_ _13"> </span>exploit<span class="_ _13"> </span>the<span class="_ _6"> </span><span class="ffa">microarchitecture<span class="_ _13"> </span></span>of<span class="_ _13"> </span>the<span class="_ _6"> </span>processor<span class="_ _1"></span>—that<span class="_ _13"> </span>is<span class="_ _1"></span>,</div><div class="t m5 x17 h26 y2e92 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>underlying<span class="_"> </span>system<span class="_"> </span>design<span class="_ _13"> </span>by<span class="_"> </span>which<span class="_"> </span>a<span class="_"> </span>processor<span class="_"> </span>executes<span class="_"> </span>instructions<span class="_ _3"></span>.<span class="_"> </span>Getting</div><div class="t m5 x17 h26 y2e93 ff7 fs19 fc1 sc0 ls0 ws0">every<span class="_ _13"> </span>last<span class="_ _13"> </span>bit<span class="_ _13"> </span>of<span class="_ _13"> </span>performance<span class="_ _13"> </span>requires<span class="_ _13"> </span>a<span class="_ _13"> </span>detailed<span class="_ _13"> </span>analysis<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>program<span class="_ _13"> </span>as<span class="_ _13"> </span>well<span class="_ _13"> </span>as</div><div class="t m5 x17 h26 y2e94 ff7 fs19 fc1 sc0 ls0 ws0">code<span class="_"> </span>generation<span class="_ _11"> </span>tuned<span class="_ _11"> </span>for<span class="_ _11"> </span>the<span class="_ _11"> </span>target<span class="_ _11"> </span>processor.<span class="_ _11"> </span>Nonetheless<span class="_ _1"></span>,<span class="_ _11"> </span>we<span class="_ _11"> </span>can<span class="_ _11"> </span>apply<span class="_ _11"> </span>some</div><div class="t m5 x17 h26 y2e95 ff7 fs19 fc1 sc0 ls0 ws0">basic<span class="_ _13"> </span>optimizations<span class="_ _13"> </span>that<span class="_ _13"> </span>will<span class="_ _6"> </span>yield<span class="_ _13"> </span>an<span class="_ _13"> </span>overall<span class="_ _13"> </span>performance<span class="_ _13"> </span>improvement<span class="_ _13"> </span>on<span class="_ _13"> </span>a<span class="_ _6"> </span>large</div><div class="t m5 x17 h26 y2e96 ff7 fs19 fc1 sc0 ls0 ws0">class<span class="_ _13"> </span>of<span class="_ _13"> </span>processors<span class="_ _1"></span>.<span class="_ _13"> </span>The<span class="_ _13"> </span>detailed<span class="_ _13"> </span>performance<span class="_ _13"> </span>results<span class="_ _13"> </span>we<span class="_ _13"> </span>report<span class="_ _13"> </span>here<span class="_ _13"> </span>may<span class="_"> </span>not<span class="_ _13"> </span>hold</div><div class="t m5 x17 h26 y2e97 ff7 fs19 fc1 sc0 ls0 ws0">for<span class="_ _13"> </span>other<span class="_ _6"> </span>machines<span class="_ _1"></span>,<span class="_ _13"> </span>but<span class="_ _13"> </span>the<span class="_ _13"> </span>general<span class="_ _6"> </span>principles<span class="_ _13"> </span>of<span class="_ _13"> </span>operation<span class="_ _6"> </span>and<span class="_ _13"> </span>optimization<span class="_ _13"> </span>apply</div><div class="t m5 x17 h26 y2e98 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_"> </span>a<span class="_"> </span>wide<span class="_"> </span>variety<span class="_"> </span>of<span class="_"> </span>machines<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y2e99 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_"> </span>understand<span class="_"> </span>ways<span class="_ _13"> </span>to<span class="_"> </span>improve<span class="_"> </span>performance<span class="_ _1"></span>,<span class="_"> </span>we<span class="_ _13"> </span>require<span class="_"> </span>a<span class="_"> </span>basic<span class="_ _13"> </span>understand-</div><div class="t m5 x17 h26 y2e9a ff7 fs19 fc1 sc0 ls0 ws0">ing<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>microarchitectures<span class="_ _11"> </span>of<span class="_ _11"> </span>modern<span class="_ _11"> </span>processors<span class="_ _1"></span>.<span class="_ _16"> </span>Due<span class="_ _11"> </span>to<span class="_ _11"> </span>the<span class="_ _11"> </span>large<span class="_ _16"> </span>number<span class="_ _11"> </span>of</div><div class="t m5 x17 h26 y2e9b ff7 fs19 fc1 sc0 ls0 ws0">transistors<span class="_ _13"> </span>that<span class="_"> </span>can<span class="_ _13"> </span>be<span class="_"> </span>integrated<span class="_ _13"> </span>onto<span class="_ _13"> </span>a<span class="_"> </span>single<span class="_ _13"> </span>chip<span class="_ _1"></span>,<span class="_"> </span>modern<span class="_ _13"> </span>microprocessors<span class="_"> </span>em-</div><div class="t m5 x17 h26 y2e9c ff7 fs19 fc1 sc0 ls0 ws0">ploy<span class="_ _14"> </span>complex<span class="_ _14"> </span>hardware<span class="_ _15"> </span>that<span class="_ _14"> </span>attempts<span class="_ _14"> </span>to<span class="_ _15"> </span>maximize<span class="_ _14"> </span>program<span class="_ _14"> </span>performance.<span class="_ _16"> </span>One</div><div class="t m5 x17 h26 y2e9d ff7 fs19 fc1 sc0 ls0 ws0">result<span class="_"> </span>is<span class="_ _13"> </span>that<span class="_"> </span>their<span class="_"> </span>actual<span class="_"> </span>operation<span class="_ _13"> </span>is<span class="_"> </span>far<span class="_"> </span>different<span class="_ _13"> </span>from<span class="_"> </span>the<span class="_"> </span>view<span class="_ _13"> </span>that<span class="_"> </span>is<span class="_"> </span>perceived</div><div class="t m5 x17 h26 y2e9e ff7 fs19 fc1 sc0 ls0 ws0">by<span class="_"> </span>looking<span class="_ _11"> </span>at<span class="_ _11"> </span>machine-level<span class="_ _11"> </span>programs<span class="_ _1"></span>.<span class="_ _11"> </span>At<span class="_ _11"> </span>the<span class="_ _11"> </span>code<span class="_ _11"> </span>level,<span class="_ _11"> </span>it<span class="_ _11"> </span>appears<span class="_ _11"> </span>as<span class="_ _11"> </span>if<span class="_ _11"> </span>instruc-</div><div class="t m5 x17 h26 y2e9f ff7 fs19 fc1 sc0 ls0 ws0">tions<span class="_"> </span>are<span class="_ _11"> </span>executed<span class="_"> </span>one<span class="_ _11"> </span>at<span class="_ _11"> </span>a<span class="_"> </span>time,<span class="_"> </span>where<span class="_"> </span>each<span class="_ _11"> </span>instruction<span class="_"> </span>involves<span class="_ _11"> </span>fetching<span class="_ _11"> </span>values</div><div class="t m5 x17 h26 y2ea0 ff7 fs19 fc1 sc0 ls0 ws0">from<span class="_ _16"> </span>registers<span class="_ _16"> </span>or<span class="_ _16"> </span>memory<span class="_ _3"></span>,<span class="_ _16"> </span>performing<span class="_ _16"> </span>an<span class="_ _16"> </span>operation,<span class="_ _14"> </span>and<span class="_ _16"> </span>storing<span class="_ _16"> </span>results<span class="_ _16"> </span>back<span class="_ _16"> </span>to</div><div class="t m5 x17 h26 y2ea1 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_ _11"> </span>register<span class="_ _16"> </span>or<span class="_ _11"> </span>memory<span class="_ _16"> </span>location.<span class="_ _11"> </span>In<span class="_ _16"> </span>the<span class="_ _11"> </span>actual<span class="_ _16"> </span>processor<span class="_ _0"></span>,<span class="_ _16"> </span>a<span class="_ _11"> </span>number<span class="_ _11"> </span>of<span class="_ _16"> </span>instructions</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
