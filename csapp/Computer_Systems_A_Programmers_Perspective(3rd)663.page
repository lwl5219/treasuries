<div id="pf297" class="pf w2 h11" data-page-no="297"><div class="pc pc297 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg297.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">662<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>6<span class="_ _3d"> </span>The<span class="_ _10"> </span>Memory<span class="_ _10"> </span>Hierarchy</span></div><div class="t m5 x14 h2f ye7 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>6.34</div><div class="t m5 x14 h2f y58a ffe fs16 fc1 sc0 ls0 ws0">Line<span class="_ _15"> </span>matching<span class="_ _15"> </span>and</div><div class="t m5 x14 h2f y58b ffe fs16 fc1 sc0 ls0 ws0">word<span class="_ _16"> </span>selection<span class="_ _16"> </span>in<span class="_ _11"> </span>a<span class="_ _16"> </span>set</div><div class="t m5 x14 h2f y58c ffe fs16 fc1 sc0 ls0 ws0">associative<span class="_"> </span>cache.</div><div class="t m5 x7e he3 y5834 ff84 fs94 fc1 sc0 ls24b ws0">01</div><div class="t m5 xaa he3 y5835 ff80 fs94 fc1 sc0 ls0 ws0">m<span class="ff84">–1<span class="_ _129"> </span>0</span></div><div class="t m5 x93 he3 y5834 ff84 fs94 fc1 sc0 ls241 ws0">234567</div><div class="t m5 x1d1 h91 y5836 ff84 fs57 fc1 sc0 ls0 ws0">1</div><div class="t m5 x1d1 h91 y5837 ff84 fs57 fc1 sc0 ls0 ws0">1</div><div class="t m5 xfc h91 y5836 ff84 fs57 fc1 sc0 ls0 ws0">1001</div><div class="t m5 xfc h91 y5837 ff84 fs57 fc1 sc0 ls0 ws0">01<span class="_ _1"></span>10</div><div class="t m5 x119 h91 y5838 ff80 fs57 fc1 sc0 ls0 ws0">t<span class="ff84"> bits</span></div><div class="t m5 x151 h91 y5839 ff84 fs57 fc1 sc0 ls0 ws0">T<span class="_ _3"></span>ag<span class="_ _26"> </span>Set index<span class="_ _14"> </span>Block offset</div><div class="t m5 x36 h91 y5838 ff80 fs57 fc1 sc0 ls0 ws0">s<span class="ff84"> bits<span class="_ _4c"> </span></span>b<span class="ff84"> bits</span></div><div class="t m5 x181 h91 y583a ff84 fs57 fc1 sc0 ls0 ws0">= ?</div><div class="t m5 xf3 h91 y583b ff80 fs57 fc1 sc0 ls0 ws0">w</div><div class="t m5 x171 he3 y583c ff84 fs94 fc1 sc0 ls0 ws0">0</div><div class="t m5 xae h91 y583d ff80 fs57 fc1 sc0 ls0 ws0">w</div><div class="t m5 x24b he3 y583c ff84 fs94 fc1 sc0 ls0 ws0">1</div><div class="t m5 x172 h91 y583d ff80 fs57 fc1 sc0 ls0 ws0">w</div><div class="t m5 x46 he3 y583c ff84 fs94 fc1 sc0 ls0 ws0">2</div><div class="t m5 x173 h91 y583d ff80 fs57 fc1 sc0 ls0 ws0">w</div><div class="t m5 x224 he3 y583c ff84 fs94 fc1 sc0 ls0 ws0">3</div><div class="t m5 x119 h91 y583e ff84 fs57 fc1 sc0 ls0 ws0">01<span class="_ _1"></span>10<span class="_ _128"> </span><span class="ff80">i<span class="_ _63"> </span></span>100</div><div class="t m5 x16d h91 y583f ff84 fs57 fc1 sc0 ls0 ws0">= 1?   (1) The valid bit must be set.</div><div class="t m5 xe0 h91 y5840 ff84 fs57 fc1 sc0 ls0 ws0">Selected set (<span class="ff80">i<span class="_ _be"> </span></span>):</div><div class="t m5 x4d h91 y5841 ff84 fs57 fc1 sc0 ls0 ws0">(2) The tag bits in one </div><div class="t m5 x135 h91 y5842 ff84 fs57 fc1 sc0 ls0 ws0">of the cache lines </div><div class="t m5 x1c6 h91 y5843 ff84 fs57 fc1 sc0 ls0 ws0">must match the tag </div><div class="t m5 x129 h91 y5844 ff84 fs57 fc1 sc0 ls0 ws0">bits in the address.</div><div class="t m5 x13e h91 y5845 ff84 fs57 fc1 sc0 ls0 ws0">(3) If (1) and (2), then </div><div class="t m5 x11d h91 y5846 ff84 fs57 fc1 sc0 ls0 ws0">cache hit, and</div><div class="t m5 x5f h91 y5847 ff84 fs57 fc1 sc0 ls0 ws0">block offset selects </div><div class="t m5 x46 h91 y5848 ff84 fs57 fc1 sc0 ls0 ws0">starting byte.</div><div class="t m5 x29 h26 y5849 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _11"> </span>6.34<span class="_"> </span>shows<span class="_"> </span>the<span class="_"> </span>basic<span class="_ _11"> </span>idea<span class="_"> </span>of<span class="_"> </span>line<span class="_"> </span>matching<span class="_ _11"> </span>in<span class="_"> </span>an<span class="_"> </span>associative<span class="_ _11"> </span>cache<span class="_ _1"></span>.<span class="_ _11"> </span>An</div><div class="t m5 x1d h26 y584a ff7 fs19 fc1 sc0 ls0 ws0">important<span class="_ _6"> </span>idea<span class="_ _13"> </span>here<span class="_ _6"> </span>is<span class="_ _13"> </span>that<span class="_ _6"> </span>any<span class="_ _6"> </span>line<span class="_ _13"> </span>in<span class="_ _6"> </span>the<span class="_ _13"> </span>set<span class="_ _6"> </span>can<span class="_ _13"> </span>contain<span class="_ _a"> </span>any<span class="_ _13"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>memory<span class="_ _6"> </span>blocks</div><div class="t m5 x1d h26 y584b ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_"> </span>map<span class="_"> </span>to<span class="_ _11"> </span>that<span class="_"> </span>set.<span class="_ _11"> </span>So<span class="_"> </span>the<span class="_ _11"> </span>cache<span class="_"> </span>must<span class="_ _11"> </span>search<span class="_"> </span>each<span class="_ _11"> </span>line<span class="_"> </span>in<span class="_"> </span>the<span class="_ _11"> </span>set<span class="_"> </span>for<span class="_ _11"> </span>a<span class="_"> </span>valid<span class="_ _11"> </span>line</div><div class="t m5 x1d h26 y584c ff7 fs19 fc1 sc0 ls0 ws0">whose<span class="_ _11"> </span>tag<span class="_ _16"> </span>matches<span class="_ _11"> </span>the<span class="_ _16"> </span>tag<span class="_ _11"> </span>in<span class="_ _16"> </span>the<span class="_ _11"> </span>address<span class="_ _1"></span>.<span class="_ _16"> </span>If<span class="_ _11"> </span>the<span class="_ _11"> </span>cache<span class="_ _16"> </span>ﬁnds<span class="_ _11"> </span>such<span class="_ _16"> </span>a<span class="_ _11"> </span>line,<span class="_ _11"> </span>then<span class="_ _16"> </span>we</div><div class="t m5 x1d h26 y584d ff7 fs19 fc1 sc0 ls0 ws0">have<span class="_"> </span>a<span class="_"> </span>hit<span class="_"> </span>and<span class="_"> </span>the<span class="_"> </span>block<span class="_"> </span>offset<span class="_"> </span>selects<span class="_"> </span>a<span class="_"> </span>word<span class="_"> </span>from<span class="_"> </span>the<span class="_"> </span>block,<span class="_"> </span>as<span class="_"> </span>before<span class="_ _1"></span>.</div><div class="t m5 x1d h42 y584e ff6 fs29 fc6 sc0 ls0 ws0">Line<span class="_ _11"> </span>Replacement<span class="_ _16"> </span>on<span class="_ _16"> </span>Misses<span class="_ _11"> </span>in<span class="_ _16"> </span>Set<span class="_ _16"> </span>Associative<span class="_ _11"> </span>Caches</div><div class="t m5 x1d h26 y584f ff7 fs19 fc1 sc0 ls0 ws0">If<span class="_"> </span>the<span class="_"> </span>word<span class="_"> </span>requested<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span>CPU<span class="_ _13"> </span>is<span class="_"> </span>not<span class="_"> </span>stored<span class="_"> </span>in<span class="_"> </span>any<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>lines<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>set,<span class="_"> </span>then</div><div class="t m5 x1d h26 y5850 ff7 fs19 fc1 sc0 ls0 ws0">we<span class="_"> </span>have<span class="_ _11"> </span>a<span class="_ _11"> </span>cache<span class="_"> </span>miss<span class="_ _0"></span>,<span class="_"> </span>and<span class="_ _11"> </span>the<span class="_ _11"> </span>cache<span class="_ _11"> </span>must<span class="_"> </span>fetch<span class="_ _11"> </span>the<span class="_ _11"> </span>block<span class="_"> </span>that<span class="_ _11"> </span>contains<span class="_ _11"> </span>the<span class="_ _11"> </span>word</div><div class="t m5 x1d h26 y5851 ff7 fs19 fc1 sc0 ls0 ws0">from<span class="_ _13"> </span>memory<span class="_ _7"></span>.<span class="_ _13"> </span>However,<span class="_ _13"> </span>once<span class="_ _13"> </span>the<span class="_ _13"> </span>cache<span class="_ _6"> </span>has<span class="_ _13"> </span>retrieved<span class="_ _13"> </span>the<span class="_ _13"> </span>block,<span class="_ _13"> </span>which<span class="_ _13"> </span>line<span class="_ _13"> </span>should</div><div class="t m5 x1d h26 y5852 ff7 fs19 fc1 sc0 ls0 ws0">it<span class="_"> </span>replace?<span class="_ _13"> </span>Of<span class="_"> </span>course<span class="_ _0"></span>,<span class="_"> </span>if<span class="_ _13"> </span>there<span class="_"> </span>is<span class="_"> </span>an<span class="_"> </span>empty<span class="_ _13"> </span>line<span class="_ _0"></span>,<span class="_"> </span>then<span class="_"> </span>it<span class="_ _13"> </span>would<span class="_"> </span>be<span class="_"> </span>a<span class="_ _13"> </span>good<span class="_"> </span>candidate<span class="_ _1"></span>.</div><div class="t m5 x1d h26 y5853 ff7 fs19 fc1 sc0 ls0 ws0">But<span class="_ _6"> </span>if<span class="_ _13"> </span>there<span class="_ _a"> </span>are<span class="_ _13"> </span>no<span class="_ _6"> </span>empty<span class="_ _6"> </span>lines<span class="_ _13"> </span>in<span class="_ _a"> </span>the<span class="_ _13"> </span>set,<span class="_ _6"> </span>then<span class="_ _13"> </span>we<span class="_ _a"> </span>must<span class="_ _13"> </span>choose<span class="_ _6"> </span>one<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _a"> </span>nonempty</div><div class="t m5 x1d h26 y5854 ff7 fs19 fc1 sc0 ls0 ws0">lines<span class="_"> </span>and<span class="_"> </span>hope<span class="_"> </span>that<span class="_"> </span>the<span class="_"> </span>CPU<span class="_"> </span>does<span class="_"> </span>not<span class="_"> </span>reference<span class="_"> </span>the<span class="_"> </span>replaced<span class="_"> </span>line<span class="_"> </span>anytime<span class="_"> </span>soon.</div><div class="t m5 x29 h26 y5855 ff7 fs19 fc1 sc0 ls0 ws0">It<span class="_ _13"> </span>is<span class="_ _13"> </span>very<span class="_ _13"> </span>difﬁcult<span class="_ _13"> </span>for<span class="_ _13"> </span>programmers<span class="_ _13"> </span>to<span class="_ _13"> </span>exploit<span class="_ _13"> </span>knowledge<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>cache<span class="_ _13"> </span>replace-</div><div class="t m5 x1d h26 y5856 ff7 fs19 fc1 sc0 ls0 ws0">ment<span class="_ _11"> </span>policy<span class="_ _11"> </span>in<span class="_ _16"> </span>their<span class="_ _11"> </span>codes<span class="_ _1"></span>,<span class="_ _16"> </span>so<span class="_ _11"> </span>we<span class="_ _16"> </span>will<span class="_ _11"> </span>not<span class="_ _16"> </span>go<span class="_ _11"> </span>into<span class="_ _16"> </span>much<span class="_ _11"> </span>detail<span class="_ _16"> </span>about<span class="_ _11"> </span>it<span class="_ _16"> </span>here<span class="_ _1"></span>.<span class="_ _16"> </span>T<span class="_ _1"></span>he</div><div class="t m5 x1d h26 y5857 ff7 fs19 fc1 sc0 ls0 ws0">simplest<span class="_ _13"> </span>replacement<span class="_ _6"> </span>policy<span class="_ _6"> </span>is<span class="_ _13"> </span>to<span class="_ _6"> </span>choose<span class="_ _13"> </span>the<span class="_ _6"> </span>line<span class="_ _13"> </span>to<span class="_ _6"> </span>replace<span class="_ _13"> </span>at<span class="_ _6"> </span>random.<span class="_ _13"> </span>Other<span class="_ _6"> </span>more</div><div class="t m5 x1d h26 y5858 ff7 fs19 fc1 sc0 ls0 ws0">sophisticated<span class="_ _13"> </span>policies<span class="_ _13"> </span>draw<span class="_ _13"> </span>on<span class="_ _6"> </span>the<span class="_ _13"> </span>principle<span class="_ _13"> </span>of<span class="_ _13"> </span>locality<span class="_ _13"> </span>to<span class="_ _13"> </span>try<span class="_ _13"> </span>to<span class="_ _6"> </span>minimize<span class="_ _13"> </span>the<span class="_ _13"> </span>prob-</div><div class="t m5 x1d h26 y5859 ff7 fs19 fc1 sc0 ls0 ws0">ability<span class="_"> </span>that<span class="_"> </span>the<span class="_"> </span>replaced<span class="_"> </span>line<span class="_ _13"> </span>will<span class="_"> </span>be<span class="_"> </span>referenced<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>near<span class="_"> </span>future<span class="_ _1"></span>.<span class="_"> </span>F<span class="_ _1"></span>or<span class="_"> </span>example<span class="_ _1"></span>,<span class="_"> </span>a</div><div class="t m5 x1d h26 y585a ffa fs19 fc1 sc0 ls0 ws0">least<span class="_ _11"> </span>frequently<span class="_ _16"> </span>used<span class="_ _11"> </span>(LFU)<span class="_"> </span><span class="ff7">policy<span class="_ _11"> </span>will<span class="_ _11"> </span>replace<span class="_ _16"> </span>the<span class="_ _11"> </span>line<span class="_ _16"> </span>that<span class="_ _11"> </span>has<span class="_ _16"> </span>been<span class="_ _11"> </span>referenced</span></div><div class="t m5 x1d h26 y585b ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>fewest<span class="_"> </span>times<span class="_"> </span>over<span class="_"> </span>some<span class="_"> </span>past<span class="_"> </span>time<span class="_"> </span>window<span class="_ _1"></span>.<span class="_"> </span>A<span class="_"> </span><span class="ffa">least<span class="_"> </span>recently<span class="_"> </span>used<span class="_"> </span>(LRU)<span class="_ _13"> </span></span>polic<span class="_ _1"></span>y</div><div class="t m5 x1d h26 y585c ff7 fs19 fc1 sc0 ls0 ws0">will<span class="_ _16"> </span>replace<span class="_ _14"> </span>the<span class="_ _16"> </span>line<span class="_ _14"> </span>that<span class="_ _16"> </span>was<span class="_ _16"> </span>last<span class="_ _14"> </span>accessed<span class="_ _16"> </span>the<span class="_ _14"> </span>furthest<span class="_ _16"> </span>in<span class="_ _14"> </span>the<span class="_ _16"> </span>past.<span class="_ _14"> </span>All<span class="_ _16"> </span>of<span class="_ _14"> </span>these</div><div class="t m5 x1d h26 y585d ff7 fs19 fc1 sc0 ls0 ws0">policies<span class="_"> </span>require<span class="_"> </span>additional<span class="_ _11"> </span>time<span class="_"> </span>and<span class="_ _11"> </span>hardware<span class="_ _1"></span>.<span class="_ _11"> </span>But<span class="_"> </span>as<span class="_ _11"> </span>we<span class="_"> </span>move<span class="_ _11"> </span>further<span class="_"> </span>down<span class="_"> </span>the</div><div class="t m5 x1d h26 y585e ff7 fs19 fc1 sc0 ls0 ws0">memory<span class="_"> </span>hierarchy<span class="_ _3"></span>,<span class="_ _11"> </span>away<span class="_"> </span>from<span class="_ _11"> </span>the<span class="_ _11"> </span>CPU<span class="_ _3"></span>,<span class="_"> </span>the<span class="_ _11"> </span>cost<span class="_ _11"> </span>of<span class="_"> </span>a<span class="_ _11"> </span>miss<span class="_ _11"> </span>becomes<span class="_"> </span>more<span class="_ _11"> </span>expen-</div><div class="t m5 x1d h26 y585f ff7 fs19 fc1 sc0 ls0 ws0">sive<span class="_"> </span>and<span class="_"> </span>it<span class="_ _11"> </span>becomes<span class="_"> </span>more<span class="_"> </span>worthwhile<span class="_ _11"> </span>to<span class="_"> </span>minimize<span class="_"> </span>misses<span class="_ _11"> </span>with<span class="_"> </span>good<span class="_"> </span>replacement</div><div class="t m5 x1d h26 y5860 ff7 fs19 fc1 sc0 ls0 ws0">policies<span class="_ _1"></span>.</div><div class="t m5 x1d h41 y2270 ffe fs29 fc1 sc0 ls0 ws0">6.4.4<span class="_ _48"> </span><span class="fs19">Fully<span class="_"> </span>Associative<span class="_"> </span>Caches</span></div><div class="t m5 x1d h46 y77e ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_"> </span><span class="ffa">fully<span class="_ _13"> </span>associative<span class="_"> </span>cac<span class="_ _1"></span>he<span class="_"> </span><span class="ff7">consists<span class="_"> </span>of<span class="_ _13"> </span>a<span class="_ _13"> </span>single<span class="_"> </span>set<span class="_ _13"> </span>(i.e.,<span class="_ _13"> </span><span class="ff11">E<span class="_ _11"> </span><span class="ff12">=<span class="_ _13"> </span></span><span class="ls211">C/<span class="_ _0"></span>B<span class="ff7 ls0">)<span class="_"> </span>that<span class="_ _13"> </span>contains<span class="_"> </span>all<span class="_ _13"> </span>of</span></span></span></span></span></div><div class="t m5 x1d h26 y77f ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>cache<span class="_"> </span>lines<span class="_ _1"></span>.<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>6.35<span class="_"> </span>shows<span class="_"> </span>the<span class="_"> </span>basic<span class="_"> </span>organization.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
