<div id="pfe3" class="pf w2 h11" data-page-no="e3"><div class="pc pce3 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bge3.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">226<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x1d h31 y390 ff7 fs21 fc2 sc0 ls0 ws0">Instruction<span class="_ _26"> </span>Effect<span class="_ _143"> </span>Description</div><div class="t m5 x1d h32 yc94 ffd fs1e fc2 sc0 ls0 ws0">pushq<span class="_ _ea"> </span><span class="ff11 fs21">S<span class="_ _74"> </span><span class="ff6">R<span class="ff7">[</span></span></span>%rsp<span class="ff7 fs21">]<span class="_ _22"> </span><span class="ff12">←<span class="_ _25"> </span><span class="ff6">R</span></span>[</span>%rsp<span class="ff7 fs21">]<span class="_ _6"> </span><span class="ff12">−<span class="_ _13"> </span></span><span class="ls14e">8;<span class="_ _26"> </span>Push<span class="_ _10"> </span>quad<span class="_"> </span>word</span></span></div><div class="t m5 x20 h31 yc96 ff6 fs21 fc2 sc0 ls0 ws0">M<span class="_ _1"></span><span class="ff7">[<span class="ff6">R</span>[</span></div><div class="t m5 xb7 h32 yc98 ffd fs1e fc2 sc0 ls0 ws0">%rsp<span class="ff7 fs21 ls14f">]]<span class="_ _25"> </span><span class="ff12 ls0">←<span class="_ _23"> </span><span class="ff11">S</span></span></span></div><div class="t m5 x1d h32 yc9b ffd fs1e fc2 sc0 ls0 ws0">popq<span class="_ _ea"> </span><span class="ff11 fs21 ls150">DD<span class="_ _ae"></span><span class="ff12 ls0">←<span class="_ _25"> </span><span class="ff6">M<span class="_ _1"></span><span class="ff7">[<span class="ff6">R</span>[<span class="ffd fs1e">%rsp</span>]<span class="_ _1"></span>]<span class="_ _1"></span>;<span class="_ _5d"> </span>P<span class="_ _1"></span>op<span class="_"> </span>quad<span class="_"> </span>word</span></span></span></span></div><div class="t m5 x20 h31 yc9c ff6 fs21 fc2 sc0 ls0 ws0">R<span class="ff7">[</span></div><div class="t m5 x1a6 h32 yc9e ffd fs1e fc2 sc0 ls0 ws0">%rsp<span class="ff7 fs21">]<span class="_ _22"> </span><span class="ff12">←<span class="_ _25"> </span><span class="ff6">R</span></span>[</span>%rsp<span class="ff7 fs21">]<span class="_ _6"> </span><span class="ff12">+<span class="_ _13"> </span></span>8</span></div><div class="t m5 x1d h2f y1328 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>3.8<span class="_ _66"> </span><span class="fc1">Push<span class="_"> </span>and<span class="_"> </span>pop<span class="_"> </span>instructions.</span></div><div class="t m5 x25 h78 y22d5 ff22 fs41 fc1 sc0 ls0 ws0">%rax</div><div class="t m5 x25 h78 y22d6 ff22 fs41 fc1 sc0 ls0 ws0">%rdx</div><div class="t m5 x25 h78 y22d7 ff22 fs41 fc1 sc0 ls0 ws0">%rsp</div><div class="t m5 x207 h78 y22d8 ff22 fs41 fc1 sc0 ls0 ws0">0x108</div><div class="t m5 x49 h78 y22d6 ff22 fs41 fc1 sc0 ls0 ws0">0</div><div class="t m5 x9c h78 y22d9 ff22 fs41 fc1 sc0 ls0 ws0">0x123</div><div class="t m5 x9c h78 y22d7 ff22 fs41 fc1 sc0 ls0 ws0">0x108</div><div class="t m5 x1ae h78 y22da ff22 fs41 fc1 sc0 ls0 ws0">%rax</div><div class="t m5 x1ae h78 y22db ff22 fs41 fc1 sc0 ls0 ws0">%rdx</div><div class="t m5 x1ae h78 y22dc ff22 fs41 fc1 sc0 ls0 ws0">%rsp</div><div class="t m5 x15 h78 y22dd ff22 fs41 fc1 sc0 ls0 ws0">0x108</div><div class="t m5 x15 h78 y22de ff22 fs41 fc1 sc0 ls0 ws0">0x100</div><div class="t m5 x6d h78 y22db ff22 fs41 fc1 sc0 ls0 ws0">0</div><div class="t m5 x1ad h78 y22df ff22 fs41 fc1 sc0 ls0 ws0">0x123</div><div class="t m5 x1ad h78 y22dc ff22 fs41 fc1 sc0 ls0 ws0">0x100</div><div class="t m5 x133 h78 y22e0 ff22 fs41 fc1 sc0 ls0 ws0">%rax</div><div class="t m5 x133 h78 y22e1 ff22 fs41 fc1 sc0 ls0 ws0">%rdx</div><div class="t m5 x133 h78 y22e2 ff22 fs41 fc1 sc0 ls0 ws0">%rsp</div><div class="t m5 x217 h78 y22e1 ff22 fs41 fc1 sc0 ls0 ws0">0x123</div><div class="t m5 x217 h78 y22e3 ff22 fs41 fc1 sc0 ls0 ws0">0x123</div><div class="t m5 x1db h78 y22e4 ff22 fs41 fc1 sc0 ls0 ws0">pushq %rax<span class="_ _10e"> </span>popq %rdx</div><div class="t m5 x217 h78 y22e2 ff22 fs41 fc1 sc0 ls0 ws0">0x108</div><div class="t m5 xf0 h79 y22e5 ff26 fs42 fc1 sc0 ls0 ws0">Initially</div><div class="t m5 x7a h79 y22e6 ff26 fs42 fc1 sc0 ls0 ws0">Stack “bottom”</div><div class="t m5 x1d h79 y22e7 ff26 fs42 fc1 sc0 ls0 ws0">Increasing</div><div class="t m5 x1f6 h79 y22e8 ff26 fs42 fc1 sc0 ls0 ws0">address</div><div class="t m5 x137 h79 y22e9 ff26 fs42 fc1 sc0 ls0 ws0">Stack “top”</div><div class="t m5 x208 h79 y22e6 ff26 fs42 fc1 sc0 ls0 ws0">Stack “bottom”</div><div class="t m5 x1e7 h78 y22ea ff22 fs41 fc1 sc0 ls0 ws0">0x123<span class="_ _d5"> </span>0x123</div><div class="t m5 x199 h79 y22eb ff26 fs42 fc1 sc0 ls0 ws0">Stack “top”</div><div class="t m5 x1f1 h79 y22ec ff26 fs42 fc1 sc0 ls0 ws0">Stack “top”</div><div class="t m5 x11a h78 y22ed ff22 fs41 fc1 sc0 ls0 ws0">0x108</div><div class="t m5 x1d8 h79 y22ee ff26 fs42 fc1 sc0 ls0 ws0">Stack “bottom”</div><div class="t m5 x1d h34 y22ef ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _6"> </span>3.9<span class="_ _c"> </span><span class="fc1">Illustration<span class="_ _6"> </span>of<span class="_ _13"> </span>stack<span class="_ _6"> </span>operation.<span class="_ _6"> </span><span class="ff6">By<span class="_ _13"> </span>convention,<span class="_ _6"> </span>we<span class="_ _6"> </span>draw<span class="_ _13"> </span>stacks<span class="_ _6"> </span>upside<span class="_ _6"> </span>down,</span></span></div><div class="t m5 x1d h34 y22f0 ff6 fs16 fc1 sc0 ls0 ws0">so<span class="_ _10"> </span>that<span class="_ _10"> </span>the<span class="_ _11"> </span>“top”<span class="_ _10"> </span>of<span class="_ _10"> </span>the<span class="_ _11"> </span>stack<span class="_ _10"> </span>is<span class="_ _10"> </span>shown<span class="_ _10"> </span>at<span class="_ _11"> </span>the<span class="_ _10"> </span>bottom.<span class="_ _10"> </span>With<span class="_ _10"> </span>x86-64,<span class="_ _10"> </span>stacks<span class="_ _11"> </span>grow<span class="_ _10"> </span>toward</div><div class="t m5 x1d h34 y22f1 ff6 fs16 fc1 sc0 ls0 ws0">lower<span class="_ _13"> </span>addresses,<span class="_ _10"> </span>so<span class="_ _13"> </span>pushing<span class="_ _10"> </span>involves<span class="_ _13"> </span>decrementing<span class="_ _10"> </span>the<span class="_ _13"> </span>stack<span class="_ _13"> </span>pointer<span class="_ _10"> </span>(register</div><div class="t m5 x20f h3a y22f2 ffd fs19 fc1 sc0 ls0 ws0">%rsp<span class="ff6 fs16">)<span class="_ _13"> </span>and</span></div><div class="t m5 x1d h34 y22f3 ff6 fs16 fc1 sc0 ls0 ws0">storing<span class="_ _10"> </span>to<span class="_ _13"> </span>memor<span class="_ _2"></span>y<span class="_ _3"></span>,<span class="_ _10"> </span>while<span class="_ _10"> </span>popping<span class="_ _10"> </span>involves<span class="_ _10"> </span>reading<span class="_ _13"> </span>from<span class="_ _10"> </span>memory<span class="_ _10"> </span>and<span class="_ _10"> </span>incrementing<span class="_ _10"> </span>the</div><div class="t m5 x1d h34 y22f4 ff6 fs16 fc1 sc0 ls0 ws0">stack<span class="_ _10"> </span>pointer<span class="_ _1"></span>.</div><div class="t m5 x1d h26 y7c1 ff7 fs19 fc1 sc0 ls0 ws0">end<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>array<span class="_ _3"></span>.<span class="_"> </span>T<span class="_ _3"></span>his<span class="_"> </span>end<span class="_"> </span>is<span class="_ _13"> </span>called<span class="_"> </span>the<span class="_"> </span><span class="ffa">top<span class="_ _13"> </span></span>of<span class="_"> </span>the<span class="_ _13"> </span>stack.<span class="_ _e"> </span>W<span class="_ _1"></span>ith<span class="_"> </span>x86-64,<span class="_"> </span>the<span class="_ _13"> </span>program</div><div class="t m5 x1d h26 y7c2 ff7 fs19 fc1 sc0 ls0 ws0">stack<span class="_ _16"> </span>is<span class="_ _11"> </span>stored<span class="_ _16"> </span>in<span class="_ _16"> </span>some<span class="_ _16"> </span>region<span class="_ _11"> </span>of<span class="_ _16"> </span>memory<span class="_ _3"></span>.<span class="_ _16"> </span>As<span class="_ _11"> </span>illustrated<span class="_ _16"> </span>in<span class="_ _16"> </span>F<span class="_ _1"></span>igure<span class="_ _16"> </span>3.9,<span class="_ _16"> </span>the<span class="_ _16"> </span>stack</div><div class="t m5 x1d h26 y7c3 ff7 fs19 fc1 sc0 ls0 ws0">grows<span class="_"> </span>downward<span class="_"> </span>such<span class="_"> </span>that<span class="_ _13"> </span>the<span class="_"> </span>top<span class="_"> </span>element<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>stack<span class="_"> </span>has<span class="_ _13"> </span>the<span class="_"> </span>lowest<span class="_"> </span>address<span class="_"> </span>of</div><div class="t m5 x1d h26 y7c4 ff7 fs19 fc1 sc0 ls0 ws0">all<span class="_ _16"> </span>stack<span class="_ _16"> </span>elements<span class="_ _3"></span>.<span class="_ _16"> </span>(By<span class="_ _16"> </span>convention,<span class="_ _14"> </span>we<span class="_ _16"> </span>draw<span class="_ _16"> </span>stacks<span class="_ _11"> </span>upside<span class="_ _16"> </span>down,<span class="_ _14"> </span>with<span class="_ _16"> </span>the<span class="_ _16"> </span>stack</div><div class="t m5 x1d h26 y7c5 ff7 fs19 fc1 sc0 ls0 ws0">“top”<span class="_ _13"> </span>shown<span class="_ _13"> </span>at<span class="_ _6"> </span>the<span class="_ _13"> </span>bottom<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _6"> </span>ﬁgure.)<span class="_ _6"> </span>T<span class="_ _0"></span>he<span class="_ _13"> </span>stack<span class="_ _13"> </span>pointer<span class="_ _6"> </span><span class="ffd">%rsp<span class="_ _13"> </span></span>holds<span class="_ _13"> </span>the<span class="_ _13"> </span>address</div><div class="t m5 x1d h26 y7c6 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span>the<span class="_"> </span>top<span class="_"> </span>stack<span class="_"> </span>element.</div><div class="t m5 x29 h26 y7c7 ff7 fs19 fc1 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _16"> </span><span class="ffd ls0">pushq<span class="_ _10"> </span><span class="ff7">instruction<span class="_"> </span>provides<span class="_ _11"> </span>the<span class="_"> </span>ability<span class="_ _11"> </span>to<span class="_"> </span>push<span class="_ _11"> </span>data<span class="_"> </span>onto<span class="_ _11"> </span>the<span class="_"> </span>stack,<span class="_ _11"> </span>while</span></span></div><div class="t m5 x1d h26 y7c8 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _6"> </span><span class="ffd">popq<span class="_ _13"> </span></span>instruction<span class="_ _6"> </span>pops<span class="_ _6"> </span>it.<span class="_ _13"> </span>Each<span class="_ _a"> </span>of<span class="_ _13"> </span>these<span class="_ _6"> </span>instructions<span class="_ _6"> </span>takes<span class="_ _13"> </span>a<span class="_ _6"> </span>single<span class="_ _6"> </span>operand—the</div><div class="t m5 x1d h26 y7c9 ff7 fs19 fc1 sc0 ls0 ws0">data<span class="_"> </span>source<span class="_"> </span>for<span class="_"> </span>pushing<span class="_"> </span>and<span class="_"> </span>the<span class="_"> </span>data<span class="_"> </span>destination<span class="_"> </span>for<span class="_"> </span>popping.</div><div class="t m5 x29 h26 y7ca ff7 fs19 fc1 sc0 ls0 ws0">Pushing<span class="_ _15"> </span>a<span class="_ _15"> </span>quad<span class="_ _15"> </span>word<span class="_ _15"> </span>value<span class="_ _15"> </span>onto<span class="_ _15"> </span>the<span class="_ _15"> </span>stack<span class="_ _21"> </span>involves<span class="_ _15"> </span>ﬁrst<span class="_ _15"> </span>decrementing<span class="_ _15"> </span>the</div><div class="t m5 x1d h26 y17d4 ff7 fs19 fc1 sc0 ls0 ws0">stack<span class="_ _15"> </span>pointer<span class="_ _14"> </span>by<span class="_ _15"> </span>8<span class="_ _15"> </span>and<span class="_ _15"> </span>then<span class="_ _15"> </span>writing<span class="_ _15"> </span>the<span class="_ _15"> </span>value<span class="_ _15"> </span>at<span class="_ _14"> </span>the<span class="_ _15"> </span>new<span class="_ _15"> </span>top-of-stack<span class="_ _15"> </span>address<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
