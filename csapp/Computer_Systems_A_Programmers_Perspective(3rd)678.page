<div id="pf2a6" class="pf w2 h11" data-page-no="2a6"><div class="pc pc2a6 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg2a6.png"/><div class="t m5 x1c4 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>6.6<span class="_ _60"> </span>Putting<span class="_ _10"> </span>It<span class="_ _10"> </span>T<span class="_ _1"></span>ogether:<span class="_ _10"> </span>The<span class="_ _10"> </span>Impact<span class="_ _10"> </span>of<span class="_ _10"> </span>Caches<span class="_ _10"> </span>on<span class="_ _10"> </span>Program<span class="_ _10"> </span>Performance<span class="_ _3e"> </span><span class="ffe fs1e">677</span></div><div class="t m5 x273 h3f y5a11 ff86 fs27 fc1 sc0 ls0 ws0">Core i7 Haswell</div><div class="t m5 x273 h3f y5a12 ff86 fs27 fc1 sc0 ls0 ws0">2.1 GHz</div><div class="t m5 x273 h3f y5a13 ff86 fs27 fc1 sc0 ls0 ws0">32 KB L1 d-cache</div><div class="t m5 x273 h3f y5a14 ff86 fs27 fc1 sc0 ls0 ws0">256 KB L2 cache</div><div class="t m5 x273 h3f y5a15 ff86 fs27 fc1 sc0 ls0 ws0">8 MB L3 cache</div><div class="t m5 x273 h3f y5a16 ff86 fs27 fc1 sc0 ls0 ws0">64 B block size</div><div class="t m5 x223 h3f y5a17 ff80 fs27 fc1 sc0 ls0 ws0">Ridges of </div><div class="t m5 x223 h3f y5a18 ff80 fs27 fc1 sc0 ls0 ws0">temporal</div><div class="t m5 x223 h3f y5a19 ff80 fs27 fc1 sc0 ls0 ws0">locality</div><div class="t m5 x197 h3f y5a1a ff86 fs27 fc1 sc0 ls0 wsc">128 M </div><div class="t m5 x101 h3f y5a1b ff86 fs27 fc1 sc0 ls0 ws0">32 M </div><div class="t m5 xf5 h3f y5a1c ff86 fs27 fc1 sc0 ls0 ws0">8 M </div><div class="t m5 x1aa h3f y5a1d ff86 fs27 fc1 sc0 ls0 ws0"><span class="fc3 sc0">2 M </span></div><div class="t m5 xa h3f y5a1e ff86 fs27 fc1 sc0 ls0 wsc"><span class="fc3 sc0">512 K </span></div><div class="t m5 xae h3f y5a1f ff86 fs27 fc1 sc0 ls254 wse"><span class="fc3 sc0">128 K </span></div><div class="t m5 x1cf h3f y5a20 ff86 fs27 fc1 sc0 ls0 wsc"><span class="fc3 sc0">32 K </span></div><div class="t m5 x123 h3f y5a21 ff86 fs27 fc1 sc0 ls0 ws0">0<span class="fc3 sc0"> </span></div><div class="t m5 x1a2 h3f y5a22 ff86 fs27 fc1 sc0 ls0 ws0">2,000<span class="fc3 sc0"> </span></div><div class="t m5 x73 h3f y5a23 ff86 fs27 fc1 sc0 ls0 ws0">4,000<span class="fc3 sc0"> </span></div><div class="t m5 x15d h3f y5a24 ff86 fs27 fc1 sc0 ls0 ws0">6,000 </div><div class="t m5 x1b6 h3f y5a25 ff86 fs27 fc1 sc0 ls0 ws0">8,000 </div><div class="t m5 x245 h3f y5a26 ff86 fs27 fc1 sc0 ls0 ws0">10,000 </div><div class="t m5 x63 h3f y5a27 ff86 fs27 fc1 sc0 ls0 ws0">12,000 </div><div class="t m5 xc h3f y5a28 ff86 fs27 fc1 sc0 ls0 ws0">14,000 </div><div class="t m5 x3e h3f y5a29 ff86 fs27 fc1 sc0 ls0 ws0">16,000 </div><div class="t m5 x142 h3f y5a2a ff86 fs27 fc1 sc0 ls0 ws0"><span class="fc3 sc0">s1 </span></div><div class="t m5 x17e h3f y5a2b ff86 fs27 fc1 sc0 ls0 ws0"><span class="fc3 sc0">s3 </span></div><div class="t m5 x15a h3f y5a2c ff86 fs27 fc1 sc0 ls0 ws0"><span class="fc3 sc0">s5 </span></div><div class="t m5 x1f7 h3f y5a2d ff86 fs27 fc1 sc0 ls0 ws0"><span class="fc3 sc0">s7 </span></div><div class="t m5 x5d h3f y5a2e ff86 fs27 fc1 sc0 ls0 ws0">s9 </div><div class="t m5 x13b h3f ye ff86 fs27 fc1 sc0 ls0 ws0">s1<span class="_ _1"></span>1 </div><div class="t m5 x1a1 h3f y5a2f ff7d fs27 fc1 sc0 ls0 ws0">Size (bytes) </div><div class="t m5 x1d3 h3f y5a30 ff7d fs27 fc1 sc0 ls0 ws0">Stride (x8 bytes) </div><div class="c x1c9 y5a31 w15 he5"><div class="t m5 x0 h3f y5a32 ff86 fs27 fc1 sc0 ls0 ws0">8</div></div><div class="c x1c2 y5a31 w16 he6"><div class="t m5 x274 h3f y5a32 ff86 fs27 fc1 sc0 ls0 ws0">M</div></div><div class="c x1aa y5a33 w17 he7"><div class="t m5 x0 h3f y5a34 ff86 fs27 fc1 sc0 ls0 ws0">2</div></div><div class="c x1f8 y5a33 w18 he8"><div class="t m5 x0 h3f y5a34 ff86 fs27 fc1 sc0 ls0 ws0">M</div></div><div class="c xa y5a35 w19 he9"><div class="t m5 x0 h3f y5a36 ff86 fs27 fc1 sc0 ls254 ws0">512</div></div><div class="c x166 y5a35 w1a he9"><div class="t m5 x0 h3f y5a36 ff86 fs27 fc1 sc0 ls0 ws0">K<span class="fc3 sc0"> </span></div></div><div class="t m5 xae h3f y5a37 ff86 fs27 fc1 sc0 ls0 ws0">12</div><div class="c x219 y5a38 w1b hea"><div class="t m5 x275 h3f y5a39 ff86 fs27 fc1 sc0 ls0 ws0">8</div></div><div class="t m5 x44 h3f y5a37 ff86 fs27 fc1 sc0 ls255 ws0"> K</div><div class="c x1cf y5a3a w1c hea"><div class="t m5 x0 h3f y5a3b ff86 fs27 fc1 sc0 ls0 ws0">32</div></div><div class="c x202 y5a3c w1d he8"><div class="t m5 x276 h3f y5a3d ff86 fs27 fc1 sc0 ls0 ws0">K</div></div><div class="c x1d4 y5a3e w1e heb"><div class="t m5 x277 h3f y5a3f ff86 fs27 fc1 sc0 ls0 ws0">0</div></div><div class="c x1d4 y5a40 w1f hec"><div class="t m5 x278 h3f y5a41 ff86 fs27 fc1 sc0 ls0 ws0">0</div></div><div class="t m5 x1a0 h3f y5a42 ff86 fs27 fc1 sc0 ls0 ws0"> </div><div class="c x142 y5a43 w20 he8"><div class="t m5 x276 h3f y5a44 ff86 fs27 fc1 sc0 ls0 ws0">s1</div></div><div class="t m5 x17e h3f y5a45 ff86 fs27 fc1 sc0 ls0 ws0">s</div><div class="c x17e y5a46 w21 hea"><div class="t m5 x279 h3f y5a3b ff86 fs27 fc1 sc0 ls0 ws0">3</div></div><div class="t m5 xa6 h3f y5a45 ff86 fs27 fc1 sc0 ls0 ws0"> </div><div class="c x15a y5a47 w22 hed"><div class="t m5 x276 h3f y5a3b ff86 fs27 fc1 sc0 ls0 ws0">s5<span class="fc3 sc0"> </span></div></div><div class="c xc1 y5a48 w21 he7"><div class="t m5 x276 h3f y5a49 ff86 fs27 fc1 sc0 ls0 ws0">s7<span class="fc3 sc0"> </span></div></div><div class="t m5 x1d6 h3f y5a4a ff80 fs27 fc1 sc0 ls0 ws0">Slopes</div><div class="t m5 x1d6 h3f y5a4b ff80 fs27 fc1 sc0 ls0 ws0">of spatial</div><div class="t m5 x1d6 h3f y5a4c ff80 fs27 fc1 sc0 ls0 ws0">locality</div><div class="t m7 xef h3f y5a4d ff7d fs27 fc1 sc0 ls0 ws0">Read throughput (MB/s) </div><div class="t m5 x1d1 h8a y5a4e ff86 fs50 fc1 sc0 ls0 ws0">Mem</div><div class="t m5 x18c h8a y5a4f ff86 fs50 fc1 sc0 ls0 ws0">L1</div><div class="t m5 x170 h8a y5a50 ff86 fs50 fc1 sc0 ls0 ws0">L2</div><div class="t m5 x13d h8a y5a51 ff86 fs50 fc1 sc0 ls0 ws0">L3</div><div class="t m5 x17 h34 y5a52 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>6.41<span class="_ _66"> </span><span class="fc1">A<span class="_"> </span>memor<span class="_ _2"></span>y<span class="_"> </span>mountain.<span class="_"> </span><span class="ff6">Shows<span class="_ _10"> </span>read<span class="_ _10"> </span>throughput<span class="_ _11"> </span>as<span class="_ _10"> </span>a<span class="_ _11"> </span>function<span class="_ _10"> </span>of<span class="_ _11"> </span>temporal<span class="_ _10"> </span>and<span class="_ _10"> </span>spatial<span class="_ _11"> </span>locality<span class="_ _3"></span>.</span></span></div><div class="t m5 x26 h26 y421c ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _13"> </span>geography<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _6"> </span>Core<span class="_ _13"> </span>i7<span class="_ _6"> </span>mountain<span class="_ _13"> </span>reveals<span class="_ _6"> </span>a<span class="_ _13"> </span>rich<span class="_ _6"> </span>structure.<span class="_ _6"> </span>Perpendicular</div><div class="t m5 x17 h26 y421d ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ffd">size<span class="_ _13"> </span></span>axis<span class="_"> </span>are<span class="_ _13"> </span>four<span class="_ _13"> </span><span class="ffa">ridges<span class="_ _13"> </span></span>that<span class="_ _13"> </span>correspond<span class="_ _13"> </span>to<span class="_"> </span>the<span class="_ _13"> </span>regions<span class="_ _13"> </span>of<span class="_ _13"> </span>temporal<span class="_ _13"> </span>locality</div><div class="t m5 x17 h26 y421e ff7 fs19 fc1 sc0 ls0 ws0">where<span class="_ _21"> </span>the<span class="_ _f"> </span>working<span class="_ _f"> </span>set<span class="_ _f"> </span>ﬁts<span class="_ _f"> </span>entirely<span class="_ _f"> </span>in<span class="_ _f"> </span>the<span class="_ _f"> </span>L1<span class="_ _f"> </span>cache<span class="_ _0"></span>,<span class="_ _e"> </span>L2<span class="_ _21"> </span>cache,<span class="_ _f"> </span>L3<span class="_ _f"> </span>cache,<span class="_ _f"> </span>and</div><div class="t m5 x17 h26 y421f ff7 fs19 fc1 sc0 ls0 ws0">main<span class="_"> </span>memory<span class="_ _7"></span>,<span class="_"> </span>respectively<span class="_ _3"></span>.<span class="_"> </span>Notice<span class="_ _13"> </span>that<span class="_"> </span>there<span class="_"> </span>is<span class="_ _13"> </span>more<span class="_"> </span>than<span class="_"> </span>an<span class="_ _13"> </span>order<span class="_"> </span>of<span class="_"> </span>magnitude</div><div class="t m5 x17 h26 y4220 ff7 fs19 fc1 sc0 ls0 ws0">difference<span class="_ _16"> </span>between<span class="_ _16"> </span>the<span class="_ _11"> </span>highest<span class="_ _16"> </span>peak<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>L1<span class="_ _16"> </span>ridge<span class="_ _1"></span>,<span class="_ _14"> </span>where<span class="_ _16"> </span>the<span class="_ _16"> </span>CPU<span class="_ _11"> </span>reads<span class="_ _16"> </span>at<span class="_ _16"> </span>a</div><div class="t m5 x17 h26 y4221 ff7 fs19 fc1 sc0 ls0 ws0">rate<span class="_ _11"> </span>of<span class="_ _11"> </span>over<span class="_ _11"> </span>14<span class="_ _11"> </span>GB/s<span class="_ _1"></span>,<span class="_ _16"> </span>and<span class="_"> </span>the<span class="_ _11"> </span>lowest<span class="_ _16"> </span>point<span class="_"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>main<span class="_"> </span>memory<span class="_ _11"> </span>ridge,<span class="_"> </span>where<span class="_ _16"> </span>the</div><div class="t m5 x17 h26 y4222 ff7 fs19 fc1 sc0 ls0 ws0">CPU<span class="_"> </span>reads<span class="_"> </span>at<span class="_"> </span>a<span class="_"> </span>rate<span class="_"> </span>of<span class="_"> </span>900<span class="_"> </span>MB/s<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y4223 ff7 fs19 fc1 sc0 ls0 ws0">On<span class="_ _16"> </span>each<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>L2,<span class="_ _14"> </span>L3,<span class="_ _14"> </span>and<span class="_ _16"> </span>main<span class="_ _16"> </span>memory<span class="_ _16"> </span>ridges<span class="_ _1"></span>,<span class="_ _14"> </span>there<span class="_ _16"> </span>is<span class="_ _14"> </span>a<span class="_ _16"> </span>slope<span class="_ _16"> </span>of<span class="_ _16"> </span>spatial</div><div class="t m5 x17 h26 y4224 ff7 fs19 fc1 sc0 ls0 ws0">locality<span class="_ _16"> </span>that<span class="_ _14"> </span>falls<span class="_ _14"> </span>downhill<span class="_ _14"> </span>as<span class="_ _16"> </span>the<span class="_ _14"> </span>stride<span class="_ _14"> </span>increases<span class="_ _14"> </span>and<span class="_ _16"> </span>spatial<span class="_ _14"> </span>locality<span class="_ _14"> </span>decreases<span class="_ _1"></span>.</div><div class="t m5 x17 h26 y4225 ff7 fs19 fc1 sc0 ls0 ws0">Notice<span class="_"> </span>that<span class="_ _11"> </span>even<span class="_"> </span>when<span class="_ _11"> </span>the<span class="_"> </span>working<span class="_ _11"> </span>set<span class="_"> </span>is<span class="_ _11"> </span>too<span class="_"> </span>large<span class="_ _11"> </span>to<span class="_"> </span>ﬁt<span class="_ _11"> </span>in<span class="_"> </span>any<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_"> </span>caches<span class="_ _1"></span>,<span class="_ _11"> </span>the</div><div class="t m5 x17 h26 y4226 ff7 fs19 fc1 sc0 ls0 ws0">highest<span class="_ _6"> </span>point<span class="_ _13"> </span>on<span class="_ _6"> </span>the<span class="_ _13"> </span>main<span class="_ _6"> </span>memory<span class="_ _13"> </span>ridge<span class="_ _6"> </span>is<span class="_ _13"> </span>a<span class="_ _6"> </span>factor<span class="_ _13"> </span>of<span class="_ _6"> </span>8<span class="_ _6"> </span>higher<span class="_ _13"> </span>than<span class="_ _6"> </span>its<span class="_ _13"> </span>lowest<span class="_ _6"> </span>point.</div><div class="t m5 x17 h26 y4227 ff7 fs19 fc1 sc0 ls0 ws0">So<span class="_ _13"> </span>even<span class="_"> </span>when<span class="_ _13"> </span>a<span class="_"> </span>program<span class="_ _13"> </span>has<span class="_"> </span>poor<span class="_ _13"> </span>temporal<span class="_"> </span>locality<span class="_ _7"></span>,<span class="_"> </span>spatial<span class="_ _13"> </span>locality<span class="_"> </span>can<span class="_ _13"> </span>still<span class="_"> </span>come</div><div class="t m5 x17 h26 y4228 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_"> </span>the<span class="_"> </span>rescue<span class="_"> </span>and<span class="_"> </span>make<span class="_"> </span>a<span class="_"> </span>signiﬁcant<span class="_"> </span>difference<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y4229 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>here<span class="_ _14"> </span>is<span class="_ _16"> </span>a<span class="_ _14"> </span>particularly<span class="_ _16"> </span>interesting<span class="_ _14"> </span>ﬂat<span class="_ _16"> </span>ridge<span class="_ _14"> </span>line<span class="_ _14"> </span>that<span class="_ _16"> </span>extends<span class="_ _14"> </span>perpendicular</div><div class="t m5 x17 h26 y422a ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _16"> </span>the<span class="_ _16"> </span>stride<span class="_ _16"> </span>axis<span class="_ _16"> </span>for<span class="_ _16"> </span>a<span class="_ _16"> </span>stride<span class="_ _16"> </span>of<span class="_ _16"> </span>1,<span class="_ _16"> </span>where<span class="_ _16"> </span>the<span class="_ _16"> </span>read<span class="_ _16"> </span>throughput<span class="_ _16"> </span>is<span class="_ _16"> </span>a<span class="_ _16"> </span>relatively<span class="_ _16"> </span>ﬂat</div><div class="t m5 x17 h26 y422b ff7 fs19 fc1 sc0 ls0 ws0">12<span class="_ _11"> </span>GB/s<span class="_ _1"></span>,<span class="_ _16"> </span>even<span class="_ _16"> </span>though<span class="_ _11"> </span>the<span class="_ _16"> </span>working<span class="_ _11"> </span>set<span class="_ _16"> </span>exceeds<span class="_ _11"> </span>the<span class="_ _16"> </span>capacities<span class="_ _16"> </span>of<span class="_ _11"> </span>L1<span class="_ _16"> </span>and<span class="_ _11"> </span>L2.<span class="_ _16"> </span>T<span class="_ _1"></span>his</div><div class="t m5 x17 h26 y422c ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_ _16"> </span>apparently<span class="_ _16"> </span>due<span class="_ _14"> </span>to<span class="_ _16"> </span>a<span class="_ _16"> </span>hardware<span class="_ _16"> </span><span class="ffa">prefetching<span class="_ _14"> </span></span>mechanism<span class="_ _14"> </span>in<span class="_ _16"> </span>the<span class="_ _16"> </span>Core<span class="_ _14"> </span>i7<span class="_ _16"> </span>memory</div><div class="t m5 x17 h26 y422d ff7 fs19 fc1 sc0 ls0 ws0">system<span class="_ _21"> </span>that<span class="_ _21"> </span>automatically<span class="_ _f"> </span>identiﬁes<span class="_ _21"> </span>sequential<span class="_ _f"> </span>stride-1<span class="_ _21"> </span>reference<span class="_ _f"> </span>patterns<span class="_ _21"> </span>and</div><div class="t m5 x17 h26 y422e ff7 fs19 fc1 sc0 ls0 ws0">attempts<span class="_"> </span>to<span class="_"> </span>fetch<span class="_"> </span>those<span class="_"> </span>blocks<span class="_"> </span>into<span class="_"> </span>the<span class="_"> </span>cache<span class="_"> </span>before<span class="_"> </span>they<span class="_"> </span>are<span class="_"> </span>accessed.<span class="_"> </span>W<span class="_ _0"></span>hile<span class="_"> </span>the</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
