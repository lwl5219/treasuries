<div id="pf122" class="pf w2 h11" data-page-no="122"><div class="pc pc122 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg122.png"/><div class="t m5 xb5 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>3.7<span class="_ _60"> </span>Procedures<span class="_ _3e"> </span><span class="ffe fs1e">289</span></div><div class="t m5 x2e h61 ye7 ff13 fs35 fc6 sc0 ls0 ws0">long<span class="_ _f"> </span>P(long<span class="_ _f"> </span>x)</div><div class="t m5 x2e h61 y26dc ff13 fs35 fc6 sc0 ls0 ws0">x<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi</div><div class="t m5 x2c h2d yecb ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">P:</span></div><div class="t m5 x2c h2d yecc ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">pushq<span class="_ _3f"> </span>%r15</span></div><div class="t m5 x2c h2d yecd ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">pushq<span class="_ _3f"> </span>%r14</span></div><div class="t m5 x2c h2d yece ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">pushq<span class="_ _3f"> </span>%r13</span></div><div class="t m5 x2c h2d yecf ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">pushq<span class="_ _3f"> </span>%r12</span></div><div class="t m5 x2c h2d yed0 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">pushq<span class="_ _3f"> </span>%rbp</span></div><div class="t m5 x2c h2e y20fe ff6 fs20 fc6 sc0 ls0 ws0">7</div><div class="t m5 xd1 h2d y1a10 ffd fs1e fc2 sc0 ls0 ws0">pushq<span class="_ _3f"> </span>%rbx</div><div class="t m5 x2c h2d yed3 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _45"> </span><span class="ffd fs1e fc2">subq<span class="_ _46"> </span>$24,<span class="_ _e"> </span>%rsp</span></div><div class="t m5 x2c h2d yed4 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rdi,<span class="_ _e"> </span>%rbx</span></div><div class="t m5 x17 h2d y462 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _45"> </span><span class="ffd fs1e fc2">leaq<span class="_ _46"> </span>1(%rdi),<span class="_ _e"> </span>%r15</span></div><div class="t m5 x17 h2d y26dd ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _45"> </span><span class="ffd fs1e fc2">leaq<span class="_ _46"> </span>2(%rdi),<span class="_ _e"> </span>%r14</span></div><div class="t m5 x17 h2d y2651 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _45"> </span><span class="ffd fs1e fc2">leaq<span class="_ _46"> </span>3(%rdi),<span class="_ _e"> </span>%r13</span></div><div class="t m5 x17 h2d yeab ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _45"> </span><span class="ffd fs1e fc2">leaq<span class="_ _46"> </span>4(%rdi),<span class="_ _e"> </span>%r12</span></div><div class="t m5 x17 h2e y2a37 ff6 fs20 fc6 sc0 ls0 ws0">14</div><div class="t m5 xd1 h2d y19a5 ffd fs1e fc2 sc0 ls0 ws0">leaq<span class="_ _46"> </span>5(%rdi),<span class="_ _e"> </span>%rbp</div><div class="t m5 x17 h2d y682 ff6 fs20 fc6 sc0 ls0 ws0">15<span class="_ _45"> </span><span class="ffd fs1e fc2">leaq<span class="_ _46"> </span>6(%rdi),<span class="_ _e"> </span>%rax</span></div><div class="t m5 x17 h2d y19a9 ff6 fs20 fc6 sc0 ls0 ws0">16<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rax,<span class="_ _e"> </span>(%rsp)</span></div><div class="t m5 x17 h2d y418 ff6 fs20 fc6 sc0 ls0 ws0">17<span class="_ _45"> </span><span class="ffd fs1e fc2">leaq<span class="_ _46"> </span>7(%rdi),<span class="_ _e"> </span>%rdx</span></div><div class="t m5 x17 h2d y2a38 ff6 fs20 fc6 sc0 ls0 ws0">18<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rdx,<span class="_ _e"> </span>8(%rsp)</span></div><div class="t m5 x17 h2d y3ed ff6 fs20 fc6 sc0 ls0 ws0">19<span class="_ _45"> </span><span class="ffd fs1e fc2">movl<span class="_ _46"> </span>$0,<span class="_ _e"> </span>%eax</span></div><div class="t m5 x17 h2d y2656 ff6 fs20 fc6 sc0 ls0 ws0">20<span class="_ _45"> </span><span class="ffd fs1e fc2">call<span class="_ _46"> </span>Q</span></div><div class="t m5 x160 h61 y19b0 ff13 fs35 fc6 sc0 ls156 ws0">...</div><div class="t m5 x34 h26 y2a39 ff7 fs19 fc2 sc0 ls0 ws0">A.<span class="_ _1f"> </span>Identify<span class="_"> </span>which<span class="_"> </span>local<span class="_"> </span>values<span class="_"> </span>get<span class="_"> </span>stored<span class="_"> </span>in<span class="_"> </span>callee-saved<span class="_"> </span>registers<span class="_ _1"></span>.</div><div class="t m5 x34 h26 y2a3a ff7 fs19 fc2 sc0 ls0 ws0">B<span class="_ _3"></span>.<span class="_ _1d"> </span>Identify<span class="_"> </span>which<span class="_"> </span>local<span class="_"> </span>values<span class="_"> </span>get<span class="_"> </span>stored<span class="_"> </span>on<span class="_"> </span>the<span class="_"> </span>stack.</div><div class="t m5 x34 h26 y2a3b ff7 fs19 fc2 sc0 ls0 ws0">C.<span class="_ _25"> </span>Explain<span class="_ _16"> </span>why<span class="_ _14"> </span>the<span class="_ _16"> </span>program<span class="_ _14"> </span>could<span class="_ _14"> </span>not<span class="_ _16"> </span>store<span class="_ _14"> </span>all<span class="_ _14"> </span>of<span class="_ _16"> </span>the<span class="_ _14"> </span>local<span class="_ _14"> </span>values<span class="_ _16"> </span>in<span class="_ _14"> </span>callee-</div><div class="t m5 x2d h26 y2a3c ff7 fs19 fc2 sc0 ls0 ws0">saved<span class="_"> </span>registers<span class="_ _1"></span>.</div><div class="t m5 x17 h41 y6fd ffe fs29 fc1 sc0 ls0 ws0">3.7.6<span class="_ _48"> </span><span class="fs19">Recursive<span class="_"> </span>Procedures</span></div><div class="t m5 x17 h26 y6fe ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _15"> </span>conventions<span class="_ _14"> </span>we<span class="_ _14"> </span>have<span class="_ _15"> </span>described<span class="_ _14"> </span>for<span class="_ _15"> </span>using<span class="_ _14"> </span>the<span class="_ _14"> </span>registers<span class="_ _15"> </span>and<span class="_ _14"> </span>the<span class="_ _14"> </span>stack<span class="_ _15"> </span>allow</div><div class="t m5 x17 h26 y6ff ff7 fs19 fc1 sc0 ls0 ws0">x86-64<span class="_"> </span>procedures<span class="_"> </span>to<span class="_ _13"> </span>call<span class="_"> </span>themselves<span class="_"> </span>recursively<span class="_ _3"></span>.<span class="_"> </span>Each<span class="_"> </span>procedure<span class="_ _13"> </span>call<span class="_"> </span>has<span class="_"> </span>its<span class="_"> </span>own</div><div class="t m5 x17 h26 y700 ff7 fs19 fc1 sc0 ls0 ws0">private<span class="_"> </span>space<span class="_ _11"> </span>on<span class="_ _11"> </span>the<span class="_"> </span>stack,<span class="_ _11"> </span>and<span class="_ _11"> </span>so<span class="_"> </span>the<span class="_ _11"> </span>local<span class="_ _11"> </span>variables<span class="_ _11"> </span>of<span class="_"> </span>the<span class="_ _11"> </span>multiple<span class="_ _11"> </span>outstanding</div><div class="t m5 x17 h26 y701 ff7 fs19 fc1 sc0 ls0 ws0">calls<span class="_ _13"> </span>do<span class="_ _6"> </span>not<span class="_ _13"> </span>interfere<span class="_ _13"> </span>with<span class="_ _6"> </span>one<span class="_ _13"> </span>another<span class="_ _0"></span>.<span class="_ _13"> </span>Furthermore<span class="_ _1"></span>,<span class="_ _13"> </span>the<span class="_ _13"> </span>stack<span class="_ _6"> </span>discipline<span class="_ _13"> </span>naturally</div><div class="t m5 x17 h26 y702 ff7 fs19 fc1 sc0 ls0 ws0">provides<span class="_ _6"> </span>the<span class="_ _13"> </span>proper<span class="_ _6"> </span>policy<span class="_ _6"> </span>for<span class="_ _6"> </span>allocating<span class="_ _13"> </span>local<span class="_ _6"> </span>storage<span class="_ _13"> </span>when<span class="_ _6"> </span>the<span class="_ _6"> </span>procedure<span class="_ _13"> </span>is<span class="_ _6"> </span>called</div><div class="t m5 x17 h26 y703 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_"> </span>deallocating<span class="_"> </span>it<span class="_"> </span>before<span class="_"> </span>returning.</div><div class="t m5 x26 h26 y704 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _15"> </span>3.35<span class="_ _14"> </span>shows<span class="_ _14"> </span>both<span class="_ _14"> </span>the<span class="_ _14"> </span>C<span class="_ _15"> </span>code<span class="_ _14"> </span>and<span class="_ _14"> </span>the<span class="_ _14"> </span>generated<span class="_ _14"> </span>assembly<span class="_ _15"> </span>code<span class="_ _14"> </span>for<span class="_ _14"> </span>a</div><div class="t m5 x17 h26 y705 ff7 fs19 fc1 sc0 ls0 ws0">recursive<span class="_"> </span>factorial<span class="_ _13"> </span>function.<span class="_"> </span>W<span class="_ _3"></span>e<span class="_"> </span>can<span class="_ _13"> </span>see<span class="_"> </span>that<span class="_ _13"> </span>the<span class="_"> </span>assembly<span class="_ _13"> </span>code<span class="_"> </span>uses<span class="_"> </span>register<span class="_ _13"> </span><span class="ffd">%rbx</span></div><div class="t m5 x17 h26 y706 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _11"> </span>hold<span class="_ _11"> </span>the<span class="_ _11"> </span>parameter<span class="_ _11"> </span><span class="ffd">n</span>,<span class="_ _11"> </span>after<span class="_ _11"> </span>Ô¨Årst<span class="_ _11"> </span>saving<span class="_ _16"> </span>the<span class="_"> </span>existing<span class="_ _11"> </span>value<span class="_ _11"> </span>on<span class="_ _16"> </span>the<span class="_"> </span>stack<span class="_ _11"> </span>(line<span class="_ _11"> </span>2)</div><div class="t m5 x17 h26 y707 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _13"> </span>later<span class="_ _6"> </span>restoring<span class="_ _13"> </span>the<span class="_ _6"> </span>value<span class="_ _13"> </span>before<span class="_ _6"> </span>returning<span class="_ _13"> </span>(line<span class="_ _13"> </span>11).<span class="_ _6"> </span>Due<span class="_ _13"> </span>to<span class="_ _6"> </span>the<span class="_ _13"> </span>stack<span class="_ _6"> </span>discipline,</div><div class="t m5 x17 h26 y708 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _13"> </span>the<span class="_ _6"> </span>register<span class="_ _1"></span>-saving<span class="_ _13"> </span>conventions<span class="_ _3"></span>,<span class="_ _13"> </span>we<span class="_ _13"> </span>can<span class="_ _6"> </span>be<span class="_ _13"> </span>assured<span class="_ _6"> </span>that<span class="_ _13"> </span>when<span class="_ _13"> </span>the<span class="_ _6"> </span>recursive<span class="_ _13"> </span>call</div><div class="t m5 x17 h26 y709 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _13"> </span><span class="ffd">rfact(n-1)<span class="_ _10"> </span></span>returns<span class="_ _13"> </span>(line<span class="_ _13"> </span>9)<span class="_"> </span>that<span class="_ _13"> </span>(1)<span class="_ _13"> </span>the<span class="_"> </span>result<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>call<span class="_"> </span>will<span class="_ _13"> </span>be<span class="_ _13"> </span>held<span class="_"> </span>in<span class="_ _13"> </span>register</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
