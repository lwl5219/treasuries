<div id="pf238" class="pf w2 h11" data-page-no="238"><div class="pc pc238 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg238.png"/><div class="t m5 x1fa h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>5.8<span class="_ _60"> </span>Loop<span class="_ _10"> </span>Unrolling<span class="_ _3e"> </span><span class="ffe fs1e">567</span></div><div class="t m5 x2c h2d ye7 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>i;</span></div><div class="t m5 x2c h2d yc4d ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _20"> </span><span class="ffd fs1e fc2">double<span class="_ _e"> </span>result<span class="_ _1f"> </span>=<span class="_ _1f"> </span>a[degree];</span></div><div class="t m5 x2c h2d yecb ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _20"> </span><span class="ffd fs1e fc2">for<span class="_ _e"> </span>(i<span class="_ _1f"> </span>=<span class="_ _1f"> </span>degree-1;<span class="_ _e"> </span>i<span class="_ _1f"> </span>&gt;=<span class="_ _e"> </span>0;<span class="_ _1f"> </span>i--)</span></div><div class="t m5 x2c h2d yecc ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _70"> </span><span class="ffd fs1e fc2">result<span class="_ _e"> </span>=<span class="_ _1f"> </span>a[i]<span class="_ _1f"> </span>+<span class="_ _e"> </span>x*result;</span></div><div class="t m5 x2c h2d yecd ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _20"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>result;</span></div><div class="t m5 x2c h2d yece ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x34 h26 y4d0b ff7 fs19 fc2 sc0 ls0 ws0">A.<span class="_ _1f"> </span>F<span class="_ _1"></span>or<span class="_ _11"> </span>degree<span class="_ _11"> </span><span class="ff11">n</span>,<span class="_ _11"> </span>how<span class="_ _16"> </span>many<span class="_"> </span>additions<span class="_ _11"> </span>and<span class="_ _16"> </span>how<span class="_"> </span>many<span class="_ _11"> </span>multiplications<span class="_ _16"> </span>does<span class="_"> </span>this</div><div class="t m5 x2d h26 y4d0c ff7 fs19 fc2 sc0 ls0 ws0">code<span class="_"> </span>perform?</div><div class="t m5 x34 h26 y4d0d ff7 fs19 fc2 sc0 ls0 ws0">B<span class="_ _3"></span>.<span class="_ _1d"> </span>On<span class="_"> </span>our<span class="_"> </span>reference<span class="_"> </span>machine<span class="_ _1"></span>,<span class="_"> </span>with<span class="_"> </span>the<span class="_"> </span>arithmetic<span class="_ _13"> </span>operations<span class="_"> </span>having<span class="_"> </span>the<span class="_"> </span>laten-</div><div class="t m5 x2d h26 y4d0e ff7 fs19 fc2 sc0 ls0 ws0">cies<span class="_"> </span>shown<span class="_"> </span>in<span class="_ _11"> </span>F<span class="_ _0"></span>igure<span class="_"> </span>5.12,<span class="_"> </span>we<span class="_ _11"> </span>measure<span class="_"> </span>the<span class="_ _11"> </span>CPE<span class="_"> </span>for<span class="_ _11"> </span>this<span class="_"> </span>function<span class="_"> </span>to<span class="_ _11"> </span>be<span class="_"> </span>8.00.</div><div class="t m5 x2d h26 y4d0f ff7 fs19 fc2 sc0 ls0 ws0">Explain<span class="_ _14"> </span>how<span class="_ _14"> </span>this<span class="_ _14"> </span>CPE<span class="_ _14"> </span>arises<span class="_ _16"> </span>based<span class="_ _14"> </span>on<span class="_ _14"> </span>the<span class="_ _14"> </span>data<span class="_ _14"> </span>dependencies<span class="_ _14"> </span>formed<span class="_ _14"> </span>be-</div><div class="t m5 x2d h26 y4d10 ff7 fs19 fc2 sc0 ls0 ws0">tween<span class="_"> </span>iterations<span class="_"> </span>due<span class="_"> </span>to<span class="_ _13"> </span>the<span class="_"> </span>operations<span class="_"> </span>implementing<span class="_"> </span>line<span class="_"> </span>7<span class="_"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>function.</div><div class="t m5 x34 h26 y4d11 ff7 fs19 fc2 sc0 ls0 ws0">C.<span class="_ _25"> </span>Explain<span class="_ _13"> </span>how<span class="_ _13"> </span>the<span class="_ _13"> </span>function<span class="_ _13"> </span>shown<span class="_ _6"> </span>in<span class="_ _13"> </span>Practice<span class="_ _13"> </span>Problem<span class="_ _13"> </span>5.5<span class="_ _13"> </span>can<span class="_ _13"> </span>run<span class="_ _13"> </span>faster<span class="_ _0"></span>,<span class="_ _13"> </span>even</div><div class="t m5 x2d h26 y4d12 ff7 fs19 fc2 sc0 ls0 ws0">though<span class="_"> </span>it<span class="_"> </span>requires<span class="_"> </span>more<span class="_"> </span>operations<span class="_ _1"></span>.</div><div class="t m5 x17 h3b y4b46 fff fs24 fc6 sc0 ls0 ws0">5.8<span class="_ _17"> </span><span class="ffe fs18">Loop<span class="_"> </span>Unrolling</span></div><div class="t m5 x17 h26 y4adb ff7 fs19 fc1 sc0 ls0 ws0">Loop<span class="_ _13"> </span>unrolling<span class="_ _13"> </span>is<span class="_ _13"> </span>a<span class="_"> </span>program<span class="_ _13"> </span>transformation<span class="_ _13"> </span>that<span class="_ _13"> </span>reduces<span class="_ _13"> </span>the<span class="_ _13"> </span>number<span class="_"> </span>of<span class="_ _13"> </span>iterations</div><div class="t m5 x17 h26 y4adc ff7 fs19 fc1 sc0 ls0 ws0">for<span class="_"> </span>a<span class="_"> </span>loop<span class="_"> </span>by<span class="_"> </span>increasing<span class="_"> </span>the<span class="_"> </span>number<span class="_"> </span>of<span class="_"> </span>elements<span class="_"> </span>computed<span class="_"> </span>on<span class="_"> </span>each<span class="_"> </span>iteration.<span class="_ _13"> </span>W<span class="_ _1"></span>e</div><div class="t m5 x17 h26 y4add ff7 fs19 fc1 sc0 ls0 ws0">saw<span class="_"> </span>an<span class="_ _13"> </span>example<span class="_"> </span>of<span class="_"> </span>this<span class="_ _13"> </span>with<span class="_"> </span>the<span class="_"> </span>function<span class="_ _13"> </span><span class="ffd">psum2<span class="_ _10"> </span></span>(F<span class="_ _0"></span>igure<span class="_"> </span>5.1),<span class="_ _13"> </span>where<span class="_"> </span>each<span class="_"> </span>iteration</div><div class="t m5 x17 h26 y4ade ff7 fs19 fc1 sc0 ls0 ws0">computes<span class="_ _14"> </span>two<span class="_ _14"> </span>elements<span class="_ _14"> </span>of<span class="_ _14"> </span>the<span class="_ _16"> </span>preﬁx<span class="_ _14"> </span>sum,<span class="_ _15"> </span>thereby<span class="_ _14"> </span>halving<span class="_ _14"> </span>the<span class="_ _14"> </span>total<span class="_ _14"> </span>number<span class="_ _14"> </span>of</div><div class="t m5 x17 h26 y4adf ff7 fs19 fc1 sc0 ls0 ws0">iterations<span class="_ _11"> </span>required.<span class="_ _11"> </span>Loop<span class="_ _11"> </span>unrolling<span class="_ _11"> </span>can<span class="_ _11"> </span>improve<span class="_ _11"> </span>performance<span class="_ _16"> </span>in<span class="_"> </span>two<span class="_ _11"> </span>ways<span class="_ _1"></span>.<span class="_ _16"> </span>F<span class="_ _1"></span>irst,</div><div class="t m5 x17 h26 y4ae0 ff7 fs19 fc1 sc0 ls0 ws0">it<span class="_ _13"> </span>reduces<span class="_ _13"> </span>the<span class="_ _13"> </span>number<span class="_ _6"> </span>of<span class="_ _13"> </span>operations<span class="_ _13"> </span>that<span class="_ _13"> </span>do<span class="_ _13"> </span>not<span class="_ _13"> </span>contribute<span class="_ _13"> </span>directly<span class="_ _6"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>program</div><div class="t m5 x17 h26 y4ae1 ff7 fs19 fc1 sc0 ls0 ws0">result,<span class="_ _11"> </span>such<span class="_"> </span>as<span class="_ _11"> </span>loop<span class="_ _11"> </span>indexing<span class="_ _11"> </span>and<span class="_ _11"> </span>conditional<span class="_ _11"> </span>branching.<span class="_"> </span>Second,<span class="_ _11"> </span>it<span class="_ _11"> </span>exposes<span class="_"> </span>ways</div><div class="t m5 x17 h26 y4ae2 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_ _11"> </span>which<span class="_ _16"> </span>we<span class="_ _11"> </span>can<span class="_ _11"> </span>further<span class="_ _16"> </span>transform<span class="_ _11"> </span>the<span class="_ _16"> </span>code<span class="_ _11"> </span>to<span class="_ _11"> </span>reduce<span class="_ _16"> </span>the<span class="_ _11"> </span>number<span class="_ _16"> </span>of<span class="_ _11"> </span>operations</div><div class="t m5 x17 h26 y4ae3 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_ _16"> </span>the<span class="_ _11"> </span>critical<span class="_ _16"> </span>paths<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>overall<span class="_ _16"> </span>computation.<span class="_ _11"> </span>In<span class="_ _16"> </span>this<span class="_ _16"> </span>section,<span class="_ _16"> </span>we<span class="_ _16"> </span>will<span class="_ _16"> </span>examine</div><div class="t m5 x17 h26 y4ae4 ff7 fs19 fc1 sc0 ls0 ws0">simple<span class="_"> </span>loop<span class="_"> </span>unrolling,<span class="_"> </span>without<span class="_"> </span>any<span class="_"> </span>further<span class="_"> </span>transformations<span class="_ _3"></span>.</div><div class="t m5 x26 h26 y4ae5 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _16"> </span>5.16<span class="_ _16"> </span>shows<span class="_ _11"> </span>a<span class="_ _16"> </span>version<span class="_ _11"> </span>of<span class="_ _16"> </span>our<span class="_ _11"> </span>combining<span class="_ _16"> </span>code<span class="_ _16"> </span>using<span class="_ _11"> </span>what<span class="_ _16"> </span>we<span class="_ _11"> </span>will<span class="_ _16"> </span>refer</div><div class="t m5 x17 h46 y4ae6 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _11"> </span>as<span class="_ _11"> </span>“2<span class="_"> </span><span class="ff12">×<span class="_ _13"> </span></span>1<span class="_"> </span>loop<span class="_ _11"> </span>unrolling.<span class="_ _1"></span>”<span class="_ _11"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span>ﬁrst<span class="_"> </span>loop<span class="_ _16"> </span>steps<span class="_ _11"> </span>through<span class="_ _11"> </span>the<span class="_ _11"> </span>array<span class="_ _11"> </span>two<span class="_ _16"> </span>elements</div><div class="t m5 x17 h26 y4ae7 ff7 fs19 fc1 sc0 ls0 ws0">at<span class="_"> </span>a<span class="_"> </span>time.<span class="_"> </span>T<span class="_ _1"></span>hat<span class="_"> </span>is<span class="_ _1"></span>,<span class="_ _11"> </span>the<span class="_"> </span>loop<span class="_ _11"> </span>index<span class="_"> </span><span class="ffd">i<span class="_ _11"> </span></span>is<span class="_"> </span>incremented<span class="_"> </span>by<span class="_ _11"> </span>2<span class="_"> </span>on<span class="_"> </span>each<span class="_ _11"> </span>iteration,<span class="_"> </span>and<span class="_ _11"> </span>the</div><div class="t m5 x17 h46 y4ae8 ff7 fs19 fc1 sc0 ls0 ws0">combining<span class="_"> </span>operation<span class="_"> </span>is<span class="_"> </span>applied<span class="_"> </span>to<span class="_"> </span>array<span class="_"> </span>elements<span class="_"> </span><span class="ff11">i<span class="_ _16"> </span></span>and<span class="_"> </span><span class="ff11">i<span class="_ _10"> </span><span class="ff12">+<span class="_ _10"> </span></span></span>1<span class="_ _13"> </span>in<span class="_"> </span>a<span class="_"> </span>single<span class="_"> </span>iteration.</div><div class="t m5 x26 h26 y4ae9 ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _16"> </span>general,<span class="_ _14"> </span>the<span class="_ _16"> </span>vector<span class="_ _16"> </span>length<span class="_ _16"> </span>will<span class="_ _14"> </span>not<span class="_ _16"> </span>be<span class="_ _16"> </span>a<span class="_ _16"> </span>multiple<span class="_ _14"> </span>of<span class="_ _16"> </span>2.<span class="_ _16"> </span>W<span class="_ _3"></span>e<span class="_ _14"> </span>want<span class="_ _16"> </span>our<span class="_ _16"> </span>code</div><div class="t m5 x17 h26 y4aea ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_"> </span>work<span class="_ _13"> </span>correctly<span class="_"> </span>for<span class="_"> </span>arbitrary<span class="_"> </span>vector<span class="_ _13"> </span>lengths<span class="_ _1"></span>.<span class="_"> </span>W<span class="_ _3"></span>e<span class="_"> </span>account<span class="_"> </span>for<span class="_"> </span>this<span class="_ _13"> </span>requirement<span class="_"> </span>in</div><div class="t m5 x17 h26 y4aeb ff7 fs19 fc1 sc0 ls0 ws0">two<span class="_ _16"> </span>ways<span class="_ _3"></span>.<span class="_ _16"> </span>First,<span class="_ _11"> </span>we<span class="_ _16"> </span>make<span class="_ _16"> </span>sure<span class="_ _16"> </span>the<span class="_ _11"> </span>ﬁrst<span class="_ _16"> </span>loop<span class="_ _16"> </span>does<span class="_ _16"> </span>not<span class="_ _16"> </span>overrun<span class="_ _11"> </span>the<span class="_ _16"> </span>array<span class="_ _16"> </span>bounds<span class="_ _1"></span>.</div><div class="t m5 x17 h46 y4aec ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _13"> </span>a<span class="_ _13"> </span>vector<span class="_ _13"> </span>of<span class="_"> </span>length<span class="_ _13"> </span><span class="ff11">n</span>,<span class="_ _13"> </span>we<span class="_ _13"> </span>set<span class="_ _13"> </span>the<span class="_"> </span>loop<span class="_ _13"> </span>limit<span class="_ _13"> </span>to<span class="_ _13"> </span>be<span class="_ _13"> </span><span class="ff11">n<span class="_ _13"> </span><span class="ff12">−<span class="_ _13"> </span></span></span>1.<span class="_ _13"> </span>W<span class="_ _3"></span>e<span class="_ _13"> </span>are<span class="_ _13"> </span>then<span class="_ _13"> </span>assured<span class="_"> </span>that</div><div class="t m5 x17 h46 y4aed ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _13"> </span>loop<span class="_"> </span>will<span class="_ _13"> </span>only<span class="_"> </span>be<span class="_ _13"> </span>executed<span class="_"> </span>when<span class="_ _13"> </span>the<span class="_"> </span>loop<span class="_ _13"> </span>index<span class="_ _13"> </span><span class="ff11">i<span class="_ _11"> </span></span>satisﬁes<span class="_"> </span><span class="ff11 ls216">i&lt;<span class="_ _3"></span>n<span class="_ _1"></span><span class="ff12 ls0">−<span class="_ _10"> </span><span class="ff7">1<span class="_ _1"></span>,<span class="_"> </span>and<span class="_ _13"> </span>hence</span></span></span></div><div class="t m5 x17 h46 y4aee ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>maximum<span class="_"> </span>array<span class="_"> </span>index<span class="_"> </span><span class="ff11">i<span class="_ _11"> </span><span class="ff12">+<span class="_ _10"> </span></span></span>1<span class="_ _13"> </span>will<span class="_"> </span>satisfy<span class="_"> </span><span class="ff11">i<span class="_ _10"> </span><span class="ff12">+<span class="_ _10"> </span></span></span>1<span class="_ _6"> </span><span class="ff11 ls42">&lt;(<span class="_ _80"></span>n<span class="ff12 ls0">−<span class="_ _10"> </span><span class="ff7">1<span class="_ _1"></span><span class="ff11">)<span class="_ _10"> </span><span class="ff12">+<span class="_ _13"></span><span class="ff7">1<span class="_ _13"> </span></span>=<span class="_ _13"></span></span>n<span class="ff7">.</span></span></span></span></span></div><div class="t m5 x26 h46 y4aef ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _14"> </span>can<span class="_ _16"> </span>generalize<span class="_ _14"> </span>this<span class="_ _14"> </span>idea<span class="_ _14"> </span>to<span class="_ _16"> </span>unroll<span class="_ _14"> </span>a<span class="_ _14"> </span>loop<span class="_ _16"> </span>by<span class="_ _14"> </span>any<span class="_ _14"> </span>factor<span class="_ _16"> </span><span class="ff11">k<span class="_ _2"></span></span>,<span class="_ _15"> </span>yielding<span class="_ _14"> </span><span class="ff11">k<span class="_ _10"> </span><span class="ff12">×<span class="_ _10"> </span></span></span>1</div><div class="t m5 x17 h46 y4af0 ffa fs19 fc1 sc0 ls0 ws0">loop<span class="_ _16"> </span>unrolling.<span class="_ _22"> </span><span class="ff7">T<span class="_ _3"></span>o<span class="_ _16"> </span>do<span class="_ _14"> </span>so<span class="_ _0"></span>,<span class="_ _14"> </span>we<span class="_ _16"> </span>set<span class="_ _14"> </span>the<span class="_ _14"> </span>upper<span class="_ _16"> </span>limit<span class="_ _14"> </span>to<span class="_ _16"> </span>be<span class="_ _14"> </span><span class="ff11">n<span class="_ _10"> </span><span class="ff12">−<span class="_ _13"> </span></span>k<span class="_ _11"> </span><span class="ff12">+<span class="_ _10"> </span></span></span>1<span class="_ _11"> </span>and<span class="_ _14"> </span>within<span class="_ _16"> </span>the</span></div><div class="t m5 x17 h46 y4af1 ff7 fs19 fc1 sc0 ls0 ws0">loop<span class="_ _13"> </span>apply<span class="_ _13"> </span>the<span class="_ _13"> </span>combining<span class="_ _13"> </span>operation<span class="_"> </span>to<span class="_ _13"> </span>elements<span class="_ _13"> </span><span class="ff11">i<span class="_ _10"> </span></span>through<span class="_"> </span><span class="ff11">i<span class="_ _10"> </span><span class="ff12">+<span class="_ _13"></span></span>k<span class="_ _10"> </span><span class="ff12">−<span class="_ _13"> </span></span></span>1.<span class="_ _13"> </span>Loop<span class="_ _13"> </span>index<span class="_ _13"> </span><span class="ffd">i</span></div><div class="t m5 x17 h46 y4af2 ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_ _14"> </span>incremented<span class="_ _14"> </span>by<span class="_ _15"> </span><span class="ff11">k<span class="_ _15"> </span></span>in<span class="_ _15"> </span>each<span class="_ _14"> </span>iteration.<span class="_ _14"> </span>The<span class="_ _16"> </span>maximum<span class="_ _15"> </span>array<span class="_ _14"> </span>index<span class="_ _14"> </span><span class="ff11">i<span class="_"> </span><span class="ff12">+<span class="_ _13"></span></span>k<span class="_ _11"> </span><span class="ff12">−<span class="_ _10"> </span></span></span>1<span class="_ _16"> </span>will</div><div class="t m5 x17 h26 y4af3 ff7 fs19 fc1 sc0 ls0 ws0">then<span class="_ _15"> </span>be<span class="_ _15"> </span>less<span class="_ _15"> </span>than<span class="_ _15"> </span><span class="ff11">n</span>.<span class="_ _15"> </span>W<span class="_ _3"></span>e<span class="_ _15"> </span>include<span class="_ _15"> </span>the<span class="_ _15"> </span>second<span class="_ _15"> </span>loop<span class="_ _15"> </span>to<span class="_ _15"> </span>step<span class="_ _15"> </span>through<span class="_ _15"> </span>the<span class="_ _15"> </span>ﬁnal<span class="_ _15"> </span>few</div><div class="t m5 x17 h26 y4af4 ff7 fs19 fc1 sc0 ls0 ws0">elements<span class="_ _21"> </span>of<span class="_ _21"> </span>the<span class="_ _21"> </span>vector<span class="_ _21"> </span>one<span class="_ _21"> </span>at<span class="_ _21"> </span>a<span class="_ _f"> </span>time<span class="_ _1"></span>.<span class="_ _f"> </span>T<span class="_ _1"></span>he<span class="_ _f"> </span>body<span class="_ _21"> </span>of<span class="_ _21"> </span>this<span class="_ _21"> </span>loop<span class="_ _21"> </span>will<span class="_ _21"> </span>be<span class="_ _f"> </span>executed</div><div class="t m5 x17 h46 y4d13 ff7 fs19 fc1 sc0 ls0 ws0">between<span class="_ _13"> </span>0<span class="_"> </span>and<span class="_ _13"> </span><span class="ff11">k<span class="_ _10"> </span><span class="ff12">−<span class="_ _13"></span></span></span>1<span class="_ _13"> </span>times<span class="_ _3"></span>.<span class="_"> </span>F<span class="_ _3"></span>or<span class="_"> </span><span class="ff11">k<span class="_ _10"> </span><span class="ff12">=<span class="_ _13"></span></span></span>2,<span class="_"> </span>we<span class="_ _13"> </span>could<span class="_ _13"> </span>use<span class="_ _13"> </span>a<span class="_"> </span>simple<span class="_ _13"> </span>conditional<span class="_ _13"> </span>statement</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
