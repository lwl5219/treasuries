<div id="pf1d8" class="pf w2 h11" data-page-no="1d8"><div class="pc pc1d8 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1d8.png"/><div class="t m5 x13d h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>4.5<span class="_ _60"> </span>Pipelined<span class="_ _10"> </span>Y86-64<span class="_ _10"> </span>Implementations<span class="_ _3e"> </span><span class="ffe fs1e">471</span></div><div class="t m5 x34 h2a y257 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">Enumerating<span class="_ _11"> </span>classes<span class="_ _11"> </span>of<span class="_ _11"> </span>data<span class="_ _16"> </span>hazards</span></div><div class="t m5 x34 h2b y2d0 ff7 fs1e fc2 sc0 ls0 ws0">Hazards<span class="_ _14"> </span>can<span class="_ _14"> </span>potentially<span class="_ _14"> </span>occur<span class="_ _14"> </span>when<span class="_ _14"> </span>one<span class="_ _14"> </span>instruction<span class="_ _14"> </span>updates<span class="_ _14"> </span>part<span class="_ _14"> </span>of<span class="_ _14"> </span>the<span class="_ _14"> </span>program<span class="_ _14"> </span>state<span class="_ _14"> </span>that<span class="_ _14"> </span>will<span class="_ _14"> </span>be</div><div class="t m5 x34 h2b y2d1 ff7 fs1e fc2 sc0 ls0 ws0">read<span class="_"> </span>by<span class="_"> </span>a<span class="_"> </span>later<span class="_"> </span>instruction.<span class="_"> </span>F<span class="_ _3"></span>or<span class="_"> </span>Y86-64,<span class="_"> </span>the<span class="_"> </span>program<span class="_"> </span>state<span class="_"> </span>includes<span class="_"> </span>the<span class="_"> </span>program<span class="_"> </span>registers<span class="_ _3"></span>,<span class="_"> </span>the<span class="_"> </span>program</div><div class="t m5 x34 h2b y2d2 ff7 fs1e fc2 sc0 ls0 ws0">counter,<span class="_ _16"> </span>the<span class="_ _16"> </span>memory<span class="_ _3"></span>,<span class="_ _14"> </span>the<span class="_ _16"> </span>condition<span class="_ _16"> </span>code<span class="_ _16"> </span>register,<span class="_ _16"> </span>and<span class="_ _16"> </span>the<span class="_ _14"> </span>status<span class="_ _16"> </span>register.<span class="_ _16"> </span>Let<span class="_ _16"> </span>us<span class="_ _16"> </span>look<span class="_ _16"> </span>at<span class="_ _16"> </span>the<span class="_ _16"> </span>hazard</div><div class="t m5 x34 h2b y2d3 ff7 fs1e fc2 sc0 ls0 ws0">possibilities<span class="_"> </span>in<span class="_"> </span>our<span class="_"> </span>proposed<span class="_"> </span>design<span class="_"> </span>for<span class="_"> </span>each<span class="_"> </span>of<span class="_"> </span>these<span class="_"> </span>forms<span class="_"> </span>of<span class="_"> </span>state<span class="_ _1"></span>.</div><div class="t m5 x26 h2b ya7a ffa fs1e fc2 sc0 ls0 ws0">Program<span class="_ _13"> </span>registers<span class="_ _1"></span>.<span class="_ _21"> </span><span class="ff7">T<span class="_ _0"></span>hese<span class="_ _13"> </span>are<span class="_"> </span>the<span class="_ _13"> </span>hazards<span class="_ _13"> </span>we<span class="_"> </span>have<span class="_ _13"> </span>already<span class="_ _13"> </span>identiﬁed.<span class="_"> </span>T<span class="_ _1"></span>hey<span class="_ _13"> </span>arise<span class="_"> </span>because<span class="_ _13"> </span>the<span class="_ _13"> </span>register</span></div><div class="t m5 x142 h2b ya7b ff7 fs1e fc2 sc0 ls0 ws0">ﬁle<span class="_ _16"> </span>is<span class="_ _16"> </span>read<span class="_ _11"> </span>in<span class="_ _16"> </span>one<span class="_ _16"> </span>stage<span class="_ _16"> </span>and<span class="_ _16"> </span>written<span class="_ _16"> </span>in<span class="_ _16"> </span>another<span class="_ _0"></span>,<span class="_ _16"> </span>leading<span class="_ _16"> </span>to<span class="_ _16"> </span>possible<span class="_ _16"> </span>unintended<span class="_ _16"> </span>interactions</div><div class="t m5 x142 h2b ya7c ff7 fs1e fc2 sc0 ls0 ws0">between<span class="_"> </span>different<span class="_"> </span>instructions<span class="_ _1"></span>.</div><div class="t m5 x26 h2b y417e ffa fs1e fc2 sc0 ls0 ws0">Program<span class="_"> </span>counter<span class="_ _3"></span>.<span class="_ _21"> </span><span class="ff7">Conﬂicts<span class="_"> </span>between<span class="_ _10"> </span>updating<span class="_"> </span>and<span class="_ _10"> </span>reading<span class="_ _10"> </span>the<span class="_ _10"> </span>program<span class="_ _10"> </span>counter<span class="_ _10"> </span>give<span class="_ _10"> </span>rise<span class="_ _10"> </span>to<span class="_ _10"> </span>control</span></div><div class="t m5 x142 h2b y417f ff7 fs1e fc2 sc0 ls0 ws0">hazards<span class="_ _1"></span>.<span class="_ _21"> </span>No<span class="_ _21"> </span>hazard<span class="_ _21"> </span>arises<span class="_ _21"> </span>when<span class="_ _21"> </span>our<span class="_ _21"> </span>fetch-stage<span class="_ _21"> </span>logic<span class="_ _21"> </span>correctly<span class="_ _21"> </span>predicts<span class="_ _21"> </span>the<span class="_ _21"> </span>new<span class="_ _21"> </span>value<span class="_ _21"> </span>of</div><div class="t m5 x142 h2b y4180 ff7 fs1e fc2 sc0 ls0 ws0">the<span class="_ _14"> </span>program<span class="_ _15"> </span>counter<span class="_ _15"> </span>before<span class="_ _14"> </span>fetching<span class="_ _15"> </span>the<span class="_ _15"> </span>next<span class="_ _14"> </span>instruction.<span class="_ _15"> </span>Mispredicted<span class="_ _15"> </span>branches<span class="_ _14"> </span>and<span class="_ _15"> </span><span class="ffd">ret</span></div><div class="t m5 x142 h2b y4181 ff7 fs1e fc2 sc0 ls0 ws0">instructions<span class="_"> </span>require<span class="_"> </span>special<span class="_"> </span>handling,<span class="_"> </span>as<span class="_"> </span>will<span class="_"> </span>be<span class="_"> </span>discussed<span class="_"> </span>in<span class="_"> </span>Section<span class="_"> </span>4.5.5.</div><div class="t m5 x26 h2b y4182 ffa fs1e fc2 sc0 ls0 ws0">Memory<span class="_ _1"></span>.<span class="_ _15"> </span><span class="ff7">Writes<span class="_ _14"> </span>and<span class="_ _16"> </span>reads<span class="_ _14"> </span>of<span class="_ _14"> </span>the<span class="_ _16"> </span>data<span class="_ _14"> </span>memory<span class="_ _16"> </span>both<span class="_ _14"> </span>occur<span class="_ _16"> </span>in<span class="_ _14"> </span>the<span class="_ _16"> </span>memory<span class="_ _14"> </span>stage<span class="_ _0"></span>.<span class="_ _16"> </span>By<span class="_ _14"> </span>the<span class="_ _16"> </span>time<span class="_ _14"> </span>an</span></div><div class="t m5 x142 h2b y4183 ff7 fs1e fc2 sc0 ls0 ws0">instruction<span class="_ _14"> </span>reading<span class="_ _16"> </span>memory<span class="_ _14"> </span>reaches<span class="_ _14"> </span>this<span class="_ _14"> </span>stage,<span class="_ _14"> </span>any<span class="_ _16"> </span>preceding<span class="_ _14"> </span>instructions<span class="_ _14"> </span>writing<span class="_ _14"> </span>memory</div><div class="t m5 x142 h2b y4184 ff7 fs1e fc2 sc0 ls0 ws0">will<span class="_"> </span>have<span class="_"> </span>already<span class="_"> </span>done<span class="_"> </span>so<span class="_ _1"></span>.<span class="_"> </span>On<span class="_"> </span>the<span class="_"> </span>other<span class="_"> </span>hand,<span class="_"> </span>there<span class="_"> </span>can<span class="_"> </span>be<span class="_"> </span>interference<span class="_"> </span>between<span class="_"> </span>instructions</div><div class="t m5 x142 h2b y4185 ff7 fs1e fc2 sc0 ls0 ws0">writing<span class="_"> </span>data<span class="_ _11"> </span>in<span class="_ _10"> </span>the<span class="_ _11"> </span>memory<span class="_ _10"> </span>stage<span class="_ _11"> </span>and<span class="_ _10"> </span>the<span class="_ _11"> </span>reading<span class="_ _10"> </span>of<span class="_ _11"> </span>instructions<span class="_ _10"> </span>in<span class="_ _11"> </span>the<span class="_ _10"> </span>fetch<span class="_ _11"> </span>stage<span class="_ _1"></span>,<span class="_ _11"> </span>since<span class="_ _11"> </span>the</div><div class="t m5 x142 h2b y4186 ff7 fs1e fc2 sc0 ls0 ws0">instruction<span class="_ _16"> </span>and<span class="_ _11"> </span>data<span class="_ _16"> </span>memories<span class="_ _16"> </span>reference<span class="_ _16"> </span>a<span class="_ _16"> </span>single<span class="_ _16"> </span>address<span class="_ _11"> </span>space.<span class="_ _11"> </span>This<span class="_ _11"> </span>can<span class="_ _16"> </span>only<span class="_ _16"> </span>happen<span class="_ _16"> </span>with</div><div class="t m5 x142 h2b y4187 ff7 fs1e fc2 sc0 ls0 ws0">programs<span class="_ _16"> </span>containing<span class="_ _14"> </span><span class="ffa">self-modifying<span class="_ _16"> </span>code</span>,<span class="_ _15"> </span>where<span class="_ _16"> </span>instructions<span class="_ _14"> </span>write<span class="_ _16"> </span>to<span class="_ _14"> </span>a<span class="_ _16"> </span>portion<span class="_ _14"> </span>of<span class="_ _16"> </span>memory</div><div class="t m5 x142 h2b y4188 ff7 fs1e fc2 sc0 ls0 ws0">from<span class="_"> </span>which<span class="_"> </span>instructions<span class="_"> </span>are<span class="_ _10"> </span>later<span class="_ _10"> </span>fetched.<span class="_"> </span>Some<span class="_ _10"> </span>systems<span class="_ _10"> </span>have<span class="_ _10"> </span>complex<span class="_ _10"> </span>mechanisms<span class="_ _10"> </span>to<span class="_ _10"> </span>detect</div><div class="t m5 x142 h2b y4189 ff7 fs1e fc2 sc0 ls0 ws0">and<span class="_ _15"> </span>avoid<span class="_ _21"> </span>such<span class="_ _21"> </span>hazards<span class="_ _1"></span>,<span class="_ _f"> </span>while<span class="_ _21"> </span>others<span class="_ _15"> </span>simply<span class="_ _21"> </span>mandate<span class="_ _21"> </span>that<span class="_ _21"> </span>programs<span class="_ _15"> </span>should<span class="_ _21"> </span>not<span class="_ _21"> </span>use<span class="_ _15"> </span>self-</div><div class="t m5 x142 h2b y418a ff7 fs1e fc2 sc0 ls0 ws0">modifying<span class="_ _11"> </span>code<span class="_ _1"></span>.<span class="_ _11"> </span>W<span class="_ _1"></span>e<span class="_ _10"> </span>will<span class="_ _11"> </span>assume<span class="_ _11"> </span>for<span class="_ _11"> </span>simplicity<span class="_ _11"> </span>that<span class="_ _11"> </span>programs<span class="_ _10"> </span>do<span class="_ _11"> </span>not<span class="_ _11"> </span>modify<span class="_ _11"> </span>themselves<span class="_ _1"></span>,<span class="_ _11"> </span>and</div><div class="t m5 x142 h2b y7ba ff7 fs1e fc2 sc0 ls0 ws0">therefore<span class="_ _11"> </span>we<span class="_ _11"> </span>do<span class="_ _16"> </span>not<span class="_ _11"> </span>need<span class="_ _11"> </span>to<span class="_ _11"> </span>take<span class="_ _16"> </span>special<span class="_ _11"> </span>measures<span class="_ _11"> </span>to<span class="_ _11"> </span>update<span class="_ _16"> </span>the<span class="_ _11"> </span>instruction<span class="_ _11"> </span>memory<span class="_ _11"> </span>based</div><div class="t m5 x142 h2b y7bb ff7 fs1e fc2 sc0 ls0 ws0">on<span class="_"> </span>updates<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>data<span class="_"> </span>memory<span class="_"> </span>during<span class="_"> </span>program<span class="_"> </span>execution.</div><div class="t m5 x26 h2b y418b ffa fs1e fc2 sc0 ls0 ws0">Condition<span class="_ _a"> </span>code<span class="_ _6"> </span>register<span class="_ _1"></span>.<span class="_ _15"> </span><span class="ff7">These<span class="_ _a"> </span>are<span class="_ _6"> </span>written<span class="_ _6"> </span>by<span class="_ _6"> </span>integer<span class="_ _6"> </span>operations<span class="_ _6"> </span>in<span class="_ _a"> </span>the<span class="_ _6"> </span>execute<span class="_ _6"> </span>stage.<span class="_ _a"> </span>T<span class="_ _0"></span>hey<span class="_ _a"> </span>are<span class="_ _6"> </span>read<span class="_ _6"> </span>by</span></div><div class="t m5 x142 h2b y418c ff7 fs1e fc2 sc0 ls0 ws0">conditional<span class="_"> </span>moves<span class="_ _13"> </span>in<span class="_"> </span>the<span class="_ _13"> </span>execute<span class="_"> </span>stage<span class="_"> </span>and<span class="_ _13"> </span>by<span class="_"> </span>conditional<span class="_ _13"> </span>jumps<span class="_"> </span>in<span class="_ _13"> </span>the<span class="_"> </span>memory<span class="_"> </span>stage<span class="_ _1"></span>.<span class="_"> </span>By<span class="_ _13"> </span>the</div><div class="t m5 x142 h2b y418d ff7 fs1e fc2 sc0 ls0 ws0">time<span class="_"> </span>a<span class="_ _11"> </span>conditional<span class="_ _10"> </span>move<span class="_ _11"> </span>or<span class="_"> </span>jump<span class="_ _11"> </span>reaches<span class="_ _10"> </span>the<span class="_ _11"> </span>execute<span class="_ _10"> </span>stage,<span class="_"> </span>any<span class="_ _11"> </span>preceding<span class="_"> </span>integer<span class="_ _11"> </span>operation</div><div class="t m5 x142 h2b y418e ff7 fs1e fc2 sc0 ls0 ws0">will<span class="_"> </span>have<span class="_"> </span>already<span class="_"> </span>completed<span class="_"> </span>this<span class="_"> </span>stage<span class="_ _1"></span>.<span class="_"> </span>No<span class="_"> </span>hazards<span class="_"> </span>can<span class="_"> </span>arise.</div><div class="t m5 x26 h2b y418f ffa fs1e fc2 sc0 ls0 ws0">Status<span class="_"> </span>register<span class="_ _3"></span>.<span class="_ _15"> </span><span class="ff7">T<span class="_ _0"></span>he<span class="_"> </span>program<span class="_ _13"> </span>status<span class="_"> </span>can<span class="_ _13"> </span>be<span class="_"> </span>affected<span class="_"> </span>by<span class="_ _13"> </span>instructions<span class="_"> </span>as<span class="_ _13"> </span>they<span class="_"> </span>ﬂow<span class="_ _13"> </span>through<span class="_"> </span>the<span class="_ _13"> </span>pipeline<span class="_ _0"></span>.</span></div><div class="t m5 x142 h2b y4190 ff7 fs1e fc2 sc0 ls0 ws0">Our<span class="_ _15"> </span>mechanism<span class="_ _15"> </span>of<span class="_ _15"> </span>associating<span class="_ _15"> </span>a<span class="_ _14"> </span>status<span class="_ _15"> </span>code<span class="_ _15"> </span>with<span class="_ _15"> </span>each<span class="_ _15"> </span>instruction<span class="_ _15"> </span>in<span class="_ _15"> </span>the<span class="_ _15"> </span>pipeline<span class="_ _15"> </span>enables</div><div class="t m5 x142 h2b y4191 ff7 fs1e fc2 sc0 ls0 ws0">the<span class="_ _16"> </span>processor<span class="_ _16"> </span>to<span class="_ _16"> </span>come<span class="_ _14"> </span>to<span class="_ _16"> </span>an<span class="_ _16"> </span>orderly<span class="_ _14"> </span>halt<span class="_ _16"> </span>when<span class="_ _16"> </span>an<span class="_ _16"> </span>exception<span class="_ _14"> </span>occurs<span class="_ _1"></span>,<span class="_ _14"> </span>as<span class="_ _16"> </span>will<span class="_ _16"> </span>be<span class="_ _14"> </span>discussed<span class="_ _16"> </span>in</div><div class="t m5 x142 h2b y4192 ff7 fs1e fc2 sc0 ls0 ws0">Section<span class="_"> </span>4.5.6.</div><div class="t m5 x35 h2b y4193 ff7 fs1e fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _14"> </span>analysis<span class="_ _14"> </span>shows<span class="_ _15"> </span>that<span class="_ _14"> </span>we<span class="_ _14"> </span>only<span class="_ _14"> </span>need<span class="_ _14"> </span>to<span class="_ _14"> </span>deal<span class="_ _14"> </span>with<span class="_ _14"> </span>register<span class="_ _14"> </span>data<span class="_ _14"> </span>hazards<span class="_ _1"></span>,<span class="_ _15"> </span>control<span class="_ _14"> </span>hazards<span class="_ _1"></span>,<span class="_ _15"> </span>and</div><div class="t m5 x34 h2b y4194 ff7 fs1e fc2 sc0 ls0 ws0">making<span class="_ _16"> </span>sure<span class="_ _16"> </span>exceptions<span class="_ _16"> </span>are<span class="_ _16"> </span>handled<span class="_ _14"> </span>properly<span class="_ _3"></span>.<span class="_ _16"> </span>A<span class="_ _16"> </span>systematic<span class="_ _16"> </span>analysis<span class="_ _16"> </span>of<span class="_ _14"> </span>this<span class="_ _16"> </span>form<span class="_ _16"> </span>is<span class="_ _16"> </span>important<span class="_ _16"> </span>when</div><div class="t m5 x34 h2b y4195 ff7 fs1e fc2 sc0 ls0 ws0">designing<span class="_ _13"> </span>a<span class="_"> </span>complex<span class="_ _13"> </span>system.<span class="_ _13"> </span>It<span class="_"> </span>can<span class="_ _13"> </span>identify<span class="_ _13"> </span>the<span class="_ _13"> </span>potential<span class="_"> </span>difﬁculties<span class="_ _13"> </span>in<span class="_ _13"> </span>implementing<span class="_"> </span>the<span class="_ _13"> </span>system,<span class="_ _13"> </span>and<span class="_"> </span>it</div><div class="t m5 x34 h2b y4196 ff7 fs1e fc2 sc0 ls0 ws0">can<span class="_"> </span>guide<span class="_"> </span>the<span class="_"> </span>generation<span class="_"> </span>of<span class="_"> </span>test<span class="_"> </span>programs<span class="_"> </span>to<span class="_"> </span>be<span class="_"> </span>used<span class="_"> </span>in<span class="_"> </span>checking<span class="_"> </span>the<span class="_"> </span>correctness<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>system.</div><div class="t m5 x17 h26 ycf1 ff7 fs19 fc2 sc0 ls0 ws0">condition<span class="_ _14"> </span>codes<span class="_ _1"></span>,<span class="_ _15"> </span>or<span class="_ _14"> </span>the<span class="_ _14"> </span>program<span class="_ _14"> </span>status<span class="_ _1"></span>.<span class="_ _14"> </span>These<span class="_ _16"> </span>are<span class="_ _14"> </span>shown<span class="_ _14"> </span>as<span class="_ _14"> </span>white<span class="_ _14"> </span>boxes<span class="_ _15"> </span>in<span class="_ _14"> </span>the</div><div class="t m5 x17 h26 ycf2 ff7 fs19 fc2 sc0 ls0 ws0">pipeline<span class="_ _14"> </span>diagrams<span class="_ _14"> </span>of<span class="_ _14"> </span>Figures<span class="_ _16"> </span>4.47<span class="_ _14"> </span>and<span class="_ _14"> </span>4.48.<span class="_ _14"> </span>In<span class="_ _15"> </span>these<span class="_ _14"> </span>ﬁgures<span class="_ _14"> </span>the<span class="_ _14"> </span>arrow<span class="_ _14"> </span>between</div><div class="t m5 x17 h26 ycf3 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>box<span class="_ _11"> </span>labeled<span class="_ _11"> </span>“D”<span class="_ _11"> </span>for<span class="_ _11"> </span>the<span class="_ _11"> </span><span class="ffd">addq<span class="_ _11"> </span></span>instruction<span class="_"> </span>and<span class="_ _11"> </span>the<span class="_ _11"> </span>box<span class="_ _11"> </span>labeled<span class="_ _11"> </span>“E”<span class="_"> </span>for<span class="_ _11"> </span>one<span class="_ _11"> </span>of</div><div class="t m5 x17 h26 ycf4 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _13"> </span>pipeline<span class="_"> </span>bubbles<span class="_ _13"> </span>indicates<span class="_"> </span>that<span class="_ _13"> </span>a<span class="_"> </span>bubble<span class="_ _13"> </span>was<span class="_"> </span>injected<span class="_ _13"> </span>into<span class="_"> </span>the<span class="_ _13"> </span>execute<span class="_"> </span>stage<span class="_ _13"> </span>in</div><div class="t m5 x17 h26 y4197 ff7 fs19 fc2 sc0 ls0 ws0">place<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_"> </span><span class="ffd">addq<span class="_ _13"> </span></span>instruction<span class="_ _13"> </span>that<span class="_ _13"> </span>would<span class="_"> </span>normally<span class="_ _13"> </span>have<span class="_ _13"> </span>passed<span class="_ _13"> </span>from<span class="_ _13"> </span>the<span class="_"> </span>decode<span class="_ _13"> </span>to</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
