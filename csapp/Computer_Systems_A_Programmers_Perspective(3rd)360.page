<div id="pf168" class="pf w2 h11" data-page-no="168"><div class="pc pc168 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg168.png"/><div class="t m5 x5f h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Homework<span class="_ _10"> </span>Problems<span class="_ _1b"> </span><span class="ffe fs1e">359</span></div><div class="t m5 x2d h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">is<span class="_ _11"> </span>only<span class="_ _16"> </span>one<span class="_ _16"> </span>answer<span class="_ _11"> </span>that<span class="_ _16"> </span>does<span class="_ _11"> </span>not<span class="_ _16"> </span>perform<span class="_ _16"> </span>any<span class="_ _11"> </span>casting<span class="_ _16"> </span>and<span class="_ _11"> </span>does<span class="_ _16"> </span>not<span class="_ _11"> </span>violate</div><div class="t m5 x2d h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">any<span class="_"> </span>type<span class="_"> </span>constraints<span class="_ _1"></span>.</div><div class="t m5 x17 h73 y328f ffe fs1e fc6 sc0 ls0 ws0">3.71<span class="_ _23"> </span><span class="ff10 fs19">◆</span></div><div class="t m5 x17 h26 y3290 ff7 fs19 fc1 sc0 ls0 ws0">Write<span class="_"> </span>a<span class="_"> </span>function<span class="_"> </span><span class="ffd">good_echo<span class="_ _13"> </span></span>that<span class="_"> </span>reads<span class="_"> </span>a<span class="_"> </span>line<span class="_"> </span>from<span class="_"> </span>standard<span class="_"> </span>input<span class="_ _13"> </span>and<span class="_"> </span>writes<span class="_"> </span>it<span class="_"> </span>to</div><div class="t m5 x17 h26 y3291 ff7 fs19 fc1 sc0 ls0 ws0">standard<span class="_"> </span>output.<span class="_"> </span>Y<span class="_ _3"></span>our<span class="_"> </span>implementation<span class="_"> </span>should<span class="_"> </span>work<span class="_"> </span>for<span class="_"> </span>an<span class="_"> </span>input<span class="_"> </span>line<span class="_"> </span>of<span class="_"> </span>arbitrary</div><div class="t m5 x17 h26 y3292 ff7 fs19 fc1 sc0 ls0 ws0">length.<span class="_ _14"> </span>Y<span class="_ _3"></span>ou<span class="_ _14"> </span>may<span class="_ _14"> </span>use<span class="_ _14"> </span>the<span class="_ _14"> </span>library<span class="_ _15"> </span>function<span class="_ _14"> </span><span class="ffd">fgets</span>,<span class="_ _15"> </span>but<span class="_ _14"> </span>you<span class="_ _15"> </span>must<span class="_ _14"> </span>make<span class="_ _14"> </span>sure<span class="_ _14"> </span>your</div><div class="t m5 x17 h26 y3293 ff7 fs19 fc1 sc0 ls0 ws0">function<span class="_"> </span>works<span class="_ _11"> </span>correctly<span class="_ _11"> </span>even<span class="_ _11"> </span>when<span class="_ _11"> </span>the<span class="_ _11"> </span>input<span class="_ _11"> </span>line<span class="_ _11"> </span>requires<span class="_ _11"> </span>more<span class="_ _11"> </span>space<span class="_ _11"> </span>than<span class="_"> </span>you</div><div class="t m5 x17 h26 y3294 ff7 fs19 fc1 sc0 ls0 ws0">have<span class="_"> </span>allocated<span class="_ _11"> </span>for<span class="_ _11"> </span>your<span class="_ _11"> </span>buffer.<span class="_"> </span>Y<span class="_ _3"></span>our<span class="_ _11"> </span>code<span class="_ _11"> </span>should<span class="_"> </span>also<span class="_ _11"> </span>check<span class="_ _11"> </span>for<span class="_ _11"> </span>error<span class="_ _11"> </span>conditions</div><div class="t m5 x17 h26 y3295 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_"> </span>return<span class="_"> </span>when<span class="_"> </span>one<span class="_"> </span>is<span class="_"> </span>encountered.<span class="_"> </span>Refer<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>deﬁnitions<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>standard<span class="_"> </span>I/O</div><div class="t m5 x17 h26 y3296 ff7 fs19 fc1 sc0 ls0 ws0">functions<span class="_"> </span>for<span class="_"> </span>documentation<span class="_"> </span>[45,<span class="_"> </span>61].</div><div class="t m5 x17 h73 y3297 ffe fs1e fc6 sc0 ls0 ws0">3.72<span class="_ _23"> </span><span class="ff10 fs19">◆◆</span></div><div class="t m5 x17 h26 y3298 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _14"> </span>3.54(a)<span class="_ _15"> </span>shows<span class="_ _14"> </span>the<span class="_ _14"> </span>code<span class="_ _14"> </span>for<span class="_ _14"> </span>a<span class="_ _14"> </span>function<span class="_ _14"> </span>that<span class="_ _15"> </span>is<span class="_ _14"> </span>similar<span class="_ _14"> </span>to<span class="_ _14"> </span>function<span class="_ _14"> </span><span class="ffd">vfunct</span></div><div class="t m5 x17 h26 y3299 ff7 fs19 fc1 sc0 ls0 ws0">(F<span class="_ _1"></span>igure<span class="_ _11"> </span>3.43(a)).<span class="_"> </span>W<span class="_ _1"></span>e<span class="_"> </span>used<span class="_"> </span><span class="ffd">vfunct<span class="_ _11"> </span></span>to<span class="_"> </span>illustrate<span class="_"> </span>the<span class="_ _11"> </span>use<span class="_"> </span>of<span class="_ _11"> </span>a<span class="_"> </span>frame<span class="_"> </span>pointer<span class="_ _11"> </span>in<span class="_"> </span>man-</div><div class="t m5 x17 h26 y329a ff7 fs19 fc1 sc0 ls0 ws0">aging<span class="_ _13"> </span>variable-size<span class="_ _6"> </span>stack<span class="_ _13"> </span>frames<span class="_ _3"></span>.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span>new<span class="_ _6"> </span>function<span class="_ _13"> </span><span class="ffd">aframe<span class="_ _6"> </span></span>allocates<span class="_ _13"> </span>space<span class="_ _6"> </span>for<span class="_ _13"> </span>local</div><div class="t m5 x17 h34 y329b ff6 fs16 fc1 sc0 ls0 ws0">(a)<span class="_ _10"> </span>C<span class="_ _11"> </span>code</div><div class="t m5 x2c h2d y329c ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">#include<span class="_ _1f"> </span>&lt;alloca.h&gt;</span></div><div class="t m5 x2c h2e y329d ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x2c h2e y329e ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x2d h2d y329f ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>aframe(long<span class="_ _1f"> </span>n,<span class="_ _1f"> </span>long<span class="_ _e"> </span>idx,<span class="_ _1f"> </span>long<span class="_ _e"> </span>*q)<span class="_ _1a"> </span>{</div><div class="t m5 x2c h2d y32a0 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>i;</span></div><div class="t m5 x2c h2d y32a1 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _20"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>**p<span class="_ _1f"> </span>=<span class="_ _1f"> </span>alloca(n<span class="_ _e"> </span>*<span class="_ _1f"> </span>sizeof(long<span class="_ _e"> </span>*));</span></div><div class="t m5 x2c h2d y32a2 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _20"> </span><span class="ffd fs1e fc2">p[0]<span class="_ _e"> </span>=<span class="_ _1f"> </span>&amp;i;</span></div><div class="t m5 x2c h2d y32a3 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _20"> </span><span class="ffd fs1e fc2 ls33">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>i=1<span class="_ _41"></span>;i&lt;n<span class="_ _41"></span>;<span class="ls0">i++)</span></span></div><div class="t m5 x2c h2d y32a4 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _70"> </span><span class="ffd fs1e fc2">p[i]<span class="_ _e"> </span>=<span class="_ _1f"> </span>q;</span></div><div class="t m5 x2c h2d y32a5 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _20"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>*p[idx];</span></div><div class="t m5 x17 h2d y32a6 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x17 h34 y32a7 ff6 fs16 fc2 sc0 ls0 ws0">(b)<span class="_ _10"> </span>Portions<span class="_ _11"> </span>of<span class="_ _10"> </span>generated<span class="_ _10"> </span>assembly<span class="_ _11"> </span>code</div><div class="t m5 x2e h61 y32a8 ff13 fs35 fc6 sc0 ls0 ws0">long<span class="_ _f"> </span>aframe(long<span class="_ _f"> </span>n,<span class="_ _f"> </span>long<span class="_ _e"> </span>idx,<span class="_ _21"> </span>long<span class="_ _f"> </span>*q)</div><div class="t m5 x2e h61 y32a9 ff13 fs35 fc6 sc0 ls0 ws0">n<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi,<span class="_ _f"> </span>idx<span class="_ _e"> </span>in<span class="_ _21"> </span>%rsi,<span class="_ _f"> </span>q<span class="_ _e"> </span>in<span class="_ _21"> </span>%rdx</div><div class="t m5 x2c h2d y32aa ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">aframe:</span></div><div class="t m5 x2c h2d y32ab ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">pushq<span class="_ _3f"> </span>%rbp</span></div><div class="t m5 x2c h2d y32ac ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rsp,<span class="_ _e"> </span>%rbp</span></div><div class="t m5 x2c h2d y32ad ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">subq<span class="_ _46"> </span>$16,<span class="_ _e"> </span>%rsp<span class="_ _107"> </span></span><span class="ff13 fs35">Allocate<span class="_ _f"> </span>space<span class="_ _f"> </span>for<span class="_ _e"> </span>i<span class="_ _21"> </span>(%rsp<span class="_ _f"> </span>=<span class="_ _e"> </span><span class="ff11">s</span></span></div><div class="t m5 xb5 h80 y32ae ff7 fs46 fc6 sc0 ls0 ws0">1</div><div class="t m5 xae h61 y32ad ff13 fs35 fc6 sc0 ls0 ws0">)</div><div class="t m5 x2c h2d y32af ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">leaq<span class="_ _46"> </span>30(,%rdi,8),<span class="_ _e"> </span>%rax</span></div><div class="t m5 x2c h2e y32b0 ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 xd1 h2d y32b1 ffd fs1e fc2 sc0 ls0 ws0">andq<span class="_ _46"> </span>$-16,<span class="_ _e"> </span>%rax</div><div class="t m5 x2c h2d y32b2 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">subq<span class="_ _46"> </span>%rax,<span class="_ _e"> </span>%rsp<span class="_ _12b"> </span></span><span class="ff13 fs35">Allocate<span class="_ _e"> </span>space<span class="_ _21"> </span>for<span class="_ _f"> </span>array<span class="_ _e"> </span>p<span class="_ _21"> </span>(%rsp<span class="_ _f"> </span>=<span class="_ _e"> </span><span class="ff11">s</span></span></div><div class="t m5 x45 h80 y32b3 ff7 fs46 fc6 sc0 ls0 ws0">2</div><div class="t m5 x4e h61 y32b2 ff13 fs35 fc6 sc0 ls0 ws0">)</div><div class="t m5 x2c h2d y32b4 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _45"> </span><span class="ffd fs1e fc2">leaq<span class="_ _46"> </span>15(%rsp),<span class="_ _e"> </span>%r8</span></div><div class="t m5 x2c h2d y32b5 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _45"> </span><span class="ffd fs1e fc2">andq<span class="_ _46"> </span>$-16,<span class="_ _e"> </span>%r8<span class="_ _107"> </span></span><span class="ff13 fs35">Set<span class="_ _f"> </span>%r8<span class="_ _f"> </span>to<span class="_ _e"> </span>&amp;p[0]</span></div><div class="t m5 x188 h2d y32b6 ffd fs1e fc2 sc0 ls0 ws0">.</div><div class="t m5 x188 h2d y32b7 ffd fs1e fc2 sc0 ls0 ws0">.</div><div class="t m5 x188 h2d y32b8 ffd fs1e fc2 sc0 ls0 ws0">.</div><div class="t m5 x17 h34 y126e ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>3.54<span class="_ _66"> </span><span class="fc1">Code<span class="_"> </span>for<span class="_"> </span>Problem<span class="_"> </span>3.72.<span class="_"> </span><span class="ff6">This<span class="_ _11"> </span>function<span class="_ _10"> </span>is<span class="_ _11"> </span>similar<span class="_ _10"> </span>to<span class="_ _11"> </span>that<span class="_ _10"> </span>of<span class="_ _10"> </span>Figure<span class="_ _11"> </span>3.43.</span></span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
