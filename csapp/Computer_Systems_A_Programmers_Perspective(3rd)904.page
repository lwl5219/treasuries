<div id="pf388" class="pf w2 h11" data-page-no="388"><div class="pc pc388 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg388.png"/><div class="t m5 x1f8 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>9.10<span class="_ _60"> </span>Garbage<span class="_ _10"> </span>Collection<span class="_ _3e"> </span><span class="ffe fs1e">903</span></div><div class="t m5 x17 h2f ye7 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>9.49</div><div class="t m5 x17 h2f y58a ffe fs16 fc1 sc0 ls0 ws0">A<span class="_ _14"> </span>garbage<span class="_ _16"> </span>collector’<span class="_ _0"></span>s</div><div class="t m5 x17 h2f y58b ffe fs16 fc1 sc0 ls0 ws0">view<span class="_ _14"> </span>of<span class="_ _16"> </span>memor<span class="_ _2"></span>y<span class="_ _16"> </span>as<span class="_ _14"> </span>a</div><div class="t m5 x17 h2f y58c ffe fs16 fc1 sc0 ls0 ws0">directed<span class="_"> </span>graph.</div><div class="t m5 xab h91 y74c2 ffcb fs57 fc1 sc0 ls0 ws0">Root nodes</div><div class="t m5 xf0 h91 y74c3 ffcb fs57 fc1 sc0 ls0 ws0">Heap nodes</div><div class="t m5 x1e h91 y74c4 ffcb fs57 fc1 sc0 ls0 ws0">Reachable</div><div class="t m5 x1e h91 y74c5 ffcb fs57 fc1 sc0 ls0 ws0">Unreachable</div><div class="t m5 x1e h91 y74c6 ffcb fs57 fc1 sc0 ls0 ws0">(garbage)</div><div class="t m5 x17 h2f y74c7 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>9.50</div><div class="t m5 x17 h2f y74c8 ffe fs16 fc1 sc0 ls0 ws0">Integrating<span class="_ _11"> </span>a<span class="_ _16"> </span>conserva-</div><div class="t m5 x17 h2f y74c9 ffe fs16 fc1 sc0 ls0 ws0">tive<span class="_ _16"> </span>garbage<span class="_ _16"> </span>collector</div><div class="t m5 x17 h2f y74ca ffe fs16 fc1 sc0 ls20b ws0">a<span class="_ _4a"></span>n<span class="_ _49"></span>daC</div><div class="t m5 x182 h3a y74cb ffd fs19 fc1 sc0 ls0 ws0">malloc<span class="_ _10"> </span><span class="ffe fs16">package.</span></div><div class="t m5 xe6 h91 y74cc ffcb fs57 fc1 sc0 ls0 ws0">C application</div><div class="t m5 xb2 h91 y74cd ffcb fs57 fc1 sc0 ls0 ws0">program</div><div class="t m5 x179 hfb y74ce ffc7 fs99 fc1 sc0 ls0 ws0">malloc()</div><div class="t m5 xf2 h91 y74cf ffcb fs57 fc1 sc0 ls0 ws0">Conservative</div><div class="t m5 x11b h91 y74d0 ffcb fs57 fc1 sc0 ls0 ws0">garbage</div><div class="t m5 x11b h91 y74d1 ffcb fs57 fc1 sc0 ls0 ws0">collector</div><div class="t m5 x216 hfb y74ce ffc7 fs99 fc1 sc0 ls0 ws0">free()</div><div class="t m5 xb8 h91 y74d2 ffcb fs57 fc1 sc0 ls0 ws0">Dynamic storage allocator</div><div class="t m5 x26 h26 y74d3 ff7 fs19 fc1 sc0 ls0 ws0">Garbage<span class="_"> </span>collectors<span class="_"> </span>for<span class="_ _13"> </span>languages<span class="_"> </span>like<span class="_"> </span>ML<span class="_"> </span>and<span class="_"> </span>J<span class="_ _3"></span>ava,<span class="_"> </span>which<span class="_"> </span>exert<span class="_"> </span>tight<span class="_ _13"> </span>control</div><div class="t m5 x17 h26 y74d4 ff7 fs19 fc1 sc0 ls0 ws0">over<span class="_"> </span>how<span class="_"> </span>applications<span class="_"> </span>create<span class="_"> </span>and<span class="_"> </span>use<span class="_"> </span>pointers<span class="_ _3"></span>,<span class="_"> </span>can<span class="_"> </span>maintain<span class="_"> </span>an<span class="_"> </span>exact<span class="_"> </span>representa-</div><div class="t m5 x17 h26 y74d5 ff7 fs19 fc1 sc0 ls0 ws0">tion<span class="_ _6"> </span>of<span class="_ _6"> </span>the<span class="_ _6"> </span>reachability<span class="_ _6"> </span>graph<span class="_ _13"> </span>and<span class="_ _a"> </span>thus<span class="_ _6"> </span>can<span class="_ _13"> </span>reclaim<span class="_ _a"> </span>all<span class="_ _6"> </span>garbage.<span class="_ _a"> </span>However,<span class="_ _6"> </span>collectors</div><div class="t m5 x17 h26 y74d6 ff7 fs19 fc1 sc0 ls0 ws0">for<span class="_ _16"> </span>languages<span class="_ _16"> </span>like<span class="_ _16"> </span>C<span class="_ _14"> </span>and<span class="_ _16"> </span>C++<span class="_ _16"> </span>cannot<span class="_ _16"> </span>in<span class="_ _14"> </span>general<span class="_ _16"> </span>maintain<span class="_ _16"> </span>exact<span class="_ _16"> </span>representations</div><div class="t m5 x17 h26 y74d7 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span>the<span class="_"> </span>reachability<span class="_ _11"> </span>graph.<span class="_"> </span>Such<span class="_ _11"> </span>collectors<span class="_"> </span>are<span class="_ _11"> </span>known<span class="_"> </span>as<span class="_ _11"> </span><span class="ffa">conservative<span class="_"> </span>garbage<span class="_"> </span>col-</span></div><div class="t m5 x17 h26 y74d8 ffa fs19 fc1 sc0 ls0 ws0">lectors<span class="ff7">.<span class="_ _11"> </span>T<span class="_ _1"></span>hey<span class="_ _16"> </span>are<span class="_"> </span>conservative<span class="_ _11"> </span>in<span class="_ _16"> </span>the<span class="_"> </span>sense<span class="_ _11"> </span>that<span class="_ _11"> </span>each<span class="_ _16"> </span>reachable<span class="_"> </span>block<span class="_ _11"> </span>is<span class="_ _16"> </span>correctly</span></div><div class="t m5 x17 h26 y74d9 ff7 fs19 fc1 sc0 ls0 ws0">identiﬁed<span class="_"> </span>as<span class="_"> </span>reachable<span class="_ _1"></span>,<span class="_"> </span>while<span class="_"> </span>some<span class="_"> </span>unreachable<span class="_ _13"> </span>nodes<span class="_"> </span>might<span class="_"> </span>be<span class="_"> </span>incorrectly<span class="_"> </span>iden-</div><div class="t m5 x17 h26 y74da ff7 fs19 fc1 sc0 ls0 ws0">tiﬁed<span class="_"> </span>as<span class="_"> </span>reachable<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y74db ff7 fs19 fc1 sc0 ls0 ws0">Collectors<span class="_ _11"> </span>can<span class="_ _11"> </span>provide<span class="_ _11"> </span>their<span class="_ _16"> </span>service<span class="_"> </span>on<span class="_ _16"> </span>demand,<span class="_ _11"> </span>or<span class="_ _11"> </span>they<span class="_ _11"> </span>can<span class="_ _11"> </span>run<span class="_ _16"> </span>as<span class="_ _11"> </span>separate</div><div class="t m5 x17 h26 y74dc ff7 fs19 fc1 sc0 ls0 ws0">threads<span class="_ _14"> </span>in<span class="_ _14"> </span>parallel<span class="_ _14"> </span>with<span class="_ _15"> </span>the<span class="_ _14"> </span>application,<span class="_ _15"> </span>continuously<span class="_ _14"> </span>updating<span class="_ _15"> </span>the<span class="_ _14"> </span>reachability</div><div class="t m5 x17 h26 y74dd ff7 fs19 fc1 sc0 ls0 ws0">graph<span class="_ _13"> </span>and<span class="_ _13"> </span>reclaiming<span class="_"> </span>garbage<span class="_ _1"></span>.<span class="_ _13"> </span>F<span class="_ _1"></span>or<span class="_ _13"> </span>example,<span class="_ _13"> </span>consider<span class="_ _13"> </span>how<span class="_ _13"> </span>we<span class="_"> </span>might<span class="_ _13"> </span>incorporate<span class="_ _13"> </span>a</div><div class="t m5 x17 h26 y74de ff7 fs19 fc1 sc0 ls0 ws0">conservative<span class="_"> </span>collector<span class="_"> </span>for<span class="_"> </span>C<span class="_"> </span>programs<span class="_"> </span>into<span class="_"> </span>an<span class="_"> </span>existing<span class="_"> </span><span class="ffd">malloc<span class="_ _10"> </span></span>package,<span class="_"> </span>as<span class="_"> </span>shown</div><div class="t m5 x17 h26 y74df ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>9.50.</div><div class="t m5 x26 h26 y74e0 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _15"> </span>application<span class="_ _21"> </span>calls<span class="_ _15"> </span><span class="ffd">malloc<span class="_ _15"> </span></span>in<span class="_ _15"> </span>the<span class="_ _15"> </span>usual<span class="_ _15"> </span>manner<span class="_ _15"> </span>whenever<span class="_ _21"> </span>it<span class="_ _15"> </span>needs<span class="_ _15"> </span>heap</div><div class="t m5 x17 h26 y74e1 ff7 fs19 fc1 sc0 ls0 ws0">space<span class="_ _1"></span>.<span class="_ _13"> </span>If<span class="_"> </span><span class="ffd">malloc<span class="_ _13"> </span></span>is<span class="_ _13"> </span>unable<span class="_ _13"> </span>to<span class="_ _13"> </span>ﬁnd<span class="_ _13"> </span>a<span class="_ _13"> </span>free<span class="_ _13"> </span>block<span class="_ _13"> </span>that<span class="_ _13"> </span>ﬁts<span class="_ _1"></span>,<span class="_ _13"> </span>then<span class="_ _13"> </span>it<span class="_"> </span>calls<span class="_ _13"> </span>the<span class="_ _13"> </span>garbage<span class="_ _13"> </span>col-</div><div class="t m5 x17 h26 y74e2 ff7 fs19 fc1 sc0 ls0 ws0">lector<span class="_ _13"> </span>in<span class="_"> </span>hopes<span class="_ _13"> </span>of<span class="_ _13"> </span>reclaiming<span class="_"> </span>some<span class="_ _13"> </span>garbage<span class="_ _13"> </span>to<span class="_"> </span>the<span class="_ _13"> </span>free<span class="_ _13"> </span>list.<span class="_"> </span>T<span class="_ _3"></span>he<span class="_"> </span>collector<span class="_ _13"> </span>identiﬁes</div><div class="t m5 x17 h26 y74e3 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _13"> </span>garbage<span class="_ _13"> </span>blocks<span class="_"> </span>and<span class="_ _13"> </span>returns<span class="_ _13"> </span>them<span class="_ _13"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>heap<span class="_"> </span>by<span class="_ _13"> </span>calling<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ffd">free<span class="_ _13"> </span></span>function.<span class="_"> </span>T<span class="_ _3"></span>he</div><div class="t m5 x17 h26 y74e4 ff7 fs19 fc1 sc0 ls0 ws0">key<span class="_ _11"> </span>idea<span class="_ _11"> </span>is<span class="_ _11"> </span>that<span class="_ _11"> </span>the<span class="_ _11"> </span>collector<span class="_ _11"> </span>calls<span class="_ _11"> </span><span class="ffd">free<span class="_ _11"> </span></span>instead<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_"> </span>application.<span class="_ _11"> </span>When<span class="_ _11"> </span>the<span class="_ _11"> </span>call</div><div class="t m5 x17 h26 y74e5 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _13"> </span>the<span class="_ _13"> </span>collector<span class="_ _13"> </span>returns<span class="_ _1"></span>,<span class="_"> </span><span class="ffd">malloc<span class="_ _13"> </span></span>tries<span class="_ _13"> </span>again<span class="_ _13"> </span>to<span class="_ _13"> </span>ﬁnd<span class="_ _13"> </span>a<span class="_ _13"> </span>free<span class="_ _13"> </span>block<span class="_ _13"> </span>that<span class="_"> </span>ﬁts<span class="_ _3"></span>.<span class="_ _13"> </span>If<span class="_ _13"> </span>that<span class="_ _13"> </span>fails<span class="_ _0"></span>,</div><div class="t m5 x17 h26 y74e6 ff7 fs19 fc1 sc0 ls0 ws0">then<span class="_ _11"> </span>it<span class="_ _16"> </span>can<span class="_ _16"> </span>ask<span class="_ _11"> </span>the<span class="_ _16"> </span>operating<span class="_ _16"> </span>system<span class="_ _11"> </span>for<span class="_ _16"> </span>additional<span class="_ _16"> </span>memory<span class="_ _7"></span>.<span class="_ _16"> </span>Eventually<span class="_ _3"></span>,<span class="_ _16"> </span><span class="ffd">malloc</span></div><div class="t m5 x17 h26 y74e7 ff7 fs19 fc1 sc0 ls0 ws0">returns<span class="_ _16"> </span>a<span class="_ _11"> </span>pointer<span class="_ _16"> </span>to<span class="_ _16"> </span>the<span class="_ _11"> </span>requested<span class="_ _16"> </span>block<span class="_ _16"> </span>(if<span class="_ _16"> </span>successful)<span class="_ _11"> </span>or<span class="_ _16"> </span>the<span class="_ _16"> </span>NULL<span class="_ _11"> </span>pointer<span class="_ _16"> </span>(if</div><div class="t m5 x17 h26 y74e8 ff7 fs19 fc1 sc0 ls0 ws0">unsuccessful).</div><div class="t m5 x17 h41 y1051 ffe fs29 fc1 sc0 ls0 ws0">9.10.2</div><div class="t m5 x1da h43 y23d9 ffe fs19 fc1 sc0 ls0 ws0">Mark&amp;Sweep<span class="_"> </span>Garbage<span class="_"> </span>Collectors</div><div class="t m5 x17 h26 yd16 ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_ _21"> </span>Mark&amp;Sweep<span class="_ _f"> </span>garbage<span class="_ _f"> </span>collector<span class="_ _f"> </span>consists<span class="_ _f"> </span>of<span class="_ _f"> </span>a<span class="_ _f"> </span><span class="ffa">mark<span class="_ _f"> </span>phase</span>,<span class="_ _e"> </span>which<span class="_ _f"> </span>marks<span class="_ _f"> </span>all</div><div class="t m5 x17 h26 yd17 ff7 fs19 fc1 sc0 ls0 ws0">reachable<span class="_ _13"> </span>and<span class="_ _13"> </span>allocated<span class="_ _6"> </span>descendants<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>root<span class="_ _13"> </span>nodes<span class="_ _3"></span>,<span class="_ _13"> </span>followed<span class="_ _13"> </span>by<span class="_ _13"> </span>a<span class="_ _13"> </span><span class="ffa">sweep<span class="_ _6"> </span>phase</span>,</div><div class="t m5 x17 h26 y223b ff7 fs19 fc1 sc0 ls0 ws0">which<span class="_"> </span>frees<span class="_ _13"> </span>each<span class="_"> </span>unmarked<span class="_"> </span>allocated<span class="_ _13"> </span>block.<span class="_"> </span>T<span class="_ _7"></span>ypically<span class="_ _3"></span>,<span class="_"> </span>one<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_"> </span>spare<span class="_ _13"> </span>low-order</div><div class="t m5 x17 h26 y223c ff7 fs19 fc1 sc0 ls0 ws0">bits<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>block<span class="_"> </span>header<span class="_"> </span>is<span class="_"> </span>used<span class="_"> </span>to<span class="_"> </span>indicate<span class="_"> </span>whether<span class="_"> </span>a<span class="_"> </span>block<span class="_"> </span>is<span class="_"> </span>marked<span class="_"> </span>or<span class="_"> </span>not.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
