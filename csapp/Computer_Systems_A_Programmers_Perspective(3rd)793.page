<div id="pf319" class="pf w2 h11" data-page-no="319"><div class="pc pc319 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg319.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">792<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>8<span class="_ _3d"> </span>Exceptional<span class="_ _10"> </span>Control<span class="_ _10"> </span>Flow</span></div><div class="t m5 x4e h2c y6781 ffa fs16 fc2 sc0 ls0 ws0">code/ecf/shellex.c</div><div class="t m5 xb h2d yb20 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">/*<span class="_ _1f"> </span>parseline<span class="_ _e"> </span>-<span class="_ _1f"> </span>Parse<span class="_ _1f"> </span>the<span class="_ _e"> </span>command<span class="_ _1f"> </span>line<span class="_ _e"> </span>and<span class="_ _1f"> </span>build<span class="_ _1f"> </span>the<span class="_ _e"> </span>argv<span class="_ _1f"> </span>array<span class="_ _e"> </span>*/</span></div><div class="t m5 xb h2d y1980 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">int<span class="_ _1f"> </span>parseline(char<span class="_ _e"> </span>*buf,<span class="_ _1f"> </span>char<span class="_ _1f"> </span>**argv)</span></div><div class="t m5 xb h2d y1983 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 xb h2d y6782 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2">char<span class="_ _e"> </span>*delim;<span class="_ _87"> </span>/*<span class="_ _e"> </span>Points<span class="_ _1f"> </span>to<span class="_ _1f"> </span>first<span class="_ _e"> </span>space<span class="_ _1f"> </span>delimiter<span class="_ _e"> </span>*/</span></div><div class="t m5 xb h2d y6783 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _20"> </span><span class="ffd fs1e fc2">int<span class="_ _e"> </span>argc;<span class="_ _44"> </span>/*<span class="_ _1f"> </span>Number<span class="_ _1f"> </span>of<span class="_ _e"> </span>args<span class="_ _1f"> </span>*/</span></div><div class="t m5 xb h2d y6784 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _20"> </span><span class="ffd fs1e fc2">int<span class="_ _e"> </span>bg;<span class="_ _16f"> </span>/*<span class="_ _e"> </span>Background<span class="_ _1f"> </span>job?<span class="_ _1f"> </span>*/</span></div><div class="t m5 xb h2e y6785 ff6 fs20 fc6 sc0 ls0 ws0">7</div><div class="t m5 xb h2e y6786 ff6 fs20 fc6 sc0 ls0 ws0">8</div><div class="t m5 x26 h2d y6787 ffd fs1e fc2 sc0 ls0 ws0">buf[strlen(buf)-1<span class="ls33">]=’’<span class="_ _41"></span>;<span class="_"> </span>/<span class="_ _41"></span>*<span class="ls0">Replace<span class="_ _e"> </span>trailing<span class="_ _1f"> </span>’\n’<span class="_ _1f"> </span>with<span class="_ _e"> </span>space<span class="_ _1f"> </span>*/</span></span></div><div class="t m5 xb h2d y6788 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _20"> </span><span class="ffd fs1e fc2">while<span class="_ _e"> </span>(*buf<span class="_ _1f"> </span>&amp;&amp;<span class="_ _1f"> </span>(*buf<span class="_ _e"> </span>==<span class="_ _1f"> </span>’<span class="_ _e"> </span>’))<span class="_ _1f"> </span>/*<span class="_ _1f"> </span>Ignore<span class="_ _e"> </span>leading<span class="_ _1f"> </span>spaces<span class="_ _e"> </span>*/</span></div><div class="t m5 x14 h2d y6789 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _70"> </span><span class="ffd fs1e fc2">buf++;</span></div><div class="t m5 x14 h2e y678a ff6 fs20 fc6 sc0 ls0 ws0">11</div><div class="t m5 x14 h2e y678b ff6 fs20 fc6 sc0 ls0 ws0">12</div><div class="t m5 x26 h2d y678c ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Build<span class="_ _1f"> </span>the<span class="_ _1f"> </span>argv<span class="_ _e"> </span>list<span class="_ _1f"> </span>*/</div><div class="t m5 x14 h2d y2d5d ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _20"> </span><span class="ffd fs1e fc2">argc<span class="_ _e"> </span>=<span class="_ _1f"> </span>0;</span></div><div class="t m5 x14 h2d y2d5e ff6 fs20 fc6 sc0 ls0 ws0">14<span class="_ _20"> </span><span class="ffd fs1e fc2">while<span class="_ _e"> </span>((delim<span class="_ _1f"> </span>=<span class="_ _1f"> </span>strchr(buf,<span class="_ _e"> </span>’<span class="_ _1f"> </span>’)))<span class="_ _e"> </span>{</span></div><div class="t m5 x14 h2d y678d ff6 fs20 fc6 sc0 ls0 ws0">15<span class="_ _70"> </span><span class="ffd fs1e fc2">argv[argc++]<span class="_ _e"> </span>=<span class="_ _1f"> </span>buf;</span></div><div class="t m5 x14 h2d y1827 ff6 fs20 fc6 sc0 ls0 ws0">16<span class="_ _70"> </span><span class="ffd fs1e fc2">*delim<span class="_ _e"> </span>=<span class="_ _1f"> </span>’\0’;</span></div><div class="t m5 x14 h2d y2d60 ff6 fs20 fc6 sc0 ls0 ws0">17<span class="_ _70"> </span><span class="ffd fs1e fc2">buf<span class="_ _e"> </span>=<span class="_ _1f"> </span>delim<span class="_ _1f"> </span>+<span class="_ _e"> </span>1;</span></div><div class="t m5 x14 h2d y2325 ff6 fs20 fc6 sc0 ls0 ws0">18<span class="_ _70"> </span><span class="ffd fs1e fc2">while<span class="_ _e"> </span>(*buf<span class="_ _1f"> </span>&amp;&amp;<span class="_ _1f"> </span>(*buf<span class="_ _e"> </span>==<span class="_ _1f"> </span>’<span class="_ _e"> </span>’))<span class="_ _1f"> </span>/*<span class="_ _1f"> </span>Ignore<span class="_ _e"> </span>spaces<span class="_ _1f"> </span>*/</span></div><div class="t m5 x14 h2d y678e ff6 fs20 fc6 sc0 ls0 ws0">19<span class="_ _1fe"> </span><span class="ffd fs1e fc2">buf++;</span></div><div class="t m5 x14 h2d y678f ff6 fs20 fc6 sc0 ls0 ws0">20<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x14 h2d y6790 ff6 fs20 fc6 sc0 ls0 ws0">21<span class="_ _20"> </span><span class="ffd fs1e fc2">argv[argc]<span class="_ _e"> </span>=<span class="_ _1f"> </span>NULL;</span></div><div class="t m5 x14 h2e y6791 ff6 fs20 fc6 sc0 ls0 ws0">22</div><div class="t m5 x14 h2e y6792 ff6 fs20 fc6 sc0 ls0 ws0">23</div><div class="t m5 x26 h2d y1e6c ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>(argc<span class="_ _1f"> </span>==<span class="_ _1f"> </span>0)<span class="_ _3b"> </span>/*<span class="_ _1f"> </span>Ignore<span class="_ _1f"> </span>blank<span class="_ _e"> </span>line<span class="_ _1f"> </span>*/</div><div class="t m5 x14 h2d y6793 ff6 fs20 fc6 sc0 ls0 ws0">24<span class="_ _70"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>1;</span></div><div class="t m5 x14 h2e y6794 ff6 fs20 fc6 sc0 ls0 ws0">25</div><div class="t m5 x14 h2e y6795 ff6 fs20 fc6 sc0 ls0 ws0">26</div><div class="t m5 x26 h2d y1e74 ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Should<span class="_ _1f"> </span>the<span class="_ _1f"> </span>job<span class="_ _e"> </span>run<span class="_ _1f"> </span>in<span class="_ _e"> </span>the<span class="_ _1f"> </span>background?<span class="_ _1f"> </span>*/</div><div class="t m5 x14 h2d y6796 ff6 fs20 fc6 sc0 ls0 ws0">27<span class="_ _20"> </span><span class="ffd fs1e fc2">if<span class="_ _e"> </span>((bg<span class="_ _1f"> </span>=<span class="_ _1f"> </span>(*argv[argc-1]<span class="_ _e"> </span>==<span class="_ _1f"> </span>’&amp;’))<span class="_ _e"> </span>!=<span class="_ _1f"> </span>0)</span></div><div class="t m5 x14 h2d y1dd4 ff6 fs20 fc6 sc0 ls0 ws0">28<span class="_ _70"> </span><span class="ffd fs1e fc2">argv[--argc]<span class="_ _e"> </span>=<span class="_ _1f"> </span>NULL;</span></div><div class="t m5 x14 h2e y5187 ff6 fs20 fc6 sc0 ls0 ws0">29</div><div class="t m5 x14 h2e y6797 ff6 fs20 fc6 sc0 ls0 ws0">30</div><div class="t m5 x26 h2d y6798 ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>bg;</div><div class="t m5 x14 h2d y6799 ff6 fs20 fc6 sc0 ls0 ws0">31<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x4e h2c y679a ffa fs16 fc2 sc0 ls0 ws0">code/ecf/shellex.c</div><div class="t m5 x14 h2f y679b ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>8.25</div><div class="t m5 xe h3a y2a0a ffd fs19 fc1 sc0 ls0 ws0">parseline<span class="_ _10"> </span><span class="ffe fs16">parses<span class="_"> </span>a<span class="_"> </span>line<span class="_"> </span>of<span class="_"> </span>input<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>shell.</span></div><div class="t m5 x1d h3b y679c fff fs24 fc6 sc0 ls0 ws0">8.5</div><div class="t m5 x58 h3e y679d ffe fs18 fc6 sc0 ls0 ws0">Signals</div><div class="t m5 x1d h26 y1204 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_"> </span>this<span class="_ _13"> </span>point<span class="_ _13"> </span>in<span class="_"> </span>our<span class="_ _13"> </span>study<span class="_ _13"> </span>of<span class="_ _13"> </span>exceptional<span class="_"> </span>control<span class="_ _13"> </span>ﬂow<span class="_ _3"></span>,<span class="_ _13"> </span>we<span class="_"> </span>have<span class="_ _13"> </span>seen<span class="_ _13"> </span>how<span class="_ _13"> </span>hardware</div><div class="t m5 x1d h26 y1205 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _11"> </span>software<span class="_ _16"> </span>cooperate<span class="_ _16"> </span>to<span class="_ _11"> </span>provide<span class="_ _16"> </span>the<span class="_ _11"> </span>fundamental<span class="_ _16"> </span>low-level<span class="_ _11"> </span>exception<span class="_ _16"> </span>mecha-</div><div class="t m5 x1d h26 y1206 ff7 fs19 fc1 sc0 ls0 ws0">nism.<span class="_ _11"> </span>W<span class="_ _1"></span>e<span class="_ _11"> </span>have<span class="_ _16"> </span>also<span class="_ _11"> </span>seen<span class="_ _16"> </span>how<span class="_ _11"> </span>the<span class="_ _16"> </span>operating<span class="_ _11"> </span>system<span class="_ _16"> </span>uses<span class="_ _11"> </span>exceptions<span class="_ _16"> </span>to<span class="_ _11"> </span>support<span class="_ _16"> </span>a</div><div class="t m5 x1d h26 y1207 ff7 fs19 fc1 sc0 ls0 ws0">form<span class="_"> </span>of<span class="_ _13"> </span>exceptional<span class="_"> </span>control<span class="_"> </span>ﬂow<span class="_ _13"> </span>known<span class="_"> </span>as<span class="_"> </span>the<span class="_ _13"> </span>process<span class="_"> </span>context<span class="_"> </span>switch.<span class="_ _13"> </span>In<span class="_"> </span>this<span class="_"> </span>sec-</div><div class="t m5 x1d h26 y1208 ff7 fs19 fc1 sc0 ls0 ws0">tion,<span class="_ _13"> </span>we<span class="_ _13"> </span>will<span class="_ _13"> </span>study<span class="_ _13"> </span>a<span class="_ _6"> </span>higher<span class="_ _1"></span>-level<span class="_ _13"> </span>software<span class="_ _13"> </span>form<span class="_ _13"> </span>of<span class="_ _13"> </span>exceptional<span class="_ _13"> </span>control<span class="_ _13"> </span>ﬂow<span class="_ _7"></span>,<span class="_ _13"> </span>known</div><div class="t m5 x1d h26 y679e ff7 fs19 fc1 sc0 ls0 ws0">as<span class="_ _13"> </span>a<span class="_ _6"> </span>Linux<span class="_ _13"> </span>signal,<span class="_ _13"> </span>that<span class="_ _6"> </span>allows<span class="_ _13"> </span>processes<span class="_ _6"> </span>and<span class="_ _13"> </span>the<span class="_ _6"> </span>kernel<span class="_ _13"> </span>to<span class="_ _13"> </span>interrupt<span class="_ _6"> </span>other<span class="_ _13"> </span>processes<span class="_ _3"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
