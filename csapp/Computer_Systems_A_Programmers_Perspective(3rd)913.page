<div id="pf391" class="pf w2 h11" data-page-no="391"><div class="pc pc391 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg391.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">912<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>9<span class="_ _3d"> </span>Virtual<span class="_ _10"> </span>Memory</span></div><div class="t m5 x29 h26 y9c ff7 fs19 fc2 sc0 ls0 ws0">Modern<span class="_ _13"> </span>systems<span class="_"> </span>initialize<span class="_ _13"> </span>chunks<span class="_ _13"> </span>of<span class="_"> </span>virtual<span class="_ _13"> </span>memory<span class="_ _13"> </span>by<span class="_"> </span>associating<span class="_ _13"> </span>them<span class="_ _13"> </span>with</div><div class="t m5 x1d h26 y409 ff7 fs19 fc2 sc0 ls0 ws0">chunks<span class="_"> </span>of<span class="_ _11"> </span>ﬁles<span class="_ _11"> </span>on<span class="_ _11"> </span>disk,<span class="_ _16"> </span>a<span class="_"> </span>process<span class="_ _11"> </span>known<span class="_ _11"> </span>as<span class="_ _11"> </span>memory<span class="_ _11"> </span>mapping.<span class="_"> </span>Memory<span class="_ _11"> </span>mapping</div><div class="t m5 x1d h26 y40a ff7 fs19 fc2 sc0 ls0 ws0">provides<span class="_ _15"> </span>an<span class="_ _15"> </span>efﬁcient<span class="_ _15"> </span>mechanism<span class="_ _15"> </span>for<span class="_ _15"> </span>sharing<span class="_ _15"> </span>data,<span class="_ _f"> </span>creating<span class="_ _15"> </span>new<span class="_ _15"> </span>processes<span class="_ _1"></span>,<span class="_ _f"> </span>and</div><div class="t m5 x1d h26 y40b ff7 fs19 fc2 sc0 ls0 ws0">loading<span class="_ _6"> </span>programs<span class="_ _1"></span>.<span class="_ _13"> </span>Applications<span class="_ _6"> </span>can<span class="_ _13"> </span>manually<span class="_ _6"> </span>create<span class="_ _6"> </span>and<span class="_ _13"> </span>delete<span class="_ _6"> </span>areas<span class="_ _13"> </span>of<span class="_ _6"> </span>the<span class="_ _6"> </span>virtual</div><div class="t m5 x1d h26 y40c ff7 fs19 fc2 sc0 ls0 ws0">address<span class="_ _6"> </span>space<span class="_ _13"> </span>using<span class="_ _6"> </span>the<span class="_ _13"> </span><span class="ffd">mmap<span class="_ _6"> </span></span>function.<span class="_ _13"> </span>However<span class="_ _0"></span>,<span class="_ _13"> </span>most<span class="_ _6"> </span>programs<span class="_ _13"> </span>rely<span class="_ _6"> </span>on<span class="_ _13"> </span>a<span class="_ _6"> </span>dynamic</div><div class="t m5 x1d h26 y40d ff7 fs19 fc2 sc0 ls0 ws0">memory<span class="_ _6"> </span>allocator<span class="_ _13"> </span>such<span class="_ _6"> </span>as<span class="_ _13"> </span><span class="ffd">malloc</span>,<span class="_ _13"> </span>which<span class="_ _6"> </span>manages<span class="_ _13"> </span>memory<span class="_ _6"> </span>in<span class="_ _13"> </span>an<span class="_ _6"> </span>area<span class="_ _13"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>virtual</div><div class="t m5 x1d h26 y40e ff7 fs19 fc2 sc0 ls0 ws0">address<span class="_"> </span>space<span class="_ _11"> </span>called<span class="_ _11"> </span>the<span class="_ _11"> </span>heap.<span class="_"> </span>Dynamic<span class="_ _11"> </span>memory<span class="_ _11"> </span>allocators<span class="_ _11"> </span>are<span class="_ _11"> </span>application-level</div><div class="t m5 x1d h26 y40f ff7 fs19 fc2 sc0 ls0 ws0">programs<span class="_ _16"> </span>with<span class="_ _11"> </span>a<span class="_ _16"> </span>system-level<span class="_ _16"> </span>feel,<span class="_ _16"> </span>directly<span class="_ _16"> </span>manipulating<span class="_ _16"> </span>memory<span class="_ _11"> </span>without<span class="_ _16"> </span>much</div><div class="t m5 x1d h26 y410 ff7 fs19 fc2 sc0 ls0 ws0">help<span class="_ _15"> </span>from<span class="_ _21"> </span>the<span class="_ _15"> </span>type<span class="_ _21"> </span>system.<span class="_ _21"> </span>Allocators<span class="_ _15"> </span>come<span class="_ _21"> </span>in<span class="_ _15"> </span>two<span class="_ _21"> </span>ﬂavors<span class="_ _1"></span>.<span class="_ _21"> </span>Explicit<span class="_ _15"> </span>allocators</div><div class="t m5 x1d h26 y411 ff7 fs19 fc2 sc0 ls0 ws0">require<span class="_ _21"> </span>applications<span class="_ _21"> </span>to<span class="_ _21"> </span>explicitly<span class="_ _21"> </span>free<span class="_ _21"> </span>their<span class="_ _21"> </span>memory<span class="_ _21"> </span>blocks<span class="_ _1"></span>.<span class="_ _21"> </span>Implicit<span class="_ _21"> </span>allocators</div><div class="t m5 x1d h26 y412 ff7 fs19 fc2 sc0 ls0 ws0">(garbage<span class="_"> </span>collectors)<span class="_"> </span>free<span class="_"> </span>any<span class="_"> </span>unused<span class="_"> </span>and<span class="_"> </span>unreachable<span class="_"> </span>blocks<span class="_"> </span>automatically<span class="_ _3"></span>.</div><div class="t m5 x29 h26 y413 ff7 fs19 fc2 sc0 ls0 ws0">Managing<span class="_ _13"> </span>and<span class="_ _6"> </span>using<span class="_ _13"> </span>memory<span class="_ _6"> </span>is<span class="_ _13"> </span>a<span class="_ _13"> </span>difﬁcult<span class="_ _6"> </span>and<span class="_ _13"> </span>error<span class="_ _3"></span>-prone<span class="_ _13"> </span>task<span class="_ _13"> </span>for<span class="_ _6"> </span>C<span class="_ _13"> </span>program-</div><div class="t m5 x1d h26 y414 ff7 fs19 fc2 sc0 ls0 ws0">mers<span class="_ _1"></span>.<span class="_ _14"> </span>Examples<span class="_ _14"> </span>of<span class="_ _14"> </span>common<span class="_ _14"> </span>errors<span class="_ _14"> </span>include<span class="_ _14"> </span>dereferencing<span class="_ _14"> </span>bad<span class="_ _14"> </span>pointers<span class="_ _1"></span>,<span class="_ _15"> </span>reading</div><div class="t m5 x1d h26 y415 ff7 fs19 fc2 sc0 ls0 ws0">uninitialized<span class="_ _13"> </span>memory<span class="_ _3"></span>,<span class="_ _13"> </span>allowing<span class="_ _13"> </span>stack<span class="_ _13"> </span>buffer<span class="_ _13"> </span>overﬂows<span class="_ _1"></span>,<span class="_ _13"> </span>assuming<span class="_"> </span>that<span class="_ _13"> </span>pointers<span class="_ _13"> </span>and</div><div class="t m5 x1d h26 y416 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _16"> </span>objects<span class="_ _16"> </span>they<span class="_ _16"> </span>point<span class="_ _16"> </span>to<span class="_ _16"> </span>are<span class="_ _16"> </span>the<span class="_ _16"> </span>same<span class="_ _16"> </span>size,<span class="_ _16"> </span>referencing<span class="_ _16"> </span>a<span class="_ _16"> </span>pointer<span class="_ _16"> </span>instead<span class="_ _16"> </span>of<span class="_ _16"> </span>the</div><div class="t m5 x1d h26 y434 ff7 fs19 fc2 sc0 ls0 ws0">object<span class="_"> </span>it<span class="_ _11"> </span>points<span class="_ _11"> </span>to<span class="_ _0"></span>,<span class="_ _11"> </span>misunderstanding<span class="_"> </span>pointer<span class="_ _11"> </span>arithmetic,<span class="_ _11"> </span>referencing<span class="_ _11"> </span>nonexistent</div><div class="t m5 x1d h26 y435 ff7 fs19 fc2 sc0 ls0 ws0">variables<span class="_ _1"></span>,<span class="_"> </span>and<span class="_"> </span>introducing<span class="_"> </span>memory<span class="_"> </span>leaks<span class="_ _1"></span>.</div><div class="t m5 x1d h29 y3ec ffe fs14 fc2 sc0 ls0 ws0">Bibliographic<span class="_"> </span>Notes</div><div class="t m5 x1d h26 y72d4 ff7 fs19 fc2 sc0 ls0 ws0">Kilburn<span class="_"> </span>and<span class="_"> </span>his<span class="_"> </span>colleagues<span class="_"> </span>published<span class="_"> </span>the<span class="_"> </span>ﬁrst<span class="_ _13"> </span>description<span class="_"> </span>of<span class="_"> </span>virtual<span class="_"> </span>memory<span class="_"> </span>[63].</div><div class="t m5 x1d h26 y72d5 ff7 fs19 fc2 sc0 ls0 ws0">Architecture<span class="_"> </span>texts<span class="_ _11"> </span>contain<span class="_ _11"> </span>additional<span class="_"> </span>details<span class="_ _11"> </span>about<span class="_ _11"> </span>the<span class="_ _11"> </span>hardware’s<span class="_"> </span>role<span class="_"> </span>in<span class="_ _11"> </span>virtual</div><div class="t m5 x1d h26 y72d6 ff7 fs19 fc2 sc0 ls0 ws0">memory<span class="_ _16"> </span>[46].<span class="_ _11"> </span>Operating<span class="_ _16"> </span>systems<span class="_ _16"> </span>texts<span class="_ _16"> </span>contain<span class="_ _16"> </span>additional<span class="_ _16"> </span>information<span class="_ _11"> </span>about<span class="_ _16"> </span>the</div><div class="t m5 x1d h26 y72d7 ff7 fs19 fc2 sc0 ls0 ws0">operating<span class="_ _11"> </span>system’s<span class="_"> </span>role<span class="_ _11"> </span>[102,<span class="_ _11"> </span>106,<span class="_ _16"> </span>113].<span class="_"> </span>Bovet<span class="_ _11"> </span>and<span class="_ _11"> </span>Cesati<span class="_ _11"> </span>[11]<span class="_ _11"> </span>give<span class="_ _11"> </span>a<span class="_ _11"> </span>detailed<span class="_ _11"> </span>de-</div><div class="t m5 x1d h26 y72d8 ff7 fs19 fc2 sc0 ls0 ws0">scription<span class="_ _13"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>Linux<span class="_ _13"> </span>virtual<span class="_ _13"> </span>memory<span class="_ _6"> </span>system.<span class="_ _13"> </span>Intel<span class="_ _13"> </span>Corporation<span class="_ _13"> </span>provides<span class="_ _6"> </span>detailed</div><div class="t m5 x1d h26 y72d9 ff7 fs19 fc2 sc0 ls0 ws0">documentation<span class="_"> </span>on<span class="_"> </span>32-bit<span class="_"> </span>and<span class="_"> </span>64-bit<span class="_"> </span>address<span class="_"> </span>translation<span class="_"> </span>on<span class="_"> </span>IA<span class="_"> </span>processors<span class="_"> </span>[52].</div><div class="t m5 x29 h26 y72da ff7 fs19 fc2 sc0 ls0 ws0">Knuth<span class="_ _16"> </span>wrote<span class="_ _14"> </span>the<span class="_ _14"> </span>classic<span class="_ _16"> </span>work<span class="_ _14"> </span>on<span class="_ _14"> </span>storage<span class="_ _16"> </span>allocation<span class="_ _14"> </span>in<span class="_ _14"> </span>1968<span class="_ _16"> </span>[64].<span class="_ _14"> </span>Since<span class="_ _14"> </span>that</div><div class="t m5 x1d h26 y72db ff7 fs19 fc2 sc0 ls0 ws0">time<span class="_ _1"></span>,<span class="_ _13"> </span>there<span class="_ _13"> </span>has<span class="_ _13"> </span>been<span class="_ _13"> </span>a<span class="_ _6"> </span>tremendous<span class="_ _13"> </span>amount<span class="_ _13"> </span>of<span class="_ _13"> </span>work<span class="_ _6"> </span>in<span class="_ _13"> </span>the<span class="_ _13"> </span>area.<span class="_ _6"> </span>Wilson,<span class="_ _13"> </span>J<span class="_ _3"></span>ohnstone,</div><div class="t m5 x1d h26 y72dc ff7 fs19 fc2 sc0 ls0 ws0">Neely<span class="_ _3"></span>,<span class="_"> </span>and<span class="_ _11"> </span>Boles<span class="_ _11"> </span>have<span class="_ _11"> </span>written<span class="_ _11"> </span>a<span class="_ _11"> </span>beautiful<span class="_ _11"> </span>survey<span class="_ _11"> </span>and<span class="_ _11"> </span>performance<span class="_ _11"> </span>evaluation<span class="_ _11"> </span>of</div><div class="t m5 x1d h26 y72dd ff7 fs19 fc2 sc0 ls0 ws0">explicit<span class="_ _13"> </span>allocators<span class="_ _13"> </span>[118].<span class="_ _13"> </span>T<span class="_ _0"></span>he<span class="_ _13"> </span>general<span class="_ _13"> </span>comments<span class="_ _13"> </span>in<span class="_ _13"> </span>this<span class="_ _13"> </span>book<span class="_"> </span>about<span class="_ _13"> </span>the<span class="_ _13"> </span>throughput</div><div class="t m5 x1d h26 y72de ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_ _14"> </span>utilization<span class="_ _15"> </span>of<span class="_ _14"> </span>different<span class="_ _15"> </span>allocator<span class="_ _15"> </span>strategies<span class="_ _14"> </span>are<span class="_ _15"> </span>paraphrased<span class="_ _15"> </span>from<span class="_ _14"> </span>their<span class="_ _15"> </span>sur<span class="_ _1"></span>-</div><div class="t m5 x1d h26 y72df ff7 fs19 fc2 sc0 ls0 ws0">vey<span class="_ _3"></span>.<span class="_ _16"> </span>J<span class="_ _1"></span>ones<span class="_ _16"> </span>and<span class="_ _16"> </span>Lins<span class="_ _14"> </span>provide<span class="_ _16"> </span>a<span class="_ _16"> </span>comprehensive<span class="_ _16"> </span>survey<span class="_ _14"> </span>of<span class="_ _16"> </span>garbage<span class="_ _16"> </span>collection<span class="_ _16"> </span>[56].</div><div class="t m5 x1d h26 y72e0 ff7 fs19 fc2 sc0 ls0 ws0">Kernighan<span class="_"> </span>and<span class="_"> </span>Ritchie<span class="_"> </span>[61]<span class="_ _11"> </span>show<span class="_"> </span>the<span class="_ _11"> </span>complete<span class="_"> </span>code<span class="_ _11"> </span>for<span class="_"> </span>a<span class="_"> </span>simple<span class="_ _11"> </span>allocator<span class="_"> </span>based</div><div class="t m5 x1d h26 y72e1 ff7 fs19 fc2 sc0 ls0 ws0">on<span class="_"> </span>an<span class="_ _11"> </span>explicit<span class="_ _11"> </span>free<span class="_"> </span>list<span class="_ _11"> </span>with<span class="_ _11"> </span>a<span class="_ _11"> </span>block<span class="_"> </span>size<span class="_ _11"> </span>and<span class="_ _11"> </span>successor<span class="_"> </span>pointer<span class="_ _11"> </span>in<span class="_ _11"> </span>each<span class="_ _11"> </span>free<span class="_"> </span>block.</div><div class="t m5 x1d h26 y72e2 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>code<span class="_"> </span>is<span class="_"> </span>interesting<span class="_"> </span>in<span class="_"> </span>that<span class="_"> </span>it<span class="_"> </span>uses<span class="_"> </span>unions<span class="_"> </span>to<span class="_"> </span>eliminate<span class="_"> </span>a<span class="_"> </span>lot<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>complicated</div><div class="t m5 x1d h26 y72e3 ff7 fs19 fc2 sc0 ls0 ws0">pointer<span class="_ _13"> </span>arithmetic,<span class="_ _13"> </span>but<span class="_"> </span>at<span class="_ _13"> </span>the<span class="_ _13"> </span>expense<span class="_ _13"> </span>of<span class="_ _13"> </span>a<span class="_"> </span>linear<span class="_ _3"></span>-time<span class="_"> </span>(rather<span class="_ _13"> </span>than<span class="_ _13"> </span>constant-time)</div><div class="t m5 x1d h26 y72e4 ff7 fs19 fc2 sc0 ls0 ws0">free<span class="_ _11"> </span>operation.<span class="_ _11"> </span>Doug<span class="_ _16"> </span>Lea<span class="_ _11"> </span>developed<span class="_ _11"> </span>a<span class="_ _16"> </span>widely<span class="_"> </span>used<span class="_ _16"> </span>open-source<span class="_ _11"> </span>malloc<span class="_ _11"> </span>package</div><div class="t m5 x1d h26 y72e5 ff7 fs19 fc2 sc0 ls0 ws0">called<span class="_"> </span><span class="ffd">dlmalloc<span class="_ _10"> </span></span>[67].</div><div class="t m5 x1d h29 y591f ffe fs14 fc2 sc0 ls0 ws0">Homework<span class="_"> </span>Problems</div><div class="t m5 x1d h73 y543 ffe fs1e fc6 sc0 ls0 ws0">9.11<span class="_ _23"> </span><span class="ff10 fs19">◆</span></div><div class="t m5 x1d h26 y544 ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _16"> </span>the<span class="_ _16"> </span>following<span class="_ _16"> </span>series<span class="_ _14"> </span>of<span class="_ _16"> </span>problems<span class="_ _1"></span>,<span class="_ _14"> </span>you<span class="_ _16"> </span>are<span class="_ _16"> </span>to<span class="_ _16"> </span>show<span class="_ _14"> </span>how<span class="_ _16"> </span>the<span class="_ _16"> </span>example<span class="_ _16"> </span>memory</div><div class="t m5 x1d h26 y545 ff7 fs19 fc1 sc0 ls0 ws0">system<span class="_ _14"> </span>in<span class="_ _15"> </span>Section<span class="_ _15"> </span>9.6.4<span class="_ _15"> </span>translates<span class="_ _14"> </span>a<span class="_ _15"> </span>virtual<span class="_ _15"> </span>address<span class="_ _15"> </span>into<span class="_ _14"> </span>a<span class="_ _15"> </span>physical<span class="_ _15"> </span>address<span class="_ _15"> </span>and</div><div class="t m5 x1d h26 y546 ff7 fs19 fc1 sc0 ls0 ws0">accesses<span class="_ _13"> </span>the<span class="_ _13"> </span>cache.<span class="_ _13"> </span>F<span class="_ _3"></span>or<span class="_"> </span>the<span class="_ _13"> </span>given<span class="_ _13"> </span>virtual<span class="_ _13"> </span>address<span class="_ _1"></span>,<span class="_"> </span>indicate<span class="_ _13"> </span>the<span class="_ _13"> </span>TLB<span class="_ _13"> </span>entry<span class="_"> </span>accessed,</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
