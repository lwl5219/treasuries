<div id="pf30c" class="pf w2 h11" data-page-no="30c"><div class="pc pc30c w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg30c.png"/><div class="t m5 x100 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>8.4<span class="_ _60"> </span>Process<span class="_ _10"> </span>Control<span class="_ _3e"> </span><span class="ffe fs1e">779</span></div><div class="t m5 x17 h47 yb1f ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>8.2<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>831)</span></div><div class="t m5 x17 h26 y9ba ff7 fs19 fc1 sc0 ls0 ws0">Consider<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>program:</div><div class="t m5 xf4 h2c y663b ffa fs16 fc1 sc0 ls0 ws0">code/ecf/global-forkprob0.c</div><div class="t m5 x2c h2d y663c ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">int<span class="_ _1f"> </span>main()</span></div><div class="t m5 x2c h2d y663d ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x2c h2d y663e ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2 ls33">i<span class="_ _41"></span>n<span class="_ _41"></span>ta=9<span class="_ _41"></span>;</span></div><div class="t m5 x2c h2e y663f ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 x2c h2e y6640 ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x142 h2d y6641 ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>(Fork()<span class="_ _1f"> </span>==<span class="_ _1f"> </span>0)</div><div class="t m5 x2c h2d y6642 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _70"> </span><span class="ffd fs1e fc2">printf(&quot;p1:<span class="_ _e"> </span>a=%d\n&quot;,<span class="_ _1f"> </span>a--);</span></div><div class="t m5 x2c h2d y6643 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _20"> </span><span class="ffd fs1e fc2">printf(&quot;p2:<span class="_ _e"> </span>a=%d\n&quot;,<span class="_ _1f"> </span>a++);</span></div><div class="t m5 x2c h2d y6644 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _20"> </span><span class="ffd fs1e fc2">exit(0);</span></div><div class="t m5 x2c h2d y6645 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 xf4 h2c y6646 ffa fs16 fc2 sc0 ls0 ws0">code/ecf/global-forkprob0.c</div><div class="t m5 x34 h26 y6647 ff7 fs19 fc2 sc0 ls0 ws0">A.<span class="_ _1f"> </span>What<span class="_"> </span>is<span class="_"> </span>the<span class="_"> </span>output<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>child<span class="_"> </span>process?</div><div class="t m5 x34 h26 y6648 ff7 fs19 fc2 sc0 ls0 ws0">B<span class="_ _3"></span>.<span class="_ _1d"> </span>What<span class="_"> </span>is<span class="_"> </span>the<span class="_"> </span>output<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>parent<span class="_"> </span>process?</div><div class="t m5 x17 h41 y6649 ffe fs29 fc1 sc0 ls0 ws0">8.4.3<span class="_ _48"> </span><span class="fs19">Reaping<span class="_"> </span>Child<span class="_"> </span>Processes</span></div><div class="t m5 x17 h26 y664a ff7 fs19 fc1 sc0 ls0 ws0">When<span class="_ _16"> </span>a<span class="_ _16"> </span>process<span class="_ _16"> </span>terminates<span class="_ _14"> </span>for<span class="_ _16"> </span>any<span class="_ _14"> </span>reason,<span class="_ _14"> </span>the<span class="_ _16"> </span>kernel<span class="_ _14"> </span>does<span class="_ _16"> </span>not<span class="_ _16"> </span>remove<span class="_ _14"> </span>it<span class="_ _16"> </span>from</div><div class="t m5 x17 h26 y664b ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>system<span class="_"> </span>immediately<span class="_ _7"></span>.<span class="_"> </span>Instead,<span class="_"> </span>the<span class="_"> </span>process<span class="_"> </span>is<span class="_"> </span>kept<span class="_"> </span>around<span class="_"> </span>in<span class="_"> </span>a<span class="_ _13"> </span>terminated<span class="_"> </span>state</div><div class="t m5 x17 h26 y664c ff7 fs19 fc1 sc0 ls0 ws0">until<span class="_ _16"> </span>it<span class="_ _16"> </span>is<span class="_ _16"> </span><span class="ffa">reaped<span class="_ _16"> </span></span>by<span class="_ _16"> </span>its<span class="_ _16"> </span>parent.<span class="_ _16"> </span>When<span class="_ _16"> </span>the<span class="_ _16"> </span>parent<span class="_ _11"> </span>reaps<span class="_ _16"> </span>the<span class="_ _16"> </span>terminated<span class="_ _16"> </span>child,<span class="_ _14"> </span>the</div><div class="t m5 x17 h26 y664d ff7 fs19 fc1 sc0 ls0 ws0">kernel<span class="_ _13"> </span>passes<span class="_ _13"> </span>the<span class="_ _13"> </span>child’s<span class="_ _13"> </span>exit<span class="_ _13"> </span>status<span class="_"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>parent<span class="_ _13"> </span>and<span class="_ _13"> </span>then<span class="_ _13"> </span>discards<span class="_"> </span>the<span class="_ _13"> </span>terminated</div><div class="t m5 x17 h26 y664e ff7 fs19 fc1 sc0 ls0 ws0">process<span class="_ _1"></span>,<span class="_ _16"> </span>at<span class="_ _16"> </span>which<span class="_ _14"> </span>point<span class="_ _16"> </span>it<span class="_ _16"> </span>ceases<span class="_ _16"> </span>to<span class="_ _16"> </span>exist.<span class="_ _16"> </span>A<span class="_ _16"> </span>terminated<span class="_ _16"> </span>process<span class="_ _16"> </span>that<span class="_ _16"> </span>has<span class="_ _16"> </span>not<span class="_ _16"> </span>yet</div><div class="t m5 x17 h26 y664f ff7 fs19 fc1 sc0 ls0 ws0">been<span class="_"> </span>reaped<span class="_"> </span>is<span class="_"> </span>called<span class="_"> </span>a<span class="_"> </span><span class="ffa">zombie</span>.</div><div class="t m5 x26 h26 y6650 ff7 fs19 fc1 sc0 ls0 ws0">When<span class="_"> </span>a<span class="_ _16"> </span>parent<span class="_ _11"> </span>process<span class="_ _11"> </span>terminates<span class="_ _1"></span>,<span class="_ _16"> </span>the<span class="_ _11"> </span>kernel<span class="_ _11"> </span>arranges<span class="_ _16"> </span>for<span class="_ _11"> </span>the<span class="_ _11"> </span><span class="ffd">init<span class="_ _11"> </span></span>process</div><div class="t m5 x17 h26 y6651 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _13"> </span>become<span class="_"> </span>the<span class="_ _13"> </span>adopted<span class="_ _13"> </span>parent<span class="_ _13"> </span>of<span class="_"> </span>any<span class="_ _13"> </span>orphaned<span class="_ _13"> </span>children.<span class="_ _13"> </span>The<span class="_ _13"> </span><span class="ffd">init<span class="_ _13"> </span></span>process<span class="_ _1"></span>,<span class="_"> </span>which</div><div class="t m5 x17 h26 y6652 ff7 fs19 fc1 sc0 ls0 ws0">has<span class="_"> </span>a<span class="_"> </span>PID<span class="_ _11"> </span>of<span class="_"> </span>1,<span class="_ _11"> </span>is<span class="_"> </span>created<span class="_"> </span>by<span class="_ _11"> </span>the<span class="_"> </span>kernel<span class="_"> </span>during<span class="_ _11"> </span>system<span class="_"> </span>start-up,<span class="_"> </span>never<span class="_"> </span>terminates<span class="_ _1"></span>,</div><div class="t m5 x17 h26 y6653 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _6"> </span>is<span class="_ _13"> </span>the<span class="_ _6"> </span>ancestor<span class="_ _13"> </span>of<span class="_ _6"> </span>every<span class="_ _13"> </span>process<span class="_ _3"></span>.<span class="_ _13"> </span>If<span class="_ _6"> </span>a<span class="_ _13"> </span>parent<span class="_ _6"> </span>process<span class="_ _13"> </span>terminates<span class="_ _6"> </span>without<span class="_ _13"> </span>reaping</div><div class="t m5 x17 h26 y6654 ff7 fs19 fc1 sc0 ls0 ws0">its<span class="_ _11"> </span>zombie<span class="_ _11"> </span>children,<span class="_ _16"> </span>then<span class="_"> </span>the<span class="_ _16"> </span>kernel<span class="_"> </span>arranges<span class="_ _16"> </span>for<span class="_ _11"> </span>the<span class="_ _11"> </span><span class="ffd">init<span class="_ _11"> </span></span>process<span class="_ _11"> </span>to<span class="_ _16"> </span>reap<span class="_"> </span>them.</div><div class="t m5 x17 h26 y6655 ff7 fs19 fc1 sc0 ls0 ws0">However,<span class="_ _6"> </span>long-running<span class="_ _13"> </span>programs<span class="_ _a"> </span>such<span class="_ _13"> </span>as<span class="_ _6"> </span>shells<span class="_ _6"> </span>or<span class="_ _13"> </span>servers<span class="_ _a"> </span>should<span class="_ _13"> </span>always<span class="_ _6"> </span>reap<span class="_ _6"> </span>their</div><div class="t m5 x17 h26 y6656 ff7 fs19 fc1 sc0 ls0 ws0">zombie<span class="_ _13"> </span>children.<span class="_ _13"> </span>Even<span class="_ _13"> </span>though<span class="_ _13"> </span>zombies<span class="_ _13"> </span>are<span class="_ _13"> </span>not<span class="_"> </span>running<span class="_ _1"></span>,<span class="_"> </span>they<span class="_ _13"> </span>still<span class="_ _13"> </span>consume<span class="_ _13"> </span>system</div><div class="t m5 x17 h26 y6657 ff7 fs19 fc1 sc0 ls0 ws0">memory<span class="_"> </span>resources<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y6658 ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_ _16"> </span>process<span class="_ _16"> </span>waits<span class="_ _16"> </span>for<span class="_ _11"> </span>its<span class="_ _16"> </span>children<span class="_ _16"> </span>to<span class="_ _16"> </span>terminate<span class="_ _16"> </span>or<span class="_ _16"> </span>stop<span class="_ _16"> </span>by<span class="_ _16"> </span>calling<span class="_ _16"> </span>the<span class="_ _11"> </span><span class="ffd">waitpid</span></div><div class="t m5 x17 h26 y6659 ff7 fs19 fc1 sc0 ls0 ws0">function.</div><div class="t m5 x31 h2d y665a ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;sys/types.h&gt;</div><div class="t m5 x31 h2d y665b ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;sys/wait.h&gt;</div><div class="t m5 x31 h2d y665c ffd fs1e fc2 sc0 ls0 ws0">pid_t<span class="_ _e"> </span>waitpid(pid_t<span class="_ _1f"> </span>pid,<span class="_ _1f"> </span>int<span class="_ _e"> </span>*statusp,<span class="_ _1f"> </span>int<span class="_ _e"> </span>options);</div><div class="t m5 x154 hf2 y665d ff7 fs1f fc2 sc0 ls0 ws0">Returns:<span class="_"> </span>PID<span class="_"> </span>of<span class="_"> </span>child<span class="_"> </span>if<span class="_"> </span>OK,<span class="_"> </span>0<span class="_"> </span>(if<span class="_"> </span>WNOHANG),<span class="_"> </span>or<span class="_"> </span><span class="ff12">−</span>1<span class="_ _13"> </span>on<span class="_"> </span>error</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
