<div id="pf3a5" class="pf w2 h11" data-page-no="3a5"><div class="pc pc3a5 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg3a5.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">932<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>10<span class="_ _3d"> </span>System-Level<span class="_ _10"> </span>I/O</span></div><div class="t m5 x28 h2a y548 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">What’<span class="_ _3"></span>s<span class="_ _16"> </span>the<span class="_ _11"> </span>difference<span class="_ _11"> </span>between<span class="_ _11"> </span><span class="ffd fs2b">ssize_t<span class="_ _16"> </span></span>and<span class="_ _11"> </span><span class="ffd fs2b">size_t</span>?</span></div><div class="t m5 x28 h2b y2d0 ff7 fs1e fc2 sc0 ls0 ws0">Y<span class="_ _3"></span>ou<span class="_ _11"> </span>might<span class="_ _11"> </span>have<span class="_ _11"> </span>noticed<span class="_ _16"> </span>that<span class="_ _11"> </span>the<span class="_ _11"> </span><span class="ffd">read<span class="_ _11"> </span></span>function<span class="_ _11"> </span>has<span class="_ _16"> </span>a<span class="_ _11"> </span><span class="ffd">size_t<span class="_ _11"> </span></span>input<span class="_ _11"> </span>argument<span class="_ _11"> </span>and<span class="_ _16"> </span>an<span class="_ _11"> </span><span class="ffd">ssize_t<span class="_ _11"> </span></span>return</div><div class="t m5 x28 h2b y2d1 ff7 fs1e fc2 sc0 ls0 ws0">value<span class="_ _1"></span>.<span class="_"> </span>So<span class="_"> </span>what’s<span class="_ _13"> </span>the<span class="_"> </span>difference<span class="_"> </span>between<span class="_ _13"> </span>these<span class="_"> </span>two<span class="_ _13"> </span>types?<span class="_"> </span>On<span class="_"> </span>x86-64<span class="_ _13"> </span>systems<span class="_ _1"></span>,<span class="_"> </span>a<span class="_"> </span><span class="ffd">size_t<span class="_ _13"> </span></span>is<span class="_"> </span>deﬁned<span class="_"> </span>as<span class="_"> </span>an</div><div class="t m5 x28 h2b y2d2 ffd fs1e fc2 sc0 ls0 ws0">unsigned<span class="_ _11"> </span>long<span class="ff7">,<span class="_"> </span>and<span class="_"> </span>an<span class="_"> </span></span>ssize_t<span class="_ _10"> </span><span class="ff7">(<span class="ffa">signed<span class="_ _10"> </span>size</span>)<span class="_"> </span>is<span class="_"> </span>deﬁned<span class="_"> </span>as<span class="_ _10"> </span>a<span class="_"> </span></span>long<span class="ff7 ls2d3">.T<span class="_ _4a"></span>h<span class="_ _4a"></span>e<span class="ffd ls0">read<span class="_ _10"> </span><span class="ff7">function<span class="_"> </span>returns<span class="_"> </span>a<span class="_"> </span>signed</span></span></span></div><div class="t m5 x28 h4a y2d3 ff7 fs1e fc2 sc0 ls0 ws0">size<span class="_"> </span>rather<span class="_ _10"> </span>than<span class="_ _10"> </span>an<span class="_ _11"> </span>unsigned<span class="_"> </span>size<span class="_ _10"> </span>because<span class="_ _10"> </span>it<span class="_ _11"> </span>must<span class="_"> </span>return<span class="_ _10"> </span>a<span class="_ _10"> </span><span class="ff12">−</span>1<span class="_"> </span>on<span class="_"> </span>error.<span class="_"> </span>Interestingly<span class="_ _3"></span>,<span class="_"> </span>the<span class="_ _10"> </span>possibility<span class="_ _11"> </span>of</div><div class="t m5 x28 h4a y2d4 ff7 fs1e fc2 sc0 ls0 ws0">returning<span class="_"> </span>a<span class="_"> </span>single<span class="_"> </span><span class="ff12">−</span>1<span class="_ _13"> </span>reduces<span class="_"> </span>the<span class="_"> </span>maximum<span class="_"> </span>size<span class="_"> </span>of<span class="_"> </span>a<span class="_"> </span><span class="ffd">read<span class="_ _10"> </span></span>by<span class="_"> </span>a<span class="_"> </span>factor<span class="_"> </span>of<span class="_"> </span>2.</div><div class="t m5 x1c1 h2c y778b ffa fs16 fc2 sc0 ls0 ws0">code/io/cpstdin.c</div><div class="t m5 x1f h2d y778c ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">#include<span class="_ _1f"> </span>&quot;csapp.h&quot;</span></div><div class="t m5 x1f h2e y778d ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x1f h2e y778e ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x4f h2d y778f ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>main(void)</div><div class="t m5 x1f h2d y7790 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x1f h2e y7791 ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x33 h2d y7792 ffd fs1e fc2 sc0 ls0 ws0">char<span class="_ _e"> </span>c;</div><div class="t m5 x1f h2e y7793 ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 x1f h2e y7794 ff6 fs20 fc6 sc0 ls0 ws0">7</div><div class="t m5 x33 h2d y7795 ffd fs1e fc2 sc0 ls0 ws0">while(Read(STDIN_FILENO,<span class="_ _e"> </span>&amp;c,<span class="_ _1f"> </span>1)<span class="_ _1f"> </span>!=<span class="_ _e"> </span>0)</div><div class="t m5 x1f h2d y7796 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _70"> </span><span class="ffd fs1e fc2">Write(STDOUT_FILENO,<span class="_ _e"> </span>&amp;c,<span class="_ _1f"> </span>1);</span></div><div class="t m5 x1f h2d y7797 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _20"> </span><span class="ffd fs1e fc2">exit(0);</span></div><div class="t m5 x1b0 h2e y7798 ff6 fs20 fc6 sc0 ls0 ws0">10</div><div class="t m5 x4f h2d y7799 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x1c1 h2c y779a ffa fs16 fc2 sc0 ls0 ws0">code/io/cpstdin.c</div><div class="t m5 x1d h2f y779b ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _13"> </span>10.3<span class="_ _c"> </span><span class="fc1">Using<span class="_ _13"> </span>read<span class="_ _13"> </span>and<span class="_ _13"> </span>write<span class="_ _10"> </span>to<span class="_ _13"> </span>copy<span class="_ _13"> </span>standard<span class="_ _13"> </span>input<span class="_ _13"> </span>to<span class="_ _13"> </span>standard<span class="_ _10"> </span>output<span class="_ _13"> </span>1<span class="_ _13"> </span>byte</span></div><div class="t m5 x1d h2f y779c ffe fs16 fc1 sc0 ls0 ws0">at<span class="_"> </span>a<span class="_"> </span>time.</div><div class="t m5 x75 h26 y779d ffa fs19 fc1 sc0 ls0 ws0">Encountering<span class="_ _13"> </span>EOF<span class="_"> </span>on<span class="_ _13"> </span>reads<span class="_ _1"></span>.<span class="_ _21"> </span><span class="ff7">Suppose<span class="_"> </span>that<span class="_ _13"> </span>we<span class="_"> </span>are<span class="_ _13"> </span>ready<span class="_ _13"> </span>to<span class="_"> </span>read<span class="_ _13"> </span>from<span class="_"> </span>a<span class="_ _13"> </span>ﬁle<span class="_ _13"> </span>that</span></div><div class="t m5 xcd h26 y779e ff7 fs19 fc1 sc0 ls0 ws0">contains<span class="_ _13"> </span>only<span class="_ _13"> </span>20<span class="_ _13"> </span>more<span class="_"> </span>bytes<span class="_ _13"> </span>from<span class="_ _13"> </span>the<span class="_ _13"> </span>current<span class="_ _13"> </span>ﬁle<span class="_ _13"> </span>position<span class="_ _13"> </span>and<span class="_"> </span>that<span class="_ _13"> </span>we<span class="_ _13"> </span>are</div><div class="t m5 xcd h26 y779f ff7 fs19 fc1 sc0 ls0 ws0">reading<span class="_"> </span>the<span class="_"> </span>ﬁle<span class="_"> </span>in<span class="_"> </span>50-byte<span class="_"> </span>chunks<span class="_ _1"></span>.<span class="_"> </span>Then<span class="_"> </span>the<span class="_"> </span>next<span class="_"> </span><span class="ffd">read<span class="_ _10"> </span></span>will<span class="_"> </span>return<span class="_"> </span>a<span class="_"> </span>short</div><div class="t m5 xcd h26 y77a0 ff7 fs19 fc1 sc0 ls0 ws0">count<span class="_"> </span>of<span class="_ _11"> </span>20,<span class="_"> </span>and<span class="_ _11"> </span>the<span class="_"> </span><span class="ffd">read<span class="_ _11"> </span></span>after<span class="_"> </span>that<span class="_ _11"> </span>will<span class="_"> </span>signal<span class="_ _11"> </span>EOF<span class="_"> </span>by<span class="_ _11"> </span>returning<span class="_"> </span>a<span class="_"> </span>short</div><div class="t m5 xcd h26 y77a1 ff7 fs19 fc1 sc0 ls0 ws0">count<span class="_"> </span>of<span class="_"> </span>0.</div><div class="t m5 x23a h26 y77a2 ffa fs19 fc1 sc0 ls0 ws0">Reading<span class="_"> </span>text<span class="_"> </span>lines<span class="_"> </span>from<span class="_"> </span>a<span class="_"> </span>terminal.<span class="_ _15"> </span><span class="ff7">If<span class="_"> </span>the<span class="_"> </span>open<span class="_"> </span>ﬁle<span class="_"> </span>is<span class="_"> </span>associated<span class="_"> </span>with<span class="_"> </span>a<span class="_"> </span>terminal</span></div><div class="t m5 xcd h26 y77a3 ff7 fs19 fc1 sc0 ls0 ws0">(i.e<span class="_ _1"></span>.,<span class="_ _16"> </span>a<span class="_ _11"> </span>keyboard<span class="_ _16"> </span>and<span class="_ _11"> </span>display),<span class="_ _11"> </span>then<span class="_ _16"> </span>each<span class="_ _11"> </span><span class="ffd">read<span class="_ _11"> </span></span>function<span class="_ _16"> </span>will<span class="_ _11"> </span>transfer<span class="_ _11"> </span>one</div><div class="t m5 xcd h26 y77a4 ff7 fs19 fc1 sc0 ls0 ws0">text<span class="_ _13"> </span>line<span class="_ _13"> </span>at<span class="_ _13"> </span>a<span class="_ _13"> </span>time<span class="_ _1"></span>,<span class="_ _13"> </span>returning<span class="_ _13"> </span>a<span class="_ _13"> </span>short<span class="_ _13"> </span>count<span class="_ _13"> </span>equal<span class="_ _13"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>size<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>text<span class="_ _13"> </span>line<span class="_ _1"></span>.</div><div class="t m5 x23a h26 y77a5 ffa fs19 fc1 sc0 ls0 ws0">Reading<span class="_"> </span>and<span class="_ _13"> </span>writing<span class="_"> </span>network<span class="_"> </span>sockets<span class="_ _3"></span>.<span class="_ _21"> </span><span class="ff7">If<span class="_"> </span>the<span class="_"> </span>open<span class="_"> </span>ﬁle<span class="_ _13"> </span>corresponds<span class="_"> </span>to<span class="_"> </span>a<span class="_ _13"> </span>network</span></div><div class="t m5 xcd h26 y77a6 ff7 fs19 fc1 sc0 ls0 ws0">socket<span class="_ _14"> </span>(Section<span class="_ _14"> </span>11.4),<span class="_ _15"> </span>then<span class="_ _14"> </span>internal<span class="_ _14"> </span>buffering<span class="_ _14"> </span>constraints<span class="_ _14"> </span>and<span class="_ _14"> </span>long<span class="_ _14"> </span>net-</div><div class="t m5 xcd h26 y77a7 ff7 fs19 fc1 sc0 ls0 ws0">work<span class="_ _6"> </span>delays<span class="_ _6"> </span>can<span class="_ _13"> </span>cause<span class="_ _a"> </span><span class="ffd">read<span class="_ _13"> </span></span>and<span class="_ _a"> </span><span class="ffd">write<span class="_ _13"> </span></span>to<span class="_ _a"> </span>return<span class="_ _13"> </span>short<span class="_ _a"> </span>counts<span class="_ _0"></span>.<span class="_ _6"> </span>Short<span class="_ _6"> </span>counts</div><div class="t m5 xcd h26 y77a8 ff7 fs19 fc1 sc0 ls0 ws0">can<span class="_ _11"> </span>also<span class="_ _16"> </span>occur<span class="_ _11"> </span>when<span class="_ _16"> </span>you<span class="_ _11"> </span>call<span class="_ _16"> </span><span class="ffd">read<span class="_ _11"> </span></span>and<span class="_ _16"> </span><span class="ffd">write<span class="_ _11"> </span></span>on<span class="_ _16"> </span>a<span class="_ _11"> </span>Linux<span class="_ _16"> </span><span class="ffa">pipe</span>,<span class="_ _16"> </span>an<span class="_ _11"> </span>inter<span class="_ _0"></span>-</div><div class="t m5 xcd h26 y77a9 ff7 fs19 fc1 sc0 ls0 ws0">process<span class="_"> </span>communication<span class="_"> </span>mechanism<span class="_"> </span>that<span class="_"> </span>is<span class="_"> </span>beyond<span class="_"> </span>our<span class="_"> </span>scope<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y77aa ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _11"> </span>practice,<span class="_ _11"> </span>you<span class="_ _16"> </span>will<span class="_ _11"> </span>never<span class="_ _16"> </span>encounter<span class="_ _11"> </span>short<span class="_ _16"> </span>counts<span class="_ _11"> </span>when<span class="_ _16"> </span>you<span class="_ _11"> </span>read<span class="_ _16"> </span>from<span class="_ _11"> </span>disk</div><div class="t m5 x1d h26 y77ab ff7 fs19 fc1 sc0 ls0 ws0">ﬁles<span class="_ _16"> </span>except<span class="_ _11"> </span>on<span class="_ _16"> </span>EOF<span class="_ _7"></span>,<span class="_ _14"> </span>and<span class="_ _16"> </span>you<span class="_ _11"> </span>will<span class="_ _16"> </span>never<span class="_ _16"> </span>encounter<span class="_ _16"> </span>short<span class="_ _11"> </span>counts<span class="_ _16"> </span>when<span class="_ _16"> </span>you<span class="_ _16"> </span>write</div><div class="t m5 x1d h26 y77ac ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_"> </span>disk<span class="_"> </span>ﬁles<span class="_ _3"></span>.<span class="_"> </span>However,<span class="_ _13"> </span>if<span class="_"> </span>you<span class="_"> </span>want<span class="_"> </span>to<span class="_ _13"> </span>build<span class="_"> </span>robust<span class="_"> </span>(reliable)<span class="_"> </span>network<span class="_ _13"> </span>applications</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
