<div id="pf3f4" class="pf w2 h11" data-page-no="3f4"><div class="pc pc3f4 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg3f4.png"/><div class="t m5 x18 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>12.1<span class="_ _60"> </span>Concurrent<span class="_ _10"> </span>Programming<span class="_ _10"> </span>with<span class="_ _10"> </span>Processes<span class="_ _3e"> </span><span class="ffe fs1e">1011</span></div><div class="t m5 x17 h2f ye7 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>12.4</div><div class="t m5 x17 h2f y58a ffe fs16 fc1 sc0 ls0 ws0">Step<span class="_ _14"> </span>4:<span class="_ _15"> </span>Server<span class="_ _15"> </span>forks</div><div class="t m5 x17 h2f y58b ffe fs16 fc1 sc0 ls0 ws0">another<span class="_ _11"> </span>child<span class="_ _16"> </span>to<span class="_ _11"> </span>service</div><div class="t m5 x17 h2f y58c ffe fs16 fc1 sc0 ls0 ws0">the<span class="_"> </span>new<span class="_"> </span>client.</div><div class="t m5 xd h4c y7f0d ffe5 fs2d fc1 sc0 ls0 ws0">Client 1</div><div class="t m5 x167 hcb y7f0e ffe6 fs7f fc1 sc0 ls0 ws0">clientfd</div><div class="t m5 xd h4c y7f0f ffe5 fs2d fc1 sc0 ls0 ws0">Client 2</div><div class="t m5 x167 hcb y7f10 ffe6 fs7f fc1 sc0 ls0 ws0">clientfd</div><div class="t m5 x13d hcb y7f11 ffe6 fs7f fc1 sc0 ls0 ws0">connfd(4)</div><div class="t m5 x1c2 h4c y7f12 ffe5 fs2d fc1 sc0 ls0 ws0">Child 1</div><div class="t m5 x13d hcb y7f13 ffe6 fs7f fc1 sc0 ls0 ws0">connfd(5)</div><div class="t m5 x1c2 h4c y7f14 ffe5 fs2d fc1 sc0 ls0 ws0">Child 2</div><div class="t m5 x1ab hcb y7f15 ffe6 fs7f fc1 sc0 ls0 ws0">listenfd(3)</div><div class="t m5 xc0 h4c y7f16 ffe5 fs2d fc1 sc0 ls0 ws0">Server</div><div class="t m5 xa7 h4c y7f17 ffe5 fs2d fc1 sc0 ls0 ws0">Data</div><div class="t m5 x15 h4c y7f18 ffe5 fs2d fc1 sc0 ls0 ws0">transfers</div><div class="t m5 xa7 h4c y7f19 ffe5 fs2d fc1 sc0 ls0 ws0">Data</div><div class="t m5 x15 h4c y7f1a ffe5 fs2d fc1 sc0 ls0 ws0">transfers</div><div class="t m5 x26 h26 y7f1b ff7 fs19 fc1 sc0 ls0 ws0">portant<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>parent,<span class="_"> </span>which<span class="_"> </span>must<span class="_"> </span>close<span class="_"> </span>its<span class="_"> </span>copy<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>connected<span class="_"> </span>descriptor</div><div class="t m5 x26 h26 y7f1c ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_"> </span>avoid<span class="_"> </span>a<span class="_"> </span>memory<span class="_"> </span>leak.</div><div class="t m5 x72 h3d y7f1d ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y7f1e ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>inally<span class="_ _3"></span>,<span class="_ _f"> </span>because<span class="_ _15"> </span>of<span class="_ _15"> </span>the<span class="_ _15"> </span>reference<span class="_ _21"> </span>count<span class="_ _15"> </span>in<span class="_ _15"> </span>the<span class="_ _15"> </span>socket’s<span class="_ _15"> </span>ﬁle<span class="_ _15"> </span>table<span class="_ _15"> </span>entry<span class="_ _3"></span>,<span class="_ _21"> </span>the</div><div class="t m5 x26 h26 y7f1f ff7 fs19 fc1 sc0 ls0 ws0">connection<span class="_ _14"> </span>to<span class="_ _14"> </span>the<span class="_ _14"> </span>client<span class="_ _15"> </span>will<span class="_ _14"> </span>not<span class="_ _14"> </span>be<span class="_ _15"> </span>terminated<span class="_ _14"> </span>until<span class="_ _14"> </span>both<span class="_ _14"> </span>the<span class="_ _15"> </span>parent’s<span class="_ _16"> </span>and</div><div class="t m5 x26 h26 y7f20 ff7 fs19 fc1 sc0 ls0 ws0">child’s<span class="_"> </span>copies<span class="_"> </span>of<span class="_"> </span><span class="ffd">connfd<span class="_ _10"> </span></span>are<span class="_"> </span>closed.</div><div class="t m5 x17 h41 y7f21 ffe fs29 fc1 sc0 ls0 ws0">12.1.2</div><div class="t m5 x1da h43 y7f22 ffe fs19 fc1 sc0 ls0 ws0">Pros<span class="_"> </span>and<span class="_"> </span>Cons<span class="_"> </span>of<span class="_"> </span>Processes</div><div class="t m5 x17 h26 y7f23 ff7 fs19 fc1 sc0 ls0 ws0">Processes<span class="_"> </span>have<span class="_ _11"> </span>a<span class="_"> </span>clean<span class="_ _11"> </span>model<span class="_"> </span>for<span class="_ _11"> </span>sharing<span class="_"> </span>state<span class="_ _11"> </span>information<span class="_"> </span>between<span class="_ _11"> </span>parents<span class="_"> </span>and</div><div class="t m5 x17 h26 y7f24 ff7 fs19 fc1 sc0 ls0 ws0">children:<span class="_ _11"> </span>ﬁle<span class="_ _11"> </span>tables<span class="_ _11"> </span>are<span class="_ _16"> </span>shared<span class="_ _11"> </span>and<span class="_ _11"> </span>user<span class="_ _11"> </span>address<span class="_ _11"> </span>spaces<span class="_ _16"> </span>are<span class="_ _11"> </span>not.<span class="_ _11"> </span>Having<span class="_ _11"> </span>separate</div><div class="t m5 x17 h26 y7f25 ff7 fs19 fc1 sc0 ls0 ws0">address<span class="_ _16"> </span>spaces<span class="_ _14"> </span>for<span class="_ _14"> </span>processes<span class="_ _16"> </span>is<span class="_ _14"> </span>both<span class="_ _14"> </span>an<span class="_ _16"> </span>advantage<span class="_ _14"> </span>and<span class="_ _14"> </span>a<span class="_ _16"> </span>disadvantage.<span class="_ _16"> </span>It<span class="_ _16"> </span>is<span class="_ _14"> </span>im-</div><div class="t m5 x17 h26 y7f26 ff7 fs19 fc1 sc0 ls0 ws0">possible<span class="_"> </span>for<span class="_"> </span>one<span class="_ _11"> </span>process<span class="_"> </span>to<span class="_"> </span>accidentally<span class="_ _11"> </span>overwrite<span class="_"> </span>the<span class="_"> </span>virtual<span class="_ _11"> </span>memory<span class="_"> </span>of<span class="_"> </span>another</div><div class="t m5 x17 h26 y7f27 ff7 fs19 fc1 sc0 ls0 ws0">process<span class="_ _1"></span>,<span class="_"> </span>which<span class="_"> </span>eliminates<span class="_"> </span>a<span class="_"> </span>lot<span class="_"> </span>of<span class="_"> </span>confusing<span class="_"> </span>failures—an<span class="_"> </span>obvious<span class="_"> </span>advantage<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y7f28 ff7 fs19 fc1 sc0 ls0 ws0">On<span class="_ _16"> </span>the<span class="_ _14"> </span>other<span class="_ _16"> </span>hand,<span class="_ _15"> </span>separate<span class="_ _16"> </span>address<span class="_ _14"> </span>spaces<span class="_ _14"> </span>make<span class="_ _16"> </span>it<span class="_ _14"> </span>more<span class="_ _16"> </span>difﬁcult<span class="_ _14"> </span>for<span class="_ _14"> </span>pro-</div><div class="t m5 x17 h26 y7f29 ff7 fs19 fc1 sc0 ls0 ws0">cesses<span class="_ _13"> </span>to<span class="_ _13"> </span>share<span class="_ _6"> </span>state<span class="_ _13"> </span>information.<span class="_ _13"> </span>T<span class="_ _7"></span>o<span class="_ _13"> </span>share<span class="_ _13"> </span>information,<span class="_ _13"> </span>they<span class="_ _13"> </span>must<span class="_ _6"> </span>use<span class="_ _13"> </span>explicit<span class="_ _13"> </span>IPC</div><div class="t m5 x17 h26 y7f2a ff7 fs19 fc1 sc0 ls0 ws0">(interprocess<span class="_ _16"> </span>communications)<span class="_ _11"> </span>mechanisms<span class="_ _1"></span>.<span class="_ _16"> </span>(See<span class="_ _16"> </span>the<span class="_ _11"> </span>Aside<span class="_ _16"> </span>on<span class="_ _16"> </span>page<span class="_ _11"> </span>1013.)<span class="_ _16"> </span>An-</div><div class="t m5 x17 h26 y7f2b ff7 fs19 fc1 sc0 ls0 ws0">other<span class="_ _13"> </span>disadvantage<span class="_ _6"> </span>of<span class="_ _13"> </span>process-based<span class="_ _13"> </span>designs<span class="_ _13"> </span>is<span class="_ _6"> </span>that<span class="_ _13"> </span>they<span class="_ _13"> </span>tend<span class="_ _6"> </span>to<span class="_ _13"> </span>be<span class="_ _13"> </span>slower<span class="_ _13"> </span>because</div><div class="t m5 x17 h26 y7f2c ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>overhead<span class="_"> </span>for<span class="_"> </span>process<span class="_"> </span>control<span class="_"> </span>and<span class="_"> </span>IPC<span class="_"> </span>is<span class="_"> </span>high.</div><div class="t m5 x17 h47 y7f2d ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>12.1<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>1072)</span></div><div class="t m5 x17 h26 y7f2e ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_"> </span>12.5<span class="_"> </span>demonstrates<span class="_"> </span>a<span class="_"> </span>concurrent<span class="_ _13"> </span>server<span class="_"> </span>in<span class="_"> </span>which<span class="_"> </span>the<span class="_"> </span>parent<span class="_ _13"> </span>process<span class="_"> </span>creates</div><div class="t m5 x17 h26 y7f2f ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_ _14"> </span>child<span class="_ _15"> </span>process<span class="_ _14"> </span>to<span class="_ _15"> </span>handle<span class="_ _15"> </span>each<span class="_ _14"> </span>new<span class="_ _15"> </span>connection<span class="_ _14"> </span>request.<span class="_ _15"> </span>T<span class="_ _7"></span>race<span class="_ _15"> </span>the<span class="_ _14"> </span>value<span class="_ _15"> </span>of<span class="_ _14"> </span>the</div><div class="t m5 x17 h26 y7f30 ff7 fs19 fc1 sc0 ls0 ws0">reference<span class="_"> </span>counter<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>associated<span class="_"> </span>ﬁle<span class="_"> </span>table<span class="_"> </span>for<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>12.5.</div><div class="t m5 x17 h47 y7f31 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>12.2<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>1072)</span></div><div class="t m5 x17 h26 y7f32 ff7 fs19 fc1 sc0 ls0 ws0">If<span class="_"> </span>we<span class="_"> </span>were<span class="_"> </span>to<span class="_"> </span>delete<span class="_"> </span>line<span class="_ _11"> </span>33<span class="_"> </span>of<span class="_"> </span>Figure12.5,<span class="_"> </span>which<span class="_"> </span>closes<span class="_"> </span>the<span class="_"> </span>connected<span class="_"> </span>descriptor,</div><div class="t m5 x17 h26 y7f33 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>code<span class="_"> </span>would<span class="_"> </span>still<span class="_"> </span>be<span class="_"> </span>correct,<span class="_ _13"> </span>in<span class="_"> </span>the<span class="_"> </span>sense<span class="_"> </span>that<span class="_"> </span>there<span class="_"> </span>would<span class="_"> </span>be<span class="_"> </span>no<span class="_"> </span>memory<span class="_"> </span>leak.</div><div class="t m5 x17 h26 y7f34 ff7 fs19 fc1 sc0 ls0 ws0">Why?</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
