<div id="pf172" class="pf w2 h11" data-page-no="172"><div class="pc pc172 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg172.png"/><div class="t m5 x107 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Solutions<span class="_ _10"> </span>to<span class="_ _10"> </span>Practice<span class="_ _10"> </span>Problems<span class="_ _1b"> </span><span class="ffe fs1e">369</span></div><div class="t m5 x34 h46 ye7 ff7 fs19 fc2 sc0 ls0 ws0">B<span class="_ _3"></span>.<span class="_ _1d"> </span>When<span class="_ _16"> </span>misprediction<span class="_ _16"> </span>occurs<span class="_ _1"></span>,<span class="_ _14"> </span>the<span class="_ _16"> </span>function<span class="_ _14"> </span>will<span class="_ _16"> </span>require<span class="_ _16"> </span>around<span class="_ _16"> </span>25<span class="_"> </span><span class="ff12">+<span class="_ _13"></span></span>40<span class="_"> </span><span class="ff12">=<span class="_ _10"> </span></span>65</div><div class="t m5 x2d h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">cycles<span class="_ _3"></span>.</div><div class="t m5 x17 h28 y33db ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>3.20<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>255)</span></div><div class="t m5 x17 h26 y33dc ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>problem<span class="_"> </span>provides<span class="_"> </span>a<span class="_"> </span>chance<span class="_"> </span>to<span class="_"> </span>study<span class="_"> </span>the<span class="_"> </span>use<span class="_"> </span>of<span class="_"> </span>conditional<span class="_"> </span>moves<span class="_ _1"></span>.</div><div class="t m5 x34 h26 y33dd ff7 fs19 fc1 sc0 ls0 ws0">A.<span class="_ _1f"> </span>T<span class="_ _1"></span>he<span class="_"> </span>operator<span class="_"> </span>is<span class="_"> </span>‘<span class="ffd">/</span>’.<span class="_ _13"> </span>W<span class="_ _1"></span>e<span class="_"> </span>see<span class="_"> </span>this<span class="_ _13"> </span>is<span class="_"> </span>an<span class="_"> </span>example<span class="_"> </span>of<span class="_"> </span>dividing<span class="_ _13"> </span>by<span class="_"> </span>a<span class="_"> </span>power<span class="_"> </span>of<span class="_ _13"> </span>4<span class="_"> </span>by</div><div class="t m5 x2d h46 y33de ff7 fs19 fc1 sc0 ls0 ws0">right<span class="_ _13"> </span>shifting<span class="_ _13"> </span>(see<span class="_ _13"> </span>Section<span class="_ _13"> </span>2.3.7).<span class="_ _13"> </span>Before<span class="_ _13"> </span>shifting<span class="_ _13"> </span>by<span class="_ _13"> </span><span class="ff11">k<span class="_ _10"> </span><span class="ff12">=<span class="_ _13"></span></span></span><span class="ls58">4,<span class="_ _13"> </span>we<span class="_ _13"> </span>must<span class="_ _13"> </span>add<span class="_ _13"> </span>a<span class="_ _13"> </span>bias</span></div><div class="t m5 x2d h26 y33df ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span>2</div><div class="t m5 x1da h50 y33e0 ff11 fs25 fc1 sc0 ls0 ws0">k</div><div class="t m5 x1d3 h46 y33e1 ff12 fs19 fc1 sc0 ls0 ws0">−<span class="_ _13"> </span><span class="ff7">1<span class="_ _13"> </span></span>=<span class="_ _13"></span><span class="ff7">15<span class="_"> </span>when<span class="_"> </span>the<span class="_"> </span>dividend<span class="_"> </span>is<span class="_"> </span>negative<span class="_ _1"></span>.</span></div><div class="t m5 x34 h26 y33e2 ff7 fs19 fc1 sc0 ls0 ws0">B<span class="_ _3"></span>.<span class="_ _1d"> </span>Here<span class="_"> </span>is<span class="_"> </span>an<span class="_"> </span>annotated<span class="_"> </span>version<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>assembly<span class="_"> </span>code:</div><div class="t m5 x19f h61 y33e3 ff13 fs35 fc6 sc0 ls0 ws0">short<span class="_ _f"> </span>arith(short<span class="_ _f"> </span>x)</div><div class="t m5 x19f h61 y33e4 ff13 fs35 fc6 sc0 ls0 ws0">x<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi</div><div class="t m5 x2d h2d y33e5 ffd fs1e fc2 sc0 ls0 ws0">arith:</div><div class="t m5 xd1 h2d y33e6 ffd fs1e fc2 sc0 ls0 ws0">leaq<span class="_ _46"> </span>15(%rdi),<span class="_ _e"> </span>%rbx</div><div class="t m5 xe2 h61 y33e7 ff13 fs35 fc6 sc0 ls0 ws0">temp<span class="_ _f"> </span>=<span class="_ _f"> </span>x+15</div><div class="t m5 xd1 h2d y33e8 ffd fs1e fc2 sc0 ls0 ws0">testq<span class="_ _3f"> </span>%rdi,<span class="_ _e"> </span>%rdi<span class="_ _2a"> </span><span class="ff13 fs35 fc6">Text<span class="_ _f"> </span>x</span></div><div class="t m5 xd1 h2d y33e9 ffd fs1e fc2 sc0 ls0 ws0">cmovns<span class="_ _1a"> </span>%rdi,<span class="_ _e"> </span>%rbx<span class="_ _2a"> </span><span class="ff13 fs35 fc6">If<span class="_ _f"> </span>x&gt;=<span class="_ _f"> </span>0,<span class="_ _e"> </span>temp<span class="_ _21"> </span>=<span class="_ _f"> </span>x</span></div><div class="t m5 xd1 h2d y33ea ffd fs1e fc2 sc0 ls0 ws0">sarq<span class="_ _46"> </span>$4,<span class="_ _e"> </span>%rbx<span class="_ _9a"> </span><span class="ff13 fs35 fc6">result<span class="_ _f"> </span>=<span class="_ _f"> </span>temp<span class="_ _e"> </span>&gt;&gt;<span class="_ _21"> </span>4<span class="_ _f"> </span>(=<span class="_ _e"> </span>x/16)</span></div><div class="t m5 xd1 h2d y33eb ffd fs1e fc2 sc0 ls0 ws0">ret</div><div class="t m5 x2d h46 y33ec ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _f"> </span>program<span class="_ _f"> </span>creates<span class="_ _21"> </span>a<span class="_ _f"> </span>temporary<span class="_ _f"> </span>value<span class="_ _f"> </span>equal<span class="_ _21"> </span>to<span class="_ _f"> </span><span class="ff11">x<span class="_"> </span><span class="ff12">+<span class="_ _13"></span></span></span>15,<span class="_ _e"> </span>in<span class="_ _15"> </span>anticipation</div><div class="t m5 x2d h26 y33ed ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_"> </span><span class="ff11">x<span class="_ _11"> </span></span>being<span class="_"> </span>negative<span class="_"> </span>and<span class="_"> </span>therefore<span class="_"> </span>requiring<span class="_"> </span>biasing<span class="_ _1"></span>.<span class="_"> </span>The<span class="_ _13"> </span><span class="ffd">cmovns<span class="_ _10"> </span></span>instruction</div><div class="t m5 x2d h46 y33ee ff7 fs19 fc2 sc0 ls0 ws0">conditionally<span class="_"> </span>changes<span class="_"> </span>this<span class="_"> </span>number<span class="_"> </span>to<span class="_"> </span><span class="ff11">x<span class="_ _11"> </span></span>when<span class="_"> </span><span class="ff11">x<span class="_ _11"> </span><span class="ff12">≥<span class="_ _10"> </span></span></span><span class="lsaa">0,<span class="_"> </span>and<span class="_"> </span>then<span class="_"> </span>it<span class="_"> </span>is<span class="_ _13"> </span>shifted<span class="_"> </span>by</span></div><div class="t m5 x2d h26 y33ef ff7 fs19 fc2 sc0 ls0 ws0">4<span class="_"> </span>to<span class="_"> </span>generate<span class="_"> </span><span class="ff11 ls57">x/<span class="_ _1"></span><span class="ff7 ls9e">16.</span></span></div><div class="t m5 x17 h28 y33f0 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>3.21<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>255)</span></div><div class="t m5 x17 h26 y33f1 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _13"> </span>problem<span class="_ _13"> </span>is<span class="_ _13"> </span>similar<span class="_ _13"> </span>to<span class="_ _13"> </span>Problem<span class="_ _13"> </span>3.18,<span class="_"> </span>except<span class="_ _13"> </span>that<span class="_ _13"> </span>some<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>conditionals<span class="_ _13"> </span>have</div><div class="t m5 x17 h26 y33f2 ff7 fs19 fc1 sc0 ls0 ws0">been<span class="_ _13"> </span>implemented<span class="_ _6"> </span>by<span class="_ _13"> </span>conditional<span class="_ _6"> </span>data<span class="_ _13"> </span>transfers<span class="_ _1"></span>.<span class="_ _13"> </span>Although<span class="_ _6"> </span>it<span class="_ _13"> </span>might<span class="_ _13"> </span>seem<span class="_ _6"> </span>daunting</div><div class="t m5 x17 h26 y33f3 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _6"> </span>ﬁt<span class="_ _6"> </span>this<span class="_ _6"> </span>code<span class="_ _6"> </span>into<span class="_ _6"> </span>the<span class="_ _6"> </span>framework<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _a"> </span>original<span class="_ _6"> </span>C<span class="_ _6"> </span>code,<span class="_ _6"> </span>you<span class="_ _6"> </span>will<span class="_ _6"> </span>ﬁnd<span class="_ _6"> </span>that<span class="_ _6"> </span>it<span class="_ _6"> </span>follows</div><div class="t m5 x17 h26 y33f4 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>translation<span class="_"> </span>rules<span class="_"> </span>fairly<span class="_"> </span>closely<span class="_ _3"></span>.</div><div class="t m5 x17 h2d y33f5 ffd fs1e fc2 sc0 ls0 ws0">short<span class="_ _e"> </span>test(short<span class="_ _1f"> </span>x,<span class="_ _1f"> </span>short<span class="_ _e"> </span>y)<span class="_ _1f"> </span>{</div><div class="t m5 x1b6 h2d y33f6 ffd fs1e fc2 sc0 ls0 ws0">short<span class="_ _e"> </span>va<span class="ls33">l=y+1<span class="_ _41"></span>2<span class="_ _41"></span>;</span></div><div class="t m5 x1b6 h2d y33f7 ffd fs1e fc2 sc0 ls33 ws0">i<span class="_ _41"></span>f(<span class="_ _41"></span>x&lt;0<span class="_ _41"></span>){</div><div class="t m5 x21e h2d y33f8 ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>(x<span class="_ _1f"> </span>&lt;<span class="_ _1f"> </span>y)</div><div class="t m5 x155 h2d y33f9 ffd fs1e fc2 sc0 ls33 ws0">v<span class="_ _41"></span>a<span class="_ _41"></span>l=x*y<span class="_ _41"></span>;</div><div class="t m5 x21e h2d y33fa ffd fs1e fc2 sc0 ls0 ws0">else</div><div class="t m5 x155 h2d y33fb ffd fs1e fc2 sc0 ls33 ws0">v<span class="_ _41"></span>a<span class="_ _41"></span>l=x|y<span class="_ _41"></span>;</div><div class="t m5 x1b6 h2d y33fc ffd fs1e fc2 sc0 ls0 ws0">}<span class="_ _e"> </span>else<span class="_ _1f"> </span>if<span class="_ _1f"> </span>(y<span class="_ _e"> </span>&gt;<span class="_ _1f"> </span>10)</div><div class="t m5 x21e h2d y33fd ffd fs1e fc2 sc0 ls33 ws0">v<span class="_ _41"></span>a<span class="_ _41"></span>l=x/y<span class="_ _41"></span>;</div><div class="t m5 x1b6 h2d y33fe ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>val;</div><div class="t m5 x17 h2d y33ff ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x17 h28 y3400 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>3.22</div><div class="t m5 x112 h2f y3401 ffe fs16 fc6 sc0 ls0 ws0">(page<span class="_"> </span>257)</div><div class="t m5 x34 h26 y8d6 ff7 fs19 fc1 sc0 ls0 ws0">A.<span class="_ _1f"> </span>T<span class="_ _1"></span>he<span class="_ _14"> </span>computation<span class="_ _14"> </span>of<span class="_ _14"> </span>14!<span class="_ _11"> </span>would<span class="_ _14"> </span>overﬂow<span class="_ _15"> </span>with<span class="_ _14"> </span>a<span class="_ _14"> </span>32-bit<span class="_ _14"> </span><span class="ffd">int</span>.<span class="_ _14"> </span>As<span class="_ _14"> </span>we<span class="_ _14"> </span>learned</div><div class="t m5 x2d h26 y8d7 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_ _16"> </span>Problem<span class="_ _16"> </span>2.35,<span class="_ _16"> </span>when<span class="_ _16"> </span>we<span class="_ _16"> </span>get<span class="_ _11"> </span>value<span class="_ _16"> </span><span class="ff11">x<span class="_ _15"> </span></span>while<span class="_ _16"> </span>attempting<span class="_ _16"> </span>to<span class="_ _16"> </span>compute<span class="_ _16"> </span><span class="ff11">n</span><span class="ls198">!,<span class="_ _15"> </span>w<span class="_ _be"></span>e</span></div><div class="t m5 x2d h46 y8d8 ff7 fs19 fc1 sc0 ls0 ws0">can<span class="_ _13"> </span>test<span class="_ _13"> </span>for<span class="_"> </span>overﬂow<span class="_ _13"> </span>by<span class="_ _13"> </span>computing<span class="_ _13"> </span><span class="ff11 ls199">x/n<span class="_ _6"> </span></span>and<span class="_ _13"> </span>seeing<span class="_ _13"> </span>whether<span class="_"> </span>it<span class="_ _13"> </span>equals<span class="_ _13"> </span><span class="ff11">(n<span class="_ _13"> </span><span class="ff12">−<span class="_ _13"> </span></span></span>1<span class="_ _0"></span><span class="ff11">)<span class="ff7">!</span></span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
