<div id="pf28b" class="pf w2 h11" data-page-no="28b"><div class="pc pc28b w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg28b.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">650<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>6<span class="_ _3d"> </span>The<span class="_ _10"> </span>Memory<span class="_ _10"> </span>Hierarchy</span></div><div class="t m5 x14 h31 y390 ff7 fs21 fc2 sc0 ls0 ws0">T<span class="_ _7"></span>ype<span class="_ _70"> </span>W<span class="_ _0"></span>hat<span class="_"> </span>cached<span class="_ _2d"> </span>Where<span class="_"> </span>cached<span class="_ _87"> </span>Latency<span class="_"> </span>(cycles)<span class="_ _b0"> </span>Managed<span class="_"> </span>by</div><div class="t m5 x14 h31 yc94 ff7 fs21 fc2 sc0 ls0 ws0">CPU<span class="_"> </span>registers<span class="_ _f1"> </span>4-byte<span class="_"> </span>or<span class="_"> </span>8-byte<span class="_"> </span>words<span class="_ _b0"> </span>On-chip<span class="_"> </span>CPU<span class="_"> </span>registers<span class="_ _158"> </span>0<span class="_ _3f"> </span>Compiler</div><div class="t m5 x14 h31 yc96 ff7 fs21 fc2 sc0 ls0 ws0">TLB<span class="_ _70"> </span>Address<span class="_"> </span>translations<span class="_ _f1"> </span>On-chip<span class="_"> </span>TLB<span class="_ _1fb"> </span>0<span class="_ _3f"> </span>Hardware<span class="_"> </span>MMU</div><div class="t m5 x14 h31 y5521 ff7 fs21 fc2 sc0 ls0 ws0">L1<span class="_"> </span>cache<span class="_ _148"> </span>64-byte<span class="_"> </span>blocks<span class="_ _77"> </span>On-chip<span class="_"> </span>L1<span class="_"> </span>cache<span class="_ _9c"> </span>4<span class="_ _3f"> </span>Hardware</div><div class="t m5 x14 h31 y5522 ff7 fs21 fc2 sc0 ls0 ws0">L2<span class="_"> </span>cache<span class="_ _148"> </span>64-byte<span class="_"> </span>blocks<span class="_ _77"> </span>On-chip<span class="_"> </span>L2<span class="_"> </span>cache<span class="_ _67"> </span>10<span class="_ _3f"> </span>Hardware</div><div class="t m5 x14 h31 y5683 ff7 fs21 fc2 sc0 ls0 ws0">L3<span class="_"> </span>cache<span class="_ _148"> </span>64-byte<span class="_"> </span>blocks<span class="_ _77"> </span>On-chip<span class="_"> </span>L3<span class="_"> </span>cache<span class="_ _67"> </span>50<span class="_ _3f"> </span>Hardware</div><div class="t m5 x14 h31 y5684 ff7 fs21 fc2 sc0 ls0 ws0">V<span class="_ _1"></span>irtual<span class="_"> </span>memory<span class="_ _1e2"> </span>4-KB<span class="_"> </span>pages<span class="_ _192"> </span>Main<span class="_"> </span>memory<span class="_ _bc"> </span>200<span class="_ _fe"> </span>Hardware<span class="_"> </span>+<span class="_"> </span>OS</div><div class="t m5 x14 h31 y5685 ff7 fs21 fc2 sc0 ls0 ws0">Buffer<span class="_"> </span>cache<span class="_ _4f"> </span>Parts<span class="_"> </span>of<span class="_"> </span>ﬁles<span class="_ _1ea"> </span>Main<span class="_"> </span>memory<span class="_ _bc"> </span>200<span class="_ _fe"> </span>OS</div><div class="t m5 x14 h31 y5686 ff7 fs21 fc2 sc0 ls0 ws0">Disk<span class="_"> </span>cache<span class="_ _128"> </span>Disk<span class="_"> </span>sectors<span class="_ _110"> </span>Disk<span class="_"> </span>controller<span class="_ _157"> </span>100,000<span class="_ _3f"> </span>Controller<span class="_"> </span>ﬁrmware</div><div class="t m5 x14 h31 y5687 ff7 fs21 fc2 sc0 ls0 ws0">Network<span class="_"> </span>cache<span class="_ _fe"> </span>Parts<span class="_"> </span>of<span class="_"> </span>ﬁles<span class="_ _110"> </span>Local<span class="_"> </span>disk<span class="_ _cf"> </span>10,000,000<span class="_ _3f"> </span>NFS<span class="_"> </span>client</div><div class="t m5 x14 h31 y5688 ff7 fs21 fc2 sc0 ls0 ws0">Browser<span class="_"> </span>cache<span class="_ _103"> </span>W<span class="_ _3"></span>eb<span class="_"> </span>pages<span class="_ _126"> </span>Local<span class="_"> </span>disk<span class="_ _cf"> </span>10,000,000<span class="_ _3f"> </span>W<span class="_ _3"></span>eb<span class="_"> </span>browser</div><div class="t m5 x14 h31 y5689 ff7 fs21 fc2 sc0 ls0 ws0">W<span class="_ _3"></span>eb<span class="_"> </span>cache<span class="_ _57"> </span>W<span class="_ _1"></span>eb<span class="_"> </span>pages<span class="_ _126"> </span>Remote<span class="_"> </span>server<span class="_"> </span>disks<span class="_ _59"> </span>1,000,000,000<span class="_ _3f"> </span>W<span class="_ _3"></span>eb<span class="_"> </span>proxy<span class="_"> </span>server</div><div class="t m5 x14 h34 y568a ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>6.23<span class="_ _c"> </span><span class="fc1">The<span class="_"> </span>ubiquity<span class="_"> </span>of<span class="_"> </span>caching<span class="_"> </span>in<span class="_ _11"> </span>modern<span class="_"> </span>computer<span class="_"> </span>systems.<span class="_ _11"> </span><span class="ff6">Acronyms:<span class="_ _11"> </span>TLB:<span class="_ _10"> </span>translation<span class="_ _11"> </span>lookaside</span></span></div><div class="t m5 x14 h34 y568b ff6 fs16 fc1 sc0 ls0 ws0">buffer;<span class="_ _10"> </span>MMU:<span class="_ _11"> </span>memory<span class="_ _10"> </span>management<span class="_ _11"> </span>unit;<span class="_ _10"> </span>OS:<span class="_ _11"> </span>operating<span class="_ _10"> </span>system;<span class="_ _10"> </span>NFS:<span class="_ _11"> </span>network<span class="_ _10"> </span>ﬁle<span class="_ _11"> </span>system.</div><div class="t m5 x1d h41 y568c ffe fs29 fc1 sc0 ls0 ws0">6.3.2<span class="_ _48"> </span><span class="fs19">Summary<span class="_"> </span>of<span class="_"> </span>Memory<span class="_"> </span>Hierarchy<span class="_"> </span>Concepts</span></div><div class="t m5 x1d h26 y568d ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_ _13"> </span>summarize<span class="_ _1"></span>,<span class="_ _13"> </span>memory<span class="_ _13"> </span>hierarchies<span class="_ _6"> </span>based<span class="_ _13"> </span>on<span class="_ _6"> </span>caching<span class="_ _13"> </span>work<span class="_ _13"> </span>because<span class="_ _6"> </span>slower<span class="_ _13"> </span>storage</div><div class="t m5 x1d h26 y568e ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_"> </span>cheaper<span class="_"> </span>than<span class="_"> </span>faster<span class="_"> </span>storage<span class="_"> </span>and<span class="_"> </span>because<span class="_"> </span>programs<span class="_"> </span>tend<span class="_"> </span>to<span class="_"> </span>exhibit<span class="_"> </span>locality:</div><div class="t m5 x75 h26 y568f ffa fs19 fc1 sc0 ls0 ws0">Exploiting<span class="_ _6"> </span>temporal<span class="_ _6"> </span>locality<span class="_ _1"></span>.<span class="_ _21"> </span><span class="ff7">Because<span class="_ _13"> </span>of<span class="_ _a"> </span>temporal<span class="_ _6"> </span>locality<span class="_ _3"></span>,<span class="_ _13"> </span>the<span class="_ _a"> </span>same<span class="_ _6"> </span>data<span class="_ _13"> </span>objects</span></div><div class="t m5 xcd h26 y5690 ff7 fs19 fc1 sc0 ls0 ws0">are<span class="_ _13"> </span>likely<span class="_ _13"> </span>to<span class="_ _13"> </span>be<span class="_ _13"> </span>reused<span class="_ _13"> </span>multiple<span class="_ _13"> </span>times<span class="_ _1"></span>.<span class="_ _13"> </span>Once<span class="_ _13"> </span>a<span class="_ _13"> </span>data<span class="_ _13"> </span>object<span class="_ _13"> </span>has<span class="_ _13"> </span>been<span class="_ _13"> </span>copied</div><div class="t m5 xcd h26 y5691 ff7 fs19 fc1 sc0 ls0 ws0">into<span class="_ _16"> </span>the<span class="_ _16"> </span>cache<span class="_ _16"> </span>on<span class="_ _16"> </span>the<span class="_ _16"> </span>ﬁrst<span class="_ _16"> </span>miss<span class="_ _0"></span>,<span class="_ _16"> </span>we<span class="_ _16"> </span>can<span class="_ _14"> </span>expect<span class="_ _16"> </span>a<span class="_ _16"> </span>number<span class="_ _16"> </span>of<span class="_ _16"> </span>subsequent</div><div class="t m5 xcd h26 y5692 ff7 fs19 fc1 sc0 ls0 ws0">hits<span class="_ _11"> </span>on<span class="_ _11"> </span>that<span class="_ _16"> </span>object.<span class="_ _11"> </span>Since<span class="_ _11"> </span>the<span class="_ _11"> </span>cache<span class="_ _16"> </span>is<span class="_ _11"> </span>faster<span class="_ _11"> </span>than<span class="_ _11"> </span>the<span class="_ _16"> </span>storage<span class="_ _11"> </span>at<span class="_ _11"> </span>the<span class="_ _11"> </span>next</div><div class="t m5 xcd h26 y5693 ff7 fs19 fc1 sc0 ls0 ws0">lower<span class="_ _15"> </span>level,<span class="_ _21"> </span>these<span class="_ _15"> </span>subsequent<span class="_ _15"> </span>hits<span class="_ _15"> </span>can<span class="_ _15"> </span>be<span class="_ _15"> </span>served<span class="_ _15"> </span>much<span class="_ _15"> </span>faster<span class="_ _15"> </span>than<span class="_ _15"> </span>the</div><div class="t m5 xcd h26 y5694 ff7 fs19 fc1 sc0 ls0 ws0">original<span class="_"> </span>miss<span class="_ _1"></span>.</div><div class="t m5 x75 h26 y5695 ffa fs19 fc1 sc0 ls0 ws0">Exploiting<span class="_ _6"> </span>spatial<span class="_ _6"> </span>locality<span class="_ _1"></span>.<span class="_ _21"> </span><span class="ff7">Blocks<span class="_ _6"> </span>usually<span class="_ _6"> </span>contain<span class="_ _6"> </span>multiple<span class="_ _6"> </span>data<span class="_ _6"> </span>objects<span class="_ _1"></span>.<span class="_ _6"> </span>Because</span></div><div class="t m5 xcd h26 y5696 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_ _11"> </span>spatial<span class="_ _11"> </span>locality<span class="_ _3"></span>,<span class="_ _16"> </span>we<span class="_ _11"> </span>can<span class="_ _11"> </span>expect<span class="_ _16"> </span>that<span class="_ _11"> </span>the<span class="_ _11"> </span>cost<span class="_ _16"> </span>of<span class="_ _11"> </span>copying<span class="_ _11"> </span>a<span class="_ _16"> </span>block<span class="_ _11"> </span>after<span class="_ _11"> </span>a</div><div class="t m5 xcd h26 y5697 ff7 fs19 fc1 sc0 ls0 ws0">miss<span class="_ _11"> </span>will<span class="_ _11"> </span>be<span class="_ _16"> </span>amortized<span class="_ _11"> </span>by<span class="_ _11"> </span>subsequent<span class="_ _11"> </span>references<span class="_ _16"> </span>to<span class="_ _11"> </span>other<span class="_ _11"> </span>objects<span class="_ _11"> </span>within</div><div class="t m5 xcd h26 y5698 ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_"> </span>block.</div><div class="t m5 x29 h26 y5699 ff7 fs19 fc1 sc0 ls0 ws0">Caches<span class="_ _14"> </span>are<span class="_ _14"> </span>used<span class="_ _14"> </span>everywhere<span class="_ _14"> </span>in<span class="_ _14"> </span>modern<span class="_ _14"> </span>systems<span class="_ _1"></span>.<span class="_ _14"> </span>As<span class="_ _14"> </span>you<span class="_ _14"> </span>can<span class="_ _14"> </span>see<span class="_ _15"> </span>from<span class="_ _14"> </span>F<span class="_ _1"></span>ig-</div><div class="t m5 x1d h26 y569a ff7 fs19 fc1 sc0 ls0 ws0">ure<span class="_ _13"> </span>6.23,<span class="_ _13"> </span>caches<span class="_ _13"> </span>are<span class="_ _13"> </span>used<span class="_ _13"> </span>in<span class="_ _13"> </span>CPU<span class="_ _13"> </span>chips<span class="_ _1"></span>,<span class="_ _13"> </span>operating<span class="_ _13"> </span>systems<span class="_ _0"></span>,<span class="_ _13"> </span>distributed<span class="_ _13"> </span>ﬁle<span class="_ _13"> </span>systems<span class="_ _1"></span>,</div><div class="t m5 x1d h26 y569b ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _11"> </span>on<span class="_ _11"> </span>the<span class="_ _11"> </span>W<span class="_ _3"></span>orld<span class="_ _11"> </span>W<span class="_ _0"></span>ide<span class="_ _11"> </span>W<span class="_ _3"></span>eb.<span class="_"> </span>T<span class="_ _1"></span>hey<span class="_ _11"> </span>are<span class="_ _11"> </span>built<span class="_ _11"> </span>from<span class="_ _11"> </span>and<span class="_ _11"> </span>managed<span class="_ _11"> </span>by<span class="_ _11"> </span>various<span class="_ _11"> </span>com-</div><div class="t m5 x1d h26 y569c ff7 fs19 fc1 sc0 ls0 ws0">binations<span class="_ _11"> </span>of<span class="_ _16"> </span>hardware<span class="_ _11"> </span>and<span class="_ _16"> </span>software<span class="_ _0"></span>.<span class="_ _11"> </span>Note<span class="_ _16"> </span>that<span class="_ _11"> </span>there<span class="_ _16"> </span>are<span class="_ _11"> </span>a<span class="_ _16"> </span>number<span class="_ _16"> </span>of<span class="_ _11"> </span>terms<span class="_ _16"> </span>and</div><div class="t m5 x1d h26 y569d ff7 fs19 fc1 sc0 ls0 ws0">acronyms<span class="_ _16"> </span>in<span class="_ _14"> </span>Figure<span class="_ _16"> </span>6.23<span class="_ _14"> </span>that<span class="_ _14"> </span>we<span class="_ _16"> </span>haven’t<span class="_ _14"> </span>covered<span class="_ _16"> </span>yet.<span class="_ _14"> </span>W<span class="_ _1"></span>e<span class="_ _14"> </span>include<span class="_ _16"> </span>them<span class="_ _14"> </span>here<span class="_ _14"> </span>to</div><div class="t m5 x1d h26 y569e ff7 fs19 fc1 sc0 ls0 ws0">demonstrate<span class="_"> </span>how<span class="_"> </span>common<span class="_"> </span>caches<span class="_"> </span>are<span class="_ _1"></span>.</div><div class="t m5 x1d h3b y8d5 fff fs24 fc6 sc0 ls0 ws0">6.4<span class="_ _17"> </span><span class="ffe fs18">Cache<span class="_"> </span>Memories</span></div><div class="t m5 x1d h26 y7a6 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>memory<span class="_ _13"> </span>hierarchies<span class="_"> </span>of<span class="_ _13"> </span>early<span class="_ _13"> </span>computer<span class="_"> </span>systems<span class="_ _13"> </span>consisted<span class="_"> </span>of<span class="_ _13"> </span>only<span class="_ _13"> </span>three<span class="_"> </span>levels:</div><div class="t m5 x1d h26 y7a7 ff7 fs19 fc1 sc0 ls0 ws0">CPU<span class="_ _6"> </span>registers<span class="_ _1"></span>,<span class="_ _6"> </span>main<span class="_ _6"> </span>memory<span class="_ _3"></span>,<span class="_ _13"> </span>and<span class="_ _a"> </span>disk<span class="_ _6"> </span>storage.<span class="_ _a"> </span>However,<span class="_ _6"> </span>because<span class="_ _6"> </span>of<span class="_ _6"> </span>the<span class="_ _6"> </span>increasing</div><div class="t m5 x1d h26 y7a8 ff7 fs19 fc1 sc0 ls0 ws0">gap<span class="_"> </span>between<span class="_ _11"> </span>CPU<span class="_"> </span>and<span class="_ _11"> </span>main<span class="_"> </span>memory<span class="_ _3"></span>,<span class="_ _11"> </span>system<span class="_"> </span>designers<span class="_ _11"> </span>were<span class="_ _11"> </span>compelled<span class="_"> </span>to<span class="_ _11"> </span>insert</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
