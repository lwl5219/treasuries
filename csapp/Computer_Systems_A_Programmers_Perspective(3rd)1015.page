<div id="pf3f7" class="pf w2 h11" data-page-no="3f7"><div class="pc pc3f7 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg3f7.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">1014<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>12<span class="_ _3d"> </span>Concurrent<span class="_ _10"> </span>Programming</span></div><div class="t m5 x1d h26 y9c ff7 fs19 fc2 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _15"> </span><span class="ffd ls0">select<span class="_ _14"> </span><span class="ff7">function<span class="_ _14"> </span>manipulates<span class="_ _14"> </span>sets<span class="_ _14"> </span>of<span class="_ _14"> </span>type<span class="_ _14"> </span></span>fd_set<span class="ff7">,<span class="_ _15"> </span>which<span class="_ _14"> </span>are<span class="_ _14"> </span>known<span class="_ _14"> </span>as<span class="_ _14"> </span><span class="ffa">de-</span></span></span></div><div class="t m5 x1d h26 y409 ffa fs19 fc2 sc0 ls0 ws0">scriptor<span class="_ _11"> </span>sets<span class="ff7">.<span class="_ _11"> </span>Logically<span class="_ _3"></span>,<span class="_ _11"> </span>we<span class="_ _11"> </span>think<span class="_ _11"> </span>of<span class="_ _11"> </span>a<span class="_ _11"> </span>descriptor<span class="_ _11"> </span>set<span class="_ _11"> </span>as<span class="_ _11"> </span>a<span class="_ _11"> </span>bit<span class="_ _11"> </span>vector<span class="_ _11"> </span>(introduced<span class="_ _11"> </span>in</span></div><div class="t m5 x1d h26 y40a ff7 fs19 fc2 sc0 ls0 ws0">Section<span class="_"> </span>2.1)<span class="_"> </span>of<span class="_"> </span>size<span class="_"> </span><span class="ff11">n</span>:</div><div class="t m5 x16 h45 y7f55 ff11 fs19 fc2 sc0 ls0 ws0">b</div><div class="t m5 x17c h4b y7f56 ff11 fs25 fc2 sc0 ls0 ws0">n<span class="ff12">−<span class="ff7">1</span></span></div><div class="t m5 x99 h45 y7f57 ff11 fs19 fc2 sc0 ls42 ws0">,...,b</div><div class="t m5 x1c2 h3c y7f56 ff7 fs25 fc2 sc0 ls0 ws0">1</div><div class="t m5 x205 h45 y7f57 ff11 fs19 fc2 sc0 ls42 ws0">,b</div><div class="t m5 xb0 h3c y7f56 ff7 fs25 fc2 sc0 ls0 ws0">0</div><div class="t m5 x1d h26 y7f58 ff7 fs19 fc2 sc0 ls0 ws0">Each<span class="_ _13"> </span>bit<span class="_ _6"> </span><span class="ff11">b</span></div><div class="t m5 x66 h50 y7f59 ff11 fs25 fc2 sc0 ls0 ws0">k</div><div class="t m5 xe0 h26 y7f58 ff7 fs19 fc2 sc0 ls0 ws0">corresponds<span class="_ _13"> </span>to<span class="_ _6"> </span>descriptor<span class="_ _13"> </span><span class="ff11">k<span class="_ _2"></span></span>.<span class="_ _13"> </span>Descriptor<span class="_ _6"> </span><span class="ff11">k<span class="_ _10"> </span></span>is<span class="_ _13"> </span>a<span class="_ _6"> </span>member<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _6"> </span>descriptor</div><div class="t m5 x1d h26 y7f5a ff7 fs19 fc2 sc0 ls0 ws0">set<span class="_ _11"> </span>if<span class="_ _16"> </span>and<span class="_ _11"> </span>only<span class="_ _11"> </span>if<span class="_ _16"> </span><span class="ff11">b</span></div><div class="t m5 x79 h50 y7f5b ff11 fs25 fc2 sc0 ls0 ws0">k</div><div class="t m5 x5d h46 y7f5c ff12 fs19 fc2 sc0 ls0 ws0">=<span class="_ _10"> </span><span class="ff7">1<span class="_ _3"></span>.<span class="_ _16"> </span>Y<span class="_ _3"></span>ou<span class="_ _11"> </span>are<span class="_ _11"> </span>only<span class="_ _16"> </span>allowed<span class="_ _11"> </span>to<span class="_ _16"> </span>do<span class="_ _11"> </span>three<span class="_ _11"> </span>things<span class="_ _16"> </span>with<span class="_ _11"> </span>descriptor</span></div><div class="t m5 x1d h26 y7f5d ff7 fs19 fc2 sc0 ls0 ws0">sets:<span class="_ _14"> </span>(1)<span class="_ _15"> </span>allocate<span class="_ _14"> </span>them,<span class="_ _15"> </span>(2)<span class="_ _15"> </span>assign<span class="_ _14"> </span>one<span class="_ _15"> </span>variable<span class="_ _14"> </span>of<span class="_ _15"> </span>this<span class="_ _14"> </span>type<span class="_ _14"> </span>to<span class="_ _15"> </span>another,<span class="_ _15"> </span>and<span class="_ _14"> </span>(3)</div><div class="t m5 x1d h26 y7f5e ff7 fs19 fc2 sc0 ls0 ws0">modify<span class="_ _15"> </span>and<span class="_ _21"> </span>inspect<span class="_ _21"> </span>them<span class="_ _21"> </span>using<span class="_ _21"> </span>the<span class="_ _21"> </span>FD_ZERO<span class="_ _3"></span>,<span class="_ _f"> </span>FD_SET<span class="_ _3"></span>,<span class="_ _f"> </span>FD_CLR,<span class="_ _f"> </span>and<span class="_ _21"> </span>FD_</div><div class="t m5 x1d h26 y7f5f ff7 fs19 fc2 sc0 ls0 ws0">ISSET<span class="_"> </span>macros<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y7f60 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _f"> </span>our<span class="_ _f"> </span>purposes<span class="_ _0"></span>,<span class="_ _e"> </span>the<span class="_ _f"> </span><span class="ffd">select<span class="_ _e"> </span></span>function<span class="_ _21"> </span>takes<span class="_ _e"> </span>two<span class="_ _21"> </span>inputs:<span class="_ _f"> </span>a<span class="_ _e"> </span>descriptor<span class="_ _21"> </span>set</div><div class="t m5 x1d h26 y7f61 ff7 fs19 fc2 sc0 ls0 ws0">(<span class="ffd">fdset</span>)<span class="_ _16"> </span>called<span class="_ _14"> </span>the<span class="_ _16"> </span><span class="ffa">read<span class="_ _14"> </span>set<span class="_ _2"></span></span>,<span class="_ _14"> </span>and<span class="_ _14"> </span>the<span class="_ _16"> </span>cardinality<span class="_ _16"> </span>(<span class="ffd">n</span>)<span class="_ _14"> </span>of<span class="_ _16"> </span>the<span class="_ _14"> </span>read<span class="_ _16"> </span>set<span class="_ _14"> </span>(actually<span class="_ _16"> </span>the</div><div class="t m5 x1d h26 y7f62 ff7 fs19 fc2 sc0 ls0 ws0">maximum<span class="_ _11"> </span>cardinality<span class="_ _11"> </span>of<span class="_ _11"> </span>any<span class="_ _11"> </span>descriptor<span class="_ _16"> </span>set).<span class="_"> </span>The<span class="_"> </span><span class="ffd">select<span class="_ _11"> </span></span>function<span class="_ _11"> </span>blocks<span class="_ _16"> </span>until<span class="_"> </span>at</div><div class="t m5 x1d h26 y7f63 ff7 fs19 fc2 sc0 ls0 ws0">least<span class="_ _16"> </span>one<span class="_ _16"> </span>descriptor<span class="_ _16"> </span>in<span class="_ _16"> </span>the<span class="_ _16"> </span>read<span class="_ _16"> </span>set<span class="_ _16"> </span>is<span class="_ _16"> </span>ready<span class="_ _16"> </span>for<span class="_ _16"> </span>reading.<span class="_ _11"> </span>A<span class="_ _16"> </span>descriptor<span class="_ _16"> </span><span class="ff11">k<span class="_ _15"> </span></span>is<span class="_ _16"> </span><span class="ffa">ready</span></div><div class="t m5 x1d h26 y7f64 ffa fs19 fc2 sc0 ls0 ws0">for<span class="_"> </span>reading<span class="_ _16"> </span><span class="ff7">if<span class="_"> </span>and<span class="_ _11"> </span>only<span class="_"> </span>if<span class="_ _11"> </span>a<span class="_ _11"> </span>request<span class="_"> </span>to<span class="_ _11"> </span>read<span class="_"> </span>1<span class="_ _11"> </span>byte<span class="_ _11"> </span>from<span class="_"> </span>that<span class="_ _11"> </span>descriptor<span class="_"> </span>would<span class="_ _11"> </span>not</span></div><div class="t m5 x1d h26 y7f65 ff7 fs19 fc2 sc0 ls0 ws0">block.<span class="_ _13"> </span>As<span class="_ _13"> </span>a<span class="_ _13"> </span>side<span class="_ _13"> </span>effect,<span class="_ _13"> </span><span class="ffd">select<span class="_ _13"> </span></span>modiﬁes<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ffd">fd_set<span class="_ _13"> </span></span>pointed<span class="_ _13"> </span>to<span class="_ _13"> </span>by<span class="_ _13"> </span>argument<span class="_ _13"> </span><span class="ffd">fdset</span></div><div class="t m5 x1d h26 y7f66 ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_ _13"> </span>indicate<span class="_ _6"> </span>a<span class="_ _13"> </span>subset<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>read<span class="_ _6"> </span>set<span class="_ _13"> </span>called<span class="_ _6"> </span>the<span class="_ _13"> </span><span class="ffa">ready<span class="_ _13"> </span>set<span class="_ _2"></span></span>,<span class="_ _13"> </span>consisting<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _6"> </span>descriptors</div><div class="t m5 x1d h26 y7f67 ff7 fs19 fc2 sc0 ls0 ws0">in<span class="_ _15"> </span>the<span class="_ _14"> </span>read<span class="_ _15"> </span>set<span class="_ _15"> </span>that<span class="_ _15"> </span>are<span class="_ _15"> </span>ready<span class="_ _15"> </span>for<span class="_ _15"> </span>reading.<span class="_ _14"> </span>The<span class="_ _14"> </span>value<span class="_ _15"> </span>returned<span class="_ _15"> </span>by<span class="_ _15"> </span>the<span class="_ _15"> </span>function</div><div class="t m5 x1d h26 y7f68 ff7 fs19 fc2 sc0 ls0 ws0">indicates<span class="_"> </span>the<span class="_"> </span>cardinality<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>ready<span class="_"> </span>set.<span class="_"> </span>Note<span class="_"> </span>that<span class="_"> </span>because<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>side<span class="_"> </span>effect,<span class="_"> </span>we</div><div class="t m5 x1d h26 y7f69 ff7 fs19 fc2 sc0 ls0 ws0">must<span class="_"> </span>update<span class="_"> </span>the<span class="_"> </span>read<span class="_"> </span>set<span class="_"> </span>every<span class="_"> </span>time<span class="_"> </span><span class="ffd">select<span class="_ _10"> </span></span>is<span class="_"> </span>called.</div><div class="t m5 x29 h26 y7f6a ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _13"> </span>best<span class="_ _13"> </span>way<span class="_ _6"> </span>to<span class="_ _13"> </span>understand<span class="_ _6"> </span><span class="ffd">select<span class="_ _13"> </span></span>is<span class="_ _13"> </span>to<span class="_ _6"> </span>study<span class="_ _13"> </span>a<span class="_ _6"> </span>concrete<span class="_ _13"> </span>example<span class="_ _1"></span>.<span class="_ _13"> </span>F<span class="_ _0"></span>igure<span class="_ _13"> </span>12.6</div><div class="t m5 x1d h26 y7f6b ff7 fs19 fc2 sc0 ls0 ws0">shows<span class="_ _11"> </span>how<span class="_ _11"> </span>we<span class="_ _11"> </span>might<span class="_ _11"> </span>use<span class="_ _11"> </span><span class="ffd">select<span class="_ _11"> </span></span>to<span class="_ _16"> </span>implement<span class="_"> </span>an<span class="_ _11"> </span>iterative<span class="_ _16"> </span>echo<span class="_"> </span>server<span class="_ _11"> </span>that<span class="_ _16"> </span>also</div><div class="t m5 x1d h26 y7f6c ff7 fs19 fc2 sc0 ls0 ws0">accepts<span class="_ _f"> </span>user<span class="_ _f"> </span>commands<span class="_ _f"> </span>on<span class="_ _f"> </span>the<span class="_ _f"> </span>standard<span class="_ _e"> </span>input.<span class="_ _21"> </span>W<span class="_ _3"></span>e<span class="_ _e"> </span>begin<span class="_ _21"> </span>by<span class="_ _f"> </span>using<span class="_ _f"> </span>the<span class="_ _f"> </span><span class="ffd">open_</span></div><div class="t m5 x1d h26 y7f6d ffd fs19 fc2 sc0 ls0 ws0">listenfd<span class="_ _10"> </span><span class="ff7">function<span class="_"> </span>from<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>11.19<span class="_"> </span>to<span class="_"> </span>open<span class="_"> </span>a<span class="_"> </span>listening<span class="_"> </span>descriptor<span class="_"> </span>(line<span class="_"> </span>16),<span class="_"> </span>and</span></div><div class="t m5 x1d h26 y7f6e ff7 fs19 fc2 sc0 ls0 ws0">then<span class="_"> </span>using<span class="_"> </span>FD_ZERO<span class="_"> </span>to<span class="_"> </span>create<span class="_"> </span>an<span class="_"> </span>empty<span class="_"> </span>read<span class="_"> </span>set<span class="_"> </span>(line<span class="_"> </span>18):</div><div class="t m5 x129 h40 y7f6f ffe7 fs28 fc1 sc0 ls0 ws0">listenfd<span class="_ _11b"> </span>stdin</div><div class="t m5 x1d h40 y7f70 ffe7 fs28 fc1 sc0 ls0 ws0">read_set</div><div class="t m5 xcd h3f y7f71 ffe8 fs27 fc1 sc0 ls0 ws0"> (<span class="ffe9">∅</span>)<span class="ffe7">:<span class="_ _5e"> </span></span>0</div><div class="t m5 x1a6 h3f y7f72 ffe8 fs27 fc1 sc0 ls0 ws0">3</div><div class="t m5 x9b h3f y7f71 ffe8 fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 x9b h3f y7f72 ffe8 fs27 fc1 sc0 ls0 ws0">2</div><div class="t m5 xd4 h3f y7f71 ffe8 fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 xd4 h3f y7f72 ffe8 fs27 fc1 sc0 ls0 ws0">1</div><div class="t m5 x82 h3f y7f71 ffe8 fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 x82 h3f y7f72 ffe8 fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 x1d h26 y7f73 ff7 fs19 fc2 sc0 ls0 ws0">Next,<span class="_"> </span>in<span class="_ _13"> </span>lines<span class="_ _13"> </span>19<span class="_"> </span>and<span class="_ _13"> </span>20,<span class="_"> </span>we<span class="_ _13"> </span>deﬁne<span class="_ _13"> </span>the<span class="_"> </span>read<span class="_ _13"> </span>set<span class="_ _13"> </span>to<span class="_"> </span>consist<span class="_ _13"> </span>of<span class="_"> </span>descriptor<span class="_ _13"> </span>0<span class="_ _13"> </span>(standard</div><div class="t m5 x1d h26 y7f74 ff7 fs19 fc2 sc0 ls0 ws0">input)<span class="_"> </span>and<span class="_"> </span>descriptor<span class="_"> </span>3<span class="_"> </span>(the<span class="_"> </span>listening<span class="_"> </span>descriptor),<span class="_"> </span>respectively:</div><div class="t m5 x150 h40 y7f75 ffe7 fs28 fc1 sc0 ls0 ws0">listenfd<span class="_ _11b"> </span>stdin</div><div class="t m5 x1d h40 y7f76 ffe7 fs28 fc1 sc0 ls0 ws0">read_set</div><div class="t m5 xcd h3f y7f77 ffe8 fs27 fc1 sc0 ls0 ws0"> ({0,<span class="_ _5"></span>3})<span class="ffe7">:<span class="_ _5e"> </span></span>1</div><div class="t m5 x183 h3f y7f78 ffe8 fs27 fc1 sc0 ls0 ws0">3</div><div class="t m5 xa0 h3f y7f77 ffe8 fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 xa0 h3f y7f78 ffe8 fs27 fc1 sc0 ls0 ws0">2</div><div class="t m5 xd2 h3f y7f77 ffe8 fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 xd2 h3f y7f78 ffe8 fs27 fc1 sc0 ls0 ws0">1</div><div class="t m5 x51 h3f y7f77 ffe8 fs27 fc1 sc0 ls0 ws0">1</div><div class="t m5 x51 h3f y7f78 ffe8 fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 x29 h26 y24e1 ff7 fs19 fc2 sc0 ls0 ws0">At<span class="_ _16"> </span>this<span class="_ _16"> </span>point,<span class="_ _14"> </span>we<span class="_ _16"> </span>begin<span class="_ _16"> </span>the<span class="_ _16"> </span>typical<span class="_ _16"> </span>server<span class="_ _16"> </span>loop<span class="_ _0"></span>.<span class="_ _16"> </span>But<span class="_ _16"> </span>instead<span class="_ _16"> </span>of<span class="_ _16"> </span>waiting<span class="_ _16"> </span>for<span class="_ _16"> </span>a</div><div class="t m5 x1d h26 y4657 ff7 fs19 fc2 sc0 ls0 ws0">connection<span class="_ _16"> </span>request<span class="_ _11"> </span>by<span class="_ _16"> </span>calling<span class="_ _16"> </span>the<span class="_ _16"> </span><span class="ffd">accept<span class="_ _16"> </span></span>function,<span class="_ _16"> </span>we<span class="_ _11"> </span>call<span class="_ _16"> </span>the<span class="_ _16"> </span><span class="ffd">select<span class="_ _16"> </span></span>function,</div><div class="t m5 x1d h26 y4658 ff7 fs19 fc2 sc0 ls0 ws0">which<span class="_ _16"> </span>blocks<span class="_ _14"> </span>until<span class="_ _14"> </span>either<span class="_ _14"> </span>the<span class="_ _14"> </span>listening<span class="_ _16"> </span>descriptor<span class="_ _14"> </span>or<span class="_ _14"> </span>standard<span class="_ _14"> </span>input<span class="_ _14"> </span>is<span class="_ _16"> </span>ready<span class="_ _14"> </span>for</div><div class="t m5 x1d h26 y4659 ff7 fs19 fc2 sc0 ls0 ws0">reading<span class="_"> </span>(line<span class="_ _13"> </span>24).<span class="_"> </span>F<span class="_ _3"></span>or<span class="_"> </span>example<span class="_ _0"></span>,<span class="_"> </span>here<span class="_ _13"> </span>is<span class="_"> </span>the<span class="_"> </span>value<span class="_ _13"> </span>of<span class="_"> </span><span class="ffd">ready_set<span class="_ _13"> </span></span>that<span class="_"> </span><span class="ffd">select<span class="_ _10"> </span></span>would</div><div class="t m5 x1d h26 y465a ff7 fs19 fc2 sc0 ls0 ws0">return<span class="_ _11"> </span>if<span class="_ _11"> </span>the<span class="_ _11"> </span>user<span class="_ _11"> </span>hit<span class="_ _11"> </span>the<span class="_ _11"> </span>enter<span class="_ _11"> </span>key<span class="_ _3"></span>,<span class="_ _11"> </span>thus<span class="_ _16"> </span>causing<span class="_"> </span>the<span class="_ _11"> </span>standard<span class="_ _11"> </span>input<span class="_ _11"> </span>descriptor<span class="_ _16"> </span>to</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
