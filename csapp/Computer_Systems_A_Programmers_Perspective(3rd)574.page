<div id="pf23e" class="pf w2 h11" data-page-no="23e"><div class="pc pc23e w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg23e.png"/><div class="t m5 x93 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>5.9<span class="_ _60"> </span>Enhancing<span class="_ _10"> </span>Parallelism<span class="_ _3e"> </span><span class="ffe fs1e">573</span></div><div class="t m5 x2c h2d y4a2c ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2 ls33">/<span class="_ _41"></span>*2x2<span class="ls0">loop<span class="_ _1f"> </span>unrolling<span class="_ _e"> </span>*/</span></span></div><div class="t m5 x2c h2d y4a2d ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">void<span class="_ _1f"> </span>combine6(vec_ptr<span class="_ _e"> </span>v,<span class="_ _1f"> </span>data_t<span class="_ _1f"> </span>*dest)</span></div><div class="t m5 x2c h2d y4a2e ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x2c h2d y4a30 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>i;</span></div><div class="t m5 x2c h2d y4aaa ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _20"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>length<span class="_ _1f"> </span>=<span class="_ _1f"> </span>vec_length(v);</span></div><div class="t m5 x2c h2d y4aac ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _20"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>limit<span class="_ _1f"> </span>=<span class="_ _1f"> </span>length-1;</span></div><div class="t m5 x2c h2d y4a33 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _20"> </span><span class="ffd fs1e fc2">data_t<span class="_ _e"> </span>*data<span class="_ _1f"> </span>=<span class="_ _1f"> </span>get_vec_start(v);</span></div><div class="t m5 x2c h2d y4a34 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _20"> </span><span class="ffd fs1e fc2">data_t<span class="_ _e"> </span>acc0<span class="_ _1f"> </span>=<span class="_ _1f"> </span>IDENT;</span></div><div class="t m5 x2c h2d y4aad ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _20"> </span><span class="ffd fs1e fc2">data_t<span class="_ _e"> </span>acc1<span class="_ _1f"> </span>=<span class="_ _1f"> </span>IDENT;</span></div><div class="t m5 x17 h2e y4a37 ff6 fs20 fc6 sc0 ls0 ws0">10</div><div class="t m5 x17 h2e y4dc9 ff6 fs20 fc6 sc0 ls0 ws0">11</div><div class="t m5 x142 h2d y4a38 ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Combine<span class="_ _1f"> </span>2<span class="_ _1f"> </span>elements<span class="_ _e"> </span>at<span class="_ _1f"> </span>a<span class="_ _e"> </span>time<span class="_ _1f"> </span>*/</div><div class="t m5 x17 h2d y4a39 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _20"> </span><span class="ffd fs1e fc2">for<span class="_ _e"> </span>(i<span class="_ _1f"> </span>=<span class="_ _1f"> </span>0;<span class="_ _e"> </span>i<span class="_ _1f"> </span>&lt;<span class="_ _e"> </span>limit;<span class="_ _1f"> </span>i+=2)<span class="_ _1f"> </span>{</span></div><div class="t m5 x17 h2d y4a3a ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _70"> </span><span class="ffd fs1e fc2">acc0<span class="_ _e"> </span>=<span class="_ _1f"> </span>acc0<span class="_ _1f"> </span>OP<span class="_ _e"> </span>data[i];</span></div><div class="t m5 x17 h2d y4a3b ff6 fs20 fc6 sc0 ls0 ws0">14<span class="_ _70"> </span><span class="ffd fs1e fc2">acc1<span class="_ _e"> </span>=<span class="_ _1f"> </span>acc1<span class="_ _1f"> </span>OP<span class="_ _e"> </span>data[i+1];</span></div><div class="t m5 x17 h2d y4a3c ff6 fs20 fc6 sc0 ls0 ws0">15<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x17 h2e y4a3d ff6 fs20 fc6 sc0 ls0 ws0">16</div><div class="t m5 x17 h2e y4dca ff6 fs20 fc6 sc0 ls0 ws0">17</div><div class="t m5 x142 h2d y4a3e ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Finish<span class="_ _1f"> </span>any<span class="_ _1f"> </span>remaining<span class="_ _e"> </span>elements<span class="_ _1f"> </span>*/</div><div class="t m5 x17 h2d y4a3f ff6 fs20 fc6 sc0 ls0 ws0">18<span class="_ _20"> </span><span class="ffd fs1e fc2">for<span class="_ _e"> </span>(;<span class="_ _1f"> </span>i<span class="_ _1f"> </span>&lt;<span class="_ _e"> </span>length;<span class="_ _1f"> </span>i++)<span class="_ _e"> </span>{</span></div><div class="t m5 x17 h2d y4a40 ff6 fs20 fc6 sc0 ls0 ws0">19<span class="_ _70"> </span><span class="ffd fs1e fc2">acc0<span class="_ _e"> </span>=<span class="_ _1f"> </span>acc0<span class="_ _1f"> </span>OP<span class="_ _e"> </span>data[i];</span></div><div class="t m5 x17 h2d y4a41 ff6 fs20 fc6 sc0 ls0 ws0">20<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x17 h2d y4a42 ff6 fs20 fc6 sc0 ls0 ws0">21<span class="_ _20"> </span><span class="ffd fs1e fc2">*dest<span class="_ _e"> </span>=<span class="_ _1f"> </span>acc0<span class="_ _1f"> </span>OP<span class="_ _e"> </span>acc1;</span></div><div class="t m5 x17 h2d y4a43 ff6 fs20 fc6 sc0 ls0 ws0">22<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x17 h35 y4a44 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _16"> </span>5.21<span class="_ _c"> </span><span class="fc1">Applying<span class="_ _16"> </span><span class="ff7">2<span class="_"> </span><span class="ff12">×<span class="_ _13"> </span></span>2<span class="_ _14"> </span></span>loop<span class="_ _16"> </span>unrolling.<span class="_ _14"> </span><span class="ff6">By<span class="_ _16"> </span>maintaining<span class="_ _14"> </span>multiple<span class="_ _16"> </span>accumulators,</span></span></div><div class="t m5 x17 h34 y4a45 ff6 fs16 fc1 sc0 ls0 ws0">this<span class="_ _11"> </span>approach<span class="_ _11"> </span>can<span class="_ _11"> </span>make<span class="_ _11"> </span>better<span class="_ _16"> </span>use<span class="_ _10"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span>multiple<span class="_ _11"> </span>functional<span class="_ _11"> </span>units<span class="_ _11"> </span>and<span class="_ _11"> </span>their<span class="_ _11"> </span>pipelining</div><div class="t m5 x17 h34 y4dcb ff6 fs16 fc1 sc0 ls0 ws0">capabilities.</div><div class="t m5 x208 h31 y4dcc ff7 fs21 fc2 sc0 ls0 ws0">Integer<span class="_ _88"> </span>Floating<span class="_"> </span>point</div><div class="t m5 x17 h31 y4dcd ff7 fs21 fc2 sc0 ls0 ws0">Function<span class="_ _7b"> </span>Page<span class="_ _103"> </span>Method<span class="_ _1a3"> </span><span class="ffd fs1e ls213">+*+*</span></div><div class="t m5 x17 h31 y4dce ffd fs1e fc2 sc0 ls0 ws0">combine4<span class="_ _f1"> </span><span class="ff7 fs21">551<span class="_ _95"> </span>Accumulate<span class="_"> </span>in<span class="_"> </span>temporary<span class="_ _85"> </span>1.27<span class="_ _3a"> </span>3.01<span class="_ _3a"> </span>3.01<span class="_ _4c"> </span>5.01</span></div><div class="t m5 x17 h32 y4dcf ffd fs1e fc2 sc0 ls0 ws0">combine5<span class="_ _f1"> </span><span class="ff7 fs21">568<span class="_ _95"> </span>2<span class="_"> </span><span class="ff12">×<span class="_ _13"> </span></span>1<span class="_ _13"> </span>unrolling<span class="_ _9d"> </span>1.01<span class="_ _4c"> </span>3.01<span class="_ _3a"> </span>3.01<span class="_ _3a"> </span>5.01</span></div><div class="t m5 x17 h32 y4dd0 ffd fs1e fc2 sc0 ls0 ws0">combine6<span class="_ _f1"> </span><span class="ff7 fs21">573<span class="_ _95"> </span>2<span class="_"> </span><span class="ff12">×<span class="_ _13"> </span></span>2<span class="_"> </span>unrolling<span class="_ _da"> </span>0.81<span class="_ _4c"> </span>1.51<span class="_ _3a"> </span>1.51<span class="_ _3a"> </span>2.51</span></div><div class="t m5 x17 h31 y4dd1 ff7 fs21 fc2 sc0 ls0 ws0">Latency<span class="_"> </span>bound<span class="_ _1ab"> </span>1.00<span class="_ _3a"> </span>3.00<span class="_ _4c"> </span>3.00<span class="_ _3a"> </span>5.00</div><div class="t m5 x17 h31 y4dd2 ff7 fs21 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>hroughput<span class="_"> </span>bound<span class="_ _1dd"> </span>0.50<span class="_ _4c"> </span>1.00<span class="_ _3a"> </span>1.00<span class="_ _3a"> </span>0.50</div><div class="t m5 x26 h26 yec2 ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _15"> </span>see<span class="_ _14"> </span>that<span class="_ _15"> </span>we<span class="_ _14"> </span>have<span class="_ _15"> </span>improved<span class="_ _15"> </span>the<span class="_ _14"> </span>performance<span class="_ _15"> </span>for<span class="_ _14"> </span>all<span class="_ _15"> </span>cases<span class="_ _1"></span>,<span class="_ _21"> </span>with<span class="_ _14"> </span>integer</div><div class="t m5 x17 h26 yec3 ff7 fs19 fc2 sc0 ls0 ws0">product,<span class="_ _14"> </span>ﬂoating-point<span class="_ _16"> </span>addition,<span class="_ _14"> </span>and<span class="_ _14"> </span>ﬂoating-point<span class="_ _16"> </span>multiplication<span class="_ _14"> </span>improving<span class="_ _16"> </span>by</div><div class="t m5 x17 h26 yec4 ff7 fs19 fc2 sc0 ls0 ws0">a<span class="_ _15"> </span>factor<span class="_ _21"> </span>of<span class="_ _21"> </span>around<span class="_ _15"> </span>2,<span class="_ _f"> </span>and<span class="_ _21"> </span>integer<span class="_ _21"> </span>addition<span class="_ _15"> </span>improving<span class="_ _21"> </span>somewhat<span class="_ _21"> </span>as<span class="_ _21"> </span>well.<span class="_ _15"> </span>Most</div><div class="t m5 x17 h26 yec5 ff7 fs19 fc2 sc0 ls0 ws0">signiﬁcantly<span class="_ _3"></span>,<span class="_"> </span>we<span class="_ _11"> </span>have<span class="_ _11"> </span>broken<span class="_ _11"> </span>through<span class="_ _11"> </span>the<span class="_ _11"> </span>barrier<span class="_ _11"> </span>imposed<span class="_ _11"> </span>by<span class="_"> </span>the<span class="_ _11"> </span>latency<span class="_"> </span>bound.</div><div class="t m5 x17 h26 yec6 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>processor<span class="_ _13"> </span>no<span class="_"> </span>longer<span class="_ _13"> </span>needs<span class="_"> </span>to<span class="_ _13"> </span>delay<span class="_"> </span>the<span class="_"> </span>start<span class="_ _13"> </span>of<span class="_"> </span>one<span class="_ _13"> </span>sum<span class="_"> </span>or<span class="_ _13"> </span>product<span class="_"> </span>operation</div><div class="t m5 x17 h26 yec7 ff7 fs19 fc2 sc0 ls0 ws0">until<span class="_"> </span>the<span class="_"> </span>previous<span class="_"> </span>one<span class="_"> </span>has<span class="_"> </span>completed.</div><div class="t m5 x26 h26 yec8 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_ _f"> </span>understand<span class="_ _21"> </span>the<span class="_ _f"> </span>performance<span class="_ _f"> </span>of<span class="_ _21"> </span><span class="ffd">combine6</span>,<span class="_ _e"> </span>we<span class="_ _21"> </span>start<span class="_ _21"> </span>with<span class="_ _f"> </span>the<span class="_ _21"> </span>code<span class="_ _f"> </span>and</div><div class="t m5 x17 h26 yec9 ff7 fs19 fc2 sc0 ls0 ws0">operation<span class="_"> </span>sequence<span class="_ _11"> </span>shown<span class="_ _11"> </span>in<span class="_ _11"> </span>F<span class="_ _1"></span>igure<span class="_ _11"> </span>5.22.<span class="_ _11"> </span>W<span class="_ _3"></span>e<span class="_ _11"> </span>can<span class="_ _11"> </span>derive<span class="_ _11"> </span>a<span class="_"> </span>template<span class="_ _11"> </span>showing<span class="_ _11"> </span>the</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
