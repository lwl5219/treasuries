<div id="pf51" class="pf w2 h11" data-page-no="51"><div class="pc pc51 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg51.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">80<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>2<span class="_ _3d"> </span>Representing<span class="_ _10"> </span>and<span class="_ _10"> </span>Manipulating<span class="_ _10"> </span>Information</span></div><div class="t m5 x1d h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">binary<span class="_ _15"> </span>data<span class="_ _15"> </span>are<span class="_ _15"> </span>communicated<span class="_ _15"> </span>over<span class="_ _15"> </span>a<span class="_ _15"> </span>network<span class="_ _15"> </span>between<span class="_ _15"> </span>different<span class="_ _15"> </span>machines<span class="_ _1"></span>.<span class="_ _15"> </span>A</div><div class="t m5 x1d h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">common<span class="_ _16"> </span>problem<span class="_ _14"> </span>is<span class="_ _16"> </span>for<span class="_ _14"> </span>data<span class="_ _16"> </span>produced<span class="_ _14"> </span>by<span class="_ _16"> </span>a<span class="_ _14"> </span>little-endian<span class="_ _16"> </span>machine<span class="_ _14"> </span>to<span class="_ _16"> </span>be<span class="_ _14"> </span>sent<span class="_ _16"> </span>to</div><div class="t m5 x1d h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">a<span class="_ _11"> </span>big-endian<span class="_ _16"> </span>machine<span class="_ _1"></span>,<span class="_ _16"> </span>or<span class="_ _11"> </span>vice<span class="_ _11"> </span>versa,<span class="_ _16"> </span>leading<span class="_ _11"> </span>to<span class="_ _11"> </span>the<span class="_ _16"> </span>bytes<span class="_ _11"> </span>within<span class="_ _11"> </span>the<span class="_ _16"> </span>words<span class="_ _11"> </span>being</div><div class="t m5 x1d h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">in<span class="_"> </span>reverse<span class="_"> </span>order<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>receiving<span class="_ _13"> </span>program.<span class="_"> </span>T<span class="_ _3"></span>o<span class="_"> </span>avoid<span class="_"> </span>such<span class="_"> </span>problems<span class="_ _3"></span>,<span class="_"> </span>code<span class="_"> </span>written</div><div class="t m5 x1d h26 y2f8 ff7 fs19 fc2 sc0 ls0 ws0">for<span class="_ _11"> </span>networking<span class="_ _16"> </span>applications<span class="_ _11"> </span>must<span class="_ _11"> </span>follow<span class="_ _16"> </span>established<span class="_ _11"> </span>conventions<span class="_ _16"> </span>for<span class="_ _11"> </span>byte<span class="_ _11"> </span>order<span class="_ _0"></span>-</div><div class="t m5 x1d h26 y2f9 ff7 fs19 fc2 sc0 ls0 ws0">ing<span class="_"> </span>to<span class="_ _11"> </span>make<span class="_ _11"> </span>sure<span class="_ _11"> </span>the<span class="_ _11"> </span>sending<span class="_ _11"> </span>machine<span class="_ _11"> </span>converts<span class="_ _11"> </span>its<span class="_ _11"> </span>internal<span class="_ _11"> </span>representation<span class="_ _11"> </span>to<span class="_"> </span>the</div><div class="t m5 x1d h26 y2fa ff7 fs19 fc2 sc0 ls0 ws0">network<span class="_"> </span>standard,<span class="_"> </span>while<span class="_"> </span>the<span class="_"> </span>receiving<span class="_"> </span>machine<span class="_"> </span>converts<span class="_"> </span>the<span class="_"> </span>network<span class="_"> </span>standard<span class="_"> </span>to</div><div class="t m5 x1d h26 y2fb ff7 fs19 fc2 sc0 ls0 ws0">its<span class="_ _16"> </span>internal<span class="_ _14"> </span>representation.<span class="_ _16"> </span>W<span class="_ _3"></span>e<span class="_ _14"> </span>will<span class="_ _16"> </span>see<span class="_ _14"> </span>examples<span class="_ _16"> </span>of<span class="_ _14"> </span>these<span class="_ _16"> </span>conversions<span class="_ _14"> </span>in<span class="_ _16"> </span>Chap-</div><div class="t m5 x1d h26 y2fc ff7 fs19 fc2 sc0 ls0 ws0">ter<span class="_"> </span>11.</div><div class="t m5 x29 h26 y2fd ff7 fs19 fc2 sc0 ls0 ws0">A<span class="_ _14"> </span>second<span class="_ _14"> </span>case<span class="_ _14"> </span>where<span class="_ _14"> </span>byte<span class="_ _14"> </span>ordering<span class="_ _14"> </span>becomes<span class="_ _14"> </span>important<span class="_ _14"> </span>is<span class="_ _14"> </span>when<span class="_ _14"> </span>looking<span class="_ _14"> </span>at</div><div class="t m5 x1d h26 y2fe ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _11"> </span>byte<span class="_ _11"> </span>sequences<span class="_ _16"> </span>representing<span class="_ _11"> </span>integer<span class="_ _11"> </span>data.<span class="_ _11"> </span>This<span class="_"> </span>occurs<span class="_ _11"> </span>often<span class="_ _16"> </span>when<span class="_ _11"> </span>inspecting</div><div class="t m5 x1d h26 y2ff ff7 fs19 fc2 sc0 ls0 ws0">machine-level<span class="_ _16"> </span>programs<span class="_ _1"></span>.<span class="_ _14"> </span>As<span class="_ _14"> </span>an<span class="_ _14"> </span>example<span class="_ _1"></span>,<span class="_ _15"> </span>the<span class="_ _16"> </span>following<span class="_ _14"> </span>line<span class="_ _14"> </span>occurs<span class="_ _16"> </span>in<span class="_ _14"> </span>a<span class="_ _14"> </span>ﬁle<span class="_ _14"> </span>that</div><div class="t m5 x1d h26 y300 ff7 fs19 fc2 sc0 ls0 ws0">gives<span class="_ _6"> </span>a<span class="_ _13"> </span>text<span class="_ _6"> </span>representation<span class="_ _13"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>machine-level<span class="_ _6"> </span>code<span class="_ _13"> </span>for<span class="_ _6"> </span>an<span class="_ _13"> </span>Intel<span class="_ _6"> </span>x86-64<span class="_ _13"> </span>processor:</div><div class="t m5 x75 h2d y907 ffd fs1e fc2 sc0 ls0 ws0">4004d3:<span class="_ _1a"> </span>01<span class="_ _e"> </span>05<span class="_ _1f"> </span>43<span class="_ _1f"> </span>0b<span class="_ _e"> </span>20<span class="_ _1f"> </span>00<span class="_ _6f"> </span>add<span class="_ _46"> </span>%eax,0x200b43(%rip)</div><div class="t m5 x1d h26 y682 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _11"> </span>line<span class="_ _11"> </span>was<span class="_ _11"> </span>generated<span class="_ _11"> </span>by<span class="_"> </span>a<span class="_ _11"> </span><span class="ffa">disassembler<span class="_ _2"></span></span>,<span class="_ _11"> </span>a<span class="_ _11"> </span>tool<span class="_ _11"> </span>that<span class="_ _11"> </span>determines<span class="_ _11"> </span>the<span class="_"> </span>instruction</div><div class="t m5 x1d h26 y683 ff7 fs19 fc2 sc0 ls0 ws0">sequence<span class="_ _16"> </span>represented<span class="_ _16"> </span>by<span class="_ _14"> </span>an<span class="_ _16"> </span>executable<span class="_ _14"> </span>program<span class="_ _16"> </span>ﬁle.<span class="_ _16"> </span>W<span class="_ _3"></span>e<span class="_ _16"> </span>will<span class="_ _16"> </span>learn<span class="_ _14"> </span>more<span class="_ _16"> </span>about</div><div class="t m5 x1d h26 y684 ff7 fs19 fc2 sc0 ls0 ws0">disassemblers<span class="_ _16"> </span>and<span class="_ _16"> </span>how<span class="_ _16"> </span>to<span class="_ _16"> </span>interpret<span class="_ _16"> </span>lines<span class="_ _16"> </span>such<span class="_ _16"> </span>as<span class="_ _16"> </span>this<span class="_ _16"> </span>in<span class="_ _16"> </span>Chapter<span class="_ _16"> </span>3.<span class="_ _16"> </span>F<span class="_ _1"></span>or<span class="_ _16"> </span>now<span class="_ _3"></span>,<span class="_ _14"> </span>we</div><div class="t m5 x1d h26 y685 ff7 fs19 fc2 sc0 ls0 ws0">simply<span class="_ _11"> </span>note<span class="_ _11"> </span>that<span class="_ _16"> </span>this<span class="_ _11"> </span>line<span class="_ _11"> </span>states<span class="_ _11"> </span>that<span class="_ _16"> </span>the<span class="_ _11"> </span>hexadecimal<span class="_ _11"> </span>byte<span class="_ _11"> </span>sequence<span class="_ _11"> </span><span class="ffd">01<span class="_ _16"> </span>05<span class="_ _16"> </span>43<span class="_ _11"> </span>0b</span></div><div class="t m5 x1d h26 y686 ffd fs19 fc2 sc0 ls0 ws0">20<span class="_ _11"> </span>00<span class="_ _16"> </span><span class="ff7">is<span class="_ _16"> </span>the<span class="_ _11"> </span>byte-level<span class="_ _16"> </span>representation<span class="_ _11"> </span>of<span class="_ _16"> </span>an<span class="_ _16"> </span>instruction<span class="_ _11"> </span>that<span class="_ _16"> </span>adds<span class="_ _11"> </span>a<span class="_ _16"> </span>word<span class="_ _16"> </span>of<span class="_ _11"> </span>data</span></div><div class="t m5 x1d h26 y687 ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_ _16"> </span>the<span class="_ _14"> </span>value<span class="_ _16"> </span>stored<span class="_ _14"> </span>at<span class="_ _16"> </span>an<span class="_ _14"> </span>address<span class="_ _14"> </span>computed<span class="_ _16"> </span>by<span class="_ _14"> </span>adding<span class="_ _16"> </span><span class="ffd">0x200b43<span class="_ _14"> </span></span>to<span class="_ _16"> </span>the<span class="_ _14"> </span>current</div><div class="t m5 x1d h26 y688 ff7 fs19 fc2 sc0 ls0 ws0">value<span class="_"> </span>of<span class="_"> </span>the<span class="_ _11"> </span><span class="ffa">program<span class="_"> </span>counter<span class="_ _2"></span></span>,<span class="_"> </span>the<span class="_ _11"> </span>address<span class="_"> </span>of<span class="_"> </span>the<span class="_ _11"> </span>next<span class="_"> </span>instruction<span class="_"> </span>to<span class="_ _11"> </span>be<span class="_"> </span>executed.</div><div class="t m5 x1d h26 y689 ff7 fs19 fc2 sc0 ls0 ws0">If<span class="_"> </span>we<span class="_ _13"> </span>take<span class="_"> </span>the<span class="_"> </span>ﬁnal<span class="_ _13"> </span>4<span class="_"> </span>bytes<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_"> </span>sequence<span class="_ _13"> </span><span class="ffd">43<span class="_ _16"> </span>0b<span class="_ _11"> </span>20<span class="_ _16"> </span>00<span class="_ _10"> </span></span>and<span class="_"> </span>write<span class="_ _13"> </span>them<span class="_"> </span>in<span class="_ _13"> </span>reverse</div><div class="t m5 x1d h26 y68a ff7 fs19 fc2 sc0 ls0 ws0">order,<span class="_ _13"> </span>we<span class="_ _13"> </span>have<span class="_"> </span><span class="ffd">00<span class="_ _11"> </span>20<span class="_ _16"> </span>0b<span class="_ _11"> </span>43</span>.<span class="_ _13"> </span>Dropping<span class="_"> </span>the<span class="_ _13"> </span>leading<span class="_ _13"> </span>0,<span class="_"> </span>we<span class="_ _13"> </span>have<span class="_ _13"> </span>the<span class="_ _13"> </span>value<span class="_"> </span><span class="ffd">0x200b43</span>,</div><div class="t m5 x1d h26 y68b ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _15"> </span>numeric<span class="_ _21"> </span>value<span class="_ _21"> </span>written<span class="_ _21"> </span>on<span class="_ _21"> </span>the<span class="_ _21"> </span>right.<span class="_ _21"> </span>Having<span class="_ _21"> </span>bytes<span class="_ _21"> </span>appear<span class="_ _15"> </span>in<span class="_ _21"> </span>reverse<span class="_ _21"> </span>order</div><div class="t m5 x1d h26 y68c ff7 fs19 fc2 sc0 ls0 ws0">is<span class="_ _14"> </span>a<span class="_ _15"> </span>common<span class="_ _15"> </span>occurrence<span class="_ _15"> </span>when<span class="_ _15"> </span>reading<span class="_ _15"> </span>machine-level<span class="_ _15"> </span>program<span class="_ _14"> </span>representations</div><div class="t m5 x1d h26 y68d ff7 fs19 fc2 sc0 ls0 ws0">generated<span class="_"> </span>for<span class="_ _11"> </span>little-endian<span class="_ _11"> </span>machines<span class="_ _11"> </span>such<span class="_"> </span>as<span class="_ _11"> </span>this<span class="_ _11"> </span>one<span class="_ _0"></span>.<span class="_"> </span>The<span class="_"> </span>natural<span class="_"> </span>way<span class="_ _11"> </span>to<span class="_ _11"> </span>write<span class="_ _11"> </span>a</div><div class="t m5 x1d h26 y68e ff7 fs19 fc2 sc0 ls0 ws0">byte<span class="_"> </span>sequence<span class="_ _13"> </span>is<span class="_"> </span>to<span class="_"> </span>have<span class="_"> </span>the<span class="_ _13"> </span>lowest-numbered<span class="_"> </span>byte<span class="_"> </span>on<span class="_ _13"> </span>the<span class="_"> </span>left<span class="_"> </span>and<span class="_ _13"> </span>the<span class="_"> </span>highest<span class="_"> </span>on</div><div class="t m5 x1d h26 y68f ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>right,<span class="_"> </span>but<span class="_ _13"> </span>this<span class="_"> </span>is<span class="_"> </span>contrary<span class="_ _13"> </span>to<span class="_"> </span>the<span class="_"> </span>normal<span class="_"> </span>way<span class="_ _13"> </span>of<span class="_"> </span>writing<span class="_"> </span>numbers<span class="_ _13"> </span>with<span class="_"> </span>the<span class="_"> </span>most</div><div class="t m5 x1d h26 y690 ff7 fs19 fc2 sc0 ls0 ws0">signiﬁcant<span class="_"> </span>digit<span class="_"> </span>on<span class="_"> </span>the<span class="_"> </span>left<span class="_"> </span>and<span class="_"> </span>the<span class="_"> </span>least<span class="_"> </span>on<span class="_"> </span>the<span class="_"> </span>right.</div><div class="t m5 x29 h26 y691 ff7 fs19 fc2 sc0 ls0 ws0">A<span class="_ _f"> </span>third<span class="_ _e"> </span>case<span class="_ _f"> </span>where<span class="_ _f"> </span>byte<span class="_ _e"> </span>ordering<span class="_ _f"> </span>becomes<span class="_ _e"> </span>visible<span class="_ _21"> </span>is<span class="_ _e"> </span>when<span class="_ _f"> </span>programs<span class="_ _f"> </span>are</div><div class="t m5 x1d h26 y692 ff7 fs19 fc2 sc0 ls0 ws0">written<span class="_ _16"> </span>that<span class="_ _14"> </span>circumvent<span class="_ _16"> </span>the<span class="_ _16"> </span>normal<span class="_ _14"> </span>type<span class="_ _16"> </span>system.<span class="_ _14"> </span>In<span class="_ _16"> </span>the<span class="_ _14"> </span>C<span class="_ _16"> </span>language<span class="_ _0"></span>,<span class="_ _14"> </span>this<span class="_ _16"> </span>can<span class="_ _14"> </span>be</div><div class="t m5 x1d h26 y693 ff7 fs19 fc2 sc0 ls0 ws0">done<span class="_ _15"> </span>using<span class="_ _14"> </span>a<span class="_ _15"> </span><span class="ffa">cast<span class="_ _f"> </span></span>or<span class="_ _15"> </span>a<span class="_ _15"> </span><span class="ffa">union<span class="_ _15"> </span></span>to<span class="_ _15"> </span>allow<span class="_ _15"> </span>an<span class="_ _15"> </span>object<span class="_ _14"> </span>to<span class="_ _15"> </span>be<span class="_ _15"> </span>referenced<span class="_ _15"> </span>according<span class="_ _15"> </span>to</div><div class="t m5 x1d h26 y694 ff7 fs19 fc2 sc0 ls0 ws0">a<span class="_ _16"> </span>different<span class="_ _16"> </span>data<span class="_ _16"> </span>type<span class="_ _16"> </span>from<span class="_ _16"> </span>which<span class="_ _16"> </span>it<span class="_ _16"> </span>was<span class="_ _16"> </span>created.<span class="_ _16"> </span>Such<span class="_ _16"> </span>coding<span class="_ _16"> </span>tricks<span class="_ _16"> </span>are<span class="_ _16"> </span>strongly</div><div class="t m5 x1d h26 y695 ff7 fs19 fc2 sc0 ls0 ws0">discouraged<span class="_"> </span>for<span class="_ _11"> </span>most<span class="_"> </span>application<span class="_ _11"> </span>programming,<span class="_"> </span>but<span class="_"> </span>they<span class="_"> </span>can<span class="_ _11"> </span>be<span class="_"> </span>quite<span class="_ _11"> </span>useful<span class="_"> </span>and</div><div class="t m5 x1d h26 y696 ff7 fs19 fc2 sc0 ls0 ws0">even<span class="_"> </span>necessary<span class="_"> </span>for<span class="_"> </span>system-level<span class="_"> </span>programming.</div><div class="t m5 x29 h26 y697 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _14"> </span>2.4<span class="_ _14"> </span>shows<span class="_ _16"> </span>C<span class="_ _14"> </span>code<span class="_ _14"> </span>that<span class="_ _16"> </span>uses<span class="_ _14"> </span>casting<span class="_ _16"> </span>to<span class="_ _14"> </span>access<span class="_ _14"> </span>and<span class="_ _16"> </span>print<span class="_ _14"> </span>the<span class="_ _14"> </span>byte<span class="_ _16"> </span>rep-</div><div class="t m5 x1d h26 y698 ff7 fs19 fc2 sc0 ls0 ws0">resentations<span class="_ _14"> </span>of<span class="_ _15"> </span>different<span class="_ _15"> </span>program<span class="_ _14"> </span>objects<span class="_ _1"></span>.<span class="_ _15"> </span>W<span class="_ _3"></span>e<span class="_ _15"> </span>use<span class="_ _15"> </span><span class="ffd">typedef<span class="_ _14"> </span></span>to<span class="_ _15"> </span>deﬁne<span class="_ _15"> </span>data<span class="_ _14"> </span>type</div><div class="t m5 x1d h26 y699 ffd fs19 fc2 sc0 ls0 ws0">byte_pointer<span class="_ _6"> </span><span class="ff7">as<span class="_ _6"> </span>a<span class="_ _6"> </span>pointer<span class="_ _6"> </span>to<span class="_ _13"> </span>an<span class="_ _a"> </span>object<span class="_ _6"> </span>of<span class="_ _6"> </span>type<span class="_ _13"> </span></span>unsigned<span class="_ _11"> </span>char<span class="ff7">.<span class="_ _6"> </span>Such<span class="_ _6"> </span>a<span class="_ _6"> </span>byte<span class="_ _13"> </span>pointer</span></div><div class="t m5 x1d h26 y69a ff7 fs19 fc2 sc0 ls0 ws0">references<span class="_ _16"> </span>a<span class="_ _16"> </span>sequence<span class="_ _16"> </span>of<span class="_ _14"> </span>bytes<span class="_ _16"> </span>where<span class="_ _16"> </span>each<span class="_ _16"> </span>byte<span class="_ _14"> </span>is<span class="_ _16"> </span>considered<span class="_ _16"> </span>to<span class="_ _16"> </span>be<span class="_ _16"> </span>a<span class="_ _14"> </span>nonnega-</div><div class="t m5 x1d h26 y69b ff7 fs19 fc2 sc0 ls0 ws0">tive<span class="_ _16"> </span>integer.<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span>ﬁrst<span class="_ _14"> </span>routine<span class="_ _16"> </span><span class="ffd">show_bytes<span class="_ _16"> </span></span>is<span class="_ _16"> </span>given<span class="_ _14"> </span>the<span class="_ _16"> </span>address<span class="_ _16"> </span>of<span class="_ _16"> </span>a<span class="_ _16"> </span>sequence<span class="_ _14"> </span>of</div><div class="t m5 x1d h26 y69c ff7 fs19 fc2 sc0 ls0 ws0">bytes<span class="_ _1"></span>,<span class="_"> </span>indicated<span class="_ _13"> </span>by<span class="_"> </span>a<span class="_ _13"> </span>byte<span class="_"> </span>pointer,<span class="_ _13"> </span>and<span class="_"> </span>a<span class="_ _13"> </span>byte<span class="_"> </span>count.<span class="_"> </span>T<span class="_ _3"></span>he<span class="_"> </span>byte<span class="_"> </span>count<span class="_ _13"> </span>is<span class="_"> </span>speciﬁed<span class="_ _13"> </span>as</div><div class="t m5 x1d h26 y69d ff7 fs19 fc2 sc0 ls0 ws0">having<span class="_"> </span>data<span class="_ _11"> </span>type<span class="_"> </span><span class="ffd">size_t</span>,<span class="_ _11"> </span>the<span class="_ _11"> </span>preferred<span class="_"> </span>data<span class="_ _11"> </span>type<span class="_"> </span>for<span class="_ _11"> </span>expressing<span class="_"> </span>the<span class="_ _11"> </span>sizes<span class="_ _11"> </span>of<span class="_"> </span>data</div><div class="t m5 x1d h26 y69e ff7 fs19 fc2 sc0 ls0 ws0">structures<span class="_ _1"></span>.<span class="_ _11"> </span>It<span class="_ _11"> </span>prints<span class="_ _11"> </span>the<span class="_ _11"> </span>individual<span class="_ _11"> </span>bytes<span class="_ _11"> </span>in<span class="_ _11"> </span>hexadecimal.<span class="_ _11"> </span>The<span class="_"> </span>C<span class="_ _11"> </span>formatting<span class="_ _11"> </span>direc-</div><div class="t m5 x1d h26 ya9e ff7 fs19 fc2 sc0 ls0 ws0">tive<span class="_"> </span><span class="ffd">%.2x<span class="_ _10"> </span></span>indicates<span class="_"> </span>that<span class="_"> </span>an<span class="_"> </span>integer<span class="_ _11"> </span>should<span class="_"> </span>be<span class="_"> </span>printed<span class="_"> </span>in<span class="_"> </span>hexadecimal<span class="_"> </span>with<span class="_ _11"> </span>at<span class="_"> </span>least</div><div class="t m5 x1d h26 ya9f ff7 fs19 fc2 sc0 ls0 ws0">2<span class="_"> </span>digits<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
