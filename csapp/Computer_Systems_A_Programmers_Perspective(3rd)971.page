<div id="pf3cb" class="pf w2 h11" data-page-no="3cb"><div class="pc pc3cb w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg3cb.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">970<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>11<span class="_ _3d"> </span>Network<span class="_ _10"> </span>Programming</span></div><div class="t m5 x1d h26 y9c ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _14"> </span>then<span class="_ _14"> </span>use<span class="_ _14"> </span>this<span class="_ _14"> </span>type<span class="_ _15"> </span>whenever<span class="_ _14"> </span>we<span class="_ _14"> </span>need<span class="_ _14"> </span>to<span class="_ _14"> </span>cast<span class="_ _14"> </span>a<span class="_ _14"> </span><span class="ffd">sockaddr_in<span class="_ _14"> </span></span>structure<span class="_ _14"> </span>to<span class="_ _15"> </span>a</div><div class="t m5 x1d h26 y409 ff7 fs19 fc2 sc0 ls0 ws0">generic<span class="_"> </span><span class="ffd">sockaddr<span class="_ _10"> </span></span>structure<span class="_ _0"></span>.</div><div class="t m5 x1d h41 y7baa ffe fs29 fc2 sc0 ls0 ws0">11.4.2<span class="_ _48"> </span><span class="fs19">The<span class="_"> </span><span class="ffd fs1c">socket<span class="_ _11"> </span></span>Function</span></div><div class="t m5 x1d h26 y7bab ff7 fs19 fc2 sc0 ls0 ws0">Clients<span class="_"> </span>and<span class="_"> </span>servers<span class="_"> </span>use<span class="_"> </span>the<span class="_"> </span><span class="ffd">socket<span class="_ _10"> </span></span>function<span class="_"> </span>to<span class="_"> </span>create<span class="_"> </span>a<span class="_"> </span><span class="ffa">socket<span class="_"> </span>descriptor<span class="_ _2"></span></span>.</div><div class="t m5 x126 h2d y7bac ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;sys/types.h&gt;</div><div class="t m5 x126 h2d y7bad ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;sys/socket.h&gt;</div><div class="t m5 x126 h2d y7bae ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>socket(int<span class="_ _1f"> </span>domain,<span class="_ _1f"> </span>int<span class="_ _e"> </span>type,<span class="_ _1f"> </span>int<span class="_ _e"> </span>protocol);</div><div class="t m5 xd5 hf2 y7baf ff7 fs1f fc2 sc0 ls0 ws0">Returns:<span class="_"> </span>nonnegative<span class="_"> </span>descriptor<span class="_"> </span>if<span class="_"> </span>OK,<span class="_"> </span><span class="ff12">−</span>1<span class="_ _13"> </span>on<span class="_"> </span>error</div><div class="t m5 x1d h26 y7bb0 ff7 fs19 fc2 sc0 ls0 ws0">If<span class="_ _11"> </span>we<span class="_ _11"> </span>wanted<span class="_ _11"> </span>the<span class="_ _11"> </span>socket<span class="_ _11"> </span>to<span class="_ _11"> </span>be<span class="_ _11"> </span>the<span class="_ _11"> </span>end<span class="_ _11"> </span>point<span class="_ _11"> </span>for<span class="_ _11"> </span>a<span class="_ _11"> </span>connection,<span class="_ _11"> </span>then<span class="_ _11"> </span>we<span class="_ _11"> </span>could<span class="_ _11"> </span>call</div><div class="t m5 x1d h26 y7bb1 ffd fs19 fc2 sc0 ls0 ws0">socket<span class="_ _10"> </span><span class="ff7">with<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>hardcoded<span class="_"> </span>arguments:</span></div><div class="t m5 x10c h2d y7bb2 ffd fs1e fc2 sc0 ls0 ws0">clientfd<span class="_ _e"> </span>=<span class="_ _1f"> </span>Socket(AF_INET,<span class="_ _1f"> </span>SOCK_STREAM,<span class="_ _e"> </span>0);</div><div class="t m5 x1d h26 y7bb3 ff7 fs19 fc2 sc0 ls0 ws0">where<span class="_ _21"> </span>AF_INET<span class="_ _21"> </span>indicates<span class="_ _f"> </span>that<span class="_ _21"> </span>we<span class="_ _f"> </span>are<span class="_ _21"> </span>using<span class="_ _21"> </span>32-bit<span class="_ _f"> </span>IP<span class="_ _21"> </span>addresses<span class="_ _f"> </span>and<span class="_ _21"> </span>SOCK_</div><div class="t m5 x1d h26 y7bb4 ff7 fs19 fc2 sc0 ls0 ws0">STREAM<span class="_ _6"> </span>indicates<span class="_ _6"> </span>that<span class="_ _6"> </span>the<span class="_ _6"> </span>socket<span class="_ _6"> </span>will<span class="_ _6"> </span>be<span class="_ _6"> </span>an<span class="_ _6"> </span>end<span class="_ _6"> </span>point<span class="_ _6"> </span>for<span class="_ _6"> </span>a<span class="_ _6"> </span>connection.<span class="_ _6"> </span>However,</div><div class="t m5 x1d h26 y7bb5 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>best<span class="_ _11"> </span>practice<span class="_ _11"> </span>is<span class="_ _11"> </span>to<span class="_"> </span>use<span class="_ _11"> </span>the<span class="_ _11"> </span><span class="ffd">getaddrinfo<span class="_ _11"> </span></span>function<span class="_"> </span>(Section<span class="_ _11"> </span>11.4.7)<span class="_ _11"> </span>to<span class="_ _11"> </span>generate</div><div class="t m5 x1d h26 y7bb6 ff7 fs19 fc2 sc0 ls0 ws0">these<span class="_ _13"> </span>parameters<span class="_ _13"> </span>automatically<span class="_ _3"></span>,<span class="_"> </span>so<span class="_ _13"> </span>that<span class="_ _13"> </span>the<span class="_"> </span>code<span class="_ _13"> </span>is<span class="_ _13"> </span>protocol-independent.<span class="_ _13"> </span>W<span class="_ _3"></span>e<span class="_"> </span>will</div><div class="t m5 x1d h26 y7bb7 ff7 fs19 fc2 sc0 ls0 ws0">show<span class="_"> </span>you<span class="_"> </span>how<span class="_"> </span>to<span class="_"> </span>use<span class="_"> </span><span class="ffd">getaddrinfo<span class="_ _10"> </span></span>with<span class="_"> </span>the<span class="_"> </span><span class="ffd">socket<span class="_ _10"> </span></span>function<span class="_"> </span>in<span class="_"> </span>Section<span class="_"> </span>11.4.8.</div><div class="t m5 x29 h26 y7bb8 ff7 fs19 fc2 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _21"> </span><span class="ffd ls0">clientfd<span class="_ _15"> </span><span class="ff7">descriptor<span class="_ _15"> </span>returned<span class="_ _15"> </span>by<span class="_ _15"> </span></span>socket<span class="_ _15"> </span><span class="ff7">is<span class="_ _15"> </span>only<span class="_ _15"> </span>partially<span class="_ _15"> </span>opened<span class="_ _15"> </span>and</span></span></div><div class="t m5 x1d h26 y7bb9 ff7 fs19 fc2 sc0 ls0 ws0">cannot<span class="_ _14"> </span>yet<span class="_ _15"> </span>be<span class="_ _14"> </span>used<span class="_ _15"> </span>for<span class="_ _14"> </span>reading<span class="_ _15"> </span>and<span class="_ _14"> </span>writing.<span class="_ _14"> </span>How<span class="_ _14"> </span>we<span class="_ _15"> </span>ﬁnish<span class="_ _14"> </span>opening<span class="_ _15"> </span>the<span class="_ _14"> </span>socket</div><div class="t m5 x1d h26 y7bba ff7 fs19 fc2 sc0 ls0 ws0">depends<span class="_ _11"> </span>on<span class="_ _16"> </span>whether<span class="_ _16"> </span>we<span class="_ _11"> </span>are<span class="_ _16"> </span>a<span class="_ _16"> </span>client<span class="_ _11"> </span>or<span class="_ _16"> </span>a<span class="_ _16"> </span>server<span class="_ _0"></span>.<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span>next<span class="_ _11"> </span>section<span class="_ _16"> </span>describes<span class="_ _16"> </span>how</div><div class="t m5 x1d h26 y7bbb ff7 fs19 fc2 sc0 ls0 ws0">we<span class="_"> </span>ﬁnish<span class="_"> </span>opening<span class="_"> </span>the<span class="_"> </span>socket<span class="_"> </span>if<span class="_"> </span>we<span class="_"> </span>are<span class="_"> </span>a<span class="_"> </span>client.</div><div class="t m5 x1d h41 y7bbc ffe fs29 fc2 sc0 ls0 ws0">11.4.3<span class="_ _48"> </span><span class="fs19">The<span class="_"> </span><span class="ffd fs1c">connect<span class="_ _11"> </span></span>Function</span></div><div class="t m5 x1d h26 y7bbd ff7 fs19 fc2 sc0 ls0 ws0">A<span class="_"> </span>client<span class="_"> </span>establishes<span class="_"> </span>a<span class="_"> </span>connection<span class="_"> </span>with<span class="_"> </span>a<span class="_"> </span>server<span class="_"> </span>by<span class="_"> </span>calling<span class="_"> </span>the<span class="_"> </span><span class="ffd">connect<span class="_ _10"> </span></span>function.</div><div class="t m5 x126 h2d y7bbe ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;sys/socket.h&gt;</div><div class="t m5 x126 h2d y7bbf ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>connect(int<span class="_ _1f"> </span>clientfd,<span class="_ _1f"> </span>const<span class="_ _e"> </span>struct<span class="_ _1f"> </span>sockaddr<span class="_ _e"> </span>*addr,</div><div class="t m5 x150 h2d y7bc0 ffd fs1e fc2 sc0 ls0 ws0">socklen_t<span class="_ _e"> </span>addrlen);</div><div class="t m5 x107 hf2 y7bc1 ff7 fs1f fc2 sc0 ls0 ws0">Returns:<span class="_"> </span>0<span class="_"> </span>if<span class="_"> </span>OK,<span class="_"> </span><span class="ff12">−</span>1<span class="_ _13"> </span>on<span class="_"> </span>error</div><div class="t m5 x1d h26 y7bc2 ff7 fs19 fc2 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_"> </span><span class="ffd ls0">connect<span class="_ _13"> </span><span class="ff7">function<span class="_ _13"> </span>attempts<span class="_ _6"> </span>to<span class="_ _13"> </span>establish<span class="_ _13"> </span>an<span class="_ _13"> </span>Internet<span class="_ _6"> </span>connection<span class="_ _13"> </span>with<span class="_ _13"> </span>the<span class="_ _6"> </span>server</span></span></div><div class="t m5 x1d h26 y7bc3 ff7 fs19 fc2 sc0 ls0 ws0">at<span class="_ _16"> </span>socket<span class="_ _14"> </span>address<span class="_ _16"> </span><span class="ffd">addr</span>,<span class="_ _14"> </span>where<span class="_ _16"> </span><span class="ffd">addrlen<span class="_ _14"> </span></span>is<span class="_ _16"> </span><span class="ffd">sizeof(sockaddr_in)</span><span class="ls2de">.T<span class="_ _42"></span>h<span class="_ _42"></span>e<span class="ffd ls0">connect</span></span></div><div class="t m5 x1d h26 y7bc4 ff7 fs19 fc2 sc0 ls0 ws0">function<span class="_"> </span>blocks<span class="_ _11"> </span>until<span class="_"> </span>either<span class="_ _11"> </span>the<span class="_"> </span>connection<span class="_ _11"> </span>is<span class="_"> </span>successfully<span class="_ _11"> </span>established<span class="_"> </span>or<span class="_ _11"> </span>an<span class="_"> </span>error</div><div class="t m5 x1d h26 y7bc5 ff7 fs19 fc2 sc0 ls0 ws0">occurs<span class="_ _1"></span>.<span class="_ _13"> </span>If<span class="_ _6"> </span>successful,<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ffd">clientfd<span class="_ _6"> </span></span>descriptor<span class="_ _13"> </span>is<span class="_ _13"> </span>now<span class="_ _6"> </span>ready<span class="_ _13"> </span>for<span class="_ _13"> </span>reading<span class="_ _6"> </span>and<span class="_ _13"> </span>writing,</div><div class="t m5 x1d h26 y7bc6 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_"> </span>the<span class="_"> </span>resulting<span class="_"> </span>connection<span class="_"> </span>is<span class="_"> </span>characterized<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span>socket<span class="_"> </span>pair</div><div class="t m5 x1d h2d y77e ffd fs1e fc2 sc0 ls0 ws0">(x:y,<span class="_ _e"> </span>addr.sin_addr:addr.sin_port)</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
