<div id="pf27b" class="pf w2 h11" data-page-no="27b"><div class="pc pc27b w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg27b.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">634<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>6<span class="_ _3d"> </span>The<span class="_ _10"> </span>Memory<span class="_ _10"> </span>Hierarchy</span></div><div class="t m5 x28 h2a y257 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">Advances<span class="_ _11"> </span>in<span class="_ _11"> </span>I/O<span class="_ _11"> </span>bus<span class="_ _16"> </span>designs</span></div><div class="t m5 x28 h2b y2d0 ff7 fs1e fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>I/O<span class="_"> </span>bus<span class="_ _10"> </span>in<span class="_"> </span>Figure<span class="_"> </span>6.11<span class="_"> </span>is<span class="_"> </span>a<span class="_"> </span>simple<span class="_"> </span>abstraction<span class="_"> </span>that<span class="_"> </span>allows<span class="_"> </span>us<span class="_"> </span>to<span class="_"> </span>be<span class="_"> </span>concrete<span class="_ _0"></span>,<span class="_"> </span>without<span class="_"> </span>being<span class="_"> </span>tied<span class="_"> </span>too</div><div class="t m5 x28 h2b y2d1 ff7 fs1e fc2 sc0 ls0 ws0">closely<span class="_"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>details<span class="_"> </span>of<span class="_ _13"> </span>any<span class="_ _13"> </span>speciﬁc<span class="_"> </span>system.<span class="_ _13"> </span>It<span class="_ _13"> </span>is<span class="_"> </span>based<span class="_ _13"> </span>on<span class="_ _13"> </span>the<span class="_"> </span><span class="ffa">peripheral<span class="_ _13"> </span>component<span class="_ _13"> </span>interconnect<span class="_"> </span>(PCI)</span></div><div class="t m5 x28 h2b y2d2 ff7 fs1e fc2 sc0 ls0 ws0">bus<span class="_ _1"></span>,<span class="_"> </span>which<span class="_"> </span>was<span class="_"> </span>popular<span class="_"> </span>until<span class="_"> </span>around<span class="_ _13"> </span>2010.<span class="_"> </span>In<span class="_"> </span>the<span class="_"> </span>PCI<span class="_"> </span>model,<span class="_"> </span>each<span class="_"> </span>device<span class="_ _13"> </span>in<span class="_"> </span>the<span class="_"> </span>system<span class="_"> </span>shares<span class="_"> </span>the<span class="_"> </span>bus<span class="_ _3"></span>,</div><div class="t m5 x28 h2b y2d3 ff7 fs1e fc2 sc0 ls0 ws0">and<span class="_"> </span>only<span class="_"> </span>one<span class="_"> </span>device<span class="_"> </span>at<span class="_"> </span>a<span class="_"> </span>time<span class="_"> </span>can<span class="_"> </span>access<span class="_"> </span>these<span class="_"> </span>wires<span class="_ _1"></span>.<span class="_ _10"> </span>In<span class="_"> </span>modern<span class="_"> </span>systems<span class="_ _0"></span>,<span class="_"> </span>the<span class="_"> </span>shared<span class="_"> </span>PCI<span class="_"> </span>bus<span class="_"> </span>has<span class="_"> </span>been</div><div class="t m5 x28 h2b y2d4 ff7 fs1e fc2 sc0 ls0 ws0">replaced<span class="_ _13"> </span>by<span class="_ _6"> </span>a<span class="_ _13"> </span><span class="ffa">PCI<span class="_ _13"> </span>express<span class="_ _13"> </span></span>(PCIe)<span class="_ _6"> </span>bus<span class="_ _0"></span>,<span class="_ _13"> </span>which<span class="_ _13"> </span>is<span class="_ _6"> </span>a<span class="_ _13"> </span>set<span class="_ _13"> </span>of<span class="_ _13"> </span>high-speed<span class="_ _6"> </span>serial,<span class="_"> </span>point-to-point<span class="_ _6"> </span>links<span class="_ _13"> </span>connected</div><div class="t m5 x28 h2b y2d5 ff7 fs1e fc2 sc0 ls0 ws0">by<span class="_"> </span>switches<span class="_ _3"></span>,<span class="_"> </span>akin<span class="_ _13"> </span>to<span class="_"> </span>the<span class="_ _13"> </span>switched<span class="_"> </span>Ethernets<span class="_ _13"> </span>that<span class="_ _13"> </span>you<span class="_"> </span>will<span class="_ _13"> </span>learn<span class="_"> </span>about<span class="_ _13"> </span>in<span class="_ _13"> </span>Chapter<span class="_"> </span>11.<span class="_ _13"> </span>A<span class="_ _13"> </span>PCIe<span class="_"> </span>bus<span class="_ _3"></span>,<span class="_"> </span>with<span class="_"> </span>a</div><div class="t m5 x28 h2b y2d6 ff7 fs1e fc2 sc0 ls0 ws0">maximum<span class="_ _13"> </span>throughput<span class="_ _6"> </span>of<span class="_ _13"> </span>16<span class="_ _13"> </span>GB/s<span class="_ _3"></span>,<span class="_ _13"> </span>is<span class="_ _13"> </span>an<span class="_ _13"> </span>order<span class="_ _6"> </span>of<span class="_ _13"> </span>magnitude<span class="_ _13"> </span>faster<span class="_ _6"> </span>than<span class="_ _13"> </span>a<span class="_ _13"> </span>PCI<span class="_ _6"> </span>bus<span class="_ _1"></span>,<span class="_ _13"> </span>which<span class="_ _13"> </span>has<span class="_ _13"> </span>a<span class="_ _6"> </span>maximum</div><div class="t m5 x28 h2b y549 ff7 fs1e fc2 sc0 ls0 ws0">throughput<span class="_"> </span>of<span class="_"> </span>533<span class="_"> </span>MB/s<span class="_ _3"></span>.<span class="_"> </span>Except<span class="_"> </span>for<span class="_"> </span>measured<span class="_"> </span>I/O<span class="_"> </span>performance<span class="_ _1"></span>,<span class="_"> </span>the<span class="_"> </span>differences<span class="_"> </span>between<span class="_"> </span>the<span class="_ _13"> </span>different</div><div class="t m5 x28 h2b y54a ff7 fs1e fc2 sc0 ls0 ws0">bus<span class="_ _11"> </span>designs<span class="_ _11"> </span>are<span class="_ _16"> </span>not<span class="_ _11"> </span>visible<span class="_ _11"> </span>to<span class="_ _16"> </span>application<span class="_ _11"> </span>programs<span class="_ _1"></span>,<span class="_ _16"> </span>so<span class="_ _11"> </span>we<span class="_ _11"> </span>will<span class="_ _16"> </span>use<span class="_ _11"> </span>the<span class="_ _11"> </span>simple<span class="_ _11"> </span>shared<span class="_ _16"> </span>bus<span class="_ _11"> </span>abstraction</div><div class="t m5 x28 h2b y54b ff7 fs1e fc2 sc0 ls0 ws0">throughout<span class="_"> </span>the<span class="_"> </span>text.</div><div class="t m5 x29 h26 y2a37 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _11"> </span>CPU<span class="_"> </span>issues<span class="_ _11"> </span>commands<span class="_ _11"> </span>to<span class="_"> </span>I/O<span class="_ _11"> </span>devices<span class="_"> </span>using<span class="_ _11"> </span>a<span class="_ _11"> </span>technique<span class="_"> </span>called<span class="_ _11"> </span><span class="ffa">memory-</span></div><div class="t m5 x1d h26 y54c0 ffa fs19 fc2 sc0 ls0 ws0">mapped<span class="_ _16"> </span>I/O<span class="_ _16"> </span><span class="ff7">(F<span class="_ _1"></span>igure<span class="_ _16"> </span>6.12(a)).<span class="_ _16"> </span>In<span class="_ _16"> </span>a<span class="_ _14"> </span>system<span class="_ _16"> </span>with<span class="_ _16"> </span>memory-mapped<span class="_ _16"> </span>I/O<span class="_ _3"></span>,<span class="_ _14"> </span>a<span class="_ _16"> </span>block<span class="_ _16"> </span>of</span></div><div class="t m5 x1d h26 y54c1 ff7 fs19 fc2 sc0 ls0 ws0">addresses<span class="_ _16"> </span>in<span class="_ _14"> </span>the<span class="_ _16"> </span>address<span class="_ _14"> </span>space<span class="_ _16"> </span>is<span class="_ _14"> </span>reserved<span class="_ _14"> </span>for<span class="_ _16"> </span>communicating<span class="_ _14"> </span>with<span class="_ _16"> </span>I/O<span class="_ _14"> </span>devices<span class="_ _1"></span>.</div><div class="t m5 x1d h26 y54c2 ff7 fs19 fc2 sc0 ls0 ws0">Each<span class="_ _11"> </span>of<span class="_ _16"> </span>these<span class="_ _11"> </span>addresses<span class="_ _16"> </span>is<span class="_ _11"> </span>known<span class="_ _11"> </span>as<span class="_ _16"> </span>an<span class="_ _11"> </span><span class="ffa">I/O<span class="_ _16"> </span>port<span class="_ _2"></span></span>.<span class="_ _11"> </span>Each<span class="_ _16"> </span>device<span class="_ _11"> </span>is<span class="_ _16"> </span>associated<span class="_ _11"> </span>with</div><div class="t m5 x1d h26 y54c3 ff7 fs19 fc2 sc0 ls0 ws0">(or<span class="_"> </span>mapped<span class="_"> </span>to)<span class="_"> </span>one<span class="_"> </span>or<span class="_"> </span>more<span class="_"> </span>ports<span class="_"> </span>when<span class="_"> </span>it<span class="_"> </span>is<span class="_"> </span>attached<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>bus<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y54c4 ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_ _13"> </span>a<span class="_ _13"> </span>simple<span class="_ _13"> </span>example<span class="_ _0"></span>,<span class="_ _13"> </span>suppose<span class="_ _13"> </span>that<span class="_ _13"> </span>the<span class="_ _13"> </span>disk<span class="_"> </span>controller<span class="_ _13"> </span>is<span class="_ _13"> </span>mapped<span class="_ _13"> </span>to<span class="_ _13"> </span>port<span class="_ _13"> </span><span class="ffd">0xa0</span>.</div><div class="t m5 x1d h26 y54c5 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>hen<span class="_ _11"> </span>the<span class="_ _11"> </span>CPU<span class="_ _11"> </span>might<span class="_ _11"> </span>initiate<span class="_ _16"> </span>a<span class="_"> </span>disk<span class="_ _11"> </span>read<span class="_ _11"> </span>by<span class="_ _11"> </span>executing<span class="_ _11"> </span>three<span class="_ _11"> </span>store<span class="_ _16"> </span>instructions<span class="_"> </span>to</div><div class="t m5 x1d h26 y54c6 ff7 fs19 fc2 sc0 ls0 ws0">address<span class="_"> </span><span class="ffd">0xa0</span>:<span class="_"> </span>T<span class="_ _0"></span>he<span class="_"> </span>ﬁrst<span class="_"> </span>of<span class="_"> </span>these<span class="_"> </span>instructions<span class="_"> </span>sends<span class="_ _11"> </span>a<span class="_"> </span>command<span class="_"> </span>word<span class="_"> </span>that<span class="_"> </span>tells<span class="_ _11"> </span>the</div><div class="t m5 x1d h26 y54c7 ff7 fs19 fc2 sc0 ls0 ws0">disk<span class="_ _11"> </span>to<span class="_ _11"> </span>initiate<span class="_ _16"> </span>a<span class="_"> </span>read,<span class="_ _16"> </span>along<span class="_ _11"> </span>with<span class="_ _11"> </span>other<span class="_ _16"> </span>parameters<span class="_"> </span>such<span class="_ _16"> </span>as<span class="_ _11"> </span>whether<span class="_ _11"> </span>to<span class="_ _11"> </span>interrupt</div><div class="t m5 x1d h26 y54c8 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _13"> </span>CPU<span class="_"> </span>when<span class="_ _13"> </span>the<span class="_ _13"> </span>read<span class="_ _13"> </span>is<span class="_"> </span>ﬁnished.<span class="_ _13"> </span>(W<span class="_ _3"></span>e<span class="_ _13"> </span>will<span class="_"> </span>discuss<span class="_ _13"> </span>interrupts<span class="_ _13"> </span>in<span class="_ _13"> </span>Section<span class="_"> </span>8.1.)<span class="_ _13"> </span>T<span class="_ _1"></span>he</div><div class="t m5 x1d h26 y54c9 ff7 fs19 fc2 sc0 ls0 ws0">second<span class="_ _22"> </span>instruction<span class="_ _1f"> </span>indicates<span class="_ _22"> </span>the<span class="_ _22"> </span>logical<span class="_ _22"> </span>block<span class="_ _1f"> </span>number<span class="_ _22"> </span>that<span class="_ _22"> </span>should<span class="_ _22"> </span>be<span class="_ _1f"> </span>read.</div><div class="t m5 x1d h26 y54ca ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _16"> </span>third<span class="_ _16"> </span>instruction<span class="_ _16"> </span>indicates<span class="_ _16"> </span>the<span class="_ _16"> </span>main<span class="_ _16"> </span>memory<span class="_ _16"> </span>address<span class="_ _16"> </span>where<span class="_ _16"> </span>the<span class="_ _16"> </span>contents<span class="_ _16"> </span>of</div><div class="t m5 x1d h26 y54cb ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>disk<span class="_"> </span>sector<span class="_"> </span>should<span class="_"> </span>be<span class="_"> </span>stored.</div><div class="t m5 x29 h26 y54cc ff7 fs19 fc2 sc0 ls0 ws0">After<span class="_ _14"> </span>it<span class="_ _16"> </span>issues<span class="_ _14"> </span>the<span class="_ _14"> </span>request,<span class="_ _15"> </span>the<span class="_ _14"> </span>CPU<span class="_ _14"> </span>will<span class="_ _14"> </span>typically<span class="_ _16"> </span>do<span class="_ _14"> </span>other<span class="_ _14"> </span>work<span class="_ _14"> </span>while<span class="_ _14"> </span>the</div><div class="t m5 x1d h26 y54cd ff7 fs19 fc2 sc0 ls0 ws0">disk<span class="_"> </span>is<span class="_"> </span>performing<span class="_ _13"> </span>the<span class="_"> </span>read.<span class="_"> </span>Recall<span class="_"> </span>that<span class="_"> </span>a<span class="_ _13"> </span>1<span class="_"> </span>GHz<span class="_"> </span>processor<span class="_"> </span>wit<span class="ls233">ha1n<span class="_ _4a"></span>s<span class="ls0">clock<span class="_"> </span>c<span class="_ _0"></span>ycle</span></span></div><div class="t m5 x1d h26 y54ce ff7 fs19 fc2 sc0 ls0 ws0">can<span class="_ _16"> </span>potentially<span class="_ _14"> </span>execute<span class="_ _16"> </span>16<span class="_ _14"> </span>million<span class="_ _16"> </span>instructions<span class="_ _14"> </span>in<span class="_ _16"> </span>the<span class="_ _14"> </span>16<span class="_ _16"> </span>ms<span class="_ _14"> </span>it<span class="_ _14"> </span>takes<span class="_ _16"> </span>to<span class="_ _14"> </span>read<span class="_ _16"> </span>the</div><div class="t m5 x1d h26 y54cf ff7 fs19 fc2 sc0 ls0 ws0">disk.<span class="_ _13"> </span>Simply<span class="_ _13"> </span>waiting<span class="_ _13"> </span>and<span class="_"> </span>doing<span class="_ _13"> </span>nothing<span class="_ _13"> </span>while<span class="_ _13"> </span>the<span class="_ _13"> </span>transfer<span class="_ _13"> </span>is<span class="_"> </span>taking<span class="_ _13"> </span>place<span class="_ _13"> </span>would<span class="_ _13"> </span>be</div><div class="t m5 x1d h26 y54d0 ff7 fs19 fc2 sc0 ls0 ws0">enormously<span class="_"> </span>wasteful.</div><div class="t m5 x29 h26 y54d1 ff7 fs19 fc2 sc0 ls0 ws0">After<span class="_"> </span>the<span class="_"> </span>disk<span class="_ _11"> </span>controller<span class="_"> </span>receives<span class="_"> </span>the<span class="_ _11"> </span>read<span class="_"> </span>command<span class="_"> </span>from<span class="_ _11"> </span>the<span class="_"> </span>CPU<span class="_ _3"></span>,<span class="_"> </span>it<span class="_ _11"> </span>trans-</div><div class="t m5 x1d h26 y54d2 ff7 fs19 fc2 sc0 ls0 ws0">lates<span class="_ _13"> </span>the<span class="_ _13"> </span>logical<span class="_ _13"> </span>block<span class="_ _13"> </span>number<span class="_ _13"> </span>to<span class="_ _13"> </span>a<span class="_ _13"> </span>sector<span class="_ _13"> </span>address<span class="_ _1"></span>,<span class="_ _13"> </span>reads<span class="_ _13"> </span>the<span class="_ _13"> </span>contents<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>sector,</div><div class="t m5 x1d h26 y54d3 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_ _6"> </span>transfers<span class="_ _13"> </span>the<span class="_ _6"> </span>contents<span class="_ _13"> </span>directly<span class="_ _6"> </span>to<span class="_ _13"> </span>main<span class="_ _6"> </span>memory<span class="_ _3"></span>,<span class="_ _13"> </span>without<span class="_ _6"> </span>any<span class="_ _13"> </span>intervention<span class="_ _6"> </span>from</div><div class="t m5 x1d h26 y54d4 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _13"> </span>CPU<span class="_ _13"> </span>(F<span class="_ _1"></span>igure<span class="_ _13"> </span>6.12(b)).<span class="_ _13"> </span>T<span class="_ _1"></span>his<span class="_ _13"> </span>process<span class="_ _1"></span>,<span class="_ _13"> </span>whereby<span class="_ _13"> </span>a<span class="_ _13"> </span>device<span class="_ _13"> </span>performs<span class="_ _6"> </span>a<span class="_ _13"> </span>read<span class="_ _13"> </span>or<span class="_ _13"> </span>write</div><div class="t m5 x1d h26 y54d5 ff7 fs19 fc2 sc0 ls0 ws0">bus<span class="_ _13"> </span>transaction<span class="_ _6"> </span>on<span class="_ _13"> </span>its<span class="_ _6"> </span>own,<span class="_ _13"> </span>without<span class="_ _6"> </span>any<span class="_ _13"> </span>involvement<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _6"> </span>CPU<span class="_ _3"></span>,<span class="_ _13"> </span>is<span class="_ _13"> </span>known<span class="_ _6"> </span>as<span class="_ _13"> </span><span class="ffa">direct</span></div><div class="t m5 x1d h26 y54d6 ffa fs19 fc2 sc0 ls0 ws0">memory<span class="_"> </span>access<span class="_"> </span><span class="ff7">(DMA).<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>transfer<span class="_"> </span>of<span class="_"> </span>data<span class="_"> </span>is<span class="_"> </span>known<span class="_"> </span>as<span class="_"> </span>a<span class="_"> </span><span class="ffa">DMA<span class="_"> </span>transfer<span class="_ _2"></span></span>.</span></div><div class="t m5 x29 h26 y54d7 ff7 fs19 fc2 sc0 ls0 ws0">After<span class="_ _11"> </span>the<span class="_ _16"> </span>DMA<span class="_ _11"> </span>transfer<span class="_ _16"> </span>is<span class="_ _11"> </span>complete<span class="_ _16"> </span>and<span class="_ _11"> </span>the<span class="_ _16"> </span>contents<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>disk<span class="_ _11"> </span>sector<span class="_ _16"> </span>are</div><div class="t m5 x1d h26 y54d8 ff7 fs19 fc2 sc0 ls0 ws0">safely<span class="_"> </span>stored<span class="_"> </span>in<span class="_"> </span>main<span class="_"> </span>memory<span class="_ _7"></span>,<span class="_"> </span>the<span class="_"> </span>disk<span class="_"> </span>controller<span class="_"> </span>notiﬁes<span class="_"> </span>the<span class="_"> </span>CPU<span class="_ _13"> </span>by<span class="_"> </span>sending<span class="_"> </span>an</div><div class="t m5 x1d h26 y54d9 ff7 fs19 fc2 sc0 ls0 ws0">interrupt<span class="_ _16"> </span>signal<span class="_ _16"> </span>to<span class="_ _16"> </span>the<span class="_ _16"> </span>CPU<span class="_ _16"> </span>(Figure<span class="_ _16"> </span>6.12(c)).<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span>basic<span class="_ _16"> </span>idea<span class="_ _16"> </span>is<span class="_ _16"> </span>that<span class="_ _14"> </span>an<span class="_ _16"> </span>interrupt</div><div class="t m5 x1d h26 y54da ff7 fs19 fc2 sc0 ls0 ws0">signals<span class="_ _16"> </span>an<span class="_ _11"> </span>external<span class="_ _16"> </span>pin<span class="_ _16"> </span>on<span class="_ _16"> </span>the<span class="_ _11"> </span>CPU<span class="_ _16"> </span>chip<span class="_ _0"></span>.<span class="_ _16"> </span>T<span class="_ _1"></span>his<span class="_ _16"> </span>causes<span class="_ _16"> </span>the<span class="_ _11"> </span>CPU<span class="_ _16"> </span>to<span class="_ _16"> </span>stop<span class="_ _16"> </span>what<span class="_ _16"> </span>it<span class="_ _11"> </span>is</div><div class="t m5 x1d h26 y54db ff7 fs19 fc2 sc0 ls0 ws0">currently<span class="_ _6"> </span>working<span class="_ _6"> </span>on<span class="_ _6"> </span>and<span class="_ _6"> </span>jump<span class="_ _6"> </span>to<span class="_ _6"> </span>an<span class="_ _6"> </span>operating<span class="_ _6"> </span>system<span class="_ _6"> </span>routine.<span class="_ _a"> </span>T<span class="_ _0"></span>he<span class="_ _6"> </span>routine<span class="_ _6"> </span>records</div><div class="t m5 x1d h26 y54dc ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>fact<span class="_ _11"> </span>that<span class="_"> </span>the<span class="_ _11"> </span>I/O<span class="_"> </span>has<span class="_ _11"> </span>ﬁnished<span class="_"> </span>and<span class="_ _11"> </span>then<span class="_"> </span>returns<span class="_ _11"> </span>control<span class="_"> </span>to<span class="_ _11"> </span>the<span class="_"> </span>point<span class="_ _11"> </span>where<span class="_ _11"> </span>the</div><div class="t m5 x1d h26 y54dd ff7 fs19 fc2 sc0 ls0 ws0">CPU<span class="_"> </span>was<span class="_"> </span>interrupted.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
