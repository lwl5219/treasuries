<div id="pf3b2" class="pf w2 h11" data-page-no="3b2"><div class="pc pc3b2 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg3b2.png"/><div class="t m5 xa h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>10.9<span class="_ _60"> </span>I/O<span class="_ _10"> </span>Redirection<span class="_ _3e"> </span><span class="ffe fs1e">945</span></div><div class="t m5 x2c h2e ye7 ff6 fs20 fc6 sc0 ls0 ws0">7</div><div class="t m5 x2c h2e y78ed ff6 fs20 fc6 sc0 ls0 ws0">8</div><div class="t m5 x142 h2d yc4d ffd fs1e fc2 sc0 ls0 ws0">fd<span class="_ _e"> </span>=<span class="_ _1f"> </span>Open(&quot;foobar.txt&quot;,<span class="_ _1f"> </span>O_RDONLY,<span class="_ _e"> </span>0);</div><div class="t m5 x2c h2d yecb ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _20"> </span><span class="ffd fs1e fc2">if<span class="_ _e"> </span>(Fork()<span class="_ _1f"> </span>==<span class="_ _1f"> </span>0)<span class="_ _e"> </span>{</span></div><div class="t m5 x17 h2d yecc ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _70"> </span><span class="ffd fs1e fc2">Read(fd,<span class="_ _e"> </span>&amp;c,<span class="_ _1f"> </span>1);</span></div><div class="t m5 x17 h2d yecd ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _70"> </span><span class="ffd fs1e fc2">exit(0);</span></div><div class="t m5 x17 h2d yece ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x17 h2d yecf ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _20"> </span><span class="ffd fs1e fc2">Wait(NULL);</span></div><div class="t m5 x17 h2d yed0 ff6 fs20 fc6 sc0 ls0 ws0">14<span class="_ _20"> </span><span class="ffd fs1e fc2">Read(fd,<span class="_ _e"> </span>&amp;c,<span class="_ _1f"> </span>1);</span></div><div class="t m5 x17 h2e y20fe ff6 fs20 fc6 sc0 ls0 ws0">15</div><div class="t m5 x142 h2d y1a10 ffd fs1e fc2 sc0 ls0 ws0">printf(&quot;c<span class="_ _e"> </span>=<span class="_ _1f"> </span>%c\n&quot;,<span class="_ _1f"> </span>c);</div><div class="t m5 x17 h2d yed3 ff6 fs20 fc6 sc0 ls0 ws0">16<span class="_ _20"> </span><span class="ffd fs1e fc2">exit(0);</span></div><div class="t m5 x17 h2d yed4 ff6 fs20 fc6 sc0 ls0 ws0">17<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x17 h3b y78ee fff fs24 fc6 sc0 ls0 ws0">10.9<span class="_ _17"> </span><span class="ffe fs18">I/O<span class="_"> </span>Redirection</span></div><div class="t m5 x17 h26 y78ef ff7 fs19 fc1 sc0 ls0 ws0">Linux<span class="_ _11"> </span>shells<span class="_ _11"> </span>provide<span class="_ _11"> </span><span class="ffa">I/O<span class="_ _11"> </span>redirection<span class="_ _11"> </span></span>operators<span class="_ _11"> </span>that<span class="_ _11"> </span>allow<span class="_ _11"> </span>users<span class="_ _11"> </span>to<span class="_ _16"> </span>associate<span class="_"> </span>stan-</div><div class="t m5 x17 h26 y78f0 ff7 fs19 fc1 sc0 ls0 ws0">dard<span class="_"> </span>input<span class="_"> </span>and<span class="_"> </span>output<span class="_"> </span>with<span class="_"> </span>disk<span class="_"> </span>ﬁles<span class="_ _1"></span>.<span class="_"> </span>F<span class="_ _1"></span>or<span class="_"> </span>example<span class="_ _0"></span>,<span class="_"> </span>typing</div><div class="t m5 x17 h2d y78f1 ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">ls<span class="_ _1f"> </span>&gt;<span class="_ _1f"> </span>foo.txt</span></div><div class="t m5 x17 h26 y78f2 ff7 fs19 fc2 sc0 ls0 ws0">causes<span class="_ _11"> </span>the<span class="_ _16"> </span>shell<span class="_ _16"> </span>to<span class="_ _11"> </span>load<span class="_ _16"> </span>and<span class="_ _11"> </span>execute<span class="_ _16"> </span>the<span class="_ _11"> </span><span class="ffd">ls<span class="_ _16"> </span></span>program,<span class="_ _16"> </span>with<span class="_ _11"> </span>standard<span class="_ _16"> </span>output<span class="_ _11"> </span>redi-</div><div class="t m5 x17 h26 y78f3 ff7 fs19 fc2 sc0 ls0 ws0">rected<span class="_"> </span>to<span class="_"> </span>disk<span class="_ _13"> </span>ﬁle<span class="_"> </span><span class="ffd">foo.txt</span>.<span class="_"> </span>As<span class="_"> </span>we<span class="_"> </span>will<span class="_ _13"> </span>see<span class="_"> </span>in<span class="_"> </span>Section<span class="_"> </span>11.5,<span class="_"> </span>a<span class="_ _13"> </span>W<span class="_ _1"></span>eb<span class="_"> </span>server<span class="_"> </span>performs</div><div class="t m5 x17 h26 y78f4 ff7 fs19 fc2 sc0 ls0 ws0">a<span class="_"> </span>similar<span class="_ _11"> </span>kind<span class="_"> </span>of<span class="_ _11"> </span>redirection<span class="_ _11"> </span>when<span class="_"> </span>it<span class="_ _11"> </span>runs<span class="_"> </span>a<span class="_ _11"> </span>CGI<span class="_ _11"> </span>program<span class="_"> </span>on<span class="_ _11"> </span>behalf<span class="_"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>client.</div><div class="t m5 x17 h26 y78f5 ff7 fs19 fc2 sc0 ls0 ws0">So<span class="_"> </span>how<span class="_"> </span>does<span class="_"> </span>I/O<span class="_"> </span>redirection<span class="_"> </span>work?<span class="_"> </span>One<span class="_"> </span>way<span class="_"> </span>is<span class="_"> </span>to<span class="_"> </span>use<span class="_"> </span>the<span class="_"> </span><span class="ffd">dup2<span class="_ _10"> </span></span>function.</div><div class="t m5 x31 h2d y78f6 ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&lt;unistd.h&gt;</div><div class="t m5 x31 h2d y78f7 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>dup2(int<span class="_ _1f"> </span>oldfd,<span class="_ _1f"> </span>int<span class="_ _e"> </span>newfd);</div><div class="t m5 x18d hf2 y78f8 ff7 fs1f fc2 sc0 ls0 ws0">Returns:<span class="_"> </span>nonnegative<span class="_"> </span>descriptor<span class="_"> </span>if<span class="_"> </span>OK,<span class="_"> </span><span class="ff12">−</span>1<span class="_ _13"> </span>on<span class="_"> </span>error</div><div class="t m5 x17 h26 y78f9 ff7 fs19 fc2 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _14"> </span><span class="ffd ls0">dup2<span class="_ _16"> </span><span class="ff7">function<span class="_ _16"> </span>copies<span class="_ _16"> </span>descriptor<span class="_ _14"> </span>table<span class="_ _16"> </span>entry<span class="_ _16"> </span></span>oldfd<span class="_ _16"> </span><span class="ff7">to<span class="_ _16"> </span>descriptor<span class="_ _16"> </span>table<span class="_ _16"> </span>entry</span></span></div><div class="t m5 x17 h26 y78fa ffd fs19 fc2 sc0 ls0 ws0">newfd<span class="ff7">,<span class="_ _13"> </span>overwriting<span class="_ _13"> </span>the<span class="_ _13"> </span>previous<span class="_ _13"> </span>contents<span class="_ _13"> </span>of<span class="_ _13"> </span>descriptor<span class="_ _13"> </span>table<span class="_ _13"> </span>entry<span class="_ _13"> </span></span>newfd<span class="ff7 ls46">.I<span class="_ _80"></span>f<span class="ffd ls0">newfd</span></span></div><div class="t m5 x17 h26 y78fb ff7 fs19 fc2 sc0 ls0 ws0">was<span class="_"> </span>already<span class="_"> </span>open,<span class="_"> </span>then<span class="_"> </span><span class="ffd">dup2<span class="_ _10"> </span></span>closes<span class="_"> </span><span class="ffd">newfd<span class="_ _10"> </span></span>before<span class="_"> </span>it<span class="_"> </span>copies<span class="_"> </span><span class="ffd">oldfd</span>.</div><div class="t m5 x26 h26 y78fc ff7 fs19 fc2 sc0 ls0 ws0">Suppose<span class="_ _13"> </span>that<span class="_"> </span>before<span class="_ _13"> </span>calling<span class="_ _13"> </span><span class="ffd">dup2(4,1)</span>,<span class="_"> </span>we<span class="_ _13"> </span>have<span class="_ _13"> </span>the<span class="_"> </span>situation<span class="_ _13"> </span>in<span class="_"> </span>F<span class="_ _3"></span>igure<span class="_"> </span>10.12,</div><div class="t m5 x17 h26 y78fd ff7 fs19 fc2 sc0 ls0 ws0">where<span class="_ _f"> </span>descriptor<span class="_ _e"> </span>1<span class="_ _f"> </span>(standard<span class="_ _e"> </span>output)<span class="_ _f"> </span>corresponds<span class="_ _e"> </span>to<span class="_ _f"> </span>ﬁle<span class="_ _e"> </span>A<span class="_ _21"> </span>(say<span class="_ _3"></span>,<span class="_ _1f"> </span>a<span class="_ _f"> </span>terminal)</div><div class="t m5 x17 h26 y78fe ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_ _21"> </span>descriptor<span class="_ _21"> </span>4<span class="_ _21"> </span>corresponds<span class="_ _21"> </span>to<span class="_ _21"> </span>ﬁle<span class="_ _21"> </span>B<span class="_ _21"> </span>(say<span class="_ _3"></span>,<span class="_ _f"> </span>a<span class="_ _21"> </span>disk<span class="_ _21"> </span>ﬁle).<span class="_ _21"> </span>The<span class="_ _15"> </span>reference<span class="_ _21"> </span>counts</div><div class="t m5 x17 h26 y78ff ff7 fs19 fc2 sc0 ls0 ws0">for<span class="_ _14"> </span>A<span class="_ _14"> </span>and<span class="_ _14"> </span>B<span class="_ _14"> </span>are<span class="_ _14"> </span>both<span class="_ _14"> </span>equal<span class="_ _14"> </span>to<span class="_ _14"> </span>1.<span class="_ _15"> </span>F<span class="_ _1"></span>igure<span class="_ _14"> </span>10.15<span class="_ _14"> </span>shows<span class="_ _15"> </span>the<span class="_ _14"> </span>situation<span class="_ _14"> </span>after<span class="_ _14"> </span>calling</div><div class="t m5 x17 h26 y7900 ffd fs19 fc2 sc0 ls0 ws0">dup2(4,1)<span class="ff7">.<span class="_ _16"> </span>Both<span class="_ _16"> </span>descriptors<span class="_ _16"> </span>now<span class="_ _16"> </span>point<span class="_ _16"> </span>to<span class="_ _16"> </span>ﬁle<span class="_ _14"> </span>B;<span class="_ _14"> </span>ﬁle<span class="_ _16"> </span>A<span class="_ _16"> </span>has<span class="_ _16"> </span>been<span class="_ _16"> </span>closed<span class="_ _14"> </span>and<span class="_ _16"> </span>its</span></div><div class="t m5 x17 h26 y7901 ff7 fs19 fc2 sc0 ls0 ws0">ﬁle<span class="_"> </span>table<span class="_ _11"> </span>and<span class="_ _11"> </span>v-node<span class="_"> </span>table<span class="_ _11"> </span>entries<span class="_ _11"> </span>deleted;<span class="_ _11"> </span>and<span class="_"> </span>the<span class="_ _11"> </span>reference<span class="_ _11"> </span>count<span class="_"> </span>for<span class="_ _11"> </span>ﬁle<span class="_ _11"> </span>B<span class="_"> </span>has</div><div class="t m5 x17 h26 y7902 ff7 fs19 fc2 sc0 ls0 ws0">been<span class="_ _16"> </span>incremented.<span class="_ _16"> </span>From<span class="_ _16"> </span>this<span class="_ _16"> </span>point<span class="_ _16"> </span>on,<span class="_ _14"> </span>any<span class="_ _14"> </span>data<span class="_ _16"> </span>written<span class="_ _14"> </span>to<span class="_ _16"> </span>standard<span class="_ _16"> </span>output<span class="_ _14"> </span>are</div><div class="t m5 x17 h26 y7903 ff7 fs19 fc2 sc0 ls0 ws0">redirected<span class="_"> </span>to<span class="_"> </span>ﬁle<span class="_"> </span>B<span class="_ _3"></span>.</div><div class="t m5 x17 h47 y7904 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>10.4<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>951)</span></div><div class="t m5 x17 h26 y56f3 ff7 fs19 fc1 sc0 ls0 ws0">How<span class="_"> </span>would<span class="_"> </span>you<span class="_"> </span>use<span class="_"> </span><span class="ffd">dup2<span class="_ _10"> </span></span>to<span class="_"> </span>redirect<span class="_"> </span>standard<span class="_"> </span>input<span class="_"> </span>to<span class="_"> </span>descriptor<span class="_"> </span>5?</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
