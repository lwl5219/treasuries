<div id="pf183" class="pf w2 h11" data-page-no="183"><div class="pc pc183 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg183.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">386<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x1d h28 ye7 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>3.56<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>341)</span></div><div class="t m5 x124 h26 y391 ff7 fs19 fc1 sc0 ls0 ws0">A.<span class="_ _1f"> </span>W<span class="_ _3"></span>e<span class="_ _11"> </span>see<span class="_ _11"> </span>here<span class="_ _16"> </span>that<span class="_"> </span>the<span class="_ _16"> </span>16<span class="_"> </span>bytes<span class="_ _16"> </span>starting<span class="_"> </span>at<span class="_ _11"> </span>address<span class="_ _16"> </span><span class="ffd">.LC1<span class="_ _11"> </span></span>form<span class="_ _11"> </span>a<span class="_ _11"> </span>mask,<span class="_ _11"> </span>where</div><div class="t m5 x4f h26 y3636 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _16"> </span>low-order<span class="_ _14"> </span>8<span class="_ _14"> </span>bytes<span class="_ _14"> </span>contain<span class="_ _16"> </span>all<span class="_ _14"> </span>ones<span class="_ _1"></span>,<span class="_ _15"> </span>except<span class="_ _16"> </span>for<span class="_ _14"> </span>the<span class="_ _14"> </span>most<span class="_ _14"> </span>signiﬁcant<span class="_ _16"> </span>bit,</div><div class="t m5 x4f h26 y3637 ff7 fs19 fc1 sc0 ls0 ws0">which<span class="_"> </span>is<span class="_ _13"> </span>the<span class="_"> </span>sign<span class="_ _13"> </span>bit<span class="_"> </span>of<span class="_ _13"> </span>a<span class="_"> </span>double-precision<span class="_ _13"> </span>value<span class="_ _1"></span>.<span class="_"> </span>When<span class="_ _13"> </span>we<span class="_"> </span>compute<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ff9">and</span></div><div class="t m5 x4f h26 y3638 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_ _11"> </span>this<span class="_ _11"> </span>mask<span class="_ _11"> </span>with<span class="_ _11"> </span><span class="ffd">%xmm0</span>,<span class="_ _11"> </span>it<span class="_ _11"> </span>will<span class="_ _11"> </span>clear<span class="_ _11"> </span>the<span class="_ _11"> </span>sign<span class="_ _11"> </span>bit<span class="_ _16"> </span>of<span class="_"> </span><span class="ffd">x</span>,<span class="_ _16"> </span>yielding<span class="_"> </span>the<span class="_ _11"> </span>absolute</div><div class="t m5 x4f h26 y3639 ff7 fs19 fc1 sc0 ls0 ws0">value<span class="_ _1"></span>.<span class="_ _16"> </span>In<span class="_ _16"> </span>fact,<span class="_ _14"> </span>we<span class="_ _16"> </span>generated<span class="_ _16"> </span>this<span class="_ _16"> </span>code<span class="_ _16"> </span>by<span class="_ _16"> </span>deﬁning<span class="_ _16"> </span><span class="ffd">EXPR(x)<span class="_ _16"> </span></span>to<span class="_ _16"> </span>be<span class="_ _16"> </span><span class="ffd">fabs(x)</span>,</div><div class="t m5 x4f h26 y363a ff7 fs19 fc1 sc0 ls0 ws0">where<span class="_"> </span><span class="ffd">fabs<span class="_ _10"> </span></span>is<span class="_"> </span>deﬁned<span class="_"> </span>in<span class="_"> </span><span class="ffd">&lt;math.h&gt;</span>.</div><div class="t m5 x124 h26 y363b ff7 fs19 fc1 sc0 ls0 ws0">B<span class="_ _3"></span>.<span class="_ _1d"> </span>W<span class="_ _1"></span>e<span class="_ _13"> </span>see<span class="_ _13"> </span>that<span class="_ _13"> </span>the<span class="_ _6"> </span><span class="ffd">vxorpd<span class="_ _13"> </span></span>instruction<span class="_ _13"> </span>sets<span class="_ _13"> </span>the<span class="_ _13"> </span>entire<span class="_ _13"> </span>register<span class="_ _13"> </span>to<span class="_ _13"> </span>zero<span class="_ _1"></span>,<span class="_ _13"> </span>and<span class="_ _13"> </span>so<span class="_ _13"> </span>this</div><div class="t m5 x4f h26 y363c ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_"> </span>a<span class="_"> </span>way<span class="_"> </span>to<span class="_"> </span>generate<span class="_"> </span>ﬂoating-point<span class="_"> </span>constant<span class="_"> </span>0<span class="ff11">.</span><span class="ls93">0.</span></div><div class="t m5 x124 h26 y363d ff7 fs19 fc1 sc0 ls0 ws0">C.<span class="_ _25"> </span>W<span class="_ _3"></span>e<span class="_"> </span>see<span class="_ _11"> </span>that<span class="_"> </span>the<span class="_ _11"> </span>16<span class="_"> </span>bytes<span class="_ _11"> </span>starting<span class="_"> </span>at<span class="_ _11"> </span>address<span class="_"> </span><span class="ffd">.LC2<span class="_ _11"> </span></span>form<span class="_"> </span>a<span class="_"> </span>mask<span class="_ _11"> </span>with<span class="_"> </span>a<span class="_ _11"> </span>single</div><div class="t m5 x4f h26 y363e ff7 fs19 fc1 sc0 ls0 ws0">1<span class="_ _14"> </span>bit,<span class="_ _21"> </span>at<span class="_ _14"> </span>the<span class="_ _15"> </span>position<span class="_ _14"> </span>of<span class="_ _15"> </span>the<span class="_ _14"> </span>sign<span class="_ _15"> </span>bit<span class="_ _14"> </span>for<span class="_ _15"> </span>the<span class="_ _14"> </span>low-order<span class="_ _15"> </span>value<span class="_ _14"> </span>in<span class="_ _15"> </span>the<span class="_ _14"> </span>XMM</div><div class="t m5 x4f h26 y363f ff7 fs19 fc1 sc0 ls0 ws0">register.<span class="_ _11"> </span>When<span class="_ _16"> </span>we<span class="_ _16"> </span>compute<span class="_ _16"> </span>the<span class="_ _16"> </span><span class="ff9">ex<span class="_ _1"></span>clusive-or<span class="_ _16"> </span><span class="ff7">of<span class="_ _16"> </span>this<span class="_ _16"> </span>mask<span class="_ _16"> </span>with<span class="_ _16"> </span><span class="ffd">%xmm0</span><span class="ls1aa">,w<span class="_ _42"></span>e</span></span></span></div><div class="t m5 x4f h26 y3640 ff7 fs19 fc1 sc0 ls0 ws0">change<span class="_"> </span>the<span class="_"> </span>sign<span class="_"> </span>of<span class="_"> </span><span class="ffd">x</span>,<span class="_"> </span>computing<span class="_"> </span>the<span class="_"> </span>expression<span class="_"> </span><span class="ffd">-x</span>.</div><div class="t m5 x1d h28 y3641 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>3.57<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>344)</span></div><div class="t m5 x1d h26 y3642 ff7 fs19 fc1 sc0 ls0 ws0">Again,<span class="_"> </span>we<span class="_"> </span>annotate<span class="_"> </span>the<span class="_"> </span>code<span class="_ _1"></span>,<span class="_"> </span>including<span class="_"> </span>dealing<span class="_"> </span>with<span class="_"> </span>the<span class="_"> </span>conditional<span class="_"> </span>branch:</div><div class="t m5 x30 h61 y3643 ff13 fs35 fc6 sc0 ls0 ws0">double<span class="_ _f"> </span>funct3(int<span class="_ _f"> </span>*ap,<span class="_ _f"> </span>double<span class="_ _e"> </span>b,<span class="_ _21"> </span>long<span class="_ _f"> </span>c,<span class="_ _e"> </span>float<span class="_ _21"> </span>*dp)</div><div class="t m5 x30 h61 y3644 ff13 fs35 fc6 sc0 ls0 ws0">ap<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi,<span class="_ _f"> </span>b<span class="_ _e"> </span>in<span class="_ _21"> </span>%xmm0,<span class="_ _f"> </span>c<span class="_ _e"> </span>in<span class="_ _21"> </span>%rsi,<span class="_ _f"> </span>dp<span class="_ _e"> </span>in<span class="_ _21"> </span>%rdx</div><div class="t m5 x37 h2d y3645 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">funct3:</span></div><div class="t m5 x37 h2d y3646 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">vmovss<span class="_ _1a"> </span>(%rdx),<span class="_ _e"> </span>%xmm1<span class="_ _17f"> </span></span><span class="ff13 fs35">Get<span class="_ _e"> </span>d<span class="_ _21"> </span>=<span class="_ _f"> </span>*dp</span></div><div class="t m5 x37 h2d y3647 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">vcvtsi2sd<span class="_ _6f"> </span>(%rdi),<span class="_ _1f"> </span>%xmm2,<span class="_ _e"> </span>%xmm2<span class="_ _bd"> </span></span><span class="ff13 fs35">Get<span class="_ _e"> </span>a<span class="_ _21"> </span>=<span class="_ _f"> </span>*ap<span class="_ _e"> </span>and<span class="_ _21"> </span>convert<span class="_ _f"> </span>to<span class="_ _e"> </span>double</span></div><div class="t m5 x37 h2d y3648 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">vucomisd<span class="_ _71"> </span>%xmm2,<span class="_ _1f"> </span>%xmm0<span class="_ _19b"> </span></span><span class="ff13 fs35">Compare<span class="_ _f"> </span>b:a</span></div><div class="t m5 x37 h2d y3649 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">jbe<span class="_ _8c"> </span>.L8<span class="_ _181"> </span></span><span class="ff13 fs35">If<span class="_ _f"> </span>&lt;=,<span class="_ _f"> </span>goto<span class="_ _e"> </span><span class="ff2d">lesseq</span></span></div><div class="t m5 x37 h2d y364a ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">vcvtsi2ssq<span class="_ _5a"> </span>%rsi,<span class="_ _1f"> </span>%xmm0,<span class="_ _e"> </span>%xmm0<span class="_ _7d"> </span></span><span class="ff13 fs35">Convert<span class="_ _e"> </span>c<span class="_ _21"> </span>to<span class="_ _f"> </span>float</span></div><div class="t m5 x37 h2d y364b ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">vmulss<span class="_ _1a"> </span>%xmm1,<span class="_ _e"> </span>%xmm0,<span class="_ _1f"> </span>%xmm1<span class="_ _d5"> </span></span><span class="ff13 fs35">Multiply<span class="_ _f"> </span>by<span class="_ _f"> </span>d</span></div><div class="t m5 x37 h2d y364c ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _45"> </span><span class="ffd fs1e fc2">vunpcklps<span class="_ _6f"> </span>%xmm1,<span class="_ _1f"> </span>%xmm1,<span class="_ _e"> </span>%xmm1</span></div><div class="t m5 x37 h2d y364d ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _45"> </span><span class="ffd fs1e fc2">vcvtps2pd<span class="_ _6f"> </span>%xmm1,<span class="_ _1f"> </span>%xmm0<span class="_ _152"> </span></span><span class="ff13 fs35">Convert<span class="_ _f"> </span>to<span class="_ _e"> </span>double</span></div><div class="t m5 x3e h2d y364e ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _45"> </span><span class="ffd fs1e fc2">ret<span class="_ _19c"> </span></span><span class="ff13 fs35">Return</span></div><div class="t m5 x3e h2d y364f ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L8:<span class="_ _19d"> </span></span><span class="ff2d fs35">lesseq:</span></div><div class="t m5 x3e h2d y3650 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _45"> </span><span class="ffd fs1e fc2">vaddss<span class="_ _1a"> </span>%xmm1,<span class="_ _e"> </span>%xmm1,<span class="_ _1f"> </span>%xmm1<span class="_ _d5"> </span></span><span class="ff13 fs35">Compute<span class="_ _f"> </span>d+d<span class="_ _f"> </span>=<span class="_ _f"> </span>2.0<span class="_ _e"> </span>*<span class="_ _21"> </span>d</span></div><div class="t m5 x3e h2e y3651 ff6 fs20 fc6 sc0 ls0 ws0">13</div><div class="t m5 x1d3 h2d y3652 ffd fs1e fc2 sc0 ls0 ws0">vcvtsi2ssq<span class="_ _5a"> </span>%rsi,<span class="_ _1f"> </span>%xmm0,<span class="_ _e"> </span>%xmm0<span class="_ _7d"> </span><span class="ff13 fs35 fc6">Convert<span class="_ _e"> </span>c<span class="_ _21"> </span>to<span class="_ _f"> </span>float</span></div><div class="t m5 x3e h2d y3653 ff6 fs20 fc6 sc0 ls0 ws0">14<span class="_ _45"> </span><span class="ffd fs1e fc2">vaddss<span class="_ _1a"> </span>%xmm1,<span class="_ _e"> </span>%xmm0,<span class="_ _1f"> </span>%xmm0<span class="_ _d5"> </span></span><span class="ff13 fs35">Comput<span class="ls156">ec+2<span class="_ _8a"></span>*<span class="_ _8a"></span>d</span></span></div><div class="t m5 x3e h2d y3654 ff6 fs20 fc6 sc0 ls0 ws0">15<span class="_ _45"> </span><span class="ffd fs1e fc2">vunpcklps<span class="_ _6f"> </span>%xmm0,<span class="_ _1f"> </span>%xmm0,<span class="_ _e"> </span>%xmm0</span></div><div class="t m5 x3e h2d y3655 ff6 fs20 fc6 sc0 ls0 ws0">16<span class="_ _45"> </span><span class="ffd fs1e fc2">vcvtps2pd<span class="_ _6f"> </span>%xmm0,<span class="_ _1f"> </span>%xmm0<span class="_ _152"> </span></span><span class="ff13 fs35">Convert<span class="_ _f"> </span>to<span class="_ _e"> </span>double</span></div><div class="t m5 x3e h2d y3656 ff6 fs20 fc6 sc0 ls0 ws0">17<span class="_ _45"> </span><span class="ffd fs1e fc2">ret<span class="_ _19c"> </span></span><span class="ff13 fs35">Return</span></div><div class="t m5 x1d h26 y3657 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>rom<span class="_"> </span>this<span class="_ _1"></span>,<span class="_"> </span>we<span class="_"> </span>can<span class="_"> </span>write<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>code<span class="_"> </span>for<span class="_"> </span><span class="ffd">funct3</span>:</div><div class="t m5 x1d h2d y3658 ffd fs1e fc2 sc0 ls0 ws0">double<span class="_ _e"> </span>funct3(int<span class="_ _1f"> </span>*ap,<span class="_ _1f"> </span>double<span class="_ _e"> </span>b,<span class="_ _1f"> </span>long<span class="_ _e"> </span>c,<span class="_ _1f"> </span>float<span class="_ _1f"> </span>*dp)<span class="_ _e"> </span>{</div><div class="t m5 x10c h2d y3659 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>a<span class="_ _1f"> </span>=<span class="_ _1f"> </span>*ap;</div><div class="t m5 x10c h2d y365a ffd fs1e fc2 sc0 ls0 ws0">float<span class="_ _e"> </span>d<span class="_ _1f"> </span>=<span class="_ _1f"> </span>*dp;</div><div class="t m5 x10c h2d y365b ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>(a<span class="_ _1f"> </span>&lt;<span class="_ _1f"> </span>b)</div><div class="t m5 x22b h2d y365c ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>c*d;</div><div class="t m5 x10c h2d y365d ffd fs1e fc2 sc0 ls0 ws0">else</div><div class="t m5 x22b h2d y365e ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>c+2*d;</div><div class="t m5 x1d h2d y365f ffd fs1e fc2 sc0 ls0 ws0">}</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
