<div id="pf36" class="pf w2 h11" data-page-no="36"><div class="pc pc36 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg36.png"/><div class="t m5 x68 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>1.7<span class="_ _3d"> </span>The<span class="_ _13"> </span>Operating<span class="_ _10"> </span>System<span class="_ _10"> </span>Manages<span class="_ _10"> </span>the<span class="_ _10"> </span>Hardware<span class="_ _3e"> </span><span class="ffe fs1e">53</span></div><div class="t m5 x17 h2f ye7 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>1.12</div><div class="t m5 x17 h2f y58a ffe fs16 fc1 sc0 ls0 ws0">Process<span class="_ _f"> </span>context</div><div class="t m5 x17 h2f y58b ffe fs16 fc1 sc0 ls0 ws0">switching.</div><div class="t m5 xd8 h3f y727 ff15 fs27 fc1 sc0 ls0 ws5">Process A</div><div class="t m5 xd9 h40 y728 ff16 fs28 fc1 sc0 ls0 ws0">read</div><div class="t m5 xda h3f y727 ff15 fs27 fc1 sc0 ls0 ws0">Process B</div><div class="t m5 x43 h3f y729 ff15 fs27 fc1 sc0 ls0 ws0">User code</div><div class="t m5 x43 h3f y72a ff15 fs27 fc1 sc0 ls0 ws0">Kernel code</div><div class="t m5 x43 h3f y72b ff15 fs27 fc1 sc0 ls0 ws0">Kernel code</div><div class="t m5 x43 h3f y72c ff15 fs27 fc1 sc0 ls0 ws0">User code</div><div class="t m5 x43 h3f y72d ff15 fs27 fc1 sc0 ls0 ws0">User code</div><div class="t m5 xdb h3f y72e ff15 fs27 fc1 sc0 ls0 ws0">Context</div><div class="t m5 xdb h3f y72f ff15 fs27 fc1 sc0 ls0 ws0">switch</div><div class="t m5 xdb h3f y730 ff15 fs27 fc1 sc0 ls0 ws0">Context</div><div class="t m5 xdb h3f y731 ff15 fs27 fc1 sc0 ls0 ws0">switch</div><div class="t m5 xb3 h3f y732 ff15 fs27 fc1 sc0 ls0 ws0">T<span class="_ _0"></span>ime</div><div class="t m5 xdc h3f y733 ff15 fs27 fc1 sc0 ls0 ws0">Disk interrupt</div><div class="t m5 xdd h3f y734 ff15 fs27 fc1 sc0 ls0 ws0">Return</div><div class="t m5 x90 h40 y735 ff15 fs27 fc1 sc0 ls0 ws0">from <span class="ff16 fs28">read</span></div><div class="t m5 x17 h26 y736 ff7 fs19 fc1 sc0 ls0 ws0">then<span class="_"> </span>passing<span class="_"> </span>control<span class="_"> </span>to<span class="_ _11"> </span>the<span class="_"> </span>new<span class="_"> </span>process<span class="_ _1"></span>.<span class="_ _11"> </span>T<span class="_ _1"></span>he<span class="_ _11"> </span>new<span class="_"> </span>process<span class="_"> </span>picks<span class="_ _11"> </span>up<span class="_"> </span>exactly<span class="_"> </span>where</div><div class="t m5 x17 h26 y737 ff7 fs19 fc1 sc0 ls0 ws0">it<span class="_"> </span>left<span class="_"> </span>off<span class="_ _1"></span>.<span class="_"> </span>F<span class="_ _0"></span>igure<span class="_"> </span>1.12<span class="_"> </span>shows<span class="_"> </span>the<span class="_"> </span>basic<span class="_"> </span>idea<span class="_"> </span>for<span class="_"> </span>our<span class="_"> </span>example<span class="_"> </span><span class="ffd">hello<span class="_ _10"> </span></span>scenario<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y738 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>here<span class="_ _13"> </span>are<span class="_ _13"> </span>two<span class="_ _13"> </span>concurrent<span class="_ _13"> </span>processes<span class="_ _13"> </span>in<span class="_ _6"> </span>our<span class="_ _13"> </span>example<span class="_ _13"> </span>scenario:<span class="_ _13"> </span>the<span class="_ _13"> </span>shell<span class="_ _13"> </span>process</div><div class="t m5 x17 h26 y739 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _6"> </span>the<span class="_ _13"> </span><span class="ffd">hello<span class="_ _6"> </span></span>process<span class="_ _1"></span>.<span class="_ _6"> </span>Initially<span class="_ _3"></span>,<span class="_ _13"> </span>the<span class="_ _6"> </span>shell<span class="_ _13"> </span>process<span class="_ _6"> </span>is<span class="_ _6"> </span>running<span class="_ _13"> </span>alone<span class="_ _1"></span>,<span class="_ _13"> </span>waiting<span class="_ _6"> </span>for<span class="_ _6"> </span>input</div><div class="t m5 x17 h26 y73a ff7 fs19 fc1 sc0 ls0 ws0">on<span class="_"> </span>the<span class="_"> </span>command<span class="_"> </span>line<span class="_ _1"></span>.<span class="_"> </span>When<span class="_ _13"> </span>we<span class="_"> </span>ask<span class="_"> </span>it<span class="_"> </span>to<span class="_"> </span>run<span class="_"> </span>the<span class="_"> </span><span class="ffd">hello<span class="_ _10"> </span></span>program,<span class="_"> </span>the<span class="_"> </span>shell<span class="_"> </span>carries</div><div class="t m5 x17 h26 y73b ff7 fs19 fc1 sc0 ls0 ws0">out<span class="_"> </span>our<span class="_"> </span>request<span class="_"> </span>by<span class="_"> </span>invoking<span class="_ _11"> </span>a<span class="_"> </span>special<span class="_"> </span>function<span class="_"> </span>known<span class="_ _11"> </span>as<span class="_"> </span>a<span class="_"> </span><span class="ffa">system<span class="_"> </span>call<span class="_ _16"> </span></span>that<span class="_"> </span>passes</div><div class="t m5 x17 h26 y73c ff7 fs19 fc1 sc0 ls0 ws0">control<span class="_ _16"> </span>to<span class="_ _16"> </span>the<span class="_ _16"> </span>operating<span class="_ _16"> </span>system.<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span>operating<span class="_ _16"> </span>system<span class="_ _16"> </span>saves<span class="_ _16"> </span>the<span class="_ _16"> </span>shell’s<span class="_ _16"> </span>context,</div><div class="t m5 x17 h26 y73d ff7 fs19 fc1 sc0 ls0 ws0">creates<span class="_ _11"> </span>a<span class="_ _16"> </span>new<span class="_ _11"> </span><span class="ffd">hello<span class="_ _11"> </span></span>process<span class="_ _16"> </span>and<span class="_ _11"> </span>its<span class="_ _16"> </span>context,<span class="_ _11"> </span>and<span class="_ _16"> </span>then<span class="_ _11"> </span>passes<span class="_ _11"> </span>control<span class="_ _16"> </span>to<span class="_ _11"> </span>the<span class="_ _11"> </span>new</div><div class="t m5 x17 h26 y73e ffd fs19 fc1 sc0 ls0 ws0">hello<span class="_ _10"> </span><span class="ff7">process<span class="_ _3"></span>.<span class="_"> </span>After<span class="_"> </span><span class="ffd">hello<span class="_ _10"> </span></span>terminates<span class="_ _3"></span>,<span class="_"> </span>the<span class="_"> </span>operating<span class="_"> </span>system<span class="_ _13"> </span>restores<span class="_"> </span>the<span class="_"> </span>context</span></div><div class="t m5 x17 h26 y73f ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_ _15"> </span>the<span class="_ _21"> </span>shell<span class="_ _21"> </span>process<span class="_ _21"> </span>and<span class="_ _21"> </span>passes<span class="_ _21"> </span>control<span class="_ _21"> </span>back<span class="_ _21"> </span>to<span class="_ _21"> </span>it,<span class="_ _f"> </span>where<span class="_ _21"> </span>it<span class="_ _21"> </span>waits<span class="_ _15"> </span>for<span class="_ _21"> </span>the<span class="_ _21"> </span>next</div><div class="t m5 x17 h26 y740 ff7 fs19 fc1 sc0 ls0 ws0">command-line<span class="_"> </span>input.</div><div class="t m5 x26 h26 y741 ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_ _11"> </span>Figure<span class="_"> </span>1.12<span class="_ _16"> </span>indicates<span class="_ _1"></span>,<span class="_ _16"> </span>the<span class="_ _11"> </span>transition<span class="_ _16"> </span>from<span class="_ _11"> </span>one<span class="_ _11"> </span>process<span class="_ _16"> </span>to<span class="_ _11"> </span>another<span class="_ _16"> </span>is<span class="_ _11"> </span>man-</div><div class="t m5 x17 h26 y742 ff7 fs19 fc1 sc0 ls0 ws0">aged<span class="_ _11"> </span>by<span class="_ _11"> </span>the<span class="_ _16"> </span>operating<span class="_ _11"> </span>system<span class="_ _11"> </span><span class="ffa">kernel<span class="_ _5"></span></span>.<span class="_ _23"> </span>T<span class="_ _1"></span>he<span class="_ _11"> </span>kernel<span class="_ _16"> </span>is<span class="_ _11"> </span>the<span class="_ _11"> </span>portion<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>operating</div><div class="t m5 x17 h26 y743 ff7 fs19 fc1 sc0 ls0 ws0">system<span class="_ _15"> </span>code<span class="_ _15"> </span>that<span class="_ _21"> </span>is<span class="_ _15"> </span>always<span class="_ _15"> </span>resident<span class="_ _21"> </span>in<span class="_ _15"> </span>memory<span class="_ _3"></span>.<span class="_ _15"> </span>When<span class="_ _15"> </span>an<span class="_ _15"> </span>application<span class="_ _15"> </span>program</div><div class="t m5 x17 h26 y744 ff7 fs19 fc1 sc0 ls0 ws0">requires<span class="_ _16"> </span>some<span class="_ _14"> </span>action<span class="_ _16"> </span>by<span class="_ _14"> </span>the<span class="_ _16"> </span>operating<span class="_ _14"> </span>system,<span class="_ _14"> </span>such<span class="_ _16"> </span>as<span class="_ _14"> </span>to<span class="_ _16"> </span>read<span class="_ _14"> </span>or<span class="_ _16"> </span>write<span class="_ _14"> </span>a<span class="_ _16"> </span>ﬁle,<span class="_ _16"> </span>it</div><div class="t m5 x17 h26 y745 ff7 fs19 fc1 sc0 ls0 ws0">executes<span class="_ _11"> </span>a<span class="_ _11"> </span>special<span class="_ _11"> </span><span class="ffa">system<span class="_ _16"> </span>call<span class="_ _16"> </span></span>instruction,<span class="_ _11"> </span>transferring<span class="_ _11"> </span>control<span class="_ _16"> </span>to<span class="_"> </span>the<span class="_ _16"> </span>kernel.<span class="_ _11"> </span>T<span class="_ _1"></span>he</div><div class="t m5 x17 h26 y746 ff7 fs19 fc1 sc0 ls0 ws0">kernel<span class="_ _13"> </span>then<span class="_"> </span>performs<span class="_ _13"> </span>the<span class="_ _13"> </span>requested<span class="_ _13"> </span>operation<span class="_"> </span>and<span class="_ _13"> </span>returns<span class="_ _13"> </span>back<span class="_ _13"> </span>to<span class="_"> </span>the<span class="_ _13"> </span>application</div><div class="t m5 x17 h26 y747 ff7 fs19 fc1 sc0 ls0 ws0">program.<span class="_"> </span>Note<span class="_"> </span>that<span class="_"> </span>the<span class="_ _11"> </span>kernel<span class="_"> </span>is<span class="_"> </span>not<span class="_"> </span>a<span class="_ _11"> </span>separate<span class="_"> </span>process<span class="_ _1"></span>.<span class="_"> </span>Instead,<span class="_ _11"> </span>it<span class="_"> </span>is<span class="_"> </span>a<span class="_"> </span>collection</div><div class="t m5 x17 h26 y748 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span>code<span class="_"> </span>and<span class="_"> </span>data<span class="_"> </span>structures<span class="_"> </span>that<span class="_"> </span>the<span class="_"> </span>system<span class="_"> </span>uses<span class="_"> </span>to<span class="_"> </span>manage<span class="_"> </span>all<span class="_"> </span>the<span class="_"> </span>processes<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y749 ff7 fs19 fc1 sc0 ls0 ws0">Implementing<span class="_ _21"> </span>the<span class="_ _21"> </span>process<span class="_ _21"> </span>abstraction<span class="_ _21"> </span>requires<span class="_ _21"> </span>close<span class="_ _21"> </span>cooperation<span class="_ _f"> </span>between</div><div class="t m5 x17 h26 y74a ff7 fs19 fc1 sc0 ls0 ws0">both<span class="_ _11"> </span>the<span class="_ _11"> </span>low-level<span class="_ _11"> </span>hardware<span class="_ _11"> </span>and<span class="_ _11"> </span>the<span class="_ _11"> </span>operating<span class="_ _11"> </span>system<span class="_ _11"> </span>software<span class="_ _0"></span>.<span class="_"> </span>W<span class="_ _1"></span>e<span class="_ _11"> </span>will<span class="_ _11"> </span>explore</div><div class="t m5 x17 h26 y74b ff7 fs19 fc1 sc0 ls0 ws0">how<span class="_"> </span>this<span class="_ _13"> </span>works<span class="_ _0"></span>,<span class="_"> </span>and<span class="_"> </span>how<span class="_ _13"> </span>applications<span class="_"> </span>can<span class="_"> </span>create<span class="_ _13"> </span>and<span class="_"> </span>control<span class="_"> </span>their<span class="_"> </span>own<span class="_ _13"> </span>processes<span class="_ _1"></span>,</div><div class="t m5 x17 h26 y74c ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_"> </span>Chapter<span class="_"> </span>8.</div><div class="t m5 x17 h41 y74d ffe fs29 fc1 sc0 ls0 ws0">1.7.2<span class="_ _48"> </span><span class="fs19">Threads</span></div><div class="t m5 x17 h26 y74e ff7 fs19 fc1 sc0 ls0 ws0">Although<span class="_ _13"> </span>we<span class="_ _6"> </span>normally<span class="_ _13"> </span>think<span class="_ _6"> </span>of<span class="_ _13"> </span>a<span class="_ _6"> </span>process<span class="_ _13"> </span>as<span class="_ _13"> </span>having<span class="_ _6"> </span>a<span class="_ _13"> </span>single<span class="_ _6"> </span>control<span class="_ _13"> </span>ﬂow<span class="_ _7"></span>,<span class="_ _13"> </span>in<span class="_ _13"> </span>modern</div><div class="t m5 x17 h26 y74f ff7 fs19 fc1 sc0 ls0 ws0">systems<span class="_"> </span>a<span class="_ _11"> </span>process<span class="_ _11"> </span>can<span class="_"> </span>actually<span class="_ _11"> </span>consist<span class="_ _11"> </span>of<span class="_ _11"> </span>multiple<span class="_"> </span>execution<span class="_ _11"> </span>units<span class="_ _1"></span>,<span class="_ _11"> </span>called<span class="_ _11"> </span><span class="ffa">threads</span>,</div><div class="t m5 x17 h26 y750 ff7 fs19 fc1 sc0 ls0 ws0">each<span class="_"> </span>running<span class="_ _11"> </span>in<span class="_"> </span>the<span class="_ _11"> </span>context<span class="_ _11"> </span>of<span class="_"> </span>the<span class="_ _11"> </span>process<span class="_ _11"> </span>and<span class="_"> </span>sharing<span class="_ _11"> </span>the<span class="_ _11"> </span>same<span class="_"> </span>code<span class="_ _11"> </span>and<span class="_ _11"> </span>global</div><div class="t m5 x17 h26 y751 ff7 fs19 fc1 sc0 ls0 ws0">data.<span class="_ _11"> </span>T<span class="_ _0"></span>hreads<span class="_ _11"> </span>are<span class="_ _11"> </span>an<span class="_ _16"> </span>increasingly<span class="_"> </span>important<span class="_ _16"> </span>programming<span class="_ _11"> </span>model<span class="_ _11"> </span>because<span class="_ _11"> </span>of<span class="_ _16"> </span>the</div><div class="t m5 x17 h26 y752 ff7 fs19 fc1 sc0 ls0 ws0">requirement<span class="_"> </span>for<span class="_ _13"> </span>concurrency<span class="_ _13"> </span>in<span class="_"> </span>network<span class="_ _13"> </span>servers<span class="_ _1"></span>,<span class="_"> </span>because<span class="_"> </span>it<span class="_ _13"> </span>is<span class="_"> </span>easier<span class="_ _13"> </span>to<span class="_"> </span>share<span class="_ _13"> </span>data</div><div class="t m5 x17 h26 y753 ff7 fs19 fc1 sc0 ls0 ws0">between<span class="_ _11"> </span>multiple<span class="_ _11"> </span>threads<span class="_ _11"> </span>than<span class="_"> </span>between<span class="_ _11"> </span>multiple<span class="_ _11"> </span>processes<span class="_ _0"></span>,<span class="_ _11"> </span>and<span class="_ _11"> </span>because<span class="_ _11"> </span>threads</div><div class="t m5 x17 h26 y754 ff7 fs19 fc1 sc0 ls0 ws0">are<span class="_ _6"> </span>typically<span class="_ _6"> </span>more<span class="_ _6"> </span>efﬁcient<span class="_ _6"> </span>than<span class="_ _6"> </span>processes<span class="_ _1"></span>.<span class="_ _6"> </span>Multi-threading<span class="_ _6"> </span>is<span class="_ _6"> </span>also<span class="_ _6"> </span>one<span class="_ _6"> </span>way<span class="_ _6"> </span>to<span class="_ _6"> </span>make</div><div class="t m5 x17 h26 y755 ff7 fs19 fc1 sc0 ls0 ws0">programs<span class="_"> </span>run<span class="_ _11"> </span>faster<span class="_ _11"> </span>when<span class="_ _11"> </span>multiple<span class="_"> </span>processors<span class="_ _11"> </span>are<span class="_ _11"> </span>available<span class="_ _0"></span>,<span class="_ _11"> </span>as<span class="_"> </span>we<span class="_ _11"> </span>will<span class="_ _11"> </span>discuss<span class="_ _11"> </span>in</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
