<div id="pf1df" class="pf w2 h11" data-page-no="1df"><div class="pc pc1df w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1df.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">478<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>4<span class="_ _3d"> </span>Processor<span class="_ _10"> </span>Architecture</span></div><div class="t m5 x118 h40 y42a8 ff49 fs27 fc1 sc0 ls0 ws0">W_dstE = <span class="ff4a fs28">%rbx</span></div><div class="t m5 x118 h3f y42a9 ff49 fs27 fc1 sc0 ls0 ws0">W_valE = 10</div><div class="t m5 x1df h3f y42aa ff49 fs27 fc1 sc0 ls0 ws0">W</div><div class="t m5 x118 h40 y42ab ff49 fs27 fc1 sc0 ls0 ws0">M_dstM = <span class="ff4a fs28">%rax</span></div><div class="t m5 x118 h3f y42ac ff49 fs27 fc1 sc0 ls0 ws0">m_valM   <span class="ff4c">   </span>M[128] = 3</div><div class="t m5 x1aa h3f y42ad ff49 fs27 fc1 sc0 ls0 ws0">M</div><div class="t m5 x1f7 h40 y42ae ff49 fs27 fc1 sc0 ls0 ws0">F<span class="_ _1c9"></span><span class="ff4a fs28">0x000: irmovq $128,%rdx</span></div><div class="t m5 x14 h40 y42af ff4a fs28 fc1 sc0 ls0 ws0">0x00a: irmovq  $3,%rcx</div><div class="t m5 x14 h40 y42b0 ff4a fs28 fc1 sc0 ls0 ws0">0x014: rmmovq %rcx, 0(%rdx)</div><div class="t m5 x14 h40 y42b1 ff4a fs28 fc1 sc0 ls0 ws0">0x01e: irmovq $10,%rbx</div><div class="t m5 x14 h40 y42b2 ff4a fs28 fc1 sc0 ls0 ws0">0x028: mrmovq 0(%rdx),%rax <span class="fc6"># Load %rax</span></div><div class="t m5 x14 h40 y42b3 ff4a fs28 fc1 sc0 ls0 ws0">0x032: addq %rbx,%rax <span class="fc6"># Use %rax</span></div><div class="t m5 x14 h40 y42b4 ff4a fs28 fc1 sc0 ls0 ws0">0x034: halt</div><div class="t m5 x14 h40 y42b5 ff4a fs28 fc1 sc0 ls0 ws0"># prog5</div><div class="c x14 y42b6 wd hb9"><div class="t m5 x0 h40 y42b7 ff4a fs28 fc3 sc1 ls0 ws0"># prog5</div></div><div class="t m5 x89 h3f y42ae ff49 fs27 fc1 sc0 ls1d6 ws0">DE<span class="_ _1"></span>M<span class="_ _4"></span>W</div><div class="t m5 x89 h3f y42b8 ff49 fs27 fc1 sc0 ls1ca ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x110 h3f y42b9 ff49 fs27 fc1 sc0 ls1c8 ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 xd9 h3f y42ba ff49 fs27 fc1 sc0 ls1c8 ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x17c h3f y42bb ff49 fs27 fc1 sc0 ls1c8 ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x6a h3f y42bc ff49 fs27 fc1 sc0 ls1e6 ws0">EM<span class="_ _7"></span>W</div><div class="t m5 x12d h3f y42bd ff49 fs27 fc1 sc0 ls0 ws0">D<span class="_ _100"></span><span class="ls1e7">FD<span class="_ _b8"></span>E<span class="_ _1cc"></span>M<span class="_ _164"></span>W</span></div><div class="t m5 x6a h3f y42be ff49 fs27 fc1 sc0 ls0 ws0">F<span class="_ _1cd"></span><span class="ls1e8">FD<span class="_ _194"></span>E<span class="_ _1cc"></span>M<span class="_ _1ce"></span>W</span></div><div class="t m5 xc1 h44 y42bf ff49 fs2a fc6 sc0 ls1d7 ws0">12345</div><div class="t m5 xb1 h44 y42c0 ff49 fs2a fc6 sc0 ls0 ws0">6</div><div class="t m5 x1c2 h44 y42c1 ff49 fs2a fc6 sc0 ls0 ws0">7</div><div class="t m5 x60 h44 y42c2 ff49 fs2a fc6 sc0 ls0 ws0">8</div><div class="t m5 x22f h44 y42c3 ff49 fs2a fc6 sc0 ls1e9 ws0">91<span class="_ _1c5"></span>0<span class="_ _2"></span>1<span class="_ _c5"></span>1<span class="_ _4"></span>1<span class="_ _1c5"></span>2</div><div class="t m5 x1df h3f y42c4 ff49 fs27 fc1 sc0 ls0 ws0">D</div><div class="t m5 x118 h3f y42c5 ff49 fs27 fc1 sc0 ls0 ws0">valA<span class="_ _1"></span>      W_valE = 10</div><div class="t m5 x118 h3f y42c6 ff49 fs27 fc1 sc0 ls0 ws0">valB      m_valM = 3</div><div class="t m5 x1bc h3f y42c7 ff49 fs27 fc1 sc0 ls0 ws0">Cycle 8</div><div class="t m8 xf9 h3f y42c8 ff49 fs27 fc1 sc0 ls0 ws0">. . .</div><div class="t mc x25a hba y42c9 ff4a fs73 fc1 sc0 ls0 ws0">bubble</div><div class="c x14 y42b6 wd hb9"><div class="t mc x25b hba y42ca ff4a fs73 fc3 sc1 ls0 ws0">bubble</div></div><div class="t m5 x14 h3a y42cb ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>4.54<span class="_ _c"> </span><span class="fc1">Handling<span class="_ _11"> </span>a<span class="_ _11"> </span>load/use<span class="_ _16"> </span>hazard<span class="_"> </span>by<span class="_ _11"> </span>stalling.<span class="_ _11"> </span><span class="ff6">By<span class="_ _11"> </span>stalling<span class="_ _11"> </span>the<span class="_ _11"> </span><span class="ffd fs19">addq<span class="_ _16"> </span></span>instruction<span class="_ _10"> </span>for<span class="_ _16"> </span>one<span class="_ _10"> </span>cycle<span class="_ _16"> </span>in<span class="_ _10"> </span>the</span></span></div><div class="t m5 x14 h34 y42cc ff6 fs16 fc1 sc0 ls0 ws0">decode<span class="_ _11"> </span>stage,<span class="_ _11"> </span>the<span class="_ _11"> </span>value<span class="_ _11"> </span>for<span class="_ _11"> </span>valB<span class="_ _11"> </span>can<span class="_ _11"> </span>be<span class="_ _11"> </span>forwarded<span class="_ _11"> </span>from<span class="_ _11"> </span>the</div><div class="t m5 x139 h3a y42cd ffd fs19 fc1 sc0 ls0 ws0">mrmovq<span class="_ _11"> </span><span class="ff6 fs16">instruction<span class="_ _11"> </span>in<span class="_ _11"> </span>the<span class="_ _11"> </span>memory<span class="_ _11"> </span>stage<span class="_ _11"> </span>to<span class="_ _11"> </span>the</span></div><div class="t m5 x14 h3a y42ce ffd fs19 fc1 sc0 ls0 ws0">addq<span class="_ _10"> </span><span class="ff6 fs16">instruction<span class="_ _11"> </span>in<span class="_ _10"> </span>the<span class="_ _10"> </span>decode<span class="_ _11"> </span>stage.</span></div><div class="t m5 x1d h2d y42cf ffd fs1e fc2 sc0 ls0 ws0">0x000:<span class="_ _46"> </span>irmovq<span class="_ _e"> </span>stack,%rsp<span class="_ _1a"> </span>#<span class="_ _3f"> </span>Initialize<span class="_ _1f"> </span>stack<span class="_ _1f"> </span>pointer</div><div class="t m5 x1d h2d y42d0 ffd fs1e fc2 sc0 ls0 ws0">0x00a:<span class="_ _46"> </span>call<span class="_ _e"> </span>proc<span class="_ _86"> </span>#<span class="_ _3f"> </span>Procedure<span class="_ _1f"> </span>call</div><div class="t m5 x1d h2d y42d1 ffd fs1e fc2 sc0 ls0 ws0">0x013:<span class="_ _46"> </span>irmovq<span class="_ _e"> </span>$10,%rdx<span class="_ _46"> </span>#<span class="_ _3f"> </span>Return<span class="_ _1f"> </span>point</div><div class="t m5 x1d h2d y42d2 ffd fs1e fc2 sc0 ls0 ws0">0x01d:<span class="_ _46"> </span>halt</div><div class="t m5 x1d h2d y42d3 ffd fs1e fc2 sc0 ls0 ws0">0x020:<span class="_ _e"> </span>.pos<span class="_ _1f"> </span>0x20</div><div class="t m5 x1d h2d y42d4 ffd fs1e fc2 sc0 ls0 ws0">0x020:<span class="_ _e"> </span>proc:<span class="_ _15a"> </span>#<span class="_ _1f"> </span>proc:</div><div class="t m5 x1d h2d y42d5 ffd fs1e fc2 sc0 ls0 ws0">0x020:<span class="_ _46"> </span>ret<span class="_ _12a"> </span>#<span class="_ _3f"> </span>Return<span class="_ _e"> </span>immediately</div><div class="t m5 x1d h2d y42d6 ffd fs1e fc2 sc0 ls0 ws0">0x021:<span class="_ _46"> </span>rrmovq<span class="_ _e"> </span>%rdx,%rbx<span class="_ _3f"> </span>#<span class="_ _3f"> </span>Not<span class="_ _1f"> </span>executed</div><div class="t m5 x1d h2d y42d7 ffd fs1e fc2 sc0 ls0 ws0">0x030:<span class="_ _e"> </span>.pos<span class="_ _1f"> </span>0x30</div><div class="t m5 x1d h2d y42d8 ffd fs1e fc2 sc0 ls0 ws0">0x030:<span class="_ _e"> </span>stack:<span class="_ _12a"> </span>#<span class="_ _1f"> </span>stack:<span class="_ _e"> </span>Stack<span class="_ _1f"> </span>pointer</div><div class="t m5 x29 h26 y27d ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _16"> </span>4.55<span class="_ _16"> </span>shows<span class="_ _16"> </span>how<span class="_ _16"> </span>we<span class="_ _14"> </span>want<span class="_ _16"> </span>the<span class="_ _16"> </span>pipeline<span class="_ _16"> </span>to<span class="_ _16"> </span>process<span class="_ _16"> </span>the<span class="_ _16"> </span><span class="ffd">ret<span class="_ _16"> </span></span>instruction.</div><div class="t m5 x1d h26 y27e ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_"> </span>with<span class="_"> </span>our<span class="_"> </span>earlier<span class="_ _11"> </span>pipeline<span class="_"> </span>diagrams<span class="_ _1"></span>,<span class="_"> </span>this<span class="_ _11"> </span>Ô¨Ågure<span class="_"> </span>shows<span class="_"> </span>the<span class="_"> </span>pipeline<span class="_ _11"> </span>activity<span class="_"> </span>with</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
