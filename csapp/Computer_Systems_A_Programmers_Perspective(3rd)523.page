<div id="pf20b" class="pf w2 h11" data-page-no="20b"><div class="pc pc20b w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg20b.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">522<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>4<span class="_ _3d"> </span>Processor<span class="_ _10"> </span>Architecture</span></div><div class="t m5 x1d h28 y9c ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>4.14<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>426)</span></div><div class="t m5 x1d h26 y1d16 ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_"> </span>can<span class="_"> </span>see<span class="_ _13"> </span>that<span class="_"> </span>the<span class="_"> </span>instruction<span class="_ _13"> </span>is<span class="_"> </span>located<span class="_"> </span>at<span class="_"> </span>address<span class="_ _13"> </span><span class="ffd">0x02c<span class="_ _10"> </span></span>and<span class="_"> </span>consists<span class="_ _13"> </span>of<span class="_"> </span>2<span class="_"> </span>bytes</div><div class="t m5 x1d h26 y1d17 ff7 fs19 fc1 sc0 ls0 ws0">with<span class="_ _13"> </span>values<span class="_ _13"> </span><span class="ffd">0xb0<span class="_ _13"> </span></span>and<span class="_ _13"> </span><span class="ffd">0x00f</span>.<span class="_"> </span>Register<span class="_ _13"> </span><span class="ffd">%rsp<span class="_ _13"> </span></span>was<span class="_ _13"> </span>set<span class="_ _13"> </span>to<span class="_ _13"> </span>120<span class="_ _13"> </span>by<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ffd">pushq<span class="_ _13"> </span></span>instruction</div><div class="t m5 x1d h26 y1d18 ff7 fs19 fc1 sc0 ls0 ws0">(line<span class="_"> </span>6),<span class="_"> </span>which<span class="_"> </span>also<span class="_"> </span>stored<span class="_"> </span>9<span class="_"> </span>at<span class="_"> </span>this<span class="_"> </span>memory<span class="_"> </span>location.</div><div class="t m5 x50 h31 y485b ff7 fs21 fc2 sc0 ls0 ws0">Generic<span class="_ _15a"> </span>Speciﬁc</div><div class="t m5 x1d h31 y485c ff7 fs21 fc2 sc0 ls0 ws0">Stage</div><div class="t m5 x50 h93 y485d ffd fs1e fc2 sc0 ls0 ws0">popq<span class="_ _11"> </span><span class="ff6 fs21">rA<span class="_ _99"> </span></span>popq<span class="_ _11"> </span>%rax</div><div class="t m5 x1d h32 y485e ff7 fs21 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>etch<span class="_ _55"> </span><span class="ff6">icode<span class="_ _a"> </span></span>:<span class="_ _be"></span><span class="ff6">ifun<span class="_ _23"> </span><span class="ff12">←<span class="_ _25"> </span></span>M</span></div><div class="t m5 x1b1 h33 y485f ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x119 h32 y4860 ff7 fs21 fc2 sc0 ls0 ws0">[<span class="ff6">PC</span>]<span class="_ _74"> </span><span class="ff6">icode<span class="_ _a"> </span></span>:<span class="_ _be"></span><span class="ff6">ifun<span class="_ _23"> </span><span class="ff12">←<span class="_ _25"> </span></span>M</span></div><div class="t m5 x1f3 h33 y485f ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x13e h32 y4860 ff7 fs21 fc2 sc0 ls0 ws0">[<span class="ffd fs1e">0x02c</span>]<span class="_ _6"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ffd fs1e">b:0</span></span></div><div class="t m5 x50 h32 y4861 ff6 fs21 fc2 sc0 ls0 ws0">rA<span class="_ _6"> </span><span class="ff7">:<span class="_ _be"></span></span>rB<span class="_ _25"> </span><span class="ff12">←<span class="_ _23"> </span></span>M</div><div class="t m5 x9e h33 y4862 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x68 h32 y4863 ff7 fs21 fc2 sc0 ls0 ws0">[<span class="ff6">PC<span class="_ _13"> </span><span class="ff12">+<span class="_ _13"> </span></span></span>1]<span class="_ _5c"> </span><span class="ff6">rA<span class="_ _6"> </span></span>:<span class="_ _a"> </span><span class="ff6">rB<span class="_ _23"> </span><span class="ff12">←<span class="_ _25"> </span></span>M</span></div><div class="t m5 x11b h33 y4862 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x1c3 h32 y4863 ff7 fs21 fc2 sc0 ls0 ws0">[<span class="ffd fs1e">0x02d</span>]<span class="_ _6"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ffd fs1e">0:f</span></span></div><div class="t m5 x50 h32 y4864 ff6 fs21 fc2 sc0 ls0 ws0">valP<span class="_ _23"> </span><span class="ff12">←<span class="_ _25"> </span></span>PC<span class="_ _13"> </span><span class="ff12">+<span class="_ _13"> </span><span class="ff7">2<span class="_ _69"> </span></span></span>valP<span class="_ _25"> </span><span class="ff12">←<span class="_ _23"> </span><span class="ffd fs1e">0x02c<span class="_ _13"> </span></span>+<span class="_ _10"> </span><span class="ff7">2<span class="_ _13"> </span></span>=<span class="_ _13"></span><span class="ffd fs1e">0x02e</span></span></div><div class="t m5 x1d h32 y4865 ff7 fs21 fc2 sc0 ls0 ws0">Decode<span class="_ _bd"> </span><span class="ff6">valA<span class="_ _25"> </span><span class="ff12">←<span class="_ _25"> </span></span>R</span>[<span class="ffd fs1e">%rsp</span>]<span class="_ _55"> </span><span class="ff6">valA<span class="_ _25"> </span><span class="ff12">←<span class="_ _25"> </span></span>R</span>[<span class="ffd fs1e">%rsp</span>]<span class="_ _6"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ffd fs1e">120</span></span></div><div class="t m5 x50 h32 y4866 ff6 fs21 fc2 sc0 ls0 ws0">valB<span class="_ _23"> </span><span class="ff12">←<span class="_ _25"> </span></span>R<span class="ff7">[<span class="ffd fs1e">%rsp</span>]<span class="_ _54"> </span></span>valB<span class="_ _25"> </span><span class="ff12">←<span class="_ _23"> </span></span>R<span class="_ _2"></span><span class="ff7">[<span class="ffd fs1e">%rsp</span>]<span class="_ _6"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ffd fs1e">120</span></span></span></div><div class="t m5 x1d h32 y4867 ff7 fs21 fc2 sc0 ls0 ws0">Execute<span class="_ _f4"> </span><span class="ff6">valE<span class="_ _25"> </span><span class="ff12">←<span class="_ _23"> </span></span>valB<span class="_ _13"> </span><span class="ff12">+<span class="_ _13"> </span></span></span>8<span class="_ _55"> </span><span class="ff6">valE<span class="_ _25"> </span><span class="ff12">←<span class="_ _25"> </span><span class="ffd fs1e">120<span class="_ _13"> </span></span>+<span class="_ _13"> </span></span></span>8<span class="_"> </span><span class="ff12">=<span class="_ _13"></span><span class="ffd fs1e">128</span></span></div><div class="t m5 x1d h32 y4868 ff7 fs21 fc2 sc0 ls0 ws0">Memory<span class="_ _88"> </span><span class="ff6">valM<span class="_ _22"> </span><span class="ff12">←<span class="_ _25"> </span></span>M</span></div><div class="t m5 x241 h33 y4869 ff7 fs20 fc2 sc0 ls0 ws0">8</div><div class="t m5 x67 h32 y4868 ff7 fs21 fc2 sc0 ls0 ws0">[<span class="ff6">valA<span class="_ _2"></span></span>]<span class="_ _148"> </span><span class="ff6">valM<span class="_ _23"> </span><span class="ff12">←<span class="_ _23"> </span></span>M</span></div><div class="t m5 x108 h33 y4869 ff7 fs20 fc2 sc0 ls0 ws0">8</div><div class="t m5 xf3 h32 y4868 ff7 fs21 fc2 sc0 ls0 ws0">[<span class="ffd fs1e">120</span>]<span class="_ _6"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ffd fs1e">9</span></span></div><div class="t m5 x1d h31 y486a ff7 fs21 fc2 sc0 ls0 ws0">Write<span class="_"> </span>back<span class="_ _4f"> </span><span class="ff6">R</span>[<span class="ffd fs1e">%rsp</span></div><div class="t m5 xed h32 y486b ff7 fs21 fc2 sc0 ls0 ws0">]<span class="_ _22"> </span><span class="ff12">←<span class="_ _25"> </span><span class="ff6">valE<span class="_ _121"> </span>R</span></span>[<span class="ffd fs1e">%rsp</span>]<span class="_ _23"> </span><span class="ff12">←<span class="_ _23"> </span><span class="ffd fs1e">128</span></span></div><div class="t m5 x50 h32 y486c ff6 fs21 fc2 sc0 ls0 ws0">R<span class="ff7">[</span>rA<span class="_ _2"></span><span class="ff7">]<span class="_ _22"> </span><span class="ff12">←<span class="_ _25"> </span></span></span>valM<span class="_ _192"> </span>R<span class="_ _2"></span><span class="ff7">[<span class="ffd fs1e">%rax</span>]<span class="_ _22"> </span><span class="ff12">←<span class="_ _25"> </span><span class="ffd fs1e">9</span></span></span></div><div class="t m5 x1d h32 y486d ff7 fs21 fc2 sc0 ls0 ws0">PC<span class="_"> </span>update<span class="_ _45"> </span><span class="ff6">PC<span class="_ _25"> </span><span class="ff12">←<span class="_ _23"> </span></span>valP<span class="_ _158"> </span>PC<span class="_ _23"> </span><span class="ff12">←</span></span></div><div class="t m5 x17b h2d y486e ffd fs1e fc2 sc0 ls0 ws0">0x02e</div><div class="t m5 x1d h26 y486f ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>instruction<span class="_"> </span>sets<span class="_"> </span><span class="ffd">%rax<span class="_ _10"> </span></span>to<span class="_"> </span>9,<span class="_"> </span>sets<span class="_"> </span><span class="ffd">%rsp<span class="_ _11"> </span></span>to<span class="_"> </span>128,<span class="_"> </span>and<span class="_"> </span>increments<span class="_"> </span>the<span class="_"> </span>PC<span class="_"> </span>by<span class="_"> </span>2.</div><div class="t m5 x1d h28 y4870 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>4.15<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>427)</span></div><div class="t m5 x1d h26 y4871 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _7"></span>racing<span class="_ _16"> </span>the<span class="_ _16"> </span>steps<span class="_ _14"> </span>listed<span class="_ _16"> </span>in<span class="_ _16"> </span>F<span class="_ _0"></span>igure<span class="_ _16"> </span>4.20<span class="_ _16"> </span>with<span class="_ _16"> </span><span class="ff6">rA<span class="_ _14"> </span></span>equal<span class="_ _16"> </span>to<span class="_ _16"> </span><span class="ffd">%rsp</span>,<span class="_ _14"> </span>we<span class="_ _16"> </span>can<span class="_ _16"> </span>see<span class="_ _14"> </span>that<span class="_ _16"> </span>in</div><div class="t m5 x1d h26 y4872 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _16"> </span>memory<span class="_ _16"> </span>stage<span class="_ _16"> </span>the<span class="_ _16"> </span>instruction<span class="_ _16"> </span>will<span class="_ _16"> </span>store<span class="_ _16"> </span><span class="ff6">valA</span>,<span class="_ _14"> </span>the<span class="_ _16"> </span>original<span class="_ _16"> </span>value<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _14"> </span>stack</div><div class="t m5 x1d h26 y4873 ff7 fs19 fc1 sc0 ls0 ws0">pointer,<span class="_"> </span>to<span class="_"> </span>memory<span class="_ _7"></span>,<span class="_"> </span>just<span class="_"> </span>as<span class="_"> </span>we<span class="_"> </span>found<span class="_"> </span>for<span class="_"> </span>x86-64.</div><div class="t m5 x1d h28 y4874 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>4.16<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>428)</span></div><div class="t m5 x1d h26 y4875 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _7"></span>racing<span class="_"> </span>the<span class="_"> </span>steps<span class="_"> </span>listed<span class="_"> </span>in<span class="_"> </span>F<span class="_ _0"></span>igure<span class="_"> </span>4.20<span class="_"> </span>with<span class="_"> </span><span class="ff6">rA<span class="_ _10"> </span></span>equal<span class="_"> </span>to<span class="_"> </span><span class="ffd">%rsp</span>,<span class="_"> </span>we<span class="_"> </span>can<span class="_"> </span>see<span class="_"> </span>that<span class="_"> </span>both</div><div class="t m5 x1d h26 y4876 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span>the<span class="_ _11"> </span>write-back<span class="_"> </span>operations<span class="_ _11"> </span>will<span class="_"> </span>update<span class="_ _11"> </span><span class="ffd">%rsp</span>.<span class="_"> </span>Since<span class="_ _11"> </span>the<span class="_ _11"> </span>one<span class="_"> </span>writing<span class="_ _11"> </span><span class="ff6">valM<span class="_ _10"> </span></span>would</div><div class="t m5 x1d h26 y4877 ff7 fs19 fc1 sc0 ls0 ws0">occur<span class="_ _16"> </span>last,<span class="_ _14"> </span>the<span class="_ _14"> </span>net<span class="_ _16"> </span>effect<span class="_ _14"> </span>of<span class="_ _14"> </span>the<span class="_ _16"> </span>instruction<span class="_ _14"> </span>will<span class="_ _16"> </span>be<span class="_ _14"> </span>to<span class="_ _16"> </span>write<span class="_ _14"> </span>the<span class="_ _16"> </span>value<span class="_ _14"> </span>read<span class="_ _16"> </span>from</div><div class="t m5 x1d h26 y4878 ff7 fs19 fc1 sc0 ls0 ws0">memory<span class="_"> </span>to<span class="_"> </span><span class="ffd">%rsp</span>,<span class="_"> </span>just<span class="_"> </span>as<span class="_"> </span>we<span class="_"> </span>saw<span class="_"> </span>for<span class="_"> </span>x86-64.</div><div class="t m5 x1d h28 y4879 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>4.17<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>429)</span></div><div class="t m5 x1d h26 y487a ff7 fs19 fc1 sc0 ls0 ws0">Implementing<span class="_ _16"> </span>conditional<span class="_ _14"> </span>moves<span class="_ _16"> </span>requires<span class="_ _16"> </span>only<span class="_ _14"> </span>minor<span class="_ _16"> </span>changes<span class="_ _14"> </span>from<span class="_ _16"> </span>register<span class="_ _1"></span>-to-</div><div class="t m5 x1d h26 y487b ff7 fs19 fc1 sc0 ls0 ws0">register<span class="_ _16"> </span>moves<span class="_ _1"></span>.<span class="_ _16"> </span>W<span class="_ _1"></span>e<span class="_ _16"> </span>simply<span class="_ _16"> </span>condition<span class="_ _16"> </span>the<span class="_ _16"> </span>write-back<span class="_ _16"> </span>step<span class="_ _14"> </span>on<span class="_ _16"> </span>the<span class="_ _16"> </span>outcome<span class="_ _16"> </span>of<span class="_ _16"> </span>the</div><div class="t m5 x1d h26 y487c ff7 fs19 fc1 sc0 ls0 ws0">conditional<span class="_"> </span>test:</div><div class="t m5 x1d h31 y487d ff7 fs21 fc2 sc0 ls0 ws0">Stage<span class="_ _55"> </span><span class="ffd fs1e">cmovXX<span class="_ _11"> </span></span><span class="ff6">rA<span class="ffd fs1e">,<span class="_ _11"> </span></span>rB</span></div><div class="t m5 x1d h32 y487e ff7 fs21 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>etch<span class="_ _55"> </span><span class="ff6">icode<span class="_ _a"> </span></span>:<span class="_ _be"></span><span class="ff6">ifun<span class="_ _23"> </span><span class="ff12">←<span class="_ _25"> </span></span>M</span></div><div class="t m5 x1b1 h33 y487f ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x119 h31 y487e ff7 fs21 fc2 sc0 ls0 ws0">[<span class="ff6">PC</span>]</div><div class="t m5 x50 h32 y4880 ff6 fs21 fc2 sc0 ls0 ws0">rA<span class="_ _6"> </span><span class="ff7">:<span class="_ _be"></span></span>rB<span class="_ _25"> </span><span class="ff12">←<span class="_ _23"> </span></span>M</div><div class="t m5 x9e h33 y4881 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x68 h32 y4882 ff7 fs21 fc2 sc0 ls0 ws0">[<span class="ff6">PC<span class="_ _13"> </span><span class="ff12">+<span class="_ _13"> </span></span></span>1]</div><div class="t m5 x50 h32 y4883 ff6 fs21 fc2 sc0 ls0 ws0">valP<span class="_ _23"> </span><span class="ff12">←<span class="_ _25"> </span></span>PC<span class="_ _13"> </span><span class="ff12">+<span class="_ _13"> </span><span class="ff7">2</span></span></div><div class="t m5 x1d h32 y4884 ff7 fs21 fc2 sc0 ls0 ws0">Decode<span class="_ _bd"> </span><span class="ff6">valA<span class="_ _25"> </span><span class="ff12">←<span class="_ _25"> </span></span>R</span>[<span class="ff6">rA<span class="_ _2"></span></span>]</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
