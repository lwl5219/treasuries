<div id="pf13c" class="pf w2 h11" data-page-no="13c"><div class="pc pc13c w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg13c.png"/><div class="t m5 xf8 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>3.10<span class="_ _60"> </span>Combining<span class="_ _10"> </span>Control<span class="_ _10"> </span>and<span class="_ _10"> </span>Data<span class="_ _10"> </span>in<span class="_ _10"> </span>Machine-Level<span class="_ _10"> </span>Programs<span class="_ _3e"> </span><span class="ffe fs1e">315</span></div><div class="t m5 x17 h41 ye7 ffe fs29 fc2 sc0 ls0 ws0">3.10.2<span class="_ _48"> </span><span class="fs19">Life<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>Real<span class="_"> </span>W<span class="_ _1"></span>orld:<span class="_"> </span>Using<span class="_"> </span>the<span class="_"> </span><span class="ff1b">gdb<span class="_ _16"> </span></span>Debugger</span></div><div class="t m5 x17 h26 ybbe ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _21"> </span>GNU<span class="_ _21"> </span>debugger<span class="_ _15"> </span><span class="ff9">gdb<span class="_ _21"> </span></span>provides<span class="_ _21"> </span>a<span class="_ _21"> </span>number<span class="_ _15"> </span>of<span class="_ _21"> </span>useful<span class="_ _21"> </span>features<span class="_ _21"> </span>to<span class="_ _15"> </span>support<span class="_ _21"> </span>the</div><div class="t m5 x17 h26 ybbf ff7 fs19 fc2 sc0 ls0 ws0">run-time<span class="_ _11"> </span>evaluation<span class="_ _16"> </span>and<span class="_ _11"> </span>analysis<span class="_ _16"> </span>of<span class="_ _11"> </span>machine-level<span class="_ _11"> </span>programs<span class="_ _0"></span>.<span class="_ _11"> </span>With<span class="_"> </span>the<span class="_ _16"> </span>examples</div><div class="t m5 x17 h26 ybc0 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_ _15"> </span>exercises<span class="_ _21"> </span>in<span class="_ _15"> </span>this<span class="_ _21"> </span>book,<span class="_ _f"> </span>we<span class="_ _15"> </span>attempt<span class="_ _21"> </span>to<span class="_ _15"> </span>infer<span class="_ _21"> </span>the<span class="_ _21"> </span>behavior<span class="_ _15"> </span>of<span class="_ _21"> </span>a<span class="_ _15"> </span>program<span class="_ _21"> </span>by</div><div class="t m5 x17 h26 ybc1 ff7 fs19 fc2 sc0 ls0 ws0">just<span class="_ _14"> </span>looking<span class="_ _14"> </span>at<span class="_ _15"> </span>the<span class="_ _14"> </span>code.<span class="_ _16"> </span>Using<span class="_ _15"> </span><span class="ff9">gdb</span>,<span class="_ _15"> </span>it<span class="_ _14"> </span>becomes<span class="_ _15"> </span>possible<span class="_ _14"> </span>to<span class="_ _15"> </span>study<span class="_ _14"> </span>the<span class="_ _15"> </span>behavior</div><div class="t m5 x17 h26 ybc2 ff7 fs19 fc2 sc0 ls0 ws0">by<span class="_ _21"> </span>watching<span class="_ _21"> </span>the<span class="_ _21"> </span>program<span class="_ _21"> </span>in<span class="_ _f"> </span>action<span class="_ _21"> </span>while<span class="_ _21"> </span>having<span class="_ _21"> </span>considerable<span class="_ _21"> </span>control<span class="_ _f"> </span>over<span class="_ _21"> </span>its</div><div class="t m5 x17 h26 y119b ff7 fs19 fc2 sc0 ls0 ws0">execution.</div><div class="t m5 x26 h26 y119c ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_"> </span>3.39<span class="_ _11"> </span>shows<span class="_"> </span>examples<span class="_"> </span>of<span class="_"> </span>some<span class="_"> </span><span class="ff9">gdb<span class="_ _10"> </span></span>commands<span class="_"> </span>that<span class="_ _11"> </span>help<span class="_"> </span>when<span class="_"> </span>working</div><div class="t m5 x17 h26 y216 ff7 fs19 fc2 sc0 ls0 ws0">with<span class="_"> </span>machine-level<span class="_ _11"> </span>x86-64<span class="_"> </span>programs<span class="_ _1"></span>.<span class="_ _11"> </span>It<span class="_"> </span>is<span class="_ _11"> </span>very<span class="_"> </span>helpful<span class="_ _11"> </span>to<span class="_"> </span>ﬁrst<span class="_ _11"> </span>run<span class="_"> </span><span class="ff9">objdump<span class="_ _10"> </span></span>to<span class="_"> </span>get</div><div class="t m5 x17 h26 y2364 ff7 fs19 fc2 sc0 ls0 ws0">a<span class="_"> </span>disassembled<span class="_ _11"> </span>version<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>program.<span class="_ _11"> </span>Our<span class="_"> </span>examples<span class="_ _11"> </span>are<span class="_ _11"> </span>based<span class="_ _11"> </span>on<span class="_ _11"> </span>running<span class="_ _11"> </span><span class="ff9">gdb</span></div><div class="t m5 x17 h26 y2365 ff7 fs19 fc2 sc0 ls0 ws0">on<span class="_ _11"> </span>the<span class="_ _11"> </span>ﬁle<span class="_ _11"> </span><span class="ffd">prog</span>,<span class="_ _11"> </span>described<span class="_ _11"> </span>and<span class="_ _11"> </span>disassembled<span class="_ _11"> </span>on<span class="_ _11"> </span>page<span class="_ _11"> </span>211.<span class="_ _11"> </span>W<span class="_ _3"></span>e<span class="_ _11"> </span>start<span class="_ _11"> </span><span class="ff9">gdb<span class="_ _11"> </span></span>with<span class="_ _11"> </span>the</div><div class="t m5 x17 h26 y320 ff7 fs19 fc2 sc0 ls0 ws0">following<span class="_"> </span>command<span class="_"> </span>line:</div><div class="t m5 x17 h2d y2d39 ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">gdb<span class="_ _1f"> </span>prog</span></div><div class="t m5 x26 h26 y2d3a ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _16"> </span>general<span class="_ _16"> </span>scheme<span class="_ _16"> </span>is<span class="_ _16"> </span>to<span class="_ _16"> </span>set<span class="_ _16"> </span>breakpoints<span class="_ _16"> </span>near<span class="_ _16"> </span>points<span class="_ _16"> </span>of<span class="_ _16"> </span>interest<span class="_ _16"> </span>in<span class="_ _16"> </span>the<span class="_ _16"> </span>pro-</div><div class="t m5 x17 h26 y2d3b ff7 fs19 fc2 sc0 ls0 ws0">gram.<span class="_ _13"> </span>T<span class="_ _1"></span>hese<span class="_ _13"> </span>can<span class="_ _13"> </span>be<span class="_ _13"> </span>set<span class="_ _13"> </span>to<span class="_ _13"> </span>just<span class="_ _13"> </span>after<span class="_ _13"> </span>the<span class="_ _13"> </span>entry<span class="_ _13"> </span>of<span class="_ _6"> </span>a<span class="_ _13"> </span>function<span class="_ _13"> </span>or<span class="_ _13"> </span>at<span class="_ _13"> </span>a<span class="_ _13"> </span>program<span class="_ _13"> </span>address<span class="_ _1"></span>.</div><div class="t m5 x17 h26 y2d3c ff7 fs19 fc2 sc0 ls0 ws0">When<span class="_ _11"> </span>one<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>breakpoints<span class="_ _11"> </span>is<span class="_ _16"> </span>hit<span class="_ _16"> </span>during<span class="_ _11"> </span>program<span class="_ _16"> </span>execution,<span class="_ _16"> </span>the<span class="_ _11"> </span>program<span class="_ _16"> </span>will</div><div class="t m5 x17 h26 y2d3d ff7 fs19 fc2 sc0 ls0 ws0">halt<span class="_"> </span>and<span class="_"> </span>return<span class="_"> </span>control<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>user.<span class="_"> </span>F<span class="_ _1"></span>rom<span class="_ _11"> </span>a<span class="_"> </span>breakpoint,<span class="_"> </span>we<span class="_"> </span>can<span class="_"> </span>examine<span class="_"> </span>different</div><div class="t m5 x17 h26 y2d3e ff7 fs19 fc2 sc0 ls0 ws0">registers<span class="_ _14"> </span>and<span class="_ _14"> </span>memory<span class="_ _14"> </span>locations<span class="_ _14"> </span>in<span class="_ _14"> </span>various<span class="_ _14"> </span>formats<span class="_ _0"></span>.<span class="_ _14"> </span>W<span class="_ _3"></span>e<span class="_ _14"> </span>can<span class="_ _14"> </span>also<span class="_ _15"> </span>single-step<span class="_ _14"> </span>the</div><div class="t m5 x17 h26 y2d3f ff7 fs19 fc2 sc0 ls0 ws0">program,<span class="_"> </span>running<span class="_ _11"> </span>just<span class="_"> </span>a<span class="_ _11"> </span>few<span class="_"> </span>instructions<span class="_"> </span>at<span class="_ _11"> </span>a<span class="_"> </span>time,<span class="_"> </span>or<span class="_"> </span>we<span class="_"> </span>can<span class="_ _11"> </span>proceed<span class="_"> </span>to<span class="_ _11"> </span>the<span class="_"> </span>next</div><div class="t m5 x17 h26 y2d40 ff7 fs19 fc2 sc0 ls0 ws0">breakpoint.</div><div class="t m5 x26 h26 y2d41 ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_ _13"> </span>our<span class="_ _13"> </span>examples<span class="_ _13"> </span>suggest,<span class="_ _13"> </span><span class="ff9">gdb<span class="_ _13"> </span></span>has<span class="_ _13"> </span>an<span class="_ _13"> </span>obscure<span class="_ _13"> </span>command<span class="_ _13"> </span>syntax,<span class="_ _13"> </span>but<span class="_ _13"> </span>the<span class="_ _6"> </span>online</div><div class="t m5 x17 h26 y2d42 ff7 fs19 fc2 sc0 ls0 ws0">help<span class="_ _16"> </span>information<span class="_ _16"> </span>(invoked<span class="_ _16"> </span>within<span class="_ _16"> </span><span class="ff9">gdb<span class="_ _16"> </span></span>with<span class="_ _16"> </span>the<span class="_ _14"> </span><span class="ffd">help<span class="_ _16"> </span></span>command)<span class="_ _16"> </span>overcomes<span class="_ _16"> </span>this</div><div class="t m5 x17 h26 y2d43 ff7 fs19 fc2 sc0 ls0 ws0">shortcoming.<span class="_ _16"> </span>Rather<span class="_ _14"> </span>than<span class="_ _14"> </span>using<span class="_ _16"> </span>the<span class="_ _14"> </span>command-line<span class="_ _14"> </span>interface<span class="_ _14"> </span>to<span class="_ _14"> </span><span class="ff9">gdb</span>,<span class="_ _14"> </span>many<span class="_ _14"> </span>pro-</div><div class="t m5 x17 h26 y2d44 ff7 fs19 fc2 sc0 ls0 ws0">grammers<span class="_ _16"> </span>prefer<span class="_ _16"> </span>using<span class="_ _16"> </span><span class="ff9">ddd</span>,<span class="_ _14"> </span>an<span class="_ _16"> </span>extension<span class="_ _14"> </span>to<span class="_ _16"> </span><span class="ff9">gdb<span class="_ _16"> </span></span>that<span class="_ _16"> </span>provides<span class="_ _16"> </span>a<span class="_ _14"> </span>graphical<span class="_ _16"> </span>user</div><div class="t m5 x17 h26 y2d45 ff7 fs19 fc2 sc0 ls0 ws0">interface<span class="_ _1"></span>.</div><div class="t m5 x17 h41 y2d46 ffe fs29 fc2 sc0 ls0 ws0">3.10.3<span class="_ _48"> </span><span class="fs19">Out-of-Bounds<span class="_"> </span>Memory<span class="_"> </span>References<span class="_"> </span>and<span class="_"> </span>Buffer<span class="_"> </span>Over<span class="_ _2"></span>ﬂow</span></div><div class="t m5 x17 h26 y2d47 ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_"> </span>have<span class="_"> </span>seen<span class="_"> </span>that<span class="_ _13"> </span>C<span class="_"> </span>does<span class="_"> </span>not<span class="_"> </span>perform<span class="_"> </span>any<span class="_ _13"> </span>bounds<span class="_"> </span>checking<span class="_"> </span>for<span class="_"> </span>array<span class="_"> </span>references<span class="_ _3"></span>,</div><div class="t m5 x17 h26 y2d48 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_"> </span>that<span class="_"> </span>local<span class="_"> </span>variables<span class="_"> </span>are<span class="_"> </span>stored<span class="_"> </span>on<span class="_"> </span>the<span class="_"> </span>stack<span class="_"> </span>along<span class="_"> </span>with<span class="_"> </span>state<span class="_"> </span>information<span class="_"> </span>such</div><div class="t m5 x17 h26 y2d49 ff7 fs19 fc2 sc0 ls0 ws0">as<span class="_ _13"> </span>saved<span class="_ _6"> </span>register<span class="_ _13"> </span>values<span class="_ _13"> </span>and<span class="_ _6"> </span>return<span class="_ _13"> </span>addresses<span class="_ _1"></span>.<span class="_ _13"> </span>T<span class="_ _1"></span>his<span class="_ _13"> </span>combination<span class="_ _6"> </span>can<span class="_ _13"> </span>lead<span class="_ _13"> </span>to<span class="_ _6"> </span>serious</div><div class="t m5 x17 h26 y2d4a ff7 fs19 fc2 sc0 ls0 ws0">program<span class="_ _13"> </span>errors<span class="_ _1"></span>,<span class="_ _13"> </span>where<span class="_ _13"> </span>the<span class="_ _13"> </span>state<span class="_ _13"> </span>stored<span class="_ _13"> </span>on<span class="_ _13"> </span>the<span class="_ _13"> </span>stack<span class="_ _13"> </span>gets<span class="_ _13"> </span>corrupted<span class="_ _13"> </span>by<span class="_ _13"> </span>a<span class="_ _13"> </span>write<span class="_ _13"> </span>to<span class="_ _13"> </span>an</div><div class="t m5 x17 h26 y2d4b ff7 fs19 fc2 sc0 ls0 ws0">out-of-bounds<span class="_"> </span>array<span class="_"> </span>element.<span class="_"> </span>When<span class="_ _13"> </span>the<span class="_"> </span>program<span class="_"> </span>then<span class="_"> </span>tries<span class="_"> </span>to<span class="_"> </span>reload<span class="_"> </span>the<span class="_"> </span>register</div><div class="t m5 x17 h26 y2d4c ff7 fs19 fc2 sc0 ls0 ws0">or<span class="_ _15"> </span>execute<span class="_ _21"> </span>a<span class="_ _21"> </span><span class="ffd">ret<span class="_ _21"> </span></span>instruction<span class="_ _21"> </span>with<span class="_ _21"> </span>this<span class="_ _15"> </span>corrupted<span class="_ _21"> </span>state,<span class="_ _21"> </span>things<span class="_ _21"> </span>can<span class="_ _21"> </span>go<span class="_ _21"> </span>seriously</div><div class="t m5 x17 h26 y2d4d ff7 fs19 fc2 sc0 ls0 ws0">wrong.</div><div class="t m5 x26 h26 y2d4e ff7 fs19 fc2 sc0 ls0 ws0">A<span class="_ _13"> </span>particularly<span class="_ _6"> </span>common<span class="_ _13"> </span>source<span class="_ _6"> </span>of<span class="_ _13"> </span>state<span class="_ _6"> </span>corruption<span class="_ _13"> </span>is<span class="_ _6"> </span>known<span class="_ _13"> </span>as<span class="_ _6"> </span><span class="ffa">buffer<span class="_ _13"> </span>overﬂo<span class="_ _1"></span>w<span class="ff7">.</span></span></div><div class="t m5 x17 h26 y2d4f ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _7"></span>ypically<span class="_ _3"></span>,<span class="_ _11"> </span>some<span class="_ _11"> </span>character<span class="_ _16"> </span>array<span class="_"> </span>is<span class="_ _16"> </span>allocated<span class="_"> </span>on<span class="_ _16"> </span>the<span class="_"> </span>stack<span class="_ _16"> </span>to<span class="_"> </span>hold<span class="_ _16"> </span>a<span class="_"> </span>string,<span class="_ _11"> </span>but<span class="_ _11"> </span>the</div><div class="t m5 x17 h26 y2d50 ff7 fs19 fc2 sc0 ls0 ws0">size<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>string<span class="_ _11"> </span>exceeds<span class="_ _11"> </span>the<span class="_ _16"> </span>space<span class="_"> </span>allocated<span class="_ _16"> </span>for<span class="_ _11"> </span>the<span class="_ _11"> </span>array<span class="_ _3"></span>.<span class="_ _11"> </span>This<span class="_"> </span>is<span class="_ _16"> </span>demonstrated</div><div class="t m5 x17 h26 y2d51 ff7 fs19 fc2 sc0 ls0 ws0">by<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>program<span class="_"> </span>example:</div><div class="t m5 x17 h2d y587 ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Implementation<span class="_ _1f"> </span>of<span class="_ _1f"> </span>library<span class="_ _e"> </span>function<span class="_ _1f"> </span>gets()<span class="_ _e"> </span>*/</div><div class="t m5 x17 h2d y267f ffd fs1e fc2 sc0 ls0 ws0">char<span class="_ _e"> </span>*gets(char<span class="_ _1f"> </span>*s)</div><div class="t m5 x17 h2d y2680 ffd fs1e fc2 sc0 ls0 ws0">{</div><div class="t m5 x1b6 h2d y2681 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>c;</div><div class="t m5 x1b6 h2d y2d52 ffd fs1e fc2 sc0 ls0 ws0">char<span class="_ _e"> </span>*dest<span class="_ _1f"> </span>=<span class="_ _1f"> </span>s;</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
