<div id="pf24d" class="pf w2 h11" data-page-no="24d"><div class="pc pc24d w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg24d.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">588<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>5<span class="_ _3d"> </span>Optimizing<span class="_ _10"> </span>Program<span class="_ _10"> </span>Performance</span></div><div class="t m5 x1d h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">values<span class="_ _13"> </span>and<span class="_"> </span>then<span class="_ _13"> </span>update<span class="_ _13"> </span>the<span class="_"> </span>program<span class="_ _13"> </span>state<span class="_ _13"> </span>with<span class="_"> </span>these<span class="_ _13"> </span>values<span class="_ _1"></span>,<span class="_"> </span>as<span class="_ _13"> </span>opposed<span class="_ _13"> </span>to<span class="_"> </span>a<span class="_ _13"> </span>more</div><div class="t m5 x1d h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">“imperative”<span class="_ _13"> </span>style<span class="_ _1"></span>,<span class="_ _13"> </span>where<span class="_ _13"> </span>we<span class="_ _13"> </span>use<span class="_ _13"> </span>conditionals<span class="_ _13"> </span>to<span class="_ _6"> </span>selectively<span class="_ _13"> </span>update<span class="_ _13"> </span>program<span class="_ _13"> </span>state<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>here<span class="_ _15"> </span>are<span class="_ _21"> </span>no<span class="_ _15"> </span>strict<span class="_ _15"> </span>rules<span class="_ _15"> </span>for<span class="_ _15"> </span>these<span class="_ _15"> </span>two<span class="_ _21"> </span>styles<span class="_ _1"></span>,<span class="_ _21"> </span>and<span class="_ _15"> </span>so<span class="_ _21"> </span>we<span class="_ _15"> </span>illustrate<span class="_ _15"> </span>with<span class="_ _15"> </span>an</div><div class="t m5 x1d h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">example<span class="_ _1"></span>.<span class="_ _13"> </span>Suppose<span class="_ _13"> </span>we<span class="_ _13"> </span>are<span class="_ _6"> </span>given<span class="_ _13"> </span>two<span class="_ _13"> </span>arrays<span class="_ _13"> </span>of<span class="_ _6"> </span>integers<span class="_ _13"> </span><span class="ffd">a<span class="_ _13"> </span></span>and<span class="_ _13"> </span><span class="ffd">b</span>,<span class="_ _13"> </span>and<span class="_ _13"> </span>at<span class="_ _6"> </span>each<span class="_ _13"> </span>position</div><div class="t m5 x1d h26 y2f8 ff11 fs19 fc2 sc0 ls0 ws0">i<span class="_ _2"></span><span class="ff7">,<span class="_"> </span>we<span class="_ _6"> </span>want<span class="_ _13"> </span>to<span class="_ _13"> </span>set<span class="_ _13"> </span><span class="ffd">a[</span></span>i<span class="_ _2"></span><span class="ffd">]<span class="_ _13"> </span><span class="ff7">to<span class="_ _13"> </span>the<span class="_ _13"> </span>minimum<span class="_ _13"> </span>of<span class="_ _13"> </span></span>a[</span>i<span class="_ _2"></span><span class="ffd">]<span class="_ _13"> </span><span class="ff7">and<span class="_ _13"> </span></span>b[</span>i<span class="_ _2"></span><span class="ffd">]<span class="ff7">,<span class="_ _13"> </span>and<span class="_ _13"> </span></span>b[</span>i<span class="_ _5"></span><span class="ffd">]<span class="_ _13"> </span><span class="ff7">to<span class="_ _13"> </span>the<span class="_ _13"> </span>maximum.</span></span></div><div class="t m5 x29 h26 y2f9 ff7 fs19 fc2 sc0 ls0 ws0">An<span class="_ _13"> </span>imperative<span class="_ _13"> </span>style<span class="_ _13"> </span>of<span class="_"> </span>implementing<span class="_ _13"> </span>this<span class="_ _13"> </span>function<span class="_ _13"> </span>is<span class="_ _13"> </span>to<span class="_ _13"> </span>check<span class="_ _13"> </span>at<span class="_"> </span>each<span class="_ _13"> </span>position</div><div class="t m5 x1d h26 y2fa ff11 fs19 fc2 sc0 ls0 ws0">i<span class="_"> </span><span class="ff7">and<span class="_"> </span>swap<span class="_"> </span>the<span class="_"> </span>two<span class="_"> </span>elements<span class="_"> </span>if<span class="_"> </span>they<span class="_"> </span>are<span class="_"> </span>out<span class="_"> </span>of<span class="_"> </span>order:</span></div><div class="t m5 x1f h2d y4f4e ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">/*<span class="_ _1f"> </span>Rearrange<span class="_ _e"> </span>two<span class="_ _1f"> </span>vectors<span class="_ _1f"> </span>so<span class="_ _e"> </span>that<span class="_ _1f"> </span>for<span class="_ _e"> </span>each<span class="_ _1f"> </span>i,<span class="_ _1f"> </span>b[i]<span class="_ _e"> </span>&gt;=<span class="_ _1f"> </span>a[i]<span class="_ _e"> </span>*/</span></div><div class="t m5 x1f h2d y4f4f ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">void<span class="_ _1f"> </span>minmax1(long<span class="_ _e"> </span>a[],<span class="_ _1f"> </span>long<span class="_ _1f"> </span>b[],<span class="_ _e"> </span>long<span class="_ _1f"> </span>n)<span class="_ _e"> </span>{</span></div><div class="t m5 x1f h2d y4f50 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>i;</span></div><div class="t m5 x1f h2d yea5 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2 ls33">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>i=0<span class="_ _41"></span>;i&lt;n<span class="_ _41"></span>;<span class="ls0">i++)<span class="_ _e"> </span>{</span></span></div><div class="t m5 x1f h2d y4f51 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _70"> </span><span class="ffd fs1e fc2">if<span class="_ _e"> </span>(a[i]<span class="_ _1f"> </span>&gt;<span class="_ _1f"> </span>b[i])<span class="_ _e"> </span>{</span></div><div class="t m5 x1f h2d y4f52 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _d1"> </span><span class="ffd fs1e fc2">long<span class="_ _1f"> </span>t<span class="_ _e"> </span>=<span class="_ _1f"> </span>a[i];</span></div><div class="t m5 x1f h2d y4f53 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _d1"> </span><span class="ffd fs1e fc2">a[i]<span class="_ _1f"> </span>=<span class="_ _e"> </span>b[i];</span></div><div class="t m5 x1f h2d y78e ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _d1"> </span><span class="ffd fs1e fc2">b[i]<span class="_ _1f"> </span>=<span class="_ _e"> </span>t;</span></div><div class="t m5 x1f h2d y4f54 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _70"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1b0 h2d y348f ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1b0 h2d y4f55 ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1d h26 y47f0 ff7 fs19 fc2 sc0 ls0 ws0">Our<span class="_"> </span>measurements<span class="_"> </span>for<span class="_"> </span>this<span class="_"> </span>function<span class="_"> </span>show<span class="_"> </span>a<span class="_"> </span>CPE<span class="_"> </span>of<span class="_ _13"> </span>around<span class="_"> </span>13.5<span class="_"> </span>for<span class="_"> </span>random<span class="_"> </span>data</div><div class="t m5 x1d h26 y4f56 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_ _6"> </span>2.5–3.5<span class="_ _6"> </span>for<span class="_ _6"> </span>predictable<span class="_ _13"> </span>data,<span class="_ _6"> </span>an<span class="_ _6"> </span>indication<span class="_ _13"> </span>of<span class="_ _a"> </span>a<span class="_ _6"> </span>misprediction<span class="_ _13"> </span>penalty<span class="_ _a"> </span>of<span class="_ _6"> </span>around</div><div class="t m5 x1d h26 y4f57 ff7 fs19 fc2 sc0 ls0 ws0">20<span class="_"> </span>cycles<span class="_ _3"></span>.</div><div class="t m5 x29 h26 y4f58 ff7 fs19 fc2 sc0 ls0 ws0">A<span class="_"> </span>functional<span class="_"> </span>style<span class="_"> </span>of<span class="_ _11"> </span>implementing<span class="_"> </span>this<span class="_"> </span>function<span class="_"> </span>is<span class="_ _11"> </span>to<span class="_"> </span>compute<span class="_"> </span>the<span class="_"> </span>minimum</div><div class="t m5 x1d h26 y4f59 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_"> </span>maximum<span class="_ _11"> </span>values<span class="_ _11"> </span>at<span class="_ _11"> </span>each<span class="_ _11"> </span>position<span class="_ _11"> </span><span class="ff11">i<span class="_"> </span></span>and<span class="_"> </span>then<span class="_ _11"> </span>assign<span class="_ _11"> </span>these<span class="_ _11"> </span>values<span class="_ _11"> </span>to<span class="_ _11"> </span><span class="ffd">a[<span class="ff11">i<span class="_ _5"></span></span>]<span class="_ _11"> </span></span>and</div><div class="t m5 x1d h26 y4f5a ffd fs19 fc2 sc0 ls0 ws0">b[<span class="ff11">i<span class="_ _2"></span></span>]<span class="ff7">,<span class="_"> </span>respectively:</span></div><div class="t m5 x1f h2d y2969 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">/*<span class="_ _1f"> </span>Rearrange<span class="_ _e"> </span>two<span class="_ _1f"> </span>vectors<span class="_ _1f"> </span>so<span class="_ _e"> </span>that<span class="_ _1f"> </span>for<span class="_ _e"> </span>each<span class="_ _1f"> </span>i,<span class="_ _1f"> </span>b[i]<span class="_ _e"> </span>&gt;=<span class="_ _1f"> </span>a[i]<span class="_ _e"> </span>*/</span></div><div class="t m5 x1f h2d y4f5b ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">void<span class="_ _1f"> </span>minmax2(long<span class="_ _e"> </span>a[],<span class="_ _1f"> </span>long<span class="_ _1f"> </span>b[],<span class="_ _e"> </span>long<span class="_ _1f"> </span>n)<span class="_ _e"> </span>{</span></div><div class="t m5 x1f h2d y4f5c ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>i;</span></div><div class="t m5 x1f h2d y4f5d ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2 ls33">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>i=0<span class="_ _41"></span>;i&lt;n<span class="_ _41"></span>;<span class="ls0">i++)<span class="_ _e"> </span>{</span></span></div><div class="t m5 x1f h2e y4f5e ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 xf7 h2d y4f5f ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>min<span class="_ _1f"> </span>=<span class="_ _1f"> </span>a[i]<span class="_ _e"> </span>&lt;<span class="_ _1f"> </span>b[i]<span class="_ _e"> </span>?<span class="_ _1f"> </span>a[i]<span class="_ _1f"> </span>:<span class="_ _e"> </span>b[i];</div><div class="t m5 x1f h2e y4f60 ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 xf7 h2d y4f61 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>max<span class="_ _1f"> </span>=<span class="_ _1f"> </span>a[i]<span class="_ _e"> </span>&lt;<span class="_ _1f"> </span>b[i]<span class="_ _e"> </span>?<span class="_ _1f"> </span>b[i]<span class="_ _1f"> </span>:<span class="_ _e"> </span>a[i];</div><div class="t m5 x1f h2d y4f62 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _70"> </span><span class="ffd fs1e fc2">a[i]<span class="_ _e"> </span>=<span class="_ _1f"> </span>min;</span></div><div class="t m5 x1f h2d y4f63 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _70"> </span><span class="ffd fs1e fc2">b[i]<span class="_ _e"> </span>=<span class="_ _1f"> </span>max;</span></div><div class="t m5 x1f h2e y2970 ff6 fs20 fc6 sc0 ls0 ws0">9</div><div class="t m5 x33 h2d y2971 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x1b0 h2d y4f64 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1d h26 y211a ff7 fs19 fc2 sc0 ls0 ws0">Our<span class="_ _21"> </span>measurements<span class="_ _f"> </span>for<span class="_ _21"> </span>this<span class="_ _f"> </span>function<span class="_ _f"> </span>show<span class="_ _21"> </span>a<span class="_ _f"> </span>CPE<span class="_ _f"> </span>of<span class="_ _21"> </span>around<span class="_ _f"> </span>4.0<span class="_ _f"> </span>regardless<span class="_ _21"> </span>of</div><div class="t m5 x1d h26 y2237 ff7 fs19 fc2 sc0 ls0 ws0">whether<span class="_ _11"> </span>the<span class="_ _16"> </span>data<span class="_ _11"> </span>are<span class="_ _11"> </span>arbitrary<span class="_ _16"> </span>or<span class="_ _11"> </span>predictable.<span class="_"> </span>(W<span class="_ _1"></span>e<span class="_ _11"> </span>also<span class="_ _16"> </span>examined<span class="_ _11"> </span>the<span class="_ _16"> </span>generated</div><div class="t m5 x1d h26 y2238 ff7 fs19 fc2 sc0 ls0 ws0">assembly<span class="_"> </span>code<span class="_"> </span>to<span class="_"> </span>make<span class="_"> </span>sure<span class="_"> </span>that<span class="_"> </span>it<span class="_"> </span>indeed<span class="_"> </span>uses<span class="_"> </span>conditional<span class="_"> </span>moves<span class="_ _1"></span>.)</div><div class="t m5 x29 h26 y2239 ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_ _6"> </span>discussed<span class="_ _13"> </span>in<span class="_ _6"> </span>Section<span class="_ _13"> </span>3.6.6,<span class="_ _6"> </span>not<span class="_ _13"> </span>all<span class="_ _6"> </span>conditional<span class="_ _13"> </span>behavior<span class="_ _6"> </span>can<span class="_ _13"> </span>be<span class="_ _6"> </span>implemented</div><div class="t m5 x1d h26 y223a ff7 fs19 fc2 sc0 ls0 ws0">with<span class="_"> </span>conditional<span class="_"> </span>data<span class="_"> </span>transfers<span class="_ _3"></span>,<span class="_"> </span>and<span class="_"> </span>so<span class="_"> </span>there<span class="_"> </span>are<span class="_"> </span>inevitably<span class="_"> </span>cases<span class="_"> </span>where<span class="_"> </span>program-</div><div class="t m5 x1d h26 yd16 ff7 fs19 fc2 sc0 ls0 ws0">mers<span class="_ _16"> </span>cannot<span class="_ _11"> </span>avoid<span class="_ _16"> </span>writing<span class="_ _16"> </span>code<span class="_ _11"> </span>that<span class="_ _16"> </span>will<span class="_ _11"> </span>lead<span class="_ _16"> </span>to<span class="_ _16"> </span>conditional<span class="_ _11"> </span>branches<span class="_ _16"> </span>for<span class="_ _16"> </span>which</div><div class="t m5 x1d h26 yd17 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>processor<span class="_"> </span>will<span class="_"> </span>do<span class="_ _11"> </span>poorly<span class="_"> </span>with<span class="_"> </span>its<span class="_"> </span>branch<span class="_ _11"> </span>prediction.<span class="_"> </span>But,<span class="_"> </span>as<span class="_ _11"> </span>we<span class="_"> </span>have<span class="_"> </span>shown,<span class="_"> </span>a</div><div class="t m5 x1d h26 y223b ff7 fs19 fc2 sc0 ls0 ws0">little<span class="_ _11"> </span>cleverness<span class="_ _16"> </span>on<span class="_ _11"> </span>the<span class="_ _16"> </span>part<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>programmer<span class="_ _11"> </span>can<span class="_ _16"> </span>sometimes<span class="_ _11"> </span>make<span class="_ _16"> </span>code<span class="_ _11"> </span>more</div><div class="t m5 x1d h26 y223c ff7 fs19 fc2 sc0 ls0 ws0">amenable<span class="_ _6"> </span>to<span class="_ _6"> </span>translation<span class="_ _6"> </span>into<span class="_ _6"> </span>conditional<span class="_ _6"> </span>data<span class="_ _6"> </span>transfers<span class="_ _1"></span>.<span class="_ _6"> </span>T<span class="_ _0"></span>his<span class="_ _6"> </span>requires<span class="_ _6"> </span>some<span class="_ _6"> </span>amount</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
