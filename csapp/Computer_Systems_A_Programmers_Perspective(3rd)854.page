<div id="pf356" class="pf w2 h11" data-page-no="356"><div class="pc pc356 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg356.png"/><div class="t m5 x6b h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>9.6<span class="_ _60"> </span>Address<span class="_ _10"> </span>T<span class="_ _1"></span>ranslation<span class="_ _3e"> </span><span class="ffe fs1e">853</span></div><div class="t m5 x17 h3f y6e5e ffad fs27 fc1 sc0 ls0 ws0">CPU chip </div><div class="t m5 x2f h3f y6e5f ffad fs27 fc1 sc0 ls0 ws0">Processor</div><div class="t m5 x4d h3f y6e60 ffad fs27 fc1 sc0 ls0 ws0">MMU<span class="_ _215"> </span>Memory</div><div class="t m5 x1ee h3f y6e61 ffad fs27 fc1 sc0 ls56 ws0">VA</div><div class="t m5 x209 h3f y6e62 ffad fs27 fc1 sc0 ls0 ws0">Data</div><div class="t m5 x198 h3f y6e63 ffad fs27 fc1 sc0 ls0 ws0">L1</div><div class="t m5 x88 h3f y6e64 ffad fs27 fc1 sc0 ls0 ws0">cache</div><div class="t m5 x24c h3f y6e65 ffad fs27 fc1 sc0 ls56 ws0">PA</div><div class="t m5 x167 h3f y6e66 ffad fs27 fc1 sc0 ls0 ws0">PTEA</div><div class="t m5 xb7 h3f y6e67 ffad fs27 fc1 sc0 ls0 ws0">PTE</div><div class="t m5 x82 h3f y6e68 ffad fs27 fc1 sc0 ls0 ws0">PTE</div><div class="t m5 xa1 h3f y6e69 ffad fs27 fc1 sc0 ls0 ws0">PTEA</div><div class="t m5 x13c h3f y6e6a ffad fs27 fc1 sc0 ls56 ws0">PA</div><div class="t m5 x19d h3f y6e6b ffad fs27 fc1 sc0 ls0 ws0">Data</div><div class="t m5 x16e h65 y6e6c ffad fs38 fc1 sc0 ls0 ws0">PTEA</div><div class="t m5 x16e h65 y6e6d ffad fs38 fc1 sc0 ls0 ws0">hit</div><div class="t m5 x16e h65 y6e6e ffad fs38 fc1 sc0 ls297 ws0">PA</div><div class="t m5 x16e h65 y6e6f ffad fs38 fc1 sc0 ls0 ws0">hit</div><div class="t m5 x151 h65 y6e70 ffad fs38 fc1 sc0 ls0 ws0">PTEA</div><div class="t m5 x184 h65 y6e71 ffad fs38 fc1 sc0 ls0 ws0">miss</div><div class="t m5 x130 h65 y6e72 ffad fs38 fc1 sc0 ls297 ws0">PA</div><div class="t m5 x184 h65 y6e73 ffad fs38 fc1 sc0 ls0 ws0">miss</div><div class="t m5 x17 h34 y294e ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>9.14<span class="_ _c"> </span><span class="fc1">Integrating<span class="_ _11"> </span>VM<span class="_ _11"> </span>with<span class="_ _11"> </span>a<span class="_ _11"> </span>physically<span class="_ _11"> </span>addressed<span class="_ _11"> </span>cache.<span class="_ _11"> </span><span class="ff6">VA:<span class="_ _10"> </span>virtual<span class="_ _11"> </span>address.</span></span></div><div class="t m5 x17 h34 y294f ff6 fs16 fc1 sc0 ls0 ws0">PTEA:<span class="_ _10"> </span>page<span class="_ _11"> </span>table<span class="_ _10"> </span>entry<span class="_ _11"> </span>address.<span class="_ _10"> </span>PTE:<span class="_ _11"> </span>page<span class="_ _10"> </span>table<span class="_ _10"> </span>entr<span class="_ _2"></span>y<span class="_ _3"></span>.<span class="_ _11"> </span>P<span class="_ _3"></span>A:<span class="_ _11"> </span>physical<span class="_ _10"> </span>address.</div><div class="t m5 x17 h41 y6e74 ffe fs29 fc1 sc0 ls0 ws0">9.6.1<span class="_ _48"> </span><span class="fs19">Integrating<span class="_"> </span>Caches<span class="_"> </span>and<span class="_"> </span>VM</span></div><div class="t m5 x17 h26 y6e75 ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _21"> </span>any<span class="_ _21"> </span>system<span class="_ _21"> </span>that<span class="_ _21"> </span>uses<span class="_ _21"> </span>both<span class="_ _21"> </span>virtual<span class="_ _21"> </span>memory<span class="_ _21"> </span>and<span class="_ _21"> </span>SRAM<span class="_ _21"> </span>caches<span class="_ _1"></span>,<span class="_ _e"> </span>there<span class="_ _15"> </span>is<span class="_ _21"> </span>the</div><div class="t m5 x17 h26 y6e76 ff7 fs19 fc1 sc0 ls0 ws0">issue<span class="_ _11"> </span>of<span class="_ _11"> </span>whether<span class="_ _16"> </span>to<span class="_ _11"> </span>use<span class="_ _11"> </span>virtual<span class="_ _16"> </span>or<span class="_ _11"> </span>physical<span class="_ _11"> </span>addresses<span class="_ _16"> </span>to<span class="_ _11"> </span>access<span class="_ _11"> </span>the<span class="_ _11"> </span>SRAM<span class="_ _16"> </span>cache<span class="_ _1"></span>.</div><div class="t m5 x17 h26 y6e77 ff7 fs19 fc1 sc0 ls0 ws0">Although<span class="_ _11"> </span>a<span class="_ _16"> </span>detailed<span class="_ _16"> </span>discussion<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>trade-offs<span class="_ _11"> </span>is<span class="_ _16"> </span>beyond<span class="_ _16"> </span>our<span class="_ _11"> </span>scope<span class="_ _16"> </span>here<span class="_ _1"></span>,<span class="_ _16"> </span>most</div><div class="t m5 x17 h26 y6e78 ff7 fs19 fc1 sc0 ls0 ws0">systems<span class="_ _13"> </span>opt<span class="_ _13"> </span>for<span class="_ _6"> </span>physical<span class="_ _13"> </span>addressing.<span class="_ _13"> </span>W<span class="_ _1"></span>ith<span class="_ _13"> </span>physical<span class="_ _13"> </span>addressing<span class="_ _0"></span>,<span class="_ _13"> </span>it<span class="_ _13"> </span>is<span class="_ _13"> </span>straightforward</div><div class="t m5 x17 h26 y6e79 ff7 fs19 fc1 sc0 ls0 ws0">for<span class="_ _11"> </span>multiple<span class="_ _11"> </span>processes<span class="_ _11"> </span>to<span class="_ _11"> </span>have<span class="_ _11"> </span>blocks<span class="_ _11"> </span>in<span class="_ _11"> </span>the<span class="_ _11"> </span>cache<span class="_ _11"> </span>at<span class="_ _16"> </span>the<span class="_"> </span>same<span class="_ _11"> </span>time<span class="_ _11"> </span>and<span class="_ _11"> </span>to<span class="_ _16"> </span>share</div><div class="t m5 x17 h26 y6e7a ff7 fs19 fc1 sc0 ls0 ws0">blocks<span class="_ _15"> </span>from<span class="_ _21"> </span>the<span class="_ _21"> </span>same<span class="_ _21"> </span>virtual<span class="_ _21"> </span>pages<span class="_ _1"></span>.<span class="_ _21"> </span>Further,<span class="_ _f"> </span>the<span class="_ _15"> </span>cache<span class="_ _21"> </span>does<span class="_ _21"> </span>not<span class="_ _21"> </span>have<span class="_ _21"> </span>to<span class="_ _21"> </span>deal</div><div class="t m5 x17 h26 y6e7b ff7 fs19 fc1 sc0 ls0 ws0">with<span class="_ _16"> </span>protection<span class="_ _14"> </span>issues<span class="_ _1"></span>,<span class="_ _14"> </span>because<span class="_ _14"> </span>access<span class="_ _16"> </span>rights<span class="_ _14"> </span>are<span class="_ _16"> </span>checked<span class="_ _14"> </span>as<span class="_ _16"> </span>part<span class="_ _14"> </span>of<span class="_ _16"> </span>the<span class="_ _14"> </span>address</div><div class="t m5 x17 h26 y6e7c ff7 fs19 fc1 sc0 ls0 ws0">translation<span class="_"> </span>process<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y6e7d ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_"> </span>9.14<span class="_"> </span>shows<span class="_ _13"> </span>how<span class="_"> </span>a<span class="_"> </span>physically<span class="_ _13"> </span>addressed<span class="_"> </span>cache<span class="_"> </span>might<span class="_ _13"> </span>be<span class="_"> </span>integrated<span class="_"> </span>with</div><div class="t m5 x17 h26 y6e7e ff7 fs19 fc1 sc0 ls0 ws0">virtual<span class="_ _16"> </span>memory<span class="_ _3"></span>.<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span>main<span class="_ _16"> </span>idea<span class="_ _16"> </span>is<span class="_ _16"> </span>that<span class="_ _16"> </span>the<span class="_ _16"> </span>address<span class="_ _16"> </span>translation<span class="_ _16"> </span>occurs<span class="_ _16"> </span>before<span class="_ _16"> </span>the</div><div class="t m5 x17 h26 y6e7f ff7 fs19 fc1 sc0 ls0 ws0">cache<span class="_ _16"> </span>lookup.<span class="_ _16"> </span>Notice<span class="_ _14"> </span>that<span class="_ _14"> </span>page<span class="_ _16"> </span>table<span class="_ _14"> </span>entries<span class="_ _14"> </span>can<span class="_ _14"> </span>be<span class="_ _14"> </span>cached,<span class="_ _14"> </span>just<span class="_ _14"> </span>like<span class="_ _14"> </span>any<span class="_ _14"> </span>other</div><div class="t m5 x17 h26 y6e80 ff7 fs19 fc1 sc0 ls0 ws0">data<span class="_"> </span>words<span class="_ _1"></span>.</div><div class="t m5 x17 h41 y630 ffe fs29 fc1 sc0 ls0 ws0">9.6.2<span class="_ _48"> </span><span class="fs19">Speeding<span class="_"> </span>Up<span class="_"> </span>Address<span class="_"> </span>T<span class="_ _3"></span>ranslation<span class="_"> </span>with<span class="_"> </span>a<span class="_"> </span>TLB</span></div><div class="t m5 x17 h26 ye4e ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_ _13"> </span>we<span class="_"> </span>have<span class="_ _13"> </span>seen,<span class="_ _13"> </span>every<span class="_"> </span>time<span class="_ _13"> </span>the<span class="_ _13"> </span>CPU<span class="_ _13"> </span>generates<span class="_"> </span>a<span class="_ _13"> </span>virtual<span class="_ _13"> </span>address<span class="_ _1"></span>,<span class="_"> </span>the<span class="_ _13"> </span>MMU<span class="_ _13"> </span>must</div><div class="t m5 x17 h26 ye4f ff7 fs19 fc1 sc0 ls0 ws0">refer<span class="_"> </span>to<span class="_"> </span>a<span class="_"> </span>PTE<span class="_"> </span>in<span class="_"> </span>order<span class="_"> </span>to<span class="_"> </span>translate<span class="_"> </span>the<span class="_"> </span>virtual<span class="_"> </span>address<span class="_"> </span>into<span class="_"> </span>a<span class="_"> </span>physical<span class="_"> </span>address<span class="_ _1"></span>.<span class="_"> </span>In</div><div class="t m5 x17 h26 ye50 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>worst<span class="_"> </span>case<span class="_ _1"></span>,<span class="_"> </span>this<span class="_"> </span>requires<span class="_ _11"> </span>an<span class="_"> </span>additional<span class="_"> </span>fetch<span class="_"> </span>from<span class="_"> </span>memory<span class="_ _3"></span>,<span class="_"> </span>at<span class="_"> </span>a<span class="_"> </span>cost<span class="_"> </span>of<span class="_"> </span>tens<span class="_"> </span>to</div><div class="t m5 x17 h26 ye51 ff7 fs19 fc1 sc0 ls0 ws0">hundreds<span class="_ _6"> </span>of<span class="_ _13"> </span>cycles<span class="_ _3"></span>.<span class="_ _13"> </span>If<span class="_ _6"> </span>the<span class="_ _13"> </span>PTE<span class="_ _6"> </span>happens<span class="_ _13"> </span>to<span class="_ _6"> </span>be<span class="_ _13"> </span>cached<span class="_ _6"> </span>in<span class="_ _13"> </span>L1,<span class="_ _6"> </span>then<span class="_ _13"> </span>the<span class="_ _6"> </span>cost<span class="_ _13"> </span>goes<span class="_ _6"> </span>down</div><div class="t m5 x17 h26 ye52 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _11"> </span>a<span class="_ _11"> </span>handful<span class="_ _11"> </span>of<span class="_ _11"> </span>cycles<span class="_ _1"></span>.<span class="_ _11"> </span>However,<span class="_ _11"> </span>many<span class="_ _11"> </span>systems<span class="_ _11"> </span>try<span class="_ _11"> </span>to<span class="_ _11"> </span>eliminate<span class="_ _16"> </span>even<span class="_"> </span>this<span class="_ _11"> </span>cost<span class="_ _16"> </span>by</div><div class="t m5 x17 h26 ye53 ff7 fs19 fc1 sc0 ls0 ws0">including<span class="_"> </span>a<span class="_ _13"> </span>small<span class="_"> </span>cache<span class="_"> </span>of<span class="_ _13"> </span>PTEs<span class="_"> </span>in<span class="_ _13"> </span>the<span class="_"> </span>MMU<span class="_"> </span>called<span class="_ _13"> </span>a<span class="_"> </span><span class="ffa">translation<span class="_"> </span>lookaside<span class="_ _13"> </span>buffer</span></div><div class="t m5 x17 h26 ye54 ffa fs19 fc1 sc0 ls0 ws0">(TLB)<span class="_ _3"></span><span class="ff7">.</span></div><div class="t m5 x26 h26 ye55 ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_ _14"> </span>TLB<span class="_ _14"> </span>is<span class="_ _14"> </span>a<span class="_ _14"> </span>small,<span class="_ _15"> </span>virtually<span class="_ _14"> </span>addressed<span class="_ _14"> </span>cache<span class="_ _14"> </span>where<span class="_ _14"> </span>each<span class="_ _14"> </span>line<span class="_ _14"> </span>holds<span class="_ _14"> </span>a<span class="_ _14"> </span>block</div><div class="t m5 x17 h26 ye56 ff7 fs19 fc1 sc0 ls0 ws0">consisting<span class="_ _11"> </span>of<span class="_ _16"> </span>a<span class="_ _11"> </span>single<span class="_ _16"> </span>PTE.<span class="_ _11"> </span>A<span class="_ _11"> </span>TLB<span class="_ _16"> </span>usually<span class="_ _11"> </span>has<span class="_ _16"> </span>a<span class="_ _11"> </span>high<span class="_ _16"> </span>degree<span class="_ _11"> </span>of<span class="_ _11"> </span>associativity<span class="_ _3"></span>.<span class="_ _16"> </span>As</div><div class="t m5 x17 h26 ye57 ff7 fs19 fc1 sc0 ls0 ws0">shown<span class="_ _6"> </span>in<span class="_ _13"> </span>F<span class="_ _1"></span>igure<span class="_ _13"> </span>9.15,<span class="_ _6"> </span>the<span class="_ _13"> </span>index<span class="_ _6"> </span>and<span class="_ _6"> </span>tag<span class="_ _13"> </span>ﬁelds<span class="_ _6"> </span>that<span class="_ _6"> </span>are<span class="_ _13"> </span>used<span class="_ _6"> </span>for<span class="_ _13"> </span>set<span class="_ _a"> </span>selection<span class="_ _13"> </span>and<span class="_ _6"> </span>line</div><div class="t m5 x17 h26 ye58 ff7 fs19 fc1 sc0 ls0 ws0">matching<span class="_"> </span>are<span class="_ _13"> </span>extracted<span class="_"> </span>from<span class="_ _13"> </span>the<span class="_"> </span>virtual<span class="_ _13"> </span>page<span class="_"> </span>number<span class="_ _13"> </span>in<span class="_"> </span>the<span class="_ _13"> </span>virtual<span class="_"> </span>address<span class="_ _3"></span>.<span class="_"> </span>If<span class="_ _13"> </span>the</div><div class="t m5 x17 h46 ye59 ff7 fs19 fc1 sc0 ls0 ws0">TLB<span class="_"> </span>has<span class="_"> </span><span class="ff11">T<span class="_ _15"> </span><span class="ff12">=<span class="_ _10"> </span></span></span>2</div><div class="t m5 xcf h50 y6e81 ff11 fs25 fc1 sc0 ls0 ws0">t</div><div class="t m5 x161 h26 ye95 ff7 fs19 fc1 sc0 ls0 ws0">sets<span class="_ _1"></span>,<span class="_"> </span>then<span class="_"> </span>the<span class="_"> </span><span class="ffa">TLB<span class="_ _13"> </span>index<span class="_"> </span>(TLBI)<span class="_ _13"> </span></span>consists<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_"> </span><span class="ff11">t<span class="_"> </span></span>least<span class="_"> </span>signiﬁcant</div><div class="t m5 x17 h26 y5b57 ff7 fs19 fc1 sc0 ls0 ws0">bits<span class="_ _6"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>VPN<span class="_ _3"></span>,<span class="_ _13"> </span>and<span class="_ _a"> </span>the<span class="_ _13"> </span><span class="ffa">TLB<span class="_ _a"> </span>tag<span class="_ _13"> </span>(TLBT)<span class="_ _5"></span></span>consists<span class="_ _13"> </span>of<span class="_ _a"> </span>the<span class="_ _13"> </span>remaining<span class="_ _a"> </span>bits<span class="_ _13"> </span>in<span class="_ _a"> </span>the<span class="_ _13"> </span>VPN<span class="_ _3"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
