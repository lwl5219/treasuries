<div id="pf3b3" class="pf w2 h11" data-page-no="3b3"><div class="pc pc3b3 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg3b3.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">946<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>10<span class="_ _3d"> </span>System-Level<span class="_ _10"> </span>I/O</span></div><div class="t m5 x28 h2a y257 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">Right<span class="_ _11"> </span>and<span class="_ _11"> </span>left<span class="_ _11"> </span>hoinkies</span></div><div class="t m5 x28 h2b y2d0 ff7 fs1e fc2 sc0 ls0 ws0">T<span class="_ _3"></span>o<span class="_ _11"> </span>avoid<span class="_ _11"> </span>confusion<span class="_ _11"> </span>with<span class="_ _11"> </span>other<span class="_ _11"> </span>bracket-type<span class="_ _11"> </span>operators<span class="_ _11"> </span>such<span class="_ _11"> </span>as<span class="_ _11"> </span>‘<span class="ffd">]</span>’<span class="_ _11"> </span>and<span class="_ _11"> </span>‘<span class="ffd">[</span>’,<span class="_ _16"> </span>we<span class="_ _10"> </span>have<span class="_ _11"> </span>always<span class="_ _11"> </span>referred<span class="_ _16"> </span>to</div><div class="t m5 x28 h2b y2d1 ff7 fs1e fc2 sc0 ls0 ws0">the<span class="_"> </span>shell’s<span class="_"> </span>‘<span class="ffd">&gt;</span>’<span class="_"> </span>operator<span class="_"> </span>as<span class="_"> </span>a<span class="_"> </span>“right<span class="_"> </span>hoinky”<span class="_"> </span>and<span class="_"> </span>the<span class="_"> </span>‘<span class="ffd">&lt;</span>’<span class="_"> </span>operator<span class="_"> </span>as<span class="_"> </span>a<span class="_"> </span>“left<span class="_"> </span>hoinky<span class="_ _7"></span>.<span class="_ _1"></span>”</div><div class="t m5 x14 h2f y7905 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>10.15</div><div class="t m5 x14 h2f y7906 ffe fs16 fc1 sc0 ls0 ws0">Kernel<span class="_ _16"> </span>data<span class="_ _16"> </span>structures</div><div class="t m5 x14 h2f y7907 ffe fs16 fc1 sc0 ls0 ws0">after<span class="_ _13"> </span>redirecting<span class="_ _13"> </span>standard</div><div class="t m5 x14 h2f y7908 ffe fs16 fc1 sc0 ls0 ws0">output<span class="_ _21"> </span>by<span class="_ _21"> </span>calling</div><div class="t m5 x14 h3a y7909 ffd fs19 fc1 sc0 ls0 ws0">dup2(4,1)<span class="ffe fs16">.<span class="_ _16"> </span><span class="ff6">The<span class="_ _14"> </span>initial</span></span></div><div class="t m5 x14 h34 y790a ff6 fs16 fc1 sc0 ls0 ws0">situation<span class="_ _14"> </span>is<span class="_ _15"> </span>shown<span class="_ _15"> </span>in</div><div class="t m5 x14 h34 y790b ff6 fs16 fc1 sc0 ls0 ws0">Figure<span class="_ _10"> </span>10.12.</div><div class="t m5 x129 h3f y790c ffd0 fs27 fc1 sc0 ls0 ws0">Descriptor table</div><div class="t m5 x7c h3f y790d ffd0 fs27 fc1 sc0 ls0 ws0">(one table</div><div class="t m5 x25 h3f y790e ffd0 fs27 fc1 sc0 ls0 ws0">per process)</div><div class="t m5 x184 h3f y790f ffd0 fs27 fc1 sc0 ls0 ws0">Open file table</div><div class="t m5 xfd h3f y7910 ffd0 fs27 fc1 sc0 ls0 ws0">(shared by</div><div class="t m5 xd5 h3f y7911 ffd0 fs27 fc1 sc0 ls0 ws0">all processes)</div><div class="t m5 x1fd h3f y7912 ffd0 fs27 fc1 sc0 ls0 ws0">v-node table</div><div class="t m5 xb5 h3f y7913 ffd0 fs27 fc1 sc0 ls0 ws0">(shared by</div><div class="t m5 x171 h3f y7914 ffd0 fs27 fc1 sc0 ls0 ws0">all processes)</div><div class="t m5 xe0 h3f y7915 ffd0 fs27 fc1 sc0 ls0 ws0">   fd 0</div><div class="t m5 xe0 h3f y7916 ffd0 fs27 fc1 sc0 ls0 ws0">   fd 1</div><div class="t m5 xe0 h3f y7917 ffd0 fs27 fc1 sc0 ls0 ws0">   fd 2</div><div class="t m5 x141 h3f y7918 ffd0 fs27 fc1 sc0 ls0 ws0"> fd 3</div><div class="t m5 x129 h3f y7919 ffd0 fs27 fc1 sc0 ls0 ws0">fd 4</div><div class="t m5 xae h3f y791a ffd0 fs27 fc1 sc0 ls0 ws0">File size</div><div class="t m5 x8a h3f y791b ffd0 fs27 fc1 sc0 ls0 ws0">File access</div><div class="t m5 x1bd h3f y791c ffd0 fs27 fc1 sc0 ls0 ws0">File type</div><div class="t m5 x1ae h3f y791d ffd0 fs27 fc1 sc0 ls0 ws0">File B</div><div class="t m5 x118 h3f y791e ffd0 fs27 fc1 sc0 ls0 ws0">File pos</div><div class="t m5 x139 h40 y791f ffd1 fs28 fc1 sc0 ls0 ws0">refcnt<span class="ff24"></span>2</div><div class="t m8 xa1 h3f y7920 ffd0 fs27 fc1 sc0 ls0 ws0">…</div><div class="t m5 x1ae h3f y7921 ffd0 fs27 fc1 sc0 ls0 ws5">File A</div><div class="t m5 x118 h3f y7922 ffd0 fs27 fc1 sc0 ls0 ws0">File pos</div><div class="t m5 x139 h40 y7923 ffd1 fs28 fc1 sc0 ls0 ws0">refcnt<span class="ff24"></span>0</div><div class="t m8 xa1 h3f y7924 ffd0 fs27 fc1 sc0 ls0 ws0">…</div><div class="t m8 x43 h3f y7925 ffd0 fs27 fc1 sc0 ls0 ws0">…</div><div class="t m5 xae h3f y7926 ffd0 fs27 fc1 sc0 ls0 ws0">File size</div><div class="t m5 x8a h3f y7927 ffd0 fs27 fc1 sc0 ls0 ws0">File access</div><div class="t m5 x1bd h3f y7928 ffd0 fs27 fc1 sc0 ls0 ws0">File type</div><div class="t m8 x43 h3f y7929 ffd0 fs27 fc1 sc0 ls0 ws0">…</div><div class="t m5 x1d h47 y792a ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>10.5<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>952)</span></div><div class="t m5 x1d h26 y792b ff7 fs19 fc1 sc0 ls0 ws0">Assuming<span class="_ _f"> </span>that<span class="_ _e"> </span>the<span class="_ _f"> </span>disk<span class="_ _f"> </span>ﬁle<span class="_ _e"> </span><span class="ffd">foobar.txt<span class="_ _f"> </span></span>consists<span class="_ _f"> </span>of<span class="_ _e"> </span>the<span class="_ _f"> </span>six<span class="_ _e"> </span>ASCII<span class="_ _21"> </span>characters</div><div class="t m5 x1d h26 y792c ffd fs19 fc1 sc0 ls0 ws0">foobar<span class="ff7">,<span class="_"> </span>what<span class="_"> </span>is<span class="_"> </span>the<span class="_"> </span>output<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>program?</span></div><div class="t m5 x1f h2e ycc6 ff6 fs20 fc6 sc0 ls0 ws0">1</div><div class="t m5 x4f h2d y441 ffd fs1e fc2 sc0 ls0 ws0">#include<span class="_ _e"> </span>&quot;csapp.h&quot;</div><div class="t m5 x1f h2e y792d ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x1f h2e y792e ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x4f h2d y6fd ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>main()</div><div class="t m5 x1f h2d y1a3b ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x1f h2d y8f8 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _20"> </span><span class="ffd fs1e fc2">int<span class="_ _e"> </span>fd1,<span class="_ _1f"> </span>fd2;</span></div><div class="t m5 x1f h2e y5fc ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 x33 h2d y5fd ffd fs1e fc2 sc0 ls0 ws0">char<span class="_ _e"> </span>c;</div><div class="t m5 x1f h2e y2441 ff6 fs20 fc6 sc0 ls0 ws0">7</div><div class="t m5 x1f h2e y792f ff6 fs20 fc6 sc0 ls0 ws0">8</div><div class="t m5 x33 h2d y22d4 ffd fs1e fc2 sc0 ls0 ws0">fd1<span class="_ _e"> </span>=<span class="_ _1f"> </span>Open(&quot;foobar.txt&quot;,<span class="_ _1f"> </span>O_RDONLY,<span class="_ _e"> </span>0);</div><div class="t m5 x1f h2d y277 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _20"> </span><span class="ffd fs1e fc2">fd2<span class="_ _e"> </span>=<span class="_ _1f"> </span>Open(&quot;foobar.txt&quot;,<span class="_ _1f"> </span>O_RDONLY,<span class="_ _e"> </span>0);</span></div><div class="t m5 x1b0 h2e y5e35 ff6 fs20 fc6 sc0 ls0 ws0">10</div><div class="t m5 x33 h2d y2269 ffd fs1e fc2 sc0 ls0 ws0">Read(fd2,<span class="_ _e"> </span>&amp;c,<span class="_ _1f"> </span>1);</div><div class="t m5 x1b0 h2d y591f ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _20"> </span><span class="ffd fs1e fc2">Dup2(fd2,<span class="_ _e"> </span>fd1);</span></div><div class="t m5 x1b0 h2e y1051 ff6 fs20 fc6 sc0 ls0 ws0">12</div><div class="t m5 x33 h2d y23d9 ffd fs1e fc2 sc0 ls0 ws0">Read(fd1,<span class="_ _e"> </span>&amp;c,<span class="_ _1f"> </span>1);</div><div class="t m5 x1b0 h2d y3874 ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _20"> </span><span class="ffd fs1e fc2">printf(&quot;c<span class="_ _e"> </span>=<span class="_ _1f"> </span>%c\n&quot;,<span class="_ _1f"> </span>c);</span></div><div class="t m5 x1b0 h2d y1672 ff6 fs20 fc6 sc0 ls0 ws0">14<span class="_ _20"> </span><span class="ffd fs1e fc2">exit(0);</span></div><div class="t m5 x1b0 h2d y28e1 ff6 fs20 fc6 sc0 ls0 ws0">15<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
