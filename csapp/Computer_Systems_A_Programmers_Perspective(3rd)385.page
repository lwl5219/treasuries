<div id="pf181" class="pf w2 h11" data-page-no="181"><div class="pc pc181 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg181.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">384<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x75 h3d y2d1a ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 ye7 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _11"> </span>value<span class="_ _11"> </span>at<span class="_ _11"> </span><span class="ffd">dp<span class="_ _11"> </span></span>is<span class="_ _11"> </span>retrieved,<span class="_ _11"> </span>converted<span class="_ _11"> </span>to<span class="_ _11"> </span>an<span class="_ _11"> </span><span class="ffd">int<span class="_ _11"> </span></span>(line<span class="_ _11"> </span>4),<span class="_ _11"> </span>and<span class="_ _11"> </span>then<span class="_ _11"> </span>stored<span class="_ _11"> </span>at</div><div class="t m5 x29 h26 y2a7 ffd fs19 fc1 sc0 ls0 ws0">ip<span class="ff7">.<span class="_"> </span>W<span class="_ _3"></span>e<span class="_"> </span>can<span class="_"> </span>therefore<span class="_"> </span>infer<span class="_"> </span>that<span class="_"> </span><span class="ffd">val1<span class="_ _10"> </span></span>is<span class="_"> </span><span class="ffd">d</span>.</span></div><div class="t m5 x75 h3d y35f0 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y35f1 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>value<span class="_"> </span>at<span class="_"> </span><span class="ffd">ip<span class="_ _10"> </span></span>is<span class="_"> </span>retrieved,<span class="_"> </span>converted<span class="_ _13"> </span>to<span class="_"> </span>a<span class="_"> </span><span class="ffd">float<span class="_ _10"> </span></span>(line<span class="_"> </span>6),<span class="_"> </span>and<span class="_"> </span>then<span class="_ _13"> </span>stored<span class="_"> </span>at</div><div class="t m5 x29 h26 y35f2 ffd fs19 fc1 sc0 ls0 ws0">fp<span class="ff7">.<span class="_"> </span>W<span class="_ _3"></span>e<span class="_"> </span>can<span class="_"> </span>therefore<span class="_"> </span>infer<span class="_"> </span>that<span class="_"> </span><span class="ffd">val2<span class="_ _10"> </span></span>is<span class="_"> </span><span class="ffd">i</span>.</span></div><div class="t m5 x75 h3d y35f3 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y35f4 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _15"> </span>value<span class="_ _14"> </span>of<span class="_ _15"> </span><span class="ffd">l<span class="_ _14"> </span></span>is<span class="_ _15"> </span>converted<span class="_ _14"> </span>to<span class="_ _15"> </span>a<span class="_ _14"> </span><span class="ffd">double<span class="_ _15"> </span></span>(line<span class="_ _14"> </span>8)<span class="_ _14"> </span>and<span class="_ _15"> </span>stored<span class="_ _14"> </span>at<span class="_ _15"> </span><span class="ffd">dp</span><span class="ls1a8">.W<span class="_ _8a"></span>ec<span class="_ _42"></span>a<span class="_ _9"></span>n</span></div><div class="t m5 x29 h26 y35f5 ff7 fs19 fc1 sc0 ls0 ws0">therefore<span class="_"> </span>infer<span class="_"> </span>that<span class="_"> </span><span class="ffd">val3<span class="_ _10"> </span></span>is<span class="_"> </span><span class="ffd">l</span>.</div><div class="t m5 x75 h3d y35f6 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y35f7 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _15"> </span>value<span class="_ _21"> </span>at<span class="_ _15"> </span><span class="ffd">fp<span class="_ _15"> </span></span>is<span class="_ _15"> </span>retrieved<span class="_ _21"> </span>on<span class="_ _15"> </span>line<span class="_ _15"> </span>3.<span class="_ _21"> </span>T<span class="_ _1"></span>he<span class="_ _15"> </span>two<span class="_ _21"> </span>instructions<span class="_ _15"> </span>at<span class="_ _15"> </span>lines<span class="_ _21"> </span>10–11</div><div class="t m5 x29 h26 y35f8 ff7 fs19 fc1 sc0 ls0 ws0">convert<span class="_ _11"> </span>this<span class="_ _16"> </span>to<span class="_ _11"> </span>double<span class="_ _16"> </span>precision<span class="_ _11"> </span>as<span class="_ _16"> </span>the<span class="_ _11"> </span>value<span class="_ _16"> </span>returned<span class="_ _11"> </span>in<span class="_ _11"> </span>register<span class="_ _16"> </span><span class="ffd">%xmm0</span><span class="ls1a9">.W<span class="_ _9"></span>e</span></div><div class="t m5 x29 h26 y35f9 ff7 fs19 fc1 sc0 ls0 ws0">can<span class="_"> </span>therefore<span class="_"> </span>infer<span class="_"> </span>that<span class="_"> </span><span class="ffd">val4<span class="_ _10"> </span></span>is<span class="_"> </span><span class="ffd">f</span>.</div><div class="t m5 x1d h28 y35fa ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>3.51<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>336)</span></div><div class="t m5 x1d h26 y35fb ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>hese<span class="_"> </span>cases<span class="_ _13"> </span>can<span class="_ _13"> </span>be<span class="_ _13"> </span>handled<span class="_"> </span>by<span class="_ _13"> </span>selecting<span class="_ _13"> </span>the<span class="_"> </span>appropriate<span class="_ _13"> </span>entries<span class="_ _13"> </span>from<span class="_ _13"> </span>the<span class="_"> </span>tables<span class="_ _13"> </span>in</div><div class="t m5 x1d h26 y35fc ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igures<span class="_"> </span>3.47<span class="_"> </span>and<span class="_"> </span>3.48,<span class="_"> </span>or<span class="_"> </span>using<span class="_ _13"> </span>one<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>code<span class="_"> </span>sequences<span class="_ _13"> </span>for<span class="_"> </span>converting<span class="_"> </span>between</div><div class="t m5 x1d h26 y35fd ff7 fs19 fc1 sc0 ls0 ws0">ﬂoating-point<span class="_"> </span>formats<span class="_ _1"></span>.</div><div class="t m5 x1d h55 y35fe ff11 fs21 fc2 sc0 ls0 ws0">T</div><div class="t m5 xc5 h6d y35ff ffd fs2c fc2 sc0 ls0 ws0">x</div><div class="t m5 xe0 h55 y35fe ff11 fs21 fc2 sc0 ls0 ws0">T</div><div class="t m5 x18e h6d y35ff ffd fs2c fc2 sc0 ls0 ws0">y</div><div class="t m5 x167 h31 y35fe ff7 fs21 fc2 sc0 ls0 ws0">Instruction(s)</div><div class="t m5 x1d h2d y3600 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _2e"> </span>double<span class="_ _26"> </span>vcvtsi2sdq<span class="_ _11"> </span>%rdi,<span class="_ _11"> </span>%xmm0,<span class="_ _11"> </span>%xmm0</div><div class="t m5 x1d h2d y3601 ffd fs1e fc2 sc0 ls0 ws0">double<span class="_ _26"> </span>int<span class="_ _105"> </span>vcvttsd2si<span class="_ _11"> </span>%xmm0,<span class="_ _11"> </span>%eax</div><div class="t m5 x1d h2d y3602 ffd fs1e fc2 sc0 ls0 ws0">float<span class="_ _75"> </span>double<span class="_ _26"> </span>vunpcklpd<span class="_ _11"> </span>%xmm0,<span class="_ _11"> </span>%xmm0,<span class="_ _11"> </span>%xmm0</div><div class="t m5 x167 h2d y3603 ffd fs1e fc2 sc0 ls0 ws0">vcvtpd2ps<span class="_ _11"> </span>%xmm0,<span class="_ _11"> </span>%xmm0</div><div class="t m5 x1d h2d y3604 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _2e"> </span>float<span class="_ _75"> </span>vcvtsi2ssq<span class="_ _11"> </span>%rdi,<span class="_ _11"> </span>%xmm0,<span class="_ _11"> </span>%xmm0</div><div class="t m5 x1d h2d y3605 ffd fs1e fc2 sc0 ls0 ws0">float<span class="_ _75"> </span>long<span class="_ _2e"> </span>vcvttss2siq<span class="_ _11"> </span>%xmm0,<span class="_ _11"> </span>%rax</div><div class="t m5 x1d h28 y3606 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>3.52</div><div class="t m5 xe1 h2f y3607 ffe fs16 fc6 sc0 ls0 ws0">(page<span class="_"> </span>337)</div><div class="t m5 x1d h26 y3608 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _13"> </span>basic<span class="_ _6"> </span>rules<span class="_ _13"> </span>for<span class="_ _6"> </span>mapping<span class="_ _6"> </span>arguments<span class="_ _13"> </span>to<span class="_ _6"> </span>registers<span class="_ _13"> </span>are<span class="_ _6"> </span>fairly<span class="_ _6"> </span>simple<span class="_ _13"> </span>(although<span class="_ _6"> </span>they</div><div class="t m5 x1d h26 y3609 ff7 fs19 fc1 sc0 ls0 ws0">become<span class="_"> </span>much<span class="_"> </span>more<span class="_"> </span>complex<span class="_"> </span>with<span class="_"> </span>more<span class="_"> </span>and<span class="_"> </span>other<span class="_"> </span>types<span class="_"> </span>of<span class="_"> </span>arguments<span class="_"> </span>[77]).</div><div class="t m5 x124 h26 y360a ff7 fs19 fc1 sc0 ls0 ws0">A.</div><div class="t m5 x4f h2d y360b ffd fs1e fc2 sc0 ls0 ws0">double<span class="_ _e"> </span>g1(double<span class="_ _1f"> </span>a,<span class="_ _1f"> </span>long<span class="_ _e"> </span>b,<span class="_ _1f"> </span>float<span class="_ _e"> </span>c,<span class="_ _1f"> </span>int<span class="_ _1f"> </span>d);</div><div class="t m5 x4f h26 y360c ff7 fs19 fc2 sc0 ls0 ws0">Registers:<span class="_"> </span><span class="ffd">a<span class="_ _10"> </span></span>in<span class="_"> </span><span class="ffd">%xmm0</span>,<span class="_"> </span><span class="ffd">b<span class="_ _10"> </span></span>in<span class="_"> </span><span class="ffd">%rdi<span class="_ _10"> </span>c<span class="_ _10"> </span></span>in<span class="_"> </span><span class="ffd">%xmm1</span>,<span class="_"> </span><span class="ffd">d<span class="_ _10"> </span></span>in<span class="_"> </span><span class="ffd">%esi</span></div><div class="t m5 x124 h26 y360d ff7 fs19 fc2 sc0 ls2a ws0">B.</div><div class="t m5 x4f h2d y360e ffd fs1e fc2 sc0 ls0 ws0">double<span class="_ _e"> </span>g2(int<span class="_ _1f"> </span>a,<span class="_ _1f"> </span>double<span class="_ _e"> </span>*b,<span class="_ _1f"> </span>float<span class="_ _e"> </span>*c,<span class="_ _1f"> </span>long<span class="_ _1f"> </span>d);</div><div class="t m5 x4f h26 y360f ff7 fs19 fc2 sc0 ls0 ws0">Registers:<span class="_"> </span><span class="ffd">a<span class="_ _10"> </span></span>in<span class="_"> </span><span class="ffd">%edi</span>,<span class="_"> </span><span class="ffd">b<span class="_ _10"> </span></span>in<span class="_"> </span><span class="ffd">%rsi</span>,<span class="_"> </span><span class="ffd">c<span class="_ _10"> </span></span>in<span class="_"> </span><span class="ffd">%rdx</span>,<span class="_"> </span><span class="ffd">d<span class="_ _10"> </span></span>in<span class="_"> </span><span class="ffd">%rcx</span></div><div class="t m5 x124 h26 y3610 ff7 fs19 fc2 sc0 ls22 ws0">C.</div><div class="t m5 x4f h2d y3611 ffd fs1e fc2 sc0 ls0 ws0">double<span class="_ _e"> </span>g3(double<span class="_ _1f"> </span>*a,<span class="_ _1f"> </span>double<span class="_ _e"> </span>b,<span class="_ _1f"> </span>int<span class="_ _e"> </span>c,<span class="_ _1f"> </span>float<span class="_ _1f"> </span>d);</div><div class="t m5 x4f h26 y3612 ff7 fs19 fc2 sc0 ls0 ws0">Registers:<span class="_"> </span><span class="ffd">a<span class="_ _10"> </span></span>in<span class="_"> </span><span class="ffd">%rdi</span>,<span class="_"> </span><span class="ffd">b<span class="_ _10"> </span></span>in<span class="_"> </span><span class="ffd">%xmm0</span>,<span class="_"> </span><span class="ffd">c<span class="_ _10"> </span></span>in<span class="_"> </span><span class="ffd">%esi</span>,<span class="_"> </span><span class="ffd">d<span class="_ _10"> </span></span>in<span class="_"> </span><span class="ffd">%xmm1</span></div><div class="t m5 x124 h26 y3613 ff7 fs19 fc2 sc0 ls2a ws0">D.</div><div class="t m5 x4f h2d y3614 ffd fs1e fc2 sc0 ls0 ws0">double<span class="_ _e"> </span>g4(float<span class="_ _1f"> </span>a,<span class="_ _1f"> </span>int<span class="_ _e"> </span>*b,<span class="_ _1f"> </span>float<span class="_ _e"> </span>c,<span class="_ _1f"> </span>double<span class="_ _1f"> </span>d);</div><div class="t m5 x4f h26 y3615 ff7 fs19 fc2 sc0 ls0 ws0">Registers:<span class="_"> </span><span class="ffd">a<span class="_ _10"> </span></span>in<span class="_"> </span><span class="ffd">%xmm0</span>,<span class="_"> </span><span class="ffd">b<span class="_ _10"> </span></span>in<span class="_"> </span><span class="ffd">%rdi</span>,<span class="_"> </span><span class="ffd">c<span class="_ _10"> </span></span>in<span class="_"> </span><span class="ffd">%xmm1</span>,<span class="_"> </span><span class="ffd">d<span class="_ _10"> </span></span>in<span class="_"> </span><span class="ffd">%xmm2</span></div><div class="t m5 x1d h28 y1ea8 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>3.53<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>339)</span></div><div class="t m5 x1d h26 ye93 ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_"> </span>can<span class="_"> </span>see<span class="_"> </span>from<span class="_"> </span>the<span class="_ _11"> </span>assembly<span class="_"> </span>code<span class="_"> </span>that<span class="_"> </span>there<span class="_"> </span>are<span class="_"> </span>two<span class="_"> </span>integer<span class="_"> </span>arguments<span class="_ _0"></span>,<span class="_"> </span>passed</div><div class="t m5 x1d h26 y2532 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_"> </span>registers<span class="_"> </span><span class="ffd">%rdi<span class="_ _10"> </span></span>and<span class="_ _11"> </span><span class="ffd">%rsi</span>.<span class="_"> </span>Let<span class="_"> </span>us<span class="_"> </span>name<span class="_ _11"> </span>these<span class="_"> </span><span class="ffd">i1<span class="_ _10"> </span></span>and<span class="_"> </span><span class="ffd">i2</span>.<span class="_ _11"> </span>Similarly<span class="_ _3"></span>,<span class="_"> </span>there<span class="_"> </span>are<span class="_"> </span>two</div><div class="t m5 x1d h26 y2533 ff7 fs19 fc1 sc0 ls0 ws0">ﬂoating-point<span class="_ _13"> </span>arguments<span class="_ _1"></span>,<span class="_"> </span>passed<span class="_ _13"> </span>in<span class="_"> </span>registers<span class="_ _13"> </span><span class="ffd">%xmm0<span class="_ _10"> </span></span>and<span class="_ _13"> </span><span class="ffd">%xmm1</span>,<span class="_"> </span>which<span class="_ _13"> </span>we<span class="_"> </span>name<span class="_ _13"> </span><span class="ffd">f1</span></div><div class="t m5 x1d h26 y2534 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_"> </span><span class="ffd">f2</span>.</div><div class="t m5 x29 h26 y2535 ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_"> </span>can<span class="_"> </span>then<span class="_"> </span>annotate<span class="_"> </span>the<span class="_"> </span>assembly<span class="_"> </span>code:</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
