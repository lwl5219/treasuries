<div id="pfd5" class="pf w2 h11" data-page-no="d5"><div class="pc pcd5 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bgd5.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">212<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x1d h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_"> </span>generate<span class="_"> </span>the<span class="_"> </span>ﬁle<span class="_"> </span><span class="ffd">mstore.s</span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>full<span class="_"> </span>content<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>ﬁle<span class="_"> </span>is<span class="_"> </span>as<span class="_"> </span>follows:</div><div class="t m5 x22b h2d yecb ffd fs1e fc2 sc0 ls0 ws0">.file<span class="_ _3f"> </span>&quot;010-mstore.c&quot;</div><div class="t m5 x22b h2d y2145 ffd fs1e fc2 sc0 ls0 ws0">.text</div><div class="t m5 x22b h2d y2146 ffd fs1e fc2 sc0 ls0 ws0">.globl<span class="_ _1a"> </span>multstore</div><div class="t m5 x22b h2d y2147 ffd fs1e fc2 sc0 ls0 ws0">.type<span class="_ _3f"> </span>multstore,<span class="_ _e"> </span>@function</div><div class="t m5 x1d h2d y2148 ffd fs1e fc2 sc0 ls0 ws0">multstore:</div><div class="t m5 x22b h2d y2149 ffd fs1e fc2 sc0 ls0 ws0">pushq<span class="_ _3f"> </span>%rbx</div><div class="t m5 x22b h2d y214a ffd fs1e fc2 sc0 ls0 ws0">movq<span class="_ _46"> </span>%rdx,<span class="_ _e"> </span>%rbx</div><div class="t m5 x22b h2d y214b ffd fs1e fc2 sc0 ls0 ws0">call<span class="_ _46"> </span>mult2</div><div class="t m5 x22b h2d y214c ffd fs1e fc2 sc0 ls0 ws0">movq<span class="_ _46"> </span>%rax,<span class="_ _e"> </span>(%rbx)</div><div class="t m5 x22b h2d y214d ffd fs1e fc2 sc0 ls0 ws0">popq<span class="_ _46"> </span>%rbx</div><div class="t m5 x22b h2d y214e ffd fs1e fc2 sc0 ls0 ws0">ret</div><div class="t m5 x22b h2d y214f ffd fs1e fc2 sc0 ls0 ws0">.size<span class="_ _3f"> </span>multstore,<span class="_ _e"> </span>.-multstore</div><div class="t m5 x22b h2d y2150 ffd fs1e fc2 sc0 ls0 ws0">.ident<span class="_ _1a"> </span>&quot;GCC:<span class="_ _e"> </span>(Ubuntu<span class="_ _1f"> </span>4.8.1-2ubuntu1~12.04)<span class="_ _1f"> </span>4.8.1&quot;</div><div class="t m5 x22b h2d y2151 ffd fs1e fc2 sc0 ls0 ws0">.section<span class="_ _71"> </span>.note.GNU-stack,&quot;&quot;,@progbits</div><div class="t m5 x29 h26 y19a9 ff7 fs19 fc2 sc0 ls0 ws0">All<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>lines<span class="_ _11"> </span>beginning<span class="_ _16"> </span>with<span class="_ _16"> </span>‘<span class="ffd">.</span>’<span class="_ _11"> </span>are<span class="_ _16"> </span>directives<span class="_ _11"> </span>to<span class="_ _16"> </span>guide<span class="_ _16"> </span>the<span class="_ _11"> </span>assembler<span class="_ _16"> </span>and</div><div class="t m5 x1d h26 y19aa ff7 fs19 fc2 sc0 ls0 ws0">linker.<span class="_ _6"> </span>W<span class="_ _3"></span>e<span class="_ _13"> </span>can<span class="_ _13"> </span>generally<span class="_ _6"> </span>ignore<span class="_ _13"> </span>these<span class="_ _1"></span>.<span class="_ _13"> </span>On<span class="_ _6"> </span>the<span class="_ _13"> </span>other<span class="_ _6"> </span>hand,<span class="_ _13"> </span>there<span class="_ _13"> </span>are<span class="_ _6"> </span>no<span class="_ _13"> </span>explanatory</div><div class="t m5 x1d h26 y19ab ff7 fs19 fc2 sc0 ls0 ws0">remarks<span class="_"> </span>about<span class="_"> </span>what<span class="_"> </span>the<span class="_"> </span>instructions<span class="_"> </span>do<span class="_"> </span>or<span class="_"> </span>how<span class="_"> </span>they<span class="_"> </span>relate<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>source<span class="_"> </span>code<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y19ac ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_"> </span>provide<span class="_"> </span>a<span class="_"> </span>clearer<span class="_"> </span>presentation<span class="_"> </span>of<span class="_"> </span>assembly<span class="_"> </span>code<span class="_ _1"></span>,<span class="_"> </span>we<span class="_"> </span>will<span class="_"> </span>show<span class="_"> </span>it<span class="_"> </span>in<span class="_"> </span>a<span class="_ _13"> </span>form</div><div class="t m5 x1d h26 y19ad ff7 fs19 fc2 sc0 ls0 ws0">that<span class="_ _16"> </span>omits<span class="_ _16"> </span>most<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>directives<span class="_ _1"></span>,<span class="_ _14"> </span>while<span class="_ _16"> </span>including<span class="_ _16"> </span>line<span class="_ _11"> </span>numbers<span class="_ _16"> </span>and<span class="_ _16"> </span>explanatory</div><div class="t m5 x1d h26 y19ae ff7 fs19 fc2 sc0 ls0 ws0">annotations<span class="_ _1"></span>.<span class="_"> </span>F<span class="_ _1"></span>or<span class="_"> </span>our<span class="_"> </span>example<span class="_ _0"></span>,<span class="_"> </span>an<span class="_"> </span>annotated<span class="_"> </span>version<span class="_"> </span>would<span class="_"> </span>appear<span class="_"> </span>as<span class="_"> </span>follows:</div><div class="t m5 xad h61 y2152 ff13 fs35 fc6 sc0 ls0 ws0">void<span class="_ _f"> </span>multstore(long<span class="_ _f"> </span>x,<span class="_ _f"> </span>long<span class="_ _e"> </span>y,<span class="_ _21"> </span>long<span class="_ _f"> </span>*dest)</div><div class="t m5 xad h61 y2153 ff13 fs35 fc6 sc0 ls0 ws0">x<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi,<span class="_ _f"> </span>y<span class="_ _e"> </span>in<span class="_ _21"> </span>%rsi,<span class="_ _f"> </span>dest<span class="_ _e"> </span>in<span class="_ _21"> </span>%rdx</div><div class="t m5 x1f h2d y35e ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">multstore:</span></div><div class="t m5 x1f h2d y2154 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">pushq<span class="_ _3f"> </span>%rbx<span class="_ _12b"> </span></span><span class="ff13 fs35">Save<span class="_ _f"> </span>%rbx</span></div><div class="t m5 x1f h2d y2155 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rdx,<span class="_ _e"> </span>%rbx<span class="_ _59"> </span></span><span class="ff13 fs35">Copy<span class="_ _f"> </span>dest<span class="_ _e"> </span>to<span class="_ _21"> </span>%rbx</span></div><div class="t m5 x1f h2d y19b8 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">call<span class="_ _46"> </span>mult2<span class="_ _c2"> </span></span><span class="ff13 fs35">Call<span class="_ _f"> </span>mult2(x,<span class="_ _f"> </span>y)</span></div><div class="t m5 x1f h2d y2156 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rax,<span class="_ _e"> </span>(%rbx)<span class="_ _f1"> </span></span><span class="ff13 fs35">Store<span class="_ _f"> </span>result<span class="_ _f"> </span>at<span class="_ _f"> </span>*dest</span></div><div class="t m5 x1f h2d y442 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">popq<span class="_ _46"> </span>%rbx<span class="_ _12b"> </span></span><span class="ff13 fs35">Restore<span class="_ _f"> </span>%rbx</span></div><div class="t m5 x1f h2d y19ba ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">ret<span class="_ _12c"> </span></span><span class="ff13 fs35">Return</span></div><div class="t m5 x29 h26 y24b ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _13"> </span>typically<span class="_ _13"> </span>show<span class="_"> </span>only<span class="_ _13"> </span>the<span class="_ _13"> </span>lines<span class="_ _13"> </span>of<span class="_ _13"> </span>code<span class="_ _13"> </span>relevant<span class="_ _13"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>point<span class="_ _13"> </span>being<span class="_ _13"> </span>discussed.</div><div class="t m5 x1d h26 y24c ff7 fs19 fc2 sc0 ls0 ws0">Each<span class="_ _11"> </span>line<span class="_ _16"> </span>is<span class="_ _11"> </span>numbered<span class="_ _16"> </span>on<span class="_ _11"> </span>the<span class="_ _16"> </span>left<span class="_ _11"> </span>for<span class="_ _16"> </span>reference<span class="_ _11"> </span>and<span class="_ _11"> </span>annotated<span class="_ _16"> </span>on<span class="_ _11"> </span>the<span class="_ _16"> </span>right<span class="_ _11"> </span>by<span class="_ _16"> </span>a</div><div class="t m5 x1d h26 y24d ff7 fs19 fc2 sc0 ls0 ws0">brief<span class="_ _13"> </span>description<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>effect<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>instruction<span class="_ _13"> </span>and<span class="_ _13"> </span>how<span class="_"> </span>it<span class="_ _13"> </span>relates<span class="_ _13"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>computa-</div><div class="t m5 x1d h26 y24e ff7 fs19 fc2 sc0 ls0 ws0">tions<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _6"> </span>original<span class="_ _13"> </span>C<span class="_ _6"> </span>code.<span class="_ _6"> </span>T<span class="_ _0"></span>his<span class="_ _6"> </span>is<span class="_ _13"> </span>a<span class="_ _6"> </span>stylized<span class="_ _13"> </span>version<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _6"> </span>way<span class="_ _13"> </span>assembly-language</div><div class="t m5 x1d h26 y24f ff7 fs19 fc2 sc0 ls0 ws0">programmers<span class="_"> </span>format<span class="_"> </span>their<span class="_"> </span>code<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y250 ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _6"> </span>also<span class="_ _6"> </span>provide<span class="_ _6"> </span>W<span class="_ _1"></span>eb<span class="_ _6"> </span>asides<span class="_ _6"> </span>to<span class="_ _6"> </span>cover<span class="_ _6"> </span>material<span class="_ _6"> </span>intended<span class="_ _13"> </span>for<span class="_ _a"> </span>dedicated<span class="_ _6"> </span>machine-</div><div class="t m5 x1d h26 y251 ff7 fs19 fc2 sc0 ls0 ws0">language<span class="_ _21"> </span>enthusiasts<span class="_ _1"></span>.<span class="_ _21"> </span>One<span class="_ _21"> </span>W<span class="_ _3"></span>eb<span class="_ _21"> </span>aside<span class="_ _21"> </span>describes<span class="_ _21"> </span>IA32<span class="_ _21"> </span>machine<span class="_ _f"> </span>code<span class="_ _1"></span>.<span class="_ _21"> </span>Having<span class="_ _21"> </span>a</div><div class="t m5 x1d h26 y252 ff7 fs19 fc2 sc0 ls0 ws0">background<span class="_ _13"> </span>in<span class="_ _6"> </span>x86-64<span class="_ _13"> </span>makes<span class="_ _6"> </span>learning<span class="_ _13"> </span>IA32<span class="_ _13"> </span>fairly<span class="_ _6"> </span>simple<span class="_ _0"></span>.<span class="_ _13"> </span>Another<span class="_ _6"> </span>W<span class="_ _3"></span>eb<span class="_ _13"> </span>aside<span class="_ _13"> </span>gives</div><div class="t m5 x1d h26 y253 ff7 fs19 fc2 sc0 ls0 ws0">a<span class="_ _11"> </span>brief<span class="_ _16"> </span>presentation<span class="_ _16"> </span>of<span class="_ _11"> </span>ways<span class="_ _16"> </span>to<span class="_ _16"> </span>incorporate<span class="_ _11"> </span>assembly<span class="_ _16"> </span>code<span class="_ _11"> </span>into<span class="_ _16"> </span>C<span class="_ _16"> </span>programs<span class="_ _3"></span>.<span class="_ _16"> </span>F<span class="_ _1"></span>or</div><div class="t m5 x1d h26 y254 ff7 fs19 fc2 sc0 ls0 ws0">some<span class="_ _11"> </span>applications<span class="_ _1"></span>,<span class="_ _16"> </span>the<span class="_ _16"> </span>programmer<span class="_ _11"> </span>must<span class="_ _16"> </span>drop<span class="_ _11"> </span>down<span class="_ _16"> </span>to<span class="_ _11"> </span>assembly<span class="_ _16"> </span>code<span class="_ _11"> </span>to<span class="_ _16"> </span>access</div><div class="t m5 x1d h26 y255 ff7 fs19 fc2 sc0 ls0 ws0">low-level<span class="_ _16"> </span>features<span class="_ _14"> </span>of<span class="_ _14"> </span>the<span class="_ _14"> </span>machine<span class="_ _0"></span>.<span class="_ _14"> </span>One<span class="_ _16"> </span>approach<span class="_ _14"> </span>is<span class="_ _14"> </span>to<span class="_ _14"> </span>write<span class="_ _14"> </span>entire<span class="_ _14"> </span>functions<span class="_ _16"> </span>in</div><div class="t m5 x1d h26 y256 ff7 fs19 fc2 sc0 ls0 ws0">assembly<span class="_ _14"> </span>code<span class="_ _14"> </span>and<span class="_ _14"> </span>combine<span class="_ _14"> </span>them<span class="_ _16"> </span>with<span class="_ _14"> </span>C<span class="_ _14"> </span>functions<span class="_ _14"> </span>during<span class="_ _14"> </span>the<span class="_ _14"> </span>linking<span class="_ _14"> </span>stage.<span class="_ _16"> </span>A</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
