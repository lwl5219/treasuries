<div id="pf2d5" class="pf w2 h11" data-page-no="2d5"><div class="pc pc2d5 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg2d5.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">724<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>7<span class="_ _3d"> </span>Linking</span></div><div class="t m5 x1d h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">Since<span class="_ _6"> </span>the<span class="_ _13"> </span>program<span class="_ _a"> </span>doesn’t<span class="_ _6"> </span>reference<span class="_ _13"> </span>any<span class="_ _a"> </span>symbols<span class="_ _13"> </span>deﬁned<span class="_ _6"> </span>by<span class="_ _6"> </span><span class="ffd">multvec.o</span>,<span class="_ _13"> </span>the<span class="_ _6"> </span>linker</div><div class="t m5 x1d h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">does<span class="_ _6"> </span><span class="ffa">not<span class="_"> </span></span>copy<span class="_ _6"> </span>this<span class="_ _6"> </span>module<span class="_ _13"> </span>into<span class="_ _6"> </span>the<span class="_ _13"> </span>executable<span class="_ _1"></span>.<span class="_ _6"> </span>The<span class="_ _a"> </span>linker<span class="_ _13"> </span>also<span class="_ _6"> </span>copies<span class="_ _13"> </span>the<span class="_ _6"> </span><span class="ffd">printf.o</span></div><div class="t m5 x1d h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">module<span class="_"> </span>from<span class="_ _13"> </span><span class="ffd">libc.a</span>,<span class="_"> </span>along<span class="_ _13"> </span>with<span class="_"> </span>a<span class="_ _13"> </span>number<span class="_"> </span>of<span class="_ _13"> </span>other<span class="_"> </span>modules<span class="_ _13"> </span>from<span class="_"> </span>the<span class="_"> </span>C<span class="_ _13"> </span>run-time</div><div class="t m5 x1d h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">system.</div><div class="t m5 x1d h41 y5fea ffe fs29 fc2 sc0 ls0 ws0">7.6.3<span class="_ _48"> </span><span class="fs19">How<span class="_"> </span>Linkers<span class="_"> </span>Use<span class="_"> </span>Static<span class="_"> </span>Libraries<span class="_"> </span>to<span class="_"> </span>Resolve<span class="_"> </span>References</span></div><div class="t m5 x1d h26 y5feb ff7 fs19 fc2 sc0 ls0 ws0">While<span class="_"> </span>static<span class="_ _16"> </span>libraries<span class="_"> </span>are<span class="_ _16"> </span>useful,<span class="_ _11"> </span>they<span class="_ _11"> </span>are<span class="_ _16"> </span>also<span class="_ _11"> </span>a<span class="_ _11"> </span>source<span class="_ _11"> </span>of<span class="_ _16"> </span>confusion<span class="_ _11"> </span>to<span class="_ _11"> </span>program-</div><div class="t m5 x1d h26 y5fec ff7 fs19 fc2 sc0 ls0 ws0">mers<span class="_ _13"> </span>because<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>way<span class="_ _13"> </span>the<span class="_ _6"> </span>Linux<span class="_ _13"> </span>linker<span class="_ _13"> </span>uses<span class="_ _13"> </span>them<span class="_ _6"> </span>to<span class="_ _13"> </span>resolve<span class="_ _13"> </span>external<span class="_ _13"> </span>references<span class="_ _3"></span>.</div><div class="t m5 x1d h26 y5fed ff7 fs19 fc2 sc0 ls0 ws0">During<span class="_ _11"> </span>the<span class="_ _16"> </span>symbol<span class="_ _11"> </span>resolution<span class="_ _16"> </span>phase<span class="_ _1"></span>,<span class="_ _16"> </span>the<span class="_ _11"> </span>linker<span class="_ _16"> </span>scans<span class="_ _11"> </span>the<span class="_ _16"> </span>relocatable<span class="_ _11"> </span>object<span class="_ _16"> </span>ﬁles</div><div class="t m5 x1d h26 y5fee ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_ _14"> </span>archives<span class="_ _14"> </span>left<span class="_ _14"> </span>to<span class="_ _14"> </span>right<span class="_ _14"> </span>in<span class="_ _14"> </span>the<span class="_ _14"> </span>same<span class="_ _14"> </span>sequential<span class="_ _14"> </span>order<span class="_ _14"> </span>that<span class="_ _14"> </span>they<span class="_ _14"> </span>appear<span class="_ _14"> </span>on<span class="_ _14"> </span>the</div><div class="t m5 x1d h26 y5fef ff7 fs19 fc2 sc0 ls0 ws0">compiler<span class="_"> </span>driver’s<span class="_"> </span>command<span class="_"> </span>line<span class="_ _1"></span>.<span class="_"> </span>(The<span class="_"> </span>driver<span class="_"> </span>automatically<span class="_"> </span>translates<span class="_"> </span>any<span class="_"> </span><span class="ffd">.c<span class="_ _10"> </span></span>ﬁles</div><div class="t m5 x1d h26 y5ff0 ff7 fs19 fc2 sc0 ls0 ws0">on<span class="_"> </span>the<span class="_"> </span>command<span class="_"> </span>line<span class="_ _11"> </span>into<span class="_"> </span><span class="ffd">.o<span class="_ _10"> </span></span>ﬁles<span class="_ _1"></span>.)<span class="_ _11"> </span>During<span class="_"> </span>this<span class="_"> </span>scan,<span class="_ _11"> </span>the<span class="_"> </span>linker<span class="_"> </span>maintains<span class="_"> </span>a<span class="_ _11"> </span>set<span class="_"> </span><span class="ff11">E</span></div><div class="t m5 x1d h26 y5ff1 ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_ _11"> </span>relocatable<span class="_ _16"> </span>object<span class="_ _11"> </span>ﬁles<span class="_ _11"> </span>that<span class="_ _16"> </span>will<span class="_ _11"> </span>be<span class="_ _16"> </span>merged<span class="_ _11"> </span>to<span class="_ _11"> </span>form<span class="_ _16"> </span>the<span class="_ _11"> </span>executable<span class="_ _0"></span>,<span class="_ _11"> </span>a<span class="_ _16"> </span>set<span class="_ _11"> </span><span class="ff11">U<span class="_ _21"> </span></span>of</div><div class="t m5 x1d h26 y5ff2 ff7 fs19 fc2 sc0 ls0 ws0">unresolved<span class="_"> </span>symbols<span class="_"> </span>(i.e<span class="_ _0"></span>.,<span class="_"> </span>symbols<span class="_"> </span>referred<span class="_"> </span>to<span class="_"> </span>but<span class="_"> </span>not<span class="_"> </span>yet<span class="_"> </span>deﬁned),<span class="_"> </span>and<span class="_ _11"> </span>a<span class="_"> </span>set<span class="_"> </span><span class="ff11">D<span class="_ _11"> </span></span>of</div><div class="t m5 x1d h26 y5ff3 ff7 fs19 fc2 sc0 ls0 ws0">symbols<span class="_ _11"> </span>that<span class="_ _11"> </span>have<span class="_ _11"> </span>been<span class="_ _11"> </span>deﬁned<span class="_ _11"> </span>in<span class="_ _16"> </span>previous<span class="_"> </span>input<span class="_ _11"> </span>ﬁles<span class="_ _0"></span>.<span class="_ _11"> </span>Initially<span class="_ _3"></span>,<span class="_ _11"> </span><span class="ff11">E<span class="_ _2"></span></span>,<span class="_ _16"> </span><span class="ff11">U<span class="_ _be"></span></span>,<span class="_ _11"> </span>and<span class="_ _11"> </span><span class="ff11">D<span class="_"> </span></span>are</div><div class="t m5 x1d h26 y5ff4 ff7 fs19 fc2 sc0 ls0 ws0">empty<span class="_ _3"></span>.</div><div class="t m5 x75 h3d y5ff5 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y5ff6 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _16"> </span>each<span class="_ _16"> </span>input<span class="_ _16"> </span>ﬁle<span class="_ _16"> </span><span class="ff11">f<span class="_ _e"> </span></span>on<span class="_ _16"> </span>the<span class="_ _16"> </span>command<span class="_ _16"> </span>line,<span class="_ _16"> </span>the<span class="_ _16"> </span>linker<span class="_ _16"> </span>determines<span class="_ _16"> </span>if<span class="_ _16"> </span><span class="ff11">f<span class="_ _e"> </span></span>is<span class="_ _16"> </span>an</div><div class="t m5 x29 h26 y5ff7 ff7 fs19 fc1 sc0 ls0 ws0">object<span class="_"> </span>ﬁle<span class="_"> </span>or<span class="_"> </span>an<span class="_"> </span>archive.<span class="_"> </span>If<span class="_"> </span><span class="ff11">f<span class="_ _21"> </span></span>is<span class="_"> </span>an<span class="_"> </span>object<span class="_"> </span>ﬁle,<span class="_"> </span>the<span class="_"> </span>linker<span class="_"> </span>adds<span class="_"> </span><span class="ff11">f<span class="_ _21"> </span></span>to<span class="_"> </span><span class="ff11">E<span class="_ _5"></span></span>,<span class="_"> </span>updates</div><div class="t m5 x29 h26 y5ff8 ff11 fs19 fc1 sc0 ls0 ws0">U<span class="_ _15"> </span><span class="ff7">and<span class="_ _11"> </span></span>D<span class="_"> </span><span class="ff7">to<span class="_ _11"> </span>reﬂect<span class="_ _11"> </span>the<span class="_ _11"> </span>symbol<span class="_ _11"> </span>deﬁnitions<span class="_ _11"> </span>and<span class="_ _16"> </span>references<span class="_"> </span>in<span class="_ _16"> </span></span>f<span class="_ _6"> </span><span class="ff7">,<span class="_ _11"> </span>and<span class="_ _11"> </span>proceeds</span></div><div class="t m5 x29 h26 y5ff9 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_"> </span>the<span class="_"> </span>next<span class="_"> </span>input<span class="_"> </span>ﬁle<span class="_ _1"></span>.</div><div class="t m5 x75 h3d y5ffa ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y5ffb ff7 fs19 fc1 sc0 ls0 ws0">If<span class="_ _11"> </span><span class="ff11">f<span class="_ _f"> </span></span>is<span class="_ _11"> </span>an<span class="_ _11"> </span>archive,<span class="_"> </span>the<span class="_ _11"> </span>linker<span class="_ _11"> </span>attempts<span class="_ _11"> </span>to<span class="_ _11"> </span>match<span class="_ _11"> </span>the<span class="_ _11"> </span>unresolved<span class="_ _11"> </span>symbols<span class="_ _11"> </span>in<span class="_ _11"> </span><span class="ff11">U</span></div><div class="t m5 x29 h26 y5ffc ff7 fs19 fc1 sc0 ls0 ws0">against<span class="_ _11"> </span>the<span class="_ _16"> </span>symbols<span class="_ _11"> </span>deﬁned<span class="_ _16"> </span>by<span class="_ _16"> </span>the<span class="_ _11"> </span>members<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>archive<span class="_ _1"></span>.<span class="_ _16"> </span>If<span class="_ _11"> </span>some<span class="_ _16"> </span>archive</div><div class="t m5 x29 h26 y5ffd ff7 fs19 fc1 sc0 ls0 ws0">member<span class="_ _11"> </span><span class="ff11">m<span class="_"> </span></span>deﬁnes<span class="_ _11"> </span>a<span class="_ _11"> </span>symbol<span class="_ _16"> </span>that<span class="_ _11"> </span>resolves<span class="_ _16"> </span>a<span class="_ _11"> </span>reference<span class="_ _16"> </span>in<span class="_ _11"> </span><span class="ff11">U<span class="_ _a"> </span></span>,<span class="_ _16"> </span>then<span class="_ _11"> </span><span class="ff11">m<span class="_ _16"> </span></span>is<span class="_ _11"> </span>added</div><div class="t m5 x29 h26 y5ffe ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _16"> </span><span class="ff11">E<span class="_ _2"></span></span>,<span class="_ _14"> </span>and<span class="_ _14"> </span>the<span class="_ _16"> </span>linker<span class="_ _14"> </span>updates<span class="_ _16"> </span><span class="ff11">U<span class="_ _f"> </span></span>and<span class="_ _14"> </span><span class="ff11">D<span class="_ _14"> </span></span>to<span class="_ _14"> </span>reﬂect<span class="_ _16"> </span>the<span class="_ _16"> </span>symbol<span class="_ _14"> </span>deﬁnitions<span class="_ _16"> </span>and</div><div class="t m5 x29 h26 y5fff ff7 fs19 fc1 sc0 ls0 ws0">references<span class="_ _15"> </span>in<span class="_ _21"> </span><span class="ff11">m</span>.<span class="_ _21"> </span>This<span class="_ _15"> </span>process<span class="_ _21"> </span>iterates<span class="_ _21"> </span>over<span class="_ _15"> </span>the<span class="_ _21"> </span>member<span class="_ _21"> </span>object<span class="_ _21"> </span>ﬁles<span class="_ _21"> </span>in<span class="_ _21"> </span>the</div><div class="t m5 x29 h26 y6000 ff7 fs19 fc1 sc0 ls0 ws0">archive<span class="_ _16"> </span>until<span class="_ _16"> </span>a<span class="_ _14"> </span>ﬁxed<span class="_ _16"> </span>point<span class="_ _16"> </span>is<span class="_ _14"> </span>reached<span class="_ _16"> </span>where<span class="_ _16"> </span><span class="ff11">U<span class="_ _e"> </span></span>and<span class="_ _16"> </span><span class="ff11">D<span class="_ _14"> </span></span>no<span class="_ _14"> </span>longer<span class="_ _16"> </span>change<span class="_ _0"></span>.<span class="_ _16"> </span>At</div><div class="t m5 x29 h26 y6001 ff7 fs19 fc1 sc0 ls0 ws0">this<span class="_ _16"> </span>point,<span class="_ _16"> </span>any<span class="_ _11"> </span>member<span class="_ _16"> </span>object<span class="_ _16"> </span>ﬁles<span class="_ _11"> </span>not<span class="_ _16"> </span>contained<span class="_ _11"> </span>in<span class="_ _16"> </span><span class="ff11">E<span class="_ _14"> </span></span>are<span class="_ _16"> </span>simply<span class="_ _16"> </span>discarded</div><div class="t m5 x29 h26 y6002 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_"> </span>the<span class="_"> </span>linker<span class="_"> </span>proceeds<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>next<span class="_"> </span>input<span class="_"> </span>ﬁle<span class="_ _1"></span>.</div><div class="t m5 x75 h3d y6003 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y6004 ff7 fs19 fc1 sc0 ls0 ws0">If<span class="_ _21"> </span><span class="ff11">U<span class="_ _1f"> </span></span>is<span class="_ _21"> </span>nonempty<span class="_ _21"> </span>when<span class="_ _21"> </span>the<span class="_ _21"> </span>linker<span class="_ _21"> </span>ﬁnishes<span class="_ _21"> </span>scanning<span class="_ _21"> </span>the<span class="_ _21"> </span>input<span class="_ _21"> </span>ﬁles<span class="_ _21"> </span>on<span class="_ _21"> </span>the</div><div class="t m5 x29 h26 y6005 ff7 fs19 fc1 sc0 ls0 ws0">command<span class="_ _14"> </span>line,<span class="_ _14"> </span>it<span class="_ _15"> </span>prints<span class="_ _15"> </span>an<span class="_ _14"> </span>error<span class="_ _15"> </span>and<span class="_ _14"> </span>terminates<span class="_ _1"></span>.<span class="_ _15"> </span>Otherwise,<span class="_ _14"> </span>it<span class="_ _15"> </span>merges<span class="_ _14"> </span>and</div><div class="t m5 x29 h26 y6006 ff7 fs19 fc1 sc0 ls0 ws0">relocates<span class="_"> </span>the<span class="_"> </span>object<span class="_"> </span>ﬁles<span class="_"> </span>in<span class="_"> </span><span class="ff11">E<span class="_ _11"> </span></span>to<span class="_"> </span>build<span class="_"> </span>the<span class="_"> </span>output<span class="_"> </span>executable<span class="_"> </span>ﬁle.</div><div class="t m5 x29 h26 y6007 ff7 fs19 fc1 sc0 ls0 ws0">Unfortunately<span class="_ _3"></span>,<span class="_ _e"> </span>this<span class="_ _f"> </span>algorithm<span class="_ _f"> </span>can<span class="_ _f"> </span>result<span class="_ _e"> </span>in<span class="_ _21"> </span>some<span class="_ _f"> </span>bafﬂing<span class="_ _e"> </span>link-time<span class="_ _21"> </span>errors</div><div class="t m5 x1d h26 y6008 ff7 fs19 fc1 sc0 ls0 ws0">because<span class="_ _6"> </span>the<span class="_ _6"> </span>ordering<span class="_ _13"> </span>of<span class="_ _a"> </span>libraries<span class="_ _13"> </span>and<span class="_ _a"> </span>object<span class="_ _13"> </span>ﬁles<span class="_ _a"> </span>on<span class="_ _13"> </span>the<span class="_ _a"> </span>command<span class="_ _13"> </span>line<span class="_ _a"> </span>is<span class="_ _6"> </span>signiﬁcant.</div><div class="t m5 x1d h26 y6009 ff7 fs19 fc1 sc0 ls0 ws0">If<span class="_ _13"> </span>the<span class="_ _13"> </span>library<span class="_ _13"> </span>that<span class="_ _13"> </span>deﬁnes<span class="_ _6"> </span>a<span class="_ _13"> </span>symbol<span class="_ _13"> </span>appears<span class="_ _13"> </span>on<span class="_ _13"> </span>the<span class="_ _13"> </span>command<span class="_ _13"> </span>line<span class="_ _13"> </span>before<span class="_ _13"> </span>the<span class="_ _13"> </span>object</div><div class="t m5 x1d h26 y600a ff7 fs19 fc1 sc0 ls0 ws0">ﬁle<span class="_ _13"> </span>that<span class="_ _6"> </span>references<span class="_ _13"> </span>that<span class="_ _13"> </span>symbol,<span class="_ _6"> </span>then<span class="_ _13"> </span>the<span class="_ _13"> </span>reference<span class="_ _6"> </span>will<span class="_ _13"> </span>not<span class="_ _13"> </span>be<span class="_ _6"> </span>resolved<span class="_ _13"> </span>and<span class="_ _13"> </span>linking</div><div class="t m5 x1d h26 y600b ff7 fs19 fc1 sc0 ls0 ws0">will<span class="_"> </span>fail.<span class="_"> </span>F<span class="_ _1"></span>or<span class="_"> </span>example<span class="_ _1"></span>,<span class="_"> </span>consider<span class="_"> </span>the<span class="_"> </span>following:</div><div class="t m5 x1d h2d y600c ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">gcc<span class="_ _1f"> </span>-static<span class="_ _1f"> </span>./libvector.a<span class="_ _e"> </span>main2.c</span></div><div class="t m5 x1d h2d y600d ffd fs1e fc2 sc0 ls0 ws0">/tmp/cc9XH6Rp.o:<span class="_ _e"> </span>In<span class="_ _1f"> </span>function<span class="_ _1f"> </span>‘main’:</div><div class="t m5 x1d h2d y600e ffd fs1e fc2 sc0 ls0 ws0">/tmp/cc9XH6Rp.o(.text+0x18):<span class="_ _e"> </span>undefined<span class="_ _1f"> </span>reference<span class="_ _1f"> </span>to<span class="_ _e"> </span>‘addvec’</div><div class="t m5 x1d h26 y8d6 ff7 fs19 fc2 sc0 ls0 ws0">What<span class="_ _14"> </span>happened?<span class="_ _14"> </span>When<span class="_ _14"> </span><span class="ffd">libvector.a<span class="_ _15"> </span></span>is<span class="_ _14"> </span>processed,<span class="_ _21"> </span><span class="ff11">U<span class="_ _e"> </span></span>is<span class="_ _15"> </span>empty<span class="_ _3"></span>,<span class="_ _15"> </span>so<span class="_ _15"> </span>no<span class="_ _14"> </span>member</div><div class="t m5 x1d h26 y8d7 ff7 fs19 fc2 sc0 ls0 ws0">object<span class="_ _16"> </span>ﬁles<span class="_ _16"> </span>from<span class="_ _11"> </span><span class="ffd">libvector.a<span class="_ _16"> </span></span>are<span class="_ _16"> </span>added<span class="_ _16"> </span>to<span class="_ _16"> </span><span class="ff11">E<span class="_ _2"></span></span>.<span class="_ _16"> </span>T<span class="_ _1"></span>hus<span class="_ _1"></span>,<span class="_ _14"> </span>the<span class="_ _16"> </span>reference<span class="_ _16"> </span>to<span class="_ _11"> </span><span class="ffd">addvec<span class="_ _16"> </span></span>is</div><div class="t m5 x1d h26 y8d8 ff7 fs19 fc2 sc0 ls0 ws0">never<span class="_"> </span>resolved<span class="_"> </span>and<span class="_"> </span>the<span class="_"> </span>linker<span class="_"> </span>emits<span class="_"> </span>an<span class="_"> </span>error<span class="_"> </span>message<span class="_"> </span>and<span class="_"> </span>terminates<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
