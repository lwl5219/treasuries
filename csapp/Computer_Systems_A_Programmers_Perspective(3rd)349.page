<div id="pf15d" class="pf w2 h11" data-page-no="15d"><div class="pc pc15d w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg15d.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">348<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x1f h2d ye7 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">store_prod:</span></div><div class="t m5 x1f h2d yc4d ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rdx,<span class="_ _e"> </span>%rax</span></div><div class="t m5 x1f h2d yecb ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">cqto</span></div><div class="t m5 x1f h2d yecc ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rsi,<span class="_ _e"> </span>%rcx</span></div><div class="t m5 x1f h2d yecd ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">sarq<span class="_ _46"> </span>$63,<span class="_ _e"> </span>%rcx</span></div><div class="t m5 x1f h2d yece ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">imulq<span class="_ _3f"> </span>%rax,<span class="_ _e"> </span>%rcx</span></div><div class="t m5 x1f h2d yecf ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">imulq<span class="_ _3f"> </span>%rsi,<span class="_ _e"> </span>%rdx</span></div><div class="t m5 x1f h2d yed0 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _45"> </span><span class="ffd fs1e fc2">addq<span class="_ _46"> </span>%rdx,<span class="_ _e"> </span>%rcx</span></div><div class="t m5 x1f h2e y20fe ff6 fs20 fc6 sc0 ls0 ws0">9</div><div class="t m5 x10d h2d y1a10 ffd fs1e fc2 sc0 ls0 ws0">mulq<span class="_ _46"> </span>%rsi</div><div class="t m5 x1b0 h2d yed3 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _45"> </span><span class="ffd fs1e fc2">addq<span class="_ _46"> </span>%rcx,<span class="_ _e"> </span>%rdx</span></div><div class="t m5 x1b0 h2d yed4 ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rax,<span class="_ _e"> </span>(%rdi)</span></div><div class="t m5 x1b0 h2d y462 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rdx,<span class="_ _e"> </span>8(%rdi)</span></div><div class="t m5 x1b0 h2d y26dd ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _45"> </span><span class="ffd fs1e fc2">ret</span></div><div class="t m5 x29 h26 y3165 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _13"> </span>code<span class="_ _a"> </span>uses<span class="_ _13"> </span>three<span class="_ _6"> </span>multiplications<span class="_ _6"> </span>for<span class="_ _13"> </span>the<span class="_ _a"> </span>multiprecision<span class="_ _13"> </span>arithmetic<span class="_ _a"> </span>required</div><div class="t m5 x1d h26 y3166 ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_ _13"> </span>implement<span class="_ _13"> </span>128-bit<span class="_"> </span>arithmetic<span class="_ _13"> </span>on<span class="_ _13"> </span>a<span class="_ _13"> </span>64-bit<span class="_ _13"> </span>machine.<span class="_ _13"> </span>Describe<span class="_ _13"> </span>the<span class="_ _13"> </span>algorithm<span class="_ _13"> </span>used</div><div class="t m5 x1d h26 y3167 ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_"> </span>compute<span class="_ _11"> </span>the<span class="_"> </span>product,<span class="_ _11"> </span>and<span class="_"> </span>annotate<span class="_ _11"> </span>the<span class="_"> </span>assembly<span class="_ _11"> </span>code<span class="_"> </span>to<span class="_ _11"> </span>show<span class="_ _11"> </span>how<span class="_"> </span>it<span class="_ _11"> </span>realizes</div><div class="t m5 x1d h26 y3168 ff7 fs19 fc2 sc0 ls0 ws0">your<span class="_"> </span>algorithm.<span class="_"> </span><span class="ffa">Hint:<span class="_"> </span></span>When<span class="_"> </span>extending<span class="_"> </span>arguments<span class="_"> </span>of<span class="_"> </span><span class="ff11">x<span class="_"> </span></span>and<span class="_"> </span><span class="ff11">y<span class="_ _16"> </span></span>to<span class="_"> </span>128<span class="_"> </span>bits<span class="_ _1"></span>,<span class="_"> </span>they<span class="_"> </span>can</div><div class="t m5 x1d h46 y3169 ff7 fs19 fc2 sc0 ls0 ws0">be<span class="_ _13"> </span>rewritten<span class="_ _13"> </span>as<span class="_ _13"> </span><span class="ff11">x<span class="_ _10"> </span><span class="ff12">=<span class="_ _13"></span></span></span>2</div><div class="t m5 xab h3c y316a ff7 fs25 fc2 sc0 ls0 ws0">64</div><div class="t m5 x1eb h45 y316b ff11 fs19 fc2 sc0 ls0 ws0">.</div><div class="t m5 x125 h45 y316c ff11 fs19 fc2 sc0 ls0 ws0">x</div><div class="t m5 xe5 h50 y316d ff11 fs25 fc2 sc0 ls0 ws0">h</div><div class="t m5 x49 h46 y316e ff12 fs19 fc2 sc0 ls0 ws0">+<span class="_ _13"></span><span class="ff11">x</span></div><div class="t m5 x1c8 h50 y316f ff11 fs25 fc2 sc0 ls0 ws0">l</div><div class="t m5 x86 h46 y316e ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_ _13"> </span><span class="ff11">y<span class="_ _10"> </span><span class="ff12">=<span class="_ _13"> </span></span></span>2</div><div class="t m5 x3f h3c y3170 ff7 fs25 fc2 sc0 ls0 ws0">64</div><div class="t m5 x36 h45 y3171 ff11 fs19 fc2 sc0 ls0 ws0">.</div><div class="t m5 xfb h45 y3172 ff11 fs19 fc2 sc0 ls0 ws0">y</div><div class="t m5 x205 h50 y316f ff11 fs25 fc2 sc0 ls0 ws0">h</div><div class="t m5 x1bc h46 y316e ff12 fs19 fc2 sc0 ls0 ws0">+<span class="_ _13"></span><span class="ff11">y</span></div><div class="t m5 x6c h50 y316f ff11 fs25 fc2 sc0 ls0 ws0">l</div><div class="t m5 xdf h26 y316e ff7 fs19 fc2 sc0 ls0 ws0">,<span class="_ _13"> </span>where<span class="_ _13"> </span><span class="ff11">x</span></div><div class="t m5 xae h50 y316f ff11 fs25 fc2 sc0 ls0 ws0">h</div><div class="t m5 x23c h26 y316e ff7 fs19 fc2 sc0 ls0 ws0">,<span class="_ _13"> </span><span class="ff11">x</span></div><div class="t m5 x43 h50 y316f ff11 fs25 fc2 sc0 ls0 ws0">l</div><div class="t m5 x1d8 h26 y316e ff7 fs19 fc2 sc0 ls0 ws0">,<span class="_ _13"> </span><span class="ff11">y</span></div><div class="t m5 x4e h50 y316f ff11 fs25 fc2 sc0 ls0 ws0">h</div><div class="t m5 x16b h26 y316e ff7 fs19 fc2 sc0 ls0 ws0">,<span class="_ _13"> </span>and<span class="_ _13"> </span><span class="ff11">y</span></div><div class="t m5 x248 h50 y316f ff11 fs25 fc2 sc0 ls0 ws0">l</div><div class="t m5 x201 h26 y316e ff7 fs19 fc2 sc0 ls0 ws0">are<span class="_ _13"> </span>64-</div><div class="t m5 x1d h46 y3173 ff7 fs19 fc2 sc0 ls0 ws0">bit<span class="_ _13"> </span>values<span class="_ _1"></span>.<span class="_"> </span>Similarly<span class="_ _7"></span>,<span class="_"> </span>the<span class="_ _13"> </span>128-bit<span class="_"> </span>product<span class="_ _13"> </span>can<span class="_ _13"> </span>be<span class="_"> </span>written<span class="_ _13"> </span>as<span class="_"> </span><span class="ff11">p<span class="_ _13"> </span><span class="ff12">=<span class="_ _10"> </span></span></span>2</div><div class="t m5 x43 h3c y3174 ff7 fs25 fc2 sc0 ls0 ws0">64</div><div class="t m5 x158 h45 y3175 ff11 fs19 fc2 sc0 ls0 ws0">.</div><div class="t m5 xd7 h45 y3176 ff11 fs19 fc2 sc0 ls0 ws0">p</div><div class="t m5 x96 h50 y3177 ff11 fs25 fc2 sc0 ls0 ws0">h</div><div class="t m5 xe9 h46 y3178 ff12 fs19 fc2 sc0 ls0 ws0">+<span class="_ _13"></span><span class="ff11">p</span></div><div class="t m5 x1e5 h50 y3177 ff11 fs25 fc2 sc0 ls0 ws0">l</div><div class="t m5 x231 h26 y3178 ff7 fs19 fc2 sc0 ls0 ws0">,<span class="_"> </span>where</div><div class="t m5 x1d h45 y3179 ff11 fs19 fc2 sc0 ls0 ws0">p</div><div class="t m5 xcf h50 y317a ff11 fs25 fc2 sc0 ls0 ws0">h</div><div class="t m5 x1cb h26 y317b ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_"> </span><span class="ff11">p</span></div><div class="t m5 x4b h50 y317a ff11 fs25 fc2 sc0 ls0 ws0">l</div><div class="t m5 x66 h26 y317b ff7 fs19 fc2 sc0 ls0 ws0">are<span class="_"> </span>64-bit<span class="_"> </span>values<span class="_ _1"></span>.<span class="_"> </span>Show<span class="_"> </span>how<span class="_"> </span>the<span class="_"> </span>code<span class="_"> </span>computes<span class="_"> </span>the<span class="_"> </span>values<span class="_"> </span>of<span class="_ _11"> </span><span class="ff11">p</span></div><div class="t m5 x174 h50 y317a ff11 fs25 fc2 sc0 ls0 ws0">h</div><div class="t m5 x223 h26 y317b ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_"> </span><span class="ff11">p</span></div><div class="t m5 x12c h50 y317a ff11 fs25 fc2 sc0 ls0 ws0">l</div><div class="t m5 x1d h26 y317c ff7 fs19 fc2 sc0 ls0 ws0">in<span class="_"> </span>terms<span class="_"> </span>of<span class="_"> </span><span class="ff11">x</span></div><div class="t m5 x1c6 h50 y317d ff11 fs25 fc2 sc0 ls0 ws0">h</div><div class="t m5 x1f7 h26 y317c ff7 fs19 fc2 sc0 ls0 ws0">,<span class="_"> </span><span class="ff11">x</span></div><div class="t m5 x50 h50 y317d ff11 fs25 fc2 sc0 ls0 ws0">l</div><div class="t m5 x76 h26 y317c ff7 fs19 fc2 sc0 ls0 ws0">,<span class="_"> </span><span class="ff11">y</span></div><div class="t m5 xb7 h50 y317d ff11 fs25 fc2 sc0 ls0 ws0">h</div><div class="t m5 x5d h26 y317c ff7 fs19 fc2 sc0 ls0 ws0">,<span class="_"> </span>and<span class="_"> </span><span class="ff11">y</span></div><div class="t m5 x49 h50 y317d ff11 fs25 fc2 sc0 ls0 ws0">l</div><div class="t m5 xdd h26 y317c ff7 fs19 fc2 sc0 ls0 ws0">.</div><div class="t m5 x1d h73 y317e ffe fs1e fc6 sc0 ls0 ws0">3.60<span class="_ _23"> </span><span class="ff10 fs19">◆◆</span></div><div class="t m5 x1d h26 y317f ff7 fs19 fc1 sc0 ls0 ws0">Consider<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>assembly<span class="_"> </span>code:</div><div class="t m5 xad h61 y3180 ff13 fs35 fc6 sc0 ls0 ws0">long<span class="_ _f"> </span>loop(long<span class="_ _f"> </span>x,<span class="_ _f"> </span>int<span class="_ _e"> </span>n)</div><div class="t m5 xad h61 y3181 ff13 fs35 fc6 sc0 ls0 ws0">x<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi,<span class="_ _f"> </span>n<span class="_ _e"> </span>in<span class="_ _21"> </span>%esi</div><div class="t m5 x1f h2e y3182 ff6 fs20 fc6 sc0 ls0 ws0">1</div><div class="t m5 x4f h2d y3183 ffd fs1e fc2 sc0 ls0 ws0">loop:</div><div class="t m5 x1f h2d y3184 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">movl<span class="_ _46"> </span>%esi,<span class="_ _e"> </span>%ecx</span></div><div class="t m5 x1f h2d y3185 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">movl<span class="_ _46"> </span>$1,<span class="_ _e"> </span>%edx</span></div><div class="t m5 x1f h2d y3186 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">movl<span class="_ _46"> </span>$0,<span class="_ _e"> </span>%eax</span></div><div class="t m5 x1f h2d y3187 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">jmp<span class="_ _8c"> </span>.L2</span></div><div class="t m5 x1f h2d y3188 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L3:</span></div><div class="t m5 x1f h2e y3189 ff6 fs20 fc6 sc0 ls0 ws0">7</div><div class="t m5 x10d h2d y318a ffd fs1e fc2 sc0 ls0 ws0">movq<span class="_ _46"> </span>%rdi,<span class="_ _e"> </span>%r8</div><div class="t m5 x1f h2e y318b ff6 fs20 fc6 sc0 ls0 ws0">8</div><div class="t m5 x10d h2d y318c ffd fs1e fc2 sc0 ls0 ws0">andq<span class="_ _46"> </span>%rdx,<span class="_ _e"> </span>%r8</div><div class="t m5 x1f h2d y318d ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _45"> </span><span class="ffd fs1e fc2">orq<span class="_ _8c"> </span>%r8,<span class="_ _e"> </span>%rax</span></div><div class="t m5 x1b0 h2d y318e ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _45"> </span><span class="ffd fs1e fc2">salq<span class="_ _46"> </span>%cl,<span class="_ _e"> </span>%rdx</span></div><div class="t m5 x1b0 h2e y318f ff6 fs20 fc6 sc0 ls0 ws0">11</div><div class="t m5 x4f h2d y3190 ffd fs1e fc2 sc0 ls0 ws0">.L2:</div><div class="t m5 x1b0 h2d y3191 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _45"> </span><span class="ffd fs1e fc2">testq<span class="_ _3f"> </span>%rdx,<span class="_ _e"> </span>%rdx</span></div><div class="t m5 x1b0 h2d y3192 ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _45"> </span><span class="ffd fs1e fc2">jne<span class="_ _8c"> </span>.L3</span></div><div class="t m5 x1b0 h2e y3193 ff6 fs20 fc6 sc0 ls0 ws0">14</div><div class="t m5 x10d h2d y3194 ffd fs1e fc2 sc0 ls0 ws0">rep;<span class="_ _e"> </span>ret</div><div class="t m5 x1d h26 y587 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _14"> </span>preceding<span class="_ _16"> </span>code<span class="_ _14"> </span>was<span class="_ _16"> </span>generated<span class="_ _14"> </span>by<span class="_ _16"> </span>compiling<span class="_ _14"> </span>C<span class="_ _16"> </span>code<span class="_ _16"> </span>that<span class="_ _14"> </span>had<span class="_ _16"> </span>the<span class="_ _14"> </span>following</div><div class="t m5 x1d h26 y588 ff7 fs19 fc2 sc0 ls0 ws0">overall<span class="_"> </span>form:</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
