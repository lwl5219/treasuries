<div id="pf134" class="pf w2 h11" data-page-no="134"><div class="pc pc134 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg134.png"/><div class="t m5 xa1 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>3.9<span class="_ _60"> </span>Heterogeneous<span class="_ _10"> </span>Data<span class="_ _10"> </span>Structures<span class="_ _3e"> </span><span class="ffe fs1e">307</span></div><div class="t m5 x26 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _1"></span>ith<span class="_ _16"> </span>this<span class="_ _16"> </span>encoding,<span class="_ _11"> </span>however,<span class="_ _16"> </span>there<span class="_ _16"> </span>is<span class="_ _11"> </span>no<span class="_ _16"> </span>way<span class="_ _16"> </span>to<span class="_ _16"> </span>determine<span class="_ _11"> </span>whether<span class="_ _16"> </span>a<span class="_ _16"> </span>given</div><div class="t m5 x17 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">node<span class="_"> </span>is<span class="_"> </span>a<span class="_"> </span>leaf<span class="_"> </span>or<span class="_"> </span>an<span class="_"> </span>internal<span class="_"> </span>node<span class="_ _1"></span>.<span class="_"> </span>A<span class="_"> </span>common<span class="_"> </span>method<span class="_"> </span>is<span class="_"> </span>to<span class="_"> </span>introduce<span class="_"> </span>an<span class="_"> </span>enumer<span class="_ _1"></span>-</div><div class="t m5 x17 h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">ated<span class="_"> </span>type<span class="_ _11"> </span>deﬁning<span class="_ _11"> </span>the<span class="_ _11"> </span>different<span class="_ _11"> </span>possible<span class="_ _11"> </span>choices<span class="_"> </span>for<span class="_ _11"> </span>the<span class="_ _11"> </span>union,<span class="_ _11"> </span>and<span class="_ _11"> </span>then<span class="_ _11"> </span>create<span class="_ _11"> </span>a</div><div class="t m5 x17 h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">structure<span class="_"> </span>containing<span class="_"> </span>a<span class="_"> </span>tag<span class="_"> </span>ﬁeld<span class="_"> </span>and<span class="_"> </span>the<span class="_"> </span>union:</div><div class="t m5 x17 h2d y2c47 ffd fs1e fc2 sc0 ls0 ws0">typedef<span class="_ _e"> </span>enum<span class="_ _1f"> </span>{<span class="_ _1f"> </span>N_LEAF,<span class="_ _e"> </span>N_INTERNAL<span class="_ _1f"> </span>}<span class="_ _e"> </span>nodetype_t;</div><div class="t m5 x17 h2d y2c48 ffd fs1e fc2 sc0 ls0 ws0">struct<span class="_ _e"> </span>node_t<span class="_ _1f"> </span>{</div><div class="t m5 x1b6 h2d y2c49 ffd fs1e fc2 sc0 ls0 ws0">nodetype_t<span class="_ _e"> </span>type;</div><div class="t m5 x1b6 h2d y2c4a ffd fs1e fc2 sc0 ls0 ws0">union<span class="_ _e"> </span>{</div><div class="t m5 x21e h2d y2c4b ffd fs1e fc2 sc0 ls0 ws0">struct<span class="_ _e"> </span>{</div><div class="t m5 x155 h2d y2c4c ffd fs1e fc2 sc0 ls0 ws0">struct<span class="_ _e"> </span>node_t<span class="_ _1f"> </span>*left;</div><div class="t m5 x155 h2d y2c4d ffd fs1e fc2 sc0 ls0 ws0">struct<span class="_ _e"> </span>node_t<span class="_ _1f"> </span>*right;</div><div class="t m5 x21e h2d y2c4e ffd fs1e fc2 sc0 ls0 ws0">}<span class="_ _e"> </span>internal;</div><div class="t m5 x21e h2d y2c4f ffd fs1e fc2 sc0 ls0 ws0">double<span class="_ _e"> </span>data[2];</div><div class="t m5 x1b6 h2d y2c50 ffd fs1e fc2 sc0 ls0 ws0">}<span class="_ _e"> </span>info;</div><div class="t m5 x17 h2d y2c51 ffd fs1e fc2 sc0 ls0 ws0">};</div><div class="t m5 x17 h26 y182d ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _f"> </span>structure<span class="_ _e"> </span>requires<span class="_ _21"> </span>a<span class="_ _f"> </span>total<span class="_ _f"> </span>of<span class="_ _e"> </span>24<span class="_ _21"> </span>bytes:<span class="_ _f"> </span>4<span class="_ _f"> </span>for<span class="_ _e"> </span><span class="ffd">type</span>,<span class="_ _e"> </span>and<span class="_ _21"> </span>either<span class="_ _f"> </span>8<span class="_ _f"> </span>each<span class="_ _e"> </span>for</div><div class="t m5 x17 h26 y2c52 ffd fs19 fc2 sc0 ls0 ws0">info.internal.left<span class="_ _6"> </span><span class="ff7">and<span class="_ _13"> </span></span>info.internal.right<span class="_ _6"> </span><span class="ff7">or<span class="_ _13"> </span>16<span class="_ _6"> </span>for<span class="_ _13"> </span></span>info.data<span class="ff7">.<span class="_ _6"> </span>As<span class="_ _13"> </span>we<span class="_ _6"> </span>will</span></div><div class="t m5 x17 h26 y2c53 ff7 fs19 fc2 sc0 ls0 ws0">discuss<span class="_"> </span>shortly<span class="_ _3"></span>,<span class="_"> </span>an<span class="_ _11"> </span>additional<span class="_"> </span>4<span class="_ _11"> </span>bytes<span class="_"> </span>of<span class="_ _11"> </span>padding<span class="_"> </span>is<span class="_ _11"> </span>required<span class="_"> </span>between<span class="_"> </span>the<span class="_ _11"> </span>ﬁeld<span class="_"> </span>for</div><div class="t m5 x17 h46 y2c54 ffd fs19 fc2 sc0 ls0 ws0">type<span class="_ _10"> </span><span class="ff7">and<span class="_"> </span>the<span class="_"> </span>union<span class="_"> </span>elements<span class="_ _1"></span>,<span class="_ _11"> </span>bringing<span class="_"> </span>the<span class="_"> </span>total<span class="_"> </span>structure<span class="_"> </span>size<span class="_"> </span>to<span class="_ _11"> </span>4<span class="_ _13"> </span><span class="ff12">+<span class="_ _10"> </span></span>4<span class="_"> </span><span class="ff12">+<span class="_ _13"></span></span>16<span class="_ _13"> </span><span class="ff12">=<span class="_ _10"> </span></span><span class="lsa0">24.</span></span></div><div class="t m5 x17 h26 y2c55 ff7 fs19 fc2 sc0 ls0 ws0">In<span class="_"> </span>this<span class="_ _13"> </span>case,<span class="_ _13"> </span>the<span class="_"> </span>savings<span class="_ _13"> </span>gain<span class="_"> </span>of<span class="_"> </span>using<span class="_ _13"> </span>a<span class="_"> </span>union<span class="_"> </span>is<span class="_ _13"> </span>small<span class="_"> </span>relative<span class="_ _13"> </span>to<span class="_"> </span>the<span class="_"> </span>awkwardness</div><div class="t m5 x17 h26 y2c56 ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_ _13"> </span>the<span class="_ _13"> </span>resulting<span class="_ _13"> </span>code<span class="_ _1"></span>.<span class="_"> </span>F<span class="_ _3"></span>or<span class="_ _13"> </span>data<span class="_ _13"> </span>structures<span class="_ _13"> </span>with<span class="_ _13"> </span>more<span class="_ _13"> </span>ﬁelds<span class="_ _1"></span>,<span class="_"> </span>the<span class="_ _13"> </span>savings<span class="_ _13"> </span>can<span class="_ _13"> </span>be<span class="_ _13"> </span>more</div><div class="t m5 x17 h26 y2c57 ff7 fs19 fc2 sc0 ls0 ws0">compelling.</div><div class="t m5 x26 h26 y2c58 ff7 fs19 fc2 sc0 ls0 ws0">Unions<span class="_"> </span>can<span class="_"> </span>also<span class="_ _13"> </span>be<span class="_"> </span>used<span class="_"> </span>to<span class="_"> </span>access<span class="_"> </span>the<span class="_ _13"> </span>bit<span class="_"> </span>patterns<span class="_"> </span>of<span class="_"> </span>different<span class="_"> </span>data<span class="_ _13"> </span>types<span class="_ _1"></span>.<span class="_"> </span>F<span class="_ _1"></span>or</div><div class="t m5 x17 h26 y2c59 ff7 fs19 fc2 sc0 ls0 ws0">example<span class="_ _1"></span>,<span class="_ _14"> </span>suppose<span class="_ _16"> </span>we<span class="_ _11"> </span>use<span class="_ _16"> </span>a<span class="_ _16"> </span>simple<span class="_ _16"> </span>cast<span class="_ _11"> </span>to<span class="_ _16"> </span>convert<span class="_ _16"> </span>a<span class="_ _16"> </span>value<span class="_ _11"> </span><span class="ffd">d<span class="_ _16"> </span></span>of<span class="_ _16"> </span>type<span class="_ _16"> </span><span class="ffd">double<span class="_ _11"> </span></span>to<span class="_ _16"> </span>a</div><div class="t m5 x17 h26 y2c5a ff7 fs19 fc2 sc0 ls0 ws0">value<span class="_"> </span><span class="ffd">u<span class="_ _10"> </span></span>of<span class="_"> </span>type<span class="_"> </span><span class="ffd">unsigned<span class="_ _16"> </span>long</span>:</div><div class="t m5 x1b6 h2d y2c5b ffd fs1e fc2 sc0 ls0 ws0">unsigned<span class="_ _e"> </span>long<span class="_ _1f"> </span>u<span class="_ _1f"> </span>=<span class="_ _e"> </span>(unsigned<span class="_ _1f"> </span>long)<span class="_ _e"> </span>d;</div><div class="t m5 x17 h26 y2c5c ff7 fs19 fc2 sc0 ls0 ws0">V<span class="_ _7"></span>alue<span class="_"> </span><span class="ffd">u<span class="_ _11"> </span></span>will<span class="_"> </span>be<span class="_"> </span>an<span class="_ _11"> </span>integer<span class="_"> </span>representation<span class="_"> </span>of<span class="_ _11"> </span><span class="ffd">d</span>.<span class="_"> </span>Except<span class="_"> </span>for<span class="_ _11"> </span>the<span class="_"> </span>case<span class="_"> </span>where<span class="_ _11"> </span><span class="ffd">d<span class="_ _10"> </span></span>is<span class="_"> </span>0.0,</div><div class="t m5 x17 h26 y2c5d ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>bit<span class="_"> </span>representation<span class="_ _13"> </span>of<span class="_"> </span><span class="ffd">u<span class="_ _10"> </span></span>will<span class="_"> </span>be<span class="_"> </span>very<span class="_"> </span>different<span class="_ _13"> </span>from<span class="_"> </span>that<span class="_"> </span>of<span class="_"> </span><span class="ffd">d</span>.<span class="_"> </span>Now<span class="_ _13"> </span>consider<span class="_"> </span>the</div><div class="t m5 x17 h26 y2c5e ff7 fs19 fc2 sc0 ls0 ws0">following<span class="_"> </span>code<span class="_"> </span>to<span class="_"> </span>generate<span class="_"> </span>a<span class="_"> </span>value<span class="_"> </span>of<span class="_"> </span>type<span class="_"> </span><span class="ffd">unsigned<span class="_ _11"> </span>long<span class="_ _11"> </span></span>from<span class="_"> </span>a<span class="_"> </span><span class="ffd">double</span>:</div><div class="t m5 x17 h2d y2c5f ffd fs1e fc2 sc0 ls0 ws0">unsigned<span class="_ _e"> </span>long<span class="_ _1f"> </span>double2bits(double<span class="_ _1f"> </span>d)<span class="_ _e"> </span>{</div><div class="t m5 x1b6 h2d y2c60 ffd fs1e fc2 sc0 ls0 ws0">union<span class="_ _e"> </span>{</div><div class="t m5 x21e h2d y2c61 ffd fs1e fc2 sc0 ls0 ws0">double<span class="_ _e"> </span>d;</div><div class="t m5 x21e h2d y2c62 ffd fs1e fc2 sc0 ls0 ws0">unsigned<span class="_ _e"> </span>long<span class="_ _1f"> </span>u;</div><div class="t m5 x1b6 h2d y2c63 ffd fs1e fc2 sc0 ls0 ws0">}<span class="_ _e"> </span>temp;</div><div class="t m5 x1b6 h2d y2c64 ffd fs1e fc2 sc0 ls0 ws0">temp.d<span class="_ _e"> </span>=<span class="_ _1f"> </span>d;</div><div class="t m5 x1b6 h2d y2c65 ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>temp.u;</div><div class="t m5 x17 h2d y2c66 ffd fs1e fc2 sc0 ls0 ws0">};</div><div class="t m5 x17 h26 y8d6 ff7 fs19 fc2 sc0 ls0 ws0">In<span class="_"> </span>this<span class="_ _13"> </span>code,<span class="_"> </span>we<span class="_ _13"> </span>store<span class="_"> </span>the<span class="_"> </span>argument<span class="_"> </span>in<span class="_ _13"> </span>the<span class="_"> </span>union<span class="_"> </span>using<span class="_ _13"> </span>one<span class="_"> </span>data<span class="_"> </span>type<span class="_"> </span>and<span class="_ _13"> </span>access<span class="_"> </span>it</div><div class="t m5 x17 h26 y8d7 ff7 fs19 fc2 sc0 ls0 ws0">using<span class="_"> </span>another<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _0"></span>he<span class="_"> </span>result<span class="_ _13"> </span>will<span class="_"> </span>be<span class="_"> </span>that<span class="_ _13"> </span><span class="ffd">u<span class="_ _10"> </span></span>will<span class="_"> </span>have<span class="_"> </span>the<span class="_ _13"> </span>same<span class="_"> </span>bit<span class="_"> </span>representation<span class="_ _13"> </span>as<span class="_"> </span><span class="ffd">d</span>,</div><div class="t m5 x17 h26 y8d8 ff7 fs19 fc2 sc0 ls0 ws0">including<span class="_"> </span>ﬁelds<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>sign<span class="_"> </span>bit,<span class="_"> </span>the<span class="_"> </span>exponent,<span class="_"> </span>and<span class="_"> </span>the<span class="_"> </span>signiﬁcand,<span class="_"> </span>as<span class="_"> </span>described<span class="_"> </span>in</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
