<div id="pf132" class="pf w2 h11" data-page-no="132"><div class="pc pc132 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg132.png"/><div class="t m5 xa1 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>3.9<span class="_ _60"> </span>Heterogeneous<span class="_ _10"> </span>Data<span class="_ _10"> </span>Structures<span class="_ _3e"> </span><span class="ffe fs1e">305</span></div><div class="t m5 x17 h47 yb1f ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>3.42<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>379)</span></div><div class="t m5 x17 h26 yb20 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _f"> </span>following<span class="_ _f"> </span>code<span class="_ _f"> </span>shows<span class="_ _f"> </span>the<span class="_ _f"> </span>declaration<span class="_ _f"> </span>of<span class="_ _21"> </span>a<span class="_ _f"> </span>structure<span class="_ _f"> </span>of<span class="_ _f"> </span>type<span class="_ _f"> </span><span class="ffd">ACE<span class="_ _f"> </span></span>and<span class="_ _f"> </span>the</div><div class="t m5 x17 h26 yb21 ff7 fs19 fc1 sc0 ls0 ws0">prototype<span class="_"> </span>for<span class="_"> </span>a<span class="_"> </span>function<span class="_"> </span><span class="ffd">test</span>:</div><div class="t m5 x17 h2d y2c0b ffd fs1e fc2 sc0 ls0 ws0">struct<span class="_ _e"> </span>ACE<span class="_ _1f"> </span>{</div><div class="t m5 x1b6 h2d y2c0c ffd fs1e fc2 sc0 ls0 ws0">short<span class="_ _5a"> </span>v;</div><div class="t m5 x1b6 h2d y2c0d ffd fs1e fc2 sc0 ls0 ws0">struct<span class="_ _e"> </span>ACE<span class="_ _1f"> </span>*p;</div><div class="t m5 x17 h2d y2c0e ffd fs1e fc2 sc0 ls0 ws0">};</div><div class="t m5 x17 h2d y2c0f ffd fs1e fc2 sc0 ls0 ws0">short<span class="_ _e"> </span>test(struct<span class="_ _1f"> </span>ACE<span class="_ _1f"> </span>*ptr);</div><div class="t m5 x26 h26 y2c10 ff7 fs19 fc2 sc0 ls0 ws0">When<span class="_ _14"> </span>the<span class="_ _15"> </span>code<span class="_ _14"> </span>for<span class="_ _15"> </span><span class="ffd">fun<span class="_ _15"> </span></span>is<span class="_ _15"> </span>compiled,<span class="_ _15"> </span><span class="ff9">gcc<span class="_ _15"> </span></span>generates<span class="_ _15"> </span>the<span class="_ _15"> </span>following<span class="_ _15"> </span>assembly</div><div class="t m5 x17 h26 y2c11 ff7 fs19 fc2 sc0 ls0 ws0">code:</div><div class="t m5 x2e h61 y2c12 ff13 fs35 fc6 sc0 ls0 ws0">short<span class="_ _f"> </span>test(struct<span class="_ _f"> </span>ACE<span class="_ _f"> </span>*ptr)</div><div class="t m5 x2e h61 y2c13 ff13 fs35 fc6 sc0 ls0 ws0">ptr<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi</div><div class="t m5 x2c h2e y2c14 ff6 fs20 fc6 sc0 ls0 ws0">1</div><div class="t m5 x2d h2d y2c15 ffd fs1e fc2 sc0 ls0 ws0">test:</div><div class="t m5 x2c h2d y2c16 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">movl<span class="_ _46"> </span>$1,<span class="_ _e"> </span>%eax</span></div><div class="t m5 x2c h2d y2c17 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">jmp<span class="_ _8c"> </span>.L2</span></div><div class="t m5 x2c h2d y1832 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L3:</span></div><div class="t m5 x2c h2e y2c18 ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 xd1 h2d y2c19 ffd fs1e fc2 sc0 ls0 ws0">imulq<span class="_ _3f"> </span>(%rdi),<span class="_ _e"> </span>%rax</div><div class="t m5 x2c h2d y2c1a ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>2(%rdi),<span class="_ _e"> </span>%rdi</span></div><div class="t m5 x2c h2d y2c1b ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L2:</span></div><div class="t m5 x2c h2d y2c1c ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _45"> </span><span class="ffd fs1e fc2">testq<span class="_ _3f"> </span>%rdi,<span class="_ _e"> </span>%rdi</span></div><div class="t m5 x2c h2d y2c1d ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _45"> </span><span class="ffd fs1e fc2">jne<span class="_ _8c"> </span>.L3</span></div><div class="t m5 x17 h2d y2c1e ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _45"> </span><span class="ffd fs1e fc2">rep;<span class="_ _e"> </span>ret</span></div><div class="t m5 x34 h26 y2c1f ff7 fs19 fc2 sc0 ls0 ws0">A.<span class="_ _1f"> </span>Use<span class="_"> </span>your<span class="_"> </span>reverse<span class="_"> </span>engineering<span class="_"> </span>skills<span class="_"> </span>to<span class="_"> </span>write<span class="_"> </span>C<span class="_"> </span>code<span class="_"> </span>for<span class="_"> </span><span class="ffd">test</span>.</div><div class="t m5 x34 h26 y2c20 ff7 fs19 fc2 sc0 ls0 ws0">B<span class="_ _3"></span>.<span class="_ _1d"> </span>Describe<span class="_ _13"> </span>the<span class="_ _13"> </span>data<span class="_ _13"> </span>structure<span class="_ _6"> </span>that<span class="_ _13"> </span>this<span class="_ _13"> </span>structure<span class="_ _13"> </span>implements<span class="_ _13"> </span>and<span class="_ _6"> </span>the<span class="_ _13"> </span>operation</div><div class="t m5 x2d h26 y2c21 ff7 fs19 fc2 sc0 ls0 ws0">performed<span class="_"> </span>by<span class="_"> </span><span class="ffd">test</span>.</div><div class="t m5 x17 h41 y2c22 ffe fs29 fc1 sc0 ls0 ws0">3.9.2<span class="_ _48"> </span><span class="fs19">Unions</span></div><div class="t m5 x17 h26 y2c23 ff7 fs19 fc1 sc0 ls0 ws0">Unions<span class="_ _13"> </span>provide<span class="_ _13"> </span>a<span class="_"> </span>way<span class="_ _13"> </span>to<span class="_ _13"> </span>circumvent<span class="_ _13"> </span>the<span class="_"> </span>type<span class="_ _13"> </span>system<span class="_ _13"> </span>of<span class="_ _13"> </span>C,<span class="_ _13"> </span>allowing<span class="_ _13"> </span>a<span class="_"> </span>single<span class="_ _13"> </span>object</div><div class="t m5 x17 h26 y2c24 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_"> </span>be<span class="_ _13"> </span>referenced<span class="_"> </span>according<span class="_"> </span>to<span class="_"> </span>multiple<span class="_ _13"> </span>types<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _0"></span>he<span class="_"> </span>syntax<span class="_"> </span>of<span class="_ _13"> </span>a<span class="_"> </span>union<span class="_"> </span>declaration<span class="_ _13"> </span>is</div><div class="t m5 x17 h26 y2c25 ff7 fs19 fc1 sc0 ls0 ws0">identical<span class="_ _16"> </span>to<span class="_ _16"> </span>that<span class="_ _11"> </span>for<span class="_ _16"> </span>structures<span class="_ _1"></span>,<span class="_ _14"> </span>but<span class="_ _16"> </span>its<span class="_ _16"> </span>semantics<span class="_ _16"> </span>are<span class="_ _11"> </span>very<span class="_ _16"> </span>different.<span class="_ _16"> </span>Rather<span class="_ _16"> </span>than</div><div class="t m5 x17 h26 y2c26 ff7 fs19 fc1 sc0 ls0 ws0">having<span class="_ _13"> </span>the<span class="_ _13"> </span>different<span class="_ _6"> </span>Ô¨Åelds<span class="_ _13"> </span>reference<span class="_ _13"> </span>different<span class="_ _13"> </span>blocks<span class="_ _6"> </span>of<span class="_ _13"> </span>memory<span class="_ _3"></span>,<span class="_ _13"> </span>they<span class="_ _13"> </span>all<span class="_ _6"> </span>reference</div><div class="t m5 x17 h26 y2c27 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>same<span class="_"> </span>block.</div><div class="t m5 x26 h26 y2c28 ff7 fs19 fc1 sc0 ls0 ws0">Consider<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>declarations:</div><div class="t m5 x17 h2d ye93 ffd fs1e fc2 sc0 ls0 ws0">struct<span class="_ _e"> </span>S3<span class="_ _1f"> </span>{</div><div class="t m5 x1b6 h2d y2c29 ffd fs1e fc2 sc0 ls0 ws0">char<span class="_ _e"> </span>c;</div><div class="t m5 x1b6 h2d y2c2a ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>i[2];</div><div class="t m5 x1b6 h2d y2c2b ffd fs1e fc2 sc0 ls0 ws0">double<span class="_ _e"> </span>v;</div><div class="t m5 x17 h2d y2c2c ffd fs1e fc2 sc0 ls0 ws0">};</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
