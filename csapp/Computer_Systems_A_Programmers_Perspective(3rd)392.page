<div id="pf188" class="pf w2 h11" data-page-no="188"><div class="pc pc188 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg188.png"/><div class="t m5 xfc h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>4.1<span class="_ _60"> </span>The<span class="_ _10"> </span>Y86-64<span class="_ _10"> </span>Instruction<span class="_ _10"> </span>Set<span class="_ _10"> </span>Architecture<span class="_ _1b"> </span><span class="ffe fs1e">391</span></div><div class="t m5 x17 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">logic<span class="_ _13"> </span>into<span class="_ _13"> </span>V<span class="_ _3"></span>erilog.<span class="_ _13"> </span>By<span class="_ _13"> </span>ﬁrst<span class="_ _13"> </span>debugging<span class="_ _13"> </span>the<span class="_ _13"> </span>HCL<span class="_ _13"> </span>description<span class="_ _13"> </span>with<span class="_ _13"> </span>our<span class="_ _13"> </span>simulators<span class="_ _0"></span>,<span class="_ _13"> </span>we</div><div class="t m5 x17 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">eliminate<span class="_"> </span>many<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>tricky<span class="_"> </span>bugs<span class="_"> </span>that<span class="_"> </span>would<span class="_"> </span>otherwise<span class="_ _11"> </span>show<span class="_"> </span>up<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>hardware</div><div class="t m5 x17 h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">design.<span class="_"> </span>Given<span class="_"> </span>a<span class="_"> </span>V<span class="_ _3"></span>erilog<span class="_"> </span>description,<span class="_"> </span>there<span class="_ _11"> </span>are<span class="_"> </span>commercial<span class="_"> </span>and<span class="_"> </span>open-source<span class="_"> </span>tools</div><div class="t m5 x17 h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_"> </span>support<span class="_ _13"> </span>simulation<span class="_"> </span>and<span class="_ _13"> </span><span class="ffa">logic<span class="_"> </span>synthesis</span>,<span class="_"> </span>generating<span class="_ _13"> </span>actual<span class="_"> </span>circuit<span class="_"> </span>designs<span class="_ _13"> </span>for<span class="_"> </span>the</div><div class="t m5 x17 h26 y2f8 ff7 fs19 fc2 sc0 ls0 ws0">microprocessors<span class="_ _1"></span>.<span class="_ _6"> </span>So,<span class="_ _6"> </span>although<span class="_ _13"> </span>much<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _a"> </span>effort<span class="_ _13"> </span>we<span class="_ _6"> </span>expend<span class="_ _13"> </span>here<span class="_ _6"> </span>is<span class="_ _6"> </span>to<span class="_ _13"> </span>create<span class="_ _6"> </span>picto-</div><div class="t m5 x17 h26 y2f9 ff7 fs19 fc2 sc0 ls0 ws0">rial<span class="_ _6"> </span>and<span class="_ _6"> </span>textual<span class="_ _6"> </span>descriptions<span class="_ _6"> </span>of<span class="_ _13"> </span>a<span class="_ _a"> </span>system,<span class="_ _13"> </span>much<span class="_ _a"> </span>as<span class="_ _6"> </span>one<span class="_ _13"> </span>would<span class="_ _a"> </span>when<span class="_ _6"> </span>writing<span class="_ _6"> </span>software,</div><div class="t m5 x17 h26 y2fa ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _13"> </span>fact<span class="_"> </span>that<span class="_ _13"> </span>these<span class="_"> </span>designs<span class="_ _13"> </span>can<span class="_ _13"> </span>be<span class="_"> </span>automatically<span class="_ _13"> </span>synthesized<span class="_ _13"> </span>demonstrates<span class="_"> </span>that<span class="_ _13"> </span>we</div><div class="t m5 x17 h26 y2fb ff7 fs19 fc2 sc0 ls0 ws0">are<span class="_"> </span>indeed<span class="_"> </span>creating<span class="_"> </span>a<span class="_"> </span>system<span class="_"> </span>that<span class="_"> </span>can<span class="_"> </span>be<span class="_"> </span>realized<span class="_"> </span>as<span class="_"> </span>hardware<span class="_ _1"></span>.</div><div class="t m5 x17 h3b y3679 fff fs24 fc6 sc0 ls0 ws0">4.1<span class="_ _17"> </span><span class="ffe fs18">The<span class="_"> </span>Y86-64<span class="_"> </span>Instruction<span class="_"> </span>Set<span class="_"> </span>Architecture</span></div><div class="t m5 x17 h26 y367a ff7 fs19 fc1 sc0 ls0 ws0">Deﬁning<span class="_ _15"> </span>an<span class="_ _21"> </span>instruction<span class="_ _21"> </span>set<span class="_ _15"> </span>architecture,<span class="_ _21"> </span>such<span class="_ _21"> </span>as<span class="_ _21"> </span>Y86-64,<span class="_ _f"> </span>includes<span class="_ _15"> </span>deﬁning<span class="_ _21"> </span>the</div><div class="t m5 x17 h26 y367b ff7 fs19 fc1 sc0 ls0 ws0">different<span class="_ _14"> </span>components<span class="_ _14"> </span>of<span class="_ _15"> </span>its<span class="_ _14"> </span>state,<span class="_ _14"> </span>the<span class="_ _15"> </span>set<span class="_ _14"> </span>of<span class="_ _14"> </span>instructions<span class="_ _15"> </span>and<span class="_ _14"> </span>their<span class="_ _14"> </span>encodings<span class="_ _0"></span>,<span class="_ _15"> </span>a</div><div class="t m5 x17 h26 y367c ff7 fs19 fc1 sc0 ls0 ws0">set<span class="_"> </span>of<span class="_"> </span>programming<span class="_"> </span>conventions<span class="_ _1"></span>,<span class="_"> </span>and<span class="_"> </span>the<span class="_"> </span>handling<span class="_"> </span>of<span class="_"> </span>exceptional<span class="_"> </span>events<span class="_ _1"></span>.</div><div class="t m5 x17 h41 y367d ffe fs29 fc1 sc0 ls0 ws0">4.1.1<span class="_ _48"> </span><span class="fs19">Programmer-Visible<span class="_"> </span>State</span></div><div class="t m5 x17 h26 y367e ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_ _6"> </span>Figure<span class="_ _a"> </span>4.1<span class="_ _13"> </span>illustrates<span class="_ _3"></span>,<span class="_ _13"> </span>each<span class="_ _6"> </span>instruction<span class="_ _13"> </span>in<span class="_ _a"> </span>a<span class="_ _13"> </span>Y86-64<span class="_ _6"> </span>program<span class="_ _6"> </span>can<span class="_ _13"> </span>read<span class="_ _a"> </span>and<span class="_ _13"> </span>modify</div><div class="t m5 x17 h26 y367f ff7 fs19 fc1 sc0 ls0 ws0">some<span class="_ _14"> </span>part<span class="_ _15"> </span>of<span class="_ _15"> </span>the<span class="_ _14"> </span>processor<span class="_ _15"> </span>state<span class="_ _0"></span>.<span class="_ _14"> </span>This<span class="_ _14"> </span>is<span class="_ _14"> </span>referred<span class="_ _15"> </span>to<span class="_ _15"> </span>as<span class="_ _14"> </span>the<span class="_ _15"> </span><span class="ffa">programmer-visible</span></div><div class="t m5 x17 h26 y3680 ff7 fs19 fc1 sc0 ls0 ws0">state<span class="_ _1"></span>,<span class="_ _14"> </span>where<span class="_ _16"> </span>the<span class="_ _16"> </span>“programmer”<span class="_ _16"> </span>in<span class="_ _14"> </span>this<span class="_ _16"> </span>case<span class="_ _16"> </span>is<span class="_ _16"> </span>either<span class="_ _16"> </span>someone<span class="_ _16"> </span>writing<span class="_ _16"> </span>programs</div><div class="t m5 x17 h26 y3681 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_"> </span>assembly<span class="_ _13"> </span>code<span class="_"> </span>or<span class="_"> </span>a<span class="_ _13"> </span>compiler<span class="_"> </span>generating<span class="_"> </span>machine-level<span class="_ _13"> </span>code.<span class="_ _13"> </span>W<span class="_ _1"></span>e<span class="_"> </span>will<span class="_ _13"> </span>see<span class="_"> </span>in<span class="_"> </span>our</div><div class="t m5 x17 h26 y3682 ff7 fs19 fc1 sc0 ls0 ws0">processor<span class="_ _14"> </span>implementations<span class="_ _14"> </span>that<span class="_ _14"> </span>we<span class="_ _14"> </span>do<span class="_ _15"> </span>not<span class="_ _14"> </span>need<span class="_ _14"> </span>to<span class="_ _14"> </span>represent<span class="_ _14"> </span>and<span class="_ _14"> </span>organize<span class="_ _15"> </span>this</div><div class="t m5 x17 h26 y3683 ff7 fs19 fc1 sc0 ls0 ws0">state<span class="_"> </span>in<span class="_"> </span>exactly<span class="_"> </span>the<span class="_"> </span>manner<span class="_"> </span>implied<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span>ISA,<span class="_"> </span>as<span class="_"> </span>long<span class="_"> </span>as<span class="_"> </span>we<span class="_ _11"> </span>can<span class="_"> </span>make<span class="_"> </span>sure<span class="_"> </span>that</div><div class="t m5 x17 h26 y3684 ff7 fs19 fc1 sc0 ls0 ws0">machine-level<span class="_ _16"> </span>programs<span class="_ _14"> </span>appear<span class="_ _16"> </span>to<span class="_ _14"> </span>have<span class="_ _16"> </span>access<span class="_ _14"> </span>to<span class="_ _16"> </span>the<span class="_ _14"> </span>programmer<span class="_ _1"></span>-visible<span class="_ _16"> </span>state.</div><div class="t m5 x17 h26 y3685 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _11"> </span>state<span class="_"> </span>for<span class="_"> </span>Y86-64<span class="_ _11"> </span>is<span class="_"> </span>similar<span class="_ _11"> </span>to<span class="_"> </span>that<span class="_ _11"> </span>for<span class="_"> </span>x86-64.<span class="_"> </span>There<span class="_"> </span>are<span class="_"> </span>15<span class="_"> </span><span class="ffa">program<span class="_ _11"> </span>registers:</span></div><div class="t m5 x17 h26 y3686 ffd fs19 fc1 sc0 ls0 ws0">%rax<span class="ff7">,<span class="_"> </span></span>%rcx<span class="ff7">,<span class="_"> </span></span>%rdx<span class="ff7">,<span class="_"> </span></span>%rbx<span class="ff7">,<span class="_"> </span></span>%rsp<span class="ff7">,<span class="_"> </span></span>%rbp<span class="ff7">,<span class="_"> </span></span>%rsi<span class="ff7">,<span class="_"> </span></span>%rdi<span class="ff7">,<span class="_"> </span>and<span class="_ _13"> </span></span>%r8<span class="_ _10"> </span><span class="ff7">through<span class="_"> </span></span>%r14<span class="ff7">.<span class="_"> </span>(W<span class="_ _1"></span>e<span class="_"> </span>omit</span></div><div class="t m5 x17 h26 y3687 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _13"> </span>x86-64<span class="_ _13"> </span>register<span class="_ _6"> </span><span class="ffd">%r15<span class="_ _13"> </span></span>to<span class="_ _13"> </span>simplify<span class="_ _13"> </span>the<span class="_ _13"> </span>instruction<span class="_ _13"> </span>encoding<span class="_ _1"></span>.)<span class="_ _13"> </span>Each<span class="_ _13"> </span>of<span class="_ _13"> </span>these<span class="_ _13"> </span>stores</div><div class="t m5 x17 h26 y3688 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_"> </span>64-bit<span class="_"> </span>word.<span class="_"> </span>Register<span class="_ _11"> </span><span class="ffd">%rsp<span class="_ _10"> </span></span>is<span class="_"> </span>used<span class="_ _11"> </span>as<span class="_"> </span>a<span class="_"> </span>stack<span class="_"> </span>pointer<span class="_ _11"> </span>by<span class="_"> </span>the<span class="_"> </span>push,<span class="_ _11"> </span>pop<span class="_ _1"></span>,<span class="_ _11"> </span>call,<span class="_"> </span>and</div><div class="t m5 x17 h26 y3689 ff7 fs19 fc1 sc0 ls0 ws0">return<span class="_ _15"> </span>instructions<span class="_ _1"></span>.<span class="_ _15"> </span>Otherwise<span class="_ _0"></span>,<span class="_ _21"> </span>the<span class="_ _15"> </span>registers<span class="_ _15"> </span>have<span class="_ _15"> </span>no<span class="_ _15"> </span>ﬁxed<span class="_ _15"> </span>meanings<span class="_ _15"> </span>or<span class="_ _21"> </span>values<span class="_ _1"></span>.</div><div class="t m5 x17 h26 y368a ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>here<span class="_ _15"> </span>are<span class="_ _15"> </span>three<span class="_ _15"> </span>single-bit<span class="_ _15"> </span><span class="ffa">condition<span class="_ _14"> </span>codes</span>,<span class="_ _21"> </span><span class="ffd">ZF</span>,<span class="_ _21"> </span><span class="ffd">SF</span>,<span class="_ _21"> </span>and<span class="_ _15"> </span><span class="ffd">OF</span>,<span class="_ _21"> </span>storing<span class="_ _15"> </span>information</div><div class="t m5 x17 h2f y368b ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>4.1</div><div class="t m5 x17 h2f y368c ffe fs16 fc1 sc0 ls0 ws0">Y86-64<span class="_ _14"> </span>programmer-</div><div class="t m5 x17 h34 y368d ffe fs16 fc1 sc0 ls0 ws0">visible<span class="_ _14"> </span>state.<span class="_ _14"> </span><span class="ff6">As<span class="_ _15"> </span>with</span></div><div class="t m5 x17 h34 y368e ff6 fs16 fc1 sc0 ls0 ws0">x86-64,<span class="_ _10"> </span>programs<span class="_ _11"> </span>for<span class="_ _11"> </span>Y86-</div><div class="t m5 x17 h34 y368f ff6 fs16 fc1 sc0 ls0 ws0">64<span class="_ _14"> </span>access<span class="_ _14"> </span>and<span class="_ _14"> </span>modify</div><div class="t m5 x17 h34 y3690 ff6 fs16 fc1 sc0 ls0 ws0">the<span class="_ _14"> </span>program<span class="_ _16"> </span>registers,</div><div class="t m5 x17 h34 y3691 ff6 fs16 fc1 sc0 ls0 ws0">the<span class="_ _16"> </span>condition<span class="_ _11"> </span>codes,<span class="_ _16"> </span>the</div><div class="t m5 x17 h34 y3692 ff6 fs16 fc1 sc0 ls0 ws0">program<span class="_ _10"> </span>counter<span class="_ _10"> </span>(PC),<span class="_ _10"> </span>and</div><div class="t m5 x17 h34 y3693 ff6 fs16 fc1 sc0 ls0 ws0">the<span class="_ _16"> </span>memory<span class="_ _1"></span>.<span class="_ _16"> </span>The<span class="_ _16"> </span>status</div><div class="t m5 x17 h34 y3694 ff6 fs16 fc1 sc0 ls0 ws0">code<span class="_ _16"> </span>indicates<span class="_ _16"> </span>whether</div><div class="t m5 x17 h34 y3695 ff6 fs16 fc1 sc0 ls0 ws0">the<span class="_ _16"> </span>program<span class="_ _16"> </span>is<span class="_ _16"> </span>running</div><div class="t m5 x17 h34 y3696 ff6 fs16 fc1 sc0 ls0 ws0">normally<span class="_ _11"> </span>or<span class="_ _16"> </span>some<span class="_ _11"> </span>special</div><div class="t m5 x17 h34 y3697 ff6 fs16 fc1 sc0 ls0 ws0">event<span class="_ _10"> </span>has<span class="_ _11"> </span>occurred.</div><div class="t m5 x69 h3f y3698 ff30 fs27 fc1 sc0 ls0 ws0">RF: Program registers</div><div class="t m5 xb1 h3f y3699 ff30 fs27 fc1 sc0 ls0 ws0">Stat: Program status</div><div class="t m5 x250 h3f y369a ff30 fs27 fc1 sc0 ls0 ws0">DMEM: Memory</div><div class="t m5 xe2 h3f y369b ff30 fs27 fc1 sc0 ls0 ws0">CC:</div><div class="t m5 x1d7 h3f y369c ff30 fs27 fc1 sc0 ls0 ws0">Condition</div><div class="t m5 x117 h3f y369d ff30 fs27 fc1 sc0 ls0 ws0">codes</div><div class="t m5 x91 h40 y369e ff31 fs28 fc1 sc0 ls0 ws0">%rax</div><div class="t m5 x91 h40 y369f ff31 fs28 fc1 sc0 ls0 ws0">%rcx</div><div class="t m5 x91 h40 y36a0 ff31 fs28 fc1 sc0 ls0 ws0">%rdx</div><div class="t m5 x91 h40 y36a1 ff31 fs28 fc1 sc0 ls0 ws0">%rbx</div><div class="t m5 x24e h40 y369e ff31 fs28 fc1 sc0 ls0 ws0">%rsp</div><div class="t m5 x24e h40 y369f ff31 fs28 fc1 sc0 ls0 ws0">%rbp</div><div class="t m5 x24e h40 y36a0 ff31 fs28 fc1 sc0 ls0 ws0">%rsi</div><div class="t m5 x24e h40 y36a1 ff31 fs28 fc1 sc0 ls0 ws0">%rdi</div><div class="t m5 x1c7 h40 y369e ff31 fs28 fc1 sc0 ls0 ws0">%r8</div><div class="t m5 x1c7 h40 y369f ff31 fs28 fc1 sc0 ls0 ws0">%r9</div><div class="t m5 xf5 h40 y36a0 ff31 fs28 fc1 sc0 ls0 ws0">%r10</div><div class="t m5 xf5 h40 y36a1 ff31 fs28 fc1 sc0 ls0 ws0">%r11</div><div class="t m5 x18a h40 y369e ff31 fs28 fc1 sc0 ls0 ws0">%r12</div><div class="t m5 x18a h40 y369f ff31 fs28 fc1 sc0 ls0 ws0">%r13</div><div class="t m5 x18a h40 y36a0 ff31 fs28 fc1 sc0 ls0 ws0">%r14</div><div class="t m5 x90 h3f y36a2 ff30 fs27 fc1 sc0 ls0 ws0">PC</div><div class="t m5 xe7 h40 y36a3 ff31 fs28 fc1 sc0 ls0 ws0">ZF<span class="_ _23"> </span>SF<span class="_ _25"> </span>OF</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
