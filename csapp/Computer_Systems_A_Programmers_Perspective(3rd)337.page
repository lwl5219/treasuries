<div id="pf151" class="pf w2 h11" data-page-no="151"><div class="pc pc151 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg151.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">336<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x1d h47 yb1f ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>3.50<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>383)</span></div><div class="t m5 x1d h26 y9ba ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _6"> </span>the<span class="_ _6"> </span>following<span class="_ _13"> </span>C<span class="_ _a"> </span>code,<span class="_ _6"> </span>the<span class="_ _6"> </span>expressions<span class="_ _13"> </span><span class="ffd">val1</span>–<span class="ffd">val4<span class="_ _a"> </span></span>all<span class="_ _13"> </span>map<span class="_ _a"> </span>to<span class="_ _6"> </span>the<span class="_ _13"> </span>program<span class="_ _a"> </span>values</div><div class="t m5 x1d h26 y302f ffd fs19 fc1 sc0 ls0 ws0">i<span class="ff7">,<span class="_"> </span></span>f<span class="ff7">,<span class="_"> </span></span>d<span class="ff7">,<span class="_"> </span>and<span class="_"> </span></span>l<span class="ff7">:</span></div><div class="t m5 x1d h2d y3030 ffd fs1e fc2 sc0 ls0 ws0">double<span class="_ _e"> </span>fcvt2(int<span class="_ _1f"> </span>*ip,<span class="_ _1f"> </span>float<span class="_ _e"> </span>*fp,<span class="_ _1f"> </span>double<span class="_ _e"> </span>*dp,<span class="_ _1f"> </span>long<span class="_ _1f"> </span>l)</div><div class="t m5 x1d h2d y3031 ffd fs1e fc2 sc0 ls0 ws0">{</div><div class="t m5 x10c h2d y3032 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>i<span class="_ _1f"> </span>=<span class="_ _1f"> </span>*ip;<span class="_ _e"> </span>float<span class="_ _1f"> </span>f<span class="_ _e"> </span>=<span class="_ _1f"> </span>*fp;<span class="_ _1f"> </span>double<span class="_ _e"> </span>d<span class="_ _1f"> </span>=<span class="_ _e"> </span>*dp;</div><div class="t m5 x10c h2d y3033 ffd fs1e fc2 sc0 ls0 ws0">*ip<span class="_ _e"> </span>=<span class="_ _1f"> </span>(int)<span class="_ _8c"> </span>val1;</div><div class="t m5 x10c h2d y3034 ffd fs1e fc2 sc0 ls0 ws0">*fp<span class="_ _e"> </span>=<span class="_ _1f"> </span>(float)<span class="_ _3f"> </span>val2;</div><div class="t m5 x10c h2d y3035 ffd fs1e fc2 sc0 ls0 ws0">*dp<span class="_ _e"> </span>=<span class="_ _1f"> </span>(double)<span class="_ _1a"> </span>val3;</div><div class="t m5 x10c h2d y3036 ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>(double)<span class="_ _1f"> </span>val4;</div><div class="t m5 x1d h2d y3037 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x29 h26 y3038 ff7 fs19 fc2 sc0 ls0 ws0">Determine<span class="_ _13"> </span>the<span class="_"> </span>mapping<span class="_ _0"></span>,<span class="_ _13"> </span>based<span class="_"> </span>on<span class="_ _13"> </span>the<span class="_"> </span>following<span class="_ _13"> </span>x86-64<span class="_ _13"> </span>code<span class="_"> </span>for<span class="_ _13"> </span>the<span class="_ _13"> </span>function:</div><div class="t m5 xad h61 y3039 ff13 fs35 fc6 sc0 ls0 ws0">double<span class="_ _f"> </span>fcvt2(int<span class="_ _f"> </span>*ip,<span class="_ _f"> </span>float<span class="_ _e"> </span>*fp,<span class="_ _21"> </span>double<span class="_ _f"> </span>*dp,<span class="_ _e"> </span>long<span class="_ _21"> </span>l)</div><div class="t m5 xad h61 y303a ff13 fs35 fc6 sc0 ls0 ws0">ip<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi,<span class="_ _f"> </span>fp<span class="_ _e"> </span>in<span class="_ _21"> </span>%rsi,<span class="_ _f"> </span>dp<span class="_ _e"> </span>in<span class="_ _21"> </span>%rdx,<span class="_ _f"> </span>l<span class="_ _e"> </span>in<span class="_ _21"> </span>%rcx</div><div class="t m5 xad h61 y303b ff13 fs35 fc6 sc0 ls0 ws0">Result<span class="_ _f"> </span>returned<span class="_ _f"> </span>in<span class="_ _f"> </span>%xmm0</div><div class="t m5 x1f h2d y303c ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">fcvt2:</span></div><div class="t m5 x1f h2d y303d ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">movl<span class="_ _46"> </span>(%rdi),<span class="_ _e"> </span>%eax</span></div><div class="t m5 x1f h2d y303e ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">vmovss<span class="_ _1a"> </span>(%rsi),<span class="_ _e"> </span>%xmm0</span></div><div class="t m5 x1f h2e y303f ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 x10d h2d y3040 ffd fs1e fc2 sc0 ls0 ws0">vcvttsd2si<span class="_ _5a"> </span>(%rdx),<span class="_ _1f"> </span>%r8d</div><div class="t m5 x1f h2d y3041 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">movl<span class="_ _46"> </span>%r8d,<span class="_ _e"> </span>(%rdi)</span></div><div class="t m5 x1f h2d y3042 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">vcvtsi2ss<span class="_ _6f"> </span>%eax,<span class="_ _1f"> </span>%xmm1,<span class="_ _e"> </span>%xmm1</span></div><div class="t m5 x1f h2d y3043 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">vmovss<span class="_ _1a"> </span>%xmm1,<span class="_ _e"> </span>(%rsi)</span></div><div class="t m5 x1f h2e y3044 ff6 fs20 fc6 sc0 ls0 ws0">8</div><div class="t m5 x10d h2d y3045 ffd fs1e fc2 sc0 ls0 ws0">vcvtsi2sdq<span class="_ _5a"> </span>%rcx,<span class="_ _1f"> </span>%xmm1,<span class="_ _e"> </span>%xmm1</div><div class="t m5 x1f h2d y3046 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _45"> </span><span class="ffd fs1e fc2">vmovsd<span class="_ _1a"> </span>%xmm1,<span class="_ _e"> </span>(%rdx)</span></div><div class="t m5 x1b0 h2d y3047 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _45"> </span><span class="ffd fs1e fc2">vunpcklps<span class="_ _6f"> </span>%xmm0,<span class="_ _1f"> </span>%xmm0,<span class="_ _e"> </span>%xmm0</span></div><div class="t m5 x1b0 h2d y3048 ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _45"> </span><span class="ffd fs1e fc2">vcvtps2pd<span class="_ _6f"> </span>%xmm0,<span class="_ _1f"> </span>%xmm0</span></div><div class="t m5 x1b0 h2e y3049 ff6 fs20 fc6 sc0 ls0 ws0">12</div><div class="t m5 x10d h2d y304a ffd fs1e fc2 sc0 ls0 ws0">ret</div><div class="t m5 x1d h47 y304b ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>3.51<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>384)</span></div><div class="t m5 x1d h26 y304c ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>following<span class="_ _13"> </span>C<span class="_"> </span>function<span class="_ _13"> </span>converts<span class="_ _13"> </span>an<span class="_"> </span>argument<span class="_ _13"> </span>of<span class="_"> </span>type<span class="_ _13"> </span><span class="ffd">src_t<span class="_ _10"> </span></span>to<span class="_ _13"> </span>a<span class="_"> </span>return<span class="_ _13"> </span>value<span class="_ _13"> </span>of</div><div class="t m5 x1d h26 y304d ff7 fs19 fc1 sc0 ls0 ws0">type<span class="_"> </span><span class="ffd">dst_t</span>,<span class="_"> </span>where<span class="_"> </span>these<span class="_"> </span>two<span class="_"> </span>types<span class="_"> </span>are<span class="_"> </span>deﬁned<span class="_"> </span>using<span class="_"> </span><span class="ffd">typedef</span>:</div><div class="t m5 x1d h2d y304e ffd fs1e fc2 sc0 ls0 ws0">dest_t<span class="_ _e"> </span>cvt(src_t<span class="_ _1f"> </span>x)</div><div class="t m5 x1d h2d y304f ffd fs1e fc2 sc0 ls0 ws0">{</div><div class="t m5 x10c h2d y3050 ffd fs1e fc2 sc0 ls0 ws0">dest_t<span class="_ _e"> </span>y<span class="_ _1f"> </span>=<span class="_ _1f"> </span>(dest_t)<span class="_ _e"> </span>x;</div><div class="t m5 x10c h2d y3051 ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>y;</div><div class="t m5 x1d h2d y3052 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x29 h26 y13c0 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _15"> </span>execution<span class="_ _15"> </span>on<span class="_ _21"> </span>x86-64,<span class="_ _f"> </span>assume<span class="_ _15"> </span>that<span class="_ _15"> </span>argument<span class="_ _21"> </span><span class="ffd">x<span class="_ _15"> </span></span>is<span class="_ _21"> </span>either<span class="_ _15"> </span>in<span class="_ _21"> </span><span class="ffd">%xmm0<span class="_ _15"> </span></span>or<span class="_ _15"> </span>in</div><div class="t m5 x1d h26 y13c1 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _15"> </span>appropriately<span class="_ _15"> </span>named<span class="_ _15"> </span>portion<span class="_ _15"> </span>of<span class="_ _15"> </span>register<span class="_ _21"> </span><span class="ffd">%rdi<span class="_ _15"> </span></span>(i.e<span class="_ _0"></span>.,<span class="_ _21"> </span><span class="ffd">%rdi<span class="_ _15"> </span></span>or<span class="_ _15"> </span><span class="ffd">%edi</span>).<span class="_ _21"> </span>One<span class="_ _15"> </span>or</div><div class="t m5 x1d h26 y13c2 ff7 fs19 fc2 sc0 ls0 ws0">two<span class="_ _16"> </span>instructions<span class="_ _16"> </span>are<span class="_ _16"> </span>to<span class="_ _16"> </span>be<span class="_ _16"> </span>used<span class="_ _16"> </span>to<span class="_ _16"> </span>perform<span class="_ _16"> </span>the<span class="_ _16"> </span>type<span class="_ _16"> </span>conversion<span class="_ _16"> </span>and<span class="_ _16"> </span>to<span class="_ _16"> </span>copy<span class="_ _16"> </span>the</div><div class="t m5 x1d h26 y13c3 ff7 fs19 fc2 sc0 ls0 ws0">value<span class="_ _21"> </span>to<span class="_ _f"> </span>the<span class="_ _f"> </span>appropriately<span class="_ _f"> </span>named<span class="_ _f"> </span>portion<span class="_ _f"> </span>of<span class="_ _f"> </span>register<span class="_ _21"> </span><span class="ffd">%rax<span class="_ _f"> </span></span>(integer<span class="_ _f"> </span>result)<span class="_ _f"> </span>or</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
