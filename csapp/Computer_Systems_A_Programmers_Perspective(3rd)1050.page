<div id="pf41a" class="pf w2 h11" data-page-no="41a"><div class="pc pc41a w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg41a.png"/><div class="t m5 x250 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>12.6<span class="_ _60"> </span>Using<span class="_ _10"> </span>Threads<span class="_ _10"> </span>for<span class="_ _10"> </span>Parallelism<span class="_ _3e"> </span><span class="ffe fs1e">1049</span></div><div class="t m5 x34 h2a y257 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">Event-driven<span class="_ _11"> </span>programs<span class="_ _11"> </span>based<span class="_ _11"> </span>on<span class="_ _16"> </span>threads</span></div><div class="t m5 x34 h2b y2d0 ff7 fs1e fc2 sc0 ls0 ws0">I/O<span class="_ _10"> </span>multiplexing<span class="_ _11"> </span>is<span class="_ _11"> </span>not<span class="_ _11"> </span>the<span class="_ _10"> </span>only<span class="_ _11"> </span>way<span class="_ _11"> </span>to<span class="_ _11"> </span>write<span class="_ _11"> </span>an<span class="_ _10"> </span>event-driven<span class="_ _11"> </span>program.<span class="_ _11"> </span>F<span class="_ _1"></span>or<span class="_ _11"> </span>example<span class="_ _1"></span>,<span class="_ _16"> </span>you<span class="_"> </span>might<span class="_ _11"> </span>have</div><div class="t m5 x34 h2b y2d1 ff7 fs1e fc2 sc0 ls0 ws0">noticed<span class="_"> </span>that<span class="_"> </span>the<span class="_"> </span>concurrent<span class="_ _13"> </span>prethreaded<span class="_"> </span>server<span class="_"> </span>that<span class="_"> </span>we<span class="_"> </span>just<span class="_ _13"> </span>developed<span class="_"> </span>is<span class="_"> </span>really<span class="_"> </span>an<span class="_"> </span>event-driven<span class="_ _13"> </span>server</div><div class="t m5 x34 h2b y2d2 ff7 fs1e fc2 sc0 ls0 ws0">with<span class="_"> </span>simple<span class="_ _13"> </span>state<span class="_"> </span>machines<span class="_"> </span>for<span class="_ _13"> </span>the<span class="_"> </span>main<span class="_ _13"> </span>and<span class="_"> </span>worker<span class="_"> </span>threads<span class="_ _3"></span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>main<span class="_"> </span>thread<span class="_ _13"> </span>has<span class="_"> </span>two<span class="_"> </span>states<span class="_ _13"> </span>(“waiting</div><div class="t m5 x34 h2b y2d3 ff7 fs1e fc2 sc0 ls0 ws0">for<span class="_"> </span>connection<span class="_"> </span>request”<span class="_ _11"> </span>and<span class="_"> </span>“waiting<span class="_"> </span>for<span class="_ _11"> </span>available<span class="_"> </span>buffer<span class="_"> </span>slot”),<span class="_ _11"> </span>two<span class="_"> </span>I/O<span class="_"> </span>events<span class="_ _11"> </span>(“connection<span class="_"> </span>request</div><div class="t m5 x34 h2b y2d4 ff7 fs1e fc2 sc0 ls0 ws0">arrives”<span class="_ _11"> </span>and<span class="_ _11"> </span>“buffer<span class="_ _16"> </span>slot<span class="_ _11"> </span>becomes<span class="_ _11"> </span>available”),<span class="_ _16"> </span>and<span class="_ _11"> </span>two<span class="_ _11"> </span>transitions<span class="_ _16"> </span>(“accept<span class="_ _11"> </span>connection<span class="_ _11"> </span>request”<span class="_ _11"> </span>and</div><div class="t m5 x34 h2b y2d5 ff7 fs1e fc2 sc0 ls0 ws0">“insert<span class="_ _13"> </span>buffer<span class="_ _13"> </span>item”).<span class="_"> </span>Similarly<span class="_ _7"></span>,<span class="_"> </span>each<span class="_ _13"> </span>worker<span class="_ _13"> </span>thread<span class="_ _13"> </span>has<span class="_ _13"> </span>one<span class="_ _13"> </span>state<span class="_ _13"> </span>(“waiting<span class="_ _13"> </span>for<span class="_"> </span>available<span class="_ _13"> </span>buffer<span class="_ _13"> </span>item”),</div><div class="t m5 x34 h2b y2d6 ff7 fs1e fc2 sc0 ls0 ws0">one<span class="_"> </span>I/O<span class="_"> </span>event<span class="_"> </span>(“buffer<span class="_"> </span>item<span class="_"> </span>becomes<span class="_"> </span>available”),<span class="_"> </span>and<span class="_"> </span>one<span class="_"> </span>transition<span class="_"> </span>(“remove<span class="_"> </span>buffer<span class="_"> </span>item”).</div><div class="t m5 x17 h2f y82ee ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>12.30</div><div class="t m5 x17 h2f y82ef ffe fs16 fc1 sc0 ls0 ws0">Relationships<span class="_ _16"> </span>between</div><div class="t m5 x17 h2f y82f0 ffe fs16 fc1 sc0 ls0 ws0">the<span class="_ _16"> </span>sets<span class="_ _16"> </span>of<span class="_ _16"> </span>sequential,</div><div class="t m5 x17 h2f y82f1 ffe fs16 fc1 sc0 ls0 ws0">concurrent,<span class="_ _11"> </span>and<span class="_ _16"> </span>parallel</div><div class="t m5 x17 h2f y82f2 ffe fs16 fc1 sc0 ls0 ws0">programs.</div><div class="t m5 x8f h3f y82f3 ffed fs27 fc1 sc0 ls0 ws0">All programs</div><div class="t m5 x79 h3f y82f4 ffed fs27 fc1 sc0 ls0 ws0">Concurrent programs</div><div class="t m5 x254 h3f y82f5 ffed fs27 fc1 sc0 ls0 ws0">Sequential programs</div><div class="t m5 xec h3f y82f6 ffed fs27 fc1 sc0 ls0 ws0">Parallel</div><div class="t m5 x16c h3f y82f7 ffed fs27 fc1 sc0 ls0 ws0">programs</div><div class="t m5 x17 h3b y94f fff fs24 fc6 sc0 ls0 ws0">12.6</div><div class="t m5 x123 h3e y1ada ffe fs18 fc6 sc0 ls0 ws0">Using<span class="_"> </span>Threads<span class="_"> </span>for<span class="_"> </span>Parallelism</div><div class="t m5 x17 h26 y6626 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>hus<span class="_ _16"> </span>far<span class="_ _16"> </span>in<span class="_ _11"> </span>our<span class="_ _16"> </span>study<span class="_ _16"> </span>of<span class="_ _11"> </span>concurrency<span class="_ _3"></span>,<span class="_ _16"> </span>we<span class="_ _11"> </span>have<span class="_ _16"> </span>assumed<span class="_ _16"> </span>concurrent<span class="_ _11"> </span>threads<span class="_ _16"> </span>exe-</div><div class="t m5 x17 h26 y6627 ff7 fs19 fc1 sc0 ls0 ws0">cuting<span class="_ _6"> </span>on<span class="_ _13"> </span>uniprocessor<span class="_ _6"> </span>systems<span class="_ _0"></span>.<span class="_ _6"> </span>However,<span class="_ _13"> </span>most<span class="_ _6"> </span>modern<span class="_ _13"> </span>machines<span class="_ _6"> </span>have<span class="_ _13"> </span>multi-core</div><div class="t m5 x17 h26 y6628 ff7 fs19 fc1 sc0 ls0 ws0">processors<span class="_ _1"></span>.<span class="_ _11"> </span>Concurrent<span class="_ _11"> </span>programs<span class="_ _11"> </span>often<span class="_ _11"> </span>run<span class="_ _11"> </span>faster<span class="_ _11"> </span>on<span class="_ _11"> </span>such<span class="_ _11"> </span>machines<span class="_ _11"> </span>because<span class="_ _11"> </span>the</div><div class="t m5 x17 h26 y6629 ff7 fs19 fc1 sc0 ls0 ws0">operating<span class="_ _14"> </span>system<span class="_ _14"> </span>kernel<span class="_ _15"> </span>schedules<span class="_ _14"> </span>the<span class="_ _15"> </span>concurrent<span class="_ _14"> </span>threads<span class="_ _15"> </span>in<span class="_ _14"> </span>parallel<span class="_ _14"> </span>on<span class="_ _15"> </span>multi-</div><div class="t m5 x17 h26 y662a ff7 fs19 fc1 sc0 ls0 ws0">ple<span class="_ _16"> </span>cores<span class="_ _1"></span>,<span class="_ _14"> </span>rather<span class="_ _14"> </span>than<span class="_ _14"> </span>sequentially<span class="_ _16"> </span>on<span class="_ _14"> </span>a<span class="_ _16"> </span>single<span class="_ _14"> </span>core<span class="_ _1"></span>.<span class="_ _14"> </span>Exploiting<span class="_ _16"> </span>such<span class="_ _14"> </span>parallelism</div><div class="t m5 x17 h26 y662b ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_"> </span>critically<span class="_"> </span>important<span class="_ _11"> </span>in<span class="_"> </span>applications<span class="_"> </span>such<span class="_ _11"> </span>as<span class="_"> </span>busy<span class="_ _11"> </span>W<span class="_ _3"></span>eb<span class="_"> </span>servers<span class="_ _0"></span>,<span class="_"> </span>database<span class="_"> </span>servers<span class="_ _1"></span>,</div><div class="t m5 x17 h26 y662c ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _16"> </span>large<span class="_ _14"> </span>scientiﬁc<span class="_ _14"> </span>codes<span class="_ _1"></span>,<span class="_ _15"> </span>and<span class="_ _14"> </span>it<span class="_ _14"> </span>is<span class="_ _16"> </span>becoming<span class="_ _14"> </span>increasingly<span class="_ _14"> </span>useful<span class="_ _14"> </span>in<span class="_ _14"> </span>mainstream</div><div class="t m5 x17 h26 y662d ff7 fs19 fc1 sc0 ls0 ws0">applications<span class="_"> </span>such<span class="_"> </span>as<span class="_"> </span>W<span class="_ _3"></span>eb<span class="_"> </span>browsers<span class="_ _1"></span>,<span class="_"> </span>spreadsheets<span class="_ _1"></span>,<span class="_"> </span>and<span class="_"> </span>document<span class="_"> </span>processors<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y662e ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_"> </span>12.30<span class="_"> </span>shows<span class="_"> </span>the<span class="_"> </span>set<span class="_"> </span>relationships<span class="_"> </span>between<span class="_"> </span>sequential,<span class="_"> </span>concurrent,<span class="_"> </span>and</div><div class="t m5 x17 h26 y662f ff7 fs19 fc1 sc0 ls0 ws0">parallel<span class="_ _15"> </span>programs<span class="_ _1"></span>.<span class="_ _15"> </span>T<span class="_ _0"></span>he<span class="_ _15"> </span>set<span class="_ _15"> </span>of<span class="_ _15"> </span>all<span class="_ _15"> </span>programs<span class="_ _15"> </span>can<span class="_ _15"> </span>be<span class="_ _15"> </span>partitioned<span class="_ _15"> </span>into<span class="_ _15"> </span>the<span class="_ _15"> </span>disjoint</div><div class="t m5 x17 h26 y6630 ff7 fs19 fc1 sc0 ls0 ws0">sets<span class="_"> </span>of<span class="_"> </span>sequential<span class="_"> </span>and<span class="_"> </span>concurrent<span class="_"> </span>programs<span class="_ _1"></span>.<span class="_"> </span>A<span class="_"> </span>sequential<span class="_ _11"> </span>program<span class="_"> </span>is<span class="_"> </span>written<span class="_"> </span>as<span class="_"> </span>a</div><div class="t m5 x17 h26 y6631 ff7 fs19 fc1 sc0 ls0 ws0">single<span class="_"> </span>logical<span class="_"> </span>ﬂow<span class="_ _3"></span>.<span class="_"> </span>A<span class="_"> </span>concurrent<span class="_"> </span>program<span class="_"> </span>is<span class="_"> </span>written<span class="_"> </span>as<span class="_"> </span>multiple<span class="_"> </span>concurrent<span class="_"> </span>ﬂows<span class="_ _1"></span>.</div><div class="t m5 x17 h26 y6632 ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_ _13"> </span>parallel<span class="_ _13"> </span>program<span class="_ _13"> </span>is<span class="_ _13"> </span>a<span class="_ _13"> </span>concurrent<span class="_ _13"> </span>program<span class="_ _6"> </span>running<span class="_ _13"> </span>on<span class="_ _13"> </span>multiple<span class="_ _13"> </span>processors<span class="_ _1"></span>.<span class="_ _13"> </span>T<span class="_ _0"></span>hus<span class="_ _1"></span>,</div><div class="t m5 x17 h26 y6633 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>set<span class="_"> </span>of<span class="_"> </span>parallel<span class="_"> </span>programs<span class="_"> </span>is<span class="_"> </span>a<span class="_"> </span>proper<span class="_"> </span>subset<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>set<span class="_"> </span>of<span class="_"> </span>concurrent<span class="_"> </span>programs<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y6634 ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_"> </span>detailed<span class="_ _11"> </span>treatment<span class="_"> </span>of<span class="_ _11"> </span>parallel<span class="_ _11"> </span>programs<span class="_"> </span>is<span class="_ _11"> </span>beyond<span class="_ _11"> </span>our<span class="_"> </span>scope,<span class="_"> </span>but<span class="_"> </span>studying</div><div class="t m5 x17 h26 y6635 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_ _13"> </span>few<span class="_"> </span>simple<span class="_ _13"> </span>example<span class="_"> </span>programs<span class="_ _13"> </span>will<span class="_"> </span>help<span class="_ _13"> </span>you<span class="_"> </span>understand<span class="_ _13"> </span>some<span class="_"> </span>important<span class="_ _13"> </span>aspects</div><div class="t m5 x17 h26 y6636 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span>parallel<span class="_"> </span>programming.<span class="_"> </span>F<span class="_ _3"></span>or<span class="_"> </span>example<span class="_ _0"></span>,<span class="_"> </span>consider<span class="_"> </span>how<span class="_"> </span>we<span class="_"> </span>might<span class="_"> </span>sum<span class="_"> </span>the<span class="_"> </span>sequence</div><div class="t m5 x17 h46 y6637 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span>integers<span class="_ _11"> </span>0<span class="ff11 ls4e">,...,n</span><span class="ff12">−<span class="_ _10"> </span></span>1<span class="_ _13"> </span>in<span class="_"> </span>parallel.<span class="_ _11"> </span>Of<span class="_"> </span>course,<span class="_"> </span>there<span class="_"> </span>is<span class="_"> </span>a<span class="_ _11"> </span>closed-form<span class="_ _11"> </span>solution<span class="_"> </span>for</div><div class="t m5 x17 h26 y6638 ff7 fs19 fc1 sc0 ls0 ws0">this<span class="_ _13"> </span>particular<span class="_ _13"> </span>problem,<span class="_"> </span>but<span class="_ _13"> </span>nonetheless<span class="_ _13"> </span>it<span class="_ _13"> </span>is<span class="_"> </span>a<span class="_ _13"> </span>concise<span class="_ _13"> </span>and<span class="_ _13"> </span>easy-to-understand<span class="_ _13"> </span>ex-</div><div class="t m5 x17 h26 y6639 ff7 fs19 fc1 sc0 ls0 ws0">emplar<span class="_ _13"> </span>that<span class="_ _13"> </span>will<span class="_ _6"> </span>allow<span class="_ _13"> </span>us<span class="_ _13"> </span>to<span class="_ _13"> </span>make<span class="_ _6"> </span>some<span class="_ _13"> </span>interesting<span class="_ _13"> </span>points<span class="_ _13"> </span>about<span class="_ _13"> </span>parallel<span class="_ _6"> </span>programs<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y663a ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>most<span class="_"> </span>straightforward<span class="_"> </span>approach<span class="_"> </span>for<span class="_"> </span>assigning<span class="_ _13"> </span>work<span class="_"> </span>to<span class="_"> </span>different<span class="_"> </span>threads<span class="_"> </span>is</div><div class="t m5 x17 h26 y82f8 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _13"> </span>partition<span class="_"> </span>the<span class="_ _13"> </span>sequence<span class="_ _13"> </span>into<span class="_"> </span><span class="ff11">t<span class="_ _11"> </span></span>disjoint<span class="_"> </span>regions<span class="_ _13"> </span>and<span class="_"> </span>then<span class="_ _13"> </span>assign<span class="_ _13"> </span>each<span class="_"> </span>of<span class="_ _13"> </span><span class="ff11">t<span class="_"> </span></span>different</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
