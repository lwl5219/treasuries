<div id="pf35f" class="pf w2 h11" data-page-no="35f"><div class="pc pc35f w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg35f.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">862<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>9<span class="_ _3d"> </span>Virtual<span class="_ _10"> </span>Memory</span></div><div class="t m8 xb4 h10a y6feb ffb6 fs9e fc1 sc0 ls0 ws0">. . .</div><div class="t m8 x176 h10a y6fec ffb6 fs9e fc1 sc0 ls0 ws0">. . .</div><div class="t m5 x4d h10a y6fed ffb6 fs9e fc1 sc0 ls0 ws0">CPU</div><div class="t m5 x10d h10a y6fee ffb6 fs9e fc1 sc0 ls0 ws0">VPN<span class="_ _95"> </span>VPO</div><div class="t m5 x1c4 h10b y6fef ffb6 fs9f fc1 sc0 ls0 ws0">36<span class="_ _2e"> </span>12</div><div class="t m5 xcd h10a y6ff0 ffb6 fs9e fc1 sc0 ls0 ws0">TLBT<span class="_ _3b"> </span>TLBI</div><div class="t m5 x21f h10b y6ff1 ffb6 fs9f fc1 sc0 ls0 ws0">32<span class="_ _4c"> </span>4</div><div class="t m5 xad h10a y6ff2 ffb6 fs9e fc1 sc0 ls0 ws0">VPN1<span class="_ _24"> </span>VPN2</div><div class="t m5 xe1 h10a y6ff3 ffb6 fs9e fc1 sc0 ls0 ws0">PTE<span class="_ _191"></span>PTE<span class="_ _191"></span>PTE<span class="_ _1c6"></span>PTE</div><div class="t m5 x5e h10a y6ff4 ffb6 fs9e fc1 sc0 ls0 ws0">PPN<span class="_ _7b"> </span>PPO</div><div class="t m5 xf4 h10b y6ff5 ffb6 fs9f fc1 sc0 ls0 ws0">40<span class="_ _78"> </span>12</div><div class="t m5 x58 h10b y6ff6 ffb6 fs9f fc1 sc0 ls2a6 ws0">99</div><div class="t m5 x21d h10a y6ff2 ffb6 fs9e fc1 sc0 ls0 ws0">VPN3<span class="_ _24"> </span>VPN4</div><div class="t m5 xb2 h10b y6ff7 ffb6 fs9f fc1 sc0 ls2a6 ws0">99</div><div class="t m5 xc2 h10a y6ff8 ffb7 fs9e fc1 sc0 ls0 ws0">TLB</div><div class="t m5 xc2 h10a y6ff9 ffb7 fs9e fc1 sc0 ls0 ws0">miss</div><div class="t m5 x218 h10a y6ffa ffb8 fs9e fc1 sc0 ls0 ws0">Virtual address (V<span class="_ _1"></span>A)</div><div class="t m5 x5e h10a y6ffb ffb7 fs9e fc1 sc0 ls0 ws0">TLB</div><div class="t m5 x19d h10a y6ffc ffb7 fs9e fc1 sc0 ls0 ws0">hit</div><div class="t m5 x89 h10a y6ffd ffb8 fs9e fc1 sc0 ls0 ws0">L1 <span class="_ _3"></span>TLB (16 sets, 4 entries/set)</div><div class="t m5 xc1 h10a y6ffe ffb8 fs9e fc1 sc0 ls0 ws0">Pa<span class="_ _0"></span>ge tables</div><div class="t m5 x6b h10a y6fff ffb6 fs9e fc1 sc0 ls0 ws0">Result</div><div class="t m5 x1d h10a y7000 ffb6 fs9e fc1 sc0 ls0 ws0">CR3</div><div class="t m5 xa9 h10b y7001 ffb6 fs9f fc1 sc0 ls0 ws0">32/64</div><div class="t m5 x158 h10a y7002 ffb6 fs9e fc1 sc0 ls0 ws0">CT<span class="_ _95"> </span>CI<span class="_ _1f"> </span>CO</div><div class="t m5 x16b h10b y7003 ffb6 fs9f fc1 sc0 ls0 ws0">40<span class="_ _2c"> </span>6<span class="_ _21b"></span>6</div><div class="t m5 x108 h10a y7004 ffb7 fs9e fc1 sc0 ls0 ws0">L1</div><div class="t m5 x108 h10a y7005 ffb7 fs9e fc1 sc0 ls0 ws0">hit</div><div class="t m5 x204 h10a y7006 ffb8 fs9e fc1 sc0 ls0 ws0">L1 d-cache</div><div class="t m5 x204 h10a y7007 ffb8 fs9e fc1 sc0 ls0 ws0">(64 sets,<span class="_ _0"></span> 8 lines/set)</div><div class="t m5 x220 h10a y7008 ffb8 fs9e fc1 sc0 ls0 ws0">L2,<span class="_ _0"></span> L3,<span class="_ _0"></span> and</div><div class="t m5 x104 h10a y7009 ffb8 fs9e fc1 sc0 ls0 ws0">main memory</div><div class="t m5 x165 h10a y700a ffb7 fs9e fc1 sc0 ls0 ws0">L1</div><div class="t m5 x165 h10a y700b ffb7 fs9e fc1 sc0 ls0 ws0">miss</div><div class="t m5 x100 h10a y700c ffb8 fs9e fc1 sc0 ls0 ws0">Physical</div><div class="t m5 x108 h10a y700d ffb8 fs9e fc1 sc0 ls0 ws0">address</div><div class="t m5 x1c3 h10a y700e ffb8 fs9e fc1 sc0 ls0 ws0">(P<span class="_ _3"></span>A)</div><div class="t m5 x1d h34 y700f ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _16"> </span>9.22<span class="_ _c"> </span><span class="fc1">Summar<span class="_ _2"></span>y<span class="_ _16"> </span>of<span class="_ _14"> </span>Core<span class="_ _16"> </span>i7<span class="_ _14"> </span>address<span class="_ _14"> </span>translation.<span class="_ _16"> </span><span class="ff6">For<span class="_ _14"> </span>simplicity<span class="_ _1"></span>,<span class="_ _14"> </span>the<span class="_ _14"> </span>i-caches,</span></span></div><div class="t m5 x1d h34 y7010 ff6 fs16 fc1 sc0 ls0 ws0">i-TLB,<span class="_ _10"> </span>and<span class="_ _11"> </span>L2<span class="_ _10"> </span>uniﬁed<span class="_ _10"> </span>TLB<span class="_ _11"> </span>are<span class="_ _10"> </span>not<span class="_ _11"> </span>shown.</div><div class="t m5 x1d h26 y7011 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_"> </span>DDR3<span class="_ _13"> </span>memory<span class="_"> </span>controller<span class="_ _0"></span>.<span class="_"> </span>Each<span class="_ _13"> </span>core<span class="_"> </span>contains<span class="_ _13"> </span>a<span class="_"> </span>hierarchy<span class="_ _13"> </span>of<span class="_"> </span>TLBs<span class="_ _1"></span>,<span class="_"> </span>a<span class="_ _13"> </span>hierarchy</div><div class="t m5 x1d h26 y7012 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span>data<span class="_"> </span>and<span class="_"> </span>instruction<span class="_"> </span>caches<span class="_ _1"></span>,<span class="_ _11"> </span>and<span class="_"> </span>a<span class="_"> </span>set<span class="_"> </span>of<span class="_"> </span>fast<span class="_ _11"> </span>point-to-point<span class="_"> </span>links<span class="_ _1"></span>,<span class="_"> </span>based<span class="_"> </span>on<span class="_ _11"> </span>the</div><div class="t m5 x1d h26 y7013 ff7 fs19 fc1 sc0 ls0 ws0">QuickPath<span class="_ _16"> </span>technology<span class="_ _7"></span>,<span class="_ _14"> </span>for<span class="_ _16"> </span>communicating<span class="_ _11"> </span>directly<span class="_ _16"> </span>with<span class="_ _16"> </span>the<span class="_ _16"> </span>other<span class="_ _16"> </span>cores<span class="_ _11"> </span>and<span class="_ _16"> </span>the</div><div class="t m5 x1d h26 y7014 ff7 fs19 fc1 sc0 ls0 ws0">external<span class="_"> </span>I/O<span class="_"> </span>bridge<span class="_ _1"></span>.<span class="_ _11"> </span>T<span class="_ _1"></span>he<span class="_"> </span>TLBs<span class="_"> </span>are<span class="_"> </span>virtually<span class="_ _11"> </span>addressed,<span class="_"> </span>and<span class="_"> </span>4-way<span class="_"> </span>set<span class="_"> </span>associative<span class="_ _0"></span>.</div><div class="t m5 x1d h26 y7015 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>L1,<span class="_"> </span>L2,<span class="_"> </span>and<span class="_"> </span>L3<span class="_"> </span>caches<span class="_"> </span>are<span class="_"> </span>physically<span class="_ _13"> </span>addressed,<span class="_"> </span>with<span class="_"> </span>a<span class="_"> </span>block<span class="_"> </span>size<span class="_"> </span>of<span class="_"> </span>64<span class="_"> </span>bytes<span class="_ _3"></span>.</div><div class="t m5 x1d h26 y7016 ff7 fs19 fc1 sc0 ls0 ws0">L1<span class="_ _16"> </span>and<span class="_ _16"> </span>L2<span class="_ _16"> </span>are<span class="_ _16"> </span>8-way<span class="_ _16"> </span>set<span class="_ _16"> </span>associative,<span class="_ _16"> </span>and<span class="_ _16"> </span>L3<span class="_ _16"> </span>is<span class="_ _16"> </span>16-way<span class="_ _16"> </span>set<span class="_ _16"> </span>associative.<span class="_ _11"> </span>The<span class="_ _11"> </span>page</div><div class="t m5 x1d h26 y7017 ff7 fs19 fc1 sc0 ls0 ws0">size<span class="_ _11"> </span>can<span class="_ _11"> </span>be<span class="_ _11"> </span>conﬁgured<span class="_ _11"> </span>at<span class="_ _11"> </span>start-up<span class="_ _11"> </span>time<span class="_ _11"> </span>as<span class="_ _11"> </span>either<span class="_ _11"> </span>4<span class="_ _11"> </span>KB<span class="_ _11"> </span>or<span class="_ _11"> </span>4<span class="_ _11"> </span>MB<span class="_ _1"></span>.<span class="_ _11"> </span>Linux<span class="_ _11"> </span>uses<span class="_ _11"> </span>4<span class="_ _11"> </span>KB</div><div class="t m5 x1d h26 y7018 ff7 fs19 fc1 sc0 ls0 ws0">pages<span class="_ _1"></span>.</div><div class="t m5 x1d h41 y7019 ffe fs29 fc1 sc0 ls0 ws0">9.7.1<span class="_ _48"> </span><span class="fs19">Core<span class="_"> </span>i7<span class="_"> </span>Address<span class="_"> </span>T<span class="_ _3"></span>ranslation</span></div><div class="t m5 x1d h26 y4174 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _16"> </span>9.22<span class="_ _16"> </span>summarizes<span class="_ _16"> </span>the<span class="_ _16"> </span>entire<span class="_ _11"> </span>Core<span class="_ _16"> </span>i7<span class="_ _16"> </span>address<span class="_ _16"> </span>translation<span class="_ _16"> </span>process<span class="_ _3"></span>,<span class="_ _14"> </span>from<span class="_ _16"> </span>the</div><div class="t m5 x1d h26 y4175 ff7 fs19 fc1 sc0 ls0 ws0">time<span class="_"> </span>the<span class="_ _13"> </span>CPU<span class="_"> </span>generates<span class="_"> </span>a<span class="_"> </span>virtual<span class="_ _13"> </span>address<span class="_"> </span>until<span class="_"> </span>a<span class="_"> </span>data<span class="_ _13"> </span>word<span class="_"> </span>arrives<span class="_"> </span>from<span class="_"> </span>memory<span class="_ _7"></span>.</div><div class="t m5 x1d h26 y4176 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _13"> </span>Core<span class="_ _6"> </span>i7<span class="_ _13"> </span>uses<span class="_ _6"> </span>a<span class="_ _6"> </span>four<span class="_ _1"></span>-level<span class="_ _13"> </span>page<span class="_ _6"> </span>table<span class="_ _13"> </span>hierarchy<span class="_ _7"></span>.<span class="_ _13"> </span>Each<span class="_ _6"> </span>process<span class="_ _13"> </span>has<span class="_ _a"> </span>its<span class="_ _13"> </span>own<span class="_ _6"> </span>private</div><div class="t m5 x1d h26 y4177 ff7 fs19 fc1 sc0 ls0 ws0">page<span class="_ _13"> </span>table<span class="_"> </span>hierarchy<span class="_ _3"></span>.<span class="_ _13"> </span>When<span class="_ _13"> </span>a<span class="_"> </span>Linux<span class="_ _13"> </span>process<span class="_"> </span>is<span class="_ _13"> </span>running,<span class="_"> </span>the<span class="_ _13"> </span>page<span class="_"> </span>tables<span class="_ _13"> </span>associated</div><div class="t m5 x1d h26 y4178 ff7 fs19 fc1 sc0 ls0 ws0">with<span class="_ _11"> </span>allocated<span class="_ _16"> </span>pages<span class="_ _16"> </span>are<span class="_ _11"> </span>all<span class="_ _16"> </span>memory-resident,<span class="_ _16"> </span>although<span class="_ _11"> </span>the<span class="_ _16"> </span>Core<span class="_ _11"> </span>i7<span class="_ _16"> </span>architecture</div><div class="t m5 x1d h26 y4179 ff7 fs19 fc1 sc0 ls0 ws0">allows<span class="_ _21"> </span>these<span class="_ _21"> </span>page<span class="_ _21"> </span>tables<span class="_ _f"> </span>to<span class="_ _21"> </span>be<span class="_ _21"> </span>swapped<span class="_ _f"> </span>in<span class="_ _21"> </span>and<span class="_ _21"> </span>out.<span class="_ _f"> </span>T<span class="_ _1"></span>he<span class="_ _f"> </span><span class="ffa">CR3<span class="_ _21"> </span></span>control<span class="_ _21"> </span>register</div><div class="t m5 x1d h26 y417a ff7 fs19 fc1 sc0 ls0 ws0">contains<span class="_"> </span>the<span class="_"> </span>physical<span class="_"> </span>address<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>beginning<span class="_ _11"> </span>of<span class="_"> </span>the<span class="_"> </span>level<span class="_"> </span>1<span class="_"> </span>(L1)<span class="_"> </span>page<span class="_ _11"> </span>table<span class="_ _1"></span>.<span class="_"> </span>The</div><div class="t m5 x1d h26 y417b ff7 fs19 fc1 sc0 ls0 ws0">value<span class="_"> </span>of<span class="_"> </span>CR3<span class="_"> </span>is<span class="_ _11"> </span>part<span class="_"> </span>of<span class="_"> </span>each<span class="_"> </span>process<span class="_ _11"> </span>context,<span class="_"> </span>and<span class="_"> </span>is<span class="_ _11"> </span>restored<span class="_"> </span>during<span class="_"> </span>each<span class="_"> </span>context</div><div class="t m5 x1d h26 y417c ff7 fs19 fc1 sc0 ls0 ws0">switch.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
