<div id="pf366" class="pf w2 h11" data-page-no="366"><div class="pc pc366 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg366.png"/><div class="t m5 xa9 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>9.8<span class="_ _60"> </span>Memor<span class="_ _2"></span>y<span class="_ _10"> </span>Mapping<span class="_ _1b"> </span><span class="ffe fs1e">869</span></div><div class="t m5 x26 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_ _11"> </span>updating<span class="_ _16"> </span>the<span class="_ _11"> </span>page<span class="_ _11"> </span>table.<span class="_"> </span>When<span class="_ _11"> </span>the<span class="_ _16"> </span>page<span class="_ _11"> </span>fault<span class="_ _11"> </span>handler<span class="_ _16"> </span>returns<span class="_ _3"></span>,<span class="_ _16"> </span>the<span class="_ _11"> </span>CPU</div><div class="t m5 x26 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">restarts<span class="_"> </span>the<span class="_"> </span>faulting<span class="_ _13"> </span>instruction,<span class="_"> </span>which<span class="_"> </span>sends<span class="_"> </span><span class="ff11">A<span class="_ _10"> </span></span>to<span class="_ _13"> </span>the<span class="_"> </span>MMU<span class="_"> </span>again.<span class="_"> </span>T<span class="_ _1"></span>his<span class="_"> </span>time<span class="_ _1"></span>,</div><div class="t m5 x26 h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>MMU<span class="_"> </span>translates<span class="_"> </span><span class="ff11">A<span class="_ _10"> </span></span>normally<span class="_ _3"></span>,<span class="_"> </span>without<span class="_"> </span>generating<span class="_"> </span>a<span class="_"> </span>page<span class="_"> </span>fault.</div><div class="t m5 x17 h3b ydc7 fff fs24 fc6 sc0 ls0 ws0">9.8<span class="_ _17"> </span><span class="ffe fs18">Memor<span class="_ _2"></span>y<span class="_"> </span>Mapping</span></div><div class="t m5 x17 h26 y70e9 ff7 fs19 fc1 sc0 ls0 ws0">Linux<span class="_ _16"> </span>initializes<span class="_ _16"> </span>the<span class="_ _11"> </span>contents<span class="_ _16"> </span>of<span class="_ _16"> </span>a<span class="_ _16"> </span>virtual<span class="_ _16"> </span>memory<span class="_ _16"> </span>area<span class="_ _11"> </span>by<span class="_ _16"> </span>associating<span class="_ _16"> </span>it<span class="_ _16"> </span>with<span class="_ _16"> </span>an</div><div class="t m5 x17 h26 y70ea ffa fs19 fc1 sc0 ls0 ws0">object<span class="_"> </span><span class="ff7">on<span class="_ _13"> </span>disk,<span class="_ _13"> </span>a<span class="_ _13"> </span>process<span class="_ _6"> </span>known<span class="_ _13"> </span>as<span class="_ _13"> </span></span>memory<span class="_ _13"> </span>mapping<span class="_ _2"></span><span class="ff7">.<span class="_ _13"> </span>Areas<span class="_ _13"> </span>can<span class="_ _6"> </span>be<span class="_ _13"> </span>mapped<span class="_ _13"> </span>to<span class="_ _13"> </span>one</span></div><div class="t m5 x17 h26 y70eb ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span>two<span class="_"> </span>types<span class="_"> </span>of<span class="_"> </span>objects:</div><div class="t m5 x1cd h26 y70ec ffc fs19 fc1 sc0 ls0 ws0">1.<span class="_ _e"> </span><span class="ffa">Regular<span class="_ _11"> </span>ﬁle<span class="_ _11"> </span>in<span class="_ _11"> </span>the<span class="_ _11"> </span>Linux<span class="_"> </span>ﬁle<span class="_ _11"> </span>system:<span class="_ _11"> </span><span class="ff7">An<span class="_ _11"> </span>area<span class="_ _11"> </span>can<span class="_ _11"> </span>be<span class="_"> </span>mapped<span class="_ _11"> </span>to<span class="_ _11"> </span>a<span class="_ _11"> </span>contiguous</span></span></div><div class="t m5 x26 h26 y70ed ff7 fs19 fc1 sc0 ls0 ws0">section<span class="_"> </span>of<span class="_ _13"> </span>a<span class="_"> </span>regular<span class="_"> </span>disk<span class="_ _13"> </span>ﬁle,<span class="_ _13"> </span>such<span class="_"> </span>as<span class="_"> </span>an<span class="_ _13"> </span>executable<span class="_"> </span>object<span class="_"> </span>ﬁle<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>ﬁle<span class="_"> </span>section</div><div class="t m5 x26 h26 y70ee ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_ _13"> </span>divided<span class="_ _13"> </span>into<span class="_ _13"> </span>page-size<span class="_ _13"> </span>pieces<span class="_ _1"></span>,<span class="_"> </span>with<span class="_ _13"> </span>each<span class="_ _13"> </span>piece<span class="_ _13"> </span>containing<span class="_ _13"> </span>the<span class="_ _13"> </span>initial<span class="_ _13"> </span>contents</div><div class="t m5 x26 h26 y70ef ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_ _16"> </span>a<span class="_ _16"> </span>virtual<span class="_ _16"> </span>page<span class="_ _1"></span>.<span class="_ _16"> </span>Because<span class="_ _16"> </span>of<span class="_ _16"> </span>demand<span class="_ _16"> </span>paging,<span class="_ _16"> </span>none<span class="_ _16"> </span>of<span class="_ _16"> </span>these<span class="_ _16"> </span>virtual<span class="_ _16"> </span>pages<span class="_ _16"> </span>is</div><div class="t m5 x26 h26 y70f0 ff7 fs19 fc1 sc0 ls0 ws0">actually<span class="_ _11"> </span>swapped<span class="_ _11"> </span>into<span class="_ _11"> </span>physical<span class="_ _16"> </span>memory<span class="_"> </span>until<span class="_ _16"> </span>the<span class="_"> </span>CPU<span class="_ _16"> </span>ﬁrst<span class="_ _11"> </span><span class="ffa">touches<span class="_"> </span></span>the<span class="_ _16"> </span>page</div><div class="t m5 x26 h26 y70f1 ff7 fs19 fc1 sc0 ls0 ws0">(i.e<span class="_ _1"></span>.,<span class="_"> </span>issues<span class="_"> </span>a<span class="_ _13"> </span>virtual<span class="_"> </span>address<span class="_"> </span>that<span class="_ _13"> </span>falls<span class="_"> </span>within<span class="_"> </span>that<span class="_ _13"> </span>page’s<span class="_"> </span>region<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>address</div><div class="t m5 x26 h26 y70f2 ff7 fs19 fc1 sc0 ls0 ws0">space).<span class="_"> </span>If<span class="_"> </span>the<span class="_"> </span>area<span class="_"> </span>is<span class="_"> </span>larger<span class="_"> </span>than<span class="_"> </span>the<span class="_"> </span>ﬁle<span class="_"> </span>section,<span class="_"> </span>then<span class="_"> </span>the<span class="_"> </span>area<span class="_"> </span>is<span class="_"> </span>padded<span class="_"> </span>with</div><div class="t m5 x26 h26 y70f3 ff7 fs19 fc1 sc0 ls0 ws0">zeros<span class="_ _1"></span>.</div><div class="t m5 x1cd h26 y70f4 ffc fs19 fc1 sc0 ls0 ws0">2.<span class="_ _e"> </span><span class="ffa">Anonymous<span class="_ _16"> </span>ﬁle:<span class="_ _11"> </span><span class="ff7">An<span class="_ _11"> </span>area<span class="_ _11"> </span>can<span class="_ _16"> </span>also<span class="_"> </span>be<span class="_ _16"> </span>mapped<span class="_"> </span>to<span class="_ _16"> </span>an<span class="_"> </span>anonymous<span class="_ _16"> </span>ﬁle<span class="_ _1"></span>,<span class="_ _16"> </span>created</span></span></div><div class="t m5 x26 h26 y70f5 ff7 fs19 fc1 sc0 ls0 ws0">by<span class="_ _11"> </span>the<span class="_ _11"> </span>kernel,<span class="_ _16"> </span>that<span class="_ _11"> </span>contains<span class="_ _11"> </span>all<span class="_ _11"> </span>binary<span class="_ _11"> </span>zeros<span class="_ _0"></span>.<span class="_ _11"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span>ﬁrst<span class="_ _11"> </span>time<span class="_ _11"> </span>the<span class="_ _11"> </span>CPU<span class="_ _11"> </span>touches</div><div class="t m5 x26 h26 y70f6 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_ _14"> </span>virtual<span class="_ _14"> </span>page<span class="_ _14"> </span>in<span class="_ _14"> </span>such<span class="_ _14"> </span>an<span class="_ _14"> </span>area,<span class="_ _15"> </span>the<span class="_ _14"> </span>kernel<span class="_ _14"> </span>ﬁnds<span class="_ _14"> </span>an<span class="_ _14"> </span>appropriate<span class="_ _14"> </span>victim<span class="_ _14"> </span>page</div><div class="t m5 x26 h26 y70f7 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_ _14"> </span>physical<span class="_ _15"> </span>memory<span class="_ _3"></span>,<span class="_ _15"> </span>swaps<span class="_ _14"> </span>out<span class="_ _15"> </span>the<span class="_ _14"> </span>victim<span class="_ _15"> </span>page<span class="_ _15"> </span>if<span class="_ _14"> </span>it<span class="_ _15"> </span>is<span class="_ _14"> </span>dirty<span class="_ _3"></span>,<span class="_ _15"> </span>overwrites<span class="_ _15"> </span>the</div><div class="t m5 x26 h26 y70f8 ff7 fs19 fc1 sc0 ls0 ws0">victim<span class="_ _11"> </span>page<span class="_ _16"> </span>with<span class="_ _16"> </span>binary<span class="_ _11"> </span>zeros<span class="_ _1"></span>,<span class="_ _16"> </span>and<span class="_ _16"> </span>updates<span class="_ _16"> </span>the<span class="_ _11"> </span>page<span class="_ _16"> </span>table<span class="_ _11"> </span>to<span class="_ _16"> </span>mark<span class="_ _16"> </span>the<span class="_ _11"> </span>page</div><div class="t m5 x26 h26 y70f9 ff7 fs19 fc1 sc0 ls0 ws0">as<span class="_ _15"> </span>resident.<span class="_ _14"> </span>Notice<span class="_ _15"> </span>that<span class="_ _15"> </span>no<span class="_ _15"> </span>data<span class="_ _15"> </span>are<span class="_ _15"> </span>actually<span class="_ _15"> </span>transferred<span class="_ _15"> </span>between<span class="_ _14"> </span>disk<span class="_ _15"> </span>and</div><div class="t m5 x26 h26 y70fa ff7 fs19 fc1 sc0 ls0 ws0">memory<span class="_ _3"></span>.<span class="_"> </span>F<span class="_ _1"></span>or<span class="_ _11"> </span>this<span class="_ _11"> </span>reason,<span class="_ _11"> </span>pages<span class="_"> </span>in<span class="_ _11"> </span>areas<span class="_ _11"> </span>that<span class="_ _11"> </span>are<span class="_ _11"> </span>mapped<span class="_"> </span>to<span class="_ _11"> </span>anonymous<span class="_ _11"> </span>ﬁles</div><div class="t m5 x26 h26 y70fb ff7 fs19 fc1 sc0 ls0 ws0">are<span class="_"> </span>sometimes<span class="_"> </span>called<span class="_"> </span><span class="ffa">demand-zero<span class="_"> </span>pages</span>.</div><div class="t m5 x26 h26 y70fc ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _11"> </span>either<span class="_ _11"> </span>case<span class="_ _0"></span>,<span class="_ _11"> </span>once<span class="_ _11"> </span>a<span class="_ _11"> </span>virtual<span class="_ _11"> </span>page<span class="_ _11"> </span>is<span class="_ _11"> </span>initialized,<span class="_ _16"> </span>it<span class="_"> </span>is<span class="_ _11"> </span>swapped<span class="_ _16"> </span>back<span class="_"> </span>and<span class="_ _11"> </span>forth</div><div class="t m5 x17 h26 y70fd ff7 fs19 fc1 sc0 ls0 ws0">between<span class="_"> </span>a<span class="_"> </span>special<span class="_ _13"> </span><span class="ffa">swap<span class="_"> </span>ﬁle<span class="_"> </span></span>maintained<span class="_"> </span>by<span class="_"> </span>the<span class="_ _13"> </span>kernel.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>swap<span class="_"> </span>ﬁle<span class="_"> </span>is<span class="_"> </span>also<span class="_"> </span>known</div><div class="t m5 x17 h26 y70fe ff7 fs19 fc1 sc0 ls0 ws0">as<span class="_ _16"> </span>the<span class="_ _11"> </span><span class="ffa">swap<span class="_ _16"> </span>space<span class="_ _16"> </span></span>or<span class="_ _16"> </span>the<span class="_ _11"> </span><span class="ffa">swap<span class="_ _16"> </span>area</span>.<span class="_ _11"> </span>An<span class="_ _16"> </span>important<span class="_ _16"> </span>point<span class="_ _16"> </span>to<span class="_ _16"> </span>realize<span class="_ _11"> </span>is<span class="_ _16"> </span>that<span class="_ _16"> </span>at<span class="_ _16"> </span>any</div><div class="t m5 x17 h26 y70ff ff7 fs19 fc1 sc0 ls0 ws0">point<span class="_ _13"> </span>in<span class="_"> </span>time<span class="_ _1"></span>,<span class="_"> </span>the<span class="_ _13"> </span>swap<span class="_ _13"> </span>space<span class="_ _13"> </span>bounds<span class="_"> </span>the<span class="_ _13"> </span>total<span class="_ _13"> </span>amount<span class="_"> </span>of<span class="_ _13"> </span>virtual<span class="_ _13"> </span>pages<span class="_"> </span>that<span class="_ _13"> </span>can<span class="_ _13"> </span>be</div><div class="t m5 x17 h26 y7100 ff7 fs19 fc1 sc0 ls0 ws0">allocated<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span>currently<span class="_"> </span>running<span class="_"> </span>processes<span class="_ _1"></span>.</div><div class="t m5 x17 h41 y8f8 ffe fs29 fc1 sc0 ls0 ws0">9.8.1<span class="_ _48"> </span><span class="fs19">Shared<span class="_"> </span>Objects<span class="_"> </span>Revisited</span></div><div class="t m5 x17 h26 yb97 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _15"> </span>idea<span class="_ _15"> </span>of<span class="_ _15"> </span>memory<span class="_ _15"> </span>mapping<span class="_ _15"> </span>resulted<span class="_ _15"> </span>from<span class="_ _15"> </span>a<span class="_ _15"> </span>clever<span class="_ _15"> </span>insight<span class="_ _14"> </span>that<span class="_ _15"> </span>if<span class="_ _15"> </span>the<span class="_ _15"> </span>virtual</div><div class="t m5 x17 h26 yb98 ff7 fs19 fc1 sc0 ls0 ws0">memory<span class="_ _13"> </span>system<span class="_ _6"> </span>could<span class="_ _13"> </span>be<span class="_ _6"> </span>integrated<span class="_ _13"> </span>into<span class="_ _6"> </span>the<span class="_ _13"> </span>conventional<span class="_ _6"> </span>ﬁle<span class="_ _13"> </span>system,<span class="_ _13"> </span>then<span class="_ _6"> </span>it<span class="_ _13"> </span>could</div><div class="t m5 x17 h26 yb99 ff7 fs19 fc1 sc0 ls0 ws0">provide<span class="_"> </span>a<span class="_"> </span>simple<span class="_"> </span>and<span class="_"> </span>efﬁcient<span class="_"> </span>way<span class="_"> </span>to<span class="_"> </span>load<span class="_"> </span>programs<span class="_"> </span>and<span class="_"> </span>data<span class="_"> </span>into<span class="_"> </span>memory<span class="_ _3"></span>.</div><div class="t m5 x26 h26 yb9a ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_ _16"> </span>we<span class="_ _16"> </span>have<span class="_ _16"> </span>seen,<span class="_ _14"> </span>the<span class="_ _16"> </span>process<span class="_ _16"> </span>abstraction<span class="_ _16"> </span>promises<span class="_ _16"> </span>to<span class="_ _16"> </span>provide<span class="_ _16"> </span>each<span class="_ _16"> </span>process</div><div class="t m5 x17 h26 yb9b ff7 fs19 fc1 sc0 ls0 ws0">with<span class="_ _15"> </span>its<span class="_ _15"> </span>own<span class="_ _15"> </span>private<span class="_ _21"> </span>virtual<span class="_ _15"> </span>address<span class="_ _15"> </span>space<span class="_ _15"> </span>that<span class="_ _21"> </span>is<span class="_ _15"> </span>protected<span class="_ _15"> </span>from<span class="_ _15"> </span>errant<span class="_ _21"> </span>writes</div><div class="t m5 x17 h26 yb9c ff7 fs19 fc1 sc0 ls0 ws0">or<span class="_ _16"> </span>reads<span class="_ _16"> </span>by<span class="_ _16"> </span>other<span class="_ _16"> </span>processes<span class="_ _3"></span>.<span class="_ _16"> </span>However,<span class="_ _16"> </span>many<span class="_ _16"> </span>processes<span class="_ _16"> </span>have<span class="_ _16"> </span>identical<span class="_ _16"> </span>read-only</div><div class="t m5 x17 h26 yb9d ff7 fs19 fc1 sc0 ls0 ws0">code<span class="_ _13"> </span>areas<span class="_ _1"></span>.<span class="_"> </span>F<span class="_ _3"></span>or<span class="_"> </span>example<span class="_ _1"></span>,<span class="_"> </span>each<span class="_ _13"> </span>process<span class="_ _13"> </span>that<span class="_"> </span>runs<span class="_ _13"> </span>the<span class="_ _13"> </span>Linux<span class="_"> </span>shell<span class="_ _13"> </span>program<span class="_"> </span><span class="ffd">bash<span class="_ _13"> </span></span>has</div><div class="t m5 x17 h26 yb9e ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _16"> </span>same<span class="_ _16"> </span>code<span class="_ _14"> </span>area.<span class="_ _16"> </span>Further,<span class="_ _16"> </span>many<span class="_ _14"> </span>programs<span class="_ _16"> </span>need<span class="_ _16"> </span>to<span class="_ _14"> </span>access<span class="_ _16"> </span>identical<span class="_ _16"> </span>copies<span class="_ _14"> </span>of</div><div class="t m5 x17 h26 yb9f ff7 fs19 fc1 sc0 ls0 ws0">read-only<span class="_ _13"> </span>run-time<span class="_ _13"> </span>library<span class="_ _6"> </span>code.<span class="_ _13"> </span>F<span class="_ _3"></span>or<span class="_ _13"> </span>example<span class="_ _1"></span>,<span class="_ _13"> </span>every<span class="_ _13"> </span>C<span class="_ _13"> </span>program<span class="_ _13"> </span>requires<span class="_ _13"> </span>functions</div><div class="t m5 x17 h26 yba0 ff7 fs19 fc1 sc0 ls0 ws0">from<span class="_ _16"> </span>the<span class="_ _11"> </span>standard<span class="_ _16"> </span>C<span class="_ _16"> </span>library<span class="_ _16"> </span>such<span class="_ _16"> </span>as<span class="_ _16"> </span><span class="ffd">printf</span>.<span class="_ _11"> </span>It<span class="_ _16"> </span>would<span class="_ _16"> </span>be<span class="_ _16"> </span>extremely<span class="_ _16"> </span>wasteful<span class="_ _16"> </span>for</div><div class="t m5 x17 h26 yba1 ff7 fs19 fc1 sc0 ls0 ws0">each<span class="_ _11"> </span>process<span class="_ _11"> </span>to<span class="_ _11"> </span>keep<span class="_ _11"> </span>duplicate<span class="_ _11"> </span>copies<span class="_ _11"> </span>of<span class="_ _11"> </span>these<span class="_ _11"> </span>commonly<span class="_ _11"> </span>used<span class="_ _16"> </span>codes<span class="_"> </span>in<span class="_ _11"> </span>physical</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
