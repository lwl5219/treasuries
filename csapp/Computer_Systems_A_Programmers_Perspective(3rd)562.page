<div id="pf232" class="pf w2 h11" data-page-no="232"><div class="pc pc232 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg232.png"/><div class="t m5 x23b h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>5.7<span class="_ _60"> </span>Understanding<span class="_ _10"> </span>Modern<span class="_ _10"> </span>Processors<span class="_ _3e"> </span><span class="ffe fs1e">561</span></div><div class="t m5 x17 h41 ye7 ffe fs29 fc2 sc0 ls0 ws0">5.7.3<span class="_ _48"> </span><span class="fs19">An<span class="_"> </span>Abstract<span class="_"> </span>Model<span class="_"> </span>of<span class="_"> </span>Processor<span class="_"> </span>Operation</span></div><div class="t m5 x17 h26 ybbe ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_ _6"> </span>a<span class="_ _6"> </span>tool<span class="_ _6"> </span>for<span class="_ _13"> </span>analyzing<span class="_ _a"> </span>the<span class="_ _13"> </span>performance<span class="_ _a"> </span>of<span class="_ _6"> </span>a<span class="_ _13"> </span>machine-level<span class="_ _a"> </span>program<span class="_ _13"> </span>executing<span class="_ _a"> </span>on<span class="_ _6"> </span>a</div><div class="t m5 x17 h26 ybbf ff7 fs19 fc2 sc0 ls0 ws0">modern<span class="_ _13"> </span>processor,<span class="_ _13"> </span>we<span class="_ _13"> </span>will<span class="_ _13"> </span>use<span class="_ _13"> </span>a<span class="_"> </span><span class="ffa">data-ﬂo<span class="_ _1"></span>w<span class="_ _13"> </span><span class="ff7">representation<span class="_ _13"> </span>of<span class="_ _13"> </span>programs<span class="_ _0"></span>,<span class="_ _13"> </span>a<span class="_ _13"> </span>graphical</span></span></div><div class="t m5 x17 h26 ybc0 ff7 fs19 fc2 sc0 ls0 ws0">notation<span class="_ _14"> </span>showing<span class="_ _14"> </span>how<span class="_ _14"> </span>the<span class="_ _14"> </span>data<span class="_ _14"> </span>dependencies<span class="_ _14"> </span>between<span class="_ _14"> </span>the<span class="_ _14"> </span>different<span class="_ _14"> </span>operations</div><div class="t m5 x17 h26 ybc1 ff7 fs19 fc2 sc0 ls0 ws0">constrain<span class="_ _14"> </span>the<span class="_ _14"> </span>order<span class="_ _15"> </span>in<span class="_ _14"> </span>which<span class="_ _14"> </span>they<span class="_ _14"> </span>are<span class="_ _15"> </span>executed.<span class="_ _14"> </span>T<span class="_ _0"></span>hese<span class="_ _14"> </span>constraints<span class="_ _14"> </span>then<span class="_ _15"> </span>lead<span class="_ _14"> </span>to</div><div class="t m5 x17 h26 ybc2 ffa fs19 fc2 sc0 ls0 ws0">critical<span class="_ _11"> </span>paths<span class="_ _16"> </span><span class="ff7">in<span class="_ _16"> </span>the<span class="_ _11"> </span>graph,<span class="_ _16"> </span>putting<span class="_ _16"> </span>a<span class="_ _16"> </span>lower<span class="_ _11"> </span>bound<span class="_ _16"> </span>on<span class="_ _16"> </span>the<span class="_ _11"> </span>number<span class="_ _16"> </span>of<span class="_ _16"> </span>clock<span class="_ _11"> </span>cycles</span></div><div class="t m5 x17 h26 y119b ff7 fs19 fc2 sc0 ls0 ws0">required<span class="_"> </span>to<span class="_"> </span>execute<span class="_"> </span>a<span class="_"> </span>set<span class="_"> </span>of<span class="_"> </span>machine<span class="_"> </span>instructions<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y119c ff7 fs19 fc2 sc0 ls0 ws0">Before<span class="_ _11"> </span>proceeding<span class="_ _16"> </span>with<span class="_ _11"> </span>the<span class="_ _11"> </span>technical<span class="_ _11"> </span>details<span class="_ _0"></span>,<span class="_ _11"> </span>it<span class="_ _16"> </span>is<span class="_ _11"> </span>instructive<span class="_ _11"> </span>to<span class="_ _16"> </span>examine<span class="_ _11"> </span>the</div><div class="t m5 x17 h26 y216 ff7 fs19 fc2 sc0 ls0 ws0">CPE<span class="_ _16"> </span>measurements<span class="_ _11"> </span>obtained<span class="_ _16"> </span>for<span class="_ _16"> </span>function<span class="_ _16"> </span><span class="ffd">combine4</span>,<span class="_ _16"> </span>our<span class="_ _16"> </span>fastest<span class="_ _16"> </span>code<span class="_ _16"> </span>up<span class="_ _11"> </span>to<span class="_ _16"> </span>this</div><div class="t m5 x17 h26 y2364 ff7 fs19 fc2 sc0 ls0 ws0">point:</div><div class="t m5 x208 h31 y4c5a ff7 fs21 fc2 sc0 ls0 ws0">Integer<span class="_ _88"> </span>Floating<span class="_"> </span>point</div><div class="t m5 x17 h31 y4c5b ff7 fs21 fc2 sc0 ls0 ws0">Function<span class="_ _7b"> </span>Page<span class="_ _103"> </span>Method</div><div class="t m5 x7f h2d y4c5c ffd fs1e fc2 sc0 ls213 ws0">+*+*</div><div class="t m5 x17 h31 y4c5d ffd fs1e fc2 sc0 ls0 ws0">combine4<span class="_ _f1"> </span><span class="ff7 fs21">551<span class="_ _95"> </span>Accumulate<span class="_"> </span>in<span class="_"> </span>temporary<span class="_ _85"> </span>1.27<span class="_ _3a"> </span>3.01<span class="_ _3a"> </span>3.01<span class="_ _4c"> </span>5.01</span></div><div class="t m5 x17 h31 y4c5e ff7 fs21 fc2 sc0 ls0 ws0">Latency<span class="_"> </span>bound<span class="_ _1ab"> </span>1.00<span class="_ _3a"> </span>3.00<span class="_ _4c"> </span>3.00<span class="_ _3a"> </span>5.00</div><div class="t m5 x17 h31 y4c5f ff7 fs21 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>hroughput<span class="_"> </span>bound<span class="_ _1dd"> </span>0.50<span class="_ _4c"> </span>1.00<span class="_ _3a"> </span>1.00<span class="_ _3a"> </span>0.50</div><div class="t m5 x26 h26 y4c60 ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_"> </span>can<span class="_ _13"> </span>see<span class="_ _13"> </span>that<span class="_"> </span>these<span class="_ _13"> </span>measurements<span class="_"> </span>match<span class="_ _13"> </span>the<span class="_ _13"> </span>latency<span class="_"> </span>bound<span class="_ _13"> </span>for<span class="_ _13"> </span>the<span class="_"> </span>proces-</div><div class="t m5 x17 h26 y4c61 ff7 fs19 fc2 sc0 ls0 ws0">sor,<span class="_ _13"> </span>except<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>case<span class="_ _13"> </span>of<span class="_"> </span>integer<span class="_"> </span>addition.<span class="_ _13"> </span>This<span class="_ _13"> </span>is<span class="_"> </span>not<span class="_"> </span>a<span class="_"> </span>coincidence—it<span class="_ _13"> </span>indicates</div><div class="t m5 x17 h26 y4c62 ff7 fs19 fc2 sc0 ls0 ws0">that<span class="_ _21"> </span>the<span class="_ _21"> </span>performance<span class="_ _21"> </span>of<span class="_ _21"> </span>these<span class="_ _21"> </span>functions<span class="_ _21"> </span>is<span class="_ _21"> </span>dictated<span class="_ _21"> </span>by<span class="_ _21"> </span>the<span class="_ _21"> </span>latency<span class="_ _15"> </span>of<span class="_ _21"> </span>the<span class="_ _21"> </span>sum</div><div class="t m5 x17 h26 y4c63 ff7 fs19 fc2 sc0 ls0 ws0">or<span class="_ _14"> </span>product<span class="_ _14"> </span>computation<span class="_ _14"> </span>being<span class="_ _15"> </span>performed.<span class="_ _14"> </span>Computing<span class="_ _14"> </span>the<span class="_ _15"> </span>product<span class="_ _14"> </span>or<span class="_ _14"> </span>sum<span class="_ _14"> </span>of<span class="_ _15"> </span><span class="ff11">n</span></div><div class="t m5 x17 h26 y4c64 ff7 fs19 fc2 sc0 ls0 ws0">elements<span class="_ _14"> </span>requires<span class="_ _15"> </span>around<span class="_ _14"> </span><span class="ff11">L</span></div><div class="t m5 x150 h45 y4c65 ff11 fs19 fc2 sc0 ls0 ws0">.</div><div class="t m5 x1af h46 y4c64 ff11 fs19 fc2 sc0 ls0 ws0">n<span class="_ _10"> </span><span class="ff12">+<span class="_ _13"> </span></span>K<span class="_ _e"> </span><span class="ff7">clock<span class="_ _14"> </span>cycles<span class="_ _3"></span>,<span class="_ _21"> </span>where<span class="_ _14"> </span><span class="ff11">L<span class="_ _15"> </span></span>is<span class="_ _14"> </span>the<span class="_ _15"> </span>latency<span class="_ _14"> </span>of<span class="_ _14"> </span>the</span></div><div class="t m5 x17 h26 y4c66 ff7 fs19 fc2 sc0 ls0 ws0">combining<span class="_ _11"> </span>operation<span class="_ _16"> </span>and<span class="_ _11"> </span><span class="ff11">K<span class="_ _15"> </span></span>represents<span class="_ _16"> </span>the<span class="_ _11"> </span>overhead<span class="_ _16"> </span>of<span class="_ _11"> </span>calling<span class="_ _16"> </span>the<span class="_ _11"> </span>function<span class="_ _16"> </span>and</div><div class="t m5 x17 h26 y4c67 ff7 fs19 fc2 sc0 ls0 ws0">initiating<span class="_ _15"> </span>and<span class="_ _15"> </span>terminating<span class="_ _15"> </span>the<span class="_ _14"> </span>loop.<span class="_ _14"> </span>T<span class="_ _0"></span>he<span class="_ _15"> </span>CPE<span class="_ _15"> </span>is<span class="_ _15"> </span>therefore<span class="_ _14"> </span>equal<span class="_ _15"> </span>to<span class="_ _15"> </span>the<span class="_ _15"> </span>latency</div><div class="t m5 x17 h26 y4c68 ff7 fs19 fc2 sc0 ls0 ws0">bound<span class="_"> </span><span class="ff11">L</span>.</div><div class="t m5 x17 h42 y4c69 ff6 fs29 fc6 sc0 ls0 ws0">From<span class="_ _11"> </span>Machine-Level<span class="_ _16"> </span>Code<span class="_ _16"> </span>to<span class="_ _11"> </span>Data-Flow<span class="_ _16"> </span>Graphs</div><div class="t m5 x17 h26 y4c6a ff7 fs19 fc1 sc0 ls0 ws0">Our<span class="_ _21"> </span>data-ﬂow<span class="_ _f"> </span>representation<span class="_ _f"> </span>of<span class="_ _f"> </span>programs<span class="_ _f"> </span>is<span class="_ _f"> </span>informal.<span class="_ _f"> </span>W<span class="_ _1"></span>e<span class="_ _f"> </span>use<span class="_ _f"> </span>it<span class="_ _21"> </span>as<span class="_ _f"> </span>a<span class="_ _f"> </span>way<span class="_ _f"> </span>to</div><div class="t m5 x17 h26 y4c6b ff7 fs19 fc1 sc0 ls0 ws0">visualize<span class="_ _14"> </span>how<span class="_ _14"> </span>the<span class="_ _14"> </span>data<span class="_ _15"> </span>dependencies<span class="_ _14"> </span>in<span class="_ _14"> </span>a<span class="_ _15"> </span>program<span class="_ _14"> </span>dictate<span class="_ _14"> </span>its<span class="_ _14"> </span>performance.<span class="_ _16"> </span>W<span class="_ _1"></span>e</div><div class="t m5 x17 h26 y4c6c ff7 fs19 fc1 sc0 ls0 ws0">present<span class="_ _21"> </span>the<span class="_ _21"> </span>data-ﬂow<span class="_ _21"> </span>notation<span class="_ _f"> </span>by<span class="_ _21"> </span>working<span class="_ _21"> </span>with<span class="_ _f"> </span><span class="ffd">combine4<span class="_ _21"> </span></span>(Figure<span class="_ _15"> </span>5.10)<span class="_ _21"> </span>as<span class="_ _f"> </span>an</div><div class="t m5 x17 h26 y4c6d ff7 fs19 fc1 sc0 ls0 ws0">example<span class="_ _1"></span>.<span class="_ _13"> </span>W<span class="_ _3"></span>e<span class="_ _13"> </span>focus<span class="_ _13"> </span>just<span class="_ _13"> </span>on<span class="_ _13"> </span>the<span class="_ _6"> </span>computation<span class="_ _13"> </span>performed<span class="_ _13"> </span>by<span class="_ _13"> </span>the<span class="_ _13"> </span>loop<span class="_ _1"></span>,<span class="_ _13"> </span>since<span class="_ _13"> </span>this<span class="_ _13"> </span>is<span class="_ _6"> </span>the</div><div class="t m5 x17 h26 y4c6e ff7 fs19 fc1 sc0 ls0 ws0">dominating<span class="_"> </span>factor<span class="_"> </span>in<span class="_"> </span>performance<span class="_"> </span>for<span class="_"> </span>large<span class="_ _11"> </span>vectors<span class="_ _1"></span>.<span class="_"> </span>W<span class="_ _3"></span>e<span class="_ _11"> </span>consider<span class="_"> </span>the<span class="_"> </span>case<span class="_"> </span>of<span class="_"> </span>data</div><div class="t m5 x17 h26 y4c6f ff7 fs19 fc1 sc0 ls0 ws0">type<span class="_"> </span><span class="ffd">double<span class="_ _13"> </span></span>with<span class="_"> </span>multiplication<span class="_ _13"> </span>as<span class="_"> </span>the<span class="_ _13"> </span>combining<span class="_"> </span>operation.<span class="_"> </span>Other<span class="_ _13"> </span>combinations</div><div class="t m5 x17 h26 y4c70 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_ _14"> </span>data<span class="_ _16"> </span>type<span class="_ _14"> </span>and<span class="_ _14"> </span>operation<span class="_ _14"> </span>yield<span class="_ _14"> </span>similar<span class="_ _14"> </span>code<span class="_ _0"></span>.<span class="_ _14"> </span>T<span class="_ _1"></span>he<span class="_ _14"> </span>compiled<span class="_ _14"> </span>code<span class="_ _14"> </span>for<span class="_ _14"> </span>this<span class="_ _14"> </span>loop</div><div class="t m5 x17 h26 y4c71 ff7 fs19 fc1 sc0 ls0 ws0">consists<span class="_ _f"> </span>of<span class="_ _e"> </span>four<span class="_ _f"> </span>instructions<span class="_ _1"></span>,<span class="_ _e"> </span>with<span class="_ _e"> </span>registers<span class="_ _f"> </span><span class="ffd">%rdx<span class="_ _f"> </span></span>holding<span class="_ _e"> </span>a<span class="_ _f"> </span>pointer<span class="_ _f"> </span>to<span class="_ _e"> </span>the<span class="_ _f"> </span><span class="ff11">i<span class="_ _5"></span></span>th</div><div class="t m5 x17 h26 y4c72 ff7 fs19 fc1 sc0 ls0 ws0">element<span class="_"> </span>of<span class="_"> </span>array<span class="_ _11"> </span><span class="ffd">data</span>,<span class="_"> </span><span class="ffd">%rax<span class="_ _11"> </span></span>holding<span class="_"> </span>a<span class="_"> </span>pointer<span class="_"> </span>to<span class="_ _11"> </span>the<span class="_"> </span>end<span class="_"> </span>of<span class="_ _11"> </span>the<span class="_"> </span>array<span class="_ _3"></span>,<span class="_"> </span>and<span class="_ _11"> </span><span class="ffd">%xmm0</span></div><div class="t m5 x17 h26 y4c73 ff7 fs19 fc1 sc0 ls0 ws0">holding<span class="_"> </span>the<span class="_"> </span>accumulated<span class="_"> </span>value<span class="_"> </span><span class="ffd">acc</span>.</div><div class="t m5 x2e h61 y4c74 ff13 fs35 fc6 sc0 ls0 ws0">Inner<span class="_ _f"> </span>loop<span class="_ _f"> </span>of<span class="_ _f"> </span>combine4.<span class="_ _3d"> </span>data_t<span class="_ _f"> </span>=<span class="_ _e"> </span>double,<span class="_ _21"> </span>OP<span class="_ _f"> </span>=<span class="_ _e"> </span>*</div><div class="t m5 x2e h61 y4c75 ff13 fs35 fc6 sc0 ls0 ws0">acc<span class="_ _f"> </span>in<span class="_ _f"> </span>%xmm0,<span class="_ _f"> </span>data+i<span class="_ _e"> </span>in<span class="_ _21"> </span>%rdx,<span class="_ _f"> </span>data+length<span class="_ _e"> </span>in<span class="_ _21"> </span>%rax</div><div class="t m5 x2c h2e y1864 ff6 fs20 fc6 sc0 ls0 ws0">1</div><div class="t m5 x2d h2d y2fb5 ffd fs1e fc2 sc0 ls0 ws0">.L25:<span class="_ _160"> </span><span class="ff2d fs35 fc6">loop:</span></div><div class="t m5 x2c h2d y20a6 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">vmulsd<span class="_ _1a"> </span>(%rdx),<span class="_ _e"> </span>%xmm0,<span class="_ _1f"> </span>%xmm0<span class="_ _3a"> </span></span><span class="ff13 fs35">Multiply<span class="_ _f"> </span>acc<span class="_ _f"> </span>by<span class="_ _f"> </span>data[i]</span></div><div class="t m5 x2c h2d y131f ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">addq<span class="_ _46"> </span>$8,<span class="_ _e"> </span>%rdx<span class="_ _d5"> </span></span><span class="ff13 fs35">Increment<span class="_ _f"> </span>data+i</span></div><div class="t m5 x2c h2d y4af6 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">cmpq<span class="_ _46"> </span>%rax,<span class="_ _e"> </span>%rdx<span class="_ _161"> </span></span><span class="ff13 fs35">Compare<span class="_ _f"> </span>to<span class="_ _f"> </span>data+length</span></div><div class="t m5 x2c h2e y4c76 ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 xd1 h2d y1397 ffd fs1e fc2 sc0 ls0 ws0">jne<span class="_ _8c"> </span>.L25<span class="_ _136"> </span><span class="ff13 fs35 fc6">If<span class="_ _f"> </span>!=,<span class="_ _f"> </span>goto<span class="_ _f"> </span><span class="ff2d">loop</span></span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
