<div id="pf20f" class="pf w2 h11" data-page-no="20f"><div class="pc pc20f w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg20f.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">526<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>4<span class="_ _3d"> </span>Processor<span class="_ _10"> </span>Architecture</span></div><div class="t m5 x4f h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">500<span class="_ _13"> </span>ps<span class="_ _1"></span>.<span class="_ _13"> </span>Adding<span class="_ _13"> </span>more<span class="_ _13"> </span>stages<span class="_ _13"> </span>would<span class="_ _13"> </span>not<span class="_ _13"> </span>help,<span class="_ _13"> </span>since<span class="_ _13"> </span>we<span class="_ _13"> </span>cannot<span class="_ _13"> </span>run<span class="_ _13"> </span>the<span class="_ _13"> </span>pipeline</div><div class="t m5 x4f h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">any<span class="_"> </span>faster<span class="_"> </span>than<span class="_"> </span>one<span class="_"> </span>cycle<span class="_"> </span>every<span class="_"> </span>100<span class="_ _13"> </span>ps<span class="_ _3"></span>.</div><div class="t m5 x1d h28 y48ec ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>4.29<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>454)</span></div><div class="t m5 x1d h26 y48ed ff7 fs19 fc1 sc0 ls0 ws0">Each<span class="_ _15"> </span>stage<span class="_ _15"> </span>would<span class="_ _21"> </span>have<span class="_ _15"> </span>combinational<span class="_ _15"> </span>logic<span class="_ _21"> </span>requiring<span class="_ _15"> </span>300<span class="ff11 ls1b">/k<span class="_ _14"> </span></span>ps<span class="_ _15"> </span>and<span class="_ _21"> </span>a<span class="_ _15"> </span>pipeline</div><div class="t m5 x1d h26 y48ee ff7 fs19 fc1 sc0 ls0 ws0">register<span class="_"> </span>requiring<span class="_"> </span>20<span class="_"> </span>ps<span class="_ _1"></span>.</div><div class="t m5 x124 h46 y48ef ff7 fs19 fc1 sc0 ls0 ws0">A.<span class="_ _1f"> </span>T<span class="_ _1"></span>he<span class="_ _14"> </span>total<span class="_ _15"> </span>latency<span class="_ _16"> </span>would<span class="_ _14"> </span>be<span class="_ _15"> </span>300<span class="_"> </span><span class="ff12">+<span class="_ _13"> </span></span>20<span class="ff11">k<span class="_ _21"> </span></span>ps<span class="_ _1"></span>,<span class="_ _15"> </span>while<span class="_ _15"> </span>the<span class="_ _14"> </span>throughput<span class="_ _14"> </span>(in<span class="_ _14"> </span>GIPS)</div><div class="t m5 x4f h26 y48f0 ff7 fs19 fc1 sc0 ls0 ws0">would<span class="_"> </span>be</div><div class="t m5 xfc h26 y48f1 ff7 fs19 fc1 sc0 ls0 ws0">1<span class="_ _1"></span><span class="ff11">,<span class="ff7">000</span></span></div><div class="t m5 x198 h3c y48f2 ff7 fs25 fc1 sc0 ls0 ws0">300</div><div class="t m5 x119 h50 y48f3 ff11 fs25 fc1 sc0 ls0 ws0">k</div><div class="t m5 xd2 h46 y48f4 ff12 fs19 fc1 sc0 ls0 ws0">+<span class="_ _13"> </span><span class="ff7">20</span></div><div class="t m5 x82 h46 y48f5 ff12 fs19 fc1 sc0 ls0 ws0">=</div><div class="t m5 xfe h26 y48f6 ff7 fs19 fc1 sc0 ls0 ws0">1<span class="_ _1"></span><span class="ff11">,<span class="ff7">000</span>k</span></div><div class="t m5 xc0 h46 y48f7 ff7 fs19 fc1 sc0 ls0 ws0">300<span class="_"> </span><span class="ff12">+<span class="_ _13"></span></span>20<span class="ff11">k</span></div><div class="t m5 x124 h46 y48f8 ff7 fs19 fc1 sc0 ls0 ws0">B<span class="_ _3"></span>.<span class="_ _1d"> </span>As<span class="_ _11"> </span>we<span class="_ _11"> </span>let<span class="_ _16"> </span><span class="ff11">k<span class="_"> </span></span>go<span class="_"> </span>to<span class="_ _11"> </span>inﬁnity<span class="_ _3"></span>,<span class="_ _11"> </span>the<span class="_ _11"> </span>throughput<span class="_ _11"> </span>becomes<span class="_ _16"> </span>1<span class="_ _1"></span><span class="ff11">,<span class="ff7">000</span>/<span class="ff7">20<span class="_"> </span><span class="ff12">=<span class="_ _13"></span></span>50<span class="_ _11"> </span>GIPS<span class="_ _1"></span>.<span class="_ _11"> </span>Of</span></span></div><div class="t m5 x4f h26 y48f9 ff7 fs19 fc1 sc0 ls0 ws0">course<span class="_ _1"></span>,<span class="_"> </span>the<span class="_"> </span>latency<span class="_"> </span>would<span class="_"> </span>approach<span class="_"> </span>inﬁnity<span class="_"> </span>as<span class="_"> </span>well.</div><div class="t m5 x1d h26 y48fa ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _16"> </span>exercise<span class="_ _11"> </span>quantiﬁes<span class="_ _16"> </span>the<span class="_ _11"> </span>diminishing<span class="_ _16"> </span>returns<span class="_ _11"> </span>of<span class="_ _16"> </span>deep<span class="_ _11"> </span>pipelining.<span class="_ _11"> </span>As<span class="_ _16"> </span>we<span class="_ _11"> </span>try<span class="_ _16"> </span>to</div><div class="t m5 x1d h26 y48fb ff7 fs19 fc1 sc0 ls0 ws0">subdivide<span class="_ _13"> </span>the<span class="_"> </span>logic<span class="_ _13"> </span>into<span class="_ _13"> </span>many<span class="_ _13"> </span>stages<span class="_ _1"></span>,<span class="_"> </span>the<span class="_ _13"> </span>latency<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>pipeline<span class="_"> </span>registers<span class="_ _13"> </span>becomes</div><div class="t m5 x1d h26 y48fc ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_"> </span>limiting<span class="_"> </span>factor.</div><div class="t m5 x1d h28 y48fd ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>4.30<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>485)</span></div><div class="t m5 x1d h26 y48fe ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _13"> </span>code<span class="_ _6"> </span>is<span class="_ _13"> </span>very<span class="_ _6"> </span>similar<span class="_ _13"> </span>to<span class="_ _6"> </span>the<span class="_ _13"> </span>corresponding<span class="_ _6"> </span>code<span class="_ _13"> </span>for<span class="_ _6"> </span>SEQ,<span class="_ _13"> </span>except<span class="_ _13"> </span>that<span class="_ _6"> </span>we<span class="_ _13"> </span>cannot</div><div class="t m5 x1d h26 y48ff ff7 fs19 fc1 sc0 ls0 ws0">yet<span class="_ _15"> </span>determine<span class="_ _15"> </span>whether<span class="_ _21"> </span>the<span class="_ _15"> </span>data<span class="_ _21"> </span>memory<span class="_ _15"> </span>will<span class="_ _21"> </span>generate<span class="_ _15"> </span>an<span class="_ _21"> </span>error<span class="_ _15"> </span>signal<span class="_ _21"> </span>for<span class="_ _15"> </span>this</div><div class="t m5 x1d h26 y4900 ff7 fs19 fc1 sc0 ls0 ws0">instruction.</div><div class="t m5 x1d h2d y4901 ffd fs1e fc2 sc0 ls0 ws0">#<span class="_ _e"> </span>Determine<span class="_ _1f"> </span>status<span class="_ _1f"> </span>code<span class="_ _e"> </span>for<span class="_ _1f"> </span>fetched<span class="_ _e"> </span>instruction</div><div class="t m5 x1d h2d y4902 ffd fs1e fc2 sc0 ls0 ws0">word<span class="_ _e"> </span>f_stat<span class="_ _1f"> </span>=<span class="_ _1f"> </span>[</div><div class="t m5 x22b h2d y4903 ffd fs1e fc2 sc0 ls0 ws0">imem_error:<span class="_ _e"> </span>SADR;</div><div class="t m5 x22b h2d y4904 ffd fs1e fc2 sc0 ls0 ws0">!instr_valid<span class="_ _e"> </span>:<span class="_ _1f"> </span>SINS;</div><div class="t m5 x22b h2d y4905 ffd fs1e fc2 sc0 ls0 ws0">f_icode<span class="_ _e"> </span>==<span class="_ _1f"> </span>IHALT<span class="_ _1f"> </span>:<span class="_ _e"> </span>SHLT;</div><div class="t m5 x22b h2d y4906 ffd fs1e fc2 sc0 ls0 ws0">1<span class="_ _e"> </span>:<span class="_ _1f"> </span>SAOK;</div><div class="t m5 x1d h2d y4907 ffd fs1e fc2 sc0 ls0 ws0">];</div><div class="t m5 x1d h28 y4908 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>4.31</div><div class="t m5 xe1 h2f y4909 ffe fs16 fc6 sc0 ls0 ws0">(page<span class="_"> </span>485)</div><div class="t m5 x1d h26 y490a ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>code<span class="_"> </span>simply<span class="_"> </span>involves<span class="_"> </span>preﬁxing<span class="_"> </span>the<span class="_ _13"> </span>signal<span class="_"> </span>names<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>code<span class="_"> </span>for<span class="_ _13"> </span>SEQ<span class="_"> </span>with<span class="_"> </span><span class="ffd">d_</span></div><div class="t m5 x1d h26 y490b ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_"> </span><span class="ffd">D_</span>.</div><div class="t m5 x1d h2d y490c ffd fs1e fc2 sc0 ls0 ws0">word<span class="_ _e"> </span>d_dstE<span class="_ _1f"> </span>=<span class="_ _1f"> </span>[</div><div class="t m5 x22b h2d y490d ffd fs1e fc2 sc0 ls0 ws0">D_icode<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _1f"> </span>IRRMOVQ,<span class="_ _e"> </span>IIRMOVQ,<span class="_ _1f"> </span>IOPQ}<span class="_ _e"> </span>:<span class="_ _1f"> </span>D_rB;</div><div class="t m5 x22b h2d y490e ffd fs1e fc2 sc0 ls0 ws0">D_icode<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _1f"> </span>IPUSHQ,<span class="_ _e"> </span>IPOPQ,<span class="_ _1f"> </span>ICALL,<span class="_ _e"> </span>IRET<span class="_ _1f"> </span>}<span class="_ _1f"> </span>:<span class="_ _e"> </span>RRSP;</div><div class="t m5 x22b h2d y490f ffd fs1e fc2 sc0 ls0 ws0">1<span class="_ _e"> </span>:<span class="_ _1f"> </span>RNONE;<span class="_ _1a"> </span>#<span class="_ _1f"> </span>Don’t<span class="_ _e"> </span>write<span class="_ _1f"> </span>any<span class="_ _e"> </span>register</div><div class="t m5 x1d h2d y4910 ffd fs1e fc2 sc0 ls0 ws0">];</div><div class="t m5 x1d h28 y4911 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>4.32</div><div class="t m5 xe1 h2f y4912 ffe fs16 fc6 sc0 ls0 ws0">(page<span class="_"> </span>488)</div><div class="t m5 x1d h26 y2fb5 ff7 fs19 fc1 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _11"> </span><span class="ffd ls0">rrmovq<span class="_ _10"> </span><span class="ff7">instruction<span class="_"> </span>(line<span class="_"> </span>5)<span class="_ _13"> </span>would<span class="_"> </span>stall<span class="_"> </span>for<span class="_"> </span>one<span class="_"> </span>c<span class="_ _1"></span>ycle<span class="_"> </span>due<span class="_"> </span>to<span class="_"> </span>a<span class="_"> </span>load/use<span class="_ _13"> </span>hazard</span></span></div><div class="t m5 x1d h26 y4913 ff7 fs19 fc1 sc0 ls0 ws0">caused<span class="_ _16"> </span>by<span class="_ _16"> </span>the<span class="_ _14"> </span><span class="ffd">popq<span class="_ _16"> </span></span>instruction<span class="_ _16"> </span>(line<span class="_ _14"> </span>4).<span class="_ _16"> </span>As<span class="_ _16"> </span>it<span class="_ _14"> </span>enters<span class="_ _16"> </span>the<span class="_ _16"> </span>decode<span class="_ _14"> </span>stage<span class="_ _1"></span>,<span class="_ _14"> </span>the<span class="_ _14"> </span><span class="ffd">popq</span></div><div class="t m5 x1d h26 y4914 ff7 fs19 fc1 sc0 ls0 ws0">instruction<span class="_ _13"> </span>would<span class="_"> </span>be<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_"> </span>memory<span class="_ _13"> </span>stage<span class="_ _1"></span>,<span class="_"> </span>giving<span class="_ _13"> </span>both<span class="_ _13"> </span><span class="ff6">M_dstE<span class="_ _10"> </span></span>and<span class="_ _13"> </span><span class="ff6">M_dstM<span class="_ _13"> </span></span>equal</div><div class="t m5 x1d h26 y4915 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _11"> </span><span class="ffd">%rsp</span>.<span class="_ _11"> </span>If<span class="_ _11"> </span>the<span class="_ _16"> </span>two<span class="_ _11"> </span>cases<span class="_ _11"> </span>were<span class="_ _11"> </span>reversed,<span class="_ _16"> </span>then<span class="_ _11"> </span>the<span class="_ _11"> </span>write<span class="_ _11"> </span>back<span class="_ _11"> </span>from<span class="_ _16"> </span><span class="ff6">M_valE<span class="_ _11"> </span></span>would</div><div class="t m5 x1d h26 y4916 ff7 fs19 fc1 sc0 ls0 ws0">take<span class="_"> </span>priority<span class="_ _7"></span>,<span class="_"> </span>causing<span class="_ _13"> </span>the<span class="_"> </span>incremented<span class="_"> </span>stack<span class="_ _13"> </span>pointer<span class="_"> </span>to<span class="_ _13"> </span>be<span class="_"> </span>passed<span class="_ _13"> </span>as<span class="_"> </span>the<span class="_"> </span>argument</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
