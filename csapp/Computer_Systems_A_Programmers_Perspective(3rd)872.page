<div id="pf368" class="pf w2 h11" data-page-no="368"><div class="pc pc368 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg368.png"/><div class="t m5 xa9 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>9.8<span class="_ _60"> </span>Memor<span class="_ _2"></span>y<span class="_ _10"> </span>Mapping<span class="_ _1b"> </span><span class="ffe fs1e">871</span></div><div class="t m5 x17 h2f ye7 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>9.30</div><div class="t m5 x17 h2f y58a ffe fs16 fc1 sc0 ls0 ws0">A<span class="_ _11"> </span>private<span class="_ _16"> </span>copy-on-write</div><div class="t m5 x17 h34 y58b ffe fs16 fc1 sc0 ls0 ws0">object.<span class="_ _14"> </span><span class="ff6">(a)<span class="_ _14"> </span>After<span class="_ _14"> </span>both</span></div><div class="t m5 x17 h34 y58c ff6 fs16 fc1 sc0 ls0 ws0">processes<span class="_ _16"> </span>have<span class="_ _16"> </span>mapped</div><div class="t m5 x17 h34 y58d ff6 fs16 fc1 sc0 ls0 ws0">the<span class="_ _11"> </span>private<span class="_ _11"> </span>copy-on-write</div><div class="t m5 x17 h34 y58e ff6 fs16 fc1 sc0 ls0 ws0">object.<span class="_ _16"> </span>(b)<span class="_ _16"> </span>After<span class="_ _16"> </span>process</div><div class="t m5 x17 h34 y58f ff6 fs16 fc1 sc0 ls0 ws0">2<span class="_ _11"> </span>writes<span class="_ _16"> </span>to<span class="_ _16"> </span>a<span class="_ _11"> </span>page<span class="_ _16"> </span>in<span class="_ _11"> </span>the</div><div class="t m5 x17 h34 y8d9 ff6 fs16 fc1 sc0 ls0 ws0">private<span class="_ _10"> </span>area.</div><div class="t m5 xb7 h84 y7113 ffbf fs49 fc1 sc0 ls0 ws0">Process 1</div><div class="t m5 xb3 h84 y7114 ffbf fs49 fc1 sc0 ls0 ws0">virtual memory</div><div class="t m5 x1a3 h84 y7113 ffbf fs49 fc1 sc0 ls0 ws0">Process 2</div><div class="t m5 x1fb h84 y7114 ffbf fs49 fc1 sc0 ls0 ws0">virtual memory</div><div class="t m5 x151 h84 y7113 ffbf fs49 fc1 sc0 ls0 ws0">Physical</div><div class="t m5 x1b3 h84 y7114 ffbf fs49 fc1 sc0 ls0 ws0">memory</div><div class="t m5 x187 h84 y7115 ffbf fs49 fc1 sc0 ls0 ws0">Private</div><div class="t m5 x186 h84 y7116 ffbf fs49 fc1 sc0 ls0 ws0">copy-on-write object</div><div class="t m5 xfd h84 y7117 ffbf fs49 fc1 sc0 ls0 ws0">(a)</div><div class="t m5 xb7 h84 y7118 ffbf fs49 fc1 sc0 ls0 ws0">Process 1</div><div class="t m5 xb3 h84 y7119 ffbf fs49 fc1 sc0 ls0 ws0">virtual memory</div><div class="t m5 x1a3 h84 y7118 ffbf fs49 fc1 sc0 ls0 ws0">Process 2</div><div class="t m5 x1fb h84 y7119 ffbf fs49 fc1 sc0 ls0 ws0">virtual memory</div><div class="t m5 x151 h84 y7118 ffbf fs49 fc1 sc0 ls0 ws0">Physical</div><div class="t m5 x1b3 h84 y7119 ffbf fs49 fc1 sc0 ls0 ws0">memory</div><div class="t m5 x187 h84 y711a ffbf fs49 fc1 sc0 ls0 ws0">Private</div><div class="t m5 x186 h84 y711b ffbf fs49 fc1 sc0 ls0 ws0">copy-on-write object</div><div class="t m5 xfd h84 y711c ffbf fs49 fc1 sc0 ls0 ws0">(b)</div><div class="t m5 x250 hcf y711d ffbf fs83 fc1 sc0 ls0 ws0">Copy-on-write</div><div class="t m5 x1dd h84 y711e ffbf fs49 fc1 sc0 ls0 ws0">Write to private</div><div class="t m5 x166 h84 y711f ffbf fs49 fc1 sc0 ls0 ws0">copy-on-write</div><div class="t m5 x13e h84 y7120 ffbf fs49 fc1 sc0 ls0 ws0">page</div><div class="t m5 x17 h26 y450f ff7 fs19 fc1 sc0 ls0 ws0">ject<span class="_ _13"> </span>into<span class="_ _6"> </span>its<span class="_ _13"> </span>address<span class="_ _6"> </span>space<span class="_ _13"> </span>(not<span class="_ _6"> </span>necessarily<span class="_ _13"> </span>at<span class="_ _6"> </span>the<span class="_ _13"> </span>same<span class="_ _13"> </span>virtual<span class="_ _6"> </span>address<span class="_ _13"> </span>as<span class="_ _6"> </span>process<span class="_ _13"> </span>1),</div><div class="t m5 x17 h26 y4510 ff7 fs19 fc1 sc0 ls0 ws0">as<span class="_"> </span>shown<span class="_"> </span>in<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>9.29(b).</div><div class="t m5 x26 h26 y4511 ff7 fs19 fc1 sc0 ls0 ws0">Since<span class="_ _14"> </span>each<span class="_ _14"> </span>object<span class="_ _14"> </span>has<span class="_ _14"> </span>a<span class="_ _14"> </span>unique<span class="_ _14"> </span>Ô¨Ålename<span class="_ _0"></span>,<span class="_ _14"> </span>the<span class="_ _15"> </span>kernel<span class="_ _14"> </span>can<span class="_ _14"> </span>quickly<span class="_ _14"> </span>determine</div><div class="t m5 x17 h26 y4512 ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_ _13"> </span>process<span class="_"> </span>1<span class="_ _13"> </span>has<span class="_ _13"> </span>already<span class="_"> </span>mapped<span class="_ _13"> </span>this<span class="_ _13"> </span>object<span class="_ _13"> </span>and<span class="_"> </span>can<span class="_ _13"> </span>point<span class="_ _13"> </span>the<span class="_"> </span>page<span class="_ _13"> </span>table<span class="_ _13"> </span>entries</div><div class="t m5 x17 h26 y4513 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_"> </span>process<span class="_"> </span>2<span class="_ _11"> </span>to<span class="_"> </span>the<span class="_ _11"> </span>appropriate<span class="_"> </span>physical<span class="_"> </span>pages<span class="_ _0"></span>.<span class="_"> </span>T<span class="_ _0"></span>he<span class="_"> </span>key<span class="_"> </span>point<span class="_ _11"> </span>is<span class="_"> </span>that<span class="_ _11"> </span>only<span class="_"> </span>a<span class="_"> </span>single</div><div class="t m5 x17 h26 y4514 ff7 fs19 fc1 sc0 ls0 ws0">copy<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>shared<span class="_"> </span>object<span class="_ _13"> </span>needs<span class="_"> </span>to<span class="_ _13"> </span>be<span class="_"> </span>stored<span class="_ _13"> </span>in<span class="_"> </span>physical<span class="_ _13"> </span>memory<span class="_ _3"></span>,<span class="_"> </span>even<span class="_ _13"> </span>though<span class="_ _13"> </span>the</div><div class="t m5 x17 h26 y4515 ff7 fs19 fc1 sc0 ls0 ws0">object<span class="_"> </span>is<span class="_ _13"> </span>mapped<span class="_"> </span>into<span class="_ _13"> </span>multiple<span class="_"> </span>shared<span class="_ _13"> </span>areas<span class="_ _1"></span>.<span class="_"> </span>F<span class="_ _3"></span>or<span class="_"> </span>convenience<span class="_ _1"></span>,<span class="_"> </span>we<span class="_ _13"> </span>have<span class="_"> </span>shown<span class="_ _13"> </span>the</div><div class="t m5 x17 h26 y4516 ff7 fs19 fc1 sc0 ls0 ws0">physical<span class="_"> </span>pages<span class="_"> </span>as<span class="_"> </span>being<span class="_"> </span>contiguous<span class="_ _1"></span>,<span class="_"> </span>but<span class="_"> </span>of<span class="_"> </span>course<span class="_"> </span>this<span class="_"> </span>is<span class="_"> </span>not<span class="_"> </span>true<span class="_"> </span>in<span class="_"> </span>general.</div><div class="t m5 x26 h26 y4517 ff7 fs19 fc1 sc0 ls0 ws0">Private<span class="_ _21"> </span>objects<span class="_ _21"> </span>are<span class="_ _f"> </span>mapped<span class="_ _21"> </span>into<span class="_ _f"> </span>virtual<span class="_ _21"> </span>memory<span class="_ _f"> </span>using<span class="_ _21"> </span>a<span class="_ _21"> </span>clever<span class="_ _f"> </span>technique</div><div class="t m5 x17 h26 y4518 ff7 fs19 fc1 sc0 ls0 ws0">known<span class="_"> </span>as<span class="_"> </span><span class="ffa">cop<span class="_ _0"></span>y-on-write<span class="ff7">.<span class="_"> </span>A<span class="_"> </span>private<span class="_"> </span>object<span class="_"> </span>begins<span class="_"> </span>life<span class="_"> </span>in<span class="_ _13"> </span>exactly<span class="_"> </span>the<span class="_"> </span>same<span class="_"> </span>way<span class="_"> </span>as<span class="_"> </span>a</span></span></div><div class="t m5 x17 h26 y4519 ff7 fs19 fc1 sc0 ls0 ws0">shared<span class="_ _13"> </span>object,<span class="_"> </span>with<span class="_ _13"> </span>only<span class="_ _13"> </span>one<span class="_ _13"> </span>copy<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>private<span class="_"> </span>object<span class="_ _13"> </span>stored<span class="_ _13"> </span>in<span class="_ _13"> </span>physical<span class="_ _13"> </span>memory<span class="_ _3"></span>.</div><div class="t m5 x17 h26 y451a ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _14"> </span>example<span class="_ _0"></span>,<span class="_ _15"> </span>F<span class="_ _1"></span>igure<span class="_ _14"> </span>9.30(a)<span class="_ _14"> </span>shows<span class="_ _15"> </span>a<span class="_ _14"> </span>case<span class="_ _14"> </span>where<span class="_ _14"> </span>two<span class="_ _14"> </span>processes<span class="_ _14"> </span>have<span class="_ _14"> </span>mapped<span class="_ _14"> </span>a</div><div class="t m5 x17 h26 y451b ff7 fs19 fc1 sc0 ls0 ws0">private<span class="_ _16"> </span>object<span class="_ _16"> </span>into<span class="_ _16"> </span>different<span class="_ _16"> </span>areas<span class="_ _14"> </span>of<span class="_ _16"> </span>their<span class="_ _16"> </span>virtual<span class="_ _16"> </span>memories<span class="_ _16"> </span>but<span class="_ _14"> </span>share<span class="_ _16"> </span>the<span class="_ _16"> </span>same</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
