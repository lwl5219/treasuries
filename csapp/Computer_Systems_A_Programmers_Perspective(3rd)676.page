<div id="pf2a4" class="pf w2 h11" data-page-no="2a4"><div class="pc pc2a4 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg2a4.png"/><div class="t m5 x1c4 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>6.6<span class="_ _60"> </span>Putting<span class="_ _10"> </span>It<span class="_ _10"> </span>T<span class="_ _1"></span>ogether:<span class="_ _10"> </span>The<span class="_ _10"> </span>Impact<span class="_ _10"> </span>of<span class="_ _10"> </span>Caches<span class="_ _10"> </span>on<span class="_ _10"> </span>Program<span class="_ _10"> </span>Performance<span class="_ _3e"> </span><span class="ffe fs1e">675</span></div><div class="t m5 x34 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">A.<span class="_ _1f"> </span>What<span class="_"> </span>is<span class="_"> </span>the<span class="_"> </span>total<span class="_"> </span>number<span class="_"> </span>of<span class="_"> </span>reads?</div><div class="t m5 x34 h26 y10aa ff7 fs19 fc2 sc0 ls0 ws0">B<span class="_ _3"></span>.<span class="_ _1d"> </span>What<span class="_"> </span>is<span class="_"> </span>the<span class="_"> </span>total<span class="_"> </span>number<span class="_"> </span>of<span class="_"> </span>reads<span class="_"> </span>that<span class="_"> </span>hit<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>cache?</div><div class="t m5 x34 h26 ybbf ff7 fs19 fc2 sc0 ls0 ws0">C.<span class="_ _25"> </span>What<span class="_"> </span>is<span class="_"> </span>the<span class="_"> </span>hit<span class="_"> </span>rate?</div><div class="t m5 x34 h26 y2f8 ff7 fs19 fc2 sc0 ls0 ws0">D<span class="_ _3"></span>.<span class="_ _23"> </span>What<span class="_"> </span>would<span class="_"> </span>the<span class="_"> </span>hit<span class="_"> </span>rate<span class="_"> </span>be<span class="_"> </span>if<span class="_"> </span>the<span class="_"> </span>cache<span class="_"> </span>were<span class="_"> </span>twice<span class="_"> </span>as<span class="_"> </span>big?</div><div class="t m5 x17 h3b y59d1 fff fs24 fc6 sc0 ls0 ws0">6.6<span class="_ _17"> </span><span class="ffe fs18">Putting<span class="_"> </span>It<span class="_"> </span>T<span class="_ _1"></span>ogether:<span class="_"> </span>The<span class="_"> </span>Impact<span class="_"> </span>of<span class="_"> </span>Caches</span></div><div class="t m5 x77 h3e y59d2 ffe fs18 fc6 sc0 ls0 ws0">on<span class="_"> </span>Program<span class="_"> </span>Performance</div><div class="t m5 x17 h26 y59d3 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>section<span class="_ _13"> </span>wraps<span class="_ _13"> </span>up<span class="_ _13"> </span>our<span class="_"> </span>discussion<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>memory<span class="_"> </span>hierarchy<span class="_ _13"> </span>by<span class="_ _13"> </span>studying<span class="_"> </span>the<span class="_ _13"> </span>im-</div><div class="t m5 x17 h26 y59d4 ff7 fs19 fc1 sc0 ls0 ws0">pact<span class="_"> </span>that<span class="_"> </span>caches<span class="_ _13"> </span>have<span class="_"> </span>on<span class="_"> </span>the<span class="_"> </span>performance<span class="_"> </span>of<span class="_ _13"> </span>programs<span class="_"> </span>running<span class="_"> </span>on<span class="_"> </span>real<span class="_"> </span>machines<span class="_ _3"></span>.</div><div class="t m5 x17 h41 y59d5 ffe fs29 fc1 sc0 ls0 ws0">6.6.1<span class="_ _48"> </span><span class="fs19">The<span class="_"> </span>Memory<span class="_"> </span>Mountain</span></div><div class="t m5 x17 h26 y59d6 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _14"> </span>rate<span class="_ _14"> </span>that<span class="_ _16"> </span>a<span class="_ _14"> </span>program<span class="_ _16"> </span>reads<span class="_ _14"> </span>data<span class="_ _14"> </span>from<span class="_ _16"> </span>the<span class="_ _14"> </span>memory<span class="_ _14"> </span>system<span class="_ _16"> </span>is<span class="_ _14"> </span>called<span class="_ _14"> </span>the<span class="_ _16"> </span><span class="ffa">read</span></div><div class="t m5 x17 h26 y59d7 ffa fs19 fc1 sc0 ls0 ws0">throughput<span class="_ _2"></span><span class="ff7">,<span class="_ _11"> </span>or<span class="_ _11"> </span>sometimes<span class="_ _11"> </span>the<span class="_ _11"> </span></span>read<span class="_"> </span>bandwidth<span class="ff7">.<span class="_ _11"> </span>If<span class="_ _11"> </span>a<span class="_"> </span>program<span class="_ _11"> </span>reads<span class="_ _11"> </span><span class="ff11">n<span class="_ _11"> </span></span>bytes<span class="_ _11"> </span>over<span class="_ _11"> </span>a</span></div><div class="t m5 x17 h26 y59d8 ff7 fs19 fc1 sc0 ls0 ws0">period<span class="_ _16"> </span>of<span class="_ _14"> </span><span class="ff11">s<span class="_ _15"> </span></span>seconds<span class="_ _1"></span>,<span class="_ _14"> </span>then<span class="_ _14"> </span>the<span class="_ _16"> </span>read<span class="_ _14"> </span>throughput<span class="_ _16"> </span>over<span class="_ _14"> </span>that<span class="_ _16"> </span>period<span class="_ _14"> </span>is<span class="_ _16"> </span><span class="ff11">n/s<span class="_ _5"></span></span>,<span class="_ _14"> </span>typically</div><div class="t m5 x17 h26 y59d9 ff7 fs19 fc1 sc0 ls0 ws0">expressed<span class="_"> </span>in<span class="_"> </span>units<span class="_"> </span>of<span class="_"> </span>megabytes<span class="_"> </span>per<span class="_"> </span>second<span class="_"> </span>(MB/s).</div><div class="t m5 x26 h26 y59da ff7 fs19 fc1 sc0 ls0 ws0">If<span class="_ _11"> </span>we<span class="_ _16"> </span>were<span class="_ _11"> </span>to<span class="_ _16"> </span>write<span class="_ _16"> </span>a<span class="_ _11"> </span>program<span class="_ _16"> </span>that<span class="_ _11"> </span>issued<span class="_ _16"> </span>a<span class="_ _11"> </span>sequence<span class="_ _16"> </span>of<span class="_ _11"> </span>read<span class="_ _16"> </span>requests<span class="_ _11"> </span>from</div><div class="t m5 x17 h26 y59db ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_ _14"> </span>tight<span class="_ _15"> </span>program<span class="_ _14"> </span>loop,<span class="_ _14"> </span>then<span class="_ _15"> </span>the<span class="_ _15"> </span>measured<span class="_ _14"> </span>read<span class="_ _15"> </span>throughput<span class="_ _14"> </span>would<span class="_ _15"> </span>give<span class="_ _14"> </span>us<span class="_ _15"> </span>some</div><div class="t m5 x17 h26 y59dc ff7 fs19 fc1 sc0 ls0 ws0">insight<span class="_ _11"> </span>into<span class="_ _16"> </span>the<span class="_ _11"> </span>performance<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span>memory<span class="_ _11"> </span>system<span class="_ _16"> </span>for<span class="_ _11"> </span>that<span class="_ _11"> </span>particular<span class="_ _16"> </span>sequence</div><div class="t m5 x17 h26 y59dd ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span>reads<span class="_ _1"></span>.<span class="_ _11"> </span>Figure<span class="_"> </span>6.40<span class="_"> </span>shows<span class="_ _11"> </span>a<span class="_ _11"> </span>pair<span class="_"> </span>of<span class="_ _11"> </span>functions<span class="_ _11"> </span>that<span class="_"> </span>measure<span class="_ _11"> </span>the<span class="_ _11"> </span>read<span class="_ _11"> </span>throughput</div><div class="t m5 x17 h26 y59de ff7 fs19 fc1 sc0 ls0 ws0">for<span class="_"> </span>a<span class="_"> </span>particular<span class="_"> </span>read<span class="_"> </span>sequence<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y59df ff7 fs19 fc1 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _14"> </span><span class="ffd ls0">test<span class="_ _14"> </span><span class="ff7">function<span class="_ _16"> </span>generates<span class="_ _14"> </span>the<span class="_ _16"> </span>read<span class="_ _16"> </span>sequence<span class="_ _14"> </span>by<span class="_ _16"> </span>scanning<span class="_ _16"> </span>the<span class="_ _14"> </span>ﬁrst<span class="_ _16"> </span></span>elems</span></div><div class="t m5 x17 h26 y59e0 ff7 fs19 fc1 sc0 ls0 ws0">elements<span class="_ _13"> </span>of<span class="_"> </span>an<span class="_ _13"> </span>array<span class="_ _13"> </span>with<span class="_"> </span>a<span class="_ _13"> </span>stride<span class="_ _13"> </span>of<span class="_"> </span><span class="ffd">stride</span>.<span class="_ _13"> </span>T<span class="_ _3"></span>o<span class="_ _13"> </span>increase<span class="_"> </span>the<span class="_ _13"> </span>available<span class="_ _13"> </span>parallelism</div><div class="t m5 x17 h46 y59e1 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_ _6"> </span>the<span class="_ _6"> </span>inner<span class="_ _13"> </span>loop<span class="_ _1"></span>,<span class="_ _6"> </span>it<span class="_ _13"> </span>uses<span class="_ _a"> </span>4<span class="_ _13"> </span><span class="ff12">×<span class="_ _13"></span></span>4<span class="_ _13"> </span>unrolling<span class="_ _a"> </span>(Section<span class="_ _6"> </span>5.9).<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_ _6"> </span><span class="ffd">run<span class="_ _6"> </span></span>function<span class="_ _13"> </span>is<span class="_ _a"> </span>a<span class="_ _13"> </span>wrapper</div><div class="t m5 x17 h26 y59e2 ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_ _11"> </span>calls<span class="_ _16"> </span>the<span class="_ _11"> </span><span class="ffd">test<span class="_ _11"> </span></span>function<span class="_ _16"> </span>and<span class="_ _11"> </span>returns<span class="_ _11"> </span>the<span class="_ _16"> </span>measured<span class="_ _11"> </span>read<span class="_ _11"> </span>throughput.<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span>call</div><div class="t m5 x17 h26 y59e3 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ffd">test<span class="_ _13"> </span></span>function<span class="_ _13"> </span>in<span class="_ _13"> </span>line<span class="_ _13"> </span>37<span class="_ _13"> </span>warms<span class="_ _13"> </span>the<span class="_ _13"> </span>cache.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span><span class="ffd">fcyc2<span class="_ _13"> </span></span>function<span class="_ _13"> </span>in<span class="_ _13"> </span>line<span class="_ _13"> </span>38<span class="_ _13"> </span>calls</div><div class="t m5 x17 h26 y59e4 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _16"> </span><span class="ffd">test<span class="_ _14"> </span></span>function<span class="_ _16"> </span>with<span class="_ _14"> </span>arguments<span class="_ _16"> </span><span class="ffd">elems<span class="_ _14"> </span></span>and<span class="_ _16"> </span>estimates<span class="_ _14"> </span>the<span class="_ _16"> </span>running<span class="_ _14"> </span>time<span class="_ _16"> </span>of<span class="_ _14"> </span>the</div><div class="t m5 x17 h26 y59e5 ffd fs19 fc1 sc0 ls0 ws0">test<span class="_ _13"> </span><span class="ff7">function<span class="_ _13"> </span>in<span class="_"> </span>CPU<span class="_ _13"> </span>cycles<span class="_ _3"></span>.<span class="_ _13"> </span>Notice<span class="_"> </span>that<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ffd">size<span class="_ _13"> </span></span>argument<span class="_"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ffd">run<span class="_ _13"> </span></span>function<span class="_ _13"> </span>is</span></div><div class="t m5 x17 h26 y59e6 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_"> </span>units<span class="_"> </span>of<span class="_ _13"> </span>bytes<span class="_ _1"></span>,<span class="_"> </span>while<span class="_"> </span>the<span class="_"> </span>corresponding<span class="_ _13"> </span><span class="ffd">elems<span class="_ _10"> </span></span>argument<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span><span class="ffd">test<span class="_ _13"> </span></span>function<span class="_"> </span>is</div><div class="t m5 x17 h26 y59e7 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_"> </span>units<span class="_"> </span>of<span class="_"> </span>array<span class="_ _13"> </span>elements<span class="_ _1"></span>.<span class="_"> </span>Also,<span class="_ _13"> </span>notice<span class="_"> </span>that<span class="_"> </span>line<span class="_"> </span>39<span class="_"> </span>computes<span class="_"> </span>MB/s<span class="_"> </span>as<span class="_ _13"> </span>10</div><div class="t m5 xb5 h3c y59e8 ff7 fs25 fc1 sc0 ls0 ws0">6</div><div class="t m5 x1e1 h26 y59e9 ff7 fs19 fc1 sc0 ls0 ws0">bytes/s<span class="_ _1"></span>,</div><div class="t m5 x17 h26 y59ea ff7 fs19 fc1 sc0 ls0 ws0">as<span class="_"> </span>opposed<span class="_"> </span>to<span class="_"> </span>2</div><div class="t m5 x17e h3c y59eb ff7 fs25 fc1 sc0 ls0 ws0">20</div><div class="t m5 x178 h26 y2455 ff7 fs19 fc1 sc0 ls0 ws0">bytes/s<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y2456 ff7 fs19 fc1 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _16"> </span><span class="ffd ls0">size<span class="_ _16"> </span><span class="ff7">and<span class="_ _11"> </span></span>stride<span class="_ _11"> </span><span class="ff7">arguments<span class="_ _16"> </span>to<span class="_ _11"> </span>the<span class="_ _11"> </span></span>run<span class="_ _16"> </span><span class="ff7">function<span class="_ _11"> </span>allow<span class="_ _11"> </span>us<span class="_ _16"> </span>to<span class="_ _11"> </span>control<span class="_ _11"> </span>the</span></span></div><div class="t m5 x17 h26 y2457 ff7 fs19 fc1 sc0 ls0 ws0">degree<span class="_ _14"> </span>of<span class="_ _14"> </span>temporal<span class="_ _15"> </span>and<span class="_ _14"> </span>spatial<span class="_ _15"> </span>locality<span class="_ _14"> </span>in<span class="_ _14"> </span>the<span class="_ _15"> </span>resulting<span class="_ _14"> </span>read<span class="_ _14"> </span>sequence.<span class="_ _14"> </span>Smaller</div><div class="t m5 x17 h26 y2458 ff7 fs19 fc1 sc0 ls0 ws0">values<span class="_ _21"> </span>of<span class="_ _f"> </span><span class="ffd">size<span class="_ _f"> </span></span>result<span class="_ _f"> </span>in<span class="_ _f"> </span>a<span class="_ _f"> </span>smaller<span class="_ _f"> </span>working<span class="_ _f"> </span>set<span class="_ _f"> </span>size<span class="_ _0"></span>,<span class="_ _e"> </span>and<span class="_ _21"> </span>thus<span class="_ _f"> </span>better<span class="_ _f"> </span>temporal</div><div class="t m5 x17 h26 y2459 ff7 fs19 fc1 sc0 ls0 ws0">locality<span class="_ _3"></span>.<span class="_ _13"> </span>Smaller<span class="_ _13"> </span>values<span class="_ _13"> </span>of<span class="_"> </span><span class="ffd">stride<span class="_ _13"> </span></span>result<span class="_ _13"> </span>in<span class="_ _13"> </span>better<span class="_ _13"> </span>spatial<span class="_"> </span>locality<span class="_ _7"></span>.<span class="_ _13"> </span>If<span class="_ _13"> </span>we<span class="_"> </span>call<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ffd">run</span></div><div class="t m5 x17 h26 y4fe ff7 fs19 fc1 sc0 ls0 ws0">function<span class="_ _13"> </span>repeatedly<span class="_ _6"> </span>with<span class="_ _13"> </span>different<span class="_ _13"> </span>values<span class="_ _13"> </span>of<span class="_ _6"> </span><span class="ffd">size<span class="_ _13"> </span></span>and<span class="_ _13"> </span><span class="ffd">stride</span>,<span class="_ _13"> </span>then<span class="_ _6"> </span>we<span class="_ _13"> </span>can<span class="_ _13"> </span>recover</div><div class="t m5 x17 h26 y4ff ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_ _16"> </span>fascinating<span class="_ _16"> </span>two-dimensional<span class="_ _11"> </span>function<span class="_ _16"> </span>of<span class="_ _16"> </span>read<span class="_ _16"> </span>throughput<span class="_ _16"> </span>versus<span class="_ _16"> </span>temporal<span class="_ _16"> </span>and</div><div class="t m5 x17 h26 y500 ff7 fs19 fc1 sc0 ls0 ws0">spatial<span class="_"> </span>locality<span class="_ _3"></span>.<span class="_"> </span>T<span class="_ _1"></span>his<span class="_"> </span>function<span class="_"> </span>is<span class="_"> </span>called<span class="_"> </span>a<span class="_"> </span><span class="ffa">memory<span class="_"> </span>mountain<span class="_"> </span></span>[112].</div><div class="t m5 x26 h26 y501 ff7 fs19 fc1 sc0 ls0 ws0">Every<span class="_ _14"> </span>computer<span class="_ _14"> </span>has<span class="_ _14"> </span>a<span class="_ _14"> </span>unique<span class="_ _16"> </span>memory<span class="_ _14"> </span>mountain<span class="_ _14"> </span>that<span class="_ _14"> </span>characterizes<span class="_ _14"> </span>the<span class="_ _14"> </span>ca-</div><div class="t m5 x17 h26 y502 ff7 fs19 fc1 sc0 ls0 ws0">pabilities<span class="_ _21"> </span>of<span class="_ _f"> </span>its<span class="_ _21"> </span>memory<span class="_ _f"> </span>system.<span class="_ _f"> </span>F<span class="_ _1"></span>or<span class="_ _21"> </span>example,<span class="_ _f"> </span>Figure<span class="_ _15"> </span>6.41<span class="_ _f"> </span>shows<span class="_ _f"> </span>the<span class="_ _21"> </span>memory</div><div class="t m5 x17 h26 y503 ff7 fs19 fc1 sc0 ls0 ws0">mountain<span class="_ _16"> </span>for<span class="_ _16"> </span>an<span class="_ _16"> </span>Intel<span class="_ _16"> </span>Core<span class="_ _16"> </span>i7<span class="_ _14"> </span>Haswell<span class="_ _16"> </span>system.<span class="_ _16"> </span>In<span class="_ _16"> </span>this<span class="_ _16"> </span>example,<span class="_ _16"> </span>the<span class="_ _16"> </span><span class="ffd">size<span class="_ _16"> </span></span>varies</div><div class="t m5 x17 h26 y504 ff7 fs19 fc1 sc0 ls0 ws0">from<span class="_"> </span>16<span class="_"> </span>KB<span class="_"> </span>to<span class="_"> </span>128<span class="_"> </span>MB<span class="_ _3"></span>,<span class="_"> </span>and<span class="_"> </span>the<span class="_"> </span><span class="ffd">stride<span class="_ _10"> </span></span>varies<span class="_"> </span>from<span class="_"> </span>1<span class="_"> </span>to<span class="_"> </span>12<span class="_"> </span>elements<span class="_ _1"></span>,<span class="_"> </span>where<span class="_"> </span>each</div><div class="t m5 x17 h26 y505 ff7 fs19 fc1 sc0 ls0 ws0">element<span class="_"> </span>is<span class="_"> </span>an<span class="_"> </span>8-byte<span class="_"> </span><span class="ffd">long<span class="_ _11"> </span>int</span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
