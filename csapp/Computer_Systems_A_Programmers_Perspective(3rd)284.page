<div id="pf11c" class="pf w2 h11" data-page-no="11c"><div class="pc pc11c w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg11c.png"/><div class="t m5 xb5 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>3.7<span class="_ _60"> </span>Procedures<span class="_ _3e"> </span><span class="ffe fs1e">283</span></div><div class="t m5 x17 h34 y9c ff6 fs16 fc2 sc0 ls0 ws0">(a)<span class="_ _10"> </span>C<span class="_ _11"> </span>code</div><div class="t m5 x17 h2d y1bbd ffd fs1e fc2 sc0 ls0 ws0">void<span class="_ _e"> </span>proc(long<span class="_ _1a"> </span>a1,<span class="_ _1f"> </span>long<span class="_ _1a"> </span>*a1p,</div><div class="t m5 x242 h2d y2769 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _3f"> </span>a2,<span class="_ _e"> </span>int<span class="_ _3f"> </span>*a2p,</div><div class="t m5 x242 h2d y276a ffd fs1e fc2 sc0 ls0 ws0">short<span class="_ _e"> </span>a3,<span class="_ _1f"> </span>short<span class="_ _1f"> </span>*a3p,</div><div class="t m5 x242 h2d y276b ffd fs1e fc2 sc0 ls0 ws0">char<span class="_ _1a"> </span>a4,<span class="_ _e"> </span>char<span class="_ _1a"> </span>*a4p)</div><div class="t m5 x17 h2d y276c ffd fs1e fc2 sc0 ls0 ws0">{</div><div class="t m5 x1b6 h2d y276d ffd fs1e fc2 sc0 ls0 ws0">*a1p<span class="_ _e"> </span>+=<span class="_ _1f"> </span>a1;</div><div class="t m5 x1b6 h2d y276e ffd fs1e fc2 sc0 ls0 ws0">*a2p<span class="_ _e"> </span>+=<span class="_ _1f"> </span>a2;</div><div class="t m5 x1b6 h2d y276f ffd fs1e fc2 sc0 ls0 ws0">*a3p<span class="_ _e"> </span>+=<span class="_ _1f"> </span>a3;</div><div class="t m5 x1b6 h2d y2770 ffd fs1e fc2 sc0 ls0 ws0">*a4p<span class="_ _e"> </span>+=<span class="_ _1f"> </span>a4;</div><div class="t m5 x17 h2d y29b0 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x17 h34 y29b1 ff6 fs16 fc2 sc0 ls0 ws0">(b)<span class="_ _10"> </span>Generated<span class="_ _11"> </span>assembly<span class="_ _10"> </span>code</div><div class="t m5 x2e h61 y29b2 ff13 fs35 fc6 sc0 ls0 ws0">void<span class="_ _f"> </span>proc(a1,<span class="_ _f"> </span>a1p,<span class="_ _f"> </span>a2,<span class="_ _e"> </span>a2p,<span class="_ _21"> </span>a3,<span class="_ _f"> </span>a3p,<span class="_ _e"> </span>a4,<span class="_ _21"> </span>a4p)</div><div class="t m5 x2e h61 y29b3 ff13 fs35 fc6 sc0 ls0 ws0">Arguments<span class="_ _f"> </span>passed<span class="_ _f"> </span>as<span class="_ _f"> </span>follows:</div><div class="t m5 x19f h61 y29b4 ff13 fs35 fc6 sc0 ls0 ws0">a1<span class="_ _3d"> </span>in<span class="_ _f"> </span>%rdi<span class="_ _77"> </span>(64<span class="_ _f"> </span>bits)</div><div class="t m5 x19f h61 y29b5 ff13 fs35 fc6 sc0 ls0 ws0">a1p<span class="_ _f"> </span>in<span class="_ _f"> </span>%rsi<span class="_ _77"> </span>(64<span class="_ _e"> </span>bits)</div><div class="t m5 x19f h61 y29b6 ff13 fs35 fc6 sc0 ls0 ws0">a2<span class="_ _3d"> </span>in<span class="_ _f"> </span>%edx<span class="_ _77"> </span>(32<span class="_ _f"> </span>bits)</div><div class="t m5 x19f h61 y29b7 ff13 fs35 fc6 sc0 ls0 ws0">a2p<span class="_ _f"> </span>in<span class="_ _f"> </span>%rcx<span class="_ _77"> </span>(64<span class="_ _e"> </span>bits)</div><div class="t m5 x19f h61 y29b8 ff13 fs35 fc6 sc0 ls0 ws0">a3<span class="_ _3d"> </span>in<span class="_ _f"> </span>%r8w<span class="_ _77"> </span>(16<span class="_ _f"> </span>bits)</div><div class="t m5 x19f h61 y29b9 ff13 fs35 fc6 sc0 ls0 ws0">a3p<span class="_ _f"> </span>in<span class="_ _f"> </span>%r9<span class="_ _122"> </span>(64<span class="_ _e"> </span>bits)</div><div class="t m5 x19f h61 y29ba ff13 fs35 fc6 sc0 ls0 ws0">a4<span class="_ _3d"> </span>at<span class="_ _f"> </span>%rsp+8<span class="_ _118"> </span>(<span class="_ _f"> </span>8<span class="_ _f"> </span>bits)</div><div class="t m5 x19f h61 y29bb ff13 fs35 fc6 sc0 ls0 ws0">a4p<span class="_ _f"> </span>at<span class="_ _f"> </span>%rsp+16<span class="_ _b9"> </span>(64<span class="_ _e"> </span>bits)</div><div class="t m5 x2c h2d y29bc ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">proc:</span></div><div class="t m5 x2c h2d y29bd ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>16(%rsp),<span class="_ _e"> </span>%rax<span class="_ _f1"> </span></span><span class="ff13 fs35">Fetch<span class="_ _f"> </span>a4p<span class="_ _3e"> </span>(64<span class="_ _f"> </span>bits)</span></div><div class="t m5 x2c h2d y28f6 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">addq<span class="_ _46"> </span>%rdi,<span class="_ _e"> </span>(%rsi)<span class="_ _59"> </span></span><span class="ff13 fs35">*a1p<span class="_ _f"> </span>+=<span class="_ _e"> </span>a1<span class="_ _60"> </span>(64<span class="_ _f"> </span>bits)</span></div><div class="t m5 x2c h2d y29be ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">addl<span class="_ _46"> </span>%edx,<span class="_ _e"> </span>(%rcx)<span class="_ _59"> </span></span><span class="ff13 fs35">*a2p<span class="_ _f"> </span>+=<span class="_ _e"> </span>a2<span class="_ _60"> </span>(32<span class="_ _f"> </span>bits)</span></div><div class="t m5 x2c h2d y28f8 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">addw<span class="_ _46"> </span>%r8w,<span class="_ _e"> </span>(%r9)<span class="_ _88"> </span></span><span class="ff13 fs35">*a3p<span class="_ _21"> </span>+=<span class="_ _e"> </span>a3<span class="_ _60"> </span>(16<span class="_ _f"> </span>bits)</span></div><div class="t m5 x2c h2e y28f9 ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 xd1 h2d y29bf ffd fs1e fc2 sc0 ls0 ws0">movl<span class="_ _46"> </span>8(%rsp),<span class="_ _e"> </span>%edx<span class="_ _93"> </span><span class="ff13 fs35 fc6">Fetch<span class="_ _e"> </span>a4<span class="_ _3c"> </span>(<span class="_ _f"> </span>8<span class="_ _e"> </span>bits)</span></div><div class="t m5 x2c h2d y28fb ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">addb<span class="_ _46"> </span>%dl,<span class="_ _e"> </span>(%rax)<span class="_ _88"> </span></span><span class="ff13 fs35">*a4p<span class="_ _21"> </span>+=<span class="_ _e"> </span>a4<span class="_ _60"> </span>(<span class="_ _f"> </span>8<span class="_ _e"> </span>bits)</span></div><div class="t m5 x2c h2d y29c0 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _45"> </span><span class="ffd fs1e fc2">ret<span class="_ _139"> </span></span><span class="ff13 fs35">Return</span></div><div class="t m5 x17 h2f y29c1 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _15"> </span>3.29<span class="_ _c"> </span><span class="fc2">Example<span class="_ _21"> </span>of<span class="_ _21"> </span>function<span class="_ _21"> </span>with<span class="_ _15"> </span>multiple<span class="_ _21"> </span>arguments<span class="_ _21"> </span>of<span class="_ _21"> </span>different<span class="_ _21"> </span>types.</span></div><div class="t m5 x17 h34 y29c2 ff6 fs16 fc2 sc0 ls0 ws0">Arguments<span class="_ _10"> </span>1–6<span class="_ _11"> </span>are<span class="_ _10"> </span>passed<span class="_ _10"> </span>in<span class="_ _11"> </span>registers,<span class="_ _10"> </span>while<span class="_ _11"> </span>arguments<span class="_ _10"> </span>7–8<span class="_ _11"> </span>are<span class="_ _10"> </span>passed<span class="_ _10"> </span>on<span class="_ _11"> </span>the<span class="_ _10"> </span>stack.</div><div class="t m5 x17 h2f y29c3 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>3.30</div><div class="t m5 x17 h2f y29c4 ffe fs16 fc2 sc0 ls0 ws0">Stack<span class="_"> </span>frame<span class="_ _11"> </span>structure<span class="_"> </span>for</div><div class="t m5 x17 h2f y29c5 ffe fs16 fc2 sc0 ls0 ws0">function</div><div class="t m5 x10a h3a y29c6 ffd fs19 fc2 sc0 ls0 ws0">proc<span class="ffe fs16">.<span class="_"> </span><span class="ff6">Arguments</span></span></div><div class="t m5 x17 h3a y29c7 ffd fs19 fc2 sc0 ls0 ws0">a4<span class="_ _11"> </span><span class="ff6 fs16">and<span class="_ _11"> </span></span>a4p<span class="_ _11"> </span><span class="ff6 fs16">are<span class="_ _10"> </span>passed<span class="_ _11"> </span>on</span></div><div class="t m5 x17 h34 y29c8 ff6 fs16 fc2 sc0 ls0 ws0">the<span class="_ _10"> </span>stack.</div><div class="t m5 x10e h3f y29c9 ff26 fs27 fc1 sc0 ls0 ws0">Return address</div><div class="t m5 xfd h3f y29ca ff26 fs27 fc1 sc0 ls0 ws0">16</div><div class="t m5 x9a h3f y29cb ff26 fs27 fc1 sc0 ls0 ws0">8</div><div class="t m5 x9a h3f y29cc ff26 fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 x180 h40 y29cd ff22 fs28 fc1 sc0 ls0 ws0">a4</div><div class="t m5 xe5 h40 y29ce ff22 fs28 fc1 sc0 ls0 ws0">a4p</div><div class="t m5 xbd h3f y29cf ff26 fs27 fc1 sc0 ls0 ws0">Stack pointer</div><div class="t m5 xbd h40 y29d0 ff22 fs28 fc1 sc0 ls0 ws0">%rsp</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
