<div id="pf294" class="pf w2 h11" data-page-no="294"><div class="pc pc294 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg294.png"/><div class="t m5 xf2 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>6.4<span class="_ _60"> </span>Cache<span class="_ _10"> </span>Memories<span class="_ _3e"> </span><span class="ffe fs1e">659</span></div><div class="t m5 x34 h2a y257 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">Why<span class="_ _11"> </span>index<span class="_ _11"> </span>with<span class="_ _11"> </span>the<span class="_ _16"> </span>middle<span class="_ _11"> </span>bits?</span></div><div class="t m5 x34 h2b y258 ff7 fs1e fc2 sc0 ls0 ws0">Y<span class="_ _3"></span>ou<span class="_"> </span>may<span class="_"> </span>be<span class="_"> </span>wondering<span class="_"> </span>why<span class="_"> </span>caches<span class="_"> </span>use<span class="_"> </span>the<span class="_"> </span>middle<span class="_ _13"> </span>bits<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>set<span class="_"> </span>index<span class="_"> </span>instead<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>high-order<span class="_"> </span>bits<span class="_ _3"></span>.</div><div class="t m5 x34 h2b y259 ff7 fs1e fc2 sc0 ls0 ws0">T<span class="_ _1"></span>here<span class="_"> </span>is<span class="_ _13"> </span>a<span class="_"> </span>good<span class="_ _13"> </span>reason<span class="_"> </span>why<span class="_ _13"> </span>the<span class="_ _13"> </span>middle<span class="_"> </span>bits<span class="_ _13"> </span>are<span class="_ _13"> </span>better.<span class="_ _13"> </span>F<span class="_ _0"></span>igure<span class="_ _13"> </span>6.31<span class="_"> </span>shows<span class="_ _13"> </span>why<span class="_ _3"></span>.<span class="_"> </span>If<span class="_ _13"> </span>the<span class="_ _13"> </span>high-order<span class="_"> </span>bits<span class="_ _13"> </span>are</div><div class="t m5 x34 h2b y25a ff7 fs1e fc2 sc0 ls0 ws0">used<span class="_ _13"> </span>as<span class="_ _13"> </span>an<span class="_ _13"> </span>index,<span class="_ _13"> </span>then<span class="_ _13"> </span>some<span class="_ _13"> </span>contiguous<span class="_ _13"> </span>memory<span class="_ _13"> </span>blocks<span class="_ _13"> </span>will<span class="_ _13"> </span>map<span class="_ _13"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>same<span class="_ _13"> </span>cache<span class="_ _13"> </span>set.<span class="_ _13"> </span>F<span class="_ _1"></span>or<span class="_ _13"> </span>example<span class="_ _0"></span>,<span class="_ _13"> </span>in</div><div class="t m5 x34 h2b y4e2 ff7 fs1e fc2 sc0 ls0 ws0">the<span class="_"> </span>ﬁgure<span class="_ _1"></span>,<span class="_"> </span>the<span class="_ _13"> </span>ﬁrst<span class="_"> </span>four<span class="_ _13"> </span>blocks<span class="_"> </span>map<span class="_"> </span>to<span class="_ _13"> </span>the<span class="_"> </span>ﬁrst<span class="_ _13"> </span>cache<span class="_"> </span>set,<span class="_ _13"> </span>the<span class="_"> </span>second<span class="_ _13"> </span>four<span class="_"> </span>blocks<span class="_ _13"> </span>map<span class="_"> </span>to<span class="_ _13"> </span>the<span class="_"> </span>second<span class="_ _13"> </span>set,</div><div class="t m5 x34 h2b y4e3 ff7 fs1e fc2 sc0 ls0 ws0">and<span class="_"> </span>so<span class="_"> </span>on.<span class="_"> </span>If<span class="_"> </span>a<span class="_"> </span>program<span class="_ _10"> </span>has<span class="_ _10"> </span>good<span class="_"> </span>spatial<span class="_ _10"> </span>locality<span class="_"> </span>and<span class="_ _10"> </span>scans<span class="_ _10"> </span>the<span class="_"> </span>elements<span class="_ _10"> </span>of<span class="_ _10"> </span>an<span class="_"> </span>array<span class="_ _10"> </span>sequentially<span class="_ _3"></span>,<span class="_ _10"> </span>then</div><div class="t m5 x34 h2b y4e4 ff7 fs1e fc2 sc0 ls0 ws0">the<span class="_ _13"> </span>cache<span class="_"> </span>can<span class="_ _13"> </span>only<span class="_ _13"> </span>hold<span class="_"> </span>a<span class="_ _13"> </span>block-size<span class="_ _13"> </span>chunk<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>array<span class="_ _13"> </span>at<span class="_"> </span>any<span class="_ _13"> </span>point<span class="_ _13"> </span>in<span class="_"> </span>time<span class="_ _1"></span>.<span class="_ _13"> </span>T<span class="_ _0"></span>his<span class="_ _13"> </span>is<span class="_"> </span>an<span class="_ _13"> </span>inefﬁcient<span class="_ _13"> </span>use<span class="_"> </span>of</div><div class="t m5 x34 h2b y945 ff7 fs1e fc2 sc0 ls0 ws0">the<span class="_ _13"> </span>cache<span class="_ _0"></span>.<span class="_ _13"> </span>Contrast<span class="_"> </span>this<span class="_ _13"> </span>with<span class="_ _13"> </span>middle-bit<span class="_ _13"> </span>indexing,<span class="_ _13"> </span>where<span class="_ _13"> </span>adjacent<span class="_ _13"> </span>blocks<span class="_"> </span>always<span class="_ _13"> </span>map<span class="_ _13"> </span>to<span class="_ _13"> </span>different<span class="_ _13"> </span>cache</div><div class="t m5 x34 h2b y946 ff7 fs1e fc2 sc0 ls0 ws0">sets<span class="_ _1"></span>.<span class="_"> </span>In<span class="_"> </span>this<span class="_"> </span>case<span class="_ _0"></span>,<span class="_"> </span>the<span class="_"> </span>cache<span class="_"> </span>can<span class="_"> </span>hold<span class="_"> </span>an<span class="_"> </span>entire<span class="_"> </span><span class="ff11">C<span class="_ _2"></span></span>-size<span class="_"> </span>chunk<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>array<span class="_ _3"></span>,<span class="_"> </span>where<span class="_"> </span><span class="ff11">C<span class="_"> </span></span>is<span class="_"> </span>the<span class="_"> </span>cache<span class="_"> </span>size<span class="_ _1"></span>.</div><div class="t m5 x18 h79 y57c8 ff83 fs42 fc1 sc0 ls0 ws0">Set index bits</div><div class="t m5 xc h79 y57c9 ff83 fs42 fc1 sc0 ls0 ws0">Four-set cache</div><div class="t m5 xec h79 y57ca ff83 fs42 fc1 sc0 ls0 ws0">High-order</div><div class="t m5 xe2 h79 y57cb ff83 fs42 fc1 sc0 ls0 ws0">bit indexing</div><div class="t m5 x11b h79 y57cc ff83 fs42 fc1 sc0 ls0 ws0">Middle-order</div><div class="t m5 x3b h79 y57cd ff83 fs42 fc1 sc0 ls0 ws0">bit indexing</div><div class="t m5 x17 h79 y57ce ff83 fs42 fc1 sc0 ls0 ws0">00</div><div class="t m5 x17 h79 y57cf ff83 fs42 fc1 sc0 ls0 ws0">01</div><div class="t m5 x17 h79 y57d0 ff83 fs42 fc1 sc0 ls0 ws0">10</div><div class="t m5 x57 h79 y57d1 ff83 fs42 fc1 sc0 ls248 ws0">11</div><div class="t m5 xf8 h79 y57d2 ff83 fs42 fc1 sc0 ls0 ws0">0000</div><div class="t m5 xe6 h79 y57d3 ff83 fs42 fc1 sc0 ls0 ws0">1<span class="_ _1"></span>100</div><div class="t m5 xe6 h79 y57d4 ff83 fs42 fc1 sc0 ls0 ws0">1<span class="_ _1"></span>101</div><div class="t m5 x21d h79 y57d5 ff83 fs42 fc1 sc0 ls248 ws0">111<span class="_ _2"></span>0</div><div class="t m5 xf1 h79 y57d6 ff83 fs42 fc1 sc0 ls248 ws0">1111</div><div class="t m5 xf8 h79 y57d7 ff83 fs42 fc1 sc0 ls0 ws0">0101</div><div class="t m5 xe6 h79 y57d8 ff83 fs42 fc1 sc0 ls0 ws0">01<span class="_ _1"></span>10</div><div class="t m5 x21d h79 y57d9 ff83 fs42 fc1 sc0 ls248 ws0">0<span class="_ _2"></span>111</div><div class="t m5 xf8 h79 y57da ff83 fs42 fc1 sc0 ls0 ws0">1000</div><div class="t m5 xf8 h79 y57db ff83 fs42 fc1 sc0 ls0 ws0">1001</div><div class="t m5 xf8 h79 y57dc ff83 fs42 fc1 sc0 ls0 ws0">1010</div><div class="t m5 xe6 h79 y57dd ff83 fs42 fc1 sc0 ls0 ws0">101<span class="_ _1"></span>1</div><div class="t m5 xf8 h79 y57de ff83 fs42 fc1 sc0 ls0 ws0">0001</div><div class="t m5 xf8 h79 y57df ff83 fs42 fc1 sc0 ls0 ws0">0010</div><div class="t m5 xe6 h79 y57e0 ff83 fs42 fc1 sc0 ls0 ws0">001<span class="_ _1"></span>1</div><div class="t m5 xf8 h79 y57e1 ff83 fs42 fc1 sc0 ls0 ws0">0100</div><div class="t m5 x3a h79 y57e2 ff83 fs42 fc1 sc0 ls0 ws0">0000</div><div class="t m5 x3a h79 y57e3 ff83 fs42 fc1 sc0 ls0 ws0">1<span class="_ _1"></span>100</div><div class="t m5 x3a h79 y57e4 ff83 fs42 fc1 sc0 ls0 ws0">1<span class="_ _1"></span>101</div><div class="t m5 x195 h79 y57e5 ff83 fs42 fc1 sc0 ls248 ws0">111<span class="_ _2"></span>0</div><div class="t m5 x80 h79 y57e6 ff83 fs42 fc1 sc0 ls248 ws0">1111</div><div class="t m5 x3a h79 y57e7 ff83 fs42 fc1 sc0 ls0 ws0">0101</div><div class="t m5 x3a h79 y57e8 ff83 fs42 fc1 sc0 ls0 ws0">01<span class="_ _1"></span>10</div><div class="t m5 x195 h79 y57e9 ff83 fs42 fc1 sc0 ls248 ws0">0<span class="_ _2"></span>111</div><div class="t m5 x3a h79 y57ea ff83 fs42 fc1 sc0 ls0 ws0">1000</div><div class="t m5 x3a h79 y57eb ff83 fs42 fc1 sc0 ls0 ws0">1001</div><div class="t m5 x3a h79 y57ec ff83 fs42 fc1 sc0 ls0 ws0">1010</div><div class="t m5 x3a h79 y57ed ff83 fs42 fc1 sc0 ls0 ws0">101<span class="_ _1"></span>1</div><div class="t m5 x3a h79 y57ee ff83 fs42 fc1 sc0 ls0 ws0">0001</div><div class="t m5 x3a h79 y57ef ff83 fs42 fc1 sc0 ls0 ws0">0010</div><div class="t m5 x3a h79 y57f0 ff83 fs42 fc1 sc0 ls0 ws0">001<span class="_ _1"></span>1</div><div class="t m5 x3a h79 y57f1 ff83 fs42 fc1 sc0 ls0 ws0">0100</div><div class="t m5 x17 h2f y57f2 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>6.31<span class="_ _66"> </span><span class="fc1">Why<span class="_"> </span>caches<span class="_"> </span>index<span class="_"> </span>with<span class="_"> </span>the<span class="_"> </span>middle<span class="_"> </span>bits.</span></div><div class="t m5 x26 h26 y561 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _15"> </span>bottom<span class="_ _14"> </span>line<span class="_ _15"> </span>is<span class="_ _14"> </span>that<span class="_ _15"> </span>even<span class="_ _14"> </span>though<span class="_ _15"> </span>the<span class="_ _14"> </span>program<span class="_ _15"> </span>has<span class="_ _14"> </span>good<span class="_ _14"> </span>spatial<span class="_ _15"> </span>locality</div><div class="t m5 x17 h26 y562 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _11"> </span>we<span class="_ _11"> </span>have<span class="_ _16"> </span>room<span class="_"> </span>in<span class="_ _16"> </span>the<span class="_ _11"> </span>cache<span class="_ _11"> </span>to<span class="_ _11"> </span>hold<span class="_ _16"> </span>the<span class="_"> </span>blocks<span class="_ _16"> </span>for<span class="_ _11"> </span>both<span class="_ _11"> </span><span class="ffd">x[i]<span class="_ _11"> </span></span>and<span class="_ _11"> </span><span class="ffd">y[i]</span>,<span class="_ _16"> </span>each</div><div class="t m5 x17 h26 y563 ff7 fs19 fc1 sc0 ls0 ws0">reference<span class="_ _13"> </span>results<span class="_ _13"> </span>in<span class="_ _6"> </span>a<span class="_ _13"> </span>conﬂict<span class="_ _13"> </span>miss<span class="_ _13"> </span>because<span class="_ _6"> </span>the<span class="_ _13"> </span>blocks<span class="_ _13"> </span>map<span class="_ _13"> </span>to<span class="_ _6"> </span>the<span class="_ _13"> </span>same<span class="_ _13"> </span>cache<span class="_ _13"> </span>set.<span class="_ _6"> </span>It</div><div class="t m5 x17 h26 y564 ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_ _13"> </span>not<span class="_ _6"> </span>unusual<span class="_ _13"> </span>for<span class="_ _6"> </span>this<span class="_ _13"> </span>kind<span class="_ _6"> </span>of<span class="_ _13"> </span>thrashing<span class="_ _6"> </span>to<span class="_ _13"> </span>result<span class="_ _6"> </span>in<span class="_ _13"> </span>a<span class="_ _6"> </span>slowdown<span class="_ _13"> </span>by<span class="_ _6"> </span>a<span class="_ _13"> </span>factor<span class="_ _13"> </span>of<span class="_ _6"> </span>2<span class="_ _13"> </span>or<span class="_ _6"> </span>3.</div><div class="t m5 x17 h26 y565 ff7 fs19 fc1 sc0 ls0 ws0">Also<span class="_ _1"></span>,<span class="_"> </span>be<span class="_"> </span>aware<span class="_"> </span>that<span class="_ _13"> </span>even<span class="_"> </span>though<span class="_"> </span>our<span class="_"> </span>example<span class="_ _13"> </span>is<span class="_"> </span>extremely<span class="_"> </span>simple<span class="_ _1"></span>,<span class="_"> </span>the<span class="_"> </span>problem<span class="_"> </span>is</div><div class="t m5 x17 h26 y566 ff7 fs19 fc1 sc0 ls0 ws0">real<span class="_"> </span>for<span class="_"> </span>larger<span class="_"> </span>and<span class="_"> </span>more<span class="_"> </span>realistic<span class="_"> </span>direct-mapped<span class="_"> </span>caches<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y567 ff7 fs19 fc1 sc0 ls0 ws0">Luckily<span class="_ _3"></span>,<span class="_"> </span>thrashing<span class="_"> </span>is<span class="_"> </span>easy<span class="_"> </span>for<span class="_"> </span>programmers<span class="_"> </span>to<span class="_"> </span>ﬁx<span class="_"> </span>once<span class="_"> </span>they<span class="_"> </span>recognize<span class="_"> </span>what<span class="_"> </span>is</div><div class="t m5 x17 h26 y216d ff7 fs19 fc1 sc0 ls0 ws0">going<span class="_"> </span>on.<span class="_"> </span>One<span class="_"> </span>easy<span class="_"> </span>solution<span class="_"> </span>is<span class="_"> </span>to<span class="_ _13"> </span>put<span class="_"> </span><span class="ff11">B<span class="_"> </span></span>bytes<span class="_"> </span>of<span class="_"> </span>padding<span class="_"> </span>at<span class="_"> </span>the<span class="_"> </span>end<span class="_"> </span>of<span class="_"> </span>each<span class="_ _13"> </span>array<span class="_ _3"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
