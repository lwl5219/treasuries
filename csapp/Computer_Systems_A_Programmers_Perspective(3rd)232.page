<div id="pfe8" class="pf w2 h11" data-page-no="e8"><div class="pc pce8 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bge8.png"/><div class="t m5 x191 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>3.5<span class="_ _60"> </span>Arithmetic<span class="_ _10"> </span>and<span class="_ _10"> </span>Logical<span class="_ _10"> </span>Operations<span class="_ _3e"> </span><span class="ffe fs1e">231</span></div><div class="t m5 x17 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">possible<span class="_ _1"></span>.<span class="_ _15"> </span>The<span class="_ _14"> </span>different<span class="_ _15"> </span>shift<span class="_ _15"> </span>instructions<span class="_ _15"> </span>can<span class="_ _15"> </span>specify<span class="_ _15"> </span>the<span class="_ _15"> </span>shift<span class="_ _15"> </span>amount<span class="_ _15"> </span>either<span class="_ _15"> </span>as</div><div class="t m5 x17 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">an<span class="_ _16"> </span>immediate<span class="_ _11"> </span>value<span class="_ _16"> </span>or<span class="_ _16"> </span>with<span class="_ _11"> </span>the<span class="_ _16"> </span>single-byte<span class="_ _16"> </span>register<span class="_ _16"> </span><span class="ffd">%cl</span>.<span class="_ _11"> </span>(These<span class="_ _11"> </span>instructions<span class="_ _16"> </span>are</div><div class="t m5 x17 h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">unusual<span class="_ _13"> </span>in<span class="_"> </span>only<span class="_ _13"> </span>allowing<span class="_ _13"> </span>this<span class="_"> </span>speciﬁc<span class="_ _13"> </span>register<span class="_ _13"> </span>as<span class="_"> </span>the<span class="_ _13"> </span>operand.)<span class="_ _13"> </span>In<span class="_"> </span>principle<span class="_ _1"></span>,<span class="_ _13"> </span>having</div><div class="t m5 x17 h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">a<span class="_"> </span>1-byte<span class="_"> </span>shift<span class="_"> </span>amount<span class="_"> </span>would<span class="_"> </span>make<span class="_ _13"> </span>it<span class="_"> </span>possible<span class="_"> </span>to<span class="_"> </span>encode<span class="_"> </span>shift<span class="_"> </span>amounts<span class="_"> </span>ranging<span class="_"> </span>up</div><div class="t m5 x17 h26 y2378 ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_"> </span>2</div><div class="t m5 x37 h3c y2379 ff7 fs25 fc2 sc0 ls0 ws0">8</div><div class="t m5 x1a2 h46 y237a ff12 fs19 fc2 sc0 ls0 ws0">−<span class="_ _13"> </span><span class="ff7">1<span class="_ _13"> </span></span>=<span class="_ _13"> </span><span class="ff7">255.<span class="_"> </span>W<span class="_ _0"></span>ith<span class="_"> </span>x86-64,<span class="_"> </span>a<span class="_"> </span>shift<span class="_ _11"> </span>instruction<span class="_"> </span>operating<span class="_"> </span>on<span class="_ _11"> </span>data<span class="_"> </span>values<span class="_"> </span>that<span class="_ _11"> </span>are</span></div><div class="t m5 x17 h26 y237b ff11 fs19 fc2 sc0 ls0 ws0">w<span class="_ _21"> </span><span class="ff7">bits<span class="_ _15"> </span>long<span class="_ _15"> </span>determines<span class="_ _15"> </span>the<span class="_ _15"> </span>shift<span class="_ _15"> </span>amount<span class="_ _15"> </span>from<span class="_ _15"> </span>the<span class="_ _15"> </span>low-order<span class="_ _15"> </span></span>m<span class="_ _15"> </span><span class="ff7">bits<span class="_ _15"> </span>of<span class="_ _15"> </span>register</span></div><div class="t m5 x17 h26 y237c ffd fs19 fc2 sc0 ls0 ws0">%cl<span class="ff7">,<span class="_ _f"> </span>where<span class="_ _15"> </span>2</span></div><div class="t m5 x1b0 h50 y237d ff11 fs25 fc2 sc0 ls0 ws0">m</div><div class="t m5 x124 h46 y237e ff12 fs19 fc2 sc0 ls0 ws0">=<span class="_ _10"> </span><span class="ff11">w<span class="ff7">.<span class="_ _21"> </span>The<span class="_ _15"> </span>higher<span class="_ _1"></span>-order<span class="_ _15"> </span>bits<span class="_ _21"> </span>are<span class="_ _21"> </span>ignored.<span class="_ _21"> </span>So<span class="_ _1"></span>,<span class="_ _e"> </span>for<span class="_ _14"> </span>example,<span class="_ _21"> </span>when</span></span></div><div class="t m5 x17 h26 y237f ff7 fs19 fc2 sc0 ls0 ws0">register<span class="_ _14"> </span><span class="ffd">%cl<span class="_ _15"> </span></span>has<span class="_ _15"> </span>hexadecimal<span class="_ _14"> </span>value<span class="_ _15"> </span><span class="ffd">0xFF</span>,<span class="_ _21"> </span>then<span class="_ _15"> </span>instruction<span class="_ _14"> </span><span class="ffd">salb<span class="_ _15"> </span></span>would<span class="_ _15"> </span>shift<span class="_ _14"> </span>by</div><div class="t m5 x17 h26 y2380 ff7 fs19 fc2 sc0 ls0 ws0">7,<span class="_ _15"> </span>while<span class="_ _15"> </span><span class="ffd">salw<span class="_ _14"> </span></span>would<span class="_ _15"> </span>shift<span class="_ _15"> </span>by<span class="_ _14"> </span>15,<span class="_ _21"> </span><span class="ffd">sall<span class="_ _14"> </span></span>would<span class="_ _15"> </span>shift<span class="_ _15"> </span>by<span class="_ _14"> </span>31,<span class="_ _21"> </span>and<span class="_ _15"> </span><span class="ffd">salq<span class="_ _14"> </span></span>would<span class="_ _15"> </span>shift</div><div class="t m5 x17 h26 y2381 ff7 fs19 fc2 sc0 ls0 ws0">by<span class="_"> </span>63.</div><div class="t m5 x26 h26 y2382 ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_ _13"> </span>F<span class="_ _0"></span>igure<span class="_ _13"> </span>3.10<span class="_"> </span>indicates<span class="_ _3"></span>,<span class="_"> </span>there<span class="_ _13"> </span>are<span class="_ _13"> </span>two<span class="_ _13"> </span>names<span class="_ _13"> </span>for<span class="_"> </span>the<span class="_ _13"> </span>left<span class="_ _13"> </span>shift<span class="_ _13"> </span>instruction:<span class="_ _13"> </span><span class="ff9 ls22">sa<span class="_ _2"></span>l</span></div><div class="t m5 x17 h26 y2383 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_ _16"> </span><span class="ff9">shl</span>.<span class="_ _14"> </span>Both<span class="_ _14"> </span>have<span class="_ _14"> </span>the<span class="_ _16"> </span>same<span class="_ _14"> </span>effect,<span class="_ _15"> </span>ﬁlling<span class="_ _14"> </span>from<span class="_ _16"> </span>the<span class="_ _14"> </span>right<span class="_ _14"> </span>with<span class="_ _14"> </span>zeros<span class="_ _1"></span>.<span class="_ _16"> </span>The<span class="_ _16"> </span>right</div><div class="t m5 x17 h26 y2384 ff7 fs19 fc2 sc0 ls0 ws0">shift<span class="_"> </span>instructions<span class="_"> </span>differ<span class="_ _13"> </span>in<span class="_"> </span>that<span class="_"> </span><span class="ff9 ls22">sar<span class="_ _11"> </span></span>performs<span class="_"> </span>an<span class="_"> </span>arithmetic<span class="_ _13"> </span>shift<span class="_"> </span>(ﬁll<span class="_"> </span>with<span class="_"> </span>copies<span class="_ _13"> </span>of</div><div class="t m5 x17 h26 y2385 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _13"> </span>sign<span class="_"> </span>bit),<span class="_ _13"> </span>whereas<span class="_ _13"> </span><span class="ff9">shr<span class="_ _13"> </span></span>performs<span class="_"> </span>a<span class="_ _13"> </span>logical<span class="_ _13"> </span>shift<span class="_"> </span>(ﬁll<span class="_ _13"> </span>with<span class="_ _13"> </span>zeros).<span class="_ _13"> </span>T<span class="_ _0"></span>he<span class="_ _13"> </span>destination</div><div class="t m5 x17 h26 y2386 ff7 fs19 fc2 sc0 ls0 ws0">operand<span class="_ _16"> </span>of<span class="_ _16"> </span>a<span class="_ _14"> </span>shift<span class="_ _16"> </span>operation<span class="_ _16"> </span>can<span class="_ _14"> </span>be<span class="_ _16"> </span>either<span class="_ _14"> </span>a<span class="_ _16"> </span>register<span class="_ _16"> </span>or<span class="_ _14"> </span>a<span class="_ _16"> </span>memory<span class="_ _16"> </span>location.<span class="_ _14"> </span>W<span class="_ _3"></span>e</div><div class="t m5 x17 h26 y2387 ff7 fs19 fc2 sc0 ls0 ws0">denote<span class="_"> </span>the<span class="_ _13"> </span>two<span class="_"> </span>different<span class="_ _13"> </span>right<span class="_"> </span>shift<span class="_ _13"> </span>operations<span class="_"> </span>in<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>3.10<span class="_ _13"> </span>as<span class="_"> </span><span class="ff11">&gt;&gt;</span></div><div class="t m5 x53 h3c y2388 ff7 fs25 fc2 sc0 ls0 ws0">A</div><div class="t m5 x11a h26 y2389 ff7 fs19 fc2 sc0 ls0 ws0">(arithmetic)</div><div class="t m5 x17 h26 y238a ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_"> </span><span class="ff11">&gt;&gt;</span></div><div class="t m5 x182 h3c y238b ff7 fs25 fc2 sc0 ls0 ws0">L</div><div class="t m5 x1d4 h26 y238c ff7 fs19 fc2 sc0 ls0 ws0">(logical).</div><div class="t m5 x17 h47 y238d ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>3.9<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>364)</span></div><div class="t m5 x17 h26 y238e ff7 fs19 fc1 sc0 ls0 ws0">Suppose<span class="_"> </span>we<span class="_"> </span>want<span class="_"> </span>to<span class="_"> </span>generate<span class="_"> </span>assembly<span class="_"> </span>code<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>C<span class="_"> </span>function:</div><div class="t m5 x17 h2d y238f ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>shift_left4_rightn(long<span class="_ _1f"> </span>x,<span class="_ _1f"> </span>long<span class="_ _e"> </span>n)</div><div class="t m5 x17 h2d y2390 ffd fs1e fc2 sc0 ls0 ws0">{</div><div class="t m5 x1b6 h2d y2391 ffd fs1e fc2 sc0 ls0 ws0">x<span class="_ _e"> </span>&lt;&lt;=<span class="_ _1f"> </span>4;</div><div class="t m5 x1b6 h2d y2392 ffd fs1e fc2 sc0 ls0 ws0">x<span class="_ _e"> </span>&gt;&gt;=<span class="_ _1f"> </span>n;</div><div class="t m5 x1b6 h2d y2393 ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>x;</div><div class="t m5 x17 h2d y2394 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x26 h26 y2395 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _15"> </span>code<span class="_ _14"> </span>that<span class="_ _15"> </span>follows<span class="_ _15"> </span>is<span class="_ _14"> </span>a<span class="_ _15"> </span>portion<span class="_ _14"> </span>of<span class="_ _15"> </span>the<span class="_ _14"> </span>assembly<span class="_ _15"> </span>code<span class="_ _15"> </span>that<span class="_ _14"> </span>performs<span class="_ _15"> </span>the</div><div class="t m5 x17 h26 y2396 ff7 fs19 fc2 sc0 ls0 ws0">actual<span class="_ _f"> </span>shifts<span class="_ _f"> </span>and<span class="_ _f"> </span>leaves<span class="_ _f"> </span>the<span class="_ _f"> </span>ﬁnal<span class="_ _f"> </span>value<span class="_ _f"> </span>in<span class="_ _f"> </span>register<span class="_ _f"> </span><span class="ffd">%rax</span>.<span class="_ _f"> </span>T<span class="_ _7"></span>wo<span class="_ _f"> </span>key<span class="_ _f"> </span>instructions</div><div class="t m5 x17 h26 y2397 ff7 fs19 fc2 sc0 ls0 ws0">have<span class="_ _14"> </span>been<span class="_ _15"> </span>omitted.<span class="_ _14"> </span>Parameters<span class="_ _15"> </span><span class="ffd">x<span class="_ _15"> </span></span>and<span class="_ _14"> </span><span class="ffd">n<span class="_ _15"> </span></span>are<span class="_ _14"> </span>stored<span class="_ _15"> </span>in<span class="_ _14"> </span>registers<span class="_ _15"> </span><span class="ffd">%rdi<span class="_ _15"> </span></span>and<span class="_ _14"> </span><span class="ffd">%rsi</span>,</div><div class="t m5 x17 h26 y2398 ff7 fs19 fc2 sc0 ls0 ws0">respectively<span class="_ _3"></span>.</div><div class="t m5 xee h61 y2399 ff13 fs35 fc6 sc0 ls0 ws0">long<span class="_ _f"> </span>shift_left4_rightn(long<span class="_ _f"> </span>x,<span class="_ _f"> </span>long<span class="_ _e"> </span>n)</div><div class="t m5 xee h61 y239a ff13 fs35 fc6 sc0 ls0 ws0">x<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi,<span class="_ _f"> </span>n<span class="_ _e"> </span>in<span class="_ _21"> </span>%rsi</div><div class="t m5 x17 h2d y239b ffd fs1e fc2 sc0 ls0 ws0">shift_left4_rightn:</div><div class="t m5 x72 h2d y239c ffd fs1e fc2 sc0 ls0 ws0">movq<span class="_ _46"> </span>%rdi,<span class="_ _e"> </span>%rax</div><div class="t m5 xf7 h61 y239d ff13 fs35 fc6 sc0 ls0 ws0">Get<span class="_ _f"> </span>x</div><div class="t m5 x7c h61 y239e ff13 fs35 fc6 sc0 ls0 ws0">x<span class="_ _f"> </span>&lt;&lt;=<span class="_ _f"> </span>4</div><div class="t m5 x72 h2d y239f ffd fs1e fc2 sc0 ls0 ws0">movl<span class="_ _46"> </span>%esi,<span class="_ _e"> </span>%ecx<span class="_ _75"> </span><span class="ff13 fs35 fc6">Get<span class="_ _e"> </span>n<span class="_ _21"> </span>(4<span class="_ _f"> </span>bytes)</span></div><div class="t m5 x7c h61 y23a0 ff13 fs35 fc6 sc0 ls0 ws0">x<span class="_ _f"> </span>&gt;&gt;=<span class="_ _f"> </span>n</div><div class="t m5 x26 h26 y144c ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>ill<span class="_ _14"> </span>in<span class="_ _14"> </span>the<span class="_ _15"> </span>missing<span class="_ _14"> </span>instructions<span class="_ _1"></span>,<span class="_ _15"> </span>following<span class="_ _14"> </span>the<span class="_ _14"> </span>annotations<span class="_ _14"> </span>on<span class="_ _14"> </span>the<span class="_ _14"> </span>right.<span class="_ _14"> </span>T<span class="_ _0"></span>he</div><div class="t m5 x17 h26 y144d ff7 fs19 fc2 sc0 ls0 ws0">right<span class="_"> </span>shift<span class="_"> </span>should<span class="_"> </span>be<span class="_"> </span>performed<span class="_"> </span>arithmetically<span class="_ _3"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
