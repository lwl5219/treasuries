<div id="pf1bb" class="pf w2 h11" data-page-no="1bb"><div class="pc pc1bb w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1bb.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">442<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>4<span class="_ _3d"> </span>Processor<span class="_ _10"> </span>Architecture</span></div><div class="t m5 x29 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_ _f"> </span>an<span class="_ _e"> </span>example<span class="_ _1"></span>,<span class="_ _1f"> </span>the<span class="_ _f"> </span>HCL<span class="_ _e"> </span>description<span class="_ _f"> </span>for<span class="_ _e"> </span><span class="ff6">need_regids<span class="_ _f"> </span></span>simply<span class="_ _e"> </span>determines</div><div class="t m5 x1d h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">whether<span class="_ _14"> </span>the<span class="_ _15"> </span>value<span class="_ _15"> </span>of<span class="_ _15"> </span><span class="ff6">icode<span class="_ _15"> </span></span>is<span class="_ _15"> </span>one<span class="_ _15"> </span>of<span class="_ _14"> </span>the<span class="_ _15"> </span>instructions<span class="_ _15"> </span>that<span class="_ _15"> </span>has<span class="_ _15"> </span>a<span class="_ _15"> </span>register<span class="_ _15"> </span>speci-</div><div class="t m5 x1d h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">ﬁer<span class="_"> </span>byte:</div><div class="t m5 x1d h2d y3d1d ffd fs1e fc2 sc0 ls0 ws0">bool<span class="_ _e"> </span>need_regids<span class="_ _1f"> </span>=</div><div class="t m5 x22b h2d y3d1e ffd fs1e fc2 sc0 ls0 ws0">icode<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _1f"> </span>IRRMOVQ,<span class="_ _e"> </span>IOPQ,<span class="_ _1f"> </span>IPUSHQ,<span class="_ _e"> </span>IPOPQ,</div><div class="t m5 x1b2 h2d y3d1f ffd fs1e fc2 sc0 ls0 ws0">IIRMOVQ,<span class="_ _e"> </span>IRMMOVQ,<span class="_ _1f"> </span>IMRMOVQ<span class="_ _1f"> </span>};</div><div class="t m5 x1d h47 y3d20 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>4.19<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>523)</span></div><div class="t m5 x1d h26 y3d21 ff7 fs19 fc1 sc0 ls0 ws0">Write<span class="_"> </span>HCL<span class="_"> </span>code<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>signal<span class="_"> </span><span class="ffd">need_valC<span class="_ _10"> </span></span>in<span class="_"> </span>the<span class="_"> </span>SEQ<span class="_"> </span>implementation.</div><div class="t m5 x29 h26 y3d22 ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_ _13"> </span>F<span class="_ _1"></span>igure<span class="_ _6"> </span>4.27<span class="_ _13"> </span>shows<span class="_ _1"></span>,<span class="_ _13"> </span>the<span class="_ _6"> </span>remaining<span class="_ _13"> </span>9<span class="_ _13"> </span>bytes<span class="_ _6"> </span>read<span class="_ _13"> </span>from<span class="_ _6"> </span>the<span class="_ _13"> </span>instruction<span class="_ _6"> </span>memory</div><div class="t m5 x1d h26 y3d23 ff7 fs19 fc1 sc0 ls0 ws0">encode<span class="_ _14"> </span>some<span class="_ _16"> </span>combination<span class="_ _14"> </span>of<span class="_ _14"> </span>the<span class="_ _14"> </span>register<span class="_ _14"> </span>speciﬁer<span class="_ _14"> </span>byte<span class="_ _14"> </span>and<span class="_ _14"> </span>the<span class="_ _14"> </span>constant<span class="_ _14"> </span>word.</div><div class="t m5 x1d h26 y3d24 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>hese<span class="_ _11"> </span>bytes<span class="_"> </span>are<span class="_"> </span>processed<span class="_ _11"> </span>by<span class="_"> </span>the<span class="_"> </span>hardware<span class="_ _11"> </span>unit<span class="_"> </span>labeled<span class="_"> </span>“<span class="_ _3"></span>Align”<span class="_"> </span>into<span class="_"> </span>the<span class="_"> </span>register</div><div class="t m5 x1d h26 y3d25 ff7 fs19 fc1 sc0 ls0 ws0">ﬁelds<span class="_"> </span>and<span class="_ _13"> </span>the<span class="_"> </span>constant<span class="_"> </span>word.<span class="_ _13"> </span>Byte<span class="_"> </span>1<span class="_"> </span>is<span class="_ _13"> </span>split<span class="_"> </span>into<span class="_"> </span>register<span class="_ _13"> </span>speciﬁers<span class="_"> </span><span class="ff6">rA<span class="_ _10"> </span></span>and<span class="_ _13"> </span><span class="ff6">rB<span class="_ _10"> </span></span>when</div><div class="t m5 x1d h26 y3d26 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>computed<span class="_"> </span>signal<span class="_"> </span><span class="ff6">need_regids<span class="_ _10"> </span></span>is<span class="_"> </span>1.<span class="_"> </span>If<span class="_"> </span><span class="ff6">need_regids<span class="_ _10"> </span></span>is<span class="_"> </span>0,<span class="_"> </span>both<span class="_"> </span>register<span class="_"> </span>speciﬁers</div><div class="t m5 x1d h26 y3d27 ff7 fs19 fc1 sc0 ls0 ws0">are<span class="_ _6"> </span>set<span class="_ _6"> </span>to<span class="_ _6"> </span><span class="ffd">0xF<span class="_ _6"> </span></span>(<span class="ffd">RNONE</span>),<span class="_ _13"> </span>indicating<span class="_ _a"> </span>there<span class="_ _13"> </span>are<span class="_ _a"> </span>no<span class="_ _6"> </span>registers<span class="_ _6"> </span>speciﬁed<span class="_ _6"> </span>by<span class="_ _13"> </span>this<span class="_ _a"> </span>instruction.</div><div class="t m5 x1d h26 y3d28 ff7 fs19 fc1 sc0 ls0 ws0">Recall<span class="_"> </span>also<span class="_ _13"> </span>(F<span class="_ _1"></span>igure<span class="_"> </span>4.2)<span class="_"> </span>that<span class="_ _13"> </span>for<span class="_"> </span>any<span class="_ _13"> </span>instruction<span class="_"> </span>having<span class="_ _13"> </span>only<span class="_"> </span>one<span class="_ _13"> </span>register<span class="_"> </span>operand,</div><div class="t m5 x1d h26 y3d29 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _15"> </span>other<span class="_ _14"> </span>ﬁeld<span class="_ _15"> </span>of<span class="_ _15"> </span>the<span class="_ _15"> </span>register<span class="_ _15"> </span>speciﬁer<span class="_ _15"> </span>byte<span class="_ _15"> </span>will<span class="_ _15"> </span>be<span class="_ _15"> </span><span class="ffd">0xF<span class="_ _15"> </span></span>(<span class="ffd">RNONE</span>).<span class="_ _15"> </span>T<span class="_ _1"></span>hus<span class="_ _0"></span>,<span class="_ _21"> </span>we<span class="_ _15"> </span>can</div><div class="t m5 x1d h26 y3d2a ff7 fs19 fc1 sc0 ls0 ws0">assume<span class="_ _14"> </span>that<span class="_ _14"> </span>the<span class="_ _15"> </span>signals<span class="_ _14"> </span><span class="ff6">rA<span class="_ _14"> </span></span>and<span class="_ _15"> </span><span class="ff6">rB<span class="_ _14"> </span></span>either<span class="_ _14"> </span>encode<span class="_ _15"> </span>registers<span class="_ _14"> </span>we<span class="_ _14"> </span>want<span class="_ _15"> </span>to<span class="_ _14"> </span>access<span class="_ _14"> </span>or</div><div class="t m5 x1d h26 y3d2b ff7 fs19 fc1 sc0 ls0 ws0">indicate<span class="_ _6"> </span>that<span class="_ _6"> </span>register<span class="_ _6"> </span>access<span class="_ _a"> </span>is<span class="_ _6"> </span>not<span class="_ _6"> </span>required.<span class="_ _6"> </span>The<span class="_ _a"> </span>unit<span class="_ _6"> </span>labeled<span class="_ _6"> </span>“<span class="_ _7"></span>Align”<span class="_ _6"> </span>also<span class="_ _6"> </span>generates</div><div class="t m5 x1d h26 y3d2c ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _11"> </span>constant<span class="_ _11"> </span>word<span class="_ _11"> </span><span class="ff6">valC</span>.<span class="_ _11"> </span>T<span class="_ _0"></span>his<span class="_ _11"> </span>will<span class="_ _11"> </span>either<span class="_ _11"> </span>be<span class="_ _11"> </span>bytes<span class="_ _11"> </span>1–8<span class="_ _11"> </span>or<span class="_ _11"> </span>bytes<span class="_ _11"> </span>2–9,<span class="_ _16"> </span>depending<span class="_"> </span>on</div><div class="t m5 x1d h26 y3d2d ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>value<span class="_"> </span>of<span class="_"> </span>signal<span class="_"> </span><span class="ff6">need_regids</span>.</div><div class="t m5 x29 h26 y3d2e ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _14"> </span>PC<span class="_ _14"> </span>incrementer<span class="_ _14"> </span>hardware<span class="_ _14"> </span>unit<span class="_ _14"> </span>generates<span class="_ _14"> </span>the<span class="_ _14"> </span>signal<span class="_ _14"> </span><span class="ff6">valP</span>,<span class="_ _14"> </span>based<span class="_ _14"> </span>on<span class="_ _14"> </span>the</div><div class="t m5 x1d h26 y3d2f ff7 fs19 fc1 sc0 ls0 ws0">current<span class="_"> </span>value<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>PC,<span class="_"> </span>and<span class="_"> </span>the<span class="_"> </span>two<span class="_"> </span>signals<span class="_"> </span><span class="ff6">need_regids<span class="_ _10"> </span></span>and<span class="_"> </span><span class="ff6">need_valC</span>.<span class="_"> </span>F<span class="_ _1"></span>or<span class="_"> </span>PC</div><div class="t m5 x1d h26 y3d30 ff7 fs19 fc1 sc0 ls0 ws0">value<span class="_ _11"> </span><span class="ff11">p<span class="_ _2"></span></span>,<span class="_ _11"> </span><span class="ff6">need_regids<span class="_ _11"> </span></span>value<span class="_ _16"> </span><span class="ff11">r<span class="_ _5"></span></span>,<span class="_ _11"> </span>and<span class="_ _16"> </span><span class="ff6">need_valC<span class="_ _11"> </span></span>value<span class="_ _11"> </span><span class="ff11">i<span class="_ _5"></span></span>,<span class="_ _11"> </span>the<span class="_ _11"> </span>incrementer<span class="_ _16"> </span>generates</div><div class="t m5 x1d h46 y3d31 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>value<span class="_"> </span><span class="ff11">p<span class="_ _10"> </span><span class="ff12">+<span class="_ _10"> </span></span></span>1<span class="_ _6"> </span><span class="ff12">+<span class="_ _10"> </span><span class="ff11">r<span class="_ _11"> </span></span>+<span class="_ _10"> </span></span>8<span class="ff11">i<span class="_ _2"></span></span>.</div><div class="t m5 x1d h42 y3d32 ff6 fs29 fc6 sc0 ls0 ws0">Decode<span class="_ _11"> </span>and<span class="_ _16"> </span>Write-Back<span class="_ _11"> </span>Stages</div><div class="t m5 x1d h26 y442 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _15"> </span>4.28<span class="_ _14"> </span>provides<span class="_ _15"> </span>a<span class="_ _14"> </span>detailed<span class="_ _15"> </span>view<span class="_ _14"> </span>of<span class="_ _15"> </span>logic<span class="_ _14"> </span>that<span class="_ _15"> </span>implements<span class="_ _14"> </span>both<span class="_ _15"> </span>the<span class="_ _14"> </span>decode</div><div class="t m5 x1d h26 y443 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_"> </span>write-back<span class="_"> </span>stages<span class="_"> </span>in<span class="_"> </span>SEQ.<span class="_"> </span>T<span class="_ _1"></span>hese<span class="_"> </span>two<span class="_"> </span>stages<span class="_"> </span>are<span class="_"> </span>combined<span class="_"> </span>because<span class="_"> </span>they<span class="_"> </span>both</div><div class="t m5 x1d h26 y444 ff7 fs19 fc1 sc0 ls0 ws0">access<span class="_"> </span>the<span class="_"> </span>register<span class="_"> </span>ﬁle<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y445 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _11"> </span>register<span class="_"> </span>ﬁle<span class="_"> </span>has<span class="_ _11"> </span>four<span class="_"> </span>ports<span class="_ _1"></span>.<span class="_ _11"> </span>It<span class="_"> </span>supports<span class="_ _11"> </span>up<span class="_"> </span>to<span class="_ _11"> </span>two<span class="_"> </span>simultaneous<span class="_"> </span>reads<span class="_ _11"> </span>(on</div><div class="t m5 x1d h26 y446 ff7 fs19 fc1 sc0 ls0 ws0">ports<span class="_ _11"> </span>A<span class="_ _11"> </span>and<span class="_ _16"> </span>B)<span class="_ _11"> </span>and<span class="_ _11"> </span>two<span class="_ _16"> </span>simultaneous<span class="_ _11"> </span>writes<span class="_ _11"> </span>(on<span class="_ _16"> </span>ports<span class="_ _11"> </span>E<span class="_ _11"> </span>and<span class="_ _11"> </span>M).<span class="_ _16"> </span>Each<span class="_ _11"> </span>port<span class="_ _11"> </span>has</div><div class="t m5 x1d h26 y447 ff7 fs19 fc1 sc0 ls0 ws0">both<span class="_"> </span>an<span class="_ _13"> </span>address<span class="_"> </span>connection<span class="_ _13"> </span>and<span class="_"> </span>a<span class="_"> </span>data<span class="_ _13"> </span>connection,<span class="_"> </span>where<span class="_"> </span>the<span class="_ _13"> </span>address<span class="_"> </span>connection</div><div class="t m5 x1d h26 y448 ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_ _11"> </span>a<span class="_ _16"> </span>register<span class="_ _16"> </span>ID<span class="_ _3"></span>,<span class="_ _16"> </span>and<span class="_ _16"> </span>the<span class="_ _11"> </span>data<span class="_ _16"> </span>connection<span class="_ _11"> </span>is<span class="_ _16"> </span>a<span class="_ _16"> </span>set<span class="_ _11"> </span>of<span class="_ _16"> </span>64<span class="_ _11"> </span>wires<span class="_ _16"> </span>serving<span class="_ _16"> </span>as<span class="_ _11"> </span>either<span class="_ _16"> </span>an</div><div class="t m5 x1d h26 y449 ff7 fs19 fc1 sc0 ls0 ws0">output<span class="_ _11"> </span>word<span class="_ _16"> </span>(for<span class="_ _11"> </span>a<span class="_ _16"> </span>read<span class="_ _11"> </span>port)<span class="_ _11"> </span>or<span class="_ _16"> </span>an<span class="_ _11"> </span>input<span class="_ _16"> </span>word<span class="_ _11"> </span>(for<span class="_ _16"> </span>a<span class="_ _11"> </span>write<span class="_ _11"> </span>port)<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>register</div><div class="t m5 x1d h26 y44a ff7 fs19 fc1 sc0 ls0 ws0">ﬁle<span class="_ _1"></span>.<span class="_ _14"> </span>The<span class="_ _16"> </span>two<span class="_ _14"> </span>read<span class="_ _16"> </span>ports<span class="_ _14"> </span>have<span class="_ _14"> </span>address<span class="_ _14"> </span>inputs<span class="_ _14"> </span><span class="ff6">srcA<span class="_ _16"> </span></span>and<span class="_ _14"> </span><span class="ff6">srcB</span>,<span class="_ _14"> </span>while<span class="_ _14"> </span>the<span class="_ _16"> </span>two<span class="_ _14"> </span>write</div><div class="t m5 x1d h26 y44b ff7 fs19 fc1 sc0 ls0 ws0">ports<span class="_ _13"> </span>have<span class="_"> </span>address<span class="_ _13"> </span>inputs<span class="_"> </span><span class="ff6">dstE<span class="_ _13"> </span></span>and<span class="_"> </span><span class="ff6">dstM</span>.<span class="_ _13"> </span>The<span class="_ _13"> </span>special<span class="_"> </span>identiﬁer<span class="_ _13"> </span><span class="ffd">0xF<span class="_ _13"> </span></span>(<span class="ffd">RNONE</span><span class="ls84">)o<span class="_ _80"></span>na<span class="_ _80"></span>n</span></div><div class="t m5 x1d h26 y44c ff7 fs19 fc1 sc0 ls0 ws0">address<span class="_"> </span>port<span class="_"> </span>indicates<span class="_"> </span>that<span class="_"> </span>no<span class="_"> </span>register<span class="_"> </span>should<span class="_"> </span>be<span class="_"> </span>accessed.</div><div class="t m5 x29 h26 y44d ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _f"> </span>four<span class="_ _f"> </span>blocks<span class="_ _f"> </span>at<span class="_ _f"> </span>the<span class="_ _f"> </span>bottom<span class="_ _f"> </span>of<span class="_ _f"> </span>Figure<span class="_ _21"> </span>4.28<span class="_ _f"> </span>generate<span class="_ _f"> </span>the<span class="_ _f"> </span>four<span class="_ _f"> </span>different</div><div class="t m5 x1d h26 y44e ff7 fs19 fc1 sc0 ls0 ws0">register<span class="_"> </span>IDs<span class="_"> </span>for<span class="_ _11"> </span>the<span class="_"> </span>register<span class="_"> </span>ﬁle,<span class="_"> </span>based<span class="_"> </span>on<span class="_"> </span>the<span class="_ _11"> </span>instruction<span class="_"> </span>code<span class="_"> </span><span class="ff6">icode</span>,<span class="_ _11"> </span>the<span class="_"> </span>register</div><div class="t m5 x1d h26 y44f ff7 fs19 fc1 sc0 ls0 ws0">speciﬁers<span class="_ _6"> </span><span class="ff6">rA<span class="_ _13"> </span></span>and<span class="_ _6"> </span><span class="ff6">rB</span>,<span class="_ _13"> </span>and<span class="_ _6"> </span>possibly<span class="_ _6"> </span>the<span class="_ _13"> </span>condition<span class="_ _6"> </span>signal<span class="_ _6"> </span><span class="ff6">Cnd<span class="_ _13"> </span></span>computed<span class="_ _a"> </span>in<span class="_ _13"> </span>the<span class="_ _6"> </span>execute</div><div class="t m5 x1d h26 y3c1a ff7 fs19 fc1 sc0 ls0 ws0">stage<span class="_ _1"></span>.<span class="_ _11"> </span>Register<span class="_ _16"> </span>ID<span class="_"> </span><span class="ff6">srcA<span class="_ _11"> </span></span>indicates<span class="_ _11"> </span>which<span class="_ _11"> </span>register<span class="_ _11"> </span>should<span class="_ _11"> </span>be<span class="_ _11"> </span>read<span class="_ _11"> </span>to<span class="_ _11"> </span>generate<span class="_ _11"> </span><span class="ff6">valA</span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
