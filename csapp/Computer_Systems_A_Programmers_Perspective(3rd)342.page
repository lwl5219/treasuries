<div id="pf156" class="pf w2 h11" data-page-no="156"><div class="pc pc156 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg156.png"/><div class="t m5 x195 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>3.11<span class="_ _60"> </span>Floating-Point<span class="_ _10"> </span>Code<span class="_ _3e"> </span><span class="ffe fs1e">341</span></div><div class="t m5 x17 h31 y390 ff7 fs21 fc2 sc0 ls0 ws0">Single<span class="_ _74"> </span>Double<span class="_ _26"> </span>Effect<span class="_ _97"> </span>Description</div><div class="t m5 x17 h32 yc94 ffd fs1e fc2 sc0 ls0 ws0">vxorps<span class="_ _26"> </span>xorpd<span class="_ _74"> </span><span class="ff11 fs21">D<span class="_ _25"> </span><span class="ff12">←<span class="_ _25"> </span></span>S</span></div><div class="t m5 xb3 h33 yc95 ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 x79 h2d yc94 ffd fs1e fc2 sc0 ls0 ws0">^<span class="_ _13"> </span><span class="ff11 fs21">S</span></div><div class="t m5 xe7 h33 yc95 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x1e6 h31 yc94 ff7 fs21 fc2 sc0 ls0 ws0">Bitwise<span class="_"> </span><span class="ff9">ex<span class="_ _0"></span>clusive-or</span></div><div class="t m5 x17 h32 yc98 ffd fs1e fc2 sc0 ls0 ws0">vandps<span class="_ _26"> </span>andpd<span class="_ _74"> </span><span class="ff11 fs21">D<span class="_ _25"> </span><span class="ff12">←<span class="_ _25"> </span></span>S</span></div><div class="t m5 xb3 h33 yc97 ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 x79 h2d yc98 ffd fs1e fc2 sc0 ls0 ws0">&amp;<span class="_ _13"> </span><span class="ff11 fs21">S</span></div><div class="t m5 xe7 h33 yc97 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x1e6 h31 yc98 ff7 fs21 fc2 sc0 ls0 ws0">Bitwise<span class="_"> </span><span class="ff9">and</span></div><div class="t m5 x17 h34 y30da ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>3.50<span class="_ _c"> </span><span class="fc1">Bitwise<span class="_"> </span>operations<span class="_ _11"> </span>on<span class="_"> </span>packed<span class="_ _11"> </span>data.<span class="_ _11"> </span><span class="ff6">These<span class="_ _11"> </span>instructions<span class="_ _10"> </span>per<span class="_ _2"></span>form<span class="_ _10"> </span>Boolean</span></span></div><div class="t m5 x17 h34 y30db ff6 fs16 fc1 sc0 ls0 ws0">operations<span class="_ _10"> </span>on<span class="_ _11"> </span>all<span class="_ _10"> </span>128<span class="_ _10"> </span>bits<span class="_ _11"> </span>in<span class="_ _10"> </span>an<span class="_ _11"> </span>XMM<span class="_ _10"> </span>register<span class="_ _1"></span>.</div><div class="t m5 x17 h47 y30dc ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>3.55<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>385)</span></div><div class="t m5 x17 h26 y30dd ff7 fs19 fc1 sc0 ls0 ws0">Show<span class="_"> </span>how<span class="_"> </span>the<span class="_"> </span>numbers<span class="_"> </span>declared<span class="_"> </span>at<span class="_"> </span>label<span class="_"> </span><span class="ffd">.LC3<span class="_ _10"> </span></span>encode<span class="_"> </span>the<span class="_"> </span>number<span class="_"> </span>32.0.</div><div class="t m5 x17 h41 y30de ffe fs29 fc1 sc0 ls0 ws0">3.11.5<span class="_ _48"> </span><span class="fs19">Using<span class="_"> </span>Bitwise<span class="_"> </span>Operations<span class="_"> </span>in<span class="_"> </span>Floating-Point<span class="_"> </span>Code</span></div><div class="t m5 x17 h26 y30df ff7 fs19 fc1 sc0 ls0 ws0">At<span class="_"> </span>times<span class="_ _3"></span>,<span class="_"> </span>we<span class="_"> </span>ﬁnd<span class="_"> </span><span class="ff9">gcc<span class="_ _10"> </span></span>generating<span class="_ _13"> </span>code<span class="_"> </span>that<span class="_"> </span>performs<span class="_"> </span>bitwise<span class="_"> </span>operations<span class="_ _13"> </span>on<span class="_"> </span>XMM</div><div class="t m5 x17 h26 y30e0 ff7 fs19 fc1 sc0 ls0 ws0">registers<span class="_"> </span>to<span class="_"> </span>implement<span class="_ _11"> </span>useful<span class="_"> </span>ﬂoating-point<span class="_ _11"> </span>results<span class="_ _1"></span>.<span class="_"> </span>Figure<span class="_"> </span>3.50<span class="_"> </span>shows<span class="_"> </span>some<span class="_"> </span>rele-</div><div class="t m5 x17 h26 y30e1 ff7 fs19 fc1 sc0 ls0 ws0">vant<span class="_ _11"> </span>instructions<span class="_ _1"></span>,<span class="_ _16"> </span>similar<span class="_ _16"> </span>to<span class="_ _11"> </span>their<span class="_ _11"> </span>counterparts<span class="_ _16"> </span>for<span class="_ _11"> </span>operating<span class="_ _16"> </span>on<span class="_ _11"> </span>general-purpose</div><div class="t m5 x17 h26 y30e2 ff7 fs19 fc1 sc0 ls0 ws0">registers<span class="_ _1"></span>.<span class="_ _11"> </span>T<span class="_ _1"></span>hese<span class="_ _11"> </span>operations<span class="_ _11"> </span>all<span class="_ _11"> </span>act<span class="_ _11"> </span>on<span class="_ _11"> </span>packed<span class="_ _16"> </span>data,<span class="_"> </span>meaning<span class="_ _11"> </span>that<span class="_ _11"> </span>they<span class="_ _11"> </span>update<span class="_ _11"> </span>the</div><div class="t m5 x17 h26 y30e3 ff7 fs19 fc1 sc0 ls0 ws0">entire<span class="_"> </span>destination<span class="_ _13"> </span>XMM<span class="_"> </span>register,<span class="_ _13"> </span>applying<span class="_"> </span>the<span class="_"> </span>bitwise<span class="_ _13"> </span>operation<span class="_"> </span>to<span class="_ _13"> </span>all<span class="_"> </span>the<span class="_"> </span>data<span class="_ _13"> </span>in</div><div class="t m5 x17 h26 y30e4 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>two<span class="_"> </span>source<span class="_ _13"> </span>registers<span class="_ _1"></span>.<span class="_"> </span>Once<span class="_"> </span>again,<span class="_"> </span>our<span class="_"> </span>only<span class="_ _13"> </span>interest<span class="_"> </span>for<span class="_"> </span>scalar<span class="_"> </span>data<span class="_ _13"> </span>is<span class="_"> </span>the<span class="_"> </span>effect</div><div class="t m5 x17 h26 y30e5 ff7 fs19 fc1 sc0 ls0 ws0">these<span class="_ _13"> </span>instructions<span class="_"> </span>have<span class="_ _13"> </span>on<span class="_ _13"> </span>the<span class="_"> </span>low-order<span class="_ _13"> </span>4<span class="_ _13"> </span>or<span class="_"> </span>8<span class="_ _13"> </span>bytes<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>destination.<span class="_ _13"> </span>T<span class="_ _0"></span>hese<span class="_ _13"> </span>op-</div><div class="t m5 x17 h26 y30e6 ff7 fs19 fc1 sc0 ls0 ws0">erations<span class="_ _6"> </span>are<span class="_ _13"> </span>often<span class="_ _6"> </span>simple<span class="_ _13"> </span>and<span class="_ _6"> </span>convenient<span class="_ _6"> </span>ways<span class="_ _13"> </span>to<span class="_ _6"> </span>manipulate<span class="_ _13"> </span>ﬂoating-point<span class="_ _6"> </span>values<span class="_ _1"></span>,</div><div class="t m5 x17 h26 y30e7 ff7 fs19 fc1 sc0 ls0 ws0">as<span class="_"> </span>is<span class="_"> </span>explored<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>problem.</div><div class="t m5 x17 h47 y30e8 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>3.56<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>386)</span></div><div class="t m5 x17 h26 y30e9 ff7 fs19 fc1 sc0 ls0 ws0">Consider<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>C<span class="_"> </span>function,<span class="_"> </span>where<span class="_"> </span><span class="ffd">EXPR<span class="_ _10"> </span></span>is<span class="_"> </span>a<span class="_"> </span>macro<span class="_"> </span>deﬁned<span class="_"> </span>with<span class="_"> </span><span class="ffd">#define</span>:</div><div class="t m5 x17 h2d y30ea ffd fs1e fc2 sc0 ls0 ws0">double<span class="_ _e"> </span>simplefun(double<span class="_ _1f"> </span>x)<span class="_ _1f"> </span>{</div><div class="t m5 x1b6 h2d y30eb ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>EXPR(x);</div><div class="t m5 x17 h2d y30ec ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x26 h26 y30ed ff7 fs19 fc2 sc0 ls0 ws0">Below<span class="_ _3"></span>,<span class="_ _11"> </span>we<span class="_ _16"> </span>show<span class="_ _11"> </span>the<span class="_ _16"> </span>A<span class="_ _4"></span>VX2<span class="_ _16"> </span>code<span class="_ _11"> </span>generated<span class="_ _16"> </span>for<span class="_ _11"> </span>different<span class="_ _11"> </span>deﬁnitions<span class="_ _16"> </span>of<span class="_ _11"> </span><span class="ffd">EXPR</span>,</div><div class="t m5 x17 h26 y30ee ff7 fs19 fc2 sc0 ls0 ws0">where<span class="_ _6"> </span>value<span class="_ _13"> </span><span class="ffd">x<span class="_ _a"> </span></span>is<span class="_ _13"> </span>held<span class="_ _6"> </span>in<span class="_ _6"> </span><span class="ffd">%xmm0</span>.<span class="_ _13"> </span>All<span class="_ _6"> </span>of<span class="_ _6"> </span>them<span class="_ _13"> </span>correspond<span class="_ _6"> </span>to<span class="_ _6"> </span>some<span class="_ _13"> </span>useful<span class="_ _a"> </span>operation<span class="_ _13"> </span>on</div><div class="t m5 x17 h26 y30ef ff7 fs19 fc2 sc0 ls0 ws0">ﬂoating-point<span class="_"> </span>values<span class="_ _1"></span>.<span class="_"> </span>Identify<span class="_"> </span>what<span class="_"> </span>the<span class="_"> </span>operations<span class="_"> </span>are<span class="_ _1"></span>.<span class="_"> </span>Y<span class="_ _3"></span>our<span class="_"> </span>answers<span class="_"> </span>will<span class="_"> </span>require</div><div class="t m5 x17 h26 y30f0 ff7 fs19 fc2 sc0 ls0 ws0">you<span class="_ _14"> </span>to<span class="_ _15"> </span>understand<span class="_ _14"> </span>the<span class="_ _14"> </span>bit<span class="_ _15"> </span>patterns<span class="_ _14"> </span>of<span class="_ _15"> </span>the<span class="_ _14"> </span>constant<span class="_ _15"> </span>words<span class="_ _14"> </span>being<span class="_ _15"> </span>retrieved<span class="_ _14"> </span>from</div><div class="t m5 x17 h26 y30f1 ff7 fs19 fc2 sc0 ls0 ws0">memory<span class="_ _3"></span>.</div><div class="t m5 x34 h26 y30f2 ff7 fs19 fc2 sc0 ls0 ws0">A.</div><div class="t m5 x146 h2d y30f3 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _45"> </span><span class="ffd fs1e fc2">vmovsd<span class="_ _1a"> </span>.LC1(%rip),<span class="_ _e"> </span>%xmm1</span></div><div class="t m5 x146 h2e y30f4 ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x1b0 h2d y30f5 ffd fs1e fc2 sc0 ls0 ws0">vandpd<span class="_ _1a"> </span>%xmm1,<span class="_ _e"> </span>%xmm0,<span class="_ _1f"> </span>%xmm0</div><div class="t m5 x146 h2d y30f6 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _1c"> </span><span class="ffd fs1e fc2">.LC1:</span></div><div class="t m5 x146 h2d y30f7 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">.long<span class="_ _3f"> </span>4294967295</span></div><div class="t m5 x146 h2d y30f8 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">.long<span class="_ _3f"> </span>2147483647</span></div><div class="t m5 x146 h2d y30f9 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">.long<span class="_ _3f"> </span>0</span></div><div class="t m5 x146 h2d y30fa ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">.long<span class="_ _3f"> </span>0</span></div><div class="t m5 x34 h26 y30fb ff7 fs19 fc2 sc0 ls2a ws0">B.<span class="_ _188"> </span><span class="ff6 fs20 fc6 ls0">1<span class="_ _45"> </span><span class="ffd fs1e fc2">vxorpd<span class="_ _1a"> </span>%xmm0,<span class="_ _e"> </span>%xmm0,<span class="_ _1f"> </span>%xmm0</span></span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
