<div id="pf283" class="pf w2 h11" data-page-no="283"><div class="pc pc283 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg283.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">642<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>6<span class="_ _3d"> </span>The<span class="_ _10"> </span>Memory<span class="_ _10"> </span>Hierarchy</span></div><div class="t m5 xb h2d y3829 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">int<span class="_ _1f"> </span>sumvec(int<span class="_ _e"> </span>v[N])</span></div><div class="t m5 xb h2d y3aa2 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 xb h2d y3aa3 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2">int<span class="_ _e"> </span>i,<span class="_ _1f"> </span>sum<span class="_ _1f"> </span>=<span class="_ _e"> </span>0;</span></div><div class="t m5 xb h2e y3aa4 ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 xb h2e y5584 ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x26 h2d y3aa5 ffd fs1e fc2 sc0 ls33 ws0">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>i=0<span class="_ _41"></span>;i&lt;N<span class="_ _41"></span>;<span class="ls0">i++)</span></div><div class="t m5 xb h2d y3aa6 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _70"> </span><span class="ffd fs1e fc2">sum<span class="_ _e"> </span>+=<span class="_ _1f"> </span>v[i];</span></div><div class="t m5 xb h2d y3aa7 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _20"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>sum;</span></div><div class="t m5 xb h2d y3aa8 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x14 h26 y5585 ff7 fs19 fc2 sc0 ls0 ws0">(a)</div><div class="t m5 x9c h31 y5586 ff7 fs21 fc2 sc0 ls0 ws0">Address<span class="_ _f4"> </span>0<span class="_ _5e"> </span>4<span class="_ _95"> </span>8<span class="_ _3c"> </span>12<span class="_ _3f"> </span>16<span class="_ _3f"> </span>20<span class="_ _3f"> </span>24<span class="_ _ff"> </span>28</div><div class="t m5 x9c h31 y5587 ff7 fs21 fc2 sc0 ls0 ws0">Contents<span class="_ _131"> </span><span class="ff11">v</span></div><div class="t m5 xb1 h33 y5588 ff7 fs20 fc2 sc0 ls0 ws0">0</div><div class="t m5 x7d h55 y5589 ff11 fs21 fc2 sc0 ls0 ws0">v</div><div class="t m5 x51 h33 y5588 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x1aa h55 y5589 ff11 fs21 fc2 sc0 ls0 ws0">v</div><div class="t m5 x195 h33 y5588 ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 x18a h55 y5589 ff11 fs21 fc2 sc0 ls0 ws0">v</div><div class="t m5 x1fa h33 y5588 ff7 fs20 fc2 sc0 ls0 ws0">3</div><div class="t m5 x1e1 h55 y5589 ff11 fs21 fc2 sc0 ls0 ws0">v</div><div class="t m5 x24b h33 y5588 ff7 fs20 fc2 sc0 ls0 ws0">4</div><div class="t m5 x4e h55 y5589 ff11 fs21 fc2 sc0 ls0 ws0">v</div><div class="t m5 x16b h33 y5588 ff7 fs20 fc2 sc0 ls0 ws0">5</div><div class="t m5 x13f h55 y5589 ff11 fs21 fc2 sc0 ls0 ws0">v</div><div class="t m5 x230 h33 y5588 ff7 fs20 fc2 sc0 ls0 ws0">6</div><div class="t m5 xbc h55 y5589 ff11 fs21 fc2 sc0 ls0 ws0">v</div><div class="t m5 x1bf h33 y5588 ff7 fs20 fc2 sc0 ls0 ws0">7</div><div class="t m5 x9c h31 y558a ff7 fs21 fc2 sc0 ls0 ws0">Access<span class="_"> </span>order<span class="_ _52"> </span>1<span class="_ _95"> </span>2<span class="_ _95"> </span>3<span class="_ _79"> </span><span class="ls235">45678</span></div><div class="t m5 x9c h31 y558b ff7 fs21 fc2 sc0 ls0 ws0">(b)</div><div class="t m5 x14 h35 y558c ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _11"> </span>6.17<span class="_ _c"> </span><span class="fc1">(a)<span class="_ _11"> </span>A<span class="_ _16"> </span>function<span class="_"> </span>with<span class="_ _16"> </span>good<span class="_ _11"> </span>locality<span class="_ _1"></span>.<span class="_ _11"> </span>(b)<span class="_ _11"> </span>Reference<span class="_ _16"> </span>pattern<span class="_"> </span>for<span class="_ _16"> </span>vector<span class="_ _11"> </span><span class="ffd fs19">v<span class="_ _11"> </span></span>(<span class="ff11">N<span class="_"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ff7">8</span></span></span>).<span class="_ _16"> </span><span class="ff6">Notice<span class="_ _11"> </span>how</span></span></div><div class="t m5 x14 h34 y558d ff6 fs16 fc1 sc0 ls0 ws0">the<span class="_ _10"> </span>vector<span class="_ _11"> </span>elements<span class="_ _10"> </span>are<span class="_ _10"> </span>accessed<span class="_ _11"> </span>in<span class="_ _10"> </span>the<span class="_ _11"> </span>same<span class="_ _10"> </span>order<span class="_ _11"> </span>that<span class="_ _10"> </span>they<span class="_ _10"> </span>are<span class="_ _11"> </span>stored<span class="_ _10"> </span>in<span class="_ _11"> </span>memory<span class="_ _1"></span>.</div><div class="t m5 x1d h41 y4a9f ffe fs29 fc1 sc0 ls0 ws0">6.2.1<span class="_ _48"> </span><span class="fs19">Locality<span class="_"> </span>of<span class="_"> </span>References<span class="_"> </span>to<span class="_"> </span>Program<span class="_"> </span>Data</span></div><div class="t m5 x1d h26 y4c14 ff7 fs19 fc1 sc0 ls0 ws0">Consider<span class="_ _13"> </span>the<span class="_"> </span>simple<span class="_ _13"> </span>function<span class="_"> </span>in<span class="_ _13"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>6.17(a)<span class="_ _13"> </span>that<span class="_ _13"> </span>sums<span class="_"> </span>the<span class="_ _13"> </span>elements<span class="_"> </span>of<span class="_ _13"> </span>a<span class="_ _13"> </span>vector.</div><div class="t m5 x1d h26 y4c15 ff7 fs19 fc1 sc0 ls0 ws0">Does<span class="_ _16"> </span>this<span class="_ _14"> </span>function<span class="_ _14"> </span>have<span class="_ _16"> </span>good<span class="_ _14"> </span>locality?<span class="_ _16"> </span>T<span class="_ _3"></span>o<span class="_ _14"> </span>answer<span class="_ _16"> </span>this<span class="_ _14"> </span>question,<span class="_ _14"> </span>we<span class="_ _14"> </span>look<span class="_ _14"> </span>at<span class="_ _16"> </span>the</div><div class="t m5 x1d h26 y4c16 ff7 fs19 fc1 sc0 ls0 ws0">reference<span class="_ _13"> </span>pattern<span class="_ _13"> </span>for<span class="_ _13"> </span>each<span class="_ _13"> </span>variable<span class="_ _1"></span>.<span class="_ _13"> </span>In<span class="_ _13"> </span>this<span class="_ _13"> </span>example<span class="_ _1"></span>,<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ffd">sum<span class="_ _13"> </span></span>variable<span class="_ _13"> </span>is<span class="_ _13"> </span>referenced</div><div class="t m5 x1d h26 y4c17 ff7 fs19 fc1 sc0 ls0 ws0">once<span class="_"> </span>in<span class="_"> </span>each<span class="_"> </span>loop<span class="_"> </span>iteration,<span class="_ _11"> </span>and<span class="_"> </span>thus<span class="_"> </span>there<span class="_"> </span>is<span class="_"> </span>good<span class="_ _11"> </span>temporal<span class="_"> </span>locality<span class="_"> </span>with<span class="_"> </span>respect</div><div class="t m5 x1d h26 y4c18 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _16"> </span><span class="ffd">sum</span>.<span class="_ _16"> </span>On<span class="_ _11"> </span>the<span class="_ _16"> </span>other<span class="_ _16"> </span>hand,<span class="_ _16"> </span>since<span class="_ _16"> </span><span class="ffd">sum<span class="_ _16"> </span></span>is<span class="_ _16"> </span>a<span class="_ _16"> </span>scalar<span class="_ _0"></span>,<span class="_ _16"> </span>there<span class="_ _16"> </span>is<span class="_ _16"> </span>no<span class="_ _16"> </span>spatial<span class="_ _16"> </span>locality<span class="_ _11"> </span>with</div><div class="t m5 x1d h26 y4c19 ff7 fs19 fc1 sc0 ls0 ws0">respect<span class="_"> </span>to<span class="_"> </span><span class="ffd">sum</span>.</div><div class="t m5 x29 h26 y4c1a ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_ _6"> </span>we<span class="_ _13"> </span>see<span class="_ _6"> </span>in<span class="_ _13"> </span>F<span class="_ _1"></span>igure<span class="_ _13"> </span>6.17(b),<span class="_ _6"> </span>the<span class="_ _13"> </span>elements<span class="_ _6"> </span>of<span class="_ _13"> </span>vector<span class="_ _6"> </span><span class="ffd">v<span class="_ _13"> </span></span>are<span class="_ _6"> </span>read<span class="_ _13"> </span>sequentially<span class="_ _7"></span>,<span class="_ _13"> </span>one</div><div class="t m5 x1d h26 y4c1b ff7 fs19 fc1 sc0 ls0 ws0">after<span class="_ _6"> </span>the<span class="_ _6"> </span>other,<span class="_ _13"> </span>in<span class="_ _a"> </span>the<span class="_ _13"> </span>order<span class="_ _a"> </span>they<span class="_ _13"> </span>are<span class="_ _a"> </span>stored<span class="_ _13"> </span>in<span class="_ _6"> </span>memory<span class="_ _6"> </span>(we<span class="_ _6"> </span>assume<span class="_ _13"> </span>for<span class="_ _a"> </span>convenience</div><div class="t m5 x1d h26 y4c1c ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_ _16"> </span>the<span class="_ _11"> </span>array<span class="_ _16"> </span>starts<span class="_ _16"> </span>at<span class="_ _16"> </span>address<span class="_ _16"> </span>0).<span class="_ _16"> </span>T<span class="_ _1"></span>hus<span class="_ _1"></span>,<span class="_ _16"> </span>with<span class="_ _16"> </span>respect<span class="_ _16"> </span>to<span class="_ _16"> </span>variable<span class="_ _16"> </span><span class="ffd">v</span>,<span class="_ _16"> </span>the<span class="_ _16"> </span>function</div><div class="t m5 x1d h26 y4c1d ff7 fs19 fc1 sc0 ls0 ws0">has<span class="_ _15"> </span>good<span class="_ _15"> </span>spatial<span class="_ _15"> </span>locality<span class="_ _15"> </span>but<span class="_ _21"> </span>poor<span class="_ _15"> </span>temporal<span class="_ _15"> </span>locality<span class="_ _15"> </span>since<span class="_ _15"> </span>each<span class="_ _21"> </span>vector<span class="_ _15"> </span>element</div><div class="t m5 x1d h26 y4c1e ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_ _16"> </span>accessed<span class="_ _16"> </span>exactly<span class="_ _16"> </span>once.<span class="_ _16"> </span>Since<span class="_ _16"> </span>the<span class="_ _16"> </span>function<span class="_ _16"> </span>has<span class="_ _16"> </span>either<span class="_ _14"> </span>good<span class="_ _16"> </span>spatial<span class="_ _16"> </span>or<span class="_ _16"> </span>temporal</div><div class="t m5 x1d h26 y4c1f ff7 fs19 fc1 sc0 ls0 ws0">locality<span class="_ _11"> </span>with<span class="_ _11"> </span>respect<span class="_ _16"> </span>to<span class="_ _11"> </span>each<span class="_ _11"> </span>variable<span class="_ _16"> </span>in<span class="_"> </span>the<span class="_ _16"> </span>loop<span class="_ _11"> </span>body<span class="_ _3"></span>,<span class="_ _11"> </span>we<span class="_ _16"> </span>can<span class="_ _11"> </span>conclude<span class="_ _11"> </span>that<span class="_ _11"> </span>the</div><div class="t m5 x1d h26 y4c20 ffd fs19 fc1 sc0 ls0 ws0">sumvec<span class="_ _10"> </span><span class="ff7">function<span class="_"> </span>enjoys<span class="_"> </span>good<span class="_"> </span>locality<span class="_ _3"></span>.</span></div><div class="t m5 x29 h26 y4c21 ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_ _16"> </span>function<span class="_ _16"> </span>such<span class="_ _16"> </span>as<span class="_ _16"> </span><span class="ffd">sumvec<span class="_ _14"> </span></span>that<span class="_ _16"> </span>visits<span class="_ _16"> </span>each<span class="_ _16"> </span>element<span class="_ _16"> </span>of<span class="_ _16"> </span>a<span class="_ _14"> </span>vector<span class="_ _16"> </span>sequentially</div><div class="t m5 x1d h26 y4c22 ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_ _21"> </span>said<span class="_ _f"> </span>to<span class="_ _f"> </span>have<span class="_ _f"> </span>a<span class="_ _f"> </span><span class="ffa">stride-1<span class="_ _f"> </span>reference<span class="_ _f"> </span>pattern<span class="_ _f"> </span></span>(with<span class="_ _f"> </span>respect<span class="_ _21"> </span>to<span class="_ _f"> </span>the<span class="_ _f"> </span>element<span class="_ _f"> </span>size).</div><div class="t m5 x1d h26 y4c23 ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _f"> </span>will<span class="_ _f"> </span>sometimes<span class="_ _f"> </span>refer<span class="_ _21"> </span>to<span class="_ _f"> </span>stride-1<span class="_ _f"> </span>reference<span class="_ _f"> </span>patterns<span class="_ _f"> </span>as<span class="_ _f"> </span><span class="ffa">sequential<span class="_ _21"> </span>reference</span></div><div class="t m5 x1d h26 y4c24 ffa fs19 fc1 sc0 ls0 ws0">patterns<span class="ff7">.<span class="_ _21"> </span>V<span class="_ _1"></span>isiting<span class="_ _21"> </span>every<span class="_ _21"> </span><span class="ff11">k<span class="_ _2"></span></span>th<span class="_ _21"> </span>element<span class="_ _21"> </span>of<span class="_ _21"> </span>a<span class="_ _21"> </span>contiguous<span class="_ _21"> </span>vector<span class="_ _21"> </span>is<span class="_ _21"> </span>called<span class="_ _21"> </span>a<span class="_ _21"> </span><span class="ffa">stride-<span class="ff11">k</span></span></span></div><div class="t m5 x1d h26 y4c25 ffa fs19 fc1 sc0 ls0 ws0">reference<span class="_ _13"> </span>pattern<span class="ff7">.<span class="_ _13"> </span>Stride-1<span class="_ _13"> </span>reference<span class="_"> </span>patterns<span class="_ _13"> </span>are<span class="_ _13"> </span>a<span class="_ _13"> </span>common<span class="_"> </span>and<span class="_ _13"> </span>important<span class="_ _13"> </span>source</span></div><div class="t m5 x1d h26 y4c26 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_ _6"> </span>spatial<span class="_ _6"> </span>locality<span class="_ _6"> </span>in<span class="_ _13"> </span>programs<span class="_ _3"></span>.<span class="_ _6"> </span>In<span class="_ _13"> </span>general,<span class="_ _6"> </span>as<span class="_ _6"> </span>the<span class="_ _13"> </span>stride<span class="_ _a"> </span>increases<span class="_ _1"></span>,<span class="_ _13"> </span>the<span class="_ _6"> </span>spatial<span class="_ _6"> </span>locality</div><div class="t m5 x1d h26 y4c27 ff7 fs19 fc1 sc0 ls0 ws0">decreases<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y4c28 ff7 fs19 fc1 sc0 ls0 ws0">Stride<span class="_ _6"> </span>is<span class="_ _13"> </span>also<span class="_ _6"> </span>an<span class="_ _13"> </span>important<span class="_ _6"> </span>issue<span class="_ _6"> </span>for<span class="_ _13"> </span>programs<span class="_ _6"> </span>that<span class="_ _13"> </span>reference<span class="_ _6"> </span>multidimensional</div><div class="t m5 x1d h26 y4c29 ff7 fs19 fc1 sc0 ls0 ws0">arrays<span class="_ _1"></span>.<span class="_ _16"> </span>F<span class="_ _1"></span>or<span class="_ _16"> </span>example,<span class="_ _16"> </span>consider<span class="_ _16"> </span>the<span class="_ _16"> </span><span class="ffd">sumarrayrows<span class="_ _16"> </span></span>function<span class="_ _16"> </span>in<span class="_ _16"> </span>Figure<span class="_ _11"> </span>6.18(a)<span class="_ _14"> </span>that</div><div class="t m5 x1d h26 y4c2a ff7 fs19 fc1 sc0 ls0 ws0">sums<span class="_"> </span>the<span class="_"> </span>elements<span class="_"> </span>of<span class="_"> </span>a<span class="_"> </span>two-dimensional<span class="_"> </span>array<span class="_ _3"></span>.</div><div class="t m5 x29 h26 y4c2b ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _11"> </span>doubly<span class="_ _16"> </span>nested<span class="_ _11"> </span>loop<span class="_ _11"> </span>reads<span class="_ _11"> </span>the<span class="_ _11"> </span>elements<span class="_ _16"> </span>of<span class="_"> </span>the<span class="_ _16"> </span>array<span class="_"> </span>in<span class="_ _11"> </span><span class="ffa">row-major<span class="_ _11"> </span>order<span class="_ _2"></span></span>.</div><div class="t m5 x1d h26 y4c2c ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>hat<span class="_ _16"> </span>is<span class="_ _1"></span>,<span class="_ _14"> </span>the<span class="_ _16"> </span>inner<span class="_ _16"> </span>loop<span class="_ _16"> </span>reads<span class="_ _16"> </span>the<span class="_ _16"> </span>elements<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>ﬁrst<span class="_ _16"> </span>row<span class="_ _3"></span>,<span class="_ _14"> </span>then<span class="_ _16"> </span>the<span class="_ _16"> </span>second<span class="_ _16"> </span>row<span class="_ _3"></span>,</div><div class="t m5 x1d h26 y4c2d ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _15"> </span>so<span class="_ _21"> </span>on.<span class="_ _15"> </span>The<span class="_ _14"> </span><span class="ffd">sumarrayrows<span class="_ _21"> </span></span>function<span class="_ _21"> </span>enjoys<span class="_ _15"> </span>good<span class="_ _21"> </span>spatial<span class="_ _15"> </span>locality<span class="_ _21"> </span>because<span class="_ _15"> </span>it</div><div class="t m5 x1d h26 y4c2e ff7 fs19 fc1 sc0 ls0 ws0">references<span class="_ _16"> </span>the<span class="_ _14"> </span>array<span class="_ _14"> </span>in<span class="_ _14"> </span>the<span class="_ _16"> </span>same<span class="_ _14"> </span>row-major<span class="_ _14"> </span>order<span class="_ _14"> </span>that<span class="_ _14"> </span>the<span class="_ _16"> </span>array<span class="_ _14"> </span>is<span class="_ _14"> </span>stored<span class="_ _14"> </span>(F<span class="_ _1"></span>ig-</div><div class="t m5 x1d h26 y4c2f ff7 fs19 fc1 sc0 ls0 ws0">ure<span class="_ _11"> </span>6.18(b)).<span class="_ _11"> </span>T<span class="_ _0"></span>he<span class="_ _11"> </span>result<span class="_ _11"> </span>is<span class="_ _11"> </span>a<span class="_ _16"> </span>nice<span class="_"> </span>stride-1<span class="_ _16"> </span>reference<span class="_"> </span>pattern<span class="_ _16"> </span>with<span class="_ _11"> </span>excellent<span class="_ _11"> </span>spatial</div><div class="t m5 x1d h26 y4c30 ff7 fs19 fc1 sc0 ls0 ws0">locality<span class="_ _3"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
