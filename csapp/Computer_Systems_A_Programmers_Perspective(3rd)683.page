<div id="pf2ab" class="pf w2 h11" data-page-no="2ab"><div class="pc pc2ab w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg2ab.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">682<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>6<span class="_ _3d"> </span>The<span class="_ _10"> </span>Memory<span class="_ _10"> </span>Hierarchy</span></div><div class="t m5 x17e h84 y5b1c ff86 fs49 fc1 sc0 ls264 ws0">100</div><div class="t m5 x1cb h84 y5b1d ff86 fs49 fc1 sc0 ls264 ws0">10</div><div class="t m5 xa6 h84 y5b1e ff86 fs49 fc1 sc0 ls0 ws0">1</div><div class="t m5 x1c h84 y5b1f ff86 fs49 fc1 sc0 ls265 ws0">50<span class="_ _24"> </span>100<span class="_ _1f"> </span>150<span class="_ _e"> </span>200<span class="_ _e"> </span>250<span class="_ _e"> </span>300<span class="_ _e"> </span>350<span class="_ _1f"> </span>400<span class="_ _e"> </span>450<span class="_ _e"> </span>500<span class="_ _e"> </span>550<span class="_ _1f"> </span>600<span class="_ _e"> </span>650<span class="_ _e"> </span>700</div><div class="t m5 x9f h84 y5b20 ff7d fs49 fc1 sc0 ls266 ws0">Array size (<span class="ff5b ls0">n<span class="ff7d">)</span></span></div><div class="t m7 x10b h84 y5b21 ff7d fs49 fc1 sc0 ls267 ws0">Cycles per inner<span class="_ _0"></span>-loop iteration</div><div class="t m5 x202 h84 y5b22 ff80 fs49 fc1 sc0 ls0 ws0">jki</div><div class="t m5 x202 h84 y5b23 ff80 fs49 fc1 sc0 ls0 ws0">kji</div><div class="t m5 x202 h84 y5b24 ff80 fs49 fc1 sc0 ls0 ws0">ijk</div><div class="t m5 x202 h84 y5b25 ff80 fs49 fc1 sc0 ls0 ws0">jik</div><div class="t m5 x202 h84 y5b26 ff80 fs49 fc1 sc0 ls0 ws0">kij</div><div class="t m5 x202 h84 y5b27 ff80 fs49 fc1 sc0 ls0 ws0">ikj</div><div class="t m5 x1d h2f y5b28 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>6.46<span class="_ _66"> </span><span class="fc1">Core<span class="_"> </span>i7<span class="_"> </span>matrix<span class="_"> </span>multiply<span class="_"> </span>per<span class="_ _2"></span>formance.</span></div><div class="t m5 x1d h26 y5b29 ff7 fs19 fc1 sc0 ls0 ws0">class<span class="_ _15"> </span><span class="ff11">AB<span class="_ _f"> </span></span>routines<span class="_ _1"></span>,<span class="_ _f"> </span>which<span class="_ _15"> </span>perform<span class="_ _15"> </span>two<span class="_ _15"> </span>loads<span class="_ _15"> </span>and<span class="_ _15"> </span>no<span class="_ _15"> </span>stores).<span class="_ _15"> </span>Second,<span class="_ _21"> </span>the<span class="_ _15"> </span>inner</div><div class="t m5 x1d h26 y5b2a ff7 fs19 fc1 sc0 ls0 ws0">loop<span class="_"> </span>scans<span class="_"> </span>the<span class="_"> </span>columns<span class="_"> </span>of<span class="_"> </span><span class="ff11">A<span class="_ _10"> </span></span>and<span class="_"> </span><span class="ff11">C<span class="_"> </span></span>with<span class="_"> </span>a<span class="_"> </span>stride<span class="_"> </span>of<span class="_"> </span><span class="ff11">n</span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>result<span class="_ _11"> </span>is<span class="_"> </span>a<span class="_"> </span>miss<span class="_"> </span>on<span class="_"> </span>each</div><div class="t m5 x1d h26 y5b2b ff7 fs19 fc1 sc0 ls0 ws0">load,<span class="_ _16"> </span>for<span class="_ _11"> </span>a<span class="_ _16"> </span>total<span class="_ _16"> </span>of<span class="_ _11"> </span>two<span class="_ _16"> </span>misses<span class="_ _11"> </span>per<span class="_ _16"> </span>iteration.<span class="_ _11"> </span>Notice<span class="_ _16"> </span>that<span class="_ _16"> </span>interchanging<span class="_ _11"> </span>the<span class="_ _16"> </span>loops</div><div class="t m5 x1d h26 y5b2c ff7 fs19 fc1 sc0 ls0 ws0">has<span class="_"> </span>decreased<span class="_"> </span>the<span class="_"> </span>amount<span class="_"> </span>of<span class="_"> </span>spatial<span class="_"> </span>locality<span class="_"> </span>compared<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>class<span class="_"> </span><span class="ff11">AB<span class="_"> </span></span>routines<span class="_ _3"></span>.</div><div class="t m5 x29 h26 y5b2d ff7 fs19 fc1 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_"> </span><span class="ff11 ls12">BC<span class="_ _6"> </span></span><span class="ls0">routines<span class="_ _6"> </span>(Figure<span class="_ _a"> </span>6.44(e)<span class="_ _13"> </span>and<span class="_ _6"> </span>(f))<span class="_ _6"> </span>present<span class="_ _13"> </span>an<span class="_ _6"> </span>interesting<span class="_ _6"> </span>trade-off:<span class="_ _13"> </span>W<span class="_ _1"></span>ith</span></div><div class="t m5 x1d h26 y5b2e ff7 fs19 fc1 sc0 ls0 ws0">two<span class="_ _14"> </span>loads<span class="_ _15"> </span>and<span class="_ _15"> </span>a<span class="_ _15"> </span>store<span class="_ _0"></span>,<span class="_ _15"> </span>they<span class="_ _15"> </span>require<span class="_ _15"> </span>one<span class="_ _15"> </span>more<span class="_ _15"> </span>memory<span class="_ _15"> </span>operation<span class="_ _14"> </span>than<span class="_ _15"> </span>the<span class="_ _15"> </span><span class="ff11">AB</span></div><div class="t m5 x1d h26 y5b2f ff7 fs19 fc1 sc0 ls0 ws0">routines<span class="_ _1"></span>.<span class="_ _16"> </span>On<span class="_ _16"> </span>the<span class="_ _16"> </span>other<span class="_ _16"> </span>hand,<span class="_ _14"> </span>since<span class="_ _16"> </span>the<span class="_ _16"> </span>inner<span class="_ _16"> </span>loop<span class="_ _16"> </span>scans<span class="_ _16"> </span>both<span class="_ _16"> </span><span class="ff11">B<span class="_ _21"> </span></span>and<span class="_ _16"> </span><span class="ff11">C<span class="_ _15"> </span></span>row-wise</div><div class="t m5 x1d h26 y5b30 ff7 fs19 fc1 sc0 ls0 ws0">with<span class="_"> </span>a<span class="_ _11"> </span>stride-1<span class="_ _11"> </span>access<span class="_ _11"> </span>pattern,<span class="_ _16"> </span>the<span class="_"> </span>miss<span class="_ _11"> </span>rate<span class="_ _11"> </span>on<span class="_ _11"> </span>each<span class="_ _11"> </span>array<span class="_ _11"> </span>is<span class="_ _11"> </span>only<span class="_ _11"> </span>0.25<span class="_ _11"> </span>misses<span class="_ _11"> </span>per</div><div class="t m5 x1d h26 y5b31 ff7 fs19 fc1 sc0 ls0 ws0">iteration,<span class="_"> </span>for<span class="_"> </span>a<span class="_"> </span>total<span class="_"> </span>of<span class="_"> </span>0.50<span class="_"> </span>misses<span class="_"> </span>per<span class="_"> </span>iteration.</div><div class="t m5 x29 h26 y5b32 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_"> </span>6.46<span class="_"> </span>summarizes<span class="_"> </span>the<span class="_"> </span>performance<span class="_"> </span>of<span class="_"> </span>different<span class="_"> </span>versions<span class="_"> </span>of<span class="_"> </span>matrix<span class="_ _13"> </span>mul-</div><div class="t m5 x1d h26 y5b33 ff7 fs19 fc1 sc0 ls0 ws0">tiply<span class="_ _11"> </span>on<span class="_ _16"> </span>a<span class="_ _16"> </span>Core<span class="_ _11"> </span>i7<span class="_ _16"> </span>system.<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span>graph<span class="_ _11"> </span>plots<span class="_ _16"> </span>the<span class="_ _16"> </span>measured<span class="_ _11"> </span>number<span class="_ _16"> </span>of<span class="_ _16"> </span>CPU<span class="_ _11"> </span>cycles</div><div class="t m5 x1d h26 y5b34 ff7 fs19 fc1 sc0 ls0 ws0">per<span class="_"> </span>inner<span class="_ _1"></span>-loop<span class="_"> </span>iteration<span class="_"> </span>as<span class="_"> </span>a<span class="_"> </span>function<span class="_"> </span>of<span class="_"> </span>array<span class="_"> </span>size<span class="_"> </span>(<span class="ff11">n</span>).</div><div class="t m5 x29 h26 y5b35 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>here<span class="_"> </span>are<span class="_"> </span>a<span class="_"> </span>number<span class="_"> </span>of<span class="_"> </span>interesting<span class="_"> </span>points<span class="_"> </span>to<span class="_"> </span>notice<span class="_"> </span>about<span class="_"> </span>this<span class="_"> </span>graph:</div><div class="t m5 x75 h3d y5b36 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y2970 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_"> </span>large<span class="_ _11"> </span>values<span class="_"> </span>of<span class="_ _11"> </span><span class="ff11">n</span>,<span class="_"> </span>the<span class="_ _11"> </span>fastest<span class="_ _11"> </span>version<span class="_"> </span>runs<span class="_ _11"> </span>almost<span class="_"> </span>40<span class="_ _11"> </span>times<span class="_"> </span>faster<span class="_ _11"> </span>than<span class="_"> </span>the</div><div class="t m5 x29 h26 y5b37 ff7 fs19 fc1 sc0 ls0 ws0">slowest<span class="_ _6"> </span>version,<span class="_ _13"> </span>even<span class="_ _a"> </span>though<span class="_ _6"> </span>each<span class="_ _6"> </span>performs<span class="_ _13"> </span>the<span class="_ _a"> </span>same<span class="_ _6"> </span>number<span class="_ _6"> </span>of<span class="_ _13"> </span>ﬂoating-point</div><div class="t m5 x29 h26 y5b38 ff7 fs19 fc1 sc0 ls0 ws0">arithmetic<span class="_"> </span>operations<span class="_ _1"></span>.</div><div class="t m5 x75 h3d y5b39 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y3de7 ff7 fs19 fc1 sc0 ls0 ws0">Pairs<span class="_ _13"> </span>of<span class="_"> </span>versions<span class="_ _13"> </span>with<span class="_"> </span>the<span class="_ _13"> </span>same<span class="_"> </span>number<span class="_ _13"> </span>of<span class="_"> </span>memory<span class="_ _13"> </span>references<span class="_ _13"> </span>and<span class="_"> </span>misses<span class="_ _13"> </span>per</div><div class="t m5 x29 h26 y5b3a ff7 fs19 fc1 sc0 ls0 ws0">iteration<span class="_"> </span>have<span class="_"> </span>almost<span class="_"> </span>identical<span class="_"> </span>measured<span class="_"> </span>performance<span class="_ _1"></span>.</div><div class="t m5 x75 h3d y5766 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y12d9 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>two<span class="_ _13"> </span>versions<span class="_"> </span>with<span class="_"> </span>the<span class="_ _13"> </span>worst<span class="_"> </span>memory<span class="_ _13"> </span>behavior,<span class="_"> </span>in<span class="_ _13"> </span>terms<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>number<span class="_ _13"> </span>of</div><div class="t m5 x29 h26 y5767 ff7 fs19 fc1 sc0 ls0 ws0">accesses<span class="_"> </span>and<span class="_"> </span>misses<span class="_ _13"> </span>per<span class="_"> </span>iteration,<span class="_"> </span>run<span class="_"> </span>signiﬁcantly<span class="_"> </span>slower<span class="_ _13"> </span>than<span class="_"> </span>the<span class="_"> </span>other<span class="_"> </span>four</div><div class="t m5 x29 h26 y5768 ff7 fs19 fc1 sc0 ls0 ws0">versions<span class="_ _1"></span>,<span class="_"> </span>which<span class="_"> </span>have<span class="_"> </span>fewer<span class="_"> </span>misses<span class="_"> </span>or<span class="_"> </span>fewer<span class="_"> </span>accesses<span class="_ _1"></span>,<span class="_"> </span>or<span class="_"> </span>both.</div><div class="t m5 x75 h3d y5769 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y7a6 ff7 fs19 fc1 sc0 ls0 ws0">Miss<span class="_ _15"> </span>rate<span class="_ _0"></span>,<span class="_ _21"> </span>in<span class="_ _21"> </span>this<span class="_ _15"> </span>case,<span class="_ _15"> </span>is<span class="_ _21"> </span>a<span class="_ _15"> </span>better<span class="_ _21"> </span>predictor<span class="_ _15"> </span>of<span class="_ _21"> </span>performance<span class="_ _15"> </span>than<span class="_ _15"> </span>the<span class="_ _21"> </span>total</div><div class="t m5 x29 h26 y7a7 ff7 fs19 fc1 sc0 ls0 ws0">number<span class="_ _15"> </span>of<span class="_ _15"> </span>memory<span class="_ _15"> </span>accesses<span class="_ _1"></span>.<span class="_ _15"> </span>F<span class="_ _1"></span>or<span class="_ _15"> </span>example,<span class="_ _15"> </span>the<span class="_ _15"> </span>class<span class="_ _15"> </span><span class="ff11 ls12">BC<span class="_"> </span></span>routines<span class="_ _3"></span>,<span class="_ _21"> </span>with<span class="_ _15"> </span>0.5</div><div class="t m5 x29 h26 y7a8 ff7 fs19 fc1 sc0 ls0 ws0">misses<span class="_ _14"> </span>per<span class="_ _16"> </span>iteration,<span class="_ _15"> </span>perform<span class="_ _14"> </span>much<span class="_ _14"> </span>better<span class="_ _14"> </span>than<span class="_ _16"> </span>the<span class="_ _14"> </span>class<span class="_ _14"> </span><span class="ff11">AB<span class="_ _f"> </span></span>routines<span class="_ _1"></span>,<span class="_ _14"> </span>with</div><div class="t m5 x29 h26 y5b3b ff7 fs19 fc1 sc0 ls0 ws0">1.25<span class="_ _16"> </span>misses<span class="_ _14"> </span>per<span class="_ _16"> </span>iteration,<span class="_ _14"> </span>even<span class="_ _14"> </span>though<span class="_ _14"> </span>the<span class="_ _16"> </span>class<span class="_ _14"> </span><span class="ff11 ls12">BC<span class="_ _16"> </span></span>routines<span class="_ _16"> </span>perform<span class="_ _14"> </span>more</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
