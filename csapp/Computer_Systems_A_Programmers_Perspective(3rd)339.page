<div id="pf153" class="pf w2 h11" data-page-no="153"><div class="pc pc153 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg153.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">338<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x124 h26 ye7 ff7 fs19 fc2 sc0 ls2a ws0">B.<span class="_ _66"> </span><span class="ffd fs1e ls0">double<span class="_ _e"> </span>g2(int<span class="_ _1f"> </span>a,<span class="_ _1f"> </span>double<span class="_ _e"> </span>*b,<span class="_ _1f"> </span>float<span class="_ _e"> </span>*c,<span class="_ _1f"> </span>long<span class="_ _1f"> </span>d);</span></div><div class="t m5 x124 h26 y3075 ff7 fs19 fc2 sc0 ls22 ws0">C.<span class="_ _24"> </span><span class="ffd fs1e ls0">double<span class="_ _1f"> </span>g3(double<span class="_ _e"> </span>*a,<span class="_ _1f"> </span>double<span class="_ _e"> </span>b,<span class="_ _1f"> </span>int<span class="_ _1f"> </span>c,<span class="_ _e"> </span>float<span class="_ _1f"> </span>d);</span></div><div class="t m5 x124 h26 y3076 ff7 fs19 fc2 sc0 ls2a ws0">D.<span class="_ _24"> </span><span class="ffd fs1e ls0">double<span class="_ _e"> </span>g4(float<span class="_ _1f"> </span>a,<span class="_ _1f"> </span>int<span class="_ _e"> </span>*b,<span class="_ _1f"> </span>float<span class="_ _e"> </span>c,<span class="_ _1f"> </span>double<span class="_ _1f"> </span>d);</span></div><div class="t m5 x1d h41 y3077 ffe fs29 fc1 sc0 ls0 ws0">3.11.3<span class="_ _48"> </span><span class="fs19">Floating-Point<span class="_"> </span>Arithmetic<span class="_"> </span>Operations</span></div><div class="t m5 x1d h26 y3078 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _16"> </span>3.49<span class="_ _11"> </span>documents<span class="_ _16"> </span>a<span class="_ _11"> </span>set<span class="_ _16"> </span>of<span class="_ _11"> </span>scalar<span class="_ _16"> </span>A<span class="_ _7"></span>VX2<span class="_ _11"> </span>ﬂoating-point<span class="_ _16"> </span>instructions<span class="_ _11"> </span>that<span class="_ _16"> </span>per<span class="_ _1"></span>-</div><div class="t m5 x1d h26 y3079 ff7 fs19 fc1 sc0 ls0 ws0">form<span class="_"> </span>arithmetic<span class="_"> </span>operations<span class="_ _1"></span>.<span class="_ _11"> </span>Each<span class="_"> </span>has<span class="_ _11"> </span>either<span class="_"> </span>one<span class="_"> </span>(<span class="ff11">S</span></div><div class="t m5 x17b h3c y307a ff7 fs25 fc1 sc0 ls0 ws0">1</div><div class="t m5 x247 h26 y307b ff7 fs19 fc1 sc0 ls0 ws0">)<span class="_"> </span>or<span class="_"> </span>two<span class="_ _11"> </span>(<span class="ff11">S</span></div><div class="t m5 x111 h3c y307c ff7 fs25 fc1 sc0 ls0 ws0">1</div><div class="t m5 x1e9 h26 y307b ff7 fs19 fc1 sc0 ls0 ws0">,<span class="_"> </span><span class="ff11">S</span></div><div class="t m5 x1c1 h3c y307c ff7 fs25 fc1 sc0 ls0 ws0">2</div><div class="t m5 x97 h26 y307b ff7 fs19 fc1 sc0 ls0 ws0">)<span class="_"> </span>source<span class="_"> </span>oper<span class="_ _1"></span>-</div><div class="t m5 x1d h26 y307d ff7 fs19 fc1 sc0 ls0 ws0">ands<span class="_ _16"> </span>and<span class="_ _11"> </span>a<span class="_ _16"> </span>destination<span class="_ _16"> </span>operand<span class="_ _16"> </span><span class="ff11">D<span class="_ _2"></span></span>.<span class="_ _11"> </span>The<span class="_ _11"> </span>ﬁrst<span class="_ _16"> </span>source<span class="_ _16"> </span>operand<span class="_ _16"> </span><span class="ff11">S</span></div><div class="t m5 x43 h3c y307e ff7 fs25 fc1 sc0 ls0 ws0">1</div><div class="t m5 x46 h26 y307f ff7 fs19 fc1 sc0 ls0 ws0">can<span class="_ _16"> </span>be<span class="_ _11"> </span>either<span class="_ _16"> </span>an</div><div class="t m5 x1d h26 y3080 ff7 fs19 fc1 sc0 ls0 ws0">XMM<span class="_ _11"> </span>register<span class="_ _16"> </span>or<span class="_ _11"> </span>a<span class="_ _16"> </span>memory<span class="_ _11"> </span>location.<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span>second<span class="_ _11"> </span>source<span class="_ _11"> </span>operand<span class="_ _16"> </span>and<span class="_ _11"> </span>the<span class="_ _16"> </span>desti-</div><div class="t m5 x1d h26 y3081 ff7 fs19 fc1 sc0 ls0 ws0">nation<span class="_ _16"> </span>operands<span class="_ _16"> </span>must<span class="_ _16"> </span>be<span class="_ _16"> </span>XMM<span class="_ _11"> </span>registers<span class="_ _0"></span>.<span class="_ _16"> </span>Each<span class="_ _16"> </span>operation<span class="_ _16"> </span>has<span class="_ _11"> </span>an<span class="_ _16"> </span>instruction<span class="_ _16"> </span>for</div><div class="t m5 x1d h26 y3082 ff7 fs19 fc1 sc0 ls0 ws0">single<span class="_ _13"> </span>precision<span class="_"> </span>and<span class="_ _13"> </span>an<span class="_ _13"> </span>instruction<span class="_"> </span>for<span class="_ _13"> </span>double<span class="_ _13"> </span>precision.<span class="_ _13"> </span>The<span class="_ _13"> </span>result<span class="_ _13"> </span>is<span class="_"> </span>stored<span class="_ _13"> </span>in<span class="_ _13"> </span>the</div><div class="t m5 x1d h26 y3083 ff7 fs19 fc1 sc0 ls0 ws0">destination<span class="_"> </span>register.</div><div class="t m5 x29 h26 y3084 ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_"> </span>an<span class="_"> </span>example<span class="_ _1"></span>,<span class="_"> </span>consider<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>ﬂoating-point<span class="_"> </span>function:</div><div class="t m5 x1d h2d y3085 ffd fs1e fc2 sc0 ls0 ws0">double<span class="_ _e"> </span>funct(double<span class="_ _1f"> </span>a,<span class="_ _1f"> </span>float<span class="_ _e"> </span>x,<span class="_ _1f"> </span>double<span class="_ _e"> </span>b,<span class="_ _1f"> </span>int<span class="_ _1f"> </span>i)</div><div class="t m5 x1d h2d y3086 ffd fs1e fc2 sc0 ls0 ws0">{</div><div class="t m5 x10c h2d y3087 ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>a*x<span class="_ _1f"> </span>-<span class="_ _1f"> </span>b/i;</div><div class="t m5 x1d h2d y3088 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x29 h26 y3089 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>x86-64<span class="_"> </span>code<span class="_"> </span>is<span class="_"> </span>as<span class="_"> </span>follows:</div><div class="t m5 xad h61 y308a ff13 fs35 fc6 sc0 ls0 ws0">double<span class="_ _f"> </span>funct(double<span class="_ _f"> </span>a,<span class="_ _f"> </span>float<span class="_ _e"> </span>x,<span class="_ _21"> </span>double<span class="_ _f"> </span>b,<span class="_ _e"> </span>int<span class="_ _21"> </span>i)</div><div class="t m5 xad h61 y308b ff13 fs35 fc6 sc0 ls0 ws0">a<span class="_ _f"> </span>in<span class="_ _f"> </span>%xmm0,<span class="_ _f"> </span>x<span class="_ _e"> </span>in<span class="_ _21"> </span>%xmm1,<span class="_ _f"> </span>b<span class="_ _e"> </span>in<span class="_ _21"> </span>%xmm2,<span class="_ _f"> </span>i<span class="_ _e"> </span>in<span class="_ _21"> </span>%edi</div><div class="t m5 x1f h2d y308c ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">funct:</span></div><div class="t m5 x10d h61 y308d ff13 fs35 fc6 sc0 ls0 ws0">The<span class="_ _f"> </span>following<span class="_ _f"> </span>two<span class="_ _f"> </span>instructions<span class="_ _e"> </span>convert<span class="_ _21"> </span>x<span class="_ _f"> </span>to<span class="_ _e"> </span>double</div><div class="t m5 x1f h2d y308e ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">vunpcklps<span class="_ _6f"> </span>%xmm1,<span class="_ _1f"> </span>%xmm1,<span class="_ _e"> </span>%xmm1</span></div><div class="t m5 x1f h2e y308f ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x10d h2d y3090 ffd fs1e fc2 sc0 ls0 ws0">vcvtps2pd<span class="_ _6f"> </span>%xmm1,<span class="_ _1f"> </span>%xmm1</div><div class="t m5 x1f h2d y3091 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">vmulsd<span class="_ _1a"> </span>%xmm0,<span class="_ _e"> </span>%xmm1,<span class="_ _1f"> </span>%xmm0<span class="_ _c2"> </span></span><span class="ff13 fs35">Multiply<span class="_ _f"> </span>a<span class="_ _f"> </span>by<span class="_ _e"> </span>x</span></div><div class="t m5 x1f h2d y3092 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">vcvtsi2sd<span class="_ _6f"> </span>%edi,<span class="_ _1f"> </span>%xmm1,<span class="_ _e"> </span>%xmm1<span class="_ _95"> </span></span><span class="ff13 fs35">Convert<span class="_ _e"> </span>i<span class="_ _21"> </span>to<span class="_ _f"> </span>double</span></div><div class="t m5 x1f h2d y3093 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">vdivsd<span class="_ _1a"> </span>%xmm1,<span class="_ _e"> </span>%xmm2,<span class="_ _1f"> </span>%xmm2<span class="_ _c2"> </span></span><span class="ff13 fs35">Compute<span class="_ _f"> </span>b/i</span></div><div class="t m5 x1d h31 y3094 ff7 fs21 fc2 sc0 ls0 ws0">Single<span class="_ _74"> </span>Double<span class="_ _26"> </span>Effect<span class="_ _83"> </span>Description</div><div class="t m5 x1d h32 y3095 ffd fs1e fc2 sc0 ls0 ws0">vaddss<span class="_ _26"> </span>vaddsd<span class="_ _5e"> </span><span class="ff11 fs21">D<span class="_ _24"> </span><span class="ff12">←<span class="_ _25"> </span></span>S</span></div><div class="t m5 xaa h33 y3096 ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 x24e h32 y3095 ff12 fs21 fc2 sc0 ls0 ws0">+<span class="_ _13"> </span><span class="ff11">S</span></div><div class="t m5 x122 h33 y3096 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 xc0 h31 y3095 ff7 fs21 fc2 sc0 ls0 ws0">Floating-point<span class="_"> </span>add</div><div class="t m5 x1d h32 y3097 ffd fs1e fc2 sc0 ls0 ws0">vsubss<span class="_ _26"> </span>vsubsd<span class="_ _5e"> </span><span class="ff11 fs21">D<span class="_ _24"> </span><span class="ff12">←<span class="_ _25"> </span></span>S</span></div><div class="t m5 xaa h33 y3098 ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 x24e h32 y3097 ff12 fs21 fc2 sc0 ls0 ws0">−<span class="_ _13"> </span><span class="ff11">S</span></div><div class="t m5 x122 h33 y3098 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 xc0 h31 y3097 ff7 fs21 fc2 sc0 ls0 ws0">Floating-point<span class="_"> </span>subtract</div><div class="t m5 x1d h32 y3099 ffd fs1e fc2 sc0 ls0 ws0">vmulss<span class="_ _26"> </span>vmulsd<span class="_ _5e"> </span><span class="ff11 fs21">D<span class="_ _24"> </span><span class="ff12">←<span class="_ _25"> </span></span>S</span></div><div class="t m5 xaa h33 y309a ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 x24e h32 y3099 ff12 fs21 fc2 sc0 ls0 ws0">×<span class="_ _13"> </span><span class="ff11">S</span></div><div class="t m5 x122 h33 y309a ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 xc0 h31 y3099 ff7 fs21 fc2 sc0 ls0 ws0">Floating-point<span class="_"> </span>multiply</div><div class="t m5 x1d h32 y309b ffd fs1e fc2 sc0 ls0 ws0">vdivss<span class="_ _26"> </span>vdivsd<span class="_ _5e"> </span><span class="ff11 fs21">D<span class="_ _24"> </span><span class="ff12">←<span class="_ _25"> </span></span>S</span></div><div class="t m5 xaa h33 y309c ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 x88 h55 y309b ff11 fs21 fc2 sc0 ls0 ws0">/S</div><div class="t m5 x119 h33 y309c ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 xc0 h31 y309b ff7 fs21 fc2 sc0 ls0 ws0">Floating-point<span class="_"> </span>divide</div><div class="t m5 x1d h32 y309d ffd fs1e fc2 sc0 ls0 ws0">vmaxss<span class="_ _26"> </span>vmaxsd<span class="_ _5e"> </span><span class="ff11 fs21">D<span class="_ _24"> </span><span class="ff12">←<span class="_ _25"> </span><span class="ff7">max</span></span>(S</span></div><div class="t m5 x138 h33 y309e ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 xd2 h55 y309d ff11 fs21 fc2 sc0 ls69 ws0">,S</div><div class="t m5 x39 h33 y309e ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 x114 h31 y309d ff11 fs21 fc2 sc0 ls0 ws0">)<span class="_ _26"> </span><span class="ff7">Floating-point<span class="_"> </span>maximum</span></div><div class="t m5 x1d h2d y309f ffd fs1e fc2 sc0 ls0 ws0">vminss<span class="_ _26"> </span>vminsd</div><div class="t m5 x9c h32 y30a0 ff11 fs21 fc2 sc0 ls0 ws0">D<span class="_ _25"> </span><span class="ff12">←<span class="_ _25"> </span><span class="ff7">min</span></span>(S</div><div class="t m5 xd5 h33 y30a1 ff7 fs20 fc2 sc0 ls0 ws0">2</div><div class="t m5 x130 h55 y30a0 ff11 fs21 fc2 sc0 ls69 ws0">,S</div><div class="t m5 x23b h33 y30a1 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 xb1 h31 y30a0 ff11 fs21 fc2 sc0 ls0 ws0">)<span class="_ _7b"> </span><span class="ff7">Floating-point<span class="_"> </span>minimum</span></div><div class="t m5 x1d h32 y30a2 ffd fs1e fc2 sc0 ls0 ws0">sqrtss<span class="_ _26"> </span>sqrtsd<span class="_ _5e"> </span><span class="ff11 fs21">D<span class="_ _24"> </span><span class="ff12">←</span></span></div><div class="t m5 x197 h83 y30a3 ff1e fs21 fc2 sc0 ls0 ws0"></div><div class="t m5 x7b h55 y30a2 ff11 fs21 fc2 sc0 ls0 ws0">S</div><div class="t m5 xb8 h33 y30a4 ff7 fs20 fc2 sc0 ls0 ws0">1</div><div class="t m5 xc0 h31 y30a2 ff7 fs21 fc2 sc0 ls0 ws0">Floating-point<span class="_"> </span>square<span class="_"> </span>root</div><div class="t m5 x1d h34 y126b ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _16"> </span>3.49<span class="_ _c"> </span><span class="fc2">Scalar<span class="_ _16"> </span>ﬂoating-point<span class="_ _16"> </span>arithmetic<span class="_ _16"> </span>operations.<span class="_ _16"> </span><span class="ff6">These<span class="_ _16"> </span>have<span class="_ _16"> </span>either<span class="_ _16"> </span>one<span class="_ _16"> </span>or</span></span></div><div class="t m5 x1d h34 y126c ff6 fs16 fc2 sc0 ls0 ws0">two<span class="_ _10"> </span>source<span class="_ _10"> </span>operands<span class="_ _10"> </span>and<span class="_ _11"> </span>a<span class="_ _10"> </span>destination<span class="_ _11"> </span>operand.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
