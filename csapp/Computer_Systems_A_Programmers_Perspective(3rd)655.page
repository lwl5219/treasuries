<div id="pf28f" class="pf w2 h11" data-page-no="28f"><div class="pc pc28f w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg28f.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">654<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>6<span class="_ _3d"> </span>The<span class="_ _10"> </span>Memory<span class="_ _10"> </span>Hierarchy</span></div><div class="t m5 x14 h2f ye7 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>6.28</div><div class="t m5 x14 h2f y58a ffe fs16 fc1 sc0 ls0 ws0">Set<span class="_ _11"> </span>selection<span class="_ _11"> </span>in<span class="_ _11"> </span>a<span class="_ _16"> </span>direct-</div><div class="t m5 x14 h2f y58b ffe fs16 fc1 sc0 ls0 ws0">mapped<span class="_"> </span>cache.</div><div class="t m5 x4f he3 y5714 ff80 fs94 fc1 sc0 ls0 ws0">m<span class="_ _2"></span><span class="ff82">–1<span class="_ _129"> </span>0</span></div><div class="t m5 x64 h91 y5715 ff80 fs57 fc1 sc0 ls0 ws0">t<span class="ff82"> bits</span></div><div class="t m5 x1c4 h91 y5716 ff82 fs57 fc1 sc0 ls23f ws0">Ta<span class="_ _5"></span>g<span class="_ _7b"> </span><span class="ls0">Set index</span></div><div class="t m5 x206 h91 y5717 ff82 fs57 fc1 sc0 ls0 ws0">Block offset</div><div class="t m5 xf1 h91 y5715 ff80 fs57 fc1 sc0 ls0 ws0">s<span class="ff82"> bits<span class="_ _4c"> </span></span>b<span class="ff82"> bits</span></div><div class="t m5 xec h91 y5718 ff82 fs57 fc1 sc0 ls0 ws0">Selected set</div><div class="t m5 x1a6 h91 y5719 ff82 fs57 fc1 sc0 ls0 ws0">0 0 0 0 1</div><div class="t m5 x1ad h91 y571a ff82 fs57 fc1 sc0 ls0 ws0">V<span class="_ _1"></span>alid<span class="_ _f1"> </span>T<span class="_ _7"></span>ag<span class="_ _b9"> </span>Cache block</div><div class="t m5 xbf h91 y571b ff82 fs57 fc1 sc0 ls0 ws0">Set 0:</div><div class="t m5 x1ad h91 y571c ff82 fs57 fc1 sc0 ls0 ws0">V<span class="_ _1"></span>alid<span class="_ _f1"> </span>T<span class="_ _7"></span>ag<span class="_ _b9"> </span>Cache block</div><div class="t m5 xbf h91 y571d ff82 fs57 fc1 sc0 ls0 ws0">Set 1:</div><div class="t m5 x1ad h91 y571e ff82 fs57 fc1 sc0 ls0 ws0">V<span class="_ _1"></span>alid<span class="_ _f1"> </span>T<span class="_ _7"></span>ag<span class="_ _b9"> </span>Cache block</div><div class="t m5 x131 h91 y571f ff82 fs57 fc1 sc0 ls0 ws0">Set <span class="ff80 ls240">S–</span>1:</div><div class="t m7 x43 h91 y5720 ff82 fs57 fc1 sc0 ls0 ws0">. . .</div><div class="t m5 x14 h2f y5721 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>6.29</div><div class="t m5 x14 h2f y5722 ffe fs16 fc1 sc0 ls0 ws0">Line<span class="_"> </span>matching<span class="_ _11"> </span>and<span class="_ _11"> </span>word</div><div class="t m5 x14 h2f y5723 ffe fs16 fc1 sc0 ls0 ws0">selection<span class="_ _14"> </span>in<span class="_ _14"> </span>a<span class="_ _14"> </span>direct-</div><div class="t m5 x14 h34 y5724 ffe fs16 fc1 sc0 ls0 ws0">mapped<span class="_"> </span>cache.<span class="_"> </span><span class="ff6">W<span class="_ _0"></span>ithin<span class="_ _10"> </span>the</span></div><div class="t m5 x14 h34 y5725 ff6 fs16 fc1 sc0 ls0 ws0">cache<span class="_ _16"> </span>block,<span class="_ _16"> </span><span class="ff11">w</span></div><div class="t m5 x182 h5d y5726 ff7 fs32 fc1 sc0 ls0 ws0">0</div><div class="t m5 x1da h34 y5727 ff6 fs16 fc1 sc0 ls0 ws0">denotes</div><div class="t m5 x14 h34 y5728 ff6 fs16 fc1 sc0 ls0 ws0">the<span class="_ _11"> </span>low-order<span class="_ _11"> </span>byte<span class="_ _16"> </span>of<span class="_ _11"> </span>the</div><div class="t m5 x14 h34 y5729 ff6 fs16 fc1 sc0 ls0 ws0">word<span class="_ _11"> </span><span class="ff11">w<span class="_ _2"></span></span>,<span class="_ _10"> </span><span class="ff11">w</span></div><div class="t m5 x37 h5d y572a ff7 fs32 fc1 sc0 ls0 ws0">1</div><div class="t m5 x1a2 h34 y572b ff6 fs16 fc1 sc0 ls0 ws0">the<span class="_ _11"> </span>next<span class="_ _11"> </span>byte,</div><div class="t m5 x14 h34 y572c ff6 fs16 fc1 sc0 ls0 ws0">and<span class="_ _10"> </span>so<span class="_ _11"> </span>on.</div><div class="t m5 x13c he3 y572d ff82 fs94 fc1 sc0 ls241 ws0">01</div><div class="t m5 x15 he3 y572e ff80 fs94 fc1 sc0 ls0 ws0">m<span class="ff82">–1<span class="_ _129"> </span>0</span></div><div class="t m5 x3a he3 y572d ff82 fs94 fc1 sc0 ls241 ws0">234567</div><div class="t m5 x1d1 h91 y572f ff82 fs57 fc1 sc0 ls242 ws0">10<span class="_ _b8"></span>1<span class="_ _1cc"></span>1<span class="_ _b8"></span>0</div><div class="t m5 x17c h91 y5730 ff80 fs57 fc1 sc0 ls0 ws0">t<span class="ff82"> bits</span></div><div class="t m5 x181 h91 y5731 ff82 fs57 fc1 sc0 ls0 ws0">T<span class="_ _3"></span>ag<span class="_ _26"> </span>Set index<span class="_ _14"> </span>Block offset</div><div class="t m5 x19b h91 y5730 ff80 fs57 fc1 sc0 ls0 ws0">s<span class="ff82"> bits<span class="_ _4c"> </span></span>b<span class="ff82"> bits</span></div><div class="t m5 x121 h91 y5732 ff82 fs57 fc1 sc0 ls0 ws0">= ?</div><div class="t m5 x3b h91 y5733 ff80 fs57 fc1 sc0 ls0 ws0">w</div><div class="t m5 xb6 he3 y5734 ff82 fs94 fc1 sc0 ls0 ws0">0</div><div class="t m5 x219 h91 y5735 ff80 fs57 fc1 sc0 ls0 ws0">w</div><div class="t m5 x24b he3 y5734 ff82 fs94 fc1 sc0 ls0 ws0">1</div><div class="t m5 x172 h91 y5735 ff80 fs57 fc1 sc0 ls0 ws0">w</div><div class="t m5 x46 he3 y5734 ff82 fs94 fc1 sc0 ls0 ws0">2</div><div class="t m5 x270 h91 y5735 ff80 fs57 fc1 sc0 ls0 ws0">w</div><div class="t m5 x202 he3 y5734 ff82 fs94 fc1 sc0 ls0 ws0">3</div><div class="t m5 x17c h91 y5736 ff82 fs57 fc1 sc0 ls0 ws0">01<span class="_ _1"></span>10<span class="_ _128"> </span><span class="ff80">i<span class="_ _63"> </span></span>100</div><div class="t m5 x1e6 h91 y5737 ff82 fs57 fc1 sc0 ls0 ws0">= 1?   (1) The valid bit must be set.</div><div class="t m5 xe0 h91 y5738 ff82 fs57 fc1 sc0 ls0 ws0">Selected set (<span class="ff80">i<span class="_ _a"> </span></span>):</div><div class="t m5 x218 h91 y5739 ff82 fs57 fc1 sc0 ls0 ws0">The tag bits in the </div><div class="t m5 x7a h91 y573a ff82 fs57 fc1 sc0 ls0 ws0">cache line must </div><div class="t m5 x1a h91 y573b ff82 fs57 fc1 sc0 ls0 ws0">match the tag bits </div><div class="t m5 x7c h91 y573c ff82 fs57 fc1 sc0 ls0 ws0">in the address.</div><div class="t m5 x83 h91 y573d ff82 fs57 fc1 sc0 ls0 ws0">(3) If (1) and (2), then </div><div class="t m5 x3d h91 y573e ff82 fs57 fc1 sc0 ls0 ws0">cache hit, and</div><div class="t m5 x19e h91 y573f ff82 fs57 fc1 sc0 ls0 ws0">block offset selects </div><div class="t m5 x1c0 h91 y5740 ff82 fs57 fc1 sc0 ls0 ws0">starting byte.</div><div class="t m5 x78 h91 y5741 ff82 fs57 fc1 sc0 ls0 ws0">(2)</div><div class="t m5 x1d h42 y5742 ff6 fs29 fc6 sc0 ls0 ws0">Set<span class="_ _11"> </span>Selection<span class="_ _16"> </span>in<span class="_ _16"> </span>Direct-Mapped<span class="_ _11"> </span>Caches</div><div class="t m5 x1d h26 y5743 ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_"> </span>this<span class="_"> </span>step<span class="_ _1"></span>,<span class="_"> </span>the<span class="_ _11"> </span>cache<span class="_"> </span>extracts<span class="_"> </span>the<span class="_"> </span><span class="ff11">s<span class="_"> </span></span>set<span class="_"> </span>index<span class="_"> </span>bits<span class="_"> </span>from<span class="_"> </span>the<span class="_"> </span>middle<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>address</div><div class="t m5 x1d h26 y5744 ff7 fs19 fc1 sc0 ls0 ws0">for<span class="_"> </span><span class="ff11">w<span class="_ _2"></span></span>.<span class="_"> </span>T<span class="_ _1"></span>hese<span class="_ _11"> </span>bits<span class="_"> </span>are<span class="_"> </span>interpreted<span class="_ _11"> </span>as<span class="_"> </span>an<span class="_"> </span>unsigned<span class="_"> </span>integer<span class="_ _11"> </span>that<span class="_"> </span>corresponds<span class="_"> </span>to<span class="_"> </span>a<span class="_ _11"> </span>set</div><div class="t m5 x1d h26 y5745 ff7 fs19 fc1 sc0 ls0 ws0">number.<span class="_ _11"> </span>In<span class="_ _14"> </span>other<span class="_ _16"> </span>words<span class="_ _1"></span>,<span class="_ _14"> </span>if<span class="_ _16"> </span>we<span class="_ _16"> </span>think<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>cache<span class="_ _16"> </span>as<span class="_ _16"> </span>a<span class="_ _14"> </span>one-dimensional<span class="_ _16"> </span>array<span class="_ _16"> </span>of</div><div class="t m5 x1d h26 y5746 ff7 fs19 fc1 sc0 ls0 ws0">sets<span class="_ _1"></span>,<span class="_ _11"> </span>then<span class="_ _11"> </span>the<span class="_ _11"> </span>set<span class="_ _16"> </span>index<span class="_"> </span>bits<span class="_ _16"> </span>form<span class="_"> </span>an<span class="_ _11"> </span>index<span class="_ _16"> </span>into<span class="_"> </span>this<span class="_ _16"> </span>array<span class="_ _7"></span>.<span class="_ _11"> </span>Figure<span class="_"> </span>6.28<span class="_ _11"> </span>shows<span class="_ _11"> </span>how</div><div class="t m5 x1d h26 y5747 ff7 fs19 fc1 sc0 ls0 ws0">set<span class="_"> </span>selection<span class="_ _11"> </span>works<span class="_"> </span>for<span class="_ _11"> </span>a<span class="_"> </span>direct-mapped<span class="_ _11"> </span>cache<span class="_ _1"></span>.<span class="_ _11"> </span>In<span class="_"> </span>this<span class="_ _11"> </span>example<span class="_ _0"></span>,<span class="_"> </span>the<span class="_ _11"> </span>set<span class="_"> </span>index<span class="_ _11"> </span>bits</div><div class="t m5 x1d h26 y5748 ff7 fs19 fc1 sc0 ls0 ws0">00001</div><div class="t m5 xc4 h3c y5749 ff7 fs25 fc1 sc0 ls0 ws0">2</div><div class="t m5 x58 h26 y574a ff7 fs19 fc1 sc0 ls0 ws0">are<span class="_"> </span>interpreted<span class="_"> </span>as<span class="_"> </span>an<span class="_"> </span>integer<span class="_"> </span>index<span class="_"> </span>that<span class="_"> </span>selects<span class="_"> </span>set<span class="_"> </span>1.</div><div class="t m5 x1d h42 y574b ff6 fs29 fc6 sc0 ls0 ws0">Line<span class="_ _11"> </span>Matching<span class="_ _16"> </span>in<span class="_ _16"> </span>Direct-Mapped<span class="_ _11"> </span>Caches</div><div class="t m5 x1d h26 y631 ff7 fs19 fc1 sc0 ls0 ws0">Now<span class="_ _14"> </span>that<span class="_ _15"> </span>we<span class="_ _14"> </span>have<span class="_ _15"> </span>selected<span class="_ _15"> </span>some<span class="_ _14"> </span>set<span class="_ _15"> </span><span class="ff11">i<span class="_ _f"> </span></span>in<span class="_ _14"> </span>the<span class="_ _15"> </span>previous<span class="_ _15"> </span>step<span class="_ _1"></span>,<span class="_ _21"> </span>the<span class="_ _15"> </span>next<span class="_ _14"> </span>step<span class="_ _15"> </span>is<span class="_ _14"> </span>to</div><div class="t m5 x1d h26 y632 ff7 fs19 fc1 sc0 ls0 ws0">determine<span class="_"> </span>if<span class="_"> </span>a<span class="_"> </span>copy<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>word<span class="_"> </span><span class="ff11">w<span class="_ _11"> </span></span>is<span class="_"> </span>stored<span class="_"> </span>in<span class="_"> </span>one<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>cache<span class="_"> </span>lines<span class="_"> </span>contained<span class="_"> </span>in</div><div class="t m5 x1d h26 y633 ff7 fs19 fc1 sc0 ls0 ws0">set<span class="_ _11"> </span><span class="ff11">i<span class="_ _2"></span></span>.<span class="_ _16"> </span>In<span class="_"> </span>a<span class="_ _11"> </span>direct-mapped<span class="_ _11"> </span>cache,<span class="_"> </span>this<span class="_ _11"> </span>is<span class="_ _16"> </span>easy<span class="_"> </span>and<span class="_ _11"> </span>fast<span class="_ _11"> </span>because<span class="_ _11"> </span>there<span class="_ _16"> </span>is<span class="_"> </span>exactly<span class="_ _11"> </span>one</div><div class="t m5 x1d h26 y634 ff7 fs19 fc1 sc0 ls0 ws0">line<span class="_ _11"> </span>per<span class="_ _11"> </span>set.<span class="_ _11"> </span>A<span class="_ _16"> </span>copy<span class="_"> </span>of<span class="_ _16"> </span><span class="ff11">w<span class="_ _16"> </span></span>is<span class="_"> </span>contained<span class="_ _16"> </span>in<span class="_"> </span>the<span class="_ _16"> </span>line<span class="_"> </span>if<span class="_ _16"> </span>and<span class="_"> </span>only<span class="_ _16"> </span>if<span class="_"> </span>the<span class="_ _16"> </span>valid<span class="_ _11"> </span>bit<span class="_ _11"> </span>is<span class="_ _11"> </span>set</div><div class="t m5 x1d h26 y635 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_"> </span>the<span class="_"> </span>tag<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>cache<span class="_"> </span>line<span class="_"> </span>matches<span class="_"> </span>the<span class="_"> </span>tag<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>address<span class="_"> </span>of<span class="_"> </span><span class="ff11">w<span class="_ _2"></span></span>.</div><div class="t m5 x29 h26 y636 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_"> </span>6.29<span class="_"> </span>shows<span class="_"> </span>how<span class="_"> </span>line<span class="_"> </span>matching<span class="_"> </span>works<span class="_"> </span>in<span class="_"> </span>a<span class="_"> </span>direct-mapped<span class="_"> </span>cache<span class="_ _1"></span>.<span class="_"> </span>In<span class="_"> </span>this</div><div class="t m5 x1d h26 y637 ff7 fs19 fc1 sc0 ls0 ws0">example<span class="_ _1"></span>,<span class="_ _16"> </span>there<span class="_ _11"> </span>is<span class="_ _11"> </span>exactly<span class="_ _11"> </span>one<span class="_ _11"> </span>cache<span class="_ _16"> </span>line<span class="_ _11"> </span>in<span class="_ _11"> </span>the<span class="_ _11"> </span>selected<span class="_ _11"> </span>set.<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _11"> </span>valid<span class="_ _11"> </span>bit<span class="_ _11"> </span>for<span class="_ _16"> </span>this</div><div class="t m5 x1d h26 y638 ff7 fs19 fc1 sc0 ls0 ws0">line<span class="_"> </span>is<span class="_ _13"> </span>set,<span class="_"> </span>so<span class="_"> </span>we<span class="_"> </span>know<span class="_ _13"> </span>that<span class="_"> </span>the<span class="_"> </span>bits<span class="_"> </span>in<span class="_ _13"> </span>the<span class="_"> </span>tag<span class="_"> </span>and<span class="_ _13"> </span>block<span class="_"> </span>are<span class="_"> </span>meaningful.<span class="_"> </span>Since<span class="_ _13"> </span>the</div><div class="t m5 x1d h26 y639 ff7 fs19 fc1 sc0 ls0 ws0">tag<span class="_"> </span>bits<span class="_ _13"> </span>in<span class="_"> </span>the<span class="_"> </span>cache<span class="_ _13"> </span>line<span class="_"> </span>match<span class="_"> </span>the<span class="_ _13"> </span>tag<span class="_"> </span>bits<span class="_"> </span>in<span class="_ _13"> </span>the<span class="_"> </span>address<span class="_ _1"></span>,<span class="_"> </span>we<span class="_"> </span>know<span class="_ _13"> </span>that<span class="_"> </span>a<span class="_"> </span>copy<span class="_ _13"> </span>of</div><div class="t m5 x1d h26 y63a ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _13"> </span>word<span class="_"> </span>we<span class="_ _13"> </span>want<span class="_"> </span>is<span class="_ _13"> </span>indeed<span class="_ _13"> </span>stored<span class="_"> </span>in<span class="_ _13"> </span>the<span class="_"> </span>line<span class="_ _1"></span>.<span class="_ _13"> </span>In<span class="_"> </span>other<span class="_ _13"> </span>words<span class="_ _1"></span>,<span class="_"> </span>we<span class="_ _13"> </span>have<span class="_"> </span>a<span class="_ _13"> </span>cache<span class="_ _13"> </span>hit.</div><div class="t m5 x1d h26 y63b ff7 fs19 fc1 sc0 ls0 ws0">On<span class="_ _11"> </span>the<span class="_ _11"> </span>other<span class="_ _16"> </span>hand,<span class="_ _11"> </span>if<span class="_ _11"> </span>either<span class="_ _11"> </span>the<span class="_ _16"> </span>valid<span class="_ _11"> </span>bit<span class="_ _11"> </span>were<span class="_ _11"> </span>not<span class="_ _16"> </span>set<span class="_"> </span>or<span class="_ _16"> </span>the<span class="_ _11"> </span>tags<span class="_ _11"> </span>did<span class="_ _11"> </span>not<span class="_ _16"> </span>match,</div><div class="t m5 x1d h26 y63c ff7 fs19 fc1 sc0 ls0 ws0">then<span class="_"> </span>we<span class="_"> </span>would<span class="_"> </span>have<span class="_"> </span>had<span class="_"> </span>a<span class="_"> </span>cache<span class="_"> </span>miss<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
