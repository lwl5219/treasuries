<div id="pf3a0" class="pf w2 h11" data-page-no="3a0"><div class="pc pc3a0 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg3a0.png"/><div class="t m5 x1d8 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>10.2<span class="_ _60"> </span>Files<span class="_ _3e"> </span><span class="ffe fs1e">927</span></div><div class="t m5 x72 h26 ye7 ffa fs19 fc2 sc0 ls0 ws0">Opening<span class="_ _16"> </span>ﬁles<span class="_ _1"></span>.<span class="_ _21"> </span><span class="ff7">An<span class="_ _16"> </span>application<span class="_ _16"> </span>announces<span class="_ _16"> </span>its<span class="_ _16"> </span>intention<span class="_ _16"> </span>to<span class="_ _16"> </span>access<span class="_ _16"> </span>an<span class="_ _16"> </span>I/O<span class="_ _16"> </span>device</span></div><div class="t m5 x30 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">by<span class="_ _16"> </span>asking<span class="_ _16"> </span>the<span class="_ _16"> </span>kernel<span class="_ _16"> </span>to<span class="_ _16"> </span><span class="ffa">open<span class="_ _16"> </span></span>the<span class="_ _16"> </span>corresponding<span class="_ _16"> </span>ﬁle<span class="_ _1"></span>.<span class="_ _16"> </span>The<span class="_ _11"> </span>kernel<span class="_ _16"> </span>returns</div><div class="t m5 x30 h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">a<span class="_ _15"> </span>small<span class="_ _14"> </span>nonnegative<span class="_ _15"> </span>integer,<span class="_ _21"> </span>called<span class="_ _15"> </span>a<span class="_ _15"> </span><span class="ffa">descriptor<span class="_ _2"></span></span>,<span class="_ _21"> </span>that<span class="_ _15"> </span>identiﬁes<span class="_ _15"> </span>the<span class="_ _15"> </span>ﬁle</div><div class="t m5 x30 h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">in<span class="_ _15"> </span>all<span class="_ _15"> </span>subsequent<span class="_ _21"> </span>operations<span class="_ _15"> </span>on<span class="_ _21"> </span>the<span class="_ _15"> </span>ﬁle.<span class="_ _14"> </span>The<span class="_ _14"> </span>kernel<span class="_ _21"> </span>keeps<span class="_ _15"> </span>track<span class="_ _21"> </span>of<span class="_ _15"> </span>all</div><div class="t m5 x30 h26 y2f8 ff7 fs19 fc2 sc0 ls0 ws0">information<span class="_"> </span>about<span class="_ _11"> </span>the<span class="_ _11"> </span>open<span class="_ _11"> </span>ﬁle.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_ _11"> </span>application<span class="_ _11"> </span>only<span class="_ _11"> </span>keeps<span class="_ _11"> </span>track<span class="_ _11"> </span>of<span class="_ _11"> </span>the</div><div class="t m5 x30 h26 y2f9 ff7 fs19 fc2 sc0 ls0 ws0">descriptor.</div><div class="t m5 x20a h26 y2fa ff7 fs19 fc2 sc0 ls0 ws0">Each<span class="_ _13"> </span>process<span class="_ _6"> </span>created<span class="_ _13"> </span>by<span class="_ _6"> </span>a<span class="_ _13"> </span>Linux<span class="_ _6"> </span>shell<span class="_ _13"> </span>begins<span class="_ _13"> </span>life<span class="_ _6"> </span>with<span class="_ _13"> </span>three<span class="_ _6"> </span>open<span class="_ _13"> </span>ﬁles:</div><div class="t m5 x30 h26 y2fb ffa fs19 fc2 sc0 ls0 ws0">standard<span class="_ _a"> </span>input<span class="_"> </span><span class="ff7">(descriptor<span class="_ _6"> </span>0),<span class="_ _13"> </span></span>standar<span class="_ _0"></span>d<span class="_ _6"> </span>output<span class="_"> </span><span class="ff7">(descriptor<span class="_ _6"> </span>1),<span class="_ _13"> </span>and<span class="_ _6"> </span></span>standard</div><div class="t m5 x30 h26 y2fc ffa fs19 fc2 sc0 ls0 ws0">error<span class="_ _13"> </span><span class="ff7">(descriptor<span class="_ _13"> </span>2).<span class="_ _6"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span>header<span class="_ _6"> </span>ﬁle<span class="_ _13"> </span><span class="ffd">&lt;unistd.h&gt;<span class="_ _6"> </span></span>deﬁnes<span class="_ _13"> </span>constants<span class="_ _6"> </span><span class="ffd">STDIN_</span></span></div><div class="t m5 x30 h26 y2fd ffd fs19 fc2 sc0 ls0 ws0">FILENO<span class="ff7">,<span class="_"> </span></span>STDOUT_FILENO<span class="ff7">,<span class="_ _13"> </span>and<span class="_"> </span></span>STDERR_FILENO<span class="ff7">,<span class="_ _13"> </span>which<span class="_"> </span>can<span class="_ _13"> </span>be<span class="_"> </span>used<span class="_ _13"> </span>instead</span></div><div class="t m5 x30 h26 y2fe ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_"> </span>the<span class="_"> </span>explicit<span class="_"> </span>descriptor<span class="_"> </span>values<span class="_ _1"></span>.</div><div class="t m5 x62 h26 y3a9e ffa fs19 fc2 sc0 ls0 ws0">Changing<span class="_ _13"> </span>the<span class="_ _6"> </span>current<span class="_ _13"> </span>ﬁle<span class="_ _6"> </span>position.<span class="_ _21"> </span><span class="ff7">The<span class="_ _6"> </span>kernel<span class="_ _13"> </span>maintains<span class="_ _6"> </span>a<span class="_ _13"> </span></span>ﬁle<span class="_ _13"> </span>position<span class="_ _a"> </span><span class="ff11">k<span class="_ _2"></span><span class="ff7">,<span class="_ _13"> </span>initially</span></span></div><div class="t m5 x30 h26 y623e ff7 fs19 fc2 sc0 ls0 ws0">0,<span class="_"> </span>for<span class="_"> </span>each<span class="_ _11"> </span>open<span class="_"> </span>ﬁle.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>ﬁle<span class="_ _11"> </span>position<span class="_"> </span>is<span class="_ _11"> </span>a<span class="_"> </span>byte<span class="_ _11"> </span>offset<span class="_"> </span>from<span class="_"> </span>the<span class="_ _11"> </span>beginning</div><div class="t m5 x30 h26 y623f ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_ _16"> </span>a<span class="_ _14"> </span>ﬁle.<span class="_ _16"> </span>An<span class="_ _14"> </span>application<span class="_ _14"> </span>can<span class="_ _16"> </span>set<span class="_ _14"> </span>the<span class="_ _14"> </span>current<span class="_ _14"> </span>ﬁle<span class="_ _14"> </span>position<span class="_ _14"> </span><span class="ff11">k<span class="_ _15"> </span></span>explicitly<span class="_ _14"> </span>by</div><div class="t m5 x30 h26 y6240 ff7 fs19 fc2 sc0 ls0 ws0">performing<span class="_"> </span>a<span class="_"> </span><span class="ffa">seek<span class="_ _11"> </span></span>operation.</div><div class="t m5 x62 h26 y770e ffa fs19 fc2 sc0 ls0 ws0">Reading<span class="_ _14"> </span>and<span class="_ _14"> </span>writing<span class="_ _15"> </span>ﬁles<span class="_ _1"></span>.<span class="_ _21"> </span><span class="ff7">A<span class="_ _14"> </span></span>read<span class="_ _15"> </span><span class="ff7">operation<span class="_ _15"> </span>copies<span class="_ _14"> </span><span class="ff11 ls205">n&gt;</span>0<span class="_ _15"> </span>bytes<span class="_ _14"> </span>from<span class="_ _14"> </span>a<span class="_ _15"> </span>ﬁle<span class="_ _14"> </span>to</span></div><div class="t m5 x30 h26 y770f ff7 fs19 fc2 sc0 ls0 ws0">memory<span class="_ _3"></span>,<span class="_ _14"> </span>starting<span class="_ _16"> </span>at<span class="_ _14"> </span>the<span class="_ _16"> </span>current<span class="_ _16"> </span>ﬁle<span class="_ _14"> </span>position<span class="_ _16"> </span><span class="ff11">k<span class="_ _15"> </span></span>and<span class="_ _14"> </span>then<span class="_ _16"> </span>incrementing<span class="_ _14"> </span><span class="ff11">k</span></div><div class="t m5 x30 h26 y7710 ff7 fs19 fc2 sc0 ls0 ws0">by<span class="_ _14"> </span><span class="ff11">n</span>.<span class="_ _15"> </span>Given<span class="_ _15"> </span>a<span class="_ _14"> </span>ﬁle<span class="_ _15"> </span>with<span class="_ _15"> </span>a<span class="_ _14"> </span>size<span class="_ _15"> </span>of<span class="_ _15"> </span><span class="ff11">m<span class="_ _15"> </span></span>bytes<span class="_ _1"></span>,<span class="_ _15"> </span>performing<span class="_ _15"> </span>a<span class="_ _15"> </span>read<span class="_ _14"> </span>operation</div><div class="t m5 x30 h46 y7711 ff7 fs19 fc2 sc0 ls0 ws0">when<span class="_ _16"> </span><span class="ff11">k<span class="_ _10"> </span><span class="ff12">≥<span class="_ _10"> </span></span>m<span class="_ _16"> </span></span>triggers<span class="_ _11"> </span>a<span class="_ _16"> </span>condition<span class="_ _16"> </span>known<span class="_ _16"> </span>as<span class="_ _11"> </span><span class="ffa">end-of-ﬁle<span class="_ _16"> </span>(EOF)<span class="_ _1"></span><span class="ff7">,<span class="_ _16"> </span>which<span class="_ _16"> </span>can</span></span></div><div class="t m5 x30 h26 y7712 ff7 fs19 fc2 sc0 ls0 ws0">be<span class="_ _16"> </span>detected<span class="_ _11"> </span>by<span class="_ _16"> </span>the<span class="_ _16"> </span>application.<span class="_ _11"> </span>T<span class="_ _0"></span>here<span class="_ _16"> </span>is<span class="_ _11"> </span>no<span class="_ _16"> </span>explicit<span class="_ _16"> </span>“EOF<span class="_ _11"> </span>character”<span class="_ _16"> </span>at</div><div class="t m5 x30 h26 y7713 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>end<span class="_"> </span>of<span class="_"> </span>a<span class="_"> </span>ﬁle<span class="_ _1"></span>.</div><div class="t m5 x20a h26 y7714 ff7 fs19 fc2 sc0 ls0 ws0">Similarly<span class="_ _3"></span>,<span class="_"> </span>a<span class="_ _13"> </span><span class="ffa">write<span class="_"> </span></span>operation<span class="_"> </span>copies<span class="_"> </span><span class="ff11 ls2cf">n&gt;</span>0<span class="_ _13"> </span>bytes<span class="_"> </span>from<span class="_"> </span>memory<span class="_ _13"> </span>to<span class="_"> </span>a<span class="_"> </span>ﬁle<span class="_ _1"></span>,</div><div class="t m5 x30 h26 y7715 ff7 fs19 fc2 sc0 ls0 ws0">starting<span class="_"> </span>at<span class="_"> </span>the<span class="_"> </span>current<span class="_"> </span>ﬁle<span class="_"> </span>position<span class="_"> </span><span class="ff11">k<span class="_ _11"> </span></span>and<span class="_"> </span>then<span class="_"> </span>updating<span class="_"> </span><span class="ff11">k<span class="_ _2"></span></span>.</div><div class="t m5 x62 h26 y7716 ffa fs19 fc2 sc0 ls0 ws0">Closing<span class="_ _16"> </span>ﬁles<span class="_ _1"></span>.<span class="_ _21"> </span><span class="ff7">When<span class="_ _16"> </span>an<span class="_ _16"> </span>application<span class="_ _16"> </span>has<span class="_ _16"> </span>ﬁnished<span class="_ _14"> </span>accessing<span class="_ _16"> </span>a<span class="_ _16"> </span>ﬁle<span class="_ _0"></span>,<span class="_ _14"> </span>it<span class="_ _16"> </span>informs<span class="_ _16"> </span>the</span></div><div class="t m5 x30 h26 y7717 ff7 fs19 fc2 sc0 ls0 ws0">kernel<span class="_ _e"> </span>by<span class="_ _e"> </span>asking<span class="_ _f"> </span>it<span class="_ _e"> </span>to<span class="_ _e"> </span><span class="ffa">close<span class="_ _e"> </span></span>the<span class="_ _e"> </span>ﬁle<span class="_ _1"></span>.<span class="_ _e"> </span>T<span class="_ _1"></span>he<span class="_ _e"> </span>kernel<span class="_ _e"> </span>responds<span class="_ _f"> </span>by<span class="_ _e"> </span>freeing</div><div class="t m5 x30 h26 y7718 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>data<span class="_"> </span>structures<span class="_"> </span>it<span class="_"> </span>created<span class="_"> </span>when<span class="_"> </span>the<span class="_"> </span>ﬁle<span class="_"> </span>was<span class="_"> </span>opened<span class="_"> </span>and<span class="_"> </span>restoring<span class="_"> </span>the</div><div class="t m5 x30 h26 y7719 ff7 fs19 fc2 sc0 ls0 ws0">descriptor<span class="_ _11"> </span>to<span class="_ _11"> </span>a<span class="_ _11"> </span>pool<span class="_ _11"> </span>of<span class="_ _11"> </span>available<span class="_ _11"> </span>descriptors<span class="_ _1"></span>.<span class="_ _11"> </span>When<span class="_ _11"> </span>a<span class="_ _11"> </span>process<span class="_ _11"> </span>terminates</div><div class="t m5 x30 h26 y771a ff7 fs19 fc2 sc0 ls0 ws0">for<span class="_ _14"> </span>any<span class="_ _14"> </span>reason,<span class="_ _14"> </span>the<span class="_ _14"> </span>kernel<span class="_ _14"> </span>closes<span class="_ _14"> </span>all<span class="_ _14"> </span>open<span class="_ _14"> </span>ﬁles<span class="_ _14"> </span>and<span class="_ _14"> </span>frees<span class="_ _14"> </span>their<span class="_ _14"> </span>memory</div><div class="t m5 x30 h26 y771b ff7 fs19 fc2 sc0 ls0 ws0">resources<span class="_ _1"></span>.</div><div class="t m5 x17 h3b y771c fff fs24 fc6 sc0 ls0 ws0">10.2<span class="_ _17"> </span><span class="ffe fs18">Files</span></div><div class="t m5 x17 h26 y771d ff7 fs19 fc1 sc0 ls0 ws0">Each<span class="_"> </span>Linux<span class="_"> </span>ﬁle<span class="_"> </span>has<span class="_"> </span>a<span class="_"> </span><span class="ffa">type<span class="_"> </span></span>that<span class="_"> </span>indicates<span class="_"> </span>its<span class="_"> </span>role<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>system:</div><div class="t m5 x72 h3d y2d14 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y2d15 ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_ _13"> </span><span class="ffa">regular<span class="_"> </span>ﬁle<span class="_ _13"> </span></span>contains<span class="_"> </span>arbitrary<span class="_ _13"> </span>data.<span class="_"> </span>Application<span class="_ _13"> </span>programs<span class="_"> </span>often<span class="_ _13"> </span>distinguish</div><div class="t m5 x26 h26 y2d16 ff7 fs19 fc1 sc0 ls0 ws0">between<span class="_"> </span><span class="ffa">text<span class="_ _13"> </span>ﬁles</span>,<span class="_"> </span>which<span class="_ _13"> </span>are<span class="_"> </span>regular<span class="_ _13"> </span>ﬁles<span class="_"> </span>that<span class="_"> </span>contain<span class="_ _13"> </span>only<span class="_"> </span>ASCII<span class="_ _13"> </span>or<span class="_"> </span>Unicode</div><div class="t m5 x26 h26 y2d17 ff7 fs19 fc1 sc0 ls0 ws0">characters<span class="_ _1"></span>,<span class="_ _11"> </span>and<span class="_ _11"> </span><span class="ffa">binary<span class="_ _11"> </span>ﬁles</span>,<span class="_ _16"> </span>which<span class="_ _11"> </span>are<span class="_ _11"> </span>everything<span class="_ _11"> </span>else<span class="_ _0"></span>.<span class="_ _11"> </span>T<span class="_ _7"></span>o<span class="_ _16"> </span>the<span class="_"> </span>kernel<span class="_ _11"> </span>there<span class="_ _16"> </span>is</div><div class="t m5 x26 h26 y771e ff7 fs19 fc1 sc0 ls0 ws0">no<span class="_"> </span>difference<span class="_"> </span>between<span class="_"> </span>text<span class="_"> </span>and<span class="_"> </span>binary<span class="_"> </span>ﬁles<span class="_ _1"></span>.</div><div class="t m5 x30 h26 y771f ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_"> </span>Linux<span class="_ _11"> </span>text<span class="_ _11"> </span>ﬁle<span class="_ _11"> </span>consists<span class="_"> </span>of<span class="_ _11"> </span>a<span class="_ _11"> </span>sequence<span class="_ _11"> </span>of<span class="_"> </span><span class="ffa">text<span class="_ _11"> </span>lines</span>,<span class="_ _11"> </span>where<span class="_ _11"> </span>each<span class="_ _11"> </span>line<span class="_"> </span>is<span class="_ _11"> </span>a</div><div class="t m5 x26 h26 y7720 ff7 fs19 fc1 sc0 ls0 ws0">sequence<span class="_"> </span>of<span class="_ _13"> </span>characters<span class="_"> </span>terminated<span class="_ _13"> </span>by<span class="_"> </span>a<span class="_ _13"> </span><span class="ffa">newline<span class="_"> </span></span>character<span class="_"> </span>(‘<span class="ffd">\n</span>’).<span class="_ _13"> </span>T<span class="_ _0"></span>he<span class="_"> </span>newline</div><div class="t m5 x26 h26 y7721 ff7 fs19 fc1 sc0 ls0 ws0">character<span class="_ _13"> </span>is<span class="_ _13"> </span>the<span class="_ _13"> </span>same<span class="_ _13"> </span>as<span class="_ _13"> </span>the<span class="_ _13"> </span>ASCII<span class="_ _13"> </span>line<span class="_ _13"> </span>feed<span class="_ _13"> </span>character<span class="_ _13"> </span>(LF)<span class="_ _13"> </span>and<span class="_ _13"> </span>has<span class="_ _6"> </span>a<span class="_ _13"> </span>numeric</div><div class="t m5 x26 h26 y7722 ff7 fs19 fc1 sc0 ls0 ws0">value<span class="_"> </span>of<span class="_"> </span><span class="ffd">0x0a</span>.</div><div class="t m5 x72 h3d y77d ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y77e ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_ _16"> </span><span class="ffa">directory<span class="_ _14"> </span></span>is<span class="_ _16"> </span>a<span class="_ _14"> </span>ﬁle<span class="_ _16"> </span>consisting<span class="_ _14"> </span>of<span class="_ _14"> </span>an<span class="_ _16"> </span>array<span class="_ _14"> </span>of<span class="_ _14"> </span><span class="ffa">links</span>,<span class="_ _14"> </span>where<span class="_ _14"> </span>each<span class="_ _16"> </span>link<span class="_ _14"> </span>maps<span class="_ _16"> </span>a</div><div class="t m5 x26 h26 y77f ffa fs19 fc1 sc0 ls0 ws0">ﬁlename<span class="_"> </span><span class="ff7">to<span class="_"> </span>a<span class="_"> </span>ﬁle<span class="_ _1"></span>,<span class="_"> </span>which<span class="_"> </span>may<span class="_ _13"> </span>be<span class="_"> </span>another<span class="_"> </span>directory<span class="_ _3"></span>.<span class="_"> </span>Each<span class="_"> </span>directory<span class="_ _13"> </span>contains<span class="_"> </span>at</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
