<div id="pfd7" class="pf w2 h11" data-page-no="d7"><div class="pc pcd7 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bgd7.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">214<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x28 h2a y257 fff fs1c fc2 sc0 ls0 ws0">W<span class="_ _1"></span>eb<span class="_ _16"> </span>Aside<span class="_ _14"> </span>ASM:EASM<span class="_ _1b"> </span><span class="ff6 fs19">Combining<span class="_ _11"> </span>assembly<span class="_ _11"> </span>code<span class="_ _11"> </span>with<span class="_ _16"> </span>C<span class="_ _11"> </span>programs</span></div><div class="t m5 x28 h2b y2d0 ff7 fs1e fc2 sc0 ls0 ws0">Although<span class="_ _11"> </span>a<span class="_ _11"> </span>C<span class="_ _11"> </span>compiler<span class="_ _11"> </span>does<span class="_ _11"> </span>a<span class="_ _11"> </span>good<span class="_ _11"> </span>job<span class="_ _11"> </span>of<span class="_ _11"> </span>converting<span class="_ _11"> </span>the<span class="_ _11"> </span>computations<span class="_ _11"> </span>expressed<span class="_ _11"> </span>in<span class="_ _11"> </span>a<span class="_ _11"> </span>program<span class="_ _11"> </span>into</div><div class="t m5 x28 h2b y2d1 ff7 fs1e fc2 sc0 ls0 ws0">machine<span class="_ _14"> </span>code<span class="_ _1"></span>,<span class="_ _15"> </span>there<span class="_ _14"> </span>are<span class="_ _14"> </span>some<span class="_ _14"> </span>features<span class="_ _14"> </span>of<span class="_ _14"> </span>a<span class="_ _14"> </span>machine<span class="_ _16"> </span>that<span class="_ _14"> </span>cannot<span class="_ _14"> </span>be<span class="_ _14"> </span>accessed<span class="_ _14"> </span>by<span class="_ _14"> </span>a<span class="_ _14"> </span>C<span class="_ _14"> </span>program.<span class="_ _14"> </span>F<span class="_ _1"></span>or</div><div class="t m5 x28 h2b y2d2 ff7 fs1e fc2 sc0 ls0 ws0">example<span class="_ _1"></span>,<span class="_ _15"> </span>every<span class="_ _16"> </span>time<span class="_ _14"> </span>an<span class="_ _14"> </span>x86-64<span class="_ _16"> </span>processor<span class="_ _14"> </span>executes<span class="_ _14"> </span>an<span class="_ _16"> </span>arithmetic<span class="_ _14"> </span>or<span class="_ _16"> </span>logical<span class="_ _14"> </span>operation,<span class="_ _14"> </span>it<span class="_ _14"> </span>sets<span class="_ _14"> </span>a<span class="_ _16"> </span>1-bit</div><div class="t m5 x28 h2b y2d3 ffa fs1e fc2 sc0 ls0 ws0">condition<span class="_ _13"> </span>code<span class="_ _6"> </span><span class="ff7">ﬂag,<span class="_ _13"> </span>named<span class="_ _6"> </span><span class="ffd">PF<span class="_ _13"> </span></span>(for<span class="_ _6"> </span>“parity<span class="_ _13"> </span>ﬂag”),<span class="_ _13"> </span>to<span class="_ _6"> </span>1<span class="_ _13"> </span>when<span class="_ _6"> </span>the<span class="_ _13"> </span>lower<span class="_ _13"> </span>8<span class="_ _6"> </span>bits<span class="_ _13"> </span>in<span class="_ _6"> </span>the<span class="_ _13"> </span>resulting<span class="_ _6"> </span>computation</span></div><div class="t m5 x28 h2b y2d4 ff7 fs1e fc2 sc0 ls0 ws0">have<span class="_ _11"> </span>an<span class="_ _16"> </span>even<span class="_ _16"> </span>number<span class="_ _11"> </span>of<span class="_ _16"> </span>ones<span class="_ _11"> </span>and<span class="_ _16"> </span>to<span class="_ _11"> </span>0<span class="_ _16"> </span>otherwise<span class="_ _0"></span>.<span class="_ _11"> </span>Computing<span class="_ _16"> </span>this<span class="_ _16"> </span>information<span class="_ _11"> </span>in<span class="_ _16"> </span>C<span class="_ _11"> </span>requires<span class="_ _16"> </span>at<span class="_ _11"> </span>least</div><div class="t m5 x28 h2b y2d5 ff7 fs1e fc2 sc0 ls0 ws0">seven<span class="_ _10"> </span>shifting,<span class="_ _11"> </span>masking,<span class="_"> </span>and<span class="_ _11"> </span><span class="ff9">ex<span class="_ _0"></span>clusive-or<span class="_ _10"> </span><span class="ff7">operations<span class="_ _11"> </span>(see<span class="_ _11"> </span>Problem<span class="_"> </span>2.65).<span class="_ _11"> </span>Even<span class="_ _11"> </span>though<span class="_"> </span>the<span class="_ _11"> </span>hardware</span></span></div><div class="t m5 x28 h2b y2d6 ff7 fs1e fc2 sc0 ls0 ws0">performs<span class="_ _16"> </span>this<span class="_ _16"> </span>computation<span class="_ _14"> </span>as<span class="_ _16"> </span>part<span class="_ _14"> </span>of<span class="_ _16"> </span>every<span class="_ _16"> </span>arithmetic<span class="_ _14"> </span>or<span class="_ _16"> </span>logical<span class="_ _14"> </span>operation,<span class="_ _14"> </span>there<span class="_ _16"> </span>is<span class="_ _14"> </span>no<span class="_ _16"> </span>way<span class="_ _16"> </span>for<span class="_ _14"> </span>a<span class="_ _16"> </span>C</div><div class="t m5 x28 h2b y549 ff7 fs1e fc2 sc0 ls0 ws0">program<span class="_ _11"> </span>to<span class="_ _10"> </span>determine<span class="_ _11"> </span>the<span class="_ _11"> </span>value<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span><span class="ffd">PF<span class="_ _11"> </span></span>condition<span class="_ _11"> </span>code<span class="_ _10"> </span>ﬂag.<span class="_ _11"> </span>T<span class="_ _1"></span>his<span class="_ _11"> </span>task<span class="_ _11"> </span>can<span class="_ _11"> </span>readily<span class="_ _11"> </span>be<span class="_ _11"> </span>performed<span class="_ _11"> </span>by</div><div class="t m5 x28 h2b y54a ff7 fs1e fc2 sc0 ls0 ws0">incorporating<span class="_"> </span>a<span class="_"> </span>small<span class="_"> </span>number<span class="_"> </span>of<span class="_"> </span>assembly-code<span class="_"> </span>instructions<span class="_"> </span>into<span class="_"> </span>the<span class="_"> </span>program.</div><div class="t m5 x57 h2b y54b ff7 fs1e fc2 sc0 ls0 ws0">T<span class="_ _1"></span>here<span class="_ _11"> </span>are<span class="_ _16"> </span>two<span class="_ _11"> </span>ways<span class="_ _11"> </span>to<span class="_ _11"> </span>incorporate<span class="_ _11"> </span>assembly<span class="_ _11"> </span>code<span class="_ _11"> </span>into<span class="_ _11"> </span>C<span class="_ _16"> </span>programs<span class="_ _1"></span>.<span class="_ _11"> </span>F<span class="_ _1"></span>irst,<span class="_ _16"> </span>we<span class="_ _11"> </span>can<span class="_ _11"> </span>write<span class="_ _11"> </span>an<span class="_ _11"> </span>entire</div><div class="t m5 x28 h2b y54c ff7 fs1e fc2 sc0 ls0 ws0">function<span class="_"> </span>as<span class="_ _11"> </span>a<span class="_ _10"> </span>separate<span class="_ _11"> </span>assembly-code<span class="_ _10"> </span>ﬁle<span class="_ _11"> </span>and<span class="_ _10"> </span>let<span class="_ _11"> </span>the<span class="_ _10"> </span>assembler<span class="_ _11"> </span>and<span class="_ _10"> </span>linker<span class="_ _11"> </span>combine<span class="_ _10"> </span>this<span class="_ _11"> </span>with<span class="_"> </span>code<span class="_ _11"> </span>we</div><div class="t m5 x28 h2b y54d ff7 fs1e fc2 sc0 ls0 ws0">have<span class="_ _a"> </span>written<span class="_ _6"> </span>in<span class="_ _6"> </span>C.<span class="_ _a"> </span>Second,<span class="_ _6"> </span>we<span class="_ _6"> </span>can<span class="_ _6"> </span>use<span class="_ _6"> </span>the<span class="_ _6"> </span><span class="ffa">inline<span class="_ _a"> </span>assembly<span class="_ _6"> </span></span>feature<span class="_ _6"> </span>of<span class="_ _a"> </span><span class="ff9">gcc</span>,<span class="_ _13"> </span>where<span class="_ _a"> </span>brief<span class="_ _6"> </span>sections<span class="_ _6"> </span>of<span class="_ _a"> </span>assembly</div><div class="t m5 x28 h2b y54e ff7 fs1e fc2 sc0 ls0 ws0">code<span class="_ _10"> </span>can<span class="_ _11"> </span>be<span class="_ _11"> </span>incorporated<span class="_ _10"> </span>into<span class="_ _11"> </span>a<span class="_ _11"> </span>C<span class="_ _10"> </span>program<span class="_ _11"> </span>using<span class="_ _11"> </span>the<span class="_ _10"> </span><span class="ffd">asm<span class="_ _11"> </span></span>directive<span class="_ _0"></span>.<span class="_ _10"> </span>This<span class="_"> </span>approach<span class="_ _11"> </span>has<span class="_ _11"> </span>the<span class="_"> </span>advantage</div><div class="t m5 x28 h2b y70b ff7 fs1e fc2 sc0 ls0 ws0">that<span class="_"> </span>it<span class="_"> </span>minimizes<span class="_"> </span>the<span class="_"> </span>amount<span class="_"> </span>of<span class="_"> </span>machine-speciﬁc<span class="_"> </span>code<span class="_ _1"></span>.</div><div class="t m5 x57 h2b y70c ff7 fs1e fc2 sc0 ls0 ws0">Of<span class="_"> </span>course<span class="_ _1"></span>,<span class="_"> </span>including<span class="_"> </span>assembly<span class="_ _13"> </span>code<span class="_"> </span>in<span class="_"> </span>a<span class="_ _13"> </span>C<span class="_"> </span>program<span class="_"> </span>makes<span class="_ _13"> </span>the<span class="_"> </span>code<span class="_"> </span>speciﬁc<span class="_ _13"> </span>to<span class="_"> </span>a<span class="_"> </span>particular<span class="_ _13"> </span>class<span class="_"> </span>of</div><div class="t m5 x28 h2b y70d ff7 fs1e fc2 sc0 ls0 ws0">machines<span class="_ _13"> </span>(such<span class="_ _13"> </span>as<span class="_ _13"> </span>x86-64),<span class="_"> </span>and<span class="_ _13"> </span>so<span class="_ _13"> </span>it<span class="_ _13"> </span>should<span class="_ _13"> </span>only<span class="_ _13"> </span>be<span class="_ _13"> </span>used<span class="_ _13"> </span>when<span class="_ _13"> </span>the<span class="_ _13"> </span>desired<span class="_"> </span>feature<span class="_ _13"> </span>can<span class="_ _13"> </span>only<span class="_ _13"> </span>be<span class="_ _13"> </span>accessed</div><div class="t m5 x28 h2b y70e ff7 fs1e fc2 sc0 ls0 ws0">in<span class="_"> </span>this<span class="_"> </span>way<span class="_ _3"></span>.</div><div class="t m5 x1d h31 y216e ff7 fs21 fc2 sc0 ls0 ws0">C<span class="_"> </span>declaration<span class="_ _26"> </span>Intel<span class="_"> </span>data<span class="_"> </span>type<span class="_ _62"> </span>Assembly-code<span class="_"> </span>sufﬁx<span class="_ _26"> </span>Size<span class="_"> </span>(bytes)</div><div class="t m5 x1d h31 y216f ffd fs1e fc2 sc0 ls0 ws0">char<span class="_ _110"> </span><span class="ff7 fs21">Byte<span class="_ _9f"> </span></span>b<span class="_ _11b"> </span><span class="ff7 fs21">1</span></div><div class="t m5 x1d h31 y2170 ffd fs1e fc2 sc0 ls0 ws0">short<span class="_ _7d"> </span><span class="ff7 fs21">W<span class="_ _3"></span>ord<span class="_ _12d"> </span><span class="ffd fs1e">w<span class="_ _11b"> </span></span>2</span></div><div class="t m5 x1d h31 y2171 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _12e"> </span><span class="ff7 fs21">Double<span class="_"> </span>word<span class="_ _10c"> </span></span>l<span class="_ _12a"> </span><span class="ff7 fs21">4</span></div><div class="t m5 x1d h31 y2172 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _110"> </span><span class="ff7 fs21">Quad<span class="_"> </span>word<span class="_ _e5"> </span></span>q<span class="_ _11b"> </span><span class="ff7 fs21">8</span></div><div class="t m5 x1d h2d y2173 ffd fs1e fc2 sc0 ls0 ws0">char<span class="_ _11"> </span>*</div><div class="t m5 x1af h31 y2174 ff7 fs21 fc2 sc0 ls0 ws0">Quad<span class="_"> </span>word<span class="_ _e5"> </span><span class="ffd fs1e">q<span class="_ _11b"> </span></span>8</div><div class="t m5 x1d h31 y2175 ffd fs1e fc2 sc0 ls0 ws0">float<span class="_ _7d"> </span><span class="ff7 fs21">Single<span class="_"> </span>precision<span class="_ _9b"> </span></span>s<span class="_ _11b"> </span><span class="ff7 fs21">4</span></div><div class="t m5 x1d h31 y2176 ffd fs1e fc2 sc0 ls0 ws0">double<span class="_ _10d"> </span><span class="ff7 fs21">Double<span class="_"> </span>precision<span class="_ _12b"> </span></span>l<span class="_ _11b"> </span><span class="ff7 fs21">8</span></div><div class="t m5 x1d h34 y2177 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _13"> </span>3.1<span class="_ _c"> </span><span class="fc1">Sizes<span class="_ _13"> </span>of<span class="_ _13"> </span>C<span class="_ _13"> </span>data<span class="_ _13"> </span>types<span class="_ _13"> </span>in<span class="_ _13"> </span>x86-64.<span class="_ _13"> </span><span class="ff6">With<span class="_ _13"> </span>a<span class="_ _13"> </span>64-bit<span class="_ _13"> </span>machine,<span class="_ _13"> </span>pointers<span class="_ _13"> </span>are<span class="_ _13"> </span>8<span class="_ _13"> </span>bytes</span></span></div><div class="t m5 x1d h34 y2178 ff6 fs16 fc1 sc0 ls0 ws0">long.</div><div class="t m5 x1d h26 y107a ff7 fs19 fc1 sc0 ls0 ws0">types<span class="_ _1"></span>,<span class="_"> </span>and<span class="_ _13"> </span>so<span class="_"> </span>they<span class="_ _13"> </span>will<span class="_"> </span>operate<span class="_ _13"> </span>on<span class="_"> </span>quad<span class="_ _13"> </span>words<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>x86-64<span class="_ _13"> </span>instruction<span class="_"> </span>set<span class="_ _13"> </span>includes</div><div class="t m5 x1d h26 y2179 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_"> </span>full<span class="_"> </span>complement<span class="_"> </span>of<span class="_"> </span>instructions<span class="_"> </span>for<span class="_"> </span>bytes<span class="_ _1"></span>,<span class="_"> </span>words<span class="_ _1"></span>,<span class="_"> </span>and<span class="_"> </span>double<span class="_"> </span>words<span class="_"> </span>as<span class="_"> </span>well.</div><div class="t m5 x29 h26 y217a ff7 fs19 fc1 sc0 ls0 ws0">Floating-point<span class="_ _14"> </span>numbers<span class="_ _14"> </span>come<span class="_ _14"> </span>in<span class="_ _14"> </span>two<span class="_ _15"> </span>principal<span class="_ _14"> </span>formats:<span class="_ _14"> </span>single-precision<span class="_ _14"> </span>(4-</div><div class="t m5 x1d h26 y217b ff7 fs19 fc1 sc0 ls0 ws0">byte)<span class="_"> </span>values<span class="_ _1"></span>,<span class="_ _11"> </span>corresponding<span class="_ _11"> </span>to<span class="_ _11"> </span>C<span class="_ _11"> </span>data<span class="_ _11"> </span>type<span class="_"> </span><span class="ffd">float</span>,<span class="_ _11"> </span>and<span class="_ _11"> </span>double-precision<span class="_ _11"> </span>(8-byte)</div><div class="t m5 x1d h26 y217c ff7 fs19 fc1 sc0 ls0 ws0">values<span class="_ _1"></span>,<span class="_ _16"> </span>corresponding<span class="_ _11"> </span>to<span class="_ _16"> </span>C<span class="_ _11"> </span>data<span class="_ _16"> </span>type<span class="_ _11"> </span><span class="ffd">double</span>.<span class="_ _16"> </span>Microprocessors<span class="_ _11"> </span>in<span class="_ _16"> </span>the<span class="_ _11"> </span>x86<span class="_ _16"> </span>family</div><div class="t m5 x1d h26 y217d ff7 fs19 fc1 sc0 ls0 ws0">historically<span class="_ _14"> </span>implemented<span class="_ _14"> </span>all<span class="_ _15"> </span>ﬂoating-point<span class="_ _14"> </span>operations<span class="_ _14"> </span>with<span class="_ _14"> </span>a<span class="_ _15"> </span>special<span class="_ _14"> </span>80-bit<span class="_ _14"> </span>(10-</div><div class="t m5 x1d h26 y217e ff7 fs19 fc1 sc0 ls0 ws0">byte)<span class="_"> </span>ﬂoating-point<span class="_"> </span>format<span class="_ _11"> </span>(see<span class="_"> </span>Problem<span class="_"> </span>2.86).<span class="_ _11"> </span>T<span class="_ _1"></span>his<span class="_ _11"> </span>format<span class="_"> </span>can<span class="_"> </span>be<span class="_ _11"> </span>speciﬁed<span class="_"> </span>in<span class="_"> </span>C</div><div class="t m5 x1d h26 y217f ff7 fs19 fc1 sc0 ls0 ws0">programs<span class="_ _16"> </span>using<span class="_ _16"> </span>the<span class="_ _16"> </span>declaration<span class="_ _16"> </span><span class="ffd">long<span class="_ _16"> </span>double</span>.<span class="_ _16"> </span>W<span class="_ _3"></span>e<span class="_ _16"> </span>recommend<span class="_ _16"> </span>against<span class="_ _16"> </span>using<span class="_ _16"> </span>this</div><div class="t m5 x1d h26 y2180 ff7 fs19 fc1 sc0 ls0 ws0">format,<span class="_"> </span>however<span class="_ _0"></span>.<span class="_"> </span>It<span class="_"> </span>is<span class="_ _13"> </span>not<span class="_"> </span>portable<span class="_"> </span>to<span class="_"> </span>other<span class="_ _13"> </span>classes<span class="_"> </span>of<span class="_"> </span>machines<span class="_ _1"></span>,<span class="_"> </span>and<span class="_"> </span>it<span class="_ _13"> </span>is<span class="_"> </span>typically</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
