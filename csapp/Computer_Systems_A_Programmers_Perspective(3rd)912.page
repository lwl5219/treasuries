<div id="pf390" class="pf w2 h11" data-page-no="390"><div class="pc pc390 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg390.png"/><div class="t m5 x225 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>9.12<span class="_ _60"> </span>Summar<span class="_ _2"></span>y<span class="_ _1b"> </span><span class="ffe fs1e">911</span></div><div class="t m5 x17 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">memory-related<span class="_ _14"> </span>bugs<span class="_ _1"></span>,<span class="_ _21"> </span>the<span class="_ _14"> </span>error<span class="_ _15"> </span>will<span class="_ _14"> </span>only<span class="_ _15"> </span>become<span class="_ _14"> </span>evident<span class="_ _15"> </span>later<span class="_ _14"> </span>in<span class="_ _15"> </span>the<span class="_ _14"> </span>program</div><div class="t m5 x17 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">when<span class="_"> </span>we<span class="_"> </span>notice<span class="_"> </span>that<span class="_"> </span>the<span class="_"> </span>values<span class="_"> </span>in<span class="_"> </span><span class="ffd">y<span class="_ _10"> </span></span>are<span class="_"> </span>corrupted.</div><div class="t m5 x17 h41 y75c6 ffe fs29 fc2 sc0 ls0 ws0">9.11.10<span class="_ _48"> </span><span class="fs19">Introducing<span class="_"> </span>Memory<span class="_"> </span>Leaks</span></div><div class="t m5 x17 h26 y75c7 ff7 fs19 fc2 sc0 ls0 ws0">Memory<span class="_"> </span>leaks<span class="_ _13"> </span>are<span class="_"> </span>slow<span class="_ _7"></span>,<span class="_"> </span>silent<span class="_"> </span>killers<span class="_ _13"> </span>that<span class="_"> </span>occur<span class="_ _13"> </span>when<span class="_"> </span>programmers<span class="_"> </span>inadvertently</div><div class="t m5 x17 h26 y75c8 ff7 fs19 fc2 sc0 ls0 ws0">create<span class="_ _13"> </span>garbage<span class="_ _13"> </span>in<span class="_"> </span>the<span class="_ _13"> </span>heap<span class="_ _13"> </span>by<span class="_ _13"> </span>forgetting<span class="_ _13"> </span>to<span class="_ _13"> </span>free<span class="_"> </span>allocated<span class="_ _13"> </span>blocks<span class="_ _3"></span>.<span class="_"> </span>F<span class="_ _3"></span>or<span class="_ _13"> </span>example,<span class="_ _13"> </span>the</div><div class="t m5 x17 h26 y75c9 ff7 fs19 fc2 sc0 ls0 ws0">following<span class="_"> </span>function<span class="_"> </span>allocates<span class="_"> </span>a<span class="_"> </span>heap<span class="_"> </span>block<span class="_"> </span><span class="ffd">x<span class="_ _10"> </span></span>and<span class="_"> </span>then<span class="_"> </span>returns<span class="_"> </span>without<span class="_"> </span>freeing<span class="_"> </span>it:</div><div class="t m5 x2c h2d y75ca ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">void<span class="_ _1f"> </span>leak(int<span class="_ _e"> </span>n)</span></div><div class="t m5 x2c h2d y75cb ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x2c h2d y75cc ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2">int<span class="_ _e"> </span>*x<span class="_ _1f"> </span>=<span class="_ _1f"> </span>(int<span class="_ _e"> </span>*)Malloc(n<span class="_ _1f"> </span>*<span class="_ _e"> </span>sizeof(int));</span></div><div class="t m5 x2c h2e y75cd ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 x2c h2e y75ce ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x142 h2d y75cf ffd fs1e fc2 sc0 ls0 ws0">return;<span class="_ _1a"> </span>/*<span class="_ _e"> </span>x<span class="_ _1f"> </span>is<span class="_ _1f"> </span>garbage<span class="_ _e"> </span>at<span class="_ _1f"> </span>this<span class="_ _e"> </span>point<span class="_ _1f"> </span>*/</div><div class="t m5 x2c h2d y75d0 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x26 h26 y75d1 ff7 fs19 fc2 sc0 ls0 ws0">If<span class="_"> </span><span class="ffd">leak<span class="_ _11"> </span></span>is<span class="_"> </span>called<span class="_ _11"> </span>frequently<span class="_ _3"></span>,<span class="_ _11"> </span>then<span class="_"> </span>the<span class="_ _11"> </span>heap<span class="_"> </span>will<span class="_ _11"> </span>gradually<span class="_ _11"> </span>ﬁll<span class="_"> </span>up<span class="_ _11"> </span>with<span class="_"> </span>garbage,</div><div class="t m5 x17 h26 y75d2 ff7 fs19 fc2 sc0 ls0 ws0">in<span class="_ _16"> </span>the<span class="_ _11"> </span>worst<span class="_ _16"> </span>case<span class="_ _16"> </span>consuming<span class="_ _16"> </span>the<span class="_ _16"> </span>entire<span class="_ _16"> </span>virtual<span class="_ _11"> </span>address<span class="_ _16"> </span>space.<span class="_ _11"> </span>Memory<span class="_ _16"> </span>leaks<span class="_ _16"> </span>are</div><div class="t m5 x17 h26 y75d3 ff7 fs19 fc2 sc0 ls0 ws0">particularly<span class="_ _13"> </span>serious<span class="_ _6"> </span>for<span class="_ _13"> </span>programs<span class="_ _6"> </span>such<span class="_ _13"> </span>as<span class="_ _6"> </span>daemons<span class="_ _13"> </span>and<span class="_ _13"> </span>servers<span class="_ _3"></span>,<span class="_ _13"> </span>which<span class="_ _13"> </span>by<span class="_ _6"> </span>deﬁnition</div><div class="t m5 x17 h26 y75d4 ff7 fs19 fc2 sc0 ls0 ws0">never<span class="_"> </span>terminate<span class="_ _1"></span>.</div><div class="t m5 x17 h3b y4aa1 fff fs24 fc6 sc0 ls0 ws0">9.12<span class="_ _17"> </span><span class="ffe fs18">Summar<span class="_ _2"></span>y</span></div><div class="t m5 x17 h26 y2152 ff7 fs19 fc1 sc0 ls0 ws0">V<span class="_ _1"></span>irtual<span class="_ _14"> </span>memory<span class="_ _16"> </span>is<span class="_ _14"> </span>an<span class="_ _16"> </span>abstraction<span class="_ _14"> </span>of<span class="_ _16"> </span>main<span class="_ _14"> </span>memory<span class="_ _3"></span>.<span class="_ _16"> </span>Processors<span class="_ _16"> </span>that<span class="_ _14"> </span>support<span class="_ _16"> </span>vir<span class="_ _1"></span>-</div><div class="t m5 x17 h26 y75d5 ff7 fs19 fc1 sc0 ls0 ws0">tual<span class="_ _13"> </span>memory<span class="_ _13"> </span>reference<span class="_ _13"> </span>main<span class="_ _13"> </span>memory<span class="_"> </span>using<span class="_ _13"> </span>a<span class="_ _13"> </span>form<span class="_ _13"> </span>of<span class="_ _13"> </span>indirection<span class="_ _13"> </span>known<span class="_ _13"> </span>as<span class="_ _13"> </span>virtual</div><div class="t m5 x17 h26 y75d6 ff7 fs19 fc1 sc0 ls0 ws0">addressing.<span class="_ _11"> </span>T<span class="_ _0"></span>he<span class="_ _11"> </span>processor<span class="_ _16"> </span>generates<span class="_ _16"> </span>a<span class="_ _16"> </span>virtual<span class="_ _11"> </span>address<span class="_ _1"></span>,<span class="_ _16"> </span>which<span class="_ _16"> </span>is<span class="_ _16"> </span>translated<span class="_ _11"> </span>into<span class="_ _16"> </span>a</div><div class="t m5 x17 h26 y75d7 ff7 fs19 fc1 sc0 ls0 ws0">physical<span class="_ _14"> </span>address<span class="_ _14"> </span>before<span class="_ _14"> </span>being<span class="_ _14"> </span>sent<span class="_ _14"> </span>to<span class="_ _14"> </span>the<span class="_ _14"> </span>main<span class="_ _14"> </span>memory<span class="_ _3"></span>.<span class="_ _14"> </span>The<span class="_ _16"> </span>translation<span class="_ _14"> </span>of<span class="_ _14"> </span>ad-</div><div class="t m5 x17 h26 y75d8 ff7 fs19 fc1 sc0 ls0 ws0">dresses<span class="_ _14"> </span>from<span class="_ _15"> </span>a<span class="_ _14"> </span>virtual<span class="_ _14"> </span>address<span class="_ _15"> </span>space<span class="_ _14"> </span>to<span class="_ _15"> </span>a<span class="_ _14"> </span>physical<span class="_ _15"> </span>address<span class="_ _14"> </span>space<span class="_ _15"> </span>requires<span class="_ _14"> </span>close</div><div class="t m5 x17 h26 y75d9 ff7 fs19 fc1 sc0 ls0 ws0">cooperation<span class="_"> </span>between<span class="_"> </span>hardware<span class="_"> </span>and<span class="_"> </span>software.<span class="_"> </span>Dedicated<span class="_"> </span>hardware<span class="_"> </span>translates<span class="_"> </span>vir<span class="_ _3"></span>-</div><div class="t m5 x17 h26 y75da ff7 fs19 fc1 sc0 ls0 ws0">tual<span class="_ _14"> </span>addresses<span class="_ _15"> </span>using<span class="_ _15"> </span>page<span class="_ _14"> </span>tables<span class="_ _15"> </span>whose<span class="_ _15"> </span>contents<span class="_ _14"> </span>are<span class="_ _15"> </span>supplied<span class="_ _15"> </span>by<span class="_ _14"> </span>the<span class="_ _15"> </span>operating</div><div class="t m5 x17 h26 y75db ff7 fs19 fc1 sc0 ls0 ws0">system.</div><div class="t m5 x26 h26 y75dc ff7 fs19 fc1 sc0 ls0 ws0">V<span class="_ _1"></span>irtual<span class="_ _11"> </span>memory<span class="_ _11"> </span>provides<span class="_ _11"> </span>three<span class="_ _11"> </span>important<span class="_ _11"> </span>capabilities<span class="_ _1"></span>.<span class="_"> </span>First,<span class="_"> </span>it<span class="_ _11"> </span>automatically</div><div class="t m5 x17 h26 y75dd ff7 fs19 fc1 sc0 ls0 ws0">caches<span class="_"> </span>recently<span class="_"> </span>used<span class="_ _11"> </span>contents<span class="_"> </span>of<span class="_ _11"> </span>the<span class="_"> </span>virtual<span class="_ _11"> </span>address<span class="_"> </span>space<span class="_ _11"> </span>stored<span class="_"> </span>on<span class="_ _11"> </span>disk<span class="_"> </span>in<span class="_"> </span>main</div><div class="t m5 x17 h26 y75de ff7 fs19 fc1 sc0 ls0 ws0">memory<span class="_ _3"></span>.<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _14"> </span>block<span class="_ _16"> </span>in<span class="_ _16"> </span>a<span class="_ _16"> </span>virtual<span class="_ _16"> </span>memory<span class="_ _14"> </span>cache<span class="_ _16"> </span>is<span class="_ _16"> </span>known<span class="_ _16"> </span>as<span class="_ _14"> </span>a<span class="_ _16"> </span>page<span class="_ _0"></span>.<span class="_ _16"> </span>A<span class="_ _16"> </span>reference</div><div class="t m5 x17 h26 y75df ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _14"> </span>a<span class="_ _14"> </span>page<span class="_ _14"> </span>on<span class="_ _15"> </span>disk<span class="_ _14"> </span>triggers<span class="_ _14"> </span>a<span class="_ _15"> </span>page<span class="_ _14"> </span>fault<span class="_ _14"> </span>that<span class="_ _14"> </span>transfers<span class="_ _15"> </span>control<span class="_ _14"> </span>to<span class="_ _14"> </span>a<span class="_ _14"> </span>fault<span class="_ _15"> </span>handler</div><div class="t m5 x17 h26 y75e0 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_"> </span>the<span class="_ _11"> </span>operating<span class="_"> </span>system.<span class="_ _11"> </span>T<span class="_ _1"></span>he<span class="_ _11"> </span>fault<span class="_"> </span>handler<span class="_ _11"> </span>copies<span class="_"> </span>the<span class="_ _11"> </span>page<span class="_ _11"> </span>from<span class="_"> </span>disk<span class="_ _11"> </span>to<span class="_"> </span>the<span class="_ _11"> </span>main</div><div class="t m5 x17 h26 y75e1 ff7 fs19 fc1 sc0 ls0 ws0">memory<span class="_ _13"> </span>cache<span class="_ _1"></span>,<span class="_ _13"> </span>writing<span class="_ _13"> </span>back<span class="_ _6"> </span>the<span class="_ _13"> </span>evicted<span class="_ _13"> </span>page<span class="_ _13"> </span>if<span class="_ _6"> </span>necessary<span class="_ _3"></span>.<span class="_ _13"> </span>Second,<span class="_ _13"> </span>virtual<span class="_ _6"> </span>memory</div><div class="t m5 x17 h26 y75e2 ff7 fs19 fc1 sc0 ls0 ws0">simpliﬁes<span class="_ _21"> </span>memory<span class="_ _21"> </span>management,<span class="_ _f"> </span>which<span class="_ _21"> </span>in<span class="_ _21"> </span>turn<span class="_ _f"> </span>simpliﬁes<span class="_ _21"> </span>linking,<span class="_ _f"> </span>sharing<span class="_ _21"> </span>data</div><div class="t m5 x17 h26 y75e3 ff7 fs19 fc1 sc0 ls0 ws0">between<span class="_"> </span>processes<span class="_ _3"></span>,<span class="_"> </span>the<span class="_ _13"> </span>allocation<span class="_"> </span>of<span class="_ _13"> </span>memory<span class="_"> </span>for<span class="_"> </span>processes<span class="_ _3"></span>,<span class="_"> </span>and<span class="_ _13"> </span>program<span class="_"> </span>loading.</div><div class="t m5 x17 h26 y75e4 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>inally<span class="_ _3"></span>,<span class="_"> </span>virtual<span class="_ _13"> </span>memory<span class="_ _13"> </span>simpliﬁes<span class="_ _13"> </span>memory<span class="_ _13"> </span>protection<span class="_ _13"> </span>by<span class="_ _13"> </span>incorporating<span class="_ _13"> </span>protection</div><div class="t m5 x17 h26 y75e5 ff7 fs19 fc1 sc0 ls0 ws0">bits<span class="_"> </span>into<span class="_"> </span>every<span class="_"> </span>page<span class="_"> </span>table<span class="_"> </span>entry<span class="_ _3"></span>.</div><div class="t m5 x26 h26 y75e6 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _16"> </span>process<span class="_ _11"> </span>of<span class="_ _16"> </span>address<span class="_ _11"> </span>translation<span class="_ _16"> </span>must<span class="_ _11"> </span>be<span class="_ _16"> </span>integrated<span class="_ _11"> </span>with<span class="_ _16"> </span>the<span class="_ _11"> </span>operation<span class="_ _16"> </span>of</div><div class="t m5 x17 h26 y75e7 ff7 fs19 fc1 sc0 ls0 ws0">any<span class="_"> </span>hardware<span class="_"> </span>caches<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>system.<span class="_"> </span>Most<span class="_"> </span>page<span class="_"> </span>table<span class="_ _11"> </span>entries<span class="_"> </span>are<span class="_"> </span>located<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>L1</div><div class="t m5 x17 h26 y75e8 ff7 fs19 fc1 sc0 ls0 ws0">cache<span class="_ _1"></span>,<span class="_ _16"> </span>but<span class="_ _16"> </span>the<span class="_ _16"> </span>cost<span class="_ _11"> </span>of<span class="_ _16"> </span>accessing<span class="_ _11"> </span>page<span class="_ _16"> </span>table<span class="_ _16"> </span>entries<span class="_ _11"> </span>from<span class="_ _16"> </span>L1<span class="_ _11"> </span>is<span class="_ _16"> </span>usually<span class="_ _16"> </span>eliminated</div><div class="t m5 x17 h26 y75e9 ff7 fs19 fc1 sc0 ls0 ws0">by<span class="_"> </span>an<span class="_"> </span>on-chip<span class="_"> </span>cache<span class="_"> </span>of<span class="_"> </span>page<span class="_"> </span>table<span class="_"> </span>entries<span class="_"> </span>called<span class="_"> </span>a<span class="_"> </span>TLB<span class="_ _3"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
