<div id="pf1d6" class="pf w2 h11" data-page-no="1d6"><div class="pc pc1d6 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1d6.png"/><div class="t m5 x13d h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>4.5<span class="_ _60"> </span>Pipelined<span class="_ _10"> </span>Y86-64<span class="_ _10"> </span>Implementations<span class="_ _3e"> </span><span class="ffe fs1e">469</span></div><div class="t m5 xa8 h3f y410b ff49 fs27 fc1 sc0 ls0 ws0">e_valE      0 + 3 = 3</div><div class="t m5 xa8 h40 y410c ff49 fs27 fc1 sc0 ls0 ws0">E_dstE = <span class="ff4a fs28">%rax</span></div><div class="t m5 xa8 h3f y410d ff49 fs27 fc1 sc0 ls0 ws0">M_valE = 10</div><div class="t m5 xa8 h40 y410e ff49 fs27 fc1 sc0 ls0 ws0">M_dstE = <span class="ff4a fs28">%rdx</span></div><div class="t m5 x187 h3f y410f ff49 fs27 fc1 sc0 ls0 ws0">D</div><div class="t m5 xa8 h3f y4110 ff49 fs27 fc1 sc0 ls0 ws0">valA<span class="_ _1"></span>      R[</div><div class="t m5 x184 h40 y4111 ff4a fs28 fc1 sc0 ls0 ws0">%rdx<span class="ff49 fs27">] = 0</span></div><div class="t m5 xa8 h40 y4112 ff49 fs27 fc1 sc0 ls0 ws0">valB      R[<span class="ff4a fs28">%rax</span>] = 0</div><div class="t m5 x48 h3f y4113 ff49 fs27 fc1 sc0 ls0 ws0">F</div><div class="t m5 x17 h40 y4114 ff4a fs28 fc1 sc0 ls0 ws0">0x000: irmovq $10,%rdx</div><div class="t m5 x17 h40 y4115 ff4a fs28 fc1 sc0 ls0 ws0"># prog4</div><div class="c x17 y4116 w8 ha7"><div class="t m5 x0 h40 y4117 ff4a fs28 fc3 sc1 ls0 ws0"># prog4</div></div><div class="t m5 x17 h40 y4118 ff4a fs28 fc1 sc0 ls0 ws0">0x00a: irmovq  $3,%rax</div><div class="t m5 x17 h40 y4119 ff4a fs28 fc1 sc0 ls0 ws0">0x014: addq %rdx,%rax</div><div class="t m5 x17 h40 y411a ff4a fs28 fc1 sc0 ls0 ws0">0x016: halt</div><div class="t m5 xec h3f y4114 ff49 fs27 fc1 sc0 ls1d6 ws0">DE<span class="_ _1"></span>M<span class="_ _4"></span>W</div><div class="t m5 xec h3f y411b ff49 fs27 fc1 sc0 ls1ca ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x186 h3f y411c ff49 fs27 fc1 sc0 ls1c8 ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x187 h3f y411d ff49 fs27 fc1 sc0 ls1c8 ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x113 h3f y411e ff49 fs27 fc1 sc0 ls0 ws0">Cycle 4</div><div class="t m5 x47 h44 y411f ff49 fs2a fc6 sc0 ls1d7 ws0">12345</div><div class="t m5 x205 h44 y4120 ff49 fs2a fc6 sc0 ls0 ws0">6</div><div class="t m5 x6c h44 y4121 ff49 fs2a fc6 sc0 ls0 ws0">7</div><div class="t m5 x11a h44 y4122 ff49 fs2a fc6 sc0 ls0 ws0">8</div><div class="t m5 x187 h3f y4123 ff49 fs27 fc1 sc0 ls0 ws0">M</div><div class="t m5 x187 h3f y4124 ff49 fs27 fc1 sc0 ls0 ws0">E</div><div class="t m5 x18b h3f y4125 ff1f fs27 fc1 sc0 ls0 ws0">Error</div><div class="t m5 x17 h3a y4126 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>4.46<span class="_ _66"> </span><span class="fc1">Pipelined<span class="_"> </span>execution<span class="_"> </span>of<span class="_ _10"> </span><span class="ffd fs19">prog4<span class="_ _10"> </span></span>without<span class="_ _10"> </span>special<span class="_ _10"> </span>pipeline<span class="_ _10"> </span>control.<span class="_ _10"> </span><span class="ff6">In<span class="_ _10"> </span>cycle</span></span></div><div class="t m5 x17 h34 y4127 ff6 fs16 fc1 sc0 ls0 ws0">4,<span class="_ _14"> </span>the</div><div class="t m5 x1b5 h3a y4128 ffd fs19 fc1 sc0 ls0 ws0">addq<span class="_ _16"> </span><span class="ff6 fs16">instruction<span class="_ _16"> </span>reads<span class="_ _14"> </span>its<span class="_ _16"> </span>source<span class="_ _16"> </span>operands<span class="_ _14"> </span>from<span class="_ _16"> </span>the<span class="_ _16"> </span>register<span class="_ _14"> </span>ﬁle.<span class="_ _16"> </span>The<span class="_ _14"> </span>pending</span></div><div class="t m5 x17 h34 y4129 ff6 fs16 fc1 sc0 ls0 ws0">write<span class="_ _11"> </span>to<span class="_ _11"> </span>register</div><div class="t m5 x126 h3a y412a ffd fs19 fc1 sc0 ls0 ws0">%rdx<span class="_ _11"> </span><span class="ff6 fs16">is<span class="_ _11"> </span>still<span class="_ _11"> </span>in<span class="_ _11"> </span>the<span class="_ _11"> </span>memory<span class="_ _11"> </span>stage,<span class="_ _16"> </span>and<span class="_ _10"> </span>the<span class="_ _11"> </span>new<span class="_ _16"> </span>value<span class="_ _10"> </span>for<span class="_ _11"> </span>register<span class="_ _11"> </span></span>%rax</div><div class="t m5 x17 h34 y412b ff6 fs16 fc1 sc0 ls0 ws0">is<span class="_ _10"> </span>just<span class="_ _11"> </span>being<span class="_ _11"> </span>computed<span class="_ _11"> </span>in<span class="_ _10"> </span>the<span class="_ _11"> </span>execute<span class="_ _11"> </span>stage.<span class="_ _11"> </span>Both<span class="_ _10"> </span>operands<span class="_ _11"> </span>valA<span class="_ _11"> </span>and<span class="_ _11"> </span>valB<span class="_ _10"> </span>get<span class="_ _11"> </span>incorrect</div><div class="t m5 x17 h34 y412c ff6 fs16 fc1 sc0 ls0 ws0">values.</div><div class="t m5 x17 h42 y412d ff6 fs29 fc6 sc0 ls0 ws0">A<span class="_ _0"></span>voiding<span class="_ _16"> </span>Data<span class="_ _11"> </span>Hazards<span class="_ _16"> </span>by<span class="_ _16"> </span>Stalling</div><div class="t m5 x17 h26 y7fe ff7 fs19 fc1 sc0 ls0 ws0">One<span class="_ _21"> </span>very<span class="_ _f"> </span>general<span class="_ _f"> </span>technique<span class="_ _f"> </span>for<span class="_ _21"> </span>avoiding<span class="_ _f"> </span>hazards<span class="_ _f"> </span>involves<span class="_ _f"> </span><span class="ffa">stalling<span class="_ _2"></span></span>,<span class="_ _e"> </span>where<span class="_ _21"> </span>the</div><div class="t m5 x17 h26 y7ff ff7 fs19 fc1 sc0 ls0 ws0">processor<span class="_ _14"> </span>holds<span class="_ _14"> </span>back<span class="_ _15"> </span>one<span class="_ _14"> </span>or<span class="_ _15"> </span>more<span class="_ _14"> </span>instructions<span class="_ _15"> </span>in<span class="_ _14"> </span>the<span class="_ _14"> </span>pipeline<span class="_ _15"> </span>until<span class="_ _14"> </span>the<span class="_ _15"> </span>hazard</div><div class="t m5 x17 h26 y800 ff7 fs19 fc1 sc0 ls0 ws0">condition<span class="_"> </span>no<span class="_ _13"> </span>longer<span class="_"> </span>holds<span class="_ _1"></span>.<span class="_"> </span>Our<span class="_"> </span>processor<span class="_ _13"> </span>can<span class="_"> </span>avoid<span class="_"> </span>data<span class="_ _13"> </span>hazards<span class="_"> </span>by<span class="_"> </span>holding<span class="_ _13"> </span>back</div><div class="t m5 x17 h26 y801 ff7 fs19 fc1 sc0 ls0 ws0">an<span class="_"> </span>instruction<span class="_ _11"> </span>in<span class="_"> </span>the<span class="_ _11"> </span>decode<span class="_"> </span>stage<span class="_ _11"> </span>until<span class="_ _11"> </span>the<span class="_"> </span>instructions<span class="_ _11"> </span>generating<span class="_"> </span>its<span class="_ _11"> </span>source<span class="_"> </span>op-</div><div class="t m5 x17 h26 y802 ff7 fs19 fc1 sc0 ls0 ws0">erands<span class="_ _11"> </span>have<span class="_ _16"> </span>passed<span class="_ _11"> </span>through<span class="_ _16"> </span>the<span class="_ _11"> </span>write-back<span class="_ _16"> </span>stage<span class="_ _1"></span>.<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span>details<span class="_ _11"> </span>of<span class="_ _11"> </span>this<span class="_ _16"> </span>mechanism</div><div class="t m5 x17 h26 y803 ff7 fs19 fc1 sc0 ls0 ws0">will<span class="_"> </span>be<span class="_ _13"> </span>discussed<span class="_"> </span>in<span class="_ _13"> </span>Section<span class="_"> </span>4.5.8.<span class="_ _13"> </span>It<span class="_"> </span>involves<span class="_ _13"> </span>simple<span class="_"> </span>enhancements<span class="_ _13"> </span>to<span class="_"> </span>the<span class="_ _13"> </span>pipeline</div><div class="t m5 x17 h26 y804 ff7 fs19 fc1 sc0 ls0 ws0">control<span class="_"> </span>logic<span class="_ _0"></span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>effect<span class="_"> </span>of<span class="_ _13"> </span>stalling<span class="_"> </span>is<span class="_"> </span>diagrammed<span class="_"> </span>in<span class="_ _13"> </span>Figure<span class="_ _13"> </span>4.47<span class="_"> </span>(<span class="ffd">prog2</span>)<span class="_"> </span>and<span class="_ _13"> </span>Fig-</div><div class="t m5 x17 h26 y805 ff7 fs19 fc1 sc0 ls0 ws0">ure<span class="_"> </span>4.48<span class="_"> </span>(<span class="ffd">prog4</span>).<span class="_"> </span>(W<span class="_ _3"></span>e<span class="_"> </span>omit<span class="_"> </span><span class="ffd">prog3<span class="_ _10"> </span></span>from<span class="_"> </span>this<span class="_"> </span>discussion,<span class="_"> </span>since<span class="_"> </span>it<span class="_"> </span>operates<span class="_"> </span>similarly</div><div class="t m5 x17 h26 y806 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _14"> </span>the<span class="_ _15"> </span>other<span class="_ _15"> </span>two<span class="_ _14"> </span>examples<span class="_ _1"></span>.)<span class="_ _15"> </span>When<span class="_ _14"> </span>the<span class="_ _15"> </span><span class="ffd">addq<span class="_ _15"> </span></span>instruction<span class="_ _14"> </span>is<span class="_ _15"> </span>in<span class="_ _15"> </span>the<span class="_ _14"> </span>decode<span class="_ _15"> </span>stage<span class="_ _0"></span>,</div><div class="t m5 x17 h26 y807 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _11"> </span>pipeline<span class="_ _16"> </span>control<span class="_ _11"> </span>logic<span class="_ _16"> </span>detects<span class="_ _11"> </span>that<span class="_ _16"> </span>at<span class="_ _11"> </span>least<span class="_ _16"> </span>one<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span>instructions<span class="_ _16"> </span>in<span class="_ _11"> </span>the<span class="_ _16"> </span>exe-</div><div class="t m5 x17 h26 y808 ff7 fs19 fc1 sc0 ls0 ws0">cute<span class="_ _1"></span>,<span class="_ _13"> </span>memory<span class="_ _3"></span>,<span class="_ _13"> </span>or<span class="_ _6"> </span>write-back<span class="_ _13"> </span>stage<span class="_ _6"> </span>will<span class="_ _13"> </span>update<span class="_ _13"> </span>either<span class="_ _6"> </span>register<span class="_ _13"> </span><span class="ffd">%rdx<span class="_ _6"> </span></span>or<span class="_ _13"> </span>register<span class="_ _6"> </span><span class="ffd">%rax</span>.</div><div class="t m5 x17 h26 y809 ff7 fs19 fc1 sc0 ls0 ws0">Rather<span class="_"> </span>than<span class="_ _13"> </span>letting<span class="_"> </span>the<span class="_"> </span><span class="ffd">addq<span class="_ _13"> </span></span>instruction<span class="_"> </span>pass<span class="_"> </span>through<span class="_ _13"> </span>the<span class="_"> </span>stage<span class="_"> </span>with<span class="_ _13"> </span>the<span class="_"> </span>incorrect</div><div class="t m5 x17 h26 y80a ff7 fs19 fc1 sc0 ls0 ws0">results<span class="_ _1"></span>,<span class="_"> </span>it<span class="_ _11"> </span>stalls<span class="_ _11"> </span>the<span class="_"> </span>instruction,<span class="_ _11"> </span>holding<span class="_ _11"> </span>it<span class="_"> </span>back<span class="_ _11"> </span>in<span class="_"> </span>the<span class="_ _11"> </span>decode<span class="_ _11"> </span>stage<span class="_"> </span>for<span class="_ _11"> </span>either<span class="_"> </span>one</div><div class="t m5 x17 h26 y80b ff7 fs19 fc1 sc0 ls0 ws0">(for<span class="_"> </span><span class="ffd">prog2</span>)<span class="_"> </span>or<span class="_"> </span>three<span class="_"> </span>(for<span class="_"> </span><span class="ffd">prog4</span>)<span class="_"> </span>extra<span class="_"> </span>c<span class="_ _1"></span>ycles<span class="_ _1"></span>.<span class="_"> </span>F<span class="_ _1"></span>or<span class="_"> </span>all<span class="_"> </span>three<span class="_"> </span>programs<span class="_ _1"></span>,<span class="_"> </span>the<span class="_"> </span><span class="ffd">addq<span class="_ _10"> </span></span>in-</div><div class="t m5 x17 h26 y80c ff7 fs19 fc1 sc0 ls0 ws0">struction<span class="_ _13"> </span>ﬁnally<span class="_"> </span>gets<span class="_ _13"> </span>correct<span class="_ _13"> </span>values<span class="_"> </span>for<span class="_ _13"> </span>its<span class="_ _13"> </span>two<span class="_"> </span>source<span class="_ _13"> </span>operands<span class="_ _13"> </span>in<span class="_"> </span>c<span class="_ _0"></span>ycle<span class="_ _13"> </span>7<span class="_"> </span>and<span class="_ _13"> </span>then</div><div class="t m5 x17 h26 y2b6f ff7 fs19 fc1 sc0 ls0 ws0">proceeds<span class="_"> </span>down<span class="_"> </span>the<span class="_"> </span>pipeline<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
