<div id="pf109" class="pf w2 h11" data-page-no="109"><div class="pc pc109 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg109.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">264<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x1d h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">code<span class="_ _13"> </span>does<span class="_ _13"> </span>not<span class="_ _13"> </span>exactly<span class="_"> </span>match<span class="_ _13"> </span>what<span class="_ _13"> </span>would<span class="_ _13"> </span>be<span class="_ _13"> </span>obtained<span class="_ _13"> </span>by<span class="_ _13"> </span>a<span class="_"> </span>direct<span class="_ _13"> </span>translation<span class="_ _13"> </span>of<span class="_ _13"> </span>the</div><div class="t m5 x1d h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">C<span class="_ _16"> </span>code<span class="_ _11"> </span>according<span class="_ _16"> </span>to<span class="_ _16"> </span>our<span class="_ _16"> </span>translation<span class="_ _16"> </span>rules<span class="_ _1"></span>.<span class="_ _16"> </span>In<span class="_ _11"> </span>particular,<span class="_ _16"> </span>it<span class="_ _16"> </span>has<span class="_ _16"> </span>two<span class="_ _16"> </span>different<span class="_ _11"> </span><span class="ffd">ret</span></div><div class="t m5 x1d h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">instructions<span class="_ _16"> </span>(lines<span class="_ _16"> </span>10<span class="_ _16"> </span>and<span class="_ _16"> </span>13).<span class="_ _16"> </span>However<span class="_ _0"></span>,<span class="_ _16"> </span>you<span class="_ _16"> </span>can<span class="_ _16"> </span>ﬁll<span class="_ _16"> </span>out<span class="_ _16"> </span>the<span class="_ _16"> </span>missing<span class="_ _16"> </span>portions<span class="_ _16"> </span>of</div><div class="t m5 x1d h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>C<span class="_"> </span>code<span class="_"> </span>in<span class="_"> </span>a<span class="_"> </span>way<span class="_"> </span>that<span class="_"> </span>it<span class="_"> </span>will<span class="_"> </span>have<span class="_"> </span>equivalent<span class="_"> </span>behavior<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>assembly<span class="_"> </span>code<span class="_ _1"></span>.</div><div class="t m5 x1d h47 y279c ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>3.26<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>372)</span></div><div class="t m5 x1d h26 y279d ff7 fs19 fc1 sc0 ls0 ws0">A<span class="_"> </span>function<span class="_"> </span><span class="ffd">test_one<span class="_ _10"> </span></span>has<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>overall<span class="_"> </span>structure:</div><div class="t m5 x1d h2d y279e ffd fs1e fc2 sc0 ls0 ws0">short<span class="_ _e"> </span>test_one(unsigned<span class="_ _1f"> </span>short<span class="_ _1f"> </span>x)<span class="_ _e"> </span>{</div><div class="t m5 x10c h2d y279f ffd fs1e fc2 sc0 ls0 ws0">short<span class="_ _e"> </span>val<span class="_ _1f"> </span>=<span class="_ _1f"> </span>1;</div><div class="t m5 x10c h2d y27a0 ffd fs1e fc2 sc0 ls0 ws0">while<span class="_ _e"> </span>(<span class="_ _1f"> </span>...<span class="_ _1f"> </span>)<span class="_ _e"> </span>{</div><div class="t m5 x22b h2d y27a1 ffd fs1e fc2 sc0 ls0 ws0">.</div><div class="t m5 x22b h2d y27a2 ffd fs1e fc2 sc0 ls0 ws0">.</div><div class="t m5 x22b h2d y27a3 ffd fs1e fc2 sc0 ls0 ws0">.</div><div class="t m5 x10c h2d y27a4 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x10c h2d y27a5 ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>...;</div><div class="t m5 x1d h2d y27a6 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x1d h26 y27a7 ff7 fs19 fc2 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _11"> </span><span class="ff9 ls0">gcc<span class="_ _10"> </span><span class="ff7">C<span class="_"> </span>compiler<span class="_"> </span>generates<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>assembly<span class="_"> </span>code:</span></span></div><div class="t m5 xad h61 y27a8 ff13 fs35 fc6 sc0 ls0 ws0">short<span class="_ _f"> </span>test_one(unsigned<span class="_ _f"> </span>short<span class="_ _f"> </span>x)</div><div class="t m5 xad h61 y27a9 ff13 fs35 fc6 sc0 ls0 ws0">x<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi</div><div class="t m5 x1f h2d y27aa ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">test_one:</span></div><div class="t m5 x1f h2d y27ab ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">movl<span class="_ _46"> </span>$1,<span class="_ _e"> </span>%eax</span></div><div class="t m5 x1f h2e y27ac ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x10d h2d y27ad ffd fs1e fc2 sc0 ls0 ws0">jmp<span class="_ _8c"> </span>.L5</div><div class="t m5 x1f h2e y27ae ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 x4f h2d y27af ffd fs1e fc2 sc0 ls0 ws0">.L6:</div><div class="t m5 x1f h2d y27b0 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">xorq<span class="_ _46"> </span>%rdi,<span class="_ _e"> </span>%rax</span></div><div class="t m5 x1f h2d y27b1 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">shrq<span class="_ _46"> </span>%rdi<span class="_ _c2"> </span></span><span class="ff13 fs35">Shift<span class="_ _f"> </span>right<span class="_ _f"> </span>by<span class="_ _f"> </span>1</span></div><div class="t m5 x1f h2d y27b2 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L5:</span></div><div class="t m5 x1f h2d y27b3 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _45"> </span><span class="ffd fs1e fc2">testq<span class="_ _3f"> </span>%rdi,<span class="_ _e"> </span>%rdi</span></div><div class="t m5 x1f h2e y27b4 ff6 fs20 fc6 sc0 ls0 ws0">9</div><div class="t m5 x10d h2d y27b5 ffd fs1e fc2 sc0 ls0 ws0">jne<span class="_ _8c"> </span>.L6</div><div class="t m5 x1b0 h2d y27b6 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _45"> </span><span class="ffd fs1e fc2">andl<span class="_ _46"> </span>$0,<span class="_ _e"> </span>%eax</span></div><div class="t m5 x1b0 h2d y27b7 ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _45"> </span><span class="ffd fs1e fc2">ret</span></div><div class="t m5 x29 h26 y27b8 ff7 fs19 fc2 sc0 ls0 ws0">Reverse<span class="_"> </span>engineer<span class="_"> </span>the<span class="_"> </span>operation<span class="_"> </span>of<span class="_"> </span>this<span class="_"> </span>code<span class="_"> </span>and<span class="_"> </span>then<span class="_"> </span>do<span class="_"> </span>the<span class="_"> </span>following:</div><div class="t m5 x124 h26 y27b9 ff7 fs19 fc2 sc0 ls0 ws0">A.<span class="_ _1f"> </span>Determine<span class="_"> </span>what<span class="_"> </span>loop<span class="_"> </span>translation<span class="_"> </span>method<span class="_"> </span>was<span class="_"> </span>used.</div><div class="t m5 x124 h26 y27ba ff7 fs19 fc2 sc0 ls0 ws0">B<span class="_ _3"></span>.<span class="_ _1d"> </span>Use<span class="_"> </span>the<span class="_"> </span>assembly-code<span class="_"> </span>version<span class="_"> </span>to<span class="_"> </span>ﬁll<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>missing<span class="_"> </span>parts<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>C<span class="_"> </span>code.</div><div class="t m5 x124 h26 y27bb ff7 fs19 fc2 sc0 ls0 ws0">C.<span class="_ _25"> </span>Describe<span class="_"> </span>in<span class="_"> </span>English<span class="_"> </span>what<span class="_"> </span>this<span class="_"> </span>function<span class="_"> </span>computes<span class="_ _1"></span>.</div><div class="t m5 x1d h42 y27bc ff6 fs29 fc6 sc0 ls0 ws0">For<span class="_ _11"> </span>Loops</div><div class="t m5 x1d h26 y27bd ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>general<span class="_"> </span>form<span class="_"> </span>of<span class="_"> </span>a<span class="_"> </span><span class="ffd">for<span class="_ _10"> </span></span>loop<span class="_"> </span>is<span class="_"> </span>as<span class="_"> </span>follows:</div><div class="t m5 x1d h53 yd7a ffd fs1e fc2 sc0 ls0 ws0">for<span class="_ _e"> </span>(<span class="ffa">init-expr<span class="_ _2"></span></span>;<span class="_ _1f"> </span><span class="ffa">test-expr<span class="_ _2"></span></span>;<span class="_ _1f"> </span><span class="ffa">update-expr</span>)</div><div class="t m5 x10c h53 y27be ffa fs1e fc2 sc0 ls0 ws0">body-statement</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
