<div id="pf22b" class="pf w2 h11" data-page-no="22b"><div class="pc pc22b w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg22b.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">554<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>5<span class="_ _3d"> </span>Optimizing<span class="_ _10"> </span>Program<span class="_ _10"> </span>Performance</span></div><div class="t m5 x1d h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">are<span class="_ _6"> </span>evaluated<span class="_ _13"> </span>simultaneously<span class="_ _3"></span>,<span class="_ _13"> </span>a<span class="_ _6"> </span>phenomenon<span class="_ _13"> </span>referred<span class="_ _6"> </span>to<span class="_ _6"> </span>as<span class="_ _13"> </span><span class="ffa">instruction-level<span class="_ _6"> </span>paral-</span></div><div class="t m5 x1d h26 y2a7 ffa fs19 fc2 sc0 ls0 ws0">lelism<span class="ff7">.<span class="_ _6"> </span>In<span class="_ _13"> </span>some<span class="_ _6"> </span>designs<span class="_ _1"></span>,<span class="_ _13"> </span>there<span class="_ _13"> </span>can<span class="_ _6"> </span>be<span class="_ _6"> </span>100<span class="_ _13"> </span>or<span class="_ _6"> </span>more<span class="_ _13"> </span>instructions<span class="_ _6"> </span>“in<span class="_ _13"> </span>ﬂight.<span class="_ _3"></span>”<span class="_ _13"> </span>Elaborate</span></div><div class="t m5 x1d h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">mechanisms<span class="_ _16"> </span>are<span class="_ _16"> </span>employed<span class="_ _14"> </span>to<span class="_ _16"> </span>make<span class="_ _16"> </span>sure<span class="_ _14"> </span>the<span class="_ _16"> </span>behavior<span class="_ _16"> </span>of<span class="_ _14"> </span>this<span class="_ _16"> </span>parallel<span class="_ _16"> </span>execution</div><div class="t m5 x1d h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">exactly<span class="_ _15"> </span>captures<span class="_ _15"> </span>the<span class="_ _21"> </span>sequential<span class="_ _15"> </span>semantic<span class="_ _21"> </span>model<span class="_ _15"> </span>required<span class="_ _15"> </span>by<span class="_ _21"> </span>the<span class="_ _15"> </span>machine-level</div><div class="t m5 x1d h26 y2f8 ff7 fs19 fc2 sc0 ls0 ws0">program.<span class="_ _14"> </span>T<span class="_ _0"></span>his<span class="_ _14"> </span>is<span class="_ _14"> </span>one<span class="_ _14"> </span>of<span class="_ _15"> </span>the<span class="_ _14"> </span>remarkable<span class="_ _14"> </span>feats<span class="_ _15"> </span>of<span class="_ _14"> </span>modern<span class="_ _14"> </span>microprocessors:<span class="_ _15"> </span>they</div><div class="t m5 x1d h26 y2f9 ff7 fs19 fc2 sc0 ls0 ws0">employ<span class="_ _13"> </span>complex<span class="_ _13"> </span>and<span class="_ _13"> </span>exotic<span class="_ _13"> </span>microarchitectures<span class="_ _1"></span>,<span class="_ _13"> </span>in<span class="_ _13"> </span>which<span class="_ _13"> </span>multiple<span class="_ _13"> </span>instructions<span class="_ _13"> </span>can</div><div class="t m5 x1d h26 y2fa ff7 fs19 fc2 sc0 ls0 ws0">be<span class="_ _13"> </span>executed<span class="_"> </span>in<span class="_ _13"> </span>parallel,<span class="_ _13"> </span>while<span class="_"> </span>presenting<span class="_ _13"> </span>an<span class="_ _13"> </span>operational<span class="_"> </span>view<span class="_ _13"> </span>of<span class="_ _13"> </span>simple<span class="_ _13"> </span>sequential</div><div class="t m5 x1d h26 y2fb ff7 fs19 fc2 sc0 ls0 ws0">instruction<span class="_"> </span>execution.</div><div class="t m5 x29 h26 y2fc ff7 fs19 fc2 sc0 ls0 ws0">Although<span class="_ _21"> </span>the<span class="_ _21"> </span>detailed<span class="_ _21"> </span>design<span class="_ _21"> </span>of<span class="_ _21"> </span>a<span class="_ _21"> </span>modern<span class="_ _f"> </span>microprocessor<span class="_ _21"> </span>is<span class="_ _21"> </span>well<span class="_ _21"> </span>beyond</div><div class="t m5 x1d h26 y2fd ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _15"> </span>scope<span class="_ _21"> </span>of<span class="_ _21"> </span>this<span class="_ _21"> </span>book,<span class="_ _f"> </span>having<span class="_ _21"> </span>a<span class="_ _21"> </span>general<span class="_ _21"> </span>idea<span class="_ _21"> </span>of<span class="_ _21"> </span>the<span class="_ _21"> </span>principles<span class="_ _21"> </span>by<span class="_ _21"> </span>which<span class="_ _15"> </span>they</div><div class="t m5 x1d h26 y2fe ff7 fs19 fc2 sc0 ls0 ws0">operate<span class="_ _13"> </span>sufﬁces<span class="_"> </span>to<span class="_ _13"> </span>understand<span class="_"> </span>how<span class="_ _13"> </span>they<span class="_"> </span>achieve<span class="_ _13"> </span>instruction-level<span class="_"> </span>parallelism.<span class="_ _13"> </span>W<span class="_ _3"></span>e</div><div class="t m5 x1d h26 y2ff ff7 fs19 fc2 sc0 ls0 ws0">will<span class="_"> </span>ﬁnd<span class="_ _13"> </span>that<span class="_"> </span>two<span class="_ _13"> </span>different<span class="_"> </span>lower<span class="_"> </span>bounds<span class="_ _13"> </span>characterize<span class="_"> </span>the<span class="_ _13"> </span>maximum<span class="_"> </span>performance</div><div class="t m5 x1d h26 y300 ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_ _21"> </span>a<span class="_ _f"> </span>program.<span class="_ _f"> </span>T<span class="_ _0"></span>he<span class="_ _f"> </span><span class="ffa">latency<span class="_ _21"> </span>bound<span class="_ _e"> </span></span>is<span class="_ _21"> </span>encountered<span class="_ _f"> </span>when<span class="_ _f"> </span>a<span class="_ _f"> </span>series<span class="_ _21"> </span>of<span class="_ _f"> </span>operations</div><div class="t m5 x1d h26 y21a ff7 fs19 fc2 sc0 ls0 ws0">must<span class="_ _21"> </span>be<span class="_ _f"> </span>performed<span class="_ _f"> </span>in<span class="_ _f"> </span>strict<span class="_ _f"> </span>sequence,<span class="_ _e"> </span>because<span class="_ _21"> </span>the<span class="_ _21"> </span>result<span class="_ _f"> </span>of<span class="_ _f"> </span>one<span class="_ _f"> </span>operation<span class="_ _f"> </span>is</div><div class="t m5 x1d h26 y450 ff7 fs19 fc2 sc0 ls0 ws0">required<span class="_ _6"> </span>before<span class="_ _6"> </span>the<span class="_ _6"> </span>next<span class="_ _a"> </span>one<span class="_ _6"> </span>can<span class="_ _6"> </span>begin.<span class="_ _6"> </span>This<span class="_ _a"> </span>bound<span class="_ _6"> </span>can<span class="_ _6"> </span>limit<span class="_ _6"> </span>program<span class="_ _6"> </span>performance</div><div class="t m5 x1d h26 y451 ff7 fs19 fc2 sc0 ls0 ws0">when<span class="_ _f"> </span>the<span class="_ _f"> </span>data<span class="_ _f"> </span>dependencies<span class="_ _f"> </span>in<span class="_ _f"> </span>the<span class="_ _f"> </span>code<span class="_ _f"> </span>limit<span class="_ _e"> </span>the<span class="_ _21"> </span>ability<span class="_ _f"> </span>of<span class="_ _f"> </span>the<span class="_ _f"> </span>processor<span class="_ _f"> </span>to</div><div class="t m5 x1d h26 y452 ff7 fs19 fc2 sc0 ls0 ws0">exploit<span class="_ _13"> </span>instruction-level<span class="_"> </span>parallelism.<span class="_ _13"> </span>The<span class="_ _13"> </span><span class="ffa">throughput<span class="_ _13"> </span>bound<span class="_"> </span></span>characterizes<span class="_"> </span>the<span class="_ _13"> </span>raw</div><div class="t m5 x1d h26 y453 ff7 fs19 fc2 sc0 ls0 ws0">computing<span class="_ _16"> </span>capacity<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>processor’s<span class="_ _11"> </span>functional<span class="_ _16"> </span>units<span class="_ _1"></span>.<span class="_ _11"> </span>This<span class="_ _11"> </span>bound<span class="_ _16"> </span>becomes<span class="_ _16"> </span>the</div><div class="t m5 x1d h26 y454 ff7 fs19 fc2 sc0 ls0 ws0">ultimate<span class="_"> </span>limit<span class="_"> </span>on<span class="_"> </span>program<span class="_"> </span>performance<span class="_ _1"></span>.</div><div class="t m5 x1d h41 y4bb2 ffe fs29 fc2 sc0 ls0 ws0">5.7.1<span class="_ _48"> </span><span class="fs19">Overall<span class="_"> </span>Operation</span></div><div class="t m5 x1d h26 y4bb3 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _14"> </span>5.11<span class="_ _15"> </span>shows<span class="_ _14"> </span>a<span class="_ _14"> </span>very<span class="_ _14"> </span>simpliﬁed<span class="_ _14"> </span>view<span class="_ _14"> </span>of<span class="_ _14"> </span>a<span class="_ _14"> </span>modern<span class="_ _14"> </span>microprocessor.<span class="_ _14"> </span>Our<span class="_ _14"> </span>hy-</div><div class="t m5 x1d h26 y4bb4 ff7 fs19 fc2 sc0 ls0 ws0">pothetical<span class="_ _11"> </span>processor<span class="_ _11"> </span>design<span class="_ _11"> </span>is<span class="_ _16"> </span>based<span class="_ _11"> </span>loosely<span class="_ _11"> </span>on<span class="_ _11"> </span>the<span class="_ _11"> </span>structure<span class="_ _16"> </span>of<span class="_ _11"> </span>recent<span class="_ _11"> </span>Intel<span class="_ _11"> </span>pro-</div><div class="t m5 x1d h26 y4bb5 ff7 fs19 fc2 sc0 ls0 ws0">cessors<span class="_ _1"></span>.<span class="_ _13"> </span>T<span class="_ _1"></span>hese<span class="_ _13"> </span>processors<span class="_ _13"> </span>are<span class="_ _13"> </span>described<span class="_ _13"> </span>in<span class="_ _6"> </span>the<span class="_ _13"> </span>industry<span class="_ _13"> </span>as<span class="_ _13"> </span>being<span class="_ _13"> </span><span class="ffa">superscalar<span class="_ _2"></span></span>,<span class="_ _13"> </span>which</div><div class="t m5 x1d h26 y4bb6 ff7 fs19 fc2 sc0 ls0 ws0">means<span class="_ _13"> </span>they<span class="_ _6"> </span>can<span class="_ _13"> </span>perform<span class="_ _13"> </span>multiple<span class="_ _13"> </span>operations<span class="_ _6"> </span>on<span class="_ _13"> </span>every<span class="_ _13"> </span>clock<span class="_ _13"> </span>c<span class="_ _1"></span>ycle<span class="_ _13"> </span>and<span class="_ _13"> </span><span class="ffa">out<span class="_ _13"> </span>of<span class="_ _6"> </span>order<span class="_ _2"></span></span>,</div><div class="t m5 x1d h26 y4bb7 ff7 fs19 fc2 sc0 ls0 ws0">meaning<span class="_ _13"> </span>that<span class="_ _13"> </span>the<span class="_ _13"> </span>order<span class="_ _13"> </span>in<span class="_ _13"> </span>which<span class="_ _13"> </span>instructions<span class="_ _13"> </span>execute<span class="_ _13"> </span>need<span class="_ _13"> </span>not<span class="_ _13"> </span>correspond<span class="_ _13"> </span>to<span class="_ _13"> </span>their</div><div class="t m5 x1d h26 y4bb8 ff7 fs19 fc2 sc0 ls0 ws0">ordering<span class="_ _16"> </span>in<span class="_ _14"> </span>the<span class="_ _14"> </span>machine-level<span class="_ _14"> </span>program.<span class="_ _16"> </span>The<span class="_ _16"> </span>overall<span class="_ _14"> </span>design<span class="_ _16"> </span>has<span class="_ _14"> </span>two<span class="_ _14"> </span>main<span class="_ _14"> </span>parts:</div><div class="t m5 x1d h26 y4bb9 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span><span class="ffa">instruction<span class="_"> </span>control<span class="_"> </span>unit<span class="_ _11"> </span></span>(ICU),<span class="_"> </span>which<span class="_"> </span>is<span class="_"> </span>responsible<span class="_"> </span>for<span class="_"> </span>reading<span class="_"> </span>a<span class="_"> </span>sequence<span class="_"> </span>of</div><div class="t m5 x1d h26 y4bba ff7 fs19 fc2 sc0 ls0 ws0">instructions<span class="_ _13"> </span>from<span class="_ _13"> </span>memory<span class="_ _13"> </span>and<span class="_ _13"> </span>generating<span class="_ _13"> </span>from<span class="_ _13"> </span>these<span class="_"> </span>a<span class="_ _13"> </span>set<span class="_ _13"> </span>of<span class="_ _13"> </span>primitive<span class="_ _13"> </span>operations</div><div class="t m5 x1d h26 y4bbb ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_ _16"> </span>perform<span class="_ _16"> </span>on<span class="_ _16"> </span>program<span class="_ _16"> </span>data,<span class="_ _16"> </span>and<span class="_ _16"> </span>the<span class="_ _16"> </span><span class="ffa">execution<span class="_ _16"> </span>unit<span class="_ _14"> </span></span>(EU),<span class="_ _14"> </span>which<span class="_ _16"> </span>then<span class="_ _16"> </span>executes</div><div class="t m5 x1d h26 y4bbc ff7 fs19 fc2 sc0 ls0 ws0">these<span class="_ _11"> </span>operations<span class="_ _1"></span>.<span class="_ _11"> </span>Compared<span class="_ _11"> </span>to<span class="_ _11"> </span>the<span class="_ _11"> </span>simple<span class="_ _11"> </span><span class="ffa">in-order<span class="_ _16"> </span></span>pipeline<span class="_ _11"> </span>we<span class="_ _11"> </span>studied<span class="_ _11"> </span>in<span class="_ _11"> </span>Chap-</div><div class="t m5 x1d h26 y4bbd ff7 fs19 fc2 sc0 ls0 ws0">ter<span class="_ _13"> </span>4,<span class="_ _13"> </span>out-of-order<span class="_ _6"> </span>processors<span class="_ _13"> </span>require<span class="_ _13"> </span>far<span class="_ _6"> </span>greater<span class="_ _13"> </span>and<span class="_ _13"> </span>more<span class="_ _6"> </span>complex<span class="_ _13"> </span>hardware<span class="_ _1"></span>,<span class="_ _13"> </span>but</div><div class="t m5 x1d h26 y4bbe ff7 fs19 fc2 sc0 ls0 ws0">they<span class="_"> </span>are<span class="_"> </span>better<span class="_"> </span>at<span class="_"> </span>achieving<span class="_"> </span>higher<span class="_"> </span>degrees<span class="_"> </span>of<span class="_"> </span>instruction-level<span class="_"> </span>parallelism.</div><div class="t m5 x29 h26 y4bbf ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _21"> </span>ICU<span class="_ _15"> </span>reads<span class="_ _15"> </span>the<span class="_ _15"> </span>instructions<span class="_ _21"> </span>from<span class="_ _15"> </span>an<span class="_ _15"> </span><span class="ffa">instruction<span class="_ _21"> </span>cache</span>—a<span class="_ _15"> </span>special<span class="_ _15"> </span>high-</div><div class="t m5 x1d h26 y4bc0 ff7 fs19 fc2 sc0 ls0 ws0">speed<span class="_ _21"> </span>memory<span class="_ _f"> </span>containing<span class="_ _21"> </span>the<span class="_ _f"> </span>most<span class="_ _f"> </span>recently<span class="_ _21"> </span>accessed<span class="_ _f"> </span>instructions<span class="_ _1"></span>.<span class="_ _21"> </span>In<span class="_ _f"> </span>general,</div><div class="t m5 x1d h26 y4bc1 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _11"> </span>ICU<span class="_ _11"> </span>fetches<span class="_ _11"> </span>well<span class="_ _11"> </span>ahead<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_"> </span>currently<span class="_ _11"> </span>executing<span class="_ _16"> </span>instructions<span class="_ _3"></span>,<span class="_ _16"> </span>so<span class="_ _11"> </span>that<span class="_ _11"> </span>it<span class="_ _11"> </span>has</div><div class="t m5 x1d h26 y4bc2 ff7 fs19 fc2 sc0 ls0 ws0">enough<span class="_"> </span>time<span class="_ _13"> </span>to<span class="_"> </span>decode<span class="_ _13"> </span>these<span class="_"> </span>and<span class="_ _13"> </span>send<span class="_"> </span>operations<span class="_ _13"> </span>down<span class="_"> </span>to<span class="_ _13"> </span>the<span class="_"> </span>EU<span class="_ _7"></span>.<span class="_"> </span>One<span class="_ _13"> </span>problem,</div><div class="t m5 x1d h26 y4bc3 ff7 fs19 fc2 sc0 ls0 ws0">however,<span class="_"> </span>is<span class="_ _13"> </span>that<span class="_"> </span>when<span class="_"> </span>a<span class="_"> </span>program<span class="_"> </span>hits<span class="_"> </span>a<span class="_"> </span>branch,</div><div class="t m5 x175 h3c y4bc4 ff7 fs25 fc2 sc0 ls0 ws0">1</div><div class="t m5 xff h26 y4bc5 ff7 fs19 fc2 sc0 ls0 ws0">there<span class="_"> </span>are<span class="_"> </span>two<span class="_"> </span>possible<span class="_"> </span>directions</div><div class="t m5 x1d h26 y4bc6 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _13"> </span>program<span class="_ _13"> </span>might<span class="_ _6"> </span>go.<span class="_ _6"> </span>T<span class="_ _0"></span>he<span class="_ _13"> </span>branch<span class="_ _13"> </span>can<span class="_ _6"> </span>be<span class="_ _13"> </span><span class="ffa">taken</span>,<span class="_ _13"> </span>with<span class="_ _13"> </span>control<span class="_ _13"> </span>passing<span class="_ _6"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>branch</div><div class="t m5 x1d h26 y4bc7 ff7 fs19 fc2 sc0 ls0 ws0">target.<span class="_ _13"> </span>Alternatively<span class="_ _3"></span>,<span class="_"> </span>the<span class="_ _13"> </span>branch<span class="_ _13"> </span>can<span class="_"> </span>be<span class="_ _13"> </span><span class="ffa">not<span class="_ _13"> </span>taken</span>,<span class="_ _13"> </span>with<span class="_"> </span>control<span class="_ _13"> </span>passing<span class="_ _13"> </span>to<span class="_"> </span>the<span class="_ _13"> </span>next</div><div class="t m5 x1d h1d y144c ff7 fs17 fc2 sc0 ls0 ws0">1.<span class="_"> </span>W<span class="_ _1"></span>e<span class="_ _10"> </span>use<span class="_"> </span>the<span class="_"> </span>term<span class="_ _10"> </span>“branch”<span class="_"> </span>speciﬁcally<span class="_ _10"> </span>to<span class="_"> </span>refer<span class="_"> </span>to<span class="_ _10"> </span>conditional<span class="_"> </span>jump<span class="_"> </span>instructions.<span class="_"> </span>Other<span class="_"> </span>instructions</div><div class="t m5 x1d h1d y4bc8 ff7 fs17 fc2 sc0 ls0 ws0">that<span class="_ _6"> </span>can<span class="_ _6"> </span>transfer<span class="_ _6"> </span>control<span class="_ _6"> </span>to<span class="_"> </span>multiple<span class="_ _a"> </span>destinations<span class="_ _0"></span>,<span class="_ _6"> </span>such<span class="_ _6"> </span>as<span class="_"> </span>procedure<span class="_ _a"> </span>return<span class="_ _6"> </span>and<span class="_ _6"> </span>indirect<span class="_"> </span>jumps<span class="_ _3"></span>,<span class="_"> </span>provide</div><div class="t m5 x1d h1d y4bc9 ff7 fs17 fc2 sc0 ls0 ws0">similar<span class="_"> </span>challenges<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>processor.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
