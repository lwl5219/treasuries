<div id="pfd4" class="pf w2 h11" data-page-no="d4"><div class="pc pcd4 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bgd4.png"/><div class="t m5 x1e8 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>3.2<span class="_ _60"> </span>Program<span class="_ _10"> </span>Encodings<span class="_ _3e"> </span><span class="ffe fs1e">211</span></div><div class="t m5 x17 h2d y140c ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>mult2(long<span class="_ _1f"> </span>a,<span class="_ _1f"> </span>long<span class="_ _e"> </span>b)<span class="_ _1f"> </span>{</div><div class="t m5 x1b6 h2d y140d ffd fs1e fc2 sc0 ls33 ws0">l<span class="_ _41"></span>o<span class="_ _41"></span>n<span class="_ _41"></span>gs=a*b<span class="_ _41"></span>;</div><div class="t m5 x1b6 h2d y1b95 ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>s;</div><div class="t m5 x52 h2d y2122 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x17 h26 y2123 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>hen<span class="_"> </span>we<span class="_"> </span>could<span class="_"> </span>generate<span class="_"> </span>an<span class="_"> </span>executable<span class="_"> </span>program<span class="_"> </span><span class="ffd">prog<span class="_ _10"> </span></span>as<span class="_"> </span>follows:</div><div class="t m5 x17 h2d y2124 ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">gcc<span class="_ _1f"> </span>-Og<span class="_ _1f"> </span>-o<span class="_ _e"> </span>prog<span class="_ _1f"> </span>main.c<span class="_ _e"> </span>mstore.c</span></div><div class="t m5 x17 h26 y2125 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _21"> </span>ﬁle<span class="_ _15"> </span><span class="ffd">prog<span class="_ _21"> </span></span>has<span class="_ _15"> </span>grown<span class="_ _21"> </span>to<span class="_ _15"> </span>8,655<span class="_ _21"> </span>bytes<span class="_ _1"></span>,<span class="_ _f"> </span>since<span class="_ _15"> </span>it<span class="_ _21"> </span>contains<span class="_ _15"> </span>not<span class="_ _21"> </span>just<span class="_ _15"> </span>the<span class="_ _21"> </span>machine</div><div class="t m5 x17 h26 y2126 ff7 fs19 fc2 sc0 ls0 ws0">code<span class="_ _16"> </span>for<span class="_ _16"> </span>the<span class="_ _14"> </span>procedures<span class="_ _16"> </span>we<span class="_ _16"> </span>provided<span class="_ _14"> </span>but<span class="_ _16"> </span>also<span class="_ _14"> </span>code<span class="_ _16"> </span>used<span class="_ _16"> </span>to<span class="_ _14"> </span>start<span class="_ _16"> </span>and<span class="_ _16"> </span>terminate</div><div class="t m5 x17 h26 y2127 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>program<span class="_"> </span>as<span class="_"> </span>well<span class="_"> </span>as<span class="_"> </span>to<span class="_"> </span>interact<span class="_"> </span>with<span class="_"> </span>the<span class="_"> </span>operating<span class="_"> </span>system.</div><div class="t m5 x26 h26 y2128 ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_"> </span>can<span class="_"> </span>disassemble<span class="_"> </span>the<span class="_"> </span>ﬁle<span class="_"> </span><span class="ffd">prog</span>:</div><div class="t m5 x17 h2d y2129 ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">objdump<span class="_ _1f"> </span>-d<span class="_ _1f"> </span>prog</span></div><div class="t m5 x17 h26 y212a ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>disassembler<span class="_"> </span>will<span class="_"> </span>extract<span class="_"> </span>various<span class="_"> </span>code<span class="_"> </span>sequences<span class="_ _1"></span>,<span class="_"> </span>including<span class="_"> </span>the<span class="_"> </span>following:</div><div class="t m5 x2d h75 y212b ff13 fs35 fc6 sc0 ls0 ws0">Disassembly<span class="_ _f"> </span>of<span class="_ _f"> </span>function<span class="_ _f"> </span><span class="ffd fs1f">sum<span class="_ _e"> </span></span>in<span class="_ _21"> </span>binary<span class="_ _f"> </span>file<span class="_ _e"> </span><span class="ffd fs1f">prog</span></div><div class="t m5 x2c h2d y212c ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">0000000000400540<span class="_ _1f"> </span>&lt;multstore&gt;:</span></div><div class="t m5 x2c h2d y212d ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">400540:<span class="_ _1a"> </span>53<span class="_ _129"> </span>push<span class="_ _3f"> </span>%rbx</span></div><div class="t m5 x2c h2d y212e ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">400541:<span class="_ _1a"> </span>48<span class="_ _e"> </span>89<span class="_ _1f"> </span>d3<span class="_ _12a"> </span>mov<span class="_ _7b"> </span>%rdx,%rbx</span></div><div class="t m5 x2c h2d y212f ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">400544:<span class="_ _1a"> </span>e8<span class="_ _e"> </span>42<span class="_ _1f"> </span>00<span class="_ _1f"> </span>00<span class="_ _e"> </span>00<span class="_ _86"> </span>callq<span class="_ _1a"> </span>40058b<span class="_ _1f"> </span>&lt;mult2&gt;</span></div><div class="t m5 x2c h2d y2130 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">400549:<span class="_ _1a"> </span>48<span class="_ _e"> </span>89<span class="_ _1f"> </span>03<span class="_ _12a"> </span>mov<span class="_ _7b"> </span>%rax,(%rbx)</span></div><div class="t m5 x2c h2d y2131 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">40054c:<span class="_ _1a"> </span>5b<span class="_ _129"> </span>pop<span class="_ _7b"> </span>%rbx</span></div><div class="t m5 x2c h2d y2132 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">40054d:<span class="_ _1a"> </span>c3<span class="_ _129"> </span>retq</span></div><div class="t m5 x2c h2d y2133 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _45"> </span><span class="ffd fs1e fc2">40054e:<span class="_ _1a"> </span>90<span class="_ _129"> </span>nop</span></div><div class="t m5 x2c h2d y2134 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _45"> </span><span class="ffd fs1e fc2">40054f:<span class="_ _1a"> </span>90<span class="_ _129"> </span>nop</span></div><div class="t m5 x26 h26 y2135 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _13"> </span>code<span class="_ _a"> </span>is<span class="_ _6"> </span>almost<span class="_ _13"> </span>identical<span class="_ _a"> </span>to<span class="_ _13"> </span>that<span class="_ _a"> </span>generated<span class="_ _13"> </span>by<span class="_ _a"> </span>the<span class="_ _6"> </span>disassembly<span class="_ _13"> </span>of<span class="_ _a"> </span><span class="ffd">mstore.c</span>.</div><div class="t m5 x17 h26 y2136 ff7 fs19 fc2 sc0 ls0 ws0">One<span class="_ _13"> </span>important<span class="_ _13"> </span>difference<span class="_"> </span>is<span class="_ _13"> </span>that<span class="_ _13"> </span>the<span class="_ _13"> </span>addresses<span class="_ _13"> </span>listed<span class="_"> </span>along<span class="_ _13"> </span>the<span class="_ _13"> </span>left<span class="_ _13"> </span>are<span class="_ _13"> </span>different—</div><div class="t m5 x17 h26 y2137 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>linker<span class="_ _13"> </span>has<span class="_"> </span>shifted<span class="_ _13"> </span>the<span class="_"> </span>location<span class="_ _13"> </span>of<span class="_"> </span>this<span class="_ _13"> </span>code<span class="_"> </span>to<span class="_ _13"> </span>a<span class="_"> </span>different<span class="_ _13"> </span>range<span class="_"> </span>of<span class="_ _13"> </span>addresses<span class="_ _1"></span>.<span class="_"> </span>A</div><div class="t m5 x17 h26 y2138 ff7 fs19 fc2 sc0 ls0 ws0">second<span class="_ _13"> </span>difference<span class="_ _13"> </span>is<span class="_"> </span>that<span class="_ _13"> </span>the<span class="_ _13"> </span>linker<span class="_ _13"> </span>has<span class="_ _13"> </span>ﬁlled<span class="_"> </span>in<span class="_ _13"> </span>the<span class="_ _13"> </span>address<span class="_ _13"> </span>that<span class="_ _13"> </span>the<span class="_"> </span><span class="ffd">callq<span class="_ _13"> </span></span>instruc-</div><div class="t m5 x17 h26 y2139 ff7 fs19 fc2 sc0 ls0 ws0">tion<span class="_"> </span>should<span class="_ _13"> </span>use<span class="_"> </span>in<span class="_ _13"> </span>calling<span class="_"> </span>the<span class="_ _13"> </span>function<span class="_"> </span><span class="ffd">mult2<span class="_ _13"> </span></span>(line<span class="_"> </span>4<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>disassembly).<span class="_ _13"> </span>One<span class="_"> </span>task</div><div class="t m5 x17 h26 y213a ff7 fs19 fc2 sc0 ls0 ws0">for<span class="_ _6"> </span>the<span class="_ _6"> </span>linker<span class="_ _13"> </span>is<span class="_ _a"> </span>to<span class="_ _6"> </span>match<span class="_ _13"> </span>function<span class="_ _a"> </span>calls<span class="_ _13"> </span>with<span class="_ _a"> </span>the<span class="_ _13"> </span>locations<span class="_ _a"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>executable<span class="_ _a"> </span>code<span class="_ _13"> </span>for</div><div class="t m5 x17 h26 y213b ff7 fs19 fc2 sc0 ls0 ws0">those<span class="_ _13"> </span>functions<span class="_ _1"></span>.<span class="_ _13"> </span>A<span class="_ _13"> </span>ﬁnal<span class="_ _13"> </span>difference<span class="_ _13"> </span>is<span class="_ _13"> </span>that<span class="_ _13"> </span>we<span class="_ _13"> </span>see<span class="_ _13"> </span>two<span class="_ _13"> </span>additional<span class="_ _13"> </span>lines<span class="_ _13"> </span>of<span class="_ _13"> </span>code<span class="_ _13"> </span>(lines</div><div class="t m5 x17 h26 y213c ff7 fs19 fc2 sc0 ls0 ws0">8–9).<span class="_ _13"> </span>These<span class="_ _13"> </span>instructions<span class="_"> </span>will<span class="_ _13"> </span>have<span class="_ _13"> </span>no<span class="_"> </span>effect<span class="_ _13"> </span>on<span class="_"> </span>the<span class="_ _13"> </span>program,<span class="_"> </span>since<span class="_ _13"> </span>they<span class="_"> </span>occur<span class="_ _13"> </span>after</div><div class="t m5 x17 h26 y213d ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _11"> </span>return<span class="_ _11"> </span>instruction<span class="_ _11"> </span>(line<span class="_"> </span>7).<span class="_ _11"> </span>They<span class="_"> </span>have<span class="_ _11"> </span>been<span class="_ _11"> </span>inserted<span class="_ _11"> </span>to<span class="_ _11"> </span>grow<span class="_ _11"> </span>the<span class="_ _11"> </span>code<span class="_ _11"> </span>for<span class="_ _11"> </span>the</div><div class="t m5 x17 h26 y213e ff7 fs19 fc2 sc0 ls0 ws0">function<span class="_ _13"> </span>to<span class="_ _6"> </span>16<span class="_ _13"> </span>bytes<span class="_ _3"></span>,<span class="_ _13"> </span>enabling<span class="_ _13"> </span>a<span class="_ _6"> </span>better<span class="_ _13"> </span>placement<span class="_ _13"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>next<span class="_ _6"> </span>block<span class="_ _13"> </span>of<span class="_ _13"> </span>code<span class="_ _6"> </span>in<span class="_ _13"> </span>terms</div><div class="t m5 x17 h26 y213f ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_"> </span>memory<span class="_"> </span>system<span class="_"> </span>performance<span class="_ _1"></span>.</div><div class="t m5 x17 h41 y2140 ffe fs29 fc2 sc0 ls0 ws0">3.2.3<span class="_ _48"> </span><span class="fs19">Notes<span class="_"> </span>on<span class="_"> </span>Formatting</span></div><div class="t m5 x17 h26 y2141 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _13"> </span>assembly<span class="_ _13"> </span>code<span class="_ _13"> </span>generated<span class="_ _13"> </span>by<span class="_ _13"> </span><span class="ff9">gcc<span class="_ _6"> </span></span>is<span class="_ _13"> </span>difﬁcult<span class="_ _13"> </span>for<span class="_ _13"> </span>a<span class="_ _13"> </span>human<span class="_ _13"> </span>to<span class="_ _6"> </span>read.<span class="_ _13"> </span>On<span class="_ _13"> </span>one<span class="_ _13"> </span>hand,</div><div class="t m5 x17 h26 y2142 ff7 fs19 fc2 sc0 ls0 ws0">it<span class="_"> </span>contains<span class="_"> </span>information<span class="_"> </span>with<span class="_"> </span>which<span class="_"> </span>we<span class="_"> </span>need<span class="_"> </span>not<span class="_"> </span>be<span class="_ _13"> </span>concerned,<span class="_"> </span>while<span class="_"> </span>on<span class="_"> </span>the<span class="_"> </span>other</div><div class="t m5 x17 h26 y2143 ff7 fs19 fc2 sc0 ls0 ws0">hand,<span class="_ _15"> </span>it<span class="_ _14"> </span>does<span class="_ _14"> </span>not<span class="_ _14"> </span>provide<span class="_ _14"> </span>any<span class="_ _14"> </span>description<span class="_ _14"> </span>of<span class="_ _14"> </span>the<span class="_ _14"> </span>program<span class="_ _15"> </span>or<span class="_ _14"> </span>how<span class="_ _14"> </span>it<span class="_ _14"> </span>works<span class="_ _1"></span>.<span class="_ _14"> </span>F<span class="_ _1"></span>or</div><div class="t m5 x17 h26 y2144 ff7 fs19 fc2 sc0 ls0 ws0">example<span class="_ _1"></span>,<span class="_"> </span>suppose<span class="_"> </span>we<span class="_"> </span>give<span class="_"> </span>the<span class="_"> </span>command</div><div class="t m5 x17 h2d y177d ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">gcc<span class="_ _1f"> </span>-Og<span class="_ _1f"> </span>-S<span class="_ _e"> </span>mstore.c</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
