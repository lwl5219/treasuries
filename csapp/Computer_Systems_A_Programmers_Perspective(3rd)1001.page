<div id="pf3e9" class="pf w2 h11" data-page-no="3e9"><div class="pc pc3e9 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg3e9.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">1000<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>11<span class="_ _3d"> </span>Network<span class="_ _10"> </span>Programming</span></div><div class="t m5 x28 h2a y257 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">Dealing<span class="_ _11"> </span>with<span class="_ _11"> </span>prematurely<span class="_ _11"> </span>closed<span class="_ _16"> </span>connections</span></div><div class="t m5 x28 h2b y258 ff7 fs1e fc2 sc0 ls0 ws0">Although<span class="_ _16"> </span>the<span class="_ _16"> </span>basic<span class="_ _16"> </span>functions<span class="_ _16"> </span>of<span class="_ _14"> </span>a<span class="_ _16"> </span>W<span class="_ _3"></span>eb<span class="_ _14"> </span>server<span class="_ _16"> </span>are<span class="_ _16"> </span>quite<span class="_ _16"> </span>simple,<span class="_ _16"> </span>we<span class="_ _16"> </span>don’t<span class="_ _16"> </span>want<span class="_ _16"> </span>to<span class="_ _16"> </span>give<span class="_ _16"> </span>you<span class="_ _14"> </span>the<span class="_ _16"> </span>false</div><div class="t m5 x28 h2b y259 ff7 fs1e fc2 sc0 ls0 ws0">impression<span class="_"> </span>that<span class="_"> </span>writing<span class="_"> </span>a<span class="_"> </span>real<span class="_"> </span>W<span class="_ _3"></span>eb<span class="_"> </span>server<span class="_"> </span>is<span class="_"> </span>easy<span class="_ _3"></span>.<span class="_"> </span>Building<span class="_"> </span>a<span class="_"> </span>robust<span class="_"> </span>W<span class="_ _3"></span>eb<span class="_"> </span>server<span class="_"> </span>that<span class="_"> </span>runs<span class="_"> </span>for<span class="_"> </span>extended</div><div class="t m5 x28 h2b y25a ff7 fs1e fc2 sc0 ls0 ws0">periods<span class="_ _15"> </span>without<span class="_ _15"> </span>crashing<span class="_ _15"> </span>is<span class="_ _15"> </span>a<span class="_ _15"> </span>difﬁcult<span class="_ _15"> </span>task<span class="_ _15"> </span>that<span class="_ _15"> </span>requires<span class="_ _15"> </span>a<span class="_ _21"> </span>deeper<span class="_ _15"> </span>understanding<span class="_ _15"> </span>of<span class="_ _15"> </span>Linux<span class="_ _15"> </span>systems</div><div class="t m5 x28 h2b y4e2 ff7 fs1e fc2 sc0 ls0 ws0">programming<span class="_"> </span>than<span class="_ _13"> </span>we’ve<span class="_ _13"> </span>learned<span class="_"> </span>here<span class="_ _1"></span>.<span class="_"> </span>F<span class="_ _1"></span>or<span class="_"> </span>example<span class="_ _1"></span>,<span class="_"> </span>if<span class="_ _13"> </span>a<span class="_"> </span>server<span class="_ _13"> </span>writes<span class="_"> </span>to<span class="_ _13"> </span>a<span class="_"> </span>connection<span class="_ _13"> </span>that<span class="_"> </span>has<span class="_ _13"> </span>already</div><div class="t m5 x28 h2b y4e3 ff7 fs1e fc2 sc0 ls0 ws0">been<span class="_"> </span>closed<span class="_ _10"> </span>by<span class="_ _11"> </span>the<span class="_"> </span>client<span class="_ _10"> </span>(say<span class="_ _3"></span>,<span class="_ _11"> </span>because<span class="_"> </span>you<span class="_ _10"> </span>clicked<span class="_ _11"> </span>the<span class="_"> </span>“Stop”<span class="_ _10"> </span>button<span class="_ _11"> </span>on<span class="_"> </span>your<span class="_ _10"> </span>browser),<span class="_ _11"> </span>then<span class="_"> </span>the<span class="_ _11"> </span>ﬁrst</div><div class="t m5 x28 h2b y4e4 ff7 fs1e fc2 sc0 ls0 ws0">such<span class="_ _6"> </span>write<span class="_ _13"> </span>returns<span class="_ _6"> </span>normally<span class="_ _3"></span>,<span class="_ _13"> </span>but<span class="_ _13"> </span>the<span class="_ _6"> </span>second<span class="_ _13"> </span>write<span class="_ _6"> </span>causes<span class="_ _13"> </span>the<span class="_ _6"> </span>delivery<span class="_ _13"> </span>of<span class="_ _6"> </span>a<span class="_ _13"> </span>SIGPIPE<span class="_ _6"> </span>signal<span class="_ _13"> </span>whose<span class="_ _6"> </span>default</div><div class="t m5 x28 h2b y945 ff7 fs1e fc2 sc0 ls0 ws0">behavior<span class="_"> </span>is<span class="_ _13"> </span>to<span class="_"> </span>terminate<span class="_"> </span>the<span class="_ _13"> </span>process<span class="_ _1"></span>.<span class="_"> </span>If<span class="_"> </span>the<span class="_ _13"> </span>SIGPIPE<span class="_"> </span>signal<span class="_"> </span>is<span class="_ _13"> </span>caught<span class="_"> </span>or<span class="_ _13"> </span>ignored,<span class="_"> </span>then<span class="_"> </span>the<span class="_ _13"> </span>second<span class="_"> </span>write</div><div class="t m5 x28 h4a y946 ff7 fs1e fc2 sc0 ls0 ws0">operation<span class="_ _11"> </span>returns<span class="_ _11"> </span><span class="ff12">−</span>1<span class="_"> </span>with<span class="_ _16"> </span><span class="ffd">errno<span class="_ _11"> </span></span>set<span class="_ _11"> </span>to<span class="_ _16"> </span>EPIPE.<span class="_ _11"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span><span class="ffd">strerr<span class="_ _11"> </span></span>and<span class="_ _11"> </span><span class="ffd">perror<span class="_ _11"> </span></span>functions<span class="_ _16"> </span>report<span class="_ _11"> </span>the<span class="_ _11"> </span>EPIPE</div><div class="t m5 x28 h2b y947 ff7 fs1e fc2 sc0 ls0 ws0">error<span class="_ _13"> </span>as<span class="_ _6"> </span>a<span class="_ _13"> </span>“Broken<span class="_ _6"> </span>pipe<span class="_ _0"></span>,<span class="_ _1"></span>”<span class="_ _13"> </span>a<span class="_ _6"> </span>nonintuitive<span class="_ _13"> </span>message<span class="_ _6"> </span>that<span class="_ _13"> </span>has<span class="_ _6"> </span>confused<span class="_ _13"> </span>generations<span class="_ _13"> </span>of<span class="_ _6"> </span>students<span class="_ _1"></span>.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span>bottom</div><div class="t m5 x28 h2b y948 ff7 fs1e fc2 sc0 ls0 ws0">line<span class="_ _13"> </span>is<span class="_ _13"> </span>that<span class="_ _13"> </span>a<span class="_ _13"> </span>robust<span class="_ _13"> </span>server<span class="_ _13"> </span>must<span class="_ _13"> </span>catch<span class="_ _13"> </span>these<span class="_"> </span>SIGPIPE<span class="_ _13"> </span>signals<span class="_ _13"> </span>and<span class="_ _13"> </span>check<span class="_ _13"> </span><span class="ffd">write<span class="_ _13"> </span></span>function<span class="_ _13"> </span>calls<span class="_ _13"> </span>for<span class="_ _13"> </span>EPIPE</div><div class="t m5 x28 h2b y949 ff7 fs1e fc2 sc0 ls0 ws0">errors<span class="_ _1"></span>.</div><div class="t m5 x1d h26 y7e34 ff7 fs19 fc2 sc0 ls0 ws0">set<span class="_ _6"> </span>the<span class="_ _13"> </span>other<span class="_ _6"> </span>CGI<span class="_ _6"> </span>environment<span class="_ _13"> </span>variables<span class="_ _6"> </span>here<span class="_ _13"> </span>as<span class="_ _6"> </span>well.<span class="_ _6"> </span>F<span class="_ _1"></span>or<span class="_ _13"> </span>brevity<span class="_ _7"></span>,<span class="_ _13"> </span>we<span class="_ _6"> </span>have<span class="_ _13"> </span>omitted</div><div class="t m5 x1d h26 y7e35 ff7 fs19 fc2 sc0 ls0 ws0">this<span class="_"> </span>step<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y7e36 ff7 fs19 fc2 sc0 ls0 ws0">Next,<span class="_ _f"> </span>the<span class="_ _21"> </span>child<span class="_ _f"> </span>redirects<span class="_ _21"> </span>the<span class="_ _21"> </span>child’s<span class="_ _15"> </span>standard<span class="_ _f"> </span>output<span class="_ _21"> </span>to<span class="_ _21"> </span>the<span class="_ _21"> </span>connected<span class="_ _21"> </span>ﬁle</div><div class="t m5 x1d h26 y7e37 ff7 fs19 fc2 sc0 ls0 ws0">descriptor<span class="_ _14"> </span>(line<span class="_ _15"> </span>14)<span class="_ _14"> </span>and<span class="_ _14"> </span>then<span class="_ _15"> </span>loads<span class="_ _14"> </span>and<span class="_ _15"> </span>runs<span class="_ _14"> </span>the<span class="_ _15"> </span>CGI<span class="_ _14"> </span>program<span class="_ _15"> </span>(line<span class="_ _14"> </span>15).<span class="_ _14"> </span>Since</div><div class="t m5 x1d h26 y7e38 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>CGI<span class="_ _11"> </span>program<span class="_ _11"> </span>runs<span class="_ _11"> </span>in<span class="_ _11"> </span>the<span class="_ _11"> </span>context<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_"> </span>child,<span class="_ _11"> </span>it<span class="_ _11"> </span>has<span class="_ _11"> </span>access<span class="_ _11"> </span>to<span class="_ _11"> </span>the<span class="_ _11"> </span>same<span class="_ _11"> </span>open</div><div class="t m5 x1d h26 y7e39 ff7 fs19 fc2 sc0 ls0 ws0">ﬁles<span class="_ _13"> </span>and<span class="_ _6"> </span>environment<span class="_ _13"> </span>variables<span class="_ _13"> </span>that<span class="_ _13"> </span>existed<span class="_ _6"> </span>before<span class="_ _13"> </span>the<span class="_ _13"> </span>call<span class="_ _6"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ffd">execve<span class="_ _6"> </span></span>function.</div><div class="t m5 x1d h26 y7e3a ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>hus<span class="_ _1"></span>,<span class="_"> </span>everything<span class="_"> </span>that<span class="_"> </span>the<span class="_ _13"> </span>CGI<span class="_"> </span>program<span class="_"> </span>writes<span class="_ _13"> </span>to<span class="_"> </span>standard<span class="_"> </span>output<span class="_ _13"> </span>goes<span class="_"> </span>directly<span class="_"> </span>to</div><div class="t m5 x1d h26 y7e3b ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>client<span class="_"> </span>process<span class="_ _1"></span>,<span class="_ _11"> </span>without<span class="_"> </span>any<span class="_"> </span>intervention<span class="_ _11"> </span>from<span class="_"> </span>the<span class="_"> </span>parent<span class="_"> </span>process<span class="_ _0"></span>.<span class="_"> </span>Meanwhile<span class="_ _0"></span>,</div><div class="t m5 x1d h26 y7e3c ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _16"> </span>parent<span class="_ _16"> </span>blocks<span class="_ _11"> </span>in<span class="_ _16"> </span>a<span class="_ _16"> </span>call<span class="_ _16"> </span>to<span class="_ _16"> </span><span class="ffd">wait</span>,<span class="_ _16"> </span>waiting<span class="_ _16"> </span>to<span class="_ _16"> </span>reap<span class="_ _16"> </span>the<span class="_ _16"> </span>child<span class="_ _16"> </span>when<span class="_ _11"> </span>it<span class="_ _16"> </span>terminates</div><div class="t m5 x1d h26 y7e3d ff7 fs19 fc2 sc0 ls0 ws0">(line<span class="_"> </span>17).</div><div class="t m5 x1d h3b y322c fff fs24 fc6 sc0 ls0 ws0">11.7<span class="_ _17"> </span><span class="ffe fs18">Summar<span class="_ _2"></span>y</span></div><div class="t m5 x1d h26 y2156 ff7 fs19 fc1 sc0 ls0 ws0">Every<span class="_ _11"> </span>network<span class="_ _11"> </span>application<span class="_ _11"> </span>is<span class="_ _11"> </span>based<span class="_ _11"> </span>on<span class="_ _11"> </span>the<span class="_ _11"> </span>client-server<span class="_ _11"> </span>model.<span class="_ _11"> </span>W<span class="_ _0"></span>ith<span class="_"> </span>this<span class="_ _16"> </span>model,</div><div class="t m5 x1d h26 y248b ff7 fs19 fc1 sc0 ls0 ws0">an<span class="_ _16"> </span>application<span class="_ _11"> </span>consists<span class="_ _16"> </span>of<span class="_ _16"> </span>a<span class="_ _16"> </span>server<span class="_ _11"> </span>and<span class="_ _16"> </span>one<span class="_ _16"> </span>or<span class="_ _16"> </span>more<span class="_ _11"> </span>clients<span class="_ _1"></span>.<span class="_ _16"> </span>T<span class="_ _0"></span>he<span class="_ _16"> </span>server<span class="_ _11"> </span>manages</div><div class="t m5 x1d h26 y248c ff7 fs19 fc1 sc0 ls0 ws0">resources<span class="_ _1"></span>,<span class="_ _13"> </span>providing<span class="_ _13"> </span>a<span class="_ _13"> </span>service<span class="_ _13"> </span>for<span class="_ _13"> </span>its<span class="_ _13"> </span>clients<span class="_ _13"> </span>by<span class="_ _13"> </span>manipulating<span class="_ _13"> </span>the<span class="_ _13"> </span>resources<span class="_ _13"> </span>in<span class="_ _13"> </span>some</div><div class="t m5 x1d h26 y248d ff7 fs19 fc1 sc0 ls0 ws0">way<span class="_ _3"></span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_ _11"> </span>basic<span class="_"> </span>operation<span class="_ _11"> </span>in<span class="_"> </span>the<span class="_ _11"> </span>client-server<span class="_"> </span>model<span class="_"> </span>is<span class="_ _11"> </span>a<span class="_"> </span>client-server<span class="_ _11"> </span>transaction,</div><div class="t m5 x1d h26 y248e ff7 fs19 fc1 sc0 ls0 ws0">which<span class="_"> </span>consists<span class="_"> </span>of<span class="_"> </span>a<span class="_"> </span>request<span class="_"> </span>from<span class="_"> </span>a<span class="_"> </span>client,<span class="_"> </span>followed<span class="_"> </span>by<span class="_"> </span>a<span class="_"> </span>response<span class="_"> </span>from<span class="_"> </span>the<span class="_ _13"> </span>server.</div><div class="t m5 x29 h26 y248f ff7 fs19 fc1 sc0 ls0 ws0">Clients<span class="_ _6"> </span>and<span class="_ _6"> </span>servers<span class="_ _6"> </span>communicate<span class="_ _6"> </span>over<span class="_ _6"> </span>a<span class="_ _6"> </span>global<span class="_ _6"> </span>network<span class="_ _6"> </span>known<span class="_ _6"> </span>as<span class="_ _6"> </span>the<span class="_ _6"> </span>Internet.</div><div class="t m5 x1d h26 y2490 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>rom<span class="_ _11"> </span>a<span class="_ _11"> </span>programmer’s<span class="_"> </span>point<span class="_"> </span>of<span class="_ _11"> </span>view<span class="_ _3"></span>,<span class="_ _11"> </span>we<span class="_"> </span>can<span class="_ _11"> </span>think<span class="_"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>Internet<span class="_"> </span>as<span class="_ _11"> </span>a<span class="_ _11"> </span>worldwide</div><div class="t m5 x1d h26 y2491 ff7 fs19 fc1 sc0 ls0 ws0">collection<span class="_ _15"> </span>of<span class="_ _15"> </span>hosts<span class="_ _21"> </span>with<span class="_ _15"> </span>the<span class="_ _15"> </span>following<span class="_ _21"> </span>properties:<span class="_ _15"> </span>(1)<span class="_ _15"> </span>Each<span class="_ _21"> </span>Internet<span class="_ _15"> </span>host<span class="_ _15"> </span>has<span class="_ _21"> </span>a</div><div class="t m5 x1d h26 y2492 ff7 fs19 fc1 sc0 ls0 ws0">unique<span class="_ _16"> </span>32-bit<span class="_ _16"> </span>name<span class="_ _16"> </span>called<span class="_ _16"> </span>its<span class="_ _16"> </span>IP<span class="_ _16"> </span>address<span class="_ _0"></span>.<span class="_ _16"> </span>(2)<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _14"> </span>set<span class="_ _16"> </span>of<span class="_ _16"> </span>IP<span class="_ _16"> </span>addresses<span class="_ _16"> </span>is<span class="_ _16"> </span>mapped</div><div class="t m5 x1d h26 y2493 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _11"> </span>a<span class="_ _16"> </span>set<span class="_ _16"> </span>of<span class="_ _11"> </span>Internet<span class="_ _16"> </span>domain<span class="_ _11"> </span>names<span class="_ _1"></span>.<span class="_ _16"> </span>(3)<span class="_ _11"> </span>Processes<span class="_ _16"> </span>on<span class="_ _16"> </span>different<span class="_ _11"> </span>Internet<span class="_ _16"> </span>hosts<span class="_ _11"> </span>can</div><div class="t m5 x1d h26 y2494 ff7 fs19 fc1 sc0 ls0 ws0">communicate<span class="_"> </span>with<span class="_"> </span>each<span class="_"> </span>other<span class="_"> </span>over<span class="_"> </span>connections<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y2495 ff7 fs19 fc1 sc0 ls0 ws0">Clients<span class="_ _14"> </span>and<span class="_ _14"> </span>servers<span class="_ _15"> </span>establish<span class="_ _14"> </span>connections<span class="_ _14"> </span>by<span class="_ _15"> </span>using<span class="_ _14"> </span>the<span class="_ _14"> </span>sockets<span class="_ _15"> </span>interface<span class="_ _1"></span>.<span class="_ _15"> </span>A</div><div class="t m5 x1d h26 y2496 ff7 fs19 fc1 sc0 ls0 ws0">socket<span class="_ _15"> </span>is<span class="_ _15"> </span>an<span class="_ _15"> </span>end<span class="_ _15"> </span>point<span class="_ _15"> </span>of<span class="_ _15"> </span>a<span class="_ _15"> </span>connection<span class="_ _15"> </span>that<span class="_ _15"> </span>is<span class="_ _15"> </span>presented<span class="_ _14"> </span>to<span class="_ _15"> </span>applications<span class="_ _15"> </span>in<span class="_ _15"> </span>the</div><div class="t m5 x1d h26 y2497 ff7 fs19 fc1 sc0 ls0 ws0">form<span class="_ _13"> </span>of<span class="_ _13"> </span>a<span class="_"> </span>ﬁle<span class="_ _13"> </span>descriptor.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span>sockets<span class="_"> </span>interface<span class="_ _13"> </span>provides<span class="_ _13"> </span>functions<span class="_ _13"> </span>for<span class="_"> </span>opening<span class="_ _13"> </span>and</div><div class="t m5 x1d h26 y44a4 ff7 fs19 fc1 sc0 ls0 ws0">closing<span class="_ _16"> </span>socket<span class="_ _16"> </span>descriptors<span class="_ _1"></span>.<span class="_ _16"> </span>Clients<span class="_ _14"> </span>and<span class="_ _16"> </span>servers<span class="_ _16"> </span>communicate<span class="_ _16"> </span>with<span class="_ _16"> </span>each<span class="_ _14"> </span>other<span class="_ _16"> </span>by</div><div class="t m5 x1d h26 y56bb ff7 fs19 fc1 sc0 ls0 ws0">reading<span class="_"> </span>and<span class="_"> </span>writing<span class="_"> </span>these<span class="_"> </span>descriptors<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
