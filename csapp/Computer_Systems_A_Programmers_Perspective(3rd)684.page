<div id="pf2ac" class="pf w2 h11" data-page-no="2ac"><div class="pc pc2ac w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg2ac.png"/><div class="t m5 x1c4 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>6.6<span class="_ _60"> </span>Putting<span class="_ _10"> </span>It<span class="_ _10"> </span>T<span class="_ _1"></span>ogether:<span class="_ _10"> </span>The<span class="_ _10"> </span>Impact<span class="_ _10"> </span>of<span class="_ _10"> </span>Caches<span class="_ _10"> </span>on<span class="_ _10"> </span>Program<span class="_ _10"> </span>Performance<span class="_ _3e"> </span><span class="ffe fs1e">683</span></div><div class="t m5 x34 h2a y257 fff fs1c fc2 sc0 ls0 ws0">W<span class="_ _1"></span>eb<span class="_ _16"> </span>Aside<span class="_ _14"> </span>MEM:BLOCKING<span class="_ _1b"> </span><span class="ff6 fs19">Using<span class="_ _11"> </span>blocking<span class="_ _11"> </span>to<span class="_ _11"> </span>increase<span class="_ _16"> </span>temporal<span class="_ _11"> </span>locality</span></div><div class="t m5 x34 h2b y2d0 ff7 fs1e fc2 sc0 ls0 ws0">T<span class="_ _1"></span>here<span class="_"> </span>is<span class="_ _13"> </span>an<span class="_ _13"> </span>interesting<span class="_ _13"> </span>technique<span class="_"> </span>called<span class="_ _13"> </span><span class="ffa">blocking<span class="_"> </span></span>that<span class="_ _13"> </span>can<span class="_ _13"> </span>improve<span class="_ _13"> </span>the<span class="_ _13"> </span>temporal<span class="_"> </span>locality<span class="_ _13"> </span>of<span class="_ _13"> </span>inner<span class="_ _13"> </span>loops<span class="_ _1"></span>.</div><div class="t m5 x34 h2b y2d1 ff7 fs1e fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _16"> </span>general<span class="_ _10"> </span>idea<span class="_ _16"> </span>of<span class="_ _11"> </span>blocking<span class="_ _11"> </span>is<span class="_ _11"> </span>to<span class="_ _11"> </span>organize<span class="_ _11"> </span>the<span class="_ _16"> </span>data<span class="_ _10"> </span>structures<span class="_ _16"> </span>in<span class="_ _11"> </span>a<span class="_ _11"> </span>program<span class="_ _11"> </span>into<span class="_ _11"> </span>large<span class="_ _11"> </span>chunks<span class="_ _16"> </span>called</div><div class="t m5 x34 h2b y2d2 ffa fs1e fc2 sc0 ls0 ws0">blocks<span class="ff7">.<span class="_ _13"> </span>(In<span class="_ _13"> </span>this<span class="_ _13"> </span>context,<span class="_"> </span>“block”<span class="_ _13"> </span>refers<span class="_ _13"> </span>to<span class="_ _13"> </span>an<span class="_ _13"> </span>application-level<span class="_ _13"> </span>chunk<span class="_ _13"> </span>of<span class="_ _13"> </span>data,<span class="_"> </span></span>not<span class="_"> </span><span class="ff7">to<span class="_ _13"> </span>a<span class="_ _13"> </span>cache<span class="_ _13"> </span>block.)<span class="_ _13"> </span>T<span class="_ _0"></span>he</span></div><div class="t m5 x34 h2b y2d3 ff7 fs1e fc2 sc0 ls0 ws0">program<span class="_ _11"> </span>is<span class="_ _11"> </span>structured<span class="_ _11"> </span>so<span class="_ _11"> </span>that<span class="_ _16"> </span>it<span class="_ _11"> </span>loads<span class="_ _11"> </span>a<span class="_ _11"> </span>chunk<span class="_ _11"> </span>into<span class="_ _11"> </span>the<span class="_ _11"> </span>L1<span class="_ _16"> </span>cache<span class="_ _1"></span>,<span class="_ _16"> </span>does<span class="_ _11"> </span>all<span class="_ _11"> </span>the<span class="_ _11"> </span>reads<span class="_ _11"> </span>and<span class="_ _11"> </span>writes<span class="_ _16"> </span>that<span class="_ _11"> </span>it</div><div class="t m5 x34 h2b y2d4 ff7 fs1e fc2 sc0 ls0 ws0">needs<span class="_"> </span>to<span class="_"> </span>on<span class="_"> </span>that<span class="_"> </span>chunk,<span class="_"> </span>then<span class="_"> </span>discards<span class="_"> </span>the<span class="_"> </span>chunk,<span class="_"> </span>loads<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>next<span class="_"> </span>chunk,<span class="_"> </span>and<span class="_"> </span>so<span class="_"> </span>on.</div><div class="t m5 x35 h2b y2d5 ff7 fs1e fc2 sc0 ls0 ws0">Unlike<span class="_ _16"> </span>the<span class="_ _16"> </span>simple<span class="_ _16"> </span>loop<span class="_ _16"> </span>transformations<span class="_ _16"> </span>for<span class="_ _16"> </span>improving<span class="_ _16"> </span>spatial<span class="_ _16"> </span>locality<span class="_ _3"></span>,<span class="_ _16"> </span>blocking<span class="_ _16"> </span>makes<span class="_ _16"> </span>the<span class="_ _16"> </span>code</div><div class="t m5 x34 h2b y2d6 ff7 fs1e fc2 sc0 ls0 ws0">harder<span class="_"> </span>to<span class="_"> </span>read<span class="_"> </span>and<span class="_ _13"> </span>understand.<span class="_"> </span>F<span class="_ _1"></span>or<span class="_"> </span>this<span class="_"> </span>reason,<span class="_"> </span>it<span class="_"> </span>is<span class="_"> </span>best<span class="_ _13"> </span>suited<span class="_"> </span>for<span class="_"> </span>optimizing<span class="_"> </span>compilers<span class="_"> </span>or<span class="_"> </span>frequently</div><div class="t m5 x34 h2b y549 ff7 fs1e fc2 sc0 ls0 ws0">executed<span class="_"> </span>library<span class="_"> </span>routines<span class="_ _3"></span>.<span class="_"> </span>Blocking<span class="_"> </span>does<span class="_"> </span>not<span class="_"> </span>improve<span class="_ _13"> </span>the<span class="_"> </span>performance<span class="_"> </span>of<span class="_"> </span>matrix<span class="_ _13"> </span>multiply<span class="_"> </span>on<span class="_"> </span>the<span class="_"> </span>Core</div><div class="t m5 x34 h2b y54a ff7 fs1e fc2 sc0 ls0 ws0">i7,<span class="_ _16"> </span>because<span class="_ _14"> </span>of<span class="_ _16"> </span>its<span class="_ _16"> </span>sophisticated<span class="_ _16"> </span>prefetching<span class="_ _16"> </span>hardware<span class="_ _0"></span>.<span class="_ _16"> </span>Still,<span class="_ _14"> </span>the<span class="_ _16"> </span>technique<span class="_ _16"> </span>is<span class="_ _16"> </span>interesting<span class="_ _16"> </span>to<span class="_ _16"> </span>study<span class="_ _16"> </span>and</div><div class="t m5 x34 h2b y54b ff7 fs1e fc2 sc0 ls0 ws0">understand<span class="_ _16"> </span>because<span class="_ _16"> </span>it<span class="_ _16"> </span>is<span class="_ _16"> </span>a<span class="_ _16"> </span>general<span class="_ _16"> </span>concept<span class="_ _16"> </span>that<span class="_ _16"> </span>can<span class="_ _16"> </span>produce<span class="_ _16"> </span>big<span class="_ _14"> </span>performance<span class="_ _16"> </span>gains<span class="_ _16"> </span>on<span class="_ _16"> </span>systems<span class="_ _16"> </span>that</div><div class="t m5 x34 h2b y54c ff7 fs1e fc2 sc0 ls0 ws0">don’t<span class="_"> </span>prefetch.</div><div class="t m5 x26 h26 y5b3c ff7 fs19 fc2 sc0 ls0 ws0">memory<span class="_"> </span>references<span class="_ _13"> </span>in<span class="_"> </span>the<span class="_"> </span>inner<span class="_ _13"> </span>loop<span class="_"> </span>(two<span class="_"> </span>loads<span class="_ _13"> </span>and<span class="_"> </span>one<span class="_"> </span>store)<span class="_ _13"> </span>than<span class="_"> </span>the<span class="_"> </span>class</div><div class="t m5 x26 h26 y5b3d ff11 fs19 fc2 sc0 ls0 ws0">AB<span class="_"> </span><span class="ff7">routines<span class="_"> </span>(two<span class="_"> </span>loads).</span></div><div class="t m5 x72 h3d y5b3e ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y5b3f ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_"> </span>large<span class="_"> </span>values<span class="_"> </span>of<span class="_"> </span><span class="ff11">n</span>,<span class="_"> </span>the<span class="_"> </span>performance<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>fastest<span class="_"> </span>pair<span class="_"> </span>of<span class="_"> </span>versions<span class="_"> </span>(<span class="ff11 ls10">ki<span class="_ _3"></span>j<span class="_ _16"> </span><span class="ff7 ls0">and</span></span></div><div class="t m5 x26 h26 y5b40 ff11 fs19 fc1 sc0 ls57 ws0">ik<span class="_ _7"></span>j<span class="_ _2"></span><span class="ff7 ls0">)<span class="_"> </span>is<span class="_ _13"> </span>constant.<span class="_"> </span>Even<span class="_"> </span>though<span class="_ _13"> </span>the<span class="_"> </span>array<span class="_ _13"> </span>is<span class="_"> </span>much<span class="_ _13"> </span>larger<span class="_"> </span>than<span class="_"> </span>any<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>SRAM</span></div><div class="t m5 x26 h26 y5b41 ff7 fs19 fc1 sc0 ls0 ws0">cache<span class="_ _11"> </span>memories<span class="_ _1"></span>,<span class="_ _16"> </span>the<span class="_"> </span>prefetching<span class="_ _16"> </span>hardware<span class="_ _11"> </span>is<span class="_ _11"> </span>smart<span class="_ _11"> </span>enough<span class="_ _16"> </span>to<span class="_ _11"> </span>recognize<span class="_ _11"> </span>the</div><div class="t m5 x26 h26 y5b42 ff7 fs19 fc1 sc0 ls0 ws0">stride-1<span class="_ _14"> </span>access<span class="_ _15"> </span>pattern,<span class="_ _21"> </span>and<span class="_ _15"> </span>fast<span class="_ _15"> </span>enough<span class="_ _14"> </span>to<span class="_ _15"> </span>keep<span class="_ _15"> </span>up<span class="_ _15"> </span>with<span class="_ _15"> </span>memory<span class="_ _14"> </span>accesses</div><div class="t m5 x26 h26 y5b43 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_ _11"> </span>the<span class="_ _16"> </span>tight<span class="_ _16"> </span>inner<span class="_ _11"> </span>loop<span class="_ _0"></span>.<span class="_ _11"> </span>This<span class="_ _11"> </span>is<span class="_ _11"> </span>a<span class="_ _16"> </span>stunning<span class="_ _16"> </span>accomplishment<span class="_ _11"> </span>by<span class="_ _16"> </span>the<span class="_ _11"> </span>Intel<span class="_ _16"> </span>engi-</div><div class="t m5 x26 h26 y5b44 ff7 fs19 fc1 sc0 ls0 ws0">neers<span class="_ _11"> </span>who<span class="_ _16"> </span>designed<span class="_ _11"> </span>this<span class="_ _11"> </span>memory<span class="_ _16"> </span>system,<span class="_ _11"> </span>providing<span class="_ _16"> </span>even<span class="_ _11"> </span>more<span class="_ _11"> </span>incentive<span class="_ _16"> </span>for</div><div class="t m5 x26 h26 y5b45 ff7 fs19 fc1 sc0 ls0 ws0">programmers<span class="_"> </span>to<span class="_"> </span>develop<span class="_"> </span>programs<span class="_"> </span>with<span class="_"> </span>good<span class="_"> </span>spatial<span class="_"> </span>locality<span class="_ _3"></span>.</div><div class="t m5 x17 h41 y5b46 ffe fs29 fc1 sc0 ls0 ws0">6.6.3<span class="_ _48"> </span><span class="fs19">Exploiting<span class="_"> </span>Locality<span class="_"> </span>in<span class="_"> </span>Y<span class="_ _3"></span>our<span class="_"> </span>Programs</span></div><div class="t m5 x17 h26 y5b47 ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_ _f"> </span>we<span class="_ _f"> </span>have<span class="_ _f"> </span>seen,<span class="_ _e"> </span>the<span class="_ _e"> </span>memory<span class="_ _21"> </span>system<span class="_ _f"> </span>is<span class="_ _f"> </span>organized<span class="_ _e"> </span>as<span class="_ _21"> </span>a<span class="_ _f"> </span>hierarchy<span class="_ _f"> </span>of<span class="_ _f"> </span>storage</div><div class="t m5 x17 h26 y5b48 ff7 fs19 fc1 sc0 ls0 ws0">devices<span class="_ _1"></span>,<span class="_ _21"> </span>with<span class="_ _15"> </span>smaller,<span class="_ _21"> </span>faster<span class="_ _15"> </span>devices<span class="_ _15"> </span>toward<span class="_ _15"> </span>the<span class="_ _15"> </span>top<span class="_ _15"> </span>and<span class="_ _15"> </span>larger,<span class="_ _21"> </span>slower<span class="_ _15"> </span>devices</div><div class="t m5 x17 h26 y5b49 ff7 fs19 fc1 sc0 ls0 ws0">toward<span class="_ _16"> </span>the<span class="_ _16"> </span>bottom.<span class="_ _16"> </span>Because<span class="_ _16"> </span>of<span class="_ _16"> </span>this<span class="_ _16"> </span>hierarchy<span class="_ _3"></span>,<span class="_ _14"> </span>the<span class="_ _16"> </span>effective<span class="_ _16"> </span>rate<span class="_ _16"> </span>that<span class="_ _16"> </span>a<span class="_ _16"> </span>program</div><div class="t m5 x17 h26 y5b4a ff7 fs19 fc1 sc0 ls0 ws0">can<span class="_"> </span>access<span class="_ _13"> </span>memory<span class="_"> </span>locations<span class="_ _13"> </span>is<span class="_"> </span>not<span class="_ _13"> </span>characterized<span class="_"> </span>by<span class="_ _13"> </span>a<span class="_"> </span>single<span class="_ _13"> </span>number.<span class="_ _13"> </span>Rather,<span class="_"> </span>it<span class="_ _13"> </span>is</div><div class="t m5 x17 h26 y5b4b ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_"> </span>wildly<span class="_"> </span>varying<span class="_"> </span>function<span class="_"> </span>of<span class="_"> </span>program<span class="_"> </span>locality<span class="_"> </span>(what<span class="_"> </span>we<span class="_"> </span>have<span class="_"> </span>dubbed<span class="_"> </span>the<span class="_"> </span>memory</div><div class="t m5 x17 h26 y5b4c ff7 fs19 fc1 sc0 ls0 ws0">mountain)<span class="_ _15"> </span>that<span class="_ _15"> </span>can<span class="_ _15"> </span>vary<span class="_ _21"> </span>by<span class="_ _15"> </span>orders<span class="_ _15"> </span>of<span class="_ _15"> </span>magnitude.<span class="_ _14"> </span>Programs<span class="_ _21"> </span>with<span class="_ _15"> </span>good<span class="_ _15"> </span>locality</div><div class="t m5 x17 h26 y5b4d ff7 fs19 fc1 sc0 ls0 ws0">access<span class="_ _11"> </span>most<span class="_ _11"> </span>of<span class="_ _11"> </span>their<span class="_ _11"> </span>data<span class="_ _11"> </span>from<span class="_ _11"> </span>fast<span class="_ _11"> </span>cache<span class="_ _11"> </span>memories<span class="_ _1"></span>.<span class="_ _11"> </span>Programs<span class="_ _11"> </span>with<span class="_ _11"> </span>poor<span class="_ _11"> </span>locality</div><div class="t m5 x17 h26 y5b4e ff7 fs19 fc1 sc0 ls0 ws0">access<span class="_"> </span>most<span class="_"> </span>of<span class="_"> </span>their<span class="_"> </span>data<span class="_"> </span>from<span class="_"> </span>the<span class="_"> </span>relatively<span class="_"> </span>slow<span class="_"> </span>DRAM<span class="_"> </span>main<span class="_"> </span>memory<span class="_ _3"></span>.</div><div class="t m5 x26 h26 y5b4f ff7 fs19 fc1 sc0 ls0 ws0">Programmers<span class="_ _16"> </span>who<span class="_ _14"> </span>understand<span class="_ _16"> </span>the<span class="_ _14"> </span>nature<span class="_ _14"> </span>of<span class="_ _16"> </span>the<span class="_ _14"> </span>memory<span class="_ _16"> </span>hierarchy<span class="_ _14"> </span>can<span class="_ _14"> </span>ex-</div><div class="t m5 x17 h26 y5b50 ff7 fs19 fc1 sc0 ls0 ws0">ploit<span class="_ _13"> </span>this<span class="_ _6"> </span>understanding<span class="_ _13"> </span>to<span class="_ _6"> </span>write<span class="_ _13"> </span>more<span class="_ _6"> </span>efﬁcient<span class="_ _13"> </span>programs<span class="_ _1"></span>,<span class="_ _13"> </span>regardless<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>speciﬁc</div><div class="t m5 x17 h26 y5b51 ff7 fs19 fc1 sc0 ls0 ws0">memory<span class="_ _14"> </span>system<span class="_ _14"> </span>organization.<span class="_ _14"> </span>In<span class="_ _14"> </span>particular,<span class="_ _14"> </span>we<span class="_ _14"> </span>recommend<span class="_ _14"> </span>the<span class="_ _14"> </span>following<span class="_ _14"> </span>tech-</div><div class="t m5 x17 h26 y5b52 ff7 fs19 fc1 sc0 ls0 ws0">niques:</div><div class="t m5 x72 h3d y5b53 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y464c ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>ocus<span class="_"> </span>your<span class="_"> </span>attention<span class="_"> </span>on<span class="_ _11"> </span>the<span class="_"> </span>inner<span class="_"> </span>loops<span class="_ _1"></span>,<span class="_"> </span>where<span class="_ _11"> </span>the<span class="_"> </span>bulk<span class="_"> </span>of<span class="_"> </span>the<span class="_ _11"> </span>computations</div><div class="t m5 x26 h26 y566f ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_"> </span>memory<span class="_"> </span>accesses<span class="_"> </span>occur.</div><div class="t m5 x72 h3d y5b54 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y2a46 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _7"></span>ry<span class="_"> </span>to<span class="_"> </span>maximize<span class="_"> </span>the<span class="_ _13"> </span>spatial<span class="_"> </span>locality<span class="_"> </span>in<span class="_"> </span>your<span class="_"> </span>programs<span class="_ _13"> </span>by<span class="_"> </span>reading<span class="_"> </span>data<span class="_"> </span>objects</div><div class="t m5 x26 h26 y5b55 ff7 fs19 fc1 sc0 ls0 ws0">sequentially<span class="_ _3"></span>,<span class="_"> </span>with<span class="_"> </span>stride<span class="_"> </span>1,<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>order<span class="_"> </span>they<span class="_"> </span>are<span class="_"> </span>stored<span class="_"> </span>in<span class="_"> </span>memory<span class="_ _7"></span>.</div><div class="t m5 x72 h3d y5b56 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 ye95 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _7"></span>ry<span class="_ _13"> </span>to<span class="_ _13"> </span>maximize<span class="_ _13"> </span>the<span class="_"> </span>temporal<span class="_ _13"> </span>locality<span class="_ _13"> </span>in<span class="_ _13"> </span>your<span class="_ _13"> </span>programs<span class="_ _13"> </span>by<span class="_ _13"> </span>using<span class="_ _13"> </span>a<span class="_ _13"> </span>data<span class="_ _13"> </span>object</div><div class="t m5 x26 h26 y5b57 ff7 fs19 fc1 sc0 ls0 ws0">as<span class="_"> </span>often<span class="_"> </span>as<span class="_"> </span>possible<span class="_"> </span>once<span class="_"> </span>it<span class="_"> </span>has<span class="_"> </span>been<span class="_"> </span>read<span class="_"> </span>from<span class="_"> </span>memory<span class="_ _3"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
