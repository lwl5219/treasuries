<div id="pf233" class="pf w2 h11" data-page-no="233"><div class="pc pc233 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg233.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">562<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>5<span class="_ _3d"> </span>Optimizing<span class="_ _10"> </span>Program<span class="_ _10"> </span>Performance</span></div><div class="t m5 xc5 h40 y4c77 ff59 fs28 fc1 sc0 ls0 ws0">%rax<span class="_ _ea"> </span>%rdx<span class="_ _3e"> </span>%xmm0</div><div class="t m5 x179 h40 y4c78 ff59 fs28 fc1 sc0 ls0 ws0">vmulsd (%rdx), %xmm0, %xmm0</div><div class="t m5 x179 h40 y4c79 ff59 fs28 fc1 sc0 ls0 ws0">addq $8,%rdx</div><div class="t m5 x179 h40 y4c7a ff59 fs28 fc1 sc0 ls0 ws0">cmpq %rax,%rdx</div><div class="t m5 x179 h40 y4c7b ff59 fs28 fc1 sc0 ls0 ws0">jne loop </div><div class="t m5 xc5 h40 y4c7c ff59 fs28 fc1 sc0 ls0 ws0">%rax<span class="_ _ea"> </span>%rdx<span class="_ _3e"> </span>%xmm0</div><div class="t m5 x125 h3f y4c7d ff58 fs27 fc1 sc0 ls214 ws0">load</div><div class="t m5 xe2 h3f y4c7e ff58 fs27 fc1 sc0 ls214 ws0">mul</div><div class="t m5 xe2 h3f y4c7f ff58 fs27 fc1 sc0 ls214 ws0">add</div><div class="t m5 x125 h3f y4c80 ff58 fs27 fc1 sc0 ls214 ws0">cmp</div><div class="t m5 xec h3f y4c81 ff58 fs27 fc1 sc0 ls214 ws0">jne</div><div class="t m5 x1d h3a y4c82 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _13"> </span>5.13<span class="_ _c"> </span><span class="fc1">Graphical<span class="_ _13"> </span>representation<span class="_ _10"> </span>of<span class="_ _13"> </span>inner-loop<span class="_ _13"> </span>code<span class="_ _13"> </span>for<span class="_"> </span><span class="ffd fs19">combine4</span>.<span class="_ _13"> </span><span class="ff6">Instructions</span></span></div><div class="t m5 x1d h34 y4c83 ff6 fs16 fc1 sc0 ls0 ws0">are<span class="_ _16"> </span>dynamically<span class="_ _16"> </span>translated<span class="_ _14"> </span>into<span class="_ _16"> </span>one<span class="_ _14"> </span>or<span class="_ _16"> </span>two<span class="_ _16"> </span>operations,<span class="_ _14"> </span>each<span class="_ _14"> </span>of<span class="_ _16"> </span>which<span class="_ _14"> </span>receives<span class="_ _16"> </span>values</div><div class="t m5 x1d h34 y4c84 ff6 fs16 fc1 sc0 ls0 ws0">from<span class="_ _10"> </span>other<span class="_ _13"> </span>operations<span class="_ _10"> </span>or<span class="_ _13"> </span>from<span class="_ _10"> </span>registers<span class="_ _10"> </span>and<span class="_ _13"> </span>produces<span class="_ _10"> </span>values<span class="_ _13"> </span>for<span class="_ _10"> </span>other<span class="_ _13"> </span>operations<span class="_ _10"> </span>and<span class="_ _10"> </span>for</div><div class="t m5 x1d h34 y4c85 ff6 fs16 fc1 sc0 ls0 ws0">registers.<span class="_ _11"> </span>We<span class="_ _10"> </span>show<span class="_ _16"> </span>the<span class="_ _11"> </span>target<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span>ﬁnal<span class="_ _11"> </span>instruction<span class="_ _11"> </span>as<span class="_ _16"> </span>the<span class="_ _11"> </span>label</div><div class="t m5 xaf h3a y4c86 ffd fs19 fc1 sc0 ls0 ws0">loop<span class="ff6 fs16">.<span class="_ _11"> </span>It<span class="_ _11"> </span>jumps<span class="_ _16"> </span>to<span class="_ _11"> </span>the</span></div><div class="t m5 x1d h34 y4c87 ff6 fs16 fc1 sc0 ls0 ws0">ﬁrst<span class="_ _10"> </span>instruction<span class="_ _11"> </span>shown.</div><div class="t m5 x29 h26 y89a ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_"> </span>F<span class="_ _0"></span>igure<span class="_"> </span>5.13<span class="_"> </span>indicates<span class="_ _1"></span>,<span class="_"> </span>with<span class="_ _11"> </span>our<span class="_"> </span>hypothetical<span class="_"> </span>processor<span class="_ _11"> </span>design,<span class="_"> </span>the<span class="_"> </span>four<span class="_"> </span>in-</div><div class="t m5 x1d h26 y89b ff7 fs19 fc1 sc0 ls0 ws0">structions<span class="_ _13"> </span>are<span class="_ _13"> </span>expanded<span class="_ _13"> </span>by<span class="_"> </span>the<span class="_ _13"> </span>instruction<span class="_ _13"> </span>decoder<span class="_ _13"> </span>into<span class="_ _13"> </span>a<span class="_ _13"> </span>series<span class="_ _13"> </span>of<span class="_"> </span>ﬁve<span class="_ _13"> </span><span class="ffa">operations</span>,</div><div class="t m5 x1d h26 y89c ff7 fs19 fc1 sc0 ls0 ws0">with<span class="_ _16"> </span>the<span class="_ _14"> </span>initial<span class="_ _16"> </span>multiplication<span class="_ _14"> </span>instruction<span class="_ _14"> </span>being<span class="_ _16"> </span>expanded<span class="_ _14"> </span>into<span class="_ _16"> </span>a<span class="_ _14"> </span><span class="ff6">load<span class="_ _14"> </span></span>operation</div><div class="t m5 x1d h26 y89d ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _16"> </span>read<span class="_ _14"> </span>the<span class="_ _14"> </span>source<span class="_ _16"> </span>operand<span class="_ _14"> </span>from<span class="_ _14"> </span>memory<span class="_ _3"></span>,<span class="_ _14"> </span>and<span class="_ _14"> </span>a<span class="_ _16"> </span><span class="ff6">mul<span class="_ _14"> </span></span>operation<span class="_ _14"> </span>to<span class="_ _16"> </span>perform<span class="_ _14"> </span>the</div><div class="t m5 x1d h26 y89e ff7 fs19 fc1 sc0 ls0 ws0">multiplication.</div><div class="t m5 x29 h26 y89f ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_ _13"> </span>a<span class="_ _13"> </span>step<span class="_ _13"> </span>toward<span class="_ _13"> </span>generating<span class="_ _13"> </span>a<span class="_ _13"> </span>data-ﬂow<span class="_ _13"> </span>graph<span class="_ _13"> </span>representation<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>program,</div><div class="t m5 x1d h26 y8a0 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>boxes<span class="_ _13"> </span>and<span class="_"> </span>lines<span class="_"> </span>along<span class="_"> </span>the<span class="_ _13"> </span>left-hand<span class="_"> </span>side<span class="_"> </span>of<span class="_ _13"> </span>Figure<span class="_ _13"> </span>5.13<span class="_"> </span>show<span class="_"> </span>how<span class="_"> </span>the<span class="_ _13"> </span>registers</div><div class="t m5 x1d h26 y8a1 ff7 fs19 fc1 sc0 ls0 ws0">are<span class="_ _16"> </span>used<span class="_ _16"> </span>and<span class="_ _16"> </span>updated<span class="_ _14"> </span>by<span class="_ _16"> </span>the<span class="_ _16"> </span>different<span class="_ _16"> </span>operations<span class="_ _1"></span>,<span class="_ _14"> </span>with<span class="_ _16"> </span>the<span class="_ _14"> </span>boxes<span class="_ _16"> </span>along<span class="_ _16"> </span>the<span class="_ _16"> </span>top</div><div class="t m5 x1d h26 y8a2 ff7 fs19 fc1 sc0 ls0 ws0">representing<span class="_"> </span>the<span class="_"> </span>register<span class="_"> </span>values<span class="_"> </span>at<span class="_"> </span>the<span class="_"> </span>beginning<span class="_ _11"> </span>of<span class="_"> </span>the<span class="_"> </span>loop<span class="_ _0"></span>,<span class="_"> </span>and<span class="_"> </span>those<span class="_"> </span>along<span class="_"> </span>the</div><div class="t m5 x1d h26 y8a3 ff7 fs19 fc1 sc0 ls0 ws0">bottom<span class="_ _13"> </span>representing<span class="_ _13"> </span>the<span class="_ _13"> </span>values<span class="_ _13"> </span>at<span class="_"> </span>the<span class="_ _13"> </span>end.<span class="_ _13"> </span>F<span class="_ _3"></span>or<span class="_ _13"> </span>example,<span class="_ _13"> </span>register<span class="_ _13"> </span><span class="ffd">%rax<span class="_ _13"> </span></span>is<span class="_ _13"> </span>only<span class="_ _13"> </span>used</div><div class="t m5 x1d h26 y8a4 ff7 fs19 fc1 sc0 ls0 ws0">as<span class="_"> </span>a<span class="_"> </span>source<span class="_"> </span>value<span class="_"> </span>by<span class="_ _13"> </span>the<span class="_"> </span><span class="ff6">cmp<span class="_ _10"> </span></span>operation,<span class="_"> </span>and<span class="_"> </span>so<span class="_"> </span>the<span class="_"> </span>register<span class="_"> </span>has<span class="_"> </span>the<span class="_ _13"> </span>same<span class="_"> </span>value<span class="_"> </span>at</div><div class="t m5 x1d h26 y8a5 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>end<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>loop<span class="_"> </span>as<span class="_"> </span>at<span class="_"> </span>the<span class="_"> </span>beginning.<span class="_"> </span>Register<span class="_"> </span><span class="ffd">%rdx</span>,<span class="_"> </span>on<span class="_"> </span>the<span class="_"> </span>other<span class="_"> </span>hand,<span class="_"> </span>is<span class="_"> </span>both</div><div class="t m5 x1d h26 y8a6 ff7 fs19 fc1 sc0 ls0 ws0">used<span class="_ _16"> </span>and<span class="_ _14"> </span>updated<span class="_ _14"> </span>within<span class="_ _14"> </span>the<span class="_ _14"> </span>loop<span class="_ _1"></span>.<span class="_ _14"> </span>Its<span class="_ _14"> </span>initial<span class="_ _14"> </span>value<span class="_ _14"> </span>is<span class="_ _14"> </span>used<span class="_ _16"> </span>by<span class="_ _14"> </span>the<span class="_ _14"> </span><span class="ff6">load<span class="_ _14"> </span></span>and<span class="_ _14"> </span><span class="ff6">add</span></div><div class="t m5 x1d h26 y8a7 ff7 fs19 fc1 sc0 ls0 ws0">operations;<span class="_ _16"> </span>its<span class="_ _16"> </span>new<span class="_ _16"> </span>value<span class="_ _16"> </span>is<span class="_ _16"> </span>generated<span class="_ _16"> </span>by<span class="_ _11"> </span>the<span class="_ _16"> </span><span class="ff6">add<span class="_ _16"> </span></span>operation,<span class="_ _16"> </span>which<span class="_ _16"> </span>is<span class="_ _16"> </span>then<span class="_ _16"> </span>used</div><div class="t m5 x1d h26 y8a8 ff7 fs19 fc1 sc0 ls0 ws0">by<span class="_"> </span>the<span class="_"> </span><span class="ff6">cmp<span class="_ _10"> </span></span>operation.<span class="_"> </span>Register<span class="_"> </span><span class="ffd">%xmm0<span class="_ _10"> </span></span>is<span class="_"> </span>also<span class="_"> </span>updated<span class="_"> </span>within<span class="_"> </span>the<span class="_"> </span>loop<span class="_"> </span>by<span class="_ _13"> </span>the<span class="_"> </span><span class="ff6">mul</span></div><div class="t m5 x1d h26 y8a9 ff7 fs19 fc1 sc0 ls0 ws0">operation,<span class="_"> </span>which<span class="_"> </span>ﬁrst<span class="_"> </span>uses<span class="_"> </span>the<span class="_"> </span>initial<span class="_"> </span>value<span class="_"> </span>as<span class="_"> </span>a<span class="_"> </span>source<span class="_"> </span>value<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y8aa ff7 fs19 fc1 sc0 ls0 ws0">Some<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>operations<span class="_"> </span>in<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>5.13<span class="_ _13"> </span>produce<span class="_"> </span>values<span class="_"> </span>that<span class="_"> </span>do<span class="_ _13"> </span>not<span class="_"> </span>correspond</div><div class="t m5 x1d h26 y8ab ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _14"> </span>registers<span class="_ _1"></span>.<span class="_ _14"> </span>W<span class="_ _1"></span>e<span class="_ _14"> </span>show<span class="_ _14"> </span>these<span class="_ _15"> </span>as<span class="_ _14"> </span>arcs<span class="_ _14"> </span>between<span class="_ _14"> </span>operations<span class="_ _15"> </span>on<span class="_ _14"> </span>the<span class="_ _14"> </span>right-hand<span class="_ _14"> </span>side.</div><div class="t m5 x1d h26 y8ac ff7 fs19 fc1 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _e"> </span><span class="ff6 ls0">load<span class="_ _f"> </span><span class="ff7">operation<span class="_ _f"> </span>reads<span class="_ _f"> </span>a<span class="_ _f"> </span>value<span class="_ _f"> </span>from<span class="_ _e"> </span>memory<span class="_ _21"> </span>and<span class="_ _f"> </span>passes<span class="_ _f"> </span>it<span class="_ _f"> </span>directly<span class="_ _e"> </span>to<span class="_ _21"> </span>the</span></span></div><div class="t m5 x1d h26 y8ad ff6 fs19 fc1 sc0 ls0 ws0">mul<span class="_ _16"> </span><span class="ff7">operation.<span class="_ _16"> </span>Since<span class="_ _16"> </span>these<span class="_ _16"> </span>two<span class="_ _16"> </span>operations<span class="_ _14"> </span>arise<span class="_ _16"> </span>from<span class="_ _16"> </span>decoding<span class="_ _16"> </span>a<span class="_ _16"> </span>single<span class="_ _14"> </span><span class="ffd">vmulsd</span></span></div><div class="t m5 x1d h26 y8ae ff7 fs19 fc1 sc0 ls0 ws0">instruction,<span class="_ _21"> </span>there<span class="_ _15"> </span>is<span class="_ _15"> </span>no<span class="_ _15"> </span>register<span class="_ _15"> </span>associated<span class="_ _15"> </span>with<span class="_ _14"> </span>the<span class="_ _15"> </span>intermediate<span class="_ _15"> </span>value<span class="_ _15"> </span>passing</div><div class="t m5 x1d h26 y8af ff7 fs19 fc1 sc0 ls0 ws0">between<span class="_ _14"> </span>them.<span class="_ _15"> </span>T<span class="_ _1"></span>he<span class="_ _15"> </span><span class="ff6">cmp<span class="_ _14"> </span></span>operation<span class="_ _15"> </span>updates<span class="_ _14"> </span>the<span class="_ _14"> </span>condition<span class="_ _15"> </span>codes<span class="_ _1"></span>,<span class="_ _15"> </span>and<span class="_ _15"> </span>these<span class="_ _14"> </span>are</div><div class="t m5 x1d h26 y8b0 ff7 fs19 fc1 sc0 ls0 ws0">then<span class="_"> </span>tested<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span><span class="ff6">jne<span class="_ _10"> </span></span>operation.</div><div class="t m5 x29 h26 y8b1 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _21"> </span>a<span class="_ _21"> </span>code<span class="_ _21"> </span>segment<span class="_ _15"> </span>forming<span class="_ _21"> </span>a<span class="_ _21"> </span>loop,<span class="_ _21"> </span>we<span class="_ _21"> </span>can<span class="_ _21"> </span>classify<span class="_ _21"> </span>the<span class="_ _21"> </span>registers<span class="_ _21"> </span>that<span class="_ _21"> </span>are</div><div class="t m5 x1d h26 y8b2 ff7 fs19 fc1 sc0 ls0 ws0">accessed<span class="_"> </span>into<span class="_"> </span>four<span class="_"> </span>categories:</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
