<div id="pf11f" class="pf w2 h11" data-page-no="11f"><div class="pc pc11f w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg11f.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">286<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x1d h34 ye7 ff6 fs16 fc2 sc0 ls0 ws0">(a)<span class="_ _10"> </span>C<span class="_ _11"> </span>code<span class="_ _10"> </span>for<span class="_ _10"> </span>calling<span class="_ _11"> </span>function</div><div class="t m5 x1d h2d y2283 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>call_proc()</div><div class="t m5 x1d h2d y2284 ffd fs1e fc2 sc0 ls0 ws0">{</div><div class="t m5 x10c h2d y2285 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _1a"> </span>x1<span class="_ _e"> </span>=<span class="_ _1f"> </span>1;<span class="_ _1f"> </span>int<span class="_ _3b"> </span>x2<span class="_ _1f"> </span>=<span class="_ _1f"> </span>2;</div><div class="t m5 x10c h2d y2286 ffd fs1e fc2 sc0 ls0 ws0">short<span class="_ _e"> </span>x3<span class="_ _1f"> </span>=<span class="_ _1f"> </span>3;<span class="_ _e"> </span>char<span class="_ _1f"> </span>x4<span class="_ _e"> </span>=<span class="_ _1f"> </span>4;</div><div class="t m5 x10c h2d y2287 ffd fs1e fc2 sc0 ls0 ws0">proc(x1,<span class="_ _e"> </span>&amp;x1,<span class="_ _1f"> </span>x2,<span class="_ _1f"> </span>&amp;x2,<span class="_ _e"> </span>x3,<span class="_ _1f"> </span>&amp;x3,<span class="_ _e"> </span>x4,<span class="_ _1f"> </span>&amp;x4);</div><div class="t m5 x10c h2d y2288 ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>(x1+x2)*(x3-x4);</div><div class="t m5 x1d h2d y23a1 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x1d h34 y2a04 ff6 fs16 fc2 sc0 ls0 ws0">(b)<span class="_ _10"> </span>Generated<span class="_ _11"> </span>assembly<span class="_ _10"> </span>code</div><div class="t m5 xad h61 y24e5 ff13 fs35 fc6 sc0 ls0 ws0">long<span class="_ _f"> </span>call_proc()</div><div class="t m5 x1f h2d y1819 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">call_proc:</span></div><div class="t m5 x10d h61 y228b ff13 fs35 fc6 sc0 ls0 ws0">Set<span class="_ _f"> </span>up<span class="_ _f"> </span>arguments<span class="_ _f"> </span>to<span class="_ _e"> </span>proc</div><div class="t m5 x1f h2d y228c ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">subq<span class="_ _46"> </span>$32,<span class="_ _e"> </span>%rsp<span class="_ _9a"> </span></span><span class="ff13 fs35">Allocate<span class="_ _f"> </span>32-byte<span class="_ _f"> </span>stack<span class="_ _e"> </span>frame</span></div><div class="t m5 x1f h2d y228d ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>$1,<span class="_ _e"> </span>24(%rsp)<span class="_ _88"> </span></span><span class="ff13 fs35">Store<span class="_ _21"> </span>1<span class="_ _e"> </span>in<span class="_ _21"> </span>&amp;x1</span></div><div class="t m5 x1f h2e y23a5 ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 x10d h2d y13a3 ffd fs1e fc2 sc0 ls0 ws0">movl<span class="_ _46"> </span>$2,<span class="_ _e"> </span>20(%rsp)<span class="_ _88"> </span><span class="ff13 fs35 fc6">Store<span class="_ _21"> </span>2<span class="_ _e"> </span>in<span class="_ _21"> </span>&amp;x2</span></div><div class="t m5 x1f h2d y23a6 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">movw<span class="_ _46"> </span>$3,<span class="_ _e"> </span>18(%rsp)<span class="_ _88"> </span></span><span class="ff13 fs35">Store<span class="_ _21"> </span>3<span class="_ _e"> </span>in<span class="_ _21"> </span>&amp;x3</span></div><div class="t m5 x1f h2d y23a7 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">movb<span class="_ _46"> </span>$4,<span class="_ _e"> </span>17(%rsp)<span class="_ _88"> </span></span><span class="ff13 fs35">Store<span class="_ _21"> </span>4<span class="_ _e"> </span>in<span class="_ _21"> </span>&amp;x4</span></div><div class="t m5 x1f h2d y23a8 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">leaq<span class="_ _46"> </span>17(%rsp),<span class="_ _e"> </span>%rax<span class="_ _93"> </span></span><span class="ff13 fs35">Create<span class="_ _e"> </span>&amp;x4</span></div><div class="t m5 x1f h2d y23a9 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>%rax,<span class="_ _e"> </span>8(%rsp)<span class="_ _59"> </span></span><span class="ff13 fs35">Store<span class="_ _f"> </span>&amp;x4<span class="_ _e"> </span>as<span class="_ _21"> </span>argument<span class="_ _f"> </span>8</span></div><div class="t m5 x1f h2d y29fd ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _45"> </span><span class="ffd fs1e fc2">movl<span class="_ _46"> </span>$4,<span class="_ _e"> </span>(%rsp)<span class="_ _5d"> </span></span><span class="ff13 fs35">Store<span class="_ _f"> </span>4<span class="_ _e"> </span>as<span class="_ _21"> </span>argument<span class="_ _f"> </span>7</span></div><div class="t m5 x1b0 h2d y29fe ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _45"> </span><span class="ffd fs1e fc2">leaq<span class="_ _46"> </span>18(%rsp),<span class="_ _e"> </span>%r9<span class="_ _59"> </span></span><span class="ff13 fs35">Pass<span class="_ _f"> </span>&amp;x3<span class="_ _e"> </span>as<span class="_ _21"> </span>argument<span class="_ _f"> </span>6</span></div><div class="t m5 x1b0 h2d y2a05 ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _45"> </span><span class="ffd fs1e fc2">movl<span class="_ _46"> </span>$3,<span class="_ _e"> </span>%r8d<span class="_ _c2"> </span></span><span class="ff13 fs35">Pass<span class="_ _e"> </span>3<span class="_ _21"> </span>as<span class="_ _f"> </span>argument<span class="_ _e"> </span>5</span></div><div class="t m5 x1b0 h2d y2a00 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _45"> </span><span class="ffd fs1e fc2">leaq<span class="_ _46"> </span>20(%rsp),<span class="_ _e"> </span>%rcx<span class="_ _93"> </span></span><span class="ff13 fs35">Pass<span class="_ _e"> </span>&amp;x2<span class="_ _21"> </span>as<span class="_ _f"> </span>argument<span class="_ _f"> </span>4</span></div><div class="t m5 x1b0 h2d y2a01 ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _45"> </span><span class="ffd fs1e fc2">movl<span class="_ _46"> </span>$2,<span class="_ _e"> </span>%edx<span class="_ _c2"> </span></span><span class="ff13 fs35">Pass<span class="_ _e"> </span>2<span class="_ _21"> </span>as<span class="_ _f"> </span>argument<span class="_ _e"> </span>3</span></div><div class="t m5 x1b0 h2d y28f5 ff6 fs20 fc6 sc0 ls0 ws0">14<span class="_ _45"> </span><span class="ffd fs1e fc2">leaq<span class="_ _46"> </span>24(%rsp),<span class="_ _e"> </span>%rsi<span class="_ _93"> </span></span><span class="ff13 fs35">Pass<span class="_ _e"> </span>&amp;x1<span class="_ _21"> </span>as<span class="_ _f"> </span>argument<span class="_ _f"> </span>2</span></div><div class="t m5 x1b0 h2d y28f7 ff6 fs20 fc6 sc0 ls0 ws0">15<span class="_ _45"> </span><span class="ffd fs1e fc2">movl<span class="_ _46"> </span>$1,<span class="_ _e"> </span>%edi<span class="_ _c2"> </span></span><span class="ff13 fs35">Pass<span class="_ _e"> </span>1<span class="_ _21"> </span>as<span class="_ _f"> </span>argument<span class="_ _e"> </span>1</span></div><div class="t m5 x10d h61 y2a06 ff13 fs35 fc6 sc0 ls0 ws0">Call<span class="_ _f"> </span>proc</div><div class="t m5 x1b0 h2d y2a07 ff6 fs20 fc6 sc0 ls0 ws0">16<span class="_ _45"> </span><span class="ffd fs1e fc2">call<span class="_ _46"> </span>proc</span></div><div class="t m5 x10d h61 y28fa ff13 fs35 fc6 sc0 ls0 ws0">Retrieve<span class="_ _f"> </span>changes<span class="_ _f"> </span>to<span class="_ _f"> </span>memory</div><div class="t m5 x1b0 h2d y28fc ff6 fs20 fc6 sc0 ls0 ws0">17<span class="_ _45"> </span><span class="ffd fs1e fc2">movslq<span class="_ _1a"> </span>20(%rsp),<span class="_ _e"> </span>%rdx<span class="_ _93"> </span></span><span class="ff13 fs35">Get<span class="_ _f"> </span>x2<span class="_ _e"> </span>and<span class="_ _21"> </span>convert<span class="_ _f"> </span>to<span class="_ _e"> </span>long</span></div><div class="t m5 x1b0 h2e y2a08 ff6 fs20 fc6 sc0 ls0 ws0">18</div><div class="t m5 x10d h2d y28fd ffd fs1e fc2 sc0 ls0 ws0">addq<span class="_ _46"> </span>24(%rsp),<span class="_ _e"> </span>%rdx<span class="_ _93"> </span><span class="ff13 fs35 fc6">Compute<span class="_ _e"> </span>x1+x2</span></div><div class="t m5 x1b0 h2d y2a09 ff6 fs20 fc6 sc0 ls0 ws0">19<span class="_ _45"> </span><span class="ffd fs1e fc2">movswl<span class="_ _1a"> </span>18(%rsp),<span class="_ _e"> </span>%eax<span class="_ _93"> </span></span><span class="ff13 fs35">Get<span class="_ _f"> </span>x3<span class="_ _e"> </span>and<span class="_ _21"> </span>convert<span class="_ _f"> </span>to<span class="_ _e"> </span>int</span></div><div class="t m5 x1b0 h2d y28ff ff6 fs20 fc6 sc0 ls0 ws0">20<span class="_ _45"> </span><span class="ffd fs1e fc2">movsbl<span class="_ _1a"> </span>17(%rsp),<span class="_ _e"> </span>%ecx<span class="_ _93"> </span></span><span class="ff13 fs35">Get<span class="_ _f"> </span>x4<span class="_ _e"> </span>and<span class="_ _21"> </span>convert<span class="_ _f"> </span>to<span class="_ _e"> </span>int</span></div><div class="t m5 x1b0 h2d y2a0a ff6 fs20 fc6 sc0 ls0 ws0">21<span class="_ _45"> </span><span class="ffd fs1e fc2">subl<span class="_ _46"> </span>%ecx,<span class="_ _e"> </span>%eax<span class="_ _5d"> </span></span><span class="ff13 fs35">Compute<span class="_ _f"> </span>x3-x4</span></div><div class="t m5 x1b0 h2d y2a0b ff6 fs20 fc6 sc0 ls0 ws0">22<span class="_ _45"> </span><span class="ffd fs1e fc2">cltq<span class="_ _139"> </span></span><span class="ff13 fs35">Convert<span class="_ _f"> </span>to<span class="_ _f"> </span>long</span></div><div class="t m5 x1b0 h2d y2a0c ff6 fs20 fc6 sc0 ls0 ws0">23<span class="_ _45"> </span><span class="ffd fs1e fc2">imulq<span class="_ _3f"> </span>%rdx,<span class="_ _e"> </span>%rax<span class="_ _5d"> </span></span><span class="ff13 fs35">Compute<span class="_ _f"> </span>(x1+x2)<span class="_ _e"> </span>*<span class="_ _21"> </span>(x3-x4)</span></div><div class="t m5 x1b0 h2d y2a0d ff6 fs20 fc6 sc0 ls0 ws0">24<span class="_ _45"> </span><span class="ffd fs1e fc2">addq<span class="_ _46"> </span>$32,<span class="_ _e"> </span>%rsp<span class="_ _9a"> </span></span><span class="ff13 fs35">Deallocate<span class="_ _f"> </span>stack<span class="_ _f"> </span>frame</span></div><div class="t m5 x1b0 h2e y2a0e ff6 fs20 fc6 sc0 ls0 ws0">25</div><div class="t m5 x10d h2d y2a0f ffd fs1e fc2 sc0 ls0 ws0">ret<span class="_ _166"> </span><span class="ff13 fs35 fc6">Return</span></div><div class="t m5 x1d h3a y2a10 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _13"> </span>3.32<span class="_ _c"> </span><span class="fc1">Example<span class="_ _13"> </span>of<span class="_ _13"> </span>code<span class="_ _13"> </span>to<span class="_ _13"> </span>call<span class="_ _13"> </span>function<span class="_ _13"> </span><span class="ffd fs19">proc</span>,<span class="_ _13"> </span>deﬁned<span class="_ _13"> </span>in<span class="_ _10"> </span>Figure<span class="_ _13"> </span>3.29.<span class="_ _13"> </span><span class="ff6">This<span class="_ _13"> </span>code</span></span></div><div class="t m5 x1d h34 y2a11 ff6 fs16 fc1 sc0 ls0 ws0">creates<span class="_ _10"> </span>a<span class="_ _11"> </span>stack<span class="_ _10"> </span>frame.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
