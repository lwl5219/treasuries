<div id="pf159" class="pf w2 h11" data-page-no="159"><div class="pc pc159 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg159.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">344<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x1d h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">set<span class="_ _13"> </span>when<span class="_ _13"> </span><span class="ff11">S</span></div><div class="t m5 x145 h3c y2a5b ff7 fs25 fc2 sc0 ls0 ws0">2</div><div class="t m5 x1ec h45 ye7 ff11 fs19 fc2 sc0 ls195 ws0">&lt;S</div><div class="t m5 x1a5 h3c y2a5b ff7 fs25 fc2 sc0 ls0 ws0">1</div><div class="t m5 x137 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">.<span class="_ _13"> </span>Instructions<span class="_ _13"> </span>such<span class="_"> </span>as<span class="_ _13"> </span><span class="ffd">ja<span class="_ _13"> </span></span>and<span class="_ _13"> </span><span class="ffd">jb<span class="_ _10"> </span></span>are<span class="_ _13"> </span>used<span class="_ _13"> </span>to<span class="_ _13"> </span>conditionally<span class="_"> </span>jump<span class="_ _13"> </span>on</div><div class="t m5 x1d h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">various<span class="_"> </span>combinations<span class="_"> </span>of<span class="_"> </span>these<span class="_"> </span>ﬂags<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_ _13"> </span>an<span class="_ _13"> </span>example<span class="_ _13"> </span>of<span class="_ _13"> </span>ﬂoating-point<span class="_ _13"> </span>comparisons<span class="_ _3"></span>,<span class="_"> </span>the<span class="_ _13"> </span>C<span class="_ _13"> </span>function<span class="_ _6"> </span>of<span class="_ _13"> </span>Figure<span class="_ _13"> </span>3.51(a)</div><div class="t m5 x1d h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">classiﬁes<span class="_ _13"> </span>argument<span class="_ _13"> </span><span class="ffd">x<span class="_ _6"> </span></span>according<span class="_ _13"> </span>to<span class="_ _13"> </span>its<span class="_ _13"> </span>relation<span class="_ _6"> </span>to<span class="_ _13"> </span>0.0,<span class="_ _13"> </span>returning<span class="_ _13"> </span>an<span class="_ _13"> </span>enumerated<span class="_ _6"> </span>type</div><div class="t m5 x1d h26 y2f8 ff7 fs19 fc2 sc0 ls0 ws0">as<span class="_"> </span>the<span class="_"> </span>result.<span class="_"> </span>Enumerated<span class="_"> </span>types<span class="_"> </span>in<span class="_"> </span>C<span class="_"> </span>are<span class="_"> </span>encoded<span class="_"> </span>as<span class="_"> </span>integers<span class="_ _1"></span>,<span class="_"> </span>and<span class="_"> </span>so<span class="_"> </span>the<span class="_"> </span>possible</div><div class="t m5 x1d h26 y2f9 ff7 fs19 fc2 sc0 ls0 ws0">function<span class="_"> </span>values<span class="_ _11"> </span>are:<span class="_"> </span>0<span class="_ _11"> </span>(<span class="ffd">NEG</span>),<span class="_"> </span>1<span class="_ _11"> </span>(<span class="ffd">ZERO</span>),<span class="_ _11"> </span>2<span class="_"> </span>(<span class="ffd">POS</span>),<span class="_ _11"> </span>and<span class="_"> </span>3<span class="_ _11"> </span>(<span class="ffd">OTHER</span>).<span class="_"> </span>This<span class="_"> </span>ﬁnal<span class="_"> </span>outcome</div><div class="t m5 x1d h26 y2fa ff7 fs19 fc2 sc0 ls0 ws0">occurs<span class="_"> </span>when<span class="_"> </span>the<span class="_"> </span>value<span class="_"> </span>of<span class="_"> </span><span class="ffd">x<span class="_ _10"> </span></span>is<span class="_"> </span><span class="ffa">NaN<span class="_ _5"></span></span>.</div><div class="t m5 x29 h26 y2fb ff9 fs19 fc2 sc0 ls0 ws0">Gcc<span class="_ _16"> </span><span class="ff7">generates<span class="_ _16"> </span>the<span class="_ _16"> </span>code<span class="_ _14"> </span>shown<span class="_ _16"> </span>in<span class="_ _16"> </span>Figure<span class="_ _11"> </span>3.51(b)<span class="_ _14"> </span>for<span class="_ _16"> </span><span class="ffd">find_range</span>.<span class="_ _16"> </span>T<span class="_ _0"></span>he<span class="_ _16"> </span>code</span></div><div class="t m5 x1d h26 y2fc ff7 fs19 fc2 sc0 ls0 ws0">is<span class="_ _11"> </span>not<span class="_ _16"> </span>very<span class="_ _11"> </span>efﬁcient—it<span class="_ _16"> </span>compares<span class="_ _11"> </span><span class="ffd">x<span class="_ _11"> </span></span>to<span class="_ _16"> </span>0.0<span class="_ _11"> </span>three<span class="_ _16"> </span>times<span class="_ _1"></span>,<span class="_ _16"> </span>even<span class="_ _11"> </span>though<span class="_ _11"> </span>the<span class="_ _16"> </span>required</div><div class="t m5 x1d h26 y2fd ff7 fs19 fc2 sc0 ls0 ws0">information<span class="_ _6"> </span>could<span class="_ _13"> </span>be<span class="_ _6"> </span>obtained<span class="_ _13"> </span>with<span class="_ _6"> </span>a<span class="_ _13"> </span>single<span class="_ _6"> </span>comparison.<span class="_ _13"> </span>It<span class="_ _6"> </span>also<span class="_ _13"> </span>generates<span class="_ _6"> </span>ﬂoating-</div><div class="t m5 x1d h26 y2fe ff7 fs19 fc2 sc0 ls0 ws0">point<span class="_"> </span>constant<span class="_ _13"> </span>0<span class="ff11">.</span>0<span class="_"> </span>twice—once<span class="_ _13"> </span>using<span class="_"> </span><span class="ffd">vxorps</span>,<span class="_ _13"> </span>and<span class="_"> </span>once<span class="_"> </span>by<span class="_ _13"> </span>reading<span class="_"> </span>the<span class="_ _13"> </span>value<span class="_"> </span>from</div><div class="t m5 x1d h26 y2ff ff7 fs19 fc2 sc0 ls0 ws0">memory<span class="_ _3"></span>.<span class="_ _16"> </span>Let<span class="_ _16"> </span>us<span class="_ _14"> </span>trace<span class="_ _16"> </span>the<span class="_ _16"> </span>ﬂow<span class="_ _14"> </span>of<span class="_ _16"> </span>the<span class="_ _14"> </span>function<span class="_ _16"> </span>for<span class="_ _16"> </span>the<span class="_ _14"> </span>four<span class="_ _16"> </span>possible<span class="_ _14"> </span>comparison</div><div class="t m5 x1d h26 y300 ff7 fs19 fc2 sc0 ls0 ws0">results:</div><div class="t m5 x75 h26 y3128 ffd fs19 fc2 sc0 ls0 ws0">x<span class="_ _13"> </span><span class="ff11">&lt;<span class="_ _13"> </span><span class="ff7">0</span>.<span class="ff7 ls196">0T<span class="_ _b4"></span>h<span class="_ _b4"></span>e<span class="_ _c3"></span><span class="ffd ls0">ja<span class="_ _13"> </span><span class="ff7">branch<span class="_ _13"> </span>on<span class="_ _13"> </span>line<span class="_ _13"> </span>4<span class="_ _13"> </span>will<span class="_ _13"> </span>be<span class="_ _13"> </span>taken,<span class="_ _13"> </span>jumping<span class="_ _13"> </span>to<span class="_ _13"> </span>the<span class="_ _6"> </span>end<span class="_ _13"> </span>with<span class="_ _13"> </span>a<span class="_ _13"> </span>return</span></span></span></span></div><div class="t m5 xcd h26 y3129 ff7 fs19 fc2 sc0 ls0 ws0">value<span class="_"> </span>of<span class="_"> </span>0.</div><div class="t m5 x75 h46 y312a ffd fs19 fc2 sc0 ls0 ws0">x<span class="_ _13"> </span><span class="ff12">=<span class="_ _10"> </span><span class="ff7">0<span class="ff11">.</span><span class="ls196">0T<span class="_ _b5"></span>h<span class="_ _b1"></span>e<span class="_ _32"></span><span class="ffd ls0">ja<span class="_ _10"> </span><span class="ff7">(line<span class="_ _11"> </span>4)<span class="_ _11"> </span>and<span class="_"> </span></span>jp<span class="_ _11"> </span><span class="ff7">(line<span class="_ _11"> </span>6)<span class="_ _11"> </span>branches<span class="_ _11"> </span>will<span class="_"> </span>not<span class="_ _11"> </span>be<span class="_ _11"> </span>taken,<span class="_ _11"> </span>but<span class="_"> </span>the<span class="_ _11"> </span></span>je</span></span></span></span></div><div class="t m5 xcd h26 y312b ff7 fs19 fc2 sc0 ls0 ws0">branch<span class="_"> </span>(line<span class="_"> </span>8)<span class="_"> </span>will,<span class="_"> </span>returning<span class="_"> </span>with<span class="_"> </span><span class="ffd">%eax<span class="_ _10"> </span></span>equal<span class="_"> </span>to<span class="_"> </span>1.</div><div class="t m5 x75 h26 y312c ffd fs19 fc2 sc0 ls0 ws0">x<span class="_ _13"> </span><span class="ff11">&gt;<span class="_ _13"> </span><span class="ff7">0</span>.<span class="ff7">0<span class="_ _1a"> </span>None<span class="_ _13"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>three<span class="_ _6"> </span>branches<span class="_ _13"> </span>will<span class="_ _6"> </span>be<span class="_ _13"> </span>taken.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_ _6"> </span><span class="ffd">setbe<span class="_ _13"> </span></span>(line<span class="_ _6"> </span>11)<span class="_ _13"> </span>will<span class="_ _13"> </span>yield</span></span></div><div class="t m5 xcd h26 y1af ff7 fs19 fc2 sc0 ls0 ws0">0,<span class="_"> </span>and<span class="_"> </span>this<span class="_"> </span>will<span class="_"> </span>be<span class="_"> </span>incremented<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span><span class="ffd">addl<span class="_ _13"> </span></span>instruction<span class="_"> </span>(line<span class="_"> </span>13)<span class="_"> </span>to<span class="_"> </span>give<span class="_"> </span>a</div><div class="t m5 xcd h26 y312d ff7 fs19 fc2 sc0 ls0 ws0">return<span class="_"> </span>value<span class="_"> </span>of<span class="_"> </span>2.</div><div class="t m5 x75 h46 y312e ffd fs19 fc2 sc0 ls0 ws0">x<span class="_ _13"> </span><span class="ff12">=<span class="_ _13"> </span><span class="ffa">NaN<span class="_ _b0"> </span><span class="ff7 lsd">Th<span class="_ _5"></span>e<span class="_ _10"> </span></span></span></span>jp<span class="_ _13"> </span><span class="ff7">branch<span class="_"> </span>(line<span class="_ _13"> </span>6)<span class="_ _13"> </span>will<span class="_ _13"> </span>be<span class="_"> </span>taken.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_"> </span>third<span class="_ _13"> </span><span class="ffd">vucomiss<span class="_ _13"> </span></span>instruction</span></div><div class="t m5 xcd h26 y312f ff7 fs19 fc2 sc0 ls0 ws0">(line<span class="_ _f"> </span>10)<span class="_ _f"> </span>will<span class="_ _e"> </span>set<span class="_ _21"> </span>both<span class="_ _e"> </span>the<span class="_ _21"> </span>carry<span class="_ _e"> </span>and<span class="_ _21"> </span>the<span class="_ _e"> </span>zero<span class="_ _21"> </span>ﬂag,<span class="_ _e"> </span>and<span class="_ _f"> </span>so<span class="_ _e"> </span>the<span class="_ _f"> </span><span class="ffd">setbe</span></div><div class="t m5 xcd h26 y3130 ff7 fs19 fc2 sc0 ls0 ws0">instruction<span class="_"> </span>(line<span class="_"> </span>11)<span class="_"> </span>and<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>instruction<span class="_ _11"> </span>will<span class="_"> </span>set<span class="_"> </span><span class="ffd">%eax<span class="_ _10"> </span></span>to<span class="_"> </span>1.<span class="_ _11"> </span>T<span class="_ _1"></span>his</div><div class="t m5 xcd h26 y3131 ff7 fs19 fc2 sc0 ls0 ws0">gets<span class="_"> </span>incremented<span class="_ _11"> </span>by<span class="_"> </span>the<span class="_ _11"> </span><span class="ffd">addl<span class="_ _11"> </span></span>instruction<span class="_"> </span>(line<span class="_ _11"> </span>13)<span class="_ _11"> </span>to<span class="_"> </span>give<span class="_ _11"> </span>a<span class="_ _11"> </span>return<span class="_"> </span>value</div><div class="t m5 xcd h26 y3132 ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_"> </span>3.</div><div class="t m5 x29 h26 y3133 ff7 fs19 fc2 sc0 ls0 ws0">In<span class="_ _11"> </span>Homework<span class="_ _11"> </span>Problems<span class="_ _11"> </span>3.73<span class="_ _11"> </span>and<span class="_ _11"> </span>3.74,<span class="_ _11"> </span>you<span class="_ _16"> </span>are<span class="_"> </span>challenged<span class="_ _11"> </span>to<span class="_ _11"> </span>hand-generate</div><div class="t m5 x1d h26 y3134 ff7 fs19 fc2 sc0 ls0 ws0">more<span class="_"> </span>efﬁcient<span class="_"> </span>implementations<span class="_"> </span>of<span class="_"> </span><span class="ffd">find_range</span>.</div><div class="t m5 x1d h47 y3135 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>3.57<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>386)</span></div><div class="t m5 x1d h26 y3136 ff7 fs19 fc1 sc0 ls0 ws0">Function<span class="_"> </span><span class="ffd">funct3<span class="_ _10"> </span></span>has<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>prototype:</div><div class="t m5 x1d h2d y3137 ffd fs1e fc2 sc0 ls0 ws0">double<span class="_ _e"> </span>funct3(int<span class="_ _1f"> </span>*ap,<span class="_ _1f"> </span>double<span class="_ _e"> </span>b,<span class="_ _1f"> </span>long<span class="_ _e"> </span>c,<span class="_ _1f"> </span>float<span class="_ _1f"> </span>*dp);</div><div class="t m5 x1d h26 y3138 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_"> </span>this<span class="_"> </span>function,<span class="_"> </span><span class="ff9">gcc<span class="_ _10"> </span></span>generates<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>code:</div><div class="t m5 xad h61 yec2 ff13 fs35 fc6 sc0 ls0 ws0">double<span class="_ _f"> </span>funct3(int<span class="_ _f"> </span>*ap,<span class="_ _f"> </span>double<span class="_ _e"> </span>b,<span class="_ _21"> </span>long<span class="_ _f"> </span>c,<span class="_ _e"> </span>float<span class="_ _21"> </span>*dp)</div><div class="t m5 xad h61 y3139 ff13 fs35 fc6 sc0 ls0 ws0">ap<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi,<span class="_ _f"> </span>b<span class="_ _e"> </span>in<span class="_ _21"> </span>%xmm0,<span class="_ _f"> </span>c<span class="_ _e"> </span>in<span class="_ _21"> </span>%rsi,<span class="_ _f"> </span>dp<span class="_ _e"> </span>in<span class="_ _21"> </span>%rdx</div><div class="t m5 x1f h2d yc21 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">funct3:</span></div><div class="t m5 x1f h2d y107b ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">vmovss<span class="_ _1a"> </span>(%rdx),<span class="_ _e"> </span>%xmm1</span></div><div class="t m5 x1f h2d ye93 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">vcvtsi2sd<span class="_ _6f"> </span>(%rdi),<span class="_ _1f"> </span>%xmm2,<span class="_ _e"> </span>%xmm2</span></div><div class="t m5 x1f h2d y832 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">vucomisd<span class="_ _71"> </span>%xmm2,<span class="_ _1f"> </span>%xmm0</span></div><div class="t m5 x1f h2d y8d6 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">jbe<span class="_ _8c"> </span>.L8</span></div><div class="t m5 x1f h2d y77e ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">vcvtsi2ssq<span class="_ _5a"> </span>%rsi,<span class="_ _1f"> </span>%xmm0,<span class="_ _e"> </span>%xmm0</span></div><div class="t m5 x1f h2d ye95 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _45"> </span><span class="ffd fs1e fc2">vmulss<span class="_ _1a"> </span>%xmm1,<span class="_ _e"> </span>%xmm0,<span class="_ _1f"> </span>%xmm1</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
