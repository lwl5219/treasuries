<div id="pf343" class="pf w2 h11" data-page-no="343"><div class="pc pc343 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg343.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">834<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>8<span class="_ _3d"> </span>Exceptional<span class="_ _10"> </span>Control<span class="_ _10"> </span>Flow</span></div><div class="t m5 x1f h2d y9c ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _20"> </span><span class="ffd fs1e fc2">for<span class="_ _e"> </span>(i=0;<span class="_ _1f"> </span>argv[i]<span class="_ _1f"> </span>!=<span class="_ _e"> </span>NULL;<span class="_ _1f"> </span>i++)</span></div><div class="t m5 x1f h2d y2825 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _70"> </span><span class="ffd fs1e fc2">printf(&quot;<span class="_ _46"> </span>argv[%2d]:<span class="_ _e"> </span>%s\n&quot;,<span class="_ _1f"> </span>i,<span class="_ _1f"> </span>argv[i]);</span></div><div class="t m5 x1b0 h2e y2826 ff6 fs20 fc6 sc0 ls0 ws0">10</div><div class="t m5 x1b0 h2e y6bbe ff6 fs20 fc6 sc0 ls0 ws0">11</div><div class="t m5 x33 h2d y249b ffd fs1e fc2 sc0 ls0 ws0">printf(&quot;\n&quot;);</div><div class="t m5 x1b0 h2d yecd ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _20"> </span><span class="ffd fs1e fc2">printf(&quot;Environment<span class="_ _e"> </span>variables:\n&quot;);</span></div><div class="t m5 x1b0 h2d y2827 ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _20"> </span><span class="ffd fs1e fc2">for<span class="_ _e"> </span>(i=0;<span class="_ _1f"> </span>envp[i]<span class="_ _1f"> </span>!=<span class="_ _e"> </span>NULL;<span class="_ _1f"> </span>i++)</span></div><div class="t m5 x1b0 h2d y24a1 ff6 fs20 fc6 sc0 ls0 ws0">14<span class="_ _70"> </span><span class="ffd fs1e fc2">printf(&quot;<span class="_ _46"> </span>envp[%2d]:<span class="_ _e"> </span>%s\n&quot;,<span class="_ _1f"> </span>i,<span class="_ _1f"> </span>envp[i]);</span></div><div class="t m5 x1b0 h2e yed0 ff6 fs20 fc6 sc0 ls0 ws0">15</div><div class="t m5 x1b0 h2e y6acc ff6 fs20 fc6 sc0 ls0 ws0">16</div><div class="t m5 x33 h2d y1a10 ffd fs1e fc2 sc0 ls0 ws0">exit(0);</div><div class="t m5 x1b0 h2d y2828 ff6 fs20 fc6 sc0 ls0 ws0">17<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x45 h2c y6b1f ffa fs16 fc2 sc0 ls0 ws0">code/ecf/myecho<span class="_ _1"></span>.c</div><div class="t m5 x1d h28 y6bbf ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>8.7<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>800)</span></div><div class="t m5 x1d h26 y6bc0 ff7 fs19 fc1 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _10"> </span><span class="ffd ls0">sleep<span class="_ _13"> </span><span class="ff7">function<span class="_ _13"> </span>returns<span class="_ _13"> </span>prematurely<span class="_ _13"> </span>whenever<span class="_ _13"> </span>the<span class="_ _13"> </span>sleeping<span class="_"> </span>process<span class="_ _13"> </span>receives<span class="_ _13"> </span>a</span></span></div><div class="t m5 x1d h26 y6bc1 ff7 fs19 fc1 sc0 ls0 ws0">signal<span class="_ _13"> </span>that<span class="_ _13"> </span>is<span class="_ _13"> </span>not<span class="_ _13"> </span>ignored.<span class="_"> </span>But<span class="_ _13"> </span>since<span class="_ _13"> </span>the<span class="_ _13"> </span>default<span class="_ _13"> </span>action<span class="_ _13"> </span>upon<span class="_ _13"> </span>receipt<span class="_ _13"> </span>of<span class="_"> </span>a<span class="_ _13"> </span>SIGINT<span class="_ _13"> </span>is</div><div class="t m5 x1d h26 y6bc2 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _13"> </span>terminate<span class="_"> </span>the<span class="_ _13"> </span>process<span class="_"> </span>(F<span class="_ _1"></span>igure<span class="_"> </span>8.26),<span class="_ _13"> </span>we<span class="_"> </span>must<span class="_ _13"> </span>install<span class="_ _13"> </span>a<span class="_"> </span>SIGINT<span class="_ _13"> </span>handler<span class="_"> </span>to<span class="_ _13"> </span>allow</div><div class="t m5 x1d h26 y6bc3 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _13"> </span><span class="ffd">sleep<span class="_ _6"> </span></span>function<span class="_ _13"> </span>to<span class="_ _6"> </span>return.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span>handler<span class="_ _13"> </span>simply<span class="_ _6"> </span>catches<span class="_ _13"> </span>the<span class="_ _6"> </span>SIGNAL<span class="_ _6"> </span>and<span class="_ _13"> </span>returns</div><div class="t m5 x1d h26 y6bc4 ff7 fs19 fc1 sc0 ls0 ws0">control<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span><span class="ffd">sleep<span class="_ _10"> </span></span>function,<span class="_"> </span>which<span class="_"> </span>returns<span class="_"> </span>immediately<span class="_ _3"></span>.</div><div class="t m5 x1cf h2c y6ad0 ffa fs16 fc1 sc0 ls0 ws0">code/ecf/snooze<span class="_ _1"></span>.c</div><div class="t m5 x1f h2d y3ed ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">#include<span class="_ _1f"> </span>&quot;csapp.h&quot;</span></div><div class="t m5 x1f h2e y2656 ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x1f h2e y6bc5 ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x4f h2d y19b0 ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>SIGINT<span class="_ _1f"> </span>handler<span class="_ _1f"> </span>*/</div><div class="t m5 x1f h2d y2657 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _1c"> </span><span class="ffd fs1e fc2">void<span class="_ _1f"> </span>handler(int<span class="_ _e"> </span>sig)</span></div><div class="t m5 x1f h2d y2658 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x1f h2d y2659 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _20"> </span><span class="ffd fs1e fc2">return;<span class="_ _e"> </span>/*<span class="_ _1f"> </span>Catch<span class="_ _1f"> </span>the<span class="_ _e"> </span>signal<span class="_ _1f"> </span>and<span class="_ _e"> </span>return<span class="_ _1f"> </span>*/</span></div><div class="t m5 x1f h2d y35e ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1f h2e y1a25 ff6 fs20 fc6 sc0 ls0 ws0">8</div><div class="t m5 x1f h2e y6bc6 ff6 fs20 fc6 sc0 ls0 ws0">9</div><div class="t m5 x4f h2d y6bc7 ffd fs1e fc2 sc0 ls0 ws0">unsigned<span class="_ _e"> </span>int<span class="_ _1f"> </span>snooze(unsigned<span class="_ _1f"> </span>int<span class="_ _e"> </span>secs)<span class="_ _1f"> </span>{</div><div class="t m5 x1b0 h2e y19b8 ff6 fs20 fc6 sc0 ls0 ws0">10</div><div class="t m5 x33 h2d y6bc8 ffd fs1e fc2 sc0 ls0 ws0">unsigned<span class="_ _e"> </span>int<span class="_ _1f"> </span>rc<span class="_ _1f"> </span>=<span class="_ _e"> </span>sleep(secs);</div><div class="t m5 x1b0 h2e y2156 ff6 fs20 fc6 sc0 ls0 ws0">11</div><div class="t m5 x1b0 h2e y6bc9 ff6 fs20 fc6 sc0 ls0 ws0">12</div><div class="t m5 x33 h2d y442 ffd fs1e fc2 sc0 ls0 ws0">printf(&quot;Slept<span class="_ _e"> </span>for<span class="_ _1f"> </span>%d<span class="_ _1f"> </span>of<span class="_ _e"> </span>%d<span class="_ _1f"> </span>secs.\n&quot;,<span class="_ _e"> </span>secs-rc,<span class="_ _1f"> </span>secs);</div><div class="t m5 x1b0 h2d y19ba ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _20"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>rc;</span></div><div class="t m5 x1b0 h2e y2455 ff6 fs20 fc6 sc0 ls0 ws0">14</div><div class="t m5 x4f h2d y55c ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x1b0 h2e y24b ff6 fs20 fc6 sc0 ls0 ws0">15</div><div class="t m5 x1b0 h2e y6bca ff6 fs20 fc6 sc0 ls0 ws0">16</div><div class="t m5 x4f h2d y8fa ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>main(int<span class="_ _1f"> </span>argc,<span class="_ _1f"> </span>char<span class="_ _e"> </span>**argv)<span class="_ _1f"> </span>{</div><div class="t m5 x1b0 h2e y2972 ff6 fs20 fc6 sc0 ls0 ws0">17</div><div class="t m5 x1b0 h2e y6bcb ff6 fs20 fc6 sc0 ls0 ws0">18</div><div class="t m5 x33 h2d y211a ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>(argc<span class="_ _1f"> </span>!=<span class="_ _1f"> </span>2)<span class="_ _e"> </span>{</div><div class="t m5 x1b0 h2d y74e ff6 fs20 fc6 sc0 ls0 ws0">19<span class="_ _70"> </span><span class="ffd fs1e fc2">fprintf(stderr,<span class="_ _e"> </span>&quot;usage:<span class="_ _1f"> </span>%s<span class="_ _1f"> </span>&lt;secs&gt;\n&quot;,<span class="_ _e"> </span>argv[0]);</span></div><div class="t m5 x1b0 h2d y278 ff6 fs20 fc6 sc0 ls0 ws0">20<span class="_ _70"> </span><span class="ffd fs1e fc2">exit(0);</span></div><div class="t m5 x1b0 h2d y24e1 ff6 fs20 fc6 sc0 ls0 ws0">21<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1b0 h2e y13c0 ff6 fs20 fc6 sc0 ls0 ws0">22</div><div class="t m5 x1b0 h2e y32df ff6 fs20 fc6 sc0 ls0 ws0">23</div><div class="t m5 x33 h2d ye14 ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>(signal(SIGINT,<span class="_ _1f"> </span>handler)<span class="_ _1f"> </span>==<span class="_ _e"> </span>SIG_ERR)<span class="_ _1f"> </span>/*<span class="_ _e"> </span>Install<span class="_ _1f"> </span>SIGINT<span class="_ _1f"> </span>*/</div><div class="t m5 x1b0 h2d yeef ff6 fs20 fc6 sc0 ls0 ws0">24<span class="_ _70"> </span><span class="ffd fs1e fc2">unix_error(&quot;signal<span class="_ _e"> </span>error\n&quot;);<span class="_ _2b"> </span>/*<span class="_ _e"> </span>handler<span class="_ _1dc"> </span>*/</span></div><div class="t m5 x1b0 h2d yd7a ff6 fs20 fc6 sc0 ls0 ws0">25<span class="_ _20"> </span><span class="ffd fs1e fc2">(void)snooze(atoi(argv[1]));</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
