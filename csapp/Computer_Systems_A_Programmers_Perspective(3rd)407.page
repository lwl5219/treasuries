<div id="pf197" class="pf w2 h11" data-page-no="197"><div class="pc pc197 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg197.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">406<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>4<span class="_ _3d"> </span>Processor<span class="_ _10"> </span>Architecture</span></div><div class="t m5 x1d h47 yb1f ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>4.4<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>518)</span></div><div class="t m5 x1d h26 y9ba ff7 fs19 fc1 sc0 ls0 ws0">Write<span class="_ _16"> </span>Y86-64<span class="_ _16"> </span>code<span class="_ _16"> </span>to<span class="_ _16"> </span>implement<span class="_ _16"> </span>a<span class="_ _16"> </span>recursive<span class="_ _16"> </span>product<span class="_ _16"> </span>function<span class="_ _16"> </span><span class="ffd">rproduct</span>,<span class="_ _14"> </span>based</div><div class="t m5 x1d h26 y302f ff7 fs19 fc1 sc0 ls0 ws0">on<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>C<span class="_"> </span>code:</div><div class="t m5 x1d h2d y3878 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>rproduct(long<span class="_ _1f"> </span>*start,<span class="_ _1f"> </span>long<span class="_ _e"> </span>count)</div><div class="t m5 x1d h2d y3879 ffd fs1e fc2 sc0 ls0 ws0">{</div><div class="t m5 x10c h2d y387a ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>(count<span class="_ _1f"> </span>&lt;=<span class="_ _1f"> </span>1)</div><div class="t m5 x22b h2d y387b ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>1;</div><div class="t m5 x10c h2d y387c ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>*start<span class="_ _1f"> </span>*<span class="_ _1f"> </span>rproduct(start+1,<span class="_ _e"> </span>count-1);</div><div class="t m5 x1d h2d y387d ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x29 h26 y387e ff7 fs19 fc2 sc0 ls0 ws0">Use<span class="_ _6"> </span>the<span class="_ _6"> </span>same<span class="_ _6"> </span>argument<span class="_ _6"> </span>passing<span class="_ _13"> </span>and<span class="_ _a"> </span>register<span class="_ _6"> </span>saving<span class="_ _6"> </span>conventions<span class="_ _13"> </span>as<span class="_ _a"> </span>x86-64<span class="_ _6"> </span>code</div><div class="t m5 x1d h26 y387f ff7 fs19 fc2 sc0 ls0 ws0">does<span class="_ _1"></span>.<span class="_ _11"> </span>Y<span class="_ _3"></span>ou<span class="_ _11"> </span>might<span class="_ _11"> </span>ﬁnd<span class="_ _11"> </span>it<span class="_ _11"> </span>helpful<span class="_ _11"> </span>to<span class="_ _11"> </span>compile<span class="_ _11"> </span>the<span class="_ _11"> </span>C<span class="_ _11"> </span>code<span class="_ _16"> </span>on<span class="_"> </span>an<span class="_ _11"> </span>x86-64<span class="_ _11"> </span>machine<span class="_ _11"> </span>and</div><div class="t m5 x1d h26 y3880 ff7 fs19 fc2 sc0 ls0 ws0">then<span class="_"> </span>translate<span class="_"> </span>the<span class="_"> </span>instructions<span class="_"> </span>to<span class="_"> </span>Y86-64.</div><div class="t m5 x1d h47 y3881 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>4.5<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>519)</span></div><div class="t m5 x1d h26 y3882 ff7 fs19 fc1 sc0 ls0 ws0">Modify<span class="_ _13"> </span>the<span class="_ _13"> </span>Y86-64<span class="_"> </span>code<span class="_ _13"> </span>for<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ffd">sum<span class="_ _13"> </span></span>function<span class="_"> </span>(F<span class="_ _1"></span>igure<span class="_ _13"> </span>4.6)<span class="_ _13"> </span>to<span class="_"> </span>implement<span class="_ _13"> </span>a<span class="_ _13"> </span>function</div><div class="t m5 x1d h26 y3883 ffd fs19 fc1 sc0 ls0 ws0">absSum<span class="_ _11"> </span><span class="ff7">that<span class="_ _16"> </span>computes<span class="_ _16"> </span>the<span class="_ _11"> </span>sum<span class="_ _16"> </span>of<span class="_ _11"> </span>absolute<span class="_ _16"> </span>values<span class="_ _11"> </span>of<span class="_ _16"> </span>an<span class="_ _11"> </span>array<span class="_ _3"></span>.<span class="_ _16"> </span>Use<span class="_ _11"> </span>a<span class="_ _16"> </span><span class="ffa">conditional</span></span></div><div class="t m5 x1d h26 y3884 ffa fs19 fc1 sc0 ls0 ws0">jump<span class="_ _13"> </span><span class="ff7">instruction<span class="_"> </span>within<span class="_"> </span>your<span class="_"> </span>inner<span class="_"> </span>loop.</span></div><div class="t m5 x1d h47 y3885 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>4.6<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>519)</span></div><div class="t m5 x1d h26 y3886 ff7 fs19 fc1 sc0 ls0 ws0">Modify<span class="_ _13"> </span>the<span class="_ _13"> </span>Y86-64<span class="_"> </span>code<span class="_ _13"> </span>for<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ffd">sum<span class="_ _13"> </span></span>function<span class="_"> </span>(F<span class="_ _1"></span>igure<span class="_ _13"> </span>4.6)<span class="_ _13"> </span>to<span class="_"> </span>implement<span class="_ _13"> </span>a<span class="_ _13"> </span>function</div><div class="t m5 x1d h26 y3887 ffd fs19 fc1 sc0 ls0 ws0">absSum<span class="_ _11"> </span><span class="ff7">that<span class="_ _16"> </span>computes<span class="_ _16"> </span>the<span class="_ _11"> </span>sum<span class="_ _16"> </span>of<span class="_ _11"> </span>absolute<span class="_ _16"> </span>values<span class="_ _11"> </span>of<span class="_ _16"> </span>an<span class="_ _11"> </span>array<span class="_ _3"></span>.<span class="_ _16"> </span>Use<span class="_ _11"> </span>a<span class="_ _16"> </span><span class="ffa">conditional</span></span></div><div class="t m5 x1d h26 y3888 ffa fs19 fc1 sc0 ls0 ws0">move<span class="_"> </span><span class="ff7">instruction<span class="_"> </span>within<span class="_"> </span>your<span class="_"> </span>inner<span class="_"> </span>loop<span class="_ _1"></span>.</span></div><div class="t m5 x1d h41 y3889 ffe fs29 fc1 sc0 ls0 ws0">4.1.6</div><div class="t m5 x8c h43 y388a ffe fs19 fc1 sc0 ls0 ws0">Some<span class="_"> </span>Y86-64<span class="_"> </span>Instruction<span class="_"> </span>Details</div><div class="t m5 x1d h26 y388b ff7 fs19 fc1 sc0 ls0 ws0">Most<span class="_"> </span>Y86-64<span class="_ _11"> </span>instructions<span class="_ _11"> </span>transform<span class="_"> </span>the<span class="_ _11"> </span>program<span class="_ _11"> </span>state<span class="_ _11"> </span>in<span class="_"> </span>a<span class="_ _11"> </span>straightforward<span class="_ _11"> </span>man-</div><div class="t m5 x1d h26 y388c ff7 fs19 fc1 sc0 ls0 ws0">ner,<span class="_ _16"> </span>and<span class="_ _14"> </span>so<span class="_ _16"> </span>deﬁning<span class="_ _14"> </span>the<span class="_ _16"> </span>intended<span class="_ _14"> </span>effect<span class="_ _16"> </span>of<span class="_ _14"> </span>each<span class="_ _16"> </span>instruction<span class="_ _14"> </span>is<span class="_ _16"> </span>not<span class="_ _14"> </span>difﬁcult.<span class="_ _16"> </span>T<span class="_ _3"></span>wo</div><div class="t m5 x1d h26 y388d ff7 fs19 fc1 sc0 ls0 ws0">unusual<span class="_"> </span>instruction<span class="_"> </span>combinations<span class="_ _1"></span>,<span class="_"> </span>however,<span class="_"> </span>require<span class="_"> </span>special<span class="_"> </span>attention.</div><div class="t m5 x29 h26 y388e ff7 fs19 fc1 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _15"> </span><span class="ffd ls0">pushq<span class="_ _16"> </span><span class="ff7">instruction<span class="_ _14"> </span>both<span class="_ _16"> </span>decrements<span class="_ _14"> </span>the<span class="_ _16"> </span>stack<span class="_ _14"> </span>pointer<span class="_ _16"> </span>by<span class="_ _14"> </span>8<span class="_ _16"> </span>and<span class="_ _14"> </span>writes<span class="_ _16"> </span>a</span></span></div><div class="t m5 x1d h26 y388f ff7 fs19 fc1 sc0 ls0 ws0">register<span class="_ _6"> </span>value<span class="_ _13"> </span>to<span class="_ _6"> </span>memory<span class="_ _3"></span>.<span class="_ _6"> </span>It<span class="_ _13"> </span>is<span class="_ _6"> </span>therefore<span class="_ _6"> </span>not<span class="_ _13"> </span>totally<span class="_ _6"> </span>clear<span class="_ _13"> </span>what<span class="_ _6"> </span>the<span class="_ _6"> </span>processor<span class="_ _13"> </span>should</div><div class="t m5 x1d h26 y3890 ff7 fs19 fc1 sc0 ls0 ws0">do<span class="_"> </span>when<span class="_"> </span>executing<span class="_ _11"> </span>the<span class="_"> </span>instruction<span class="_"> </span><span class="ffd">pushq<span class="_ _16"> </span>%rsp</span>,<span class="_"> </span>since<span class="_"> </span>the<span class="_ _11"> </span>register<span class="_"> </span>being<span class="_"> </span>pushed<span class="_ _11"> </span>is</div><div class="t m5 x1d h26 y3891 ff7 fs19 fc1 sc0 ls0 ws0">being<span class="_ _16"> </span>changed<span class="_ _16"> </span>by<span class="_ _14"> </span>the<span class="_ _16"> </span>same<span class="_ _16"> </span>instruction.<span class="_ _16"> </span>T<span class="_ _3"></span>wo<span class="_ _16"> </span>different<span class="_ _16"> </span>conventions<span class="_ _14"> </span>are<span class="_ _16"> </span>possible:</div><div class="t m5 x1d h26 y3892 ff7 fs19 fc1 sc0 ls0 ws0">(1)<span class="_"> </span>push<span class="_"> </span>the<span class="_"> </span>original<span class="_"> </span>value<span class="_"> </span>of<span class="_"> </span><span class="ffd">%rsp</span>,<span class="_"> </span>or<span class="_"> </span>(2)<span class="_"> </span>push<span class="_"> </span>the<span class="_"> </span>decremented<span class="_"> </span>value<span class="_"> </span>of<span class="_"> </span><span class="ffd">%rsp</span>.</div><div class="t m5 x29 h26 y3893 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _16"> </span>the<span class="_ _16"> </span>Y86-64<span class="_ _16"> </span>processor,<span class="_ _16"> </span>let<span class="_ _16"> </span>us<span class="_ _16"> </span>adopt<span class="_ _16"> </span>the<span class="_ _14"> </span>same<span class="_ _16"> </span>convention<span class="_ _16"> </span>as<span class="_ _16"> </span>is<span class="_ _16"> </span>used<span class="_ _16"> </span>with</div><div class="t m5 x1d h26 y3894 ff7 fs19 fc1 sc0 ls0 ws0">x86-64,<span class="_"> </span>as<span class="_"> </span>determined<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>problem.</div><div class="t m5 x1d h47 y3895 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>4.7<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>520)</span></div><div class="t m5 x1d h26 y7a6 ff7 fs19 fc1 sc0 ls0 ws0">Let<span class="_ _16"> </span>us<span class="_ _16"> </span>determine<span class="_ _11"> </span>the<span class="_ _16"> </span>behavior<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>instruction<span class="_ _16"> </span><span class="ffd">pushq<span class="_ _11"> </span>%rsp<span class="_ _16"> </span></span>for<span class="_ _16"> </span>an<span class="_ _16"> </span>x86-64<span class="_ _16"> </span>pro-</div><div class="t m5 x1d h26 y7a7 ff7 fs19 fc1 sc0 ls0 ws0">cessor.<span class="_ _16"> </span>W<span class="_ _3"></span>e<span class="_ _14"> </span>could<span class="_ _14"> </span>try<span class="_ _16"> </span>reading<span class="_ _14"> </span>the<span class="_ _14"> </span>Intel<span class="_ _16"> </span>documentation<span class="_ _14"> </span>on<span class="_ _14"> </span>this<span class="_ _14"> </span>instruction,<span class="_ _14"> </span>but<span class="_ _14"> </span>a</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
