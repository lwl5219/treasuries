<div id="pf350" class="pf w2 h11" data-page-no="350"><div class="pc pc350 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg350.png"/><div class="t m5 xfc h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>9.4<span class="_ _60"> </span>VM<span class="_ _10"> </span>as<span class="_ _10"> </span>a<span class="_ _10"> </span>T<span class="_ _1"></span>ool<span class="_ _10"> </span>for<span class="_ _10"> </span>Memory<span class="_ _10"> </span>Management<span class="_ _3e"> </span><span class="ffe fs1e">847</span></div><div class="t m5 x34 h2a y257 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">Counting<span class="_ _11"> </span>page<span class="_ _11"> </span>faults</span></div><div class="t m5 x34 h2b y2d0 ff7 fs1e fc2 sc0 ls0 ws0">Y<span class="_ _3"></span>ou<span class="_"> </span>can<span class="_"> </span>monitor<span class="_"> </span>the<span class="_"> </span>number<span class="_"> </span>of<span class="_"> </span>page<span class="_"> </span>faults<span class="_"> </span>(and<span class="_"> </span>lots<span class="_"> </span>of<span class="_"> </span>other<span class="_"> </span>information)<span class="_"> </span>with<span class="_"> </span>the<span class="_"> </span>Linux<span class="_"> </span><span class="ffd">getrusage</span></div><div class="t m5 x34 h2b y2d1 ff7 fs1e fc2 sc0 ls0 ws0">function.</div><div class="t m5 x17 h2f y6d5c ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>9.9</div><div class="t m5 x17 h2f y6d5d ffe fs16 fc1 sc0 ls0 ws0">How<span class="_ _15"> </span>VM<span class="_ _21"> </span>provides</div><div class="t m5 x17 h2f y6d5e ffe fs16 fc1 sc0 ls0 ws0">processes<span class="_ _11"> </span>with<span class="_ _16"> </span>separate</div><div class="t m5 x17 h34 y6d5f ffe fs16 fc1 sc0 ls0 ws0">address<span class="_ _14"> </span>spaces.<span class="_ _15"> </span><span class="ff6">The</span></div><div class="t m5 x17 h34 y6d60 ff6 fs16 fc1 sc0 ls0 ws0">operating<span class="_ _13"> </span>system<span class="_ _13"> </span>maintains</div><div class="t m5 x17 h34 y6d61 ff6 fs16 fc1 sc0 ls0 ws0">a<span class="_ _11"> </span>separate<span class="_ _16"> </span>page<span class="_ _11"> </span>table<span class="_ _16"> </span>for</div><div class="t m5 x17 h34 y6d62 ff6 fs16 fc1 sc0 ls0 ws0">each<span class="_ _10"> </span>process<span class="_ _10"> </span>in<span class="_ _10"> </span>the<span class="_ _10"> </span>system.</div><div class="t m5 x197 h3f y6d63 ffa9 fs27 fc1 sc0 ls0 ws0">Virtual address spaces</div><div class="t m5 x283 h3f y6d64 ffa9 fs27 fc1 sc0 ls0 ws0">Physical memory</div><div class="t m5 x231 h3f y6d65 ffa9 fs27 fc1 sc0 ls0 ws0">Shared page</div><div class="t m5 xbd h3f y6d66 ffa9 fs27 fc1 sc0 ls0 ws0">Address translation</div><div class="t m5 xb3 h3f y6d67 ffa9 fs27 fc1 sc0 ls0 ws0">Process <span class="ffaa">i<span class="_ _5"></span></span>:</div><div class="t m5 xb3 h3f y6d68 ffa9 fs27 fc1 sc0 ls0 ws0">Process <span class="ffaa">j<span class="_ _5"></span></span>:</div><div class="t m5 xd4 h65 y6d69 ffa9 fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 x87 h65 y6d6a ffaa fs38 fc1 sc0 ls0 ws0">N<span class="_ _2"></span><span class="ffa9">–1</span></div><div class="t m5 xd4 h65 y6d6b ffa9 fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 x99 h3f y6d6c ffa9 fs27 fc1 sc0 ls0 ws0">VP 1</div><div class="t m5 x99 h3f y6d6d ffa9 fs27 fc1 sc0 ls0 ws0">VP 2</div><div class="t m5 x99 h3f y6d6e ffa9 fs27 fc1 sc0 ls0 ws0">VP 1<span class="_ _13f"> </span>PP 2</div><div class="t m5 x270 h3f y6d6f ffa9 fs27 fc1 sc0 ls0 ws0">PP 7</div><div class="t m5 xd6 h3f y6d70 ffa9 fs27 fc1 sc0 ls0 ws0">PP 10</div><div class="t m5 x99 h3f y6d71 ffa9 fs27 fc1 sc0 ls0 ws0">VP 2</div><div class="t m5 x87 h65 y6d72 ffaa fs38 fc1 sc0 ls0 ws0">N<span class="_ _2"></span><span class="ffa9">–1</span></div><div class="t m5 x81 h65 y6d73 ffa9 fs38 fc1 sc0 ls0 ws0">0</div><div class="t m5 x261 h65 y6d74 ffaa fs38 fc1 sc0 ls0 ws0">M<span class="_ _2"></span><span class="ffa9">–1</span></div><div class="t m5 x17 h3b y6d75 fff fs24 fc6 sc0 ls0 ws0">9.4<span class="_ _17"> </span><span class="ffe fs18">VM<span class="_"> </span>as<span class="_"> </span>a<span class="_"> </span>T<span class="_ _1"></span>ool<span class="_"> </span>for<span class="_"> </span>Memory<span class="_"> </span>Management</span></div><div class="t m5 x17 h26 y6d76 ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _13"> </span>the<span class="_ _6"> </span>last<span class="_ _13"> </span>section,<span class="_ _6"> </span>we<span class="_ _13"> </span>saw<span class="_ _6"> </span>how<span class="_ _13"> </span>virtual<span class="_ _13"> </span>memory<span class="_ _6"> </span>provides<span class="_ _13"> </span>a<span class="_ _6"> </span>mechanism<span class="_ _13"> </span>for<span class="_ _6"> </span>using<span class="_ _13"> </span>the</div><div class="t m5 x17 h26 y6d77 ff7 fs19 fc1 sc0 ls0 ws0">DRAM<span class="_ _13"> </span>to<span class="_"> </span>cache<span class="_ _13"> </span>pages<span class="_"> </span>from<span class="_ _13"> </span>a<span class="_ _13"> </span>typically<span class="_"> </span>larger<span class="_ _13"> </span>virtual<span class="_"> </span>address<span class="_ _13"> </span>space<span class="_ _1"></span>.<span class="_"> </span>Interestingly<span class="_ _7"></span>,</div><div class="t m5 x17 h26 y6d78 ff7 fs19 fc1 sc0 ls0 ws0">some<span class="_ _13"> </span>early<span class="_ _13"> </span>systems<span class="_ _13"> </span>such<span class="_ _13"> </span>as<span class="_"> </span>the<span class="_ _13"> </span>DEC<span class="_ _13"> </span>PDP-11/70<span class="_ _13"> </span>supported<span class="_ _13"> </span>a<span class="_ _13"> </span>virtual<span class="_ _13"> </span>address<span class="_ _13"> </span>space</div><div class="t m5 x17 h26 y6d79 ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_ _15"> </span>was<span class="_ _15"> </span><span class="ffa">smaller<span class="_ _f"> </span></span>than<span class="_ _21"> </span>the<span class="_ _15"> </span>available<span class="_ _21"> </span>physical<span class="_ _15"> </span>memory<span class="_ _3"></span>.<span class="_ _21"> </span>Y<span class="_ _3"></span>et<span class="_ _15"> </span>virtual<span class="_ _15"> </span>memory<span class="_ _21"> </span>was</div><div class="t m5 x17 h26 y6d7a ff7 fs19 fc1 sc0 ls0 ws0">still<span class="_ _16"> </span>a<span class="_ _16"> </span>useful<span class="_ _16"> </span>mechanism<span class="_ _16"> </span>because<span class="_ _16"> </span>it<span class="_ _16"> </span>greatly<span class="_ _11"> </span>simpliﬁed<span class="_ _16"> </span>memory<span class="_ _16"> </span>management<span class="_ _16"> </span>and</div><div class="t m5 x17 h26 y6d7b ff7 fs19 fc1 sc0 ls0 ws0">provided<span class="_"> </span>a<span class="_"> </span>natural<span class="_"> </span>way<span class="_"> </span>to<span class="_"> </span>protect<span class="_"> </span>memory<span class="_ _3"></span>.</div><div class="t m5 x26 h26 y6d7c ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>hus<span class="_ _f"> </span>far,<span class="_ _f"> </span>we<span class="_ _21"> </span>have<span class="_ _f"> </span>assumed<span class="_ _21"> </span>a<span class="_ _21"> </span>single<span class="_ _f"> </span>page<span class="_ _21"> </span>table<span class="_ _21"> </span>that<span class="_ _f"> </span>maps<span class="_ _21"> </span>a<span class="_ _21"> </span>single<span class="_ _f"> </span>virtual</div><div class="t m5 x17 h26 y6d7d ff7 fs19 fc1 sc0 ls0 ws0">address<span class="_ _14"> </span>space<span class="_ _14"> </span>to<span class="_ _14"> </span>the<span class="_ _14"> </span>physical<span class="_ _14"> </span>address<span class="_ _14"> </span>space<span class="_ _0"></span>.<span class="_ _14"> </span>In<span class="_ _14"> </span>fact,<span class="_ _15"> </span>operating<span class="_ _14"> </span>systems<span class="_ _14"> </span>provide</div><div class="t m5 x17 h26 y6d7e ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_"> </span>separate<span class="_"> </span>page<span class="_"> </span>table<span class="_ _1"></span>,<span class="_"> </span>and<span class="_"> </span>thus<span class="_"> </span>a<span class="_"> </span>separate<span class="_ _13"> </span>virtual<span class="_"> </span>address<span class="_"> </span>space,<span class="_ _13"> </span>for<span class="_"> </span>each<span class="_"> </span>process<span class="_ _1"></span>.</div><div class="t m5 x17 h26 y6d7f ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_"> </span>9.9<span class="_"> </span>shows<span class="_"> </span>the<span class="_ _13"> </span>basic<span class="_"> </span>idea.<span class="_"> </span>In<span class="_ _13"> </span>the<span class="_"> </span>example<span class="_ _1"></span>,<span class="_"> </span>the<span class="_"> </span>page<span class="_"> </span>table<span class="_ _13"> </span>for<span class="_"> </span>process<span class="_"> </span><span class="ff11">i<span class="_ _11"> </span></span>maps</div><div class="t m5 x17 h26 y6d80 ff7 fs19 fc1 sc0 ls0 ws0">VP<span class="_"> </span>1<span class="_"> </span>to<span class="_"> </span>PP<span class="_"> </span>2<span class="_"> </span>and<span class="_"> </span>VP<span class="_"> </span>2<span class="_"> </span>to<span class="_ _11"> </span>PP<span class="_"> </span>7.<span class="_"> </span>Similarly<span class="_ _3"></span>,<span class="_"> </span>the<span class="_"> </span>page<span class="_"> </span>table<span class="_"> </span>for<span class="_"> </span>process<span class="_ _11"> </span><span class="ff11">j<span class="_ _14"> </span></span>maps<span class="_"> </span>VP<span class="_ _11"> </span>1</div><div class="t m5 x17 h26 y6d81 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _11"> </span>PP<span class="_ _11"> </span>7<span class="_ _16"> </span>and<span class="_ _11"> </span>VP<span class="_ _11"> </span>2<span class="_ _16"> </span>to<span class="_"> </span>PP<span class="_ _16"> </span>10.<span class="_ _11"> </span>Notice<span class="_ _11"> </span>that<span class="_ _16"> </span>multiple<span class="_ _11"> </span>virtual<span class="_ _11"> </span>pages<span class="_ _11"> </span>can<span class="_ _16"> </span>be<span class="_ _11"> </span>mapped<span class="_ _11"> </span>to</div><div class="t m5 x17 h26 y6d82 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>same<span class="_"> </span>shared<span class="_"> </span>physical<span class="_"> </span>page<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y6d83 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _16"> </span>combination<span class="_ _11"> </span>of<span class="_ _16"> </span>demand<span class="_ _16"> </span>paging<span class="_ _11"> </span>and<span class="_ _16"> </span>separate<span class="_ _11"> </span>virtual<span class="_ _16"> </span>address<span class="_ _11"> </span>spaces<span class="_ _16"> </span>has</div><div class="t m5 x17 h26 y6d84 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_"> </span>profound<span class="_ _11"> </span>impact<span class="_ _11"> </span>on<span class="_ _11"> </span>the<span class="_"> </span>way<span class="_ _11"> </span>that<span class="_ _11"> </span>memory<span class="_ _11"> </span>is<span class="_"> </span>used<span class="_ _11"> </span>and<span class="_ _11"> </span>managed<span class="_ _11"> </span>in<span class="_"> </span>a<span class="_ _11"> </span>system.<span class="_ _11"> </span>In</div><div class="t m5 x17 h26 y6d85 ff7 fs19 fc1 sc0 ls0 ws0">particular,<span class="_ _11"> </span>VM<span class="_ _16"> </span>simpliﬁes<span class="_ _11"> </span>linking<span class="_ _16"> </span>and<span class="_ _16"> </span>loading<span class="_ _0"></span>,<span class="_ _16"> </span>the<span class="_ _11"> </span>sharing<span class="_ _16"> </span>of<span class="_ _16"> </span>code<span class="_ _11"> </span>and<span class="_ _16"> </span>data,<span class="_ _16"> </span>and</div><div class="t m5 x17 h26 y6d86 ff7 fs19 fc1 sc0 ls0 ws0">allocating<span class="_"> </span>memory<span class="_"> </span>to<span class="_"> </span>applications<span class="_ _1"></span>.</div><div class="t m5 x72 h3d y5496 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y107b ffa fs19 fc1 sc0 ls0 ws0">Simplifying<span class="_ _11"> </span>linking.<span class="_ _6"> </span><span class="ff7">A<span class="_ _11"> </span>separate<span class="_ _16"> </span>address<span class="_"> </span>space<span class="_ _11"> </span>allows<span class="_ _11"> </span>each<span class="_ _11"> </span>process<span class="_ _16"> </span>to<span class="_"> </span>use<span class="_ _11"> </span>the</span></div><div class="t m5 x26 h26 y21fc ff7 fs19 fc1 sc0 ls0 ws0">same<span class="_ _6"> </span>basic<span class="_ _6"> </span>format<span class="_ _6"> </span>for<span class="_ _6"> </span>its<span class="_ _13"> </span>memory<span class="_ _a"> </span>image,<span class="_ _6"> </span>regardless<span class="_ _6"> </span>of<span class="_ _6"> </span>where<span class="_ _6"> </span>the<span class="_ _13"> </span>code<span class="_ _a"> </span>and<span class="_ _6"> </span>data</div><div class="t m5 x26 h26 y3366 ff7 fs19 fc1 sc0 ls0 ws0">actually<span class="_ _13"> </span>reside<span class="_"> </span>in<span class="_ _13"> </span>physical<span class="_ _13"> </span>memory<span class="_ _3"></span>.<span class="_"> </span>F<span class="_ _3"></span>or<span class="_ _13"> </span>example,<span class="_ _13"> </span>as<span class="_"> </span>we<span class="_ _13"> </span>saw<span class="_ _13"> </span>in<span class="_ _13"> </span>Figure<span class="_ _13"> </span>8.13,<span class="_"> </span>ev-</div><div class="t m5 x26 h26 y3367 ff7 fs19 fc1 sc0 ls0 ws0">ery<span class="_"> </span>process<span class="_"> </span>on<span class="_"> </span>a<span class="_"> </span>given<span class="_"> </span>Linux<span class="_"> </span>system<span class="_"> </span>has<span class="_"> </span>a<span class="_"> </span>similar<span class="_"> </span>memory<span class="_"> </span>format.<span class="_"> </span>F<span class="_ _1"></span>or<span class="_"> </span>64-bit</div><div class="t m5 x26 h26 yc03 ff7 fs19 fc1 sc0 ls0 ws0">address<span class="_ _16"> </span>spaces<span class="_ _3"></span>,<span class="_ _14"> </span>the<span class="_ _16"> </span>code<span class="_ _16"> </span>segment<span class="_ _11"> </span><span class="ffa">always<span class="_ _16"> </span></span>starts<span class="_ _16"> </span>at<span class="_ _11"> </span>virtual<span class="_ _16"> </span>address<span class="_ _16"> </span><span class="ffd">0x400000</span>.</div><div class="t m5 x26 h26 yc04 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _14"> </span>data<span class="_ _16"> </span>segment<span class="_ _14"> </span>follows<span class="_ _16"> </span>the<span class="_ _16"> </span>code<span class="_ _14"> </span>segment<span class="_ _16"> </span>after<span class="_ _14"> </span>a<span class="_ _16"> </span>suitable<span class="_ _14"> </span>alignment<span class="_ _16"> </span>gap<span class="_ _0"></span>.</div><div class="t m5 x26 h26 y35bd ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>stack<span class="_"> </span>occupies<span class="_ _11"> </span>the<span class="_"> </span>highest<span class="_"> </span>portion<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>user<span class="_"> </span>process<span class="_"> </span>address<span class="_"> </span>space<span class="_ _11"> </span>and</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
