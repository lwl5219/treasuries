<div id="pf1d1" class="pf w2 h11" data-page-no="1d1"><div class="pc pc1d1 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1d1.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">464<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>4<span class="_ _3d"> </span>Processor<span class="_ _10"> </span>Architecture</span></div><div class="t m5 x28 h2a y257 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">Other<span class="_ _11"> </span>branch<span class="_ _11"> </span>prediction<span class="_ _11"> </span>strategies</span></div><div class="t m5 x28 h2b y2d0 ff7 fs1e fc2 sc0 ls0 ws0">Our<span class="_ _11"> </span>design<span class="_ _16"> </span>uses<span class="_ _11"> </span>an<span class="_ _16"> </span><span class="ffa">always<span class="_ _11"> </span>taken<span class="_ _11"> </span></span>branch<span class="_ _11"> </span>prediction<span class="_ _16"> </span>strategy<span class="_ _3"></span>.<span class="_ _11"> </span>Studies<span class="_ _16"> </span>show<span class="_ _11"> </span>this<span class="_ _16"> </span>strategy<span class="_ _11"> </span>has<span class="_ _16"> </span>around<span class="_ _11"> </span>a</div><div class="t m5 x28 h2b y2d1 ff7 fs1e fc2 sc0 ls0 ws0">60%<span class="_"> </span>success<span class="_"> </span>rate<span class="_ _11"> </span>[44,<span class="_"> </span>122].<span class="_ _10"> </span>Conversely<span class="_ _3"></span>,<span class="_ _11"> </span>a<span class="_"> </span><span class="ffa">never<span class="_"> </span>taken<span class="_"> </span></span>(NT)<span class="_ _11"> </span>strategy<span class="_"> </span>has<span class="_"> </span>around<span class="_ _10"> </span>a<span class="_ _11"> </span>40%<span class="_"> </span>success<span class="_"> </span>rate.<span class="_"> </span>A</div><div class="t m5 x28 h2b y2d2 ff7 fs1e fc2 sc0 ls0 ws0">slightly<span class="_ _11"> </span>more<span class="_ _10"> </span>sophisticated<span class="_ _11"> </span>strategy<span class="_ _3"></span>,<span class="_ _11"> </span>known<span class="_ _11"> </span>as<span class="_ _11"> </span><span class="ffa">backward<span class="_"> </span>taken,<span class="_ _11"> </span>forward<span class="_ _11"> </span>not<span class="_ _11"> </span>taken<span class="_"> </span></span>(BTFNT),<span class="_ _11"> </span>predicts</div><div class="t m5 x28 h2b y2d3 ff7 fs1e fc2 sc0 ls0 ws0">that<span class="_ _6"> </span>branches<span class="_ _13"> </span>to<span class="_ _13"> </span>lower<span class="_ _6"> </span>addresses<span class="_ _13"> </span>than<span class="_ _6"> </span>the<span class="_ _13"> </span>next<span class="_ _6"> </span>instruction<span class="_ _13"> </span>will<span class="_ _6"> </span>be<span class="_ _13"> </span>taken,<span class="_ _6"> </span>while<span class="_ _13"> </span>those<span class="_ _6"> </span>to<span class="_ _13"> </span>higher<span class="_ _6"> </span>addresses</div><div class="t m5 x28 h2b y2d4 ff7 fs1e fc2 sc0 ls0 ws0">will<span class="_ _13"> </span>not<span class="_ _6"> </span>be<span class="_ _13"> </span>taken.<span class="_ _13"> </span>T<span class="_ _1"></span>his<span class="_ _13"> </span>strategy<span class="_ _6"> </span>has<span class="_ _13"> </span>a<span class="_ _13"> </span>success<span class="_ _6"> </span>rate<span class="_ _13"> </span>of<span class="_ _13"> </span>around<span class="_ _6"> </span>65%.<span class="_ _13"> </span>T<span class="_ _1"></span>his<span class="_ _13"> </span>improvement<span class="_ _13"> </span>stems<span class="_ _6"> </span>from<span class="_ _13"> </span>the<span class="_ _13"> </span>fact</div><div class="t m5 x28 h2b y2d5 ff7 fs1e fc2 sc0 ls0 ws0">that<span class="_"> </span>loops<span class="_"> </span>are<span class="_"> </span>closed<span class="_"> </span>by<span class="_ _13"> </span>backward<span class="_"> </span>branches<span class="_"> </span>and<span class="_"> </span>loops<span class="_"> </span>are<span class="_"> </span>generally<span class="_ _13"> </span>executed<span class="_"> </span>multiple<span class="_"> </span>times<span class="_ _1"></span>.<span class="_"> </span>F<span class="_ _1"></span>orward</div><div class="t m5 x28 h2b y2d6 ff7 fs1e fc2 sc0 ls0 ws0">branches<span class="_ _11"> </span>are<span class="_ _11"> </span>used<span class="_ _16"> </span>for<span class="_ _11"> </span>conditional<span class="_ _11"> </span>operations<span class="_ _1"></span>,<span class="_ _16"> </span>and<span class="_ _11"> </span>these<span class="_ _16"> </span>are<span class="_ _11"> </span>less<span class="_ _11"> </span>likely<span class="_ _16"> </span>to<span class="_ _11"> </span>be<span class="_ _11"> </span>taken.<span class="_ _11"> </span>In<span class="_ _16"> </span>Problems<span class="_ _11"> </span>4.55</div><div class="t m5 x28 h2b y549 ff7 fs1e fc2 sc0 ls0 ws0">and<span class="_ _25"> </span>4.56,<span class="_ _14"> </span>you<span class="_ _16"> </span>can<span class="_ _16"> </span>modify<span class="_ _16"> </span>the<span class="_ _16"> </span>Y86-64<span class="_ _16"> </span>pipeline<span class="_ _14"> </span>processor<span class="_ _16"> </span>to<span class="_ _16"> </span>implement<span class="_ _16"> </span>the<span class="_ _16"> </span>NT<span class="_ _16"> </span>and<span class="_ _16"> </span>BTFNT<span class="_ _14"> </span>branch</div><div class="t m5 x28 h2b y54a ff7 fs1e fc2 sc0 ls0 ws0">prediction<span class="_"> </span>strategies<span class="_ _1"></span>.</div><div class="t m5 x57 h2b y54b ff7 fs1e fc2 sc0 ls0 ws0">As<span class="_ _16"> </span>we<span class="_ _14"> </span>saw<span class="_ _14"> </span>in<span class="_ _16"> </span>Section<span class="_ _14"> </span>3.6.6,<span class="_ _15"> </span>mispredicted<span class="_ _16"> </span>branches<span class="_ _14"> </span>can<span class="_ _14"> </span>degrade<span class="_ _16"> </span>the<span class="_ _14"> </span>performance<span class="_ _14"> </span>of<span class="_ _16"> </span>a<span class="_ _14"> </span>program</div><div class="t m5 x28 h2b y54c ff7 fs1e fc2 sc0 ls0 ws0">considerably<span class="_ _3"></span>,<span class="_ _f"> </span>thus<span class="_ _21"> </span>motivating<span class="_ _21"> </span>the<span class="_ _21"> </span>use<span class="_ _f"> </span>of<span class="_ _21"> </span>conditional<span class="_ _21"> </span>data<span class="_ _21"> </span>transfer<span class="_ _21"> </span>rather<span class="_ _21"> </span>than<span class="_ _21"> </span>conditional<span class="_ _21"> </span>control</div><div class="t m5 x28 h2b y54d ff7 fs1e fc2 sc0 ls0 ws0">transfer<span class="_"> </span>when<span class="_"> </span>possible<span class="_ _1"></span>.</div><div class="t m5 x1d h26 y19a9 ff7 fs19 fc2 sc0 ls0 ws0">yield<span class="_ _14"> </span>a<span class="_ _14"> </span>throughput<span class="_ _14"> </span>of<span class="_ _14"> </span>one<span class="_ _14"> </span>instruction<span class="_ _14"> </span>per<span class="_ _15"> </span>cycle<span class="_ _1"></span>.<span class="_ _14"> </span>T<span class="_ _3"></span>o<span class="_ _14"> </span>do<span class="_ _14"> </span>this<span class="_ _1"></span>,<span class="_ _15"> </span>we<span class="_ _14"> </span>must<span class="_ _14"> </span>determine</div><div class="t m5 x1d h26 y19aa ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _14"> </span>location<span class="_ _15"> </span>of<span class="_ _14"> </span>the<span class="_ _15"> </span>next<span class="_ _15"> </span>instruction<span class="_ _14"> </span>right<span class="_ _15"> </span>after<span class="_ _15"> </span>fetching<span class="_ _14"> </span>the<span class="_ _15"> </span>current<span class="_ _14"> </span>instruction.</div><div class="t m5 x1d h26 y19ab ff7 fs19 fc2 sc0 ls0 ws0">Unfortunately<span class="_ _3"></span>,<span class="_ _e"> </span>if<span class="_ _e"> </span>the<span class="_ _f"> </span>fetched<span class="_ _f"> </span>instruction<span class="_ _e"> </span>is<span class="_ _f"> </span>a<span class="_ _e"> </span>conditional<span class="_ _f"> </span>branch,<span class="_ _e"> </span>we<span class="_ _e"> </span>will<span class="_ _f"> </span>not</div><div class="t m5 x1d h26 y19ac ff7 fs19 fc2 sc0 ls0 ws0">know<span class="_ _11"> </span>whether<span class="_ _16"> </span>or<span class="_ _11"> </span>not<span class="_ _11"> </span>the<span class="_ _16"> </span>branch<span class="_ _11"> </span>should<span class="_ _16"> </span>be<span class="_ _11"> </span>taken<span class="_ _11"> </span>until<span class="_ _16"> </span>several<span class="_ _11"> </span>cycles<span class="_ _11"> </span>later,<span class="_ _11"> </span>after</div><div class="t m5 x1d h26 y19ad ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _21"> </span>instruction<span class="_ _21"> </span>has<span class="_ _f"> </span>passed<span class="_ _21"> </span>through<span class="_ _21"> </span>the<span class="_ _f"> </span>execute<span class="_ _21"> </span>stage.<span class="_ _15"> </span>Similarly<span class="_ _3"></span>,<span class="_ _e"> </span>if<span class="_ _15"> </span>the<span class="_ _21"> </span>fetched</div><div class="t m5 x1d h26 y19ae ff7 fs19 fc2 sc0 ls0 ws0">instruction<span class="_"> </span>is<span class="_"> </span>a<span class="_ _13"> </span><span class="ffd">ret</span>,<span class="_"> </span>we<span class="_"> </span>cannot<span class="_"> </span>determine<span class="_ _13"> </span>the<span class="_"> </span>return<span class="_"> </span>location<span class="_"> </span>until<span class="_ _13"> </span>the<span class="_"> </span>instruction</div><div class="t m5 x1d h26 y2d07 ff7 fs19 fc2 sc0 ls0 ws0">has<span class="_"> </span>passed<span class="_"> </span>through<span class="_"> </span>the<span class="_"> </span>memory<span class="_"> </span>stage<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y2d08 ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _1"></span>ith<span class="_ _16"> </span>the<span class="_ _16"> </span>exception<span class="_ _16"> </span>of<span class="_ _16"> </span>conditional<span class="_ _16"> </span>jump<span class="_ _16"> </span>instructions<span class="_ _16"> </span>and<span class="_ _16"> </span><span class="ffd">ret</span>,<span class="_ _14"> </span>we<span class="_ _16"> </span>can<span class="_ _16"> </span>deter<span class="_ _1"></span>-</div><div class="t m5 x1d h26 y405a ff7 fs19 fc2 sc0 ls0 ws0">mine<span class="_ _11"> </span>the<span class="_ _16"> </span>address<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>next<span class="_ _16"> </span>instruction<span class="_ _11"> </span>based<span class="_ _11"> </span>on<span class="_ _16"> </span>information<span class="_ _11"> </span>computed<span class="_ _11"> </span>during</div><div class="t m5 x1d h26 y405b ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _11"> </span>fetch<span class="_ _16"> </span>stage<span class="_ _1"></span>.<span class="_ _16"> </span>F<span class="_ _3"></span>or<span class="_ _16"> </span><span class="ffd">call<span class="_ _11"> </span></span>and<span class="_ _16"> </span><span class="ffd">jmp<span class="_ _11"> </span></span>(unconditional<span class="_ _11"> </span>jump),<span class="_ _16"> </span>it<span class="_ _16"> </span>will<span class="_ _11"> </span>be<span class="_ _11"> </span><span class="ff6">valC</span>,<span class="_ _16"> </span>the<span class="_ _11"> </span>con-</div><div class="t m5 x1d h26 y405c ff7 fs19 fc2 sc0 ls0 ws0">stant<span class="_"> </span>word<span class="_ _13"> </span>in<span class="_"> </span>the<span class="_"> </span>instruction,<span class="_ _13"> </span>while<span class="_"> </span>for<span class="_"> </span>all<span class="_"> </span>others<span class="_ _13"> </span>it<span class="_"> </span>will<span class="_"> </span>be<span class="_ _13"> </span><span class="ff6">valP</span>,<span class="_"> </span>the<span class="_"> </span>address<span class="_ _13"> </span>of<span class="_"> </span>the</div><div class="t m5 x1d h26 y405d ff7 fs19 fc2 sc0 ls0 ws0">next<span class="_ _11"> </span>instruction.<span class="_ _16"> </span>W<span class="_ _3"></span>e<span class="_ _16"> </span>can<span class="_ _16"> </span>therefore<span class="_ _11"> </span>achieve<span class="_ _16"> </span>our<span class="_ _16"> </span>goal<span class="_ _11"> </span>of<span class="_ _16"> </span>issuing<span class="_ _16"> </span>a<span class="_ _11"> </span>new<span class="_ _16"> </span>instruction</div><div class="t m5 x1d h26 y405e ff7 fs19 fc2 sc0 ls0 ws0">every<span class="_ _13"> </span>clock<span class="_ _13"> </span>cycle<span class="_ _13"> </span>in<span class="_ _13"> </span>most<span class="_ _13"> </span>cases<span class="_ _13"> </span>by<span class="_ _13"> </span><span class="ffa">predicting<span class="_"> </span></span>the<span class="_ _13"> </span>next<span class="_ _13"> </span>value<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>PC<span class="_ _1"></span>.<span class="_ _13"> </span>F<span class="_ _1"></span>or<span class="_ _13"> </span>most<span class="_ _13"> </span>in-</div><div class="t m5 x1d h26 y405f ff7 fs19 fc2 sc0 ls0 ws0">struction<span class="_"> </span>types<span class="_ _1"></span>,<span class="_"> </span>our<span class="_"> </span>prediction<span class="_"> </span>will<span class="_"> </span>be<span class="_"> </span>completely<span class="_"> </span>reliable<span class="_ _1"></span>.<span class="_"> </span>F<span class="_ _3"></span>or<span class="_"> </span>conditional<span class="_"> </span>jumps<span class="_ _1"></span>,</div><div class="t m5 x1d h26 y4060 ff7 fs19 fc2 sc0 ls0 ws0">we<span class="_ _13"> </span>can<span class="_ _13"> </span>predict<span class="_ _13"> </span>either<span class="_ _13"> </span>that<span class="_"> </span>a<span class="_ _13"> </span>jump<span class="_ _13"> </span>will<span class="_ _13"> </span>be<span class="_ _13"> </span>taken,<span class="_ _13"> </span>so<span class="_ _13"> </span>that<span class="_ _13"> </span>the<span class="_ _13"> </span>new<span class="_"> </span>PC<span class="_ _13"> </span>value<span class="_ _13"> </span>would<span class="_ _13"> </span>be</div><div class="t m5 x1d h26 y4061 ff6 fs19 fc2 sc0 ls0 ws0">valC<span class="ff7">,<span class="_ _13"> </span>or<span class="_"> </span>that<span class="_ _13"> </span>it<span class="_ _13"> </span>will<span class="_"> </span>not<span class="_ _13"> </span>be<span class="_ _13"> </span>taken,<span class="_"> </span>so<span class="_ _13"> </span>that<span class="_ _13"> </span>the<span class="_ _13"> </span>new<span class="_"> </span>PC<span class="_ _13"> </span>value<span class="_ _13"> </span>would<span class="_ _13"> </span>be<span class="_"> </span></span>valP<span class="ff7">.<span class="_ _13"> </span>In<span class="_ _13"> </span>either</span></div><div class="t m5 x1d h26 y4062 ff7 fs19 fc2 sc0 ls0 ws0">case<span class="_ _1"></span>,<span class="_"> </span>we<span class="_ _13"> </span>must<span class="_ _13"> </span>somehow<span class="_ _13"> </span>deal<span class="_ _13"> </span>with<span class="_ _13"> </span>the<span class="_ _13"> </span>case<span class="_ _13"> </span>where<span class="_ _13"> </span>our<span class="_ _13"> </span>prediction<span class="_ _13"> </span>was<span class="_ _13"> </span>incorrect<span class="_ _13"> </span>and</div><div class="t m5 x1d h26 y4063 ff7 fs19 fc2 sc0 ls0 ws0">therefore<span class="_"> </span>we<span class="_"> </span>have<span class="_"> </span>fetched<span class="_"> </span>and<span class="_"> </span>partially<span class="_"> </span>executed<span class="_"> </span>the<span class="_"> </span>wrong<span class="_ _11"> </span>instructions<span class="_ _1"></span>.<span class="_"> </span>W<span class="_ _3"></span>e<span class="_"> </span>will</div><div class="t m5 x1d h26 y4064 ff7 fs19 fc2 sc0 ls0 ws0">return<span class="_"> </span>to<span class="_"> </span>this<span class="_"> </span>matter<span class="_"> </span>in<span class="_"> </span>Section<span class="_"> </span>4.5.8.</div><div class="t m5 x29 h26 y4065 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _6"> </span>technique<span class="_ _6"> </span>of<span class="_ _13"> </span>guessing<span class="_ _a"> </span>the<span class="_ _6"> </span>branch<span class="_ _6"> </span>direction<span class="_ _6"> </span>and<span class="_ _6"> </span>then<span class="_ _13"> </span>initiating<span class="_ _a"> </span>the<span class="_ _6"> </span>fetching</div><div class="t m5 x1d h26 y4066 ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_"> </span>instructions<span class="_"> </span>according<span class="_"> </span>to<span class="_ _11"> </span>our<span class="_"> </span>guess<span class="_"> </span>is<span class="_ _11"> </span>known<span class="_"> </span>as<span class="_"> </span><span class="ffa">branch<span class="_"> </span>prediction</span>.<span class="_"> </span>It<span class="_ _11"> </span>is<span class="_"> </span>used<span class="_"> </span>in</div><div class="t m5 x1d h26 y4067 ff7 fs19 fc2 sc0 ls0 ws0">some<span class="_ _6"> </span>form<span class="_ _13"> </span>by<span class="_ _a"> </span>virtually<span class="_ _13"> </span>all<span class="_ _6"> </span>processors<span class="_ _1"></span>.<span class="_ _6"> </span>Extensive<span class="_ _13"> </span>experiments<span class="_ _a"> </span>have<span class="_ _13"> </span>been<span class="_ _6"> </span>conducted</div><div class="t m5 x1d h26 y4068 ff7 fs19 fc2 sc0 ls0 ws0">on<span class="_ _16"> </span>effective<span class="_ _16"> </span>strategies<span class="_ _11"> </span>for<span class="_ _16"> </span>predicting<span class="_ _16"> </span>whether<span class="_ _16"> </span>or<span class="_ _16"> </span>not<span class="_ _16"> </span>branches<span class="_ _11"> </span>will<span class="_ _16"> </span>be<span class="_ _16"> </span>taken<span class="_ _16"> </span>[46,</div><div class="t m5 x1d h26 y4069 ff7 fs19 fc2 sc0 ls0 ws0">Section<span class="_"> </span>2.3].<span class="_"> </span>Some<span class="_"> </span>systems<span class="_"> </span>devote<span class="_"> </span>large<span class="_"> </span>amounts<span class="_"> </span>of<span class="_"> </span>hardware<span class="_ _13"> </span>to<span class="_"> </span>this<span class="_"> </span>task.<span class="_"> </span>In<span class="_"> </span>our</div><div class="t m5 x1d h26 y406a ff7 fs19 fc2 sc0 ls0 ws0">design,<span class="_"> </span>we<span class="_ _13"> </span>will<span class="_"> </span>use<span class="_ _13"> </span>the<span class="_"> </span>simple<span class="_ _13"> </span>strategy<span class="_"> </span>of<span class="_ _13"> </span>predicting<span class="_"> </span>that<span class="_ _13"> </span>conditional<span class="_"> </span>branches<span class="_ _13"> </span>are</div><div class="t m5 x1d h26 y406b ff7 fs19 fc2 sc0 ls0 ws0">always<span class="_"> </span>taken,<span class="_"> </span>and<span class="_"> </span>so<span class="_"> </span>we<span class="_"> </span>predict<span class="_"> </span>the<span class="_"> </span>new<span class="_"> </span>value<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>PC<span class="_"> </span>to<span class="_"> </span>be<span class="_"> </span><span class="ff6">valC</span>.</div><div class="t m5 x29 h26 y406c ff7 fs19 fc2 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _14"> </span>are<span class="_ _15"> </span>still<span class="_ _14"> </span>left<span class="_ _14"> </span>with<span class="_ _14"> </span>predicting<span class="_ _15"> </span>the<span class="_ _14"> </span>new<span class="_ _14"> </span>PC<span class="_ _15"> </span>value<span class="_ _14"> </span>resulting<span class="_ _14"> </span>from<span class="_ _14"> </span>a<span class="_ _15"> </span><span class="ffd">ret<span class="_ _14"> </span></span>in-</div><div class="t m5 x1d h26 y406d ff7 fs19 fc2 sc0 ls0 ws0">struction.<span class="_"> </span>Unlike<span class="_ _11"> </span>conditional<span class="_ _11"> </span>jumps<span class="_ _1"></span>,<span class="_ _11"> </span>we<span class="_"> </span>have<span class="_ _11"> </span>a<span class="_ _11"> </span>nearly<span class="_"> </span>unbounded<span class="_ _11"> </span>set<span class="_ _11"> </span>of<span class="_"> </span>possible</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
