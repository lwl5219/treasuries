<div id="pf1ef" class="pf w2 h11" data-page-no="1ef"><div class="pc pc1ef w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1ef.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">494<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>4<span class="_ _3d"> </span>Processor<span class="_ _10"> </span>Architecture</span></div><div class="t m5 x15 ha0 y44e2 ff50 fs62 fc1 sc0 ls1f7 ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x16f ha0 y44e3 ff50 fs62 fc1 sc0 ls1ff ws0">FDE<span class="_ _3"></span>M<span class="_ _4"></span>W</div><div class="t m5 x40 ha0 y44e4 ff50 fs62 fc1 sc0 ls1f9 ws0">FD</div><div class="t m5 x3a ha0 y44e5 ff50 fs62 fc1 sc0 ls0 ws0">E</div><div class="t m5 x205 ha0 y44e6 ff50 fs62 fc1 sc0 ls1f7 ws0">FD</div><div class="t m5 x18a ha0 y44e7 ff50 fs62 fc1 sc0 ls0 ws0">E</div><div class="t m5 x3a ha0 y44e8 ff50 fs62 fc1 sc0 ls1f9 ws0">FD</div><div class="t m5 x147 ha0 y44e9 ff50 fs62 fc1 sc0 ls0 ws0">E</div><div class="t m5 x22f ha0 y44e4 ff50 fs62 fc1 sc0 ls200 ws0">MW<span class="_ _1"></span>WW<span class="_ _7b"> </span>W</div><div class="t m5 x1d h9e y44ea ff4a fs63 fc1 sc0 ls0 ws0">0x000: irmovq $1,%rax</div><div class="t m5 x1d h9e y44eb ff4a fs63 fc1 sc0 ls0 ws0">0x00a: xorq %rsp,%rsp #CC = 100</div><div class="t m5 x1d h9e y44ec ff4a fs63 fc1 sc0 ls0 ws0">0x00c: pushq %rax</div><div class="t m5 x1d h9e y44ed ff4a fs63 fc1 sc0 ls0 ws0">0x00e: addq %rax,%rax</div><div class="t m5 x1d h9e y44ee ff4a fs63 fc1 sc0 ls0 ws0">0x010: irmovq $2,%rax</div><div class="t m5 x1d h9e y44ef ff4a fs63 fc1 sc0 ls0 ws0"># prog10</div><div class="c x1d y44f0 w12 hc9"><div class="t m5 x0 h9e y44f1 ff4a fs63 fc3 sc1 ls0 ws0"># prog10</div></div><div class="t m5 x200 ha1 y44f2 ff50 fs64 fc6 sc0 ls1cf ws0">12345</div><div class="t m5 x54 ha1 y44f3 ff50 fs64 fc6 sc0 ls0 ws0">6</div><div class="t m5 x1bd ha1 y44f4 ff50 fs64 fc6 sc0 ls0 ws0">7</div><div class="t m5 x103 ha1 y44f5 ff50 fs64 fc6 sc0 ls0 ws0">8</div><div class="t m5 x104 ha1 y44f6 ff50 fs64 fc6 sc0 ls1d0 ws0">91<span class="_ _184"></span>0</div><div class="t m5 x61 ha0 y44f7 ff50 fs62 fc1 sc0 ls0 ws0">. . .</div><div class="t m5 x2b ha0 y44f8 ff50 fs62 fc1 sc0 ls0 ws0">Cycle 6</div><div class="t m5 x19d ha0 y44f9 ff50 fs62 fc1 sc0 ls0 ws0">mem_error = 1</div><div class="t m5 x1bd ha0 y44fa ff50 fs62 fc1 sc0 ls0 ws0">set_cc <span class="ff23">←</span> 0</div><div class="t m5 x18a ha0 y44fb ff50 fs62 fc1 sc0 ls0 ws0">M</div><div class="t m5 x19d ha0 y44fc ff50 fs62 fc1 sc0 ls0 ws0">New CC = 000</div><div class="t m5 x54 ha0 y44fd ff50 fs62 fc1 sc0 ls0 ws0">E</div><div class="t m5 x1d h34 y44fe ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>4.63<span class="_ _66"> </span><span class="fc1">Processing<span class="_"> </span>invalid<span class="_"> </span>memory<span class="_"> </span>reference<span class="_ _10"> </span>exception.<span class="_ _13"> </span><span class="ff6">On<span class="_ _10"> </span>cycle<span class="_ _10"> </span>6,<span class="_ _11"> </span>the<span class="_ _10"> </span>invalid</span></span></div><div class="t m5 x1d h34 y44ff ff6 fs16 fc1 sc0 ls0 ws0">memory<span class="_ _10"> </span>reference<span class="_ _10"> </span>by<span class="_ _11"> </span>the</div><div class="t m5 x125 h3a y4500 ffd fs19 fc1 sc0 ls0 ws0">pushq<span class="_ _10"> </span><span class="ff6 fs16">instruction<span class="_ _10"> </span>causes<span class="_ _10"> </span>the<span class="_ _10"> </span>updating<span class="_ _11"> </span>of<span class="_ _10"> </span>the<span class="_ _10"> </span>condition<span class="_ _10"> </span>codes</span></div><div class="t m5 x1d h34 y4501 ff6 fs16 fc1 sc0 ls0 ws0">to<span class="_ _10"> </span>be<span class="_ _11"> </span>disabled.<span class="_ _11"> </span>The<span class="_ _10"> </span>pipeline<span class="_ _11"> </span>starts<span class="_ _10"> </span>injecting<span class="_ _11"> </span>bubbles<span class="_ _11"> </span>into<span class="_ _10"> </span>the<span class="_ _11"> </span>memory<span class="_ _11"> </span>stage<span class="_ _11"> </span>and<span class="_ _10"> </span>stalling</div><div class="t m5 x1d h34 y4502 ff6 fs16 fc1 sc0 ls0 ws0">the<span class="_ _10"> </span>excepting<span class="_ _11"> </span>instruction<span class="_ _10"> </span>in<span class="_ _10"> </span>the<span class="_ _11"> </span>write-back<span class="_ _10"> </span>stage.</div><div class="t m5 x1d h31 y4503 ff7 fs21 fc2 sc0 ls0 ws0">Condition<span class="_ _115"> </span>T<span class="_ _3"></span>rigger</div><div class="t m5 x1d h32 y4504 ff7 fs21 fc2 sc0 ls0 ws0">Processing<span class="_"> </span><span class="ffd fs1e">ret<span class="_ _ed"> </span></span><span class="ff6">IRET<span class="_ _10"> </span><span class="ff12 ls69">∈{<span class="_ _80"></span><span class="ff6 ls0">D<span class="_ _16"> </span>icode<span class="ff11">,<span class="_ _13"> </span></span>E</span></span></span></div><div class="t m5 x1d9 h32 y4505 ff6 fs21 fc2 sc0 ls0 ws0">icode<span class="ff11">,<span class="_ _13"> </span></span>M<span class="_ _11"> </span>icode<span class="ff12">}</span></div><div class="t m5 x1d h31 y4506 ff7 fs21 fc2 sc0 ls0 ws0">Load/use<span class="_"> </span>hazard<span class="_ _e2"> </span><span class="ff6">E</span></div><div class="t m5 xfa h32 y4507 ff6 fs21 fc2 sc0 ls0 ws0">icode<span class="_ _13"> </span><span class="ff12 ls69">∈{<span class="_ _80"></span><span class="ff6 ls0">IMRMOVQ<span class="_ _2"></span><span class="ff11">,<span class="_ _13"> </span></span>IPOPQ<span class="_ _2"></span><span class="ff12">}<span class="_ _13"></span><span class="ffd fs1e">&amp;&amp;<span class="_ _13"> </span></span></span>E<span class="_ _16"> </span>dstM<span class="_ _13"> </span><span class="ff12 ls69">∈{<span class="_ _4a"></span><span class="ff6 ls0">d<span class="_ _16"> </span>srcA<span class="ff11">,<span class="_ _13"> </span></span>d<span class="_ _16"> </span>srcB<span class="_ _1"></span><span class="ff12">}</span></span></span></span></span></div><div class="t m5 x1d h31 y4508 ff7 fs21 fc2 sc0 ls0 ws0">Mispredicted<span class="_"> </span>branch<span class="_ _26"> </span><span class="ff6">E</span></div><div class="t m5 xfa h32 y4509 ff6 fs21 fc2 sc0 ls0 ws0">icode<span class="_ _13"> </span><span class="ff12">=<span class="_ _13"> </span></span>IJXX<span class="_ _13"> </span><span class="ffd fs1e">&amp;&amp;<span class="_ _13"> </span>!</span>e<span class="_ _14"> </span>Cnd</div><div class="t m5 x1d h31 y450a ff7 fs21 fc2 sc0 ls0 ws0">Exception<span class="_ _44"> </span><span class="ff6">m</span></div><div class="t m5 x16d h32 y450b ff6 fs21 fc2 sc0 ls0 ws0">stat<span class="_ _10"> </span><span class="ff12 ls69">∈{<span class="_ _80"></span><span class="ff6 ls0">SADR<span class="ff11">,<span class="_ _10"> </span></span>SINS<span class="_ _1"></span><span class="ff11">,<span class="_ _13"> </span><span class="ff6">SHLT<span class="ff12">}<span class="_ _13"> </span><span class="ffd fs1e">||<span class="_ _13"> </span></span></span>W<span class="_ _15"> </span>stat<span class="_ _10"> </span><span class="ff12 ls69">∈{<span class="_ _80"></span><span class="ff6 ls0">SADR<span class="_ _2"></span><span class="ff11">,<span class="_ _13"> </span></span>SINS<span class="_ _0"></span><span class="ff11">,<span class="_ _13"> </span><span class="ff6">SHL<span class="_ _0"></span>T<span class="ff12">}</span></span></span></span></span></span></span></span></span></div><div class="t m5 x1d h34 y450c ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _13"> </span>4.64<span class="_ _c"> </span><span class="fc1">Detection<span class="_ _13"> </span>conditions<span class="_ _13"> </span>for<span class="_ _13"> </span>pipeline<span class="_ _13"> </span>control<span class="_ _13"> </span>logic.<span class="_ _13"> </span><span class="ff6">Four<span class="_ _13"> </span>different<span class="_ _13"> </span>conditions</span></span></div><div class="t m5 x1d h34 y450d ff6 fs16 fc1 sc0 ls0 ws0">require<span class="_ _16"> </span>altering<span class="_ _14"> </span>the<span class="_ _16"> </span>pipeline<span class="_ _14"> </span>ﬂow<span class="_ _16"> </span>by<span class="_ _14"> </span>either<span class="_ _16"> </span>stalling<span class="_ _14"> </span>the<span class="_ _14"> </span>pipeline<span class="_ _16"> </span>or<span class="_ _14"> </span>canceling<span class="_ _16"> </span>partially</div><div class="t m5 x1d h34 y450e ff6 fs16 fc1 sc0 ls0 ws0">executed<span class="_ _10"> </span>instructions.</div><div class="t m5 x1d h26 y450f ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>hese<span class="_"> </span>expressions<span class="_ _11"> </span>are<span class="_"> </span>implemented<span class="_"> </span>by<span class="_"> </span>simple<span class="_"> </span>blocks<span class="_ _11"> </span>of<span class="_"> </span>combinational<span class="_"> </span>logic<span class="_"> </span>that</div><div class="t m5 x1d h26 y4510 ff7 fs19 fc1 sc0 ls0 ws0">must<span class="_ _16"> </span>generate<span class="_ _11"> </span>their<span class="_ _16"> </span>results<span class="_ _16"> </span>before<span class="_ _11"> </span>the<span class="_ _16"> </span>end<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span>clock<span class="_ _16"> </span>cycle<span class="_ _11"> </span>in<span class="_ _16"> </span>order<span class="_ _16"> </span>to<span class="_ _11"> </span>control</div><div class="t m5 x1d h26 y4511 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _13"> </span>action<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>pipeline<span class="_ _13"> </span>registers<span class="_"> </span>as<span class="_ _13"> </span>the<span class="_ _13"> </span>clock<span class="_"> </span>rises<span class="_ _13"> </span>to<span class="_ _13"> </span>start<span class="_ _13"> </span>the<span class="_"> </span>next<span class="_ _13"> </span>cycle<span class="_ _1"></span>.<span class="_ _13"> </span>During</div><div class="t m5 x1d h26 y4512 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_ _14"> </span>clock<span class="_ _16"> </span>cycle<span class="_ _1"></span>,<span class="_ _15"> </span>pipeline<span class="_ _14"> </span>registers<span class="_ _14"> </span>D<span class="_ _3"></span>,<span class="_ _15"> </span>E,<span class="_ _15"> </span>and<span class="_ _16"> </span>M<span class="_ _14"> </span>hold<span class="_ _14"> </span>the<span class="_ _14"> </span>states<span class="_ _14"> </span>of<span class="_ _14"> </span>the<span class="_ _14"> </span>instructions</div><div class="t m5 x1d h26 y4513 ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_ _21"> </span>are<span class="_ _21"> </span>in<span class="_ _21"> </span>the<span class="_ _21"> </span>decode<span class="_ _1"></span>,<span class="_ _e"> </span>execute<span class="_ _1"></span>,<span class="_ _f"> </span>and<span class="_ _21"> </span>memory<span class="_ _21"> </span>pipeline<span class="_ _21"> </span>stages<span class="_ _1"></span>,<span class="_ _e"> </span>respectively<span class="_ _7"></span>.<span class="_ _21"> </span>As</div><div class="t m5 x1d h26 y4514 ff7 fs19 fc1 sc0 ls0 ws0">we<span class="_ _16"> </span>approach<span class="_ _11"> </span>the<span class="_ _16"> </span>end<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span>clock<span class="_ _16"> </span>cycle<span class="_ _1"></span>,<span class="_ _16"> </span>signals<span class="_ _16"> </span><span class="ff6">d_srcA<span class="_ _11"> </span></span>and<span class="_ _16"> </span><span class="ff6">d_srcB<span class="_ _16"> </span></span>will<span class="_ _11"> </span>be<span class="_ _16"> </span>set<span class="_ _16"> </span>to</div><div class="t m5 x1d h26 y4515 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _16"> </span>register<span class="_ _14"> </span>IDs<span class="_ _16"> </span>of<span class="_ _14"> </span>the<span class="_ _16"> </span>source<span class="_ _14"> </span>operands<span class="_ _16"> </span>for<span class="_ _14"> </span>the<span class="_ _16"> </span>instruction<span class="_ _14"> </span>in<span class="_ _14"> </span>the<span class="_ _16"> </span>decode<span class="_ _14"> </span>stage<span class="_ _1"></span>.</div><div class="t m5 x1d h26 y4516 ff7 fs19 fc1 sc0 ls0 ws0">Detecting<span class="_ _f"> </span>a<span class="_ _e"> </span><span class="ffd">ret<span class="_ _21"> </span></span>instruction<span class="_ _e"> </span>as<span class="_ _21"> </span>it<span class="_ _e"> </span>passes<span class="_ _21"> </span>through<span class="_ _e"> </span>the<span class="_ _f"> </span>pipeline<span class="_ _f"> </span>simply<span class="_ _e"> </span>involves</div><div class="t m5 x1d h26 y4517 ff7 fs19 fc1 sc0 ls0 ws0">checking<span class="_ _15"> </span>the<span class="_ _21"> </span>instruction<span class="_ _21"> </span>codes<span class="_ _21"> </span>of<span class="_ _21"> </span>the<span class="_ _15"> </span>instructions<span class="_ _21"> </span>in<span class="_ _21"> </span>the<span class="_ _21"> </span>decode<span class="_ _0"></span>,<span class="_ _f"> </span>execute<span class="_ _0"></span>,<span class="_ _f"> </span>and</div><div class="t m5 x1d h26 y4518 ff7 fs19 fc1 sc0 ls0 ws0">memory<span class="_ _21"> </span>stages<span class="_ _1"></span>.<span class="_ _21"> </span>Detecting<span class="_ _21"> </span>a<span class="_ _21"> </span>load/use<span class="_ _21"> </span>hazard<span class="_ _21"> </span>involves<span class="_ _21"> </span>checking<span class="_ _21"> </span>the<span class="_ _21"> </span>instruction</div><div class="t m5 x1d h26 y4519 ff7 fs19 fc1 sc0 ls0 ws0">type<span class="_ _16"> </span>(<span class="ffd">mrmovq<span class="_ _11"> </span></span>or<span class="_ _16"> </span><span class="ffd">popq</span>)<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>instruction<span class="_ _11"> </span>in<span class="_ _16"> </span>the<span class="_ _16"> </span>execute<span class="_ _16"> </span>stage<span class="_ _16"> </span>and<span class="_ _11"> </span>comparing<span class="_ _16"> </span>its</div><div class="t m5 x1d h26 y451a ff7 fs19 fc1 sc0 ls0 ws0">destination<span class="_ _13"> </span>register<span class="_ _6"> </span>with<span class="_ _13"> </span>the<span class="_ _13"> </span>source<span class="_ _6"> </span>registers<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _6"> </span>instruction<span class="_ _13"> </span>in<span class="_ _13"> </span>the<span class="_ _6"> </span>decode<span class="_ _13"> </span>stage<span class="_ _1"></span>.</div><div class="t m5 x1d h26 y451b ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _14"> </span>pipeline<span class="_ _14"> </span>control<span class="_ _15"> </span>logic<span class="_ _14"> </span>should<span class="_ _14"> </span>detect<span class="_ _14"> </span>a<span class="_ _14"> </span>mispredicted<span class="_ _14"> </span>branch<span class="_ _14"> </span>while<span class="_ _14"> </span>the<span class="_ _14"> </span>jump</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
