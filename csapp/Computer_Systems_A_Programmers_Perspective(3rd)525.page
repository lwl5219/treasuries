<div id="pf20d" class="pf w2 h11" data-page-no="20d"><div class="pc pc20d w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg20d.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">524<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>4<span class="_ _3d"> </span>Processor<span class="_ _10"> </span>Architecture</span></div><div class="t m5 x1d h28 y9c ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>4.20<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>443)</span></div><div class="t m5 x1d h26 y1d16 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>code<span class="_"> </span>is<span class="_"> </span>similar<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>code<span class="_"> </span>for<span class="_"> </span><span class="ff6">srcA</span>.</div><div class="t m5 x1d h2d y48ac ffd fs1e fc2 sc0 ls0 ws0">word<span class="_ _e"> </span>srcB<span class="_ _1f"> </span>=<span class="_ _1f"> </span>[</div><div class="t m5 x22b h2d y48ad ffd fs1e fc2 sc0 ls0 ws0">icode<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _1f"> </span>IOPQ,<span class="_ _e"> </span>IRMMOVQ,<span class="_ _1f"> </span>IMRMOVQ<span class="_ _1a"> </span>}<span class="_ _e"> </span>:<span class="_ _1f"> </span>rB;</div><div class="t m5 x22b h2d y48ae ffd fs1e fc2 sc0 ls0 ws0">icode<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _1f"> </span>IPUSHQ,<span class="_ _e"> </span>IPOPQ,<span class="_ _1f"> </span>ICALL,<span class="_ _e"> </span>IRET<span class="_ _1f"> </span>}<span class="_ _1f"> </span>:<span class="_ _e"> </span>RRSP;</div><div class="t m5 x22b h2d y48af ffd fs1e fc2 sc0 ls0 ws0">1<span class="_ _e"> </span>:<span class="_ _1f"> </span>RNONE;<span class="_ _1a"> </span>#<span class="_ _1f"> </span>Don’t<span class="_ _e"> </span>need<span class="_ _1f"> </span>register</div><div class="t m5 x1d h2d y48b0 ffd fs1e fc2 sc0 ls0 ws0">];</div><div class="t m5 x1d h28 y48b1 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>4.21</div><div class="t m5 xe1 h2f y48b2 ffe fs16 fc6 sc0 ls0 ws0">(page<span class="_"> </span>444)</div><div class="t m5 x1d h26 y48b3 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>code<span class="_"> </span>is<span class="_"> </span>similar<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>code<span class="_"> </span>for<span class="_"> </span><span class="ff6">dstE</span>.</div><div class="t m5 x1d h2d y48b4 ffd fs1e fc2 sc0 ls0 ws0">word<span class="_ _e"> </span>dstM<span class="_ _1f"> </span>=<span class="_ _1f"> </span>[</div><div class="t m5 x22b h2d y48b5 ffd fs1e fc2 sc0 ls0 ws0">icode<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _1f"> </span>IMRMOVQ,<span class="_ _e"> </span>IPOP<span class="ls33">Q}:r<span class="_ _41"></span>A<span class="_ _41"></span>;</span></div><div class="t m5 x22b h2d y48b6 ffd fs1e fc2 sc0 ls0 ws0">1<span class="_ _e"> </span>:<span class="_ _1f"> </span>RNONE;<span class="_ _1a"> </span>#<span class="_ _1f"> </span>Don’t<span class="_ _e"> </span>write<span class="_ _1f"> </span>any<span class="_ _e"> </span>register</div><div class="t m5 x1d h2d y48b7 ffd fs1e fc2 sc0 ls0 ws0">];</div><div class="t m5 x1d h28 y48b8 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>4.22</div><div class="t m5 xe1 h2f y48b9 ffe fs16 fc6 sc0 ls0 ws0">(page<span class="_"> </span>444)</div><div class="t m5 x1d h26 y48ba ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_ _11"> </span>we<span class="_ _11"> </span>found<span class="_ _16"> </span>in<span class="_"> </span>Practice<span class="_ _16"> </span>Problem<span class="_ _11"> </span>4.16,<span class="_ _11"> </span>we<span class="_ _16"> </span>want<span class="_"> </span>the<span class="_ _16"> </span>write<span class="_ _11"> </span>via<span class="_ _11"> </span>the<span class="_ _11"> </span>M<span class="_ _16"> </span>port<span class="_"> </span>to<span class="_ _16"> </span>take</div><div class="t m5 x1d h26 y48bb ff7 fs19 fc1 sc0 ls0 ws0">priority<span class="_ _13"> </span>over<span class="_ _13"> </span>the<span class="_ _13"> </span>write<span class="_ _6"> </span>via<span class="_ _13"> </span>the<span class="_ _13"> </span>E<span class="_ _13"> </span>port<span class="_ _13"> </span>in<span class="_ _13"> </span>order<span class="_ _6"> </span>to<span class="_ _13"> </span>store<span class="_ _13"> </span>the<span class="_ _13"> </span>value<span class="_ _13"> </span>read<span class="_ _13"> </span>from<span class="_ _6"> </span>memory</div><div class="t m5 x1d h26 y48bc ff7 fs19 fc1 sc0 ls0 ws0">into<span class="_"> </span><span class="ffd">%rsp</span>.</div><div class="t m5 x1d h28 y48bd ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>4.23<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>445)</span></div><div class="t m5 x1d h26 y48be ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>code<span class="_"> </span>is<span class="_"> </span>similar<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>code<span class="_"> </span>for<span class="_"> </span><span class="ff6">aluA</span>.</div><div class="t m5 x1d h2d y48bf ffd fs1e fc2 sc0 ls0 ws0">word<span class="_ _e"> </span>aluB<span class="_ _1f"> </span>=<span class="_ _1f"> </span>[</div><div class="t m5 x22b h2d y48c0 ffd fs1e fc2 sc0 ls0 ws0">icode<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _1f"> </span>IRMMOVQ,<span class="_ _e"> </span>IMRMOVQ,<span class="_ _1f"> </span>IOPQ,<span class="_ _e"> </span>ICALL,</div><div class="t m5 xbe h2d y48c1 ffd fs1e fc2 sc0 ls0 ws0">IPUSHQ,<span class="_ _e"> </span>IRET,<span class="_ _1f"> </span>IPOPQ<span class="_ _1f"> </span>}<span class="_ _e"> </span>:<span class="_ _1f"> </span>valB;</div><div class="t m5 x22b h2d y48c2 ffd fs1e fc2 sc0 ls0 ws0">icode<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _1f"> </span>IRRMOVQ,<span class="_ _e"> </span>IIRMOV<span class="ls33">Q}:0<span class="_ _41"></span>;</span></div><div class="t m5 x22b h2d y48c3 ffd fs1e fc2 sc0 ls0 ws0">#<span class="_ _e"> </span>Other<span class="_ _1f"> </span>instructions<span class="_ _1f"> </span>don’t<span class="_ _e"> </span>need<span class="_ _1f"> </span>ALU</div><div class="t m5 x1d h2d y48c4 ffd fs1e fc2 sc0 ls0 ws0">];</div><div class="t m5 x1d h28 y48c5 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>4.24</div><div class="t m5 xe1 h2f y48c6 ffe fs16 fc6 sc0 ls0 ws0">(page<span class="_"> </span>445)</div><div class="t m5 x1d h26 y48c7 ff7 fs19 fc1 sc0 ls0 ws0">Implementing<span class="_"> </span>conditional<span class="_"> </span>moves<span class="_ _11"> </span>is<span class="_"> </span>surprisingly<span class="_"> </span>simple:<span class="_ _11"> </span>we<span class="_"> </span>disable<span class="_ _11"> </span>writing<span class="_"> </span>to<span class="_"> </span>the</div><div class="t m5 x1d h26 y48c8 ff7 fs19 fc1 sc0 ls0 ws0">register<span class="_ _11"> </span>ﬁle<span class="_ _11"> </span>by<span class="_ _11"> </span>setting<span class="_ _11"> </span>the<span class="_ _16"> </span>destination<span class="_"> </span>register<span class="_ _16"> </span>to<span class="_"> </span><span class="ffd">RNONE<span class="_ _16"> </span></span>when<span class="_"> </span>the<span class="_ _16"> </span>condition<span class="_"> </span>does</div><div class="t m5 x1d h26 y48c9 ff7 fs19 fc1 sc0 ls0 ws0">not<span class="_"> </span>hold.</div><div class="t m5 x1d h2d y48ca ffd fs1e fc2 sc0 ls0 ws0">word<span class="_ _e"> </span>dstE<span class="_ _1f"> </span>=<span class="_ _1f"> </span>[</div><div class="t m5 x22b h2d y48cb ffd fs1e fc2 sc0 ls0 ws0">icode<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _1f"> </span>IRRMOVQ<span class="_ _e"> </span>}<span class="_ _1f"> </span>&amp;&amp;<span class="_ _e"> </span>Cnd<span class="_ _1f"> </span>:<span class="_ _1f"> </span>rB;</div><div class="t m5 x22b h2d y48cc ffd fs1e fc2 sc0 ls0 ws0">icode<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _1f"> </span>IIRMOVQ,<span class="_ _e"> </span>IOPQ}<span class="_ _1f"> </span>:<span class="_ _e"> </span>rB;</div><div class="t m5 x22b h2d y48cd ffd fs1e fc2 sc0 ls0 ws0">icode<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _1f"> </span>IPUSHQ,<span class="_ _e"> </span>IPOPQ,<span class="_ _1f"> </span>ICALL,<span class="_ _e"> </span>IRET<span class="_ _1f"> </span>}<span class="_ _1f"> </span>:<span class="_ _e"> </span>RRSP;</div><div class="t m5 x22b h2d y48ce ffd fs1e fc2 sc0 ls0 ws0">1<span class="_ _e"> </span>:<span class="_ _1f"> </span>RNONE;<span class="_ _1a"> </span>#<span class="_ _1f"> </span>Don’t<span class="_ _e"> </span>write<span class="_ _1f"> </span>any<span class="_ _e"> </span>register</div><div class="t m5 x1d h2d y48cf ffd fs1e fc2 sc0 ls0 ws0">];</div><div class="t m5 x1d h28 y48d0 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>4.25</div><div class="t m5 xe1 h2f y48d1 ffe fs16 fc6 sc0 ls0 ws0">(page<span class="_"> </span>446)</div><div class="t m5 x1d h26 yd7a ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>code<span class="_"> </span>is<span class="_"> </span>similar<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>code<span class="_"> </span>for<span class="_"> </span><span class="ff6">mem_addr</span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
