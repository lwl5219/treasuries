<div id="pf32a" class="pf w2 h11" data-page-no="32a"><div class="pc pc32a w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg32a.png"/><div class="t m5 x1e0 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>8.5<span class="_ _60"> </span>Signals<span class="_ _3e"> </span><span class="ffe fs1e">809</span></div><div class="t m5 x12f h2c y27f ffa fs16 fc2 sc0 ls0 ws0">code/ecf/signal2.c</div><div class="t m5 x2c h2d y280 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">void<span class="_ _1f"> </span>handler2(int<span class="_ _e"> </span>sig)</span></div><div class="t m5 x2c h2d y281 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x2c h2d y283 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2">int<span class="_ _e"> </span>olderrno<span class="_ _1f"> </span>=<span class="_ _1f"> </span>errno;</span></div><div class="t m5 x2c h2e y284 ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 x2c h2e y69c3 ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x142 h2d y285 ffd fs1e fc2 sc0 ls0 ws0">while<span class="_ _e"> </span>(waitpid(-1,<span class="_ _1f"> </span>NULL,<span class="_ _1f"> </span>0)<span class="_ _e"> </span>&gt;<span class="_ _1f"> </span>0)<span class="_ _e"> </span>{</div><div class="t m5 x2c h2d y286 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _70"> </span><span class="ffd fs1e fc2">Sio_puts(&quot;Handler<span class="_ _e"> </span>reaped<span class="_ _1f"> </span>child\n&quot;);</span></div><div class="t m5 x2c h2d y287 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x2c h2d y4493 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _20"> </span><span class="ffd fs1e fc2">if<span class="_ _e"> </span>(errno<span class="_ _1f"> </span>!=<span class="_ _1f"> </span>ECHILD)</span></div><div class="t m5 x2c h2d y4a9a ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _70"> </span><span class="ffd fs1e fc2">Sio_error(&quot;waitpid<span class="_ _e"> </span>error&quot;);</span></div><div class="t m5 x17 h2d y4a9b ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _20"> </span><span class="ffd fs1e fc2">Sleep(1);</span></div><div class="t m5 x17 h2d y4a9c ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _20"> </span><span class="ffd fs1e fc2">errno<span class="_ _e"> </span>=<span class="_ _1f"> </span>olderrno;</span></div><div class="t m5 x17 h2d y906 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x12f h2c y69c4 ffa fs16 fc2 sc0 ls0 ws0">code/ecf/signal2.c</div><div class="t m5 x17 h2f y69c5 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>8.37</div><div class="t m5 x156 h3a y69c6 ffd fs19 fc1 sc0 ls0 ws0">signal2<span class="ffe fs16">.<span class="_"> </span><span class="ff6">An<span class="_ _11"> </span>improved<span class="_ _11"> </span>version<span class="_ _11"> </span>of<span class="_ _11"> </span>Figure<span class="_ _11"> </span>8.36<span class="_ _11"> </span>that<span class="_ _11"> </span>correctly<span class="_ _11"> </span>accounts<span class="_ _11"> </span>for</span></span></div><div class="t m5 x17 h34 y69c7 ff6 fs16 fc1 sc0 ls0 ws0">the<span class="_ _10"> </span>fact<span class="_ _11"> </span>that<span class="_ _10"> </span>signals<span class="_ _10"> </span>are<span class="_ _11"> </span>not<span class="_ _10"> </span>queued.</div><div class="t m5 x17 h26 y69c8 ff7 fs19 fc1 sc0 ls0 ws0">as<span class="_ _13"> </span>many<span class="_ _13"> </span>zombie<span class="_ _13"> </span>children<span class="_ _13"> </span>as<span class="_"> </span>possible<span class="_ _13"> </span>each<span class="_ _13"> </span>time<span class="_ _13"> </span>it<span class="_ _13"> </span>is<span class="_ _13"> </span>invoked.<span class="_ _13"> </span>Figure<span class="_ _13"> </span>8.37<span class="_ _13"> </span>shows<span class="_ _13"> </span>the</div><div class="t m5 x17 h26 y69c9 ff7 fs19 fc1 sc0 ls0 ws0">modiÔ¨Åed<span class="_"> </span>SIGCHLD<span class="_"> </span>handler.</div><div class="t m5 x26 h26 y69ca ff7 fs19 fc1 sc0 ls0 ws0">When<span class="_"> </span>we<span class="_"> </span>run<span class="_"> </span><span class="ffd">signal2<span class="_ _11"> </span></span>on<span class="_ _11"> </span>our<span class="_"> </span>Linux<span class="_ _11"> </span>system,<span class="_"> </span>it<span class="_ _11"> </span>now<span class="_"> </span>correctly<span class="_ _11"> </span>reaps<span class="_"> </span>all<span class="_ _11"> </span>of<span class="_"> </span>the</div><div class="t m5 x17 h26 y69cb ff7 fs19 fc1 sc0 ls0 ws0">zombie<span class="_"> </span>children:</div><div class="t m5 x17 h2d y69cc ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">./signal2</span></div><div class="t m5 x17 h2d y69cd ffd fs1e fc2 sc0 ls0 ws0">Hello<span class="_ _e"> </span>from<span class="_ _1f"> </span>child<span class="_ _1f"> </span>15237</div><div class="t m5 x17 h2d y69ce ffd fs1e fc2 sc0 ls0 ws0">Hello<span class="_ _e"> </span>from<span class="_ _1f"> </span>child<span class="_ _1f"> </span>15238</div><div class="t m5 x17 h2d y69cf ffd fs1e fc2 sc0 ls0 ws0">Hello<span class="_ _e"> </span>from<span class="_ _1f"> </span>child<span class="_ _1f"> </span>15239</div><div class="t m5 x17 h2d y69d0 ffd fs1e fc2 sc0 ls0 ws0">Handler<span class="_ _e"> </span>reaped<span class="_ _1f"> </span>child</div><div class="t m5 x17 h2d y69d1 ffd fs1e fc2 sc0 ls0 ws0">Handler<span class="_ _e"> </span>reaped<span class="_ _1f"> </span>child</div><div class="t m5 x17 h2d y69d2 ffd fs1e fc2 sc0 ls0 ws0">Handler<span class="_ _e"> </span>reaped<span class="_ _1f"> </span>child</div><div class="t m5 x17 h2d y69d3 ff13 fs1e fc2 sc0 ls0 ws0">CR</div><div class="t m5 x17 h2d y69d4 ffd fs1e fc2 sc0 ls0 ws0">Parent<span class="_ _e"> </span>processing<span class="_ _1f"> </span>input</div><div class="t m5 x17 h47 y69d5 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>8.8<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>835)</span></div><div class="t m5 x17 h26 y69d6 ff7 fs19 fc1 sc0 ls0 ws0">What<span class="_"> </span>is<span class="_"> </span>the<span class="_"> </span>output<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>program?</div><div class="t m5 xb0 h2c y69d7 ffa fs16 fc1 sc0 ls0 ws0">code/ecf/signalprob0.c</div><div class="t m5 x2c h2e y5b5 ff6 fs20 fc6 sc0 ls0 ws0">1</div><div class="t m5 x2d h2d y74e ffd fs1e fc2 sc0 ls0 ws0">volatile<span class="_ _e"> </span>long<span class="_ _1f"> </span>counter<span class="_ _1f"> </span>=<span class="_ _e"> </span>2;</div><div class="t m5 x2c h2e yc21 ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x2c h2e y69d8 ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x2d h2d y107b ffd fs1e fc2 sc0 ls0 ws0">void<span class="_ _e"> </span>handler1(int<span class="_ _1f"> </span>sig)</div><div class="t m5 x2c h2d y13c0 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x2c h2e y587 ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x142 h2d y832 ffd fs1e fc2 sc0 ls0 ws0">sigset_t<span class="_ _e"> </span>mask,<span class="_ _1f"> </span>prev_mask;</div><div class="t m5 x2c h2e y8d6 ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 x2c h2e ye94 ff6 fs20 fc6 sc0 ls0 ws0">7</div><div class="t m5 x142 h2d y77e ffd fs1e fc2 sc0 ls0 ws0">Sigfillset(&amp;mask);</div><div class="t m5 x2c h2d ye95 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _20"> </span><span class="ffd fs1e fc2">Sigprocmask(SIG_BLOCK,<span class="_ _e"> </span>&amp;mask,<span class="_ _1f"> </span>&amp;prev_mask);<span class="_ _1a"> </span>/*<span class="_ _1f"> </span>Block<span class="_ _e"> </span>sigs<span class="_ _1f"> </span>*/</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
