<div id="pf202" class="pf w2 h11" data-page-no="202"><div class="pc pc202 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg202.png"/><div class="t m5 x5f h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Homework<span class="_ _10"> </span>Problems<span class="_ _1b"> </span><span class="ffe fs1e">513</span></div><div class="t m5 x17 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">material<span class="_"> </span>for<span class="_"> </span>directions<span class="_"> </span>on<span class="_"> </span>how<span class="_"> </span>to<span class="_ _13"> </span>generate<span class="_"> </span>a<span class="_"> </span>simulator<span class="_"> </span>for<span class="_"> </span>your<span class="_"> </span>solution<span class="_"> </span>and<span class="_"> </span>how</div><div class="t m5 x17 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_"> </span>test<span class="_"> </span>it.</div><div class="t m5 x17 h73 y470e ffe fs1e fc6 sc0 ls0 ws0">4.55<span class="_ _23"> </span><span class="ff10 fs19">◆◆◆</span></div><div class="t m5 x17 h26 y470f ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _13"> </span>ﬁle<span class="_ _a"> </span><span class="ffd">pipe-nt.hcl<span class="_ _6"> </span></span>contains<span class="_ _13"> </span>a<span class="_ _a"> </span>copy<span class="_ _13"> </span>of<span class="_ _a"> </span>the<span class="_ _13"> </span>HCL<span class="_ _a"> </span>code<span class="_ _6"> </span>for<span class="_ _13"> </span>PIPE,<span class="_ _6"> </span>plus<span class="_ _6"> </span>a<span class="_ _13"> </span>declaration</div><div class="t m5 x17 h26 y4710 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_ _11"> </span>the<span class="_ _11"> </span>constant<span class="_ _11"> </span><span class="ffd">J_YES<span class="_ _11"> </span></span>with<span class="_ _11"> </span>value<span class="_ _11"> </span><span class="ffd">0</span>,<span class="_ _11"> </span>the<span class="_ _11"> </span>function<span class="_ _11"> </span>code<span class="_ _11"> </span>for<span class="_ _11"> </span>an<span class="_ _11"> </span>unconditional<span class="_ _11"> </span>jump</div><div class="t m5 x17 h26 y4711 ff7 fs19 fc1 sc0 ls0 ws0">instruction.<span class="_ _21"> </span>Modify<span class="_ _f"> </span>the<span class="_ _f"> </span>branch<span class="_ _f"> </span>prediction<span class="_ _f"> </span>logic<span class="_ _f"> </span>so<span class="_ _21"> </span>that<span class="_ _f"> </span>it<span class="_ _f"> </span>predicts<span class="_ _f"> </span>conditional</div><div class="t m5 x17 h26 y4712 ff7 fs19 fc1 sc0 ls0 ws0">jumps<span class="_ _14"> </span>as<span class="_ _14"> </span>being<span class="_ _15"> </span>not<span class="_ _14"> </span>taken<span class="_ _14"> </span>while<span class="_ _15"> </span>continuing<span class="_ _14"> </span>to<span class="_ _14"> </span>predict<span class="_ _15"> </span>unconditional<span class="_ _14"> </span>jumps<span class="_ _14"> </span>and</div><div class="t m5 x17 h26 y4713 ffd fs19 fc1 sc0 ls0 ws0">call<span class="_ _16"> </span><span class="ff7">as<span class="_ _11"> </span>being<span class="_ _16"> </span>taken.<span class="_ _16"> </span>Y<span class="_ _7"></span>ou<span class="_ _16"> </span>will<span class="_ _16"> </span>need<span class="_ _16"> </span>to<span class="_ _11"> </span>devise<span class="_ _16"> </span>a<span class="_ _16"> </span>way<span class="_ _11"> </span>to<span class="_ _16"> </span>get<span class="_ _16"> </span><span class="ff6">valC</span>,<span class="_ _16"> </span>the<span class="_ _16"> </span>jump<span class="_ _11"> </span>target</span></div><div class="t m5 x17 h26 y4714 ff7 fs19 fc1 sc0 ls0 ws0">address<span class="_ _1"></span>,<span class="_ _13"> </span>to<span class="_ _13"> </span>pipeline<span class="_ _13"> </span>register<span class="_"> </span>M<span class="_ _13"> </span>to<span class="_ _13"> </span>recover<span class="_ _13"> </span>from<span class="_ _13"> </span>mispredicted<span class="_ _13"> </span>branches<span class="_ _1"></span>.<span class="_ _13"> </span>See<span class="_ _13"> </span>the<span class="_ _13"> </span>lab</div><div class="t m5 x17 h26 y4715 ff7 fs19 fc1 sc0 ls0 ws0">material<span class="_"> </span>for<span class="_"> </span>directions<span class="_"> </span>on<span class="_"> </span>how<span class="_"> </span>to<span class="_ _13"> </span>generate<span class="_"> </span>a<span class="_"> </span>simulator<span class="_"> </span>for<span class="_"> </span>your<span class="_"> </span>solution<span class="_"> </span>and<span class="_"> </span>how</div><div class="t m5 x17 h26 y4716 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_"> </span>test<span class="_"> </span>it.</div><div class="t m5 x17 h73 y4717 ffe fs1e fc6 sc0 ls0 ws0">4.56<span class="_ _23"> </span><span class="ff10 fs19">◆◆◆</span></div><div class="t m5 x17 h26 y4718 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>ﬁle<span class="_ _13"> </span><span class="ffd">pipe-btfnt.hcl<span class="_ _13"> </span></span>contains<span class="_ _13"> </span>a<span class="_ _13"> </span>copy<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>HCL<span class="_ _13"> </span>code<span class="_"> </span>for<span class="_ _13"> </span>PIPE,<span class="_ _13"> </span>plus<span class="_ _13"> </span>a<span class="_"> </span>decla-</div><div class="t m5 x17 h26 y4719 ff7 fs19 fc1 sc0 ls0 ws0">ration<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>constant<span class="_"> </span><span class="ffd">J_YES<span class="_ _10"> </span></span>with<span class="_"> </span>value<span class="_"> </span><span class="ffd">0</span>,<span class="_"> </span>the<span class="_"> </span>function<span class="_"> </span>code<span class="_"> </span>for<span class="_"> </span>an<span class="_"> </span>unconditional</div><div class="t m5 x17 h26 y471a ff7 fs19 fc1 sc0 ls0 ws0">jump<span class="_ _15"> </span>instruction.<span class="_ _15"> </span>Modify<span class="_ _15"> </span>the<span class="_ _15"> </span>branch<span class="_ _15"> </span>prediction<span class="_ _15"> </span>logic<span class="_ _15"> </span>so<span class="_ _21"> </span>that<span class="_ _15"> </span>it<span class="_ _15"> </span>predicts<span class="_ _15"> </span>condi-</div><div class="t m5 x17 h26 y471b ff7 fs19 fc1 sc0 ls0 ws0">tional<span class="_ _14"> </span>jumps<span class="_ _14"> </span>as<span class="_ _14"> </span>being<span class="_ _14"> </span>taken<span class="_ _14"> </span>when<span class="_ _14"> </span><span class="ff6">valC<span class="_ _10"> </span><span class="ff11">&lt;<span class="_ _10"> </span></span>valP<span class="_ _16"> </span></span>(backward<span class="_ _14"> </span>branch)<span class="_ _14"> </span>and<span class="_ _14"> </span>as<span class="_ _14"> </span>being</div><div class="t m5 x17 h46 y471c ff7 fs19 fc1 sc0 ls0 ws0">not<span class="_ _14"> </span>taken<span class="_ _15"> </span>when<span class="_ _14"> </span><span class="ff6">valC<span class="_ _10"> </span><span class="ff12">≥<span class="_ _10"> </span></span>valP<span class="_ _14"> </span></span>(forward<span class="_ _14"> </span>branch).<span class="_ _15"> </span>(Since<span class="_ _14"> </span>Y86-64<span class="_ _15"> </span>does<span class="_ _14"> </span>not<span class="_ _15"> </span>support</div><div class="t m5 x17 h26 y471d ff7 fs19 fc1 sc0 ls0 ws0">unsigned<span class="_"> </span>arithmetic,<span class="_"> </span>you<span class="_ _11"> </span>should<span class="_ _11"> </span>implement<span class="_ _11"> </span>this<span class="_"> </span>test<span class="_ _11"> </span>using<span class="_ _11"> </span>a<span class="_ _11"> </span>signed<span class="_"> </span>comparison.)</div><div class="t m5 x17 h26 y471e ff7 fs19 fc1 sc0 ls0 ws0">Continue<span class="_"> </span>to<span class="_"> </span>predict<span class="_"> </span>unconditional<span class="_"> </span>jumps<span class="_"> </span>and<span class="_"> </span><span class="ffd">call<span class="_ _10"> </span></span>as<span class="_ _11"> </span>being<span class="_"> </span>taken.<span class="_"> </span>Y<span class="_ _3"></span>ou<span class="_"> </span>will<span class="_"> </span>need</div><div class="t m5 x17 h26 y471f ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _11"> </span>devise<span class="_ _11"> </span>a<span class="_ _16"> </span>way<span class="_"> </span>to<span class="_ _16"> </span>get<span class="_ _11"> </span>both<span class="_ _11"> </span><span class="ff6">valC<span class="_ _11"> </span></span>and<span class="_ _16"> </span><span class="ff6">valP<span class="_ _11"> </span></span>to<span class="_ _11"> </span>pipeline<span class="_ _11"> </span>register<span class="_ _11"> </span>M<span class="_ _16"> </span>to<span class="_ _11"> </span>recover<span class="_ _11"> </span>from</div><div class="t m5 x17 h26 y4720 ff7 fs19 fc1 sc0 ls0 ws0">mispredicted<span class="_ _11"> </span>branches<span class="_ _1"></span>.<span class="_ _16"> </span>See<span class="_ _11"> </span>the<span class="_ _16"> </span>lab<span class="_ _11"> </span>material<span class="_ _16"> </span>for<span class="_ _11"> </span>directions<span class="_ _16"> </span>on<span class="_ _11"> </span>how<span class="_ _16"> </span>to<span class="_ _11"> </span>generate<span class="_ _16"> </span>a</div><div class="t m5 x17 h26 y4721 ff7 fs19 fc1 sc0 ls0 ws0">simulator<span class="_"> </span>for<span class="_"> </span>your<span class="_"> </span>solution<span class="_"> </span>and<span class="_"> </span>how<span class="_"> </span>to<span class="_"> </span>test<span class="_"> </span>it.</div><div class="t m5 x17 h73 y4722 ffe fs1e fc6 sc0 ls0 ws0">4.57<span class="_ _23"> </span><span class="ff10 fs19">◆◆◆</span></div><div class="t m5 x17 h26 y4723 ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _11"> </span>our<span class="_ _16"> </span>design<span class="_ _11"> </span>of<span class="_ _16"> </span>PIPE,<span class="_ _16"> </span>we<span class="_ _11"> </span>generate<span class="_ _16"> </span>a<span class="_ _11"> </span>stall<span class="_ _16"> </span>whenever<span class="_ _16"> </span>one<span class="_ _11"> </span>instruction<span class="_ _16"> </span>performs<span class="_ _11"> </span>a</div><div class="t m5 x17 h26 y4724 ffa fs19 fc1 sc0 ls0 ws0">load<span class="ff7">,<span class="_ _13"> </span>reading<span class="_ _13"> </span>a<span class="_ _6"> </span>value<span class="_ _13"> </span>from<span class="_ _6"> </span>memory<span class="_ _13"> </span>into<span class="_ _13"> </span>a<span class="_ _6"> </span>register,<span class="_ _13"> </span>and<span class="_ _6"> </span>the<span class="_ _13"> </span>next<span class="_ _6"> </span>instruction<span class="_ _13"> </span>has<span class="_ _6"> </span>this</span></div><div class="t m5 x17 h26 y4725 ff7 fs19 fc1 sc0 ls0 ws0">register<span class="_"> </span>as<span class="_"> </span>a<span class="_ _13"> </span>source<span class="_"> </span>operand.<span class="_"> </span>When<span class="_ _13"> </span>the<span class="_"> </span>source<span class="_"> </span>gets<span class="_"> </span>used<span class="_ _13"> </span>in<span class="_"> </span>the<span class="_"> </span>execute<span class="_"> </span>stage<span class="_ _1"></span>,<span class="_"> </span>this</div><div class="t m5 x17 h26 y4726 ff7 fs19 fc1 sc0 ls0 ws0">stalling<span class="_"> </span>is<span class="_"> </span>the<span class="_"> </span>only<span class="_ _11"> </span>way<span class="_"> </span>to<span class="_"> </span>avoid<span class="_"> </span>a<span class="_ _11"> </span>hazard.<span class="_"> </span>F<span class="_ _1"></span>or<span class="_"> </span>cases<span class="_ _11"> </span>where<span class="_"> </span>the<span class="_"> </span>second<span class="_"> </span>instruction</div><div class="t m5 x17 h26 y4727 ff7 fs19 fc1 sc0 ls0 ws0">stores<span class="_ _13"> </span>the<span class="_ _6"> </span>source<span class="_ _13"> </span>operand<span class="_ _6"> </span>to<span class="_ _13"> </span>memory<span class="_ _7"></span>,<span class="_ _13"> </span>such<span class="_ _13"> </span>as<span class="_ _6"> </span>with<span class="_ _13"> </span>an<span class="_ _6"> </span><span class="ffd">rmmovq<span class="_ _13"> </span></span>or<span class="_ _13"> </span><span class="ffd">pushq<span class="_ _6"> </span></span>instruction,</div><div class="t m5 x17 h26 y4728 ff7 fs19 fc1 sc0 ls0 ws0">this<span class="_"> </span>stalling<span class="_"> </span>is<span class="_"> </span>not<span class="_"> </span>necessary<span class="_ _3"></span>.<span class="_"> </span>Consider<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>code<span class="_"> </span>examples:</div><div class="t m5 x2c h2d y4729 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _20"> </span><span class="ffd fs1e fc2">mrmovq<span class="_ _e"> </span>0(%rcx),%rdx<span class="_ _3f"> </span>#<span class="_ _1f"> </span>Load<span class="_ _1a"> </span>1</span></div><div class="t m5 x2c h2d y472a ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _20"> </span><span class="ffd fs1e fc2">pushq<span class="_ _1a"> </span>%rdx<span class="_ _192"> </span>#<span class="_ _1f"> </span>Store<span class="_ _e"> </span>1</span></div><div class="t m5 x2c h2d y472b ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2">nop</span></div><div class="t m5 x2c h2d y472c ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2">popq<span class="_ _e"> </span>%rdx<span class="_ _da"> </span>#<span class="_ _e"> </span>Load<span class="_ _1a"> </span>2</span></div><div class="t m5 x2c h2d y472d ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _20"> </span><span class="ffd fs1e fc2">rmmovq<span class="_ _e"> </span>%rax,0(%rdx)<span class="_ _3f"> </span>#<span class="_ _1f"> </span>Store<span class="_ _1f"> </span>2</span></div><div class="t m5 x26 h26 y211a ff7 fs19 fc2 sc0 ls0 ws0">In<span class="_ _21"> </span>lines<span class="_ _21"> </span>1<span class="_ _f"> </span>and<span class="_ _21"> </span>2,<span class="_ _e"> </span>the<span class="_ _21"> </span><span class="ffd">mrmovq<span class="_ _21"> </span></span>instruction<span class="_ _21"> </span>reads<span class="_ _f"> </span>a<span class="_ _21"> </span>value<span class="_ _f"> </span>from<span class="_ _21"> </span>memory<span class="_ _21"> </span>into</div><div class="t m5 x17 h26 y2237 ffd fs19 fc2 sc0 ls0 ws0">%rdx<span class="ff7">,<span class="_"> </span>and<span class="_ _13"> </span>the<span class="_"> </span></span>pushq<span class="_ _13"> </span><span class="ff7">instruction<span class="_"> </span>then<span class="_ _13"> </span>pushes<span class="_"> </span>this<span class="_ _13"> </span>value<span class="_"> </span>onto<span class="_"> </span>the<span class="_ _13"> </span>stack.<span class="_"> </span>Our<span class="_ _13"> </span>design</span></div><div class="t m5 x17 h26 y2238 ff7 fs19 fc2 sc0 ls0 ws0">for<span class="_ _11"> </span>PIPE<span class="_ _16"> </span>would<span class="_ _16"> </span>stall<span class="_ _11"> </span>the<span class="_ _16"> </span><span class="ffd">pushq<span class="_ _11"> </span></span>instruction<span class="_ _16"> </span>to<span class="_ _16"> </span>avoid<span class="_ _11"> </span>a<span class="_ _16"> </span>load/use<span class="_ _11"> </span>hazard.<span class="_ _16"> </span>Observe<span class="_ _0"></span>,</div><div class="t m5 x17 h26 y2239 ff7 fs19 fc2 sc0 ls0 ws0">however,<span class="_ _11"> </span>that<span class="_ _16"> </span>the<span class="_ _16"> </span>value<span class="_ _11"> </span>of<span class="_ _16"> </span><span class="ffd">%rdx<span class="_ _16"> </span></span>is<span class="_ _11"> </span>not<span class="_ _16"> </span>required<span class="_ _11"> </span>by<span class="_ _16"> </span>the<span class="_ _16"> </span><span class="ffd">pushq<span class="_ _11"> </span></span>instruction<span class="_ _16"> </span>until<span class="_ _16"> </span>it</div><div class="t m5 x17 h26 y223a ff7 fs19 fc2 sc0 ls0 ws0">reaches<span class="_ _13"> </span>the<span class="_"> </span>memory<span class="_ _13"> </span>stage.<span class="_ _13"> </span>W<span class="_ _3"></span>e<span class="_"> </span>can<span class="_ _13"> </span>add<span class="_"> </span>an<span class="_ _13"> </span>additional<span class="_"> </span>bypass<span class="_ _13"> </span>path,<span class="_"> </span>as<span class="_ _13"> </span>diagrammed</div><div class="t m5 x17 h26 yd16 ff7 fs19 fc2 sc0 ls0 ws0">in<span class="_ _16"> </span>F<span class="_ _1"></span>igure<span class="_ _16"> </span>4.70,<span class="_ _14"> </span>to<span class="_ _16"> </span>forward<span class="_ _16"> </span>the<span class="_ _16"> </span>memory<span class="_ _16"> </span>output<span class="_ _16"> </span>(signal<span class="_ _16"> </span><span class="ff6">m_valM</span><span class="ls203">)t<span class="_ _49"></span>ot<span class="_ _42"></span>h<span class="_ _42"></span>e<span class="ff6 ls0">valA<span class="_ _16"> </span><span class="ff7">ﬁeld</span></span></span></div><div class="t m5 x17 h26 yd17 ff7 fs19 fc2 sc0 ls0 ws0">in<span class="_"> </span>pipeline<span class="_ _11"> </span>register<span class="_ _11"> </span>M.<span class="_ _11"> </span>On<span class="_ _11"> </span>the<span class="_"> </span>next<span class="_ _11"> </span>clock<span class="_ _11"> </span>cycle<span class="_ _1"></span>,<span class="_ _11"> </span>this<span class="_ _11"> </span>forwarded<span class="_ _11"> </span>value<span class="_"> </span>can<span class="_ _11"> </span>then<span class="_ _11"> </span>be</div><div class="t m5 x17 h26 y223b ff7 fs19 fc2 sc0 ls0 ws0">written<span class="_"> </span>to<span class="_"> </span>memory<span class="_ _3"></span>.<span class="_"> </span>T<span class="_ _1"></span>his<span class="_"> </span>technique<span class="_"> </span>is<span class="_"> </span>known<span class="_"> </span>as<span class="_"> </span><span class="ffa">load<span class="_"> </span>forwarding<span class="_ _2"></span></span>.</div><div class="t m5 x26 h26 y223c ff7 fs19 fc2 sc0 ls0 ws0">Note<span class="_ _14"> </span>that<span class="_ _15"> </span>the<span class="_ _15"> </span>second<span class="_ _15"> </span>example<span class="_ _14"> </span>(lines<span class="_ _15"> </span>4<span class="_ _15"> </span>and<span class="_ _15"> </span>5)<span class="_ _14"> </span>in<span class="_ _15"> </span>the<span class="_ _15"> </span>code<span class="_ _15"> </span>sequence<span class="_ _14"> </span>above</div><div class="t m5 x17 h26 y23da ff7 fs19 fc2 sc0 ls0 ws0">cannot<span class="_"> </span>make<span class="_"> </span>use<span class="_ _11"> </span>of<span class="_"> </span>load<span class="_ _11"> </span>forwarding.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>value<span class="_ _11"> </span>loaded<span class="_"> </span>by<span class="_ _11"> </span>the<span class="_"> </span><span class="ffd">popq<span class="_ _11"> </span></span>instruction<span class="_"> </span>is</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
