<div id="pf223" class="pf w2 h11" data-page-no="223"><div class="pc pc223 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg223.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">546<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>5<span class="_ _3d"> </span>Optimizing<span class="_ _10"> </span>Program<span class="_ _10"> </span>Performance</span></div><div class="t m5 x1f h2d y3829 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">/*<span class="_ _1f"> </span>Convert<span class="_ _e"> </span>string<span class="_ _1f"> </span>to<span class="_ _1f"> </span>lowercase:<span class="_ _e"> </span>slow<span class="_ _1f"> </span>*/</span></div><div class="t m5 x1f h2d y3aa2 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">void<span class="_ _1f"> </span>lower1(char<span class="_ _e"> </span>*s)</span></div><div class="t m5 x1f h2d y3aa3 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x1f h2d y3aa4 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>i;</span></div><div class="t m5 x1f h2e y3aa5 ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x1f h2e y4af7 ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 x33 h2d y3aa6 ffd fs1e fc2 sc0 ls0 ws0">for<span class="_ _e"> </span>(i<span class="_ _1f"> </span>=<span class="_ _1f"> </span>0;<span class="_ _e"> </span>i<span class="_ _1f"> </span>&lt;<span class="_ _e"> </span>strlen(s);<span class="_ _1f"> </span>i++)</div><div class="t m5 x1f h2d y3aa7 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _70"> </span><span class="ffd fs1e fc2">if<span class="_ _e"> </span>(s[i]<span class="_ _1f"> </span>&gt;=<span class="_ _1f"> </span>’A’<span class="_ _e"> </span>&amp;&amp;<span class="_ _1f"> </span>s[i]<span class="_ _e"> </span>&lt;=<span class="_ _1f"> </span>’Z’)</span></div><div class="t m5 x1f h2d y3aa8 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _d1"> </span><span class="ffd fs1e fc2">s[i]<span class="_ _1f"> </span>-=<span class="_ _e"> </span>(’A’<span class="_ _1f"> </span>-<span class="_ _e"> </span>’a’);</span></div><div class="t m5 x1f h2d y3aa9 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1b0 h2e y3aaa ff6 fs20 fc6 sc0 ls0 ws0">10</div><div class="t m5 x1b0 h2e y4af8 ff6 fs20 fc6 sc0 ls0 ws0">11</div><div class="t m5 x4f h2d y3aab ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Convert<span class="_ _1f"> </span>string<span class="_ _1f"> </span>to<span class="_ _e"> </span>lowercase:<span class="_ _1f"> </span>faster<span class="_ _e"> </span>*/</div><div class="t m5 x1b0 h2d y3aac ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _1c"> </span><span class="ffd fs1e fc2">void<span class="_ _1f"> </span>lower2(char<span class="_ _e"> </span>*s)</span></div><div class="t m5 x1b0 h2d y3aad ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x1b0 h2d y3aae ff6 fs20 fc6 sc0 ls0 ws0">14<span class="_ _20"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>i;</span></div><div class="t m5 x1b0 h2d y4af9 ff6 fs20 fc6 sc0 ls0 ws0">15<span class="_ _20"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>len<span class="_ _1f"> </span>=<span class="_ _1f"> </span>strlen(s);</span></div><div class="t m5 x1b0 h2e y4afa ff6 fs20 fc6 sc0 ls0 ws0">16</div><div class="t m5 x1b0 h2e y4afb ff6 fs20 fc6 sc0 ls0 ws0">17</div><div class="t m5 x33 h2d y4afc ffd fs1e fc2 sc0 ls0 ws0">for<span class="_ _e"> </span>(i<span class="_ _1f"> </span>=<span class="_ _1f"> </span>0;<span class="_ _e"> </span>i<span class="_ _1f"> </span>&lt;<span class="_ _e"> </span>len;<span class="_ _1f"> </span>i++)</div><div class="t m5 x1b0 h2d y4afd ff6 fs20 fc6 sc0 ls0 ws0">18<span class="_ _70"> </span><span class="ffd fs1e fc2">if<span class="_ _e"> </span>(s[i]<span class="_ _1f"> </span>&gt;=<span class="_ _1f"> </span>’A’<span class="_ _e"> </span>&amp;&amp;<span class="_ _1f"> </span>s[i]<span class="_ _e"> </span>&lt;=<span class="_ _1f"> </span>’Z’)</span></div><div class="t m5 x1b0 h2d y4afe ff6 fs20 fc6 sc0 ls0 ws0">19<span class="_ _d1"> </span><span class="ffd fs1e fc2">s[i]<span class="_ _1f"> </span>-=<span class="_ _e"> </span>(’A’<span class="_ _1f"> </span>-<span class="_ _e"> </span>’a’);</span></div><div class="t m5 x1b0 h2d y4aff ff6 fs20 fc6 sc0 ls0 ws0">20<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1b0 h2e y4b00 ff6 fs20 fc6 sc0 ls0 ws0">21</div><div class="t m5 x1b0 h2e y4b01 ff6 fs20 fc6 sc0 ls0 ws0">22</div><div class="t m5 x4f h2d y4b02 ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Sample<span class="_ _1f"> </span>implementation<span class="_ _1f"> </span>of<span class="_ _e"> </span>library<span class="_ _1f"> </span>function<span class="_ _e"> </span>strlen<span class="_ _1f"> </span>*/</div><div class="t m5 x1b0 h2d y4b03 ff6 fs20 fc6 sc0 ls0 ws0">23<span class="_ _1c"> </span><span class="ffd fs1e fc2">/*<span class="_ _1f"> </span>Compute<span class="_ _e"> </span>length<span class="_ _1f"> </span>of<span class="_ _1f"> </span>string<span class="_ _e"> </span>*/</span></div><div class="t m5 x1b0 h2d y4b04 ff6 fs20 fc6 sc0 ls0 ws0">24<span class="_ _1c"> </span><span class="ffd fs1e fc2">size_t<span class="_ _1f"> </span>strlen(const<span class="_ _e"> </span>char<span class="_ _1f"> </span>*s)</span></div><div class="t m5 x1b0 h2d y4b05 ff6 fs20 fc6 sc0 ls0 ws0">25<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x1b0 h2d y4b06 ff6 fs20 fc6 sc0 ls0 ws0">26<span class="_ _20"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>length<span class="_ _1f"> </span>=<span class="_ _1f"> </span>0;</span></div><div class="t m5 x1b0 h2d y4b07 ff6 fs20 fc6 sc0 ls0 ws0">27<span class="_ _20"> </span><span class="ffd fs1e fc2">while<span class="_ _e"> </span>(*s<span class="_ _1f"> </span>!=<span class="_ _1f"> </span>’\0’)<span class="_ _e"> </span>{</span></div><div class="t m5 x1b0 h2d y4b08 ff6 fs20 fc6 sc0 ls0 ws0">28<span class="_ _70"> </span><span class="ffd fs1e fc2">s++;</span></div><div class="t m5 x1b0 h2d y4b09 ff6 fs20 fc6 sc0 ls0 ws0">29<span class="_ _70"> </span><span class="ffd fs1e fc2">length++;</span></div><div class="t m5 x1b0 h2d y4b0a ff6 fs20 fc6 sc0 ls0 ws0">30<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1b0 h2d y4b0b ff6 fs20 fc6 sc0 ls0 ws0">31<span class="_ _20"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>length;</span></div><div class="t m5 x1b0 h2d y4b0c ff6 fs20 fc6 sc0 ls0 ws0">32<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1d h34 y4b0d ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _6"> </span>5.7<span class="_ _c"> </span><span class="fc1">Lowercase<span class="_ _6"> </span>conversion<span class="_ _6"> </span>routines.<span class="_ _13"> </span><span class="ff6">The<span class="_ _a"> </span>two<span class="_ _13"> </span>procedures<span class="_ _a"> </span>have<span class="_ _13"> </span>radically<span class="_ _a"> </span>different</span></span></div><div class="t m5 x1d h34 y4b0e ff6 fs16 fc1 sc0 ls0 ws0">performance.</div><div class="t m5 x29 h26 y561 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>analysis<span class="_"> </span>is<span class="_ _13"> </span>conﬁrmed<span class="_"> </span>by<span class="_ _13"> </span>actual<span class="_"> </span>measurements<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>functions<span class="_ _13"> </span>for<span class="_"> </span>differ<span class="_ _1"></span>-</div><div class="t m5 x1d h26 y562 ff7 fs19 fc1 sc0 ls0 ws0">ent<span class="_ _13"> </span>length<span class="_ _13"> </span>strings<span class="_ _3"></span>,<span class="_ _13"> </span>as<span class="_ _13"> </span>shown<span class="_ _13"> </span>in<span class="_ _13"> </span>F<span class="_ _1"></span>igure<span class="_ _13"> </span>5.8<span class="_ _13"> </span>(and<span class="_ _13"> </span>using<span class="_ _13"> </span>the<span class="_ _13"> </span>library<span class="_ _6"> </span>version<span class="_ _13"> </span>of<span class="_ _13"> </span><span class="ffd">strlen</span>).</div><div class="t m5 x1d h26 y563 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _16"> </span>graph<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>run<span class="_ _11"> </span>time<span class="_ _16"> </span>for<span class="_ _11"> </span><span class="ffd">lower1<span class="_ _11"> </span></span>rises<span class="_ _16"> </span>steeply<span class="_ _11"> </span>as<span class="_ _11"> </span>the<span class="_ _16"> </span>string<span class="_ _11"> </span>length<span class="_ _16"> </span>increases</div><div class="t m5 x1d h26 y564 ff7 fs19 fc1 sc0 ls0 ws0">(F<span class="_ _1"></span>igure<span class="_"> </span>5.8(a)).<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>5.8(b)<span class="_ _13"> </span>shows<span class="_"> </span>the<span class="_"> </span>run<span class="_ _13"> </span>times<span class="_"> </span>for<span class="_"> </span>seven<span class="_ _13"> </span>different<span class="_"> </span>lengths<span class="_"> </span>(not</div><div class="t m5 x1d h26 y565 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>same<span class="_ _11"> </span>as<span class="_"> </span>shown<span class="_ _11"> </span>in<span class="_"> </span>the<span class="_ _11"> </span>graph),<span class="_ _11"> </span>each<span class="_"> </span>of<span class="_ _11"> </span>which<span class="_"> </span>is<span class="_ _11"> </span>a<span class="_ _11"> </span>power<span class="_"> </span>of<span class="_ _11"> </span>2.<span class="_"> </span>Observe<span class="_ _11"> </span>that<span class="_"> </span>for</div><div class="t m5 x1d h26 y566 ffd fs19 fc1 sc0 ls0 ws0">lower1<span class="_ _11"> </span><span class="ff7">each<span class="_ _16"> </span>doubling<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>string<span class="_ _11"> </span>length<span class="_ _16"> </span>causes<span class="_ _11"> </span>a<span class="_ _16"> </span>quadrupling<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>run<span class="_ _11"> </span>time<span class="_ _0"></span>.</span></div><div class="t m5 x1d h26 y567 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _16"> </span>is<span class="_ _11"> </span>a<span class="_ _11"> </span>clear<span class="_ _16"> </span>indicator<span class="_ _11"> </span>of<span class="_ _11"> </span>a<span class="_ _11"> </span>quadratic<span class="_ _16"> </span>run<span class="_ _11"> </span>time<span class="_ _0"></span>.<span class="_ _11"> </span>F<span class="_ _1"></span>or<span class="_ _11"> </span>a<span class="_ _16"> </span>string<span class="_ _11"> </span>of<span class="_ _11"> </span>length<span class="_ _16"> </span>1,048,576,</div><div class="t m5 x1d h26 y216d ffd fs19 fc1 sc0 ls0 ws0">lower1<span class="_ _10"> </span><span class="ff7">requires<span class="_"> </span>over<span class="_"> </span>17<span class="_"> </span>minutes<span class="_"> </span>of<span class="_"> </span>CPU<span class="_"> </span>time<span class="_ _0"></span>.</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
