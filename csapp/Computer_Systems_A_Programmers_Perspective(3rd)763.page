<div id="pf2fb" class="pf w2 h11" data-page-no="2fb"><div class="pc pc2fb w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg2fb.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">762<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>8<span class="_ _3d"> </span>Exceptional<span class="_ _10"> </span>Control<span class="_ _10"> </span>Flow</span></div><div class="t m5 x29 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">was<span class="_"> </span>executing<span class="_ _11"> </span>when<span class="_"> </span>the<span class="_ _11"> </span>event<span class="_ _11"> </span>occurred)<span class="_"> </span>or<span class="_ _11"> </span>the<span class="_ _11"> </span>next<span class="_"> </span>instruction<span class="_ _11"> </span>(the<span class="_ _11"> </span>instruc-</div><div class="t m5 x29 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">tion<span class="_"> </span>that<span class="_ _13"> </span>would<span class="_"> </span>have<span class="_"> </span>executed<span class="_"> </span>after<span class="_ _13"> </span>the<span class="_"> </span>current<span class="_"> </span>instruction<span class="_ _13"> </span>had<span class="_"> </span>the<span class="_"> </span>event<span class="_"> </span>not</div><div class="t m5 x29 h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">occurred).</div><div class="t m5 x75 h3d y780 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y781 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _13"> </span>processor<span class="_"> </span>also<span class="_ _13"> </span>pushes<span class="_ _13"> </span>some<span class="_ _13"> </span>additional<span class="_ _13"> </span>processor<span class="_ _13"> </span>state<span class="_ _13"> </span>onto<span class="_ _13"> </span>the<span class="_ _13"> </span>stack<span class="_ _13"> </span>that</div><div class="t m5 x29 h26 y782 ff7 fs19 fc1 sc0 ls0 ws0">will<span class="_ _13"> </span>be<span class="_ _13"> </span>necessary<span class="_ _6"> </span>to<span class="_ _13"> </span>restart<span class="_ _13"> </span>the<span class="_ _13"> </span>interrupted<span class="_ _6"> </span>program<span class="_ _13"> </span>when<span class="_ _13"> </span>the<span class="_ _13"> </span>handler<span class="_ _13"> </span>returns<span class="_ _3"></span>.</div><div class="t m5 x29 h26 y783 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _16"> </span>example<span class="_ _1"></span>,<span class="_ _16"> </span>an<span class="_ _16"> </span>x86-64<span class="_ _16"> </span>system<span class="_ _11"> </span>pushes<span class="_ _16"> </span>the<span class="_ _16"> </span>EFLA<span class="_ _1"></span>GS<span class="_ _16"> </span>register<span class="_ _11"> </span>containing<span class="_ _16"> </span>the</div><div class="t m5 x29 h26 y784 ff7 fs19 fc1 sc0 ls0 ws0">current<span class="_"> </span>condition<span class="_"> </span>codes<span class="_ _1"></span>,<span class="_"> </span>among<span class="_"> </span>other<span class="_"> </span>things<span class="_ _1"></span>,<span class="_"> </span>onto<span class="_"> </span>the<span class="_"> </span>stack.</div><div class="t m5 x75 h3d y6422 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 ye9f ff7 fs19 fc1 sc0 ls0 ws0">When<span class="_ _11"> </span>control<span class="_ _16"> </span>is<span class="_ _16"> </span>being<span class="_ _11"> </span>transferred<span class="_ _16"> </span>from<span class="_ _16"> </span>a<span class="_ _16"> </span>user<span class="_ _11"> </span>program<span class="_ _16"> </span>to<span class="_ _16"> </span>the<span class="_ _16"> </span>kernel,<span class="_ _16"> </span>all<span class="_ _11"> </span>of</div><div class="t m5 x29 h26 y6423 ff7 fs19 fc1 sc0 ls0 ws0">these<span class="_ _14"> </span>items<span class="_ _15"> </span>are<span class="_ _14"> </span>pushed<span class="_ _15"> </span>onto<span class="_ _15"> </span>the<span class="_ _14"> </span>kernel’s<span class="_ _14"> </span>stack<span class="_ _15"> </span>rather<span class="_ _15"> </span>than<span class="_ _14"> </span>onto<span class="_ _15"> </span>the<span class="_ _14"> </span>user’s</div><div class="t m5 x29 h26 y6424 ff7 fs19 fc1 sc0 ls0 ws0">stack.</div><div class="t m5 x75 h3d y6425 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 yea5 ff7 fs19 fc1 sc0 ls0 ws0">Exception<span class="_ _6"> </span>handlers<span class="_ _13"> </span>run<span class="_ _6"> </span>in<span class="_ _13"> </span><span class="ffa">kernel<span class="_ _6"> </span>mode<span class="_ _13"> </span></span>(Section<span class="_ _6"> </span>8.2.4),<span class="_ _13"> </span>which<span class="_ _6"> </span>means<span class="_ _13"> </span>they<span class="_ _6"> </span>have</div><div class="t m5 x29 h26 y6426 ff7 fs19 fc1 sc0 ls0 ws0">complete<span class="_"> </span>access<span class="_"> </span>to<span class="_"> </span>all<span class="_"> </span>system<span class="_"> </span>resources<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y6427 ff7 fs19 fc1 sc0 ls0 ws0">Once<span class="_ _15"> </span>the<span class="_ _14"> </span>hardware<span class="_ _15"> </span>triggers<span class="_ _15"> </span>the<span class="_ _15"> </span>exception,<span class="_ _21"> </span>the<span class="_ _15"> </span>rest<span class="_ _15"> </span>of<span class="_ _15"> </span>the<span class="_ _15"> </span>work<span class="_ _15"> </span>is<span class="_ _14"> </span>done<span class="_ _15"> </span>in</div><div class="t m5 x1d h26 y6428 ff7 fs19 fc1 sc0 ls0 ws0">software<span class="_ _11"> </span>by<span class="_ _11"> </span>the<span class="_ _11"> </span>exception<span class="_ _11"> </span>handler.<span class="_ _11"> </span>After<span class="_ _11"> </span>the<span class="_ _11"> </span>handler<span class="_ _11"> </span>has<span class="_ _11"> </span>processed<span class="_ _11"> </span>the<span class="_ _11"> </span>event,<span class="_ _16"> </span>it</div><div class="t m5 x1d h26 y6429 ff7 fs19 fc1 sc0 ls0 ws0">optionally<span class="_ _13"> </span>returns<span class="_"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>interrupted<span class="_ _13"> </span>program<span class="_"> </span>by<span class="_ _13"> </span>executing<span class="_ _13"> </span>a<span class="_ _13"> </span>special<span class="_"> </span>“return<span class="_ _13"> </span>from</div><div class="t m5 x1d h26 y642a ff7 fs19 fc1 sc0 ls0 ws0">interrupt”<span class="_"> </span>instruction,<span class="_ _13"> </span>which<span class="_"> </span>pops<span class="_"> </span>the<span class="_ _13"> </span>appropriate<span class="_"> </span>state<span class="_"> </span>back<span class="_ _13"> </span>into<span class="_"> </span>the<span class="_"> </span>processor’<span class="_ _1"></span>s</div><div class="t m5 x1d h26 y642b ff7 fs19 fc1 sc0 ls0 ws0">control<span class="_ _16"> </span>and<span class="_ _14"> </span>data<span class="_ _14"> </span>registers<span class="_ _1"></span>,<span class="_ _14"> </span>restores<span class="_ _14"> </span>the<span class="_ _16"> </span>state<span class="_ _14"> </span>to<span class="_ _14"> </span><span class="ffa">user<span class="_ _16"> </span>mode<span class="_ _14"> </span></span>(Section<span class="_ _14"> </span>8.2.4)<span class="_ _14"> </span>if<span class="_ _16"> </span>the</div><div class="t m5 x1d h26 y642c ff7 fs19 fc1 sc0 ls0 ws0">exception<span class="_ _13"> </span>interrupted<span class="_ _13"> </span>a<span class="_"> </span>user<span class="_ _13"> </span>program,<span class="_ _13"> </span>and<span class="_ _13"> </span>then<span class="_"> </span>returns<span class="_ _13"> </span>control<span class="_ _13"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>interrupted</div><div class="t m5 x1d h26 y642d ff7 fs19 fc1 sc0 ls0 ws0">program.</div><div class="t m5 x1d h41 y642e ffe fs29 fc1 sc0 ls0 ws0">8.1.2<span class="_ _48"> </span><span class="fs19">Classes<span class="_"> </span>of<span class="_"> </span>Exceptions</span></div><div class="t m5 x1d h26 y642f ff7 fs19 fc1 sc0 ls0 ws0">Exceptions<span class="_ _16"> </span>can<span class="_ _16"> </span>be<span class="_ _14"> </span>divided<span class="_ _16"> </span>into<span class="_ _16"> </span>four<span class="_ _14"> </span>classes:<span class="_ _16"> </span><span class="ffa">interrupts</span>,<span class="_ _14"> </span><span class="ffa">traps</span>,<span class="_ _14"> </span><span class="ffa">faults</span>,<span class="_ _14"> </span>and<span class="_ _14"> </span><span class="ffa">aborts</span>.</div><div class="t m5 x1d h26 y6430 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>table<span class="_"> </span>in<span class="_"> </span>Figure<span class="_"> </span>8.4<span class="_"> </span>summarizes<span class="_"> </span>the<span class="_"> </span>attributes<span class="_"> </span>of<span class="_"> </span>these<span class="_"> </span>classes<span class="_ _3"></span>.</div><div class="t m5 x1d h42 y6431 ff6 fs29 fc6 sc0 ls0 ws0">Interrupts</div><div class="t m5 x1d h26 y6432 ffa fs19 fc1 sc0 ls0 ws0">Interrupts<span class="_ _16"> </span><span class="ff7">occur<span class="_ _14"> </span></span>asynchronously<span class="_ _16"> </span><span class="ff7">as<span class="_ _16"> </span>a<span class="_ _14"> </span>result<span class="_ _16"> </span>of<span class="_ _14"> </span>signals<span class="_ _14"> </span>from<span class="_ _16"> </span>I/O<span class="_ _14"> </span>devices<span class="_ _16"> </span>that<span class="_ _14"> </span>are</span></div><div class="t m5 x1d h26 y6433 ff7 fs19 fc1 sc0 ls0 ws0">external<span class="_ _21"> </span>to<span class="_ _21"> </span>the<span class="_ _21"> </span>processor.<span class="_ _15"> </span>Hardware<span class="_ _21"> </span>interrupts<span class="_ _21"> </span>are<span class="_ _21"> </span>asynchronous<span class="_ _21"> </span>in<span class="_ _21"> </span>the<span class="_ _21"> </span>sense</div><div class="t m5 x1d h26 y6434 ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_"> </span>they<span class="_ _13"> </span>are<span class="_"> </span>not<span class="_ _13"> </span>caused<span class="_"> </span>by<span class="_ _13"> </span>the<span class="_"> </span>execution<span class="_ _13"> </span>of<span class="_"> </span>any<span class="_ _13"> </span>particular<span class="_"> </span>instruction.<span class="_ _13"> </span>Exception</div><div class="t m5 x1d h26 y6435 ff7 fs19 fc1 sc0 ls0 ws0">handlers<span class="_"> </span>for<span class="_"> </span>hardware<span class="_"> </span>interrupts<span class="_"> </span>are<span class="_"> </span>often<span class="_"> </span>called<span class="_"> </span><span class="ffa">interrupt<span class="_"> </span>handlers</span>.</div><div class="t m5 x29 h26 y6436 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _15"> </span>8.5<span class="_ _14"> </span>summarizes<span class="_ _14"> </span>the<span class="_ _15"> </span>processing<span class="_ _14"> </span>for<span class="_ _15"> </span>an<span class="_ _14"> </span>interrupt.<span class="_ _14"> </span>I/O<span class="_ _15"> </span>devices<span class="_ _14"> </span>such<span class="_ _14"> </span>as</div><div class="t m5 x1d h26 y6437 ff7 fs19 fc1 sc0 ls0 ws0">network<span class="_"> </span>adapters<span class="_ _3"></span>,<span class="_"> </span>disk<span class="_"> </span>controllers<span class="_ _1"></span>,<span class="_"> </span>and<span class="_"> </span>timer<span class="_"> </span>chips<span class="_ _13"> </span>trigger<span class="_"> </span>interrupts<span class="_"> </span>by<span class="_"> </span>signaling</div><div class="t m5 x1d h26 y6438 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_ _13"> </span>pin<span class="_ _13"> </span>on<span class="_ _13"> </span>the<span class="_ _13"> </span>processor<span class="_ _13"> </span>chip<span class="_ _13"> </span>and<span class="_ _13"> </span>placing<span class="_ _13"> </span>onto<span class="_"> </span>the<span class="_ _13"> </span>system<span class="_ _13"> </span>bus<span class="_ _13"> </span>the<span class="_ _13"> </span>exception<span class="_ _13"> </span>number</div><div class="t m5 x1d h26 y6439 ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_"> </span>identiﬁes<span class="_"> </span>the<span class="_"> </span>device<span class="_"> </span>that<span class="_"> </span>caused<span class="_"> </span>the<span class="_"> </span>interrupt.</div><div class="t m5 x14 h31 y4b0 ff7 fs21 fc2 sc0 ls0 ws0">Class<span class="_ _88"> </span>Cause<span class="_ _20a"> </span>Async/sync<span class="_ _26"> </span>Return<span class="_"> </span>behavior</div><div class="t m5 x14 h31 y643a ff7 fs21 fc2 sc0 ls0 ws0">Interrupt<span class="_ _26"> </span>Signal<span class="_"> </span>from<span class="_"> </span>I/O<span class="_"> </span>device<span class="_ _77"> </span>Async<span class="_ _d0"> </span>Always<span class="_"> </span>returns<span class="_"> </span>to<span class="_"> </span>next<span class="_"> </span>instruction</div><div class="t m5 x14 h31 y643b ff7 fs21 fc2 sc0 ls0 ws0">T<span class="_ _7"></span>rap<span class="_ _7f"> </span>Intentional<span class="_"> </span>exception<span class="_ _122"> </span>Sync<span class="_ _1b4"> </span>Always<span class="_"> </span>returns<span class="_"> </span>to<span class="_"> </span>next<span class="_"> </span>instruction</div><div class="t m5 x14 h31 y643c ff7 fs21 fc2 sc0 ls0 ws0">F<span class="_ _3"></span>ault<span class="_ _118"> </span>Potentially<span class="_"> </span>recoverable<span class="_"> </span>error<span class="_ _26"> </span>Sync<span class="_ _1b4"> </span>Might<span class="_"> </span>return<span class="_"> </span>to<span class="_"> </span>current<span class="_"> </span>instruction</div><div class="t m5 x14 h31 y643d ff7 fs21 fc2 sc0 ls0 ws0">Abort<span class="_ _b9"> </span>Nonrecoverable<span class="_"> </span>error<span class="_ _c0"> </span>Sync<span class="_ _11c"> </span>Never<span class="_"> </span>returns</div><div class="t m5 x14 h34 y126b ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _11"> </span>8.4<span class="_ _c"> </span><span class="fc1">Classes<span class="_ _11"> </span>of<span class="_ _11"> </span>exceptions.<span class="_ _16"> </span><span class="ff6">Asynchronous<span class="_ _11"> </span>exceptions<span class="_ _11"> </span>occur<span class="_ _11"> </span>as<span class="_ _16"> </span>a<span class="_ _11"> </span>result<span class="_ _11"> </span>of<span class="_ _11"> </span>events<span class="_ _16"> </span>in<span class="_ _11"> </span>I/O<span class="_ _11"> </span>devices<span class="_ _11"> </span>that</span></span></div><div class="t m5 x14 h34 y126c ff6 fs16 fc1 sc0 ls0 ws0">are<span class="_ _10"> </span>external<span class="_ _11"> </span>to<span class="_ _10"> </span>the<span class="_ _10"> </span>processor<span class="_ _1"></span>.<span class="_ _11"> </span>Synchronous<span class="_ _10"> </span>exceptions<span class="_ _10"> </span>occur<span class="_ _11"> </span>as<span class="_ _10"> </span>a<span class="_ _11"> </span>direct<span class="_ _10"> </span>result<span class="_ _11"> </span>of<span class="_ _10"> </span>executing<span class="_ _10"> </span>an<span class="_ _11"> </span>instruction.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
