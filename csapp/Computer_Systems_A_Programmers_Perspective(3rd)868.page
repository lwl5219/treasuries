<div id="pf364" class="pf w2 h11" data-page-no="364"><div class="pc pc364 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg364.png"/><div class="t m5 xed h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>9.7<span class="_ _60"> </span>Case<span class="_ _10"> </span>Study:<span class="_ _10"> </span>The<span class="_ _10"> </span>Intel<span class="_ _10"> </span>Core<span class="_ _10"> </span>i7/Linux<span class="_ _10"> </span>Memory<span class="_ _10"> </span>System<span class="_ _3e"> </span><span class="ffe fs1e">867</span></div><div class="t m5 x1a4 h70 y708b ffbb fs27 fc1 sc0 ls0 ws0">mm</div><div class="t m5 x17 h70 y708c ffbb fs27 fc1 sc0 ls0 ws0">task_struct</div><div class="t m5 x8c h70 y708b ffbb fs27 fc1 sc0 ls0 ws0">pgd</div><div class="t m5 xbe h70 y708d ffbb fs27 fc1 sc0 ls0 ws0">vm_end</div><div class="t m5 x9b h70 y708e ffbb fs27 fc1 sc0 ls0 ws0">vm_start</div><div class="t m5 xba h70 y708f ffbb fs27 fc1 sc0 ls0 ws0">vm_prot</div><div class="t m5 x9b h70 y7090 ffbb fs27 fc1 sc0 ls0 ws0">vm_flags</div><div class="t m5 xba h70 y7091 ffbb fs27 fc1 sc0 ls0 ws0">vm_next</div><div class="t m5 xbe h70 y7092 ffbb fs27 fc1 sc0 ls0 ws0">vm_end</div><div class="t m5 x9b h70 y7093 ffbb fs27 fc1 sc0 ls0 ws0">vm_start</div><div class="t m5 xba h70 y7094 ffbb fs27 fc1 sc0 ls0 ws0">vm_prot</div><div class="t m5 x9b h70 y7095 ffbb fs27 fc1 sc0 ls0 ws0">vm_flags</div><div class="t m5 xba h70 y7096 ffbb fs27 fc1 sc0 ls0 ws0">vm_next</div><div class="t m5 xbe h70 y7097 ffbb fs27 fc1 sc0 ls0 ws0">vm_end</div><div class="t m5 x19a h3f y7098 ffbc fs27 fc1 sc0 ls0 ws0">Shared libraries</div><div class="t m5 x45 h70 y7099 ffbb fs27 fc1 sc0 ls0 ws0">0</div><div class="t m5 x6b h3f y709a ffbc fs27 fc1 sc0 ls0 ws0">Data</div><div class="t m5 x247 h3f y709b ffbc fs27 fc1 sc0 ls0 ws0">T<span class="_ _3"></span>ext</div><div class="t m5 x9b h70 y709c ffbb fs27 fc1 sc0 ls0 ws0">vm_start</div><div class="t m5 xba h70 y709d ffbb fs27 fc1 sc0 ls0 ws0">vm_prot</div><div class="t m5 x9b h70 y709e ffbb fs27 fc1 sc0 ls0 ws0">vm_flags</div><div class="t m5 xba h70 y709f ffbb fs27 fc1 sc0 ls0 ws0">vm_next</div><div class="t m5 x203 h70 y70a0 ffbb fs27 fc1 sc0 ls0 ws0">mmap</div><div class="t m5 x13 h70 y708c ffbb fs27 fc1 sc0 ls0 ws0">mm_struct</div><div class="t m5 xdc h70 y70a1 ffbb fs27 fc1 sc0 ls0 ws0">vm_area_struct</div><div class="t m5 x7d h3f y70a2 ffbc fs27 fc1 sc0 ls0 ws0">Process virtual memory</div><div class="t m5 x17 h2f y70a3 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>9.27<span class="_ _66"> </span><span class="fc1">How<span class="_"> </span>Linux<span class="_"> </span>organizes<span class="_"> </span>virtual<span class="_"> </span>memor<span class="_ _2"></span>y<span class="_ _3"></span>.</span></div><div class="t m5 x17 h26 y70a4 ff7 fs19 fc1 sc0 ls0 ws0">run<span class="_ _11"> </span>the<span class="_ _16"> </span>process<span class="_ _11"> </span>(e<span class="_ _0"></span>.g.,<span class="_ _11"> </span>the<span class="_ _11"> </span>PID<span class="_ _1"></span>,<span class="_ _16"> </span>pointer<span class="_ _11"> </span>to<span class="_ _16"> </span>the<span class="_ _11"> </span>user<span class="_ _11"> </span>stack,<span class="_ _16"> </span>name<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span>executable</div><div class="t m5 x17 h26 y70a5 ff7 fs19 fc1 sc0 ls0 ws0">object<span class="_"> </span>ﬁle<span class="_ _1"></span>,<span class="_"> </span>and<span class="_"> </span>program<span class="_"> </span>counter).</div><div class="t m5 x26 h26 y70a6 ff7 fs19 fc1 sc0 ls0 ws0">One<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span>entries<span class="_ _11"> </span>in<span class="_ _16"> </span>the<span class="_ _11"> </span>task<span class="_ _11"> </span>structure<span class="_ _16"> </span>points<span class="_ _11"> </span>to<span class="_ _11"> </span>an<span class="_ _16"> </span><span class="ffd">mm_struct<span class="_ _11"> </span></span>that<span class="_ _11"> </span>charac-</div><div class="t m5 x17 h26 y70a7 ff7 fs19 fc1 sc0 ls0 ws0">terizes<span class="_ _14"> </span>the<span class="_ _14"> </span>current<span class="_ _14"> </span>state<span class="_ _14"> </span>of<span class="_ _15"> </span>the<span class="_ _14"> </span>virtual<span class="_ _14"> </span>memory<span class="_ _3"></span>.<span class="_ _14"> </span>T<span class="_ _1"></span>he<span class="_ _15"> </span>two<span class="_ _14"> </span>ﬁelds<span class="_ _14"> </span>of<span class="_ _14"> </span>interest<span class="_ _14"> </span>to<span class="_ _14"> </span>us</div><div class="t m5 x17 h26 y70a8 ff7 fs19 fc1 sc0 ls0 ws0">are<span class="_"> </span><span class="ffd">pgd</span>,<span class="_ _11"> </span>which<span class="_ _11"> </span>points<span class="_ _11"> </span>to<span class="_ _11"> </span>the<span class="_"> </span>base<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>level<span class="_"> </span>1<span class="_ _11"> </span>table<span class="_ _11"> </span>(the<span class="_ _11"> </span>page<span class="_"> </span>global<span class="_ _11"> </span>directory),</div><div class="t m5 x17 h26 y70a9 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_"> </span><span class="ffd">mmap</span>,<span class="_ _13"> </span>which<span class="_"> </span>points<span class="_ _13"> </span>to<span class="_"> </span>a<span class="_"> </span>list<span class="_ _13"> </span>of<span class="_"> </span><span class="ffd">vm_area_structs<span class="_ _13"> </span></span>(area<span class="_"> </span>structs),<span class="_"> </span>each<span class="_ _13"> </span>of<span class="_"> </span>which</div><div class="t m5 x17 h26 y70aa ff7 fs19 fc1 sc0 ls0 ws0">characterizes<span class="_ _11"> </span>an<span class="_ _11"> </span>area<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>current<span class="_ _16"> </span>virtual<span class="_"> </span>address<span class="_ _11"> </span>space.<span class="_"> </span>When<span class="_ _11"> </span>the<span class="_ _11"> </span>kernel<span class="_ _11"> </span>runs</div><div class="t m5 x17 h26 y70ab ff7 fs19 fc1 sc0 ls0 ws0">this<span class="_"> </span>process<span class="_ _1"></span>,<span class="_"> </span>it<span class="_"> </span>stores<span class="_"> </span><span class="ffd">pgd<span class="_ _10"> </span></span>in<span class="_"> </span>the<span class="_"> </span>CR3<span class="_"> </span>control<span class="_"> </span>register.</div><div class="t m5 x26 h26 y70ac ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_"> </span>our<span class="_ _11"> </span>purposes<span class="_ _1"></span>,<span class="_ _11"> </span>the<span class="_ _11"> </span>area<span class="_ _11"> </span>struct<span class="_ _11"> </span>for<span class="_"> </span>a<span class="_ _11"> </span>particular<span class="_ _11"> </span>area<span class="_ _11"> </span>contains<span class="_"> </span>the<span class="_ _11"> </span>following</div><div class="t m5 x17 h26 y70ad ff7 fs19 fc1 sc0 ls0 ws0">ﬁelds:</div><div class="t m5 x72 h26 y70ae ffd fs19 fc1 sc0 ls0 ws0">fvm_start<span class="ff7">.<span class="_ _e"> </span>Points<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>beginning<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>area.</span></div><div class="t m5 x72 h26 y70af ffd fs19 fc1 sc0 ls0 ws0">vm_end<span class="ff7">.<span class="_ _e"> </span>Points<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>end<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>area.</span></div><div class="t m5 x72 h26 y70b0 ffd fs19 fc1 sc0 ls0 ws0">vm_prot<span class="ff7">.<span class="_ _e"> </span>Describes<span class="_ _16"> </span>the<span class="_ _16"> </span>read/write<span class="_ _16"> </span>permissions<span class="_ _16"> </span>for<span class="_ _16"> </span>all<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>pages<span class="_ _16"> </span>contained</span></div><div class="t m5 x30 h26 y70b1 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_"> </span>the<span class="_"> </span>area.</div><div class="t m5 x72 h26 y70b2 ffd fs19 fc1 sc0 ls0 ws0">vm_flags<span class="ff7">.<span class="_ _e"> </span>Describes<span class="_ _16"> </span>(among<span class="_ _16"> </span>other<span class="_ _11"> </span>things)<span class="_ _16"> </span>whether<span class="_ _16"> </span>the<span class="_ _11"> </span>pages<span class="_ _16"> </span>in<span class="_ _16"> </span>the<span class="_ _11"> </span>area<span class="_ _16"> </span>are</span></div><div class="t m5 x30 h26 y70b3 ff7 fs19 fc1 sc0 ls0 ws0">shared<span class="_"> </span>with<span class="_"> </span>other<span class="_"> </span>processes<span class="_"> </span>or<span class="_"> </span>private<span class="_"> </span>to<span class="_"> </span>this<span class="_"> </span>process<span class="_ _1"></span>.</div><div class="t m5 x72 h26 y70b4 ffd fs19 fc1 sc0 ls0 ws0">vm_next<span class="ff7">.<span class="_ _e"> </span>Points<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>next<span class="_"> </span>area<span class="_"> </span>struct<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>list.</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
