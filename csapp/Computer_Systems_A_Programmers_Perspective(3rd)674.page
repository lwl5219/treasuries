<div id="pf2a2" class="pf w2 h11" data-page-no="2a2"><div class="pc pc2a2 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg2a2.png"/><div class="t m5 xf5 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>6.5<span class="_ _60"> </span>Writing<span class="_ _10"> </span>Cache-Friendly<span class="_ _10"> </span>Code<span class="_ _1b"> </span><span class="ffe fs1e">673</span></div><div class="t m5 x26 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">Assume<span class="_"> </span>this<span class="_"> </span>code<span class="_"> </span>runs<span class="_"> </span>on<span class="_"> </span>a<span class="_"> </span>machine<span class="_"> </span>with<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>properties:</div><div class="t m5 x72 h3d y5984 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h46 y5985 ffd fs19 fc1 sc0 ls0 ws0">sizeof<span class="_ _1"></span><span class="ff11">(<span class="ffd">int<span class="_ _1"></span><span class="ff11">)<span class="_ _10"> </span><span class="ff12">=<span class="_ _13"></span><span class="ff7 lsb1">4.</span></span></span></span></span></div><div class="t m5 x72 h3d y5986 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y5987 ff7 fs19 fc1 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _e"> </span><span class="ffd ls0">src<span class="_ _e"> </span><span class="ff7">array<span class="_ _21"> </span>starts<span class="_ _e"> </span>at<span class="_ _f"> </span>address<span class="_ _e"> </span>0<span class="_ _21"> </span>and<span class="_ _e"> </span>the<span class="_ _f"> </span></span>dst<span class="_ _e"> </span><span class="ff7">array<span class="_ _f"> </span>starts<span class="_ _f"> </span>at<span class="_ _e"> </span>address<span class="_ _f"> </span>16</span></span></div><div class="t m5 x26 h26 y5988 ff7 fs19 fc1 sc0 ls0 ws0">(decimal).</div><div class="t m5 x72 h3d y5989 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y598a ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>here<span class="_ _6"> </span>is<span class="_ _6"> </span>a<span class="_ _6"> </span>single<span class="_ _6"> </span>L1<span class="_ _6"> </span>data<span class="_ _13"> </span>cache<span class="_ _a"> </span>that<span class="_ _6"> </span>is<span class="_ _6"> </span>direct-mapped,<span class="_ _13"> </span>write-through,<span class="_ _6"> </span>and<span class="_ _6"> </span>write-</div><div class="t m5 x26 h26 y598b ff7 fs19 fc1 sc0 ls0 ws0">allocate<span class="_ _1"></span>,<span class="_"> </span>with<span class="_"> </span>a<span class="_"> </span>block<span class="_"> </span>size<span class="_"> </span>of<span class="_"> </span>8<span class="_"> </span>bytes<span class="_ _1"></span>.</div><div class="t m5 x72 h3d y598c ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y598d ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>cache<span class="_"> </span>has<span class="_"> </span>a<span class="_"> </span>total<span class="_"> </span>size<span class="_"> </span>of<span class="_"> </span>16<span class="_"> </span>data<span class="_"> </span>bytes<span class="_"> </span>and<span class="_"> </span>the<span class="_"> </span>cache<span class="_"> </span>is<span class="_"> </span>initially<span class="_"> </span>empty<span class="_ _3"></span>.</div><div class="t m5 x72 h3d y598e ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y598f ff7 fs19 fc1 sc0 ls0 ws0">Accesses<span class="_ _14"> </span>to<span class="_ _14"> </span>the<span class="_ _14"> </span><span class="ffd">src<span class="_ _14"> </span></span>and<span class="_ _14"> </span><span class="ffd">dst<span class="_ _14"> </span></span>arrays<span class="_ _14"> </span>are<span class="_ _14"> </span>the<span class="_ _14"> </span>only<span class="_ _14"> </span>sources<span class="_ _14"> </span>of<span class="_ _14"> </span>read<span class="_ _14"> </span>and<span class="_ _14"> </span>write</div><div class="t m5 x26 h26 y5990 ff7 fs19 fc1 sc0 ls0 ws0">misses<span class="_ _1"></span>,<span class="_"> </span>respectively<span class="_ _3"></span>.</div><div class="t m5 x34 h26 y5991 ff7 fs19 fc1 sc0 ls0 ws0">A.<span class="_ _1f"> </span>F<span class="_ _1"></span>or<span class="_ _16"> </span>each<span class="_ _16"> </span><span class="ffd">row<span class="_ _16"> </span></span>and<span class="_ _16"> </span><span class="ffd">col</span>,<span class="_ _14"> </span>indicate<span class="_ _16"> </span>whether<span class="_ _16"> </span>the<span class="_ _16"> </span>access<span class="_ _16"> </span>to<span class="_ _16"> </span><span class="ffd">src[row][col]<span class="_ _16"> </span></span>and</div><div class="t m5 x2d h26 y5992 ffd fs19 fc1 sc0 ls0 ws0">dst[row][col]<span class="_ _11"> </span><span class="ff7">is<span class="_ _11"> </span>a<span class="_ _11"> </span>hit<span class="_ _11"> </span>(h)<span class="_ _11"> </span>or<span class="_ _11"> </span>a<span class="_ _11"> </span>miss<span class="_ _11"> </span>(m).<span class="_ _11"> </span>F<span class="_ _1"></span>or<span class="_ _11"> </span>example<span class="_ _0"></span>,<span class="_ _11"> </span>reading<span class="_ _11"> </span><span class="ffd">src[0][0]</span></span></div><div class="t m5 x2d h26 y5993 ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_"> </span>a<span class="_"> </span>miss<span class="_"> </span>and<span class="_"> </span>writing<span class="_"> </span><span class="ffd">dst[0][0]<span class="_ _10"> </span></span>is<span class="_"> </span>also<span class="_"> </span>a<span class="_"> </span>miss<span class="_ _1"></span>.</div><div class="t m5 x1ee h31 y5994 ffd fs1e fc2 sc0 ls0 ws0">dst<span class="_ _10"> </span><span class="ff7 fs21">array<span class="_ _1ff"> </span></span>src<span class="_ _10"> </span><span class="ff7 fs21">array</span></div><div class="t m5 xf6 h31 y5995 ff7 fs21 fc2 sc0 ls0 ws0">Col.<span class="_"> </span>0<span class="_ _128"> </span>Col.<span class="_"> </span>1<span class="_ _1d7"> </span>Col.<span class="_"> </span>0<span class="_ _128"> </span>Col.<span class="_"> </span>1</div><div class="t m5 x2d h31 y5996 ff7 fs21 fc2 sc0 ls0 ws0">Row<span class="_"> </span>0<span class="_ _6c"> </span>m<span class="_ _141"> </span><span class="fc1">Row0<span class="_ _6f"> </span>m</span></div><div class="t m5 x2d h31 y5997 ff7 fs21 fc1 sc0 ls0 ws0">Row<span class="_"> </span>1</div><div class="t m5 xe3 h31 y5998 ff7 fs21 fc1 sc0 ls0 ws0">Row<span class="_"> </span>1</div><div class="t m5 x34 h26 y5999 ff7 fs19 fc1 sc0 ls0 ws0">B<span class="_ _3"></span>.<span class="_ _1d"> </span>Repeat<span class="_"> </span>the<span class="_"> </span>problem<span class="_"> </span>for<span class="_"> </span>a<span class="_"> </span>cache<span class="_"> </span>with<span class="_"> </span>32<span class="_"> </span>data<span class="_"> </span>bytes<span class="_ _1"></span>.</div><div class="t m5 x17 h47 y599a ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>6.18<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>702)</span></div><div class="t m5 x17 h26 y2bfb ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _11"> </span>heart<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_"> </span>recent<span class="_ _11"> </span>hit<span class="_ _11"> </span>game<span class="_ _11"> </span><span class="ffa">SimAquarium<span class="_"> </span></span>is<span class="_ _11"> </span>a<span class="_ _11"> </span>tight<span class="_ _11"> </span>loop<span class="_"> </span>that<span class="_ _11"> </span>calculates<span class="_ _11"> </span>the</div><div class="t m5 x17 h26 y599b ff7 fs19 fc1 sc0 ls0 ws0">average<span class="_ _15"> </span>position<span class="_ _21"> </span>of<span class="_ _21"> </span>512<span class="_ _21"> </span>algae<span class="_ _1"></span>.<span class="_ _21"> </span>Y<span class="_ _3"></span>ou<span class="_ _21"> </span>are<span class="_ _21"> </span>evaluating<span class="_ _15"> </span>its<span class="_ _21"> </span>cache<span class="_ _21"> </span>performance<span class="_ _21"> </span>on<span class="_ _15"> </span>a</div><div class="t m5 x17 h46 y599c ff7 fs19 fc1 sc0 ls0 ws0">machine<span class="_ _6"> </span>with<span class="_ _13"> </span>a<span class="_ _6"> </span>2,048-byte<span class="_ _13"> </span>direct-mapped<span class="_ _6"> </span>data<span class="_ _13"> </span>cache<span class="_ _6"> </span>with<span class="_ _13"> </span>32-byte<span class="_ _6"> </span>blocks<span class="_ _13"> </span>(<span class="ff11">B<span class="_ _10"> </span><span class="ff12">=<span class="_ _13"> </span></span></span>32<span class="_ _2"></span>).</div><div class="t m5 x17 h26 y599d ff7 fs19 fc1 sc0 ls0 ws0">Y<span class="_ _3"></span>ou<span class="_"> </span>are<span class="_"> </span>given<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>deÔ¨Ånitions:</div><div class="t m5 x2c h2d y599e ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">struct<span class="_ _1f"> </span>algae_position<span class="_ _e"> </span>{</span></div><div class="t m5 x2c h2d y599f ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _20"> </span><span class="ffd fs1e fc2">int<span class="_ _e"> </span>x;</span></div><div class="t m5 x2c h2e y59a0 ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x142 h2d y59a1 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>y;</div><div class="t m5 x2c h2e y59a2 ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 x2d h2d y59a3 ffd fs1e fc2 sc0 ls0 ws0">};</div><div class="t m5 x2c h2e y59a4 ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x2c h2e y59a5 ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 x2d h2d y59a6 ffd fs1e fc2 sc0 ls0 ws0">struct<span class="_ _e"> </span>algae_position<span class="_ _1f"> </span>grid[32][32];</div><div class="t m5 x2c h2e y59a7 ff6 fs20 fc6 sc0 ls0 ws0">7</div><div class="t m5 x2d h2d y59a8 ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>total_x<span class="_ _1f"> </span>=<span class="_ _1f"> </span>0,<span class="_ _e"> </span>total_y<span class="_ _1f"> </span>=<span class="_ _e"> </span>0;</div><div class="t m5 x2c h2d y59a9 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _1c"> </span><span class="ffd fs1e fc2">int<span class="_ _1f"> </span>i,<span class="_ _e"> </span>j;</span></div><div class="t m5 x26 h26 y59aa ff7 fs19 fc2 sc0 ls0 ws0">Y<span class="_ _3"></span>ou<span class="_"> </span>should<span class="_"> </span>also<span class="_"> </span>assume<span class="_"> </span>the<span class="_"> </span>following:</div><div class="t m5 x72 h3d y59ab ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h46 yf3a ffd fs19 fc1 sc0 ls0 ws0">sizeof<span class="_ _1"></span><span class="ff11">(<span class="ffd">int<span class="_ _1"></span><span class="ff11">)<span class="_ _10"> </span><span class="ff12">=<span class="_ _13"></span><span class="ff7 lsb1">4.</span></span></span></span></span></div><div class="t m5 x72 h3d y59ac ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y832 ffd fs19 fc1 sc0 ls0 ws0">grid<span class="_ _10"> </span><span class="ff7">begins<span class="_"> </span>at<span class="_"> </span>memory<span class="_"> </span>address<span class="_"> </span>0.</span></div><div class="t m5 x72 h3d y59ad ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y59ae ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>cache<span class="_"> </span>is<span class="_"> </span>initially<span class="_"> </span>empty<span class="_ _3"></span>.</div><div class="t m5 x72 h3d y59af ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x26 h26 y4af6 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>only<span class="_ _13"> </span>memory<span class="_"> </span>accesses<span class="_ _13"> </span>are<span class="_"> </span>to<span class="_ _13"> </span>the<span class="_"> </span>entries<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>array<span class="_"> </span><span class="ffd">grid</span>.<span class="_ _13"> </span>V<span class="_ _7"></span>ariables<span class="_"> </span><span class="ffd">i</span>,<span class="_ _13"> </span><span class="ffd">j</span>,</div><div class="t m5 x26 h26 y59b0 ffd fs19 fc1 sc0 ls0 ws0">total_x<span class="ff7">,<span class="_"> </span>and<span class="_"> </span></span>total_y<span class="_ _10"> </span><span class="ff7">are<span class="_"> </span>stored<span class="_"> </span>in<span class="_"> </span>registers<span class="_ _1"></span>.</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
