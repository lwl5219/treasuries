<div id="pf2e8" class="pf w2 h11" data-page-no="2e8"><div class="pc pc2e8 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg2e8.png"/><div class="t m5 x175 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>7.13<span class="_ _60"> </span>Librar<span class="_ _2"></span>y<span class="_ _10"> </span>Interpositioning<span class="_ _1b"> </span><span class="ffe fs1e">743</span></div><div class="t m5 x30 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">these<span class="_ _11"> </span>entries<span class="_ _11"> </span>is<span class="_ _11"> </span>responsible<span class="_ _11"> </span>for<span class="_ _11"> </span>invoking<span class="_ _11"> </span>a<span class="_ _11"> </span>speciﬁc<span class="_ _11"> </span>function.<span class="_ _16"> </span><span class="ffd">PLT[1]<span class="_ _10"> </span></span>(not</div><div class="t m5 x30 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">shown<span class="_"> </span>here)<span class="_"> </span>invokes<span class="_"> </span>the<span class="_ _11"> </span>system<span class="_"> </span>startup<span class="_"> </span>function<span class="_"> </span>(<span class="ffd">__libc_start_main</span>),</div><div class="t m5 x30 h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">which<span class="_"> </span>initializes<span class="_"> </span>the<span class="_"> </span>execution<span class="_"> </span>environment,<span class="_"> </span>calls<span class="_"> </span>the<span class="_"> </span><span class="ffd">main<span class="_ _10"> </span></span>function,<span class="_"> </span>and</div><div class="t m5 x30 h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">handles<span class="_ _6"> </span>its<span class="_ _13"> </span>return<span class="_ _a"> </span>value.<span class="_ _6"> </span>Entries<span class="_ _6"> </span>starting<span class="_ _13"> </span>at<span class="_ _6"> </span><span class="ffd">PLT[2]<span class="_ _6"> </span></span>invoke<span class="_ _13"> </span>functions<span class="_ _6"> </span>called</div><div class="t m5 x30 h26 y2f8 ff7 fs19 fc2 sc0 ls0 ws0">by<span class="_ _6"> </span>the<span class="_ _13"> </span>user<span class="_ _6"> </span>code.<span class="_ _6"> </span>In<span class="_ _6"> </span>our<span class="_ _13"> </span>example<span class="_ _1"></span>,<span class="_ _13"> </span><span class="ffd">PLT[2]<span class="_ _13"> </span></span>invokes<span class="_ _6"> </span><span class="ffd">addvec<span class="_ _13"> </span></span>and<span class="_ _6"> </span><span class="ffd">PLT[3]<span class="_ _6"> </span></span>(not</div><div class="t m5 x30 h26 y2f9 ff7 fs19 fc2 sc0 ls0 ws0">shown)<span class="_"> </span>invokes<span class="_"> </span><span class="ffd">printf</span>.</div><div class="t m5 x72 h26 y3a99 ffa fs19 fc2 sc0 ls0 ws0">Global<span class="_ _14"> </span>offset<span class="_ _15"> </span>table<span class="_ _14"> </span>(GO<span class="_ _1"></span>T).<span class="_ _21"> </span><span class="ff7">As<span class="_ _15"> </span>we<span class="_ _14"> </span>have<span class="_ _15"> </span>seen,<span class="_ _15"> </span>the<span class="_ _14"> </span>GOT<span class="_ _14"> </span>is<span class="_ _15"> </span>an<span class="_ _14"> </span>array<span class="_ _15"> </span>of<span class="_ _14"> </span>8-byte</span></div><div class="t m5 x30 h26 y3a9a ff7 fs19 fc2 sc0 ls0 ws0">address<span class="_ _21"> </span>entries<span class="_ _1"></span>.<span class="_ _f"> </span>When<span class="_ _21"> </span>used<span class="_ _21"> </span>in<span class="_ _f"> </span>conjunction<span class="_ _f"> </span>with<span class="_ _21"> </span>the<span class="_ _f"> </span>PL<span class="_ _3"></span>T<span class="_ _3"></span>,<span class="_ _f"> </span><span class="ffd">GOT[0]<span class="_ _f"> </span></span>and</div><div class="t m5 x30 h26 y3a9b ffd fs19 fc2 sc0 ls0 ws0">GOT[1]<span class="_ _13"> </span><span class="ff7">contain<span class="_ _13"> </span>information<span class="_ _13"> </span>that<span class="_ _13"> </span>the<span class="_ _13"> </span>dynamic<span class="_ _13"> </span>linker<span class="_"> </span>uses<span class="_ _13"> </span>when<span class="_ _13"> </span>it<span class="_ _13"> </span>resolves</span></div><div class="t m5 x30 h26 y3a9c ff7 fs19 fc2 sc0 ls0 ws0">function<span class="_ _16"> </span>addresses<span class="_ _0"></span>.<span class="_ _16"> </span><span class="ffd">GOT[2]<span class="_ _14"> </span></span>is<span class="_ _14"> </span>the<span class="_ _14"> </span>entry<span class="_ _14"> </span>point<span class="_ _14"> </span>for<span class="_ _16"> </span>the<span class="_ _14"> </span>dynamic<span class="_ _14"> </span>linker<span class="_ _14"> </span>in</div><div class="t m5 x30 h26 y3a9d ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _11"> </span><span class="ffd">ld-linux.so<span class="_ _11"> </span></span>module<span class="_ _0"></span>.<span class="_ _11"> </span>Each<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>remaining<span class="_"> </span>entries<span class="_ _11"> </span>corresponds<span class="_ _16"> </span>to</div><div class="t m5 x30 h26 y3a9e ff7 fs19 fc2 sc0 ls0 ws0">a<span class="_ _16"> </span>called<span class="_ _16"> </span>function<span class="_ _11"> </span>whose<span class="_ _16"> </span>address<span class="_ _16"> </span>needs<span class="_ _16"> </span>to<span class="_ _16"> </span>be<span class="_ _16"> </span>resolved<span class="_ _11"> </span>at<span class="_ _16"> </span>run<span class="_ _16"> </span>time<span class="_ _0"></span>.<span class="_ _16"> </span>Each</div><div class="t m5 x30 h26 y623e ff7 fs19 fc2 sc0 ls0 ws0">has<span class="_ _11"> </span>a<span class="_ _11"> </span>matching<span class="_ _11"> </span>PL<span class="_ _3"></span>T<span class="_"> </span>entry<span class="_ _3"></span>.<span class="_ _11"> </span>F<span class="_ _1"></span>or<span class="_ _11"> </span>example,<span class="_"> </span><span class="ffd">GOT[4]<span class="_ _16"> </span></span>and<span class="_"> </span><span class="ffd">PLT[2]<span class="_ _11"> </span></span>correspond</div><div class="t m5 x30 h26 y623f ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_ _11"> </span><span class="ffd">addvec</span>.<span class="_ _16"> </span>Initially<span class="_ _3"></span>,<span class="_ _16"> </span>each<span class="_ _16"> </span>GO<span class="_ _0"></span>T<span class="_ _11"> </span>entry<span class="_ _16"> </span>points<span class="_ _16"> </span>to<span class="_ _11"> </span>the<span class="_ _16"> </span>second<span class="_ _16"> </span>instruction<span class="_ _11"> </span>in</div><div class="t m5 x30 h26 y6240 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>corresponding<span class="_"> </span>PL<span class="_ _3"></span>T<span class="_"> </span>entry<span class="_ _7"></span>.</div><div class="t m5 x26 h26 y6241 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _16"> </span>7.19(a)<span class="_"> </span>shows<span class="_ _16"> </span>how<span class="_"> </span>the<span class="_ _16"> </span>GO<span class="_ _0"></span>T<span class="_ _11"> </span>and<span class="_ _11"> </span>PL<span class="_ _3"></span>T<span class="_ _11"> </span>work<span class="_ _11"> </span>together<span class="_ _16"> </span>to<span class="_"> </span>lazily<span class="_ _16"> </span>resolve</div><div class="t m5 x17 h26 y6242 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>run-time<span class="_"> </span>address<span class="_"> </span>of<span class="_"> </span>function<span class="_"> </span><span class="ffd">addvec<span class="_ _10"> </span></span>the<span class="_"> </span>ﬁrst<span class="_"> </span>time<span class="_"> </span>it<span class="_"> </span>is<span class="_"> </span>called:</div><div class="t m5 x62 h26 y6243 ffa fs19 fc2 sc0 ls0 ws0">Step<span class="_"> </span>1.<span class="_ _15"> </span><span class="ff7">Instead<span class="_"> </span>of<span class="_ _13"> </span>directly<span class="_"> </span>calling<span class="_ _13"> </span><span class="ffd">addvec</span>,<span class="_"> </span>the<span class="_"> </span>program<span class="_ _13"> </span>calls<span class="_"> </span>into<span class="_ _13"> </span><span class="ffd">PLT[2]</span>,<span class="_"> </span>which</span></div><div class="t m5 x30 h26 y6244 ff7 fs19 fc2 sc0 ls0 ws0">is<span class="_"> </span>the<span class="_"> </span>PL<span class="_ _3"></span>T<span class="_"> </span>entry<span class="_"> </span>for<span class="_"> </span><span class="ffd">addvec</span>.</div><div class="t m5 x62 h26 y6245 ffa fs19 fc2 sc0 ls0 ws0">Step<span class="_ _11"> </span>2.<span class="_ _21"> </span><span class="ff7">The<span class="_"> </span>ﬁrst<span class="_ _11"> </span>PL<span class="_ _3"></span>T<span class="_ _16"> </span>instruction<span class="_ _11"> </span>does<span class="_ _11"> </span>an<span class="_ _11"> </span>indirect<span class="_ _16"> </span>jump<span class="_ _11"> </span>through<span class="_ _11"> </span><span class="ffd">GOT[4]</span>.<span class="_ _11"> </span>Since</span></div><div class="t m5 x30 h26 y6246 ff7 fs19 fc2 sc0 ls0 ws0">each<span class="_ _6"> </span>GOT<span class="_ _a"> </span>entry<span class="_ _6"> </span>initially<span class="_ _6"> </span>points<span class="_ _6"> </span>to<span class="_ _6"> </span>the<span class="_ _6"> </span>second<span class="_ _6"> </span>instruction<span class="_ _6"> </span>in<span class="_ _6"> </span>its<span class="_ _6"> </span>correspond-</div><div class="t m5 x30 h26 y6247 ff7 fs19 fc2 sc0 ls0 ws0">ing<span class="_ _13"> </span>PL<span class="_ _3"></span>T<span class="_"> </span>entry<span class="_ _7"></span>,<span class="_"> </span>the<span class="_ _13"> </span>indirect<span class="_"> </span>jump<span class="_ _13"> </span>simply<span class="_"> </span>transfers<span class="_ _13"> </span>control<span class="_"> </span>back<span class="_ _13"> </span>to<span class="_"> </span>the<span class="_ _13"> </span>next</div><div class="t m5 x30 h26 y6248 ff7 fs19 fc2 sc0 ls0 ws0">instruction<span class="_"> </span>in<span class="_"> </span><span class="ffd">PLT[2]</span>.</div><div class="t m5 x62 h26 y6249 ffa fs19 fc2 sc0 ls0 ws0">Step<span class="_"> </span>3.<span class="_ _21"> </span><span class="ff7">After<span class="_ _11"> </span>pushing<span class="_ _11"> </span>an<span class="_"> </span>ID<span class="_ _11"> </span>for<span class="_"> </span><span class="ffd">addvec<span class="_ _11"> </span></span>(<span class="ffd">0x1</span>)<span class="_"> </span>onto<span class="_ _11"> </span>the<span class="_ _11"> </span>stack,<span class="_"> </span><span class="ffd">PLT[2]<span class="_ _11"> </span></span>jumps<span class="_"> </span>to</span></div><div class="t m5 x30 h26 y624a ffd fs19 fc2 sc0 ls0 ws0">PLT[0]<span class="ff7">.</span></div><div class="t m5 x72 h26 y624b ffa fs19 fc2 sc0 ls0 ws0">Step<span class="_ _16"> </span>4.<span class="_ _15"> </span><span class="ffd">PLT[0]<span class="_ _16"> </span><span class="ff7">pushes<span class="_ _16"> </span>an<span class="_ _16"> </span>argument<span class="_ _11"> </span>for<span class="_ _16"> </span>the<span class="_ _16"> </span>dynamic<span class="_ _11"> </span>linker<span class="_ _16"> </span>indirectly<span class="_ _16"> </span>through</span></span></div><div class="t m5 x30 h26 y624c ffd fs19 fc2 sc0 ls0 ws0">GOT[1]<span class="_ _6"> </span><span class="ff7">and<span class="_ _6"> </span>then<span class="_ _6"> </span>jumps<span class="_ _13"> </span>into<span class="_ _a"> </span>the<span class="_ _13"> </span>dynamic<span class="_ _a"> </span>linker<span class="_ _6"> </span>indirectly<span class="_ _13"> </span>through<span class="_ _a"> </span></span>GOT[2]<span class="ff7">.</span></div><div class="t m5 x30 h26 y624d ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _f"> </span>dynamic<span class="_ _e"> </span>linker<span class="_ _21"> </span>uses<span class="_ _f"> </span>the<span class="_ _f"> </span>two<span class="_ _f"> </span>stack<span class="_ _e"> </span>entries<span class="_ _21"> </span>to<span class="_ _f"> </span>determine<span class="_ _f"> </span>the<span class="_ _f"> </span>run-</div><div class="t m5 x30 h26 y624e ff7 fs19 fc2 sc0 ls0 ws0">time<span class="_"> </span>location<span class="_"> </span>of<span class="_"> </span><span class="ffd">addvec</span>,<span class="_"> </span>overwrites<span class="_"> </span><span class="ffd">GOT[4]<span class="_ _10"> </span></span>with<span class="_"> </span>this<span class="_"> </span>address<span class="_ _1"></span>,<span class="_"> </span>and<span class="_"> </span>passes</div><div class="t m5 x30 h26 y624f ff7 fs19 fc2 sc0 ls0 ws0">control<span class="_"> </span>to<span class="_"> </span><span class="ffd">addvec</span>.</div><div class="t m5 x26 h26 y6250 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _e"> </span>7.19(b)<span class="_ _e"> </span>shows<span class="_ _e"> </span>the<span class="_ _f"> </span>control<span class="_ _e"> </span>ﬂow<span class="_ _e"> </span>for<span class="_ _f"> </span>any<span class="_ _e"> </span>subsequent<span class="_ _e"> </span>invocations<span class="_ _e"> </span>of</div><div class="t m5 x17 h26 y6251 ffd fs19 fc2 sc0 ls0 ws0">addvec<span class="ff7">:</span></div><div class="t m5 x62 h26 y6252 ffa fs19 fc2 sc0 ls0 ws0">Step<span class="_"> </span>1.<span class="_ _21"> </span><span class="ff7">Control<span class="_"> </span>passes<span class="_"> </span>to<span class="_"> </span><span class="ffd">PLT[2]<span class="_ _10"> </span></span>as<span class="_"> </span>before.</span></div><div class="t m5 x62 h26 y6253 ffa fs19 fc2 sc0 ls0 ws0">Step<span class="_"> </span>2.<span class="_ _21"> </span><span class="ff7">However,<span class="_"> </span>this<span class="_ _11"> </span>time<span class="_"> </span>the<span class="_ _11"> </span>indirect<span class="_ _11"> </span>jump<span class="_"> </span>through<span class="_ _11"> </span><span class="ffd">GOT[4]<span class="_ _10"> </span></span>transfers<span class="_ _11"> </span>control</span></div><div class="t m5 x30 h26 y6254 ff7 fs19 fc2 sc0 ls0 ws0">directly<span class="_"> </span>to<span class="_"> </span><span class="ffd">addvec</span>.</div><div class="t m5 x17 h3b y1672 fff fs24 fc6 sc0 ls0 ws0">7.13<span class="_ _17"> </span><span class="ffe fs18">Librar<span class="_ _2"></span>y<span class="_"> </span>Interpositioning</span></div><div class="t m5 x17 h26 y77e ff7 fs19 fc1 sc0 ls0 ws0">Linux<span class="_ _16"> </span>linkers<span class="_ _16"> </span>support<span class="_ _16"> </span>a<span class="_ _16"> </span>powerful<span class="_ _16"> </span>technique,<span class="_ _16"> </span>called<span class="_ _16"> </span><span class="ffa">library<span class="_ _16"> </span>interpositioning<span class="_ _2"></span></span>,<span class="_ _14"> </span>that</div><div class="t m5 x17 h26 y77f ff7 fs19 fc1 sc0 ls0 ws0">allows<span class="_ _13"> </span>you<span class="_ _6"> </span>to<span class="_ _13"> </span>intercept<span class="_ _6"> </span>calls<span class="_ _13"> </span>to<span class="_ _6"> </span>shared<span class="_ _13"> </span>library<span class="_ _6"> </span>functions<span class="_ _13"> </span>and<span class="_ _6"> </span>execute<span class="_ _13"> </span>your<span class="_ _6"> </span>own<span class="_ _13"> </span>code</div><div class="t m5 x17 h26 y2c86 ff7 fs19 fc1 sc0 ls0 ws0">instead.<span class="_"> </span>Using<span class="_"> </span>interpositioning,<span class="_"> </span>you<span class="_"> </span>could<span class="_ _11"> </span>trace<span class="_"> </span>the<span class="_ _11"> </span>number<span class="_"> </span>of<span class="_"> </span>times<span class="_ _11"> </span>a<span class="_"> </span>particular</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
