<div id="pf328" class="pf w2 h11" data-page-no="328"><div class="pc pc328 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg328.png"/><div class="t m5 x1e0 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>8.5<span class="_ _60"> </span>Signals<span class="_ _3e"> </span><span class="ffe fs1e">807</span></div><div class="t m5 x12f h2c y27f ffa fs16 fc2 sc0 ls0 ws0">code/ecf/signal1.c</div><div class="t m5 x2c h2d y280 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">/*<span class="_ _1f"> </span>WARNING:<span class="_ _e"> </span>This<span class="_ _1f"> </span>code<span class="_ _1f"> </span>is<span class="_ _e"> </span>buggy!<span class="_ _1f"> </span>*/</span></div><div class="t m5 x2c h2e y281 ff6 fs20 fc6 sc0 ls0 ws0">2</div><div class="t m5 x2c h2e y282 ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x2d h2d y283 ffd fs1e fc2 sc0 ls0 ws0">void<span class="_ _e"> </span>handler1(int<span class="_ _1f"> </span>sig)</div><div class="t m5 x2c h2d y284 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x2c h2d y285 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _20"> </span><span class="ffd fs1e fc2">int<span class="_ _e"> </span>olderrno<span class="_ _1f"> </span>=<span class="_ _1f"> </span>errno;</span></div><div class="t m5 x2c h2e y286 ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 x2c h2e y6298 ff6 fs20 fc6 sc0 ls0 ws0">7</div><div class="t m5 x142 h2d y287 ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>((waitpid(-1,<span class="_ _1f"> </span>NULL,<span class="_ _1f"> </span>0))<span class="_ _e"> </span>&lt;<span class="_ _1f"> </span>0)</div><div class="t m5 x2c h2d y4493 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _70"> </span><span class="ffd fs1e fc2">sio_error(&quot;waitpid<span class="_ _e"> </span>error&quot;);</span></div><div class="t m5 x2c h2d y4a9a ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _20"> </span><span class="ffd fs1e fc2">Sio_puts(&quot;Handler<span class="_ _e"> </span>reaped<span class="_ _1f"> </span>child\n&quot;);</span></div><div class="t m5 x17 h2d y4a9b ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _20"> </span><span class="ffd fs1e fc2">Sleep(1);</span></div><div class="t m5 x17 h2d y4a9c ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _20"> </span><span class="ffd fs1e fc2">errno<span class="_ _e"> </span>=<span class="_ _1f"> </span>olderrno;</span></div><div class="t m5 x17 h2d y906 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x17 h2e y4a9d ff6 fs20 fc6 sc0 ls0 ws0">13</div><div class="t m5 x17 h2e y66b5 ff6 fs20 fc6 sc0 ls0 ws0">14</div><div class="t m5 x2d h2d y4a9e ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>main()</div><div class="t m5 x17 h2d y4a9f ff6 fs20 fc6 sc0 ls0 ws0">15<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x17 h2d y417 ff6 fs20 fc6 sc0 ls0 ws0">16<span class="_ _20"> </span><span class="ffd fs1e fc2">int<span class="_ _e"> </span>i,<span class="_ _1f"> </span>n;</span></div><div class="t m5 x17 h2d y4aa0 ff6 fs20 fc6 sc0 ls0 ws0">17<span class="_ _20"> </span><span class="ffd fs1e fc2">char<span class="_ _e"> </span>buf[MAXBUF];</span></div><div class="t m5 x17 h2e yeb4 ff6 fs20 fc6 sc0 ls0 ws0">18</div><div class="t m5 x17 h2e y6997 ff6 fs20 fc6 sc0 ls0 ws0">19</div><div class="t m5 x142 h2d y2a2b ffd fs1e fc2 sc0 ls0 ws0">if<span class="_ _e"> </span>(signal(SIGCHLD,<span class="_ _1f"> </span>handler1)<span class="_ _1f"> </span>==<span class="_ _e"> </span>SIG_ERR)</div><div class="t m5 x17 h2d y1ab8 ff6 fs20 fc6 sc0 ls0 ws0">20<span class="_ _70"> </span><span class="ffd fs1e fc2">unix_error(&quot;signal<span class="_ _e"> </span>error&quot;);</span></div><div class="t m5 x17 h2e y94f ff6 fs20 fc6 sc0 ls0 ws0">21</div><div class="t m5 x17 h2e y6998 ff6 fs20 fc6 sc0 ls0 ws0">22</div><div class="t m5 x142 h2d y4aa1 ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Parent<span class="_ _1f"> </span>creates<span class="_ _1f"> </span>children<span class="_ _e"> </span>*/</div><div class="t m5 x17 h2d y3228 ff6 fs20 fc6 sc0 ls0 ws0">23<span class="_ _20"> </span><span class="ffd fs1e fc2 ls33">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>i=0<span class="_ _41"></span>;i&lt;3<span class="_ _41"></span>;<span class="ls0">i++)<span class="_ _e"> </span>{</span></span></div><div class="t m5 x17 h2d y35d ff6 fs20 fc6 sc0 ls0 ws0">24<span class="_ _70"> </span><span class="ffd fs1e fc2">if<span class="_ _e"> </span>(Fork()<span class="_ _1f"> </span>==<span class="_ _1f"> </span>0)<span class="_ _e"> </span>{</span></div><div class="t m5 x17 h2e y4aa3 ff6 fs20 fc6 sc0 ls0 ws0">25</div><div class="t m5 x162 h2d y3229 ffd fs1e fc2 sc0 ls0 ws0">printf(&quot;Hello<span class="_ _e"> </span>from<span class="_ _1f"> </span>child<span class="_ _1f"> </span>%d\n&quot;,<span class="_ _e"> </span>(int)getpid());</div><div class="t m5 x17 h2d y2467 ff6 fs20 fc6 sc0 ls0 ws0">26<span class="_ _d1"> </span><span class="ffd fs1e fc2">exit(0);</span></div><div class="t m5 x17 h2d y322b ff6 fs20 fc6 sc0 ls0 ws0">27<span class="_ _70"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x17 h2d y322c ff6 fs20 fc6 sc0 ls0 ws0">28<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x17 h2e y441 ff6 fs20 fc6 sc0 ls0 ws0">29</div><div class="t m5 x17 h2e y6999 ff6 fs20 fc6 sc0 ls0 ws0">30</div><div class="t m5 x142 h2d y2c5c ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Parent<span class="_ _1f"> </span>waits<span class="_ _1f"> </span>for<span class="_ _e"> </span>terminal<span class="_ _1f"> </span>input<span class="_ _e"> </span>and<span class="_ _1f"> </span>then<span class="_ _1f"> </span>processes<span class="_ _e"> </span>it<span class="_ _1f"> </span>*/</div><div class="t m5 x17 h2d y322d ff6 fs20 fc6 sc0 ls0 ws0">31<span class="_ _20"> </span><span class="ffd fs1e fc2">if<span class="_ _e"> </span>((n<span class="_ _1f"> </span>=<span class="_ _1f"> </span>read(STDIN_FILENO,<span class="_ _e"> </span>buf,<span class="_ _1f"> </span>sizeof(buf)))<span class="_ _e"> </span>&lt;<span class="_ _1f"> </span>0)</span></div><div class="t m5 x17 h2d y24a ff6 fs20 fc6 sc0 ls0 ws0">32<span class="_ _70"> </span><span class="ffd fs1e fc2">unix_error(&quot;read&quot;);</span></div><div class="t m5 x17 h2e y8f9 ff6 fs20 fc6 sc0 ls0 ws0">33</div><div class="t m5 x17 h2e y677d ff6 fs20 fc6 sc0 ls0 ws0">34</div><div class="t m5 x142 h2d y5fd ffd fs1e fc2 sc0 ls0 ws0">printf(&quot;Parent<span class="_ _e"> </span>processing<span class="_ _1f"> </span>input\n&quot;);</div><div class="t m5 x17 h2d y4aa5 ff6 fs20 fc6 sc0 ls0 ws0">35<span class="_ _20"> </span><span class="ffd fs1e fc2">while<span class="_ _e"> </span>(1)</span></div><div class="t m5 x17 h2e y22d4 ff6 fs20 fc6 sc0 ls0 ws0">36</div><div class="t m5 xc5 h2d y74d ffd fs1e fc2 sc0 ls0 ws0">;</div><div class="t m5 x17 h2e y277 ff6 fs20 fc6 sc0 ls0 ws0">37</div><div class="t m5 x17 h2e y699a ff6 fs20 fc6 sc0 ls0 ws0">38</div><div class="t m5 x142 h2d y2269 ffd fs1e fc2 sc0 ls0 ws0">exit(0);</div><div class="t m5 x17 h2d y226b ff6 fs20 fc6 sc0 ls0 ws0">39<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x12f h2c y4aa6 ffa fs16 fc2 sc0 ls0 ws0">code/ecf/signal1.c</div><div class="t m5 x17 h2f y4aa7 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _14"> </span>8.36</div><div class="t m5 x8e h3a y699b ffd fs19 fc1 sc0 ls0 ws0">signal1<span class="ffe fs16">.<span class="_ _14"> </span><span class="ff6">This<span class="_ _15"> </span>program<span class="_ _15"> </span>is<span class="_ _15"> </span>ï¬‚awed<span class="_ _15"> </span>because<span class="_ _15"> </span>it<span class="_ _14"> </span>assumes<span class="_ _15"> </span>that<span class="_ _15"> </span>signals<span class="_ _15"> </span>are</span></span></div><div class="t m5 x17 h34 y699c ff6 fs16 fc1 sc0 ls0 ws0">queued.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
