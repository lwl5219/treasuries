<div id="pf130" class="pf w2 h11" data-page-no="130"><div class="pc pc130 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg130.png"/><div class="t m5 xa1 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>3.9<span class="_ _60"> </span>Heterogeneous<span class="_ _10"> </span>Data<span class="_ _10"> </span>Structures<span class="_ _3e"> </span><span class="ffe fs1e">303</span></div><div class="t m5 x34 h2a y257 fff fs1c fc2 sc0 ls0 ws0">New<span class="_ _16"> </span>to<span class="_ _16"> </span>C?<span class="_ _1b"> </span><span class="ff6 fs19">Representing<span class="_ _11"> </span>an<span class="_ _11"> </span>object<span class="_ _16"> </span>as<span class="_ _11"> </span>a<span class="_ _11"> </span><span class="ffd fs2b">struct<span class="_ _16"> </span></span><span class="ffb">(continued)</span></span></div><div class="t m5 x35 h2b y2d0 ff7 fs1e fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _11"> </span>objects<span class="_ _16"> </span>of<span class="_ _10"> </span>C++<span class="_ _16"> </span>and<span class="_ _10"> </span>J<span class="_ _1"></span>ava<span class="_ _11"> </span>are<span class="_ _11"> </span>more<span class="_ _11"> </span>elaborate<span class="_ _16"> </span>than<span class="_ _10"> </span>structures<span class="_ _16"> </span>in<span class="_ _11"> </span>C<span class="_ _0"></span>,<span class="_ _11"> </span>in<span class="_ _11"> </span>that<span class="_ _11"> </span>they<span class="_ _11"> </span>also<span class="_ _16"> </span>associate</div><div class="t m5 x34 h2b y2d1 ff7 fs1e fc2 sc0 ls0 ws0">a<span class="_ _11"> </span>set<span class="_ _11"> </span>of<span class="_ _11"> </span><span class="ffa">methods<span class="_ _16"> </span></span>with<span class="_ _10"> </span>an<span class="_ _16"> </span>object<span class="_ _11"> </span>that<span class="_ _11"> </span>can<span class="_ _11"> </span>be<span class="_ _11"> </span>invoked<span class="_ _11"> </span>to<span class="_ _16"> </span>perform<span class="_ _10"> </span>computation.<span class="_ _16"> </span>In<span class="_ _11"> </span>C<span class="_ _0"></span>,<span class="_ _11"> </span>we<span class="_ _16"> </span>would<span class="_ _10"> </span>simply</div><div class="t m5 x34 h2b y2d2 ff7 fs1e fc2 sc0 ls0 ws0">write<span class="_"> </span>these<span class="_"> </span>as<span class="_"> </span>ordinary<span class="_"> </span>functions<span class="_ _1"></span>,<span class="_"> </span>such<span class="_"> </span>as<span class="_"> </span>the<span class="_"> </span>functions<span class="_"> </span><span class="ffd">area<span class="_ _10"> </span></span>and<span class="_"> </span><span class="ffd">rotate_left<span class="_ _10"> </span></span>shown<span class="_"> </span>previously<span class="_ _7"></span>.</div><div class="t m5 x17 h26 y2bcc ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_"> </span>type<span class="_"> </span><span class="ffd">struct<span class="_ _16"> </span>rec<span class="_ _11"> </span>*<span class="_ _11"> </span></span>is<span class="_"> </span>in<span class="_"> </span>register<span class="_"> </span><span class="ffd">%rdi</span>.<span class="_ _11"> </span>T<span class="_ _1"></span>hen<span class="_ _11"> </span>the<span class="_"> </span>following<span class="_"> </span>code<span class="_"> </span>copies<span class="_ _11"> </span>element</div><div class="t m5 x17 h26 y2bcd ffd fs19 fc2 sc0 ls0 ws0">r-&gt;i<span class="_ _10"> </span><span class="ff7">to<span class="_"> </span>element<span class="_"> </span></span>r-&gt;j<span class="ff7">:</span></div><div class="t m5 xd1 h61 y2bce ff13 fs35 fc6 sc0 ls0 ws0">Registers:<span class="_ _f"> </span>r<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi</div><div class="t m5 x2c h2d y2bcf ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _45"> </span><span class="ffd fs1e fc2">movl<span class="_ _46"> </span>(%rdi),<span class="_ _e"> </span>%eax<span class="_ _5d"> </span></span><span class="ff13 fs35">Get<span class="_ _f"> </span>r-&gt;i</span></div><div class="t m5 x2c h2d y2bd0 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">movl<span class="_ _46"> </span>%eax,<span class="_ _e"> </span>4(%rdi)<span class="_ _2a"> </span></span><span class="ff13 fs35">Store<span class="_ _f"> </span>in<span class="_ _f"> </span>r-&gt;j</span></div><div class="t m5 x17 h26 y2bd1 ff7 fs19 fc2 sc0 ls0 ws0">Since<span class="_"> </span>the<span class="_"> </span>offset<span class="_"> </span>of<span class="_ _11"> </span>ﬁeld<span class="_"> </span><span class="ffd">i<span class="_ _11"> </span></span>is<span class="_"> </span>0,<span class="_"> </span>the<span class="_"> </span>address<span class="_ _11"> </span>of<span class="_"> </span>this<span class="_"> </span>ﬁeld<span class="_ _11"> </span>is<span class="_"> </span>simply<span class="_"> </span>the<span class="_"> </span>value<span class="_ _11"> </span>of<span class="_"> </span><span class="ffd">r</span><span class="ls17b">.T<span class="_ _42"></span>o</span></div><div class="t m5 x17 h26 y2bd2 ff7 fs19 fc2 sc0 ls0 ws0">store<span class="_"> </span>into<span class="_"> </span>ﬁeld<span class="_"> </span><span class="ffd">j</span>,<span class="_"> </span>the<span class="_"> </span>code<span class="_"> </span>adds<span class="_"> </span>offset<span class="_"> </span>4<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>address<span class="_"> </span>of<span class="_"> </span><span class="ffd">r</span>.</div><div class="t m5 x26 h26 y2bd3 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_ _16"> </span>generate<span class="_"> </span>a<span class="_ _11"> </span>pointer<span class="_ _16"> </span>to<span class="_"> </span>an<span class="_ _11"> </span>object<span class="_ _16"> </span>within<span class="_"> </span>a<span class="_ _16"> </span>structure<span class="_ _1"></span>,<span class="_ _11"> </span>we<span class="_ _11"> </span>can<span class="_ _16"> </span>simply<span class="_"> </span>add<span class="_ _16"> </span>the</div><div class="t m5 x17 h26 y2bd4 ff7 fs19 fc2 sc0 ls0 ws0">ﬁeld’s<span class="_ _11"> </span>offset<span class="_ _16"> </span>to<span class="_ _16"> </span>the<span class="_ _16"> </span>structure<span class="_ _16"> </span>address<span class="_ _1"></span>.<span class="_ _16"> </span>F<span class="_ _1"></span>or<span class="_ _16"> </span>example<span class="_ _1"></span>,<span class="_ _16"> </span>we<span class="_ _16"> </span>can<span class="_ _16"> </span>generate<span class="_ _16"> </span>the<span class="_ _16"> </span>pointer</div><div class="t m5 x17 h46 y2bd5 ffd fs19 fc2 sc0 ls0 ws0">&amp;(r-&gt;a[1])<span class="_ _13"> </span><span class="ff7">by<span class="_ _13"> </span>adding<span class="_ _13"> </span>offset<span class="_ _13"> </span>8<span class="_ _13"> </span><span class="ff12">+<span class="_ _13"></span></span>4</span></div><div class="t m5 x22 h45 y2bd6 ff11 fs19 fc2 sc0 ls0 ws0">.</div><div class="t m5 x167 h46 y2bd5 ff7 fs19 fc2 sc0 ls0 ws0">1<span class="_ _6"> </span><span class="ff12">=<span class="_ _13"></span></span>12.<span class="_ _13"> </span>F<span class="_ _0"></span>or<span class="_ _13"> </span>pointer<span class="_ _13"> </span><span class="ffd">r<span class="_ _13"> </span></span>in<span class="_ _13"> </span>register<span class="_ _13"> </span><span class="ffd">%rdi<span class="_ _13"> </span></span>and<span class="_ _13"> </span>long</div><div class="t m5 x17 h26 y2bd7 ff7 fs19 fc2 sc0 ls0 ws0">integer<span class="_ _13"> </span>variable<span class="_"> </span><span class="ffd">i<span class="_ _13"> </span></span>in<span class="_ _13"> </span>register<span class="_"> </span><span class="ffd">%rsi</span>,<span class="_ _13"> </span>we<span class="_"> </span>can<span class="_ _13"> </span>generate<span class="_ _13"> </span>the<span class="_"> </span>pointer<span class="_ _13"> </span>value<span class="_ _13"> </span><span class="ffd">&amp;(r-&gt;a[i])</span></div><div class="t m5 x17 h26 y2bd8 ff7 fs19 fc2 sc0 ls0 ws0">with<span class="_"> </span>the<span class="_"> </span>single<span class="_"> </span>instruction</div><div class="t m5 xd1 h61 y2bd9 ff13 fs35 fc6 sc0 ls0 ws0">Registers:<span class="_ _f"> </span>r<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi,<span class="_ _e"> </span>i<span class="_ _21"> </span>%rsi</div><div class="t m5 x2c h2d y2bda ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _45"> </span><span class="ffd fs1e fc2">leaq<span class="_ _46"> </span>8(%rdi,%rsi,4),<span class="_ _e"> </span>%rax<span class="_ _f1"> </span></span><span class="ff13 fs35">Set<span class="_ _f"> </span>%rax<span class="_ _f"> </span>to<span class="_ _f"> </span>&amp;r-&gt;a[i]</span></div><div class="t m5 x26 h26 y2bdb ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_"> </span>a<span class="_"> </span>ﬁnal<span class="_"> </span>example<span class="_ _1"></span>,<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>code<span class="_"> </span>implements<span class="_"> </span>the<span class="_"> </span>statement</div><div class="t m5 x1b6 h2d y2bdc ffd fs1e fc2 sc0 ls0 ws0">r-&gt;p<span class="_ _e"> </span>=<span class="_ _1f"> </span>&amp;r-&gt;a[r-&gt;i<span class="_ _1f"> </span>+<span class="_ _e"> </span>r-&gt;j];</div><div class="t m5 x17 h26 y2bdd ff7 fs19 fc2 sc0 ls0 ws0">starting<span class="_"> </span>with<span class="_"> </span><span class="ffd">r<span class="_ _10"> </span></span>in<span class="_"> </span>register<span class="_"> </span><span class="ffd">%rdi</span>:</div><div class="t m5 xd1 h61 y2bde ff13 fs35 fc6 sc0 ls0 ws0">Registers:<span class="_ _f"> </span>r<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi</div><div class="t m5 x2c h2d y2bdf ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _45"> </span><span class="ffd fs1e fc2">movl<span class="_ _46"> </span>4(%rdi),<span class="_ _e"> </span>%eax<span class="_ _107"> </span></span><span class="ff13 fs35">Get<span class="_ _f"> </span>r-&gt;j</span></div><div class="t m5 x2c h2d y2be0 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">addl<span class="_ _46"> </span>(%rdi),<span class="_ _e"> </span>%eax<span class="_ _13b"> </span></span><span class="ff13 fs35">Add<span class="_ _f"> </span>r-&gt;i</span></div><div class="t m5 x2c h2d y2be1 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">cltq<span class="_ _174"> </span></span><span class="ff13 fs35">Extend<span class="_ _f"> </span>to<span class="_ _f"> </span>8<span class="_ _f"> </span>bytes</span></div><div class="t m5 x2c h2d y2be2 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">leaq<span class="_ _46"> </span>8(%rdi,%rax,4),<span class="_ _e"> </span>%rax<span class="_ _59"> </span></span><span class="ff13 fs35">Compute<span class="_ _f"> </span>&amp;r-&gt;a[r-&gt;i<span class="_ _e"> </span>+<span class="_ _21"> </span>r-&gt;j]</span></div><div class="t m5 x2c h2e y2be3 ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 xd1 h2d y2be4 ffd fs1e fc2 sc0 ls0 ws0">movq<span class="_ _46"> </span>%rax,<span class="_ _e"> </span>16(%rdi)<span class="_ _12b"> </span><span class="ff13 fs35 fc6">Store<span class="_ _e"> </span>in<span class="_ _21"> </span>r-&gt;p</span></div><div class="t m5 x26 h26 ye14 ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_"> </span>these<span class="_ _11"> </span>examples<span class="_ _11"> </span>show<span class="_ _3"></span>,<span class="_ _11"> </span>the<span class="_ _11"> </span>selection<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>different<span class="_"> </span>ﬁelds<span class="_ _11"> </span>of<span class="_ _11"> </span>a<span class="_ _11"> </span>structure<span class="_ _11"> </span>is</div><div class="t m5 x17 h26 ye15 ff7 fs19 fc2 sc0 ls0 ws0">handled<span class="_ _11"> </span>completely<span class="_ _11"> </span>at<span class="_ _11"> </span>compile<span class="_ _11"> </span>time<span class="_ _0"></span>.<span class="_ _11"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span>machine<span class="_"> </span>code<span class="_ _11"> </span>contains<span class="_ _11"> </span>no<span class="_ _11"> </span>information</div><div class="t m5 x17 h26 ye16 ff7 fs19 fc2 sc0 ls0 ws0">about<span class="_"> </span>the<span class="_"> </span>ﬁeld<span class="_"> </span>declarations<span class="_"> </span>or<span class="_"> </span>the<span class="_"> </span>names<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>ﬁelds<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
