<div id="pf2e1" class="pf w2 h11" data-page-no="2e1"><div class="pc pc2e1 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg2e1.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">736<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>7<span class="_ _3d"> </span>Linking</span></div><div class="t m5 x14 h2f ye7 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>7.16</div><div class="t m5 x14 h2f y58a ffe fs16 fc1 sc0 ls0 ws0">Dynamic<span class="_ _16"> </span>linking<span class="_ _14"> </span>with</div><div class="t m5 x14 h2f y58b ffe fs16 fc1 sc0 ls0 ws0">shared<span class="_"> </span>libraries.</div><div class="t m5 xe4 h40 y40ec ff8d fs28 fc1 sc0 ls0 ws0">main2.c</div><div class="t m5 xde h40 y6150 ff8d fs28 fc1 sc0 ls0 ws0">libc.so</div><div class="t m5 x6c h40 y6151 ff8d fs28 fc1 sc0 ls0 ws0">libvector.so</div><div class="t m5 xde h40 y6152 ff8d fs28 fc1 sc0 ls0 ws0">libc.so</div><div class="t m5 x6c h40 y6153 ff8d fs28 fc1 sc0 ls0 ws0">libvector.so</div><div class="t m5 x122 h40 y6154 ff8d fs28 fc1 sc0 ls0 ws0">main2.o</div><div class="t m5 x101 h40 y6155 ff8d fs28 fc1 sc0 ls0 ws0">prog2l</div><div class="t m5 x181 h3f y6156 ff8e fs27 fc1 sc0 ls0 ws0">T<span class="_ _0"></span>ranslators</div><div class="t m5 x180 h40 y6157 ff8e fs27 fc1 sc0 ls0 ws0">(<span class="ff8d fs28">cpp,cc1,as</span>)</div><div class="t m5 x40 h3f y6158 ff8e fs27 fc1 sc0 ls0 ws0">Linker (</div><div class="t m5 x170 h40 y6159 ff8d fs28 fc1 sc0 ls0 ws0">ld<span class="ff8e fs27">)</span></div><div class="t m5 xa5 h3f y615a ff80 fs27 fc1 sc0 ls0 ws0">Fully linked</div><div class="t m5 xe0 h3f y615b ff80 fs27 fc1 sc0 ls0 ws0">ex<span class="_ _1"></span>ecutable in memory</div><div class="t m5 xab h3f y615c ff80 fs27 fc1 sc0 ls0 ws0">P<span class="_ _0"></span>ar<span class="_ _2"></span>tially link<span class="_ _0"></span>ed</div><div class="t m5 x7c h3f y615d ff80 fs27 fc1 sc0 ls0 ws0">ex<span class="_ _1"></span>ecutable object file</div><div class="t m5 xb1 h40 y40ec ff8d fs28 fc1 sc0 ls0 ws0">vector.h</div><div class="t m5 x130 h3f y615e ff8e fs27 fc1 sc0 ls0 ws0">Loader</div><div class="t m5 x20c h40 y615f ff8e fs27 fc1 sc0 ls0 ws0">(<span class="ff8d fs28">execve</span>)</div><div class="t m5 x24e h40 y6160 ff8e fs27 fc1 sc0 ls0 ws0">Dynamic linker (<span class="ff8d fs28">ld-linux.so</span>)</div><div class="t m5 xed h3f y6161 ff80 fs27 fc1 sc0 ls0 ws0">Relocatable</div><div class="t m5 xec h3f y6162 ff80 fs27 fc1 sc0 ls0 ws0">object file</div><div class="t m5 x1ca h3f y6163 ff80 fs27 fc1 sc0 ls0 ws0">Relocation and</div><div class="t m5 x1ca h3f y6164 ff80 fs27 fc1 sc0 ls0 ws0">symbol table inf</div><div class="c xe0 y6165 w24 hf0"><div class="t m5 x10f h3f y6166 ff80 fs27 fc1 sc0 ls0 ws0">o</div></div><div class="t m5 xb6 h3f y6167 ff80 fs27 fc1 sc0 ls0 ws0">Code and data</div><div class="t m5 x1d h26 y6168 ff7 fs19 fc1 sc0 ls0 ws0">object<span class="_ _6"> </span>ﬁle<span class="_ _1"></span>.<span class="_ _13"> </span>Once<span class="_ _a"> </span>we<span class="_ _6"> </span>have<span class="_ _6"> </span>created<span class="_ _6"> </span>the<span class="_ _6"> </span>library<span class="_ _3"></span>,<span class="_ _13"> </span>we<span class="_ _a"> </span>would<span class="_ _6"> </span>then<span class="_ _6"> </span>link<span class="_ _6"> </span>it<span class="_ _6"> </span>into<span class="_ _6"> </span>our<span class="_ _6"> </span>example</div><div class="t m5 x1d h26 y6169 ff7 fs19 fc1 sc0 ls0 ws0">program<span class="_"> </span>in<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>7.7:</div><div class="t m5 x1d h2d y616a ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">gcc<span class="_ _1f"> </span>-o<span class="_ _1f"> </span>prog2l<span class="_ _e"> </span>main2.c<span class="_ _1f"> </span>./libvector.so</span></div><div class="t m5 x1d h26 y616b ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _14"> </span>creates<span class="_ _14"> </span>an<span class="_ _16"> </span>executable<span class="_ _14"> </span>object<span class="_ _14"> </span>ﬁle<span class="_ _16"> </span><span class="ffd">prog2l<span class="_ _14"> </span></span>in<span class="_ _14"> </span>a<span class="_ _16"> </span>form<span class="_ _14"> </span>that<span class="_ _14"> </span>can<span class="_ _16"> </span>be<span class="_ _14"> </span>linked<span class="_ _14"> </span>with</div><div class="t m5 x1d h26 y616c ffd fs19 fc2 sc0 ls0 ws0">libvector.so<span class="_ _16"> </span><span class="ff7">at<span class="_ _11"> </span>run<span class="_ _16"> </span>time<span class="_ _0"></span>.<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span>basic<span class="_ _16"> </span>idea<span class="_ _11"> </span>is<span class="_ _16"> </span>to<span class="_ _16"> </span>do<span class="_ _16"> </span>some<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>linking<span class="_ _11"> </span>statically</span></div><div class="t m5 x1d h26 y616d ff7 fs19 fc2 sc0 ls0 ws0">when<span class="_ _13"> </span>the<span class="_ _6"> </span>executable<span class="_ _13"> </span>ﬁle<span class="_ _13"> </span>is<span class="_ _6"> </span>created,<span class="_ _13"> </span>and<span class="_ _13"> </span>then<span class="_ _6"> </span>complete<span class="_ _13"> </span>the<span class="_ _13"> </span>linking<span class="_ _6"> </span>process<span class="_ _13"> </span>dynami-</div><div class="t m5 x1d h26 y616e ff7 fs19 fc2 sc0 ls0 ws0">cally<span class="_ _13"> </span>when<span class="_ _6"> </span>the<span class="_ _13"> </span>program<span class="_ _6"> </span>is<span class="_ _13"> </span>loaded.<span class="_ _6"> </span>It<span class="_ _13"> </span>is<span class="_ _6"> </span>important<span class="_ _13"> </span>to<span class="_ _6"> </span>realize<span class="_ _13"> </span>that<span class="_ _6"> </span>none<span class="_ _13"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>code<span class="_ _6"> </span>or</div><div class="t m5 x1d h26 y616f ff7 fs19 fc2 sc0 ls0 ws0">data<span class="_"> </span>sections<span class="_"> </span>from<span class="_"> </span><span class="ffd">libvector.so<span class="_ _10"> </span></span>are<span class="_"> </span>actually<span class="_"> </span>copied<span class="_"> </span>into<span class="_ _13"> </span>the<span class="_"> </span>executable<span class="_"> </span><span class="ffd">prog2l</span></div><div class="t m5 x1d h26 y6170 ff7 fs19 fc2 sc0 ls0 ws0">at<span class="_ _13"> </span>this<span class="_ _13"> </span>point.<span class="_ _13"> </span>Instead,<span class="_ _13"> </span>the<span class="_ _13"> </span>linker<span class="_ _13"> </span>copies<span class="_ _13"> </span>some<span class="_ _13"> </span>relocation<span class="_ _13"> </span>and<span class="_ _13"> </span>symbol<span class="_ _13"> </span>table<span class="_ _13"> </span>informa-</div><div class="t m5 x1d h26 y6171 ff7 fs19 fc2 sc0 ls0 ws0">tion<span class="_ _11"> </span>that<span class="_ _16"> </span>will<span class="_ _11"> </span>allow<span class="_ _11"> </span>references<span class="_ _16"> </span>to<span class="_ _11"> </span>code<span class="_ _11"> </span>and<span class="_ _16"> </span>data<span class="_ _11"> </span>in<span class="_ _11"> </span><span class="ffd">libvector.so<span class="_ _16"> </span></span>to<span class="_ _11"> </span>be<span class="_ _11"> </span>resolved</div><div class="t m5 x1d h26 y6172 ff7 fs19 fc2 sc0 ls0 ws0">at<span class="_"> </span>load<span class="_"> </span>time<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y6173 ff7 fs19 fc2 sc0 ls0 ws0">When<span class="_"> </span>the<span class="_"> </span>loader<span class="_"> </span>loads<span class="_"> </span>and<span class="_ _11"> </span>runs<span class="_"> </span>the<span class="_"> </span>executable<span class="_ _11"> </span><span class="ffd">prog2l</span>,<span class="_"> </span>it<span class="_"> </span>loads<span class="_ _11"> </span>the<span class="_"> </span>partially</div><div class="t m5 x1d h26 y6174 ff7 fs19 fc2 sc0 ls0 ws0">linked<span class="_ _11"> </span>executable<span class="_ _11"> </span><span class="ffd">prog2l</span>,<span class="_ _11"> </span>using<span class="_ _11"> </span>the<span class="_ _11"> </span>techniques<span class="_ _11"> </span>discussed<span class="_ _16"> </span>in<span class="_"> </span>Section<span class="_ _11"> </span>7.9.<span class="_ _11"> </span>Next,<span class="_ _16"> </span>it</div><div class="t m5 x1d h26 y6175 ff7 fs19 fc2 sc0 ls0 ws0">notices<span class="_"> </span>that<span class="_"> </span><span class="ffd">prog2l<span class="_ _10"> </span></span>contains<span class="_"> </span>a<span class="_"> </span><span class="ffd">.interp<span class="_ _10"> </span></span>section,<span class="_"> </span>which<span class="_"> </span>contains<span class="_"> </span>the<span class="_"> </span>path<span class="_"> </span>name<span class="_"> </span>of</div><div class="t m5 x1d h26 y6176 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _16"> </span>dynamic<span class="_ _14"> </span>linker,<span class="_ _14"> </span>which<span class="_ _16"> </span>is<span class="_ _14"> </span>itself<span class="_ _16"> </span>a<span class="_ _14"> </span>shared<span class="_ _14"> </span>object<span class="_ _16"> </span>(e.g<span class="_ _1"></span>.,<span class="_ _15"> </span><span class="ffd">ld-linux.so<span class="_ _16"> </span></span>on<span class="_ _14"> </span>Linux</div><div class="t m5 x1d h26 y6177 ff7 fs19 fc2 sc0 ls0 ws0">systems).<span class="_ _16"> </span>Instead<span class="_ _11"> </span>of<span class="_ _16"> </span>passing<span class="_ _16"> </span>control<span class="_ _16"> </span>to<span class="_ _16"> </span>the<span class="_ _11"> </span>application,<span class="_ _14"> </span>as<span class="_ _16"> </span>it<span class="_ _11"> </span>would<span class="_ _16"> </span>normally<span class="_ _16"> </span>do<span class="_ _1"></span>,</div><div class="t m5 x1d h26 y6178 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _13"> </span>loader<span class="_ _13"> </span>loads<span class="_ _13"> </span>and<span class="_ _13"> </span>runs<span class="_ _6"> </span>the<span class="_ _13"> </span>dynamic<span class="_ _13"> </span>linker.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span>dynamic<span class="_ _13"> </span>linker<span class="_ _13"> </span>then<span class="_ _13"> </span>ﬁnishes<span class="_ _13"> </span>the</div><div class="t m5 x1d h26 y6179 ff7 fs19 fc2 sc0 ls0 ws0">linking<span class="_"> </span>task<span class="_"> </span>by<span class="_"> </span>performing<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>relocations:</div><div class="t m5 x75 h3d y617a ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y2fb5 ff7 fs19 fc1 sc0 ls0 ws0">Relocating<span class="_"> </span>the<span class="_"> </span>text<span class="_"> </span>and<span class="_"> </span>data<span class="_"> </span>of<span class="_"> </span><span class="ffd">libc.so<span class="_ _10"> </span></span>into<span class="_"> </span>some<span class="_"> </span>memory<span class="_"> </span>segment</div><div class="t m5 x75 h3d y5b54 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y2a46 ff7 fs19 fc1 sc0 ls0 ws0">Relocating<span class="_ _13"> </span>the<span class="_ _13"> </span>text<span class="_ _13"> </span>and<span class="_ _13"> </span>data<span class="_ _13"> </span>of<span class="_ _13"> </span><span class="ffd">libvector.so<span class="_ _13"> </span></span>into<span class="_ _13"> </span>another<span class="_ _13"> </span>memory<span class="_ _13"> </span>segment</div><div class="t m5 x75 h3d y77d ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y77e ff7 fs19 fc1 sc0 ls0 ws0">Relocating<span class="_ _f"> </span>any<span class="_ _f"> </span>references<span class="_ _f"> </span>in<span class="_ _f"> </span><span class="ffd">prog2l<span class="_ _f"> </span></span>to<span class="_ _f"> </span>symbols<span class="_ _f"> </span>deﬁned<span class="_ _f"> </span>by<span class="_ _e"> </span><span class="ffd">libc.so<span class="_ _21"> </span></span>and</div><div class="t m5 x29 h3a y77f ffd fs19 fc1 sc0 ls0 ws0">libvector.so</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
