<div id="pf1db" class="pf w2 h11" data-page-no="1db"><div class="pc pc1db w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1db.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">474<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>4<span class="_ _3d"> </span>Processor<span class="_ _10"> </span>Architecture</span></div><div class="t m5 x180 h40 y41fb ff49 fs27 fc1 sc0 ls0 ws0">F<span class="_ _1c9"></span><span class="ff4a fs28">0x000: irmovq $10,%rdx</span></div><div class="t m5 x1d h40 y41fc ff4a fs28 fc1 sc0 ls0 ws0"># prog4</div><div class="c x1d y41fd w8 hb2"><div class="t m5 x0 h40 y41fe ff4a fs28 fc3 sc1 ls0 ws0"># prog4</div></div><div class="t m5 x1d h40 y41ff ff4a fs28 fc1 sc0 ls0 ws0">0x00a: irmovq  $3,%rax</div><div class="t m5 x1d h40 y4200 ff4a fs28 fc1 sc0 ls0 ws0">0x014: addq %rdx,%rax</div><div class="t m5 x1d h40 y4201 ff4a fs28 fc1 sc0 ls0 ws0">0x016: halt</div><div class="t m5 x13d h3f y41fb ff49 fs27 fc1 sc0 ls1d6 ws0">DE<span class="_ _1"></span>M<span class="_ _4"></span>W</div><div class="t m5 x13d h3f y4202 ff49 fs27 fc1 sc0 ls1ca ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x1c9 h3f y4203 ff49 fs27 fc1 sc0 ls1c8 ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 xe8 h3f y4204 ff49 fs27 fc1 sc0 ls1c8 ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 xd4 h44 y4205 ff49 fs2a fc6 sc0 ls1d7 ws0">12345</div><div class="t m5 xb5 h44 y4206 ff49 fs2a fc6 sc0 ls0 ws0">6</div><div class="t m5 x1e9 h44 y4207 ff49 fs2a fc6 sc0 ls0 ws0">7</div><div class="t m5 x104 h44 y4208 ff49 fs2a fc6 sc0 ls0 ws0">8</div><div class="t m5 x16 h40 y4209 ff49 fs27 fc1 sc0 ls0 ws0">srcA<span class="_ _1"></span> = <span class="ff4a fs28">%rdx</span></div><div class="t m5 x16 h40 y420a ff49 fs27 fc1 sc0 ls0 ws0">srcB = <span class="ff4a fs28">%rax</span></div><div class="t m5 x16 h40 y420b ff49 fs27 fc1 sc0 ls0 ws0">M_dstE = <span class="ff4a fs28">%rdx</span></div><div class="t m5 x16 h3f y420c ff49 fs27 fc1 sc0 ls0 ws0">M_valE = 10</div><div class="t m5 x18b h3f y420d ff49 fs27 fc1 sc0 ls0 ws0">valA<span class="_ _1"></span>      M_valE = 10</div><div class="t m5 x18b h3f y420e ff49 fs27 fc1 sc0 ls0 ws0">valB      e_valE = 3</div><div class="t m5 x41 h3f y420f ff49 fs27 fc1 sc0 ls0 ws0">Cycle 4</div><div class="t m5 xe8 h3f y4210 ff49 fs27 fc1 sc0 ls0 ws0">D</div><div class="t m5 x19c h3f y4211 ff49 fs27 fc1 sc0 ls0 ws0">M</div><div class="t m5 x16 h3f y4212 ff49 fs27 fc1 sc0 ls0 ws0">E_dstE = </div><div class="t m5 x250 h40 y4213 ff4a fs28 fc1 sc0 ls0 ws0">%rax</div><div class="t m5 x16 h3f y4214 ff49 fs27 fc1 sc0 ls0 ws0">e_valE      0 + 3 = 3</div><div class="t m5 xe8 h3f y4215 ff49 fs27 fc1 sc0 ls0 ws0">E</div><div class="t m5 x1d h3a y4216 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>4.51<span class="_ _66"> </span><span class="fc1">Pipelined<span class="_"> </span>execution<span class="_"> </span>of<span class="_ _10"> </span><span class="ffd fs19">prog4<span class="_ _10"> </span></span>using<span class="_ _10"> </span>forwarding.<span class="_"> </span><span class="ff6">In<span class="_ _10"> </span>cycle<span class="_ _10"> </span>4,<span class="_ _10"> </span>the<span class="_ _10"> </span>decode-</span></span></div><div class="t m5 x1d h34 y4217 ff6 fs16 fc1 sc0 ls0 ws0">stage<span class="_ _10"> </span>logic<span class="_ _10"> </span>detects<span class="_ _10"> </span>a<span class="_ _10"> </span>pending<span class="_ _13"> </span>write<span class="_ _10"> </span>to<span class="_ _10"> </span>register</div><div class="t m5 x1b4 h3a y4218 ffd fs19 fc1 sc0 ls0 ws0">%rdx<span class="_ _10"> </span><span class="ff6 fs16">in<span class="_ _10"> </span>the<span class="_ _10"> </span>memory<span class="_ _10"> </span>stage.<span class="_ _10"> </span>It<span class="_ _10"> </span>also<span class="_ _13"> </span>detects</span></div><div class="t m5 x1d h34 y4219 ff6 fs16 fc1 sc0 ls0 ws0">that<span class="_ _10"> </span>a<span class="_ _10"> </span>new<span class="_ _11"> </span>value<span class="_ _10"> </span>is<span class="_ _11"> </span>being<span class="_ _10"> </span>computed<span class="_ _10"> </span>for<span class="_ _11"> </span>register</div><div class="t m5 x51 h3a y421a ffd fs19 fc1 sc0 ls0 ws0">%rax<span class="_ _10"> </span><span class="ff6 fs16">in<span class="_ _10"> </span>the<span class="_ _11"> </span>execute<span class="_ _10"> </span>stage.<span class="_ _11"> </span>It<span class="_ _10"> </span>uses<span class="_ _10"> </span>these</span></div><div class="t m5 x1d h34 y421b ff6 fs16 fc1 sc0 ls0 ws0">as<span class="_ _10"> </span>the<span class="_ _11"> </span>values<span class="_ _10"> </span>for<span class="_ _10"> </span>valA<span class="_ _11"> </span>and<span class="_ _10"> </span>valB<span class="_ _11"> </span>rather<span class="_ _10"> </span>than<span class="_ _11"> </span>the<span class="_ _10"> </span>values<span class="_ _10"> </span>read<span class="_ _11"> </span>from<span class="_ _10"> </span>the<span class="_ _11"> </span>register<span class="_ _10"> </span>ﬁle.</div><div class="t m5 x29 h26 y421c ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_"> </span>exploit<span class="_ _13"> </span>data<span class="_ _13"> </span>forwarding<span class="_ _13"> </span>to<span class="_ _13"> </span>its<span class="_"> </span>full<span class="_ _13"> </span>extent,<span class="_ _13"> </span>we<span class="_ _13"> </span>can<span class="_"> </span>also<span class="_ _13"> </span>pass<span class="_ _13"> </span>newly<span class="_ _13"> </span>computed</div><div class="t m5 x1d h26 y421d ff7 fs19 fc1 sc0 ls0 ws0">values<span class="_ _11"> </span>from<span class="_ _11"> </span>the<span class="_ _16"> </span>execute<span class="_ _11"> </span>stage<span class="_ _11"> </span>to<span class="_ _16"> </span>the<span class="_"> </span>decode<span class="_ _16"> </span>stage<span class="_ _1"></span>,<span class="_ _16"> </span>avoiding<span class="_ _11"> </span>the<span class="_ _11"> </span>need<span class="_ _16"> </span>to<span class="_ _11"> </span>stall<span class="_ _11"> </span>for</div><div class="t m5 x1d h26 y421e ff7 fs19 fc1 sc0 ls0 ws0">program<span class="_ _14"> </span><span class="ffd">prog4</span>,<span class="_ _15"> </span>as<span class="_ _15"> </span>illustrated<span class="_ _14"> </span>in<span class="_ _15"> </span>F<span class="_ _1"></span>igure<span class="_ _15"> </span>4.51.<span class="_ _14"> </span>In<span class="_ _15"> </span>cycle<span class="_ _16"> </span>4,<span class="_ _21"> </span>the<span class="_ _14"> </span>decode-stage<span class="_ _15"> </span>logic</div><div class="t m5 x1d h26 y421f ff7 fs19 fc1 sc0 ls0 ws0">detects<span class="_ _16"> </span>a<span class="_ _16"> </span>pending<span class="_ _16"> </span>write<span class="_ _14"> </span>to<span class="_ _16"> </span>register<span class="_ _16"> </span><span class="ffd">%rdx<span class="_ _14"> </span></span>in<span class="_ _16"> </span>the<span class="_ _16"> </span>memory<span class="_ _16"> </span>stage,<span class="_ _16"> </span>and<span class="_ _16"> </span>also<span class="_ _16"> </span>that<span class="_ _14"> </span>the</div><div class="t m5 x1d h26 y4220 ff7 fs19 fc1 sc0 ls0 ws0">value<span class="_ _16"> </span>being<span class="_ _16"> </span>computed<span class="_ _14"> </span>by<span class="_ _16"> </span>the<span class="_ _16"> </span>ALU<span class="_ _14"> </span>in<span class="_ _16"> </span>the<span class="_ _14"> </span>execute<span class="_ _16"> </span>stage<span class="_ _16"> </span>will<span class="_ _14"> </span>later<span class="_ _16"> </span>be<span class="_ _16"> </span>written<span class="_ _14"> </span>to</div><div class="t m5 x1d h26 y4221 ff7 fs19 fc1 sc0 ls0 ws0">register<span class="_ _6"> </span><span class="ffd">%rax</span>.<span class="_ _13"> </span>It<span class="_ _6"> </span>can<span class="_ _13"> </span>use<span class="_ _6"> </span>the<span class="_ _13"> </span>value<span class="_ _6"> </span>in<span class="_ _6"> </span>the<span class="_ _13"> </span>memory<span class="_ _6"> </span>stage<span class="_ _13"> </span>(signal<span class="_ _6"> </span><span class="ff6">M_valE</span>)<span class="_ _13"> </span>for<span class="_ _6"> </span>operand</div><div class="t m5 x1d h26 y4222 ff6 fs19 fc1 sc0 ls0 ws0">valA<span class="ff7">.<span class="_ _11"> </span>It<span class="_ _11"> </span>can<span class="_ _11"> </span>also<span class="_"> </span>use<span class="_ _11"> </span>the<span class="_ _11"> </span>ALU<span class="_ _11"> </span>output<span class="_ _11"> </span>(signal<span class="_ _11"> </span></span>e_valE<span class="ff7">)<span class="_ _11"> </span>for<span class="_ _11"> </span>operand<span class="_ _11"> </span></span>valB<span class="ff7">.<span class="_ _11"> </span>Note<span class="_ _11"> </span>that</span></div><div class="t m5 x1d h26 y4223 ff7 fs19 fc1 sc0 ls0 ws0">using<span class="_ _13"> </span>the<span class="_"> </span>ALU<span class="_ _13"> </span>output<span class="_"> </span>does<span class="_ _13"> </span>not<span class="_"> </span>introduce<span class="_ _13"> </span>any<span class="_"> </span>timing<span class="_ _13"> </span>problems<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>decode<span class="_ _13"> </span>stage</div><div class="t m5 x1d h26 y4224 ff7 fs19 fc1 sc0 ls0 ws0">only<span class="_"> </span>needs<span class="_"> </span>to<span class="_ _11"> </span>generate<span class="_"> </span>signals<span class="_ _11"> </span><span class="ff6">valA<span class="_ _10"> </span></span>and<span class="_ _11"> </span><span class="ff6">valB<span class="_ _10"> </span></span>by<span class="_ _11"> </span>the<span class="_"> </span>end<span class="_"> </span>of<span class="_ _11"> </span>the<span class="_"> </span>clock<span class="_ _11"> </span>cycle<span class="_"> </span>so<span class="_"> </span>that</div><div class="t m5 x1d h26 y4225 ff7 fs19 fc1 sc0 ls0 ws0">pipeline<span class="_ _16"> </span>register<span class="_ _16"> </span>E<span class="_ _14"> </span>can<span class="_ _16"> </span>be<span class="_ _14"> </span>loaded<span class="_ _16"> </span>with<span class="_ _16"> </span>the<span class="_ _14"> </span>results<span class="_ _16"> </span>from<span class="_ _14"> </span>the<span class="_ _16"> </span>decode<span class="_ _16"> </span>stage<span class="_ _14"> </span>as<span class="_ _16"> </span>the</div><div class="t m5 x1d h26 y4226 ff7 fs19 fc1 sc0 ls0 ws0">clock<span class="_"> </span>rises<span class="_ _13"> </span>to<span class="_"> </span>start<span class="_"> </span>the<span class="_"> </span>next<span class="_ _13"> </span>cycle<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _0"></span>he<span class="_"> </span>ALU<span class="_"> </span>output<span class="_ _13"> </span>will<span class="_"> </span>be<span class="_"> </span>valid<span class="_ _13"> </span>before<span class="_"> </span>this<span class="_"> </span>point.</div><div class="t m5 x29 h26 y4227 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _15"> </span>uses<span class="_ _15"> </span>of<span class="_ _15"> </span>forwarding<span class="_ _15"> </span>illustrated<span class="_ _15"> </span>in<span class="_ _15"> </span>programs<span class="_ _15"> </span><span class="ffd">prog2<span class="_ _15"> </span></span>to<span class="_ _15"> </span><span class="ffd">prog4<span class="_ _15"> </span></span>all<span class="_ _15"> </span>involve</div><div class="t m5 x1d h26 y4228 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _16"> </span>forwarding<span class="_ _14"> </span>of<span class="_ _16"> </span>values<span class="_ _14"> </span>generated<span class="_ _16"> </span>by<span class="_ _14"> </span>the<span class="_ _14"> </span>ALU<span class="_ _16"> </span>and<span class="_ _14"> </span>destined<span class="_ _16"> </span>for<span class="_ _14"> </span>write<span class="_ _16"> </span>port<span class="_ _14"> </span>E.</div><div class="t m5 x1d h26 y4229 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>orwarding<span class="_"> </span>can<span class="_"> </span>also<span class="_"> </span>be<span class="_"> </span>used<span class="_"> </span>with<span class="_"> </span>values<span class="_"> </span>read<span class="_ _11"> </span>from<span class="_"> </span>the<span class="_"> </span>memory<span class="_"> </span>and<span class="_"> </span>destined<span class="_"> </span>for</div><div class="t m5 x1d h26 y422a ff7 fs19 fc1 sc0 ls0 ws0">write<span class="_ _13"> </span>port<span class="_ _13"> </span>M.<span class="_ _13"> </span>F<span class="_ _0"></span>rom<span class="_ _13"> </span>the<span class="_ _13"> </span>memory<span class="_ _13"> </span>stage<span class="_ _1"></span>,<span class="_"> </span>we<span class="_ _13"> </span>can<span class="_ _13"> </span>forward<span class="_ _13"> </span>the<span class="_ _13"> </span>value<span class="_ _13"> </span>that<span class="_ _13"> </span>has<span class="_ _13"> </span>just<span class="_ _13"> </span>been</div><div class="t m5 x1d h26 y422b ff7 fs19 fc1 sc0 ls0 ws0">read<span class="_"> </span>from<span class="_ _11"> </span>the<span class="_ _11"> </span>data<span class="_ _11"> </span>memory<span class="_ _11"> </span>(signal<span class="_ _11"> </span><span class="ff6">m_valM</span>).<span class="_"> </span>From<span class="_"> </span>the<span class="_ _11"> </span>write-back<span class="_"> </span>stage,<span class="_"> </span>we<span class="_ _11"> </span>can</div><div class="t m5 x1d h26 y422c ff7 fs19 fc1 sc0 ls0 ws0">forward<span class="_ _16"> </span>the<span class="_ _16"> </span>pending<span class="_ _16"> </span>write<span class="_ _16"> </span>to<span class="_ _14"> </span>port<span class="_ _16"> </span>M<span class="_ _16"> </span>(signal<span class="_ _16"> </span><span class="ff6">W_valM</span>).<span class="_ _14"> </span>T<span class="_ _1"></span>his<span class="_ _16"> </span>gives<span class="_ _14"> </span>a<span class="_ _16"> </span>total<span class="_ _16"> </span>of<span class="_ _16"> </span>ﬁve</div><div class="t m5 x1d h26 y422d ff7 fs19 fc1 sc0 ls0 ws0">different<span class="_ _13"> </span>forwarding<span class="_ _13"> </span>sources<span class="_ _13"> </span>(<span class="ff6">e_valE</span>,<span class="_ _13"> </span><span class="ff6">m_valM</span>,<span class="_"> </span><span class="ff6">M_valE</span>,<span class="_ _13"> </span><span class="ff6">W_valM</span>,<span class="_ _13"> </span>and<span class="_ _13"> </span><span class="ff6">W_valE</span>)<span class="_ _13"> </span>and</div><div class="t m5 x1d h26 y422e ff7 fs19 fc1 sc0 ls0 ws0">two<span class="_"> </span>different<span class="_"> </span>forwarding<span class="_"> </span>destinations<span class="_"> </span>(<span class="ff6">valA<span class="_ _10"> </span></span>and<span class="_"> </span><span class="ff6">valB</span>).</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
