<div id="pf2d0" class="pf w2 h11" data-page-no="2d0"><div class="pc pc2d0 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg2d0.png"/><div class="t m5 x84 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>7.6<span class="_ _60"> </span>Symbol<span class="_ _10"> </span>Resolution<span class="_ _3e"> </span><span class="ffe fs1e">719</span></div><div class="t m5 x17 h2d ye7 ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _20"> </span><span class="ffd fs1e fc2">printf(&quot;x<span class="_ _e"> </span>=<span class="_ _1f"> </span>0x%x<span class="_ _1f"> </span>y<span class="_ _e"> </span>=<span class="_ _1f"> </span>0x%x<span class="_ _e"> </span>\n&quot;,</span></div><div class="t m5 x17 h2d yc4d ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _1eb"> </span><span class="ffd fs1e fc2">x,<span class="_ _e"> </span>y);</span></div><div class="t m5 x17 h2d yecb ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _20"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>0;</span></div><div class="t m5 x17 h2d yecc ff6 fs20 fc6 sc0 ls0 ws0">14<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x2c h2d y2d1c ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">/*<span class="_ _1f"> </span>bar5.c<span class="_ _e"> </span>*/</span></div><div class="t m5 x2c h2d y5f69 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">double<span class="_ _1f"> </span>x;</span></div><div class="t m5 x2c h2e y5f6a ff6 fs20 fc6 sc0 ls0 ws0">3</div><div class="t m5 x2c h2e y5f6b ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 x2d h2d y5f6c ffd fs1e fc2 sc0 ls0 ws0">void<span class="_ _e"> </span>f()</div><div class="t m5 x2c h2d y5f6d ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x2c h2d y3488 ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _20"> </span><span class="ffd fs1e fc2">x<span class="_ _e"> </span>=<span class="_ _1f"> </span>-0.0;</span></div><div class="t m5 x2c h2d y49e ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x26 h26 y2b56 ff7 fs19 fc2 sc0 ls0 ws0">On<span class="_ _16"> </span>an<span class="_ _11"> </span>x86-64/Linux<span class="_ _16"> </span>machine<span class="_ _0"></span>,<span class="_ _16"> </span><span class="ffd">double</span>s<span class="_ _16"> </span>are<span class="_ _11"> </span>8<span class="_ _16"> </span>bytes<span class="_ _16"> </span>and<span class="_ _16"> </span><span class="ffd">int</span>s<span class="_ _11"> </span>are<span class="_ _16"> </span>4<span class="_ _16"> </span>bytes<span class="_ _1"></span>.<span class="_ _16"> </span>On</div><div class="t m5 x17 h26 y521f ff7 fs19 fc2 sc0 ls0 ws0">our<span class="_"> </span>system,<span class="_ _11"> </span>the<span class="_ _11"> </span>address<span class="_"> </span>of<span class="_ _11"> </span><span class="ffd">x<span class="_ _11"> </span></span>is<span class="_"> </span><span class="ffd">0x601020<span class="_ _11"> </span></span>and<span class="_ _11"> </span>the<span class="_ _11"> </span>address<span class="_"> </span>of<span class="_ _11"> </span><span class="ffd">y<span class="_ _11"> </span></span>is<span class="_"> </span><span class="ffd">0x601024</span>.<span class="_ _11"> </span>T<span class="_ _0"></span>hus<span class="_ _1"></span>,</div><div class="t m5 x17 h26 y5f6e ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>assignment<span class="_ _11"> </span><span class="ffd">x<span class="_ _16"> </span>=<span class="_ _11"> </span>-0.0<span class="_ _11"> </span></span>in<span class="_ _11"> </span>line<span class="_"> </span>6<span class="_ _11"> </span>of<span class="_ _11"> </span><span class="ffd">bar5.c<span class="_ _11"> </span></span>will<span class="_"> </span>overwrite<span class="_ _11"> </span>the<span class="_ _11"> </span>memory<span class="_ _11"> </span>locations</div><div class="t m5 x17 h26 y5f6f ff7 fs19 fc2 sc0 ls0 ws0">for<span class="_ _15"> </span><span class="ffd">x<span class="_ _21"> </span></span>and<span class="_ _15"> </span><span class="ffd">y<span class="_ _15"> </span></span>(lines<span class="_ _21"> </span>5<span class="_ _15"> </span>and<span class="_ _21"> </span>6<span class="_ _15"> </span>in<span class="_ _21"> </span><span class="ffd">foo5.c</span>)<span class="_ _21"> </span>with<span class="_ _15"> </span>the<span class="_ _21"> </span>double-precision<span class="_ _15"> </span>ﬂoating-point</div><div class="t m5 x17 h26 y5f70 ff7 fs19 fc2 sc0 ls0 ws0">representation<span class="_"> </span>of<span class="_"> </span>negative<span class="_"> </span>zero!</div><div class="t m5 x17 h2d y3d92 ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">gcc<span class="_ _1f"> </span>-Wall<span class="_ _1f"> </span>-Og<span class="_ _e"> </span>-o<span class="_ _1f"> </span>foobar5<span class="_ _e"> </span>foo5.c<span class="_ _1f"> </span>bar5.c</span></div><div class="t m5 x17 h2d y5f71 ffd fs1e fc2 sc0 ls0 ws0">/usr/bin/ld:<span class="_ _e"> </span>Warning:<span class="_ _1f"> </span>alignment<span class="_ _1f"> </span>4<span class="_ _e"> </span>of<span class="_ _1f"> </span>symbol<span class="_ _e"> </span>‘x’<span class="_ _1f"> </span>in<span class="_ _1f"> </span>/tmp/cclUFK5g.o</div><div class="t m5 x17 h2d y5f72 ffd fs1e fc2 sc0 ls0 ws0">is<span class="_ _e"> </span>smaller<span class="_ _1f"> </span>than<span class="_ _1f"> </span>8<span class="_ _e"> </span>in<span class="_ _1f"> </span>/tmp/ccbTLcb9.o</div><div class="t m5 x17 h2d y5f73 ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">./foobar5</span></div><div class="t m5 x17 h2d y5f74 ffd fs1e fc2 sc0 ls0 ws0">x<span class="_ _e"> </span>=<span class="_ _1f"> </span>0x0<span class="_ _1f"> </span>y<span class="_ _e"> </span>=<span class="_ _1f"> </span>0x80000000</div><div class="t m5 x17 h26 y261f ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _11"> </span>is<span class="_ _11"> </span>a<span class="_ _11"> </span>subtle<span class="_ _11"> </span>and<span class="_ _11"> </span>nasty<span class="_ _11"> </span>bug,<span class="_ _11"> </span>especially<span class="_ _11"> </span>because<span class="_ _11"> </span>it<span class="_ _11"> </span>triggers<span class="_ _11"> </span>only<span class="_ _11"> </span>a<span class="_ _11"> </span>warning<span class="_ _11"> </span>from</div><div class="t m5 x17 h26 y2620 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _14"> </span>linker,<span class="_ _14"> </span>and<span class="_ _14"> </span>because<span class="_ _15"> </span>it<span class="_ _14"> </span>typically<span class="_ _14"> </span>manifests<span class="_ _14"> </span>itself<span class="_ _14"> </span>much<span class="_ _14"> </span>later<span class="_ _15"> </span>in<span class="_ _14"> </span>the<span class="_ _14"> </span>execution</div><div class="t m5 x17 h26 y2621 ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_ _11"> </span>the<span class="_ _16"> </span>program,<span class="_ _16"> </span>far<span class="_ _11"> </span>away<span class="_ _16"> </span>from<span class="_ _16"> </span>where<span class="_ _11"> </span>the<span class="_ _16"> </span>error<span class="_ _11"> </span>occurred.<span class="_ _16"> </span>In<span class="_ _11"> </span>a<span class="_ _16"> </span>large<span class="_ _11"> </span>system<span class="_ _16"> </span>with</div><div class="t m5 x17 h26 y2622 ff7 fs19 fc2 sc0 ls0 ws0">hundreds<span class="_ _13"> </span>of<span class="_ _6"> </span>modules<span class="_ _1"></span>,<span class="_ _13"> </span>a<span class="_ _13"> </span>bug<span class="_ _13"> </span>of<span class="_ _6"> </span>this<span class="_ _13"> </span>kind<span class="_ _13"> </span>is<span class="_ _13"> </span>extremely<span class="_ _6"> </span>hard<span class="_ _13"> </span>to<span class="_ _13"> </span>ﬁx,<span class="_ _13"> </span>especially<span class="_ _6"> </span>because</div><div class="t m5 x17 h26 y2623 ff7 fs19 fc2 sc0 ls0 ws0">many<span class="_ _16"> </span>programmers<span class="_ _16"> </span>are<span class="_ _16"> </span>not<span class="_ _16"> </span>aware<span class="_ _11"> </span>of<span class="_ _16"> </span>how<span class="_ _16"> </span>linkers<span class="_ _16"> </span>work,<span class="_ _14"> </span>and<span class="_ _16"> </span>because<span class="_ _16"> </span>they<span class="_ _16"> </span>often</div><div class="t m5 x17 h26 y2624 ff7 fs19 fc2 sc0 ls0 ws0">ignore<span class="_ _21"> </span>compiler<span class="_ _f"> </span>warnings<span class="_ _1"></span>.<span class="_ _f"> </span>When<span class="_ _21"> </span>in<span class="_ _f"> </span>doubt,<span class="_ _e"> </span>invoke<span class="_ _21"> </span>the<span class="_ _f"> </span>linker<span class="_ _f"> </span>with<span class="_ _f"> </span>a<span class="_ _21"> </span>ﬂag<span class="_ _f"> </span>such</div><div class="t m5 x17 h26 y2625 ff7 fs19 fc2 sc0 ls0 ws0">as<span class="_ _14"> </span>the<span class="_ _15"> </span><span class="ff9">gcc<span class="_ _14"> </span><span class="ffd">-fno-common<span class="_ _15"> </span></span></span>ﬂag,<span class="_ _15"> </span>which<span class="_ _14"> </span>triggers<span class="_ _15"> </span>an<span class="_ _14"> </span>error<span class="_ _15"> </span>if<span class="_ _14"> </span>it<span class="_ _15"> </span>encounters<span class="_ _14"> </span>multiply-</div><div class="t m5 x17 h26 y2626 ff7 fs19 fc2 sc0 ls0 ws0">deﬁned<span class="_"> </span>global<span class="_"> </span>symbols<span class="_ _3"></span>.<span class="_"> </span>Or<span class="_"> </span>use<span class="_"> </span>the<span class="_"> </span><span class="ffd">-Werror<span class="_ _10"> </span></span>option,<span class="_"> </span>which<span class="_"> </span>turns<span class="_"> </span>all<span class="_"> </span>warnings<span class="_"> </span>into</div><div class="t m5 x17 h26 y2627 ff7 fs19 fc2 sc0 ls0 ws0">errors<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y2628 ff7 fs19 fc2 sc0 ls0 ws0">In<span class="_ _11"> </span>Section<span class="_ _11"> </span>7.5,<span class="_ _11"> </span>we<span class="_ _16"> </span>saw<span class="_"> </span>how<span class="_ _11"> </span>the<span class="_ _16"> </span>compiler<span class="_"> </span>assigns<span class="_ _16"> </span>symbols<span class="_"> </span>to<span class="_ _11"> </span>COMMON<span class="_ _16"> </span>and</div><div class="t m5 x17 h26 y2629 ffd fs19 fc2 sc0 ls0 ws0">.bss<span class="_ _11"> </span><span class="ff7">using<span class="_ _16"> </span>a<span class="_ _11"> </span>seemingly<span class="_ _11"> </span>arbitrary<span class="_ _16"> </span>convention.<span class="_ _11"> </span>Actually<span class="_ _3"></span>,<span class="_ _16"> </span>this<span class="_ _11"> </span>convention<span class="_ _16"> </span>is<span class="_ _11"> </span>due<span class="_ _11"> </span>to</span></div><div class="t m5 x17 h26 y262a ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _14"> </span>fact<span class="_ _14"> </span>that<span class="_ _14"> </span>in<span class="_ _15"> </span>some<span class="_ _14"> </span>cases<span class="_ _14"> </span>the<span class="_ _14"> </span>linker<span class="_ _15"> </span>allows<span class="_ _14"> </span>multiple<span class="_ _14"> </span>modules<span class="_ _14"> </span>to<span class="_ _15"> </span>deﬁne<span class="_ _14"> </span>global</div><div class="t m5 x17 h26 y262b ff7 fs19 fc2 sc0 ls0 ws0">symbols<span class="_"> </span>with<span class="_"> </span>the<span class="_"> </span>same<span class="_"> </span>name<span class="_ _1"></span>.<span class="_"> </span>W<span class="_ _0"></span>hen<span class="_"> </span>the<span class="_"> </span>compiler<span class="_"> </span>is<span class="_"> </span>translating<span class="_ _13"> </span>some<span class="_"> </span>module<span class="_"> </span>and</div><div class="t m5 x17 h26 y262c ff7 fs19 fc2 sc0 ls0 ws0">encounters<span class="_ _11"> </span>a<span class="_ _16"> </span>weak<span class="_ _11"> </span>global<span class="_ _11"> </span>symbol,<span class="_ _16"> </span>say<span class="_ _3"></span>,<span class="_ _16"> </span><span class="ffd">x</span>,<span class="_ _11"> </span>it<span class="_ _16"> </span>does<span class="_ _11"> </span>not<span class="_ _11"> </span>know<span class="_ _16"> </span>if<span class="_ _11"> </span>other<span class="_ _11"> </span>modules<span class="_ _16"> </span>also</div><div class="t m5 x17 h26 y262d ff7 fs19 fc2 sc0 ls0 ws0">deﬁne<span class="_"> </span><span class="ffd">x</span>,<span class="_ _13"> </span>and<span class="_"> </span>if<span class="_ _13"> </span>so<span class="_ _1"></span>,<span class="_"> </span>it<span class="_"> </span>cannot<span class="_ _13"> </span>predict<span class="_"> </span>which<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>multiple<span class="_"> </span>instances<span class="_ _13"> </span>of<span class="_"> </span><span class="ffd">x<span class="_ _13"> </span></span>the<span class="_"> </span>linker</div><div class="t m5 x17 h26 y262e ff7 fs19 fc2 sc0 ls0 ws0">might<span class="_ _11"> </span>choose<span class="_ _1"></span>.<span class="_ _11"> </span>So<span class="_ _16"> </span>the<span class="_"> </span>compiler<span class="_ _11"> </span>defers<span class="_ _11"> </span>the<span class="_ _11"> </span>decision<span class="_ _11"> </span>to<span class="_ _11"> </span>the<span class="_ _11"> </span>linker<span class="_ _16"> </span>by<span class="_"> </span>assigning<span class="_ _11"> </span><span class="ffd">x<span class="_ _11"> </span></span>to</div><div class="t m5 x17 h26 y262f ff7 fs19 fc2 sc0 ls0 ws0">COMMON<span class="_ _3"></span>.<span class="_"> </span>On<span class="_ _13"> </span>the<span class="_ _13"> </span>other<span class="_ _13"> </span>hand,<span class="_"> </span>if<span class="_ _13"> </span><span class="ffd">x<span class="_ _13"> </span></span>is<span class="_ _13"> </span>initialized<span class="_"> </span>to<span class="_ _13"> </span>zero<span class="_ _1"></span>,<span class="_"> </span>then<span class="_ _13"> </span>it<span class="_ _13"> </span>is<span class="_ _13"> </span>a<span class="_"> </span>strong<span class="_ _13"> </span>symbol</div><div class="t m5 x17 h26 y2630 ff7 fs19 fc2 sc0 ls0 ws0">(and<span class="_ _11"> </span>thus<span class="_ _11"> </span>must<span class="_ _11"> </span>be<span class="_ _16"> </span>unique<span class="_ _11"> </span>by<span class="_ _11"> </span>rule<span class="_ _11"> </span>2),<span class="_ _16"> </span>so<span class="_ _11"> </span>the<span class="_ _11"> </span>compiler<span class="_ _11"> </span>can<span class="_ _11"> </span>conﬁdently<span class="_ _16"> </span>assign<span class="_ _11"> </span>it<span class="_ _11"> </span>to</div><div class="t m5 x17 h26 y2631 ffd fs19 fc2 sc0 ls0 ws0">.bss<span class="ff7">.<span class="_ _14"> </span>Similarly<span class="_ _3"></span>,<span class="_ _14"> </span>static<span class="_ _15"> </span>symbols<span class="_ _14"> </span>are<span class="_ _14"> </span>unique<span class="_ _14"> </span>by<span class="_ _14"> </span>construction,<span class="_ _15"> </span>so<span class="_ _14"> </span>the<span class="_ _14"> </span>compiler<span class="_ _14"> </span>can</span></div><div class="t m5 x17 h26 y2632 ff7 fs19 fc2 sc0 ls0 ws0">conﬁdently<span class="_"> </span>assign<span class="_"> </span>them<span class="_"> </span>to<span class="_"> </span>either<span class="_"> </span><span class="ffd">.data<span class="_ _10"> </span></span>or<span class="_"> </span><span class="ffd">.bss</span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
