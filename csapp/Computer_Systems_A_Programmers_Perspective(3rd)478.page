<div id="pf1de" class="pf w2 h11" data-page-no="1de"><div class="pc pc1de w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1de.png"/><div class="t m5 x13d h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>4.5<span class="_ _60"> </span>Pipelined<span class="_ _10"> </span>Y86-64<span class="_ _10"> </span>Implementations<span class="_ _3e"> </span><span class="ffe fs1e">477</span></div><div class="t m5 x18 h9e y427d ff49 fs62 fc1 sc0 ls0 ws0">M_dstE = <span class="ff4a fs63">%rbx</span></div><div class="t m5 x18 ha0 y427e ff49 fs62 fc1 sc0 ls0 ws0">M_valE = 10</div><div class="t m5 x191 ha0 y427f ff49 fs62 fc1 sc0 ls0 ws0">M</div><div class="t m5 x6a h9e y427d ff49 fs62 fc1 sc0 ls0 ws0">M_dstM = <span class="ff4a fs63">%rax</span></div><div class="t m5 x6a ha0 y427e ff49 fs62 fc1 sc0 ls0 ws0">m_valM   <span class="ff4c">   </span>M[128] = 3</div><div class="t m5 x171 ha0 y427f ff49 fs62 fc1 sc0 ls0 ws0">M</div><div class="t m5 x8f h9e y4280 ff49 fs62 fc1 sc0 ls0 ws0">F<span class="_ _1c3"></span><span class="ff4a fs63">0x000: irmovq $128,%rdx</span></div><div class="t m5 x17 h9e y4281 ff4a fs63 fc1 sc0 ls0 ws0"># prog5</div><div class="c x17 y4282 wc hb8"><div class="t m5 x0 h9e y4283 ff4a fs63 fc3 sc1 ls0 ws0"># prog5</div></div><div class="t m5 x17 h9e y4284 ff4a fs63 fc1 sc0 ls0 ws0">0x00a: irmovq  $3,%rcx</div><div class="t m5 x17 h9e y4285 ff4a fs63 fc1 sc0 ls0 ws0">0x014: rmmovq %rcx, 0(%rdx) </div><div class="t m5 x17 h9e y4286 ff4a fs63 fc1 sc0 ls0 ws0">0x01e: irmovq $10,%rbx</div><div class="t m5 x17 h9e y4287 ff4a fs63 fc1 sc0 ls0 ws0">0x028: mrmovq 0(%rdx),%rax <span class="fc6"># Load %rax</span></div><div class="t m5 x17 h9e y4288 ff4a fs63 fc1 sc0 ls0 ws0">0x032: addq %ebx,%eax <span class="fc6"># Use %rax</span></div><div class="t m5 x17 h9e y4289 ff4a fs63 fc1 sc0 ls0 ws0">0x034: halt</div><div class="t m5 xdc ha0 y4280 ff49 fs62 fc1 sc0 ls1cc ws0">DE<span class="_ _1"></span>M<span class="_ _7"></span>W</div><div class="t m5 xdc ha0 y428a ff49 fs62 fc1 sc0 ls1cd ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x49 ha0 y428b ff49 fs62 fc1 sc0 ls1ce ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x23d ha0 y428c ff49 fs62 fc1 sc0 ls1ce ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x130 ha0 y428d ff49 fs62 fc1 sc0 ls1ce ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x250 ha0 y428e ff49 fs62 fc1 sc0 ls1cd ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 xbd ha0 y428f ff49 fs62 fc1 sc0 ls1cd ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 xf8 ha1 y4290 ff49 fs64 fc6 sc0 ls1cf ws0">12345</div><div class="t m5 x5e ha1 y4291 ff49 fs64 fc6 sc0 ls0 ws0">6</div><div class="t m5 x24f ha1 y4292 ff49 fs64 fc6 sc0 ls0 ws0">7</div><div class="t m5 x1f8 ha1 y4293 ff49 fs64 fc6 sc0 ls0 ws0">8</div><div class="t m5 x11a ha1 y4294 ff49 fs64 fc6 sc0 ls1d0 ws0">91<span class="_ _184"></span>0<span class="_ _2"></span>1<span class="_ _1c4"></span>1</div><div class="t m5 x23b ha0 y4295 ff49 fs62 fc1 sc0 ls0 ws0">D</div><div class="t m5 x69 ha0 y4296 ff49 fs62 fc1 sc0 ls0 ws0">valA<span class="_ _1"></span>      M_valE = 10</div><div class="t m5 x69 ha0 y4297 ff49 fs62 fc1 sc0 ls0 ws0">valB      R[</div><div class="t m5 x191 h9e y4298 ff4a fs63 fc1 sc0 ls0 ws0">%rax<span class="ff49 fs62">] = 0</span></div><div class="t m5 x101 ha0 y4299 ff49 fs62 fc1 sc0 ls0 ws0">Cycle 7<span class="_ _12e"> </span>Cycle 8</div><div class="t m5 x84 ha0 y429a ff1f fs62 fc1 sc0 ls0 ws0">Error</div><div class="t m8 x1ae ha0 y429b ff49 fs62 fc1 sc0 ls0 ws0">. . .</div><div class="t m5 x17 h3a y429c ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _13"> </span>4.53<span class="_ _66"> </span><span class="fc1">Example<span class="_ _13"> </span>of<span class="_ _13"> </span>load/use<span class="_ _13"> </span>data<span class="_ _6"> </span>hazard.<span class="_ _13"> </span><span class="ff6">The<span class="_ _13"> </span><span class="ffd fs19">addq<span class="_ _13"> </span></span>instruction<span class="_ _6"> </span>requires<span class="_ _13"> </span>the<span class="_ _13"> </span>value</span></span></div><div class="t m5 x17 h34 y429d ff6 fs16 fc1 sc0 ls0 ws0">of<span class="_ _10"> </span>register</div><div class="t m5 x1d4 h3a y429e ffd fs19 fc1 sc0 ls0 ws0">%rax</div><div class="t m5 x10b h3a y429f ff6 fs16 fc1 sc0 ls0 ws0">during<span class="_ _10"> </span>the<span class="_ _10"> </span>decode<span class="_ _10"> </span>stage<span class="_ _10"> </span>in<span class="_ _10"> </span>cycle<span class="_ _13"> </span>7.<span class="_ _10"> </span>The<span class="_ _10"> </span>preceding<span class="_ _10"> </span><span class="ffd fs19">mrmovq<span class="_ _10"> </span></span>reads<span class="_ _10"> </span>a<span class="_ _10"> </span>new</div><div class="t m5 x17 h34 y42a0 ff6 fs16 fc1 sc0 ls0 ws0">value<span class="_ _10"> </span>for<span class="_ _10"> </span>this<span class="_ _10"> </span>register<span class="_ _10"> </span>during<span class="_ _10"> </span>the<span class="_ _10"> </span>memory<span class="_ _10"> </span>stage<span class="_ _10"> </span>in<span class="_ _10"> </span>cycle<span class="_ _10"> </span>8,<span class="_ _10"> </span>which<span class="_ _10"> </span>is<span class="_ _10"> </span>too<span class="_ _10"> </span>late<span class="_ _10"> </span>for<span class="_ _10"> </span>the</div><div class="t m5 x44 h3a y42a1 ffd fs19 fc1 sc0 ls0 ws0">addq</div><div class="t m5 x17 h34 y42a2 ff6 fs16 fc1 sc0 ls0 ws0">instruction.</div><div class="t m5 x26 h26 y42a3 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_"> </span>use<span class="_"> </span>of<span class="_"> </span>a<span class="_"> </span>stall<span class="_"> </span>to<span class="_"> </span>handle<span class="_"> </span>a<span class="_"> </span>load/use<span class="_"> </span>hazard<span class="_"> </span>is<span class="_"> </span>called<span class="_"> </span>a<span class="_"> </span><span class="ffa">load<span class="_"> </span>interloc<span class="_ _0"></span>k<span class="ff7">.<span class="_"> </span>Load</span></span></div><div class="t m5 x17 h26 y42a4 ff7 fs19 fc1 sc0 ls0 ws0">interlocks<span class="_ _11"> </span>combined<span class="_ _11"> </span>with<span class="_ _11"> </span>forwarding<span class="_ _16"> </span>sufﬁce<span class="_ _11"> </span>to<span class="_ _11"> </span>handle<span class="_ _11"> </span>all<span class="_ _11"> </span>possible<span class="_ _16"> </span>forms<span class="_ _11"> </span>of<span class="_ _11"> </span>data</div><div class="t m5 x17 h26 y42a5 ff7 fs19 fc1 sc0 ls0 ws0">hazards<span class="_ _1"></span>.<span class="_"> </span>Since<span class="_ _13"> </span>only<span class="_ _13"> </span>load<span class="_"> </span>interlocks<span class="_ _13"> </span>reduce<span class="_"> </span>the<span class="_ _13"> </span>pipeline<span class="_"> </span>throughput,<span class="_ _13"> </span>we<span class="_"> </span>can<span class="_ _13"> </span>nearly</div><div class="t m5 x17 h26 y42a6 ff7 fs19 fc1 sc0 ls0 ws0">achieve<span class="_"> </span>our<span class="_"> </span>throughput<span class="_"> </span>goal<span class="_"> </span>of<span class="_"> </span>issuing<span class="_"> </span>one<span class="_"> </span>new<span class="_"> </span>instruction<span class="_"> </span>on<span class="_"> </span>every<span class="_"> </span>clock<span class="_"> </span>cycle<span class="_ _1"></span>.</div><div class="t m5 x17 h42 y42a7 ff6 fs29 fc6 sc0 ls0 ws0">A<span class="_ _0"></span>voiding<span class="_ _16"> </span>Control<span class="_ _11"> </span>Hazards</div><div class="t m5 x17 h26 y631 ff7 fs19 fc1 sc0 ls0 ws0">Control<span class="_ _11"> </span>hazards<span class="_ _11"> </span>arise<span class="_ _11"> </span>when<span class="_ _11"> </span>the<span class="_ _11"> </span>processor<span class="_ _11"> </span>cannot<span class="_ _11"> </span>reliably<span class="_ _11"> </span>determine<span class="_ _11"> </span>the<span class="_ _16"> </span>address</div><div class="t m5 x17 h26 y632 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_ _15"> </span>the<span class="_ _21"> </span>next<span class="_ _15"> </span>instruction<span class="_ _21"> </span>based<span class="_ _21"> </span>on<span class="_ _15"> </span>the<span class="_ _21"> </span>current<span class="_ _15"> </span>instruction<span class="_ _21"> </span>in<span class="_ _21"> </span>the<span class="_ _15"> </span>fetch<span class="_ _21"> </span>stage<span class="_ _0"></span>.<span class="_ _15"> </span>As</div><div class="t m5 x17 h26 y633 ff7 fs19 fc1 sc0 ls0 ws0">was<span class="_ _14"> </span>discussed<span class="_ _14"> </span>in<span class="_ _14"> </span>Section<span class="_ _14"> </span>4.5.4,<span class="_ _15"> </span>control<span class="_ _14"> </span>hazards<span class="_ _14"> </span>can<span class="_ _14"> </span>only<span class="_ _14"> </span>occur<span class="_ _15"> </span>in<span class="_ _14"> </span>our<span class="_ _14"> </span>pipelined</div><div class="t m5 x17 h26 y634 ff7 fs19 fc1 sc0 ls0 ws0">processor<span class="_ _13"> </span>for<span class="_ _13"> </span><span class="ffd">ret<span class="_ _13"> </span></span>and<span class="_ _13"> </span>jump<span class="_ _13"> </span>instructions<span class="_ _1"></span>.<span class="_ _13"> </span>Moreover,<span class="_ _13"> </span>the<span class="_ _13"> </span>latter<span class="_ _13"> </span>case<span class="_ _13"> </span>only<span class="_ _13"> </span>causes<span class="_ _13"> </span>dif-</div><div class="t m5 x17 h26 y635 ff7 fs19 fc1 sc0 ls0 ws0">ﬁculties<span class="_"> </span>when<span class="_"> </span>the<span class="_"> </span>direction<span class="_"> </span>of<span class="_"> </span>a<span class="_"> </span>conditional<span class="_"> </span>jump<span class="_"> </span>is<span class="_"> </span>mispredicted.<span class="_"> </span>In<span class="_"> </span>this<span class="_"> </span>section,</div><div class="t m5 x17 h26 y636 ff7 fs19 fc1 sc0 ls0 ws0">we<span class="_ _11"> </span>provide<span class="_ _11"> </span>a<span class="_ _11"> </span>high-level<span class="_ _11"> </span>view<span class="_ _11"> </span>of<span class="_ _11"> </span>how<span class="_ _16"> </span>these<span class="_"> </span>hazards<span class="_ _11"> </span>can<span class="_ _11"> </span>be<span class="_ _16"> </span>handled.<span class="_"> </span>The<span class="_"> </span>detailed</div><div class="t m5 x17 h26 y637 ff7 fs19 fc1 sc0 ls0 ws0">implementation<span class="_ _11"> </span>will<span class="_ _16"> </span>be<span class="_ _11"> </span>presented<span class="_ _16"> </span>in<span class="_ _11"> </span>Section<span class="_ _16"> </span>4.5.8<span class="_ _11"> </span>as<span class="_ _16"> </span>part<span class="_ _11"> </span>of<span class="_ _16"> </span>a<span class="_ _11"> </span>more<span class="_ _16"> </span>general<span class="_ _11"> </span>dis-</div><div class="t m5 x17 h26 y638 ff7 fs19 fc1 sc0 ls0 ws0">cussion<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>pipeline<span class="_"> </span>control.</div><div class="t m5 x26 h26 y639 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _16"> </span>the<span class="_ _16"> </span><span class="ffd">ret<span class="_ _16"> </span></span>instruction,<span class="_ _16"> </span>consider<span class="_ _14"> </span>the<span class="_ _16"> </span>following<span class="_ _16"> </span>example<span class="_ _16"> </span>program.<span class="_ _16"> </span>T<span class="_ _1"></span>his<span class="_ _16"> </span>pro-</div><div class="t m5 x17 h26 y63a ff7 fs19 fc1 sc0 ls0 ws0">gram<span class="_ _6"> </span>is<span class="_ _6"> </span>shown<span class="_ _6"> </span>in<span class="_ _13"> </span>assembly<span class="_ _a"> </span>code,<span class="_ _6"> </span>but<span class="_ _6"> </span>with<span class="_ _13"> </span>the<span class="_ _a"> </span>addresses<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _a"> </span>different<span class="_ _6"> </span>instructions</div><div class="t m5 x17 h26 y63b ff7 fs19 fc1 sc0 ls0 ws0">on<span class="_"> </span>the<span class="_"> </span>left<span class="_"> </span>for<span class="_"> </span>reference:</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
