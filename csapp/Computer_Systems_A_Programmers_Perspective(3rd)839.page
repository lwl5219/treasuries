<div id="pf347" class="pf w2 h11" data-page-no="347"><div class="pc pc347 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg347.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">838<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>9<span class="_ _3d"> </span>Virtual<span class="_ _10"> </span>Memory</span></div><div class="t m5 x1d h38 y5225 ff7 fs1b fc6 sc0 ls0 ws0">P</div><div class="t m5 xf6 h26 y9c ff7 fs19 fc1 sc0 ls0 ws0">rocesses<span class="_ _11"> </span>in<span class="_ _16"> </span>a<span class="_ _11"> </span>system<span class="_ _16"> </span>share<span class="_ _16"> </span>the<span class="_ _11"> </span>CPU<span class="_ _16"> </span>and<span class="_ _11"> </span>main<span class="_ _16"> </span>memory<span class="_ _11"> </span>with<span class="_ _16"> </span>other<span class="_ _11"> </span>processes<span class="_ _1"></span>.</div><div class="t m5 xf6 h26 y409 ff7 fs19 fc1 sc0 ls0 ws0">However,<span class="_ _6"> </span>sharing<span class="_ _6"> </span>the<span class="_ _6"> </span>main<span class="_ _13"> </span>memory<span class="_ _a"> </span>poses<span class="_ _13"> </span>some<span class="_ _a"> </span>special<span class="_ _6"> </span>challenges<span class="_ _0"></span>.<span class="_ _6"> </span>As<span class="_ _6"> </span>demand</div><div class="t m5 x1d h26 y40a ff7 fs19 fc1 sc0 ls0 ws0">on<span class="_"> </span>the<span class="_"> </span>CPU<span class="_"> </span>increases<span class="_ _1"></span>,<span class="_"> </span>processes<span class="_"> </span>slow<span class="_"> </span>down<span class="_"> </span>in<span class="_"> </span>some<span class="_"> </span>reasonably<span class="_"> </span>smooth<span class="_"> </span>way<span class="_ _3"></span>.<span class="_"> </span>But</div><div class="t m5 x1d h26 y40b ff7 fs19 fc1 sc0 ls0 ws0">if<span class="_ _14"> </span>too<span class="_ _15"> </span>many<span class="_ _15"> </span>processes<span class="_ _15"> </span>need<span class="_ _14"> </span>too<span class="_ _15"> </span>much<span class="_ _15"> </span>memory<span class="_ _3"></span>,<span class="_ _15"> </span>then<span class="_ _15"> </span>some<span class="_ _15"> </span>of<span class="_ _15"> </span>them<span class="_ _14"> </span>will<span class="_ _15"> </span>simply</div><div class="t m5 x1d h26 y40c ff7 fs19 fc1 sc0 ls0 ws0">not<span class="_ _11"> </span>be<span class="_ _16"> </span>able<span class="_ _11"> </span>to<span class="_ _16"> </span>run.<span class="_ _11"> </span>When<span class="_ _11"> </span>a<span class="_ _16"> </span>program<span class="_ _11"> </span>is<span class="_ _16"> </span>out<span class="_ _11"> </span>of<span class="_ _16"> </span>space<span class="_ _1"></span>,<span class="_ _16"> </span>it<span class="_ _11"> </span>is<span class="_ _16"> </span>out<span class="_ _11"> </span>of<span class="_ _16"> </span>luck.<span class="_ _11"> </span>Memory<span class="_ _16"> </span>is</div><div class="t m5 x1d h26 y40d ff7 fs19 fc1 sc0 ls0 ws0">also<span class="_ _13"> </span>vulnerable<span class="_ _13"> </span>to<span class="_ _13"> </span>corruption.<span class="_ _13"> </span>If<span class="_ _13"> </span>some<span class="_ _13"> </span>process<span class="_ _13"> </span>inadvertently<span class="_ _13"> </span>writes<span class="_ _13"> </span>to<span class="_ _13"> </span>the<span class="_ _13"> </span>memory</div><div class="t m5 x1d h26 y40e ff7 fs19 fc1 sc0 ls0 ws0">used<span class="_ _6"> </span>by<span class="_ _6"> </span>another<span class="_ _6"> </span>process<span class="_ _0"></span>,<span class="_ _6"> </span>that<span class="_ _13"> </span>process<span class="_ _a"> </span>might<span class="_ _13"> </span>fail<span class="_ _a"> </span>in<span class="_ _6"> </span>some<span class="_ _13"> </span>bewildering<span class="_ _a"> </span>fashion<span class="_ _13"> </span>totally</div><div class="t m5 x1d h26 y40f ff7 fs19 fc1 sc0 ls0 ws0">unrelated<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>program<span class="_"> </span>logic.</div><div class="t m5 x29 h26 y410 ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _11"> </span>order<span class="_ _11"> </span>to<span class="_ _11"> </span>manage<span class="_ _11"> </span>memory<span class="_ _11"> </span>more<span class="_ _11"> </span>efﬁciently<span class="_ _11"> </span>and<span class="_ _11"> </span>with<span class="_ _11"> </span>fewer<span class="_ _16"> </span>errors<span class="_ _3"></span>,<span class="_ _16"> </span>modern</div><div class="t m5 x1d h26 y411 ff7 fs19 fc1 sc0 ls0 ws0">systems<span class="_"> </span>provide<span class="_"> </span>an<span class="_"> </span>abstraction<span class="_"> </span>of<span class="_"> </span>main<span class="_"> </span>memory<span class="_"> </span>known<span class="_"> </span>as<span class="_"> </span><span class="ffa">virtual<span class="_"> </span>memory<span class="_ _11"> </span>(VM)<span class="_ _3"></span><span class="ff7">.</span></span></div><div class="t m5 x1d h26 y412 ff7 fs19 fc1 sc0 ls0 ws0">V<span class="_ _1"></span>irtual<span class="_ _16"> </span>memory<span class="_ _16"> </span>is<span class="_ _14"> </span>an<span class="_ _16"> </span>elegant<span class="_ _16"> </span>interaction<span class="_ _16"> </span>of<span class="_ _16"> </span>hardware<span class="_ _16"> </span>exceptions<span class="_ _1"></span>,<span class="_ _14"> </span>hardware<span class="_ _16"> </span>ad-</div><div class="t m5 x1d h26 y413 ff7 fs19 fc1 sc0 ls0 ws0">dress<span class="_ _13"> </span>translation,<span class="_"> </span>main<span class="_ _13"> </span>memory<span class="_ _3"></span>,<span class="_"> </span>disk<span class="_ _13"> </span>ﬁles<span class="_ _1"></span>,<span class="_"> </span>and<span class="_ _13"> </span>kernel<span class="_"> </span>software<span class="_ _13"> </span>that<span class="_"> </span>provides<span class="_ _13"> </span>each</div><div class="t m5 x1d h26 y414 ff7 fs19 fc1 sc0 ls0 ws0">process<span class="_ _16"> </span>with<span class="_ _16"> </span>a<span class="_ _16"> </span>large<span class="_ _1"></span>,<span class="_ _14"> </span>uniform,<span class="_ _14"> </span>and<span class="_ _16"> </span>private<span class="_ _16"> </span>address<span class="_ _16"> </span>space<span class="_ _1"></span>.<span class="_ _16"> </span>With<span class="_ _16"> </span>one<span class="_ _16"> </span>clean<span class="_ _16"> </span>mech-</div><div class="t m5 x1d h26 y415 ff7 fs19 fc1 sc0 ls0 ws0">anism,<span class="_ _f"> </span>virtual<span class="_ _21"> </span>memory<span class="_ _21"> </span>provides<span class="_ _f"> </span>three<span class="_ _21"> </span>important<span class="_ _21"> </span>capabilities:<span class="_ _21"> </span>(1)<span class="_ _21"> </span>It<span class="_ _21"> </span>uses<span class="_ _21"> </span>main</div><div class="t m5 x1d h26 y416 ff7 fs19 fc1 sc0 ls0 ws0">memory<span class="_ _11"> </span>efﬁciently<span class="_ _16"> </span>by<span class="_ _11"> </span>treating<span class="_ _16"> </span>it<span class="_ _16"> </span>as<span class="_ _11"> </span>a<span class="_ _16"> </span>cache<span class="_ _11"> </span>for<span class="_ _16"> </span>an<span class="_ _11"> </span>address<span class="_ _16"> </span>space<span class="_ _11"> </span>stored<span class="_ _16"> </span>on<span class="_ _11"> </span>disk,</div><div class="t m5 x1d h26 y434 ff7 fs19 fc1 sc0 ls0 ws0">keeping<span class="_ _14"> </span>only<span class="_ _15"> </span>the<span class="_ _14"> </span>active<span class="_ _15"> </span>areas<span class="_ _15"> </span>in<span class="_ _14"> </span>main<span class="_ _15"> </span>memory<span class="_ _14"> </span>and<span class="_ _15"> </span>transferring<span class="_ _14"> </span>data<span class="_ _15"> </span>back<span class="_ _15"> </span>and</div><div class="t m5 x1d h26 y435 ff7 fs19 fc1 sc0 ls0 ws0">forth<span class="_ _13"> </span>between<span class="_"> </span>disk<span class="_ _13"> </span>and<span class="_ _13"> </span>memory<span class="_"> </span>as<span class="_ _13"> </span>needed.<span class="_ _13"> </span>(2)<span class="_"> </span>It<span class="_ _13"> </span>simpliﬁes<span class="_ _13"> </span>memory<span class="_"> </span>management</div><div class="t m5 x1d h26 y436 ff7 fs19 fc1 sc0 ls0 ws0">by<span class="_ _13"> </span>providing<span class="_ _6"> </span>each<span class="_ _13"> </span>process<span class="_ _13"> </span>with<span class="_ _13"> </span>a<span class="_ _6"> </span>uniform<span class="_ _13"> </span>address<span class="_ _13"> </span>space<span class="_ _1"></span>.<span class="_ _13"> </span>(3)<span class="_ _13"> </span>It<span class="_ _6"> </span>protects<span class="_ _13"> </span>the<span class="_ _13"> </span>address</div><div class="t m5 x1d h26 y437 ff7 fs19 fc1 sc0 ls0 ws0">space<span class="_"> </span>of<span class="_"> </span>each<span class="_"> </span>process<span class="_"> </span>from<span class="_"> </span>corruption<span class="_"> </span>by<span class="_"> </span>other<span class="_"> </span>processes<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y438 ff7 fs19 fc1 sc0 ls0 ws0">V<span class="_ _1"></span>irtual<span class="_ _13"> </span>memory<span class="_ _13"> </span>is<span class="_ _13"> </span>one<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _6"> </span>great<span class="_ _13"> </span>ideas<span class="_ _13"> </span>in<span class="_ _13"> </span>computer<span class="_ _13"> </span>systems<span class="_ _3"></span>.<span class="_ _13"> </span>A<span class="_ _13"> </span>major<span class="_ _13"> </span>reason</div><div class="t m5 x1d h26 y439 ff7 fs19 fc1 sc0 ls0 ws0">for<span class="_"> </span>its<span class="_ _13"> </span>success<span class="_"> </span>is<span class="_"> </span>that<span class="_ _13"> </span>it<span class="_"> </span>works<span class="_"> </span>silently<span class="_ _13"> </span>and<span class="_"> </span>automatically<span class="_ _3"></span>,<span class="_"> </span>without<span class="_ _13"> </span>any<span class="_"> </span>intervention</div><div class="t m5 x1d h26 y43a ff7 fs19 fc1 sc0 ls0 ws0">from<span class="_ _13"> </span>the<span class="_ _13"> </span>application<span class="_ _13"> </span>programmer.<span class="_ _13"> </span>Since<span class="_ _13"> </span>virtual<span class="_"> </span>memory<span class="_ _13"> </span>works<span class="_ _13"> </span>so<span class="_ _13"> </span>well<span class="_ _13"> </span>behind<span class="_ _13"> </span>the</div><div class="t m5 x1d h26 y43b ff7 fs19 fc1 sc0 ls0 ws0">scenes<span class="_ _1"></span>,<span class="_ _13"> </span>why<span class="_ _a"> </span>would<span class="_ _13"> </span>a<span class="_ _a"> </span>programmer<span class="_ _6"> </span>need<span class="_ _13"> </span>to<span class="_ _a"> </span>understand<span class="_ _13"> </span>it?<span class="_ _a"> </span>There<span class="_ _a"> </span>are<span class="_ _6"> </span>several<span class="_ _13"> </span>reasons<span class="_ _3"></span>.</div><div class="t m5 x75 h3d y6bd5 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y47f5 ffa fs19 fc1 sc0 ls0 ws0">V<span class="_ _1"></span>irtual<span class="_ _14"> </span>memory<span class="_ _15"> </span>is<span class="_ _15"> </span>central.<span class="_ _11"> </span><span class="ff7">V<span class="_ _1"></span>irtual<span class="_ _15"> </span>memory<span class="_ _15"> </span>pervades<span class="_ _14"> </span>all<span class="_ _15"> </span>levels<span class="_ _15"> </span>of<span class="_ _15"> </span>computer</span></div><div class="t m5 x29 h26 y50e2 ff7 fs19 fc1 sc0 ls0 ws0">systems<span class="_ _1"></span>,<span class="_ _16"> </span>playing<span class="_ _11"> </span>key<span class="_ _11"> </span>roles<span class="_ _11"> </span>in<span class="_ _16"> </span>the<span class="_ _11"> </span>design<span class="_ _11"> </span>of<span class="_ _16"> </span>hardware<span class="_ _11"> </span>exceptions<span class="_ _1"></span>,<span class="_ _16"> </span>assemblers<span class="_ _1"></span>,</div><div class="t m5 x29 h26 y50e3 ff7 fs19 fc1 sc0 ls0 ws0">linkers<span class="_ _1"></span>,<span class="_ _21"> </span>loaders<span class="_ _1"></span>,<span class="_ _f"> </span>shared<span class="_ _15"> </span>objects<span class="_ _1"></span>,<span class="_ _f"> </span>ﬁles<span class="_ _1"></span>,<span class="_ _21"> </span>and<span class="_ _21"> </span>processes<span class="_ _1"></span>.<span class="_ _15"> </span>Understanding<span class="_ _15"> </span>virtual</div><div class="t m5 x29 h26 y50e4 ff7 fs19 fc1 sc0 ls0 ws0">memory<span class="_"> </span>will<span class="_"> </span>help<span class="_"> </span>you<span class="_"> </span>better<span class="_"> </span>understand<span class="_"> </span>how<span class="_"> </span>systems<span class="_"> </span>work<span class="_"> </span>in<span class="_"> </span>general.</div><div class="t m5 x75 h3d y6bd6 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y6bd7 ffa fs19 fc1 sc0 ls0 ws0">V<span class="_ _1"></span>irtual<span class="_ _11"> </span>memory<span class="_ _16"> </span>is<span class="_ _11"> </span>powerful.<span class="_ _13"> </span><span class="ff7">V<span class="_ _1"></span>irtual<span class="_ _11"> </span>memory<span class="_ _16"> </span>gives<span class="_ _11"> </span>applications<span class="_ _11"> </span>powerful<span class="_ _16"> </span>ca-</span></div><div class="t m5 x29 h26 y6bd8 ff7 fs19 fc1 sc0 ls0 ws0">pabilities<span class="_ _13"> </span>to<span class="_"> </span>create<span class="_ _13"> </span>and<span class="_ _13"> </span>destroy<span class="_"> </span>chunks<span class="_ _13"> </span>of<span class="_ _13"> </span>memory<span class="_ _3"></span>,<span class="_"> </span>map<span class="_ _13"> </span>chunks<span class="_ _13"> </span>of<span class="_"> </span>memory<span class="_ _13"> </span>to</div><div class="t m5 x29 h26 y6bd9 ff7 fs19 fc1 sc0 ls0 ws0">portions<span class="_ _16"> </span>of<span class="_ _11"> </span>disk<span class="_ _16"> </span>ﬁles<span class="_ _1"></span>,<span class="_ _16"> </span>and<span class="_ _16"> </span>share<span class="_ _11"> </span>memory<span class="_ _16"> </span>with<span class="_ _16"> </span>other<span class="_ _11"> </span>processes<span class="_ _1"></span>.<span class="_ _16"> </span>F<span class="_ _1"></span>or<span class="_ _16"> </span>example<span class="_ _1"></span>,</div><div class="t m5 x29 h26 y6bda ff7 fs19 fc1 sc0 ls0 ws0">did<span class="_ _13"> </span>you<span class="_ _6"> </span>know<span class="_ _13"> </span>that<span class="_ _13"> </span>you<span class="_ _6"> </span>can<span class="_ _13"> </span>read<span class="_ _13"> </span>or<span class="_ _6"> </span>modify<span class="_ _13"> </span>the<span class="_ _13"> </span>contents<span class="_ _6"> </span>of<span class="_ _13"> </span>a<span class="_ _13"> </span>disk<span class="_ _6"> </span>ﬁle<span class="_ _13"> </span>by<span class="_ _6"> </span>reading</div><div class="t m5 x29 h26 y6bdb ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_ _13"> </span>writing<span class="_ _13"> </span>memory<span class="_ _13"> </span>locations?<span class="_ _13"> </span>Or<span class="_"> </span>that<span class="_ _13"> </span>you<span class="_ _13"> </span>can<span class="_ _13"> </span>load<span class="_ _13"> </span>the<span class="_ _13"> </span>contents<span class="_ _13"> </span>of<span class="_ _13"> </span>a<span class="_"> </span>ﬁle<span class="_ _13"> </span>into</div><div class="t m5 x29 h26 y38e0 ff7 fs19 fc1 sc0 ls0 ws0">memory<span class="_"> </span>without<span class="_"> </span>doing<span class="_"> </span>any<span class="_"> </span>explicit<span class="_ _11"> </span>copying?<span class="_"> </span>Understanding<span class="_"> </span>virtual<span class="_"> </span>memory</div><div class="t m5 x29 h26 y38e1 ff7 fs19 fc1 sc0 ls0 ws0">will<span class="_"> </span>help<span class="_"> </span>you<span class="_"> </span>harness<span class="_"> </span>its<span class="_"> </span>powerful<span class="_"> </span>capabilities<span class="_"> </span>in<span class="_"> </span>your<span class="_"> </span>applications<span class="_ _1"></span>.</div><div class="t m5 x75 h3d y6bdc ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y5fe ffa fs19 fc1 sc0 ls0 ws0">V<span class="_ _1"></span>irtual<span class="_ _16"> </span>memory<span class="_ _11"> </span>is<span class="_ _16"> </span>dangerous<span class="_ _1"></span>.<span class="_ _13"> </span><span class="ff7">Applications<span class="_ _16"> </span>interact<span class="_ _16"> </span>with<span class="_ _11"> </span>virtual<span class="_ _16"> </span>memory<span class="_ _16"> </span>ev-</span></div><div class="t m5 x29 h26 y5ff ff7 fs19 fc1 sc0 ls0 ws0">ery<span class="_"> </span>time<span class="_"> </span>they<span class="_ _11"> </span>reference<span class="_"> </span>a<span class="_ _11"> </span>variable<span class="_ _1"></span>,<span class="_ _11"> </span>dereference<span class="_"> </span>a<span class="_ _11"> </span>pointer,<span class="_"> </span>or<span class="_"> </span>make<span class="_"> </span>a<span class="_ _11"> </span>call<span class="_"> </span>to<span class="_ _11"> </span>a</div><div class="t m5 x29 h26 y600 ff7 fs19 fc1 sc0 ls0 ws0">dynamic<span class="_ _6"> </span>allocation<span class="_ _13"> </span>package<span class="_ _6"> </span>such<span class="_ _13"> </span>as<span class="_ _6"> </span><span class="ffd">malloc</span>.<span class="_ _13"> </span>If<span class="_ _6"> </span>virtual<span class="_ _13"> </span>memory<span class="_ _6"> </span>is<span class="_ _13"> </span>used<span class="_ _6"> </span>improp-</div><div class="t m5 x29 h26 y601 ff7 fs19 fc1 sc0 ls0 ws0">erly<span class="_ _3"></span>,<span class="_ _14"> </span>applications<span class="_ _14"> </span>can<span class="_ _14"> </span>suffer<span class="_ _14"> </span>from<span class="_ _14"> </span>perplexing<span class="_ _14"> </span>and<span class="_ _14"> </span>insidious<span class="_ _14"> </span>memory-related</div><div class="t m5 x29 h26 y602 ff7 fs19 fc1 sc0 ls0 ws0">bugs<span class="_ _1"></span>.<span class="_"> </span>F<span class="_ _1"></span>or<span class="_"> </span>example<span class="_ _1"></span>,<span class="_"> </span>a<span class="_"> </span>program<span class="_"> </span>with<span class="_"> </span>a<span class="_"> </span>bad<span class="_"> </span>pointer<span class="_"> </span>can<span class="_"> </span>crash<span class="_"> </span>immediately<span class="_"> </span>with</div><div class="t m5 x29 h26 y603 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_ _16"> </span>“segmentation<span class="_ _11"> </span>fault”<span class="_ _16"> </span>or<span class="_ _16"> </span>a<span class="_ _11"> </span>“protection<span class="_ _16"> </span>fault,<span class="_ _1"></span>”<span class="_ _16"> </span>run<span class="_ _16"> </span>silently<span class="_ _16"> </span>for<span class="_ _11"> </span>hours<span class="_ _16"> </span>before</div><div class="t m5 x29 h26 y604 ff7 fs19 fc1 sc0 ls0 ws0">crashing,<span class="_ _16"> </span>or<span class="_ _16"> </span>scariest<span class="_ _16"> </span>of<span class="_ _14"> </span>all,<span class="_ _14"> </span>run<span class="_ _16"> </span>to<span class="_ _16"> </span>completion<span class="_ _16"> </span>with<span class="_ _14"> </span>incorrect<span class="_ _16"> </span>results<span class="_ _1"></span>.<span class="_ _16"> </span>Under<span class="_ _1"></span>-</div><div class="t m5 x29 h26 y605 ff7 fs19 fc1 sc0 ls0 ws0">standing<span class="_ _15"> </span>virtual<span class="_ _15"> </span>memory<span class="_ _3"></span>,<span class="_ _21"> </span>and<span class="_ _15"> </span>the<span class="_ _15"> </span>allocation<span class="_ _15"> </span>packages<span class="_ _15"> </span>such<span class="_ _15"> </span>as<span class="_ _15"> </span><span class="ffd">malloc<span class="_ _15"> </span></span>that</div><div class="t m5 x29 h26 y606 ff7 fs19 fc1 sc0 ls0 ws0">manage<span class="_"> </span>it,<span class="_"> </span>can<span class="_"> </span>help<span class="_"> </span>you<span class="_"> </span>avoid<span class="_"> </span>these<span class="_"> </span>errors<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
