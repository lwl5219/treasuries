<div id="pf218" class="pf w2 h11" data-page-no="218"><div class="pc pc218 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg218.png"/><div class="t m5 x255 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>5.1<span class="_ _60"> </span>Capabilities<span class="_ _10"> </span>and<span class="_ _10"> </span>Limitations<span class="_ _10"> </span>of<span class="_ _10"> </span>Optimizing<span class="_ _10"> </span>Compilers<span class="_ _3e"> </span><span class="ffe fs1e">535</span></div><div class="t m5 x17 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _14"> </span>compiler<span class="_ _14"> </span>to<span class="_ _15"> </span>perform<span class="_ _14"> </span>only<span class="_ _15"> </span>safe<span class="_ _14"> </span>optimizations<span class="_ _15"> </span>eliminates<span class="_ _14"> </span>possible<span class="_ _14"> </span>sources<span class="_ _15"> </span>of</div><div class="t m5 x17 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">undesired<span class="_ _11"> </span>run-time<span class="_ _11"> </span>behavior,<span class="_"> </span>but<span class="_ _11"> </span>it<span class="_ _11"> </span>also<span class="_ _16"> </span>means<span class="_"> </span>that<span class="_ _11"> </span>the<span class="_ _11"> </span>programmer<span class="_ _11"> </span>must<span class="_ _11"> </span>make</div><div class="t m5 x17 h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">more<span class="_ _13"> </span>of<span class="_ _13"> </span>an<span class="_"> </span>effort<span class="_ _13"> </span>to<span class="_ _13"> </span>write<span class="_ _13"> </span>programs<span class="_"> </span>in<span class="_ _13"> </span>a<span class="_ _13"> </span>way<span class="_ _13"> </span>that<span class="_"> </span>the<span class="_ _13"> </span>compiler<span class="_ _13"> </span>can<span class="_ _13"> </span>then<span class="_"> </span>transform</div><div class="t m5 x17 h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">into<span class="_"> </span>efﬁcient<span class="_"> </span>machine-level<span class="_"> </span>code.<span class="_"> </span>T<span class="_ _7"></span>o<span class="_"> </span>appreciate<span class="_ _11"> </span>the<span class="_"> </span>challenges<span class="_"> </span>of<span class="_"> </span>deciding<span class="_ _11"> </span>which</div><div class="t m5 x17 h26 y2f8 ff7 fs19 fc2 sc0 ls0 ws0">program<span class="_"> </span>transformations<span class="_"> </span>are<span class="_"> </span>safe<span class="_"> </span>or<span class="_"> </span>not,<span class="_"> </span>consider<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>two<span class="_"> </span>procedures:</div><div class="t m5 x2c h2d y31e3 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">void<span class="_ _1f"> </span>twiddle1(long<span class="_ _e"> </span>*xp,<span class="_ _1f"> </span>long<span class="_ _1f"> </span>*yp)</span></div><div class="t m5 x2c h2d y4999 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x2c h2d y499a ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2">*xp<span class="_ _e"> </span>+=<span class="_ _1f"> </span>*yp;</span></div><div class="t m5 x2c h2d y499b ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2">*xp<span class="_ _e"> </span>+=<span class="_ _1f"> </span>*yp;</span></div><div class="t m5 x2c h2d y499c ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x2c h2e y499d ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 x2c h2e y499e ff6 fs20 fc6 sc0 ls0 ws0">7</div><div class="t m5 x2d h2d y499f ffd fs1e fc2 sc0 ls0 ws0">void<span class="_ _e"> </span>twiddle2(long<span class="_ _1f"> </span>*xp,<span class="_ _1f"> </span>long<span class="_ _e"> </span>*yp)</div><div class="t m5 x2c h2d y49a0 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x2c h2d y49a1 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _20"> </span><span class="ffd fs1e fc2">*xp<span class="_ _e"> </span>+=<span class="_ _1f"> </span>2*<span class="_ _1f"> </span>*yp;</span></div><div class="t m5 x17 h2d y49a2 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x26 h26 y49a3 ff7 fs19 fc2 sc0 ls0 ws0">At<span class="_ _11"> </span>ﬁrst<span class="_ _16"> </span>glance<span class="_ _1"></span>,<span class="_ _16"> </span>both<span class="_ _11"> </span>procedures<span class="_ _11"> </span>seem<span class="_ _16"> </span>to<span class="_ _11"> </span>have<span class="_ _11"> </span>identical<span class="_ _16"> </span>behavior<span class="_ _0"></span>.<span class="_ _11"> </span>T<span class="_ _0"></span>hey<span class="_ _11"> </span>both</div><div class="t m5 x17 h26 y49a4 ff7 fs19 fc2 sc0 ls0 ws0">add<span class="_"> </span>twice<span class="_"> </span>the<span class="_ _11"> </span>value<span class="_"> </span>stored<span class="_"> </span>at<span class="_ _11"> </span>the<span class="_"> </span>location<span class="_"> </span>designated<span class="_ _11"> </span>by<span class="_"> </span>pointer<span class="_ _11"> </span><span class="ffd">yp<span class="_ _10"> </span></span>to<span class="_"> </span>that<span class="_ _11"> </span>desig-</div><div class="t m5 x17 h26 y49a5 ff7 fs19 fc2 sc0 ls0 ws0">nated<span class="_ _16"> </span>by<span class="_ _16"> </span>pointer<span class="_ _16"> </span><span class="ffd">xp</span>.<span class="_ _16"> </span>On<span class="_ _11"> </span>the<span class="_ _16"> </span>other<span class="_ _16"> </span>hand,<span class="_ _14"> </span>function<span class="_ _16"> </span><span class="ffd">twiddle2<span class="_ _16"> </span></span>is<span class="_ _16"> </span>more<span class="_ _16"> </span>efﬁcient.<span class="_ _11"> </span>It</div><div class="t m5 x17 h26 y49a6 ff7 fs19 fc2 sc0 ls0 ws0">requires<span class="_"> </span>only<span class="_ _11"> </span>three<span class="_ _11"> </span>memory<span class="_ _11"> </span>references<span class="_ _11"> </span>(read<span class="_ _11"> </span><span class="ffd">*xp</span>,<span class="_ _11"> </span>read<span class="_ _11"> </span><span class="ffd">*yp</span>,<span class="_ _16"> </span>write<span class="_"> </span><span class="ffd">*xp</span>),<span class="_ _11"> </span>whereas</div><div class="t m5 x17 h26 y49a7 ffd fs19 fc2 sc0 ls0 ws0">twiddle1<span class="_ _13"> </span><span class="ff7">requires<span class="_"> </span>six<span class="_ _13"> </span>(two<span class="_ _13"> </span>reads<span class="_ _13"> </span>of<span class="_"> </span></span>*xp<span class="ff7">,<span class="_ _13"> </span>two<span class="_ _13"> </span>reads<span class="_"> </span>of<span class="_ _13"> </span></span>*yp<span class="ff7">,<span class="_"> </span>and<span class="_ _13"> </span>two<span class="_ _13"> </span>writes<span class="_ _13"> </span>of<span class="_"> </span></span>*xp<span class="ff7">).</span></div><div class="t m5 x17 h26 y49a8 ff7 fs19 fc2 sc0 ls0 ws0">Hence<span class="_ _1"></span>,<span class="_ _15"> </span>if<span class="_ _14"> </span>a<span class="_ _14"> </span>compiler<span class="_ _15"> </span>is<span class="_ _14"> </span>given<span class="_ _14"> </span>procedure<span class="_ _14"> </span><span class="ffd">twiddle1<span class="_ _14"> </span></span>to<span class="_ _14"> </span>compile,<span class="_ _14"> </span>one<span class="_ _14"> </span>might<span class="_ _14"> </span>think</div><div class="t m5 x17 h26 y49a9 ff7 fs19 fc2 sc0 ls0 ws0">it<span class="_ _16"> </span>could<span class="_ _14"> </span>generate<span class="_ _16"> </span>more<span class="_ _14"> </span>efﬁcient<span class="_ _16"> </span>code<span class="_ _14"> </span>based<span class="_ _16"> </span>on<span class="_ _14"> </span>the<span class="_ _16"> </span>computations<span class="_ _14"> </span>performed<span class="_ _16"> </span>by</div><div class="t m5 x17 h26 y49aa ffd fs19 fc2 sc0 ls0 ws0">twiddle2<span class="ff7">.</span></div><div class="t m5 x26 h26 y49ab ff7 fs19 fc2 sc0 ls0 ws0">Consider,<span class="_ _15"> </span>however,<span class="_ _21"> </span>the<span class="_ _21"> </span>case<span class="_ _15"> </span>in<span class="_ _15"> </span>which<span class="_ _21"> </span><span class="ffd">xp<span class="_ _15"> </span></span>and<span class="_ _15"> </span><span class="ffd">yp<span class="_ _21"> </span></span>are<span class="_ _15"> </span>equal.<span class="_ _15"> </span>Then<span class="_ _14"> </span>function</div><div class="t m5 x17 h26 y49ac ffd fs19 fc2 sc0 ls0 ws0">twiddle1<span class="_ _10"> </span><span class="ff7">will<span class="_"> </span>perform<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>computations:</span></div><div class="t m5 x2c h2d y49ad ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2">*xp<span class="_ _e"> </span>+=<span class="_ _1f"> </span>*xp;<span class="_ _1a"> </span>/*<span class="_ _1f"> </span>Double<span class="_ _e"> </span>value<span class="_ _1f"> </span>at<span class="_ _e"> </span>xp<span class="_ _1f"> </span>*/</span></div><div class="t m5 x2c h2d y49ae ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2">*xp<span class="_ _e"> </span>+=<span class="_ _1f"> </span>*xp;<span class="_ _1a"> </span>/*<span class="_ _1f"> </span>Double<span class="_ _e"> </span>value<span class="_ _1f"> </span>at<span class="_ _e"> </span>xp<span class="_ _1f"> </span>*/</span></div><div class="t m5 x17 h26 y49af ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _16"> </span>result<span class="_ _16"> </span>will<span class="_ _11"> </span>be<span class="_ _16"> </span>that<span class="_ _16"> </span>the<span class="_ _16"> </span>value<span class="_ _11"> </span>at<span class="_ _16"> </span><span class="ffd">xp<span class="_ _16"> </span></span>will<span class="_ _16"> </span>be<span class="_ _11"> </span>increased<span class="_ _16"> </span>by<span class="_ _16"> </span>a<span class="_ _11"> </span>factor<span class="_ _16"> </span>of<span class="_ _16"> </span>4.<span class="_ _16"> </span>On<span class="_ _11"> </span>the</div><div class="t m5 x17 h26 y49b0 ff7 fs19 fc2 sc0 ls0 ws0">other<span class="_"> </span>hand,<span class="_"> </span>function<span class="_"> </span><span class="ffd">twiddle2<span class="_ _10"> </span></span>will<span class="_"> </span>perform<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>computation:</div><div class="t m5 x2c h2d y49b1 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _20"> </span><span class="ffd fs1e fc2">*xp<span class="_ _e"> </span>+=<span class="_ _1f"> </span>2*<span class="_ _1f"> </span>*xp;<span class="_ _3b"> </span>/*<span class="_ _1f"> </span>Triple<span class="_ _1f"> </span>value<span class="_ _e"> </span>at<span class="_ _1f"> </span>xp<span class="_ _e"> </span>*/</span></div><div class="t m5 x17 h26 y49b2 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _6"> </span>result<span class="_ _6"> </span>will<span class="_ _6"> </span>be<span class="_ _6"> </span>that<span class="_ _6"> </span>the<span class="_ _13"> </span>value<span class="_ _a"> </span>at<span class="_ _6"> </span><span class="ffd">xp<span class="_ _6"> </span></span>will<span class="_ _6"> </span>be<span class="_ _6"> </span>increased<span class="_ _6"> </span>by<span class="_ _6"> </span>a<span class="_ _6"> </span>factor<span class="_ _6"> </span>of<span class="_ _6"> </span>3.<span class="_ _6"> </span>The<span class="_ _a"> </span>compiler</div><div class="t m5 x17 h26 y49b3 ff7 fs19 fc2 sc0 ls0 ws0">knows<span class="_ _14"> </span>nothing<span class="_ _14"> </span>about<span class="_ _14"> </span>how<span class="_ _14"> </span><span class="ffd">twiddle1<span class="_ _14"> </span></span>will<span class="_ _15"> </span>be<span class="_ _14"> </span>called,<span class="_ _15"> </span>and<span class="_ _14"> </span>so<span class="_ _14"> </span>it<span class="_ _14"> </span>must<span class="_ _14"> </span>assume<span class="_ _14"> </span>that</div><div class="t m5 x17 h26 y49b4 ff7 fs19 fc2 sc0 ls0 ws0">arguments<span class="_"> </span><span class="ffd">xp<span class="_ _10"> </span></span>and<span class="_"> </span><span class="ffd">yp<span class="_ _11"> </span></span>can<span class="_"> </span>be<span class="_"> </span>equal.<span class="_"> </span>It<span class="_"> </span>therefore<span class="_"> </span>cannot<span class="_"> </span>generate<span class="_"> </span>code<span class="_ _11"> </span>in<span class="_"> </span>the<span class="_"> </span>style</div><div class="t m5 x17 h26 y49b5 ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_"> </span><span class="ffd">twiddle2<span class="_ _10"> </span></span>as<span class="_"> </span>an<span class="_"> </span>optimized<span class="_"> </span>version<span class="_"> </span>of<span class="_"> </span><span class="ffd">twiddle1</span>.</div><div class="t m5 x26 h26 y49b6 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _21"> </span>case<span class="_ _21"> </span>where<span class="_ _15"> </span>two<span class="_ _21"> </span>pointers<span class="_ _21"> </span>may<span class="_ _15"> </span>designate<span class="_ _21"> </span>the<span class="_ _21"> </span>same<span class="_ _15"> </span>memory<span class="_ _21"> </span>location<span class="_ _21"> </span>is</div><div class="t m5 x17 h26 y49b7 ff7 fs19 fc2 sc0 ls0 ws0">known<span class="_ _16"> </span>as<span class="_ _11"> </span><span class="ffa">memory<span class="_ _16"> </span>aliasing<span class="_ _2"></span></span>.<span class="_ _16"> </span>In<span class="_ _16"> </span>performing<span class="_ _16"> </span>only<span class="_ _11"> </span>safe<span class="_ _16"> </span>optimizations<span class="_ _1"></span>,<span class="_ _16"> </span>the<span class="_ _16"> </span>compiler</div><div class="t m5 x17 h26 y49b8 ff7 fs19 fc2 sc0 ls0 ws0">must<span class="_ _16"> </span>assume<span class="_ _14"> </span>that<span class="_ _14"> </span>different<span class="_ _16"> </span>pointers<span class="_ _14"> </span>may<span class="_ _14"> </span>be<span class="_ _14"> </span>aliased.<span class="_ _16"> </span>As<span class="_ _14"> </span>another<span class="_ _14"> </span>example<span class="_ _1"></span>,<span class="_ _15"> </span>for<span class="_ _16"> </span>a</div><div class="t m5 x17 h26 y49b9 ff7 fs19 fc2 sc0 ls0 ws0">program<span class="_"> </span>with<span class="_"> </span>pointer<span class="_"> </span>variables<span class="_"> </span><span class="ffd">p<span class="_ _10"> </span></span>and<span class="_"> </span><span class="ffd">q</span>,<span class="_"> </span>consider<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>code<span class="_"> </span>sequence:</div><div class="t m5 x1b6 h2d y20a6 ffd fs1e fc2 sc0 ls0 ws0">x<span class="_ _e"> </span>=<span class="_ _1f"> </span>1000;<span class="_ _1f"> </span>y<span class="_ _e"> </span>=<span class="_ _1f"> </span>3000;</div><div class="t m5 x1b6 h2d y49ba ffd fs1e fc2 sc0 ls0 ws0">*q<span class="_ _e"> </span>=<span class="_ _1f"> </span>y;<span class="_ _3f"> </span>/*<span class="_ _1f"> </span>3000<span class="_ _e"> </span>*/</div><div class="t m5 x1b6 h2d y49bb ffd fs1e fc2 sc0 ls0 ws0">*p<span class="_ _e"> </span>=<span class="_ _1f"> </span>x;<span class="_ _3f"> </span>/*<span class="_ _1f"> </span>1000<span class="_ _e"> </span>*/</div><div class="t m5 x1b6 h2d y49bc ffd fs1e fc2 sc0 ls0 ws0">t1<span class="_ _e"> </span>=<span class="_ _1f"> </span>*q;<span class="_ _1a"> </span>/*<span class="_ _1f"> </span>1000<span class="_ _e"> </span>or<span class="_ _1f"> </span>3000<span class="_ _e"> </span>*/</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
