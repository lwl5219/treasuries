<div id="pf42e" class="pf w2 h11" data-page-no="42e"><div class="pc pc42e w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg42e.png"/><div class="t m5 x23c h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Homework<span class="_ _10"> </span>Problems<span class="_ _1b"> </span><span class="ffe fs1e">1069</span></div><div class="t m5 x17 h28 y140c ffe fs1e fc6 sc0 ls0 ws0">12.26</div><div class="t m5 x1d2 h73 ye7 ff10 fs19 fc6 sc0 ls0 ws0">◆◆◆</div><div class="t m5 x17 h26 y2a7 ff7 fs19 fc1 sc0 ls0 ws0">Use<span class="_ _11"> </span>the<span class="_ _11"> </span>lock-and-copy<span class="_ _16"> </span>technique<span class="_ _11"> </span>to<span class="_ _11"> </span>implement<span class="_ _11"> </span>a<span class="_ _16"> </span>thread-safe<span class="_ _11"> </span>non-reentrant<span class="_ _11"> </span>ver<span class="_ _1"></span>-</div><div class="t m5 x17 h26 y2a8 ff7 fs19 fc1 sc0 ls0 ws0">sion<span class="_ _16"> </span>of<span class="_ _16"> </span><span class="ffd">gethostbyname<span class="_ _16"> </span></span>called<span class="_ _16"> </span><span class="ffd">gethostbyname_ts</span>.<span class="_ _14"> </span>A<span class="_ _16"> </span>correct<span class="_ _16"> </span>solution<span class="_ _16"> </span>will<span class="_ _16"> </span>use<span class="_ _16"> </span>a</div><div class="t m5 x17 h26 y2f7 ff7 fs19 fc1 sc0 ls0 ws0">deep<span class="_"> </span>copy<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span><span class="ffd">hostent<span class="_ _10"> </span></span>structure<span class="_"> </span>protected<span class="_"> </span>by<span class="_"> </span>a<span class="_"> </span>mutex.</div><div class="t m5 x17 h73 y84f6 ffe fs1e fc6 sc0 ls0 ws0">12.27<span class="_ _23"> </span><span class="ff10 fs19">◆◆</span></div><div class="t m5 x17 h26 y84f7 ff7 fs19 fc1 sc0 ls0 ws0">Some<span class="_ _13"> </span>network<span class="_ _13"> </span>programming<span class="_ _13"> </span>texts<span class="_ _13"> </span>suggest<span class="_ _13"> </span>the<span class="_ _13"> </span>following<span class="_ _6"> </span>approach<span class="_ _13"> </span>for<span class="_ _13"> </span>reading<span class="_ _13"> </span>and</div><div class="t m5 x17 h26 y84f8 ff7 fs19 fc1 sc0 ls0 ws0">writing<span class="_ _13"> </span>sockets:<span class="_"> </span>Before<span class="_ _13"> </span>interacting<span class="_ _13"> </span>with<span class="_ _13"> </span>the<span class="_"> </span>client,<span class="_ _13"> </span>open<span class="_ _13"> </span>two<span class="_ _13"> </span>standard<span class="_"> </span>I/O<span class="_ _13"> </span>streams</div><div class="t m5 x17 h26 y84f9 ff7 fs19 fc1 sc0 ls0 ws0">on<span class="_ _6"> </span>the<span class="_ _6"> </span>same<span class="_ _6"> </span>open<span class="_ _13"> </span>connected<span class="_ _a"> </span>socket<span class="_ _13"> </span>descriptor<span class="_ _1"></span>,<span class="_ _13"> </span>one<span class="_ _6"> </span>for<span class="_ _6"> </span>reading<span class="_ _6"> </span>and<span class="_ _13"> </span>one<span class="_ _a"> </span>for<span class="_ _6"> </span>writing:</div><div class="t m5 x1b6 h2d y84fa ffd fs1e fc2 sc0 ls0 ws0">FILE<span class="_ _e"> </span>*fpin,<span class="_ _1f"> </span>*fpout;</div><div class="t m5 x1b6 h2d y84fb ffd fs1e fc2 sc0 ls0 ws0">fpin<span class="_ _e"> </span>=<span class="_ _1f"> </span>fdopen(sockfd,<span class="_ _1f"> </span>&quot;r&quot;);</div><div class="t m5 x1b6 h2d y84fc ffd fs1e fc2 sc0 ls0 ws0">fpout<span class="_ _e"> </span>=<span class="_ _1f"> </span>fdopen(sockfd,<span class="_ _1f"> </span>&quot;w&quot;);</div><div class="t m5 x17 h26 y2d5e ff7 fs19 fc2 sc0 ls0 ws0">When<span class="_ _13"> </span>the<span class="_ _13"> </span>server<span class="_"> </span>ﬁnishes<span class="_ _13"> </span>interacting<span class="_ _13"> </span>with<span class="_ _13"> </span>the<span class="_"> </span>client,<span class="_ _13"> </span>close<span class="_ _13"> </span>both<span class="_"> </span>streams<span class="_ _13"> </span>as<span class="_ _13"> </span>follows:</div><div class="t m5 x1b6 h2d y84fd ffd fs1e fc2 sc0 ls0 ws0">fclose(fpin);</div><div class="t m5 x1b6 h2d y84fe ffd fs1e fc2 sc0 ls0 ws0">fclose(fpout);</div><div class="t m5 x26 h26 y84ff ff7 fs19 fc2 sc0 ls0 ws0">However,<span class="_ _16"> </span>if<span class="_ _14"> </span>you<span class="_ _16"> </span>try<span class="_ _16"> </span>this<span class="_ _14"> </span>approach<span class="_ _16"> </span>in<span class="_ _14"> </span>a<span class="_ _16"> </span>concurrent<span class="_ _14"> </span>server<span class="_ _16"> </span>based<span class="_ _16"> </span>on<span class="_ _14"> </span>threads<span class="_ _1"></span>,</div><div class="t m5 x17 h26 y8500 ff7 fs19 fc2 sc0 ls0 ws0">you<span class="_"> </span>will<span class="_"> </span>create<span class="_"> </span>a<span class="_"> </span>deadly<span class="_"> </span>race<span class="_"> </span>condition.<span class="_"> </span>Explain.</div><div class="t m5 x17 h73 y50c9 ffe fs1e fc6 sc0 ls0 ws0">12.28<span class="_ _23"> </span><span class="ff10 fs19">◆</span></div><div class="t m5 x17 h26 y8501 ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>12.45,<span class="_"> </span>does<span class="_"> </span>swapping<span class="_"> </span>the<span class="_ _13"> </span>order<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>two<span class="_"> </span><span class="ff11">V<span class="_ _21"> </span></span>operations<span class="_"> </span>have<span class="_"> </span>any<span class="_"> </span>effect</div><div class="t m5 x17 h26 y8502 ff7 fs19 fc1 sc0 ls0 ws0">on<span class="_ _16"> </span>whether<span class="_ _14"> </span>or<span class="_ _14"> </span>not<span class="_ _16"> </span>the<span class="_ _14"> </span>program<span class="_ _16"> </span>deadlocks?<span class="_ _14"> </span>J<span class="_ _1"></span>ustify<span class="_ _14"> </span>your<span class="_ _14"> </span>answer<span class="_ _16"> </span>by<span class="_ _14"> </span>drawing<span class="_ _14"> </span>the</div><div class="t m5 x17 h26 y8503 ff7 fs19 fc1 sc0 ls0 ws0">progress<span class="_"> </span>graphs<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>four<span class="_"> </span>possible<span class="_"> </span>cases:</div><div class="t m5 xe h31 y8504 ff7 fs21 fc2 sc0 ls0 ws0">Case<span class="_"> </span>1<span class="_ _234"> </span>Case<span class="_"> </span>2<span class="_ _1b0"> </span>Case<span class="_"> </span>3<span class="_ _234"> </span>Case<span class="_"> </span>4</div><div class="t m5 x17 h31 y8505 ff7 fs21 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>hread<span class="_"> </span>1<span class="_ _18"> </span>T<span class="_ _1"></span>hread<span class="_"> </span>2<span class="_ _b9"> </span>T<span class="_ _1"></span>hread<span class="_"> </span>1<span class="_ _18"> </span>T<span class="_ _1"></span>hread<span class="_"> </span>2<span class="_ _b9"> </span>T<span class="_ _1"></span>hread<span class="_"> </span>1<span class="_ _18"> </span>T<span class="_ _1"></span>hread<span class="_"> </span>2<span class="_ _b9"> </span>T<span class="_ _1"></span>hread<span class="_"> </span>1<span class="_ _18"> </span>T<span class="_ _1"></span>hread<span class="_"> </span>2</div><div class="t m5 x34 h2d y8506 ffd fs1e fc2 sc0 ls0 ws0">P(s)<span class="_ _5a"> </span>P(s)<span class="_ _c0"> </span>P(s)<span class="_ _5a"> </span>P(s)<span class="_ _55"> </span>P(s)<span class="_ _5a"> </span>P(s)<span class="_ _c0"> </span>P(s)<span class="_ _5a"> </span>P(s)</div><div class="t m5 x34 h2d y8507 ffd fs1e fc2 sc0 ls0 ws0">P(t)<span class="_ _5a"> </span>P(t)<span class="_ _c0"> </span>P(t)<span class="_ _5a"> </span>P(t)<span class="_ _55"> </span>P(t)<span class="_ _5a"> </span>P(t)<span class="_ _c0"> </span>P(t)<span class="_ _5a"> </span>P(t)</div><div class="t m5 x34 h2d y8508 ffd fs1e fc2 sc0 ls0 ws0">V(s)<span class="_ _5a"> </span>V(s)<span class="_ _c0"> </span>V(s)<span class="_ _5a"> </span>V(t)<span class="_ _55"> </span>V(t)<span class="_ _5a"> </span>V(s)<span class="_ _c0"> </span>V(t)<span class="_ _5a"> </span>V(t)</div><div class="t m5 x34 h2d y8509 ffd fs1e fc2 sc0 ls0 ws0">V(t)<span class="_ _5a"> </span>V(t)<span class="_ _c0"> </span>V(t)<span class="_ _5a"> </span>V(s)<span class="_ _55"> </span>V(s)<span class="_ _5a"> </span>V(t)<span class="_ _c0"> </span>V(s)<span class="_ _5a"> </span>V(s)</div><div class="t m5 x17 h28 y850a ffe fs1e fc6 sc0 ls0 ws0">12.29</div><div class="t m5 x1d2 h73 y850b ff10 fs19 fc6 sc0 ls0 ws0">◆</div><div class="t m5 x17 h26 y850c ff7 fs19 fc1 sc0 ls0 ws0">Can<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>program<span class="_"> </span>deadlock?<span class="_"> </span>Why<span class="_"> </span>or<span class="_"> </span>why<span class="_"> </span>not?</div><div class="t m5 x17 h2d y2594 ffd fs1e fc2 sc0 ls0 ws0">Initially<span class="ls33">:a=1<span class="_ _41"></span>,b=1<span class="_ _41"></span>,c=1<span class="_ _41"></span>.</span></div><div class="t m5 x17 h2d y2596 ffd fs1e fc2 sc0 ls0 ws0">Thread<span class="_ _e"> </span>1:<span class="_ _2b"> </span>Thread<span class="_ _e"> </span>2:</div><div class="t m5 x245 h2d y2597 ffd fs1e fc2 sc0 ls0 ws0">P(a);<span class="_ _192"> </span>P(c);</div><div class="t m5 x245 h2d y2598 ffd fs1e fc2 sc0 ls0 ws0">P(b);<span class="_ _192"> </span>P(b);</div><div class="t m5 x245 h2d y2599 ffd fs1e fc2 sc0 ls0 ws0">V(b);<span class="_ _192"> </span>V(b);</div><div class="t m5 x245 h2d y259a ffd fs1e fc2 sc0 ls0 ws0">P(c);<span class="_ _192"> </span>V(c);</div><div class="t m5 x245 h2d y259b ffd fs1e fc2 sc0 ls0 ws0">V(c);</div><div class="t m5 x245 h2d y850d ffd fs1e fc2 sc0 ls0 ws0">V(a);</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
