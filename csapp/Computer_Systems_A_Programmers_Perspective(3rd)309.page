<div id="pf135" class="pf w2 h11" data-page-no="135"><div class="pc pc135 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg135.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">308<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 x1d h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">Section<span class="_"> </span>3.11.<span class="_"> </span>The<span class="_"> </span>numeric<span class="_"> </span>value<span class="_"> </span>of<span class="_ _11"> </span><span class="ffd">u<span class="_ _10"> </span></span>will<span class="_ _11"> </span>bear<span class="_"> </span>no<span class="_ _11"> </span>relation<span class="_"> </span>to<span class="_ _11"> </span>that<span class="_"> </span>of<span class="_ _11"> </span><span class="ffd">d</span>,<span class="_"> </span>except<span class="_ _11"> </span>for</div><div class="t m5 x1d h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>case<span class="_"> </span>when<span class="_"> </span><span class="ffd">d<span class="_ _10"> </span></span>is<span class="_"> </span>0.0.</div><div class="t m5 x29 h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">When<span class="_ _14"> </span>using<span class="_ _14"> </span>unions<span class="_ _15"> </span>to<span class="_ _14"> </span>combine<span class="_ _15"> </span>data<span class="_ _15"> </span>types<span class="_ _14"> </span>of<span class="_ _15"> </span>different<span class="_ _14"> </span>sizes<span class="_ _1"></span>,<span class="_ _21"> </span>byte-ordering</div><div class="t m5 x1d h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">issues<span class="_ _14"> </span>can<span class="_ _14"> </span>become<span class="_ _14"> </span>important.<span class="_ _14"> </span>F<span class="_ _1"></span>or<span class="_ _14"> </span>example<span class="_ _0"></span>,<span class="_ _15"> </span>suppose<span class="_ _14"> </span>we<span class="_ _14"> </span>write<span class="_ _14"> </span>a<span class="_ _14"> </span>procedure<span class="_ _14"> </span>that</div><div class="t m5 x1d h26 y2f8 ff7 fs19 fc2 sc0 ls0 ws0">will<span class="_"> </span>create<span class="_"> </span>an<span class="_"> </span>8-byte<span class="_ _11"> </span><span class="ffd">double<span class="_ _10"> </span></span>using<span class="_"> </span>the<span class="_ _11"> </span>bit<span class="_"> </span>patterns<span class="_"> </span>given<span class="_"> </span>by<span class="_ _11"> </span>two<span class="_"> </span>4-byte<span class="_"> </span><span class="ffd">unsigned</span></div><div class="t m5 x1d h26 y2f9 ff7 fs19 fc2 sc0 ls0 ws0">values:</div><div class="t m5 x1d h2d y2c67 ffd fs1e fc2 sc0 ls0 ws0">double<span class="_ _e"> </span>uu2double(unsigned<span class="_ _1f"> </span>word0,<span class="_ _1f"> </span>unsigned<span class="_ _e"> </span>word1)</div><div class="t m5 x1d h2d y2c68 ffd fs1e fc2 sc0 ls0 ws0">{</div><div class="t m5 x10c h2d y2c69 ffd fs1e fc2 sc0 ls0 ws0">union<span class="_ _e"> </span>{</div><div class="t m5 x22b h2d y2c6a ffd fs1e fc2 sc0 ls0 ws0">double<span class="_ _e"> </span>d;</div><div class="t m5 x22b h2d y2c6b ffd fs1e fc2 sc0 ls0 ws0">unsigned<span class="_ _e"> </span>u[2];</div><div class="t m5 x10c h2d y2c6c ffd fs1e fc2 sc0 ls0 ws0">}<span class="_ _e"> </span>temp;</div><div class="t m5 x10c h2d y2c6d ffd fs1e fc2 sc0 ls0 ws0">temp.u[0]<span class="_ _e"> </span>=<span class="_ _1f"> </span>word0;</div><div class="t m5 x10c h2d y2c6e ffd fs1e fc2 sc0 ls0 ws0">temp.u[1]<span class="_ _e"> </span>=<span class="_ _1f"> </span>word1;</div><div class="t m5 x10c h2d y2c6f ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>temp.d;</div><div class="t m5 x1d h2d y2c70 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x1d h26 y2c71 ff7 fs19 fc2 sc0 ls0 ws0">On<span class="_ _15"> </span>a<span class="_ _15"> </span>little-endian<span class="_ _21"> </span>machine<span class="_ _1"></span>,<span class="_ _f"> </span>such<span class="_ _15"> </span>as<span class="_ _21"> </span>an<span class="_ _15"> </span>x86-64<span class="_ _15"> </span>processor,<span class="_ _21"> </span>argument<span class="_ _21"> </span><span class="ffd">word0<span class="_ _15"> </span></span>will</div><div class="t m5 x1d h26 y2c72 ff7 fs19 fc2 sc0 ls0 ws0">become<span class="_ _15"> </span>the<span class="_ _15"> </span>low-order<span class="_ _15"> </span>4<span class="_ _15"> </span>bytes<span class="_ _15"> </span>of<span class="_ _15"> </span><span class="ffd">d</span>,<span class="_ _21"> </span>while<span class="_ _15"> </span><span class="ffd">word1<span class="_ _15"> </span></span>will<span class="_ _15"> </span>become<span class="_ _15"> </span>the<span class="_ _15"> </span>high-order<span class="_ _15"> </span>4</div><div class="t m5 x1d h26 y2c73 ff7 fs19 fc2 sc0 ls0 ws0">bytes<span class="_ _1"></span>.<span class="_"> </span>On<span class="_"> </span>a<span class="_"> </span>big-endian<span class="_"> </span>machine<span class="_ _1"></span>,<span class="_"> </span>the<span class="_"> </span>role<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>two<span class="_"> </span>arguments<span class="_"> </span>will<span class="_"> </span>be<span class="_"> </span>reversed.</div><div class="t m5 x1d h47 y2c74 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>3.43<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>380)</span></div><div class="t m5 x1d h26 y2c75 ff7 fs19 fc1 sc0 ls0 ws0">Suppose<span class="_ _13"> </span>you<span class="_"> </span>are<span class="_ _13"> </span>given<span class="_ _13"> </span>the<span class="_"> </span>job<span class="_ _13"> </span>of<span class="_ _13"> </span>checking<span class="_ _13"> </span>that<span class="_"> </span>a<span class="_ _13"> </span>C<span class="_ _13"> </span>compiler<span class="_"> </span>generates<span class="_ _13"> </span>the<span class="_ _13"> </span>proper</div><div class="t m5 x1d h26 y2c76 ff7 fs19 fc1 sc0 ls0 ws0">code<span class="_ _13"> </span>for<span class="_ _13"> </span>structure<span class="_ _13"> </span>and<span class="_ _6"> </span>union<span class="_ _13"> </span>access<span class="_ _1"></span>.<span class="_ _13"> </span>Y<span class="_ _3"></span>ou<span class="_ _13"> </span>write<span class="_ _13"> </span>the<span class="_ _6"> </span>following<span class="_ _13"> </span>structure<span class="_ _13"> </span>declaration:</div><div class="t m5 x1d h2d y2c77 ffd fs1e fc2 sc0 ls0 ws0">typedef<span class="_ _e"> </span>union<span class="_ _1f"> </span>{</div><div class="t m5 x10c h2d y2c78 ffd fs1e fc2 sc0 ls0 ws0">struct<span class="_ _e"> </span>{</div><div class="t m5 x22b h2d y2c79 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _3f"> </span>u;</div><div class="t m5 x22b h2d y2c7a ffd fs1e fc2 sc0 ls0 ws0">short<span class="_ _1a"> </span>v;</div><div class="t m5 x22b h2d y2c7b ffd fs1e fc2 sc0 ls0 ws0">char<span class="_ _3f"> </span>w;</div><div class="t m5 x10c h2d y2c7c ffd fs1e fc2 sc0 ls0 ws0">}<span class="_ _e"> </span>t1;</div><div class="t m5 x10c h2d y2c7d ffd fs1e fc2 sc0 ls0 ws0">struct<span class="_ _e"> </span>{</div><div class="t m5 x22b h2d y2c7e ffd fs1e fc2 sc0 ls0 ws0">int<span class="_ _e"> </span>a[2];</div><div class="t m5 x22b h2d y2c7f ffd fs1e fc2 sc0 ls0 ws0">char<span class="_ _1a"> </span>*p;</div><div class="t m5 x10c h2d y2c80 ffd fs1e fc2 sc0 ls0 ws0">}<span class="_ _e"> </span>t2;</div><div class="t m5 x1d h2d y2c81 ffd fs1e fc2 sc0 ls0 ws0">}<span class="_ _e"> </span>u_type;</div><div class="t m5 x1d h26 y2c82 ff7 fs19 fc2 sc0 ls0 ws0">Y<span class="_ _3"></span>ou<span class="_"> </span>write<span class="_"> </span>a<span class="_"> </span>series<span class="_"> </span>of<span class="_"> </span>functions<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>form</div><div class="t m5 x1d h53 y2c83 ffd fs1e fc2 sc0 ls0 ws0">void<span class="_ _e"> </span>get(u_type<span class="_ _1f"> </span>*up,<span class="_ _1f"> </span><span class="ffa">type<span class="_ _e"> </span></span>*dest)<span class="_ _1f"> </span>{</div><div class="t m5 x10c h53 y2c84 ffd fs1e fc2 sc0 ls0 ws0">*dest<span class="_ _e"> </span>=<span class="_ _1a"> </span><span class="ffa">expr<span class="_ _2"></span></span>;</div><div class="t m5 x1d h2d y2c85 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x1d h26 y77e ff7 fs19 fc2 sc0 ls0 ws0">with<span class="_ _21"> </span>different<span class="_ _21"> </span>access<span class="_ _21"> </span>expressions<span class="_ _21"> </span><span class="ffa">expr<span class="_ _f"> </span></span>and<span class="_ _21"> </span>with<span class="_ _f"> </span>destination<span class="_ _21"> </span>data<span class="_ _21"> </span>type<span class="_ _21"> </span><span class="ffa">type<span class="_ _21"> </span></span>set</div><div class="t m5 x1d h26 y77f ff7 fs19 fc2 sc0 ls0 ws0">according<span class="_ _15"> </span>to<span class="_ _15"> </span>type<span class="_ _15"> </span>associated<span class="_ _14"> </span>with<span class="_ _15"> </span><span class="ffa">expr<span class="_ _2"></span></span>.<span class="_ _15"> </span>Y<span class="_ _3"></span>ou<span class="_ _15"> </span>then<span class="_ _15"> </span>examine<span class="_ _15"> </span>the<span class="_ _15"> </span>code<span class="_ _15"> </span>generated</div><div class="t m5 x1d h26 y2c86 ff7 fs19 fc2 sc0 ls0 ws0">when<span class="_"> </span>compiling<span class="_"> </span>the<span class="_"> </span>functions<span class="_"> </span>to<span class="_"> </span>see<span class="_"> </span>if<span class="_"> </span>they<span class="_"> </span>match<span class="_"> </span>your<span class="_"> </span>expectations<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
