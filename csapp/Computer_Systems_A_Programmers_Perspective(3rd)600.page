<div id="pf258" class="pf w2 h11" data-page-no="258"><div class="pc pc258 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg258.png"/><div class="t m5 x10f h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>5.14<span class="_ _60"> </span>Identifying<span class="_ _10"> </span>and<span class="_ _10"> </span>Eliminating<span class="_ _10"> </span>Performance<span class="_ _10"> </span>Bottlenecks<span class="_ _3e"> </span><span class="ffe fs1e">599</span></div><div class="t m5 x17 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _11"> </span>relative<span class="_ _11"> </span>importance<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span>different<span class="_ _11"> </span>functions<span class="_ _11"> </span>in<span class="_ _11"> </span>determining<span class="_ _16"> </span>the<span class="_ _11"> </span>overall<span class="_ _11"> </span>run</div><div class="t m5 x17 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">time<span class="_ _1"></span>.<span class="_ _13"> </span>The<span class="_ _6"> </span>calling<span class="_ _13"> </span>information<span class="_ _13"> </span>allows<span class="_ _13"> </span>us<span class="_ _13"> </span>to<span class="_ _13"> </span>understand<span class="_ _13"> </span>the<span class="_ _13"> </span>dynamic<span class="_ _13"> </span>behavior<span class="_ _6"> </span>of<span class="_ _13"> </span>the</div><div class="t m5 x17 h26 y2a8 ff7 fs19 fc2 sc0 ls0 ws0">program.</div><div class="t m5 x26 h26 y2f7 ff7 fs19 fc2 sc0 ls0 ws0">Proﬁling<span class="_ _11"> </span>with<span class="_ _11"> </span><span class="ff9">gprof<span class="_ _11"> </span></span>requires<span class="_ _11"> </span>three<span class="_ _16"> </span>steps<span class="_ _3"></span>,<span class="_ _16"> </span>as<span class="_ _11"> </span>shown<span class="_ _11"> </span>for<span class="_ _11"> </span>a<span class="_ _11"> </span>C<span class="_ _16"> </span>program<span class="_"> </span><span class="ffd">prog.c</span>,</div><div class="t m5 x17 h26 y2f8 ff7 fs19 fc2 sc0 ls0 ws0">which<span class="_"> </span>runs<span class="_"> </span>with<span class="_"> </span>command-line<span class="_"> </span>argument<span class="_"> </span><span class="ffd">file.txt</span>:</div><div class="t m5 x1cd h26 y50c0 ffc fs19 fc2 sc0 ls0 ws0">1.<span class="_ _e"> </span><span class="ff7">The<span class="_"> </span>program<span class="_ _13"> </span>must<span class="_"> </span>be<span class="_"> </span>compiled<span class="_"> </span>and<span class="_"> </span>linked<span class="_ _13"> </span>for<span class="_"> </span>proﬁling.<span class="_"> </span>W<span class="_ _1"></span>ith<span class="_"> </span><span class="ff9">gcc<span class="_ _10"> </span></span>(and<span class="_"> </span>other</span></div><div class="t m5 x26 h26 y50c1 ff7 fs19 fc2 sc0 ls0 ws0">C<span class="_ _21"> </span>compilers),<span class="_ _e"> </span>this<span class="_ _f"> </span>involves<span class="_ _21"> </span>simply<span class="_ _f"> </span>including<span class="_ _f"> </span>the<span class="_ _f"> </span>run-time<span class="_ _f"> </span>ﬂag<span class="_ _f"> </span><span class="ffd">-pg<span class="_ _21"> </span></span>on<span class="_ _f"> </span>the</div><div class="t m5 x26 h26 y50c2 ff7 fs19 fc2 sc0 ls0 ws0">command<span class="_ _13"> </span>line<span class="_ _0"></span>.<span class="_ _13"> </span>It<span class="_ _13"> </span>is<span class="_"> </span>important<span class="_ _13"> </span>to<span class="_ _13"> </span>ensure<span class="_ _13"> </span>that<span class="_ _13"> </span>the<span class="_"> </span>compiler<span class="_ _13"> </span>does<span class="_ _13"> </span>not<span class="_ _13"> </span>attempt<span class="_ _13"> </span>to</div><div class="t m5 x26 h26 y50c3 ff7 fs19 fc2 sc0 ls0 ws0">perform<span class="_ _13"> </span>any<span class="_ _13"> </span>optimizations<span class="_ _13"> </span>via<span class="_ _6"> </span>inline<span class="_ _13"> </span>substitution,<span class="_ _13"> </span>or<span class="_ _13"> </span>else<span class="_ _13"> </span>the<span class="_ _13"> </span>calls<span class="_ _13"> </span>to<span class="_ _13"> </span>functions</div><div class="t m5 x26 h26 y217 ff7 fs19 fc2 sc0 ls0 ws0">may<span class="_"> </span>not<span class="_"> </span>be<span class="_"> </span>tabulated<span class="_"> </span>accurately<span class="_ _3"></span>.<span class="_"> </span>W<span class="_ _3"></span>e<span class="_ _11"> </span>use<span class="_"> </span>optimization<span class="_"> </span>ﬂag<span class="_"> </span><span class="ffd">-Og</span>,<span class="_"> </span>guaranteeing</div><div class="t m5 x26 h26 y50c4 ff7 fs19 fc2 sc0 ls0 ws0">that<span class="_"> </span>function<span class="_"> </span>calls<span class="_"> </span>will<span class="_"> </span>be<span class="_"> </span>tracked<span class="_"> </span>properly<span class="_ _3"></span>.</div><div class="t m5 x26 h2d y181d ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">gcc<span class="_ _1f"> </span>-Og<span class="_ _1f"> </span>-pg<span class="_ _e"> </span>prog.c<span class="_ _1f"> </span>-o<span class="_ _e"> </span>prog</span></div><div class="t m5 x1cd h26 y50c5 ffc fs19 fc2 sc0 ls0 ws0">2.<span class="_ _e"> </span><span class="ff7">The<span class="_"> </span>program<span class="_"> </span>is<span class="_"> </span>then<span class="_"> </span>executed<span class="_"> </span>as<span class="_"> </span>usual:</span></div><div class="t m5 x26 h2d y682 ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">./prog<span class="_ _1f"> </span>file.txt</span></div><div class="t m5 x26 h26 y50c6 ff7 fs19 fc2 sc0 ls0 ws0">It<span class="_ _11"> </span>runs<span class="_ _11"> </span>slightly<span class="_ _16"> </span>(around<span class="_ _11"> </span>a<span class="_ _11"> </span>factor<span class="_ _16"> </span>of<span class="_"> </span>2)<span class="_ _16"> </span>slower<span class="_ _11"> </span>than<span class="_ _11"> </span>normal,<span class="_ _16"> </span>but<span class="_ _11"> </span>otherwise<span class="_ _11"> </span>the</div><div class="t m5 x26 h26 y50c7 ff7 fs19 fc2 sc0 ls0 ws0">only<span class="_"> </span>difference<span class="_"> </span>is<span class="_"> </span>that<span class="_"> </span>it<span class="_"> </span>generates<span class="_"> </span>a<span class="_"> </span>ﬁle<span class="_"> </span><span class="ffd">gmon.out</span>.</div><div class="t m5 x1cd h26 y50c8 ffc fs19 fc2 sc0 ls0 ws0">3.<span class="_ _e"> </span><span class="ff9">gprof<span class="_ _10"> </span><span class="ff7">is<span class="_"> </span>invoked<span class="_"> </span>to<span class="_"> </span>analyze<span class="_"> </span>the<span class="_"> </span>data<span class="_"> </span>in<span class="_"> </span><span class="ffd">gmon.out</span>:</span></span></div><div class="t m5 x26 h2d y50c9 ffd fs1e fc2 sc0 ls0 ws0">linux&gt;<span class="_ _e"> </span><span class="ff13">gprof<span class="_ _1f"> </span>prog</span></div><div class="t m5 x26 h26 y2e8d ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>ﬁrst<span class="_"> </span>part<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>proﬁle<span class="_"> </span>report<span class="_ _13"> </span>lists<span class="_"> </span>the<span class="_"> </span>times<span class="_ _13"> </span>spent<span class="_"> </span>executing<span class="_ _13"> </span>the<span class="_"> </span>different</div><div class="t m5 x17 h26 y4983 ff7 fs19 fc2 sc0 ls0 ws0">functions<span class="_ _1"></span>,<span class="_"> </span>sorted<span class="_"> </span>in<span class="_"> </span>descending<span class="_"> </span>order.<span class="_"> </span>As<span class="_"> </span>an<span class="_"> </span>example<span class="_ _1"></span>,<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>listing<span class="_"> </span>shows</div><div class="t m5 x17 h26 y4984 ff7 fs19 fc2 sc0 ls0 ws0">this<span class="_"> </span>part<span class="_"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>report<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>three<span class="_"> </span>most<span class="_"> </span>time-consuming<span class="_"> </span>functions<span class="_ _13"> </span>in<span class="_"> </span>a<span class="_"> </span>program:</div><div class="t m5 x72 h2d y50ca ffd fs1e fc2 sc0 ls0 ws0">%<span class="_ _3f"> </span>cumulative<span class="_ _3f"> </span>self<span class="_ _16f"> </span>self<span class="_ _58"> </span>total</div><div class="t m5 x52 h2d y50cb ffd fs1e fc2 sc0 ls0 ws0">time<span class="_ _3f"> </span>seconds<span class="_ _3f"> </span>seconds<span class="_ _46"> </span>calls<span class="_ _3f"> </span>s/call<span class="_ _3f"> </span>s/call<span class="_ _1a"> </span>name</div><div class="t m5 x52 h2d y50cc ffd fs1e fc2 sc0 ls0 ws0">97.58<span class="_ _46"> </span>203.66<span class="_ _3f"> </span>203.66<span class="_ _71"> </span>1<span class="_ _3f"> </span>203.66<span class="_ _3f"> </span>203.66<span class="_ _1a"> </span>sort_words</div><div class="t m5 x72 h2d y50cd ffd fs1e fc2 sc0 ls0 ws0">2.32<span class="_ _46"> </span>208.50<span class="_ _8c"> </span>4.85<span class="_ _3f"> </span>965027<span class="_ _8c"> </span>0.00<span class="_ _8c"> </span>0.00<span class="_ _1a"> </span>find_ele_rec</div><div class="t m5 x72 h2d y50ce ffd fs1e fc2 sc0 ls0 ws0">0.14<span class="_ _46"> </span>208.81<span class="_ _8c"> </span>0.30<span class="_ _e"> </span>12511031<span class="_ _72"> </span>0.00<span class="_ _58"> </span>0.00<span class="_ _1a"> </span>Strlen</div><div class="t m5 x26 h26 y6fe ff7 fs19 fc2 sc0 ls0 ws0">Each<span class="_ _16"> </span>row<span class="_ _14"> </span>represents<span class="_ _14"> </span>the<span class="_ _16"> </span>time<span class="_ _14"> </span>spent<span class="_ _16"> </span>for<span class="_ _14"> </span>all<span class="_ _14"> </span>calls<span class="_ _16"> </span>to<span class="_ _14"> </span>some<span class="_ _14"> </span>function.<span class="_ _16"> </span>The<span class="_ _16"> </span>ﬁrst</div><div class="t m5 x17 h26 y6ff ff7 fs19 fc2 sc0 ls0 ws0">column<span class="_ _16"> </span>indicates<span class="_ _14"> </span>the<span class="_ _16"> </span>percentage<span class="_ _14"> </span>of<span class="_ _16"> </span>the<span class="_ _14"> </span>overall<span class="_ _16"> </span>time<span class="_ _14"> </span>spent<span class="_ _16"> </span>on<span class="_ _14"> </span>the<span class="_ _14"> </span>function.<span class="_ _16"> </span>T<span class="_ _0"></span>he</div><div class="t m5 x17 h26 y700 ff7 fs19 fc2 sc0 ls0 ws0">second<span class="_ _15"> </span>shows<span class="_ _21"> </span>the<span class="_ _15"> </span>cumulative<span class="_ _21"> </span>time<span class="_ _21"> </span>spent<span class="_ _15"> </span>by<span class="_ _21"> </span>the<span class="_ _15"> </span>functions<span class="_ _21"> </span>up<span class="_ _21"> </span>to<span class="_ _15"> </span>and<span class="_ _21"> </span>including</div><div class="t m5 x17 h26 y701 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _16"> </span>one<span class="_ _16"> </span>on<span class="_ _16"> </span>this<span class="_ _16"> </span>row<span class="_ _1"></span>.<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _14"> </span>third<span class="_ _16"> </span>shows<span class="_ _16"> </span>the<span class="_ _16"> </span>time<span class="_ _16"> </span>spent<span class="_ _16"> </span>on<span class="_ _16"> </span>this<span class="_ _16"> </span>particular<span class="_ _14"> </span>function,</div><div class="t m5 x17 h26 y702 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_"> </span>the<span class="_ _13"> </span>fourth<span class="_"> </span>shows<span class="_"> </span>how<span class="_ _13"> </span>many<span class="_"> </span>times<span class="_"> </span>it<span class="_ _13"> </span>was<span class="_"> </span>called<span class="_"> </span>(not<span class="_ _13"> </span>counting<span class="_"> </span>recursive<span class="_"> </span>calls).</div><div class="t m5 x17 h26 y703 ff7 fs19 fc2 sc0 ls0 ws0">In<span class="_ _14"> </span>our<span class="_ _15"> </span>example<span class="_ _0"></span>,<span class="_ _15"> </span>the<span class="_ _15"> </span>function<span class="_ _14"> </span><span class="ffd">sort_words<span class="_ _15"> </span></span>was<span class="_ _14"> </span>called<span class="_ _15"> </span>only<span class="_ _14"> </span>once,<span class="_ _15"> </span>but<span class="_ _14"> </span>this<span class="_ _15"> </span>single</div><div class="t m5 x17 h26 y704 ff7 fs19 fc2 sc0 ls0 ws0">call<span class="_ _13"> </span>required<span class="_"> </span>203.66<span class="_ _13"> </span>seconds<span class="_ _1"></span>,<span class="_"> </span>while<span class="_ _13"> </span>the<span class="_ _13"> </span>function<span class="_"> </span><span class="ffd">find_ele_rec<span class="_ _13"> </span></span>was<span class="_ _13"> </span>called<span class="_"> </span>965,027</div><div class="t m5 x17 h26 y705 ff7 fs19 fc2 sc0 ls0 ws0">times<span class="_ _16"> </span>(not<span class="_ _16"> </span>including<span class="_ _16"> </span>recursive<span class="_ _16"> </span>calls),<span class="_ _14"> </span>requiring<span class="_ _16"> </span>a<span class="_ _16"> </span>total<span class="_ _14"> </span>of<span class="_ _16"> </span>4.85<span class="_ _16"> </span>seconds<span class="_ _1"></span>.<span class="_ _16"> </span>Function</div><div class="t m5 x17 h26 y706 ffd fs19 fc2 sc0 ls0 ws0">Strlen<span class="_ _14"> </span><span class="ff7">computes<span class="_ _15"> </span>the<span class="_ _14"> </span>length<span class="_ _15"> </span>of<span class="_ _15"> </span>a<span class="_ _14"> </span>string<span class="_ _15"> </span>by<span class="_ _15"> </span>calling<span class="_ _14"> </span>the<span class="_ _15"> </span>library<span class="_ _14"> </span>function<span class="_ _15"> </span></span>strlen<span class="ff7">.</span></div><div class="t m5 x17 h26 y707 ff7 fs19 fc2 sc0 ls0 ws0">Library<span class="_"> </span>function<span class="_ _13"> </span>calls<span class="_"> </span>are<span class="_ _13"> </span>normally<span class="_"> </span>not<span class="_ _13"> </span>shown<span class="_"> </span>in<span class="_"> </span>the<span class="_ _13"> </span>results<span class="_"> </span>by<span class="_ _13"> </span><span class="ff9">gprof</span>.<span class="_"> </span>T<span class="_ _1"></span>heir<span class="_"> </span>times</div><div class="t m5 x17 h26 y708 ff7 fs19 fc2 sc0 ls0 ws0">are<span class="_ _13"> </span>usually<span class="_ _13"> </span>reported<span class="_ _6"> </span>as<span class="_ _13"> </span>part<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>function<span class="_ _13"> </span>calling<span class="_ _6"> </span>them.<span class="_ _13"> </span>By<span class="_ _13"> </span>creating<span class="_ _13"> </span>the<span class="_ _13"> </span>“wrapper</div><div class="t m5 x17 h26 y709 ff7 fs19 fc2 sc0 ls0 ws0">function”<span class="_ _16"> </span><span class="ffd">Strlen</span>,<span class="_ _16"> </span>we<span class="_ _11"> </span>can<span class="_ _16"> </span>reliably<span class="_ _16"> </span>track<span class="_ _16"> </span>the<span class="_ _11"> </span>calls<span class="_ _16"> </span>to<span class="_ _16"> </span><span class="ffd">strlen</span>,<span class="_ _16"> </span>showing<span class="_ _16"> </span>that<span class="_ _16"> </span>it<span class="_ _11"> </span>was</div><div class="t m5 x17 h26 y70a ff7 fs19 fc2 sc0 ls0 ws0">called<span class="_"> </span>12,511,031<span class="_"> </span>times<span class="_"> </span>but<span class="_"> </span>only<span class="_"> </span>requiring<span class="_"> </span>a<span class="_"> </span>total<span class="_"> </span>of<span class="_"> </span>0.30<span class="_"> </span>seconds<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
