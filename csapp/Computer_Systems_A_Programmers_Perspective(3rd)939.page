<div id="pf3ab" class="pf w2 h11" data-page-no="3ab"><div class="pc pc3ab w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg3ab.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">938<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>10<span class="_ _3d"> </span>System-Level<span class="_ _10"> </span>I/O</span></div><div class="t m5 x16b h2c y27f ffa fs16 fc2 sc0 ls0 ws0">code/src/csapp<span class="_ _1"></span>.c</div><div class="t m5 x1f h2e y280 ff6 fs20 fc6 sc0 ls0 ws0">1</div><div class="t m5 x4f h2d yad1 ffd fs1e fc2 sc0 ls0 ws0">ssize_t<span class="_ _e"> </span>rio_readlineb(rio_t<span class="_ _1f"> </span>*rp,<span class="_ _1f"> </span>void<span class="_ _e"> </span>*usrbuf,<span class="_ _1f"> </span>size_t<span class="_ _e"> </span>maxlen)</div><div class="t m5 x1f h2d y281 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x1f h2d yad2 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2">int<span class="_ _e"> </span>n,<span class="_ _1f"> </span>rc;</span></div><div class="t m5 x1f h2d yad3 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2">char<span class="_ _e"> </span>c,<span class="_ _1f"> </span>*bufp<span class="_ _1f"> </span>=<span class="_ _e"> </span>usrbuf;</span></div><div class="t m5 x1f h2e y285 ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x1f h2e y65f1 ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 x33 h2d yad4 ffd fs1e fc2 sc0 ls0 ws0">for<span class="_ _e"> </span>(n<span class="_ _1f"> </span>=<span class="_ _1f"> </span>1;<span class="_ _e"> </span>n<span class="_ _1f"> </span>&lt;<span class="_ _e"> </span>maxlen;<span class="_ _1f"> </span>n++)<span class="_ _1f"> </span>{</div><div class="t m5 x1f h2d yad5 ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _70"> </span><span class="ffd fs1e fc2">if<span class="_ _e"> </span>((rc<span class="_ _1f"> </span>=<span class="_ _1f"> </span>rio_read(rp,<span class="_ _e"> </span>&amp;c,<span class="_ _1f"> </span>1))<span class="_ _e"> </span>==<span class="_ _1f"> </span>1)<span class="_ _1f"> </span>{</span></div><div class="t m5 x1f h2d yad6 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _d1"> </span><span class="ffd fs1e fc2">*bufp++<span class="_ _1f"> </span>=<span class="_ _e"> </span>c;</span></div><div class="t m5 x1f h2d y496b ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _d1"> </span><span class="ffd fs1e fc2">if<span class="_ _1f"> </span>(c<span class="_ _e"> </span>==<span class="_ _1f"> </span>’\n’)<span class="_ _e"> </span>{</span></div><div class="t m5 x1b0 h2d y50d4 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _143"> </span><span class="ffd fs1e fc2">n++;</span></div><div class="t m5 x1b0 h2d y4a9c ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _143"> </span><span class="ffd fs1e fc2">break;</span></div><div class="t m5 x1b0 h2d y61b6 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _d1"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1b0 h2d y2181 ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _70"> </span><span class="ffd fs1e fc2">}<span class="_ _e"> </span>else<span class="_ _1f"> </span>if<span class="_ _1f"> </span>(rc<span class="_ _e"> </span>==<span class="_ _1f"> </span>0)<span class="_ _e"> </span>{</span></div><div class="t m5 x1b0 h2d y554b ff6 fs20 fc6 sc0 ls0 ws0">14<span class="_ _d1"> </span><span class="ffd fs1e fc2">if<span class="_ _1f"> </span>(n<span class="_ _e"> </span>==<span class="_ _1f"> </span>1)</span></div><div class="t m5 x1b0 h2d y4a9f ff6 fs20 fc6 sc0 ls0 ws0">15<span class="_ _143"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>0;<span class="_ _1f"> </span>/*<span class="_ _1f"> </span>EOF,<span class="_ _e"> </span>no<span class="_ _1f"> </span>data<span class="_ _e"> </span>read<span class="_ _1f"> </span>*/</span></div><div class="t m5 x1b0 h2d y417 ff6 fs20 fc6 sc0 ls0 ws0">16<span class="_ _d1"> </span><span class="ffd fs1e fc2">else</span></div><div class="t m5 x1b0 h2d y4aa0 ff6 fs20 fc6 sc0 ls0 ws0">17<span class="_ _143"> </span><span class="ffd fs1e fc2">break;<span class="_ _7b"> </span>/*<span class="_ _1f"> </span>EOF,<span class="_ _1f"> </span>some<span class="_ _e"> </span>data<span class="_ _1f"> </span>was<span class="_ _e"> </span>read<span class="_ _1f"> </span>*/</span></div><div class="t m5 x1b0 h2d y3ec ff6 fs20 fc6 sc0 ls0 ws0">18<span class="_ _70"> </span><span class="ffd fs1e fc2">}<span class="_ _e"> </span>else</span></div><div class="t m5 x1b0 h2d y2a2b ff6 fs20 fc6 sc0 ls0 ws0">19<span class="_ _d1"> </span><span class="ffd fs1e fc2">return<span class="_ _1f"> </span>-1;<span class="_ _7b"> </span>/*<span class="_ _1f"> </span>Error<span class="_ _e"> </span>*/</span></div><div class="t m5 x1b0 h2d y1ab8 ff6 fs20 fc6 sc0 ls0 ws0">20<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1b0 h2d y1ada ff6 fs20 fc6 sc0 ls0 ws0">21<span class="_ _20"> </span><span class="ffd fs1e fc2">*bufp<span class="_ _e"> </span>=<span class="_ _1f"> </span>0;</span></div><div class="t m5 x1b0 h2d y61b9 ff6 fs20 fc6 sc0 ls0 ws0">22<span class="_ _20"> </span><span class="ffd fs1e fc2">return<span class="_ _e"> </span>n-1;</span></div><div class="t m5 x1b0 h2d y3228 ff6 fs20 fc6 sc0 ls0 ws0">23<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x16b h2c y677a ffa fs16 fc2 sc0 ls0 ws0">code/src/csapp<span class="_ _1"></span>.c</div><div class="t m5 x16b h2c y77ff ffa fs16 fc2 sc0 ls0 ws0">code/src/csapp<span class="_ _1"></span>.c</div><div class="t m5 x1f h2d y47f8 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">ssize_t<span class="_ _1f"> </span>rio_readnb(rio_t<span class="_ _e"> </span>*rp,<span class="_ _1f"> </span>void<span class="_ _1f"> </span>*usrbuf,<span class="_ _e"> </span>size_t<span class="_ _1f"> </span>n)</span></div><div class="t m5 x1f h2d y2c5b ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">{</span></div><div class="t m5 x1f h2d y2a53 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2">size_t<span class="_ _e"> </span>nleft<span class="_ _1f"> </span>=<span class="_ _1f"> </span>n;</span></div><div class="t m5 x1f h2d y29a8 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _20"> </span><span class="ffd fs1e fc2">ssize_t<span class="_ _e"> </span>nread;</span></div><div class="t m5 x1f h2d y646e ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _20"> </span><span class="ffd fs1e fc2">char<span class="_ _e"> </span>*bufp<span class="_ _1f"> </span>=<span class="_ _1f"> </span>usrbuf;</span></div><div class="t m5 x1f h2e y42a7 ff6 fs20 fc6 sc0 ls0 ws0">6</div><div class="t m5 x1f h2e y7800 ff6 fs20 fc6 sc0 ls0 ws0">7</div><div class="t m5 x33 h2d y3eb4 ffd fs1e fc2 sc0 ls0 ws0">while<span class="_ _e"> </span>(nleft<span class="_ _1f"> </span>&gt;<span class="_ _1f"> </span>0)<span class="_ _e"> </span>{</div><div class="t m5 x1f h2d y4490 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _70"> </span><span class="ffd fs1e fc2">if<span class="_ _e"> </span>((nread<span class="_ _1f"> </span>=<span class="_ _1f"> </span>rio_read(rp,<span class="_ _e"> </span>bufp,<span class="_ _1f"> </span>nleft))<span class="_ _e"> </span>&lt;<span class="_ _1f"> </span>0)</span></div><div class="t m5 x1f h2d y29ac ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _d1"> </span><span class="ffd fs1e fc2">return<span class="_ _1f"> </span>-1;<span class="_ _86"> </span>/*<span class="_ _e"> </span>errno<span class="_ _1f"> </span>set<span class="_ _e"> </span>by<span class="_ _1f"> </span>read()<span class="_ _e"> </span>*/</span></div><div class="t m5 x1b0 h2d y3478 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _70"> </span><span class="ffd fs1e fc2">else<span class="_ _e"> </span>if<span class="_ _1f"> </span>(nread<span class="_ _1f"> </span>==<span class="_ _e"> </span>0)</span></div><div class="t m5 x1b0 h2d y3de7 ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _d1"> </span><span class="ffd fs1e fc2">break;<span class="_ _16f"> </span>/*<span class="_ _e"> </span>EOF<span class="_ _1f"> </span>*/</span></div><div class="t m5 x1b0 h2d y5982 ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _70"> </span><span class="ffd fs1e fc2">nleft<span class="_ _e"> </span>-=<span class="_ _1f"> </span>nread;</span></div><div class="t m5 x1b0 h2d y4c74 ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _70"> </span><span class="ffd fs1e fc2">bufp<span class="_ _e"> </span>+=<span class="_ _1f"> </span>nread;</span></div><div class="t m5 x1b0 h2d y464c ff6 fs20 fc6 sc0 ls0 ws0">14<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1b0 h2e y1864 ff6 fs20 fc6 sc0 ls0 ws0">15</div><div class="t m5 x33 h2d y2fb5 ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>(n<span class="_ _1f"> </span>-<span class="_ _1f"> </span>nleft);<span class="_ _82"> </span>/*<span class="_ _1f"> </span>Return<span class="_ _e"> </span>&gt;=<span class="_ _1f"> </span>0<span class="_ _e"> </span>*/</div><div class="t m5 x1b0 h2d y20a6 ff6 fs20 fc6 sc0 ls0 ws0">16<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x16b h2c y7801 ffa fs16 fc2 sc0 ls0 ws0">code/src/csapp<span class="_ _1"></span>.c</div><div class="t m5 x1d h2f y7802 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>10.8<span class="_ _66"> </span><span class="fc1">The</span></div><div class="t m5 xb3 h3a ybbd ffd fs19 fc1 sc0 ls0 ws0">rio_readlineb<span class="_ _10"> </span><span class="ffe fs16">and<span class="_"> </span></span>rio_readnb<span class="_ _11"> </span><span class="ffe fs16">functions.</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
