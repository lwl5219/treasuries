<div id="pfe6" class="pf w2 h11" data-page-no="e6"><div class="pc pce6 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bge6.png"/><div class="t m5 x191 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>3.5<span class="_ _60"> </span>Arithmetic<span class="_ _10"> </span>and<span class="_ _10"> </span>Logical<span class="_ _10"> </span>Operations<span class="_ _3e"> </span><span class="ffe fs1e">229</span></div><div class="t m5 x17 h2d y140c ffd fs1e fc2 sc0 ls0 ws0">leaq<span class="_ _11"> </span>0xE(,%rdx,3),<span class="_ _11"> </span>%rax</div><div class="t m5 x17 h2d y1d16 ffd fs1e fc1 sc0 ls0 ws0">leaq<span class="_ _11"> </span>6(%rbx,%rdx,7),<span class="_ _11"> </span>%rax</div><div class="t m5 x26 h26 y233f ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_"> </span>an<span class="_ _13"> </span>illustration<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>use<span class="_ _13"> </span>of<span class="_"> </span><span class="ffd">leaq<span class="_ _10"> </span></span>in<span class="_ _13"> </span>compiled<span class="_"> </span>code<span class="_ _0"></span>,<span class="_"> </span>consider<span class="_ _13"> </span>the<span class="_"> </span>following</div><div class="t m5 x17 h26 y2340 ff7 fs19 fc1 sc0 ls0 ws0">C<span class="_"> </span>program:</div><div class="t m5 x17 h2d y2341 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>scale(long<span class="_ _1f"> </span>x,<span class="_ _1f"> </span>long<span class="_ _e"> </span>y,<span class="_ _1f"> </span>long<span class="_ _e"> </span>z)<span class="_ _1f"> </span>{</div><div class="t m5 x1b6 h2d y2342 ffd fs1e fc2 sc0 ls33 ws0">l<span class="_ _41"></span>o<span class="_ _41"></span>n<span class="_ _41"></span>gt=x+4*y+1<span class="_ _41"></span>2*z<span class="_ _41"></span>;</div><div class="t m5 x1b6 h2d y2343 ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>t;</div><div class="t m5 x17 h2d y2344 ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x26 h26 y2345 ff7 fs19 fc2 sc0 ls0 ws0">When<span class="_ _11"> </span>compiled,<span class="_ _16"> </span>the<span class="_ _11"> </span>arithmetic<span class="_ _16"> </span>operations<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span>function<span class="_ _11"> </span>are<span class="_ _16"> </span>implemented</div><div class="t m5 x17 h26 y2346 ff7 fs19 fc2 sc0 ls0 ws0">by<span class="_"> </span>a<span class="_"> </span>sequence<span class="_"> </span>of<span class="_"> </span>three<span class="_"> </span><span class="ffd">leaq<span class="_ _10"> </span></span>functions<span class="_ _3"></span>,<span class="_"> </span>as<span class="_"> </span>is<span class="_"> </span>documented<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span>comments<span class="_"> </span>on<span class="_"> </span>the</div><div class="t m5 x17 h26 y2347 ff7 fs19 fc2 sc0 ls0 ws0">right-hand<span class="_"> </span>side:</div><div class="t m5 xee h61 y2348 ff13 fs35 fc6 sc0 ls0 ws0">long<span class="_ _f"> </span>scale(long<span class="_ _f"> </span>x,<span class="_ _f"> </span>long<span class="_ _e"> </span>y,<span class="_ _21"> </span>long<span class="_ _f"> </span>z)</div><div class="t m5 xee h61 y2349 ff13 fs35 fc6 sc0 ls0 ws0">x<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi,<span class="_ _f"> </span>y<span class="_ _e"> </span>in<span class="_ _21"> </span>%rsi,<span class="_ _f"> </span>z<span class="_ _e"> </span>in<span class="_ _21"> </span>%rdx</div><div class="t m5 x17 h2d y234a ffd fs1e fc2 sc0 ls0 ws0">scale:</div><div class="t m5 x72 h2d y234b ffd fs1e fc2 sc0 ls0 ws0">leaq<span class="_ _46"> </span>(%rdi,%rsi,4),<span class="_ _e"> </span>%rax</div><div class="t m5 xbe h61 y234c ff13 fs35 fc6 sc0 ls0 ws0">x<span class="_ _f"> </span>+<span class="_ _f"> </span>4*y</div><div class="t m5 x72 h2d y234d ffd fs1e fc2 sc0 ls0 ws0">leaq<span class="_ _46"> </span>(%rdx,%rdx,2),<span class="_ _e"> </span>%rdx<span class="_ _93"> </span><span class="ff13 fs35 fc6">z<span class="_ _e"> </span>+<span class="_ _21"> </span>2*z<span class="_ _f"> </span>=<span class="_ _f"> </span>3*z</span></div><div class="t m5 x72 h2d y234e ffd fs1e fc2 sc0 ls0 ws0">leaq<span class="_ _46"> </span>(%rax,%rdx,4),<span class="_ _e"> </span>%rax<span class="_ _93"> </span><span class="ff13 fs35 fc6">(x+4*y)<span class="_ _e"> </span>+<span class="_ _21"> </span>4*(3*z<span class="ls156">)=x+4<span class="_ _8a"></span>*<span class="_ _12"></span>y+<span class="ls0">12*z</span></span></span></div><div class="t m5 x72 h2d y234f ffd fs1e fc2 sc0 ls0 ws0">ret</div><div class="t m5 x26 h26 y2350 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _16"> </span>ability<span class="_"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span><span class="ffd">leaq<span class="_ _11"> </span></span>instruction<span class="_ _11"> </span>to<span class="_ _16"> </span>perform<span class="_ _11"> </span>addition<span class="_ _11"> </span>and<span class="_ _11"> </span>limited<span class="_ _16"> </span>forms<span class="_ _11"> </span>of</div><div class="t m5 x17 h26 y2351 ff7 fs19 fc2 sc0 ls0 ws0">multiplication<span class="_ _11"> </span>proves<span class="_ _16"> </span>useful<span class="_ _16"> </span>when<span class="_ _11"> </span>compiling<span class="_ _16"> </span>simple<span class="_ _16"> </span>arithmetic<span class="_ _11"> </span>expressions<span class="_ _16"> </span>such</div><div class="t m5 x17 h26 y2352 ff7 fs19 fc2 sc0 ls0 ws0">as<span class="_"> </span>this<span class="_"> </span>example<span class="_ _1"></span>.</div><div class="t m5 x17 h47 y2353 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>3.7<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>364)</span></div><div class="t m5 x17 h26 y2354 ff7 fs19 fc1 sc0 ls0 ws0">Consider<span class="_ _21"> </span>the<span class="_ _f"> </span>following<span class="_ _f"> </span>code,<span class="_ _f"> </span>in<span class="_ _f"> </span>which<span class="_ _f"> </span>we<span class="_ _f"> </span>have<span class="_ _f"> </span>omitted<span class="_ _f"> </span>the<span class="_ _f"> </span>expression<span class="_ _21"> </span>being</div><div class="t m5 x17 h26 y2355 ff7 fs19 fc1 sc0 ls0 ws0">computed:</div><div class="t m5 x17 h2d y2356 ffd fs1e fc2 sc0 ls0 ws0">short<span class="_ _e"> </span>scale3(short<span class="_ _1f"> </span>x,<span class="_ _1f"> </span>short<span class="_ _e"> </span>y,<span class="_ _1f"> </span>short<span class="_ _e"> </span>z)<span class="_ _1f"> </span>{</div><div class="t m5 x72 h2d y2357 ffd fs1e fc2 sc0 ls0 ws0">short<span class="_ _e"> </span>t<span class="_ _1f"> </span>=</div><div class="t m5 x154 h2d y2358 ffd fs1e fc2 sc0 ls0 ws0">;</div><div class="t m5 x72 h2d y2359 ffd fs1e fc2 sc0 ls0 ws0">return<span class="_ _e"> </span>t;</div><div class="t m5 x17 h2d y235a ffd fs1e fc2 sc0 ls0 ws0">}</div><div class="t m5 x26 h26 y235b ff7 fs19 fc2 sc0 ls0 ws0">Compiling<span class="_"> </span>the<span class="_"> </span>actual<span class="_"> </span>function<span class="_"> </span>with<span class="_"> </span><span class="ff9">gcc<span class="_ _10"> </span></span>yields<span class="_"> </span>the<span class="_"> </span>following<span class="_"> </span>assembly<span class="_"> </span>code:</div><div class="t m5 xee h61 y235c ff13 fs35 fc6 sc0 ls0 ws0">short<span class="_ _f"> </span>scale3(short<span class="_ _f"> </span>x,<span class="_ _f"> </span>short<span class="_ _e"> </span>y,<span class="_ _21"> </span>short<span class="_ _f"> </span>z)</div><div class="t m5 xee h61 y235d ff13 fs35 fc6 sc0 ls0 ws0">x<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi,<span class="_ _f"> </span>y<span class="_ _e"> </span>in<span class="_ _21"> </span>%rsi,<span class="_ _f"> </span>z<span class="_ _e"> </span>in<span class="_ _21"> </span>%rdx</div><div class="t m5 x17 h2d y235e ffd fs1e fc2 sc0 ls0 ws0">scale3:</div><div class="t m5 x72 h2d y235f ffd fs1e fc2 sc0 ls0 ws0">leaq<span class="_ _e"> </span>(%rsi,%rsi,9),<span class="_ _1f"> </span>%rbx</div><div class="t m5 x72 h2d y2360 ffd fs1e fc2 sc0 ls0 ws0">leaq<span class="_ _e"> </span>(%rbx,%rdx),<span class="_ _1f"> </span>%rbx</div><div class="t m5 x72 h2d y2361 ffd fs1e fc2 sc0 ls0 ws0">leaq<span class="_ _e"> </span>(%rbx,%rdi,%rsi),<span class="_ _1f"> </span>%rbx</div><div class="t m5 x72 h2d y2362 ffd fs1e fc2 sc0 ls0 ws0">ret</div><div class="t m5 x26 h26 y2363 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>ill<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>missing<span class="_"> </span>expression<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>C<span class="_"> </span>code.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
