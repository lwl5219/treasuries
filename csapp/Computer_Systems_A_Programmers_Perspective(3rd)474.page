<div id="pf1da" class="pf w2 h11" data-page-no="1da"><div class="pc pc1da w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1da.png"/><div class="t m5 x13d h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>4.5<span class="_ _60"> </span>Pipelined<span class="_ _10"> </span>Y86-64<span class="_ _10"> </span>Implementations<span class="_ _3e"> </span><span class="ffe fs1e">473</span></div><div class="t m8 x24 h3f y41c4 ff49 fs27 fc1 sc0 ls0 ws0">. . .</div><div class="t m5 x48 h40 y41c5 ff49 fs27 fc1 sc0 ls0 ws0">F<span class="_ _1c9"></span><span class="ff4a fs28">0x000: irmovq $10,%rdx</span></div><div class="t m5 x17 h40 y41c6 ff4a fs28 fc1 sc0 ls0 ws0"># prog3</div><div class="c x17 y41c7 w7 hb1"><div class="t m5 x0 h40 y41c8 ff4a fs28 fc3 sc1 ls0 ws0"># prog3</div></div><div class="t m5 x17 h40 y41c9 ff4a fs28 fc1 sc0 ls0 ws0">0x00a: irmovq  $3,%rax</div><div class="t m5 x17 h40 y41ca ff4a fs28 fc1 sc0 ls0 ws0">0x014: nop</div><div class="t m5 x17 h40 y41cb ff4a fs28 fc1 sc0 ls0 ws0">0x005: addq %rdx,%rax</div><div class="t m5 x17 h40 y41cc ff4a fs28 fc1 sc0 ls0 ws0">0x017: halt</div><div class="t m5 xec h3f y41c5 ff49 fs27 fc1 sc0 ls1d6 ws0">DE<span class="_ _1"></span>M<span class="_ _4"></span>W</div><div class="t m5 xec h3f y41cd ff49 fs27 fc1 sc0 ls1ca ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x186 h3f y41ce ff49 fs27 fc1 sc0 ls1c8 ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x187 h3f y41cf ff49 fs27 fc1 sc0 ls1c8 ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 xd8 h3f y41d0 ff49 fs27 fc1 sc0 ls1c8 ws0">FDE<span class="_ _3"></span>M<span class="_ _8"></span>W</div><div class="t m5 x47 h44 y41d1 ff49 fs2a fc6 sc0 ls1d7 ws0">12345</div><div class="t m5 x205 h44 y41d2 ff49 fs2a fc6 sc0 ls0 ws0">6</div><div class="t m5 x6c h44 y41d3 ff49 fs2a fc6 sc0 ls0 ws0">7</div><div class="t m5 x11a h44 y41d4 ff49 fs2a fc6 sc0 ls0 ws0">8</div><div class="t m5 x11e h44 y41d5 ff49 fs2a fc6 sc0 ls0 ws0">9</div><div class="t m5 xe2 h40 y41d6 ff49 fs27 fc1 sc0 ls0 ws0">srcA<span class="_ _1"></span> = <span class="ff4a fs28">%rdx</span></div><div class="t m5 xe2 h40 y41d7 ff49 fs27 fc1 sc0 ls0 ws0">srcB = <span class="ff4a fs28">%rax</span></div><div class="t m5 xe2 h40 y41d8 ff49 fs27 fc1 sc0 ls0 ws0">W_dstE = <span class="ff4a fs28">%rdx</span></div><div class="t m5 xe2 h3f y41d9 ff49 fs27 fc1 sc0 ls0 ws0">W_valE = 10</div><div class="t m5 xb1 h3f y41da ff49 fs27 fc1 sc0 ls0 ws0">valA<span class="_ _1"></span>      W_valE = 10</div><div class="t m5 xb1 h3f y41db ff49 fs27 fc1 sc0 ls0 ws0">valB      M_valE = 3</div><div class="t m5 x215 h3f y41dc ff49 fs27 fc1 sc0 ls0 ws0">Cycle 5</div><div class="t m5 x1fc h3f y41dd ff49 fs27 fc1 sc0 ls0 ws0">R[</div><div class="t m5 xf9 h40 y41de ff4a fs28 fc1 sc0 ls0 ws0">%rdx<span class="ff49 fs27">]      10</span></div><div class="t m5 xd8 h3f y41df ff49 fs27 fc1 sc0 ls0 ws0">D</div><div class="t m5 x254 h3f y41e0 ff49 fs27 fc1 sc0 ls0 ws0">W</div><div class="t m5 xe2 h3f y41e1 ff49 fs27 fc1 sc0 ls0 ws0">M_dstE = </div><div class="t m5 x16 h40 y41e2 ff4a fs28 fc1 sc0 ls0 ws0">%rax</div><div class="t m5 xe2 h3f y41e3 ff49 fs27 fc1 sc0 ls0 ws0">M_valE = 3</div><div class="t m5 xd8 h3f y41e4 ff49 fs27 fc1 sc0 ls0 ws0">M</div><div class="t m5 x17 h3a y41e5 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>4.50<span class="_ _66"> </span><span class="fc1">Pipelined<span class="_"> </span>execution<span class="_"> </span>of<span class="_ _10"> </span><span class="ffd fs19">prog3<span class="_ _10"> </span></span>using<span class="_ _10"> </span>forwarding.<span class="_"> </span><span class="ff6">In<span class="_ _10"> </span>cycle<span class="_ _10"> </span>5,<span class="_ _10"> </span>the<span class="_ _10"> </span>decode-</span></span></div><div class="t m5 x17 h34 y41e6 ff6 fs16 fc1 sc0 ls0 ws0">stage<span class="_ _14"> </span>logic<span class="_ _14"> </span>detects<span class="_ _14"> </span>a<span class="_ _15"> </span>pending<span class="_ _14"> </span>write<span class="_ _14"> </span>to<span class="_ _15"> </span>register</div><div class="t m5 x7b h3a y41e7 ffd fs19 fc1 sc0 ls0 ws0">%rdx<span class="_ _14"> </span><span class="ff6 fs16">in<span class="_ _14"> </span>the<span class="_ _14"> </span>write-back<span class="_ _15"> </span>stage<span class="_ _14"> </span>and<span class="_ _14"> </span>to</span></div><div class="t m5 x17 h34 y41e8 ff6 fs16 fc1 sc0 ls0 ws0">register</div><div class="t m5 x19f h3a y41e9 ffd fs19 fc1 sc0 ls0 ws0">%rax<span class="_ _11"> </span><span class="ff6 fs16">in<span class="_ _16"> </span>the<span class="_ _11"> </span>memory<span class="_ _16"> </span>stage.<span class="_ _11"> </span>It<span class="_ _11"> </span>uses<span class="_ _16"> </span>these<span class="_ _11"> </span>as<span class="_ _11"> </span>the<span class="_ _16"> </span>values<span class="_ _11"> </span>for<span class="_ _16"> </span>valA<span class="_ _11"> </span>and<span class="_ _11"> </span>valB<span class="_ _16"> </span>rather</span></div><div class="t m5 x17 h34 y41ea ff6 fs16 fc1 sc0 ls0 ws0">than<span class="_ _10"> </span>the<span class="_ _11"> </span>values<span class="_ _10"> </span>read<span class="_ _10"> </span>from<span class="_ _11"> </span>the<span class="_ _10"> </span>register<span class="_ _11"> </span>Ô¨Åle.</div><div class="t m5 x17 h26 y41eb ffd fs19 fc1 sc0 ls0 ws0">%rax<span class="_ _15"> </span><span class="ff7">is<span class="_ _21"> </span>the<span class="_ _21"> </span>source<span class="_ _21"> </span>register<span class="_ _21"> </span>for<span class="_ _21"> </span>operand<span class="_ _21"> </span><span class="ff6">valB</span>,<span class="_ _f"> </span>and<span class="_ _21"> </span>that<span class="_ _21"> </span>there<span class="_ _15"> </span>is<span class="_ _21"> </span>also<span class="_ _21"> </span>a<span class="_ _21"> </span>pending</span></div><div class="t m5 x17 h26 y41ec ff7 fs19 fc1 sc0 ls0 ws0">write<span class="_"> </span>to<span class="_ _11"> </span><span class="ffd">%rax<span class="_ _11"> </span></span>on<span class="_ _11"> </span>write<span class="_ _11"> </span>port<span class="_ _11"> </span>E.<span class="_ _11"> </span>It<span class="_ _11"> </span>can<span class="_ _11"> </span>therefore<span class="_ _11"> </span>avoid<span class="_ _11"> </span>stalling<span class="_"> </span>by<span class="_ _11"> </span>simply<span class="_ _11"> </span>using<span class="_ _11"> </span>the</div><div class="t m5 x17 h26 y41ed ff7 fs19 fc1 sc0 ls0 ws0">data<span class="_"> </span>word<span class="_ _11"> </span>supplied<span class="_"> </span>to<span class="_ _11"> </span>port<span class="_ _11"> </span>E<span class="_"> </span>(signal<span class="_ _11"> </span><span class="ff6">W_valE</span>)<span class="_ _11"> </span>as<span class="_"> </span>the<span class="_ _11"> </span>value<span class="_ _11"> </span>for<span class="_"> </span>operand<span class="_ _11"> </span><span class="ff6">valB</span>.<span class="_ _11"> </span>T<span class="_ _1"></span>his</div><div class="t m5 x17 h26 y41ee ff7 fs19 fc1 sc0 ls0 ws0">technique<span class="_ _11"> </span>of<span class="_ _11"> </span>passing<span class="_ _11"> </span>a<span class="_ _16"> </span>result<span class="_"> </span>value<span class="_ _16"> </span>directly<span class="_"> </span>from<span class="_ _16"> </span>one<span class="_"> </span>pipeline<span class="_ _16"> </span>stage<span class="_"> </span>to<span class="_ _16"> </span>an<span class="_"> </span>earlier</div><div class="t m5 x17 h26 y41ef ff7 fs19 fc1 sc0 ls0 ws0">one<span class="_ _13"> </span>is<span class="_ _6"> </span>commonly<span class="_ _13"> </span>known<span class="_ _13"> </span>as<span class="_ _13"> </span><span class="ffa">data<span class="_ _6"> </span>forwarding<span class="_ _13"> </span></span>(or<span class="_ _13"> </span>simply<span class="_ _13"> </span><span class="ffa">forwarding</span>,<span class="_ _13"> </span>and<span class="_ _13"> </span>sometimes</div><div class="t m5 x17 h26 y41f0 ffa fs19 fc1 sc0 ls0 ws0">bypassing<span class="ff7">).<span class="_ _14"> </span>It<span class="_ _14"> </span>allows<span class="_ _14"> </span>the<span class="_ _14"> </span>instructions<span class="_ _14"> </span>of<span class="_ _14"> </span><span class="ffd">prog2<span class="_ _14"> </span></span>to<span class="_ _14"> </span>proceed<span class="_ _14"> </span>through<span class="_ _14"> </span>the<span class="_ _14"> </span>pipeline</span></div><div class="t m5 x17 h26 y41f1 ff7 fs19 fc1 sc0 ls0 ws0">without<span class="_ _13"> </span>any<span class="_ _6"> </span>stalling.<span class="_ _13"> </span>Data<span class="_ _6"> </span>forwarding<span class="_ _13"> </span>requires<span class="_ _13"> </span>adding<span class="_ _13"> </span>additional<span class="_ _6"> </span>data<span class="_ _13"> </span>connections</div><div class="t m5 x17 h26 y41f2 ff7 fs19 fc1 sc0 ls0 ws0">and<span class="_"> </span>control<span class="_"> </span>logic<span class="_"> </span>to<span class="_"> </span>the<span class="_"> </span>basic<span class="_"> </span>hardware<span class="_"> </span>structure<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y41f3 ff7 fs19 fc1 sc0 ls0 ws0">As<span class="_ _15"> </span>F<span class="_ _0"></span>igure<span class="_ _15"> </span>4.50<span class="_ _15"> </span>illustrates<span class="_ _1"></span>,<span class="_ _21"> </span>data<span class="_ _15"> </span>forwarding<span class="_ _21"> </span>can<span class="_ _15"> </span>also<span class="_ _15"> </span>be<span class="_ _15"> </span>used<span class="_ _15"> </span>when<span class="_ _21"> </span>there<span class="_ _15"> </span>is</div><div class="t m5 x17 h26 y41f4 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_ _21"> </span>pending<span class="_ _21"> </span>write<span class="_ _21"> </span>to<span class="_ _f"> </span>a<span class="_ _21"> </span>register<span class="_ _21"> </span>in<span class="_ _f"> </span>the<span class="_ _21"> </span>memory<span class="_ _21"> </span>stage,<span class="_ _f"> </span>avoiding<span class="_ _21"> </span>the<span class="_ _21"> </span>need<span class="_ _f"> </span>to<span class="_ _21"> </span>stall</div><div class="t m5 x17 h26 y41f5 ff7 fs19 fc1 sc0 ls0 ws0">for<span class="_ _11"> </span>program<span class="_ _16"> </span><span class="ffd">prog3</span>.<span class="_ _11"> </span>In<span class="_ _11"> </span>cycle<span class="_ _11"> </span>5,<span class="_ _16"> </span>the<span class="_ _11"> </span>decode-stage<span class="_ _16"> </span>logic<span class="_ _11"> </span>detects<span class="_ _16"> </span>a<span class="_ _11"> </span>pending<span class="_ _11"> </span>write<span class="_ _16"> </span>to</div><div class="t m5 x17 h26 y41f6 ff7 fs19 fc1 sc0 ls0 ws0">register<span class="_ _6"> </span><span class="ffd">%rdx<span class="_ _6"> </span></span>on<span class="_ _6"> </span>port<span class="_ _13"> </span>E<span class="_ _a"> </span>in<span class="_ _6"> </span>the<span class="_ _6"> </span>write-back<span class="_ _13"> </span>stage<span class="_ _1"></span>,<span class="_ _13"> </span>as<span class="_ _a"> </span>well<span class="_ _6"> </span>as<span class="_ _6"> </span>a<span class="_ _13"> </span>pending<span class="_ _a"> </span>write<span class="_ _6"> </span>to<span class="_ _13"> </span>register</div><div class="t m5 x17 h26 y41f7 ffd fs19 fc1 sc0 ls0 ws0">%rax<span class="_ _6"> </span><span class="ff7">that<span class="_ _13"> </span>is<span class="_ _a"> </span>on<span class="_ _13"> </span>its<span class="_ _6"> </span>way<span class="_ _6"> </span>to<span class="_ _13"> </span>port<span class="_ _6"> </span>E<span class="_ _6"> </span>but<span class="_ _13"> </span>is<span class="_ _6"> </span>still<span class="_ _6"> </span>in<span class="_ _13"> </span>the<span class="_ _a"> </span>memory<span class="_ _13"> </span>stage<span class="_ _1"></span>.<span class="_ _6"> </span>Rather<span class="_ _13"> </span>than<span class="_ _6"> </span>stalling</span></div><div class="t m5 x17 h26 y41f8 ff7 fs19 fc1 sc0 ls0 ws0">until<span class="_"> </span>the<span class="_"> </span>writes<span class="_"> </span>have<span class="_"> </span>occurred,<span class="_"> </span>it<span class="_ _13"> </span>can<span class="_"> </span>use<span class="_"> </span>the<span class="_"> </span>value<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>write-back<span class="_"> </span>stage<span class="_"> </span>(signal</div><div class="t m5 x17 h26 y41f9 ff6 fs19 fc1 sc0 ls0 ws0">W_valE<span class="ff7">)<span class="_"> </span>for<span class="_ _11"> </span>operand<span class="_"> </span></span>valA<span class="_ _11"> </span><span class="ff7">and<span class="_"> </span>the<span class="_ _11"> </span>value<span class="_"> </span>in<span class="_ _11"> </span>the<span class="_"> </span>memory<span class="_ _11"> </span>stage<span class="_"> </span>(signal<span class="_ _11"> </span></span>M_valE<span class="ff7">)<span class="_"> </span>for</span></div><div class="t m5 x17 h26 y41fa ff7 fs19 fc1 sc0 ls0 ws0">operand<span class="_"> </span><span class="ff6">valB</span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
