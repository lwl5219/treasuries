<div id="pf235" class="pf w2 h11" data-page-no="235"><div class="pc pc235 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg235.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">564<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>5<span class="_ _3d"> </span>Optimizing<span class="_ _10"> </span>Program<span class="_ _10"> </span>Performance</span></div><div class="t m5 x1d h26 y9c ff7 fs19 fc2 sc0 ls0 ws0">not<span class="_"> </span>taken.<span class="_ _11"> </span>W<span class="_ _1"></span>e<span class="_"> </span>assume<span class="_ _11"> </span>this<span class="_ _11"> </span>checking<span class="_"> </span>can<span class="_ _11"> </span>be<span class="_ _11"> </span>done<span class="_ _11"> </span>quickly<span class="_ _11"> </span>enough<span class="_"> </span>that<span class="_ _11"> </span>it<span class="_ _11"> </span>does<span class="_ _11"> </span>not</div><div class="t m5 x1d h26 y409 ff7 fs19 fc2 sc0 ls0 ws0">slow<span class="_"> </span>down<span class="_"> </span>the<span class="_"> </span>processor.</div><div class="t m5 x29 h26 y40a ff7 fs19 fc2 sc0 ls0 ws0">In<span class="_"> </span>Figure<span class="_"> </span>5.14(b),<span class="_ _11"> </span>we<span class="_"> </span>have<span class="_ _11"> </span>eliminated<span class="_ _11"> </span>the<span class="_ _11"> </span>operators<span class="_"> </span>that<span class="_ _11"> </span>were<span class="_ _11"> </span>colored<span class="_ _11"> </span>white</div><div class="t m5 x1d h26 y40b ff7 fs19 fc2 sc0 ls0 ws0">on<span class="_"> </span>the<span class="_"> </span>left,<span class="_ _11"> </span>and<span class="_"> </span>we<span class="_ _11"> </span>have<span class="_"> </span>retained<span class="_ _11"> </span>only<span class="_"> </span>the<span class="_ _11"> </span>loop<span class="_"> </span>registers<span class="_ _1"></span>.<span class="_ _11"> </span>What<span class="_"> </span>we<span class="_"> </span>have<span class="_"> </span>left<span class="_ _11"> </span>is<span class="_"> </span>an</div><div class="t m5 x1d h26 y40c ff7 fs19 fc2 sc0 ls0 ws0">abstract<span class="_"> </span>template<span class="_"> </span>showing<span class="_ _13"> </span>the<span class="_"> </span>data<span class="_"> </span>dependencies<span class="_"> </span>that<span class="_"> </span>form<span class="_"> </span>among<span class="_ _13"> </span>loop<span class="_"> </span>registers</div><div class="t m5 x1d h26 y40d ff7 fs19 fc2 sc0 ls0 ws0">due<span class="_ _16"> </span>to<span class="_ _14"> </span>one<span class="_ _16"> </span>iteration<span class="_ _14"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>loop.<span class="_ _16"> </span>W<span class="_ _3"></span>e<span class="_ _16"> </span>can<span class="_ _14"> </span>see<span class="_ _16"> </span>in<span class="_ _14"> </span>this<span class="_ _16"> </span>diagram<span class="_ _14"> </span>that<span class="_ _16"> </span>there<span class="_ _14"> </span>are<span class="_ _16"> </span>two</div><div class="t m5 x1d h26 y40e ff7 fs19 fc2 sc0 ls0 ws0">data<span class="_ _15"> </span>dependencies<span class="_ _15"> </span>from<span class="_ _15"> </span>one<span class="_ _14"> </span>iteration<span class="_ _15"> </span>to<span class="_ _15"> </span>the<span class="_ _15"> </span>next.<span class="_ _15"> </span>Along<span class="_ _15"> </span>one<span class="_ _15"> </span>side,<span class="_ _15"> </span>we<span class="_ _15"> </span>see<span class="_ _15"> </span>the</div><div class="t m5 x1d h26 y40f ff7 fs19 fc2 sc0 ls0 ws0">dependencies<span class="_"> </span>between<span class="_"> </span>successive<span class="_"> </span>values<span class="_"> </span>of<span class="_"> </span>program<span class="_"> </span>value<span class="_"> </span><span class="ffd">acc</span>,<span class="_"> </span>stored<span class="_"> </span>in<span class="_"> </span>register</div><div class="t m5 x1d h26 y410 ffd fs19 fc2 sc0 ls0 ws0">%xmm0<span class="ff7">.<span class="_"> </span>The<span class="_"> </span>loop<span class="_"> </span>computes<span class="_"> </span>a<span class="_ _11"> </span>new<span class="_ _11"> </span>value<span class="_"> </span>for<span class="_ _11"> </span></span>acc<span class="_ _11"> </span><span class="ff7">by<span class="_"> </span>multiplying<span class="_ _11"> </span>the<span class="_"> </span>old<span class="_ _11"> </span>value<span class="_ _11"> </span>by<span class="_"> </span>a</span></div><div class="t m5 x1d h26 y411 ff7 fs19 fc2 sc0 ls0 ws0">data<span class="_ _11"> </span>element,<span class="_ _11"> </span>generated<span class="_ _11"> </span>by<span class="_ _11"> </span>the<span class="_ _11"> </span><span class="ff6">load<span class="_ _11"> </span></span>operation.<span class="_ _11"> </span>Along<span class="_ _11"> </span>the<span class="_ _11"> </span>other<span class="_ _11"> </span>side,<span class="_"> </span>we<span class="_ _11"> </span>see<span class="_ _11"> </span>the</div><div class="t m5 x1d h26 y412 ff7 fs19 fc2 sc0 ls0 ws0">dependencies<span class="_ _16"> </span>between<span class="_ _16"> </span>successive<span class="_ _16"> </span>values<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>pointer<span class="_ _14"> </span>to<span class="_ _16"> </span>the<span class="_ _16"> </span><span class="ff11">i<span class="_ _5"></span></span>th<span class="_ _16"> </span>data<span class="_ _16"> </span>element.</div><div class="t m5 x1d h26 y413 ff7 fs19 fc2 sc0 ls0 ws0">On<span class="_"> </span>each<span class="_ _13"> </span>iteration,<span class="_"> </span>the<span class="_ _13"> </span>old<span class="_"> </span>value<span class="_"> </span>is<span class="_ _13"> </span>used<span class="_"> </span>as<span class="_ _13"> </span>the<span class="_"> </span>address<span class="_ _13"> </span>for<span class="_"> </span>the<span class="_"> </span><span class="ff6">load<span class="_ _13"> </span></span>operation,<span class="_"> </span>and</div><div class="t m5 x1d h26 y414 ff7 fs19 fc2 sc0 ls0 ws0">it<span class="_"> </span>is<span class="_"> </span>also<span class="_"> </span>incremented<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span><span class="ff6">add<span class="_ _10"> </span></span>operation<span class="_"> </span>to<span class="_"> </span>compute<span class="_"> </span>its<span class="_"> </span>new<span class="_"> </span>value<span class="_ _0"></span>.</div><div class="t m5 x29 h26 y415 ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _6"> </span>5.15<span class="_ _13"> </span>shows<span class="_ _a"> </span>the<span class="_ _6"> </span>data-ﬂow<span class="_ _6"> </span>representation<span class="_ _6"> </span>of<span class="_ _6"> </span><span class="ff11">n<span class="_ _6"> </span></span>iterations<span class="_ _13"> </span>by<span class="_ _a"> </span>the<span class="_ _6"> </span>inner<span class="_ _6"> </span>loop</div><div class="t m5 x1d h26 y416 ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_ _13"> </span>function<span class="_ _13"> </span><span class="ffd">combine4</span>.<span class="_"> </span>T<span class="_ _1"></span>his<span class="_ _13"> </span>graph<span class="_"> </span>was<span class="_ _13"> </span>obtained<span class="_ _13"> </span>by<span class="_ _13"> </span>simply<span class="_"> </span>replicating<span class="_ _13"> </span>the<span class="_ _13"> </span>template</div><div class="t m5 x1d h26 y434 ff7 fs19 fc2 sc0 ls0 ws0">shown<span class="_ _6"> </span>in<span class="_ _6"> </span>Figure<span class="_ _a"> </span>5.14(b)<span class="_ _6"> </span><span class="ff11">n<span class="_ _13"> </span></span>times<span class="_ _3"></span>.<span class="_ _6"> </span>W<span class="_ _1"></span>e<span class="_ _6"> </span>can<span class="_ _6"> </span>see<span class="_ _6"> </span>that<span class="_ _13"> </span>the<span class="_ _a"> </span>program<span class="_ _6"> </span>has<span class="_ _13"> </span>two<span class="_ _a"> </span>chains<span class="_ _6"> </span>of<span class="_ _13"> </span>data</div><div class="t m5 x14 h2f y4cb5 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>5.15</div><div class="t m5 x14 h2f y4cb6 ffe fs16 fc1 sc0 ls0 ws0">Data-ﬂow<span class="_"> </span>representation</div><div class="t m5 x14 h2f y4cb7 ffe fs16 fc1 sc0 ls0 ws0">of<span class="_ _14"> </span>computation<span class="_ _14"> </span>by<span class="_ _14"> </span><span class="ff11">n</span></div><div class="t m5 x14 h2f y4cb8 ffe fs16 fc1 sc0 ls0 ws0">iterations<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>inner</div><div class="t m5 x14 h2f y4cb9 ffe fs16 fc1 sc0 ls0 ws0">loop<span class="_ _16"> </span>of</div><div class="t m5 x34 h3a y4cba ffd fs19 fc1 sc0 ls0 ws0">combine4<span class="ffe fs16">.<span class="_ _16"> </span><span class="ff6">The</span></span></div><div class="t m5 x14 h34 y4cbb ff6 fs16 fc1 sc0 ls0 ws0">sequence<span class="_ _11"> </span>of<span class="_ _10"> </span>multiplication</div><div class="t m5 x14 h34 y4cbc ff6 fs16 fc1 sc0 ls0 ws0">operations<span class="_ _11"> </span>forms<span class="_ _11"> </span>a<span class="_ _11"> </span>critical</div><div class="t m5 x14 h34 y4cbd ff6 fs16 fc1 sc0 ls0 ws0">path<span class="_ _11"> </span>that<span class="_ _16"> </span>limits<span class="_ _16"> </span>program</div><div class="t m5 x14 h34 y4cbe ff6 fs16 fc1 sc0 ls0 ws0">performance.</div><div class="t m5 x1ec h40 y4cbf ff59 fs28 fc1 sc0 ls0 ws0">data[0]</div><div class="t m5 x16d h3f y4cc0 ff58 fs27 fc1 sc0 ls214 ws0">load</div><div class="t m5 x1c6 h3f y4cc1 ff58 fs27 fc1 sc0 ls214 wsa">Critical path</div><div class="t m5 x115 h3f y4cc2 ff58 fs27 fc1 sc0 ls214 ws0">mul<span class="_ _63"> </span>add</div><div class="t m5 x1ec h40 y32a4 ff59 fs28 fc1 sc0 ls0 ws0">data[1]</div><div class="t m5 x16d h3f y4cc3 ff58 fs27 fc1 sc0 ls214 ws0">load</div><div class="t m5 x115 h3f y4cc4 ff58 fs27 fc1 sc0 ls214 ws0">mul<span class="_ _63"> </span>add</div><div class="t m5 x1ec h40 y4cc5 ff59 fs28 fc1 sc0 ls0 ws0">data[<span class="ff5a fs27">n<span class="_ _2"></span></span>-2]</div><div class="t m5 x16d h3f y4cc6 ff58 fs27 fc1 sc0 ls214 ws0">load</div><div class="t m5 x115 h3f y4cc7 ff58 fs27 fc1 sc0 ls214 ws0">mul<span class="_ _63"> </span>add</div><div class="t m5 x1ec h40 y4cc8 ff59 fs28 fc1 sc0 ls0 ws0">data[<span class="ff5a fs27">n<span class="_ _2"></span></span>-1]</div><div class="t m5 x16d h3f y4cc9 ff58 fs27 fc1 sc0 ls214 ws0">load</div><div class="t m5 x115 h3f y4cca ff58 fs27 fc1 sc0 ls214 ws0">mul<span class="_ _63"> </span>add</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
