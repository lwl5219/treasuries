<div id="pf241" class="pf w2 h11" data-page-no="241"><div class="pc pc241 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg241.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">576<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>5<span class="_ _3d"> </span>Optimizing<span class="_ _10"> </span>Program<span class="_ _10"> </span>Performance</span></div><div class="t m5 x23a h9a y4e0f ff66 fs5e fc1 sc0 ls0 ws0">6</div><div class="t m5 x23a h9a y4e10 ff66 fs5e fc1 sc0 ls0 ws0">5</div><div class="t m5 x23a h9a y4e11 ff66 fs5e fc1 sc0 ls0 ws0">4</div><div class="t m5 x23a h9a y4e12 ff66 fs5e fc1 sc0 ls0 ws0">3</div><div class="t m5 x23a h9a y4e13 ff66 fs5e fc1 sc0 ls0 ws0">2</div><div class="t m5 x23a h9a y4e14 ff66 fs5e fc1 sc0 ls0 ws0">1</div><div class="t m5 x23a h9a y4e15 ff66 fs5e fc1 sc0 ls0 ws0">0</div><div class="t m5 xc2 h9a y4e16 ff66 fs5e fc1 sc0 ls0 ws0">1</div><div class="t m5 x18e h9a y4e17 ff66 fs5e fc1 sc0 ls0 ws0">2<span class="_ _79"> </span>3<span class="_ _79"> </span>4</div><div class="t m5 xec h9a y4e18 ff21 fs5e fc1 sc0 ls0 ws0">Unrolling factor <span class="ff5b">k</span></div><div class="t m7 x10b h9a y4e19 ff21 fs5e fc1 sc0 ls0 ws0">CPE</div><div class="t m5 xe4 h9a y4e17 ff66 fs5e fc1 sc0 ls0 ws0">5<span class="_ _79"> </span>6</div><div class="t m5 x21 hd5 y4e1a ff66 fs86 fc1 sc0 ls0 ws0">double </div><div class="t m5 x262 hd6 y4e1b ff66 fs87 fc1 sc0 ls0 ws0">*</div><div class="t m5 x21 hd5 y4e1c ff66 fs86 fc1 sc0 ls0 ws0">double +</div><div class="t m5 x21 hd5 y4e1d ff66 fs86 fc1 sc0 ls0 ws0">long </div><div class="t m5 x210 hd6 y4e1e ff66 fs87 fc1 sc0 ls0 ws0">*</div><div class="t m5 x21 hd5 y4e1f ff66 fs86 fc1 sc0 ls0 ws0">long +</div><div class="t m5 xbf h9a y4e17 ff66 fs5e fc1 sc0 ls0 ws0">7<span class="_ _79"> </span>8<span class="_ _79"> </span>9<span class="_ _3c"> </span>10</div><div class="t m5 x1d h35 y4e20 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _11"> </span>5.25<span class="_ _c"> </span><span class="fc1">CPE<span class="_ _11"> </span>per<span class="_ _2"></span>formance<span class="_"> </span>of<span class="_ _16"> </span><span class="ff11">k<span class="_ _10"> </span><span class="ff12">×<span class="_ _13"></span></span>k<span class="_"> </span></span>loop<span class="_ _11"> </span>unrolling.<span class="_ _11"> </span><span class="ff6">All<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>CPEs<span class="_ _11"> </span>improve<span class="_ _16"> </span>with</span></span></div><div class="t m5 x1d h34 y4e21 ff6 fs16 fc1 sc0 ls0 ws0">this<span class="_ _10"> </span>transformation,<span class="_ _11"> </span>achieving<span class="_ _10"> </span>near<span class="_ _10"> </span>or<span class="_ _11"> </span>at<span class="_ _10"> </span>their<span class="_ _11"> </span>throughput<span class="_ _10"> </span>bounds.</div><div class="t m5 x1d h26 y4e22 ff7 fs19 fc1 sc0 ls0 ws0">achieve<span class="_ _16"> </span>nearly<span class="_ _14"> </span>the<span class="_ _16"> </span>throughput<span class="_ _14"> </span>bounds<span class="_ _16"> </span>for<span class="_ _14"> </span>all<span class="_ _14"> </span>cases<span class="_ _1"></span>.<span class="_ _16"> </span>Integer<span class="_ _14"> </span>addition<span class="_ _16"> </span>achieves<span class="_ _14"> </span>a</div><div class="t m5 x1d h46 y4e23 ff7 fs19 fc1 sc0 ls0 ws0">CPE<span class="_"> </span>of<span class="_ _11"> </span>0.54<span class="_"> </span>with<span class="_ _11"> </span><span class="ff11">k<span class="_ _11"> </span><span class="ff12">=<span class="_ _13"> </span></span></span><span class="ls77">7,<span class="_ _11"> </span>close<span class="_ _11"> </span>to<span class="_"> </span>the<span class="_ _11"> </span>throughput<span class="_"> </span>bound<span class="_ _11"> </span>of<span class="_ _11"> </span>0.50<span class="_"> </span>caused<span class="_ _11"> </span>by<span class="_ _11"> </span>the<span class="_"> </span>two</span></div><div class="t m5 x1d h26 y4e24 ff7 fs19 fc1 sc0 ls0 ws0">load<span class="_ _13"> </span>units<span class="_ _3"></span>.<span class="_ _13"> </span>Integer<span class="_ _13"> </span>multiplication<span class="_ _13"> </span>and<span class="_ _13"> </span>ﬂoating-point<span class="_ _6"> </span>addition<span class="_ _13"> </span>achieve<span class="_ _13"> </span>CPEs<span class="_ _13"> </span>of<span class="_ _13"> </span>1.01</div><div class="t m5 x1d h46 y4e25 ff7 fs19 fc1 sc0 ls0 ws0">when<span class="_ _6"> </span><span class="ff11">k<span class="_ _10"> </span><span class="ff12">≥<span class="_ _13"></span></span></span>3,<span class="_ _6"> </span>approaching<span class="_ _6"> </span>the<span class="_ _13"> </span>throughput<span class="_ _a"> </span>bound<span class="_ _13"> </span>of<span class="_ _a"> </span>1.00<span class="_ _13"> </span>set<span class="_ _a"> </span>by<span class="_ _13"> </span>their<span class="_ _a"> </span>functional<span class="_ _13"> </span>units<span class="_ _3"></span>.</div><div class="t m5 x1d h46 y4e26 ff7 fs19 fc1 sc0 ls0 ws0">Floating-point<span class="_"> </span>multiplication<span class="_ _11"> </span>achieves<span class="_"> </span>a<span class="_ _11"> </span>CPE<span class="_"> </span>of<span class="_ _11"> </span>0.51<span class="_"> </span>for<span class="_ _11"> </span><span class="ff11">k<span class="_ _10"> </span><span class="ff12">≥<span class="_ _10"> </span></span></span><span class="ls58">10,<span class="_"> </span>approaching<span class="_ _11"> </span>the</span></div><div class="t m5 x1d h26 y4e27 ff7 fs19 fc1 sc0 ls0 ws0">throughput<span class="_ _16"> </span>bound<span class="_ _14"> </span>of<span class="_ _14"> </span>0.50<span class="_ _14"> </span>set<span class="_ _16"> </span>by<span class="_ _14"> </span>the<span class="_ _14"> </span>two<span class="_ _14"> </span>ﬂoating-point<span class="_ _16"> </span>multipliers<span class="_ _14"> </span>and<span class="_ _14"> </span>the<span class="_ _16"> </span>two</div><div class="t m5 x1d h26 y4e28 ff7 fs19 fc1 sc0 ls0 ws0">load<span class="_ _14"> </span>units<span class="_ _0"></span>.<span class="_ _14"> </span>It<span class="_ _15"> </span>is<span class="_ _15"> </span>worth<span class="_ _15"> </span>noting<span class="_ _15"> </span>that<span class="_ _14"> </span>our<span class="_ _15"> </span>code<span class="_ _15"> </span>is<span class="_ _15"> </span>able<span class="_ _15"> </span>to<span class="_ _15"> </span>achieve<span class="_ _14"> </span>nearly<span class="_ _15"> </span>twice<span class="_ _15"> </span>the</div><div class="t m5 x1d h26 y4e29 ff7 fs19 fc1 sc0 ls0 ws0">throughput<span class="_ _6"> </span>with<span class="_ _6"> </span>ﬂoating-point<span class="_ _6"> </span>multiplication<span class="_ _13"> </span>as<span class="_ _a"> </span>it<span class="_ _13"> </span>can<span class="_ _a"> </span>with<span class="_ _6"> </span>ﬂoating-point<span class="_ _13"> </span>addition,</div><div class="t m5 x1d h26 y4e2a ff7 fs19 fc1 sc0 ls0 ws0">even<span class="_"> </span>though<span class="_"> </span>multiplication<span class="_"> </span>is<span class="_"> </span>a<span class="_"> </span>more<span class="_"> </span>complex<span class="_"> </span>operation.</div><div class="t m5 x29 h26 y4e2b ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _14"> </span>general,<span class="_ _15"> </span>a<span class="_ _15"> </span>program<span class="_ _14"> </span>can<span class="_ _15"> </span>achieve<span class="_ _14"> </span>the<span class="_ _15"> </span>throughput<span class="_ _14"> </span>bound<span class="_ _15"> </span>for<span class="_ _14"> </span>an<span class="_ _14"> </span>operation</div><div class="t m5 x1d h26 y4e2c ff7 fs19 fc1 sc0 ls0 ws0">only<span class="_"> </span>when<span class="_"> </span>it<span class="_ _13"> </span>can<span class="_"> </span>keep<span class="_"> </span>the<span class="_"> </span>pipelines<span class="_ _13"> </span>ﬁlled<span class="_"> </span>for<span class="_"> </span>all<span class="_"> </span>of<span class="_ _13"> </span>the<span class="_"> </span>functional<span class="_"> </span>units<span class="_"> </span>capable<span class="_ _13"> </span>of</div><div class="t m5 x1d h26 y4e2d ff7 fs19 fc1 sc0 ls0 ws0">performing<span class="_ _11"> </span>that<span class="_ _16"> </span>operation.<span class="_ _11"> </span>F<span class="_ _1"></span>or<span class="_ _16"> </span>an<span class="_ _11"> </span>operation<span class="_ _16"> </span>with<span class="_ _11"> </span>latency<span class="_ _11"> </span><span class="ff11">L<span class="_ _16"> </span></span>and<span class="_ _11"> </span>capacity<span class="_ _11"> </span><span class="ff11">C<span class="_ _5"></span></span>,<span class="_ _16"> </span>this</div><div class="t m5 x1d h46 y4e2e ff7 fs19 fc1 sc0 ls0 ws0">requires<span class="_ _11"> </span>an<span class="_ _11"> </span>unrolling<span class="_ _11"> </span>factor<span class="_ _11"> </span><span class="ff11">k<span class="_ _11"> </span><span class="ff12">≥<span class="_ _13"> </span></span>C</span></div><div class="t m5 x184 h45 y4e2f ff11 fs19 fc1 sc0 ls0 ws0">.</div><div class="t m5 x130 h26 y4e2e ff11 fs19 fc1 sc0 ls0 ws0">L<span class="ff7">.<span class="_ _11"> </span>F<span class="_ _1"></span>or<span class="_ _11"> </span>example<span class="_ _0"></span>,<span class="_ _11"> </span>ﬂoating-point<span class="_ _11"> </span>multiplication</span></div><div class="t m5 x1d h46 y4e30 ff7 fs19 fc1 sc0 ls0 ws0">has<span class="_ _16"> </span><span class="ff11">C<span class="_"> </span><span class="ff12">=<span class="_ _13"></span></span></span>2<span class="_ _14"> </span>and<span class="_ _14"> </span><span class="ff11">L<span class="_ _10"> </span><span class="ff12">=<span class="_ _13"> </span></span></span>5,<span class="_ _14"> </span>necessitating<span class="_ _14"> </span>an<span class="_ _16"> </span>unrolling<span class="_ _14"> </span>factor<span class="_ _14"> </span>of<span class="_ _16"> </span><span class="ff11">k<span class="_ _11"> </span><span class="ff12">≥<span class="_ _10"> </span></span></span><span class="ls58">10.<span class="_ _16"> </span>Floating-point</span></div><div class="t m5 x1d h46 y4e31 ff7 fs19 fc1 sc0 ls0 ws0">addition<span class="_"> </span>has<span class="_"> </span><span class="ff11">C<span class="_ _11"> </span><span class="ff12">=<span class="_ _10"> </span></span></span>1<span class="_ _13"> </span>and<span class="_"> </span><span class="ff11">L<span class="_ _13"> </span><span class="ff12">=<span class="_ _10"> </span></span></span>3<span class="_ _1"></span>,<span class="_"> </span>achieving<span class="_"> </span>maximum<span class="_"> </span>throughput<span class="_"> </span>with<span class="_"> </span><span class="ff11">k<span class="_ _11"> </span><span class="ff12">≥<span class="_ _13"> </span></span></span><span class="ls23">3.</span></div><div class="t m5 x29 h46 y4e32 ff7 fs19 fc1 sc0 ls0 ws0">In<span class="_ _6"> </span>performing<span class="_ _13"> </span>the<span class="_ _6"> </span><span class="ff11">k<span class="_ _10"> </span><span class="ff12">×<span class="_ _13"></span></span>k<span class="_ _13"> </span></span>unrolling<span class="_ _13"> </span>transformation,<span class="_ _6"> </span>we<span class="_ _13"> </span>must<span class="_ _6"> </span>consider<span class="_ _13"> </span>whether<span class="_ _6"> </span>it</div><div class="t m5 x1d h26 y4e33 ff7 fs19 fc1 sc0 ls0 ws0">preserves<span class="_ _13"> </span>the<span class="_ _6"> </span>functionality<span class="_ _13"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>original<span class="_ _6"> </span>function.<span class="_ _13"> </span>W<span class="_ _3"></span>e<span class="_ _6"> </span>have<span class="_ _13"> </span>seen<span class="_ _6"> </span>in<span class="_ _13"> </span>Chapter<span class="_ _6"> </span>2<span class="_ _13"> </span>that</div><div class="t m5 x1d h26 y4e34 ff7 fs19 fc1 sc0 ls0 ws0">two’s-complement<span class="_ _6"> </span>arithmetic<span class="_ _6"> </span>is<span class="_ _13"> </span>commutative<span class="_ _6"> </span>and<span class="_ _13"> </span>associative<span class="_ _1"></span>,<span class="_ _13"> </span>even<span class="_ _6"> </span>when<span class="_ _13"> </span>overﬂow</div><div class="t m5 x1d h26 y4e35 ff7 fs19 fc1 sc0 ls0 ws0">occurs<span class="_ _1"></span>.<span class="_"> </span>Hence<span class="_ _0"></span>,<span class="_"> </span>for<span class="_"> </span>an<span class="_ _11"> </span>integer<span class="_"> </span>data<span class="_"> </span>type,<span class="_"> </span>the<span class="_"> </span>result<span class="_"> </span>computed<span class="_"> </span>by<span class="_ _11"> </span><span class="ffd">combine6<span class="_ _10"> </span></span>will<span class="_"> </span>be</div><div class="t m5 x1b0 h26 y4e36 ff7 fs19 fc1 sc0 ls0 ws0">identical<span class="_ _16"> </span>to<span class="_ _14"> </span>that<span class="_ _16"> </span>computed<span class="_ _14"> </span>by<span class="_ _14"> </span><span class="ffd">combine5<span class="_ _16"> </span></span>under<span class="_ _14"> </span>all<span class="_ _16"> </span>possible<span class="_ _14"> </span>conditions<span class="_ _1"></span>.<span class="_ _14"> </span>T<span class="_ _1"></span>hus<span class="_ _0"></span>,<span class="_ _14"> </span>an</div><div class="t m5 x1b0 h26 y4e37 ff7 fs19 fc1 sc0 ls0 ws0">optimizing<span class="_ _16"> </span>compiler<span class="_ _16"> </span>could<span class="_ _11"> </span>potentially<span class="_ _16"> </span>convert<span class="_ _16"> </span>the<span class="_ _16"> </span>code<span class="_ _16"> </span>shown<span class="_ _16"> </span>in<span class="_ _16"> </span><span class="ffd">combine4<span class="_ _11"> </span></span>ﬁrst</div><div class="t m5 x1b0 h26 y4e38 ff7 fs19 fc1 sc0 ls0 ws0">to<span class="_ _14"> </span>a<span class="_ _14"> </span>two-way<span class="_ _14"> </span>unrolled<span class="_ _14"> </span>variant<span class="_ _15"> </span>of<span class="_ _14"> </span><span class="ffd">combine5<span class="_ _14"> </span></span>by<span class="_ _14"> </span>loop<span class="_ _14"> </span>unrolling,<span class="_ _15"> </span>and<span class="_ _14"> </span>then<span class="_ _14"> </span>to<span class="_ _14"> </span>that</div><div class="t m5 x1b0 h26 y4e39 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_"> </span><span class="ffd">combine6<span class="_ _10"> </span></span>by<span class="_ _11"> </span>introducing<span class="_"> </span>parallelism.<span class="_"> </span>Some<span class="_ _11"> </span>compilers<span class="_"> </span>do<span class="_"> </span>either<span class="_"> </span>this<span class="_ _11"> </span>or<span class="_"> </span>similar</div><div class="t m5 x1b0 h26 y4e3a ff7 fs19 fc1 sc0 ls0 ws0">transformations<span class="_"> </span>to<span class="_"> </span>improve<span class="_"> </span>performance<span class="_"> </span>for<span class="_"> </span>integer<span class="_"> </span>data.</div><div class="t m5 x29 h26 y4e3b ff7 fs19 fc1 sc0 ls0 ws0">On<span class="_ _21"> </span>the<span class="_ _f"> </span>other<span class="_ _f"> </span>hand,<span class="_ _e"> </span>ﬂoating-point<span class="_ _21"> </span>multiplication<span class="_ _f"> </span>and<span class="_ _f"> </span>addition<span class="_ _f"> </span>are<span class="_ _21"> </span>not<span class="_ _f"> </span>as-</div><div class="t m5 x1b0 h26 y4e3c ff7 fs19 fc1 sc0 ls0 ws0">sociative<span class="_ _1"></span>.<span class="_ _14"> </span>Thus<span class="_ _3"></span>,<span class="_ _14"> </span><span class="ffd">combine5<span class="_ _14"> </span></span>and<span class="_ _14"> </span><span class="ffd">combine6<span class="_ _14"> </span></span>could<span class="_ _14"> </span>produce<span class="_ _16"> </span>different<span class="_ _14"> </span>results<span class="_ _14"> </span>due<span class="_ _14"> </span>to</div><div class="t m5 x1b0 h26 y4e3d ff7 fs19 fc1 sc0 ls0 ws0">rounding<span class="_ _11"> </span>or<span class="_ _11"> </span>overﬂow<span class="_ _1"></span>.<span class="_ _11"> </span>Imagine,<span class="_ _11"> </span>for<span class="_ _11"> </span>example,<span class="_ _11"> </span>a<span class="_ _11"> </span>product<span class="_ _11"> </span>computation<span class="_ _16"> </span>in<span class="_ _11"> </span>which<span class="_ _11"> </span>all</div><div class="t m5 x1b0 h26 y4e3e ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_ _16"> </span>the<span class="_ _14"> </span>elements<span class="_ _16"> </span>with<span class="_ _14"> </span>even<span class="_ _16"> </span>indices<span class="_ _14"> </span>are<span class="_ _14"> </span>numbers<span class="_ _16"> </span>with<span class="_ _14"> </span>very<span class="_ _16"> </span>large<span class="_ _14"> </span>absolute<span class="_ _16"> </span>values<span class="_ _0"></span>,</div><div class="t m5 x1b0 h26 y4e3f ff7 fs19 fc1 sc0 ls0 ws0">while<span class="_ _16"> </span>those<span class="_ _14"> </span>with<span class="_ _14"> </span>odd<span class="_ _16"> </span>indices<span class="_ _14"> </span>are<span class="_ _14"> </span>very<span class="_ _14"> </span>close<span class="_ _16"> </span>to<span class="_ _14"> </span>0.0.<span class="_ _14"> </span>In<span class="_ _16"> </span>such<span class="_ _14"> </span>a<span class="_ _14"> </span>case<span class="_ _1"></span>,<span class="_ _15"> </span>product<span class="_ _14"> </span><span class="ffa">PE</span></div><div class="t m5 x262 h50 y4e40 ff11 fs25 fc1 sc0 ls0 ws0">n</div><div class="t m5 x1d h26 y4c76 ff7 fs19 fc1 sc0 ls0 ws0">might<span class="_ _13"> </span>overﬂow<span class="_ _3"></span>,<span class="_"> </span>or<span class="_ _13"> </span><span class="ffa">PO</span></div><div class="t m5 x255 h50 y4e41 ff11 fs25 fc1 sc0 ls0 ws0">n</div><div class="t m5 x110 h26 y1397 ff7 fs19 fc1 sc0 ls0 ws0">might<span class="_ _13"> </span>underﬂow<span class="_ _3"></span>,<span class="_"> </span>even<span class="_ _13"> </span>though<span class="_"> </span>computing<span class="_ _13"> </span>product<span class="_ _13"> </span><span class="ff11">P</span></div><div class="t m5 x2a h50 y4e41 ff11 fs25 fc1 sc0 ls0 ws0">n</div><div class="t m5 x9d h26 y1397 ff7 fs19 fc1 sc0 ls0 ws0">pro-</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
