<div id="pf126" class="pf w2 h11" data-page-no="126"><div class="pc pc126 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg126.png"/><div class="t m5 xc0 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>3.8<span class="_ _60"> </span>Array<span class="_ _10"> </span>Allocation<span class="_ _10"> </span>and<span class="_ _10"> </span>Access<span class="_ _3e"> </span><span class="ffe fs1e">293</span></div><div class="t m5 x17 h31 ye7 ff7 fs21 fc2 sc0 ls0 ws0">Array<span class="_ _26"> </span>Element<span class="_"> </span>size<span class="_ _26"> </span>T<span class="_ _3"></span>otal<span class="_"> </span>size<span class="_ _26"> </span>Start<span class="_"> </span>address<span class="_ _26"> </span>Element<span class="_"> </span><span class="ff11">i</span></div><div class="t m5 x72 h2d yb20 ffd fs1e fc2 sc0 ls0 ws0">P<span class="_ _16c"> </span><span class="ff11 fs21 fc1">x</span></div><div class="t m5 x87 h6d y2a80 ffd fs2c fc1 sc0 ls0 ws0">P</div><div class="t m5 x72 h2d y9bb ffd fs1e fc1 sc0 ls0 ws0">Q<span class="_ _16c"> </span><span class="ff11 fs21">x</span></div><div class="t m5 x87 h6d y2a81 ffd fs2c fc1 sc0 ls0 ws0">Q</div><div class="t m5 x72 h2d y9bc ffd fs1e fc1 sc0 ls0 ws0">R<span class="_ _16c"> </span><span class="ff11 fs21">x</span></div><div class="t m5 x88 h6d y2a82 ffd fs2c fc1 sc0 ls0 ws0">R</div><div class="t m5 x72 h2d y9bd ffd fs1e fc1 sc0 ls0 ws0">S<span class="_ _16c"> </span><span class="ff11 fs21">x</span></div><div class="t m5 x87 h6d y2a83 ffd fs2c fc1 sc0 ls0 ws0">S</div><div class="t m5 x72 h2d y9be ffd fs1e fc1 sc0 ls0 ws0">T<span class="_ _16c"> </span><span class="ff11 fs21">x</span></div><div class="t m5 x87 h6d y2a84 ffd fs2c fc1 sc0 ls0 ws0">T</div><div class="t m5 x17 h41 y2a85 ffe fs29 fc1 sc0 ls0 ws0">3.8.2</div><div class="t m5 x182 h43 y2a86 ffe fs19 fc1 sc0 ls0 ws0">Pointer<span class="_"> </span>Arithmetic</div><div class="t m5 x17 h26 y2a87 ff7 fs19 fc1 sc0 ls0 ws0">C<span class="_"> </span>allows<span class="_"> </span>arithmetic<span class="_ _13"> </span>on<span class="_"> </span>pointers<span class="_ _1"></span>,<span class="_"> </span>where<span class="_"> </span>the<span class="_"> </span>computed<span class="_"> </span>value<span class="_ _13"> </span>is<span class="_"> </span>scaled<span class="_"> </span>according<span class="_"> </span>to</div><div class="t m5 x17 h26 y2a88 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>size<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>data<span class="_"> </span>type<span class="_ _13"> </span>referenced<span class="_"> </span>by<span class="_ _13"> </span>the<span class="_"> </span>pointer.<span class="_ _13"> </span>T<span class="_ _0"></span>hat<span class="_"> </span>is<span class="_ _3"></span>,<span class="_"> </span>if<span class="_ _13"> </span><span class="ffd">p<span class="_ _10"> </span></span>is<span class="_"> </span>a<span class="_ _13"> </span>pointer<span class="_"> </span>to<span class="_ _13"> </span>data</div><div class="t m5 x17 h26 y2a89 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_ _16"> </span>type<span class="_ _16"> </span><span class="ff11">T<span class="_ _13"> </span></span>,<span class="_ _11"> </span>and<span class="_ _16"> </span>the<span class="_ _16"> </span>value<span class="_ _16"> </span>of<span class="_ _16"> </span><span class="ffd">p<span class="_ _16"> </span></span>is<span class="_ _16"> </span><span class="ff11">x</span></div><div class="t m5 xa5 h6e y2a8a ffd fs25 fc1 sc0 ls0 ws0">p</div><div class="t m5 x22 h26 y2a8b ff7 fs19 fc1 sc0 ls0 ws0">,<span class="_ _16"> </span>then<span class="_ _16"> </span>the<span class="_ _16"> </span>expression<span class="_ _16"> </span><span class="ffd">p+i<span class="_ _11"> </span></span>has<span class="_ _16"> </span>value<span class="_ _16"> </span><span class="ff11">x</span></div><div class="t m5 xb5 h6e y2a8a ffd fs25 fc1 sc0 ls0 ws0">p</div><div class="t m5 x1f3 h46 y2a8b ff12 fs19 fc1 sc0 ls0 ws0">+<span class="_ _10"> </span><span class="ff11">L</span></div><div class="t m5 x45 h45 y2a8c ff11 fs19 fc1 sc0 ls0 ws0">.</div><div class="t m5 x38 h26 y2a8b ff11 fs19 fc1 sc0 ls0 ws0">i<span class="_ _2"></span><span class="ff7">,</span></div><div class="t m5 x17 h26 y2a8d ff7 fs19 fc1 sc0 ls0 ws0">where<span class="_"> </span><span class="ff11">L<span class="_ _10"> </span></span>is<span class="_"> </span>the<span class="_"> </span>size<span class="_"> </span>of<span class="_"> </span>data<span class="_"> </span>type<span class="_"> </span><span class="ff11">T<span class="_ _13"> </span></span>.</div><div class="t m5 x26 h26 y2a8e ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _15"> </span>unary<span class="_ _14"> </span>operators<span class="_ _15"> </span>‘<span class="ffd">&amp;</span>’<span class="_ _15"> </span>and<span class="_ _14"> </span>‘<span class="ffd">*</span>’<span class="_ _15"> </span>allow<span class="_ _14"> </span>the<span class="_ _15"> </span>generation<span class="_ _14"> </span>and<span class="_ _15"> </span>dereferencing<span class="_ _15"> </span>of</div><div class="t m5 x17 h26 y2a8f ff7 fs19 fc1 sc0 ls0 ws0">pointers<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _3"></span>hat<span class="_"> </span>is<span class="_ _1"></span>,<span class="_"> </span>for<span class="_ _13"> </span>an<span class="_"> </span>expression<span class="_ _13"> </span><span class="ffa">Expr<span class="_"> </span></span>denoting<span class="_"> </span>some<span class="_ _13"> </span>object,<span class="_"> </span><span class="ffd">&amp;<span class="ffa">Expr<span class="_"> </span></span></span>is<span class="_"> </span>a<span class="_ _13"> </span>pointer</div><div class="t m5 x17 h26 y2a90 ff7 fs19 fc1 sc0 ls0 ws0">giving<span class="_ _16"> </span>the<span class="_ _16"> </span>address<span class="_ _16"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>object.<span class="_ _16"> </span>F<span class="_ _1"></span>or<span class="_ _16"> </span>an<span class="_ _16"> </span>expression<span class="_ _16"> </span><span class="ffa">AExpr<span class="_ _15"> </span></span>denoting<span class="_ _16"> </span>an<span class="_ _16"> </span>address<span class="_ _1"></span>,</div><div class="t m5 x17 h26 y2a91 ffd fs19 fc1 sc0 ls0 ws0">*<span class="ffa">AExpr<span class="_ _15"> </span><span class="ff7">gives<span class="_ _14"> </span>the<span class="_ _15"> </span>value<span class="_ _14"> </span>at<span class="_ _14"> </span>that<span class="_ _14"> </span>address<span class="_ _1"></span>.<span class="_ _15"> </span>T<span class="_ _1"></span>he<span class="_ _15"> </span>expressions<span class="_ _14"> </span><span class="ffa">Expr<span class="_ _15"> </span></span>and<span class="_ _15"> </span><span class="ffd">*&amp;<span class="ffa">Expr<span class="_ _15"> </span></span></span>are</span></span></div><div class="t m5 x17 h26 y2a92 ff7 fs19 fc1 sc0 ls0 ws0">therefore<span class="_ _15"> </span>equivalent.<span class="_ _15"> </span>The<span class="_ _14"> </span>array<span class="_ _21"> </span>subscripting<span class="_ _15"> </span>operation<span class="_ _21"> </span>can<span class="_ _15"> </span>be<span class="_ _21"> </span>applied<span class="_ _15"> </span>to<span class="_ _21"> </span>both</div><div class="t m5 x17 h26 y2a93 ff7 fs19 fc1 sc0 ls0 ws0">arrays<span class="_ _6"> </span>and<span class="_ _6"> </span>pointers<span class="_ _1"></span>.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_ _6"> </span>array<span class="_ _6"> </span>reference<span class="_ _13"> </span><span class="ffd">A[i]<span class="_ _a"> </span></span>is<span class="_ _6"> </span>identical<span class="_ _13"> </span>to<span class="_ _a"> </span>the<span class="_ _13"> </span>expression<span class="_ _a"> </span><span class="ffd">*(A+i)</span>.</div><div class="t m5 x17 h26 y2a94 ff7 fs19 fc1 sc0 ls0 ws0">It<span class="_ _11"> </span>computes<span class="_ _11"> </span>the<span class="_ _11"> </span>address<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span><span class="ff11">i<span class="_ _2"></span></span>th<span class="_ _11"> </span>array<span class="_ _11"> </span>element<span class="_ _11"> </span>and<span class="_ _16"> </span>then<span class="_"> </span>accesses<span class="_ _11"> </span>this<span class="_ _16"> </span>memory</div><div class="t m5 x17 h26 y2a95 ff7 fs19 fc1 sc0 ls0 ws0">location.</div><div class="t m5 x26 h26 y2a96 ff7 fs19 fc1 sc0 ls0 ws0">Expanding<span class="_ _14"> </span>on<span class="_ _14"> </span>our<span class="_ _14"> </span>earlier<span class="_ _15"> </span>example<span class="_ _1"></span>,<span class="_ _21"> </span>suppose<span class="_ _14"> </span>the<span class="_ _14"> </span>starting<span class="_ _15"> </span>address<span class="_ _14"> </span>of<span class="_ _14"> </span>integer</div><div class="t m5 x17 h26 y2a97 ff7 fs19 fc1 sc0 ls0 ws0">array<span class="_ _14"> </span><span class="ffd">E<span class="_ _14"> </span></span>and<span class="_ _14"> </span>integer<span class="_ _14"> </span>index<span class="_ _14"> </span><span class="ff11">i<span class="_ _f"> </span></span>are<span class="_ _14"> </span>stored<span class="_ _14"> </span>in<span class="_ _14"> </span>registers<span class="_ _15"> </span><span class="ffd">%rdx<span class="_ _14"> </span></span>and<span class="_ _14"> </span><span class="ffd">%rcx</span>,<span class="_ _15"> </span>respectively<span class="_ _3"></span>.</div><div class="t m5 x17 h26 y2a98 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _11"> </span>following<span class="_"> </span>are<span class="_"> </span>some<span class="_ _11"> </span>expressions<span class="_"> </span>involving<span class="_"> </span><span class="ffd">E</span>.<span class="_ _11"> </span>W<span class="_ _3"></span>e<span class="_ _11"> </span>also<span class="_"> </span>show<span class="_"> </span>an<span class="_ _11"> </span>assembly-code</div><div class="t m5 x17 h26 y2a99 ff7 fs19 fc1 sc0 ls0 ws0">implementation<span class="_"> </span>of<span class="_"> </span>each<span class="_ _13"> </span>expression,<span class="_"> </span>with<span class="_"> </span>the<span class="_"> </span>result<span class="_"> </span>being<span class="_"> </span>stored<span class="_ _13"> </span>in<span class="_"> </span>either<span class="_"> </span>register</div><div class="t m5 x17 h26 y2a9a ffd fs19 fc1 sc0 ls0 ws0">%eax<span class="_ _10"> </span><span class="ff7">(for<span class="_"> </span>data)<span class="_"> </span>or<span class="_"> </span>register<span class="_"> </span></span>%rax<span class="_ _10"> </span><span class="ff7">(for<span class="_"> </span>pointers).</span></div><div class="t m5 x17 h31 y2a9b ff7 fs21 fc2 sc0 ls0 ws0">Expression<span class="_ _26"> </span>T<span class="_ _7"></span>ype<span class="_ _8b"> </span>V<span class="_ _3"></span>alue<span class="_ _12e"> </span>Assembly<span class="_"> </span>code</div><div class="t m5 x17 h2d y2a9c ffd fs1e fc2 sc0 ls0 ws0">E<span class="_ _16d"> </span>int<span class="_ _11"> </span>*<span class="_ _26"> </span><span class="ff11 fs21">x</span></div><div class="t m5 x4d h6d y2a9d ffd fs2c fc2 sc0 ls0 ws0">E</div><div class="t m5 xe3 h2d y2a9c ffd fs1e fc2 sc0 ls0 ws0">movl<span class="_ _11"> </span>%rdx,%rax</div><div class="t m5 x17 h2d y2a9e ffd fs1e fc2 sc0 ls0 ws0">E[0]<span class="_ _53"> </span>int</div><div class="t m5 x145 h31 y2a9f ff6 fs21 fc2 sc0 ls0 ws0">M<span class="_ _1"></span><span class="ff7">[<span class="ff11">x</span></span></div><div class="t m5 x25 h6d y2aa0 ffd fs2c fc2 sc0 ls0 ws0">E</div><div class="t m5 x7c h31 y2a9f ff7 fs21 fc2 sc0 ls0 ws0">]<span class="_ _12e"> </span><span class="ffd fs1e">movl<span class="_ _11"> </span>(%rdx),%eax</span></div><div class="t m5 x17 h2d y2aa1 ffd fs1e fc2 sc0 ls0 ws0">E[i]<span class="_ _53"> </span>int</div><div class="t m5 x145 h31 y2aa2 ff6 fs21 fc2 sc0 ls0 ws0">M<span class="_ _1"></span><span class="ff7">[<span class="ff11">x</span></span></div><div class="t m5 x25 h6d y2aa3 ffd fs2c fc2 sc0 ls0 ws0">E</div><div class="t m5 x1a5 h32 y2aa2 ff12 fs21 fc2 sc0 ls0 ws0">+<span class="_ _13"> </span><span class="ff7">4<span class="ff11">i<span class="_ _2"></span></span>]<span class="_ _64"> </span><span class="ffd fs1e">movl<span class="_ _11"> </span>(%rdx,%rcx,4),%eax</span></span></div><div class="t m5 x17 h2d y2aa4 ffd fs1e fc2 sc0 ls0 ws0">&amp;E[2]<span class="_ _d0"> </span>int<span class="_ _11"> </span>*</div><div class="t m5 x145 h55 y2aa5 ff11 fs21 fc2 sc0 ls0 ws0">x</div><div class="t m5 x4d h6d y2aa6 ffd fs2c fc2 sc0 ls0 ws0">E</div><div class="t m5 x15e h32 y2aa5 ff12 fs21 fc2 sc0 ls0 ws0">+<span class="_ _13"> </span><span class="ff7">8<span class="_ _70"> </span><span class="ffd fs1e">leaq<span class="_ _10"> </span>8(%rdx),%rax</span></span></div><div class="t m5 x17 h2d y2aa7 ffd fs1e fc2 sc0 ls0 ws0">E+i-1<span class="_ _d0"> </span>int<span class="_ _11"> </span>*</div><div class="t m5 x145 h55 y2aa8 ff11 fs21 fc2 sc0 ls0 ws0">x</div><div class="t m5 x4d h6d y2aa9 ffd fs2c fc2 sc0 ls0 ws0">E</div><div class="t m5 x15e h32 y2aa8 ff12 fs21 fc2 sc0 ls0 ws0">+<span class="_ _13"> </span><span class="ff7">4<span class="ff11">i<span class="_ _10"> </span></span></span>−<span class="_ _10"> </span><span class="ff7">4<span class="_ _20"> </span><span class="ffd fs1e">leaq<span class="_ _11"> </span>-4(%rdx,%rcx,4),%rax</span></span></div><div class="t m5 x17 h2d y2aaa ffd fs1e fc2 sc0 ls0 ws0">*(E+i-3)<span class="_ _ab"> </span>int</div><div class="t m5 x145 h31 y2aab ff6 fs21 fc2 sc0 ls0 ws0">M<span class="_ _1"></span><span class="ff7">[<span class="ff11">x</span></span></div><div class="t m5 x25 h6d y2aac ffd fs2c fc2 sc0 ls0 ws0">E</div><div class="t m5 x1a5 h32 y2aab ff12 fs21 fc2 sc0 ls0 ws0">+<span class="_ _13"> </span><span class="ff7">4<span class="ff11">i<span class="_ _10"> </span></span></span>−<span class="_ _10"> </span><span class="ff7">12]<span class="_ _13c"> </span><span class="ffd fs1e">movl<span class="_ _11"> </span>-12(%rdx,%rcx,4),%eax</span></span></div><div class="t m5 x17 h2d y2aad ffd fs1e fc2 sc0 ls0 ws0">&amp;E[i]-E<span class="_ _2e"> </span>long</div><div class="t m5 x145 h2d y2aae ff11 fs21 fc2 sc0 ls0 ws0">i<span class="_ _15f"> </span><span class="ffd fs1e">movq<span class="_ _11"> </span>%rcx,%rax</span></div><div class="t m5 x26 h26 yc21 ff7 fs19 fc2 sc0 ls0 ws0">In<span class="_"> </span>these<span class="_ _11"> </span>examples<span class="_ _1"></span>,<span class="_ _11"> </span>we<span class="_"> </span>see<span class="_ _11"> </span>that<span class="_"> </span>operations<span class="_ _11"> </span>that<span class="_"> </span>return<span class="_ _11"> </span>array<span class="_ _11"> </span>values<span class="_"> </span>have<span class="_ _11"> </span>type</div><div class="t m5 x17 h26 yc22 ffd fs19 fc2 sc0 ls0 ws0">int<span class="ff7">,<span class="_ _14"> </span>and<span class="_ _16"> </span>hence<span class="_ _16"> </span>involve<span class="_ _14"> </span>4-byte<span class="_ _16"> </span>operations<span class="_ _16"> </span>(e.g<span class="_ _1"></span>.,<span class="_ _14"> </span><span class="ffd">movl</span>)<span class="_ _14"> </span>and<span class="_ _16"> </span>registers<span class="_ _16"> </span>(e.g<span class="_ _1"></span>.,<span class="_ _14"> </span><span class="ffd">%eax</span>).</span></div><div class="t m5 x17 h26 yc23 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>hose<span class="_ _11"> </span>that<span class="_"> </span>return<span class="_ _11"> </span>pointers<span class="_"> </span>have<span class="_ _11"> </span>type<span class="_"> </span><span class="ffd">int<span class="_ _16"> </span>*</span>,<span class="_"> </span>and<span class="_ _11"> </span>hence<span class="_"> </span>involve<span class="_ _11"> </span>8-byte<span class="_ _11"> </span>operations</div><div class="t m5 x17 h26 yc24 ff7 fs19 fc2 sc0 ls0 ws0">(e<span class="_ _1"></span>.g.,<span class="_ _e"> </span><span class="ffd">leaq</span>)<span class="_ _e"> </span>and<span class="_ _f"> </span>registers<span class="_ _e"> </span>(e<span class="_ _1"></span>.g.,<span class="_ _e"> </span><span class="ffd">%rax</span>).<span class="_ _f"> </span>The<span class="_ _f"> </span>ﬁnal<span class="_ _f"> </span>example<span class="_ _e"> </span>shows<span class="_ _f"> </span>that<span class="_ _e"> </span>one<span class="_ _f"> </span>can</div><div class="t m5 x17 h26 yc25 ff7 fs19 fc2 sc0 ls0 ws0">compute<span class="_ _11"> </span>the<span class="_ _16"> </span>difference<span class="_ _16"> </span>of<span class="_ _11"> </span>two<span class="_ _16"> </span>pointers<span class="_ _11"> </span>within<span class="_ _16"> </span>the<span class="_ _11"> </span>same<span class="_ _16"> </span>data<span class="_ _11"> </span>structure,<span class="_ _11"> </span>with<span class="_ _16"> </span>the</div><div class="t m5 x17 h26 yc26 ff7 fs19 fc2 sc0 ls0 ws0">result<span class="_ _16"> </span>being<span class="_ _11"> </span>data<span class="_ _16"> </span>having<span class="_ _16"> </span>type<span class="_ _16"> </span><span class="ffd">long<span class="_ _16"> </span></span>and<span class="_ _16"> </span>value<span class="_ _11"> </span>equal<span class="_ _16"> </span>to<span class="_ _16"> </span>the<span class="_ _16"> </span>difference<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>two</div><div class="t m5 x17 h26 y14b5 ff7 fs19 fc2 sc0 ls0 ws0">addresses<span class="_"> </span>divided<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span>size<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>data<span class="_"> </span>type<span class="_ _1"></span>.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
