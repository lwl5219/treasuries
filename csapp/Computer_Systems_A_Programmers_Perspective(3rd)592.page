<div id="pf250" class="pf w2 h11" data-page-no="250"><div class="pc pc250 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg250.png"/><div class="t m5 x187 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>5.12<span class="_ _60"> </span>Understanding<span class="_ _10"> </span>Memor<span class="_"> </span>y<span class="_ _10"> </span>Per<span class="_ _2"></span>formance<span class="_ _1b"> </span><span class="ffe fs1e">591</span></div><div class="t m5 x17 h26 ye7 ff7 fs19 fc2 sc0 ls0 ws0">a<span class="_ _14"> </span>CPE<span class="_ _14"> </span>of<span class="_ _15"> </span>4.00,<span class="_ _15"> </span>which<span class="_ _14"> </span>we<span class="_ _15"> </span>claim<span class="_ _14"> </span>is<span class="_ _14"> </span>a<span class="_ _15"> </span>direct<span class="_ _14"> </span>indication<span class="_ _14"> </span>of<span class="_ _15"> </span>the<span class="_ _14"> </span>latency<span class="_ _14"> </span>of<span class="_ _14"> </span>the<span class="_ _14"> </span>load</div><div class="t m5 x17 h26 y2a7 ff7 fs19 fc2 sc0 ls0 ws0">operation.<span class="_"> </span>T<span class="_ _7"></span>o<span class="_"> </span>see<span class="_"> </span>this<span class="_ _1"></span>,<span class="_"> </span>consider<span class="_"> </span>the<span class="_"> </span>assembly<span class="_"> </span>code<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>loop:</div><div class="t m5 x2e h61 y4fab ff13 fs35 fc6 sc0 ls0 ws0">Inner<span class="_ _f"> </span>loop<span class="_ _f"> </span>of<span class="_ _f"> </span>list_len</div><div class="t m5 x2e h61 y4fac ff13 fs35 fc6 sc0 ls0 ws0">ls<span class="_ _f"> </span>in<span class="_ _f"> </span>%rdi,<span class="_ _f"> </span>len<span class="_ _e"> </span>in<span class="_ _21"> </span>%rax</div><div class="t m5 x2c h2d y4fad ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">.L3:<span class="_ _12c"> </span></span><span class="ff2d fs35">loop:</span></div><div class="t m5 x2c h2d y4fae ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">addq<span class="_ _46"> </span>$1,<span class="_ _e"> </span>%rax<span class="_ _10d"> </span></span><span class="ff13 fs35">Increment<span class="_ _e"> </span>len</span></div><div class="t m5 x2c h2d y4faf ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">movq<span class="_ _46"> </span>(%rdi),<span class="_ _e"> </span>%rdi<span class="_ _3a"> </span></span><span class="ff13 fs35">ls<span class="_ _e"> </span>=<span class="_ _21"> </span>ls-&gt;next</span></div><div class="t m5 x2c h2d y4fb0 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">testq<span class="_ _3f"> </span>%rdi,<span class="_ _e"> </span>%rdi<span class="_ _6c"> </span></span><span class="ff13 fs35">Test<span class="_ _f"> </span>ls</span></div><div class="t m5 x2c h2d y4fb1 ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _45"> </span><span class="ffd fs1e fc2">jne<span class="_ _8c"> </span>.L3<span class="_ _29"> </span></span><span class="ff13 fs35">If<span class="_ _f"> </span>nonnull,<span class="_ _f"> </span>goto<span class="_ _e"> </span><span class="ff2d">loop</span></span></div><div class="t m5 x26 h26 y4fb2 ff7 fs19 fc2 sc0 lsd ws0">Th<span class="_ _2"></span>e<span class="_ _11"> </span><span class="ffd ls0">movq<span class="_ _10"> </span><span class="ff7">instruction<span class="_"> </span>on<span class="_"> </span>line<span class="_ _13"> </span>3<span class="_"> </span>forms<span class="_"> </span>the<span class="_"> </span>critical<span class="_ _13"> </span>bottleneck<span class="_"> </span>in<span class="_"> </span>this<span class="_"> </span>loop<span class="_ _1"></span>.<span class="_"> </span>Each</span></span></div><div class="t m5 x17 h26 y4fb3 ff7 fs19 fc2 sc0 ls0 ws0">successive<span class="_ _13"> </span>value<span class="_"> </span>of<span class="_ _13"> </span>register<span class="_"> </span><span class="ffd">%rdi<span class="_ _13"> </span></span>depends<span class="_ _13"> </span>on<span class="_"> </span>the<span class="_ _13"> </span>result<span class="_"> </span>of<span class="_ _13"> </span>a<span class="_ _13"> </span>load<span class="_"> </span>operation<span class="_ _13"> </span>having</div><div class="t m5 x17 h26 y4fb4 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>value<span class="_"> </span>in<span class="_"> </span><span class="ffd">%rdi<span class="_ _13"> </span></span>as<span class="_"> </span>its<span class="_"> </span>address<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _1"></span>hus<span class="_ _1"></span>,<span class="_"> </span>the<span class="_"> </span>load<span class="_"> </span>operation<span class="_"> </span>for<span class="_"> </span>one<span class="_ _13"> </span>iteration<span class="_"> </span>cannot</div><div class="t m5 x17 h26 y4fb5 ff7 fs19 fc2 sc0 ls0 ws0">begin<span class="_ _14"> </span>until<span class="_ _15"> </span>the<span class="_ _14"> </span>one<span class="_ _15"> </span>for<span class="_ _14"> </span>the<span class="_ _15"> </span>previous<span class="_ _14"> </span>iteration<span class="_ _14"> </span>has<span class="_ _15"> </span>completed.<span class="_ _14"> </span>The<span class="_ _14"> </span>CPE<span class="_ _14"> </span>of<span class="_ _14"> </span>4.00</div><div class="t m5 x17 h26 y4fb6 ff7 fs19 fc2 sc0 ls0 ws0">for<span class="_ _11"> </span>this<span class="_ _11"> </span>function<span class="_ _11"> </span>is<span class="_ _11"> </span>determined<span class="_ _11"> </span>by<span class="_ _11"> </span>the<span class="_ _16"> </span>latenc<span class="_ _0"></span>y<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>load<span class="_ _11"> </span>operation.<span class="_ _11"> </span>Indeed,<span class="_ _16"> </span>this</div><div class="t m5 x17 h26 y4fb7 ff7 fs19 fc2 sc0 ls0 ws0">measurement<span class="_ _11"> </span>matches<span class="_ _16"> </span>the<span class="_ _11"> </span>documented<span class="_ _16"> </span>access<span class="_ _16"> </span>time<span class="_ _11"> </span>of<span class="_ _16"> </span>4<span class="_ _11"> </span>cycles<span class="_ _11"> </span>for<span class="_ _16"> </span>the<span class="_ _11"> </span>reference</div><div class="t m5 x17 h26 y4fb8 ff7 fs19 fc2 sc0 ls0 ws0">machineâ€™s<span class="_"> </span>L1<span class="_"> </span>cache<span class="_ _1"></span>,<span class="_"> </span>as<span class="_"> </span>is<span class="_"> </span>discussed<span class="_"> </span>in<span class="_"> </span>Section<span class="_"> </span>6.4.</div><div class="t m5 x17 h41 y4fb9 ffe fs29 fc2 sc0 ls0 ws0">5.12.2<span class="_ _48"> </span><span class="fs19">Store<span class="_"> </span>Performance</span></div><div class="t m5 x17 h26 y4fba ff7 fs19 fc2 sc0 ls0 ws0">In<span class="_ _11"> </span>all<span class="_ _16"> </span>of<span class="_ _11"> </span>our<span class="_ _11"> </span>examples<span class="_ _16"> </span>thus<span class="_ _11"> </span>far,<span class="_ _11"> </span>we<span class="_ _11"> </span>analyzed<span class="_ _16"> </span>only<span class="_ _11"> </span>functions<span class="_ _16"> </span>that<span class="_ _11"> </span>reference<span class="_ _11"> </span>mem-</div><div class="t m5 x17 h26 y4fbb ff7 fs19 fc2 sc0 ls0 ws0">ory<span class="_"> </span>mostly<span class="_"> </span>with<span class="_ _11"> </span>load<span class="_"> </span>operations<span class="_ _1"></span>,<span class="_ _11"> </span>reading<span class="_ _11"> </span>from<span class="_"> </span>a<span class="_"> </span>memory<span class="_ _11"> </span>location<span class="_"> </span>into<span class="_ _11"> </span>a<span class="_"> </span>register.</div><div class="t m5 x17 h26 y4fbc ff7 fs19 fc2 sc0 ls0 ws0">Its<span class="_ _11"> </span>counterpart,<span class="_ _16"> </span>the<span class="_ _16"> </span><span class="ffa">store<span class="_ _16"> </span></span>operation,<span class="_ _16"> </span>writes<span class="_ _11"> </span>a<span class="_ _16"> </span>register<span class="_ _11"> </span>value<span class="_ _16"> </span>to<span class="_ _16"> </span>memory<span class="_ _7"></span>.<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _16"> </span>per<span class="_ _1"></span>-</div><div class="t m5 x17 h26 y4fbd ff7 fs19 fc2 sc0 ls0 ws0">formance<span class="_ _16"> </span>of<span class="_ _14"> </span>this<span class="_ _14"> </span>operation,<span class="_ _15"> </span>particularly<span class="_ _14"> </span>in<span class="_ _16"> </span>relation<span class="_ _14"> </span>to<span class="_ _14"> </span>its<span class="_ _14"> </span>interactions<span class="_ _14"> </span>with<span class="_ _14"> </span>load</div><div class="t m5 x17 h26 y4fbe ff7 fs19 fc2 sc0 ls0 ws0">operations<span class="_ _1"></span>,<span class="_"> </span>involves<span class="_"> </span>several<span class="_"> </span>subtle<span class="_"> </span>issues<span class="_ _1"></span>.</div><div class="t m5 x26 h26 y4fbf ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_ _13"> </span>with<span class="_ _13"> </span>the<span class="_ _13"> </span>load<span class="_ _13"> </span>operation,<span class="_ _13"> </span>in<span class="_ _13"> </span>most<span class="_ _13"> </span>cases<span class="_ _1"></span>,<span class="_ _13"> </span>the<span class="_ _13"> </span>store<span class="_ _13"> </span>operation<span class="_ _13"> </span>can<span class="_ _13"> </span>operate<span class="_ _13"> </span>in<span class="_ _13"> </span>a</div><div class="t m5 x17 h26 y4fc0 ff7 fs19 fc2 sc0 ls0 ws0">fully<span class="_ _13"> </span>pipelined<span class="_ _13"> </span>mode,<span class="_ _13"> </span>beginning<span class="_ _13"> </span>a<span class="_ _13"> </span>new<span class="_ _13"> </span>store<span class="_ _13"> </span>on<span class="_"> </span>every<span class="_ _13"> </span>c<span class="_ _1"></span>ycle.<span class="_ _13"> </span>F<span class="_ _1"></span>or<span class="_ _13"> </span>example<span class="_ _0"></span>,<span class="_ _13"> </span>consider</div><div class="t m5 x17 h26 y4fc1 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _13"> </span>function<span class="_ _13"> </span>shown<span class="_ _13"> </span>in<span class="_ _13"> </span>Figure<span class="_ _13"> </span>5.32<span class="_ _13"> </span>that<span class="_ _13"> </span>sets<span class="_ _13"> </span>the<span class="_ _13"> </span>elements<span class="_ _13"> </span>of<span class="_"> </span>an<span class="_ _13"> </span>array<span class="_ _13"> </span><span class="ffd">dest<span class="_ _13"> </span></span>of<span class="_ _13"> </span>length</div><div class="t m5 x17 h26 y4fc2 ffd fs19 fc2 sc0 ls0 ws0">n<span class="_ _11"> </span><span class="ff7">to<span class="_"> </span>zero.<span class="_"> </span>Our<span class="_ _11"> </span>measurements<span class="_ _11"> </span>show<span class="_"> </span>a<span class="_ _11"> </span>CPE<span class="_ _11"> </span>of<span class="_ _11"> </span>1.0.<span class="_ _11"> </span>This<span class="_"> </span>is<span class="_"> </span>the<span class="_ _11"> </span>best<span class="_ _11"> </span>we<span class="_ _11"> </span>can<span class="_ _11"> </span>achieve</span></div><div class="t m5 x17 h26 y4fc3 ff7 fs19 fc2 sc0 ls0 ws0">on<span class="_"> </span>a<span class="_"> </span>machine<span class="_"> </span>with<span class="_"> </span>a<span class="_"> </span>single<span class="_"> </span>store<span class="_"> </span>functional<span class="_"> </span>unit.</div><div class="t m5 x26 h26 y4fc4 ff7 fs19 fc2 sc0 ls0 ws0">Unlike<span class="_ _16"> </span>the<span class="_ _16"> </span>other<span class="_ _16"> </span>operations<span class="_ _16"> </span>we<span class="_ _16"> </span>have<span class="_ _16"> </span>considered<span class="_ _16"> </span>so<span class="_ _16"> </span>far,<span class="_ _16"> </span>the<span class="_ _16"> </span>store<span class="_ _16"> </span>operation</div><div class="t m5 x17 h26 y4fc5 ff7 fs19 fc2 sc0 ls0 ws0">does<span class="_ _16"> </span>not<span class="_ _14"> </span>affect<span class="_ _14"> </span>any<span class="_ _14"> </span>register<span class="_ _14"> </span>values<span class="_ _1"></span>.<span class="_ _14"> </span>T<span class="_ _1"></span>hus<span class="_ _1"></span>,<span class="_ _15"> </span>by<span class="_ _14"> </span>their<span class="_ _16"> </span>very<span class="_ _14"> </span>nature,<span class="_ _14"> </span>a<span class="_ _16"> </span>series<span class="_ _14"> </span>of<span class="_ _14"> </span>store</div><div class="t m5 x17 h26 y4fc6 ff7 fs19 fc2 sc0 ls0 ws0">operations<span class="_"> </span>cannot<span class="_ _13"> </span>create<span class="_"> </span>a<span class="_"> </span>data<span class="_"> </span>dependenc<span class="_ _1"></span>y<span class="_ _3"></span>.<span class="_"> </span>Only<span class="_"> </span>a<span class="_ _13"> </span>load<span class="_"> </span>operation<span class="_"> </span>is<span class="_ _13"> </span>affected<span class="_"> </span>by</div><div class="t m5 x17 h26 y4fc7 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_"> </span>result<span class="_"> </span>of<span class="_"> </span>a<span class="_ _13"> </span>store<span class="_"> </span>operation,<span class="_"> </span>since<span class="_"> </span>only<span class="_"> </span>a<span class="_"> </span>load<span class="_"> </span>can<span class="_"> </span>read<span class="_ _13"> </span>back<span class="_"> </span>the<span class="_"> </span>memory<span class="_"> </span>value</div><div class="t m5 x17 h26 y4fc8 ff7 fs19 fc2 sc0 ls0 ws0">that<span class="_ _13"> </span>has<span class="_"> </span>been<span class="_ _13"> </span>written<span class="_"> </span>by<span class="_ _13"> </span>the<span class="_"> </span>store<span class="_ _1"></span>.<span class="_ _13"> </span>The<span class="_ _13"> </span>function<span class="_"> </span><span class="ffd">write_read<span class="_ _13"> </span></span>shown<span class="_ _13"> </span>in<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>5.33</div><div class="t m5 x2c h2d y4fc9 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">/*<span class="_ _1f"> </span>Set<span class="_ _e"> </span>elements<span class="_ _1f"> </span>of<span class="_ _1f"> </span>array<span class="_ _e"> </span>to<span class="_ _1f"> </span>0<span class="_ _e"> </span>*/</span></div><div class="t m5 x2c h2d y4fca ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _1c"> </span><span class="ffd fs1e fc2">void<span class="_ _1f"> </span>clear_array(long<span class="_ _e"> </span>*dest,<span class="_ _1f"> </span>long<span class="_ _1f"> </span>n)<span class="_ _e"> </span>{</span></div><div class="t m5 x2c h2d y4fcb ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _20"> </span><span class="ffd fs1e fc2">long<span class="_ _e"> </span>i;</span></div><div class="t m5 x2c h2e y4fcc ff6 fs20 fc6 sc0 ls0 ws0">4</div><div class="t m5 x142 h2d y4fcd ffd fs1e fc2 sc0 ls33 ws0">f<span class="_ _41"></span>o<span class="_ _41"></span>r(<span class="_ _41"></span>i=0<span class="_ _41"></span>;i&lt;n<span class="_ _41"></span>;<span class="ls0">i++)</span></div><div class="t m5 x2c h2d y4fce ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _70"> </span><span class="ffd fs1e fc2">dest[i]<span class="_ _e"> </span>=<span class="_ _1f"> </span>0;</span></div><div class="t m5 x2c h2d y4fcf ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x17 h34 y126e ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>5.32<span class="_ _66"> </span><span class="fc1">Function<span class="_"> </span>to<span class="_"> </span>set<span class="_"> </span>array<span class="_"> </span>elements<span class="_"> </span>to<span class="_"> </span>0.<span class="_"> </span><span class="ff6">This<span class="_ _11"> </span>code<span class="_ _10"> </span>achieves<span class="_ _11"> </span>a<span class="_ _10"> </span>CPE<span class="_ _11"> </span>of<span class="_ _10"> </span>1.0.</span></span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
