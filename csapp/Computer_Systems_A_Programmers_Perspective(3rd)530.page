<div id="pf212" class="pf w2 h11" data-page-no="212"><div class="pc pc212 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg212.png"/><div class="t m5 x107 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Solutions<span class="_ _10"> </span>to<span class="_ _10"> </span>Practice<span class="_ _10"> </span>Problems<span class="_ _1b"> </span><span class="ffe fs1e">529</span></div><div class="t m5 x2c h2d ye7 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">#<span class="_ _1f"> </span>Test<span class="_ _e"> </span>instruction<span class="_ _1f"> </span>that<span class="_ _1f"> </span>modifies<span class="_ _e"> </span>%esp<span class="_ _1f"> </span>followed<span class="_ _e"> </span>by<span class="_ _1f"> </span>ret</span></div><div class="t m5 x2c h2d yc4d ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _70"> </span><span class="ffd fs1e fc2">irmovq<span class="_ _e"> </span>mem,%rbx</span></div><div class="t m5 x2c h2d yecb ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _70"> </span><span class="ffd fs1e fc2">mrmovq<span class="_ _1a"> </span>0(%rbx),%rsp<span class="_ _e"> </span>#<span class="_ _1f"> </span>Sets<span class="_ _1f"> </span>%rsp<span class="_ _e"> </span>to<span class="_ _1f"> </span>point<span class="_ _e"> </span>to<span class="_ _1f"> </span>return<span class="_ _1f"> </span>point</span></div><div class="t m5 x2c h2d yecc ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _70"> </span><span class="ffd fs1e fc2">ret<span class="_ _137"> </span>#<span class="_ _1f"> </span>Returns<span class="_ _e"> </span>to<span class="_ _1f"> </span>return<span class="_ _1f"> </span>point</span></div><div class="t m5 x2c h2d yecd ff6 fs20 fc6 sc0 ls0 ws0">5<span class="_ _70"> </span><span class="ffd fs1e fc2">halt<span class="_ _15a"> </span>#</span></div><div class="t m5 x2c h2d yece ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _1c"> </span><span class="ffd fs1e fc2">rtnpt:<span class="_ _1a"> </span>irmovq<span class="_ _1f"> </span>$5,%rsi<span class="_ _6f"> </span>#<span class="_ _e"> </span>Return<span class="_ _1f"> </span>point</span></div><div class="t m5 x2c h2d yecf ff6 fs20 fc6 sc0 ls0 ws0">7<span class="_ _70"> </span><span class="ffd fs1e fc2">halt</span></div><div class="t m5 x2c h2d yed0 ff6 fs20 fc6 sc0 ls0 ws0">8<span class="_ _1c"> </span><span class="ffd fs1e fc2">.pos<span class="_ _1f"> </span>0x40</span></div><div class="t m5 x2c h2e y20fe ff6 fs20 fc6 sc0 ls0 ws0">9</div><div class="t m5 x2d h2d y1a10 ffd fs1e fc2 sc0 ls0 ws0">mem:<span class="_ _46"> </span>.quad<span class="_ _e"> </span>stack<span class="_ _86"> </span>#<span class="_ _1f"> </span>Holds<span class="_ _1f"> </span>desired<span class="_ _e"> </span>stack<span class="_ _1f"> </span>pointer</div><div class="t m5 x17 h2d yed3 ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _1c"> </span><span class="ffd fs1e fc2">.pos<span class="_ _1f"> </span>0x50</span></div><div class="t m5 x17 h2d yed4 ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _1c"> </span><span class="ffd fs1e fc2">stack:<span class="_ _1a"> </span>.quad<span class="_ _1f"> </span>rtnpt<span class="_ _86"> </span>#<span class="_ _e"> </span>Top<span class="_ _1f"> </span>of<span class="_ _e"> </span>stack:<span class="_ _1f"> </span>Holds<span class="_ _1f"> </span>return<span class="_ _e"> </span>point</span></div><div class="t m5 x26 h26 y4951 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _13"> </span>program<span class="_ _13"> </span>uses<span class="_ _13"> </span>two<span class="_ _6"> </span>initialized<span class="_ _13"> </span>words<span class="_ _13"> </span>in<span class="_ _6"> </span>memory<span class="_ _3"></span>.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_ _13"> </span>ﬁrst<span class="_ _13"> </span>word<span class="_ _6"> </span>(<span class="ffd">mem</span>)<span class="_ _13"> </span>holds</div><div class="t m5 x17 h26 y4952 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _16"> </span>address<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>second<span class="_ _11"> </span>(<span class="ffd">stack</span>—the<span class="_ _16"> </span>desired<span class="_ _16"> </span>stack<span class="_ _16"> </span>pointer).<span class="_ _11"> </span>The<span class="_ _11"> </span>second<span class="_ _16"> </span>word</div><div class="t m5 x17 h26 y4953 ff7 fs19 fc2 sc0 ls0 ws0">holds<span class="_ _13"> </span>the<span class="_"> </span>address<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>desired<span class="_"> </span>return<span class="_ _13"> </span>point<span class="_ _13"> </span>for<span class="_"> </span>the<span class="_ _13"> </span><span class="ffd">ret<span class="_ _13"> </span></span>instruction.<span class="_ _13"> </span>The<span class="_ _13"> </span>program</div><div class="t m5 x17 h26 y4954 ff7 fs19 fc2 sc0 ls0 ws0">loads<span class="_"> </span>the<span class="_"> </span>stack<span class="_"> </span>pointer<span class="_"> </span>into<span class="_"> </span><span class="ffd">%rsp<span class="_ _10"> </span></span>and<span class="_"> </span>executes<span class="_"> </span>the<span class="_"> </span><span class="ffd">ret<span class="_ _10"> </span></span>instruction.</div><div class="t m5 x17 h28 yeaf ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>4.39<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>499)</span></div><div class="t m5 x17 h26 yeb1 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>rom<span class="_ _13"> </span>F<span class="_ _0"></span>igure<span class="_ _13"> </span>4.66,<span class="_ _13"> </span>we<span class="_ _6"> </span>can<span class="_ _13"> </span>see<span class="_ _13"> </span>that<span class="_ _13"> </span>pipeline<span class="_ _6"> </span>register<span class="_ _13"> </span>D<span class="_ _13"> </span>must<span class="_ _13"> </span>be<span class="_ _6"> </span>stalled<span class="_ _13"> </span>for<span class="_ _13"> </span>a<span class="_ _13"> </span>load/use</div><div class="t m5 x17 h26 y4955 ff7 fs19 fc1 sc0 ls0 ws0">hazard:</div><div class="t m5 x17 h2d y4956 ffd fs1e fc2 sc0 ls0 ws0">bool<span class="_ _e"> </span>D_stall<span class="_ _1f"> </span>=</div><div class="t m5 x21e h2d y4957 ffd fs1e fc2 sc0 ls0 ws0">#<span class="_ _e"> </span>Conditions<span class="_ _1f"> </span>for<span class="_ _1f"> </span>a<span class="_ _e"> </span>load/use<span class="_ _1f"> </span>hazard</div><div class="t m5 x21e h2d y4958 ffd fs1e fc2 sc0 ls0 ws0">E_icode<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _1f"> </span>IMRMOVQ,<span class="_ _e"> </span>IPOPQ<span class="_ _1f"> </span>}<span class="_ _e"> </span>&amp;&amp;</div><div class="t m5 x12 h2d y4959 ffd fs1e fc2 sc0 ls0 ws0">E_dstM<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _1f"> </span>d_srcA,<span class="_ _e"> </span>d_srcB<span class="_ _1f"> </span>};</div><div class="t m5 x17 h28 y495a ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>4.40</div><div class="t m5 x112 h2f y256a ffe fs16 fc6 sc0 ls0 ws0">(page<span class="_"> </span>500)</div><div class="t m5 x17 h26 y47f6 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>rom<span class="_ _11"> </span>F<span class="_ _0"></span>igure<span class="_"> </span>4.66,<span class="_ _11"> </span>we<span class="_ _11"> </span>can<span class="_"> </span>see<span class="_ _11"> </span>that<span class="_"> </span>pipeline<span class="_ _11"> </span>register<span class="_ _11"> </span>E<span class="_"> </span>must<span class="_ _11"> </span>be<span class="_"> </span>set<span class="_ _11"> </span>to<span class="_ _11"> </span>bubble<span class="_"> </span>for<span class="_ _11"> </span>a</div><div class="t m5 x17 h26 y48e2 ff7 fs19 fc1 sc0 ls0 ws0">load/use<span class="_"> </span>hazard<span class="_"> </span>or<span class="_"> </span>for<span class="_"> </span>a<span class="_"> </span>mispredicted<span class="_"> </span>branch:</div><div class="t m5 x17 h2d y495b ffd fs1e fc2 sc0 ls0 ws0">bool<span class="_ _e"> </span>E_bubble<span class="_ _1f"> </span>=</div><div class="t m5 x21e h2d y495c ffd fs1e fc2 sc0 ls0 ws0">#<span class="_ _e"> </span>Mispredicted<span class="_ _1f"> </span>branch</div><div class="t m5 x21e h2d y495d ffd fs1e fc2 sc0 ls0 ws0">(E_icode<span class="_ _e"> </span>==<span class="_ _1f"> </span>IJXX<span class="_ _1f"> </span>&amp;&amp;<span class="_ _e"> </span>!e_Cnd)<span class="_ _1f"> </span>||</div><div class="t m5 x21e h2d y495e ffd fs1e fc2 sc0 ls0 ws0">#<span class="_ _e"> </span>Conditions<span class="_ _1f"> </span>for<span class="_ _1f"> </span>a<span class="_ _e"> </span>load/use<span class="_ _1f"> </span>hazard</div><div class="t m5 x21e h2d y495f ffd fs1e fc2 sc0 ls0 ws0">E_icode<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _1f"> </span>IMRMOVQ,<span class="_ _e"> </span>IPOPQ<span class="_ _1f"> </span>}<span class="_ _e"> </span>&amp;&amp;</div><div class="t m5 x12 h2d y4960 ffd fs1e fc2 sc0 ls0 ws0">E_dstM<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _1f"> </span>d_srcA,<span class="_ _e"> </span>d_srcB};</div><div class="t m5 x17 h28 y4961 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>4.41</div><div class="t m5 x112 h2f y22c ffe fs16 fc6 sc0 ls0 ws0">(page<span class="_"> </span>500)</div><div class="t m5 x17 h26 y53d ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _13"> </span>control<span class="_ _a"> </span>requires<span class="_ _13"> </span>examining<span class="_ _a"> </span>the<span class="_ _13"> </span>code<span class="_ _a"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>executing<span class="_ _a"> </span>instruction<span class="_ _13"> </span>and<span class="_ _a"> </span>checking</div><div class="t m5 x17 h26 y53e ff7 fs19 fc1 sc0 ls0 ws0">for<span class="_"> </span>exceptions<span class="_"> </span>further<span class="_"> </span>down<span class="_"> </span>the<span class="_"> </span>pipeline<span class="_ _1"></span>.</div><div class="t m5 x17 h2d y2269 ffd fs1e fc2 sc0 ls0 ws0">##<span class="_ _e"> </span>Should<span class="_ _1f"> </span>the<span class="_ _1f"> </span>condition<span class="_ _e"> </span>codes<span class="_ _1f"> </span>be<span class="_ _e"> </span>updated?</div><div class="t m5 x17 h2d y226a ffd fs1e fc2 sc0 ls0 ws0">bool<span class="_ _e"> </span>set_cc<span class="_ _1f"> </span>=<span class="_ _1f"> </span>E_icode<span class="_ _e"> </span>==<span class="_ _1f"> </span>IOPQ<span class="_ _e"> </span>&amp;&amp;</div><div class="t m5 x188 h2d y4962 ffd fs1e fc2 sc0 ls0 ws0">#<span class="_ _e"> </span>State<span class="_ _1f"> </span>changes<span class="_ _1f"> </span>only<span class="_ _e"> </span>during<span class="_ _1f"> </span>normal<span class="_ _e"> </span>operation</div><div class="t m5 x188 h2d y4963 ffd fs1e fc2 sc0 ls0 ws0">!m_stat<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _1f"> </span>SADR,<span class="_ _e"> </span>SINS,<span class="_ _1f"> </span>SHLT<span class="_ _e"> </span>}<span class="_ _1f"> </span>&amp;&amp;<span class="_ _1f"> </span>!W_stat<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _e"> </span>SADR,<span class="_ _1f"> </span>SINS,<span class="_ _1f"> </span>SHLT<span class="_ _e"> </span>};</div><div class="t m5 x17 h28 y4964 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>4.42</div><div class="t m5 x112 h2f y4965 ffe fs16 fc6 sc0 ls0 ws0">(page<span class="_"> </span>500)</div><div class="t m5 x17 h26 y77e ff7 fs19 fc1 sc0 ls0 ws0">Injecting<span class="_"> </span>a<span class="_"> </span>bubble<span class="_"> </span>into<span class="_"> </span>the<span class="_"> </span>memory<span class="_ _11"> </span>stage<span class="_"> </span>on<span class="_"> </span>the<span class="_"> </span>next<span class="_"> </span>cycle<span class="_"> </span>involves<span class="_"> </span>checking<span class="_"> </span>for</div><div class="t m5 x17 h26 y77f ff7 fs19 fc1 sc0 ls0 ws0">an<span class="_ _6"> </span>exception<span class="_ _13"> </span>in<span class="_ _6"> </span>either<span class="_ _13"> </span>the<span class="_ _6"> </span>memory<span class="_ _6"> </span>or<span class="_ _13"> </span>the<span class="_ _6"> </span>write-back<span class="_ _13"> </span>stage<span class="_ _a"> </span>during<span class="_ _13"> </span>the<span class="_ _6"> </span>current<span class="_ _13"> </span>c<span class="_ _1"></span>ycle.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
