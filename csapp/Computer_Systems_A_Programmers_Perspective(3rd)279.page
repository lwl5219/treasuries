<div id="pf117" class="pf w2 h11" data-page-no="117"><div class="pc pc117 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg117.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">278<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>3<span class="_ _3d"> </span>Machine-Level<span class="_ _10"> </span>Representation<span class="_ _10"> </span>of<span class="_ _10"> </span>Programs</span></div><div class="t m5 xc8 h40 y294a ff22 fs28 fc1 sc0 ls0 ws0">%rip</div><div class="t m5 xc8 h40 y294b ff22 fs28 fc1 sc0 ls0 ws0">%rsp</div><div class="t m5 x12 h40 y294a ff22 fs28 fc1 sc0 ls0 ws0">0x400563</div><div class="t m5 x1a4 h40 y294b ff22 fs28 fc1 sc0 ls0 ws0">0x7fffffffe840</div><div class="t m5 x14 h40 y294c ff26 fs27 fc1 sc0 ls0 ws0">(a) Executing <span class="ff22 fs28">call</span></div><div class="t m5 x20 h40 y294a ff22 fs28 fc1 sc0 ls0 ws0">%rip</div><div class="t m5 x20 h40 y294b ff22 fs28 fc1 sc0 ls0 ws0">%rsp</div><div class="t m5 xa8 h40 y294a ff22 fs28 fc1 sc0 ls0 ws0">0x400540</div><div class="t m5 xa5 h40 y294b ff22 fs28 fc1 sc0 ls0 ws0">0x7fffffffe838</div><div class="t m5 x90 h40 y294d ff22 fs28 fc1 sc0 ls0 ws0">0x400568</div><div class="t m5 x1b7 h40 y294c ff26 fs27 fc1 sc0 ls0 ws5">(b) After <span class="_ _2"></span><span class="ff22 fs28 ws0">call</span></div><div class="t m5 xdf h40 y294a ff22 fs28 fc1 sc0 ls0 ws0">%rip</div><div class="t m5 xdf h40 y294b ff22 fs28 fc1 sc0 ls0 ws0">%rsp</div><div class="t m5 x111 h40 y294a ff22 fs28 fc1 sc0 ls0 ws0">0x400568</div><div class="t m5 x1c3 h40 y294b ff22 fs28 fc1 sc0 ls0 ws0">0x7fffffffe840</div><div class="t m5 x12e h40 y294c ff26 fs27 fc1 sc0 ls0 ws7">(c) After <span class="_ _2"></span><span class="ff22 fs28 ws0">ret</span></div><div class="t m5 x14 h3a y294e ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>3.26<span class="_ _66"> </span><span class="fc1">Illustration<span class="_"> </span>of<span class="_"> </span><span class="ffd fs19">call<span class="_ _10"> </span></span>and<span class="_"> </span><span class="ffd fs19">ret<span class="_ _10"> </span></span>functions.<span class="_"> </span><span class="ff6">The<span class="_ _10"> </span><span class="ffd fs19">call<span class="_ _10"> </span></span>instruction<span class="_ _10"> </span>transfers<span class="_ _10"> </span>control<span class="_ _11"> </span>to<span class="_ _10"> </span>the<span class="_ _10"> </span>start<span class="_ _10"> </span>of<span class="_ _10"> </span>a</span></span></div><div class="t m5 x14 h34 y294f ff6 fs16 fc1 sc0 ls0 ws0">function,<span class="_ _10"> </span>while<span class="_ _11"> </span>the</div><div class="t m5 x74 h3a y2950 ffd fs19 fc1 sc0 ls0 ws0">ret<span class="_ _10"> </span><span class="ff6 fs16">instruction<span class="_ _11"> </span>returns<span class="_ _10"> </span>back<span class="_ _10"> </span>to<span class="_ _11"> </span>the<span class="_ _10"> </span>instruction<span class="_ _11"> </span>following<span class="_ _10"> </span>the<span class="_ _11"> </span>call.</span></div><div class="t m5 x29 h26 y2951 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _11"> </span>3.26<span class="_ _11"> </span>illustrates<span class="_ _11"> </span>the<span class="_ _11"> </span>execution<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span><span class="ffd">call<span class="_ _10"> </span></span>and<span class="_ _11"> </span><span class="ffd">ret<span class="_ _11"> </span></span>instructions<span class="_ _11"> </span>for<span class="_ _11"> </span>the</div><div class="t m5 x1d h26 y2952 ffd fs19 fc1 sc0 ls0 ws0">multstore<span class="_ _21"> </span><span class="ff7">and<span class="_ _f"> </span></span>main<span class="_ _f"> </span><span class="ff7">functions<span class="_ _f"> </span>introduced<span class="_ _f"> </span>in<span class="_ _21"> </span>Section<span class="_ _f"> </span>3.2.2.<span class="_ _f"> </span>T<span class="_ _0"></span>he<span class="_ _21"> </span>following<span class="_ _f"> </span>are</span></div><div class="t m5 x1d h26 y2953 ff7 fs19 fc1 sc0 ls0 ws0">excerpts<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>disassembled<span class="_"> </span>code<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>two<span class="_"> </span>functions:</div><div class="t m5 x134 h61 y2954 ff13 fs35 fc6 sc0 ls0 ws0">Beginning<span class="_ _f"> </span>of<span class="_ _f"> </span>function<span class="_ _f"> </span>multstore</div><div class="t m5 x1f h2d y2955 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs1e fc2">0000000000400540<span class="_ _1f"> </span>&lt;multstore&gt;:</span></div><div class="t m5 x1f h2d y2956 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _45"> </span><span class="ffd fs1e fc2">400540:<span class="_ _1a"> </span>53<span class="_ _129"> </span>push<span class="_ _3f"> </span>%rbx</span></div><div class="t m5 x1f h2d y2957 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _45"> </span><span class="ffd fs1e fc2">400541:<span class="_ _1a"> </span>48<span class="_ _e"> </span>89<span class="_ _1f"> </span>d3<span class="_ _12a"> </span>mov<span class="_ _7b"> </span>%rdx,%rbx</span></div><div class="t m5 x134 h61 y2958 ff13 fs35 fc6 sc0 ls156 ws0">...</div><div class="t m5 x134 h61 y2959 ff13 fs35 fc6 sc0 ls0 ws0">Return<span class="_ _f"> </span>from<span class="_ _f"> </span>function<span class="_ _f"> </span>multstore</div><div class="t m5 x1f h2d y295a ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _45"> </span><span class="ffd fs1e fc2">40054d:<span class="_ _1a"> </span>c3<span class="_ _129"> </span>retq</span></div><div class="t m5 x134 h61 y295b ff13 fs35 fc6 sc0 ls156 ws0">...</div><div class="t m5 x134 h61 y295c ff13 fs35 fc6 sc0 ls0 ws0">Call<span class="_ _f"> </span>to<span class="_ _f"> </span>multstore<span class="_ _f"> </span>from<span class="_ _e"> </span>main</div><div class="t m5 x1f h2e y295d ff6 fs20 fc6 sc0 ls0 ws0">5</div><div class="t m5 x10d h2d y295e ffd fs1e fc2 sc0 ls0 ws0">400563:<span class="_ _1a"> </span>e8<span class="_ _e"> </span>d8<span class="_ _1f"> </span>ff<span class="_ _1f"> </span>ff<span class="_ _e"> </span>ff<span class="_ _86"> </span>callq<span class="_ _1a"> </span>400540<span class="_ _1f"> </span>&lt;multstore&gt;</div><div class="t m5 x1f h2d y295f ff6 fs20 fc6 sc0 ls0 ws0">6<span class="_ _45"> </span><span class="ffd fs1e fc2">400568:<span class="_ _1a"> </span>48<span class="_ _e"> </span>8b<span class="_ _1f"> </span>54<span class="_ _1f"> </span>24<span class="_ _e"> </span>08<span class="_ _86"> </span>mov<span class="_ _46"> </span>0x8(%rsp),%rdx</span></div><div class="t m5 x29 h26 y21f4 ff7 fs19 fc2 sc0 ls0 ws0">In<span class="_ _16"> </span>this<span class="_ _16"> </span>code<span class="_ _1"></span>,<span class="_ _16"> </span>we<span class="_ _16"> </span>can<span class="_ _16"> </span>see<span class="_ _16"> </span>that<span class="_ _16"> </span>the<span class="_ _16"> </span><span class="ffd">call<span class="_ _16"> </span></span>instruction<span class="_ _11"> </span>with<span class="_ _16"> </span>address<span class="_ _16"> </span><span class="ffd">0x400563<span class="_ _16"> </span></span>in</div><div class="t m5 x1d h26 y21f5 ffd fs19 fc2 sc0 ls0 ws0">main<span class="_ _14"> </span><span class="ff7">calls<span class="_ _14"> </span>function<span class="_ _14"> </span></span>multstore<span class="ff7">.<span class="_ _14"> </span>This<span class="_ _16"> </span>status<span class="_ _15"> </span>is<span class="_ _14"> </span>shown<span class="_ _14"> </span>in<span class="_ _14"> </span>Figure<span class="_ _16"> </span>3.26(a),<span class="_ _15"> </span>with<span class="_ _14"> </span>the</span></div><div class="t m5 x1d h26 y21f6 ff7 fs19 fc2 sc0 ls0 ws0">indicated<span class="_ _16"> </span>values<span class="_ _16"> </span>for<span class="_ _16"> </span>the<span class="_ _16"> </span>stack<span class="_ _16"> </span>pointer<span class="_ _16"> </span><span class="ffd">%rsp<span class="_ _14"> </span></span>and<span class="_ _16"> </span>the<span class="_ _16"> </span>program<span class="_ _16"> </span>counter<span class="_ _16"> </span><span class="ffd">%rip</span><span class="ls16c">.T<span class="_ _42"></span>h<span class="_ _42"></span>e</span></div><div class="t m5 x1d h26 y21f7 ff7 fs19 fc2 sc0 ls0 ws0">effect<span class="_ _6"> </span>of<span class="_ _6"> </span>the<span class="_ _6"> </span><span class="ffd">call<span class="_ _6"> </span></span>is<span class="_ _6"> </span>to<span class="_ _6"> </span>push<span class="_ _6"> </span>the<span class="_ _6"> </span>return<span class="_ _6"> </span>address<span class="_ _6"> </span><span class="ffd">0x400568<span class="_ _6"> </span></span>onto<span class="_ _6"> </span>the<span class="_ _6"> </span>stack<span class="_ _6"> </span>and<span class="_ _6"> </span>to<span class="_ _6"> </span>jump</div><div class="t m5 x1d h26 y21f8 ff7 fs19 fc2 sc0 ls0 ws0">to<span class="_ _15"> </span>the<span class="_ _15"> </span>ﬁrst<span class="_ _15"> </span>instruction<span class="_ _15"> </span>in<span class="_ _15"> </span>function<span class="_ _15"> </span><span class="ffd">multstore</span>,<span class="_ _f"> </span>at<span class="_ _15"> </span>address<span class="_ _15"> </span><span class="ffd">0x0400540<span class="_ _15"> </span></span>(3.26(b)).</div><div class="t m5 x1d h26 y21f9 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _14"> </span>execution<span class="_ _14"> </span>of<span class="_ _16"> </span>function<span class="_ _14"> </span><span class="ffd">multstore<span class="_ _14"> </span></span>continues<span class="_ _14"> </span>until<span class="_ _16"> </span>it<span class="_ _14"> </span>hits<span class="_ _14"> </span>the<span class="_ _16"> </span><span class="ffd">ret<span class="_ _14"> </span></span>instruction</div><div class="t m5 x1d h26 y2214 ff7 fs19 fc2 sc0 ls0 ws0">at<span class="_ _14"> </span>address<span class="_ _15"> </span><span class="ffd">0x40054d</span>.<span class="_ _15"> </span>T<span class="_ _1"></span>his<span class="_ _15"> </span>instruction<span class="_ _15"> </span>pops<span class="_ _14"> </span>the<span class="_ _15"> </span>value<span class="_ _15"> </span><span class="ffd">0x400568<span class="_ _14"> </span></span>from<span class="_ _15"> </span>the<span class="_ _15"> </span>stack</div><div class="t m5 x1d h26 y2215 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_ _15"> </span>jumps<span class="_ _15"> </span>to<span class="_ _15"> </span>this<span class="_ _15"> </span>address<span class="_ _1"></span>,<span class="_ _f"> </span>resuming<span class="_ _15"> </span>the<span class="_ _15"> </span>execution<span class="_ _15"> </span>of<span class="_ _15"> </span><span class="ffd">main<span class="_ _21"> </span></span>just<span class="_ _15"> </span>after<span class="_ _15"> </span>the<span class="_ _15"> </span><span class="ffd">call</span></div><div class="t m5 x1d h26 y2216 ff7 fs19 fc2 sc0 ls0 ws0">instruction<span class="_"> </span>(3.26(c)).</div><div class="t m5 x29 h26 y2217 ff7 fs19 fc2 sc0 ls0 ws0">As<span class="_ _13"> </span>a<span class="_ _6"> </span>more<span class="_ _13"> </span>detailed<span class="_ _13"> </span>example<span class="_ _6"> </span>of<span class="_ _13"> </span>passing<span class="_ _13"> </span>control<span class="_ _6"> </span>to<span class="_ _13"> </span>and<span class="_ _13"> </span>from<span class="_ _6"> </span>procedures<span class="_ _1"></span>,<span class="_ _13"> </span>Figure</div><div class="t m5 x1d h26 y2218 ff7 fs19 fc2 sc0 ls0 ws0">3.27(a)<span class="_ _11"> </span>shows<span class="_ _16"> </span>the<span class="_ _11"> </span>disassembled<span class="_ _11"> </span>code<span class="_ _16"> </span>for<span class="_ _11"> </span>two<span class="_ _16"> </span>functions<span class="_ _1"></span>,<span class="_ _11"> </span><span class="ffd">top<span class="_ _16"> </span></span>and<span class="_ _11"> </span><span class="ffd">leaf</span>,<span class="_ _16"> </span>as<span class="_ _11"> </span>well<span class="_ _16"> </span>as</div><div class="t m5 x1d h26 y2219 ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _16"> </span>portion<span class="_ _14"> </span>of<span class="_ _14"> </span>code<span class="_ _16"> </span>in<span class="_ _14"> </span>function<span class="_ _14"> </span><span class="ffd">main<span class="_ _14"> </span></span>where<span class="_ _16"> </span><span class="ffd">top<span class="_ _14"> </span></span>gets<span class="_ _14"> </span>called.<span class="_ _16"> </span>Each<span class="_ _14"> </span>instruction<span class="_ _14"> </span>is</div><div class="t m5 x1d h26 y221a ff7 fs19 fc2 sc0 ls0 ws0">identiﬁed<span class="_ _11"> </span>by<span class="_ _11"> </span>labels<span class="_ _11"> </span><span class="ffd">L1</span>–<span class="ffd">L2<span class="_ _11"> </span></span>(in<span class="_ _16"> </span><span class="ffd">leaf</span>),<span class="_ _11"> </span><span class="ffd">T1</span>–<span class="ffd">T4<span class="_ _11"> </span></span>(in<span class="_ _11"> </span><span class="ffd">top</span>),<span class="_ _16"> </span>and<span class="_"> </span><span class="ffd">M1</span>–<span class="ffd">M2<span class="_ _16"> </span></span>in<span class="_"> </span><span class="ffd">main</span>.<span class="_ _16"> </span>Part<span class="_"> </span>(b)</div><div class="t m5 x1d h26 y221b ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_ _14"> </span>the<span class="_ _15"> </span>ﬁgure<span class="_ _14"> </span>shows<span class="_ _15"> </span>a<span class="_ _14"> </span>detailed<span class="_ _15"> </span>trace<span class="_ _14"> </span>of<span class="_ _14"> </span>the<span class="_ _15"> </span>code<span class="_ _14"> </span>execution,<span class="_ _21"> </span>in<span class="_ _14"> </span>which<span class="_ _15"> </span><span class="ffd">main<span class="_ _14"> </span></span>calls</div><div class="t m5 x1d h26 y221c ffd fs19 fc2 sc0 ls0 ws0">top(100)<span class="ff7">,<span class="_ _11"> </span>causing<span class="_ _11"> </span></span>top<span class="_ _11"> </span><span class="ff7">to<span class="_ _11"> </span>call<span class="_ _11"> </span></span>leaf(95)<span class="ff7">.<span class="_ _11"> </span>Function<span class="_ _11"> </span></span>leaf<span class="_ _11"> </span><span class="ff7">returns<span class="_ _11"> </span>97<span class="_ _11"> </span>to<span class="_ _11"> </span></span>top<span class="ff7">,<span class="_ _16"> </span>which</span></div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
