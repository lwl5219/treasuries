<div id="pf265" class="pf w2 h11" data-page-no="265"><div class="pc pc265 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg265.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">612<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>5<span class="_ _3d"> </span>Optimizing<span class="_ _10"> </span>Program<span class="_ _10"> </span>Performance</span></div><div class="t m5 x1f h2d ye7 ff6 fs20 fc6 sc0 ls0 ws0">9<span class="_ _20"> </span><span class="ffd fs1e fc2">/*<span class="_ _e"> </span>Combine<span class="_ _1f"> </span>5<span class="_ _1f"> </span>elements<span class="_ _e"> </span>at<span class="_ _1f"> </span>a<span class="_ _e"> </span>time<span class="_ _1f"> </span>*/</span></div><div class="t m5 x1b0 h2d yc4d ff6 fs20 fc6 sc0 ls0 ws0">10<span class="_ _20"> </span><span class="ffd fs1e fc2">for<span class="_ _e"> </span>(i<span class="_ _1f"> </span>=<span class="_ _1f"> </span>0;<span class="_ _e"> </span>i<span class="_ _1f"> </span>&lt;<span class="_ _e"> </span>limit;<span class="_ _1f"> </span>i+=5)<span class="_ _1f"> </span>{</span></div><div class="t m5 x1b0 h2d yecb ff6 fs20 fc6 sc0 ls0 ws0">11<span class="_ _70"> </span><span class="ffd fs1e fc2">acc<span class="_ _e"> </span>=<span class="_ _1f"> </span>acc<span class="_ _1f"> </span>OP<span class="_ _e"> </span>data[i]<span class="_ _3f"> </span>OP<span class="_ _1f"> </span>data[i+1];</span></div><div class="t m5 x1b0 h2d yecc ff6 fs20 fc6 sc0 ls0 ws0">12<span class="_ _70"> </span><span class="ffd fs1e fc2">acc<span class="_ _e"> </span>=<span class="_ _1f"> </span>acc<span class="_ _1f"> </span>OP<span class="_ _e"> </span>data[i+2]<span class="_ _1f"> </span>OP<span class="_ _e"> </span>data[i+3];</span></div><div class="t m5 x1b0 h2d yecd ff6 fs20 fc6 sc0 ls0 ws0">13<span class="_ _70"> </span><span class="ffd fs1e fc2">acc<span class="_ _e"> </span>=<span class="_ _1f"> </span>acc<span class="_ _1f"> </span>OP<span class="_ _e"> </span>data[i+4];</span></div><div class="t m5 x1b0 h2d yece ff6 fs20 fc6 sc0 ls0 ws0">14<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1b0 h2e yecf ff6 fs20 fc6 sc0 ls0 ws0">15</div><div class="t m5 x1b0 h2e y51ef ff6 fs20 fc6 sc0 ls0 ws0">16</div><div class="t m5 x33 h2d yed0 ffd fs1e fc2 sc0 ls0 ws0">/*<span class="_ _e"> </span>Finish<span class="_ _1f"> </span>any<span class="_ _1f"> </span>remaining<span class="_ _e"> </span>elements<span class="_ _1f"> </span>*/</div><div class="t m5 x1b0 h2e y20fe ff6 fs20 fc6 sc0 ls0 ws0">17</div><div class="t m5 x33 h2d y1a10 ffd fs1e fc2 sc0 ls0 ws0">for<span class="_ _e"> </span>(;<span class="_ _1f"> </span>i<span class="_ _1f"> </span>&lt;<span class="_ _e"> </span>length;<span class="_ _1f"> </span>i++)<span class="_ _e"> </span>{</div><div class="t m5 x1b0 h2d yed3 ff6 fs20 fc6 sc0 ls0 ws0">18<span class="_ _70"> </span><span class="ffd fs1e fc2">acc<span class="_ _e"> </span>=<span class="_ _1f"> </span>acc<span class="_ _1f"> </span>OP<span class="_ _e"> </span>data[i];</span></div><div class="t m5 x1b0 h2d yed4 ff6 fs20 fc6 sc0 ls0 ws0">19<span class="_ _20"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1b0 h2d y462 ff6 fs20 fc6 sc0 ls0 ws0">20<span class="_ _20"> </span><span class="ffd fs1e fc2">*dest<span class="_ _e"> </span>=<span class="_ _1f"> </span>acc;</span></div><div class="t m5 x1b0 h2d y26dd ff6 fs20 fc6 sc0 ls0 ws0">21<span class="_ _1c"> </span><span class="ffd fs1e fc2">}</span></div><div class="t m5 x1d h28 y51f0 ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>5.8</div><div class="t m5 x1ed h2f y51f1 ffe fs16 fc6 sc0 ls0 ws0">(page<span class="_"> </span>581)</div><div class="t m5 x1d h26 y51f2 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _16"> </span>problem<span class="_ _16"> </span>demonstrates<span class="_ _16"> </span>how<span class="_ _16"> </span>small<span class="_ _11"> </span>changes<span class="_ _16"> </span>in<span class="_ _16"> </span>a<span class="_ _16"> </span>program<span class="_ _16"> </span>can<span class="_ _16"> </span>yield<span class="_ _11"> </span>dramatic</div><div class="t m5 x1d h26 y51f3 ff7 fs19 fc1 sc0 ls0 ws0">performance<span class="_ _15"> </span>differences<span class="_ _1"></span>,<span class="_ _21"> </span>especially<span class="_ _15"> </span>on<span class="_ _15"> </span>a<span class="_ _15"> </span>machine<span class="_ _15"> </span>with<span class="_ _15"> </span>out-of-order<span class="_ _15"> </span>execution.</div><div class="t m5 x1d h26 y51f4 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>igure<span class="_ _21"> </span>5.39<span class="_ _21"> </span>diagrams<span class="_ _21"> </span>the<span class="_ _21"> </span>three<span class="_ _21"> </span>multiplication<span class="_ _21"> </span>operations<span class="_ _21"> </span>for<span class="_ _15"> </span>a<span class="_ _21"> </span>single<span class="_ _21"> </span>iteration</div><div class="t m5 x1d h26 y51f5 ff7 fs19 fc1 sc0 ls0 ws0">of<span class="_ _11"> </span>the<span class="_ _16"> </span>function.<span class="_ _16"> </span>In<span class="_ _11"> </span>this<span class="_ _16"> </span>ﬁgure<span class="_ _1"></span>,<span class="_ _16"> </span>the<span class="_ _16"> </span>operations<span class="_ _16"> </span>shown<span class="_ _11"> </span>as<span class="_ _16"> </span>blue<span class="_ _11"> </span>boxes<span class="_ _16"> </span>are<span class="_ _16"> </span>along<span class="_ _11"> </span>the</div><div class="t m5 x1d h26 y51f6 ff7 fs19 fc1 sc0 ls0 ws0">critical<span class="_"> </span>path—they<span class="_"> </span>need<span class="_"> </span>to<span class="_"> </span>be<span class="_"> </span>computed<span class="_"> </span>in<span class="_"> </span>sequence<span class="_"> </span>to<span class="_"> </span>compute<span class="_"> </span>a<span class="_"> </span>new<span class="_"> </span>value<span class="_"> </span>for</div><div class="t m5 x1d h26 y51f7 ff7 fs19 fc1 sc0 ls0 ws0">loop<span class="_"> </span>variable<span class="_"> </span><span class="ffd">r</span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span>operations<span class="_"> </span>shown<span class="_"> </span>as<span class="_ _13"> </span>light<span class="_"> </span>boxes<span class="_"> </span>can<span class="_"> </span>be<span class="_"> </span>computed<span class="_"> </span>in<span class="_"> </span>parallel</div><div class="t m5 x1d h26 y51f8 ff7 fs19 fc1 sc0 ls0 ws0">with<span class="_ _11"> </span>the<span class="_ _16"> </span>critical<span class="_ _16"> </span>path<span class="_ _11"> </span>operations<span class="_ _1"></span>.<span class="_ _16"> </span>F<span class="_ _1"></span>or<span class="_ _11"> </span>a<span class="_ _16"> </span>loop<span class="_ _11"> </span>with<span class="_ _16"> </span><span class="ff11">P<span class="_ _e"> </span></span>operations<span class="_ _11"> </span>along<span class="_ _11"> </span>the<span class="_ _16"> </span>critical</div><div class="t m5 x1d h26 y51f9 ff7 fs19 fc1 sc0 ls0 ws0">path,<span class="_ _11"> </span>each<span class="_ _11"> </span>iteration<span class="_ _11"> </span>will<span class="_ _11"> </span>require<span class="_ _11"> </span>a<span class="_"> </span>minimum<span class="_ _11"> </span>of<span class="_ _11"> </span>5<span class="ff11">P<span class="_ _f"> </span></span>clock<span class="_ _11"> </span>cycles<span class="_"> </span>and<span class="_ _11"> </span>will<span class="_ _11"> </span>compute</div><div class="t m5 x1d h26 y51fa ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _16"> </span>product<span class="_ _11"> </span>for<span class="_ _16"> </span>three<span class="_ _16"> </span>elements<span class="_ _1"></span>,<span class="_ _16"> </span>giving<span class="_ _16"> </span>a<span class="_ _16"> </span>lower<span class="_ _16"> </span>bound<span class="_ _11"> </span>on<span class="_ _16"> </span>the<span class="_ _16"> </span>CPE<span class="_ _16"> </span>of<span class="_ _16"> </span>5<span class="_ _1"></span><span class="ff11 ls227">P/<span class="_ _7"></span><span class="ff7 ls0">3.<span class="_ _11"> </span>T<span class="_ _0"></span>his</span></span></div><div class="t m5 x1d h26 y51fb ff7 fs19 fc1 sc0 ls0 ws0">implies<span class="_ _13"> </span>lower<span class="_"> </span>bounds<span class="_ _13"> </span>of<span class="_"> </span>5.00<span class="_ _13"> </span>for<span class="_"> </span>A1,<span class="_ _13"> </span>3.33<span class="_"> </span>for<span class="_ _13"> </span>A2<span class="_"> </span>and<span class="_ _13"> </span>A5,<span class="_"> </span>and<span class="_ _13"> </span>1.67<span class="_"> </span>for<span class="_ _13"> </span>A3<span class="_"> </span>and<span class="_ _13"> </span>A4.</div><div class="t m5 x1d h26 y51fc ff7 fs19 fc1 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_ _16"> </span>ran<span class="_ _16"> </span>these<span class="_ _16"> </span>functions<span class="_ _11"> </span>on<span class="_ _16"> </span>an<span class="_ _16"> </span>Intel<span class="_ _16"> </span>Core<span class="_ _16"> </span>i7<span class="_ _16"> </span>Haswell<span class="_ _11"> </span>processor<span class="_ _16"> </span>and<span class="_ _16"> </span>found<span class="_ _16"> </span>that<span class="_ _16"> </span>it</div><div class="t m5 x1d h26 y51fd ff7 fs19 fc1 sc0 ls0 ws0">could<span class="_"> </span>achieve<span class="_"> </span>these<span class="_"> </span>CPE<span class="_"> </span>values<span class="_ _1"></span>.</div><div class="t m5 x1d h28 y51fe ffe fs1e fc6 sc0 ls0 ws0">Solution<span class="_"> </span>to<span class="_"> </span>Problem<span class="_"> </span>5.9<span class="_ _e"> </span><span class="fs16">(page<span class="_"> </span>589)</span></div><div class="t m5 x1d h26 y51ff ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>his<span class="_ _13"> </span>is<span class="_ _6"> </span>another<span class="_ _6"> </span>demonstration<span class="_ _13"> </span>that<span class="_ _6"> </span>a<span class="_ _6"> </span>slight<span class="_ _13"> </span>change<span class="_ _6"> </span>in<span class="_ _6"> </span>coding<span class="_ _13"> </span>style<span class="_ _6"> </span>can<span class="_ _6"> </span>make<span class="_ _13"> </span>it<span class="_ _6"> </span>much</div><div class="t m5 x1d h26 y5200 ff7 fs19 fc1 sc0 ls0 ws0">easier<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>compiler<span class="_"> </span>to<span class="_"> </span>detect<span class="_"> </span>opportunities<span class="_"> </span>to<span class="_"> </span>use<span class="_"> </span>conditional<span class="_"> </span>moves:</div><div class="t m5 x10c h2d y5201 ffd fs1e fc2 sc0 ls0 ws0">while<span class="_ _e"> </span>(i<span class="ls33">1&lt;n&amp;<span class="_ _41"></span>&amp;i<span class="_ _41"></span>2&lt;n<span class="_ _41"></span>){</span></div><div class="t m5 x22b h2d y5202 ffd fs1e fc2 sc0 ls0 ws0">long<span class="_ _e"> </span>v1<span class="_ _1f"> </span>=<span class="_ _1f"> </span>src1[i1];</div><div class="t m5 x263 h40 y5203 ff73 fs28 fc1 sc0 ls0 ws0">r</div><div class="t m5 x264 h40 y5204 ff74 fs27 fc1 sc0 ls0 ws0">A1: <span class="ff73 fs28">((r*x)*y)*z</span></div><div class="t m5 x263 h40 y5205 ff73 fs28 fc1 sc0 ls0 ws0">r</div><div class="t m5 x17 h40 y5203 ff73 fs28 fc1 sc0 ls0 ws0">x<span class="_ _b3"> </span>y<span class="_ _b2"> </span>z</div><div class="t m5 x234 hd1 y5206 ff74 fs84 fc1 sc0 ls0 ws0">*<span class="_ _1f0"> </span>*</div><div class="t m5 x234 hd1 y5207 ff74 fs84 fc1 sc0 ls0 ws0">*</div><div class="t m5 x234 hd1 y5208 ff74 fs84 fc1 sc0 ls0 ws0">*</div><div class="t m5 x126 h40 y5203 ff73 fs28 fc1 sc0 ls0 ws0">r</div><div class="t m5 xa2 h40 y5204 ff74 fs27 fc1 sc0 ls0 ws0">A2: <span class="ff73 fs28">(r*(x*y))*z</span></div><div class="t m5 x126 h40 y5205 ff73 fs28 fc1 sc0 ls0 ws0">r</div><div class="t m5 x162 h40 y5203 ff73 fs28 fc1 sc0 ls0 ws0">x<span class="_ _b3"> </span>y<span class="_ _b2"> </span>z</div><div class="t m5 x162 hd1 y5206 ff74 fs84 fc1 sc0 ls0 ws0">*</div><div class="t m5 x126 hd1 y5207 ff74 fs84 fc1 sc0 ls0 ws0">*</div><div class="t m5 x126 hd1 y5208 ff74 fs84 fc1 sc0 ls0 ws0">*</div><div class="t m5 x18d h40 y5203 ff73 fs28 fc1 sc0 ls0 ws0">r</div><div class="t m5 x47 h40 y5204 ff74 fs27 fc1 sc0 ls0 ws0">A3: <span class="ff73 fs28">r*((x*y)*z)</span></div><div class="t m5 x18d h40 y5205 ff73 fs28 fc1 sc0 ls0 ws0">r</div><div class="t m5 xbe h40 y5203 ff73 fs28 fc1 sc0 ls0 ws0">x<span class="_ _b3"> </span>y<span class="_ _b2"> </span>z</div><div class="t m5 xa0 hd1 y5206 ff74 fs84 fc1 sc0 ls0 ws0">*</div><div class="t m5 xa0 hd1 y5207 ff74 fs84 fc1 sc0 ls0 ws0">*</div><div class="t m5 x10f hd1 y5208 ff74 fs84 fc1 sc0 ls0 ws0">*</div><div class="t m5 x5e h40 y5203 ff73 fs28 fc1 sc0 ls0 ws0">r</div><div class="t m5 x114 h40 y5204 ff74 fs27 fc1 sc0 ls0 ws0">A4: <span class="ff73 fs28">r*(x*(y*z))</span></div><div class="t m5 x5e h40 y5205 ff73 fs28 fc1 sc0 ls0 ws0">r</div><div class="t m5 x1bb h40 y5203 ff73 fs28 fc1 sc0 ls0 ws0">x<span class="_ _b3"> </span>y<span class="_ _b2"> </span>z</div><div class="t m5 x6b hd1 y5206 ff74 fs84 fc1 sc0 ls0 ws0">*</div><div class="t m5 x194 hd1 y5207 ff74 fs84 fc1 sc0 ls0 ws0">*</div><div class="t m5 xa1 hd1 y5208 ff74 fs84 fc1 sc0 ls0 ws0">*</div><div class="t m5 x23c h40 y5203 ff73 fs28 fc1 sc0 ls0 ws0">r</div><div class="t m5 x169 h40 y5204 ff74 fs27 fc1 sc0 ls0 ws0">A5: <span class="ff73 fs28">(r*x)*(y*z)</span></div><div class="t m5 x23c h40 y5205 ff73 fs28 fc1 sc0 ls0 ws0">r</div><div class="t m5 x45 h40 y5203 ff73 fs28 fc1 sc0 ls0 ws0">x<span class="_ _b3"> </span>y<span class="_ _b2"> </span>z</div><div class="t m5 x13f hd1 y5206 ff74 fs84 fc1 sc0 ls0 ws0">*</div><div class="t m5 xb4 hd1 y5208 ff74 fs84 fc1 sc0 ls0 ws0">*</div><div class="t m5 x14 h34 y126b ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _21"> </span>5.39<span class="_ _c"> </span><span class="fc2">Data<span class="_ _21"> </span>dependencies<span class="_ _f"> </span>among<span class="_ _f"> </span>multiplication<span class="_ _21"> </span>operations<span class="_ _f"> </span>for<span class="_ _21"> </span>cases<span class="_ _f"> </span>in<span class="_ _21"> </span>Problem<span class="_ _f"> </span>5.8.<span class="_ _f"> </span><span class="ff6">The</span></span></div><div class="t m5 x14 h34 y126c ff6 fs16 fc2 sc0 ls0 ws0">operations<span class="_ _10"> </span>shown<span class="_ _11"> </span>as<span class="_ _10"> </span>blue<span class="_ _10"> </span>boxes<span class="_ _11"> </span>form<span class="_ _10"> </span>the<span class="_ _11"> </span>critical<span class="_ _10"> </span>paths<span class="_ _11"> </span>for<span class="_ _10"> </span>the<span class="_ _10"> </span>iterations.</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
