<div id="pf2dd" class="pf w2 h11" data-page-no="2dd"><div class="pc pc2dd w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg2dd.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">732<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>7<span class="_ _3d"> </span>Linking</span></div><div class="t m5 x111 h2c y27f ffa fs16 fc2 sc0 ls0 ws0">code/link/prog-exe<span class="_ _1"></span>.d</div><div class="t m5 x25a h61 y280 ff13 fs35 fc6 sc0 ls0 ws0">Read-only<span class="_ _f"> </span>code<span class="_ _f"> </span>segment</div><div class="t m5 xb h88 y281 ff6 fs20 fc6 sc0 ls0 ws0">1<span class="_ _1c"> </span><span class="ffd fs4e fc2">LOAD<span class="_ _e"> </span>off<span class="_ _5e"> </span>0x0000000000000000<span class="_ _e"> </span>vaddr<span class="_ _e"> </span>0x0000000000400000<span class="_ _f"> </span>paddr<span class="_ _e"> </span>0x0000000000400000<span class="_ _e"> </span>align<span class="_ _f"> </span>2**21</span></div><div class="t m5 xb h88 y283 ff6 fs20 fc6 sc0 ls0 ws0">2<span class="_ _2a"> </span><span class="ffd fs4e fc2">filesz<span class="_ _e"> </span>0x000000000000069c<span class="_ _e"> </span>memsz<span class="_ _f"> </span>0x000000000000069c<span class="_ _e"> </span>flags<span class="_ _e"> </span>r-x</span></div><div class="t m5 x25a h61 y285 ff13 fs35 fc6 sc0 ls0 ws0">Read/write<span class="_ _f"> </span>data<span class="_ _f"> </span>segment</div><div class="t m5 xb h88 yad4 ff6 fs20 fc6 sc0 ls0 ws0">3<span class="_ _1c"> </span><span class="ffd fs4e fc2">LOAD<span class="_ _e"> </span>off<span class="_ _5e"> </span>0x0000000000000df8<span class="_ _e"> </span>vaddr<span class="_ _e"> </span>0x0000000000600df8<span class="_ _f"> </span>paddr<span class="_ _e"> </span>0x0000000000600df8<span class="_ _e"> </span>align<span class="_ _f"> </span>2**21</span></div><div class="t m5 xb h88 y287 ff6 fs20 fc6 sc0 ls0 ws0">4<span class="_ _2a"> </span><span class="ffd fs4e fc2">filesz<span class="_ _e"> </span>0x0000000000000228<span class="_ _e"> </span>memsz<span class="_ _f"> </span>0x0000000000000230<span class="_ _e"> </span>flags<span class="_ _e"> </span>rw-</span></div><div class="t m5 x111 h2c y288 ffa fs16 fc2 sc0 ls0 ws0">code/link/prog-exe<span class="_ _1"></span>.d</div><div class="t m5 x14 h2f y289 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_ _f"> </span>7.14<span class="_ _c"> </span><span class="fc1">Program<span class="_ _e"> </span>header<span class="_ _21"> </span>table<span class="_ _e"> </span>for<span class="_ _f"> </span>the<span class="_ _e"> </span>example<span class="_ _21"> </span>executable</span></div><div class="t m5 x170 h3a y60de ffd fs19 fc1 sc0 ls0 ws0">prog<span class="ffe fs16">.<span class="_ _f"> </span></span>off<span class="ff6 fs16">:<span class="_ _e"> </span>offset<span class="_ _f"> </span>in<span class="_ _f"> </span>object<span class="_ _e"> </span>ﬁle;</span></div><div class="t m5 x14 h3a y58b9 ffd fs19 fc1 sc0 ls0 ws0">vaddr/paddr<span class="ff6 fs16">:<span class="_ _10"> </span>memory<span class="_ _11"> </span>address;<span class="_ _10"> </span></span>align<span class="ff6 fs16">:<span class="_ _11"> </span>alignment<span class="_ _10"> </span>requirement;<span class="_ _11"> </span></span>filesz<span class="ff6 fs16">:<span class="_ _10"> </span>segment<span class="_ _10"> </span>size<span class="_ _11"> </span>in<span class="_ _10"> </span>object<span class="_ _11"> </span>ﬁle;</span></div><div class="t m5 x14 h3a y5da2 ffd fs19 fc1 sc0 ls0 ws0">memsz<span class="ff6 fs16">:<span class="_ _10"> </span>segment<span class="_ _11"> </span>size<span class="_ _10"> </span>in<span class="_ _10"> </span>memor<span class="_ _2"></span>y;<span class="_ _10"> </span></span>flags<span class="ff6 fs16">:<span class="_ _10"> </span>run-time<span class="_ _11"> </span>permissions.</span></div><div class="t m5 x29 h26 y60df ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _13"> </span>format<span class="_ _13"> </span>of<span class="_ _13"> </span>an<span class="_ _6"> </span>executable<span class="_ _13"> </span>object<span class="_ _13"> </span>ﬁle<span class="_ _13"> </span>is<span class="_ _13"> </span>similar<span class="_ _6"> </span>to<span class="_ _13"> </span>that<span class="_ _13"> </span>of<span class="_ _13"> </span>a<span class="_ _6"> </span>relocatable<span class="_ _13"> </span>object</div><div class="t m5 x1d h26 y60e0 ff7 fs19 fc1 sc0 ls0 ws0">ﬁle<span class="_ _1"></span>.<span class="_ _16"> </span>T<span class="_ _1"></span>he<span class="_ _11"> </span>ELF<span class="_ _16"> </span>header<span class="_ _11"> </span>describes<span class="_ _11"> </span>the<span class="_ _16"> </span>overall<span class="_"> </span>format<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>ﬁle.<span class="_"> </span>It<span class="_ _16"> </span>also<span class="_ _11"> </span>includes<span class="_ _11"> </span>the</div><div class="t m5 x1d h26 y60e1 ff7 fs19 fc1 sc0 ls0 ws0">program’s<span class="_ _13"> </span><span class="ffa">entry<span class="_ _13"> </span>point<span class="_ _2"></span></span>,<span class="_ _13"> </span>which<span class="_ _13"> </span>is<span class="_"> </span>the<span class="_ _13"> </span>address<span class="_ _13"> </span>of<span class="_ _13"> </span>the<span class="_ _13"> </span>ﬁrst<span class="_ _13"> </span>instruction<span class="_ _13"> </span>to<span class="_ _13"> </span>execute<span class="_ _13"> </span>when</div><div class="t m5 x1d h26 y60e2 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>program<span class="_ _13"> </span>runs<span class="_ _1"></span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span><span class="ffd">.text</span>,<span class="_"> </span><span class="ffd">.rodata</span>,<span class="_"> </span>and<span class="_ _13"> </span><span class="ffd">.data<span class="_ _10"> </span></span>sections<span class="_"> </span>are<span class="_ _13"> </span>similar<span class="_"> </span>to<span class="_"> </span>those<span class="_ _13"> </span>in</div><div class="t m5 x1d h26 y60e3 ff7 fs19 fc1 sc0 ls0 ws0">a<span class="_ _16"> </span>relocatable<span class="_ _16"> </span>object<span class="_ _16"> </span>ﬁle<span class="_ _1"></span>,<span class="_ _14"> </span>except<span class="_ _16"> </span>that<span class="_ _16"> </span>these<span class="_ _16"> </span>sections<span class="_ _16"> </span>have<span class="_ _16"> </span>been<span class="_ _16"> </span>relocated<span class="_ _16"> </span>to<span class="_ _16"> </span>their</div><div class="t m5 x1d h26 y60e4 ff7 fs19 fc1 sc0 ls0 ws0">eventual<span class="_"> </span>run-time<span class="_ _13"> </span>memory<span class="_"> </span>addresses<span class="_ _3"></span>.<span class="_"> </span>T<span class="_ _1"></span>he<span class="_"> </span><span class="ffd">.init<span class="_ _13"> </span></span>section<span class="_"> </span>deﬁnes<span class="_ _13"> </span>a<span class="_"> </span>small<span class="_ _13"> </span>function,</div><div class="t m5 x1d h26 y60e5 ff7 fs19 fc1 sc0 ls0 ws0">called<span class="_ _14"> </span><span class="ffd">_init</span>,<span class="_ _15"> </span>that<span class="_ _14"> </span>will<span class="_ _14"> </span>be<span class="_ _14"> </span>called<span class="_ _15"> </span>by<span class="_ _14"> </span>the<span class="_ _14"> </span>program’s<span class="_ _16"> </span>initialization<span class="_ _15"> </span>code<span class="_ _1"></span>.<span class="_ _14"> </span>Since<span class="_ _15"> </span>the</div><div class="t m5 x1d h26 y60e6 ff7 fs19 fc1 sc0 ls0 ws0">executable<span class="_"> </span>is<span class="_"> </span><span class="ffa">fully<span class="_"> </span>linked<span class="_"> </span></span>(relocated),<span class="_"> </span>it<span class="_"> </span>needs<span class="_"> </span>no<span class="_"> </span><span class="ffd">.rel<span class="_ _11"> </span></span>sections<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y60e7 ff7 fs19 fc1 sc0 ls0 ws0">ELF<span class="_"> </span>executables<span class="_ _11"> </span>are<span class="_"> </span>designed<span class="_ _11"> </span>to<span class="_"> </span>be<span class="_ _11"> </span>easy<span class="_"> </span>to<span class="_ _11"> </span>load<span class="_"> </span>into<span class="_ _11"> </span>memory<span class="_ _3"></span>,<span class="_"> </span>with<span class="_ _11"> </span>contigu-</div><div class="t m5 x1d h26 y60e8 ff7 fs19 fc1 sc0 ls0 ws0">ous<span class="_ _11"> </span>chunks<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>executable<span class="_ _16"> </span>ﬁle<span class="_ _11"> </span>mapped<span class="_ _11"> </span>to<span class="_ _16"> </span>contiguous<span class="_ _11"> </span>memory<span class="_ _11"> </span>segments<span class="_ _1"></span>.<span class="_ _16"> </span>T<span class="_ _1"></span>his</div><div class="t m5 x1d h26 y60e9 ff7 fs19 fc1 sc0 ls0 ws0">mapping<span class="_ _11"> </span>is<span class="_ _11"> </span>described<span class="_ _11"> </span>by<span class="_ _11"> </span>the<span class="_ _11"> </span><span class="ffa">program<span class="_ _11"> </span>header<span class="_ _11"> </span>table</span>.<span class="_ _11"> </span>F<span class="_ _0"></span>igure<span class="_ _11"> </span>7.14<span class="_ _11"> </span>shows<span class="_ _11"> </span>part<span class="_ _11"> </span>of<span class="_ _11"> </span>the</div><div class="t m5 x1d h26 y60ea ff7 fs19 fc1 sc0 ls0 ws0">program<span class="_ _13"> </span>header<span class="_"> </span>table<span class="_ _13"> </span>for<span class="_"> </span>our<span class="_ _13"> </span>example<span class="_"> </span>executable<span class="_ _13"> </span><span class="ffd">prog</span>,<span class="_"> </span>as<span class="_ _13"> </span>displayed<span class="_"> </span>by<span class="_ _13"> </span><span class="ff9">objd<span class="_ _1"></span>ump<span class="ff7">.</span></span></div><div class="t m5 x29 h26 y60eb ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>rom<span class="_ _14"> </span>the<span class="_ _16"> </span>program<span class="_ _14"> </span>header<span class="_ _16"> </span>table,<span class="_ _16"> </span>we<span class="_ _14"> </span>see<span class="_ _14"> </span>that<span class="_ _16"> </span>two<span class="_ _14"> </span>memory<span class="_ _16"> </span>segments<span class="_ _14"> </span>will<span class="_ _16"> </span>be</div><div class="t m5 x1d h26 y60ec ff7 fs19 fc1 sc0 ls0 ws0">initialized<span class="_ _14"> </span>with<span class="_ _15"> </span>the<span class="_ _14"> </span>contents<span class="_ _15"> </span>of<span class="_ _15"> </span>the<span class="_ _14"> </span>executable<span class="_ _15"> </span>object<span class="_ _15"> </span>ﬁle<span class="_ _1"></span>.<span class="_ _15"> </span>Lines<span class="_ _14"> </span>1<span class="_ _15"> </span>and<span class="_ _15"> </span>2<span class="_ _14"> </span>tell<span class="_ _15"> </span>us</div><div class="t m5 x1d h26 y60ed ff7 fs19 fc1 sc0 ls0 ws0">that<span class="_ _11"> </span>the<span class="_ _16"> </span>ﬁrst<span class="_ _11"> </span>segment<span class="_ _16"> </span>(the<span class="_ _11"> </span><span class="ffa">code<span class="_ _16"> </span>segment<span class="_ _2"></span></span>)<span class="_ _16"> </span>has<span class="_ _11"> </span>read/execute<span class="_ _16"> </span>permissions<span class="_ _1"></span>,<span class="_ _16"> </span>starts<span class="_ _11"> </span>at</div><div class="t m5 x1d h26 y60ee ff7 fs19 fc1 sc0 ls0 ws0">memory<span class="_ _15"> </span>address<span class="_ _21"> </span><span class="ffd">0x400000</span>,<span class="_ _f"> </span>has<span class="_ _21"> </span>a<span class="_ _21"> </span>total<span class="_ _21"> </span>size<span class="_ _15"> </span>in<span class="_ _21"> </span>memory<span class="_ _21"> </span>of<span class="_ _21"> </span><span class="ffd">0x69c<span class="_ _15"> </span></span>bytes<span class="_ _0"></span>,<span class="_ _f"> </span>and<span class="_ _15"> </span>is</div><div class="t m5 x1d h26 y60ef ff7 fs19 fc1 sc0 ls0 ws0">initialized<span class="_ _11"> </span>with<span class="_ _11"> </span>the<span class="_ _11"> </span>ﬁrst<span class="_ _16"> </span><span class="ffd">0x69c<span class="_ _10"> </span></span>bytes<span class="_ _16"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>executable<span class="_ _11"> </span>object<span class="_ _11"> </span>ﬁle,<span class="_"> </span>which<span class="_ _16"> </span>includes</div><div class="t m5 x1d h26 y60f0 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_ _11"> </span>ELF<span class="_ _16"> </span>header,<span class="_ _16"> </span>the<span class="_ _11"> </span>program<span class="_ _16"> </span>header<span class="_ _11"> </span>table,<span class="_ _11"> </span>and<span class="_ _16"> </span>the<span class="_ _16"> </span><span class="ffd">.init</span>,<span class="_ _11"> </span><span class="ffd">.text</span>,<span class="_ _16"> </span>and<span class="_ _16"> </span><span class="ffd">.rodata</span></div><div class="t m5 x1d h26 y60f1 ff7 fs19 fc1 sc0 ls0 ws0">sections<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y60f2 ff7 fs19 fc1 sc0 ls0 ws0">Lines<span class="_ _13"> </span>3<span class="_ _6"> </span>and<span class="_ _13"> </span>4<span class="_ _13"> </span>tell<span class="_ _6"> </span>us<span class="_ _13"> </span>that<span class="_ _13"> </span>the<span class="_ _6"> </span>second<span class="_ _13"> </span>segment<span class="_ _13"> </span>(the<span class="_ _6"> </span><span class="ffa">data<span class="_ _13"> </span>segment<span class="_ _2"></span></span>)<span class="_ _13"> </span>has<span class="_ _6"> </span>read/write</div><div class="t m5 x1d h26 y60f3 ff7 fs19 fc1 sc0 ls0 ws0">permissions<span class="_ _1"></span>,<span class="_ _13"> </span>starts<span class="_ _13"> </span>at<span class="_ _13"> </span>memory<span class="_ _6"> </span>address<span class="_ _13"> </span><span class="ffd">0x600df8</span>,<span class="_ _13"> </span>has<span class="_ _13"> </span>a<span class="_ _13"> </span>total<span class="_ _13"> </span>memory<span class="_ _13"> </span>size<span class="_ _6"> </span>of<span class="_ _13"> </span><span class="ffd">0x230</span></div><div class="t m5 x1d h26 y60f4 ff7 fs19 fc1 sc0 ls0 ws0">bytes<span class="_ _1"></span>,<span class="_"> </span>and<span class="_ _13"> </span>is<span class="_"> </span>initialized<span class="_ _13"> </span>with<span class="_ _13"> </span>the<span class="_"> </span><span class="ffd">0x228<span class="_ _13"> </span></span>bytes<span class="_"> </span>in<span class="_ _13"> </span>the<span class="_"> </span><span class="ffd">.data<span class="_ _13"> </span></span>section<span class="_"> </span>starting<span class="_ _13"> </span>at<span class="_"> </span>offset</div><div class="t m5 x1d h26 y60f5 ffd fs19 fc1 sc0 ls0 ws0">0xdf8<span class="_ _10"> </span><span class="ff7">in<span class="_ _13"> </span>the<span class="_"> </span>object<span class="_ _13"> </span>ﬁle.<span class="_ _13"> </span>T<span class="_ _1"></span>he<span class="_"> </span>remaining<span class="_"> </span>8<span class="_ _13"> </span>bytes<span class="_"> </span>in<span class="_ _13"> </span>the<span class="_"> </span>segment<span class="_ _13"> </span>correspond<span class="_"> </span>to<span class="_ _13"> </span><span class="ffd">.bss</span></span></div><div class="t m5 x1d h26 y60f6 ff7 fs19 fc1 sc0 ls0 ws0">data<span class="_"> </span>that<span class="_"> </span>will<span class="_"> </span>be<span class="_"> </span>initialized<span class="_"> </span>to<span class="_"> </span>zero<span class="_"> </span>at<span class="_"> </span>run<span class="_"> </span>time<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y60f7 ff7 fs19 fc1 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _13"> </span>any<span class="_"> </span>segment<span class="_ _13"> </span><span class="ff11">s<span class="_ _2"></span></span>,<span class="_"> </span>the<span class="_ _13"> </span>linker<span class="_ _13"> </span>must<span class="_ _13"> </span>choose<span class="_"> </span>a<span class="_ _13"> </span>starting<span class="_ _13"> </span>address<span class="_ _1"></span>,<span class="_"> </span><span class="ffd">vaddr</span>,<span class="_ _13"> </span>such<span class="_ _13"> </span>that</div><div class="t m5 xed h46 y60f8 ffd fs19 fc1 sc0 ls0 ws0">vaddr<span class="_ _13"> </span><span class="ff7">mod<span class="_"> </span></span>align<span class="_ _10"> </span><span class="ff12">=<span class="_ _13"></span></span>off<span class="_ _6"> </span><span class="ff7">mod<span class="_"> </span></span>align</div><div class="t m5 x1d h26 y60f9 ff7 fs19 fc1 sc0 ls0 ws0">where<span class="_"> </span><span class="ffd">off<span class="_ _11"> </span></span>is<span class="_ _11"> </span>the<span class="_ _11"> </span>offset<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>segment’s<span class="_"> </span>ﬁrst<span class="_ _11"> </span>section<span class="_ _11"> </span>in<span class="_ _11"> </span>the<span class="_ _11"> </span>object<span class="_ _11"> </span>ﬁle<span class="_ _0"></span>,<span class="_ _11"> </span>and<span class="_ _11"> </span><span class="ffd">align</span></div><div class="t m5 x1d h26 y60fa ff7 fs19 fc1 sc0 ls0 ws0">is<span class="_"> </span>the<span class="_"> </span>alignment<span class="_ _11"> </span>speciﬁed<span class="_"> </span>in<span class="_ _11"> </span>the<span class="_"> </span>program<span class="_ _11"> </span>header<span class="_"> </span>(2</div><div class="t m5 x6b h3c y131d ff7 fs25 fc1 sc0 ls0 ws0">21</div><div class="t m5 x107 h46 y345b ff12 fs19 fc1 sc0 ls0 ws0">=<span class="_ _13"> </span><span class="ffd">0x200000<span class="ff7">).<span class="_"> </span>F<span class="_ _1"></span>or<span class="_ _11"> </span>example<span class="_ _1"></span>,</span></span></div><div class="t m5 x1d h26 y4ad6 ff7 fs19 fc1 sc0 ls0 ws0">in<span class="_"> </span>the<span class="_"> </span>data<span class="_"> </span>segment<span class="_"> </span>in<span class="_"> </span>F<span class="_ _1"></span>igure<span class="_"> </span>7.14,</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
