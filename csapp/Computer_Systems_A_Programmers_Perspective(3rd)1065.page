<div id="pf429" class="pf w2 h11" data-page-no="429"><div class="pc pc429 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg429.png"/><div class="t m5 x14 h28 y9b ffe fs1e fc2 sc0 ls0 ws0">1064<span class="_ _1b"> </span><span class="ff6 fs1f">Chapter<span class="_ _10"> </span>12<span class="_ _3d"> </span>Concurrent<span class="_ _10"> </span>Programming</span></div><div class="t m8 x145 h3f y844c fff1 fs27 fc1 sc0 ls0 ws0">. . .</div><div class="t m5 x15c h3f y844d fff1 fs27 fc1 sc0 ls0 ws0">. . .<span class="_ _54"> </span>. . .<span class="_ _55"> </span>. . .</div><div class="t m5 x204 h3f y844e fff1 fs27 fc1 sc0 ls0 ws0">. . .</div><div class="t m5 x9 h3f y844d fff1 fs27 fc1 sc0 ls0 ws0">. . .</div><div class="t m8 x145 h3f y844f fff1 fs27 fc1 sc0 ls0 ws0">. . .<span class="_ _23d"></span>. . .<span class="_ _23d"></span>. . .</div><div class="t m5 x21f h3f y8450 fff1 fs27 fc1 sc0 ls0 ws0">Thread 2</div><div class="t m5 x190 h3f y8451 fff1 fs27 fc1 sc0 ls0 ws0">Thread 1</div><div class="t m5 x1d7 h3f y8452 ffee fs27 fc1 sc0 ls0 ws0">A trajectory that deadlocks</div><div class="t m5 xdc h3f y8453 ffee fs27 fc1 sc0 ls0 ws0">A trajectory that does not deadlock</div><div class="t m5 x214 h3f y8454 ffee fs27 fc1 sc0 ls0 ws0">P<span class="_ _2"></span><span class="fff1">(</span>s<span class="fff1">)</span></div><div class="t m5 x22b h3f y8455 ffee fs27 fc1 sc0 ls0 ws0">P<span class="_ _2"></span><span class="fff1">(</span>t<span class="_ _5"></span><span class="fff1">)</span></div><div class="t m5 x1d7 h3f y8456 ffee fs27 fc1 sc0 ls0 ws0">P<span class="_ _2"></span><span class="fff1">(</span>s<span class="fff1">)<span class="_ _10d"> </span></span>P<span class="_ _2"></span><span class="fff1">(</span>t<span class="_ _5"></span><span class="fff1">)<span class="_ _82"> </span></span>V<span class="_ _2"></span><span class="fff1">(</span>s<span class="fff1">)<span class="_ _10d"> </span></span>V<span class="_ _2"></span><span class="fff1">(</span>t<span class="_ _5"></span><span class="fff1">)</span></div><div class="t m5 x65 h3f y8457 ffee fs27 fc1 sc0 ls0 ws0">V<span class="_ _2"></span><span class="fff1">(</span>t<span class="_ _5"></span><span class="fff1">)</span></div><div class="t m5 x1c4 h3f y8458 ffee fs27 fc1 sc0 ls0 ws0">V<span class="_ _2"></span><span class="fff1">(</span>s<span class="fff1">)</span></div><div class="t m5 x1f6 h3f y8459 fff1 fs27 fc1 sc0 ls0 ws0">Initially</div><div class="t m5 x17e h3f y845a ffee fs27 fc1 sc0 ls0 ws0">s<span class="ff24"><span class="fff1">1</span></span></div><div class="t m5 x75 h3f y845b ffee fs27 fc1 sc0 ls0 ws0">t<span class="_ _2"></span><span class="ff24"><span class="fff1">1</span></span></div><div class="t m5 x198 h3f y845c fff1 fs27 fc1 sc0 ls0 ws0">Forbidden</div><div class="t m5 x1b3 h3f y845d fff1 fs27 fc1 sc0 ls0 ws0">region </div><div class="t m5 x122 h3f y845e fff1 fs27 fc1 sc0 ls0 ws0">for <span class="ffee">s</span></div><div class="t m5 x41 h3f y845f fff1 fs27 fc1 sc0 ls0 ws0">Forbidden</div><div class="t m5 xf9 h3f y8460 fff1 fs27 fc1 sc0 ls0 ws0">region </div><div class="t m5 xff h3f y8461 fff1 fs27 fc1 sc0 ls0 ws0">for <span class="ffee">t</span></div><div class="t m5 x68 h3f y8462 fff2 fs27 fc1 sc0 ls0 ws0">Deadlock</div><div class="t m5 x86 h3f y8463 fff2 fs27 fc1 sc0 ls0 ws0">state</div><div class="t m5 x16 hd0 y8464 fff3 fs27 fc1 sc0 ls0 ws0">d</div><div class="t m5 xd9 h3f y8465 fff2 fs27 fc1 sc0 ls0 ws0">Deadlock</div><div class="t m5 x1c8 h3f y8466 fff2 fs27 fc1 sc0 ls0 ws0">region</div><div class="t m5 x1d h2f y8467 ffe fs16 fc6 sc0 ls0 ws0">Figure<span class="_"> </span>12.44<span class="_ _66"> </span><span class="fc1">Progress<span class="_"> </span>graph<span class="_"> </span>for<span class="_"> </span>a<span class="_"> </span>program<span class="_"> </span>that<span class="_"> </span>can<span class="_"> </span>deadlock.</span></div><div class="t m5 x29 h26 y8468 ff7 fs19 fc1 sc0 ls0 ws0">possible<span class="_ _16"> </span>because<span class="_ _11"> </span>the<span class="_ _16"> </span>overlapping<span class="_ _16"> </span>forbidden<span class="_ _16"> </span>regions<span class="_ _16"> </span>block<span class="_ _11"> </span>progress<span class="_ _16"> </span>in<span class="_ _16"> </span>every</div><div class="t m5 x29 h26 y8469 ff7 fs19 fc1 sc0 ls0 ws0">legal<span class="_ _f"> </span>direction.<span class="_ _e"> </span>In<span class="_ _f"> </span>other<span class="_ _e"> </span>words<span class="_ _3"></span>,<span class="_ _1f"> </span>the<span class="_ _f"> </span>program<span class="_ _f"> </span>is<span class="_ _e"> </span>deadlocked<span class="_ _f"> </span>because<span class="_ _e"> </span>each</div><div class="t m5 x29 h26 y846a ff7 fs19 fc1 sc0 ls0 ws0">thread<span class="_"> </span>is<span class="_"> </span>waiting<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>other<span class="_"> </span>to<span class="_"> </span>do<span class="_"> </span>a<span class="_"> </span><span class="ff11">V<span class="_ _f"> </span></span>operation<span class="_"> </span>that<span class="_"> </span>will<span class="_"> </span>never<span class="_"> </span>occur.</div><div class="t m5 x75 h3d y846b ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y846c ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _11"> </span>overlapping<span class="_ _11"> </span>forbidden<span class="_"> </span>regions<span class="_ _11"> </span>induce<span class="_"> </span>a<span class="_ _11"> </span>set<span class="_ _11"> </span>of<span class="_"> </span>states<span class="_ _11"> </span>called<span class="_ _11"> </span>the<span class="_"> </span><span class="ffa">deadlock</span></div><div class="t m5 x29 h26 y846d ffa fs19 fc1 sc0 ls0 ws0">region<span class="ff7">.<span class="_ _11"> </span>If<span class="_ _16"> </span>a<span class="_ _16"> </span>trajectory<span class="_ _11"> </span>happens<span class="_ _16"> </span>to<span class="_ _16"> </span>touch<span class="_ _11"> </span>a<span class="_ _16"> </span>state<span class="_ _16"> </span>in<span class="_ _11"> </span>the<span class="_ _16"> </span>deadlock<span class="_ _16"> </span>region,<span class="_ _16"> </span>then</span></div><div class="t m5 x29 h26 y846e ff7 fs19 fc1 sc0 ls0 ws0">deadlock<span class="_ _11"> </span>is<span class="_ _11"> </span>inevitable.<span class="_"> </span>T<span class="_ _3"></span>rajectories<span class="_ _11"> </span>can<span class="_ _11"> </span>enter<span class="_ _11"> </span>deadlock<span class="_ _16"> </span>regions<span class="_ _3"></span>,<span class="_ _16"> </span>but<span class="_ _11"> </span>they<span class="_ _11"> </span>can</div><div class="t m5 x29 h26 y846f ff7 fs19 fc1 sc0 ls0 ws0">never<span class="_"> </span>leave<span class="_ _1"></span>.</div><div class="t m5 x75 h3d y8470 ff14 fs26 fc6 sc0 ls0 ws0">.</div><div class="t m5 x29 h26 y8471 ff7 fs19 fc1 sc0 ls0 ws0">Deadlock<span class="_ _11"> </span>is<span class="_ _16"> </span>an<span class="_ _11"> </span>especially<span class="_ _16"> </span>difﬁcult<span class="_ _11"> </span>issue<span class="_ _11"> </span>because<span class="_ _16"> </span>it<span class="_ _11"> </span>is<span class="_ _16"> </span>not<span class="_ _11"> </span>always<span class="_ _16"> </span>predictable<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y8472 ff7 fs19 fc1 sc0 ls0 ws0">Some<span class="_ _13"> </span>lucky<span class="_"> </span>execution<span class="_ _13"> </span>trajectories<span class="_ _13"> </span>will<span class="_"> </span>skirt<span class="_ _13"> </span>the<span class="_"> </span>deadlock<span class="_ _13"> </span>region,<span class="_ _13"> </span>while<span class="_"> </span>others</div><div class="t m5 x29 h26 y8473 ff7 fs19 fc1 sc0 ls0 ws0">will<span class="_ _13"> </span>be<span class="_ _13"> </span>trapped<span class="_ _13"> </span>by<span class="_ _13"> </span>it.<span class="_ _13"> </span>F<span class="_ _1"></span>igure<span class="_ _13"> </span>12.44<span class="_ _13"> </span>shows<span class="_ _13"> </span>an<span class="_ _13"> </span>example<span class="_ _13"> </span>of<span class="_ _13"> </span>each.<span class="_ _13"> </span>The<span class="_ _13"> </span>implications</div><div class="t m5 x29 h26 y8474 ff7 fs19 fc1 sc0 ls0 ws0">for<span class="_ _6"> </span>a<span class="_ _6"> </span>programmer<span class="_ _6"> </span>are<span class="_ _6"> </span>scary<span class="_ _3"></span>.<span class="_ _13"> </span>Y<span class="_ _7"></span>ou<span class="_ _6"> </span>might<span class="_ _6"> </span>run<span class="_ _6"> </span>the<span class="_ _13"> </span>same<span class="_ _a"> </span>program<span class="_ _6"> </span>a<span class="_ _13"> </span>thousand<span class="_ _a"> </span>times</div><div class="t m5 x29 h26 y8475 ff7 fs19 fc1 sc0 ls0 ws0">without<span class="_ _16"> </span>any<span class="_ _14"> </span>problem,<span class="_ _15"> </span>but<span class="_ _14"> </span>then<span class="_ _14"> </span>the<span class="_ _16"> </span>next<span class="_ _14"> </span>time<span class="_ _14"> </span>it<span class="_ _14"> </span>deadlocks<span class="_ _1"></span>.<span class="_ _14"> </span>Or<span class="_ _14"> </span>the<span class="_ _14"> </span>program</div><div class="t m5 x29 h26 y8476 ff7 fs19 fc1 sc0 ls0 ws0">might<span class="_ _f"> </span>work<span class="_ _e"> </span>ﬁne<span class="_ _f"> </span>on<span class="_ _e"> </span>one<span class="_ _f"> </span>machine<span class="_ _e"> </span>but<span class="_ _f"> </span>deadlock<span class="_ _e"> </span>on<span class="_ _21"> </span>another.<span class="_ _e"> </span>W<span class="_ _7"></span>orst<span class="_ _e"> </span>of<span class="_ _f"> </span>all,</div><div class="t m5 x29 h26 y8477 ff7 fs19 fc1 sc0 ls0 ws0">the<span class="_"> </span>error<span class="_ _11"> </span>is<span class="_ _11"> </span>often<span class="_ _11"> </span>not<span class="_ _11"> </span>repeatable<span class="_ _11"> </span>because<span class="_"> </span>different<span class="_ _11"> </span>executions<span class="_ _11"> </span>have<span class="_ _11"> </span>different</div><div class="t m5 x29 h26 y8478 ff7 fs19 fc1 sc0 ls0 ws0">trajectories<span class="_ _1"></span>.</div><div class="t m5 x29 h26 y8479 ff7 fs19 fc1 sc0 ls0 ws0">Programs<span class="_ _13"> </span>deadlock<span class="_"> </span>for<span class="_ _13"> </span>many<span class="_ _13"> </span>reasons<span class="_ _1"></span>,<span class="_"> </span>and<span class="_ _13"> </span>preventing<span class="_ _13"> </span>them<span class="_ _13"> </span>is<span class="_"> </span>a<span class="_ _13"> </span>difﬁcult<span class="_ _13"> </span>prob-</div><div class="t m5 x1d h26 y847a ff7 fs19 fc1 sc0 ls0 ws0">lem<span class="_ _13"> </span>in<span class="_ _13"> </span>general.<span class="_"> </span>However<span class="_ _0"></span>,<span class="_ _13"> </span>when<span class="_"> </span>binary<span class="_ _13"> </span>semaphores<span class="_ _13"> </span>are<span class="_ _13"> </span>used<span class="_"> </span>for<span class="_ _13"> </span>mutual<span class="_ _13"> </span>exclusion,</div><div class="t m5 x1d h26 y847b ff7 fs19 fc1 sc0 ls0 ws0">as<span class="_ _11"> </span>in<span class="_ _16"> </span>F<span class="_ _1"></span>igure<span class="_ _16"> </span>12.44,<span class="_ _11"> </span>then<span class="_ _16"> </span>you<span class="_ _11"> </span>can<span class="_ _16"> </span>apply<span class="_ _11"> </span>the<span class="_ _16"> </span>following<span class="_ _11"> </span>simple<span class="_ _11"> </span>and<span class="_ _16"> </span>effective<span class="_ _11"> </span>rule<span class="_ _16"> </span>to</div><div class="t m5 x1d h26 y847c ff7 fs19 fc1 sc0 ls0 ws0">prevent<span class="_"> </span>deadlocks:</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
