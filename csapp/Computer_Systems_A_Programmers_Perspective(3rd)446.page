<div id="pf1be" class="pf w2 h11" data-page-no="1be"><div class="pc pc1be w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1be.png"/><div class="t m5 x99 h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>4.3<span class="_ _60"> </span>Sequential<span class="_ _10"> </span>Y86-64<span class="_ _10"> </span>Implementations<span class="_ _3e"> </span><span class="ffe fs1e">445</span></div><div class="t m5 x21e h2d y140c ffd fs1e fc2 sc0 ls0 ws0">icode<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _1f"> </span>ICALL,<span class="_ _e"> </span>IPUSH<span class="ls33">Q}:-<span class="_ _41"></span>8<span class="_ _41"></span>;</span></div><div class="t m5 x21e h2d y140d ffd fs1e fc2 sc0 ls0 ws0">icode<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _1f"> </span>IRET,<span class="_ _e"> </span>IPOP<span class="ls33">Q}:8<span class="_ _41"></span>;</span></div><div class="t m5 x21e h2d y1b95 ffd fs1e fc2 sc0 ls0 ws0">#<span class="_ _e"> </span>Other<span class="_ _1f"> </span>instructions<span class="_ _1f"> </span>don’t<span class="_ _e"> </span>need<span class="_ _1f"> </span>ALU</div><div class="t m5 x17 h2d y2122 ffd fs1e fc2 sc0 ls0 ws0">];</div><div class="t m5 x17 h47 y3d87 ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>4.23<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>524)</span></div><div class="t m5 x17 h26 y3d88 ff7 fs19 fc1 sc0 ls0 ws0">Based<span class="_"> </span>on<span class="_"> </span>the<span class="_ _11"> </span>ﬁrst<span class="_"> </span>operand<span class="_"> </span>of<span class="_ _11"> </span>the<span class="_"> </span>ﬁrst<span class="_"> </span>step<span class="_ _11"> </span>of<span class="_"> </span>the<span class="_"> </span>execute<span class="_ _11"> </span>stage<span class="_"> </span>in<span class="_"> </span>Figures<span class="_"> </span>4.18<span class="_"> </span>to</div><div class="t m5 x17 h26 y3d89 ff7 fs19 fc1 sc0 ls0 ws0">4.21,<span class="_"> </span>write<span class="_"> </span>an<span class="_"> </span>HCL<span class="_"> </span>description<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>signal<span class="_"> </span><span class="ff6">aluB<span class="_ _10"> </span></span>in<span class="_"> </span>SEQ.</div><div class="t m5 x26 h26 y3d8a ff7 fs19 fc1 sc0 ls0 ws0">Looking<span class="_ _16"> </span>at<span class="_ _16"> </span>the<span class="_ _16"> </span>operations<span class="_ _14"> </span>performed<span class="_ _16"> </span>by<span class="_ _16"> </span>the<span class="_ _16"> </span>ALU<span class="_ _14"> </span>in<span class="_ _16"> </span>the<span class="_ _16"> </span>execute<span class="_ _16"> </span>stage,<span class="_ _16"> </span>we</div><div class="t m5 x17 h26 y3d8b ff7 fs19 fc1 sc0 ls0 ws0">can<span class="_ _11"> </span>see<span class="_ _16"> </span>that<span class="_ _11"> </span>it<span class="_ _16"> </span>is<span class="_ _11"> </span>mostly<span class="_ _16"> </span>used<span class="_ _11"> </span>as<span class="_ _16"> </span>an<span class="_ _11"> </span>adder.<span class="_ _11"> </span>F<span class="_ _1"></span>or<span class="_ _16"> </span>the<span class="_ _11"> </span><span class="ffd">OPq<span class="_ _16"> </span></span>instructions<span class="_ _1"></span>,<span class="_ _16"> </span>however<span class="_ _0"></span>,<span class="_ _16"> </span>we</div><div class="t m5 x17 h26 y3d8c ff7 fs19 fc1 sc0 ls0 ws0">want<span class="_ _16"> </span>it<span class="_ _11"> </span>to<span class="_ _16"> </span>use<span class="_ _16"> </span>the<span class="_ _11"> </span>operation<span class="_ _16"> </span>encoded<span class="_ _11"> </span>in<span class="_ _16"> </span>the<span class="_ _16"> </span><span class="ff6">ifun<span class="_ _16"> </span></span>ﬁeld<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _16"> </span>instruction.<span class="_ _11"> </span>W<span class="_ _1"></span>e<span class="_ _16"> </span>can</div><div class="t m5 x17 h26 y3d8d ff7 fs19 fc1 sc0 ls0 ws0">therefore<span class="_"> </span>write<span class="_"> </span>the<span class="_"> </span>HCL<span class="_"> </span>description<span class="_"> </span>for<span class="_"> </span>the<span class="_"> </span>ALU<span class="_"> </span>control<span class="_"> </span>as<span class="_"> </span>follows:</div><div class="t m5 x17 h2d y3d8e ffd fs1e fc2 sc0 ls0 ws0">word<span class="_ _e"> </span>alufun<span class="_ _1f"> </span>=<span class="_ _1f"> </span>[</div><div class="t m5 x21e h2d y3d8f ffd fs1e fc2 sc0 ls0 ws0">icode<span class="_ _e"> </span>==<span class="_ _1f"> </span>IOPQ<span class="_ _1f"> </span>:<span class="_ _e"> </span>ifun;</div><div class="t m5 x21e h2d y3d90 ffd fs1e fc2 sc0 ls0 ws0">1<span class="_ _e"> </span>:<span class="_ _1f"> </span>ALUADD;</div><div class="t m5 x17 h2d y3d91 ffd fs1e fc2 sc0 ls0 ws0">];</div><div class="t m5 x26 h26 y3d92 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _16"> </span>execute<span class="_ _16"> </span>stage<span class="_ _16"> </span>also<span class="_ _16"> </span>includes<span class="_ _16"> </span>the<span class="_ _16"> </span>condition<span class="_ _11"> </span>code<span class="_ _16"> </span>register.<span class="_ _16"> </span>Our<span class="_ _16"> </span>ALU<span class="_ _11"> </span>gen-</div><div class="t m5 x17 h26 y3d93 ff7 fs19 fc2 sc0 ls0 ws0">erates<span class="_ _11"> </span>the<span class="_ _11"> </span>three<span class="_ _16"> </span>signals<span class="_"> </span>on<span class="_ _16"> </span>which<span class="_ _11"> </span>the<span class="_ _11"> </span>condition<span class="_ _11"> </span>codes<span class="_ _16"> </span>are<span class="_"> </span>based—zero,<span class="_ _11"> </span>sign,<span class="_ _11"> </span>and</div><div class="t m5 x17 h26 y3d94 ff7 fs19 fc2 sc0 ls0 ws0">overﬂow—every<span class="_ _14"> </span>time<span class="_ _15"> </span>it<span class="_ _15"> </span>operates<span class="_ _1"></span>.<span class="_ _15"> </span>However,<span class="_ _15"> </span>we<span class="_ _15"> </span>only<span class="_ _15"> </span>want<span class="_ _15"> </span>to<span class="_ _15"> </span>set<span class="_ _14"> </span>the<span class="_ _15"> </span>condition</div><div class="t m5 x17 h26 y3d95 ff7 fs19 fc2 sc0 ls0 ws0">codes<span class="_"> </span>when<span class="_"> </span>an<span class="_"> </span><span class="ffd">OPq<span class="_ _10"> </span></span>instruction<span class="_"> </span>is<span class="_"> </span>executed.<span class="_"> </span>W<span class="_ _7"></span>e<span class="_"> </span>therefore<span class="_"> </span>generate<span class="_"> </span>a<span class="_"> </span>signal<span class="_"> </span><span class="ff6">set_cc</span></div><div class="t m5 x17 h26 y3d96 ff7 fs19 fc2 sc0 ls0 ws0">that<span class="_"> </span>controls<span class="_"> </span>whether<span class="_"> </span>or<span class="_"> </span>not<span class="_"> </span>the<span class="_"> </span>condition<span class="_"> </span>code<span class="_"> </span>register<span class="_"> </span>should<span class="_"> </span>be<span class="_"> </span>updated:</div><div class="t m5 x17 h2d y3d97 ffd fs1e fc2 sc0 ls0 ws0">bool<span class="_ _e"> </span>set_cc<span class="_ _1f"> </span>=<span class="_ _1f"> </span>icode<span class="_ _e"> </span>in<span class="_ _1f"> </span>{<span class="_ _e"> </span>IOPQ<span class="_ _1f"> </span>};</div><div class="t m5 x26 h26 y3d98 ff7 fs19 fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>hardware<span class="_"> </span>unit<span class="_ _13"> </span>labeled<span class="_"> </span>“cond”<span class="_"> </span>uses<span class="_"> </span>a<span class="_ _13"> </span>combination<span class="_"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>condition<span class="_"> </span>codes</div><div class="t m5 x17 h26 y3d99 ff7 fs19 fc2 sc0 ls0 ws0">and<span class="_ _13"> </span>the<span class="_"> </span>function<span class="_ _13"> </span>code<span class="_"> </span>to<span class="_ _13"> </span>determine<span class="_ _13"> </span>whether<span class="_"> </span>a<span class="_ _13"> </span>conditional<span class="_ _13"> </span>branch<span class="_"> </span>or<span class="_ _13"> </span>data<span class="_"> </span>transfer</div><div class="t m5 x17 h26 y3d9a ff7 fs19 fc2 sc0 ls0 ws0">should<span class="_ _13"> </span>take<span class="_ _6"> </span>place<span class="_ _13"> </span>(F<span class="_ _1"></span>igure<span class="_ _6"> </span>4.3).<span class="_ _13"> </span>It<span class="_ _6"> </span>generates<span class="_ _13"> </span>the<span class="_ _13"> </span><span class="ff6">Cnd<span class="_ _6"> </span></span>signal<span class="_ _13"> </span>used<span class="_ _6"> </span>both<span class="_ _13"> </span>for<span class="_ _6"> </span>the<span class="_ _13"> </span>setting</div><div class="t m5 x17 h26 y3d9b ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_"> </span><span class="ff6">dstE<span class="_ _10"> </span></span>with<span class="_"> </span>conditional<span class="_"> </span>moves<span class="_ _13"> </span>and<span class="_"> </span>in<span class="_"> </span>the<span class="_"> </span>next<span class="_"> </span>PC<span class="_"> </span>logic<span class="_"> </span>for<span class="_ _13"> </span>conditional<span class="_"> </span>branches<span class="_ _1"></span>.</div><div class="t m5 x17 h26 y3d9c ff7 fs19 fc2 sc0 ls0 ws0">F<span class="_ _1"></span>or<span class="_ _16"> </span>other<span class="_ _11"> </span>instructions<span class="_ _1"></span>,<span class="_ _16"> </span>the<span class="_ _16"> </span><span class="ff6">Cnd<span class="_ _16"> </span></span>signal<span class="_ _11"> </span>may<span class="_ _16"> </span>be<span class="_ _11"> </span>set<span class="_ _16"> </span>to<span class="_ _16"> </span>either<span class="_ _11"> </span>1<span class="_ _16"> </span>or<span class="_ _16"> </span>0,<span class="_ _16"> </span>depending<span class="_ _11"> </span>on</div><div class="t m5 x17 h26 y3d9d ff7 fs19 fc2 sc0 ls0 ws0">the<span class="_ _11"> </span>instruction’s<span class="_ _16"> </span>function<span class="_ _11"> </span>code<span class="_ _16"> </span>and<span class="_ _11"> </span>the<span class="_ _16"> </span>setting<span class="_ _11"> </span>of<span class="_ _16"> </span>the<span class="_ _11"> </span>condition<span class="_ _16"> </span>codes<span class="_ _1"></span>,<span class="_ _16"> </span>but<span class="_ _16"> </span>it<span class="_ _11"> </span>will</div><div class="t m5 x17 h26 y3d9e ff7 fs19 fc2 sc0 ls0 ws0">be<span class="_"> </span>ignored<span class="_"> </span>by<span class="_"> </span>the<span class="_"> </span>control<span class="_"> </span>logic.<span class="_"> </span>W<span class="_ _3"></span>e<span class="_"> </span>omit<span class="_"> </span>the<span class="_"> </span>detailed<span class="_"> </span>design<span class="_"> </span>of<span class="_"> </span>this<span class="_"> </span>unit.</div><div class="t m5 x17 h47 y3d9f ffe fs2b fc1 sc0 ls0 ws0">Practice<span class="_"> </span>Problem<span class="_"> </span>4.24<span class="_ _1f"> </span><span class="fs16">(solution<span class="_"> </span>page<span class="_"> </span>524)</span></div><div class="t m5 x17 h26 y3da0 ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _21"> </span>conditional<span class="_ _21"> </span>move<span class="_ _21"> </span>instructions<span class="_ _1"></span>,<span class="_ _f"> </span>abbreviated<span class="_ _21"> </span><span class="ffd">cmovXX</span>,<span class="_ _f"> </span>have<span class="_ _21"> </span>instruction<span class="_ _21"> </span>code</div><div class="t m5 x17 h26 y3da1 ffd fs19 fc1 sc0 ls0 ws0">IRRMOVQ<span class="ff7">.<span class="_ _11"> </span>As<span class="_ _16"> </span>F<span class="_ _0"></span>igure<span class="_ _11"> </span>4.28<span class="_ _16"> </span>shows<span class="_ _1"></span>,<span class="_ _16"> </span>we<span class="_ _11"> </span>can<span class="_ _16"> </span>implement<span class="_ _16"> </span>these<span class="_ _11"> </span>instructions<span class="_ _16"> </span>by<span class="_ _11"> </span>making</span></div><div class="t m5 x17 h26 y3da2 ff7 fs19 fc1 sc0 ls0 ws0">use<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _16"> </span><span class="ff6">Cnd<span class="_ _11"> </span></span>signal,<span class="_ _11"> </span>generated<span class="_ _16"> </span>in<span class="_ _11"> </span>the<span class="_ _11"> </span>execute<span class="_ _16"> </span>stage<span class="_ _1"></span>.<span class="_ _11"> </span>Modify<span class="_ _16"> </span>the<span class="_ _11"> </span>HCL<span class="_ _11"> </span>code<span class="_ _11"> </span>for</div><div class="t m5 x17 h26 y3da3 ff6 fs19 fc1 sc0 ls0 ws0">dstE<span class="_ _10"> </span><span class="ff7">to<span class="_"> </span>implement<span class="_"> </span>these<span class="_"> </span>instructions<span class="_ _1"></span>.</span></div><div class="t m5 x17 h42 y1a57 ff6 fs29 fc6 sc0 ls0 ws0">Memory<span class="_ _16"> </span>Stage</div><div class="t m5 x17 h26 y15bf ff7 fs19 fc1 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_ _15"> </span>memory<span class="_ _15"> </span>stage<span class="_ _15"> </span>has<span class="_ _15"> </span>the<span class="_ _15"> </span>task<span class="_ _15"> </span>of<span class="_ _15"> </span>either<span class="_ _15"> </span>reading<span class="_ _15"> </span>or<span class="_ _15"> </span>writing<span class="_ _15"> </span>program<span class="_ _15"> </span>data.<span class="_ _15"> </span>As</div><div class="t m5 x17 h26 y15c0 ff7 fs19 fc1 sc0 ls0 ws0">shown<span class="_ _15"> </span>in<span class="_ _21"> </span>F<span class="_ _0"></span>igure<span class="_ _15"> </span>4.30,<span class="_ _f"> </span>two<span class="_ _21"> </span>control<span class="_ _15"> </span>blocks<span class="_ _21"> </span>generate<span class="_ _15"> </span>the<span class="_ _21"> </span>values<span class="_ _21"> </span>for<span class="_ _15"> </span>the<span class="_ _21"> </span>memory</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
