<div id="pf1f6" class="pf w2 h11" data-page-no="1f6"><div class="pc pc1f6 w2 h11"><img class="bi x0 y0 w1 h1" alt="" src="csapp/bg1f6.png"/><div class="t m5 x13d h28 y9b ff6 fs1f fc2 sc0 ls0 ws0">Section<span class="_ _10"> </span>4.5<span class="_ _60"> </span>Pipelined<span class="_ _10"> </span>Y86-64<span class="_ _10"> </span>Implementations<span class="_ _3e"> </span><span class="ffe fs1e">501</span></div><div class="t m5 x34 h2a y257 fff fs1c fc2 sc0 ls0 ws0">Aside<span class="_ _1b"> </span><span class="ff6 fs19">T<span class="_ _3"></span>esting<span class="_ _11"> </span>the<span class="_ _11"> </span>design</span></div><div class="t m5 x34 h2b y2d0 ff7 fs1e fc2 sc0 ls0 ws0">As<span class="_ _6"> </span>we<span class="_ _6"> </span>have<span class="_ _6"> </span>seen,<span class="_ _13"> </span>there<span class="_ _6"> </span>are<span class="_ _6"> </span>many<span class="_ _6"> </span>ways<span class="_ _13"> </span>to<span class="_ _a"> </span>introduce<span class="_ _6"> </span>bugs<span class="_ _13"> </span>into<span class="_ _a"> </span>a<span class="_ _13"> </span>design,<span class="_ _6"> </span>even<span class="_ _6"> </span>for<span class="_ _6"> </span>a<span class="_ _6"> </span>simple<span class="_ _13"> </span>microprocessor<span class="_ _1"></span>.</div><div class="t m5 x34 h2b y2d1 ff7 fs1e fc2 sc0 ls0 ws0">W<span class="_ _1"></span>ith<span class="_ _13"> </span>pipelining<span class="_ _0"></span>,<span class="_ _13"> </span>there<span class="_ _a"> </span>are<span class="_ _13"> </span>many<span class="_ _6"> </span>subtle<span class="_ _6"> </span>interactions<span class="_ _13"> </span>between<span class="_ _a"> </span>the<span class="_ _13"> </span>instructions<span class="_ _6"> </span>at<span class="_ _6"> </span>different<span class="_ _13"> </span>pipeline<span class="_ _6"> </span>stages<span class="_ _1"></span>.</div><div class="t m5 x34 h2b y2d2 ff7 fs1e fc2 sc0 ls0 ws0">W<span class="_ _3"></span>e<span class="_"> </span>have<span class="_"> </span>seen<span class="_"> </span>that<span class="_"> </span>many<span class="_"> </span>of<span class="_"> </span>the<span class="_"> </span>design<span class="_"> </span>challenges<span class="_ _10"> </span>involve<span class="_"> </span>unusual<span class="_"> </span>instructions<span class="_"> </span>(such<span class="_"> </span>as<span class="_"> </span>popping<span class="_"> </span>to<span class="_"> </span>the</div><div class="t m5 x34 h2b y2d3 ff7 fs1e fc2 sc0 ls0 ws0">stack<span class="_"> </span>pointer)<span class="_ _11"> </span>or<span class="_"> </span>unusual<span class="_ _10"> </span>instruction<span class="_ _11"> </span>combinations<span class="_"> </span>(such<span class="_ _11"> </span>as<span class="_"> </span>a<span class="_ _10"> </span>not-taken<span class="_ _11"> </span>jump<span class="_"> </span>followed<span class="_ _11"> </span>by<span class="_"> </span>a<span class="_ _11"> </span><span class="ffd">ret</span>).<span class="_"> </span>W<span class="_ _1"></span>e</div><div class="t m5 x34 h2b y2d4 ff7 fs1e fc2 sc0 ls0 ws0">also<span class="_ _16"> </span>see<span class="_ _16"> </span>that<span class="_ _16"> </span>exception<span class="_ _11"> </span>handling<span class="_ _16"> </span>adds<span class="_ _16"> </span>an<span class="_ _16"> </span>entirely<span class="_ _16"> </span>new<span class="_ _16"> </span>dimension<span class="_ _16"> </span>to<span class="_ _16"> </span>the<span class="_ _11"> </span>possible<span class="_ _16"> </span>pipeline<span class="_ _16"> </span>behaviors<span class="_ _1"></span>.</div><div class="t m5 x34 h2b y2d5 ff7 fs1e fc2 sc0 ls0 ws0">How<span class="_ _3"></span>,<span class="_"> </span>then,<span class="_ _11"> </span>can<span class="_"> </span>we<span class="_"> </span>be<span class="_ _11"> </span>sure<span class="_"> </span>that<span class="_ _10"> </span>our<span class="_ _11"> </span>design<span class="_"> </span>is<span class="_"> </span>correct?<span class="_ _11"> </span>F<span class="_ _1"></span>or<span class="_"> </span>hardware<span class="_ _11"> </span>manufacturers<span class="_ _1"></span>,<span class="_"> </span>this<span class="_ _10"> </span>is<span class="_ _11"> </span>a<span class="_"> </span>dominant</div><div class="t m5 x34 h2b y2d6 ff7 fs1e fc2 sc0 ls0 ws0">concern,<span class="_ _14"> </span>since<span class="_ _14"> </span>they<span class="_ _14"> </span>cannot<span class="_ _14"> </span>simply<span class="_ _14"> </span>report<span class="_ _14"> </span>an<span class="_ _14"> </span>error<span class="_ _14"> </span>and<span class="_ _16"> </span>have<span class="_ _14"> </span>users<span class="_ _14"> </span>download<span class="_ _14"> </span>code<span class="_ _14"> </span>patches<span class="_ _14"> </span>over<span class="_ _14"> </span>the</div><div class="t m5 x34 h2b y549 ff7 fs1e fc2 sc0 ls0 ws0">Internet.<span class="_ _6"> </span>Even<span class="_ _13"> </span>a<span class="_ _6"> </span>simple<span class="_ _13"> </span>logic<span class="_ _6"> </span>design<span class="_ _13"> </span>error<span class="_ _6"> </span>can<span class="_ _13"> </span>have<span class="_ _6"> </span>serious<span class="_ _13"> </span>consequences<span class="_ _3"></span>,<span class="_ _13"> </span>especially<span class="_ _13"> </span>as<span class="_ _6"> </span>microprocessors</div><div class="t m5 x34 h2b y54a ff7 fs1e fc2 sc0 ls0 ws0">are<span class="_ _11"> </span>increasingly<span class="_ _16"> </span>used<span class="_ _11"> </span>to<span class="_ _11"> </span>operate<span class="_ _16"> </span>systems<span class="_ _11"> </span>that<span class="_ _16"> </span>are<span class="_ _11"> </span>critical<span class="_ _11"> </span>to<span class="_ _16"> </span>our<span class="_ _11"> </span>lives<span class="_ _16"> </span>and<span class="_ _11"> </span>health,<span class="_ _16"> </span>such<span class="_ _11"> </span>as<span class="_ _16"> </span>automotive</div><div class="t m5 x34 h2b y54b ff7 fs1e fc2 sc0 ls0 ws0">antilock<span class="_"> </span>braking<span class="_"> </span>systems<span class="_ _1"></span>,<span class="_"> </span>heart<span class="_"> </span>pacemakers<span class="_ _1"></span>,<span class="_"> </span>and<span class="_"> </span>aircraft<span class="_"> </span>control<span class="_"> </span>systems<span class="_ _1"></span>.</div><div class="t m5 x35 h2b y54c ff7 fs1e fc2 sc0 ls0 ws0">Simply<span class="_ _13"> </span>simulating<span class="_"> </span>a<span class="_ _13"> </span>design<span class="_ _13"> </span>while<span class="_ _13"> </span>running<span class="_ _13"> </span>a<span class="_ _13"> </span>number<span class="_"> </span>of<span class="_ _13"> </span>“typical”<span class="_ _13"> </span>programs<span class="_ _13"> </span>is<span class="_ _13"> </span>not<span class="_"> </span>a<span class="_ _13"> </span>sufﬁcient<span class="_ _13"> </span>means</div><div class="t m5 x34 h2b y54d ff7 fs1e fc2 sc0 ls0 ws0">of<span class="_ _13"> </span>testing<span class="_ _13"> </span>a<span class="_ _13"> </span>system.<span class="_"> </span>Instead,<span class="_ _13"> </span>thorough<span class="_ _13"> </span>testing<span class="_ _13"> </span>requires<span class="_ _13"> </span>devising<span class="_ _13"> </span>ways<span class="_ _13"> </span>of<span class="_ _13"> </span>systematically<span class="_ _13"> </span>generating<span class="_ _13"> </span>many</div><div class="t m5 x34 h2b y54e ff7 fs1e fc2 sc0 ls0 ws0">tests<span class="_ _15"> </span>that<span class="_ _15"> </span>will<span class="_ _21"> </span>exercise<span class="_ _15"> </span>as<span class="_ _21"> </span>many<span class="_ _15"> </span>different<span class="_ _21"> </span>instructions<span class="_ _15"> </span>and<span class="_ _21"> </span>instruction<span class="_ _15"> </span>combinations<span class="_ _21"> </span>as<span class="_ _15"> </span>possible.<span class="_ _15"> </span>In</div><div class="t m5 x34 h2b y70b ff7 fs1e fc2 sc0 ls0 ws0">creating<span class="_ _14"> </span>our<span class="_ _15"> </span>Y86-64<span class="_ _15"> </span>processor<span class="_ _14"> </span>designs<span class="_ _0"></span>,<span class="_ _15"> </span>we<span class="_ _15"> </span>also<span class="_ _15"> </span>devised<span class="_ _15"> </span>a<span class="_ _14"> </span>number<span class="_ _15"> </span>of<span class="_ _15"> </span>testing<span class="_ _14"> </span>scripts<span class="_ _0"></span>,<span class="_ _15"> </span>each<span class="_ _15"> </span>of<span class="_ _15"> </span>which</div><div class="t m5 x34 h2b y70c ff7 fs1e fc2 sc0 ls0 ws0">generates<span class="_"> </span>many<span class="_ _11"> </span>different<span class="_ _10"> </span>tests<span class="_ _0"></span>,<span class="_ _10"> </span>runs<span class="_ _11"> </span>simulations<span class="_ _10"> </span>of<span class="_ _11"> </span>the<span class="_ _10"> </span>processor,<span class="_ _10"> </span>and<span class="_ _11"> </span>compares<span class="_ _10"> </span>the<span class="_ _11"> </span>resulting<span class="_ _10"> </span>register</div><div class="t m5 x34 h2b y70d ff7 fs1e fc2 sc0 ls0 ws0">and<span class="_"> </span>memory<span class="_"> </span>values<span class="_ _11"> </span>to<span class="_"> </span>those<span class="_"> </span>produced<span class="_ _11"> </span>by<span class="_"> </span>our<span class="_"> </span><span class="ff9">yis<span class="_ _11"> </span></span>instruction<span class="_"> </span>set<span class="_"> </span>simulator.<span class="_"> </span>Here<span class="_ _10"> </span>is<span class="_ _11"> </span>a<span class="_"> </span>brief<span class="_"> </span>description</div><div class="t m5 x34 h2b y70e ff7 fs1e fc2 sc0 ls0 ws0">of<span class="_"> </span>the<span class="_"> </span>scripts:</div><div class="t m5 x26 h2b y45f8 ff7 fs1e fc2 sc0 ls0 ws0">optest.<span class="_ _e"> </span>Runs<span class="_ _13"> </span>49<span class="_ _13"> </span>tests<span class="_ _13"> </span>of<span class="_ _6"> </span>different<span class="_"> </span>Y86-64<span class="_ _6"> </span>instructions<span class="_"> </span>with<span class="_ _6"> </span>different<span class="_"> </span>source<span class="_ _6"> </span>and<span class="_"> </span>destination<span class="_ _6"> </span>registers</div><div class="t m5 x26 h2b y45f9 ff7 fs1e fc2 sc0 ls0 ws0">jtest.<span class="_ _e"> </span>Runs<span class="_ _6"> </span>64<span class="_ _6"> </span>tests<span class="_ _6"> </span>of<span class="_ _13"> </span>the<span class="_ _a"> </span>different<span class="_ _6"> </span>jump<span class="_ _13"> </span>and<span class="_ _a"> </span>call<span class="_ _6"> </span>instructions<span class="_ _1"></span>,<span class="_ _13"> </span>with<span class="_ _6"> </span>different<span class="_ _6"> </span>combinations<span class="_ _6"> </span>of<span class="_ _13"> </span>whether</div><div class="t m5 x142 h2b y7b9 ff7 fs1e fc2 sc0 ls0 ws0">or<span class="_"> </span>not<span class="_"> </span>the<span class="_"> </span>branches<span class="_"> </span>are<span class="_"> </span>taken</div><div class="t m5 x26 h2b y7ba ff7 fs1e fc2 sc0 ls0 ws0">cmtest.<span class="_ _e"> </span>Runs<span class="_ _11"> </span>28<span class="_ _11"> </span>tests<span class="_ _11"> </span>of<span class="_ _11"> </span>the<span class="_ _11"> </span>different<span class="_ _16"> </span>conditional<span class="_ _11"> </span>move<span class="_ _11"> </span>instructions<span class="_ _1"></span>,<span class="_ _11"> </span>with<span class="_ _16"> </span>different<span class="_ _10"> </span>control<span class="_ _16"> </span>combi-</div><div class="t m5 x142 h2b y7bb ff7 fs1e fc2 sc0 ls0 ws0">nations</div><div class="t m5 x26 h2b y418b ff7 fs1e fc2 sc0 ls0 ws0">htest.<span class="_ _e"> </span>Runs<span class="_ _16"> </span>600<span class="_ _14"> </span>tests<span class="_ _16"> </span>of<span class="_ _16"> </span>different<span class="_ _14"> </span>data<span class="_ _16"> </span>hazard<span class="_ _14"> </span>possibilities<span class="_ _1"></span>,<span class="_ _14"> </span>with<span class="_ _14"> </span>different<span class="_ _16"> </span>combinations<span class="_ _14"> </span>of<span class="_ _16"> </span>source</div><div class="t m5 x142 h2b y418c ff7 fs1e fc2 sc0 ls0 ws0">and<span class="_ _15"> </span>destination<span class="_ _21"> </span>instructions<span class="_ _0"></span>,<span class="_ _f"> </span>and<span class="_ _21"> </span>with<span class="_ _21"> </span>different<span class="_ _21"> </span>numbers<span class="_ _21"> </span>of<span class="_ _21"> </span><span class="ffd">nop<span class="_ _21"> </span></span>instructions<span class="_ _21"> </span>between<span class="_ _21"> </span>the</div><div class="t m5 x142 h2b y418d ff7 fs1e fc2 sc0 ls0 ws0">instruction<span class="_"> </span>pairs</div><div class="t m5 x26 h2b y45fa ff7 fs1e fc2 sc0 ls0 ws0">ctest.<span class="_ _e"> </span>T<span class="_ _7"></span>ests<span class="_ _16"> </span>22<span class="_ _11"> </span>different<span class="_ _11"> </span>control<span class="_ _16"> </span>combinations<span class="_ _1"></span>,<span class="_ _16"> </span>based<span class="_ _11"> </span>on<span class="_ _16"> </span>an<span class="_ _11"> </span>analysis<span class="_ _11"> </span>similar<span class="_ _16"> </span>to<span class="_ _11"> </span>what<span class="_ _11"> </span>we<span class="_ _16"> </span>did<span class="_ _11"> </span>in<span class="_ _16"> </span>Sec-</div><div class="t m5 x142 h2b y418f ff7 fs1e fc2 sc0 ls0 ws0">tion<span class="_"> </span>4.5.8</div><div class="t m5 x26 h2b y45fb ff7 fs1e fc2 sc0 ls0 ws0">etest.<span class="_ _e"> </span>T<span class="_ _7"></span>ests<span class="_"> </span>12<span class="_ _13"> </span>different<span class="_ _13"> </span>combinations<span class="_"> </span>where<span class="_ _13"> </span>an<span class="_ _13"> </span>instruction<span class="_ _13"> </span>causes<span class="_"> </span>an<span class="_ _13"> </span>exception<span class="_ _13"> </span>and<span class="_ _13"> </span>the<span class="_ _13"> </span>instructions</div><div class="t m5 x142 h2b y45fc ff7 fs1e fc2 sc0 ls0 ws0">following<span class="_"> </span>it<span class="_"> </span>could<span class="_"> </span>alter<span class="_"> </span>the<span class="_"> </span>programmer<span class="_ _1"></span>-visible<span class="_"> </span>state</div><div class="t m5 x34 h2b y45fd ff7 fs1e fc2 sc0 ls0 ws0">T<span class="_ _1"></span>he<span class="_"> </span>key<span class="_ _13"> </span>idea<span class="_ _13"> </span>of<span class="_ _13"> </span>this<span class="_ _13"> </span>testing<span class="_"> </span>method<span class="_ _13"> </span>is<span class="_ _13"> </span>that<span class="_ _13"> </span>we<span class="_ _13"> </span>want<span class="_ _13"> </span>to<span class="_ _13"> </span>be<span class="_"> </span>as<span class="_ _13"> </span>systematic<span class="_ _13"> </span>as<span class="_ _13"> </span>possible<span class="_ _1"></span>,<span class="_"> </span>generating<span class="_ _13"> </span>tests<span class="_ _13"> </span>that</div><div class="t m5 x34 h2b y45fe ff7 fs1e fc2 sc0 ls0 ws0">create<span class="_"> </span>the<span class="_"> </span>different<span class="_"> </span>conditions<span class="_"> </span>that<span class="_"> </span>are<span class="_"> </span>likely<span class="_"> </span>to<span class="_"> </span>cause<span class="_"> </span>pipeline<span class="_"> </span>errors<span class="_ _1"></span>.</div><div class="t m5 x17 h26 y8ff ff7 fs19 fc2 sc0 ls0 ws0">processor<span class="_ _13"> </span>on<span class="_"> </span>some<span class="_ _13"> </span>benchmark<span class="_ _13"> </span>program<span class="_"> </span>and<span class="_ _13"> </span>observe<span class="_"> </span>the<span class="_ _13"> </span>operation<span class="_ _13"> </span>of<span class="_"> </span>the<span class="_ _13"> </span>execute</div><div class="t m5 x17 h26 y900 ff7 fs19 fc2 sc0 ls0 ws0">stage<span class="_ _1"></span>.<span class="_"> </span>On<span class="_ _13"> </span>each<span class="_ _13"> </span>cycle<span class="_ _1"></span>,<span class="_"> </span>the<span class="_ _13"> </span>execute<span class="_"> </span>stage<span class="_ _13"> </span>either<span class="_ _13"> </span>(1)<span class="_"> </span>processes<span class="_ _13"> </span>an<span class="_ _13"> </span>instruction<span class="_"> </span>and<span class="_ _13"> </span>this</div><div class="t m5 x17 h26 y901 ff7 fs19 fc2 sc0 ls0 ws0">instruction<span class="_ _6"> </span>continues<span class="_ _13"> </span>through<span class="_ _6"> </span>the<span class="_ _13"> </span>remaining<span class="_ _6"> </span>stages<span class="_ _13"> </span>to<span class="_ _6"> </span>completion,<span class="_ _13"> </span>or<span class="_ _13"> </span>(2)<span class="_ _6"> </span>processes</div><div class="t m5 x17 h26 y902 ff7 fs19 fc2 sc0 ls0 ws0">a<span class="_ _13"> </span>bubble<span class="_ _6"> </span>injected<span class="_ _13"> </span>due<span class="_ _6"> </span>to<span class="_ _13"> </span>one<span class="_ _13"> </span>of<span class="_ _6"> </span>the<span class="_ _13"> </span>three<span class="_ _6"> </span>special<span class="_ _13"> </span>cases<span class="_ _1"></span>.<span class="_ _13"> </span>If<span class="_ _6"> </span>the<span class="_ _13"> </span>stage<span class="_ _6"> </span>processes<span class="_ _13"> </span>a<span class="_ _13"> </span>total</div><div class="t m5 x17 h26 y903 ff7 fs19 fc2 sc0 ls0 ws0">of<span class="_ _13"> </span><span class="ff11">C</span></div><div class="t m5 x253 h50 y45ff ff11 fs25 fc2 sc0 ls0 ws0">i</div><div class="t m5 x1a2 h26 yc26 ff7 fs19 fc2 sc0 ls0 ws0">instructions<span class="_ _13"> </span>and<span class="_ _13"> </span><span class="ff11">C</span></div><div class="t m5 x1b7 h50 y45ff ff11 fs25 fc2 sc0 ls0 ws0">b</div><div class="t m5 xe0 h26 yc26 ff7 fs19 fc2 sc0 ls0 ws0">bubbles<span class="_ _1"></span>,<span class="_ _13"> </span>then<span class="_ _13"> </span>the<span class="_"> </span>processor<span class="_ _13"> </span>has<span class="_ _13"> </span>required<span class="_ _13"> </span>around<span class="_ _13"> </span><span class="ff11">C</span></div><div class="t m5 x132 h50 y45ff ff11 fs25 fc2 sc0 ls0 ws0">i</div><div class="t m5 x44 h46 yc26 ff12 fs19 fc2 sc0 ls0 ws0">+<span class="_ _13"></span><span class="ff11">C</span></div><div class="t m5 xd6 h50 y45ff ff11 fs25 fc2 sc0 ls0 ws0">b</div><div class="t m5 x17 h26 yc04 ff7 fs19 fc2 sc0 ls0 ws0">total<span class="_"> </span>clock<span class="_"> </span>cycles<span class="_"> </span>to<span class="_ _11"> </span>execute<span class="_"> </span><span class="ff11">C</span></div><div class="t m5 x1af h50 y4600 ff11 fs25 fc2 sc0 ls0 ws0">i</div><div class="t m5 xf0 h26 yc04 ff7 fs19 fc2 sc0 ls0 ws0">instructions<span class="_ _1"></span>.<span class="_"> </span>W<span class="_ _1"></span>e<span class="_"> </span>say<span class="_"> </span>“around”<span class="_ _11"> </span>because<span class="_"> </span>we<span class="_ _11"> </span>ignore</div></div><div class="pi" data-data='{"ctm":[2.000000,0.000000,0.000000,2.000000,0.000000,0.000000]}'></div></div>
